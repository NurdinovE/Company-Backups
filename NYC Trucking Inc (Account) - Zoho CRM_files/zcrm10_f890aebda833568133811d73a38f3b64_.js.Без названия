var FingerPrint=FingerPrint||{};FingerPrint.setProperties=function(e,t,a){this.config_properties&&this.config_properties[e]&&(this.config_properties[e][t]=this.config_properties[e][t]||{},"object"==typeof a&&$.extend(FingerPrint.config_properties[e][t],a))},FingerPrint.getImageUrl=function(e,t){var a="default"===e?ResourceConstants.CRM:"CRMClient"===e?ResourceConstants.CRMClient:ResourceConstants.CRMOrganization;return networkUtils.getImageUrl(t,a)};var crmHistory={length:0,backOneLevel:function(e,t,a,r,o){if(renderingUtils.zctt.hidett(!0),!a){var i=$(t).attr("data-params");delete(a=i?JSON.parse(i):{}).clickId,delete a.calleeObj}var n=history.state.data;if(n&&n.backOneLevel){var s=n.backOneLevel.historyIndex,l=Crm.newHistoryArr[s];if(l){if("crm.tab.module.custom-view.list"==l.route&&crmNavig.customViewKey===l.dynamicParams[1]&&("crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route)){var d=crmNavig.getRecordNumToId(Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],crmNavig.customViewKey),c=commonUtils.getFromToIndexes(d-1,moduleRecordMapping[l.dynamicParams[0]].per_page),m=crmHistory.getPageDetailsFromIndex(c[0],c[1]);l.queryParams=l.queryParams||{},l.queryParams.page=m.page,l.queryParams.per_page=m.perPage,l.data.fromIndex=c[0],l.data.toIndex=c[1]}!r||"crm.tab.module.custom-view.list"!==l.route&&"crm.tab.module.custom-view.kanban"!==l.route&&"crm.tab.module.custom-view.canvas"!==l.route||(a||(a={}),a.clearCache=!0),o&&"crm.tab.module.entity.detail"===l.route&&(a||(a={}),a.kafkaWFData=o);var u=Lyte.Router.transitionTo(l);for(var p in l.data&&(delete l.data.fetchOnlyBody,"crm.tab.module.entity.detail"!==l.route&&"crm.tab.module.entity.canvas"!==l.route||delete l.data.affected_data),u.data=Object.assign({},l.data),a)u.data[p]=a[p]}else crmHistory.handleAptBack()}else{console.error("backOneLevel Not found"),crmHistory.handleAptBack()}},handleAptBack:function(){var e=Lyte.Router.getRouteInstance().transition.info;if(-1!==e.route.indexOf("crm.tab.module"))-1!==e.route.indexOf("crm.tab.module.entity.")?Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:[e.dynamicParams[0],e.dynamicParams[1]]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[e.dynamicParams[0]]});else if(-1===e.route.indexOf("crm.settings")||/autoresponders|custom-view|macro|manage-mass-mail/.test(e.route)){var t=e.route.match(/crm.tab.google-adwords|crm.tab.projects|crm.tab.reports|crm.tab.marketplace|crm.tab.forecasts|crm.tab.dashboards|crm.tab.approvals/);t&&t.length>0?Lyte.Router.transitionTo({route:t[0]}):e.queryParams.module?Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[e.queryParams.module]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:["Home"]})}else Lyte.Router.transitionTo("crm.settings.index")},backToListView:function(){this.backOneLevel()},getCurrentStateData:function(){return history.state?history.state.data:{}},refreshCurrentPage:function(){var e=Lyte.Router.getRouteInstance(),t=e.transition?e.transition.data:{};!0!==t.fromActivityListView&&"cv"!==t.pfrom&&"true"!==t.fromActivityListView||(t.fromDetailView=!0),e.refresh().data=t},getPrevListView:function(){for(var e=Crm.newHistoryArr,t=e.length-1;t>-1;t--){if(/crm.tab.module.custom-view.list|crm.tab.module.custom-view.kanban|crm.global-search|crm.tab.module.actions.approve|crm.tab.module.actions.mass-tools|crm.tab.forecasts.pipeline/.test(e[t].route))return e[t];if("crm.tab.module.begin"===e[t].route&&"Home"===e[t].dynamicParams[0])return e[t]}return!1},back:function(e,t){var a=t&&t.step?t.step:1;$("#taskDetailsPart");a=parseInt(a);var r=$(t);if(t&&r.length){var o=r.attr("data-module");if("Activities"===Crm.activityGrp[o]&&"edit"===window[o].currentStatus&&"true"===$("#iskanbanview").val())return $("#cvEditSave").empty(),hide("cvEditSave"),ActivityMoreInfoContent?$("#entitypopup").html(ActivityMoreInfoContent):taskDetailsview.listAnimation("close"),void(ActivityMoreInfoContent="")}crmHistory.length<=1?crmHistory.handleAptBack():(crmHistory.length=crmHistory.length-a-1,crmHistory.fromProgBack=!0,history.go(-a))},getPageDetailsFromIndex:function(e,t){var a={};e=Number(e),t=Number(t);return isNaN(e)||isNaN(t)||(a.perPage=t-e+1,a.page=t/a.perPage),a},getNewURL:function(e){if(-1===e.indexOf(".do"))return(decodeURIComponent(e).indexOf("Voice Of Customer")>-1||decodeURIComponent(e).indexOf("Voice of the Customer")>-1)&&(e=crmTab&&crmTab.showVocPromoTab?decodeURIComponent(e).replace(decodeURIComponent(e).indexOf("Voice Of Customer")>-1?"Voice Of Customer":"Voice of the Customer","voc/promo"):decodeURIComponent(e).replace(decodeURIComponent(e).indexOf("Voice Of Customer")>-1?"Voice Of Customer":"Voice of the Customer","voc/analytics")),(e.includes("workflow-alerts")||e.includes("workflow-tasks")||e.includes("workflow-field-updates")||e.includes("workflow-webhooks"))&&(e=e.replace("workflow-","")),networkUtils.getOrgSpecificURL(e);location.pathname;var t=location.search;t=t?JSON.parse('{"'+decodeURI(t.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'):{};var a=networkUtils.parseUrl(e),r=e.substring(0,e.indexOf(a.action)),o={},i=a.params,n=moduleRecordMapping[i.module],s={accountInfo:"personal-settings",notificationSettings:"sales-signals",viewOrgDetails:"company-details",editFiscal:"fiscal-year",bizhrs:"business-hours",bushrs:"business-hours",holidays:"holidays",currencies:"currencies",emailSettings:"email-settings",aes:"email-sharing",emailParser:"email-parser",emailAuth:"email-auth",bcc:"bcc-dropbox",trackingSettings:"email-insights",orgEmail:"organization-emails",workflow:"workflow-rules",telephony:"telephony",schedules:"schedules",authKey:"phonebridge-token",translation:"translation-settings",translationimporthistory:"translation-history",clientPortal:"client-portal",ZiaOrgConfig:"admin-panel",ZiaSettings:"reminder",ZiaUserConfig:"notification",sentimentModel:"sentiment-model",EventMeetingAuthorize:"meeting"};switch(a.action){case"EditCV":r+="settings/custom-view/"+i.cvid+"/edit?module="+i.module;break;case"GlobalSearch1":r+="search?searchword="+i.searchword,i.sModules&&(r+="&sModules="+i.sModules);break;case"ShowCalendar":r+="calendar?",i.type&&(r+="type="+i.type),i.module&&(r+="&module="+i.sModule),i.obtaineddate&&(r+="&obtaineddate="+i.obtaineddate),i.tdWidthParam&&(r+="&tdWidthParam="+i.tdWidthParam),i.userFetchCnt&&(r+="&userFetchCnt="+i.userFetchCnt),i.isTailLoadCall&&(r+="&isTailLoadCall="+i.isTailLoadCall),i.pageNo&&(r+="&pageNo="+i.pageNo),i.idStr&&(r+="&idStr="+i.idStr),i.searchword&&(r+="&searchword="+i.searchword),i.searchCategory&&(r+="&searchCategory="+i.searchCategory);break;case"tab":"Setup"==i.module?r+="settings/index":"Google Adwords"==i.module||"Google%20Adwords"==i.module||"Google AdWords"==i.module||"Google%20AdWords"==i.module?r+="tab/Google%20AdWords":r=r+"tab/"+i.module;break;case"EntReply":r=Crm.getCrmBasePath()+"/tab/"+i.module+"/"+i.entId+"/send-mail?action="+i.action+"&entityMail="+i.entityMail;break;case"ShowHomePage":if(void 0===Crm.nextGenInfo)r+="tab/Home/begin";else{var l=crmHistory.getLastAccessedURL();l&&(r=location.origin+l)}break;case"Migration":r+="settings/migration";break;case"CustomReport":-1==r.indexOf("/crm/CustomReport/")&&(r=Crm.getCrmBasePath()+"/tab/Reports/"+i.reportId+"?folderId="+i.folderId+"&repType=tabular");break;case"showMacro":i.ruleId&&(r=r+"settings/macro/"+i.ruleId,i.module&&(r=r+"?module="+i.module));break;case"ShowSetup":switch(-1==(r+="settings/").indexOf("/crm/settings/")&&(r=Crm.getCrmBasePath()+"/settings/"),i.subTab){case"accountInfo":case"notificationSettings":case"viewOrgDetails":case"editFiscal":case"currencies":case"bizhrs":case"aes":case"emailParser":case"emailAuth":case"bcc":case"trackingSettings":case"orgEmail":case"schedules":case"authKey":case"translation":case"translationimporthistory":case"clientPortal":case"pbxreg":case"holidays":r+=s[i.subTab];break;case"emailSettings":r=r+s[i.subTab]+"?action="+i.action,i.isFromSI&&(r=r+"&isFromSI="+i.isFromSI);break;case"telephony":r+=s[i.subTab],validationUtils.isNotEmpty(i.ctiname)?r=r+"/summary/"+i.ctiname:r+="/marketplace";break;case"chat":r=r+"extensions/zoho/"+i.appname;break;case"gameSettings":r+="game-settings";break;case"users":r+=i.subTab,i&&i.reqZUID&&(r+="?reqZUID="+i.reqZUID);break;case"activate":r+="activate-users";break;case"viewUser":r=r+"users/"+i.userId;break;case"bushrs":"viewBusinessHours"==i.action?r+="business-hours":"createShiftHours"==i.action?r+="business-hours/createShiftHours":("viewShiftHours"==i.action||"editShiftHours"==i.action)&&(r=r+"business-hours/"+i.shiftid);break;case"ZiaOrgConfig":case"ZiaUserConfig":case"ZiaSettings":r=r+"zia/"+s[i.subTab];break;case"Groups":r+="groups","viewGroup"==i.action&&(r=r+"/"+i.groupId);break;case"Profiles":r+="profiles",i.profileId&&(r=r+"/"+i.profileId);break;case"Roles":r+="roles",i.roleId&&(r=r+"/"+i.roleId);break;case"SharingSetting":r+="data-sharing";break;case"movetoOrg":r+="allowed-ips";break;case"zmailusers":r+="zmail-users";break;case"enableTerritory":case"assignTerritory":break;case"territoryRules":"territoryRules"===i.action&&(r+="/territory-rules");break;case"modules":if(r+="modules",i.module)if(r=r+"/"+i.module,"formRules"===i.innerTab){if(r+="/layout-rules",i.formRuleId){r=r+"/"+i.formRuleId+"?layoutId="+i.layoutId;break}}else if("layouts"===i.innerTab){if("dependency"===i.isLoadPage){r+="/map-dependency",i.layoutId&&(r=r+"?layoutId="+i.layoutId);break}if("mapping"===i.isLoadPage){r+="/conversion-mapping",i.leadLayoutId&&(r=r+"?leadLayoutId="+i.leadLayoutId);break}if(r=r+"/"+i.innerTab,i.layoutId&&(r=r+"/"+i.layoutId,i.actionType&&"createLayout"===i.actionType)){r+="/clone";break}}else if("moduleInfo"===i.innerTab)r+="/summary";else if("fields"===i.innerTab)i.isFieldPermission?(r+="/field-permissions",i.profileId&&(r=r+"?profileId="+i.profileId)):(r+="/field-listing",i.layoutId&&-1!=i.layoutId&&(r=r+"?layoutId="+i.layoutId));else{if("cusLink"==i.innerTab){r+="/links-and-buttons","createCustomButton"===i.step?r+="/create?component=button":"editCustomButton"===i.step&&(r=r+"/"+i.buttonId),i.layoutId&&-1!=i.layoutId&&(r=r+"?layoutId="+i.layoutId);break}if("validationRules"==i.innerTab){if(r+="/validation-rules",i.validationRuleId){r=r+"/"+i.validationRuleId+"?layoutId="+i.layoutId;break}break}r=r+"/"+i.innerTab}i.step&&(r=r+"/"+i.step),i.buttonId&&(r=r+"/"+i.buttonId),i.component&&(r=r+"/"+i.component);break;case"tabGroup":r+="tab-groups";break;case"webTabs":r+="web-tabs";break;case"inventory":case"mailmerge":case"email":r=r+"templates?type="+("mailmerge"==i.subTab?"mail-merge":i.subTab)+"&","newEmailTemplate"===i.step||"newInventoryTemplate"===i.step?(r+="step=create&",i.templateName&&(r+="templateName="+i.templateName+"&selectedcategory="+i.selectedcategory+"&")):"editEmailTemplate"===i.step||"editInventoryTemplate"===i.step?r+="step=edit&templateId="+i.emailTemplateId+"&":"cloneEmailTemplate"===i.step||"cloneInventoryTemplate"===i.step?r+="step=clone&templateId="+i.emailTemplateId+"&":"showGallery"===i.step||"showInventoryGallery"===i.step?r+="step=showGallery&":"showAllTemplates"!==i.step&&"showInventoryTemplates"!==i.step||!i.emailTemplateId||(r+="templateId="+i.emailTemplateId+"&"),i.module&&(r+="module="+i.module+"&"),i.folder&&(r+="folder="+i.folder),r=r.endsWith("&")?r.substring(0,r.length-1):r;break;case"resellerLgin":r+="copy-customization";break;case"workflow":r+=s[i.subTab],"newRule"==i.step&&(r+="/create",i.module&&(r=r+"?module="+i.module)),i.ruleId&&(r=r+"/"+i.ruleId,i.module&&(r=r+"?module="+i.module)),i.actionId&&(r=r+"?actionId="+i.actionId);break;case"insight":r+="workflow-insights",i.step&&(r=r+"?step="+i.step,i.module&&(r=r+"&module="+i.module),i.processId&&(r=r+"&processId="+i.processId));break;case"process":r+="blueprint","getProcessDetails"==i.action&&i.processId&&(r=r+"/"+i.processId,i.module&&(r=r+"?module="+i.module));break;case"usage":r+="blueprint-usage",i.action&&(r=r+"?action="+i.action,i.reportId&&(r=r+"&reportId="+i.reportId));break;case"setting":r+="blueprint-setting",i.action&&(r=r+"?action="+i.action);break;case"alert":if(r+="alerts",i.step){switch(i.step){case"newAlert":r+="/create";break;case"viewAlert":case"showAlert":r=r+"/"+i.alertId;break;case"editAlert":r=r+"/"+i.alertId+"/edit"}i.module&&(r=r+"?module="+i.module)}break;case"task":if(r+="tasks",i.step){switch(i.step){case"newTask":r+="/create";break;case"showTask":r=r+"/"+i.taskId;break;case"editTask":r=r+"/"+i.taskId+"/edit"}i.module&&(r=r+"?module="+i.module)}break;case"fieldUpdate":if(r+="field-updates",i.step){switch(i.step){case"newFieldUpdate":r+="/create";break;case"showFieldUpdate":r=r+"/"+i.fieldUpdateId;break;case"editFieldUpdate":r=r+"/"+i.fieldUpdateId+"/edit"}i.module&&(r=r+"?module="+i.module)}break;case"webhook":if(r+="webhooks",i.step){switch(i.step){case"newWebHook":r+="/create";break;case"showWebHook":r=r+"/"+i.webHookId;break;case"editWebHook":r=r+"/"+i.webHookId+"/edit"}i.module&&(r=r+"?module="+i.module)}break;case"wfdeluge":r+="deluge",i.delugeId&&(r=r+"?delugeId="+i.delugeId);break;case"cfSchedulers":r+="schedules";break;case"webLeads":r+="webform";break;case"autoRespRules":r+="auto-response-rules","viewAutoRespRuleEntries"===i.action?r=r+"?action=viewAutoRespRuleEntries&ruleId="+i.ruleId+"&ruleName="+i.ruleName+"&module="+i.seModule:i.seModule&&(r=r+"?module="+i.seModule);break;case"unsubscribe":r+="unsubscribe-link";break;case"assignmentRules":if(r+="assignment-rules",i.action)switch(i.action){case"viewRules":i.seModule&&(r=r+"?module="+i.seModule);break;case"viewRuleEntries":r=r+"/"+i.ruleId,i.seModule&&(r=r+"?module="+i.seModule);break;case"editRuleEntry":r=r+"/"+i.ruleId,i.seModule&&(r=r+"?module="+i.seModule),i.entryId&&(r=r+"&entryId="+i.entryId)}else i.seModule&&(r=r+"?module="+i.seModule);break;case"escalationRules":if(r+="escalation-rules",i.action)switch(i.action){case"viewEscRuleEntries":r=r+"/"+i.ruleId;break;case"viewEscalationsOfEscRuleEntry":r=r+"/"+i.ruleId+"?entryId="+i.entryId}break;case"approvalProcess":r+="approval-process",i.processId&&(r=r+"/"+i.processId);break;case"scoringRules":r+="scoring-rules";break;case"zohoApps":var d=i.appname;i.appname?"viewInvoiceIntegration"===i.appname?d="finance-suite":"zohomeeting"===i.appname&&(d="meeting"):d="apps",r=r+"extensions/zoho/"+d;break;case"googleUsers":case"googleAdwords":case"googleContacts":case"googleMail":case"googleDocs":case"googleCalendar":case"googleSites":case"googleTasks":r=r+"extensions/google/"+i.subTab.split("google")[1].toLowerCase();break;case"googleApps":r=r+"extensions/google/"+$u.invert(crmHistory.getGAppsRoutevsAction())[i.appname];break;case"googleChromeExt":r+="extensions/google/chrome-ext";break;case"microsoftApps":r+="extensions/microsoft/office-365";break;case"microsoftoutlook":r+="extensions/microsoft/outlook";break;case"microsoftword":r+="extensions/microsoft/word";break;case"twitter":case"facebook":r=r+"extensions/social/"+i.subTab;break;case"googleplus":r+="extensions/social/google-plus";break;case"socialaccounts":r+="extensions/social/brands";break;case"socialadmin":r+="extensions/social/admin-settings";break;case"leadgen":r+="extensions/social/lead-gen";break;case"marketPlace":if(r+="extensions/all",i.nameSpace){r=Object.keys(Events.displayToolName).contains(i.nameSpace)?r+"/meeting-integration?toolname="+i.nameSpace:r+"/"+i.nameSpace;var c="?";for(var m in i)"nameSpace"===m&&"tab"===m&&"subTab"===m||(c+=m+"="+i[m]+"&");c.length>1&&!Object.keys(Events.displayToolName).contains(i.nameSpace)&&(r+=c)}break;case"skyeye":r+="extensions/skyeye";break;case"otherApps":"telephony"==i.appname?(r+="telephony",validationUtils.isNotEmpty(i.ctiname)?r=r+"/summary/"+i.ctiname:r+="/marketplace"):(r+="webInteg/other-apps/otherApps",i.appname&&(r=r+"/"+i.name));break;case"api":var u=i.action||i.step;switch(u){case"developerapi":r+="api";break;case"topUsage":r+="api/usage/graph-view?",r+=(p=i.from||t.from)?"from="+p+"&":"",r+=(g=i.to||t.to)?"to="+g+"&":"",r+=(v=i.period||t.period)?"period="+v+"&":"",r=(r+=(f=i.type||t.type)?"type="+f:"").endsWith("&")||r.endsWith("?")?r.substring(0,r.length-1):r;break;case"statistics":r+="api/usage/table-view?";var p=i.from||t.from,g=i.to||t.to,v=i.period||t.period,f=i.type||t.type,h=i.order||t.order;r+=p?"from="+p+"&":"",r+=g?"to="+g+"&":"",r+=v?"period="+v+"&":"",r+=f?"type="+f+"&":"",r=(r+=h?"order="+decodeURIComponent(h):"").endsWith("&")||r.endsWith("?")?r.substring(0,r.length-1):r;break;case"ModulesList":r+="api/modules";break;case"FieldsList":case"RelatedList":r=r+"api/modules/"+i.module+"?step="+u}break;case"zscKey":r+="zsc-key";break;case"widgets":r+="widgets";break;case"functions":r+="functions";break;case"crmconnectors":r+="connections";break;case"crmvariables":r+="crmvariables",i.variableId?(r=r+"/"+i.variableId,i.groupId&&(r=r+"?groupId="+i.groupId)):i.groupId&&(r=r+"/create?groupId="+i.groupId);break;case"migrate":case"importHistory":r+="import-history";break;case"export":r+="export-data";break;case"backup":r+="data-backup";break;case"storageUsage":r+="storage";break;case"recyclebin":r+="recyclebin";break;case"auditLog":r+="auditlog";break;case"removeSampleData":r+="remove-sample-data";break;case"sandbox":r+="sandbox"}break;case"ShowTab":if("Setup"==i.module)r+="settings/index";else if("Google Adwords"==i.module||"Google%20Adwords"==i.module||"Google AdWords"==i.module||"Google%20AdWords"==i.module)r+="tab/Google%20AdWords";else if("Approvals"==i.module||"Reports"==i.module||"Dashboards"==i.module||"Forecasts"==i.module||"Emails"==i.module||"SalesInbox"==i.module||"Desk"==i.module||"Projects"==i.module)r=r+"tab/"+i.module;else if("Home"==i.module)r+="tab/Home/begin";else if(r=r+"tab/"+i.module,"Feeds"===i.module||"OneFeeds"==i.module)i.action&&(r.indexOf("?")>-1?r+="&action="+i.action:r+="?action="+i.action),i.id&&(r.indexOf("?")>-1?r+="&id="+i.id:r+="?id="+i.id),i.key&&(r.indexOf("?")>-1?r+="&key="+i.key:r+="?key="+i.key);else{if("true"!=i.webTab&&(i.cvid||(i.cvid=n.cvid,i.viewid=n.viewid),r=n.viewid?r+"/custom-view/"+i.cvid+"/canvas/"+n.viewid:r+"/custom-view/"+i.cvid+"/list"),delete i.webTab,delete i.module,delete i.cvid,delete i.viewid,i.fromIndex){var y=this.getPageDetailsFromIndex(i.fromIndex,i.toIndex);r+="?page="+y.page+"&per_page="+y.perPage}i.sortOrderString&&(o.sortOrder=i.sortOrderString,o.sortColumn=i.sortColumnString)}break;case"EntityInfo":r="Activities"!==Crm.activityGrp[i.module]||n.visible?"true"==i.showShared?r+"tab/"+i.module+"/"+i.id+"?showShared=true":void 0!==moduleRecordMapping[i.module]&&"team_based"===moduleRecordMapping[i.module].access_type&&moduleRecordMapping[i.module].private_profile&&"Requesters"===moduleRecordMapping[i.module].private_profile.name?r+"tab/Requesters/"+i.module+"/"+i.id+"/":r+"tab/"+i.module+"/"+i.id+"/":r+"tab/Activities/"+i.id+"?sub_module="+i.module;break;case"Dashboard":"showDashboard"==i.action&&i.dbId&&(r=r+"tab/Dashboards/"+i.dbId);break;case"CreateEntity":if(r="Activities"==Crm.activityGrp[i.module]?r+"tab/Activities/create?sub_module="+i.module:r+"tab/"+i.module+"/create",-1!=e.indexOf("#"))r=r+"#"+e.split("#")[1];break;case"CloneEntity":r="Activities"==Crm.activityGrp[i.module]?r+"tab/Activities/"+i.id+"/clone?sub_module="+i.module:r+"tab/"+i.module+"/"+i.id+"/clone";break;case"EditEntity":r="Activities"==Crm.activityGrp[i.module]?r+"tab/Activities/"+i.id+"/edit?sub_module="+i.module:r+"tab/"+i.module+"/"+i.id+"/edit";break;case"Import":r+="settings/import";break;case"Template":if("exportPDF"===i.action)r=r+"tab/"+i.module+"/"+i.entityId+"/export-pdf";else r=e;break;case"MassEmailRecords":r=r+"tab/"+i.module+"/actions/mass-email";break;case"IAMSecurityError":r+="iam-security-error";break;case"RoleForecast":case"TerritoryForecast":if(r+="tab/Forecasts","createForecast"==i.action)r+="/create";else if("viewForecast"==i.action){delete i.module,delete i.action;var b=0;for(var m in i)r+=0==b?"?":"&",r+=m+"="+i[m],b++}else"editForecastSettings"==i.action&&(r+="/editSettings");break;case"approvalProcess":if("detailedView"==i.action){if(r+="tab/Approvals/view?entityId="+i.entityId+"&recModule="+i.recModule,i.triggerAction){var C="";"approve"==i.triggerAction?C="Approval":"delete"==i.triggerAction?C="Delete":"reject"==i.triggerAction&&(C="Reject"),r+="&triggerAction="+C}break}default:r=e}return networkUtils.getOrgSpecificURL(r)},getState:function(){var e={url:window.location.href,title:document.title};return window.history.state?e.data=window.history.state.data:e.data={},e},getGAppsRoutevsAction:function(){return{users:"showZGUsers",contacts:"showZGContacts",mail:"showZGMail",docs:"showZGDocs",calendar:"showZGCal",adwords:"showZGAdword",sites:"showZGSite","chrome-ext":"showChromeExt",tasks:"showZGTask"}},getLastAccessedURL:function(){var e=Crm.nextGenInfo&&Crm.nextGenInfo.last_accessed_module&&idModuleMapping?idModuleMapping[Crm.nextGenInfo.last_accessed_module.id]:"Home",t=Crm.nextGenInfo&&Crm.nextGenInfo.last_accessed_menu?Crm.nextGenInfo.last_accessed_menu:null;t&&["reports","dashboards"].includes(t)?e="reports"===t?"Reports":"Dashboards":t&&"requesters"===t&&Crm.nextGenInfo.last_accessed_requester_module&&Crm.nextGenInfo.last_accessed_requester_module.id&&idModuleMapping&&idModuleMapping[Crm.nextGenInfo.last_accessed_requester_module.id]&&(e=idModuleMapping[Crm.nextGenInfo.last_accessed_requester_module.id]);var a={dynamicParams:[e],queryParams:{}};return"requesters"===t?a.route="crm.tab.requesters.module":"marketplace"===t?a.route="crm.settings.section.extensions":a=Lyte.registeredMixins["crm-menu-utils"].getRouteForModule(e),Lyte.Router.getURL(a)}};crmHistory.locationOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.host;var gS={cobavailUsrEmailJson:void 0,frmPage:void 0,companyDetailsPopShown:!1,userTimeZone:"",orgSubmit:function(e,t,a){if(commonUtils.showHideLoadingDiv(),gS.orgNameValidate()){$("#"+e).addClass("op5 eventNone"),commonUtils.showHideLoadingDiv(!0);var r=Crm.getCrmBasePath()+"/OrgConfig.do?actionName=updateOrgDetailsFrmCOB",o=$("#frmSignup").val(),i=$("#userTimeZone").val(),n=$("#currencyLocale").val(),s=$("#orgEmpCount").val(),l=commonUtils.formData2QueryString(document.profilePageCOBForm);i!=this.userTimeZone&&Crm.client_tracking("Customer OnBoarding - TimeZone Changed"),(Crm.userDetails.COUNTRY_LOCALE.split("_")[1]?Crm.userDetails.COUNTRY_LOCALE.split("_")[1]:"US")!==n&&Crm.client_tracking("Customer OnBoarding - Currency Locale Changed"),null!=s&&s.length>0&&Crm.client_tracking("Customer OnBoarding - Employee Count Changed"),"true"==a?(l=l+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&frmSignup="+o+"&populateSampleData=true",Crm.trackSpotLightAction("Customer OnBoarding - Explore With Sample Data"),Crm.client_tracking("Customer OnBoarding - Explore With Sample Data")):(l=l+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&frmSignup="+o+"&populateSampleData=false",Crm.trackSpotLightAction("Customer OnBoarding - Explore CRM"),Crm.client_tracking("Customer OnBoarding - Explore CRM")),(new crmRequestPool).initiate({action:r,data:l,success:function(e){if(a){var t=e.modVsCanvasId;t&&(moduleRecordMapping.Leads.viewid=t.Leads,moduleRecordMapping.Products.viewid=t.Products,moduleRecordMapping.Potentials.viewid=t.Potentials,moduleRecordMapping.Contacts.viewid=t.Contacts,moduleRecordMapping.Accounts.viewid=t.Accounts)}if(commonUtils.showHideLoadingDiv(!1),Crm.userDetails.orgTimeZone=i,crmui.hidePopup("cobdiv"),Crm.trackSpotLightAction("Customer OnBoarding - Profile Page Update"),Crm.client_tracking("Customer OnBoarding - Profile Page Update"),newSignupPageUnload&&window.removeEventListener("beforeunload",newSignupPageUnload),e.orgName&&(Crm.userDetails.orgName=e.orgName),e.mobilePage&&(window.location=Crm.getCrmBasePath()+"/mobilepage"),e.reloadPage)return window.location=window.location.href,window.opener&&window.opener.location.reload(),!1;e.IAM_EMAILCONFIGURE_URL?(networkUtils.openUrl(e.IAM_EMAILCONFIGURE_URL+"&serviceurl="+window.location.href,"_self"),Lyte.Component.render("crm-mobile-footer",{url:e.IAM_EMAILCONFIGURE_URL,crmVerifyEmailPop:!0},"body"),$("#deactivatebtn").val("Verifying...")):($("#FreezeLayer").removeClass("welcomeFreez"),$("#cobdiv").removeClass("welcomeContainer"));var r=networkUtils.returnDependencyFiles(["zworkdrive-conf-model.js","crm-related-list-wd-attachments.js"],ResourceConstants.CRMClient);Lyte.injectResources(r,void 0,(function(){gS.loadWDOnboard()})),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_COMPANYDETAILS").PF_COMPANYDETAILS,RebrandLinkUtil.getProperties("PF_COMPANYDETAILS_ID").PF_COMPANYDETAILS_ID)}})}return!1},loadWDOnboard:function(){var e=Crm.companyName;null!==e&&""!==e.trim()||(e="Zoho CRM"),store.findAll("workdrive-conf").then((function(t){var a=t[0];if(a.available&&!a.configured)if(a.is_team_available){var r={wdURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),portalId:crmZgid,productName:"ZohoCRM",appKey:a.app_key,serviceOrgTypeId:5,callbackFn:Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].docsTabTeamSetupCallback:crmRelatedList.docsTabTeamSetupCallback,signedAppKey:a.signed_app_key,hideLeftPanel:!0,isClosable:!1,nameToDisplay:e},o=RebrandLinkUtil.getProperty("WD_SDK_JS_STATIC_URL"),i=networkUtils.returnDependencyFiles(["zworkdrive-onboard-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);Lyte.removeFromCache([o]),Lyte.injectResources([o,i],void 0,(function(){(new ZWDSDK).loadOnboarding(r)}))}else Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].docsTabTeamSetupCallback({}):crmRelatedList.docsTabTeamSetupCallback({})}),(function(){document.querySelector("crm-content-libraries").component.showHideMessageElement.call(self,"#contentLibraryMessageBox","error",!0,I18n.getMsg("crm.mailmerge.internal.error"))}))},basicProfile:function(e,t){var a=Crm.getCrmBasePath()+"/CustomerOnBoarding.do?tab=basicProfile&action=showProfilePage&frm="+e+"&isFreeUsr="+t;(new crmRequestPool).initiate({type:"POST",action:a,success:function(e){var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cobresources")],ResourceConstants.CRM);Lyte.injectResources(t,void 0);var a=$("#cobdiv"),r=$("#industType").val(),o=$("#cobdiv .pop-content");if(o.html(e),o.removeClass("zcrm-content"),commonUtils.showHideLoadingDiv(!1),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())a.css("cssText","top:0px");else{var i=(renderingUtils.windowHeight-a.height())/2;a.css("cssText","top:"+i+"px !important")}crmui.showPopup("cobdiv"),a.addClass("welcomeContainer"),a.css("top",""),$("#FreezeLayer").addClass("welcomeFreez"),setTimeout((function(){$("#orgName").focus()}),100),thirdPartyUtils.bindSelect2($(".welcomeContainer .oBSelectBox"));var n=o.find(".welcomeInputStyle input"),s=n.length;n.on("focus",(function(){var e=$(this),t=e.parent().find(".fieldTransLabel");""===e.val()&&t.addClass("addedTrans")})),n.on("blur",(function(){var e=$(this),t=e.parent().find(".fieldTransLabel");""===e.val()&&t.removeClass("addedTrans")}));for(var l=0;l<s;l++){var d=$(n).eq(l),c=d.parent().find(".fieldTransLabel");""!==d.val()?c.addClass("addedTrans"):c.removeClass("addedTrans")}null!=r&&""!=r&&$("#industryType").val(r).trigger("chosen:updated")}}),$(window).ready((function(){Crm.trackSpotLightAction("Customer OnBoarding - Profile Page"),Crm.client_tracking("Customer OnBoarding - Profile Page")})),gS.companyDetailsPopShown=!0},welcomeOBMethod:function(e){!0===$(".dataSamplePopulatedCOB").prop("checked")?gS.orgSubmit("profileDetailBtn2",e,"true"):gS.orgSubmit("profileDetailBtn",e)},trackOnboardUsingPF:function(e,t,a,r){if("false"===RebrandLinkUtil.getProperties("IS_LOCAL_ZOHO").IS_LOCAL_ZOHO&&"false"===RebrandLinkUtil.getProperties("ISDEVELOPMENT").ISDEVELOPMENT&&"US"===RebrandLinkUtil.getProperties("DeploymentLocation").DeploymentLocation&&Crm.userDetails&&"A"!==Crm.userDetails.LICENSE_TYPE_ACTUAL&&"A"===Crm.userDetails.LICENSE_TYPE){var o=$L.moment().toDate();if(Crm.userDetails.ORG_CREATED_TIME>o.getTime()-2592e6&&(!localStorage.getItem("onBoardPFDisabledTime")||o.getTime()-localStorage.getItem("onBoardPFDisabledTime")<72e5)&&(!localStorage.getItem("api_enable_time")||localStorage.getItem("api_enable_time")<=o.getTime()||!JSON.parse(localStorage.getItem("is_limit_reached")))){var i="https://"+RebrandLinkUtil.getProperties("CCSIGNALS").CCSIGNALS+"/signals/v1/Signals__s/"+t+"/actions/invoke_webhook?digest="+e+"&zuid="+parseInt(crmZuid)+"&orgid="+parseInt(crmZgid);a&&(i=i+"&module="+a),r&&(i=i+"&featurename="+r),$L.ajax({url:i,type:"POST",success:function(e){if(e){var t=e.responseText;if(t){var a=JSON.parse(t);a&&a.code&&("SUCCESS"===a.code&&JSON.parse(localStorage.getItem("is_limit_reached"))?localStorage.setItem("is_limit_reached",!1):"LIMIT_EXCEEDED"===a.code&&(localStorage.setItem("is_limit_reached",!0),localStorage.setItem("api_enable_time",$L.moment().endOf("day").timezone("GMT").format("x"))))}}},error:function(e){if(e){var t=e.responseText;if(t){var a=JSON.parse(t);a&&a.code&&"LIMIT_EXCEEDED"===a.code&&(localStorage.setItem("is_limit_reached",!0),localStorage.setItem("api_enable_time",$L.moment().endOf("day").timezone("GMT").format("x")))}}}})}}},useExistingMailBox:function(e,t){var a="COB",r=$(t).attr("accId");$("#helpdesk").hasClass("cobclicked")||(a="setup");var o=Crm.getCrmBasePath()+"/CustomerOnBoarding.do?tab=emailInteg&action=useExistingMailBox&mailAddr="+e+"&accId="+r+"&frm="+a;(new crmRequestPool).initiate({type:"POST",action:o,success:function(e){$("#zmailAccountId").val(r),(e.indexOf("success")>-1||e.indexOf("crm.label.pop.multiorg")>-1)&&(Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.email-settings",{action:"zmail"}),renderingUtils.removeFreezeLayer())}}),Crm.trackSpotLightAction("Customer OnBoarding - Existing Mail Configured")},showless:function(e,t){gS.emailintclk("COB",e,t)},orgNameValidate:function(){var e,t,a=!0;$(".errorFieldP").removeClass("errorFieldP"),$(".errorMsgDesc").remove();var r,o,i,n=document.profilePageCOBForm.orgName.value,s=document.profilePageCOBForm.orgPhone,l=document.profilePageCOBForm.userEmail,d=document.profilePageCOBForm.orgEmpCount,c=$("#orgPhone"),m=$("#orgName"),u=$("#orgEmpCount"),p=$("#userEmail");return s&&(r=document.profilePageCOBForm.orgPhone.value),l&&(o=document.profilePageCOBForm.userEmail.value),d&&(i=document.profilePageCOBForm.orgEmpCount.value),null==n||""==n.trim()?(t=m,e=I18n.getValueForFields("crm.field.empty.check","Company"),commonUtils.showErrorMsg(e,t,"coborgName"),Crm.trackSpotLightAction("COB - Company Name Alert"),Crm.client_tracking("COB - Company Name Alert"),m.focus(),a=!1):(null!=i&&i.length>=0&&/[a-zA-Z.-]/.test(i)&&(t=u,e=I18n.getValueForFields("crm.field.valid.check",`${I18n.getMsg("crm.label.empCount")}`),commonUtils.showErrorMsg(e,t,"Employee count"),Crm.client_tracking("COB - Employee Count Alert"),u.focus(),a=!1),null!=n&&""!=n&&0!=n.replace(/^\s+/g,"").replace(/\s+$/g,"").length||(t=m,e=I18n.getValueForFields("crm.field.empty.check","Company"),commonUtils.showErrorMsg(e,t,"coborgName"),Crm.trackSpotLightAction("COB - Company Name Alert"),Crm.client_tracking("COB - Company Name Alert"),m.focus(),a=!1),!l||validationUtils.isValidEmail(o)&&""!=o||(t=p,e=I18n.getValueForFields("crm.field.valid.check","Email"),commonUtils.showErrorMsg(e,t,"Email"),Crm.trackSpotLightAction("COB - User Email Alert"),p.focus(),a=!1),s&&(!validationUtils.isValidPhoneNo(c,r)||r.length<6)&&(t=c,e=I18n.getValueForFields("crm.field.valid.check","Phone"),commonUtils.showErrorMsg(e,t,"Phone"),Crm.trackSpotLightAction("COB - Phone Number Alert"),Crm.client_tracking("COB - Phone Number Alert"),c.focus(),a=!1)),a},emailintclk:function(e,t,a){if("COB"==e&&$("#sub_emailSettings").hasClass("sel")){$("#helpdesk").removeClass("cobclicked");var r=I18n.getMsg("cob.alreadyin.setup.mailpage");crmui.showMsgBand("warning",r,5e3)}else{var o=$("#helpdesk");commonUtils.showHideLoadingDiv(!0),o.hasClass("cobclicked")||(e="setup");var i=Crm.getCrmBasePath()+"/CustomerOnBoarding.do?tab=emailInteg&action=mailConfigMainPage&frm="+e;null==a&&(i+="&freshConf=true"),(new crmRequestPool).initiate({type:"POST",action:i,success:function(e){commonUtils.showHideLoadingDiv();var r=$("#otherIMAP");if(o.hasClass("cobclicked")){$("#cobdiv .pop-content").html(e);var i=renderingUtils.windowOuterHeight-100;if($("#cobdiv .popup-padding").css({maxHeight:i,overflow:"auto"}),$("body").addClass("oH"),crmui.showPopup("cobdiv"),null!=t){"other"==t?$(".migImap").trigger("click"):$(".mig"+t).trigger("click"),$("#service").val(t),$("#frmService").val(t),$("#acnt_select").hide();var n=r.find("#"+t);n.addClass("flag"),n.show(),r.fadeIn(),$("#cobdiv #imapUsername").val(a),"true"===$("#isOAuthConf").val()&&($("#cobdiv #imapPassword").val("*********"),$("#cobdiv #imapUsername, #cobdiv #imapPassword").attr("readonly",!0))}}else $("#result").html(e)}})}},focusFields_cob:function(e){$(".labelValCreate").removeClass("focusEleField"),$(e).closest(".labelValCreate,.tabDiv").addClass("focusEleField"),"saveCancelSpan"==$(e).next().attr("id")&&$(e).off("blur",removeFocusClass)}};function slidelt(e){var t=$("#helpdesk");t.removeClass("right0").addClass("_r390"),"frmSetupClick"!=e&&t.addClass("cobclicked"),t.removeClass("active"),$(".cobStartShow").hide(),$(".cobStartHide").show(),$("body").removeClass("oH"),$("#cobouterdiv").css({width:"60px",right:"-60px"})}function getObj(e,t){var a,r,o;for(t||(t=document),(a=e.indexOf("?"))>0&&parent.frames.length&&""!=e.substring(a+1)&&null!=e.substring(a+1)&&parent.frames[e.substring(a+1)]&&(t=parent.frames[e.substring(a+1)].document,e=e.substring(0,a)),!(o=t[e])&&t.all&&(o=t.all[e]),r=0;!o&&r<t.forms.length;r++)o=t.forms[r][e];for(r=0;!o&&t.layers&&r<t.layers.length;r++)o=getObj(e,t.layers[r].document);return!o&&t.getElementById&&(o=t.getElementById(e)),o||(o=t.getElementsByName(e)[0]),o}function getOpenerObj(e,t){var a="";if(void 0!==getObj("service")&&(a=getObj("service").value),"zcal"!==a&&"zcreator"!==a&&"zmail"!==a&&"mail"!==a&&opener)return t&&"undefined"!==t&&"null"!==t?opener.document[t].elements[e]:getObj(e,opener.document)}function getElm(e,t){if(t=commonUtils.escapeSingleQuote(t),e)var a=$("[name='"+e+"'] [name='"+t+"'], [name='"+e+"'] [id='"+t+"']");else a=$("[name='"+t+"'],[id='"+t+"']");return a.length>1?a:a[0]}function getObjFromPopup(e,t){var a=t.find('[id="'+e+'"]').length?t.find('[id="'+e+'"]')[0]:t.find('[name="'+e+'"]')[0];return void 0===a&&window.isFromOutlookPlugin&&(a=window.opener.$.find('[id="'+e+'"]').length?window.opener.$.find('[id="'+e+'"]')[0]:window.opener.$.find('[name="'+e+'"]')[0]),a}mR=function(e,t,a,r,o){document.getElementById("ajax_load_tab")&&"false"!=o&&commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:"POST",url:e,data:a,dataType:"text",success:function(a,r,i){"false"!=o&&commonUtils.showHideLoadingDiv(),null==i&&(i={requestUrl:e}),t(a,r,i)},error:function(e){if(e.responseText.indexOf("Usage of V1 API is Deprecated")>-1){var t=JSON.parse(e.responseText);renderDenyTemp(t,"approvalprocess","save")}if(e.responseText.indexOf("crm.change.owner.permission.Manage_Subordinate_Alert")>-1)return commonUtils.showHideLoadingDiv(),void _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.change.owner.permission.Manage_Subordinate_Alert"),ltPropType:"error"}});if((e.requestUrl.includes("addApprovalRule")||e.requestUrl.includes("updateApprovalProcess"))&&"scheduler already running"===e.responseText){var a=e.requestUrl.includes("addApprovalRule")?"add":"update";return _cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:e.responseText,ltPropSecondaryMessage:"Unable to save the approval process now due to ongoing hierarchy preference updates. Kindly try again after few minutes"}}),"add"===a&&($L("#commonSummary").css("display",""),$L("#finalSaveDiv").css("display","block")),void commonUtils.showHideLoadingDiv()}if(e.status===crmConstants.limitExceedsCode)return Search.displayLookupExceedsMsg(e),"false"!=o&&commonUtils.showHideLoadingDiv(),!1;400===e.status&&"CRITERIA_LIMIT_EXCEEDED"===e.responseText?renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.limit.error",Search.MAX_CRT_CNT)):400===e.status&&e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1?renderingUtils.showCustomAlert(I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1])):400===e.status&&e.responseText.indexOf("DYNAMIC_FORMULA_IN_CRITERIA")>-1?_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.formula.dynamic.custom.view.error",e.responseText.split("###")[1])}}):400!==e.status||"VALUE_LIMIT_EXCEEDED"!==e.responseText&&"FIELD_LIMIT_EXCEEDED"!==e.responseText||(getElemById("searchbtn").disabled=!1,_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:"FIELD_LIMIT_EXCEEDED"===e.responseText?I18n.getMsg("crm.multi.select.field.filter.limit.reached.msg",Search.include_exclude_comparator_limit):I18n.getMsg("crm.multi.select.field.option.limit.reached.heading",Search.include_exclude_values_limit),ltPropButtonPosition:"center"}})),void 0!==r&&r&&r(e),"false"!=o&&commonUtils.showHideLoadingDiv()}})};var renderingUtils="object"!=typeof renderingUtils?{}:renderingUtils;function fetchFollowed(e){$(e).parents(".feedFilterlist").siblings(".svalue").find("#value").html($(e).html()),$(e).parents(".feedFilterlist").hide(),$("#mod_sel")[0].value=$(e)[0].id}function showRecFlwdByMe(e,t){var a=$("#pulseInfo"),r=($("#feedContainerDiv"),$("#feedParentDiv")),o=$("#feedLeftMenuContainer"),i=$("#feedsFollowUpDetails"),n=r.height()-2;r.width(),o.width();$("#feedscontainer").hide(),$("#feedContainerDiv").addClass("p0"),i.hide(),$("#feedsFollowUpCtn").show(),$(".feedsViewPage").addClass("oHImp"),setFeedFollowUp(),a.addClass("br_right_border3"),a.css({height:n+"px"});var s=Crm.getCrmBasePath()+"/Pulse.do?action=recflwdbyme&days=0";if(null!=getObj("mod_sel")&&""!=getObj("mod_sel").value&&(s+="&searchModule="+getObj("mod_sel").value),null!=getObj("ownerId_sel")&&""!=getObj("ownerId_sel").value&&(s+="&ownerId="+getObj("ownerId_sel").value),"mbtn"==t){if(getObj("rfbm_st").value){var l=parseInt(getObj("rfbm_st").value,10)+1;getObj("rfbm_st").value=l}s+="&type=smore&rfbm_st="+getObj("rfbm_st").value}var d=document.getElementById(e);return mR(s,(function(a){getObj("mda_trans").value;if(a.indexOf("ALERTERROR:::")>-1){var r=a.split("ALERTERROR:::");alert(r[1])}else if(a.indexOf("NOMOREUPDATES:::")>-1){$(d).empty();r=a.split("NOMOREUPDATES:::")}else{if("msel"==t||"qlnk"==t||"aplfltr"==t)$(d).empty(),d.innerHTML=a,EvalInnerScript(d),"msel"==t&&getObj("flwcnt")&&($("#flwcnt").empty(),getObj("flwcnt").innerHTML="( "+flwcnt+" )");else{var o=getObj(e).innerHTML+a;$(getObj(e)).empty(),getObj(e).innerHTML=o,EvalInnerScript(d)}if(getObj(e+"_avail"))getObj(e+"_mbtn").style.display="none"}})),!1}function showUntouchedRecords(e,t){var a=$("#pulseInfo"),r=($("#feedContainerDiv"),$("#feedParentDiv")),o=$("#feedLeftMenuContainer"),i=$("#feedsFollowUpDetails"),n=r.height()-2;r.width(),o.width(),r.width(),o.width();$("#feedscontainer").hide(),$("#feedContainerDiv").addClass("p0"),i.hide(),$("#feedsFollowUpCtn").show(),$(".feedsViewPage").addClass("oHImp"),setFeedFollowUp(),a.addClass("br_right_border3"),a.css({height:n+"px"});var s=Crm.getCrmBasePath()+"/Pulse.do?action=showall",l=document.getElementById(e);return mR(s,(function(a){getObj("mda_trans").value;if(a.indexOf("ALERTERROR:::")>-1){var r=a.split("ALERTERROR:::");alert(r[1])}else{if("msel"==t||"qlnk"==t)$(l).empty(),l.innerHTML=a,EvalInnerScript(l),"msel"==t&&getObj("flwcnt")&&($(getObj("flwcnt")).empty(),getObj("flwcnt").innerHTML=flwcnt);else{var o=getObj(e).innerHTML+a;$(getObj(e)).empty(),getObj(e).innerHTML=o,EvalInnerScript(l)}if(getObj(e+"_avail"))getObj(e+"_mbtn").style.display="none"}Crm.bindEventForUserBCView()})),!1}function toggleFollowup(e,t,a){var r="id",o="module";if(a){var i=a.split("_")[2];r="moduleid_"+i,o="module_"+i}var n=$("#"+o).val(),s=$("#"+r).val();store.triggerAction("entity","follow",{type:"follow"===t?"PUT":"DELETE",module:moduleRecordMapping[n].api_name,entityId:s}).then((function(){var r="follow"===t?I18n.getMsg("crm.label.pulse.unfollow"):I18n.getMsg("crm.label.pulse.follow"),o="follow"===t?"unfollow":"follow";if(a){if(document.getElementById(a).style.display="none",getObj("flwcnt")){var i=getObj("flwcnt").innerHTML,s=getObj("flwcnt").innerHTML.match("[0-9]+")[0],l=parseInt(s,10)-1;$(getObj("flwcnt")).empty(),getObj("flwcnt").innerHTML=i.replace(s,l)}}else if("follow"==t?"Events"!=n&&"Tasks"!=n&&"Calls"!=n&&detailView.formFollowersDiv(Crm.userDetails.USER_ID,!1,!0):"Events"!=n&&"Tasks"!=n&&"Calls"!=n&&detailView.formFollowersDiv(Crm.userDetails.USER_ID,!1,!1),!0===Crm.userDetails.DETAIL_VIEW_HEADER_LYTE&&"Events"!==n)for(var d=e.getData("dropAction"),c=d.length,m=0;m<c;m++){var u=d[m][1];if(void 0!==u){for(var p=u.length,g=0;g<p;g++)if(u[g].name===t){Lyte.objectUtils(e.getData("dropAction")[m][1][g],"add","display_label",r),Lyte.objectUtils(e.getData("dropAction")[m][1][g],"add","name",o);break}break}}else{var v=document.getElementById("flw_spn"),f=$("#detailViewButtonLayerMainTableRow #flw_spn");$(v).empty(),f.empty();var h="follow"===t?"<a class='graytag cP' id='Follow_btn' href=\"javascript:;\" onClick=\"toggleFollowup(this,'unfollow');\">"+r+"</a>":"<a class='graytag cP' id='unFollow_btn' href=\"javascript:;\" onClick=\"javascript:toggleFollowup(this,'follow');Crm.trackSpotLightAction('Started Following Record');\"  name=\"Follow_btn\" id=\"Follow_btn\" >"+r+"</a>";v.innerHTML=h,f.html(h)}}))}function getRightPanelDetails(e,t,a,r,o){delete $$rightPanel.rpCachedList,$$rightPanel.rpCachedList=new Array,delete $$rightPanel.rpTabOrder,$$rightPanel.entityId=e,$$rightPanel.currentModule=t,t==crmModuleConstants.Leads||t==crmModuleConstants.Contacts?($$rightPanel.rpTabOrder=["info","timeline","conversation"],$$rightPanel.caller=null):"Projects"==t?($$rightPanel.rpTabOrder=["info"],$$rightPanel.caller=null):($$rightPanel.rpTabOrder=["info","timeline"],$$rightPanel.caller="Feeds"),"entityDetail"===(a=a||"feedsFollowUpDetails")&&(askZia.previousRightPanelDiv=$$rightPanel.rpParentContainer),$$rightPanel.rpParentContainer=a,$$rightPanel.detailRightPanel("krp_tab1",$$rightPanel.rpTabOrder[0],!0,r,o)}function showFollowUpDetails(e,t,a){$("#feedParentDiv");var r=$(e).find("#moduleid_"+a)[0].value,o=$(e).find("#module_"+a)[0].value;Crm.userDetails.isRelatedListLyteEnabled?Lyte.Globals.get("relatedList")&&(Lyte.Globals.set("relatedList.entityId",encodeURIComponent(r)),Lyte.Globals.set("relatedList.module",o)):(crmRelatedList.EntityId=encodeURIComponent(r),crmRelatedList.Module=o),$(e).hasClass("lisel")||getRightPanelDetails(r,o),$("#feedsFollowUpDetails").show(),$(".feedsFlCtn ul li").removeClass("lisel"),$(e).addClass("lisel"),Math.abs(parseInt($("#"+t).css("left")))===parseInt($("#"+t).width())&&$("#"+t).animate({left:"0px"},300,(function(){})),setTimeout((function(){var e=$L("#feedParentDiv"),t=$("#krp_Rightpanel_InfoContainer"),a=e.height()-52;t.css({height:a+"px"}),t.perfectScrollbar("destroy")}),1200)}function hidePulseAllHistoryDiv(){var e=renderingUtils.findPosX(document.getElementById("pulseSettingsTd"));$("#pmrlstact").animate({left:e-380+"px"}),getObj(pulseSelId.id).className="pulserowout",pulseSelId.id=!0}function setPulseLayoutHeight(){var e=document.getElementById("activeUpdateData"),t=getObj("pulseActivityDivContainer");if(void 0===e)timestamp=setTimeout(setPulseLayoutHeight(),200);else{var a=document.getElementById("basic").offsetHeight,r=document.body.clientHeight;a<r?t&&(t.style.height=r-t.style.top+"px"):t&&(t.style.height=""),"undefined"!=typeof timestamp&&window.clearTimeout(timestamp)}}function showFilterModules(e){var t=$(e).siblings(".newFeedDrop");t.is(":visible")?(t.hide(),$(".feedfiltercontent").removeClass("feedfilterfocus")):(t.show(),t.closest(".feedfiltercontent").addClass("feedfilterfocus"))}function getMorePulseDetails(e,t,a,r,o,i){if(($(".feedfiltercontent").removeClass("feedfilterfocus"),o)&&!getObj(o+"_arw_dv"))return!1;var n=Crm.getCrmBasePath()+"/Pulse.do?searchModule="+getObj("mod_sel").value;getObj("ownerId_sel")&&(n+="&ownerId="+getObj("ownerId_sel").value);var s=document.getElementById(e);if("aplfltr"==a&&"pulseInfo"==e)n+="&action=aplFilter&nextSet=0";else{var l=null,d=null,c=null;if("mrbtn"==a||"rlnk"==a)l=document.getElementById("next_set_"+e);else if("larw"==a||"frmspn"==a){l=document.getElementById("ns_mla");var m=document.getElementById("od_hd_"+o),u=document.getElementById("od_bc_"+o);d=document.getElementById("p"+e),c=document.getElementById("mrlalnk");var p=document.getElementById("rec_iso_cd_"+o);p&&(n+="&isoCode="+p.value),$("#pulseRightTitleDiv").empty(),document.getElementById("pulseRightTitleDiv").innerHTML="<div class='mT5 fR dbBtnClose svgIcons ico-close op5 dIB cP' onclick='hidePulseAllHistoryDiv()'></div><div class='crm-small-font-size br_top_dotted_white br_bottom_dotted_border4'>"+m.innerHTML+"<div id='bc_dtl'>"+u.innerHTML+"</div></div>"}var g=parseInt(l.value,10)+1;"rlnk"!=a&&"larw"!=a||(g="0"),n+="&nextSet="+g,"mrbtn"==a||"rlnk"==a?(n+="&action=getMoreDetails&secName="+e,"thirtySectionData"==e&&(n+="&days="+getObj("pulseValue").value.replace(/^[0]+/g,""))):n+="&action=getMoreLastActivities&parentId="+r}return"larw"==a?n+="&referer=pulseleftslider":"frmspn"==a&&(n+="&referer=pulseslidermorebtn"),mR(n,(function(i){var n=i,m=getObj("nmda_trans").value,u=getObj("mda_trans").value;if(n.indexOf("ALERTERROR:::")>-1){var p=n.split("ALERTERROR:::");alert(p[1])}else if(n.indexOf("NOMOREUPDATES:::")>-1){$(s).empty();p=n.split("NOMOREUPDATES:::");if("mrbtn"==a)alert(p[1]),t.disabled=!0;else if("larw"==a||"frmspn"==a){if(setPositionOfContainer(d),d.style.display="block",o&&"larw"==a){var v=o.substring(0,o.indexOf("_")),f=o.substring(o.indexOf("_")+1),h=v+"_la_dt_"+f;if(getObj(h)){var y=s.innerHTML+"<br><div class='p5'>"+getObj(h).innerHTML+"</div>";$(s).empty(),s.innerHTML="<br><div class='p5'>"+y+"</div>"}if(getObj(h=v+"_la_txt_"+f)){y=s.innerHTML+"<br>"+getObj(h).innerHTML;$(s).empty(),s.innerHTML="<div class='p15 br_top_dotted_white br_bottom_dotted_border4'>"+y+"</div>"}}$(c).empty()}else"rlnk"==a&&($(s).empty(),s.innerHTML='<div style="padding:0px 30px;"><div class="p30 norec" align="center"><input type="hidden" id="nda_ts" value="true"/>&lt;&nbsp;'+getObj("nochanges").value+"&nbsp;&gt;</div></div>",t.value=m,t.disabled=!0)}else if("aplfltr"==a?$(s).empty():(l.value=g,"larw"==a?($(s).empty(),setPositionOfContainer(d),d.style.display="block"):"rlnk"==a&&$(s).empty()),s){"larw"!=a&&"frmspn"!=a||($(c).empty(),c.innerHTML="<a id='"+e+"_mbtn' name='"+e+"_mbtn' class='moreOption' href='javascript:;' onclick=\"javascript:getMorePulseDetails('mrlstact','"+t+"','frmspn','"+r+"','"+o+"');\">"+getObj("mda_trans").value+"</a>");y=s.innerHTML+n;if($(s).empty(),s.innerHTML=y,EvalInnerScript(s),document.getElementById("pulseRightBoxInnerDiv")&&(document.getElementById("pulseRightBoxInnerDiv").style.height=document.getElementById("pmrlstact").offsetHeight-(document.getElementById("pulseRightTitleDiv").offsetHeight+document.getElementById("mrlalnk").offsetHeight)+"px","larw"==a&&(document.getElementById("pulseRightBoxInnerDiv").style.width="350px")),getObj(e+"_avail"))if("mrlstact"==e)$(c).empty();else(b=getObj(e+"_mbtn")).style.display="none";else if("mrbtn"==a||"rlnk"==a){var b;(b=getObj(e+"_mbtn")).value=u,b.disabled=!1,b.style.display="block"}}})),!1}function showPulseUsingSlider(){var e=Crm.getCrmBasePath()+"/Pulse.do",t={action:"aplSldrDays"};t.days=$("#pulseValue")[0].value.replace(/^[0]+/g,""),getObj("mod_sel")&&""!=getObj("mod_sel").value&&(t.searchModule=$("#mod_sel")[0].value),getObj("ownerId_sel")&&""!=getObj("ownerId_sel").value&&(t.ownerId=$("#ownerId_sel")[0].value);var a={params:t,success_callback:function(e){var t=e;if(t.indexOf("ALERTERROR:::")>-1){var a=t.split("ALERTERROR:::");alert(a[1])}else $("#pulseInfo").empty(),document.getElementById("pulseInfo").innerHTML=t,EvalInnerScript(document.getElementById("pulseInfo"))}};return networkUtils.makeRequest(e,"POST",a),!1}function changePopTabView(e,t,a){var r=document.getElementById("tab_a_"+e);if(r){var o=document.getElementById("tab_a_"+t);o.onclick="first"==t?function(){changePopTabView("first","last",a)}:function(){changePopTabView("last","first",a)},r.removeAttribute("onclick",0),r.className=e+" active",o.className=t}document.getElementById("last_popup_accessed_tab").value=e,"first"==e?showPulseHistory("dlink"):(TBAPageNum=1,noMoreTBActions=!1,loadTimeBasedActions(1,getObj("id").value,a))}function showPulseHistory(e,t){if(t){var a="<h2>"+getObj("upcmngactn").value+"</h2>";$(getObj("lstact_title")).empty(),getObj("lstact_title").innerHTML='<div class="mT5 fR dbBtnClose svgIcons ico-close op5 dIB cP" onclick="closePulsePopupDiv(\'pmrlstact_d\')"></div>'+a+"</div>";r=getObj("module").value;loadTimeBasedActions(1,getObj("id").value,r),document.getElementById("plstact_d").style.display="block",repositionContainer("pmrlstact_d","pulseHistorylnk")}else{var r=getObj("module").value;"dlink"==e&&(getObj("dtl_nxt_st").value="0");var o=Crm.getCrmBasePath()+"/Pulse.do?searchModule="+r+"&action=getMoreLastActivities&parentId="+getObj("id").value+"&nextSet="+getObj("dtl_nxt_st").value+"&isoCode="+getObj("rec_iso_cd").value,i=getObj("mrlalnk_d"),n=document.getElementById("lstact_d");"dlink"==e?o+="&referer=entitylstupdlink":"mbtn"==e&&(o+="&referer=entitylstupdmorebtn"),mR(o,(function(a){var o=a,s="",l=getObj("curr_edtn");if(!l||"E"!=l.value&&"A"!=l.value&&"C"!=l.value&&"U"!=l.value&&"Z"!=l.value?l&&"E"!=l.value&&"A"!=l.value&&"C"!=l.value&&"U"!==l.value&&"Z"!==l.value&&(s="<h2>"+getObj("actdone").value+"</h2>"):s=t?"<h2>"+getObj("upcmngactn").value+"</h2>":"<div class='menuBg'><div class='tabMenu'><a id='tab_a_first' class='first active' href='javascript:void(null)'>"+getObj("actdone").value+"</a><a id='tab_a_last' class='last' href='javascript:void(null)' onclick=\"changePopTabView('last','first','"+r+"');\">"+getObj("upcmngactn").value+"</a></div></div>",o.indexOf("ALERTERROR:::")>-1){var d=o.split("ALERTERROR:::");alert(d[1])}else if(o.indexOf("NOMOREUPDATES:::")>-1)$(getObj("lstact_title")).empty(),getObj("lstact_title").innerHTML='<div class="mT5 fR dbBtnClose svgIcons ico-close op5 dIB cP" onclick="closePulsePopupDiv(\'pmrlstact_d\')"></div>'+s+"</div>",getObj("dp_tmp_act")&&($(n).empty(),n.innerHTML=getObj("dp_tmp_act").innerHTML),$(i).empty();else{if("dlink"==e)$(getObj("lstact_title")).empty(),getObj("lstact_title").innerHTML='<div class="mT5 fR dbBtnClose svgIcons ico-close op5 dIB cP" onclick="closePulsePopupDiv(\'pmrlstact_d\')"></div>'+s+"</div>",$(n).empty(),n.innerHTML=o;else{var c=n.innerHTML+o;$(n).empty(),n.innerHTML=c}var m=getObj("dtl_nxt_st");m.value=parseInt(m.value,10)+1,getObj("mrlstact_avail")?$(i).empty():($(i).empty(),i.innerHTML="<a id='mbtn' name='mbtn' class='moreOption' href='javascript:;' onclick=\"javascript:showPulseHistory('mbtn');\">"+getObj("mda_trans").value+"</a>",i.style.display="")}repositionContainer("pmrlstact_d","pulseHistorylnk"),"dlink"==e&&(document.getElementById("plstact_d").style.display="block",document.getElementById("upcmng_actn").style.display="none")}))}return!1}function closePulsePopupDiv(e){var t=document.getElementById(e);t&&($("#lstact_d").empty(),document.getElementById("lstact_d").style.height="",getObj("dtl_nxt_st")&&(getObj("dtl_nxt_st").value="0"),t.style.display="none")}function repositionContainer(e,t){var a=getObj(e),r=getObj(t);a&&r&&(Crm.userDetails.RTL_ENABLED?a.style.left=renderingUtils.findPosX(r)+"px":a.style.left=renderingUtils.findPosX(r)-345+"px",a.style.top=renderingUtils.findPosY(r)+20+"px",a.style.width="490px",a.style.display="block",a.style.zIndex="100",a.style.position="absolute")}function showFlwdUsrLst(e){var t=getObj(e);t&&(t.style.display="block")}function setPositionOfContainer(e){var t=renderingUtils.findPosX(document.getElementById("pulseSettingsTd"));e.style.left=t-360+"px";document.all?document.body.offsetHeight:window.innerHeight,pulseRightBoxPostion(),document.documentElement.offsetWidth,document.getElementById("pmrlstact").style.left=t+"px"}function setValueLookup(e,t,a,r,o,i,n,s,l){var d=document.querySelector(".fromLyteFields"),c=!1;if(d&&d.component&&"lookupPopup"!==n){d.component.invAutoFill=!0,d.component.setData({newLookupcreated:!0,selectedSingleId:t});var m=d.querySelector("lyte-input");m&&(m.classList.add("yellowLyteInput"),c=!0,setTimeout((function(){m.classList.remove("yellowLyteInput")}),5e3)),d.classList.remove("fromLyteFields")}var u=document.querySelector(".frominvSubPBLyteFields");u&&u.component&&u.component.getMethods("onInventoryPriceBookSel")&&(u.component.executeMethod("onInventoryPriceBookSel",{priceBookRecid:t,priceBookName:o,pricingDetails:l,listPriceVal:e}),c=!0);var p=$("#searchCreatePopup:visible").length,g=!1,v=$("#qCreate").is(":visible"),f=$("#freezeBackGround");if(null!=s&&("zcal"==s||"zmail"==s||"zcreator"==s||"mail"==s)){var h=RebrandLinkUtil.getProperty("CALENDARURL");if(!h){var y=window.location.hostname;h=y&&-1!==y.indexOf("localzoho.com")?"calendar.localzoho.com":"calendar.zoho.com"}"zmail"==s?h=RebrandLinkUtil.getProperty("MailURL"):"zcreator"==s?h=RebrandLinkUtil.getProperty("creatorURL"):"mail"==s&&(h=RebrandLinkUtil.getProperty("MailURL"));var b=RebrandLinkUtil.getProperty("URLPROTOCOL");b||(b="https");var C=b+"://"+h,I={};return I.fldName=e,I.fldId=t,I.frmtprice=a,I.frmtqty=r,I.pbname=o,I.formName=i,void window.opener.postMessage(I,C)}var w="lookupPopup"===n&&$("#searchCreatePopup").html()?$("#searchCreatePopup"):i&&document[i]?$(document[i]):$("body"),_=$("#"+n);i&&"undefined"!==i||(i=$("[name^=createEntityForm]")[0]?$("[name^=createEntityForm]")[0].name:void 0);var R=Crm.moduleName?Crm.moduleName:"";if(n){R=w.find('input[name="searchModule"]').val();var L=_.find('input[name="searchModule"]').val(),k=_.find('input[name="fldName"]').val(),P=_.find('input[name="fldId"]').val(),O=_.find('input[name="operation"]').length}else{L=getObj("searchModule").value,k=getObj("fldName").value,P=getObj("fldId").value;O=getObj("operation")}if("MassConvertForm"!==i&&"convertlead"!==i||$("#clearCampaigns").removeClass("vH"),("Quotes"==R||"Invoices"==R||"SalesOrders"==R||"Contacts"==R)&&"Accounts"==L&&"Account Name"==k&&O||"SalesOrders"==R&&"Quotes"==L||"Invoices"==R&&"SalesOrders"==L&&O)fillFormObject(encodeURIComponent(e),t,L,i);else{if("temp_searchcampcv"===k)var T=$(".camp_lkp_obj")[0],E=$(T).closest("#searchval_div").find("#temp_searchcampcv")[0];else E=getObjFromPopup(k,w),T=getObjFromPopup(P,w);if("convertlead"===i){var S=P.split("_")[1],D="";$L("crm-convert-action").length>0&&(D="convert_"),document.querySelector("crux-lookup-component[id='"+D+"component_"+S+"']").component.setData("cxPropValue",'{"id":"'+t+'","name":"'+e+'"}');var M=$L("crm-mass-convert");M.length>0&&M[0].setData("moveBackGroundFreeze",!1)}else{T.value=t,E.value=e,$(E).data("id",t),k==P?$(T).data("id",t):T.value=t;try{CRMLookupCallBack()}catch(e){}if(Crm.setRefFieldValues(E,t),"Products"==L){var B=k.substr(10);Crm.isInventoryModule(R)&&("null"!=r&&(getObj("hdnQtyStock"+B).value=r),getObj("hdnUnitPrice"+B).value=a)}else if("PriceBooks"==L)if("null"!=e&&null!=e&&k.indexOf("txtListPrice")>-1){E.value=e;var A=$(E).attr("id");A=A.split("txtListPrice")[1],productDetails.discStatus="fromPb",$("#txtQty"+A).trigger("blur"),$("#hdnPriceBookName"+A).val(o),$("#hdnPriceBookIdClone"+A).val(t);var U=$("#frmBook").find(".openSansNormal").text();U.indexOf("-")>0&&(U=U.substring(0,U.lastIndexOf("-"))),$("#frmBook").find(".openSansNormal").text(U),$("#frmBook").find(".openSansNormal").append(" - "+o)}else if("null"!==e&&null!==e&&Crm.isLineItemSubFormModule(E.dataset.subformdisplaylabel)&&k.indexOf("_BOOKID_")>-1){var j=$(E).closest("tr").data("data-rowid"),x=$(productDetails.sfFldIdSuffix+"LISTPRICE_"+j);$(E).val(o),x.val(productDetails.getRoundOff(x,parseFloat(e))).trigger("change"),productDetails.discStatus="fromPb",g=!0,window[productDetails.module].formulaObj.handlePriceBookLineItemUpdate(j,l,!0)}else E.value=o;if(getObj("property(leContModName)")){var F=getObj("property(leContModName)");if($("#leContModName").trigger("loadBestTime"),"createEvent"in document){var N=document.createEvent("HTMLEvents");N.initEvent("click",!1,!0),F.dispatchEvent(N)}else F.fireEvent("onclick")}("convertlead"==i||"MassConvertForm"==i&&E.value.length>0)&&$("#"+E.parentElement.id).addClass("show-close")}var V=$("#sIlookupFieldAddNew");1==V.is(":visible")&&"Account Name"==k&&(V.hide(),$(".clearAccountName").remove()),hideAnimatePopup(n,!0),p&&($("#freezeBackGround").css("z-index","30"),renderingUtils.showFreezeLayer()),null!==window.opener||g||c||$(E).effect("highlight",{},1e3),v&&"object"==typeof Crm&&Crm.isZiaOwnerRecommendationEnabled&&$(E).trigger("loadzor")}v&&f.css("z-index","30")}function setContactValues(e,t,a,r,o,n){var s=document.querySelector(".fromLyteFields"),l=!1;if(s&&s.component&&"lookupPopup"!==o){s.component.invAutoFill=!0,s.component.setData({newLookupcreated:!0,selectedSingleId:t});var d=s.querySelector("lyte-input");d&&(d.classList.add("yellowLyteInput"),l=!0,setTimeout((function(){d.classList.remove("yellowLyteInput")}),5e3)),s.classList.remove("fromLyteFields")}var c=$("#searchCreatePopup:visible").length,m=$("#qCreate").is(":visible"),u=$("#freezeBackGround"),p=decodeURIComponent(a);jsonObj=JSON.parse(p),a=jsonObj.accountName+"",accId=jsonObj.accountId+"";var g=jsonObj.cntPhone+"",v=jsonObj.cntEmail+"",f=r&&document[r]?$(document[r]):$("#show"),h=$("#"+o),y=Crm.moduleName?Crm.moduleName:"";if(null!=n&&("zcal"==n||"zmail"==n||"zcreator"==n||"mail"==n)){var b=RebrandLinkUtil.getProperty("CALENDARURL");if(!b){var C=window.location.hostname;b=C&&-1!==C.indexOf("localzoho.com")?"calendar.localzoho.com":"calendar.zoho.com"}"zmail"==n?b=RebrandLinkUtil.getProperty("MailURL"):"zcreator"==n?b=RebrandLinkUtil.getProperty("creatorURL"):"mail"==n&&(b=RebrandLinkUtil.getProperty("MailURL"));var I=RebrandLinkUtil.getProperty("URLPROTOCOL");I||(I="https");var w=I+"://"+b,_={};return _.fldName=e,_.fldId=t,_.acName=a,_.acId=accId,_.formName=r,void window.opener.postMessage(_,w)}if(o){y=f.find('input[name="module"]').val();h.find('input[name="searchModule"]').val();var R=h.find('input[name="fldName"]').val(),L=h.find('input[name="fldId"]').val(),k=getObjFromPopup(R,f),P=getObjFromPopup(L,f)}else getObj("searchModule").value,R=getObj("fldName").value,L=getObj("fldId").value,k=getOpenerObj(R=getObj("fldName").value,r),P=getOpenerObj(getObj("fldId").value,r);var O=getObjFromPopup("uiType_property(contactName:"+R+")",h);if(O)var T=O.value;if(void 0!==k&&(k.value=e,$(k).data("id",t)),void 0!==P&&(P.value=t),0==R.indexOf("CID")){var E=getObjFromPopup("accNameInConRoleAdd_"+R.replace("CID",""),f);E&&(void 0!==a&&"null"!=a?E.innerText=a:$(E).empty())}try{"undefined"!=typeof CRMLookupCallBack&&CRMLookupCallBack(),opener.CRMLookupCallBack()}catch(e){}if(null!=getObjFromPopup("property(modsel)",f))var S=getObjFromPopup("property(modsel)",f).value,D=getObjFromPopup("property(modname)",f).value;if(""==D&&("null"!=a&&"Accounts"==S?(getObjFromPopup("property(modname)",f).value=a,getObjFromPopup("property(modid)",f).value=accId,$(getObjFromPopup("property(modname)",f)).data("id",accId)):(getObjFromPopup("property(modname)",f).value="",getObjFromPopup("property(modid)",f).value="")),133!=T&&"null"!=a&&getObjFromPopup("property(Account Name)",f)&&""==getObjFromPopup("property(Account Name)",f).value&&getObjFromPopup("Account Name",f)){getObjFromPopup("Account Name",f).value=unescape(a);var M=Object.keys(jsonObj);for(i=0;i<M.length;i++){var B=getObjFromPopup("property("+M[i]+")",f);B&&(B.value=jsonObj[M[i]]?jsonObj[M[i]]:"")}}if("Cases"===y&&("null"!==g&&getObjFromPopup("property(Phone)",f)&&""===getObjFromPopup("property(Phone)",f).value&&(getObjFromPopup("property(Phone)",f).value=g),"null"!==v&&getObjFromPopup("property(Email)",f)&&""===getObjFromPopup("property(Email)",f).value&&(getObjFromPopup("property(Email)",f).value=v)),getObjFromPopup("property(leContModName)",f)){var A=getObjFromPopup("property(leContModName)",f);$("#leContModName").trigger("loadBestTime"),Crm.isHeadless||$(A).trigger("click")}if(Crm.setRefFieldValues(k,t),"SalesOrders"!=y&&"Quotes"!=y&&"Invoices"!=y||fillFormObject(encodeURIComponent(e),t,"Contacts",r),"MassConvertForm"===r&&k.value.length>0)$("#"+k.parentElement.id).addClass("show-close");else if("convertlead"===r){var U=L.split("_")[1],j="";$L("crm-convert-action").length>0&&(j="convert_"),document.querySelector("crux-lookup-component[id='"+j+"component_"+U+"']").component.setData("cxPropValue",'{"id":"'+t+'","name":"'+e+'"}')}hideAnimatePopup(o,!0),c&&($("#freezeBackGround").css("z-index","30"),renderingUtils.showFreezeLayer()),null!==window.opener||l||$(k).effect("highlight",{},1e3),m&&u.css("z-index","30")}function fillFormObject(e,t,a,r,o){var i=getObj("fldName").value,n=getObj("fldId").value,s=getObj("operation").value,l=getObj(i),d=getObj(n);l.value=decodeURIComponent(e),d.value=t,fillInfo(Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule="+a+"&operation="+s+"&module="+getOpenerObj("module").value+"&entityname="+e+"&entityid="+t+"&isajax=true",a,r)}function fillInfo(e,t,a){var r=getHTTPObject();r.open("POST",e,!0),r.onreadystatechange=function(){if(4==r.readyState){var e=r.responseText;$("#test").empty(),document.getElementById("test").innerHTML=e,opener.document.forms[a].fieldvalues.value=getObj("fieldvalues").value;var o=1;opener.document.forms[a].rowCount&&(o=opener.rowCnt,opener.document.forms[a].rowCount.value=getObj("rowCount").value),opener.init(),"Accounts"==t&&opener.rowCnt&&(opener.rowCnt=o),$("#test").empty(),window.self.close()}},r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),r.send(csrfParamName+"="+encodeURIComponent(csrfToken))}function blockContent(e,t){if(!t||13!=t.keyCode){if(document.getElementById("displayContent_"+e)){var a=document.getElementById("displayContent_"+e);$(a).remove()}$(getObj(e)).removeClass("err_fld"),$(getObj(e)).closest("tr").hasClass("form_err_fld")&&$(getObj(e)).closest("tr").removeClass("form_err_fld")}}function moveMail(e,t,a,r){var o="step=moveMails&toSeid="+e+"&messageId="+t+"&"+a+"="+encodeURIComponent(r);$.ajax({type:"POST",data:o,url:Crm.getCrmBasePath()+"/Search.do",success:function(e){var t=$(".pwie");t.html('<div class="MailToolPopup">'+I18n.getMsg("bccdropbox.movemail.succ")+"</div>"),t.removeClass("pB20"),t.addClass("pB40");var a=$(".MailToolPopup");a.css({padding:"8px 30px",position:"absolute","font-size":"14px","font-family":"georgia",border:"1px solid #daebcc","box-shadow":"2px 2px 10px #d7e2ed","background-color":"#12AA67",color:"#fff","z-index":"300"});var r=a.outerWidth()/2,o=t.outerWidth()/2-r;if(a.css({left:o,top:"0px"}),setTimeout((function(){$("#topBandPopup").hide(),$("#freezeBackGround").hide()}),2500),$("#isFromNewAPI").length>0){var i=$("#id").val();null!=store.peekRecord("emails_rl_user","shared_users_"+i)&&store.deleteRecord("emails_rl_user","emails_"+i),showMailsListViaAPI("ALL","-10","next")}else window.$("#mailTable").find("tr[tobehidden=true]").hide()}})}function showLookUp(e,t,a,r,o,i,n,s,l,d,c,m,u,p,g,v,f){if(isNewLookupPopup(e,r)){var h=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);h=h.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM));var y=[];Crm.userDetails.RTL_ENABLED&&(y=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));var b=h.concat(y);Lyte.injectResources(b,void 0,(function(){var a={},o=$(document.getElementById(e));a.lookupModule=r,a.productFldId=s,a.module=$('input[name="searchModule"]').val(),a.labelName=e,a.searchModule=r,a.linkingmodule=void 0,a.fieldid=o.data("fieldid"),a.id=o.data("id"),t&&(a.labelId=t),a.parentModule=f?$('input[name="property(module)"]').val():r;var i=document.getElementById("lookupListPopup");if(f&&$("crm-entity-lookup").length>0&&$("crm-entity-lookup")[0].component.closeThisLookupPop(),!i){var n="";n=t.indexOf("CID")>0?o:document.getElementById(t);var l=document.createElement("crm-entity-lookup");l.component.setData("reqData",{fieldid:o.data("fieldid")}),n.append(l),i=document.getElementById("lookupListPopup")}var d=$("crm-entity-lookup")[0].component;d.setData("fromSearchCreate",f),d.layersAnalystAgent(d,f,a,!1,!0)}))}else newShowLookUp(e,t,a,r,o,n,s,l,d,c,m,u,p,g,v,f)}function isNewLookupPopup(e,t){var a=$(".outlookInfoCont").is(":visible");return Crm.userDetails.isLookupAdvancedSearchEnabled&&"ownername"!==t&&null!==e&&-1===e.indexOf("searchcampcv")&&!a}function newShowLookUp(e,t,a,r,o,i,n,s,l,d,c,m,u,p,g,v){var f=$("[id='"+e+"']").data("fieldid");f&&(f+=""),f&&-1!=f.indexOf("fields_")&&(f=f.split("_")[1]);var h=$("#createEntityForm"),y=$("#qCreate").is(":visible"),b=$("#layoutdetails").val();if(isNewLookupPopup(e,r)){var C={};C.lookupModule=r;var I=$('input[name="searchModule"]').val();C.parentModule=v?$('input[name="property(module)"]').val():r,C.module=void 0===I?r:I,C.labelName=e,C.searchModule=r,C.linkingmodule=void 0,t&&(C.labelId=t);var w=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);w=w.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM));var _=[];Crm.userDetails.RTL_ENABLED&&(_=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));var R=w.concat(_);Lyte.injectResources(R,void 0,(function(){var a=document.getElementById(t);if(e.indexOf("property(Campaign Source)")>=0)C.parentModule="Potentials",C.fieldid=$(g.target.parentElement.closest("tr")).find("div.convertLead").attr("extrainfo").split("&&&")[0],a=a.closest("div");else{var r=$("[id='"+e+"']");C.fieldid=r.data("fieldid"),C.id=r.data("id")}var o=document.getElementById("lookupListPopup");if(v&&$("crm-entity-lookup").length>0&&$("crm-entity-lookup")[0].component.closeThisLookupPop(),!o){var i=document.createElement("crm-entity-lookup");i.component.setData("reqData",{}),a.append(i),o=document.getElementById("lookupListPopup")}var n=$("crm-entity-lookup")[0].component;n.layersAnalystAgent(n,v,C,!1,!0)}))}else{var L=renderingUtils.windowWidth;if("fromentityview"==o){var k=$("#id").val();Search.showChangeOwnerPopUp("entityview",r,k,p,s,"5")}else if("listview"==o||"customview"==o)p=crmListView.getObject().module,Search.showChangeOwnerPopUp(o,r,"",p,s,"5");else{if(g)var P=g.target,O=$(P).closest("form")[0].name;else O=void 0;var T=getObj(e);productStr="";var E="",S=getObj("operation");if(null==n);else if(null!=n){if("vendorName"==n||"property(vendorName:Vendor Name)"==n)E=getObj("property(vendorName:Vendor Name)")?getObj("property(vendorName:Vendor Name)").value:"";else if("property(actName:Account Name)"==n){for(var D=$("*[id^='property(actName:']"),M=[],B={accounts:[]},A=0,U=0;U<D.length;U++){var j=D[U],x=j.value,F=/property\([a-z]+\:(.*[^)])+/i,N=j.id.match(F)[1],V=getObj(N),H="";if(!V)V=getObj("property("+N+")");V&&(H=V.value),null!=x&&""!=x&&null!=H&&""!=H&&(M.contains(x)||(M[A]=x,B.accounts[A]={},B.accounts[A].id=x,B.accounts[A].name=H,A+=1))}if(M.length>0){E=M[0];var z=JSON.stringify(B);productStr=productStr+"&accDetails="+encodeURIComponent(z)}else E=null}else E=$("[id='"+n+"']").val()?$("[id='"+n+"']").val():null;productStr=productStr+"&productId="+E}var q,W=getObj("property(Currency)");q=W?W.value:"";var G=t;if(t.indexOf("property(")>-1)try{F=/property\([a-z]+\:(.*[^)])+/i;G=t.match(F)[1].replace(/[^a-z]/gi,"")}catch(e){G=(new Date).getTime()}var J="Lookup"+G;if("ownername"==r){if("itsfromwebformOwnerlookup"==o)var Z=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&itsfromwebformOwnerlookup=yes&condition="+m+"&targetForm="+O;else if(e.indexOf("searchuser")>-1)Z=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&itsfromcriteria=yes&condition="+m+"&targetForm="+O;else if("itsfrmChangeManger"==o||"itsfrmChangeFCManger"==o){var K="no",Q="";a.indexOf("addManager")>-1?(Q=a.replace("addManager",""),K="yes"):Q=a.replace("changeManager","");var X="";X="itsfrmChangeFCManger"==o?"&roleId="+Q:"&territoryId="+Q;Z=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&"+o+"="+K+"&condition="+m+X+"&targetForm="+O}else Z=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&itsfromLAR="+d+"&condition="+m+"&targetForm="+O;if(document.getElementById("showUserList"))Z=Z+"&showUserList="+document.getElementById("showUserList").value;if(getObj("showDuplicates"))Z=Z+"&showDuplicates="+getObj("showDuplicates").value;null!=c&&(Z=Z+"&ownerFieldId="+c),S&&"edit"==S.value&&(Z=Z+"&operation="+S.value),null!=p&&(Z=Z+"&module="+p),h.is(":visible")&&(te=h.find("[name=layoutId]").val()),y&&void 0!==b&&(te=b),$("#convertLeadForm").is(":visible")&&(te=Crm.VR.potLayoutId),te&&"null"!=te&&"undefined"!=te&&(Z+="&layoutId="+te),f&&"null"!=f&&"undefined"!=f&&(Z+="&lookupFieldId="+f);document.body.scrollTop;$("#topBandPopup").empty(),document.getElementById("iskanbanview")&&(Z+="&iskanbanview=true");try{ProcessBuilder.Process&&ProcessBuilder.Process.Module&&(Z=Z+"&module="+ProcessBuilder.Process.Module)}catch(e){murphy.error(e)}var Y=csrfParamName+"="+encodeURIComponent(csrfToken);mR(Z,(function(e){$("#topBandPopup").html(e);var t=$("#ownerId");if(null!=t.val()&&""!=t.val()){var a=t.val();$("#"+a+"_chkbx").prop("checked",!0),isclicked=!0}showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),setTimeout((function(){$("#fldValue").length>0&&$("#fldValue").focus()}),500)}),Y)}else{if(""!=u&&null!=u&&"-1"!=u)var ee=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&condition="+m+"&potentialId="+u+"&currencyISOCode="+q+"&targetForm="+O;else ee=Crm.getCrmBasePath()+"/Search.do?searchmodule="+r+"&fldName="+e+"&fldId="+t+"&fldLabel="+a+"&fldValue="+productStr+"&condition="+m+"&currencyISOCode="+q+"&targetForm="+O;var te;if(h.is(":visible")&&(te=h.find("[name=layoutId]").val()),y&&void 0!==b&&(te=b),$("#convertLeadForm").is(":visible")&&(te=Crm.VR.potLayoutId),te&&"null"!=te&&"undefined"!=te&&(ee+="&layoutId="+te),f&&"null"!=f&&"undefined"!=f&&(ee+="&lookupFieldId="+f),"PotContacts"!=r&&("toAddress"!==e&&"ccAddress"!==e||"Contacts"!==r&&"Leads"!==r)){var ae="topBandPopup";if(v)$("#topBandPopup").html()&&(Crm.lookups={},Crm.lookups.content=$("#topBandPopup").html()),1!=$("#sIlookupFieldAddNew").is(":visible")&&"Account Name"!==e&&$("#topBandPopup").html(""),ae="lookupPopup",ee+="&fromSearchCreate=true";if($(".outlookInfoCont").is(":visible")){$(ae);ee+="&isfromOutlookRightPanel=true",$$rightPanel.openNewWindowFromOutlook(ee,500,1100)}else commonUtils.openCustomLookup(ee,"",ae,L-300,void 0,void 0,void 0,void 0,void 0,v)}else openPopUp("lookUpWin",T,ee,J,900,400,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")}0!=$("#cvEditSave").length&&"block"===$("#cvEditSave")[0].style.display&&($('[id="cvEditSave"] [id="'+e+'"]')[0].value=""),$("#searchCreatePopup").length&&"none"!=$("#searchCreatePopup")[0].style.display&&$("#lookupPopup").css("z-index","252")}}}function loadlookupdiv(e,t){if($("#lookupdiv").removeAttr("style"),document.getElementById("lookupdiv").style.zIndex=30,document.getElementById("lookupdiv").style.opacity="1",$(".zcrm-show").is(":visible")){var a=$(".zcrm-modal").css("z-index");$("#lookupdiv").css({"z-index":parseInt(a)+2}),setTimeout((function(){$("#FreezeLayer").css({"z-index":parseInt(a)+1})}),300)}t&&($("#lookupdiv").empty(),document.getElementById("lookupdiv").innerHTML="<div style='height:300px;overflow:auto;border:1px solid #e5e5e5'>"+I18n.getMsg("loading")+"...</div>"),mR(e,(function(e){renderingUtils.freezeBackground();var t=document.getElementById("lookupdiv");$("#lookupdiv").empty(),document.getElementById("lookupdiv").innerHTML=e,mailsetCenter("lookupdiv");for(var a=t.getElementsByTagName("SCRIPT"),r=0;r<a.length;r++){var o=document.createElement("SCRIPT");o.type="text/javascript",o.language="javascript",""!=a[r].src&&(o.src=a[r].src),o.text=a[r].text,void 0===document.getElementsByTagName("HEAD")[0]?document.createElement("HEAD").appendChild(o):document.getElementsByTagName("HEAD")[0].appendChild(o)}}))}function loadCurrencyDiv(e){$("#currFrmtDiv_back").hide(),document.getElementById("currencyPopupDiv").innerHTML="<div style='height:300px;overflow:auto;border:1px solid #d7e2ed'>"+I18n.getMsg("loading")+"...</div>",mR(e,(function(e){$("#currencyPopupDiv").html(e),crmui.showPopup("currencyPopupDiv",!0),wfForm.initFormClick(),wfForm.chosen_show("currencyPopupDiv"),wfForm.inputfieldFocus()}))}function closeownernamedialog(){$("select").css({visibility:"visible"});var e=document.getElementById("shownotes"),t=document.getElementById("updateCallStatus"),a=document.querySelector("#multipleFieldsEditPop");a=!!a&&"none"!=a.style.display,e&&"block"==e.style.display||$("#eventCreatePopup").is(":visible")||$("#createEditCallDiv").is(":visible")||$(".feedAutoFollowPopup").is(":visible")||t&&$("#updateCallStatus").is(":visible")||0!=$("#wfModule").length||a||renderingUtils.removeFreezeLayer(),$("#topBandPopup").is(":visible")&&hideAnimatePopup("topBandPopup",!0),t&&$("#updateCallStatus").is(":visible")&&($("#freezeBackGround").css({opacity:"0.5",background:"var(--bg_white)",zIndex:"26"}),$("#updateCallStatus").css("zIndex","27"),renderingUtils.showFreezeLayer()),getObj("lookupdiv").style.display="none",$(getObj("lookupdiv")).removeClass("newShowLayoutPopup"),$L("#rpBtnResubmit").removeClass("disable"),removeInsertedScripts()}function fieldDependency(e,t){var a=Crm.jsonDepValues[t];try{val=a[e]}catch(t){a=JSON.parse(jsonDepValues),val=a[e]}"Salutation"==e&&(e="saltName");var r=getObj("property("+e+")")?getObj("property("+e+")").value:"";""==r&&(r="-"+I18n.getMsg("None")+"-");var o={};for(var i in val)if(val.hasOwnProperty(i)){var n=i;"Salutation"==n&&(n="saltName");var s=getObj("property("+n+")");if(getObj(n)){var l=getObj(n).value;s=getObj("comboValue"+l);for(var d=[],c=0;c<s.options.length;c++)s.options[c].selected&&d.push(s.options[c].value);d.length>0&&(o[n]=d)}else o[n]=s.value;var m=val[i][r];if(m){s.length=0;for(var u=o[n],p=0;p<m.length;p++){var g=document.createElement("OPTION");"-None-"==m[p]?g.value="":g.value=m[p],g.text=m[p],"object"==typeof u?u.contains(m[p])&&(g.selected=!0):m[p]==o[n]&&(g.selected=!0),s.options.add(g)}}}}function setDependent(e,t,a,r,o){$(".newSelect select").trigger("destroy");var i=$(e).closest("form")[0].name;r||(r=getElm(i,"module").value),noneValue=I18n.getMsg("None"),e.length>1&&"radio"==e[0].type&&(e=e[0]);var n=!0,s=e.name;""!=s&&null!=s&&null!=s||(n=!1,s=e.id);var l=$(e);if(!0===l.data("colorcode_enabled")){var d=l.children("option:selected").eq(0),c=d.attr("data-colorcode")?d.attr("data-colorcode"):"",m="selectColorComponent";if(r!==crmModuleConstants.Events){m=void 0!==l.data("subformsectionlabel")?m+"-"+l.attr("id"):m+"-"+l.data("fieldid"),l.data("colorcode",c);var u=l.parent().parent();if(u.addClass("colorEnabledPicklist"),$("#"+m).remove(),"-None-"===d.val()||""===d.val())u.addClass("colorEnabledPKNone");else u.removeClass("colorEnabledPKNone"),$('<span class="dIB activitesColor" data-zcqa="generalaction_colorcode_'+l.data("fieldid")+'" id="'+m+'" style="background:'+$ESAPI.encoder().encodeForHTMLAttribute(c)+'"></span>').insertBefore(l)}}var p=s.substr(s.indexOf("(")+1,s.length);p=p.substr(0,p.lastIndexOf(")"));var g=a?Crm.jsonDepValues_Quick[r]:Crm.jsonDepValues[r],v=a?Crm.jsonSelectValues_Quick[r]:Crm.jsonSelectValues[r];if(null!=g){var f=g[p];if(null!=f&&""!=f&&"null"!=f){var h=f;for(var y in h)if(h.hasOwnProperty(y)){var b=!1,C=y,I=h[y];C.indexOf(")")>-1&&(C=C.replace(/\)/g,"_____")),C.indexOf("(")>-1&&(C=C.replace(/\(/g,"____")),C.indexOf(".")>-1&&(C=C.replace(/\./g,"___"));var w=getElm(i,"property("+C+")");if(n||(w=getElemById("property("+C+")")),null!=w&&null!=w||"Salutation"!=C||(w=getElm(i,"property(saltName)"),n||(w=getElemById("property(saltName)"))),getElm(i,C)){var _=getElm(i,C).value,R=getElm(i,"comboValue"+_);null!=R&&null!=R&&(w=R)}if(w&&w.options){var L="26"===w.dataset.uitype,k=$("#stageMap"),P=L&&k.length?JSON.parse(k.val()):void 0;"Potentials"!=r||"convertlead"!=i&&"MassConvertForm"!=i||(P=JSON.parse(k.val()));for(var O=!(!w.dataset.colorcode_enabled||"true"!==w.dataset.colorcode_enabled),T=w.dataset.picklistmap?JSON.parse(w.dataset.picklistmap):{},E="",S={},D=0;D<w.options.length;D++)w.options[D].selected&&(E=""==E?w.options[D].value:E+",,,"+w.options[D].value),void 0!==w.options[D].getAttribute("fctype")&&null!==w.options[D].getAttribute("fctype")&&(S[w.options[D].value]=w.options[D].getAttribute("fctype"));w.value="";var M=v[C],B=$L("#stageMap");if(!o)for(var A in I){var U=A;"-None-"==U&&(U="");v[p];var j=null,x=e.value;if("Stage"==p&&"Potentials"==r&&x.indexOf(":")>-1&&(j=x.substring(x.indexOf(":")+1)),null!=j&&U==trimBoth(j)||U==trimBoth(e.value)){b=!0,w.length=0;for(var F=I[A],N=0;N<F.length;N++){var V=document.createElement("OPTION"),H=F[N];if("-None-"==(Q=H))V.value="",H=noneValue;else if(P&&P[Q]?V.value=P[Q]:V.value=Q,S&&S[Q])V.setAttribute("fctype",S[Q]);else if(w.dataset&&w.dataset.stagemap){var z=JSON.parse(w.dataset.stagemap);z&&Object.keys(z).includes(Q)&&V.setAttribute("fctype",S[z[Q]+":"+Q])}else if(B&&B.val()){var q=JSON.parse(B.val());q&&Object.keys(q).includes(Q)&&V.setAttribute("fctype",S[q[Q]])}if(V.text=H,null!=E)for(var W=E.split(",,,"),G=0;G<W.length;G++)Q==W[G]&&(V.selected=!0);if("undefined"!=typeof wfConvert){var J=Object.keys(wfConvert.stageVsProbablity).length>0&&null!=wfConvert.stageVsProbablity[Q],Z=Object.keys(wfConvert.stageKeyVsProbablity).length>0&&null!=wfConvert.stageKeyVsProbablity[Q];(J||Z)&&(V.setAttribute("data-val",J?wfConvert.stageVsProbablity[Q]:wfConvert.stageKeyVsProbablity[Q]),V.value=Q)}if(O){var K=getPickListColorCode(Q,T,!0);V.setAttribute("data-colorcode",K)}w.options.add(V),"Potentials"!=r||"convertlead"!=i&&"MassConvertForm"!=i||$(w).trigger("change")}}}if(!b){w.length=0;for(N=0;N<M.length;N++){var Q=M[N];V=document.createElement("OPTION");if("-None-"==Q?(V.value="",M[N]=noneValue):V.value=M[N],V.text=M[N],null!=E)for(W=E.split(",,,"),G=0;G<W.length;G++)Q==W[G]&&(V.selected=!0);if("undefined"!=typeof wfConvert){J=Object.keys(wfConvert.stageVsProbablity).length>0&&null!=wfConvert.stageVsProbablity[Q],Z=Object.keys(wfConvert.stageKeyVsProbablity).length>0&&null!=wfConvert.stageKeyVsProbablity[Q];(J||Z)&&(V.setAttribute("data-val",J?wfConvert.stageVsProbablity[Q]:wfConvert.stageKeyVsProbablity[Q]),V.value=Q)}if(O){K=getPickListColorCode(Q,T,!0);V.setAttribute("data-colorcode",K)}w.options.add(V)}}(!t||Crm.jsonDepValues[r]&&Crm.jsonDepValues[r][C])&&w&&"none"!=w.style.display&&(setDependent(w,!1,void 0,r),$(w).trigger("change")),a&&b&&setTimeout((function(){thirdPartyUtils.bindSelect2("#qCreate select"),L&&$(w).trigger("change")}),10)}}}thirdPartyUtils.bindSelect2($(".newSelect select")),L&&$L(w).trigger("change")}}function closeHtmldiv(e,t,a,r){"finish"==t?doAjaxUpdate("result",Crm.getCrmBasePath()+"/WebToEntityForm.do?module="+a):"cancel"==t&&(r?removeFreezeLayer2():renderingUtils.removeFreezeLayer(),document.getElementById(e).style.display="none")}function getCallTimer(){return{Minute:0,Second:0,TimerID:0,start:function(e,t){this.TimerID=setInterval(e,t)},increment:function(){this.Second>=59?(this.Second=0,this.Minute+=1):this.Second+=1},reset:function(){clearInterval(this.TimerID),this.Minute=this.Second=this.TimerID=0},pause:function(){clearInterval(this.TimerID)},resume:function(e,t){this.TimerID=setInterval(e,t)}}}renderingUtils.showCustomAlert=function(e,t,a,r,o,i){var n=$("#custom_alert_popup");n.attr("data-show",!0),a?$("#custom_alert_msg").html(e):$("#custom_alert_msg").text(e),t?$("#alert_title").text(t).show():$("#alert_title").hide(),showAnimatePopup("custom_alert_popup");var s=$("#custom_alert_button");s.val(i||I18n.getMsg("crm.nsocial.onboard.got.it")),setTimeout((function(){n.removeAttr("data-show");var e=$("#custom_alert_button");e.length>0&&e.eq(0).focus()}),100),$("#custom_alert_button").unbind("click"),r?o?s.unbind("click").click({params:o},r):s.unbind("click").click(r):n.attr("data-show")||r&&r()},renderingUtils.showMsgBox=function(e,t,a){var r=document.getElementById("lyteMsgBox");a||(a={}),a.ltPropType=t,a.ltPropMessage=e,a.ltPropDuration=a.ltPropDuration?a.ltPropDuration:"3000",a.id="lyteMsgBox",r?r.ltProp({message:a.ltPropMessage,type:a.ltPropType,duration:a.ltPropDuration}):r=Lyte.Component.render("lyte-messagebox",a,"body"),r.ltProp("show",!0)};var formNameVsTimerObjMap={createFormTimer:function(e){return this[e]=getCallTimer(),this[e]},resetFormTimer:function(e){void 0!==this[e]&&(this[e].reset(),delete this[e])},start:function(e,t,a){this.resetFormTimer(a),this.createFormTimer(a),this[a].start(e,t)},resume:function(e,t,a){this[a].resume(e,t)},increment:function(e){this[e].increment()},reset:function(e){void 0!==this[e]&&this[e].reset()},pause:function(e){this[e].pause()}},callTimer=formNameVsTimerObjMap.createFormTimer();function displayCallTimer(e){formNameVsTimerObjMap.increment(e);var t=formNameVsTimerObjMap[e],a=$("form[name='"+e+"'] #countupminute");a?(a.html((t.Minute<=9?"0":"")+t.Minute),$("form[name='"+e+"'] #countupsecond").html((t.Second<=9?"0":"")+t.Second)):formNameVsTimerObjMap.reset(formname)}function startCallTimer(e){var t=$(e).closest("form").get("0").name;$("form[name='"+t+"'] #startTimerDiv").attr("onclick","stopCallTimer(this)"),$("form[name='"+t+"'] #startTimerLabel").hide(),$("form[name='"+t+"'] #stopTimerLabel").show(),$("form[name='"+t+"'] #timerButtonDiv").css("visibility","visible"),$("form[name='"+t+"'] #pauseCallTimer").show(),$("form[name='"+t+"'] #resumeCallTimer").hide(),$("form[name='"+t+"'] #resetCallTimer").css("display","inline"),formNameVsTimerObjMap.start("displayCallTimer('"+t+"')",1e3,t);var a=Crm.getCrmBasePath()+"/calls/CallAction.do",r={type:"getCurrentTimeInUserFormat"};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:a,type:"POST",data:r,success:function(e){var a=e.indexOf(":"),r=e.substring(0,a-3),o=e.substring(a-2,e.length),i=[];i.push(r);var n=o.split(" ");i.push(n[0]),n.length>1&&i.push(n[1]);var s=i[1].split(":");if($("form[name='"+t+"'] [name='property(Call Start Time)']").val(i[0]),$("form[name='"+t+"'] [name='property(Call Start Timehour)']").val(s[0]),$("form[name='"+t+"'] [name='property(Call Start Timeminute)']").val(s[1]),"HH:mm"!==Crm.userDetails.TIME_FORMAT){$("form[name='"+t+"'] [name='property(Call Start Timeampm)']").val(i[2]);var l=$("form[name='"+t+"'] input[id='Call Start Time_dateTime']"),d=$("form[name='"+t+"'] span[id='Call Start Time_ampmSpan']");l.length&&d.length&&(l.val([s[0],s[1]].join(":")),d.attr("ampm",i[2]),d.val(I18n.getMsg(i[2])))}}})}function stopCallTimer(e){var t=$(e).closest("form").get("0").name,a=formNameVsTimerObjMap[t];$("form[name='"+t+"'] #startTimerDiv").attr("onclick",""),$("form[name='"+t+"'] [id='property(DurationInMinute)']").val(a.Minute<=9?"0"+a.Minute:a.Minute),$("form[name='"+t+"'] [id='property(DurationInSecond)']").val(a.Second<=9?"0"+a.Second:a.Second),formNameVsTimerObjMap.reset(t),$("form[name='"+t+"'] #pauseCallTimer").hide(),$("form[name='"+t+"'] #resumeCallTimer").hide(),$("form[name='"+t+"'] #resetCallTimer").css("display","inline"),$("form[name='"+t+"'] #stopTimerLabel").hide(),$("form[name='"+t+"'] #startTimerDiv").hide(),"quickcreate"==$("form[name='"+t+"'] #callTimerDiv").attr("place")&&(showHideCallDuration("inline-block",t),$("form[name='"+t+"'] #callTimerDiv").hide())}function pauseCallTimer(e){var t=$(e).closest("form").get("0").name;formNameVsTimerObjMap.pause(t),$("form[name='"+t+"'] #pauseCallTimer").hide(),$("form[name='"+t+"'] #resumeCallTimer").show()}function resumeCallTimer(e){var t=$(e).closest("form").get("0").name;formNameVsTimerObjMap.resume("displayCallTimer('"+t+"')",1e3,t),$("form[name='"+t+"'] #pauseCallTimer").show(),$("form[name='"+t+"'] #resumeCallTimer").hide()}function resetCallTimer(e){var t=$(e).closest("form").get("0").name;formNameVsTimerObjMap.reset(t),$("form[name='"+t+"'] #startTimerDiv").show().attr("onclick","startCallTimer(this)"),$("form[name='"+t+"'] #startTimerLabel").show(),$("form[name='"+t+"'] #stopTimerLabel").hide(),$("form[name='"+t+"'] #countupminute").html("00"),$("form[name='"+t+"'] #countupsecond").html("00"),$("form[name='"+t+"'] #pauseCallTimer").hide(),$("form[name='"+t+"'] #resumeCallTimer").hide(),$("form[name='"+t+"'] #resetCallTimer").hide(),$("form[name='"+t+"'] [id='property(DurationInMinute)']").val(""),$("form[name='"+t+"'] [id='property(DurationInSecond)']").val("00")}function getCallDuration(e){var t=getElm(e,"property(DurationInMinute)"),a=getElm(e,"property(DurationInSecond)");t.value=t.value.trim(),a.value=a.value.trim();var r=""==t.value?"00":t.value,o=""==a.value?"00":a.value,i=/^\d{1}$/;return o>59&&(o=parseInt(o)-60,r=parseInt(r)+1),(r=r<=9&&i.test(r)?"0"+r:r)+":"+(o=o<=9&&i.test(o)?"0"+o:o)}function freezealert(e,t,a){var r="N";if(!getObj("status").checked&&t)return r="S",renderingUtils.freezeBackground(),document.getElementById("alertDiv1").style.zIndex="30",mailsetCenter("alertDiv1"),(new IntegrationService).doValidate(),null!=IntegrationService.isServiceAlerted&&"S"==IntegrationService.isServiceAlerted&&($(getObj("zti_reference_deactivate1")).empty(),getObj("zti_reference_deactivate1").innerHTML=getObj("integrationService").innerHTML),getObj("status").checked=!0,!1;if(1==e&&!getObj("status").checked&&0==t)return r="S",renderingUtils.freezeBackground(),document.getElementById("alertDiv2").style.zIndex="30",mailsetCenter("alertDiv2"),(new IntegrationService).doValidate(),null!=IntegrationService.isServiceAlerted&&"S"==IntegrationService.isServiceAlerted&&($(getObj("zti_reference_deactivate2")).empty(),getObj("zti_reference_deactivate2").innerHTML=getObj("integrationService").innerHTML),!1;if("Administrator"!=e&&t){r="S",renderingUtils.freezeBackground(),document.getElementById("alertDiv3").style.zIndex="30",mailsetCenter("alertDiv3");var o=getObj("profileId");return(new IntegrationService).doValidate(),null!=IntegrationService.isServiceAlerted&&"S"==IntegrationService.isServiceAlerted&&($(getObj("zti_reference_deactivate3")).empty(),getObj("zti_reference_deactivate3").innerHTML=getObj("integrationService").innerHTML),o.selectedIndex=0,!1}return"S"!=r&&!getObj("status").checked&&a&&"S"==a&&((new IntegrationService).doValidate(),null!=IntegrationService.isServiceAlerted&&"S"==IntegrationService.isServiceAlerted)?(renderingUtils.freezeBackground(),document.getElementById("integrationService").style.zIndex="30",mailsetCenter("integrationService"),getObj("serviceClose").style.display="block",!1):void 0}function showResponderEntity(e){if(getObj("mailListDiv"))new AjaxAPI({id:"mailListDiv",url:e,callbackfn:function(){}}).post();else{commonUtils.showHideLoadingDiv(!0);var t=document.getElementById("lookupdiv");t.style.display="block",t.style.zIndex=30,t.style.overflow="hidden",t.style.width="680px",t.style.height="500px",mailsetCenter("lookupdiv"),renderingUtils.freezeBackground(),new AjaxAPI({id:"lookupdiv",url:e,callbackfn:function(){commonUtils.showHideLoadingDiv()}}).post()}}function searchResponderAction(e,t){var a=getObj("searchString").value;showResponderEntity(Crm.getCrmBasePath()+"/AutoResponder.do?step=showEntity&responderId="+t+"&module="+e+"&searchString="+encodeURIComponent(a))}var fillCurrencySymbols=function(e,t,a,r){null==r&&(r=getObj("module").value);var o=document.getElementById("currencyDetails");if(null!=o){var i=jQuery.parseJSON(o.value),n=i[e].symbol,s=$("#currencyFields").val(),l=Crm.isInventoryModule(r);if(l&&productDetails.fillCurrencySymbolsInLineHeaders(e,t,i),null!=s){if(l)for(var d=1;d<=parseInt($("#totalProductCount").val());)s+=":;:hdnUnitPrice"+d+":;:txtListPrice"+d,++d;var c=s.split(":;:"),m=c.length;for(d=0;d<m;d++){var u=document.getElementById("currencySymbol_"+c[d]);if(u&&($(u).empty(),u.innerHTML=n+"&nbsp;"),""!=c[d]){var p=getObj(c[d]),g=p.value;if(!(g.indexOf("${")>-1)&&null!=t&&""!=t&&""!=g){var v=g/parseFloat(i[t].er),f=parseFloat(i[e].er);p.value=roundNumber(v*f,2)}}}}if(l&&null==a)for(var h=1;h<=parseInt($("#totalProductCount").val());h++)calculateForLine(h,!0);productDetails.fillCurrSymForGrandVals(n)}};function updateStatus(e,t,a){var r="";e.substr(e.indexOf("#")+1,e.length);return"NoForm"!=t&&(r=commonUtils.formData2QueryString(t)),document.getElementById("shownotes").style.display="none",mR(e,(function(e){renderingUtils.removeFreezeLayer();var t=e;if(-1!=t.indexOf("ALERTERROR:::")){var r=t.split("ALERTERROR:::");return alert(r[1]),!1}""!=a&&($(getObj("bulkUpdateSuccess")).empty(),getObj("bulkUpdateSuccess").innerHTML=a,mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),2e3)),Crm.userDetails.isRelatedListLyteEnabled||crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,t),document.getElementById("ajax_load_tab").style.display="none",("canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName||Crm.userDetails.isRelatedListLyteEnabled)&&Lyte.triggerEvent("relatedList",{res:t})}),r),$("#shownotes").empty(),("Campaigns"==getObj("module").value&&getObj("totalContact")||getObj("totalLead"))&&loadCampaingSummary(),!1}function openImportWizard(e,t,a){void 0===a&&(a="myOrgData");var r=Crm.getCrmBasePath()+"/specific/ImportAction.do?step=1&module="+e+"&campaignId="+t+"&dataScope="+a;doAjaxUpdate("show",r)}function hideMacro(e){macroDivStatus=!1;var t=e.relatedTarget;$("#divMacro").find(t).length>0||(clearTimeout(CLEAR_INTERVAL_ID),$("#divMacro").hide())}function showMacro(e,t,a,r,o,i,n){!!document.getElementById("fromZcampLukp")&&removeRecLookUp();var s=new getHTTPObject,l="";if(1==e){a=void 0!==a&&""!=a&&"null"!=a?"&reqFrom="+a:"",n=void 0!==n&&""!=n&&"null"!=n?"&entityID="+n:"";var d="";getElemById("macroSugstBox")&&(d=(d=getElemById("macroSugstBox").value)==I18n.getMsg("crm.globalsearch.search.title")?"":"&macroNameSug="+encodeURIComponent(d)),l=Crm.getCrmBasePath()+"/WorkFlowRule.do?step=newRuleStep1&mode=macro&module="+t+a+d+n}else 2==e?(a=void 0!==a&&"null"!=a?"&reqFrom="+a:"",l=Crm.getCrmBasePath()+"/WorkFlowRule.do?step=showAllRules&mode=macro&module="+t+a+"&cvid="+i+"&FROM_INDEX="+r+"&TO_INDEX="+o):3==e?l=Crm.getCrmBasePath()+"/WorkFlowRule.do?step=showRule&ruleId="+t+"&mode=macro":4==e?l=Crm.getCrmBasePath()+"/WorkFlowRule.do?step=editRule&ruleId="+t+"&mode=macro":(5==e||6==e)&&(l="");s.open("GET",l,!0),s.onreadystatechange=function(){if(4==s.readyState){var e=getElemById("show");$(e).empty(),e.innerHTML=s.responseText,setTimeout((function(){manipulateScriptElems(e)}),0)}},s.send(null)}function showMacroSuggest(e,t,a,r,o,i,n,s,l,d,c,m,u){return Macro.showMacroSuggest(e,t,a,r,o,i,n,s,l,d,c,m,u)}function showMassConvertDialog(e,t,a,r,o){if("Leads"===e){if(!moduleRecordMapping.Contacts.visible)return(l=[]).push(moduleRecordMapping.Leads.plural_label),l.push(moduleRecordMapping.Contacts.plural_label),crmui.showMsgBand("error",I18n.getMsg("crm.lead.no.conversion",l),3e3),void commonUtils.showHideLoadingDiv(!1);if(document.querySelector("crm-mass-convert"))return;var i=networkUtils.returnDependencyFiles(["crm-mass-convert.js","user_type.js","crux-form-component.js"],ResourceConstants.CRMClient);i=(i=(i=i.concat(networkUtils.returnDependencyFiles(["zohocrm_mass_convert.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-mass-convert.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("crm_mass_convert"),ResourceConstants.CRM)),Crm.userDetails.ValidationAlertPreference&&(i=(i=(i=i.concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM))),commonUtils.showHideLoadingDiv(!0),Lyte.injectResources(i,void 0,(function(){var e={};e.crmBasePath=Crm.getCrmBasePath(),e.recordIds=t.split(";").filter((function(e){return e})),e.changeOwnerPermission=moduleRecordMapping.Accounts.visible?!Crm.userDetails.PERSONAL_ACCOUNT&&Crm.userDetails.permissions.Crm_Implied_Change_Owner_Accounts&&Crm.userDetails.permissions.Crm_Implied_Change_Owner_Contacts:!Crm.userDetails.PERSONAL_ACCOUNT&&Crm.userDetails.permissions.Crm_Implied_Change_Owner_Contacts,e.pipeLineEnabled=Crm.userDetails.isMultiPipelineActivated,e.isFromTool=a,e.pipeLineWarning=!1,e.ZiaVisionForLeads=Crm.userDetails.ZiaVisionForLeads,e.noteAlert=e.ZiaVisionForLeads,e.hasDealCreatePermission=moduleRecordMapping.Potentials.visible&&Crm.userDetails.permissions.Crm_Implied_Create_Potentials,e.hasAcntVisible=moduleRecordMapping.Accounts.visible;var r={};r.dealcreation_new=app.store.makeRequest("findAll","features",{api_names:"massconvert_dealcreation_newflow"},!1,!0,{version:"v7"});var o=store.peekRecord("user",Crm.userDetails.USER_ID);return r.user=void 0!==o?o:store.findRecord("user",Crm.userDetails.USER_ID),Lyte.resolvePromises(r).then((function(t){e.dealcreation_newflow=!!t.dealcreation_new,e.userId=Crm.userDetails.USER_ID,e.username=t.user.full_name,store.findAll("user_type").then((function(t){commonUtils.showHideLoadingDiv(!1);for(var a=t.length,r=[],o=!1,i=0;i<a;i++){var n=t[i];if(!0===n.active){if(n.personality_module.api_name===Crm.moduleInfo.Contacts.apiname&&!1===n.default){var s={};s.displayName=n.name,s.profileId=n.id,r.push(s)}n.personality_module.api_name===Crm.moduleInfo.Leads.apiname&&(o=!0)}}r.length>0&&o&&(e.portal_profiles=r,e.portalUserType=r[0].profileId),Lyte.Component.render("crm-mass-convert",e,"body")}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-mass-convert",e,"body")}))}))}))}else{var n=Crm.getCrmBasePath()+"/EntityMassConvert.do?step=massConvert&module="+e;if(a&&(n+="&isfromTool=true&startindex="+r+"&endindex="+o),0==$("#massConvertDIV").length){var s=document.createElement("div");s.setAttribute("id","massConvertDIV"),s.setAttribute("class","is-scroll ppTop newPopupStyleEle newMassConvertStyleEle"),document.body.appendChild(s)}var l=csrfParamName+"="+encodeURIComponent(csrfToken)+"&idsList="+encodeURIComponent(t),d=document.getElementById("massConvertDIV");$(d).empty(),new AjaxAPI({id:"massConvertDIV",url:n,params:l,callbackfn:function(){crmui.showPopup("massConvertDIV",!0),thirdPartyUtils.bindSelect2($(".cchosen").find("select"))}}).post()}}function closeMacroDialog(){!!document.getElementById("fromZcampLukp")?($("#popupnew").css("display","none"),$("[name=chk]").prop("checked",!1),$("#selAllCon").prop("checked",!1)):(document.getElementById("FreezeLayer")&&document.body.removeChild(document.getElementById("FreezeLayer")),hide("popupnew"))}function executeMacro(e,t,a,r){"null"==a&&crmListView.getObject()&&(a=crmListView.getObject().selectedIds.join(";")),doMacroExecution(e,t,decodeURIComponent(a).split(";"),r)}function doMacroExecution(e,t,a,r){var o=a.splice(0,crmConstants.maxRecOperCnt),i=new getHTTPObject,n=csrfParamName+"="+encodeURIComponent(csrfToken),s=!!document.getElementById("fromZcampLukp"),l=Crm.getCrmBasePath()+"/WorkFlowRule.do?step=executeWFRulesForLstVwEx";l+="&module="+t+"&idlist="+o.join(";")+"&ruleId="+e;var d=getElemById("mailRest");d&&(l+="&mailRest="+d.value),i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var c=getElemById("macroExecuteBtnLayer"),m=getElemById("macroExecutedBtnLayer"),u=getElemById("macroExecutingBtnLayer");c.style.display="none",u.style.display="",i.onreadystatechange=function(){if(4==i.readyState)if(1===a.length&&""===a[0]||a.length<=0){i.responseText;setTimeout((function(){showMacroExecProg(3)}),500),setTimeout((function(){showMacroExecProg(1)}),1e3),setTimeout((function(){showMacroExecProg(2)}),1500),setTimeout((function(){u.style.display="none",m.style.display=""}),2e3),s?(setTimeout((function(){$("#popupnew").css("display","none")}),4e3),$("[name=chk]").prop("checked",!1),$("#selAllCon").prop("checked",!1)):setTimeout((function(){crmTab.deleteFromCache(t),void 0!==r&&"dropDown"!=r&&""!=r&&"potentialpipeline"!=r&&"adwordCampSummary"!=r&&"adwordGroupSummary"!=r?reloadCurrentEntityView():"potentialpipeline"==r?reloadCurrentPipelinePage():"adwordCampSummary"==r||"adwordGroupSummary"==r?(renderingUtils.removeFreezeLayer(),getObj("popupnew").style.display="none"):reloadCurrentListView(),document.getElementById("FreezeLayer")&&document.body.removeChild(document.getElementById("FreezeLayer")),hide("popupnew")}),4e3)}else doMacroExecution(e,t,a,r)},i.send(n)}function showHideLockIcon(e,t){var a="true"===$("#iskanbanview").val(),r='<span id="lockicon" class="dIB vaM mL5"><crmutil-icon icon-name="lock-locked" icon-class="zcicn-lock-locked crmBaseIcon "></crmutil-icon></span>',o=a?$("#recordid_"+e):$("#cvlist_"+e);t?0==o.find("#lockicon").length&&(a?o.find("#name").after(r):o.find("#lp_Subject").after(r)):o.find("#lockicon").remove()}function reloadCurrentEntityView(e,t,a,r){if("Tasks"===t&&Crm.isDVRefreshForLock&&(detailView.showFollowUpTask=!0),Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution())Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0);else{if(t=t||(getObj("module")?getObj("module").value:""),"detail"===Lyte.Router.getRouteInstance().routeName&&Crm.renderDVLyteFlow(t)){var o={type:"custom event",message:"reloadCurrentEntityView function called in lyte enabled flow"};return murphy.addCustomTracking(o),murphy.error(new Error("reloadCurrentEntityView function called in lyte enabled flow")),void(Lyte.registeredMixins["crm-detailview-common-utils"]&&Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView())}if(e=(e=e||$("#id").val())||getObj("id").value,featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&featuresAvailable.TEAM_MODULE_ENABLED&&Lyte.Component.registeredHelpers.isRequesterTeamModule(t))Lyte.resolvePromises([store.findRecord(moduleRecordMapping[t].id,e,{approved:"both",converted:"both",formatted_currency:!0})]).then((function(){Lyte.Router.getRouteInstance().refresh()}));else{var i={};("entity"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName)&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(t)&&moduleRecordMapping.LockingInformation&&(i.records=store.findRecord(moduleRecordMapping[t].id,e,{approved:"both",converted:"both",formatted_currency:!0}),i.lockedRecord=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/"+moduleRecordMapping[t].api_name+"/"+e+"/Locking_Information__s",method:"GET"}).then((function(e){return e}),(function(e){})),detailView.recordLockingDetails.lockingInfoFields||(i.lockingInfoFields=store.findAll("field",{module:moduleRecordMapping.LockingInformation.api_name},void 0,!0,{apiVersion:"2.2"}))),Lyte.resolvePromises(i).then((function(o){if(detailView.recordLockingDetails&&(renderingUtils.removeFreezeLayer(),detailView.recordLockingDetails.lockedRecordDetails=o.lockedRecord?o.lockedRecord.data:void 0,o.lockingInfoFields&&(detailView.recordLockingDetails.lockingInfoFields=o.lockingInfoFields)),"Events"!==t&&"Calls"!==t||!Crm.renderDVLyteFlow(moduleApiMapping.Calls)||"detail"!==Lyte.Router.getRouteInstance().routeName)if("Activities"!==Crm.activityGrp[t]||"true"!==$L("#iskanbanview").val()&&!$L("#rightPanel").length)if(a)ajaxNew(Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+e+"&module="+t+"&cvid="+$("#cvid").val()+"&recordNum="+$("#recordNum").val(),void 0,a,void 0,!0);else if("canvas"===Lyte.Router.getRouteInstance().routeName)Lyte.Router.getRouteInstance().refresh();else{var i=$("#cvid"),n=$("#recordNum"),s=i.val()?i.val():"null",l=n.val()?n.val():"null";detailView.load(Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+e+"&module="+t+"&cvid="+s+"&recordNum="+l,void 0,void 0,void 0,void 0,!0)}else $("#multipleFieldsEditPop").remove(),"Tasks"===t&&showHideLockIcon(e,r),loadActivityDetails(void 0,void 0,void 0,e,!0,a,void 0,void 0,void 0,!0);else{var d={};d.entityId=e,d.module=t,SourceIdentifier.refreshPage("detailView",d)}}),(function(e){murphy.error(e)}))}}}function reloadCurrentPipelinePage(){var e=Crm.getCrmBasePath()+"/ViewPipeline.do?actiontype=viewPipeline";e+=Territory.currentInfo.pipelineInfo,ajaxNew(e)}function showMacroExecProg(e){var t=getElemById("macroAct"+e);t&&(t.style.visibility="visible")}function showRulesActions(e){var t=$("#rulesAct_"+e);t&&t.css("visibility","visible")}function hideRulesActions(e){var t=$("#rulesAct_"+e);t&&t.css("visibility","hidden")}function checkTimedBasedAction(){noMoreTBActions||TBALoading||loadTimeBasedActions(TBAPageNum+1,getObj("id").value)}function OnMessageFromChild(e){if(null!=e&&e.indexOf("zdframeht:")>-1){var t=parseInt(e.substring(e.indexOf("zdframeht:")+10)),a=document.getElementById("externalIframe");t&&(a.style.height=t+10+"px")}}function showUploadPhoto(e,t,a){"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route?(e=$L("#module")[0].value,t=$L("#entityId")[0].value):("crm.tab.module.create.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.edit.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.clone.canvas"===Lyte.Router.getRouteInstance().transition.info.route)&&e&&e.moduleName?e=e.moduleName:"crm.tab.module.create.canvas"!==Lyte.Router.getRouteInstance().transition.info.route&&"crm.tab.module.entity.edit.canvas"!==Lyte.Router.getRouteInstance().transition.info.route&&"crm.tab.module.entity.clone.canvas"!==Lyte.Router.getRouteInstance().transition.info.route||(e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t="crm.tab.module.entity.edit.canvas"===Lyte.Router.getRouteInstance().transition.info.route?Lyte.Router.getRouteInstance().transition.info.dynamicParams[1]:void 0);var r=Lyte.Router.getRouteInstance().getQueryParams().layoutId,o=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+e+"&actionName=showUploadImage";return void 0!==r&&(o=o+"&layoutId="+r),o=networkUtils.getPortalURL(o),"Users"!=e&&"Org"!==e&&void 0!==t&&""!=t&&(o+="&entityId="+t),void 0!==a&&""!==a&&(o+="&currentStatus="+a),mR(o,(function(t){var a=t;if(a.indexOf("ALERTERROR:::")>-1){var r=a.split("ALERTERROR:::");alert(r[1])}else{var o=document.getElementById("topBandPopup");if($(o).empty(),o.innerHTML=a,EvalInnerScript(o),"TeamSpace"===e){var i=document.getElementById("upload_photo");i&&i.click()}else showAnimatePopup("topBandPopup");CScriptLib&&_cscript._is_preview_frame&&(document.querySelector("#topBandPopup .zcrm-content").style.maxHeight="90vh"),document.querySelector("#topBandPopup").classList.add("crmCropperPopup")}})),!1}function uploadCroppedPhoto(e){return document.getElementById("j_uploadphoto").disabled="disabled",e.submit(),!1}function uploadOrigPhoto(e,t){var a=e.value;return commonUtils.showHideLoadingDiv(!0),validateImageFileExtension(a,t)&&validateImageSize(e,t)?(document.photouploaderform.submit(),$("#upload_photo").prop("disabled",!0),!0):(commonUtils.showHideLoadingDiv(),!1)}function dataURItoBlob(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([r],{type:a})}function showImageForCrop(e,t){if(!window.FileReader)return $('form[name="photocrop').remove(),void uploadOrigPhoto(e,t);var a,r=e.value;if(void 0===r&&void 0!==e.name?(r=e.name,a=e):a=e.files[0],validateImageFileExtension(r,t)&&validateImageSize(a,t)){"TeamSpace"===t&&showAnimatePopup("topBandPopup"),$("#selectPhotoForUpload").hide();var o=document.createElement("img"),i=new FileReader;i.onload=function(e){var a=getElemById("upload_photo").value,r=a.lastIndexOf("."),i=a.substring(r+1);i||(i="png"),o.src=e.target.result,o.onload=function(){var e=document.createElement("canvas"),a=o.width,r=o.height,n=450/r,s=835/a,l=n>s?s:n;r*=l,a*=l,e.width=a,e.height=r,e.getContext("2d",{preserveDrawingBuffer:!0}).drawImage(o,0,0,a,r);var d=e.toDataURL("image/"+i);blobObj=dataURItoBlob(d);var c=document.getElementById("mainTrgtImg");c.src=d,$("#showImageForCrop").show(),$("#crop_photo_title").text(I18n.getMsg("crm.general.crop.your.photo.here")),c.onload=function(){initJcrop(t)}}},i.readAsDataURL(a)}else{$L("#freezeBackGround").addClass("zcrmImageUploadCustomPopupFreeze"),e.value=""}}function uploadCroppedPhoto_new(e){var t;e=$(e),document.getElementById("j_uploadphoto").disabled="disabled";var a=(t=void 0!==getElemById("upload_photo").files[0]?getElemById("upload_photo").files[0].name:fileDropObj.name).lastIndexOf("."),r=t.substring(a+1);r||(r="png");document.getElementById("mainTrgtImg");var o=dataURItoBlob($L("#mainTrgtImg").data("cropper").getCroppedImage().toDataURL("image/"+r)),i=new FormData(e[0]);return i.append("upload_photo",o,t),commonUtils.showHideLoadingDiv(!0),$.ajax({url:e.attr("action"),type:"POST",data:i,contentType:!1,processData:!1,success:function(t){commonUtils.showHideLoadingDiv();var a="crm.tab.module.create.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.edit.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.clone.canvas"===Lyte.Router.getRouteInstance().transition.info.route;("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||a)&&$("[id=nonrellistProfileImage_canvas]").remove(),$("#"+e.attr("target")).html(t),hideAnimatePopup("topBandPopup");var r=$("[name='action_module']").val();if(Lyte.Router.getRouteInstance().transition.target.startsWith("crm.settings.section.teamspace")){var o=document.querySelector("crm-teamspace-builder");o&&o.component&&o.component.executeMethod("setUploadedIcon",document.getElementById("tsPhotoID").value)}null!=customViewObject&&customViewObject.isCustomizedView&&"Users"!=r&&"Org"!=r&&crmTab.deleteFromCache(r);var i=document.querySelector("crm-create-avatarupload"),n=document.getElementById("photoID"),s=document.querySelector("crm-create-entity");if(i){i.component.setData("uploadId",n.apiValue),i.component.executeMethod("setUploadIdinEntityRecord"),i.component.executeMethod("syncLatestAvatar");let e=i.component.data.currmoduleName,t=$L("crm-create-layout#"+e+"LC_layoutNode")[0];t&&t.component.setData("recordImagePhotoId",n.value)}if(s&&s.component.setData("isRecordImgRemoved",!1),"company-details"===Lyte.Router.getRouteInstance().routeName&&store.findAll("org").then((function(e){$L("crm-companydetail-page")[0].setData("photoId",e[0].photo_id),Crm.userDetails.org_logo=e[0].photo_id})),"canvas"===Lyte.Router.getRouteInstance().routeName&&delete crmTab.cacheObj[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()],"detail"===Lyte.Router.getRouteInstance().routeName){crmTab.deleteFromCache(Lyte.Router.getRouteInstance().parent.parent.getDynamicParam());var l=$L("crm-detail-view-avatarupload")[0];l.component.executeMethod("syncLatestAvatar"),l.component.setData("recordImage",n.value)}if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||a){var d=$L("#entityId")[0].value,c=document.querySelectorAll("#img_"+d),m=c.length;if("undefined"!=typeof fileID)for(var u=$("crm-canvas-form"),p=0;p<m;p++){c[p].setAttribute("data-fileid",fileID),c[p].setAttribute("src",chimgsrc);var g=document.createElement("div");g.classList.add("crm-csript-readonly-replaceaction","crm-dp-image-edit","canvas_profileimage"),g.setAttribute("onclick","previewPhoto()"),g.setAttribute("id","previewPhoto_crm-csript");var v=document.createElement("div");v.classList.add("cameraIcon"),g.appendChild(v),$(g).insertAfter(c[p].parentNode),a&&u.length&&u[0]&&u[0].component&&u[0].component.data&&u[0].component.data.record&&(u[0].component.data.record.Record_Image="null"!==n.apiValue?n.apiValue:fileID)}else if("undefined"!=typeof failureType&&"image_processing"===failureType){var f;for(p=0;p<m;p++)c[p].setAttribute("onmouseover","renderingUtils.zctt.showtt('"+I18n.getMsg("crm.zia.vision.processing.image")+"')"),c[p].setAttribute("onclick","detailView.renderVisionErrorPopUp('image_processing')"),c[p].style["background-image"]="none",f=c[p].closest("crm-canvas-profile-image").closest(".zcanvas-field"),$(f).addClass("zc-contain-Image"),c[p].setAttribute("src",networkUtils.getImageUrl("ico_processing_image.svg",ResourceConstants.CRM));$("[id=nonrellistProfileImage_canvas]").remove(),$(".canvas_profileimage").remove()}}},error:function(e){commonUtils.showHideLoadingDiv(),hideAnimatePopup("topBandPopup"),renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}}),!1}function cancelUploadImage(e,t){var a=new crmRequestPool,r=$("#fileId").val();if(r&&"-1"!=r){var o={fileId:$("#fileId").val(),action_module:t};e&&"null"!==e&&(o.entityId=e),o.crmcsrfparam=encodeURIComponent(csrfToken),a.initiate({action:"EntityImageAttach.do?actionName=cancelUploadImage",type:"POST",data:o})}hideAnimatePopup("topBandPopup"),"TeamSpace"===t&&$L("#topBandPopup").trapFocus("destroy"),commonUtils.showHideLoadingDiv()}function initJcrop(e){Lyte.injectResources([networkUtils.returnDependencyFiles(["lyte-cropper.js","exif-plugin.js"],ResourceConstants.CRMClient)],void 0,(function(){var t=$L("#cropimgcontainer img"),a=$L("#cropimgcontainer"),r=t[0].getBoundingClientRect();a.css({width:r.width>a.width?a.width:r.width+"px",height:r.height>a.height?a.height:r.height+"px","text-align":"center",margin:"auto"}),"Leads"===e||"Contacts"===e?$L("#mainTrgtImg").cropper({aspectRatio:"1:1",selection:{top:20,left:20,size:220},minSize:150,maxSize:450}):$L("#mainTrgtImg").cropper({aspectRatio:"n:n",selection:{top:20,left:20,size:220}}),commonUtils.showHideLoadingDiv()}))}function loadSalesSummary(){if($("#lp_salesSummaryDiv").length){var e=I18n.getMsg("crm.autoresponder.days"),t=SalesSummaryInfo.QUALIFICATIONDURATION,a=SalesSummaryInfo.DEALDURATION&&"null"!==SalesSummaryInfo.DEALDURATION?SalesSummaryInfo.DEALDURATION+" "+e:"0",r=SalesSummaryInfo.SALESDURATION&&"null"!==SalesSummaryInfo.SALESDURATION?SalesSummaryInfo.SALESDURATION+" "+e:"0";t?$("#lp_leadConversionTimeSpan").text(t+" "+e):$("#lp_leadConversionTimeSpan").text(I18n.getMsg("crm.salessummay.notapplicable")),$("#lp_SalesCycleDurationSpan").text(a),$("#lp_OverallSalesDurationSpan").text(r)}}function processPlugins(){$("#hotels").html($("[name=plugin_RL]").eq(1).find("#hotels").html()),$("[name=plugin_RL]").eq(1).remove()}function transferRelatedDetails(e,t){getObj("module")&&"Events"==getObj("module").value&&(Events.initEventRightPannel(getObj("id").value),processPlugins());var a=getElemById("noteDetails");if(!a&&t){(a=document.createElement("div")).id="noteDetails",a.name="noteDetails",$(a).addClass("fL clearAfterB relatedlist-bg");const e=document.getElementsByClassName("dvScrollContainier")[0];if(crmTab.isZBCustomModule(detailView.currentModule)||crmTab.isZSCustomModule(detailView.currentModule)){const t=document.getElementsByClassName("zbDetailsRelSection");t&&e.insertBefore(a,t[0].nextSibling)}else{const t=document.getElementById("segmentation");e.insertBefore(a,t.nextSibling)}}a&&(""==a.innerHTML||e)&&($(a).empty(),Crm.userDetails.isRelatedListLyteEnabled||(a.innerHTML=$("#relNotesInRL").html())),a&&!1===t&&$(a).remove(),featuresAvailable.ZIA_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_View_Zia_Notes_Summary&&Crm.isSupportedModuleForZiaSummary(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])&&(Notes.currentFiletr="all",Notes.injectNotesSummaryComponent("pageLoad")),$("#relNotesInRL").html(""),Notes.processNotes(),$("#recentItemListdiv").length&&$("#rItemDataDiv").html($("#recentItemListdiv").html())}function removeRecLookUp(){renderingUtils.removeFreezeLayer(),getObj("lookupdiv").style.display="none",$("#lookupdiv").empty(),document.body.style.overflow=""}function constructList(){if(0==$("#sdiv").length){var e=$("<div>",{id:"sdiv",class:"eventActionsMenu",style:"display:none;z-index:1002;#padding-right:20px;"}),t=$("<ul>",{id:"times",class:"timeList"}),a=$("ul",e.append(t));if(allTimeArr.length){for(var r in allTimeArr)if(allTimeArr.hasOwnProperty(r)){var o=allTimeArr[r].toString(),i=o.split(":");if("HH:mm"!==Crm.userDetails.TIME_FORMAT)var n=I18n.getMsg(i[2]),s=[[i[0],i[1]].join(":"),n].join(" ");else s=[i[0],i[1]].join(":");a.append($("<li>",{time:o,text:s}))}if(!$("#bestTimeListFilterId").length)$("#timesData").append('<div class="bestTimeListFilter cP" id="bestTimeListFilterId" onclick="crmBstTime.showFilteredBestTime(this);sE(event);renderingUtils.zctt.hidett();" onmouseout="renderingUtils.zctt.hidett();");" style="display:none;z-index:1003">'+I18n.getMsg("crm.best.time.column.label")+"</div>"),document.getElementById("bestTimeListFilterId").addEventListener("mouseover",(function(e){$(e.target).hasClass("filtered")?renderingUtils.zctt.showtt(I18n.getMsg("crm.best.time.tooltip.show.all.time"),void 0,void 0,void 0,"false"):renderingUtils.zctt.showtt(I18n.getMsg("crm.best.time.tooltip.show.best.time"),void 0,void 0,void 0,"false")}));$("#timesData").append(e),$("#times li, .AmpmnewValues li, .bestTimeListFilter").mouseover((function(){var e=$(this);cur=e.index(),"HH:mm"!==Crm.userDetails.TIME_FORMAT&&$(".AmpmnewValues li").removeClass("li_hover"),$("#times li").removeClass("li_hover"),e.addClass(li_hover_class)})).mouseout((function(){$("#times li, .AmpmnewValues li").removeClass("li_hover")})).mousedown((function(e){$(e.target).hasClass("bestTimeListFilter")?$(".bestTimeListFilter").addClass("bottomAlignClicked"):($(".bestTimeListFilter").removeClass("bottomAlignClicked"),$(".bestTimeListFilter").hide(),$(".tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask")),div_on_hover=!1,div_on_click=!0,$(".bestTimeListFilter").hasClass("bottomAlignClicked")||($("#sdiv.tA").length&&($("#sdiv.tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask")),setTime($(this),!0),$("#sdiv").hide(),crmBstTime.hideBestTimeSuggestion("QuickCreateTask"),$(".AmpmnewValues").addClass("hide"))}))}else constructTime(),constructList()}}function constructTime(e){if(allTimeArr.length||e){var t=new Date(2e3,0,1,0,"00","00"),a=t.getDate(),r=a,o="PM",i="00";for(allTimeArr=[];a==r;){var n=t.getHours();"HH:mm"!==Crm.userDetails.TIME_FORMAT?(i=(t.getHours()+11)%12+1,o=n>11?"PM":"AM"):i=t.getHours();var s,l=t.getMinutes();"HH:mm"!==Crm.userDetails.TIME_FORMAT?(s=[formatNumber(i),formatNumber(l),o].join(":"),[[formatNumber(i),formatNumber(l)].join(":"),I18n.getMsg(o)].join(" ")):(s=[formatNumber(i),formatNumber(l)].join(":"),[[formatNumber(i),formatNumber(l)].join(":")].join(" ")),allTimeArr.push(s),t.setMinutes(l+30),r=t.getDate()}}else constructTime(!0)}function doGetCaretPosition(e){if(document.selection){e.focus();var t=document.selection.createRange();t.moveStart("character",-e.value.length),CaretPos=t.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(CaretPos=e.selectionStart)}function handleQCScheduleCall(e){var t=$(e).closest("form").get("0").name,a=$("form[name='"+t+"'] select[name='property(Call Type)']"),r=a.find("[actualvalue=Outbound]").val();$("form[name='"+t+"'] input[name='property(Call Duration)']").parent().css("display","none").parent().css("display","none"),$("form[name='"+t+"'] input[name='property(Call Start Time)']").parent().css("display","block").parent().css("display","block"),a.val(r).trigger("change").attr("disabled",!0),$("form[name='"+t+"'] [id='_leContModSel']").parent().children("span").children("label").addClass("qmandatory"),getObj("compCalDiv")&&$("form[name='"+t+"'] #compCalDiv").css("display","block"),getObj("qownerName_select")&&$("#call_qowner").css("display",""),getObj("remTime")&&($("#remTime").closest(".tabDivCreate").css("display",""),$("form[name='"+t+"'] input[name='remCheckTask']").prop("checked",!0)),$("#checkDuplicateEvent").show(),$("input[name='property(Call Start Time)']")[0].setAttribute("onclick","crmCalendar.showCalendar(event,'leftPanel',Events.callDuplicationDateHandler, undefined, 786)")}function deleteFollowUpRule(e,t){if(window.confirm(I18n.getMsg("crm.delete.autofollowrule.confirm"))){var a=Crm.getCrmBasePath()+"/AutoFollowUp.do?action=delFollowUp",r={};r.followUpId=e,r.crmcsrfparam=encodeURIComponent(csrfToken),mR(a,(function(e){"true"===trimBoth(e)&&$(t).parents("tr").remove()}),r)}}function setWidthForDiv(e){var t=trimBoth(e);if(-1!==e.indexOf("REACHED_MAX_LIMIT_PER_USER_PER_MODULE")){var a=e.split("###")[1];$("#errorMsg").html(I18n.getMsg("crm.followup.alert.msg5",a))}else if(-1!==e.indexOf("REACHED_MAX_LIMIT_PER_MODULE")){a=e.split("###")[1];$("#errorMsg").html(I18n.getMsg("crm.followup.alert.msg4",a))}else if(-1!==e.indexOf("REACHED_MAX_LIMIT")){a=e.split("###")[1];$("#errorMsg").html(I18n.getMsg("crm.followup.alert.msg3",a))}else if("ALREADY_EXSISTS_ERROR"===t)$("#errorMsg").html(I18n.getMsg("crm.followup.alert.msg2"));else if("CRITERIA_ERROR"===t)$("#errorMsg").html(I18n.getMsg("crm.masstool.invalid.criteria"));else{var r=$("#feedsLookupDiv");renderingUtils.showFreezeLayer();$(window).height();r.attr("style",""),r.attr("class","zcrm-modal zcrm-effect zcrm-show newInputStyleEle"),r.html(e),crmui.modalZIndex("nonLyte",r[0],"open")}}function showFollowUpRule(e){var t=$(e).data("params"),a=t.action,r=Crm.getCrmBasePath()+"/AutoFollowUp.do";(new crmRequestPool).initiate({action:r,data:t,type:"GET",success:function(e){switch(a){case"showAllFollowUps":case"newFollowUp":case"editFollowUp":setWidthForDiv(e);break;case"createdByMe":$("#myRulesDiv").find("tbody").append(e);var t=$("#CBMmoreMsg");null==loadCBMPage?t.remove():t.data("params").pageno=loadCBMPage;break;case"sharedWithMe":$("#sharedRulesDiv").find("tbody").append(e);var r=$("#SWMmoreMsg");null==loadSWMPage?r.remove():r.data("params").pageno=loadSWMPage}},error:function(){}}),setTimeout((function(){$("#moduleCustomizationDiv").is(":visible")&&document.getElementById("AFcancel").addEventListener("click",(function(){CrmModule.show("deletefield")}));$("#followUpName").focus()}),1e3)}function displayMoreContent(e){$(e).siblings("span").show(),$(e).remove()}function logoutCall(e){logout(e)}function approveRecord(e){var t=detailView.appObj,a=$L("appCmntsArea"),r="";null!==a&&(r=a.value);var o=$L("#reasonAdmin1");if("rejectRecord"===e&&""!==detailView.adminapproval&&0!==o.length&&(o=o[0].cxProp("value")).length>1e3)renderingUtils.displayErrorDiv("appCmntsArea","1000",I18n.getMsg("crm.approval.comment.validation"));else{r=r&&0!==r.length?r:"";var i=$L("#lyteAPCommentArea");if(0===r.length&&""===r&&i.length>0&&(r=(r=i[0].value).replace(/\s/g,"").length>0?r:""),r.length>1e3)renderingUtils.displayErrorDiv("appCmntsArea","1000",I18n.getMsg("crm.approval.comment.validation"));else{var n=$L("crm-approval-process-rejectors")[0],s=[];if(void 0!==n&&!0===n.getData("checkbox_enabled")&&!0===n.getData("cc_enabled")){var l=$("#cruxUserDrop")[0].getData("cxPropSelectedUsers");if((C=l.length)>0)for(var d=0;d<C;d++)s[d]=l[d].id;if(0===s.length)return $L("#noUsersAlert").e.ltProp("show",!0),!1;s=JSON.stringify(s)}var c="rejectRecord"===e&&n&&n.component.getData("data")?n.component.getData("data"):void 0,m=void 0!==n?n.component.getData("response"):void 0;if(m=m&&n.component.getData("fromEditPageTakeover")?"takeover":m,"respond"===e||"takeover"===m){var u=n.component.getData("fromSource"),p=Lyte.Router.getRouteInstance().currentModel,g="canvas"===Lyte.Router.getRouteInstance().routeName,v="respond"===m?"approveRecord":m+"Record";v="takeover"===m?e:v,appAct=v;var f=void 0===detailView.currentModule?g?p.module_name:"editFromTasks"===u?p.module:p.moduleName:detailView.currentModule;appMod=f,appRecId=void 0===detailView.entityId?g?p.records?p.records[p.moduleObj.id][0].id:p.entityId:"editFromTasks"===u?p.entityId:p.entityrecordData.id:detailView.entityId,c=n.component.getData("data");var h="undefined"==typeof businessCardJson?n.component.getData("currentStage"):businessCardJson.approversNameList.currLevel;currAppLevel=h}else appAct=e;if(("Tasks"===appMod||"Events"===appMod)&&n){var y={},b=Crm.fieldsObj[appMod],C=b.length;for(d=0;d<C;d++){var I=$("#"+b[d]).data();if(void 0!==I){var w="property("+("Tasks"===appMod?I.colname:I.label)+")",_="Tasks"===appMod?Crm.requestParamWithColname[I.colname]:Crm.requestParam[w]?Crm.requestParam[w]:Crm.requestParamWithColname[I.colname],R={};if(8===I.uitype&&"undefined"!=typeof changeOwner&&(R.$relatedRecords=changeOwner.relatedRecords[appRecId],R.$notify=changeOwner.notifyOwner[appRecId],R.id=Crm.requestParamWithColname[I.colname]),"Tasks"!==appMod&&"SMOWNERID"===I.colname&&(_=Crm.requestParam["property(ownerName)"]),!_||"ENDDATETIME"!==I.colname&&"STARTDATETIME"!==I.colname&&333!==I.uitype||(_="HH:mm"!==Crm.userDetails.TIME_FORMAT?_+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"hour)"]+":"+Crm.requestParam[w.substring(0,w.indexOf(")"))+"minute)"]+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"ampm)"]:_+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"hour)"]+":"+Crm.requestParam[w.substring(0,w.indexOf(")"))+"minute)"],_=apiDateTimeFormat(_)),void 0!==_&&I.oldValue!==_&&void 0!==I.sysrefname&&(y[I.sysrefname]=8===I.uitype?R:"Due_Date"===I.sysrefname&&""===_?null:_),"All_day"===I.sysrefname&&void 0!==y.All_day&&(y[I.sysrefname]="on"===y[I.sysrefname]?"true":"false"),"Remind_At"===I.sysrefname&&void 0!==y.Remind_At)if("Tasks"===appMod){var L;if(w="property("+I.label+")",_=Crm.requestParam[w],_="HH:mm"!==Crm.userDetails.TIME_FORMAT?_+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"hour)"]+":"+Crm.requestParam[w.substring(0,w.indexOf(")"))+"minute)"]+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"ampm)"]:_+" "+Crm.requestParam[w.substring(0,w.indexOf(")"))+"hour)"]+":"+Crm.requestParam[w.substring(0,w.indexOf(")"))+"minute)"],_=apiDateTimeFormat(_),Crm.requestParam.remTime){var k=Crm.requestParam.remTime.split(" "),P="days"===k[1]?"D":"W";L=(L="-P"+k[0]+P)+";TRIGGER_TIME="+(M=Crm.requestParam["property(Remind Athour)"]+":"+Crm.requestParam["property(Remind Atminute)"])}var O=Crm.requestParam.remTime?L:"DATE-TIME:"+_;y[I.sysrefname]="none"===y[I.sysrefname]||0===y[I.sysrefname].length?null:{ALARM:"FREQ="+Crm.requestParamWithColname.RemindAt_period.toUpperCase()+";ACTION="+Crm.requestParamWithColname.RemindAt_Notify.toUpperCase()+";TRIGGER="+O},crmTasks&&crmTasks.updateAllUpcomingRem&&(y.$update_all_future_tasks=crmTasks.updateAllUpcomingRem)}else if("Events"===appMod){var T=null!==(_="none"===Crm.requestParamWithColname.REMINDAT?null:JSON.parse(Crm.requestParamWithColname.REMINDAT))?[]:_,E=null!==_?Object.keys(_).length:0,S=void 0!==y.All_day&&"true"===y.All_day||!0===$L("#Crm_Events_ALLDAYEVENT").is(":checked"),D="";if(S){var M={hrs:parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])-1,mins:"0",seconds:"0"};D=Utils.getDateObject(void 0,M),D=(D=Utils.getUtcDateObj(D.getTime())).getHours()+":"+D.getMinutes()}for(var B=1;B<=E;B++){var A={},U=_[B];U=U.split(" "),A.unit=parseInt(U[0]),A.period="0"===U[0]?S?"days":"minutes":"mins"===U[1]?"minutes":"hrs"===U[1]?"hours":U[1],S&&(A.time=D),T.push(A)}y[I.sysrefname]=T}if("Remind_Participants"===I.sysrefname&&_){var j=JSON.parse(_);y[I.sysrefname]=j.partRem}}}if(void 0!==Crm.requestParam.invAddJson||void 0!==Crm.requestParam.invRemoveJson){var x=[];if(void 0!==Crm.requestParam.invAddJson){var F=JSON.parse(Crm.requestParam.invAddJson),N=Object.keys(F);for(C=N.length,d=0;d<C;d++){var V=N[d];if(Object.keys(V).length>0)if(""!==(J="e"===V?"email":"u"===V?"user":"l"===V?"lead":"c"===V?"contact":""))for(var H=(Z=Object.keys(F[V])).length,z=0;z<H;z++){var q={};q["e"===V?"Email":"participant"]=Z[z],q.type=J,x.push(q)}}}if(void 0!==Crm.requestParam.invRemoveJson){var W=JSON.parse(Crm.requestParam.invRemoveJson),G=Object.keys(W);for(C=G.length,d=0;d<C;d++){var J;V=G[d];if(Object.keys(V).length>0)if(""!==(J="e"===V?"email":"u"===V?"user":"l"===V?"lead":"c"===V?"contact":"")){var Z;for(H=(Z=Object.keys(W[V])).length,z=0;z<H;z++){var K={};K["e"===V?"Email":"participant"]=Z[z],K.type=J,K._delete=null,x.push(K)}}}}Object.keys(x).length>0&&(y.Participants=x)}var Q=$("#Crm_Events_CONTACTID").data();Crm.requestParam["property(leContModSel)"]&&Crm.requestParam["property(leContModId)"]?"Contacts"===Crm.requestParam["property(leContModSel)"]?y.Who_Id=Crm.requestParam["property(leContModId)"]:(y.What_Id=Crm.requestParam["property(leContModId)"],y.$se_module=moduleApiMapping[Crm.requestParam["property(leContModSel)"]]):Q&&!Q.readonly&&(y.Who_Id=null),Crm.requestParam["property(modid)"]&&"Contacts"!==Crm.requestParam["property(modsel)"]?(y.What_Id=Crm.requestParam["property(modid)"],y.$se_module=moduleApiMapping[Crm.requestParam["property(modsel)"]]):void 0===y.What_Id&&Q&&!Q.readonly&&(y.What_Id=null),y&&0!==Object.keys(y).length&&((c={}).data=[y])}appMod&&appRecId||"detail"!==Lyte.Router.getRouteInstance().routeName||(appMod=detailView.currentModule,appRecId=detailView.entityId);var X={};if(X.crmcsrfparam=encodeURIComponent(csrfToken),X.comments=0===r.length&&n&&n.component.getData("takeoverComments")&&0!==n.component.getData("takeoverComments").length?n.component.getData("takeoverComments"):r,c&&0!==c.length&&(X.data=JSON.stringify(c)),X.notify_user_ids=s,"backToResp"===appAct)return openApprovalPop("respondApproval",appMod,appRecId,getElemById("respondApproval"),I18n.getMsg("crm.approvalProcess.label.yourCommentsHere"),void 0,currAppLevel,void 0),null;var Y,ee=Crm.getCrmBasePath()+"/approvalProcess.do?action="+appAct;if(ee=ee+"&module="+appMod+"&recordId="+appRecId,"rejectRecord"===e&&void 0!==detailView.rejectionStage&&(ee=ee+"&rejectStage="+detailView.rejectionStage),"respond"===e&&"rejectRecord"===appAct&&(ee=ee+"&rejectStage="+(void 0!==n.getData("rejectionStage")?n.getData("rejectionStage")+"":n.getData("approverList").length+"")),""!==detailView.adminapproval&&(currAppLevel=0,ee=ee+"&adminApproval="+detailView.adminapproval),"respondApproval"===$(t).attr("id")&&"delegateRecord"===appAct)return openApprovalPop("delegateRecord",appMod,appRecId,getElemById("delRecBtn"),I18n.getMsg("crm.approvalProcess.label.yourCommentsforDelagate"),void 0,currAppLevel,void 0),null;if("delegateRecord"===appAct){var te=$("#deleUserName").attr("userId");if(te||"respond"!==e||(te=void 0===(te=n.component.getData("userRecord").id)?"None":te),"None"===te)return alert(I18n.getMsg("crm.tpi.ctiapi.config.errormsg.selectsalesrep")),!1;ee=ee+"&delegateUserId="+te}else n&&n.setData("show",!1);("edit"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().routeName&&"form_edit"===Lyte.Router.getRouteInstance().currentModel.form_type)&&n&&n.setData("disableSaveButtons",!1),(currAppLevel||0===currAppLevel)&&(ee+="&currLevel="+currAppLevel),"Events"===appMod&&$L("#saveEventsBtn,#cancelEventBtn").prop("disabled",!0),n&&((u=n.getData("fromSource"))&&n.setData("fromSource","remove"+u),Y=n.getData("subformPromise")),detailView.isWFExecInKafka=!1,detailView.refreshInWms=!1,mR(ee,(function(a){var r=JSON.parse(a);if("-1"===r.auditLogId&&r.recordStatus&&"OnApprovalProcessUpdateCall"===r.recordStatus||crmTab.deleteFromCache(appMod),t){if("approveRecord"===appAct?(!1,$(t).closest("tr").css("pointer-events","none"),$(t).closest("td").find(".approveRejectButtons").hide(),-1!=r.auditLogId&&$(t).closest("td").find(".approved").show()):"rejectRecord"===appAct?(!1,$(t).closest("tr").css("pointer-events","none"),$(t).closest("td").find(".approveRejectButtons").hide(),-1!=r.auditLogId&&$(t).closest("td").find(".rejected").show()):(!0,$(t).closest("tr").css("pointer-events","none"),$(t).closest("td").find(".approveRejectButtons").hide(),-1!=r.auditLogId&&$(t).closest("td").find(".delegated").show()),-1==r.auditLogId){"edit"===Lyte.Router.getRouteInstance().routeName&&$L("crm-create-buttons")[0].component.setData("disableFormbuttons",!1),"Rejected"==r.recordStatus?$(t).closest("td").find(".rejected").show():"Delegated"==r.recordStatus?$(t).closest("td").find(".delegated").show():$(t).closest("td").find(".approved").show();var o="Rejected"===r.recordStatus||"Process_Admin_Reject"===r.recordStatus?I18n.getMsg("crm.approval.already.rejectedrecord",r.doneBy):"Delegated"===r.recordStatus?I18n.getMsg("crm.approval.already.delegatedrecord",r.doneBy):I18n.getMsg("crm.approval.already.approvedrecord",r.doneBy);"canvas"===Lyte.Router.getRouteInstance().routeName?Customization.approvalMsg=o:renderingUtils.showCustomAlert(o)}if(isWFKafkaUser()&&(detailView.isWFExecInKafka=r.isWFExecInKafka,r.callWMS))return detailView.refreshInWms=r.callWMS,detailView.prevModule=r.module,hide("approvePop"),detailView.approvalCaseOffloading=!0,detailView.hideElementsForKafkaWorkFlow(appMod),void setTimeout((function(){detailView.refreshInWms&&(detailView.refreshInWms=!1,detailView.approvalCaseOffloading=!1,detailView.callLyteRefresh(appMod))}),8e3)}else if($(appObj1).closest("div").hide(),"approveRecord"===appAct?-1!=r.auditLogId&&$("#approvedClicked").show():"rejectRecord"===appAct?-1!=r.auditLogId&&$("#approvedRejected").show():-1!=r.auditLogId&&($("#approvalDelegate").show(),store.findRecord("user",te).then((function(e){var t=e[0].email,a=e[0].full_name,r=e[0].image_link;getElemById("delegateUserName").innerHTML=$ESAPI.encoder().encodeForHTML(a),getElemById("deleUserEmail").innerHTML=$ESAPI.encoder().encodeForHTML(t),$("#deleUserImg").attr("src",r)}))),-1==r.auditLogId)if("OnApprovalProcessUpdateCall"===r.recordStatus){var i=r.updateCallErrorResponse[0];_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg(i.message),ltPropWrapperClass:"crmCenterAlert"},accept:function(){Lyte.registeredMixins.approvalprocess.onCloseActions(u||"approvalAction",!0,Y)}})}else{o="Rejected"===r.recordStatus||"Process_Admin_Reject"===r.recordStatus?I18n.getMsg("crm.approval.already.rejectedrecord",r.doneBy):"Delegated"===r.recordStatus?I18n.getMsg("crm.approval.already.delegatedrecord",r.doneBy):I18n.getMsg("crm.approval.already.approvedrecord",r.doneBy);"canvas"===Lyte.Router.getRouteInstance().routeName?Customization.approvalMsg=o:renderingUtils.showCustomAlert(o)}("respondApproval"===$(t).attr("id")||"delRecBtn"===$(t).attr("id")||"respondApprovalAP"===$(t).attr("id")||"-1"===r.auditLogId&&0===currAppLevel)&&("canvas"==Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().refresh():reloadCurrentEntityView()),"-1"===r.auditLogId||"respond"!==e&&0!==currAppLevel&&"takeover"!==m||("detail"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().routeName&&"form_edit"!==Lyte.Router.getRouteInstance().currentModel.form_type?"Events"===appMod?(reloadCurrentEntityView(appRecId,appMod),Events.closeEntity()):Lyte.Router.getRouteInstance().refresh():("canvas"===Lyte.Router.getRouteInstance().routeName||"edit"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().routeName&&"form_edit"===Lyte.Router.getRouteInstance().currentModel.form_type)&&("listView"===Crm.editReqFrom?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[appMod,appRecId]}):crmHistory.backOneLevel())),detailView.appObj="","rejectRecord"===appAct&&void 0!==r.approverNameList&&(detailView.comments=r.comments,businessCardJson.approversNameList=r.approverNameList),detailView.appObj="",detailView.adminapproval="",hide("approvePop"),renderingUtils.removeFreezeLayer()}),X)}}}function showApproveDetailedView(e,t,a){var r=Crm.getCrmBasePath()+"/approvalProcess.do?action=showDetailedView&entityId="+e+"&recModule="+t+"&isOthersView="+a;ajaxNew(r,void 0,$("body").animate({scrollTop:0},500))}function myJobsReject(e,t,a,r,o,i,n){var s=-1===n?"myJobRtT":"myJobRt",l=Crm.getCrmBasePath()+"/approvalProcess.do?action=showDetailedView&entityId="+e+"&recModule="+t+"&isOthersView="+s;jQuery.ajax({url:l,type:"POST"}).done((function(e){detailView.approverbusiinessObj=JSON.parse(e.approverNameList),a=o,i=void 0!==detailView.approverbusiinessObj&&void 0!==detailView.approverbusiinessObj.recordOwner?detailView.approverbusiinessObj.recordOwner:i,openRejectorComp(a,r,!0,t,void 0,i)}))}function openApprovalPop(e,t,a,r,o,i,n,s,l){appAct=e,appMod=t,appRecId=a;var d=r;detailView.appObj=r;var c=!1;appObj1=i,void 0===s?s=e:"awaitingRecords"===s&&(myJobsReject(a,t,s,getElemById("appCmntsArea"),e),c=!0,s=e);if(currAppLevel=n,"approvePop"===$("#approvePopMainDiv").children().attr("id")){var m=getElemById("appCmntsArea");if(m.value="","approveRecord"===e)getElemById("appRecBtn").style.display="",getElemById("delRecBtn").style.display="none",getElemById("rejRecBtn").style.display="none",getElemById("deleUsersDiv").style.display="none",getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none",$("#cancelBtn").removeClass("mL5");else if("delegateRecord"===e)getElemById("appRecBtn").style.display="none",getElemById("delRecBtn").style.display="",getElemById("rejRecBtn").style.display="none",getElemById("deleUsersDiv").style.display="",JElem=$("#delRecBtn"),JElem.removeClass("newCancelBtn"),JElem.addClass("newSaveBtn"),"respondApprovalAP"===$(d).attr("id")||"delRecBtn"===$(d).attr("id")?(getElemById("cancelBtn").style.display="none",getElemById("backBtn").style.display=""):(getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none",$("#cancelBtn").removeClass("mL5"));else if("rejectRecord"===e)getElemById("appRecBtn").style.display="none",getElemById("delRecBtn").style.display="none",getElemById("rejRecBtn").style.display="",getElemById("deleUsersDiv").style.display="none",JElem=$("#rejRecBtn"),JElem.removeClass("newCancelBtn"),JElem.addClass("newSaveBtn"),$("#cancelBtn").addClass("mL5"),getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none";else{getElemById("appRecBtn").style.display="",getElemById("delRecBtn").style.display="",getElemById("rejRecBtn").style.display="",getElemById("deleUsersDiv").style.display="none",getElemById("cancelBtn").style.display="none",getElemById("backBtn").style.display="none",JElem=$("#rejRecBtn"),JElem.removeClass("newSaveBtn"),JElem.addClass("newCancelBtn");var u=$("#delRecBtn");u.removeClass("newSaveBtn"),u.addClass("newCancelBtn")}$("#appCmntsArea").attr("placeholder",o),c||openRejectorComp(s,m,!1,t,false,l)}else{var p=Crm.getCrmBasePath()+"/approvalProcess.do?action=showApprovePop&recordId="+a+"&module="+t,g=new getHTTPObject;g.open("GET",p,!0),g.onreadystatechange=function(){if(4==g.readyState){if(401==g.status)return void renderingUtils.displayPermissionDenied(g.responseText);txt=g.responseText;try{var a=JSON.parse(txt);"Failure"===a.Status&&renderingUtils.showCustomAlert(a.Error)}catch(a){$("#approvePopMainDiv").html(txt),EvalInnerScript(getObj("approvePopMainDiv"));var r=getElemById("appCmntsArea");if(r.value="","approveRecord"===e)getElemById("appRecBtn").style.display="",null!=getElemById("delRecBtn").style.display&&(getElemById("delRecBtn").style.display="none"),getElemById("rejRecBtn").style.display="none",getElemById("deleUsersDiv").style.display="none",getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none",$("#cancelBtn").removeClass("mL5");else if("delegateRecord"===e)getElemById("appRecBtn").style.display="none",getElemById("delRecBtn").style.display="",getElemById("rejRecBtn").style.display="none",getElemById("deleUsersDiv").style.display="",JElem=$("#delRecBtn"),JElem.removeClass("newCancelBtn"),JElem.addClass("newSaveBtn"),"respondApprovalAP"===$(d).attr("id")||"delRecBtn"===$(d).attr("id")?(getElemById("cancelBtn").style.display="none",getElemById("backBtn").style.display=""):(getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none",$("#cancelBtn").removeClass("mL5"));else if("rejectRecord"===e)getElemById("appRecBtn").style.display="none",getElemById("delRecBtn").style.display="none",getElemById("rejRecBtn").style.display="",getElemById("deleUsersDiv").style.display="none",JElem=$("#rejRecBtn"),JElem.removeClass("newCancelBtn"),JElem.addClass("newSaveBtn"),$("#cancelBtn").addClass("mL5"),getElemById("cancelBtn").style.display="",getElemById("backBtn").style.display="none";else{getElemById("appRecBtn").style.display="",getElemById("delRecBtn").style.display="",getElemById("rejRecBtn").style.display="",getElemById("deleUsersDiv").style.display="none",getElemById("cancelBtn").style.display="none",getElemById("backBtn").style.display="none",JElem=$("#rejRecBtn"),JElem.removeClass("newSaveBtn"),JElem.addClass("newCancelBtn");var i=$("#delRecBtn");i.removeClass("newSaveBtn"),i.addClass("newCancelBtn")}$("#appCmntsArea").attr("placeholder",o),c||openRejectorComp(s,r,!1,t,false,l)}}},g.send(null)}}function openRejectorComp(e,t,a,r,o,i,n,s,l,d,c,m){var u,p=networkUtils.returnDependencyFiles(["crm-approval-process-rejectors.css"],ResourceConstants.CRMClient),g=networkUtils.returnDependencyFiles(["crm-approval-process-rejectors.js","approvalprocess-mixins.js"],ResourceConstants.CRMClient),v=[],f={},h=!0,y="false";detailView.rejectionStage="1";var b,C=I18n.getMsg("crm.approvalProcess.label.yourCommentsHere"),I=[];if("awaiting"===e&&(e="rejectRecord",a=!0),"delegateRecord"===e&&($("#deleUserName").attr("userId","None"),C=I18n.getMsg("crm.approvalProcess.label.yourCommentsforDelagate")),"canvas"===Lyte.Router.getRouteInstance().routeName&&"form_edit"!==Lyte.Router.getRouteInstance().currentModel.form_type)b=Lyte.Router.getRouteInstance().currentModel.entityDetails;else if("undefined"!=typeof businessCardJson)b=businessCardJson;else if("detail"===Lyte.Router.getRouteInstance().routeName){var w=$L("crm-approvalprocess-detailview")[0];b=void 0!==w?w.component.data.thisObj:void 0}a||"rejectRecord"!==e||void 0===b||"3"!==b.approversNameList.rejectorsType||""===detailView.adminapproval||(h=!1);var _=!1;a||void 0===b||void 0===b.approversNameList?void 0!==detailView.approverbusiinessObj&&(v=void 0!==detailView.approverbusiinessObj?detailView.approverbusiinessObj.approverList:[],f=detailView.approverbusiinessObj.rejectorObj,u=detailView.approverbusiinessObj.currUser,y="2"===detailView.approverbusiinessObj.parllel?"false":"true",detailView.rejectionStage=detailView.approverbusiinessObj.rejectorsType,a=!0,_="rejectRecord"===e?detailView.approverbusiinessObj.rejectActionCC:"approveRecord"===e&&detailView.approverbusiinessObj.approveActionCC):(v=void 0!==b.approversNameList?b.approversNameList.approverList:[],f=b.approversNameList.rejectorObj,u=b.approversNameList.currUser,y="2"===b.approversNameList.parllel?"false":"true",detailView.rejectionStage=b.approversNameList.rejectorsType,_="rejectRecord"===e?b.approversNameList.rejectActionCC:"approveRecord"===e?b.approversNameList.approveActionCC:_);var R=y;if("false"===y&&"3"!==detailView.rejectionStage&&(y="true"),"1"!==detailView.rejectionStage&&"approveRecord"!==e&&"delegateRecord"!==e||(v=[]),"view"===Lyte.Router.getRouteInstance().routeName&&void 0!==detailView.approverbusiinessObj&&(_="rejectRecord"===e?detailView.approverbusiinessObj.rejectActionCC:"approveRecord"===e&&detailView.approverbusiinessObj.approveActionCC),"true"===o&&(_=!0),_){if(a||void 0===b)Lyte.arrayUtils(I,"push",void 0!==i?i:detailView.approverbusiinessObj.recordOwner);else if(Lyte.arrayUtils(I,"push",b.ownerId),"canvas"===Lyte.Router.getRouteInstance().routeName){var L=store.peekRecord(moduleRecordMapping[r].id,b.approversNameList.id);Lyte.arrayUtils(I,"push",void 0!==L?L.Owner.id:b.ownerId)}Lyte.arrayUtils(I,"push",u)}var k=g;k=k.concat(p);var P=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.js"],ResourceConstants.CRMClient),O=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.css"],ResourceConstants.CRMClient);k=(k=(k=k.concat(O)).concat(P)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM)),null!=t&&t.focus();var T,E,S,D=$("#approvalprocessModal").eq(0);void 0!==D&&D.remove();var M=!1;var B=e;if("takeover"===e){T=b.approversNameList.pendingForApprovalStage,E=b.approversNameList.waitingForApproval,S=[];var A=0,U=E.length;for(A=0;A<U;A++){var j=E[A].id;S.push(j)}M=!(!s||1!==s.length)||M,B=M?B:"respond",_=!M&&_}var x=Lyte.Router.getRouteInstance().routeName,F=("edit"===x||"detail"===x||"form_edit"===c)&&b.approversNameList.approveActionCC,N=("edit"===x||"detail"===x||"form_edit"===c)&&b.approversNameList.rejectActionCC;_="respond"===B?F:_,"edit"===Lyte.Router.getRouteInstance().routeName&&0===I.length&&(Lyte.arrayUtils(I,"push",Crm.userDetails.USER_ID),Lyte.arrayUtils(I,"push",b.ownerId),_=M?_:F);var V=$L("crm-approval-process-rejectors");V.length>0&&V[0].remove();var H=[l,d];Lyte.injectResources(k,void 0,(function(){Lyte.Component.render("crm-approval-process-rejectors",{show:!0,approverList:v,userNameLists:f,isRejecorsAvailable:0!==v.length,comment:C,currUser:u+"",mod:r,parllel:y,myJob:a,iscommentSecneeded:h,orginElem:e,response:B,waitingArr:T,adminUsers:"",onlytakeOver:M,parallelCheck:R,checkbox_enabled:_,excludeUsers:I,data:n,approvers:E,approverIds:S,cc_reject:N,cc_approve:F,disableCurrentAndUpcoming:S&&1===S.length,subformPromise:H,fromSource:c,takeoverComments:m},"body");var t=document.getElementById("approvalprocessModal");t.ltProp("offset",{top:"0px",left:"center"}),"edit"===Lyte.Router.getRouteInstance().routeName&&commonUtils.showHideLoadingDiv(!1),"respond"!==e&&"takeover"!==e||t.ltProp("width","600px")}))}function openrejList(e,t,a){var r={},o=[];0!==e.length&&(o=JSON.parse(e));var i=JSON.parse(t);i=i.concat(o),r.parllel="true",r.activeUserList=o,r.fullUserList=i,detailView.approverpop.approversNameList=r,detailView.approverpop.approversNameList.isPortalUser=!0;var n="#approvalStagepop_"+a,s=networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.js"],ResourceConstants.CRMClient);s=s.concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],ResourceConstants.CRMClient)),Lyte.injectResources(s,void 0,(function(){Lyte.Component.render("crm-approval-process-rejectorlistshow",{show:"true",query:n,thisObj:detailView.approverpop,approverList:i,fromdetailview:!1},n)}))}function selectDownUsersForDelagate(){"none"==$("#usersListDiv").css("display")?($("#usersListDiv").css("display","block"),$("#usersListDiv .webformSearch2 input").focus().removeClass("noBg").val(""),10<=$("#allUsers li").length&&($("#usersSearchDiv").show(),$("#usersSearchDiv .webformSearch2 input").focus().removeClass("noBg").val(""))):"block"==$("#usersListDiv").css("display")&&$("#usersListDiv").hide()}function showSelectDownUsersForDelagate(e){$("#app_user").removeClass("focusCss");var t=$(e).attr("uname"),a=$(e).attr("uid");$("#approversTD").attr("approverVal",t),$("#deleUserName").text(t),$("#deleUserName").attr("userId",a),$("#usersListDiv").hide()}function searchUserToDelegate(e){var t=$("#userSearchId").val().trim().toLowerCase(),a=$("#allUsers li");$("#allUsers li").css("display","none");for(var r=0;r<a.length;r++){var o=a[r],i=$(o).find("span").text().toLowerCase();""!=i&&-1==i.indexOf(t)||$(o).css("display","block")}}function showApprovalsAwaitingForOthersFiltered(e,t){var a=getElemById("proOpt");if("module"===e&&null!=a){var r=t.value,o=a.options.length;if("All"===r)for(idx=0;idx<o;idx++){(i=a.options[idx]).style.display=""}else for(a.options[0].selected=!0,idx=0;idx<o;idx++){var i;"All"===(i=a.options[idx]).value||i.getAttribute("modName")===r?i.style.display="":i.style.display="none"}}var n=t.parentNode.classList.contains("filterApplied");"All"==t.value||n?"All"==t.value&&n&&t.parentNode.classList.remove("filterApplied"):(t.parentNode.classList.add("filterApplied"),n=!0);var s=t.getAttribute("view"),l="",d=$L("crm-myjobs")[0];l="true"===s?Crm.getCrmBasePath()+"/approvalProcess.do?action=showOthersAwaitingRecordsFiltered&isOthersView="+t.getAttribute("view"):Crm.getCrmBasePath()+"/approvalProcess.do?action=showAwaitingRecordsFiltered&isOthersView="+t.getAttribute("view"),l+="&modOpt="+getElemById("modOpt").value,l+="&usrOpt="+getElemById("usrOpt").value,l+="&durOpt="+getElemById("durOpt").value,null!=getElemById("proOpt")&&(l+="&proOpt="+getElemById("proOpt").value),null!=getElemById("apprOpt")?l+="&apprOpt="+getElemById("apprOpt").value:l+="&processFilter="+$L("Crm-myjobs")[0].getData().type;var c=d.getData();n&&d.setData("initialIndex",0),"Process"==c.type||"All"==getElemById("usrOpt").value?(l+="&fromIndex="+(c.initialIndex+1),l+="&toIndex="+(c.initialIndex+c.recordPerPage)):(l+="&per_pageCnt="+c.recordPerPage,"Approvals"==c.type&&"All"!=getElemById("usrOpt").value?l+="&pageCnt=1":l+="&pageCnt="+c.page);var m={params:{},headers:{},success_callback:function(e){if(void 0!==e){$("#awtAppRecsDIV").empty(),getElemById("awtAppRecsDIV").innerHTML=e;var t=$L(".myJobsFooter");$L("#noRecordsInThisView").length>0?t.hide():t.show();var a=$L("#filteredCount").val();a>0&&n?(d.setData("totalNumberOfRecords",a),d.setData("page",1)):"Process"==$L("Crm-myjobs")[0].getData().type?d.setData("totalNumberOfRecords",d.getData("jobs_count").process):"true"===s?d.setData("totalNumberOfRecords",d.getData("jobs_count").others_awating):d.setData("totalNumberOfRecords",d.getData("jobs_count").approval)}}};networkUtils.makeRequest(l,"POST",m)}function showSortedColumnDetails(e,t){var a;"dropdownarr"==e.children[0].className?(e.children[0].className="dropdownarr dropdownarr180",a="DES"):(e.children[0].className="dropdownarr",a="ASC");var r="";r="true"===t?Crm.getCrmBasePath()+"/approvalProcess.do?action=showOthersAwaitingRecordsFiltered&isOthersView="+t:Crm.getCrmBasePath()+"/approvalProcess.do?action=showAwaitingRecordsFiltered&isOthersView="+t,r+="&modOpt="+getElemById("modOpt").value,r+="&usrOpt="+getElemById("usrOpt").value,r+="&durOpt="+getElemById("durOpt").value,r+="&sortOrder="+a,r+="&processFilter="+$L("Crm-myjobs")[0].getData().type;var o=$L("crm-myjobs")[0].getData();$L("crm-myjobs")[0].setData("sort_order",a),"Process"==o.type?$L("crm-myjobs")[0].setData("bpSortOrderApplied",!0):$L("crm-myjobs")[0].setData("apSortOrderApplied",!0),"Process"==o.type||"All"==getElemById("usrOpt").value?(r+="&fromIndex="+(o.initialIndex+1),r+="&toIndex="+(o.initialIndex+o.recordPerPage)):(r+="&per_pageCnt="+o.recordPerPage,r+="&pageCnt="+o.page);var i={params:{},headers:{},success_callback:function(e){void 0!==e&&($("#awtAppRecsDIV").empty(),getElemById("awtAppRecsDIV").innerHTML=e)}};networkUtils.makeRequest(r,"POST",i)}function typeText(e){$(e).addClass("noBg")}function emptyLocalStoreRI(e){if($(e).find("span").removeClass("showCircle"),"undefined"!=typeof Storage){localStorage.setItem("recentItemSts",JSON.stringify({recentItem:!0}))}}function toggleRuleList(e){"created"==e?($("#shared").removeClass("selectedItem"),$("#created").addClass("selectedItem"),$("#sharedRulesDiv").hide(),$("#myRulesDiv").show()):($("#created").removeClass("selectedItem"),$("#shared").addClass("selectedItem"),$("#myRulesDiv").hide(),$("#sharedRulesDiv").show())}function pulseRightBoxPostion(){if(document.getElementById("pulseTopContainerTr")){var e=document.documentElement.scrollTop+document.body.scrollTop,t=document.getElementById("basic").offsetHeight,a=document.getElementById("pmrlstact"),r=document.getElementById("pulseRightBoxInnerDiv");if(document.all?cH=document.body.offsetHeight:cH=window.innerHeight,e<140)a.style.top=148-e+"px",a.style.height=cH-198+e+"px",r.style.height=a.offsetHeight-getObj("pulseRightTitleDiv").offsetHeight+"px";else if(e+cH<t)a.style.top="30px",a.style.height=cH-50+"px",r.style.height=a.offsetHeight-getObj("pulseRightTitleDiv").offsetHeight+"px";else{a.style.top="0px";var o=e+cH-t,i=cH-o-15;a.style.height=i+"px",r.style.height=a.offsetHeight-getObj("pulseRightTitleDiv").offsetHeight+"px"}}}selectRange=function(e,t,a){return e.each((function(){if(e[0].setSelectionRange)e.focus(),e[0].setSelectionRange(t,a);else if(e[0].createTextRange){var r=e[0].createTextRange();r.collapse(!0),r.moveEnd("character",a),r.moveStart("character",t),r.select()}}))};var ZBLookUpUtil={searchModuleName:"",zbFromCRMURLType:"",accountID:"",contactID:"",vendorID:""};function submitLookupForm(e,t,a,r,o,i,n){var s=commonUtils.formData2QueryString(e),l=$("input[name='isfromOutlookRightPanel']").length>0,d=$("input[name='needResourceLoad']").length>0;if(l&&d&&$("input[name='needResourceLoad']").val("true"),((s+=a).indexOf("zmail")>0||s.indexOf("zcal")>0)&&(s+="&loadRes=true"),CScriptLib){var c,m={};if(s.split("&").forEach((e=>{var t=e.split("=");m[t[0]]=t[1]})),Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()){const e=$L(`[fld-id=${m.fldId}]`);if(e.length){const{criteria:t}=e[0].component.data.moduledataUicomp;t&&(c=encodeURIComponent(JSON.stringify({criteria:t.criteria,...t.config})))}}else{const e=$("#"+m.fldId).attr("data-criteria");e&&(c=encodeURIComponent(e))}c&&(s+="&filtercriteria="+c)}n&&(s+="&fromAutDealCreate=true");var u=document.querySelector("#servicesDiv");return u&&u.ltProp("selected")&&(s+="&serviceStatusFilter="+u.ltProp("selected")),!0===o&&(s+="&luceneSearch=true&searchcriteria="+i),r&&"true"==r?commonUtils.openCustomLookup(e.action,s,t,void 0,void 0,void 0,void 0,r):commonUtils.openCustomLookup(e.action,s,t),!1}function showImagePreview(e){var t=e.id;if(0==$("img#previewImg_"+t).length){var a='<img id="previewImg_'+t+'" src="'+e.href+'" style="max-width: 100px;max-height: 1px;">';$(e).append(a),$("[name=cboxElement]").colorbox({rel:"photonavigation",preloading:!1,photo:!0}),$(document).bind("cbox_closed",(function(){$(document).unbind("cbox_complete"),$(document).unbind("cbox_closed")})),$(document).bind("cbox_complete",(function(){var e=$(".cboxPhoto")[0];void 0!==e&&"from-image"!==getComputedStyle(e).imageOrientation&&""===e.style.transform&&(e.style.display="none",Lyte.injectResources([networkUtils.returnDependencyFiles(["exif-plugin.js"],ResourceConstants.CRMClient)],void 0,function(){$L.exif({target:e,getData:function(t){if(void 0!==t.exifdata&&void 0!==t.exifdata.Orientation)switch(t.exifdata.Orientation){case 6:e.style.transform="rotate(90deg)";break;case 8:e.style.transform="rotate(270deg)";break;case 3:e.style.transform="rotate(180deg)"}e.style.display=""}})}.bind(this)))}))}}function hideFeedBackPopup(){$("#feedBackPopup").slideUp(),$("#feedbackicon").removeClass("feedbackiconActive").addClass("feedbackicon")}ZBLookUpUtil.contactZBAndLoadCreatePage=function(e,t){var a=Crm.getCrmBasePath()+"/connectzb",r={entityType:window.opener.ZBLookUpUtil.zbFromCRMURLType,formatType:"json",module:window.opener.ZBLookUpUtil.searchModuleName,crmEntityId:t};4==window.opener.ZBLookUpUtil.zbFromCRMURLType&&(a=Crm.getCrmBasePath()+"/connectzs",r={actionNumber:window.opener.ZBLookUpUtil.zbFromCRMURLType,formatType:"json",crmModule:window.opener.ZBLookUpUtil.searchModuleName,crmEntityID:t}),"Vendors"===r.module?window.opener.ZBLookUpUtil.vendorID=t:"Accounts"===r.module?(window.opener.ZBLookUpUtil.accountID=t,window.opener.ZBLookUpUtil.contactID="",window.opener.ZInvoice.potentialLinkingObj.accountID=t,window.opener.ZInvoice.potentialLinkingObj.contactID=""):(window.opener.ZBLookUpUtil.contactID=t,window.opener.ZBLookUpUtil.accountID="",window.opener.ZInvoice.potentialLinkingObj.accountID="",window.opener.ZInvoice.potentialLinkingObj.contactID=t),jQuery.ajax({url:a,data:r,type:"POST"}).done((function(e){var t=JSON.parse(e);0!=t.code?window.opener.ZInvoice.showMessage(t.message):window.opener.$("#zBooksIframe")[0].contentWindow.InvoiceUtil.updateFieldsInEntityCreatePage(t,r.entityType);window.self.close()}))},ZBLookUpUtil.selectPotential=function(e,t){window.opener.$("#zBooksIframe")[0].contentWindow.InvoiceUtil.updatePotentialInEntityCreatePage(e,t),window.self.close()};var wfBG={setBGClr:function(){$("#subTabBottomDiv").addClass("setBgClr"),$("#setup_new_ContentDiv").addClass("workflow_rule"),$("#setupshow").addClass("newSetupWorkflow")},setWhiteBG:function(){$("#subTabBottomDiv").removeClass("setBgClr"),$("#setup_new_ContentDiv").removeClass("workflow_rule"),$("#setupshow").removeClass("newSetupWorkflow")}};function orgemailToolTip(e,t){if(""!=(e=$(e)).siblings(".templateFromAddress").text().trim()&&"null"!=e.siblings(".templateFromAddress").text()&&"undefined"!=e.siblings(".templateFromAddress").text()){var a,r="";""!=e.siblings(".templateReplyAddress").text()&&"null"!=e.siblings(".templateReplyAddress").text()&&"undefined"!=e.siblings(".templateReplyAddress").text()&&null!=e.siblings(".templateReplyAddress").text()&&null!=e.siblings(".templateReplyAddress").text()&&(r=e.siblings(".templateReplyAddress").text()),""!=r?(a='<div class="crm-font-bold crm-base-font-size">'+I18n.getMsg("crm.template.from.tooltip.sender")+'</div><div class="pR mT5"><table cellspacing="0" cellpadding="3"><tr><td class="alignRight crmNotFoundColor crm-base-font-size crm-font-regular vaM">'+I18n.getMsg("crm.label.from")+' :</td><td class="vaM orgemailfromID crm-base-font-size crm-font-regular"><a  class="emailIdToolTip" style="color:var(--linkColor);">'+$ESAPI.encoder().encodeForHTML(e.siblings(".templateFromAddress").text())+"</a></td></tr>",a+='<tr><td class="vaM alignRight crmNotFoundColor crm-base-font-size crm-font-regular wsNowrap">'+I18n.getMsg("crm.label.reply.to")+' :</td><td class="vaM orgemailfromID crm-base-font-size crm-font-regular"><a  class="emailIdToolTip" style="color:var(--linkColor);">'+$ESAPI.encoder().encodeForHTML(r)+"</a></td></tr>"):a='<div class="crm-font-bold crm-base-font-size">'+I18n.getMsg("crm.template.from.tooltip.sender")+'</div><div class="pR mT5"><table  cellspacing="0" cellpadding="3"><tr><td class="crmNotFoundColor crm-base-font-size crm-font-regular vaM wsNowrap">'+I18n.getMsg("crm.label.from")+' :</td><td class="vaM orgemailfromID crm-base-font-size crm-font-regular"><a  class="emailIdToolTip" style="color:var(--linkColor);">'+$ESAPI.encoder().encodeForHTML(e.siblings(".templateFromAddress").text())+"</a></td></tr><table>",a+='</table><div class="orgToolTipTriangle pA"></div><div class="org_InnerTriangle pA"></div></div>',0==$(".orgToolTipContainer").length&&$("body").append("<div class='orgToolTipContainer br3 p20 dIB pA zi32'></div>"),$(".orgToolTipContainer").html(a);var o=$(e).offset().top,i=$(".orgToolTipContainer").outerHeight(),n=($(".orgToolTipContainer").outerWidth(),o-i),s=$(e).offset().left;$(".orgToolTipContainer").css({left:s-16,top:n-10}),1==t&&($(".orgToolTipContainer").show(),template.titleForEllipsis(".orgemailfromID a")),0==t&&setTimeout((function(){$(".orgToolTipContainer").hide()}),150),template.titleForEllipsis(".emailIdToolTip")}}function deleteCompanyLogo(){var e=Crm.getCrmBasePath()+"/OrgConfig.do?actionName=delOrgImg",t=csrfParamName+"="+encodeURIComponent(csrfToken),a=new crmRequestPool;return commonUtils.showHideLoadingDiv(!0),a.initiate({action:e+"&ajaxload=true",data:t,success:function(e){commonUtils.showHideLoadingDiv(),hideAnimatePopup("deletepopup");var t=getElemById("companyLogo");t&&(t.setAttribute("src",networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM)),t.style.width="75",$("#helpdesk").hasClass("cobclicked")||$(t).parent("div").addClass("companylogocontainer"),$("#changeDiv").hide(),$("#uploadDiv").show())}}),!1}function setCurrencySymbol(e,t,a){var r,o=Crm.currencyFields[e];r=window[e].currencyDetails&&Object.keys(window[e].currencyDetails).length>0&&window[e].defaultCurrency?window[e].currencyDetails[window[e].defaultCurrency].symbol:Crm.userDetails.defaultOrgCurrency?Crm.userDetails.defaultOrgCurrency:"",a&&(r=detailView.currencyDetails[a].symbol);for(var i=o.length,n=0;n<i;n++){var s=t.find("#currencySymbol_"+o[n]);s[0]&&($(s[0]).empty(),$(s[0]).hasClass("sfHeaderCurrency")?s[0].innerHTML="("+r+")":s[0].innerHTML=r+"&nbsp;")}}function refreshPageForBulkWorkFlowScheduler(e){isWFExecuted=!0;var t=e.ruleType,a=e.isJobCompleted,r=e.isPageRefreshingNeeded,o=void 0,i=void 0,n=(o=void 0,Lyte.Router.getRouteInstance().transition.info),s=$L("crm-change-owner");if(!(!s[0]||!s.find("lyte-modal")[0].getData("ltPropShow")||"entity"!==Lyte.Router.getRouteInstance().parent.routeName||"canvas"!==Lyte.Router.getRouteInstance().routeName))detailView.callLyteRefresh();else{if("crm.tab.module.actions.mass-tools"==n.route){var l=Lyte.Router.getRouteInstance().transition;o=l.info.queryParams.type,i=l.info.dynamicParams[0]}else n.route.startsWith("crm.tab.module")||"crm.tab.module.custom-view.list"==n.route?i=n.dynamicParams[0]:"crm.tab.forecasts.pipeline"==n.route?i="Forecasts":n.route.startsWith("crm.settings.section.compliance.consent-dashboard.list-view")&&(i=n.queryParams.module);if(null!=i&&(t==i||"Forecasts"==i)||!a||r||n.route.startsWith("crm.settings.section.compliance.consent-dashboard")){var d=I18n.getMsg("crm.massupdate.updatedsuccesfully");if((n.route.startsWith("crm.tab.module")||"crm.tab.forecasts.pipeline"==n.route||n.route.startsWith("crm.settings.section.compliance.consent-dashboard"))&&"crm.tab.module.actions.mass-tools"!=n.route){var c=!1,m=!1;crmListView.checkAll(),showHideListViewBtnFn(),commonUtils.showHideLoadingDiv(!1);var u=$L("crm-macro-execute");if($("#bulkUpdateFldsListForScheduler.zcrm-show").length>0)hideAnimatePopup("bulkUpdateFldsListForScheduler",!0);else if($("#topBandPopup.zcrm-show").length>0)hideAnimatePopup("topBandPopup",!0);else if($("#addTagsDiv.showPpTop").length>0)c=!0,(m=crmListView.addTagsPopupMsg(e.tagSuccessCount,e.recordsSize,customViewObject.tagRecordLimit))||(d=I18n.getMsg("crm.tags.list.view.added.successfully")),crmui.hidePopup("addTagsDiv");else if($("#removeTagsDiv.showPpTop").length>0)c=!0,d=I18n.getMsg("crm.tags.removed.successfully"),crmui.hidePopup("removeTagsDiv");else if(u.length>0){var p=u[0];crmTab.deleteFromCache(i),setTimeout((function(){crmListView.reloadCurrentListView(),p.remove()}),4500)}else $("#updateConsenttype").length>0?(c=!0,crmui.hidePopup("updateConsenttype")):r&&(c=!0);c&&(renderingUtils.removeFreezeLayer(),m?crmui.showPop("maximumReach"):(a||r)&&crmui.showMsgBand("success",d,"4000",""),n.route.startsWith("crm.settings.section.compliance.consent-dashboard")?ConsentLawBasisUpdates.afterchangeToggle(!0):crmListView.reloadCurrentListView())}else if("update"==o){if($("#bulkUpdate_display").length>0){(a||r)&&($("#bulkUpdateSuccess").empty().html(d),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),2e3));var g=$L("crm-field-update")[0];g&&g.component.setData("showModal",!1);var v=$L("crm-mass-tools")[0].component;v.fetchRecords(void 0,void 0,void 0,!0).then((function(){v.setData("showActionBtn",!1)})),hide("bulkUpdate_display")}}else"transfer"!=o&&"mass_transfer"!=o||(callMassRecords(1,10,"mass_transfer"),commonUtils.showHideLoadingDiv(!1))}}}function help_handling(e,t){e=e.crm_data_fetcher;var a=renderingUtils.createHTML({name:"div",attr:{class:"botHelpQuesContainer paddingNeeded"}});if(a.setAttribute("data-zcqa","help element"),0!==e.details.data.summary.localeCompare("I cannot find the exact answer for this question but hope the below articles helps")&&e.details.data.articles){var r=renderingUtils.createHTML({name:"a",attr:{class:"botHelpMessageTitle  mB",href:e.details.data.articles[0].url,target:"_blank')"}});$(r).html(e.details.data.articles[0].title),$(r).attr("data-zcqa","help link element"),$(a).html(r),e.details.data.articles.shift()}var o,i,n,s=renderingUtils.createHTML({name:"div",attr:{class:"botHelpMessageDiv mT5"}});if($(s).attr("data-zcqa","help message"),$(s).html(e.details.data.summary),$(a).append(s),e.details.data.articles&&e.details.data.articles.length>0){o=renderingUtils.createHTML({name:"div",attr:{class:"botRelatedLinkcontainer mT15 mB10"}}),0!==e.details.data.summary.localeCompare("I cannot find the exact answer for this question but hope the below articles helps")&&(i=renderingUtils.createHTML({name:"div",attr:{class:"crm-font-bold crmBaseColor mB5 crm-base-font-size"}}),$(i).text("Related Articles"),$(i).attr("data-zcqa","related title")),$(o).append(i);for(var l=e.details.data.articles.length,d=0;d<l;d++)void 0!==e.details.data.articles[d].url&&(n=renderingUtils.createHTML({name:"a",attr:{class:"crm-font-regular  mB2 diBulletOption pL10 cP crm-base-font-size dIB",href:e.details.data.articles[d].url,target:"_blank",title:e.details.data.articles[d].url}}),$(n).html(e.details.data.articles[d].title),$(n).attr("data-zcqa","related-article"+d),$(o).append(n))}$(a).append(o),t.html(a).hide().slideDown(200)}function ziaRenderResult(e,t,a,r,o,i,n){ziaRenderResultWithTitle(e,t,a,r,o,i,n,null)}function ziaRenderResultWithTitle(e,t,a,r,o,i,n,s){var l;if(n&&(l=$L(n).parents("crm-intelligence-config-result")[0].component),e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&(e.crm_data_fetcher.details.data.showSetRoutineMsg=!0,(e.crm_data_fetcher.details&&e.crm_data_fetcher.details.di_data&&("search"===e.crm_data_fetcher.details.di_data.query_type||"help"===e.crm_data_fetcher.details.di_data.query_type)||e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&("suggestions"===e.crm_data_fetcher.details.data.output_format||"help_content"===e.crm_data_fetcher.details.data.output_format))&&(e.crm_data_fetcher.details.data.showSetRoutineMsg=!1)),e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"suggestions"===e.crm_data_fetcher.details.data.output_format)t.html('<div style="padding:8px 13px;border-bottom:1px solid #eaeaea;">Here are some suggestions</div>'),askZia.showSuggestions(e.crm_data_fetcher.details.data.input_sentence,e.crm_data_fetcher.details.data.suggestions,t);else if(e&&(e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"no_content"===e.crm_data_fetcher.details.data.output_format||e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&0===Object.keys(e.crm_data_fetcher.details.data).length)){if(s){var d=renderingUtils.createHTML({name:"div"}),c=renderingUtils.createHTML({name:"div",attr:{class:"crm-font-bold crmBaseColor alignLeft mB10"},text:s}),m=renderingUtils.createHTML({name:"div",attr:{class:"crm-font-regular crmLabelColor alignLeft mB5"},text:"There aren't any results for that search"});d.append(c),d.append(m)}else d=renderingUtils.createHTML({name:"div",attr:{class:"crm-font-regular crmLabelColor alignLeft paddingNeeded"},text:"There aren't any results for that search"});t.html(d).hide().slideDown(200)}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&e.crm_data_fetcher.details.data.rows&&0!==e.crm_data_fetcher.details.data.rows.length){var u=e.crm_data_fetcher.details.data,p=u.rows,g=e.crm_data_fetcher.details.display_type;g=0===g.indexOf("chart")?"pie":g.replace(" chart",""),e.crm_data_fetcher.details&&e.crm_data_fetcher.details.summary&&(e.crm_data_fetcher.details.summary.showSetRoutineMsg=e.crm_data_fetcher.details.data.showSetRoutineMsg);var v=JSON.stringify(e.crm_data_fetcher.details.summary);if(t.attr("summary",v),e.crm_data_fetcher.details.data.rows.length>=11?(e.crm_data_fetcher.details.data.rows.pop(),e.crm_data_fetcher.details.data.showmore=!0,e.crm_data_fetcher.details.data.start_index=i?i+10:11):e.crm_data_fetcher.details.data.showmore=!1,e.crm_data_fetcher.details.data.groupby_used){var f=u.columns[0].display_value,h=u.columns[1].display_value,y=(I=p.length)<=1?"":renderingUtils.createHTML({name:"div",attr:{class:"botChooseOptionDiv"},child:[{name:"div",attr:{class:"fL chatboticcontainer",onclick:"askZia.replaceChart($(this),'bar');sE(event);"},child:[{name:"div",attr:{class:"vertical-chart"}}]},{name:"div",attr:{class:"fL chatboticcontainer",onclick:"askZia.replaceChart($(this),'pie');sE(event);"},child:[{name:"div",attr:{class:"pie-chart"}}]},{name:"div",attr:{class:"fL chatboticcontainer",onclick:"askZia.replaceChart($(this),'funnel');sE(event);"},child:[{name:"div",attr:{class:"funnel-chart"}}]},{name:"div",attr:{class:"fL chatboticcontainer",onclick:"askZia.replaceChart($(this),'line');sE(event);"},child:[{name:"div",attr:{class:"line-chart"}}]},{name:"div",attr:{class:"fL chatboticcontainer disablechatbtn",onclick:"askZia.replaceChart($(this),'table');sE(event);"},child:[{name:"div",attr:{class:"table-view"},content:"T"}]}]});if(n){for(var b=n.closest(".botSentText"),C=JSON.parse(b.getAttribute("data-chartjson")),I=e.crm_data_fetcher.details.data.rows.length,w=0;w<I;w++)C.rows.push(e.crm_data_fetcher.details.data.rows[w]);C.showmore=e.crm_data_fetcher.details.data.showmore,b.setAttribute("data-chartjson",JSON.stringify(C))}else t.attr("data-chartjson",JSON.stringify(e.crm_data_fetcher.details.data));t.attr({"data-xaxis":f,"data-message":e.crm_data_fetcher.details.data.text,"data-yaxis":h,chartType:g,chartName:e.crm_data_fetcher.details.name}).addClass("cP")}if(e.crm_data_fetcher.details.data.groupby_used&&e.crm_data_fetcher.details.display_type.includes("chart"))t.attr({onclick:"askZia.showChartinPop(this)"}).html(renderingUtils.createHTML({name:"div",attr:{class:"fR w100_per cP pT30 pB30 pL20 pR20 chartDivCont",style:"max-width:calc(430px - 110px);box-sizing:border-box;background-color: var(--bg_white)",id:"chartDivCont"}})).append(y),t.find(".chartDivCont").html(renderingUtils.createHTML({name:"div",attr:{class:"fR  cP chartDiv",style:"width:calc(430px - 150px)",id:"chartDiv"}})),askZia.createChart(e.crm_data_fetcher.details.data,t.find(".chartDiv"),g,f,h,e.crm_data_fetcher.details.name),t.addClass("noPaddingBotText");else if(t.attr("onclick","sE()"),(!e.crm_data_fetcher.details.data.groupby_used&&e.crm_data_fetcher.details.data.aggregation_used||!i)&&(e.crm_data_fetcher.details.data.pathway=!!v,e.crm_data_fetcher.details.data.showSetRoutineMsg=e.crm_data_fetcher.details.data.pathway,(S=document.createElement("crm-intelligence-config-result")).setData({result:e.crm_data_fetcher.details.data})),!e.crm_data_fetcher.details.data.groupby_used&&e.crm_data_fetcher.details.data.aggregation_used){e.crm_data_fetcher.details.output_sentence&&null===s?(t.html(renderingUtils.createHTML({name:"div",attr:{class:"headLineHint",id:"chatBotDiv"},text:"Showing results for "+e.crm_data_fetcher.details.output_sentence})),t.append(S)):s?(t.append(renderingUtils.createHTML({name:"div",attr:{class:"crm-font-bold crmBaseColor alignLeft mB10"},text:s})),t.html(S)):t.html(S),t.find(".chatbotTableParentDiv").addClass("kbiborder");var _=t.find(".IntelligenceConfigResultTable");_.removeClass("newtable w100_per"),_.find("td").addClass("aligncenter crm-base-font-size crmBaseColor").css({"font-family":"roboto"}),_.find("th").addClass("aligncenter crm-font-regular crm-base-font-size crmBaseColor pB5"),t.addClass("cD").removeClass("cP")}else{i?l.methods.appendMoreData(e.crm_data_fetcher.details.data,l,n):(e.crm_data_fetcher.details.data.pathway=!!v,e.crm_data_fetcher.details.data.showSetRoutineMsg=e.crm_data_fetcher.details.data.pathway,e.crm_data_fetcher.details.output_sentence&&null===s?(t.append(renderingUtils.createHTML({name:"div",attr:{class:"headLineHint",id:"chatBotDiv"},text:"Showing results for "+e.crm_data_fetcher.details.output_sentence})),t.append(S)):s?(t.append(renderingUtils.createHTML({name:"div",attr:{class:"crm-font-bold crmBaseColor alignLeft mB10"},text:s})),t.html(S)):t.html(S)),t.append(y).hide().slideDown(200).addClass("noPaddingBotText");var R=t.find(".IntelligenceConfigResultTable").find("th"),L=100/R.length;R.css({width:L}),t.addClass("cD").removeClass("cP")}}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&e.crm_data_fetcher.details.data.result&&0!==e.crm_data_fetcher.details.data.result.length&&"gsearch"===e.crm_data_fetcher.details.data.type){var k=document.createElement("crm-search-result");e.crm_data_fetcher.details.data.result.message=e.crm_data_fetcher.details.message,k.setData({result:e.crm_data_fetcher.details.data.result}),t.attr("data-chartjson",JSON.stringify(e.crm_data_fetcher.details.data.result)).html(k).hide().addClass("noPaddingBotText cD");var P=renderingUtils.createHTML({name:"div",attr:{class:"alignCenter mB10 mT10 chatbotSecLoad crmLinkColor cP",onclick:"askZia.loadDetailContent(this)"}});t.find(".chatbotsearchResultContainer").append(P),t.find(".chatbotSecLoad").text("View detail"),t.slideDown(200);JSON.parse(t.attr("data-chartjson"))}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&e.crm_data_fetcher.details.data.result&&0!==e.crm_data_fetcher.details.data.result.length&&"module_gsearch"===e.crm_data_fetcher.details.data.type){(k=document.createElement("crm-search-result")).setData({result:e.crm_data_fetcher.details.data.result}),t.html(k).addClass("noPaddingBotText cD")}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"pre_defined"===e.crm_data_fetcher.details.data.type){if(e.crm_data_fetcher.details.data.other_modules){var O=e.crm_data_fetcher.details.data.result.moduleData,T=!1;if(O)Object.values(O).forEach((function(e){e.length>5&&!T&&(T=!0)}));e.crm_data_fetcher.details.data.result.showViewDetail=T,e.crm_data_fetcher.details.data.result.flag=1;var E="#"+t[0].id;k=Lyte.Component.render("crm-search-result",{result:e.crm_data_fetcher.details.data.result,otherModules:e.crm_data_fetcher.details.data.result,isSingleReport:e.crm_data_fetcher.details.data.single_report,message:e.crm_data_fetcher.details.message},E);t.addClass("noPaddingBotText cD"),t.find(".individualRenderList").show()}else{var S,D=$(".dbImg").length+1;e.crm_data_fetcher.details.data.id=D,s&&(e.crm_data_fetcher.details.data.name="",t.append(renderingUtils.createHTML({name:"div",attr:{class:"crm-font-bold crmBaseColor alignLeft mB10"},text:s}))),(S=document.createElement("crm-intelligence-config-result")).setData({result:e.crm_data_fetcher.details.data}),t.html(S),networkUtils.loadFeatureScripts(["zohocrm_analytics.js",networkUtils.getI18nJSUrl("dashboard")],(function(){CrmAnalytics.initChart();var t=e.crm_data_fetcher.details.data.component_type;t=e.crm_data_fetcher.details.data.component_props&&e.crm_data_fetcher.details.data.component_props.visualization_props.type?t+"_"+e.crm_data_fetcher.details.data.component_props.visualization_props.type:t;var a="dbImg_"+D;$("#"+a).append('<div class="dashboardContent dash_chart" id="chartdiv_'+a+'" style="height:calc(100% - 23px);"><div class="h100_per pR w100_per"><span class="absCenter"></span></div></div>'),CrmAnalytics.setMinMaxDimensions(t,a),CrmAnalytics.renderComponent(e.crm_data_fetcher.details.data,a)}),"undefined"!=typeof CrmAnalytics);var M=document.querySelectorAll("#chartdiv_dbImg_"+D);$(M[1]).remove();var B=$(M[0]);B.css({"margin-top":"20px"}),"kpi"===e.crm_data_fetcher.details.data.component_type?B.css({height:"auto"}):B.css({height:"210px"});var A=B.find(".d3container")[0];void 0!==A&&(A.__data__.userdata.tooltip.enabled=!1,A.__data__.redraw())}t.hide().slideDown(200)}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"report"==e.crm_data_fetcher.details.data.type){var U=e.crm_data_fetcher.details.data,j=renderingUtils.createHTML({name:"div",attr:{class:"fR crm-base-font-size crm-font-regular crmBaseColor paddingNeeded"}}),x=renderingUtils.createHTML({name:"img",attr:{src:U.url,style:"height:100px;width:100px",alt:"no data available"}}),F=renderingUtils.createHTML({name:"a",attr:{href:U.crmUrl},text:"open report page"});j.append(x),j.append(F),t.append(j)}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"all_modules"==e.crm_data_fetcher.details.data.type){var N=0;Object.keys(e.crm_data_fetcher.details.data).forEach((function(a){var r=e.crm_data_fetcher.details.data[a];if(r instanceof Object){if(r.type="all_modules",r.moduleName=crmTab.getDisplayName("Potentials"),N)l.methods.appendMoreData(r,l,n);else{var o=document.createElement("crm-intelligence-config-result");o.setData({result:r}),t.html(o)}N++}}))}else if(e&&e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"help_content"===e.crm_data_fetcher.details.data.output_format)help_handling(e,t);else{if(!(e.crm_data_fetcher&&e.crm_data_fetcher.details&&e.crm_data_fetcher.details.data&&"message_from_DI"===e.crm_data_fetcher.details.data.output_format)){if(void 0===askZia.firstMessage||!0===o){o||(askZia.firstMessage=askZia.message);var V=e.notify?"alignCenter":"fR";d=renderingUtils.createHTML({name:"div",attr:{class:"paddingNeeded crm-base-font-size crm-font-regular crmBaseColor "+V},text:"There aren't any results for that search"});t.html(d).hide().slideDown(200)}else askZia.secondMessage=askZia.message,t.append(askZia.createSupportOptionElement());return}var d=renderingUtils.createHTML({name:"div",attr:{class:"crm-base-font-size crm-font-regular crmBaseColor paddingNeeded fR"},text:e.crm_data_fetcher.details.data.message});t.html(d).hide().slideDown(200)}o||void 0!==askZia&&(askZia.firstMessage=void 0)}function isWFSchedulerUser(){return Crm.userDetails.isWFSchedulerUser}function isWFKafkaUser(){return Crm.userDetails.isWFKafkaUser}$("body").click((function(){$(".feedFilterlist").fadeOut(),$(".svalue").parent().removeClass("dropdownActive, feedfilterfocus")})),$(".feedfiltercontent").click((function(e){e.stopPropagation()}));