Lyte.Component.register("crm-emailconversation-view",{_template:'<template tag-name="crm-emailconversation-view"> <lyte-modal id="edvModalConversation" lt-prop-height="100%" lt-prop-wrapper-class="edvModal {{if(isNextGenUIEnabled,&quot;edvModalLeftMnu&quot;,&quot;&quot;)}}" lt-prop-allow-multiple="true" lt-prop-transition="{{modalTransition}}" lt-prop-offset="{{modalOffset}}" lt-prop-width="calc(100vw - 10%)" lt-prop-show-close-button="false" lt-prop-freeze="false" lt-prop-show="{{showModal}}" on-before-show="{{method(\'alignModal\')}}" lt-prop-close-on-escape="{{onEscapeClose(mailSource)}}" on-show="{{method(&quot;aferModalRendered&quot;)}}" on-close="{{method(\'closeModal\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="edvModalHeader pT20 pB20 flexAlignStart spaceBetween bg_white"> <div class="flexAlignStart mR50"> <div class="crm-heading-font-size edvHeading edvSubjectHeader crm-font-bold"><lyte-text class="edvSubject" lt-prop-value="{{lbind(subjectText)}}"></lyte-text></div> <template is="if" value="{{showMailCount(conversationList)}}"><template case="true"><div class=" mT3 edvMailCounter mL10 crm-small-font-size edvBlack crm-font-medium">{{conversationList.length}}</div></template></template> <span class="hide" id="email_attachments"></span> </div> <div class="dF aiCenter mT3 "> <span class="dIB crmcssBaseIcon zcicn-arrow-line-left-lg cP edvPrevMail {{handleNav(prevNextDisabled,prevDisabled,nextDisabled,this,true)}}" onclick="{{action(\'previousMail\',this)}}" data-zcqa="edv_previous_mail"></span> <span class="edvNextMail dIB crmcssBaseIcon zcicn-arrow-line-right-lg cP mL20 mT1 {{handleNav(prevNextDisabled,prevDisabled,nextDisabled,this)}}" onclick="{{action(\'nextMail\',this)}}" data-zcqa="edv_next_mail"></span> <crmutil-icon class="edvCloseBtn cP mL25" icon-name="close-9" icon-class="zcicn-close-9 crmBaseIcon zcicn16" onclick="{{action(\'closeThreadView\')}}" data-zcqa="edv_close_mail"></crmutil-icon> </div> </lyte-modal-header> <lyte-modal-content class="edvModalContent dF flexDC oH p15"> <div class="edvMailContainer bg_white oA "> <lyte-accordion class="edvMailAccordion" lt-prop-duration="0.2s" lt-prop-dynamic="true" lt-prop-exclusive="false" on-before-open="{{method(\'showMailContent\')}}" on-before-close="{{method(\'beforeCloseMailContent\')}}" on-close="{{method(\'onCloseMailContent\')}}"> <template is="registerYield" yield-name="yield"> <template is="for" items="{{conversationList}}" item="conversation" index="index"> <lyte-accordion-item class="edvBbColor {{addClassForIndex(mailArray[index].content)}}" data-index="{{index}}"> <lyte-accordion-header class="edvThreadContainer" id="edvContainer_{{conversation.message_id}}" data-index="{{index}}"> <div class="dF"> <template is="if" value="{{expHandlers(mailSource,\'!==\',\'mailMagnet\')}}"><template case="true"><div class="mT2 dF mR10"> <crmutil-icon icon-name="{{getMailStatusIconName(conversation,mailSource)}}" icon-class="{{getMailStatusIconClass(conversation,mailSource)}}"></crmutil-icon> </div></template></template> <div class="dF spaceBetween edvHeader flexDC"> <div class="dF spaceBetween "> <div class="dF aiCenter "> <span class="openMail"></span> <template is="if" value="{{expHandlers(mailSource,\'===\',\'mailMagnet\')}}"><template case="true"><span class="crm-base-font-size edvBlack mR10 etViewRecipientName" onclick="{{action(\'showContactCard\')}}" data-zcqa="edv_show_contactcard_{{conversation.subject}}_{{conversation.message_id}}"> <lyte-text class="maxW250 crmEllipticText cP" lt-prop-value="{{getUserNameOrEmail(conversation,moduleInfo,mailSource)}}"></lyte-text></span></template><template case="false"><span class="crm-base-font-size edvBlack mR10"> <lyte-text class="maxW250 crmEllipticText" lt-prop-value="{{getDisplayNameOrEmail(conversation.from.user_name,conversation.from.email)}}"></lyte-text></span></template></template> <template is="if" value="{{hasSentiment(conversation)}}"><template case="true"><crmutil-icon class="mR11" icon-name="{{getSentimentIconUtilName(conversation.sentiment_info)}}" icon-class="{{getSentimentIconUtilClass(conversation.sentiment_info)}}"></crmutil-icon></template><template case="false"><template is="if" value="{{expHandlers(conversation.sentiment_info,\'&amp;&amp;\',expHandlers(conversation.sentiment_info,\'!==\',\'Neutral\'))}}"><template case="true"><crmutil-icon class="mR10" icon-name="frustration" icon-class="zcicn-frustration zcicn-red-bg-filled" data-value="CNS" name="sentimenticon_{{conversation.message_id}}" data-zcqa="CNS_{{conversation.message_id}}"></crmutil-icon></template></template></template></template> <template is="if" value="{{hasEmotion(conversation)}}"><template case="true"><span class="{{getEmotionIcon(conversation.emotion)}} edvBlack crm-base-font-size mR10" lt-prop-title="{{getTranslatedEmotionValue(conversation.emotion)}}">{{getTranslatedEmotionValue(conversation.emotion)}}</span></template></template> <template is="if" value="{{hasIntent(conversation)}}"><template case="true"><span class="edvIntent edvBlack crm-base-font-size" lt-prop-title="{{getTranslatedIntentValue(conversation.intent,true)}}" lt-prop-tooltip-config=" { &quot;position&quot; : &quot;top&quot; , &quot;appearance&quot; : &quot;box&quot; , &quot;margin&quot; : 0 , &quot;showdelay&quot; : 0 , &quot;hidedelay&quot; : 0 , &quot;maxdisplaytime&quot; : 5000 } ">{{getTranslatedIntentValue(conversation.intent)}}</span></template></template> <div class="dF edvContentInfo"> <template is="if" value="{{expHandlers(dealData.hasDealLinking,\'&amp;&amp;\',hasKey(dealArray[index],\'name\'))}}"><template case="true"><div class="vaM crm-base-font-size dIF aiCenter crm-font-regular mL2"> <span class="edvLinkKey vaM">{{getI18n(\'crm.relatedList.deals.linkeddeal\',getDealTranslatedSingularLabel())}}:</span> <span class="edvBlue mL2 cP edvDealName vaM mB3 edvDealTextContainer edvPreventAccordion" id="edvDealHeader_{{conversation.message_id}}" onmouseover="{{action(\'showContactCard\',true,index,true)}}" onmouseout="{{action(\'closeContactCard\',true,index)}}" data-zcqa="edv_show_dealpopover_header_{{conversation.subject}}_{{conversation.message_id}}"> <a target="_blank" data-params="{&quot;module&quot;:&quot;Potentials&quot;,&quot;id&quot;:&quot;{{dealArray[index].id}}&quot;}" onclick="{{action(\'checkForPublicFields\',event,this)}}" rel="noopener noreferrer" href="{{getDealLink(dealArray[index].id)}}" data-zcqa="edv_open_deal_header_{{conversation.subject}}_{{conversation.message_id}}"><lyte-text class="vaM edvDealTextContainer" lt-prop-value="{{dealArray[index].name}}" lyte-hovercard="true"> </lyte-text></a> </span> <template is="if" value="{{hasEmailWritePermission(conversation.sharing_permission)}}"><template case="true"><div class=" mL5 edvShowDealOption dIF cP aiCenter edvDealTextContainer edvPreventAccordion" onclick="{{action(\'dealOptionsClicked\',this,index)}}" data-zcqa="edv_open_deal_options_header_{{conversation.subject}}_{{conversation.message_id}}"> <crmutil-icon class="cP edvDealTextContainer edvPreventAccordion" icon-name="more-hr" icon-class="zcicn-more-hr crmBaseIcon "></crmutil-icon> </div></template></template> </div></template></template> </div> </div> <div class="dF aiCenter "> <template is="if" value="{{expHandlers(expHandlers(conversation.has_attachment,\'||\',conversation.has_attachments),\'||\',conversation.hasAttach)}}"><template case="true"><crmutil-icon icon-name="attachment" class="mR10" icon-class="zcicn-attachment crmBaseIcon "></crmutil-icon></template></template> <span class="edvBlack crm-small-font-size">{{getEdvDateNTime(expHandlers(conversation.date_time,\'?:\',conversation.date_time,conversation.sent_time))}}</span> </div> <template is="if" value="{{showAssoPotentialId(conversation)}}"><template case="true"><input type="hidden" id="assoPotential_{{conversation.message_id}}" data-id="{{conversation.linked_deal[&quot;id&quot;]}}" value="{{conversation.linked_deal[\'name\']}}"></template></template> </div> <div class="edvBlack dF spaceBetween"> <template is="if" value="{{conversation.snippet}}"><template case="true"><div class="edvContentInfo crm-base-font-size pT5 edvConvSummary "><lyte-text lt-prop-value="{{conversation.snippet}}" lt-prop-show="false"></lyte-text></div></template></template> <div class="crm-base-font-size edvSenderInfo hide vaM"> <template is="if" value="{{expHandlers(expHandlers(countToRecepients(conversation),\'>=\',1),\'&amp;&amp;\',expHandlers(countRecepients(conversation),\'>\',1))}}"><template case="true"> <span class="edvGrey mR5">{{getI18n(\'crm.label.to.email\')}}:</span> <lyte-text class=" edvBlack edvLytetext" lt-prop-value="{{getDisplayNameOrEmail(conversation.to[0].user_name,conversation.to[0].email)}}"></lyte-text> <span class="edvLiteGrey mL5 mR5">{{getI18n(\'crm.label.lowercase.and\')}}</span> <span class="cP edvShowMoreMails edvPreventAccordion crm-font-medium" id="messageId_{{conversation.message_id}}" onclick="{{action(\'edvShowMoreMails\',this,index)}}" data-zcqa="edv_show_mailpopover_{{conversation.subject}}_{{conversation.message_id}}">{{expHandlers(countRecepients(conversation),\'-\',1)}} {{getI18n(\'crm.login.more\')}}</span> </template><template case="false"><template is="if" value="{{expHandlers(countToRecepients(conversation),\'>=\',1)}}"><template case="true"> <span class="edvGrey mR5">{{getI18n(\'crm.label.to.email\')}}:</span> <lyte-text class="cP edvBlack edvLytetext edvPreventAccordion" lt-prop-value="{{getDisplayNameOrEmail(conversation.to[0].user_name,conversation.to[0].email)}}" id="messageId_{{conversation.message_id}}" onclick="{{action(\'edvShowMoreMails\',this,index)}}" data-zcqa="edv_show_mailpopover_{{conversation.subject}}_{{conversation.message_id}}"></lyte-text> </template></template></template></template> </div> <div class="dF aiCenter mT9 edvSenderInfo hide"> <span class="edvPreventAccordion createActivity mR10 edvBlue crm-base-font-size cP hide"></span> <template is="if" value="{{expHandlers(hasEnrichment(conversation,moduleInfo),\'&amp;&amp;\',isDataEnrichmentAvailable)}}"><template case="true"><span class="edvContentDivider mR10 hide"></span></template></template> <template is="if" value="{{mailArray[index].showTranslateSection}}"><template case="true"> <div data-zcqa="translateBtn_emailView" class="cP zia_highlight flexAlignCenter edvPreventAccordion pT8 pR0 pB8 pL0 mL15 mR29" onclick="{{action(\'translateBtnAction\',mailArray[index],index,conversation.message_id)}}"> <span class="zcicncss-new-translate zcicn_blue_mask mR5 zcicn-cssIcons edvPreventAccordion"></span> <div class="crmLinkColor crm-font-regular crm-subheading-font-size edvPreventAccordion">{{getI18n(\'crm.email.translate\')}}</div> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(mailArray[index].showTranslateSection,\'!\'),\'&amp;&amp;\',isTranslationAvailable)}}"><template case="true"> <lyte-dropdown on-before-show="{{method(\'onShowOfDropdown\',conversation.message_id)}}" on-before-hide="{{method(\'onHideOfDropdown\',conversation.message_id)}}" lt-prop-disabled="{{mailArray[index].disableDropdown}}" class="mL15 mR15" id="translateDropDown_{{conversation.message_id}}" lt-prop-selected="{{mailArray[index].currentSelection}}" on-option-selected="{{method(\'optionSelected\',mailArray[index],index,conversation.message_id)}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-button class="flexAlignCenter borderNone boxShadowNone edvPreventAccordion pL0 pR0 zia_emailsummary_dropbtn"> <span class="zcicncss-new-translate zcicn_blue_mask mR5 zcicn-cssIcons edvPreventAccordion"></span> <div class="crmLinkColor crm-font-regular crm-subheading-font-size edvPreventAccordion">{{mailArray[index].currentSelection}}</div> <span id="arrow_{{conversation.message_id}}" class="zcicn-arrow-line-down-sm-mask zcicn-cssIcons zcicn_blue_mask mL3 edvPreventAccordion"></span> </lyte-drop-button> <lyte-drop-box class="zia_email_translate_dropbox_conv"> <lyte-drop-header class="w180"> <lyte-search on-search="{{method(\'onSearch\')}}" lt-prop-query-selector="{&quot;scope&quot;:&quot;.zia_email_translate_dropbox_conv&quot;,&quot;search&quot;:&quot;lyte-drop-item&quot;}" lt-prop-component="dropdown" lt-prop-position="top" lt-prop-placeholder="{{getI18n(\'crm.globalsearch.search.title\')}}"> </lyte-search> </lyte-drop-header> <lyte-drop-body> <template is="for" items="{{dropDownLanguages}}" item="language" index="index"> <lyte-drop-item data-value="{{language.name}}">{{language.name}} {{getLanguageId(language.id)}}</lyte-drop-item> </template> <div id="searchID" class="aligncenter crm-base-font-size crmNotFoundColor p15 hide">{{getI18n(\'crm.template.listview.search.no.results\')}}</div> </lyte-drop-body> <lyte-drop-footer class="alignLeft br_top_border2 cP crmLinkColor pB10 pL25 pR25 pT10 bg_crmBg3" onclick="{{action(\'originalChange\',mailArray[index],index,conversation.message_id)}}">{{mailArray[index].userLan}} - {{getI18n(\'zc.editor.original\')}}</lyte-drop-footer> </lyte-drop-box> </template> </lyte-dropdown> </template></template> <template is="if" value="{{hasActivity(mailArray[index])}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(mailArray[index],\'&amp;&amp;\',mailArray[index].viewactivitylabel),\'&amp;&amp;\',expHandlers(isTranslationAvailable,\'!\'))}}"><template case="true"> <div class="{{borderHelper(mailArray[index].status[0].type)}} crmLinkColor cP edvPreventAccordion dIB pL10 pR10 crm-extra-medium-font-size" id="EnrichActivitiesavailable" onclick="{{action(\'openActivityPopup\',conversation,mailArray[index],index)}}" data-zcqa="activity_suggestions_conversationview">{{mailArray[index].viewactivitylabel}}</div> </template></template> </template></template> <template is="if" value="{{expHandlers(conversation.showHelpZia,\'&amp;&amp;\',expHandlers(isTranslationAvailable,\'!\'))}}"><template case="true"> <div id="mail-feedback" class="{{isSentMail(mailArray[index])}} flexAlignCenter crmLinkColor cP edvPreventAccordion pL10 pR10 crm-extra-medium-font-size"> <span onclick="{{action(\'openHelpZia\',conversation,index)}}" data-zcqa="edv_feedback_mechanism_{{conversation.subject}}_{{conversation.message_id}}" class="edvPreventAccordion">{{getI18n(\'crm.zia.FM.help.zia\')}}</span> <span class="dIB pR right0 top_5"><crm-ui-loaders interaction-name="crmNewReleaseLoader"></crm-ui-loaders></span> </div> </template></template> <template is="if" value="{{expHandlers(hasEmailsAIDropDown(conversation,mailArray[index]),\'&amp;&amp;\',isTranslationAvailable)}}"><template case="true"> <template is="if" value="{{expHandlers(mailArray[index].showTranslateSection,\'||\',mailArray[index].dropDownSection)}}"><template case="true"> <div class="h4 w4 br50per zia_email_dot_wrap zi1"></div> </template></template> <div data-zcqa="ziaMenu" class="flexAlignCenter cP edvPreventAccordion pT8 pR0 pB8 pL0 mL15 mR15 ziaMenu_{{conversation.message_id}}" id="ziaMenu"> <div class="crmLinkColor cP crm-font-regular crm-subheading-font-size edvPreventAccordion">{{getI18n(\'crm.intelligence.name\')}}</div> <span class="zcicn-arrow-line-down-sm-mask zcicn-cssIcons zcicn-rotate-180 zcicn_blue_mask mL3 edvPreventAccordion"></span> </div> <div id="mail-feedback"></div> <lyte-menu lt-prop-position="down" lt-prop-yield="true" lt-prop-event="click" lt-prop-query=".ziaMenu_{{conversation.message_id}}" on-menu-click="{{method(\'menuSelected\',conversation,index)}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{conversation.showHelpZia}}"><template case="true"> <lyte-menu-item data-zcqa="helpZia" data-value="Help_Zia"> <lyte-menu-label class="flexAlignCenter"> <crmutil-icon icon-name="ziahelp" icon-class="zcicn-ziahelp zcicn16"></crmutil-icon> <span class="mL10">{{getI18n(\'crm.zia.FM.help.zia\')}}</span> </lyte-menu-label> </lyte-menu-item> </template></template> <template is="if" value="{{mailArray[index].showEnrichment}}"><template case="true"> <lyte-menu-item data-zcqa="dataEnrichment" data-value="Enrich_data"> <lyte-menu-label class="flexAlignCenter"> <crmutil-icon icon-name="enrichdata" icon-class="zcicn-enrichdata zcicn16"></crmutil-icon> <span class="mL10">{{getI18n(\'crm.email.threadview.enrich.data\')}}</span> </lyte-menu-label> </lyte-menu-item> </template></template> <template is="if" value="{{mailArray[index].showActivity}}"><template case="true"> <lyte-menu-item data-zcqa="activitySuggestion" data-value="Activity_Suggestion"> <lyte-menu-label class="flexAlignCenter"> <crmutil-icon icon-name="activitysuggestion" icon-class="zcicn-activitysuggestion zcicn16"></crmutil-icon> <span class="mL10">{{getI18n(\'crm.zia.FM.modal.activity-suggestion\')}}</span> </lyte-menu-label> </lyte-menu-item> </template></template> </lyte-menu-body> </template> </lyte-menu> </template></template> <template is="if" value="{{expHandlers(expHandlers(hasEnrichment(conversation,moduleInfo),\'&amp;&amp;\',expHandlers(isDataEnrichmentAvailable,\'||\',isEmailsAIClickableSupport)),\'&amp;&amp;\',expHandlers(isTranslationAvailable,\'!\'))}}"><template case="true"> <div class="dIF aiCenter pL10 pR10 edvSenderInfo "> <span class="edvBlue crm-extra-medium-font-size edvPreventAccordion {{getBorder(conversation)}} cP" onclick="{{action(\'openEnrichment\',conversation,index)}}" data-zcqa="edv_enrich_data_{{conversation.subject}}_{{conversation.message_id}}">{{getI18n(\'crm.email.threadview.enrich.data\')}}</span> </div> </template></template> <template is="if" value="{{expHandlers(hasKey(conversation,\'emotion\'),\'&amp;&amp;\',Crm.userDetails.isHelpZiaEnabled)}}"><template case="true"> <div class="dIF aiCenter pL10 R10 edvSenderInfo"> <span class="mL10 edvBlue crm-extra-medium-font-size edvPreventAccordion" lt-prop-title="Help zia to provide better results" lt-prop-tooltip-config=" { &quot;position&quot; : &quot;bottom&quot; } " onclick="{{action(\'helpZia\')}}">{{getI18n(\'crm.email.threadview.help.zia\')}}</span> </div> </template></template> <template is="if" value="{{expHandlers(moduleInfo.recordState,\'!==\',\'deleted\')}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(getMailStatus(conversation.status[0].type,\'scheduled\'),\'||\',getMailStatus(conversation.status[0].type,\'draft\')),\'&amp;&amp;\',expHandlers(conversation.sharing_permission,\'!==\',\'read_only\'))}}"><template case="true"> <lyte-button class="edvPreventAccordion" lt-prop-size="small" lt-prop-class="outlineprimary" onclick="{{action(\'openComposeWindow\',this,index)}}" data-zcqa="edv_edit_header_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'gs.edit\')}} </template> </lyte-button> </template><template case="false"><template is="if" value="{{getMailStatus(conversation.status[0].type,\'failed\')}}"><template case="true"> <lyte-button class="edvPreventAccordion" lt-prop-size="small" lt-prop-class="outlineprimary" onclick="{{action(\'openComposeWindow\',this,index)}}" data-zcqa="edv_edit_resend_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.resend\')}} </template> </lyte-button> </template><template case="false"><template is="if" value="{{expHandlers(hasSendMailPermission(mailSource,moduleInfo.moduleName,conversation.sharing_permission),\'!\')}}"><template case="true"> <template is="if" value="{{hasPrintMailPermission(mailSource,moduleInfo.moduleName,conversation.sharing_permission)}}"><template case="true"><lyte-button class="edvPreventAccordion mL15 mR0" lt-prop-size="small" lt-prop-class="outlineprimary" onclick="{{action(\'printPreview\',this,index)}}" data-zcqa="edv_print_preview_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.print.view\')}} </template> </lyte-button></template></template> </template><template case="false"><template is="if" value="{{expHandlers(conversation.to,\'&amp;&amp;\',expHandlers(conversation.to.length,\'==\',1))}}"><template case="true"> <div class="lyteClubbedButton edvPreventAccordion mL15 crm-base-font-size"> <lyte-button lt-prop-size="small" lt-prop-appearance="primary" lt-prop-class="outlineprimary" onclick="{{action(\'replyOption\',\'reply\',index)}}" data-zcqa="edv_reply_header_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.reply\')}} </template> </lyte-button> <lyte-button id="showMoreOptionsConversation" class="dIF aiCenter edvShowMoreOptionsConversation" lt-prop-appearance="primary" lt-prop-class="outlineprimary" lt-prop-size="small" onclick="{{action(\'replyIndexUpdate\',index)}}" data-zcqa="edv_show_more_options_header_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> </template> </lyte-button> </div> </template><template case="false"> <div class="lyteClubbedButton edvPreventAccordion mL5"> <lyte-button lt-prop-size="small" lt-prop-class="outlineprimary" lt-prop-appearance="primary" onclick="{{action(\'replyOption\',\'replyAll\',index)}}" data-zcqa="edv_reply_all_header_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.replyall\')}} </template> </lyte-button> <lyte-button id="showMoreOptionsConversation" class="dIF aiCenter edvShowMoreOptionsConversation" lt-prop-class="outlineprimary" lt-prop-appearance="primary" lt-prop-size="small" onclick="{{action(\'replyIndexUpdate\',index)}}" data-zcqa="edv_show_more_options_header_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> </template> </lyte-button> </div> </template></template></template></template></template></template></template></template> </template></template> </div> </div> <div class="cBoth"></div> <div class="dF edvSenderInfo hide"> <template is="if" value="{{expHandlers(dealData.hasDealLinking,\'&amp;&amp;\',hasKey(dealArray[index],\'name\'))}}"><template case="true"><div class="vaM crm-base-font-size dIF aiCenter crm-font-regular"> <span class="edvLinkKey vaM">{{getI18n(\'crm.relatedList.deals.linkeddeal\',getDealTranslatedSingularLabel())}}:</span> <span class="edvBlue mL2 cP edvDealName vaM mB3 edvDealTextContainer edvPreventAccordion" id="edvDealFooter_{{conversation.message_id}}" onmouseover="{{action(\'showContactCard\',true,index)}}" onmouseout="{{action(\'closeContactCard\',true,index)}}" data-zcqa="edv_show_dealpopover_footer_{{conversation.subject}}_{{conversation.message_id}}"> <a target="_blank" rel="noopener noreferrer" data-params="{&quot;module&quot;:&quot;Potentials&quot;,&quot;id&quot;:&quot;{{dealArray[index].id}}&quot;}" onclick="{{action(\'checkForPublicFields\',event,this)}}" href="{{getDealLink(dealArray[index].id)}}" data-zcqa="edv_open_deal_footer_{{conversation.subject}}_{{conversation.message_id}}"><lyte-text lyte-hovercard="true" lt-prop-value="{{dealArray[index].name}}" class="vaM"></lyte-text></a> </span> <template is="if" value="{{hasEmailWritePermission(conversation.sharing_permission)}}"><template case="true"><div class=" mL5 edvShowDealOption cP dIF aiCenter edvDealTextContainer edvPreventAccordion" onclick="{{action(\'dealOptionsClicked\',this,index)}}" data-zcqa="edv_open_deal_options_footer_{{conversation.subject}}_{{conversation.message_id}}"> <crmutil-icon class="cP edvDealTextContainer edvPreventAccordion" icon-name="more-hr" icon-class="zcicn-more-hr crmBaseIcon "></crmutil-icon> </div></template></template> </div></template></template> </div> </div> </div> </lyte-accordion-header> <lyte-accordion-body class="bg_white p0 edvBodyColor"> <template is="if" value="{{hasContent(mailArray[index][&quot;content&quot;],undefined)}}"><template case="true"> <div class="edvMailContent edvMailContent_{{conversation.message_id}}"> <div class="edvMailBody clearFix" id="mailContent_{{conversation.message_id}}"> <span class="mailBody" data-subject="{{mailArray[index].subject}}" data-time="{{getTimeInMillis(conversation.sent_time)}}" data-from-addr="{{getDisplayEmail(conversation.from.user_name,conversation.from.email)}}"> {{appendAsShadowDOM(this,mailArray[index].content,\'.mailBody\')}} </span> <template is="if" value="{{hasContent(mailArray[index][&quot;previous_content&quot;],undefined)}}"><template case="true"> <lyte-accordion lt-prop-duration="0.2s" lt-prop-exclusive="false" on-before-open="{{method(\'showPreviousMailContent\')}}" on-before-close="{{method(\'beforeClosePreviousMailContent\')}}"> <template is="registerYield" yield-name="yield"> <lyte-accordion-item class="edvSingleThreadAcc"> <lyte-accordion-header class="bg_white p0 mB10 cAuto"> <div class="edvShowReply cP"> <crmutil-icon icon-name="more-hr" icon-class="zcicn-more-hr crmBaseIcon "></crmutil-icon> </div> </lyte-accordion-header> <lyte-accordion-body class="p0 edvBodyColor mailPrevBody"> {{appendAsShadowDOM(this,mailArray[index].previous_content,\'.mailPrevBody\')}} </lyte-accordion-body> </lyte-accordion-item> </template> </lyte-accordion> </template></template> </div> <div class="attachments"> <template is="if" value="{{hasAttachments(mailArray[index])}}"><template case="true"> <lyte-accordion lt-prop-duration="0.2s" lt-prop-exclusive="false" lt-prop-dynamic="true" on-before-open="{{method(\'beforeOpenAttachContent\')}}" on-before-close="{{method(\'beforeCloseAttachContent\')}}"> <template is="registerYield" yield-name="yield"> <lyte-accordion-item class="edvAttachAccordion borderNone"> <lyte-accordion-header class="bg_white p0 cDefault"> <div class="dF aiCenter pT12 edvAttachContainer pB10"> <div class="edvHeading crm-base-font-size crm-font-semibold dF aiCenter"> <span class="edvDropDown mR8 cP dIB crmcssBaseIcon zcicn-arrow-solid-down-md mR11"></span> <template is="if" value="{{hasDownloadAttachPermission(mailSource)}}"><template case="true"><lyte-checkbox class="edvPreventAccordion edvSelectAllcheck" lt-prop-label-class="edvPreventAccordion" lt-prop-type="default" lt-prop-tabindex="0" on-checked="{{method(&quot;selectAll&quot;)}}" on-unchecked="{{method(&quot;unSelectAll&quot;)}}" data-zcqa="edv_selectall_{{conversation.subject}}_{{conversation.message_id}}"></lyte-checkbox></template></template> <span class="edvAttachmentCount">{{mailArray[index].attachments.length}}</span> <span class="edvAtchName mL5">{{getAttachmentTextForConversation(mailArray[index].attachments)}}</span> </div> <div class="edvDwldOptions hide flexAlignCenter"> <span class="cP edvBlue crm-base-font-size edvDownloadText edvPreventAccordion" purpose="downloadAttachments" onclick="{{action(&quot;downloadAttachments&quot;,this,false,index)}}" data-zcqa="edv_multiselect_download_as_zip_{{conversation.subject}}_{{conversation.message_id}}">{{getI18n(\'crm.email.threadview.download.as.zip\')}}</span> <span class="edvBlue cP mL25 crm-base-font-size edvPreventAccordion" purpose="addToRelatedList" onclick="{{action(&quot;attachIndexUpdate&quot;,index)}}" data-zcqa="edv_multiselect_add_to_{{conversation.subject}}_{{conversation.message_id}}"> {{getI18n(\'crm.label.simply.add.to\')}} <span class="zcicn-arrow-solid-down-sm-mask zcicn-cssIcons zcicn_blue_mask mB3"></span> </span> </div> </div> </lyte-accordion-header> <lyte-accordion-body class="p0" data-attachments="attachments_{{conversation.message_id}}" id="attachments_{{conversation.message_id}}"> <div class="edvAtchsDiv"> <template is="for" items="{{getAttachments(mailArray[index])}}" item="attachment" index="attachIndex"> <div class="mB20 edvAttachments aiCenter dIF pB10 pT10 p12" id="edv_attachments_{{attachment.id}}"> <div class="dIF aiCenter edvAtchInnerSec"> <crmutil-icon class="{{if(ifEquals(mailSource,\'draft\'),\'\',\'edvfileType\')}}" icon-name="{{getIconName(attachment.name)}}" icon-class="{{getIconClass(attachment.name)}}"></crmutil-icon> <template is="if" value="{{hasDownloadAttachPermission(mailSource)}}"><template case="true"><lyte-checkbox class="edvPreventAccordion edvAttachCheckBx" lt-prop-label-class="edvPreventAccordion" lt-prop-type="default" lt-prop-tabindex="0" on-checked="{{method(&quot;onAttachSelected&quot;,this,index)}}" on-unchecked="{{method(&quot;onAttachUnselected&quot;,this,index)}}" data-attach-id="{{attachment.id}}" data-attach-name="{{attachment.name}}" data-zcqa="edv_select_{{attachment.name}}_{{attachment.id}}"></lyte-checkbox></template></template> </div> <div class="aiCenter dF spaceBetween minW180"> <lyte-text class="edvBlack crm-base-font-size w110" lt-prop-value="{{attachment.name}}"></lyte-text> <template is="if" value="{{expHandlers(selectedCount[index],\'>\',0)}}"><template case="true"> <span class="crm-small-font-size edvGrey">{{bytesToSize(attachment.size,2)}}</span> </template><template case="false"> <span class="crm-small-font-size edvGrey {{if(ifEquals(mailSource,\'draft\'),\'\',\'edvFileSize\')}}">{{bytesToSize(attachment.size,2)}}</span> <template is="if" value="{{hasDownloadAttachPermission(mailSource)}}"><template case="true"><div class=" edvDownloadIcon cP" onclick="{{action(\'showDwldOptions\',this,attachment,index)}}" data-zcqa="edv_show_download_options_{{attachment.name}}_{{attachment.id}}"> <crmutil-icon class="cP" icon-name="more-hr" icon-class="zcicn-more-hr crmBaseIcon "></crmutil-icon> </div></template></template> </template></template> </div> </div> </template> </div> </lyte-accordion-body> </lyte-accordion-item> </template> </lyte-accordion> </template></template> </div> <div class="pT15 dF aiCenter"> <template is="if" value="{{expHandlers(showReplyForwardOptions(conversation.status,moduleInfo.recordState),\'&amp;&amp;\',hasSendMailPermission(mailSource,moduleInfo.moduleName,conversation.sharing_permission))}}"><template case="true"><div> <lyte-button class="crm-base-font-size " lt-prop-class=" edvBlack" lt-prop-size="small" onclick="{{action(\'replyOption\',\'reply\',index)}}" data-zcqa="edv_reply_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.reply\')}} </template> </lyte-button> <lyte-button class="crm-base-font-size " lt-prop-class=" edvBlack" lt-prop-size="small" onclick="{{action(\'replyOption\',\'replyAll\',index)}}" data-zcqa="edv_reply_all_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.replyall\')}} </template> </lyte-button> <lyte-button class="crm-small-font-size" lt-prop-class="edvBlack" lt-prop-size="small" onclick="{{action(\'replyOption\',\'forward\',index)}}" data-zcqa="edv_forward_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.email.label.forward\')}} </template> </lyte-button> </div></template></template> <template is="for" items="{{getFirstCustomButtons(mailSource,moduleInfo.moduleName)}}" item="button" index="buttonIndex"> <template is="if" value="{{expHandlers(buttonIndex,\'===\',0)}}"><template case="true"> <template is="if" value="{{addClassForCustomButton(moduleInfo.moduleName)}}"><template case="true"> <lyte-button lt-prop-class="edvBlack " lt-prop-size="small" class="etvCustomBtn mR0" onclick="{{action(\'triggerCustomButton\',button,index)}}" id="edv_custom_button_{{button.id}}" data-zcqa="edv_custom_button_{{button.name}}_{{button.id}}"> <template is="registerYield" yield-name="text"> {{button.name}} </template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-class="edvBlack " lt-prop-size="small" onclick="{{action(\'triggerCustomButton\',button,index)}}" id="edv_custom_button_{{button.id}}" data-zcqa="edv_custom_button_{{button.name}}_{{button.id}}"> <template is="registerYield" yield-name="text"> {{button.name}} </template> </lyte-button> </template></template> </template></template> <template is="if" value="{{expHandlers(buttonIndex,\'===\',1)}}"><template case="true"> <lyte-button lt-prop-class="edvCustomBtnNoBrdr" lt-prop-size="small" class="etvCustomBtnOptions" onclick="{{action(\'replyIndexUpdate\',index)}}" data-zcqa="edv_custom_button_dropdown_{{conversation.subject}}_{{conversation.message_id}}"> <template is="registerYield" yield-name="text"> <span class="dIB crmcssBaseIcon zcicn-arrow-solid-down-sm mB3"></span> </template> </lyte-button> </template></template> </template> </div> </div> </template></template> </lyte-accordion-body> </lyte-accordion-item> </template> <div class="ecnAttachment hide"></div> </template> </lyte-accordion> </div> </lyte-modal-content> </template> </lyte-modal> <lyte-menu lt-prop-yield="true" lt-prop-wrapper-class="edvCustomBtntxt" lt-prop-event="click" lt-prop-query=".etvCustomBtnOptions" lt-prop-position="downAlignLeft"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{getCustomButtons(mailSource,moduleInfo.moduleName)}}" item="button" index="buttonIndex"> <lyte-menu-item data-value="{{button.name}}" onclick="{{action(\'triggerCustomButton\',button)}}" id="edv_custom_button_{{button.id}}" data-zcqa="edv_custom_button_{{button.id}}"> <lyte-menu-label><lyte-text lt-prop-value="{{button.name}}"></lyte-text></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <lyte-popover id="edvShowMoreMailsModalConversation" lt-prop-show="{{lbind(mailDetailsPopover)}}" lt-prop-origin-elem="#{{edvPopOverId}}" lt-prop-max-width="500px" lt-prop-placement="bottom" lt-prop-height="auto" lt-prop-duration="400" lt-prop-content-padding="15px" lt-prop-freeze="false" lt-prop-wrapper-class="edvMailInfo" lt-prop-show-close-button="true" lt-prop-scrollable="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="crm-base-font-size edvmailDetailInfoPopup edvBlack"> <div class="etvContactCardContainer pT15"> <div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'crm.template.from.emailid\')}}:</div> <div class="pB12"> <lyte-text class=" edvLytetext" lt-prop-value="{{getDisplayEmail(mailData.from.user_name,mailData.from.email)}}"></lyte-text> </div> </div> <template is="if" value="{{hasRecepients(mailData,\'to\')}}"><template case="true"><div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'crm.label.to.email\')}}:</div> <div class="pB12"> <template is="for" items="{{mailData.to}}" item="data" index="index"> <lyte-text class=" edvLytetext" lt-prop-value="{{getDisplayEmail(data.user_name,data.email,index,mailData,\'to\')}}"></lyte-text> </template> </div> </div></template></template> <template is="if" value="{{hasRecepients(mailData,\'cc\')}}"><template case="true"><div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'crm.label.cc.email\')}}:</div> <div class="pB12"> <template is="for" items="{{mailData.cc}}" item="data" index="index"> <lyte-text class=" edvLytetext" lt-prop-value="{{getDisplayEmail(data.user_name,data.email,index,mailData,\'cc\')}}"></lyte-text> </template> </div> </div></template></template> <template is="if" value="{{hasRecepients(mailData,\'bcc\')}}"><template case="true"><div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'crm.label.bcc.email\')}}:</div> <div class="pB12"> <template is="for" items="{{mailData.bcc}}" item="data" index="index"> <lyte-text class=" edvLytetext" lt-prop-value="{{getDisplayEmail(data.user_name,data.email,index,mailData,\'bcc\')}}"></lyte-text> </template> </div> </div></template></template> <div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'gs.date\')}}:</div> <div class="pB12"> {{getEdvDateNTime(mailData.sent_time)}} </div> </div> <div class="flexAlignStart"> <div class="pB12 mR10 mailInfoTitle">{{getI18n(\'crm.events.subject\')}}:</div> <div class="pB12"> <lyte-text class="edvLytetext" lt-prop-value="{{mailData.subject}}"></lyte-text> </div> </div> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-menu lt-prop-yield="true" lt-prop-wrapper-class="edvMenuStyle" lt-prop-event="click" lt-prop-query="#showMoreOptionsConversation" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" lt-prop-position="downAlignLeft"> <template is="registerYield" yield-name="yield"> <lyte-menu-body class="edvMenuBdy"> <template is="if" value="{{expHandlers(conversationList[replyIndex].to.length,\'==\',1)}}"><template case="true"> <lyte-menu-item data-value="4" class="edvMenuItem" onclick="{{action(\'replyOption\',\'replyAll\')}}" data-zcqa="edv_reply_all"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.button.replyall\')}} </lyte-menu-label> </lyte-menu-item> </template><template case="false"> <lyte-menu-item data-value="4" class="edvMenuItem" onclick="{{action(\'replyOption\',\'reply\')}}" data-zcqa="edv_reply"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.button.reply\')}} </lyte-menu-label> </lyte-menu-item> </template></template> <lyte-menu-item data-value="5" class="edvMenuItem" onclick="{{action(\'replyOption\',\'forward\')}}" data-zcqa="edv_forward"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.label.forward\')}} </lyte-menu-label> </lyte-menu-item> <template is="if" value="{{hasPrintMailPermission(mailSource,moduleInfo.moduleName)}}"><template case="true"><lyte-menu-item data-value="6" class="edvMenuItem" onclick="{{action(\'printPreview\')}}" data-zcqa="edv_print_preview"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.button.print.view\')}} </lyte-menu-label> </lyte-menu-item></template></template> <template is="if" value="{{expHandlers(mailSource,\'==\',\'mailMagnet\')}}"><template case="true"> <lyte-menu-item data-value="7" class="edvMenuItem" onclick="{{action(\'addFollowUpTask\',event)}}" data-zcqa="edv_add_followup_task"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.add.followup.task\')}} </lyte-menu-label> </lyte-menu-item> </template></template> <template is="if" value="{{expHandlers(dealData.hasDealLinking,\'&amp;&amp;\',expHandlers(conversationList[replyIndex].sharing_permission,\'!==\',\'read_only\'))}}"><template case="true"> <template is="if" value="{{islinkedToDeal(dealArray[replyIndex])}}"><template case="true"> <lyte-menu-item data-value="8" class="edvMenuItem" onclick="{{action(\'unlinkDeal\')}}" data-zcqa="edv_unlink_deal"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.relatedList.deals.unlinkdeal\',getDealTranslatedSingularLabel())}} </lyte-menu-label> </lyte-menu-item> </template><template case="false"> <lyte-menu-item data-value="8" class="edvMenuItem" onclick="{{action(\'linkToNewOrChangeDeal\')}}" data-zcqa="edv_change_deal"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.relatedList.deals.link\',getDealTranslatedSingularLabel())}} </lyte-menu-label> </lyte-menu-item> </template></template> </template></template> </lyte-menu-body> </template> </lyte-menu> <lyte-menu lt-prop-yield="true" lt-prop-class="edvAttachement" lt-prop-wrapper-class="edvAttachement" lt-prop-event="click" lt-prop-query=".edvDownloadIcon" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" on-close="{{method(&quot;onCloseMenu&quot;)}}" on-before-close="{{method(\'onBeforeCloseMenu\')}}" lt-prop-position="downLeft"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <lyte-menu-item data-value="1" class="edvMenuItem pR" onclick="{{action(\'downloadAttachments\',this,true)}}" data-zcqa="edv_singleselect_download"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.databackup.configure.free.edition.button\')}} </lyte-menu-label> </lyte-menu-item> <lyte-menu-item data-value="2" class="edvMenuItem" data-zcqa="edv_singleselect_add_to"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.label.simply.add.to\')}} <span class="dIB crmcssBaseIcon zcicn-arrow-solid-right-sm pA edvArrowRightAddTo"></span> </lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-menu lt-prop-yield="true" lt-prop-class="edvAttachement" lt-prop-wrapper-class="edvAttachement" lt-prop-event="mouseenter" lt-prop-query="lyte-menu-item[data-value=&quot;2&quot;]" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" on-close="{{method(&quot;onCloseMenu&quot;)}}" on-before-close="{{method(\'onBeforeCloseSubMenu\')}}" lt-prop-position="right"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{hasAttachmentCreatePermission(moduleInfo.moduleName,mailSource)}}"><template case="true"><lyte-menu-item data-value="3" class="edvMenuItem" onclick="{{action(\'addToRelatedList\',this,true)}}" data-zcqa="edv_singleselect_add_to_related_list"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.attachment.related.list\')}} </lyte-menu-label> </lyte-menu-item></template></template> <lyte-menu-item data-value="4" class="edvMenuItem" onclick="{{action(\'addToWorkDrive\',this,true)}}" data-zcqa="edv_singleselect_add_workdrive"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.work.drive\')}} </lyte-menu-label> </lyte-menu-item> <lyte-menu-item data-value="5" class="edvMenuItem" onclick="{{action(\'addToCloud\',this,true)}}" data-zcqa="edv_singleselect_add_to_cloud"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.other.cloud.services\')}} </lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-menu lt-prop-yield="true" lt-prop-class="edvAttachement" lt-prop-wrapper-class="edvAttachement" lt-prop-event="click" lt-prop-query="span[purpose=&quot;addToRelatedList&quot;]" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" on-close="{{method(&quot;onCloseMenu&quot;)}}" lt-prop-position="down"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{hasAttachmentCreatePermission(moduleInfo.moduleName,mailSource)}}"><template case="true"><lyte-menu-item data-value="3" class="edvMenuItem" onclick="{{action(\'addToRelatedList\',this,false)}}" data-zcqa="edv_multipleselect_add_to_related_list"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.attachment.related.list\')}} </lyte-menu-label> </lyte-menu-item></template></template> <lyte-menu-item data-value="4" class="edvMenuItem" onclick="{{action(\'addToWorkDrive\',this,false)}}" data-zcqa="edv_multipleselect_add_to_workdrive"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.threadview.work.drive\')}} </lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-menu lt-prop-yield="true" lt-prop-class="edvAttachement" lt-prop-wrapper-class="edvAttachement" lt-prop-event="click" lt-prop-query=".edvShowDealOption" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" on-close="{{method(&quot;onCloseDealOptionsMenu&quot;)}}" lt-prop-position="downRight"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <lyte-menu-item class="edvMenuItem crm-base-font-size edvBlack" onclick="{{action(\'linkToNewOrChangeDeal\',this)}}" data-zcqa="edv_mailview_deal_change"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'gs.change\')}} </lyte-menu-label> </lyte-menu-item> <lyte-menu-item class="edvMenuItem crm-base-font-size edvBlack" onclick="{{action(\'unlinkDeal\',this)}}" data-zcqa="edv_mailview_deal_unlink"> <lyte-menu-label class="crm-base-font-size edvBlack"> {{getI18n(\'crm.email.editor.label.Unlink\')}} </lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-hovercard id="edvShowLinkedDeal" lt-prop-show="{{lbind(showDealHoverCard)}}" lt-prop-close-on-body-click="true" lt-prop-auto-show="true" lt-prop-width="350px" lt-prop-popover-wrapper-class="edvDealPopover" lt-prop-origin-elem="#{{dealData.messageId}}"> <template is="registerYield" yield-name="hoverCardYield"> <lyte-hovercard-content> <template is="if" value="{{dealData.success}}"><template case="true"> <div class="crm-medium-large-font-size mB12 crm-font-bold edvBlack"><lyte-text lt-prop-value="{{dealData.name}}"></lyte-text></div> <div class="edvContactCardContainer"> <div class="edvLinkTable"> <template is="for" items="{{contactCard}}" item="contact" index="index"> <template is="if" value="{{expHandlers(expHandlers(contactCard.length,\'-\',1),\'==\',index)}}"><template case="true"> <div class="flexAlignStart"> <div class="alignRight"> <lyte-text class="edvGrey crm-base-font-size edvContactLabel pR20 edvLinkKey" lt-prop-value="{{contact.display_label}}"> </lyte-text> </div> <div class="w140"> {{contact.value}} </div> </div> </template><template case="false"> <div class="flexAlignStart mB10"> <div class="alignRight"> <lyte-text class="edvGrey crm-base-font-size edvContactLabel pR20 edvLinkKey" lt-prop-value="{{contact.display_label}}"> </lyte-text> </div> <div class="w140"> {{contact.value}} </div> </div> </template></template> </template> </div> </div> </template><template case="false"> <div class="crm-extra-small-font-size edvBlack">{{dealData.message}}</div> </template></template> </lyte-hovercard-content> </template> </lyte-hovercard> <lyte-popover id="etViewRecipientDetailsPopOver" lt-prop-show="{{lbind(showContactCardPopover)}}" lt-prop-freeze="false" lt-prop-origin-elem=".etViewRecipientName.etViewPopOverActive" lt-prop-wrapper-class="etViewMailRecipientPopOverClass" lt-prop-width="333px" lt-prop-content-padding="15px 20px 5px 20px" lt-prop-show-close-button="false" lt-prop-allow-multiple="true" lt-prop-duration="400" lt-prop-type="box" lt-prop-placement="bottomLeft"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="etViewRecipientPopoverContent"> <div class="flexAlignCenter edvPopOverMargin"> <div class="flexAlignCenter"> <img class="etViewRecipientProfPic" src="{{getMailMagnetImageUrl(contactCardHeader,moduleInfo)}}" alt="error" onerror="{{action(\'imgOnError\',this)}}"> <div class="mL12"> <div class="edvBlack crm-base-font-size mB4"> <lyte-text class="vaM edvContactHeaderText" lt-prop-value="{{contactCardHeader.recordName}}"></lyte-text> <crmutil-icon class="dIB vaM mT2 mL5 cP" icon-name="expand-sm" icon-class="zcicn-expand-sm zcicn12 crmBaseIcon " onclick="{{action(\'openRecord\')}}" data-zcqa="edv_contact_card_open_record"></crmutil-icon> </div> <template is="if" value="{{contactCardHeader.accountName}}"><template case="true"><div class="edvBlack crm-extra-small-font-size w110"><lyte-text lt-prop-value="{{contactCardHeader.accountName}}"></lyte-text></div></template><template case="false"><div class="edvBlack crm-extra-small-font-size w110"><lyte-text lt-prop-value="{{contactCardHeader.companyName}}"> </lyte-text></div></template></template> </div> </div> </div> <div class="edvLinkTable"> <template is="for" items="{{contactCard}}" item="contact" index="index"> <template is="if" value="{{expHandlers(expHandlers(contactCard.length,\'-\',1),\'==\',index)}}"><template case="true"> <div class="flexAlignStart"> <div class="alignRight"> <lyte-text class="edvGrey crm-base-font-size edvContactLabel pR20 edvLinkKey" lt-prop-value="{{contact.display_label}}"> </lyte-text> </div> <div class="w140"> {{contact.value}} </div> </div> </template><template case="false"> <div class="flexAlignStart mB10"> <div class="alignRight"> <lyte-text class="edvGrey crm-base-font-size edvContactLabel pR20 edvLinkKey" lt-prop-value="{{contact.display_label}}"> </lyte-text> </div> <div class="w140"> {{contact.value}} </div> </div> </template></template> </template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-event-listener event-name="windowResize" on-fire="{{action(\'onwindowResize\')}}"> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1,0]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[0,0]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"attr",position:[1,3,5]},{type:"componentDynamic",position:[1,3,5]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,3]},{type:"if",position:[1,1,1,3,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]}]},false:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,5]},{type:"if",position:[1,1,1,3,1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,7]},{type:"if",position:[1,1,1,3,1,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,9]},{type:"if",position:[1,1,1,3,1,1,9],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,11,1]},{type:"if",position:[1,1,1,3,1,1,11,1],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]},{type:"attr",position:[0,3]},{type:"attr",position:[0,3,1]},{type:"attr",position:[0,3,1,0]},{type:"componentDynamic",position:[0,3,1,0]},{type:"attr",position:[0,5]},{type:"if",position:[0,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,1,3,1]},{type:"if",position:[1,1,1,3,1,3,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[0]}]}},default:{}},{type:"text",position:[1,1,1,3,1,3,3,0]},{type:"attr",position:[1,1,1,3,1,5]},{type:"if",position:[1,1,1,3,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,1]},{type:"if",position:[1,1,1,3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,0]},{type:"componentDynamic",position:[0,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,3,1]},{type:"if",position:[1,1,1,3,3,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]},{type:"text",position:[5,0]},{type:"attr",position:[7]},{type:"text",position:[7,0]},{type:"text",position:[7,2]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,3]},{type:"if",position:[1,1,1,3,3,5,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,5]},{type:"if",position:[1,1,1,3,3,5,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,7]},{type:"if",position:[1,1,1,3,3,5,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"componentDynamic",position:[3,1,1]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3,1]},{type:"for",position:[3,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"text",position:[1,2]},{type:"componentDynamic",position:[1]}]},{type:"text",position:[3,3,3,0]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5]},{type:"text",position:[3,5,0]},{type:"text",position:[3,5,2]},{type:"componentDynamic",position:[3,5]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,9]},{type:"if",position:[1,1,1,3,3,5,9],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,11]},{type:"if",position:[1,1,1,3,3,5,11],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,3,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,13]},{type:"if",position:[1,1,1,3,3,5,13],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[3]},{type:"text",position:[3,1,0]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,15]},{type:"if",position:[1,1,1,3,3,5,15],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,17]},{type:"if",position:[1,1,1,3,3,5,17],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,5,19]},{type:"if",position:[1,1,1,3,3,5,19],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"registerYield",position:[0,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[]},{type:"componentDynamic",position:[1,3]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[]},{type:"componentDynamic",position:[1,3]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,7,1]},{type:"if",position:[1,1,1,3,7,1],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]},{type:"attr",position:[0,3]},{type:"attr",position:[0,3,1]},{type:"attr",position:[0,3,1,0]},{type:"componentDynamic",position:[0,3,1,0]},{type:"attr",position:[0,5]},{type:"if",position:[0,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0,1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1,3]},{type:"if",position:[1,1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"text",position:[1,1,1,1,5,0]},{type:"text",position:[1,1,1,1,7,0]},{type:"attr",position:[1,1,1,3,1]},{type:"text",position:[1,1,1,3,1,0]},{type:"attr",position:[1,1,1,3,3]},{type:"text",position:[1,1,1,3,3,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1,1]},{type:"for",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"if",position:[1,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0,1]}]}},default:{}}]}},default:{}}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"registerYield",position:[0,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0,1]},{type:"attr",position:[0,3]},{type:"registerYield",position:[0,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0,3]},{type:"attr",position:[0,5]},{type:"registerYield",position:[0,5,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0,5]}]}},default:{}},{type:"attr",position:[1,5,3]},{type:"for",position:[1,5,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[]},{type:"componentDynamic",position:[1]}]}},default:{}}]}]}},default:{}},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]}]},{type:"componentDynamic",position:[3,1,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0]},{type:"componentDynamic",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"attr",position:[1,1,1,3,1]},{type:"componentDynamic",position:[1,1,1,3,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]},{type:"attr",position:[0,3,1]},{type:"for",position:[0,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]},{type:"attr",position:[0,3,1]},{type:"for",position:[0,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}]}},default:{}},{type:"attr",position:[1,1,7]},{type:"if",position:[1,1,7],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]},{type:"attr",position:[0,3,1]},{type:"for",position:[0,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}]}},default:{}},{type:"text",position:[1,1,9,1,0]},{type:"text",position:[1,1,9,3,1]},{type:"text",position:[1,1,11,1,0]},{type:"attr",position:[1,1,11,3,1]},{type:"componentDynamic",position:[1,1,11,3,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1,1]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,9]},{type:"if",position:[1,9],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]},{type:"attr",position:[9]},{type:"registerYield",position:[9,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[9]},{type:"attr",position:[11]},{type:"registerYield",position:[11,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1,1]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"text",position:[1,5,1,1]},{type:"componentDynamic",position:[1,5,1]},{type:"componentDynamic",position:[1,5]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[11]},{type:"attr",position:[13]},{type:"registerYield",position:[13,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1,1]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[13]},{type:"attr",position:[15]},{type:"registerYield",position:[15,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[15]},{type:"attr",position:[17]},{type:"registerYield",position:[17,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"attr",position:[3,1,1]},{type:"for",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1]}]}},default:{}}]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[17]},{type:"attr",position:[19]},{type:"registerYield",position:[19,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,1,3,1,1]},{type:"componentDynamic",position:[1,1,1,3,1,1]},{type:"attr",position:[1,1,1,3,1,3]},{type:"componentDynamic",position:[1,1,1,3,1,3]},{type:"attr",position:[1,1,1,3,3]},{type:"if",position:[1,1,1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0,0]},{type:"componentDynamic",position:[0,0]}]},false:{dynamicNodes:[{type:"attr",position:[0,0]},{type:"componentDynamic",position:[0,0]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[19]},{type:"attr",position:[21]},{type:"componentDynamic",position:[21]}],_observedAttributes:["edvPopOverId","dealPopOverId","isTranslation_dropDownOpen","conversationList","mailArray","processedMails","selectedCount","mailData","dealData","moduleInfo","mailType","sentOrReceived","showModal","mailSource","cloudPayLoad","replyIndex","dealIndex","contactCardHeader","contactCard","dealArray","showDealHoverCard","showContactCardPopover","mailDetailsPopover","prevNextDisabled","nextDisabled","prevDisabled","messageId","subjectText","modalTransition","modalOffset","isNextGenUIEnabled","showLanguageList","isEmailsAIClickableSupport","showTranslate","isDataEnrichmentAvailable","dropDownLanguages","showDropDown","dropDownLanguageObj","languageobj","actualContentBackup","isTranslationAvailable","newUserLan"],data:function(){return{edvPopOverId:Lyte.attr("string",{default:"edvShowMoreMail"}),dealPopOverId:Lyte.attr("string",{default:"dealPopOverId"}),isTranslation_dropDownOpen:Lyte.attr("string",{default:""}),conversationList:Lyte.attr("array",{default:[{from:{user_name:"suryabhagavan.g+11",email:"suryabhagavan.g+11@zohocorp.com"},to:[{user_name:"suryabhagavan.g",email:"suryabhagavan.g@zohocorp.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],cc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],hasAttach:"true",subject:"All the best, do it!!!",sentiment:"Neutral",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef371",snippet:"hello I am snippet1",message_id:"3b8070baf316c8a7277e6587333baedf5567a29ab0be7dabfaffd9a88979da6a",owner:{id:"111112000000047359",name:"surya"},linked_record:{name:"zoho cliq",id:"111112000000062083"},status:[{type:"received"}]},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"}],bcc:[],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",sentiment:"Neutral",hasAttach:"true",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef3",snippet:"Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2Hello I am snippet2vvvHello I am snippet2Hello I am snippet2Hello I am snippet2",message_id:"3b8070baf316c8a7277e6587333baedf5567a29ab0be7dabfaffd9a88979da6a",linked_record:{name:"zoho cliq",id:"111112000000062083"},owner:{id:"111112000000047359",name:"surya"},status:[{type:"sent"}]},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],bcc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",sentiment:"Negative",hasAttach:"true",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef3",snippet:"Hello I am snippet2",message_id:"3b8070baf316c8a7277e6587333baedf5567a29ab0be7dabfaffd9a88979da6a",owner:{id:"111112000000047359",name:"surya"},linked_record:{name:"zoho cliq",id:"111112000000062083"},status:[{type:"received"}]},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],bcc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",sentiment:"Neutral",hasAttach:"true",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef3",snippet:"Hello I am snippet2",message_id:"3b8070baf316c8a7277e6587333baedfa72d77366ed96a1e0c7b67a6d5f78fd2",owner:{id:"111112000000047359",name:"surya"},linked_record:{name:"zoho cliq",id:"111112000000062083"},status:[{type:"sent"}]},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],bcc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",sentiment:"Neutral",hasAttach:"true",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef3",snippet:"Hello I am snippet2",message_id:"3b8070baf316c8a7277e6587333baedf3cb4f1628573e9863f6740f886ebc738",owner:{id:"111112000000047359",name:"surya"},linked_record:{name:"zoho cliq",id:"111112000000062083"},status:[{type:"received"}]},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],bcc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",sentiment:"Positive",hasAttach:"true",intent:"Query",mail_format:"text/html",editable:"true",date_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef3",snippet:"Hello I am snippet2",message_id:"3b8070baf316c8a7277e6587333baedf75cf8144e976587f074a18137ea2a962",owner:{id:"111112000000047359",name:"surya"},linked_record:{name:"zoho cliq",id:"111112000000062083"},status:[{type:"sent"}]}]}),mailArray:Lyte.attr("array",{default:[{},{from:{user_name:"sai",email:"sai@zoho.com"},to:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],cc:[{user_name:"sai",email:"sai@zoho.com"},{user_name:"surya",email:"suryabhagavan.g@zoho.com"}],reply_to:[{user_name:"sai",email:"sai@zoho.com"}],subject:"All the best, do it!!!",content:"your content your content your contentyour contentyour contentyour contentyour contentyour contentyour contentyour content",attachments:[{name:"Screenshot1.png",id:"ce457f1f6affc3d706d097b11",size:"1024123"},{name:"Screenshot2.png",id:"ce457f1f6affc22",size:"123345678"}],sentiment_details:"Negative",intent:"Query",mail_format:"text/html",editable:"true",sent_time:"2018-04-12T12:12:12+05:30",thread_id:"35e5a8f7b7c7751492abef371"},{},{},{},{}]}),processedMails:Lyte.attr("array",{default:[{},{},{},{},{},{}]}),selectedCount:Lyte.attr("array",{default:[0,0,0,0,0,0]}),mailData:Lyte.attr("object",{default:{}}),dealData:Lyte.attr("object",{default:{}}),moduleInfo:Lyte.attr("object",{default:{moduleName:"Leads",moduleId:"111112000000053709"}}),mailType:Lyte.attr("string",{default:"ALLUSERSMAILS"}),sentOrReceived:Lyte.attr("string",{default:"Sent"}),showModal:Lyte.attr("boolean",{default:!1}),mailSource:Lyte.attr("string",{default:"ALLUSERSMAILS"}),cloudPayLoad:Lyte.attr("object",{default:{}}),replyIndex:Lyte.attr("number",{default:0}),dealIndex:Lyte.attr("number",{default:0}),contactCardHeader:Lyte.attr("object",{default:{}}),contactCard:Lyte.attr("array",{default:[]}),dealArray:Lyte.attr("array",{default:[{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"},{name:"zoho cliq",id:"111112000000062083"}]}),showDealHoverCard:Lyte.attr("boolean",{default:!1}),showContactCardPopover:Lyte.attr("boolean",{default:!1}),mailDetailsPopover:Lyte.attr("boolean",{default:!1}),prevNextDisabled:Lyte.attr("boolean",{default:!1}),nextDisabled:Lyte.attr("boolean",{default:!1}),prevDisabled:Lyte.attr("boolean",{default:!1}),messageId:Lyte.attr("string",{default:"ALLUSERSMAILS"}),subjectText:Lyte.attr("string",{default:"ALLUSERSMAILS"}),modalTransition:Lyte.attr("string",{default:featuresAvailable.NEXTGENUI_ENABLED?'{"animation":"slideFromLeft"}':'{"animation":"slideFromRight"}'}),modalOffset:Lyte.attr("string",{default:featuresAvailable.NEXTGENUI_ENABLED?'{"top":"0px","left":"0px"}':'{"top":"0px","right":"0px"}'}),isNextGenUIEnabled:Lyte.attr("boolean",{default:!!featuresAvailable.NEXTGENUI_ENABLED}),showLanguageList:Lyte.attr("boolean",{default:!1}),isEmailsAIClickableSupport:Lyte.attr("boolean",{default:!1}),showTranslate:Lyte.attr("boolean",{default:!0}),isDataEnrichmentAvailable:Lyte.attr("boolean",{default:!1}),dropDownLanguages:Lyte.attr("array",{default:[{id:"Tamil",name:""},{id:"English",name:"English"},{id:"French",name:"Franais"},{id:"German",name:"Deutsch"},{id:"Italian",name:"Italiano"},{id:"Portuguese",name:"Portugus"},{id:"Spanish",name:"espaol"},{id:"Dutch",name:"Nederlands"},{id:"Assamese",name:""},{id:"Bengali",name:""},{id:"Gujarati",name:""},{id:"kannada",name:""},{id:"Malayalam",name:""},{id:"Marati",name:""},{id:"Oriya",name:""},{id:"Punjabi",name:""},{id:"Telugu",name:""},{id:"Hindi",name:""},{id:"Russian",name:""},{id:"Croatian",name:"Hrvatski"},{id:"Czech",name:"etina"},{id:"Polish",name:"Polski"},{id:"Ukrainian",name:""},{id:"Arabic",name:""},{id:"Persian",name:""},{id:"Urdu",name:""},{id:"Armenian",name:""},{id:"Georgian",name:""},{id:"Hebrew",name:""},{id:"Catalan",name:"catal"},{id:"Danish",name:"dansk"},{id:"Romanian",name:"Romn"},{id:"Swedish",name:"svenska"},{id:"Greek",name:""},{id:"Estonian",name:"eesti keel"},{id:"Finnish",name:"Suomalainen"},{id:"Serbian",name:""},{id:"Hungarian",name:"Magyar"},{id:"Japanese",name:""},{id:"Chinese",name:""},{id:"Korean",name:""},{id:"Belarusian",name:""},{id:"Bulgarian",name:""},{id:"Latvian",name:"latviski"},{id:"Lithuanian",name:"lietuvis"},{id:"Slovak",name:"slovensk"},{id:"Slovenian",name:"Slovenina"},{id:"Macedonian",name:""},{id:"Indonesian",name:"Bahasa Indonesia"},{id:"Malay",name:"Bahasa Melayu"},{id:"Tagalog",name:"Wikang Tagalog"},{id:"Filipino",name:"Wikang Filipino"},{id:"Afrikaans",name:"Afrikaans"},{id:"Albanian",name:"Gjuha shqipe"},{id:"Azerbaijani",name:" "},{id:"Basque",name:"euskara"},{id:"Esperanto",name:"Esperanto"},{id:"Galician",name:"galego"},{id:"Icelandic",name:"slenska"},{id:"Irish",name:"Gaeilge"},{id:"Khmer",name:""},{id:"Lao",name:""},{id:"Maltese",name:"Malti"},{id:"Norwegian",name:"norsk"},{id:"Thai",name:""},{id:"Turkish",name:"Trke"},{id:"Vietnamese",name:"Ting Vit"},{id:"Yiddish",name:""},{id:"Sinhala",name:""},{id:"Malagasy",name:"malagasy"},{id:"Swahili",name:""},{id:"Sundanese",name:" "}]}),showDropDown:Lyte.attr("boolean",{default:!1}),dropDownLanguageObj:Lyte.attr("object",{default:{Tamil:"",English:"English",French:"Franais",German:"Deutsch",Italian:"Italiano",Portuguese:"Portugus",Spanish:"espaol",Dutch:"Nederlands",Assamese:"",Bengali:"",Gujarati:"",Kannada:"",Malayalam:"",Marati:"",Oriya:"",Punjabi:"",Telugu:"",Hindi:"",Russian:"",Croatian:"Hrvatski",Czech:"etina",Polish:"Polski",Ukrainian:"",Arabic:"",Persian:"",Urdu:"",Armenian:"",Georgian:"",Hebrew:"",Catalan:"catal",Danish:"dansk",Romanian:"Romn",Swedish:"svenska",Greek:"",Estonian:"eesti keel",Finnish:"Suomalainen",Serbian:"",Hungarian:"Magyar",Japanese:"",Chinese:"",Korean:"",Belarusian:"",Bulgarian:"",Latvian:"latviski",Lithuanian:"lietuvis",Slovak:"slovensk",Slovenian:"Slovenina",Macedonian:"",Indonesian:"Bahasa Indonesia",Malay:"Bahasa Melayu",Tagalog:"Wikang Tagalog",Filipino:"Wikang Filipino",Afrikaans:"Afrikaans",Albanian:"Gjuha shqipe",Azerbaijani:" ",Basque:"euskara",Esperanto:"Esperanto",Galician:"galego",Icelandic:"slenska",Irish:"Gaeilge",Khmer:"",Lao:"",Maltese:"Malti",Norwegian:"norsk",Thai:"",Turkish:"Trke",Vietnamese:"Ting Vit",Yiddish:"",Sinhala:"",Malagasy:"malagasy",Swahili:"",Sundanese:" "}}),languageobj:Lyte.attr("object",{default:{iw_IL:"",en_US:"English",en_GB:"English",zh_CN:"",zh_TW:"",fr_FR:"Franais",ja_JP:"",ar_EG:"",id_ID:"Bahasa Indonesia",bg_BG:"",hr_HR:"hrvatski",cs_CZ:"etina",da_DK:"dansk",de_DE:"Deutsch",he_IL:"",hi_IN:"",hu_HU:"Magyar",it_IT:"Italiano",ko_KR:"",pt_PT:"Portugus",pt_BR:"Portugus",ru_RU:"",es_ES:"espaol",sv_SE:"svenska",pl_PL:"Polski",th_TH:"",tr_TR:"Trke",nl_NL:"Nederlands",vi_VN:"Ting Vit"}}),actualContentBackup:Lyte.attr("string"),isTranslationAvailable:Lyte.attr("boolean",{default:!1}),newUserLan:Lyte.attr("string")}},init:function(){this.setData({isEmailsAIClickableSupport:Crm.userDetails.isEmailsAIClickableSupport,isTranslationAvailable:Crm.userDetails.isTranslationAvailable}),this.replyIndex=0,this.attachIndex=-1,this.singleAttachment={},this.emailRelationId=-1,this.showContactCard=!0,this.contactCard=[]},didConnect:function(){Lyte.addEventListener("beforeRouteTransition",this.closeModal)},closeModal:function(){let e=$L("#edvModalConversation"),t=$L("#etmmModal");0!==e.length&&e[0].ltProp("show",!1),0!==t.length&&t[0].ltProp("show",!1)},didDestroy:function(){Lyte.removeEventListener("beforeRouteTransition",this.closeModal)},actions:{openActivityPopup:function(e,t,a){this.openActivityPopup(e,a)},openEnrichment:function(e,t){var a=this.getData("mailArray["+t+"]");this.openEnrichment(a)},originalChange:function(e,t,a){var i=$L(".loaderClass"),o=$L(".edvMailContent_"+a).children(),n=$L(".edvModalHeader");let s=null,l=o.length;for(let e=0;e<l;e++){var r=o[e];if(r.nodeType===Node.ELEMENT_NODE&&r.classList.contains("loaderClass")){s=r,s.classList.add("hide");break}}n.removeClass("zia_email_subject_freeze"),$L("#translateDropDown_"+a)[0].close(),e.currentSelection=this.getData("newUserLan"),e.userLan=this.getData("newUserLan"),this.setData("subjectText",e.actualSubjectBackup),e.content=e.actualContentBackup,e.subject=e.actualSubjectBackup,this.setData("subjectText",e.actualSubjectBackup),Lyte.arrayUtils(this.getData("mailArray"),"replaceAt",t,e),this.invokeBatchDownloadInlineImages(t,a),i.addClass("hide")},translateBtnAction:function(e,t,a){var i=$L(".edvMailContent_"+a),o=$L(".edvModalHeader");o.addClass("zia_email_subject_freeze"),i.addClass("zia_email_freeze_wrap");var n=document.createElement("crm-ui-loaders");n.setAttribute("class","bg_white bottom0 op08 pA w100_per top0 dF zia_email_circle_loader loaderClass"),n.setAttribute("interaction-name","crmCircleLoader"),i.append(n),e.dropDownSection=!0,e.showTranslateSection=!1;let s=e.content;e.actualContentBackup=s,e.actualSubjectBackup=e.subject;var l=e.subject;this.setData("actualContentBackup",s);var r=this.languageDetectAPICall(s),d=this;r.then((function(n){$L(".edvActive").removeClass("edvActive");var c=(n=n.zia_config).dummy.response[0].language;c=d.getLanguageNameInSpecific(c),d.setData("newUserLan",c),e.userLan=c;var m=d.getLanguage(Crm.userDetails.RELEVANT_LOCALE);if(e.currentSelection=m,m=d.getLanguageNameInEnglish(m),Crm.client_tracking("Email Translation - clicked from email view with target language of "+m),Lyte.arrayUtils(d.getData("mailArray"),"replaceAt",t,e),d.invokeBatchDownloadInlineImages(t,a),$L("#translateDropDown_"+a)[0].toggle(),c!==m)(r=d.translateAPICall(s,n,m,l)).then((function(i){i=i.zia_config,$L(".loaderClass").addClass("hide"),o.removeClass("zia_email_subject_freeze"),i&&i.dummy.translated_text?(e.content=i.dummy.translated_text,e.subject=i.dummy.translated_subject,d.setData("subjectText",i.dummy.translated_subject),Lyte.arrayUtils(d.getData("mailArray"),"replaceAt",t,e),d.invokeBatchDownloadInlineImages(t,a),$L(".edvActive").removeClass("edvActive")):(i.dummy.status&&"error"===i.dummy.status&&"LANGUAGE_NOT_SUPPORTED"===i.dummy.code||i.dummy.status&&"error"===i.dummy.status&&"INTERNAL_SERVER_ERROR"===i.dummy.code)&&_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.email.summary.error"),ltPropType:"error",ltPropSecondaryMessage:I18n.getMsg("crm.email.summary.desc"),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok.got.it"),cxPropZcqa:"button_1"}]}})}),(function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.email.translation.error"),ltPropType:"error",ltPropSecondaryMessage:I18n.getMsg("crm.email.translation.desc"),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok.got.it"),cxPropZcqa:"button_1"}]}})}));else{var p=i.children();let e=null,t=p.length;for(let a=0;a<t;a++){var u=p[a];if(u.nodeType===Node.ELEMENT_NODE&&u.classList.contains("loaderClass")){e=u,e.classList.add("hide");break}}o.removeClass("zia_email_subject_freeze")}}),(function(){o.removeClass("zia_email_subject_freeze"),$L(".loaderClass").addClass("hide"),d.errorHandling(),d.invokeBatchDownloadInlineImages(t,a)})),this.setData({showDropDown:!1,showLanguageList:!0,showTranslate:!1}),$L(".edvActive").removeClass("edvActive")},checkForPublicFields:async function(e,t){var a=JSON.parse(t.getAttribute("data-params"));if(await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(a.module,a.id,e))return!1},onwindowResize:function(){var e=$L(".edvModal").find("lyte-modal-content"),t=getComputedStyle(e[0]).maxHeight,a=parseInt(t)-30;$L(".edvMailContainer").css("min-height",a)},triggerCustomButton:function(e,t){let a=null;a="canvas"===Lyte.Router.getRouteInstance().routeName?$L('div[data-api-name="Emails"]').attr("data-id"):$L('div[ddname="EMAILSPERSONALITY"]').attr("ddid"),0!==t&&void 0===t&&(t=this.replyIndex);let i=this.getData("moduleInfo").moduleId,o=this.getData("conversationList["+t+"]").message_id,n=this.getData("moduleInfo").moduleName;var s=Object.keys(moduleApiMapping).find((function(e){return moduleApiMapping[e]===n}));let l="CB_"+a;return CustomButtonJSObjectInit.checkBox||(CustomButtonJSObjectInit.checkBox={}),this.emailRelationId=a,CustomButtonJSObjectInit.checkBox[l]=o,CustomButtonJSObjectInit.execute(e.id,"relatedlist",i,a,s)},openRecord:function(){let e=this.getData("moduleInfo");networkUtils.openUrl(Crm.getCrmBasePath()+"/EntityInfo.do?id="+e.moduleId+"&module="+e.moduleName,"_blank")},addFollowUpTask:function(){let e=this.getData("moduleInfo");Q.selectAction("NewTask","",e.moduleName,e.moduleId,"recentMailView"),$("#FreezeLayer").addClass("etTaskFreeze")},showContactCard:async function(e,t,a){let i,o,n,s;if(this.showContactCard=!0,e)n=this.getData("dealArray")[t],s=this.getData("conversationList")[t].message_id,i="Deals",o=n.id,this.setData("dealIndex",t),Lyte.objectUtils(this.getData("dealData"),"add","name",n.name),Lyte.objectUtils(this.getData("dealData"),"add","id",n.id),a?Lyte.objectUtils(this.getData("dealData"),"add","messageId","edvDealHeader_"+s):Lyte.objectUtils(this.getData("dealData"),"add","messageId","edvDealFooter_"+s);else{let e=this.getData("moduleInfo");i=e.moduleName,o=e.moduleId}commonUtils.showHideLoadingDiv(!0);var l=Lyte.resolvePromises({layout:store.findAll("layout",{module:i,mode:"business_card"},!0,!0),record_details:store.findRecord("record_details",o,{approved:"both",converted:"both"},!0,!0,{recordId:o,recordName:i})});let r=$L(".etViewPopOverActive"),d=$L(".etViewRecipientName"),c=await Lyte.registeredMixins["crm-view-utils"].getPublicFields(moduleRecordMapping[i].api_name);l.then((async function(t){let a=t.layout[0].fields,i=t.record_details.recordData,o=a.length,n=[],s=$L("crm-emailconversation-view")[0].component;if(0===Object.keys(i).length)return e&&0===c.length?(Lyte.objectUtils(s.getData("dealData"),"add","success",!1),Lyte.objectUtils(s.getData("dealData"),"add","message",I18n.getMsg("crm.security.error")),s.showContactCard&&s.setData("showDealHoverCard",!0)):0===c.length&&(commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.rightpanel.record.delete"),ltPropDuration:"3000",ltPropShow:!0}})),void commonUtils.showHideLoadingDiv(!1);Lyte.objectUtils(s.getData("dealData"),"add","success",!0);for(let e=2;e<o;e++){let t=a[e].api_name,o=a[e].field_label,s="Owner"!==t&&"Account_Name"!==t||!i[t]?i[t]:i[t].name;s="Closing_Date"===t&&i[t]?Utils.getDateInGivenPattern($L.moment(i[t]).toDate(),Crm.userDetails.DATE_PATTERN.toLowerCase()):s,s="Expected_Revenue"===t&&i[t]?i.$currency_symbol+" "+i[t]:s,s=Lyte.registeredMixins["crm-emailconversation-view-mixin"].processDisplayValue(s),n.push({display_label:o,value:s,api_name:t})}let l=s.getData("contactCard").length;for(let e=0;e<l;e++)Lyte.arrayUtils(s.getData("contactCard"),"pop");Lyte.arrayUtils(s.getData("contactCard"),"push",n),e?s.showContactCard&&s.setData("showDealHoverCard",!0):(Lyte.objectUtils(s.getData("contactCardHeader"),"add","accountName",i.Account_Name?i.Account_Name.name:null),Lyte.objectUtils(s.getData("contactCardHeader"),"add","companyName",i.Company),Lyte.objectUtils(s.getData("contactCardHeader"),"add","Record_Image",i.Record_Image),Lyte.objectUtils(s.getData("contactCardHeader"),"add","recordName",i.Last_Name),r.removeClass("etViewPopOverActive"),d.addClass("etViewPopOverActive"),s.setData("showContactCardPopover",!0)),commonUtils.showHideLoadingDiv(!1)}),(function(){let t=$L("crm-emailconversation-view")[0].component;e&&0===c.length?(Lyte.objectUtils(t.getData("dealData"),"add","success",!1),Lyte.objectUtils(t.getData("dealData"),"add","message",I18n.getMsg("crm.security.error")),t.showContactCard&&t.setData("showDealHoverCard",!0)):0===c.length&&(commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.security.error"),ltPropDuration:"3000",ltPropShow:!0}})),commonUtils.showHideLoadingDiv(!1)}))},closeContactCard:function(){commonUtils.showHideLoadingDiv(!1),this.showContactCard=!1},showDwldOptions:function(e,t,a){t.index=a,this.singleAttachment=t,$L(e).closest(".edvAttachments").addClass("edvAttachAvtive")},helpZia:function(){_cruxUtils.showCustomMessage({params:{ltPropType:"info",ltPropMessage:"feature not available yet",ltPropDuration:"3000",ltPropShow:!0}})},replyIndexUpdate:function(e){this.replyIndex=e,this.setData("replyIndex",e),this.setData("dealIndex",e)},attachIndexUpdate:function(e){this.attachIndex=e},openComposeWindow:function(e,t){let a={},i=this.getData("conversationList["+t+"]"),o="";i.to&&Array.isArray(i.to)&&i.to.length>=1&&i.to.forEach(((e,t)=>{o+=0===t?e.email:","+e.email})),a.massMailId=i.message_id,a.entId=this.getData("moduleInfo.moduleId"),a.module=this.getData("moduleInfo.moduleName"),a.entEmailId=o;var n=(void 0!==i.owner?i.owner.id:1)===Crm.userDetails.USER_ID,s=Crm.userDetails.isEmailAuthorisationEnabled;s&&void 0!==i.status[0].type&&"scheduled"===i.status[0].type&&!n?_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.email.message.schedule.mail.edit"),ltPropSecondaryMessage:I18n.getMsg("crm.email.message.schedule.mail.edit.explanation"),ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default"},{type:"accept",text:I18n.getMsg("crm.button.edit"),appearance:"primary"}]},accept:function(){openComposeView(e,a)},reject:function(){}}):s&&void 0!==i.status[0].type&&"draft"===i.status[0].type&&!n?EmailCompose.fetchDraftDetails(a.massMailId,a.module,a.entId,!0):openComposeView(e,a)},replyOption:function(e,t){if("dummyClick"===e)return;void 0===t&&(t=this.replyIndex);let a=this.getData("conversationList["+t+"]"),i=this.getData("mailArray["+t+"]"),o=this.getData("mailSource"),n=this.methods.getArrayAsString(i.to),s=this.methods.getArrayAsString(i.cc),l=this.methods.getArrayAsString(i.bcc),r=this.methods.getArrayAsString([i.from]),d=this.methods.getArrayAsString([i.reply_to]),c={msgid:a.message_id,sentOrReceived:a.status[0].type,fromAddr:r,toAddr:n,ccAddr:s,bccAddr:l,sub:i.subject,to:i.to,cc:i.cc,mailOwnerId:a.owner.id},m=this.getData("moduleInfo.moduleName"),p=Object.keys(moduleApiMapping).find((e=>moduleApiMapping[e]==m&&e!==moduleApiMapping[e]));p=p||m;let u=this.getData("moduleInfo.moduleId");if("Cases"===p&&Crm.userDetails.isEmailsForCasesModuleEnabled){var y=Lyte.Component.registeredHelpers.checkSelectedModuleInRL();y&&(p="Contacts",u=y)}replyMail(p,u,e,this.getData("mailType"),o,n,r,d,c)},printPreview:function(e,t){t||(t=this.replyIndex);let a=this.getData("moduleInfo");store.findRecord("record_details",a.moduleId,{approved:"both",converted:"both"},!0,!0,{recordId:a.moduleId,recordName:a.moduleName}).then((e=>{let a=$L("crm-emailconversation-view")[0].component,i=a.getData("conversationList["+t+"]"),o=a.getData("moduleInfo"),n={},s=a.getData("mailType");n.msgid=i.message_id,n.mailUserId=i.owner.id,n.module=o.moduleName,n.entId=o.moduleId,n.entEmailId=e.recordData.Email||e.recordData.Secondary_Email,mailPrintView(s,"",n)}),(()=>{_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.security.error"),ltPropDuration:"3000",ltPropShow:!0}})}))},closeThreadView:function(){this.setData("showModal",!1)},edvShowMoreMails:function(e,t){var a=this.getData("mailArray");this.setData("mailData",a[t]);let i="messageId_"+this.getData("conversationList["+t+"]").message_id;this.setData({edvPopOverId:i,mailDetailsPopover:!0})},linkToNewOrChangeDeal:function(){let e=this.getData("dealIndex"),t=this.getData("conversationList")[e].message_id;Crm.userDetails.isLookupAdvancedSearchEnabled?this.showLookUp(t,this.getData("moduleInfo.moduleId"),this.getData("moduleInfo.moduleName")):Crm.showLookUp(this.getData("moduleInfo.moduleName"),"assoPotential_"+t,"assoPotential_"+t,"Potentials","Potentials","rLEmail")},unlinkDeal:function(){let e=this.getData("dealIndex"),t="assoPotential_"+this.getData("conversationList")[e].message_id,a=this.getData("dealArray")[e].name,i=this.getData("dealArray")[e].id;EntityEmail.changeDealForEmail.bind(this)("dissociateDeal",t,i,a)},downloadAttachments:function(e,t,a){commonUtils.showHideLoadingDiv(!0),t&&(a=this.singleAttachment.index);let i=this.getData("moduleInfo.moduleName"),o=this.getData("moduleInfo.moduleId"),n=this.getData("conversationList["+a+"].owner.id"),s=this.getData("conversationList["+a+"].message_id"),l=this.getData("mailArray["+a+"].attachments"),r=this.getSelectedForConversation(t,this.singleAttachment,l,s,n);var d;d=t?r[0].name:"emailattachments.zip",this.downloadEmailAttachments(i,o,s,r,d,e)},addToRelatedList:function(e,t,a){commonUtils.showHideLoadingDiv(!0),a=t?this.singleAttachment.index:this.attachIndex;var i=this.getData("moduleInfo.moduleName"),o=this.getData("moduleInfo.moduleId"),n=this.getData("conversationList["+a+"].owner.id"),s=this.getData("conversationList["+a+"].message_id");let l=this.getData("mailArray["+a+"].attachments"),r=this.getSelectedForConversation(t,this.singleAttachment,l,s,n,"relatedList");this.alertMaxFileAddition(r)?commonUtils.showHideLoadingDiv(!1):this.mRforRelatedList(r,i,o,s)},addToWorkDrive:function(e,t,a){let i=this.methods.getSelectedForCloud.call(this,t,a);var o={service:"workdrive"};o.__attachments=i,this.setData("cloudPayLoad",o),this.showWorkDrive(!0)},addToCloud:function(e,t,a){let i=void 0!==this.singleAttachment.name?this.singleAttachment.name:"photo.jpeg";var o={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote",callback:this.cloudUploaderCallBack,fileName:i,title:I18n.getMsg("crm.email.threadview.add.to.cloud")};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(o.cloud_services="gdrive,box,skydrive");let n=this.methods.getSelectedForCloud.call(this,t,a);var s={};s.__attachments=n,this.setData("cloudPayLoad",s),this.loadCloudUploader(o)},previousMail:function(e){this.openPrevMail(e,"EMAIL_THREAD_VIEW")},nextMail:function(e){this.openNextMail(e,"EMAIL_THREAD_VIEW")},dealOptionsClicked:function(e,t){$L(e).addClass("edvShowDealHover"),this.setData("dealIndex",t)},imgOnError:function(e){e.onerror=null,e.src=networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM)}},methods:{onSearch:function(e){var t=$L("#searchID");e.length?t.addClass("hide"):t.removeClass("hide")},onShowOfDropdown:function(e){$L("#arrow_"+e).removeClass("zcicn-rotate-180")},onHideOfDropdown:function(e){$L("#arrow_"+e).addClass("zcicn-rotate-180")},menuSelected:function(e,t,a){switch(a){case"Activity_Suggestion":this.openActivityPopup(e,t);break;case"Help_Zia":this.openHelpZia(e,t);break;case"Enrich_data":e=this.getData("mailArray["+t+"]"),this.openEnrichment(e)}},optionSelected:function(e,t,a,i,o){var n=$L(".edvMailContent_"+a).children();let s=null,l=n.length;for(let e=0;e<l;e++){var r=n[e];if(r.nodeType===Node.ELEMENT_NODE&&r.classList.contains("loaderClass")){s=r,s.classList.remove("hide");break}}var d=$L(".edvModalHeader");d.addClass("zia_email_subject_freeze");let c=e.actualContentBackup,m=e.actualSubjectBackup;e.disableDropdown=!0,e.currentSelection=o,e.userLan=this.getData("newUserLan"),o=this.getLanguageNameInEnglish(o),Crm.client_tracking("Email Translation - selected from email view with target language of "+o),Lyte.arrayUtils(this.getData("mailArray"),"replaceAt",t,e),this.invokeBatchDownloadInlineImages(t,a);var p=this.languageDetectAPICall(c);let u=this;p.then((function(i){(i=i.zia_config?i.zia_config:i).dummy.response[0].language!==o?(p=u.translateAPICall(c,i,o,m)).then((function(i){s.classList.add("hide"),d.removeClass("zia_email_subject_freeze"),(i=i.zia_config)&&i.dummy.translated_text?(e.content=i.dummy.translated_text,e.subject=i.dummy.translated_subject,u.setData("subjectText",i.dummy.translated_subject),e.disableDropdown=!1,Lyte.arrayUtils(u.getData("mailArray"),"replaceAt",t,e),u.invokeBatchDownloadInlineImages(t,a)):(i.dummy.status&&"error"===i.dummy.status&&"LANGUAGE_NOT_SUPPORTED"===i.dummy.code||i.dummy.status&&"error"===i.dummy.status&&"INTERNAL_SERVER_ERROR"===i.dummy.code)&&_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.email.summary.error"),ltPropType:"error",ltPropSecondaryMessage:I18n.getMsg("crm.email.summary.desc"),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok.got.it"),cxPropZcqa:"button_1"}]}})}),(function(){u.errorHandling(),s.classList.add("hide"),d.removeClass("zia_email_subject_freeze"),e.disableDropdown=!1,e.content=c,e.subject=m,u.setData("subjectText",m),Lyte.arrayUtils(u.getData("mailArray"),"replaceAt",t,e),u.invokeBatchDownloadInlineImages(t,a)})):(e.disableDropdown=!1,e.content=c,e.subject=m,u.setData("subjectText",m),Lyte.arrayUtils(u.getData("mailArray"),"replaceAt",t,e),u.invokeBatchDownloadInlineImages(t,a),s.classList.add("hide"),d.removeClass("zia_email_subject_freeze"))}))},alignModal:function(){let e="mailMagnet"===this.getData("mailSource"),t=$L("#tabLayer"),a=parseInt(t.innerHeight())+t.offset().top,i=$L("#edvModalConversation"),o=$L(".etmmModal .lyteModal"),n=$L("#etmmModal"),s=$L(".edvMailAccordion"),l=$L("#wmstoolbar"),r=0,d=this.getData("isNextGenUIEnabled"),c=d&&Crm.userDetails.RTL_ENABLED?40:0;if(l.length&&(r=l.height()),e){let e=o&&o.length>0?o[0].offsetWidth:0;(!d&&Crm.userDetails.RTL_ENABLED||d&&!Crm.userDetails.RTL_ENABLED)&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame?(i[0].ltProp("offset",{top:"0px",left:e+"px"}),i[0].ltProp("height","calc(100vh - "+r+"px)")):!(!d&&Crm.userDetails.RTL_ENABLED||d&&!Crm.userDetails.RTL_ENABLED)||"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame?(d&&Crm.userDetails.RTL_ENABLED||!d&&!Crm.userDetails.RTL_ENABLED)&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame?(i[0].ltProp("offset",{top:"0px",right:e+c+"px"}),i[0].ltProp("height","calc(100vh - 28px)")):!(d&&Crm.userDetails.RTL_ENABLED||!d&&!Crm.userDetails.RTL_ENABLED)||"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame||(i[0].ltProp("offset",{top:a+"px",right:e+c+"px"}),i[0].ltProp("height","calc(100vh - "+(r+a)+"px)")):(i[0].ltProp("offset",{top:a+"px",left:e+"px"}),i[0].ltProp("height","calc(100vh - "+(r+a)+"px)")),n[0].ltProp("overlayClose",!1),o.addClass("noBxShdw"),i[0].ltProp("width","calc(100vw - 10% - "+e+"px)")}else!d&&Crm.userDetails.RTL_ENABLED||d&&!Crm.userDetails.RTL_ENABLED?i[0].ltProp("offset",{top:"0px",left:"0px"}):i[0].ltProp("offset",{top:"0px",right:c+"px"}),i[0].ltProp("height","100%"),s[0].style.height="auto",o.removeClass("noBxShdw"),i[0].ltProp("width","calc(100vw - 10%)");i[0].ltProp("freeze",!0)},getSelectedForCloud:function(e,t){t=e?this.singleAttachment.index:this.attachIndex;var a=this.getData("conversationList["+t+"].owner.id"),i=this.getData("conversationList["+t+"].message_id");let o=this.getData("mailArray["+t+"].attachments");return this.getSelectedForConversation(e,this.singleAttachment,o,i,a)},aferModalRendered:function(){let e="canvas"===Lyte.Router.getRouteInstance().routeName?$L("crm-detailview-canvas")[0]:$L("crm-detailview-header")[0];this.setData("isDataEnrichmentAvailable",0!==$L("#id").val().length&&"relatedList"===this.getData("mailSource")&&e&&e.component&&("canvas"===Lyte.Router.getRouteInstance().routeName?Crm.userDetails.isEnrichDataEnabled||e.component.data.dataEnrichmentAvailable:Crm.userDetails.isEnrichDataEnabled||e.component.data.isDataEnrichmentAvailable)&&this.getData("moduleInfo.moduleName")===e.component.data.module);let t=$L(".edvModal"),a=this.getData("isNextGenUIEnabled"),i=$L(".ts-fxd-sc"),o=$L(".lftmnu-fxd-mail");a&&o&&i&&i.length>0&&o.length>0&&i.removeClass("lftmnu-fxd-mail");let n=$L(".etmmModalLeftMnu");n&&n.length>0?(crmui.modalZIndex("lyte-modal",n.children[0],"open"),t[0].style.zIndex=parseInt(n[0].style.zIndex)-1):"salesSignal"===!this.getData("mailSource")&&"signals"===!this.getData("mailSource")&&t.css({"z-index":"98"}),$L("#edvModalConversation")[0].calculateOffset();var s=t.find("lyte-modal-content"),l=getComputedStyle(s[0]).maxHeight,r=parseInt(l)-30;$L(".edvMailContainer").css("min-height",r)},onCloseMenu:function(){$L(".edvAttachAvtive").removeClass("edvAttachAvtive")},onBeforeCloseMenu:function(e,t){return 2!==$(t.target).closest(".edvMenuItem").data("value")},onBeforeCloseSubMenu:function(e,t){return 2!==$(t.target).closest(".edvMenuItem").data("value")},selectAll:function(e,t){let a=$L(t.$node);if(a.hasClass("lyteCheckboxPartial"))return a.removeClass("lyteCheckboxPartial"),void a[0].ltProp("checked",!1);for(var i=$L(e),o=i.closest(".edvBbColor"),n=i.closest(".edvAttachAccordion").find(".edvAtchsDiv .edvAttachCheckBx"),s=n.length,l=0;l<s;l++)n[l].ltProp("checked",!0);o.find(".edvDwldOptions").removeClass("hide")},unSelectAll:function(e,t,a,i){if("click"===i){for(var o=$L(e),n=o.closest(".edvBbColor"),s=o.closest(".edvAttachAccordion").find(".edvAtchsDiv .edvAttachCheckBx"),l=s.length,r=0;r<l;r++)s[r].ltProp("checked",!1);n.find(".edvDwldOptions").addClass("hide")}},onAttachSelected:function(e,t){var a=$L(e),i=a.closest(".edvBbColor"),o=i.find(".edvSelectAllcheck"),n=0,s=i.find(".edvAttachmentCount"),l=a.closest(".edvAtchsDiv").find(".edvAttachCheckBx"),r=i.find(".edvDwldOptions"),d=i.find(".edvAtchName");a.closest(".edvAttachments").addClass("edvAttachSelected");for(var c=l.length,m=0;m<c;m++)!0===l[m].ltProp("checked")&&n++;s.text(n),n>1?d.text(I18n.getMsg("crm.email.threadview.attachments.selected")):1===n?d.text(I18n.getMsg("crm.email.threadview.attachment.selected")):1===c?d.text(I18n.getMsg("crm.email.threadview.attachment")):d.text(I18n.getMsg("Attachments")),c===n?(o.removeClass("lyteCheckboxPartial"),o[0].ltProp("checked",!0)):o.addClass("lyteCheckboxPartial"),r.removeClass("hide"),Lyte.arrayUtils(this.getData("selectedCount"),"replaceAt",t,n)},onAttachUnselected:function(e,t){var a=$L(e),i=a.closest(".edvBbColor"),o=i.find(".edvSelectAllcheck"),n=0,s=i.find(".edvAttachmentCount"),l=a.closest(".edvAtchsDiv").find(".edvAttachCheckBx"),r=i.find(".edvDwldOptions"),d=i.find(".edvAtchName");a.closest(".edvAttachments").removeClass("edvAttachSelected");for(var c=l.length,m=0;m<c;m++)!0===l[m].ltProp("checked")&&n++;s.text(n),o[0].ltProp("checked",!1),n>1?(d.text(I18n.getMsg("crm.email.threadview.attachments.selected")),o.addClass("lyteCheckboxPartial")):1===n?(d.text(I18n.getMsg("crm.email.threadview.attachment.selected")),o.addClass("lyteCheckboxPartial")):(1===c?d.text(I18n.getMsg("crm.email.threadview.attachment")):d.text(I18n.getMsg("Attachments")),s.text(c),r.addClass("hide"),o.removeClass("lyteCheckboxPartial"),o[0].ltProp("checked",!1)),Lyte.arrayUtils(this.getData("selectedCount"),"replaceAt",t,n)},beforeCloseMailContent:function(e,t){let a=this.getData("conversationList").length;var i=$L(e.target);let o=$L(t),n="INPUT"===i[0].tagName;var s=i.hasClass("edvPreventAccordion")||i.closest(".edvDealTextContainer").length||n||i.closest(".edvShowMoreOptionsConversation").length;return o.hasClass("firstOpen")&&(s=!0,o.removeClass("firstOpen")),!s&&1!==a&&(o.removeClass("edvMailOpened"),!0)},beforeCloseAttachContent:function(e){return!!e.target.classList.contains("edvDropDown")},beforeOpenAttachContent:function(e){return!!e.target.classList.contains("edvDropDown")},beforeClosePreviousMailContent:function(e){let t=$(e.target);return!(!t.hasClass("edvShowReply")&&!t.closest(".edvShowReply").length)},showPreviousMailContent:function(e){let t=$(e.target);return!(!t.hasClass("edvShowReply")&&!t.closest(".edvShowReply").length)},showMailContent:function(e,t){var a=$L(t);let i=a[0].dataset.index,o=void 0===this.getData("mailArray["+i+"]").content,n=$L(e.target);return!(n.hasClass("edvDealTextContainer")||n.hasClass("edvPreventAccordion")||n.closest(".edvPreventAccordion").length)&&($L(".edvActive").removeClass("edvActive"),a.addClass("edvActive"),this.setData("subjectText",this.getData("conversationList["+i+"]").subject),o?(this.methods.getMailContent.bind(this)(t,i),!1):(a.removeClass("firstOpen"),a.find(".edvSenderInfo").removeClass("hide"),a.find(".edvContentInfo").addClass("hide"),void a.addClass("edvMailOpened")))},onCloseMailContent:function(e,t){var a=$L(t);a.find(".edvSenderInfo").addClass("hide"),a.find(".edvContentInfo").removeClass("hide"),$L(".edvActive").removeClass("edvActive"),a.addClass("edvActive"),a.removeClass("lyteAccordionActive"),this.setData("subjectText",this.getData("conversationList["+a.data("index")+"]").subject)},showEmailDetailView:function(){let e="mailMagnet"===this.getData("mailSource"),t=$L(".currViewedMail"),a=$L("#mailNav"),i=$L("#module").val(),o="relatedList"===this.getData("mailSource")&&"Activities"!==i&&"Events"!==i&&"Tasks"!==i&&"Calls"!==i&&"Meetings"!==i,n=parseInt($L("#ernTable Lyte-tr.topband_dv_row").length),s=($L('div[ddname="EMAILSPERSONALITY"] .previous_disabled').length||$L("crm-emailsrl-canvas-view .previous_disabled").length||0===a.length)&&0===parseInt(t.attr("index")),l=($L('div[ddname="EMAILSPERSONALITY"] .next_disabled').length||$L("crm-emailsrl-canvas-view .next_disabled").length||0===a.length)&&parseInt(t.attr("index"))+1===n;o||this.setData("prevNextDisabled",!0),o&&s?this.setData({prevNextDisabled:!1,prevDisabled:!0}):o&&!s&&this.setData({prevNextDisabled:!1,prevDisabled:!1}),o&&l?this.setData({prevNextDisabled:!1,nextDisabled:!0}):o&&!l&&this.setData({prevNextDisabled:!1,nextDisabled:!1}),this.setData("showModal",!0);let r=0,d=$L(".edvBbColor"),c=this.getData("mailArray"),m=d.length,p=$L(".edvModalContent");for(let e=0;e<m;e++)if("content"in c[e]){r=e;break}let u=d.eq(r),y=u[0],v=u.find(".edvSenderInfo"),h=u.find(".edvContentInfo"),g=u.find("span.openMail"),f=this.getData("moduleInfo"),_=this.getData("conversationList")[r],b=(this.getData("mailArray")[r],_.message_id),w=$L("#"+("edvContainer_"+b)).offset().top,D=$("#edvContainer_"+b);v.removeClass("hide"),h.addClass("hide"),setTimeout((()=>{u.addClass("firstOpen edvMailOpened"),g.click(),1===m?(u.removeClass("edvActive"),D.addClass("cAuto"),u.addClass("edvSingleThreadAcc lyteAccordionActive")):(u.removeClass("edvSingleThreadAcc"),p.scrollTop(w))}),5);let L=f.moduleName,C=f.moduleId,x=_.owner.id,A=this.isValidEmail(L,_,e,this.getData("mailType"));if((o||e)&&A)if(Crm.userDetails.IMAP_STATUS){Lyte.objectUtils(this.getData("dealData"),"add","hasDealLinking",!0);let e=c[r].linked_record||c[r].linked_deal||_.linked_record;e&&(Lyte.objectUtils(this.getData("dealData"),"add","dealId",e.id),Lyte.objectUtils(this.getData("dealData"),"add","dealName",e.name))}else Lyte.objectUtils(this.getData("dealData"),"delete","hasDealLinking");else Lyte.objectUtils(this.getData("dealData"),"delete","hasDealLinking");this.batchDownloadInlineImages(L,C,b,x,y);this.getData("mailType");this.preventLinkOpen(b)},getMailContent:function(e,t){commonUtils.showHideLoadingDiv(!0);var a=$L(e);let i=this.getData("conversationList["+t+"]"),o=Crm.userDetails.isEnrichDataEnabled||this.getData("isDataEnrichmentAvailable"),n=$L("#"+i.message_id),s=a.find(".edvSenderInfo"),l=a.find(".edvContentInfo"),r=a.find("span.openMail"),d=$L(".edvActive");var c=this.getData("moduleInfo.moduleName"),m=this.getData("moduleInfo.moduleId");if("Cases"===c&&Crm.userDetails.isEmailsForCasesModuleEnabled){var p=Lyte.Component.registeredHelpers.checkSelectedModuleInRL();p&&(c="Contacts",m=p)}store.findRecord("view_email",i.message_id,{user_id:i.owner.id,message_id:i.message_id},!1,!1,{module:c,entityId:m,isConversationMail:!0}).then((e=>{let i={moduleName:e.view_email.mailData.moduleName,entityId:e.view_email.mailData.entityId,recordState:"present"};Crm.userDetails.isEnrichDataEnabled||Lyte.Component.registeredHelpers.hasEnrichment(e.view_email.mailData,i)&&o&&Lyte.Component.registeredHelpers.hasActivity(e.view_email.mailData)?e.view_email.mailData.class="br_right_border1":e.view_email.mailData.class="",e.view_email.mailData.showTranslateSection=Crm.userDetails.isTranslationAvailable,Lyte.arrayUtils(this.getData("mailArray"),"insertAt",t,e.view_email.mailData),s.removeClass("hide"),l.addClass("hide"),commonUtils.showHideLoadingDiv(!1),n.removeClass("crm-font-bold"),d.removeClass("edvActive"),a.addClass("edvActive firstOpen edvMailOpened lyteAccordionActive"),this.methods.postEmailRendered.bind(this)(a),r.click()}),(e=>{let t=e.responseText.replace("",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})}))},postEmailRendered:function(e){let t=e[0].dataset.index,a=this.getData("moduleInfo"),i=this.getData("conversationList")[t],o=this.getData("mailArray")[t],n=a.moduleName,s=a.moduleId,l=i.owner.id,r=i.message_id;this.batchDownloadInlineImages(n,s,r,l,e[0]);this.getData("mailType");var d=o.feedback_mechanism&&("Received"!==o.status[0].type||"Received"===o.status[0].type&&(o.activity_info||o.emotion||o.intent||o.sentiment_info));o.showHelpZia=!!d,this.preventLinkOpen(r),store.triggerAction("view_email","mark_as_read",{messageId:r,moduleName:n,moduleId:s,userId:l},{},"POST",{});var c=this;setTimeout((function(){c.setData("highlight_class","")}),2e3)},getArrayAsString:function(e){if(void 0===e||!Array.isArray(e)||0===e.length)return;let t="";return e.forEach((function(e,a){let i=e.email;e.user_name&&(i=e.user_name+"<"+i+">"),t=0===a?i:t+","+i})),""===t?void 0:t},closeModal:function(){this.setData("showModal",!1);let e=$L("#etmmModal"),t=this.getData("isNextGenUIEnabled"),a="mailMagnet"===this.getData("mailSource"),i=$L(".ts-fxd-sc"),o=$L(".lftmnu-fxd-mail");t&&a&&i&&i.length>0&&!(o&&o.length>0)&&i.addClass("lftmnu-fxd-mail"),$L(".etViewThreadHighight").removeClass("etViewThreadHighight"),$L(".etmmActiveMail").removeClass("etmmActiveMail"),0!==e.length&&e[0].ltProp("overlayClose",!0),$L(".etmmModal .lyteModal").removeClass("noBxShdw"),Q&&(Q.close(),hideMenu()),crmui.hidePopup("enrichPopupDiv")},onCloseDealOptionsMenu:function(){$L(".edvShowDealHover").removeClass("edvShowDealHover")}}},{mixins:["crm-emailconversation-view-mixin","crm-email-summary-mixin"]}),Lyte.Component.register("crm-email-attachments",{_template:'<template tag-name="crm-email-attachments"> <lyte-popover id="etViewAttachmentPopOver" lt-prop-show="{{showPopover}}" lt-prop-freeze="true" lt-prop="{&quot;dimmer&quot; : {&quot;opacity&quot;:&quot;0&quot;}}" lt-prop-origin-elem=".etViewMain.edViewAttachementIcon.popoverActive" lt-prop-wrapper-class="etViewPopOverClass etAttachmentViewPopOverClass " lt-prop-width="520px" lt-prop-max-height="{{maxHeight}}" lt-prop-content-padding="30px 0 15px 0" lt-prop-show-close-button="true" lt-prop-allow-multiple="true" lt-prop-placement="{{placement}}" lt-prop-duration="400" on-close="{{method(&quot;beforeClosePopOver&quot;)}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-header> <div class="dF aiCenter "> <div class="etViewCheckBoxWrapper pL15 w50"> <lyte-checkbox class="vaM etViewAttachmentPopoverHeaderChkbox" lt-prop-value="1" on-checked="{{method(\'selectAllPopOverAttachments\')}}" on-unchecked="{{method(\'deSelectAllPopOverAttachments\')}}" data-zcqa="rlattachment_selectall"></lyte-checkbox> </div> <div class="etViewHeaderCell edvHeading ellipsistext w180"> <span class="vaM crm-font-semibold etViewAttachmentInfo wsNowrap">{{getAttachmentText(attachments)}}</span> </div> <div class="etViewDownload vH etViewHeaderCell mL50"> <span class="etViewLink crm-extra-small-font-size cP wsNowrap crm-font-regular" onclick="{{action(\'download\',false)}}" data-zcqa="rlattachment_multiselect_download_as_zip">{{getI18n(\'crm.email.threadview.download.as.zip\')}}</span> </div> <div class="etViewAddToCategory vH etViewHeaderCell mL50"> <div class="pL25 etViewAddToCategoryContainer" onclick="{{action(\'showCategoryMenu\')}}" data-zcqa="rlattachment_multiselect_add_to"> <span class="etViewLink crm-extra-small-font-size cP wsNowrap etViewHeaderAddTo crm-font-regular">{{getI18n(\'crm.label.simply.add.to\')}}</span> <span class="dIB vaM cP etViewDropdown wsNowrap"></span> </div> </div> </div> </lyte-popover-header> <lyte-popover-content onscroll="{{action(\'hideAttachmentPopOver\')}}"> <lyte-table lt-prop-wrapper-class="etViewAttachmentPopOverTable " lt-prop-yield="true" cellpadding="0" cellspacing="0" class="crm-base-font-size etViewAttachmentList borderNone attachRef"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <template is="for" items="{{attachments}}" item="attachment" index="index"> <lyte-tr class="alignLeft etViewAttachmentRow h34" id="rlattachment_{{attachment.id}}"> <lyte-td class="etViewCheckBoxWrapper etViewAttachmentSection w50"> <lyte-checkbox class="vaM etViewAttachmentPopoverChkbox" lt-prop-value="1" on-checked="{{method(\'selectPopOverAttachments\')}}" on-unchecked="{{method(\'deSelectPopOverAttachments\')}}" data-zcqa="rlattachment_select_{{attachment.name}}_{{attachment.id}}"></lyte-checkbox> </lyte-td> <lyte-td class=" etViewAttachmentSection etViewAttachementName"> <div class="dF aiCenter mT3"> <crmutil-icon icon-name="{{getIconName(attachment.name)}}" icon-class="{{getIconClass(attachment.name)}}"></crmutil-icon> <lyte-text class="crm-base-font-size mR10 pL10 w200 {{getBoldClass(attachment.read)}}" lt-prop-value="{{attachment.name}}"></lyte-text> <span class="etViewRoundIcon br5 mR10"></span> <span class="crm-small-font-size etViewAttachmentSize mT2 fShrink">{{bytesToSize(attachment.size,2)}}</span> </div> </lyte-td> <lyte-td class=" etViewAttachmentSection alignRight"> <template is="if" value="{{showOptions}}"><template case="true"> <crmutil-icon class="etViewDownloadIcon mT3 cP" icon-name="download" icon-class="zcicn-download crmBaseIcon " onclick="{{action(\'download\',true,attachment)}}" data-zcqa="rlattachment_singleselect_download_{{attachment.name}}_{{attachment.id}}"></crmutil-icon> </template></template> </lyte-td> <lyte-td class="w100 etViewAttachmentSection"> <template is="if" value="{{showOptions}}"><template case="true"> <div class="etViewAddTo cP mL15" onclick="{{action(\'showCategoryMenu\',attachment)}}" data-zcqa="rlattachment_singleselect_add_to_{{attachment.name}}_{{attachment.id}}"> <span class="etViewLink crm-extra-small-font-size vaM cP">{{getI18n(\'crm.label.simply.add.to\')}}</span> <span class="dIB vaM cP etViewDropdown previewDropDown"></span> </div> </template></template> </lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </lyte-popover-content> <lyte-menu lt-prop-wrapper-class="etViewPopOverClass" lt-prop-yield="true" lt-prop-event="click" lt-prop-query=".etViewAddToCategoryContainer" lt-prop-width="auto" lt-prop-height="auto" lt-prop-position="downAlignLeft" lt-prop-callout="true"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{hasAttachmentCreatePermission(moduleInfo.moduleName)}}"><template case="true"><lyte-menu-item data-value="relatedlist" onclick="{{action(\'addToRelatedList\',false)}}" data-zcqa="rlattachment_multiselect_add_to_relatedlist"> <lyte-menu-label>{{getI18n(\'crm.email.threadview.attachment.related.list\')}}</lyte-menu-label> <lyte-menu-description></lyte-menu-description> </lyte-menu-item></template></template> <lyte-menu-item data-value="workdrive" onclick="{{action(\'addToWorkDrive\',false)}}" data-zcqa="rlattachment_multiselect_add_to_workdrive"> <lyte-menu-label>{{getI18n(\'crm.email.threadview.work.drive\')}}</lyte-menu-label> <lyte-menu-description></lyte-menu-description> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-menu id="attachmentsAddtionPopover" lt-prop-wrapper-class="etViewPopOverClass" lt-prop-query-class="lyteMenuSelected" lt-prop-yield="true" lt-prop-event="click" lt-prop-query=".etViewAddTo" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-position="downAlignLeft" lt-prop-callout="true" on-open="{{method(\'addRowHighlight\')}}" on-close="{{method(\'removeRowHighlight\')}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{hasAttachmentCreatePermission(moduleInfo.moduleName)}}"><template case="true"><lyte-menu-item data-value="relatedlist" onclick="{{action(\'addToRelatedList\',true)}}" data-zcqa="rlattachment_singleselect_add_to_relatedlist"> <lyte-menu-label>{{getI18n(\'crm.email.threadview.attachment.related.list\')}}</lyte-menu-label> <lyte-menu-description></lyte-menu-description> </lyte-menu-item></template></template> <lyte-menu-item data-value="workdrive" onclick="{{action(\'addToWorkDrive\',true)}}" data-zcqa="rlattachment_singleselect_add_to_workdrive"> <lyte-menu-label>{{getI18n(\'crm.email.threadview.work.drive\')}}</lyte-menu-label> <lyte-menu-description></lyte-menu-description> </lyte-menu-item> <lyte-menu-item data-value="otherclouddrives" onclick="{{action(\'addToCloud\',true)}}" data-zcqa="rlattachment_singleselect_add_to_cloud"> <lyte-menu-label>{{getI18n(\'crm.email.threadview.other.cloud.services\')}}</lyte-menu-label> <lyte-menu-description></lyte-menu-description> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"attr",position:[1,1,5,1]},{type:"text",position:[1,1,5,1,0]},{type:"attr",position:[1,1,7,1]},{type:"text",position:[1,1,7,1,1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"attr",position:[1,3,1,3]},{type:"componentDynamic",position:[1,3,1,3]},{type:"text",position:[1,3,1,7,0]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,5]},{type:"attr",position:[1,7,1]},{type:"if",position:[1,7,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]}]}},default:{}},{type:"componentDynamic",position:[1,7]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1,0]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0,3]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3,3]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1,0]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0,3]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3,3]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"text",position:[1,5,1,0]},{type:"componentDynamic",position:[1,5,1]},{type:"componentDynamic",position:[1,5,3]},{type:"componentDynamic",position:[1,5]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["attachments","moduleInfo","cloudPayLoad","showOptions","showPopover","placement","maxHeight"],data:function(){return{attachments:Lyte.attr("array",{default:[{owner:{id:0x18abfc67a493900},size:16415,name:"Screenshot from 2021-10-08 13-54-32.png",message_id:"3b8070baf316c8a7277e6587333baedfe83ad9d82aa04e738c5323224f0e4f70",id:"ce457f1f6affc3d706d097b5ffa574f8dcbdb00c9b6f792c9f959614754d386298abf94a5ae6edeeb7be9227687088639adf5e5379a72689b0f3d1b612ad0080"},{owner:{id:0x18abfc67a493900},size:189615,name:"Screenshot from 2021-10-13 15-57-24.png",message_id:"3b8070baf316c8a7277e6587333baedfe83ad9d82aa04e738c5323224f0e4f70",id:"ce457f1f6affc3d706d097b5ffa574f8937b952e0f716f953949d4067bccff789c88e263fd3d143e19450bdd93ff278e9adf5e5379a72689b0f3d1b612ad0080"},{owner:{id:0x18abfc67a493900},size:22056,name:"Screenshot from 2021-10-11 10-04-50.png",message_id:"3b8070baf316c8a7277e6587333baedfe83ad9d82aa04e738c5323224f0e4f70",id:"ce457f1f6affc3d706d097b5ffa574f828b9d9f4774acba35db2f30cd0786f00ad747c36df222d2073508efcb36736a89adf5e5379a72689b0f3d1b612ad0080"},{owner:{id:0x18abfc67a493900},size:54701,name:"Screenshot from 2021-10-13 17-12-20.png",message_id:"3b8070baf316c8a7277e6587333baedfe83ad9d82aa04e738c5323224f0e4f70",id:"ce457f1f6affc3d706d097b5ffa574f8cf12c28e1d103852a6d89a6715bbd9604afbc04689dca5a9b5f2c3761b36fd649adf5e5379a72689b0f3d1b612ad0080"}]}),moduleInfo:Lyte.attr("object",{default:{moduleName:"Leads",moduleId:"111112000000053709"}}),cloudPayLoad:Lyte.attr("object",{default:{}}),showOptions:Lyte.attr("boolean",{default:!0}),showPopover:Lyte.attr("boolean",{default:!1}),placement:Lyte.attr("string",{default:"bottom"}),maxHeight:Lyte.attr("string",{default:"300px"})}},init:function(){this.singleAttachment={},this.asyncCall=!1},actions:{download:function(e,t){commonUtils.showHideLoadingDiv(!0);let a=this.getData("attachments"),i=this.getSelectedForPreview(e,t,a);var o,n=this.getData("moduleInfo.moduleName"),s=this.getData("moduleInfo.moduleId");o=e?i[0].name:"emailattachments.zip",this.asyncCall=!0,this.downloadEmailAttachments(n,s,void 0,i,o,void 0)},addToRelatedList:function(e){commonUtils.showHideLoadingDiv(!0);let t=this.getData("attachments"),a=this.getSelectedForPreview(e,this.singleAttachment,t,"relatedList");var i=this.getData("moduleInfo.moduleName"),o=this.getData("moduleInfo.moduleId");this.alertMaxFileAddition(a)?commonUtils.showHideLoadingDiv(!1):(this.asyncCall=!0,this.mRforRelatedList(a,i,o))},addToCloud:function(e){let t=this.getData("attachments"),a=this.getSelectedForPreview(e,this.singleAttachment,t);var i={};i.__attachments=a,this.setData("cloudPayLoad",i);let o=void 0!==this.singleAttachment.name?this.singleAttachment.name:"photo.jpeg";var n={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote",callback:Lyte.registeredMixins["crm-emailconversation-view-mixin"].attachmentPreviewCloud,fileName:o,title:"Add attachment to the cloud"};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(n.cloud_services="gdrive,box,skydrive,dropbox"),this.asyncCall=!0,this.loadCloudUploader(n)},addToWorkDrive:function(e){let t=this.getData("attachments"),a=this.getSelectedForPreview(e,this.singleAttachment,t);var i={service:"workdrive"};i.__attachments=a,this.setData("cloudPayLoad",i),this.asyncCall=!0,Lyte.registeredMixins["crm-emailconversation-view-mixin"].showWorkDrive()},showCategoryMenu:function(e){this.singleAttachment=e},hideAttachmentPopOver:function(){$L("#attachmentsAddtionPopover")[0].ltProp("show",!1)}},methods:{selectPopOverAttachments:function(){for(var e=$L(".etViewHeaderCell .etViewAttachmentInfo"),t=$L(".etViewAttachmentPopoverHeaderChkbox"),a=0,i=$(".etViewAttachmentPopoverChkbox"),o=i.length,n=0;n<o;n++)!0===i[n].ltProp("checked")&&a++;a?($L(".etViewDownload").removeClass("vH"),$L(".etViewAddToCategory").removeClass("vH")):($L(".etViewDownload").addClass("vH"),$L(".etViewAddToCategory").addClass("vH"));let s=0===a;this.setData("showOptions",s),e[0].innerText=a>1?a+" "+I18n.getMsg("crm.email.threadview.attachments.selected"):1===a?a+" "+I18n.getMsg("crm.email.threadview.attachment.selected"):1===o?a+" "+I18n.getMsg("crm.email.threadview.attachment"):a+" "+I18n.getMsg("Attachments"),o===a?(t.removeClass("lyteCheckboxPartial"),t[0].ltProp("checked",!0)):t.addClass("lyteCheckboxPartial")},deSelectPopOverAttachments:function(){let e=$L(".etViewHeaderCell .etViewAttachmentInfo"),t=$L(".etViewAttachmentPopoverHeaderChkbox"),a=0,i=$(".etViewAttachmentPopoverChkbox"),o=i.length;for(let e=0;e<o;e++)!0===i[e].ltProp("checked")&&a++;a?($L(".etViewDownload").removeClass("vH"),$L(".etViewAddToCategory").removeClass("vH")):($L(".etViewDownload").addClass("vH"),$L(".etViewAddToCategory").addClass("vH"));let n=0===a;this.setData("showOptions",n),a>1?(e[0].innerText=a+" "+I18n.getMsg("crm.email.threadview.attachments.selected"),t.addClass("lyteCheckboxPartial")):1===a?(e[0].innerText=a+" "+I18n.getMsg("crm.email.threadview.attachment.selected"),t.addClass("lyteCheckboxPartial")):(e[0].innerText=1===o?o+" "+I18n.getMsg("crm.email.threadview.attachment"):o+" "+I18n.getMsg("Attachments"),t.removeClass("lyteCheckboxPartial"),t[0].ltProp("checked",!1))},selectAllPopOverAttachments:function(e,t){let a=$L(t.$node);if(a.hasClass("lyteCheckboxPartial"))return a.removeClass("lyteCheckboxPartial"),void a[0].ltProp("checked",!1);for(var i=$L(".etViewAttachmentList")[0].querySelectorAll("lyte-checkbox"),o=i.length,n=0;n<o;n++)i[n].ltProp("checked",!0)},deSelectAllPopOverAttachments:function(e,t,a,i){if("click"===i)for(var o=$L(".etViewAttachmentList")[0].querySelectorAll("lyte-checkbox"),n=o.length,s=0;s<n;s++)o[s].ltProp("checked",!1)},addRowHighlight:function(e,t){$L(t.target).closest(".etViewAttachmentRow").addClass("etViewAttachmentRowHover")},removeRowHighlight:function(){$L(".etViewAttachmentRowHover").removeClass("etViewAttachmentRowHover")},beforeClosePopOver:function(){this.asyncCall||$L(".etViewThreadHighight").removeClass("etViewThreadHighight")}}},{mixins:["crm-emailconversation-view-mixin"]}),Lyte.Component.register("crm-mailmagnet-view",{_template:'<template tag-name="crm-mailmagnet-view"> <lyte-modal id="etmmModal" lt-prop-overlay-close="true" lt-prop-height="{{modalHeight}}" lt-prop-show="{{lbind(showModal)}}" lt-prop-close-on-escape="false" lt-prop-width="360px" lt-prop-wrapper-class="etmmModal {{if(isNextGenUIEnabled,&quot;etmmModalLeftMnu&quot;,&quot;&quot;)}}" lt-prop-allow-multiple="true" lt-prop-transition="{{modalTransition}}" lt-prop-offset="{{modalOffset}}" lt-prop-freeze="false" lt-prop-show-close-button="false" on-before-show="{{method(\'setIconActive\')}}" on-show="{{method(&quot;aferModalRendered&quot;)}}" on-before-close="{{method(\'removeIconActive\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="etmmModalHeader"> <div class="flexAlignCenter spaceBetween"> <span class="crm-font-bold edvHeading crm-subheading-font-size">{{getI18n(\'crm.email.mailmagnet.name\')}}</span> <crmutil-icon class="cP vaM" icon-name="close-9" icon-class="zcicn-close-9 crmBaseIcon zcicn12" onclick="{{action(\'closeMailMagnetModal\')}}" data-zcqa="mailmagnet_close"></crmutil-icon> </div> </lyte-modal-header> <lyte-modal-content class="p0 etmmModalContent"> <lyte-tabs class="etmmMailCategoryTab lyteOuterTab" lt-prop-hover="lyteOuterTabHover" lt-prop-height="auto" on-before-open="{{method(\'tabChanged\')}}"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="pL12"> <lyte-tab-title class="activeTab edvHeading crm-base-font-size pR" lt-prop-id="all" data-zcqa="mailmagnet_all_tab"> <span class="etmmHeaderText">{{getI18n(\'gs.all\')}}</span> </lyte-tab-title> <lyte-tab-title class="edvHeading crm-base-font-size pR" lt-prop-id="unread" data-zcqa="mailmagnet_unread_tab"> <span class="etmmHeaderText">{{getI18n(\'crm.label.unread\')}}</span> </lyte-tab-title> </lyte-tab-head> <lyte-tab-body class="p0"> <lyte-tab-content class="pL0 etmmTabContent" id="all"> <ul class="edvBlack m0 p0"> <template is="if" value="{{expHandlers(expHandlers(mailList,\'&amp;&amp;\',mailList.length),\'&amp;&amp;\',tabSwitch)}}"><template case="true"> <template is="for" items="{{mailList}}" item="mail" index="index"> <li class="{{concat(getMailMagnetUnreadClass(mail,readMessages,index,\'etmmunread\'),\' etmmmailthread pR \',getOpenedClassMailMagnet(mail,openedEmail))}}" id="mailmagent_{{mail.message_id}}" data-mailmagnet-index="{{index}}" onclick="{{action(\'openEmailThread\',index)}}" data-zcqa="mailmagnet_open_email_{{mail.subject}}_{{mail.message_id}}"> <div class="etmmMailActiveBrdr"></div> <div class="etmmMailListContainer"> <div class="flexAlignCenter spaceBetween mB10"> <div class="flexAlignCenter"> <img class="etmmprofilepic" src="{{getMailMagnetImageUrl(mail)}}" alt="error" onerror="{{action(\'imgOnError\',this)}}"> <div class="mL10 minw200"> <div class="mtmmusrname dF aiCenter ellipsistext w180 {{getMailMagnetUnreadClass(mail,\'crm-font-bold\')}} crm-base-font-size mB2"> <lyte-text lt-prop-value="{{mail.record.name}}"></lyte-text> <template is="if" value="{{expHandlers(expHandlers(mail.sentiment_info,\'&amp;&amp;\',expHandlers(mail.sentiment_info,\'!==\',\'Neutral\')),\'&amp;&amp;\',expHandlers(mail.sentiment_info,\'!==\',\'Consecutive Negative\'))}}"><template case="true"><crmutil-icon class="mL10" icon-name="{{getSentimentIconUtilName(mail.sentiment_info)}}" icon-class="{{getSentimentIconUtilClass(mail.sentiment_info)}}"></crmutil-icon></template><template case="false"><template is="if" value="{{expHandlers(mail.sentiment_info,\'&amp;&amp;\',expHandlers(mail.sentiment_info,\'!==\',\'Neutral\'))}}"><template case="true"><crmutil-icon class="mR10" icon-name="frustration" icon-class="zcicn-frustration zcicn-red-bg-filled" data-value="CNS" name="sentimenticon_{{mail.message_id}}" data-zcqa="CNS_{{mail.message_id}}"></crmutil-icon></template></template></template></template> </div> <template is="if" value="{{expHandlers(mail.Account_Name,\'||\',mail.Company)}}"><template case="true"><div class="crm-base-font-size w180"><lyte-text lt-prop-value="{{getCompanyOrAccount(mail)}}"></lyte-text></div></template></template> </div> </div> <div class="etmmtimestamp crm-small-font-size etmmDateNTime w70 alignRight"><lyte-text lt-prop-value="{{getMailMagnetDateNTime(mail.received_date)}}"></lyte-text></div> </div> <div class="crm-base-font-size etNoWrap w300"> <template is="if" value="{{mail.has_attachment}}"><template case="true"> <crmutil-icon icon-name="attachment" class="dIB vaM" icon-class="zcicn-attachment crmBaseIcon "></crmutil-icon> </template></template> <lyte-text class="vaM" lt-prop-value="{{mail.subject}}"></lyte-text> </div> </div> </li> </template> </template><template case="false"> <div class="p10 pT30 aligncenter">{{getI18n(\'crm.email.mailmagnet.no.new.messages\')}}</div> </template></template> </ul> </lyte-tab-content> <lyte-tab-content class="pL0 etmmTabContent" id="unread"> <ul class="edvBlack m0 p0"> <template is="if" value="{{expHandlers(isMailMagnetListEmpty(mailList),\'&amp;&amp;\',tabSwitch)}}"><template case="true"> <template is="for" items="{{mailList}}" item="mail" index="index"> <template is="if" value="{{isUnreadMailMagnet(mail)}}"><template case="true"> <li class="{{concat(getMailMagnetUnreadClass(mail,readMessages,index,\'etmmunread\'),\' etmmmailthread pR \',getOpenedClassMailMagnet(mail,openedEmail))}}" id="mailmagent_{{mail.message_id}}" onclick="{{action(\'openEmailThread\',index)}}" data-zcqa="mailmagnet_open_email_{{mail.message_id}}"> <div class="etmmMailActiveBrdr"></div> <div class="etmmMailListContainer"> <div class="flexAlignCenter spaceBetween mB10"> <div class="flexAlignCenter"> <img class="etmmprofilepic" src="{{getMailMagnetImageUrl(mail)}}" alt="error" onerror="{{action(\'imgOnError\',this)}}"> <div class="mL10 minw200"> <div class="mtmmusrname dF aiCenter ellipsistext w180 crm-font-bold crm-base-font-size mB2"> <lyte-text lt-prop-value="{{mail.record.name}}"></lyte-text> <template is="if" value="{{expHandlers(mail.sentiment_info,\'&amp;&amp;\',expHandlers(mail.sentiment_info,\'!==\',\'Neutral\'))}}"><template case="true"><crmutil-icon class="mL10" icon-name="{{getSentimentIconUtilName(mail.sentiment_info)}}" icon-class="{{getSentimentIconUtilClass(mail.sentiment_info)}}"></crmutil-icon></template></template> </div> <div class="crm-base-font-size w180"><lyte-text lt-prop-value="{{getCompanyOrAccount(mail)}}"></lyte-text></div> </div> </div> <div class="etmmtimestamp crm-small-font-size etmmDateNTime w70 alignRight"><lyte-text lt-prop-value="{{getMailMagnetDateNTime(mail.received_date)}}"></lyte-text></div> </div> <div class="crm-base-font-size etNoWrap w300"> <template is="if" value="{{mail.has_attachment}}"><template case="true"> <crmutil-icon icon-name="attachment" class="dIB vaM" icon-class="zcicn-attachment crmBaseIcon "></crmutil-icon> </template></template> <lyte-text class="vaM" lt-prop-value="{{mail.subject}}"></lyte-text> </div> </div> </li> </template></template> </template> </template><template case="false"> <div class="p10 pT30 aligncenter">{{getI18n(\'crm.email.mailmagnet.no.unread.messages\')}}</div> </template></template> </ul> </lyte-tab-content> </lyte-tab-body> </template> </lyte-tabs> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,3]},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1,1]},{type:"if",position:[3,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,3,1,1,1]},{type:"attr",position:[1,3,1,1,3,1]},{type:"attr",position:[1,3,1,1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1,3,1,1]},{type:"attr",position:[1,3,1,1,3,1,3]},{type:"if",position:[1,3,1,1,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1,1,3,3]},{type:"if",position:[1,3,1,1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0,0]},{type:"componentDynamic",position:[0,0]}]}},default:{}},{type:"attr",position:[1,3,1,3,0]},{type:"componentDynamic",position:[1,3,1,3,0]},{type:"attr",position:[1,3,3,1]},{type:"if",position:[1,3,3,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,3,3]},{type:"componentDynamic",position:[1,3,3,3]}]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3,1,1]},{type:"if",position:[3,3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,3,1,1,1]},{type:"attr",position:[1,3,1,1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1,3,1,1]},{type:"attr",position:[1,3,1,1,3,1,3]},{type:"if",position:[1,3,1,1,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[1,3,1,1,3,3,0]},{type:"componentDynamic",position:[1,3,1,1,3,3,0]},{type:"attr",position:[1,3,1,3,0]},{type:"componentDynamic",position:[1,3,1,3,0]},{type:"attr",position:[1,3,3,1]},{type:"if",position:[1,3,3,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,3,3]},{type:"componentDynamic",position:[1,3,3,3]}]}},default:{}}]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["mailList","renderUnread","modalHeight","openedEmail","readMessages","tabSwitch","modalTransition","modalOffset","isNextGenUIEnabled","showModal"],data:function(){return{mailList:Lyte.attr("array",{default:[]}),renderUnread:Lyte.attr("boolean",{default:!1}),modalHeight:Lyte.attr("string",{default:"100%"}),openedEmail:Lyte.attr("string",{default:""}),readMessages:Lyte.attr("array",{default:[]}),tabSwitch:Lyte.attr("boolean",{default:!0}),modalTransition:Lyte.attr("string",{default:featuresAvailable.NEXTGENUI_ENABLED?'{"animation":"slideFromLeft"}':'{"animation":"slideFromRight"}'}),modalOffset:Lyte.attr("string",{default:featuresAvailable.NEXTGENUI_ENABLED?'{"top":"0px","left":"40px"}':'{"top":"0px","right":"0px"}'}),isNextGenUIEnabled:Lyte.attr("boolean",{default:!!featuresAvailable.NEXTGENUI_ENABLED}),showModal:Lyte.attr("boolean",{default:!1})}},init:function(){this.listenerId=!1},didConnect:function(){this.listenerId=Lyte.addEventListener("beforeRouteTransition",this.closeModal)},closeModal:function(){let e=$L("#etmmModal");0!==e.length&&e[0].ltProp("show",!1)},didDestroy:function(){Lyte.removeEventListener(this.listenerId)},actions:{closeMailMagnetModal:function(){$L("#etmmModal")[0].ltProp("show",!1);let e=$L("#edvModalConversation");0!==e.length&&e[0].ltProp("show",!1)},openEmailThread:function(e){this.getData("readMessages").push(e);let t=$L('[data-mailmagnet-index="'+e+'"]').closest(".etmmmailthread");setTimeout((()=>{t.removeClass("etmmunread")}),0),$L(".etmmActiveMail").removeClass("etmmActiveMail"),t.addClass("etmmActiveMail");let a="ZMAIL";Crm.userDetails.isMailAppsUser||(a="GMail");let i=this.getData("mailList")[e];this.setData("openedEmail",i.message_id),i.showTranslateSection=Crm.userDetails.isTranslationAvailable,Crm.userDetails.EMAIL_THREAD_VIEW&&emailThreadViewForSignal(i.message_id,Crm.userDetails.USER_ID,i.record.module.name,i.record.id,a,"Received",void 0,void 0,void 0,i.message_id,"mailMagnet")},imgOnError:function(e){e.onerror=null,e.src=networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM)}},methods:{updateReadStatus:function(){let e=this.getData("readMessages").length;for(let t=0;t<e;t++){let e=this.getData("readMessages")[t],a=this.getData("mailList")[e];a.read=!0,Lyte.arrayUtils(this.getData("mailList"),"replaceAt",e,a)}},setIconActive:function(){let e,t=$L("#etmmModal"),a=$L("#tabLayer"),i=parseInt(a.innerHeight())+a.offset().top,o=this.getData("isNextGenUIEnabled"),n=o?"40px":"0px";"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame?(e=$L("#wms-chatwindowcontainer").height(),!o&&Crm.userDetails.RTL_ENABLED||o&&!Crm.userDetails.RTL_ENABLED?t[0].ltProp("offset",{top:"0px",left:n}):t[0].ltProp("offset",{top:"0px",right:n})):(e=$L("#wms-chatwindowcontainer").height()+i,!o&&Crm.userDetails.RTL_ENABLED||o&&!Crm.userDetails.RTL_ENABLED?t[0].ltProp("offset",{top:i+"px",left:n}):t[0].ltProp("offset",{top:i+"px",right:n}));let s="calc(100% - "+e+"px)";this.setData("modalHeight",s)},removeIconActive:function(){if($L("#etmmModal")[0].ltProp("overlayClose",!0),$L(".mailmagnetIconActive").removeClass("mailmagnetIconActive"),featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.actions.updateNavActiveClassForBottomMenu("leftPaneMail",!1)}},aferModalRendered:function(){if(featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.actions.updateNavActiveClassForBottomMenu("leftPaneMail",!0)}},tabChanged:function(e,t,a,i,o){let n=$L("#edvModalConversation");0!==n.length&&n[0].ltProp("show",!1),this.setData("openedEmail",""),this.methods.updateReadStatus.call(this),this.setData("tabSwitch",!1),this.setData("tabSwitch",!0);let s=$(o),l=$(i);s.removeClass("activeTab"),l.addClass("activeTab"),"unread"===l.attr("lt-prop-id")?this.setData("renderUnread",!0):this.setData("renderUnread",!1)},openMailMagnet:function(){this.setData("showModal",!0)}}}),store.registerModel("conversations",{conversation:Lyte.attr("array"),id:Lyte.attr("string",{primaryKey:!0})},{actions:{link_record:{}}}),store.registerAdapter("conversations",{namespace:"crm",buildURL:function(e,t,a,i,o,n,s){return o=n?o.replace("conversations/actions/"+n,"v2.2/"+s.module+"/"+s.entityId+"/Emails/actions/"+n):o.replace("conversations/"+a.thread_id,"v2.2/"+s.module+"/"+s.entityId+"/Emails/__conversations")}}),store.registerSerializer("conversations",{payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a,i,o,n,s){var l={},r={};return l.id=s.thread_id,l.conversation=a.__conversations,r.conversations=l,r}}),store.registerModel("view_email",{mailData:Lyte.attr("object"),id:Lyte.attr("string",{primaryKey:!0})},{actions:{mark_as_read:{},link_record:{}}}),store.registerAdapter("view_email",{namespace:"crm",buildURL:function(e,t,a,i,o,n,s){return o=n?o.replace("view_email/actions/mark_as_read","v2.2/"+s.moduleName+"/"+s.moduleId+"/Emails/"+s.messageId+"/actions/mark_as_read"):o.replace("view_email/"+a.message_id,"v2/"+s.module+"/"+s.entityId+"/Emails")}}),store.registerSerializer("view_email",{serialize:function(e,t,a,i,o,n,s){if(s){let e={},t={};return e.owner={id:i.userId},t.Emails=[e],t}return t},payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a,i,o,n,s,l){var r={};if(r.id=s.message_id,EmailCompose&&EmailCompose.aiData&&(EmailCompose.aiData.entityId=l.entityId,EmailCompose.aiData.module=l.module,EmailCompose.aiData.msgid=s.message_id),r.mailData=a.email_related_list[0],r.mailData.attachments.forEach((e=>{e.size||(e.size="12137")})),l.isConversationMail){let e=r.mailData.content,t=(new DOMParser).parseFromString(e,"text/html"),a=t.querySelector(".zcrm_prevMail");if(a){let e=t.cloneNode(!0).querySelectorAll("style");e.forEach((e=>{a.append(e)})),r.mailData.previous_content=a.outerHTML;let i=t.getElementsByTagName("html")[0];a.remove(),e.forEach((e=>{i.append(e)})),r.mailData.content=i.outerHTML}}return r.mailData&&r.mailData.mail_format&&"text"==r.mailData.mail_format&&(r.mailData.content=r.mailData.content.replaceAll("<","&lt;"),r.mailData.content=r.mailData.content.replaceAll(">","&gt;"),r.mailData.content=r.mailData.content.replaceAll("\n","<br>")),a.view_email=r,a}}),store.registerModel("email_column_widths",{type:Lyte.attr("string",{primaryKey:!0}),subject:Lyte.attr("number"),sentiment:Lyte.attr("number"),intent:Lyte.attr("number"),emotion:Lyte.attr("number"),date:Lyte.attr("number"),source:Lyte.attr("number"),sentby:Lyte.attr("number"),status:Lyte.attr("number"),content:Lyte.attr("number"),fromaddress:Lyte.attr("number"),default_configuration:Lyte.attr("boolean")}),store.registerAdapter("email_column_widths",{namespace:"crm/v2.2/settings/email_related_list_configuration",buildURL:function(e,t,a,i,o){return o="update"===t||"findAll"===t?o.replace("/email_column_widths",""):o.replace("/email_column_widths/"+Crm.userDetails.USER_ID,"")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("email_column_widths",{serialize:function(){let e={subject:"Subject",sentiment:"Sentiment",intent:"Intent",emotion:"Emotion",date:"Date",source:"Source",sentby:"Sent By",status:"Status",content:"Content",fromaddress:"From Address"},t=store.peekAll("email_column_widths"),a=[],i={},o=[],n=t.length;for(let s=0;s<n;s++){let n=t[s];o=Lyte.registeredMixins["crm-emailconversation-view-mixin"].populateColumns(n,e),i={},i.type=n.type,i.default_configuration=!!n.default_configuration,i.columns=o,a.push(i)}let s={};return s.email_related_list_configuration={column_widths:a},s},payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a){let i={Subject:"subject",Sentiment:"sentiment",Intent:"intent",Emotion:"emotion",Date:"date",Source:"source","Sent By":"sentby",Status:"status",Content:"content","From Address":"fromaddress"};if("update"!==t){let e=[],t={},o={},n=a.email_related_list_configuration.column_widths,s=n.length;for(let t=0;t<s;t++){let a=n[t],s=a.type,l=a.default_configuration,r=a.columns,d=r.length;o={},o.type=s,o.default_configuration=l;for(let e=0;e<d;e++){let t=r[e];o[i[t.name]]=t.width}e.push(o)}return t.email_column_widths=e,t}return!0}}),store.registerModel("emails_rl_attachments",{attachmentData:Lyte.attr("array"),id:Lyte.attr("string")},{actions:{download_attachment:{attachmentData:[],meta:{}},add_to_cloud:{},add_to_attachments:{}}}),store.registerAdapter("emails_rl_attachments",{namespace:"crm",buildURL:function(e,t,a,i,o,n,s){let l=a.thread_id?a.thread_id:a.message_id;return o="add_to_cloud"===n?o.replace("emails_rl_attachments/actions/add_to_cloud","v2.2/"+s.meta.module+"/"+s.meta.entityId+"/Emails/__attachments/actions/add_to_cloud"):"add_to_attachments"===n?o.replace("emails_rl_attachments/actions/add_to_attachments","v2.2/"+s.meta.module+"/"+s.meta.entityId+"/Emails/actions/add_to_attachments"):o.replace("emails_rl_attachments/"+l,"v2.2/"+s.meta.module+"/"+s.meta.entityId+"/Emails/__attachments")},headersForRequest:function(e,t,a){var i=this.$super.headersForRequest();return a.meta.addHeader&&(i.downloadMode=!0),i}}),store.registerSerializer("emails_rl_attachments",{payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a,i,o,n,s,l){let r;return r=s?{emails_rl_attachments:{id:s.thread_id||s.message_id,attachmentData:a.__attachments}}:{emails_rl_attachments:{id:l.meta.userId}},r}}),store.registerModel("record_details",{recordData:Lyte.attr("object"),id:Lyte.attr("string")}),store.registerAdapter("record_details",{namespace:"crm",buildURL:function(e,t,a,i,o,n,s){return o=s.recordName?o.replace("record_details","v2.2/"+s.recordName):o.replace("record_details","v2.2/Deals")}}),store.registerSerializer("record_details",{payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a,i,o,n,s,l){let r=a&&a.data?a.data[0]:{};return{record_details:{id:l.recordId,recordData:r}}}}),store.registerModel("mail_magnet",{mails:Lyte.attr("array"),user_id:Lyte.attr("string",{primaryKey:!0})},{actions:{count_reset:{}}}),store.registerAdapter("mail_magnet",{namespace:"crm/email/v2",buildURL:function(e,t,a,i,o){return o=o.replaceAll("mail_magnets","mail_magnet")}}),store.registerSerializer("mail_magnet",{payloadKey:function(e){return e+""},normalizeResponse:function(e,t,a){let i;return"findAll"===t?(i={mail_magnet:{user_id:Crm.userDetails.USER_ID,mails:a.mail_magnet}},i):a}}),Lyte.Mixin.register("crm-emailconversation-view-mixin",{downloadEmailAttachments:function(e,t,a,i,o,n){var s="/crm/v2.2/"+e+"/"+t+"/Emails/__attachments/actions/download",l=JSON.stringify({__attachments:i}),r=new XMLHttpRequest;r.open("POST",s),r.setRequestHeader("X-ZCSRF-TOKEN",csrfParamName+"="+cookieUtils.getCookie("crmcsr")),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.setRequestHeader("X-CRM-ORG",crmZgid),r.responseType="blob","emailattachments.zip"===o&&r.setRequestHeader("downloadMode","application/zip"),commonUtils.showHideLoadingDiv(!0),r.onload=function(e){if(200===e.currentTarget.status&&e.currentTarget.response.size>0)try{var t=new Blob([e.currentTarget.response],{type:"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,o);else{var a=(window.URL||window.webkitURL).createObjectURL(t),i=document.createElement("a");o?(i.style.display="none",void 0===i.download?window.location=a:(i.href=a,i.download=o,document.querySelector("#email_attachments").append(i),i.target="_blank",i.click(),i.remove())):window.location=a}n?Lyte.registeredMixins["crm-emailconversation-view-mixin"].removeAllCheckBox(n):$L(".etViewThreadHighight").removeClass("etViewThreadHighight")}catch(e){murphy.error(e),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.email.threadview.error.download"),ltPropDuration:"3000",ltPropShow:!0}})}finally{commonUtils.showHideLoadingDiv(!1)}else _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.email.threadview.error.download"),ltPropDuration:"3000",ltPropShow:!0}})},r.send(l)},getColumnCount:function(){let e=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getSelectedTab(),t=0;if(["drafts","scheduled"].includes(e))t=3;else{t=4;let e=$L("crm-emails-related-list")[0].component.data;e.isZiaEnabled&&(e.isIntentEnabled&&t++,e.isSentimentEnabled&&t++,e.isEmotionsEnabled&&t++)}return t},invokeBatchDownloadInlineImages(e,t){let a=this.getData("moduleInfo"),i=a.moduleName,o=a.moduleId,n=$L(".edvBbColor"),s=this.getData("mailArray"),l=n.length,r=0,d=this.getData("conversationList["+e+"].owner.id");for(let e=0;e<l;e++)if("content"in s[e]){r=e;break}let c=n.eq(r)[0];this.batchDownloadInlineImages(i,o,t,d,c)},batchDownloadInlineImages:function(e,t,a,i,o){let n=o.querySelector(".mailBody").shadowRoot.querySelectorAll("img.ZCrmImage"),s=[...n],l=o.querySelector(".mailPrevBody");if(l){let e=l.shadowRoot.querySelectorAll("img.ZCrmImage");s=[...n].concat([...e])}let r=s.length;for(let e=0;e<r;e++)s[e].setAttribute("data-src",s[e].attributes.src.value),s[e].setAttribute("src","");let d=0,c=function(){if(d>=s.length)return;let o=[],n=0;for(;n<5&&d<r;){let l=s[d++],r=l.dataset.src;if(n++,l.classList.contains("imageLoaded"))continue;let c=r.substring(r.indexOf("img_id:")+7).trim();Lyte.registeredMixins["crm-emailconversation-view-mixin"].addPromiseToArray(o,e,t,a,c,i,l)}Promise.all(o).then((function(){c()}))};c()},addPromiseToArray:function(e,t,a,i,o,n,s){e.push(new Promise((e=>{Lyte.registeredMixins["crm-emailconversation-view-mixin"].downloadInlineImages(t,a,i,o,n,s,e)})))},downloadInlineImages:function(e,t,a,i,o,n,s){var l="/crm/email/v2/"+e+"/"+t+"/Emails/inline_images",r={};r.message_id=a,r.user_id=o,r.id=i,r.name="Hello.jpg";var d=networkUtils.constructEncodedUrl(l,r),c=new XMLHttpRequest;c.open("GET",d),c.setRequestHeader("X-ZCSRF-TOKEN",csrfParamName+"="+cookieUtils.getCookie("crmcsr")),c.setRequestHeader("X-CRM-ORG",crmZgid),c.responseType="blob",c.onload=function(e){if(200===e.currentTarget.status){s();try{var t=function(e,t){var a=new Blob([e],{type:"application/octet-stream"}),i=new FileReader;i.readAsDataURL(a),i.onloadend=function(){var e=i.result;t.src=e,t.classList.add("imageLoaded")}};window.Encryptionenabled?e.currentTarget.response instanceof Blob?e.currentTarget.response.text().then((e=>{ZSEC.Encryption.decrypt(e,c.getResponseHeader("Waf-Encryption-Key"),{returnBinary:!0}).then((e=>{t(e,n)}))})):ZSEC.Encryption.decrypt(e.currentTarget.response,c.getResponseHeader("Waf-Encryption-Key"),{returnBinary:!0}).then((e=>{t(e,n)})):t(e.currentTarget.response,n)}catch(e){murphy.error(e)}}},c.send()},postEmailRendered:function(e,t,a){let i=e.find("img.ZCrmImage"),o=this.getData("moduleInfo"),n=this.getData("conversationList")[a],s=o.moduleName,l=o.moduleId,r=n.owner.id,d=n.message_id,c=i.length;for(let e=0;e<c;e++){let t=i[e],a=t.src;if(t.classList.contains("imageLoaded"))continue;let o=a.substring(a.indexOf("img_id:")+7).trim();i[e].src="",this.downloadInlineImages(s,l,d,o,r,t)}},loadCloudUploader:function(e){var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloudpicker")],ResourceConstants.CRM),a=networkUtils.returnDependencyFiles(["crm-cloud-uploader.js"],ResourceConstants.CRMClient),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-cloud-uploader",{options:e,showCloudUploader:!0},"#show")}))},getSelectedForConversation:function(e,t,a,i,o,n){let s=[],l="relatedList";if(e)n!==l?s.push({id:t.id,name:t.name,owner:{id:o},message_id:i}):s.push({attachments:[{id:t.id,name:t.name}],owner:{id:o},message_id:i});else{for(var r=$L('lyte-accordion-body[data-attachments="attachments_'+i+'"]').find(".edvAtchsDiv .edvAttachCheckBx"),d=r.length,c=0;c<d;c++)if(!0===r[c].ltProp("checked")){let e=a[c];if(n!==l)s.push({id:e.id,name:e.name,owner:{id:o},message_id:i});else{let t=s.length;if(0===t)s.push({attachments:[{id:e.id,name:e.name}],owner:{id:o},message_id:i});else{let a=!1;for(var m=0;m<t;m++)s[m].message_id===i&&(s[m].attachments.push({id:e.id,name:e.name}),a=!0);a||s.push({attachments:[{id:e.id,name:e.name}],owner:{id:o},message_id:i})}}}}return s},getSelectedForPreview:function(e,t,a,i){let o=[],n="relatedList";if(e)i!==n?o.push({id:t.id,name:t.name,owner:t.owner,message_id:t.message_id}):o.push({attachments:[{id:t.id,name:t.name}],owner:t.owner,message_id:t.message_id});else for(var s=$L(".attachRef").find(".etViewAttachmentSection .etViewAttachmentPopoverChkbox"),l=s.length,r=0;r<l;r++){if(!0===s[r].ltProp("checked")){let e=a[r];if(i!==n)o.push({id:e.id,name:e.name,owner:e.owner,message_id:e.message_id});else{let t=o.length;if(0===t)o.push({attachments:[{id:e.id,name:e.name}],owner:e.owner,message_id:e.message_id});else{let a=!1;for(var d=0;d<t;d++)o[d].message_id===e.message_id&&(o[d].attachments.push({id:e.id,name:e.name}),a=!0);a||o.push({attachments:[{id:e.id,name:e.name}],owner:e.owner,message_id:e.message_id})}}}}return o},mRforRelatedList:function(e,t,a,i){let o={module:t,entityId:a},n={email_related_list:e},s=$L(".etViewThreadHighight");store.triggerAction("emails_rl_attachments","add_to_attachments",{meta:o},{},"POST",n).then((()=>{let t=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getSucessMsg(e,"relatedList");_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.email.threadview.added.sucessfully",t),ltPropDuration:"3000",ltPropShow:!0}}),commonUtils.showHideLoadingDiv(!1),i?Lyte.registeredMixins["crm-emailconversation-view-mixin"].removeAllCheckBox(void 0,i):s.removeClass("etViewThreadHighight"),Lyte.triggerEvent("relatedList",{module:"Attachments"})}),(e=>{let t=JSON.parse(e.responseText);var a=t.email_related_list,o="",n="";switch(a?a[0].code:t.code){case"NO_PERMISSION":o="error",n=I18n.getMsg("crm.view.attachment.add.nopermission");break;case"STORAGE_SPACE_EXCEEDS":o="info",n=I18n.getMsg("crm.view.attachment.add.nostorage");break;default:o="error",n=I18n.getMsg("crm.view.attachment.add.unsuccessful")}_cruxUtils.showCustomMessage({params:{ltPropType:o,ltPropMessage:n,ltPropDuration:"3000",ltPropShow:!0}}),commonUtils.showHideLoadingDiv(!1),i||s.removeClass("etViewThreadHighight")}))},removeAllCheckBox:function(e,t){let a;if(e||t){if(t){a=$L("#attachments_"+t)}else a=$L(e);for(var i=a.closest(".edvBbColor").find(".edvAtchsDiv .edvAttachCheckBx"),o=i.length,n=0;n<o;n++)!0===i[n].ltProp("checked")&&i[n].ltProp("checked",!1)}},getSucessMsg:function(e,t){let a="";if("relatedList"===t&&1===e[0].attachments.length)return a=e[0].attachments[0].name,a;if("relatedList"===t){let t=e.length,i=0;for(let a=0;a<t;a++)i+=e[a].attachments.length;return a=i+" "+I18n.getMsg("Attachments"),a}return a=1===e.length?e[0].name:e.length+" "+I18n.getMsg("Attachments"),a},showWorkDrive:function(e){var t={};t.WDDomainURL=httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),t.primaryActionCallBack=e?Lyte.registeredMixins["crm-emailconversation-view-mixin"].workDriveCallBack:Lyte.registeredMixins["crm-emailconversation-view-mixin"].attachmentPreviewWD,t.width="850px",t.height="80%",t.service="ZohoCRM",t.zsoid=crmZgid,t.showBasicButton=!0,t.applyWDDefaultFont=!0,t.denyButtonName=I18n.getMsg("crm.creator.cancelbutton"),t.showDenyButton=!0,t.showFooter=!0,t.showLeftPanel=!0,t.showPrimaryButton=!0;var a=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([a]),Lyte.injectResources([a],void 0,(function(){(new WorkDrive).showResourceAdder(t)}))},attachmentPreviewWD:function(e){let t=e.callbackDataFromWorkDrive.destinationResourceToAdd[0].id;$(".etViewThreadHighight").removeClass("etViewThreadHighight"),Lyte.registeredMixins["crm-emailconversation-view-mixin"].postCloudData(t,"workdrive")},attachmentPreviewCloud:function(e){let t=e.folderId,a=e.source;e.accountId&&(t+=","+e.accountId),$(".etViewThreadHighight").removeClass("etViewThreadHighight"),Lyte.registeredMixins["crm-emailconversation-view-mixin"].postCloudData(t,a)},postCloudData:function(e,t,a){let i;i=a?$L("crm-emailconversation-view")[0]:$L("crm-email-attachments")[0];let o=i.component.getData("cloudPayLoad"),n=i.component.getData("moduleInfo");o.folder_id=e,o.service=t&&"workdrive"!==t?t:"workdrive";let s=$L(".etViewThreadHighight");commonUtils.showHideLoadingDiv(!0);let l={module:n.moduleName,entityId:n.moduleId};store.triggerAction("emails_rl_attachments","add_to_cloud",{attachmentData:o.__attachments,meta:l},{},"POST",o).then((()=>{let e=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getSucessMsg(o.__attachments);_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.email.threadview.added.sucessfully",e),ltPropDuration:"3000",ltPropShow:!0}}),s.removeClass("etViewThreadHighight"),commonUtils.showHideLoadingDiv(!1)}),(e=>{let t=JSON.parse(e.responseText).__attachments[0].message;_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:t,ltPropDuration:"3000",ltPropShow:!0}}),s.removeClass("etViewThreadHighight"),commonUtils.showHideLoadingDiv(!1)}))},workDriveCallBack:function(e){let t=e.callbackDataFromWorkDrive.destinationResourceToAdd[0].id,a=document.querySelector("crm-emailconversation-view"),i=a.component.getData("cloudPayLoad"),o=a.component.getData("moduleInfo");i.folder_id=t,Lyte.registeredMixins["crm-emailconversation-view-mixin"].triggerAddToCloud(i,o)},cloudUploaderCallBack:function(e){let t=e.folderId,a=e.source;e.accountId&&(t+=","+e.accountId);let i=document.querySelector("crm-emailconversation-view"),o=i.component.getData("cloudPayLoad"),n=i.component.getData("moduleInfo");o.folder_id=t,o.service=a,Lyte.registeredMixins["crm-emailconversation-view-mixin"].triggerAddToCloud(o,n)},triggerAddToCloud:function(e,t){commonUtils.showHideLoadingDiv(!0);let a=e.__attachments[0].message_id,i={module:t.moduleName,entityId:t.moduleId};store.triggerAction("emails_rl_attachments","add_to_cloud",{attachmentData:e.__attachments,meta:i},{},"POST",e).then((()=>{Lyte.registeredMixins["crm-emailconversation-view-mixin"].removeAllCheckBox(void 0,a);let t=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getSucessMsg(e.__attachments);_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.email.threadview.added.sucessfully",t),ltPropDuration:"3000",ltPropShow:!0}}),commonUtils.showHideLoadingDiv(!1)}),(e=>{Lyte.registeredMixins["crm-emailconversation-view-mixin"].removeAllCheckBox(void 0,a);let t=JSON.parse(e.responseText).__attachments[0].message;_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:t,ltPropDuration:"3000",ltPropShow:!0}}),commonUtils.showHideLoadingDiv(!1)}))},bulkUpdateForThreadView:function(e){let t=[],a=e.userId,i=e.dealName,o=e.dealId,n=e.contactId,s="Contacts";(commonUtils.showHideLoadingDiv(!0),n)||(s="Potentials",n=$L("crm-emailconversation-view")[0].component.data.moduleInfo.moduleId);t.push(e.msgId),Lyte.registeredMixins["crm-emailconversation-view-mixin"].bulkUpdateForThreadViewHelper(t,a,i,o,n,s,e.action)},bulkUpdateForThreadViewHelper:function(e,t,a,i,o,n,s){commonUtils.showHideLoadingDiv(!0);let l=e[0],r=$L("crm-emailconversation-view");if("associateDeal"===s){let s=[],d={};e.forEach((e=>{let o={};o.message_id=e,o.owner={id:t},o.linked_record={module:{api_name:"Deals"},name:a,id:i},s.push(o)})),d.Emails=s,store.triggerAction("conversations","link_record",{module:n,entityId:o},{},"POST",d).then((e=>{e.Emails.forEach((e=>{if("success"===e.status){var t=$L("#assoPotential_"+l).closest(".ecnBodyTxt").parent().parent(),o=store.peekRecord("emails_rl_user",t.data("msgid")),n=t.closest(".topband_dv_row");if(t.addClass("hasDeal"),t.find(".ecnBodyTxt").addClass("hasDeal"),t.find(".crmEllipticText").addClass("hasDeal"),t.data({dealid:i,dealname:a}),n.addClass("ldHighlightRow"),void 0!==o){var s=o.data;s.linked_deal={},s.linked_deal.id=i,s.linked_deal.name=a,store.pushPayload("emails_rl_user",{content:t.data("msgid"),data:s})}if(setTimeout((function(){n.addClass("ldAnimateHighlight")}),500),0!==r.length){let t=store.peekRecord("view_email",e.details.message_id);if(t){let o={id:i,name:a},n=t.mailData;n.linked_deal=o,store.pushPayload("view_email",{id:e.details.message_id,mailData:n})}let o=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getIndexByMessageId(l);Lyte.arrayUtils(r[0].component.getData("dealArray"),"replaceAt",o,{id:i,name:a})}setTimeout((function(){$L(".ldAnimateHighlight").removeClass("ldHighlightRow ldAnimateHighlight")}),4e3)}})),commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.email.threadview.linkdeal.sucess",[Crm.moduleInfo.Potentials.translatedSingularLabel,a]),ltPropDuration:"3000",ltPropShow:!0}})}),(e=>{Lyte.registeredMixins["crm-emailconversation-view-mixin"].processDealErrorResponse(e)}))}else{var d=e.length,c=e[0];for(let t=1;t<d;t++)c+=","+e[t];store.triggerAction("conversations","link_record",{module:n,entityId:o},{message_ids:c,owner_id:t},"DELETE").then((e=>{e.Emails.forEach((e=>{if("success"===e.status){var t=$L("#assoPotential_"+l).closest(".ecnBodyTxt").parent().parent(),a=store.peekRecord("emails_rl_user",t.data("msgid"));t.removeClass("hasDeal"),t.find(".erlSubjectBodyContainer").removeClass("hasDeal"),t.removeData("dealid"),t.removeData("dealname");let e=$L("#ldealInfo");e.length&&e[0].remove(),EntityEmail.postProcessDealDisAccociation(a,l)}})),commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.email.threadview.unlinkdeal.sucess",[Crm.moduleInfo.Potentials.translatedSingularLabel,a]),ltPropDuration:"3000",ltPropShow:!0}})}),(e=>{Lyte.registeredMixins["crm-emailconversation-view-mixin"].processDealErrorResponse(e)}))}},processDealErrorResponse:function(e){e=JSON.parse(e.response);var t=I18n.getMsg("crm.mail.error");if(e.Emails)t=e.Emails[0].message;commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:t,ltPropDuration:"3000",ltPropShow:!0}})},clearAllDataAttributes:function(e){var t=e.data(),a=$L.map(t,(function(e,t){return t}));let i=a.length;for(let t=0;t<i;t++)e.removeAttr("data-"+a[t])},getIndexByMessageId:function(e){let t=0;return $L("crm-emailconversation-view")[0].component.getData("conversationList").forEach(((a,i)=>{a.message_id===e&&(t=i)})),t},isValidEmail:function(e,t,a,i){let o=$L("#module").val(),n=Crm.userDetails.isMailAppsUser&&("ZMAIL"===i||"ALLUSERSMAILS"===i)&&("Contacts"===o||"Accounts"===o||"Potentials"===o||"Deals"===o||a)&&("Contacts"===e||"Accounts"===e||"Deals"===e||"Potentials"===e)&&(!t.status||"scheduled"!==t.status[0].type.toLowerCase()&&"failed"!==t.status[0].type.toLowerCase()),s=$("#contactSelDropdownInAcc");return s.length&&"ACCOUNTS_ALL"===s.attr("lt-prop-selected")&&(n=!1),n},emailThreadViewForSignalCallBack:function(e,t,a,i,o,n,s,l,r,d,c,m){let p={module:a,entityId:i,isConversationMail:!0},u="",y=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getOfffsetHeight(),v="zia"===c&&!r;if(d||v)u=d;else{let e=$L("#emailDetailIframeContent"+r).contents().find("#APIMsgId");if(0===e.length)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.imap.error.configuration"),ltPropDuration:"3000",ltPropShow:!0}}),void commonUtils.showHideLoadingDiv(!1);u=e[0].value}var h=c;let g,f;c||(c="salesSignal"),u=v?e:u;let _={user_id:t,message_id:u};c&&(r&&m&&(_.notification_id=r),(m||"zia"===h)&&(_.notification_type="zia"===h?"zia":"sales_signal")),Lyte.resolvePromises({view_email:store.findRecord("view_email",u,_,!1,!1,p),record_details:store.findRecord("record_details",i,{approved:"both",converted:"both"},!0,!0,{recordId:i,recordName:a})}).then((e=>{let s=e.view_email.view_email.mailData,l=e.record_details.recordData,r={moduleName:a,moduleId:i,recordState:"present"};o=Crm.userDetails.isMailAppsUser&&"Received"===n?"ZMAIL":"mailMagnet"===c?"GMail":"ALLUSERSMAILS",s.messageId=u,s.mailOwnerId=t,s.sentOrReceived=n,0===Object.keys(l).length?r.recordState="deleted":l.$converted&&(r.recordState="converted"),s.showTranslateSection=Crm.userDetails.isTranslationAvailable,s.entityId=i,s.moduleName=a;let d=Lyte.registeredMixins["crm-emailconversation-view-mixin"].convertToConversationResponse(s),m=[],p="linked_deal"in d[0]?{id:d[0].linked_deal.id,name:d[0].linked_deal.name}:{};m.push(p),m=Array.from(m),g=[s],f=[void 0],g=Array.from(g),f=Array.from(f);let v={conversationList:Array.from(d),moduleInfo:r,mailType:o,sentOrReceived:n,offsetHeight:y,mailArray:g,processedMails:f,dealData:{},selectedCount:[0],mailSource:c,dealArray:m,subjectText:d[0].subject,messageId:u};Lyte.registeredMixins["crm-emailconversation-view-mixin"].postProcessEmailThreadView(v),commonUtils.showHideLoadingDiv(!1),store.triggerAction("view_email","mark_as_read",{messageId:u,moduleName:a,moduleId:i,userId:t},{},"POST",{})}),(e=>{let t=JSON.parse(e.response);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:t.message,ltPropDuration:"3000",ltPropShow:!0}})}))},emailThreadViewForMailMagnetCallback:function(){let e=$L("#etmmModal");0!==e.length&&e[0].ltProp("show")||store.findAll("mail_magnet").then((e=>{if(commonUtils.showHideLoadingDiv(!1),$L("#newMailCount")[0].style.display="none",store.triggerAction("mail_magnet","count_reset",{},{},"PUT",{}),e&&e.mails&&0===e.mails.length){_cruxUtils.showCustomMessage({params:{ltPropType:"info",ltPropMessage:"No Emails Found",ltPropDuration:"3000",ltPropShow:!0}});var t=document.querySelector("crm-left-menu");return void(t&&t.component&&t.component.actions.updateNavActiveClassForBottomMenu("leftPaneMail",!1))}$L("#rmnIconDiv").addClass("mailmagnetIconActive");let a="crm-mailmagnet-view",i=$(a);i.remove(),Lyte.Component.render("crm-mailmagnet-view",{mailList:null!=e.mails?Array.from(e.mails):[],openedEmail:""},"#show"),i=$L(a);let o=i[0].component;o.methods.openMailMagnet.bind(o)()}),(e=>{let t=JSON.parse(e.responseText);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:t.message,ltPropDuration:"3000",ltPropShow:!0}})}))},sortConversations:function(e){return e.sort((function(e,t){let a=$L.moment(e.sent_time).toDate().getTime();return $L.moment(t.sent_time).toDate().getTime()-a})),e},convertToConversationResponse:function(e){store.unloadAll("activity_suggestions");let t={owner:{}};t.owner.name="",t.owner.id=e.mailOwnerId,t.read=!!e.read&&e.read,t.subject=e.subject;var a=e&&e.activity_info&&e.activity_info.activities&&e.activity_info.activities.length;a&&(t.showActivity=!0);var i=e.feedback_mechanism&&(a&&"Received"!==e.status[0].type||"Received"===e.status[0].type&&(e.activity_info||e.emotion||e.intent||e.sentiment_info));t.showHelpZia=!!i;let o={moduleName:e.moduleName,entityId:e.entityId,recordState:"present"};return Lyte.Component.registeredHelpers.hasEnrichment(e,o)&&Lyte.Component.registeredHelpers.hasActivity(e)?t.class="br_right_border1":t.class="",t.showTranslateSection=Crm.userDetails.isTranslationAvailable,t.userLan=Crm.userDetails.RELEVANT_LOCALE,t.currentSelection=Crm.userDetails.RELEVANT_LOCALE,t.message_id=e.messageId,t.source=null,t.sent=null,t.mail_index=null,t.intent=e.intent?e.intent:"",t.sentiment_info=e.sentiment_info?e.sentiment_info:"",t.sent_time=e.sent_time,t.from=e.from,t.emotion=e.emotion,t.activity_info=e.activity_info,e.to&&Array.isArray(e.to)&&e.to.length>=1&&e.to[0].email&&(t.to=e.to),e.cc&&(t.cc=e.cc),e.bcc&&(t.bcc=e.bcc),e.status&&(t.status=e.status),e.linked_deal&&(t.linked_deal=e.linked_deal),e.linked_record&&(t.linked_record=e.linked_record),e.$sharing_permission&&(t.sharing_permission=e.$sharing_permission),t.hasAttach=e.attachments&&0!==e.attachments.length,[t]},emailNonThreadView:function(e,t,a,i,o,n,s,l,r){var d=e;d.messageId=t,d.entityId=a,d.mailOwnerId=i,d.mailType=o,d.sentOrReceived=n,d.moduleName=s,d&&!d.activity_info?d.showActivity=!1:d.showActivity=!0,d&&d.feedback_mechanism&&(d.intent||d.sentiment_info||d.emotion||d.activity_info)?d.showHelpZia=!0:d.showHelpZia=!1;let c=Lyte.registeredMixins["crm-emailconversation-view-mixin"].convertToConversationResponse(d);c[0].module=d.moduleName,c[0].entityId=d.entityId,c[0].massmailid=d.id,mailArray=[d],processedMails=[{}];let m=[],p="linked_deal"in c[0]?{id:c[0].linked_deal.id,name:c[0].linked_deal.name}:{};m.push(p),m=Array.from(m),mailArray=Array.from(mailArray),processedMails=Array.from(processedMails);let u={conversationList:Array.from(c),moduleInfo:{moduleName:s,moduleId:a,recordState:"present"},mailType:o,sentOrReceived:n,offsetHeight:r,mailArray:mailArray,processedMails:processedMails,dealData:{message_id:t},selectedCount:[0],mailSource:"signals"===l?"salesSignals":"zia"===l?l:"relatedList",dealArray:m,messageId:t,subjectText:c[0].subject};Lyte.registeredMixins["crm-emailconversation-view-mixin"].postProcessEmailThreadView(u),commonUtils.showHideLoadingDiv(!1)},emailThreadView:function(e,t,a,i,o,n,s,l,r,d,c,m,p,u,y){("CRMMASSMAIL"===$L(r).attr("purpose")||r&&"ernSummery2"===r.id&&"CRMMASSMAIL"===$L(r).parent().find(".emailSubjectEllipisis").attr("purpose"))&&(t="ALLUSERSMAILS"),Crm.userDetails.IMAP_STATUS&&"IMAP"===t&&(t="ZMAIL");var v=void 0!==event?$L(event.target):null;let h=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getModuleInfo(u,d,y);d=h[1];let g=h[0];var f,_,b;let w=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getOfffsetHeight();if(!(null!==v&&(null===v||"INPUT"===v.prop("tagName")||"I"===v.prop("tagName")||v.hasClass("MoveToMailIcon")||v.hasClass("ernSummery")||$L(r).hasClass("rLAttachment")||v.hasClass("erlThreadViewIcon")||v.hasClass("zcicn-link")||v.attr("href")&&v.attr("href").includes("zcicn-link")))){commonUtils.showHideLoadingDiv(!0);let a={module:g,entityId:d,isConversationMail:!1};$L(".currViewedMail").removeClass("currViewedMail");var D=$L(".etViewThreadHighight"),L=$L("#"+e),C=$L("#email_attachments");e&&(L.removeClass("crm-font-bold"),L.addClass("currViewedMail"),D.removeClass("etViewThreadHighight"),L.closest(".topband_dv_row").addClass("etViewThreadHighight"));var x={user_id:l,message_id:e};if(("Potentials"===g||"Deals"===g)&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL){var A=$L("#dealOnlyDropDown");if(A.length>0){var I=A[0].component.data.ltPropSelected,M=$L("#contactRolesDropDown")[0].component.data.ltPropSelected;"dealsOnly"!==I&&(!0===M.includes("_")?(M=M.split("_")[0],g=a.module="Deals"):g=a.module="Contacts",d=a.entityId=M)}}if("Cases"===g&&Crm.userDetails.isEmailsForCasesModuleEnabled){var k=Lyte.Component.registeredHelpers.checkSelectedModuleInRL();k&&(a.module="Contacts",a.entityId=k)}store.findRecord("view_email",e,x,!1,!1,a).then((a=>{if(void 0===p){(a=a.view_email.mailData).messageId=e,a.entityId=d,a.mailOwnerId=l,a.mailType=t,a.sentOrReceived=i,a.moduleName=g,a.showTranslateSection=Crm.userDetails.isTranslationAvailable,a&&!a.activity_info?a.showActivity=!1:a.showActivity=!0,a&&a.feedback_mechanism&&(a.intent||a.sentiment_info||a.emotion||a.activity_info)?a.showHelpZia=!0:a.showHelpZia=!1;let o=Lyte.registeredMixins["crm-emailconversation-view-mixin"].convertToConversationResponse(a);o[0].module=a.moduleName,o[0].entityId=a.entityId,o[0].massmailid=a.id,f=[a],_=[{}];let n=[],s="linked_deal"in o[0]?{id:o[0].linked_deal.id,name:o[0].linked_deal.name}:{};n.push(s),n=Array.from(n),f=Array.from(f),_=Array.from(_);let r={conversationList:Array.from(o),moduleInfo:{moduleName:g,moduleId:d,recordState:"present"},mailType:t,sentOrReceived:i,offsetHeight:w,mailArray:f,processedMails:_,dealData:{message_id:e},selectedCount:[0],mailSource:"signals"===u?"salesSignals":"zia"===u?u:"relatedList",dealArray:n,messageId:e,subjectText:o[0].subject};Lyte.registeredMixins["crm-emailconversation-view-mixin"].postProcessEmailThreadView(r),commonUtils.showHideLoadingDiv(!1),Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailNonThreadView(a,e,d,l,t,i,g,u,w)}else store.findRecord("conversations",p,{user_id:l,thread_id:p},!1,!1,{module:g,entityId:d}).then((o=>{let n=(b=Lyte.registeredMixins["crm-emailconversation-view-mixin"].sortConversations(o.conversations.conversation)).length,s=[],l=[],r=[],c=[],m="";for(let t=0;t<n;t++){l.push({}),r.push(0);let i="linked_record"in b[t]?{id:b[t].linked_record.id,name:b[t].linked_record.name}:{};s.push(i),b[t].message_id===e?(c.push(a.view_email.mailData),m=b[t].subject):(c.push({}),c[t].showTranslateSection=!1),b[t].sentiment&&(b[t].sentiment_info=b[t].sentiment),b[t].snippet&&(C.html(b[t].snippet),b[t].snippet=C.text()),!b[t].feedback_mechanism||null===b[t].sentiment&&null===b[t].intent&&null===b[t].emotion?b[t].showHelpZia=!1:b[t].showHelpZia=!0,c[t].showTranslateSection=Crm.userDetails.isTranslationAvailable,b[t].showTranslateSection=Crm.userDetails.isTranslationAvailable}c=Array.from(c),l=Array.from(l),b=Array.from(b),s=Array.from(s);let p={conversationList:b,moduleInfo:{moduleName:g,moduleId:d,recordState:"present"},mailType:t,sentOrReceived:i,offsetHeight:w,mailArray:c,processedMails:l,dealData:{message_id:e},selectedCount:r,mailSource:"signals"===u?"salesSignals":"zia"===u?u:"relatedList",dealArray:s,messageId:e,subjectText:m};Lyte.registeredMixins["crm-emailconversation-view-mixin"].postProcessEmailThreadView(p)}),(o=>{commonUtils.showHideLoadingDiv(!1),D.removeClass("etViewThreadHighight");let n=o.responseText.replace("",""),s=JSON.parse(n);s&&s.message&&!s.message.includes("Conversation is deleted/invalid thread id")?_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:s.message,ltPropDuration:"3000",ltPropShow:!0}}):Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailNonThreadView(a,e,d,l,t,i,g,u,w)}));"ALLUSERSMAILS"!==t&&store.triggerAction("view_email","mark_as_read",{messageId:e,moduleName:g,moduleId:d,userId:l},{},"POST",{})}),(e=>{let t=e.responseText.replace("",""),a=JSON.parse(t),i=a.message;i||(i=a.email_related_list[0].message),commonUtils.showHideLoadingDiv(!1),D.removeClass("etViewThreadHighight"),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:i,ltPropDuration:"3000",ltPropShow:!0}})}))}},postProcessEmailThreadView:function(e){let t="crm-emailconversation-view",a=$L(t);0===a.length&&(Lyte.Component.render("crm-emailconversation-view",e,"#basic"),a=$L(t));let i=a[0];"draft"===e.mailSource&&i.component.setData("mailSource",e.mailSource);i.component.setData({mailArray:null}),i.component.setData(e),i.component.methods.showEmailDetailView.bind(i.component)(),commonUtils.showHideLoadingDiv(!1)},populateReplyDetailsForNewEmailView:function(e){var t=void 0===e.msgid?null:e.msgid,a=void 0===e.sentOrReceived?null:e.sentOrReceived,i=void 0===e.fromAddr?null:e.fromAddr,o=void 0===e.toAddr?null:e.toAddr,n=void 0===e.ccAddr?null:e.ccAddr,s=void 0===e.bccAddr?null:e.bccAddr,l=void 0===e.replyToAddr?null:e.replyToAddr,r=void 0===e.sub?null:e.sub;r&&(r=encodeURIComponent(r.replace(/[\n\r]/g,"").trim()));return"&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(o)+"&ccAddr="+encodeURIComponent(n)+"&bccAddr="+encodeURIComponent(s)+"&replyToAddr="+encodeURIComponent(l)+"&inReplyTo="+encodeURIComponent(null)+"&msgid="+t+"&sub="+r+"&sentOrReceived="+a+"&mid=null"},getModuleInfo:function(e,t,a){let i=$L("#id").val(),o=moduleApiMapping[$L("#module").val()];var n=$("#contactSelDropdownInAcc"),s="",l=$("#isFromNewAPI");if(n.length>0&&(s=l.length>0?n.attr("lt-prop-selected"):$("#contactSelDropdownInAcc :selected").attr("value")),"Accounts"===o&&n.length>0&&"ACCOUNTS_ALL"!=s&&(o="Contacts",i="ALL"!=s?s:t),"activity"===e){var r=Lyte.registeredMixins["crm-detailcanvas-utils"];if(r=r&&r.isFromCanvasActivityEnabledModule(a),Crm.renderDVLyteFlow&&Crm.renderDVLyteFlow(a)||r){let e=$L("crm-detailview-right-panel");e&&e.length>0&&(o=e[0].component.data.module,i=e[0].component.data.record_id)}else o=$$rightPanel.currentModule,i=$$rightPanel.entityId}return[o,i]},getOfffsetHeight:function(){let e=$L("#etmmModal"),t=$L("crm-menu"),a=t.length>0?t[0].getBoundingClientRect().height:0,i=$L("#wms-chatwindowcontainer"),o=97.5+a,n=!1;return 0!==e.length&&(n=e[0].ltProp("show")),n||(o-=a),i.length&&(o+=i[0].getBoundingClientRect().height),o="calc(100vh - "+o+"px)",o},populateColumns:function(e,t){let a=[];return Object.keys(e).forEach((function(i){let o={};o.name=t[i],o.width=e[i],o.name&&a.push(o)})),a},calculateTotalWidth:function(){let e=60,t=$L("#draftMails").hasClass("selectTab"),a=$L("#mails").hasClass("selectTab"),i=$L("#scheduledMails").hasClass("selectTab"),o=store.peekRecord("email_column_widths",Lyte.registeredMixins["crm-emailconversation-view-mixin"].getSelectedTab()),n=$("crm-emails-related-list")[0].component.getData();a&&o?(e+=o.subject+o.source+o.date+o.sentby+o.status,n&&n.isZiaEnabled&&n.isSentimentEnabled&&(e+=o.sentiment),n&&n.isZiaEnabled&&n.isEmotionsEnabled&&(e+=o.emotion),n&&n.isZiaEnabled&&n.isIntentEnabled&&(e+=o.intent)):i?e+=o.subject+o.source+o.date+o.sentby:t&&(e+=o.subject+o.content+o.date+o.fromaddress);let s=$L("#ernTable");if(s.length){let t=s.height()+"px";s.find("lyte-table-structure").width(e),s[0].style.setProperty("--resizeHeight",t)}},getSelectedTab:function(){let e=$L("#draftMails").hasClass("selectTab"),t=$L("#mails").hasClass("selectTab"),a=$L("#scheduledMails").hasClass("selectTab");return e?"drafts":t?"mails":a?"scheduled":void 0},preventLinkOpen:function(e){setTimeout((()=>{var t=$("#mailContent_"+e);let a=t[0].querySelector(".mailBody").shadowRoot;a.addEventListener("click",Lyte.registeredMixins["crm-emailconversation-view-mixin"].preventClick);let i=a.querySelectorAll('a[href="javascript:void(0)"]'),o=t[0].querySelector(".mailPrevBody");if(o){o=o.shadowRoot;let e=o.querySelectorAll('a[href="javascript:void(0)"]');i=[...i].concat([...e]),o.addEventListener("click",Lyte.registeredMixins["crm-emailconversation-view-mixin"].preventClick)}i.forEach((e=>e.removeAttribute("href")))}),5)},preventClick:function(e){var t=e.target.id,a=e.target.href;if(a&&-1!==a.indexOf("Campaigns.Webinar Registration URL")&&(t="WebinarRegistrationURL"),t){["ConsentForm","DataRequest","Unsubscribe","Doubleoptin","WebinarRegistrationURL"].forEach((a=>{-1!==a.indexOf(t)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}))}},showLookUp:function(e,t,a){let i="Potentials";if(this.fldIdVal="assoPotential_"+e,Crm.userDetails.isLookupAdvancedSearchEnabled){var o={};o.labelName=this.fldIdVal,o.source="rLEmail",o.lookupModule="Potentials",o.searchModule="Potentials",o.parentModule=i,o.contactId=t,Lyte.registeredMixins["crm-emailconversation-view-mixin"].openNewLookup(o)}else Crm.showLookUp(i,"assoPotential_"+e,"assoPotential_"+e,"Potentials","Potentials","rLEmail")},openNewLookup:function(e){let t,a,i=document.getElementById("lookupListPopup");if(!i&&(a=document.getElementById("lookupModalDiv"),null===a)){let e=document.createElement("div");e.id="lookupModalDiv",document.body.appendChild(e),a=document.getElementById("lookupModalDiv")}let o=[],n=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);n=n.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(o=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));let s=n.concat(o);Lyte.injectResources(s,void 0,(function(){if(Crm.moduleName=e.searchModule,!i&&a){let e=document.createElement("crm-entity-lookup");e.component.setData("reqData",{}),a.append(e),t=e.component}else t=$L("crm-entity-lookup")[0].component;t.layersAnalystAgent(t,void 0,e,void 0,!0)}))},removeHighlightFromSummary:function(e){e.length&&e[0].component.getData("showModal")||$(".etViewThreadHighight").removeClass("etViewThreadHighight")},isEmailViewOpen:function(e){let t=$L("crm-emailconversation-view");return!!(t.length&&t[0].component.getData("showModal")&&e&&"EMAIL_THREAD_VIEW"!==e)},processDisplayValue:function(e){if(e&&Array.isArray(e)){let t="";return e.forEach((function(e,a){t=0===a?e:t+"; "+e})),t}return e||""},alertMaxFileAddition:function(e){let t=e.length,a=0;for(let i=0;i<t;i++)a+=e[0].attachments.length;return a>10&&(_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.fileuploader.message.maxfilesexceeded",10),ltPropDuration:"3000",ltPropShow:!0}}),!0)},isEmailViewOpen:function(){var e=$L("#edvModalConversation");return Crm.userDetails.EMAIL_THREAD_VIEW&&e.length&&e[0].ltProp("show")},openNextMail:function(e){var t=parseInt($(".currViewedMail").attr("index"));if(t<9){var a=$('[viewid="mdv_'+(t+1)+'"]');a.length>0?($("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",a)):$(e).addClass("eNavDisabled")}else if($('div[ddname="EMAILSPERSONALITY"] .next_disabled').length||0===$("#mailNav").length)$(e).addClass("eNavDisabled");else{$("#isFromNewAPI").length>0?showMailsListViaAPI("",$("#navigationIndex").html(),"next","first"):showMailsList($("#navigationEntityId").html(),$("#navigationEmailid").html(),$("#navigationFullname").html(),"",$("#navigationIndex").html(),"next","","false",$("#navigationModule").html(),void 0,"first")}},openPrevMail:function(e){var t=parseInt($(".currViewedMail").attr("index"));if(t>0){var a=$('[viewid="mdv_'+(t-1)+'"]');a.length>0?($("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",a)):$(e).addClass("eNavDisabled")}else if($('div[ddname="EMAILSPERSONALITY"] .previous_disabled').length||0===$("#mailNav").length)$(e).addClass("eNavDisabled");else{$("#isFromNewAPI").length>0&&Crm.userDetails.EMAIL_THREAD_VIEW?showMailsListViaAPI("",$("#navigationIndex").html(),"previous","last"):showMailsList($("#navigationEntityId").html(),$("#navigationEmailid").html(),$("#navigationFullname").html(),"",$("#navigationIndex").html(),"previous","","false",$("#navigationModule").html(),void 0,"last")}},openDataEnrichmentEnabled:function(){return crmCommonModule.isApproved&&("7"===crmCommonModule.isApproved||"8"===crmCommonModule.isApproved)},openDataEnrichment:function(e,t){if(Lyte.registeredMixins["crm-emailconversation-view-mixin"].openDataEnrichmentEnabled()){var a=$("#rpRecordInReview")[0];return a.ltProp("message",I18n.getMsg("crm.reviewprocess.record.entered.enrichdata.customview.msg")),a.ltProp("show",!0),void hideAnimatePopup("searchCreatePopup",!0)}Lyte.registeredMixins["enrichment-utils"].CheckTriggerData("email",t,e,null)},getBestTime:function(e,t){var a="";if(e)if(t.isToday()){var i=crmBstTime.getParsedBestTime(crmBstTime.responseData.DetailsPage[7],crmBstTime.userData).nextImmediateTime;a=i||Utils.getTimeInUserFormat()}else t.isToday()||(a=crmBstTime.getParsedBestTime(crmBstTime.responseData.DetailsPage[7],crmBstTime.userData).allTimes[0]);return a},setTimeFromTimeString:function(e,t){var a;if("hh:mm"!==Crm.userDetails.TIME_FORMAT.toLowerCase()){var i=t.split(" ");a=i[0].split(":"),"pm"==i[1].toLowerCase()&&a[0]<12&&e.setHours(parseInt(a[0])+12)}else a=t.split(":");return"pm"==i[1].toLowerCase()&&a[0]<12||e.setHours(a[0]),e.setMinutes(a[1]),e},getDateTimeString:function(e,t,a,i){var o=new Date(e.userDisplayYear,e.userDisplayMonth-1,e.userDisplayDate,e.userHourIn24hrFmt,e.userDisplayMinute),n="",s=o.toLocaleTimeString();if(s.indexOf(" ")>-1){var l=s.split(" "),r=l[0].split(":");n="PM"==l[1]?Number(r[0])+12+":"+r[1]:r[0]+":"+r[1]}else n=(n=o.toLocaleTimeString().substring(0,o.toLocaleTimeString().length-3).split(":"))[0]+":"+n[1];if(!a&&(n="09:00",o.setHours(9),o.setMinutes(0),e.isToday())){var d=$L.moment().toDate();n=d.getHours()+":"+d.getMinutes(),o=d}var c;"hh:mm"!==Crm.userDetails.TIME_FORMAT.toLowerCase()&&(n=(c=Utils.getTimeStringWithAmPm(o)).hrs+":"+c.mins+" "+I18n.getMsg(c.meridiem.toLocaleUpperCase()));(a||""==t||null==t||(n=t),i&&!a)&&(n=(c=Utils.getTimeStringWithAmPm($L.moment().toDate())).hrs+":"+c.mins+" "+I18n.getMsg(c.meridiem.toLocaleUpperCase()));var m=o.getFullYear()!=$L.moment().toDate().getFullYear()?", "+o.getFullYear():"";return o.getDate()+" "+I18n.getMsg(["January","February","March","April","May","June","July","August","September","October","November","December"][o.getMonth()])+m+", "+n},setBusinessHrnMin:function(e,t,a,i){var o,n;if((t=t.split(" "))[1]&&"pm"==t[1].toLowerCase())t=t[0].split(":"),o=parseInt(t[0])+12,n=parseInt(t[1]);else{if(1==(t=t[0].split(":")).length){var s=e;i||(s.setHours(9),s.setMinutes(0)),(Lyte.registeredMixins["crm-emailconversation-view-mixin"].checkIfDateIsToday(s)||""===s)&&(s=$L.moment().toDate()),t[0]=s.getHours(),t[1]=s.getMinutes()}o=parseInt(t[0]),n=parseInt(t[1])}return e.setHours(o),e.setMinutes(n),e},checkIfDateIsToday:function(e){var t=$L.moment().toDate();return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},getCurrentTimeInUserLocale:function(){var e=Utils.getTimeInUserFormat();if(-1!="08:04 pm".toLocaleLowerCase().indexOf("pm")||-1!="08:04 pm".toLocaleLowerCase().indexOf("am")){var t=e.split(" ");e=t[0]+" "+I18n.getMsg(t[1].toUpperCase())}return e},renderFeedbackComp:function(e,t,a,i,o){Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-email-feedback-mechanism",{showFeedbackModal:!0,mailData:e,intentValues:t,actualActivityArr:i,index:a},"#mail-feedback")}))},getLanguage:function(e){return this.getData("languageobj")[e]},openEnrichment:function(e){Crm.userDetails.isEmailsAIClickableSupport?Crm.client_tracking("Email enrichment clicked on demand click"):Crm.client_tracking("Email enrichment - clicked"),0===$L("#id").val().length?_cruxUtils.showCustomMessage({params:{ltPropType:"info",ltPropMessage:I18n.getMsg("crm.auto.enrich.not.found"),ltPropDuration:"3000",ltPropShow:!0}}):Lyte.registeredMixins["crm-emailconversation-view-mixin"].openDataEnrichment(this.getData("moduleInfo.moduleName"),e.content)},getLanguageNameInSpecific:function(e){return this.getData("dropDownLanguageObj")[e]},openHelpZia:async function(e,t){var a=$L("crm-emailconversation-view")[0].component.data,i=[{name:"None",value:I18n.getMsg("None")}],o=[],n=networkUtils.returnDependencyFiles(["crm-email-feedback-mechanism.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-email-feedback-mechanism.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(n),l={module:e.module?e.module:EmailCompose.aiData.module,id:e.entityId?e.entityId:EmailCompose.aiData.entityId,msgid:e.message_id},r=await store.findAll("zia_notification_setup",{type:"email_intelligence"});if((r=r.configurations)&&r.length&&r[0].enabled)try{if(r[3].enabled){try{(o=await store.findAll("activity_suggestions",{include_inner_details:"linked_record->Events.Start_Date_Time,linked_record->Tasks.Due_Date,linked_record->Calls.Call_Start_Time"},void 0,void 0,l)).length&&(o=o[0].activities)}catch(e){o=[]}Crm.client_tracking("Feedback Mechanism - opened for sent mail")}if("Received"===a.sentOrReceived){try{await Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-email-intent.js"],ResourceConstants.CRMClient)]),(await store.findAll("system_email_intents")).forEach((e=>{e.status&&i.push({name:e.name,value:e.name})})),(await store.findAll("custom_email_intents")).forEach((e=>{e.status&&i.push({name:e.name,value:e.name})}))}catch(e){var d=JSON.parse(e.response);if(e&&403===e.status&&"NO_PERMISSION"===d.code){["crm.zia.CI.system.purchase","crm.zia.CI.system.complaint","crm.zia.CI.system.query","crm.zia.CI.system.request"].forEach((e=>{i.push({name:I18n.getMsg(e),value:I18n.getMsg(e)})}))}}Crm.client_tracking("Feedback Mechanism - opened for received mail")}}finally{Lyte.registeredMixins["crm-emailconversation-view-mixin"].renderFeedbackComp(a,i,t,o,s)}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.zia.CI.email.permission.denied"),ltPropType:"error",ltPropDuration:"2000"}})},openActivityPopup:function(e,t){if(Crm.userDetails.isEmailsAIClickableSupport?Crm.client_tracking("Activity Extraction on demand click"):Crm.client_tracking("Activity Extraction - opened from RL"),e.activity_info&&e.activity_info.activities&&e.activity_info.activities.length){for(var a=e.activity_info.activities,i=a,o=a.length,n=0;n<o;n++){var s=i[n];switch(s.module.api_name){case"Events":a[n]={time:s.linked_record&&s.linked_record.Start_Date_Time?s.linked_record.Start_Date_Time:void 0,linked_record:s.linked_record&&s.linked_record.id?s.linked_record.id:void 0,is_created:!!s.linked_record,type:s.module.api_name,title:s.data.subject,id:s.id,End_Date_Time:s.data.End_Date_Time,Start_Date_Time:s.data.Start_Date_Time,module:e.module,entityId:e.entityId};break;case"Calls":a[n]={time:s.linked_record&&s.linked_record.Call_Start_Time?s.linked_record.Call_Start_Time:void 0,linked_record:s.linked_record&&s.linked_record.id?s.linked_record.id:void 0,is_created:!!s.linked_record,type:s.module.api_name,title:s.data.subject,id:s.id,Call_Start_Time:s.data.Call_Start_Time,module:e.module,entityId:e.entityId};break;case"Tasks":a[n]={time:s.linked_record&&s.linked_record.Due_Date?s.linked_record.Due_Date:void 0,linked_record:s.linked_record&&s.linked_record.id?s.linked_record.id:void 0,is_created:!!s.linked_record,type:s.module.api_name,title:s.data.subject,id:s.id,Due_Date:s.data.Due_Date,module:e.module,entityId:e.entityId}}}Lyte.Component.render("crm-email-activity-suggestions",{index:t,mailData:e,isFromCompose:!1,massmailid:e.activity_info.id,activityList:a,message_id:e.message_id,module:e.module?e.module:EmailCompose.aiData.module,entityId:e.entityId?e.entityId:EmailCompose.aiData.entityId},"body"),e.activity_info=void 0}else{i=e;var l={module:e.module?e.module:EmailCompose.aiData.module,id:e.entityId?e.entityId:EmailCompose.aiData.entityId,msgid:e.message_id};store.findAll("activity_suggestions",{include_inner_details:"linked_record->Events.Start_Date_Time,linked_record->Tasks.Due_Date,linked_record->Calls.Call_Start_Time"},void 0,void 0,l).then((function(a){a.length?Lyte.Component.render("crm-email-activity-suggestions",{massmailid:a[0].id,index:t,mailData:e,module:i.module,entityId:i.entityId,isFromCompose:!0,massmailid:a[0].id},"body"):_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.zia.email.extraction.empty"),ltPropType:"warning",ltPropDuration:"2000"}})}),(function(e){if(e&&e.response){var t=JSON.parse(e.response);Lyte.registeredMixins["crm-email-activity-mixin"].errorHandling(t)}}))}},getLanguageNameInEnglish:function(e,t,a){let i;i=t?a.getData("dropDownLanguageObj"):this.getData("dropDownLanguageObj");for(const t in i)if(`${i[t]}`===e)return`${t}`}});
