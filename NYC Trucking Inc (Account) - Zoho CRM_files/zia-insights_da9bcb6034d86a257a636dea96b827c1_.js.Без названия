Lyte.Mixin.register("zia-insights-utils",{isValidModule:function(e){const t=["US","EU","IN","China","AU","CSEZ","JP","CA","SA"].contains(Crm.userDetails.DEPLOYMENT),i=["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE);return!(!1===(e&&!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type&&["Visits","Forecasts"].indexOf(e.module_name)<0)||!1===t||!1===i)},updateFeatureResource:function(e,t){t.forEach((function(t){try{switch(t.feature.api_name){case"prediction":if(moduleRecordMapping[e].isPredictionEnabled=t.feature._used,t.configurations&&t.configurations.length>0){var i=[];for(var n of t.configurations){var s=n.resource;for(var r of n.associated_resources)if("fields"===r.type){var o={};for(var a of r.resources){var c=a._details.type;delete a._details,["is_ended_field","trend_field","accuracy_field"].includes(c)?o[c]=a:s[c]=a}s.insights_details=o}s=JSON.parse(JSON.stringify(s).replace(new RegExp('"is_ended_field"',"g"),'"isEnded_field"')),s=JSON.parse(JSON.stringify(s).replace(new RegExp('"relation_field"',"g"),'"relation"')),i.push(s)}moduleRecordMapping[e].prediction_details=i}break;case"recommendation":case"recommendation_early_access":if(moduleRecordMapping[e].isRecommendationsEnable=t.feature._used,t.configurations&&t.configurations.length>0){s=t.configurations[0].resource;for(var r of(s=JSON.parse(JSON.stringify(s).replace(/"active":/g,'"enabled":')),t.configurations[0].associated_resources))if("modules"===r.type)for(var a of r.resources){c=a._details.type;delete a._details,s[c]=a}moduleRecordMapping[e].recommendationsDetailsJson=s}break;case"similarity":moduleRecordMapping[e].isSimilarityEnable=t.feature._used;break;case"best_time":if(t.configurations&&t.configurations.length>0){s=t.configurations[0].resource;for(var r of t.configurations[0].associated_resources)if("modules"===r.type)for(var a of r.resources){c=a._details.type;delete a._details,s[c]=a}s=JSON.parse(JSON.stringify(s).replace(/"module_relation":/g,'"moduleRelation":')),moduleRecordMapping[e].best_time_data=s}break;case"next_best_action":case"next_best_experience":if(moduleRecordMapping[e].isNbxEnabled=t.feature._used,t.configurations&&t.configurations.length>0){s={};for(var r of(s=t.configurations[0].resource,t.configurations[0].associated_resources))if("fields"===r.type)for(var a of r.resources){c=a._details.type;delete a._details,"medium"===c&&(c="action"),s[c]="relation"===c?a.api_name:a}moduleRecordMapping[e].NBX=s}break;case"Competitors_Alert":if(moduleRecordMapping[e].isCompetitorMentionEnabled=t.feature._used,t.configurations&&t.configurations.length>0){s={};for(var l of(s.competitors=t.configurations[0].resource.competitors,s.relation=new Map,s.module=[],s.fields=[],t.configurations.associated_resources))if("modules"===l.type)s.module=l.resources[0];else if("fields"===l.type)for(var d of l.resources)"relation"===d._details.type?(s.relation.set("id",d.id),s.relation.set("api_name",d.api_name)):(delete d._details,s.fields.push(d));moduleRecordMapping[e].competitor_mention_details=s}break;case"call_intelligence":moduleRecordMapping[e].isCallTranscriptionEnable=t.feature._used,t.configurations&&t.configurations.length>0&&(moduleRecordMapping[e].call_transcription=t.configurations[0].resource)}}catch(e){murphy.error(e)}}))},isFeatureEnabled:function(e,t){if(e&&t){var i=store.peekRecord("features-status",t.api_name);if(i&&i.status){var n=Object.assign(...i.status.map((e=>({[e.api_name]:e.used}))));if((n?Object.keys(Object.fromEntries(Object.entries(n).filter((([e,t])=>t&&e)))):[]).includes(e))return!0}return!1}return!0},getInsightsV2:function(e,t,i,n,s){if(this.isValidModule(e)&&this.isFeatureEnabled(s,e)){const s=["predictions_data","recommendation_data","next_best_action_data","similarity_data","churn_predictions_data","vision_data","zia_suggested_users_data","best_time_data","call_analytics_data","scoring_rule_data","best_mode_data","competitor_mentions","competitor_mentions_data"];var r=!1,o=i&&i.keys,a=o?i.keys.split(","):[],c=store.peekRecord("zia-insights-v2",t.toString());const g=c||store.createRecord("zia-insights-v2",{id:t.toString()});if(o&&1===a.length&&g.keyVsPromise)for(var l=(u=g.keyVsPromise).length,d=0;d<l;d++)if(u[d].keys.includes(a[0]))return u[d].promise;if(g.keyVsPromise){l=(u=g.keyVsPromise).length;var u,m=[];for(d=0;d<l;d++)m.push(...u[d].keys);r=a.filter((e=>!m.includes(e))).length>0}else r=!0;var _=g.in_process_promise;if(c&&_&&_.isFulfilled()){let e=o?i.keys.split(","):[],t=Object.keys(c);if(t.includes("competitor_mentions_data")&&(t[t.indexOf("competitor_mentions_data")]="competitor_mentions"),e.every((e=>t.includes(e)))){const e={};return Object.keys(c).filter((e=>s.contains(e))).forEach((t=>{e[t]=c.$.get(t)})),Promise.resolve({zia_insights:e})}o&&(i.keys=e.filter((e=>!t.contains(e))).join(",")),delete g.in_process_promise}if(g.in_process_promise&&!r)return g.in_process_promise;const f=new URLSearchParams(i||{}).toString(),C={url:`/crm/v7/${e.api_name}/${t}/actions/zia_insights${""!==f?"?"+f:""}`};let y=store.findAll("zia-insights-v2",null,!1,!1,C).then((e=>{var t=e&&e.zia_insights?e.zia_insights:void 0;if(!t)return Promise.reject(void 0);Object.keys(t).forEach((e=>{g.$.set(e,t[e])}));const i={};return Object.keys(g).filter((e=>s.contains(e))).forEach((e=>{i[e]=g.$.get(e)})),n&&n({zia_insights:i}),Promise.resolve({zia_insights:i})}),(()=>Promise.reject(void 0)));const R=e=>{let t=!0,i=!1,n=!1,s=e.then((function(e){return n=!0,t=!1,e}),(function(e){throw i=!0,t=!1,e}));return s.isFulfilled=function(){return n},s.isPending=function(){return t},s.isRejected=function(){return i},s};g.in_process_promise?g.$.set("in_process_promise",R(Promise.all([g.in_process_promise,R(y)]))):g.$.set("in_process_promise",R(y));var p={keys:a,promise:y};return g.keyVsPromise?g.keyVsPromise.push(p):g.$.set("keyVsPromise",[p]),y}},getInsights:function(e,t,i,n,s){if(!this.isFeatureEnabled(s,e))return;if(!this.isValidModule(e))return;const r=i&&i.keys,o=new URLSearchParams(i||{}).toString(),a={headers:{"X-ZOHO-SERVICE":"crm/lookupTooltip"},url:`/crm/v7/${e.api_name}/${t}/actions/zia_insights${""!==o?"?"+o:""}`};if(!r){var c=store.peekRecord("zia-insights",t);if(c)return c.promise}if(r){store.unloadRecord("zia-insights-keys",t);const e={id:t,promise:store.findAll("dummy",null,!1,!1,a)};return store.createRecord("zia-insights-keys",e).promise.then((function(e){return new Promise(((t,i)=>{var s=e.zia_insights;if(s)return t({zia_insights_keys:JSON.parse(JSON.stringify(s))}),n(JSON.parse(JSON.stringify(s)));i(void 0)}))}),(function(){return new Promise((e=>{e(void 0)}))}))}{const e={id:t,promise:store.findAll("dummy",null,!1,!1,a)};return store.createRecord("zia-insights",e).promise.then((function(e){return new Promise(((t,i)=>{var n=e.zia_insights;n?t({zia_insights:JSON.parse(JSON.stringify(n))}):i(void 0)}))}),(function(){return new Promise((e=>{e(void 0)}))}))}},renderZiaFeatureComponent:function(e,t,i,n,s,r,o,a){var c,l,d,u,m="",_=[];switch("Leads"!==t&&"Contacts"!==t&&"Potentials"!==t&&"Deals"!==t||"zia_score"!==e||!i||i.Full_Name||(i.Full_Name=i.name),e){case"best_time_to_contact":m="crm-besttime-new",c={module:t,seid:i.id,isTitleNeeded:!0,stateId:o+a,isKioskComponent:!0,name:i.name?i.name:"",parentComponent:s},l=networkUtils.returnDependencyFiles(["crm-besttime-new.js","besttime_zia_new_model.js","zia_reminder_model.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["crm-besttime-new.css"],ResourceConstants.CRMClient),_=_.concat(l).concat(d);break;case"churn_prediction":m="crm-canvas-churn-prediction-result",c={module:t,record:i,isTitleNeeded:!0,isKioskComponent:!0},l=networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction-result.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ChurnPrediction"),networkUtils.getI18nJSUrl("reasoning")],ResourceConstants.CRM);var p=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),g=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);_=_.concat(l).concat(d).concat(u).concat(p).concat(g);break;case"prediction":m="crm-prediction-canvas-detail-page",c={module:t,record:i,isTitleNeeded:!0},l=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reasoning")],ResourceConstants.CRM),_=_.concat(l.concat(d).concat(u));break;case"next_best_action":case"next_best_experience":m="crm-nba-canvas-detail-page",c={record:i,isTitleNeeded:!0,config_module:t,isFromKiosk:!0},l=(l=networkUtils.returnDependencyFiles(["nba-detail-page.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["zia/nbx/crm-nba-mixins.js"],ResourceConstants.CRMClient)),d=networkUtils.returnDependencyFiles(["zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],ResourceConstants.CRM),_=_.concat(l).concat(d).concat(u);break;case"zia_score":m="crm-canvas-zia-score-result",c={module_name:t,record:i,isTitleNeeded:!0},l=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);p=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),g=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaScore")],ResourceConstants.CRM),_=_.concat(l).concat(d).concat(p).concat(g).concat(u);break;case"Competitors_Alert":m="crm-competitormention-widget",c={module:t,entityId:i.id,entityEmail:i.Email,isEmptyScreenNeeded:!0,isTitleNeeded:!0},s&&r&&"kiosk"===r&&(c.parentComponent=s,c.parentFeatureName=r),l=networkUtils.returnDependencyFiles(["crm-competitors-utilities.js","crm-competitormention-widget.js","crm-ui-loaders.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["crm-competitormention-widget.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CompetitorAlertsWidget")],ResourceConstants.CRM),_=_.concat(l).concat(d).concat(u);break;case"recommendation_early_access":m="crm-recommendation-details-newview",c={entity_module:t,entity_id:i.id,isCanvasView:!0,isEmptyScreenNeeded:!0,isTitleNeeded:!0},l=networkUtils.returnDependencyFiles(["recommendation-util.js","crm-recommendation-details-newview.js","recommendation-detailed-main.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["recommendation-details-page.css","crm-recommendation-details-newview.css"],ResourceConstants.CRMClient),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail")],ResourceConstants.CRM),_=_.concat(l).concat(d).concat(u);break;case"similarity":m="crm-similarity-result",c={entity_module:t,entity_id:i.id,isCanvasView:!0,isEmptyScreenNeeded:!0,isTitleNeeded:!0},l=networkUtils.returnDependencyFiles(["recommendation-util.js","crm-recommendation-details-newview.js","similarity-details-page.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["recommendation-details-page.css","crm-recommendation-details-newview.css"],ResourceConstants.CRMClient);var f=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail"),networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM),_=_.concat(l).concat(d).concat(f).concat(u);break;default:return}var C=networkUtils.returnDependencyFiles(["zia-helpers.js"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM);_=_.concat(C).concat(y),Lyte.injectResources(_,void 0,(function(){Lyte.Component.render(m,c,n)}))},getFeatureLabel:function(e){switch(e){case"best_time_to_contact":return I18n.getMsg("crm.zia.config.best.time.to.contact");case"churn_prediction":return I18n.getMsg("crm.zia.prediction.churn");case"prediction":return I18n.getMsg("crm.predictions.feature.label");case"next_best_action":case"next_best_experience":return I18n.getMsg("crm.zia.nba.feature.label");case"Competitors_Alert":return I18n.getMsg("crm.setup.system.competitors1");case"zia_score":return I18n.getMsg("crm.setup.system.ziascore");case"recommendation_early_access":return I18n.getMsg("crm.setup.system.ziarecommendation");case"similarity":return I18n.getMsg("crm.setup.system.ziasimilarity");default:return e}},invokeZiaInsightsAPI:function(e,t,i){if(!i){var n=store.peekRecord("features-status",e.api_name);if(n&&n.status){var s=Object.assign(...n.status.map((e=>({[e.api_name]:e.used}))));i=s?Object.keys(Object.fromEntries(Object.entries(s).filter((([e,t])=>t&&e)))):[]}}const r=["churn_prediction","prediction","next_best_action","recommendation_early_access","similarity","zia_score","Competitors_Alert","call_transcription","best_mode_to_contact","best_time_to_contact"];i&&(i=i.filter((function(e){return r.includes(e)})));for(var o=i?i.length:0,a=[],c=0;c<o;c++){switch(i[c]){case"churn_prediction":a.push("churn_predictions_data");break;case"prediction":a.push("predictions_data");break;case"next_best_action":case"next_best_experience":a.push("next_best_action_data");break;case"recommendation_early_access":a.push("recommendation_data");break;case"similarity":a.push("similarity_data");break;case"zia_score":a.push("scoring_rule_data");break;case"Competitors_Alert":a.push("competitor_mentions");break;case"best_time_to_contact":case"best_mode_to_contact":if("Deals"===e.api_name||a.includes("best_mode_data"))break;a.push("best_mode_data");break;case"call_transcription":a.push("call_analytics_data");break;default:continue}}var l=[],d=a.length;for(let i=0;i<d;i+=5){var u=a.slice(i,i+5),m={keys:u.toString()};if(u.includes("similarity_data")){var _="similarity_data.similarity.selected_views";m.include_inner_details=m.include_inner_details?m.include_inner_details+","+_:_}if(u.includes("churn_predictions_data")||u.includes("predictions_data")){var p="predictions_data.output.critical_fields.field_label";m.include_inner_details=m.include_inner_details?m.include_inner_details+","+p:p}l.push(this.getInsightsV2(e,t,m,null,null))}return Lyte.resolvePromises(l)}}),Lyte.Mixin.register("zia-detail-view-insights",{getZiaResults:function(e,t,i,n,s){var r=Lyte.registeredMixins["zia-detail-view-insights"],o={};return o.insight=r.triggerZiaInsights(e,t),Lyte.resolvePromises(o).then((function(o){return r.parseZiaComponents(o.insight,e,t,i,n,s)}))},downloadZiaFiles:function(e){var t=[];if(e.prediction_supported){var i=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reasoning")],ResourceConstants.CRM);t=t.concat(i.concat(n).concat(s))}if(e.churn_supported){var r=networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction-result.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);t=t.concat(r).concat(o)}if(e.nba_supported){var a=networkUtils.returnDependencyFiles(["nba-detail-page.js"],ResourceConstants.CRMClient);a=a.concat(networkUtils.returnDependencyFiles(["zia/nbx/crm-nba-mixins.js"],ResourceConstants.CRMClient));var c=networkUtils.returnDependencyFiles(["zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],ResourceConstants.CRM);t=t.concat(a).concat(c).concat(l)}if(e.recommend_supported){var d=networkUtils.returnDependencyFiles(["recommendation-detailed-main.js","recommendation-util.js","crm-recommendation-details-newview.js"],ResourceConstants.CRMClient),u=networkUtils.returnDependencyFiles(["recommendation-details-page.css","crm-recommendation-details-newview.css"],ResourceConstants.CRMClient),m=networkUtils.returnDependencyFiles(["similarity-details-page.js"],ResourceConstants.CRMClient),_=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),p=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail"),networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM);t=t.concat(d).concat(u).concat(m).concat(_).concat(p)}if(e.zia_score_supported){var g=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.js"],ResourceConstants.CRMClient),f=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),C=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),y=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM),R=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaScore")],ResourceConstants.CRM);t=t.concat(g).concat(f).concat(C).concat(y).concat(R)}if(e.zia_call_analytics_supported){var h=networkUtils.returnDependencyFiles(["recommendation-util.js","call-transcription-comp.js","crm-activity-rel-wrapper.js"],ResourceConstants.CRMClient),w=networkUtils.returnDependencyFiles(["crm-zia-call-analytics.css","crm-zia-call-transcription.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),b=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zia-call-analytics")],ResourceConstants.CRM);t=t.concat(h).concat(w).concat(b)}if(e.competitor_mentions_supported){var k=networkUtils.returnDependencyFiles(["crm-competitors-utilities.js","crm-competitormention-widget.js","crm-ui-loaders.js"],ResourceConstants.CRMClient),v=networkUtils.returnDependencyFiles(["crm-competitormention-widget.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),M=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CompetitorAlertsWidget")],ResourceConstants.CRM);t=t.concat(k).concat(v).concat(M)}if(e.best_time_supported){var U=networkUtils.returnDependencyFiles(["crm-besttime-new.js","besttime_zia_new_model.js","zia_reminder_model.js"],ResourceConstants.CRMClient),F=networkUtils.returnDependencyFiles(["crm-besttime-new.css"],ResourceConstants.CRMClient);t=t.concat(U).concat(F)}var z=networkUtils.returnDependencyFiles(["zia-helpers.js"],ResourceConstants.CRMClient),D=networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM);return t=t.concat(z).concat(D)},triggerZiaInsights:function(e,t){var i={},n=t.id,s=moduleRecordMapping[e],r={keys:"scoring_rule_data,call_analytics_data"};("Leads"===e||"Contacts"===e)&&s.isCompetitorMentionEnabled&&t.Email&&(r.keys+=",competitor_mentions");var o={};return o.zia_insights_default=Lyte.registeredMixins["zia-insights-utils"].getInsights(s,n,{include_inner_details:"similarity_data.similarity.selected_views,predictions_data.output.critical_fields.field_label"}),o.zia_insights_second=Lyte.registeredMixins["zia-insights-utils"].getInsights(s,n,r),Lyte.resolvePromises(o).then((function(e){var t;e.zia_insights_default&&((t=e.zia_insights_default.zia_insights)&&(i.predictions_data=t.predictions_data,i.recommendation_data=t.recommendation_data,i.churn_predictions_data=t.churn_predictions_data,i.next_best_action_data=t.next_best_action_data,i.similarity_data=t.similarity_data));e.zia_insights_second&&((t=e.zia_insights_second.zia_insights_keys)&&(i.scoring_rule_data=t.scoring_rule_data,i.call_analytics_data=t.call_analytics_data,t.competitor_mentions_data&&(i.competitor_mentions_data=t.competitor_mentions_data)));return i}))},parseZiaComponents:function(e,t,i,n,s,r){var o=Lyte.registeredMixins["zia-detail-view-insights"],a={};return a.module=t,a.record=i,a.entity_id=i.id,a.layout_id=n,a.meta_info=s,a.zia_info=r,a.feature_count=0,a=o.processFieldPrediction(e.predictions_data,a),a=o.processRecommendation(e.recommendation_data,a),a=o.processChurnDetails(e.churn_predictions_data,a),a=o.processNextBestActionDetails(e.next_best_action_data,a),a=o.processSimilarity(e.similarity_data,a),a=o.processZiaScore(e.scoring_rule_data,a),a=o.processBestTimeData(a,r),a=o.processCompetitorMentions(e.competitor_mentions_data,a),a=o.processCallAnalytics(e.call_analytics_data,a)},increaseFeatureCount:function(e){return e.feature_count=e.feature_count+1,e},processFieldPrediction:function(e,t){if(e){for(var i={},n=[],s=e.length,r=t.record,o=t.layout_id,a=0;a<s;a++){var c=e[a],l=c.prediction,d={};if(d.id=l.id,d.name=l.name,d.trend=c.output.trend,c.output.critical_fields&&(d.critical_fields=c.output.critical_fields),l.score_to?store.peekRecord("field",l.predict_field.id)[o]&&store.peekRecord("field",l.prediction_field.id)[o]&&store.peekRecord("field",l.score_to.id)[o]:store.peekRecord("field",l.predict_field.id)[o]&&store.peekRecord("field",l.prediction_field.id)[o]){d.label=store.peekRecord("field",l.predict_field.id).field_label;var u=store.peekRecord("field",l.prediction_field.id),m=objectUtils.cloneObject(u);if(Lyte.registeredMixins["crm-detailview-parser"].populateFieldAttributes(u,m,"prediction",t.module),d.result=m,void 0===d.result||void 0===r[m.api_name])continue;if(d.value=r[m.api_name],l.score_to){d.isScoreAvail=!!l.score_to;var _=store.peekRecord("field",l.score_to.id),p=objectUtils.cloneObject(_);if(Lyte.registeredMixins["crm-detailview-parser"].populateFieldAttributes(_,p,"prediction",t.module),d.score=p,void 0===d.score||void 0===r[p.api_name])continue;d.score=r[p.api_name]}n.push(d)}}if(n.length)return i.tabId=moduleRecordMapping[t.module].id,i.recordId=r.id,i.prediction=n,i.record=r,i.module=t.module,i.layout_id=o,i.meta_info=t.meta_info,i.isNewView=!0,t.field_prediction_component_data=i,t.showFieldPrediction=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processChurnDetails:function(e,t){if(e){var i=t.record,n=t.layout_id,s=[],r={};r.record=i,r.module=t.module;for(var o=e.length,a=0;a<o;a++){var c=e[a].churn_prediction,l={};l.id=c.id,l.name=c.name;var d=store.peekRecord("field",c.score_field.id),u=c.prediction_field?store.peekRecord("field",c.prediction_field.id):null;if(u?u[n]&&d[n]:d[n]){if(l.label=I18n.getMsg("crm.zia.prediction.churn.result.nonsub"),l.value=i[d.api_name],u){var m=i[u.api_name];l.label=("string"==typeof m?m:m.name)+" "+I18n.getMsg("crm.zia.prediction.churn.result.sub")}void 0!==l.value&&s.push(l)}}if(s.length)return r.churn_prediction=s,t.churn_prediction_component_data=r,t.showChurnPrediction=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processNextBestActionDetails:function(e,t){if(e){var i={},n=e[0],s=Lyte.registeredMixins["crm-nba-utils"].getSuggestionData(n,t.module);return i.next_best_action=s.next_best_action,i.is_nba_available=s.is_nba_available,i.suggestion=s.suggestion,i.duration=s.duration,i.module=s.module,i.mentioneddetails=s.mentioned_details,i.trigerobj=s.triger_obj,i.record=t.record,i.currentModule=t.module,t.next_best_action_component_data=i,t.showNextBestAction=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processCallAnalytics:function(e,t){if(e||moduleRecordMapping&&moduleRecordMapping.Calls&&moduleRecordMapping.Calls.isCallTranscriptionEnable){var i=t.record,n={};return n.record_id=i.id,t.zia_call_analytics_data=n,t.showZiaCallAnalytics=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t),Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processZiaScore:function(e,t){if(e)for(var i=e.length,n=0;n<i;n++){var s=e[n].scoring_rule,r=t.module,o=t.record,a={};a.record_id=o.id,a.record_name="Potentials"===r||"Deals"===r?o.Deal_Name:o.Lead_Name,a.record_owner=o.Owner.name,a.module_label=moduleRecordMapping[r].singular_label,a.id=s.id,a.name=s.name;var c=t.meta_info.fieldColumnNameMap;for(let i in c)if(c[i][0]===s.score_field.id){s=e[n].output.score;a.score=s,$("#subvalue_"+i).html(s),t.zia_score_component_data=a,t.showZiaScore=!0;break}return Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processCompetitorMentions:function(e,t){if(e&&e.output){var i={};if(i.entityId=t.record.id,i.module=t.module,i.entityEmail=t.record.Email,i.competitorInsight=e.output,t.competitor_mentions_data=i,t.showCompetitorMentions=!0,t.showCompetitorMentions)return Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processBestTimeData:function(e,t){var i=!Crm.userDetails.isBTPermissionMigrationRun||Crm.userDetails.permissions.Crm_Implied_View_Result_BestTime;if(e.showBestTime=i&&!(Crm.userDetails.isSandbox||Crm.userDetails.CLIENT_ACCOUNT||Crm.userDetails.LITE.IS_LITE_USER)&&(Crm.userDetails.isBestTimeEnabledCall||Crm.userDetails.isBestTimeEnabledMail),!e.showBestTime)return e;var n=e.module,s=e.record,r={record_name:s.Full_Name};return"Potentials"!==n&&"Deals"!==n||!s.Contact_Name?"Potentials"!==n&&"Deals"!==n||s.Contact_Name?r.record_id=s.id:e.showBestTime=!1:(r.record_id=s.Contact_Name.id,r.record_name=s.Contact_Name.name),e.best_time_component_data=r,t.best_time_supported&&e.showBestTime?Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(e):e},processSimilarity:function(e,t){var i=t.module,n={};if(e){var s=e[0].output;return s.sort((function(e,t){return t.score-e.score})),n.module=moduleRecordMapping[i],n.similarities=s,n.similarityConfig=e[0].similarity,t.similarity_component_data=n,t.showRecommendationSimilarity=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}return t},processRecommendation:function(e,t){var i=t.module;if(e&&e.length>0){var n=e[0];if(n){var s=n.output;if(s.length){var r=s[0],o=n.recommendation,a=store.createRecord("recommendations-details");a.$.set("recommendation_id",o.id),a.$.set("name",o.name),a.$.set("first_buy",r.first_buy),a.$.set("next_buy",r.next_buy),a.$.set("rebuy",r.rebuy),a.$.set("frequently_bought_together",r.frequently_bought_together),a.$.set("customer_also_bought",r.customer_also_bought),a.$.set("whom_to",o.whom_to),a.$.set("what_to",o.what_to),a.$.set("based_on",o.based_on);var c={};return c.recommendationsDetails=a,c.entity_module=i,c.entity_id=t.entity_id,t.recommendation_component_data=c,t.showRecommendation=!0,Lyte.registeredMixins["zia-detail-view-insights"].increaseFeatureCount(t)}}}return t}}),store.registerModel("zia-insights",{}),store.registerModel("zia-insights-v2",{id:Lyte.attr("string",{primaryKey:!0})}),store.registerModel("zia-insights-keys",{}),store.registerAdapter("zia-insights-v2",{headersForRequest:function(){var e=this.$super.headersForRequest();return e["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken,e["X-ZOHO-SERVICE"]="crm/lookupTooltip",e["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",window.clientPortalName&&(e["X-CRMPORTAL"]=window.clientPortalName),e},buildURL:function(e,t,i,n,s,r,o){return s=(s=s.replace(/\/crm\/.*/,"/crm/")).replace("/crm/",o.url)}}),store.registerSerializer("zia-insights-v2",{});
