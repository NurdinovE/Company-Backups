Lyte.Component.register("crm-assign-territory-detail-view",{_template:'<template tag-name="crm-assign-territory-detail-view"> <lyte-event-listener event-name="update_territories" on-fire="{{action(\'handleRefresh\')}}"> <template is="if" value="{{fromRl}}"><template case="true"> <div class="pR br6 cP pL10 w350 maxW100per" id="assignTerr_{{seid}}" data-zcqa="link_AssignTerritoriesinRl"> <template is="if" value="{{expHandlers(terrLimit,\'===\',1)}}"><template case="true"> <lyte-text lt-prop-min-count="1" class="vaBottom mL5 maxW330 {{if(fromCanvasView,true,\'w100_per\',\'w80_per\')}}" lt-prop-value="{{assignedTerrforInput[0].name}}" data-zcqa="pot_assignedInfo"></lyte-text> </template><template case="false"> <lyte-text data-zcqa="otherModTerrInfo_fromRL" class="w70_per vaBottom atr_selectedTerr" lt-prop-array="{{assignedTerrforInput}}" lt-prop-min-count="1" lt-prop-suffix=" {{getI18n(\'crm.assign.territory.and.others\')}}"></lyte-text> </template></template> </div> </template><template case="false"> <div class="{{if(isDetailViewRevamp,\'\',\'pR\')}} br6 {{if(ifEquals(fromCanvasView,true),\'canvasTerrCont dIB\',\'w350\')}} {{if(expHandlers(isDetailViewRevamp,\'||\',fromCanvasView),\'\',\'atr_inputCont atr_inputHover\')}} cP maxW100per" id="assignTerr_{{seid}}" data-zcqa="link_AssignTerritories" onclick="{{action(\'assignTerritories\')}}"> <template is="if" value="{{expHandlers(assignedTerrforInput.length,\'>\',0)}}"><template case="true"> <div class="dvTerrCont {{if(ifEquals(fromCanvasView,true),\'dF aiCenter\',\'maxW90per\')}}" data-zcqa="link_TerritoriesList" id="assingedTerritories_{{seid}}"> <template is="if" value="{{expHandlers(terrLimit,\'===\',1)}}"><template case="true"> <template is="if" value="{{expHandlers(fromCanvasEditor,\'!\')}}"><template case="true"> <crmutil-icon icon-name="info-rounded" icon-class="zcicn-info-rounded zcicn_grey {{if(isDetailViewRevamp,\'zcicn16\',\'\')}}" data-zcqa="atr_inputInfoIcon" lt-prop-title="{{getI18n(\'crm.territory.assign.territory.assigned.by.and.assigned.on\',if(ifEquals(assignedTerrforInput[0].$assigned,\'manually\'),assignedTerrforInput[0].$assigned_by,getI18n(\'crm.record.lock.automatically\')),formatDateForTerritory(assignedTerrforInput[0].$assigned_time))}}"></crmutil-icon> </template></template> <lyte-text lt-prop-min-count="1" class="vaBottom mL5 maxW330 {{if(ifEquals(fromCanvasView,true),\'atr_canvasTerr w100_per\',\'w80_per\')}}" lt-prop-value="{{assignedTerrforInput[0].name}}" data-zcqa="pot_assignedInfo"></lyte-text> <template is="if" value="{{expHandlers(expHandlers(expHandlers(assignedTerrforInput,\'&amp;&amp;\',assignedTerrforInput[0].showRemove),\'&amp;&amp;\',expHandlers(isRecLocked,\'!\')),\'&amp;&amp;\',expHandlers(fromCanvasEditor,\'!\'))}}"><template case="true"> <crmutil-icon class="{{if(ifEquals(fromCanvasView,true),\'atr_editClose_canvas mL5\',\'pA right40 atr_editClose\')}}" data-zcqa="atr_singleTerrRemove" icon-name="close-9" icon-class="zcicn-close-9 zcicn9 crmBaseIcon " onclick="{{action(\'removeSingleTerritory\')}}"></crmutil-icon> </template></template> </template><template case="false"> <lyte-text data-zcqa="otherModTerrInfo" lt-prop-min-count="1" class="{{if(ifEquals(fromCanvasView,true),\'w100_per\',\'w70_per\')}} maxW330 vaBottom atr_selectedTerr" lt-prop-array="{{assignedTerrforInput}}" lt-prop-suffix=" {{getI18n(\'crm.assign.territory.and.others\')}}"></lyte-text> </template></template> </div> </template><template case="false"><template is="if" value="{{fromCanvasView}}"><template case="true"> <span class="atr_canvasTerrEmpty">-</span> </template><template case="false"> <span data-zcqa="atr_emptyTerrInfo" class="atr_empty"></span> </template></template></template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(canassign,\'&amp;&amp;\',expHandlers(isRecLocked,\'!\')),\'&amp;&amp;\',expHandlers(fromCanvasView,\'!\')),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <template is="if" value="{{expHandlers(isDetailViewRevamp,\'!\')}}"><template case="true"><crmutil-icon data-zcqa="atr_editTerritoryInfo" class="atr_editIcon pA right15" icon-name="edit-filled-md" icon-class="zcicn-edit-filled-md zcicn12 crmBaseIcon"></crmutil-icon></template></template> </template></template> </div> </template></template> <template is="if" value="{{loadCruxTerritoryOnInit}}"><template case="true"> <crux-territory data-zcqa="cxTerrCompInDV" cx-prop-show-modal="true" cx-prop-type="{{if(expHandlers(terrLimit,\'===\',1),\'single\',\'multiple\')}}" cx-prop-item-yield="true" cx-prop-show-radio-button="{{if(expHandlers(terrLimit,\'===\',1),\'true\',\'false\')}}" cx-prop-show-close-icon-modal="{{if(expHandlers(isRecLocked,\'||\',expHandlers(expHandlers(isAdministrator,\'!\'),\'&amp;&amp;\',isLiteUser)),true,false)}}" cx-prop-search-suffix-yield="true" cx-prop-territory="{{orgTerrWithChild}}" cx-prop-value="{{assignedTerrObj}}" cx-prop-search="dropdownSearch" cx-prop-disabled-ids="{{disabledTerritories}}" on-before-check-territory="{{method(\'selectTerritory\')}}" on-before-uncheck-territory="{{method(\'unSelectTerritory\')}}" cx-prop-modal-footer-yield="true" cx-prop-modal-header-yield="true" id="atr_cruxTerrComp_{{seid}}" cx-prop-allow-multiple-modal="true" on-territory-tree-open="{{method(\'onTerritoryTreeNodeOpen\')}}" on-territory-tree-close="{{method(\'onTerritoryTreeNodeClose\')}}" on-territory-tree-modal-show="{{method(\'onTerritoryTreeNodeOpen\')}}" on-scroll-to-territory-end="{{method(\'onTerritoryTreeNodeOpen\')}}" on-territory-modal-close="{{method(\'onCancelTerritoryModal\')}}" cx-prop-tree-max-level="100"> <template is="yield" yield-name="modalHeaderYield"> <div class="boxBB pR dF aiCenter"> <template is="if" value="{{expHandlers(expHandlers(assignedTerrObj.length,\'>\',0),\'&amp;&amp;\',expHandlers(terrLimit,\'>\',1))}}"><template case="true"> <crmutil-icon class="cP atr_Modal mR10" icon-name="arrow-back" onclick="{{action(\'backToSummarizeView\')}}" icon-class="zcicn-arrow-back crmBaseIcon" data-zcqa="cx_territory_back"></crmutil-icon> </template></template> {{getI18n(\'crm.mxnlookup.select\',getI18n(if(expHandlers(terrLimit,\'===\',1),\'Territory\',\'Territories\')))}} </div> </template> <template is="yield" yield-name="searchSuffixYield"> <template is="if" value="{{isExpandNeeded}}"><template case="true"> <span class="crmLabelColor pR mL10 cP atr_clearBtn vaM dIB" data-zcqa="atr_expandALL" onclick="{{action(\'expandAll\')}}" id="atr_expandCollapseAll">{{getI18n(\'crm.label.expand.all\')}}</span> </template><template case="false"><template is="if" value="{{orgTerrWithChild[0].children}}"><template case="true"> <span class="crmLabelColor pR mL10 cP atr_clearBtn vaM dIB" data-zcqa="atr_collapseAll" onclick="{{action(\'collapseAll\')}}" id="atr_expandCollapseAll">{{getI18n(\'crm.label.collapse.all\')}}</span> </template></template></template></template> <template is="if" value="{{expHandlers(noOfSelected,\'>\',0)}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(terrLimit,\'===\',1),\'&amp;&amp;\',expHandlers(changedSelectedTerrArr.length,\'>\',0))}}"><template case="true"> <span class="mL10 vaM dIB" id="atr_selectTerrTxt" data-zcqa="atr_selectedTxt"> {{getI18n(\'crm.record.selected\',\':\')}} </span> <template is="for" items="{{changedSelectedTerrArr}}" item="assignedTerritory" index="index"> <template is="if" value="{{expHandlers(assignedTerritory.show,\'==\',true)}}"><template case="true"> <lyte-text class="dIB mL10 tdUnderline crm-font-semibold cP vaM" data-zcqa="atr_selectedTerrTxt" onclick="{{action(\'goToSelectedTerr\',assignedTerritory)}}" id="atr_terrSelect" lt-prop-value="{{territoryIdVsName[assignedTerritory.id]}}"> </lyte-text> </template></template> </template> </template><template case="false"> <span class="dIB mL10 crmLinkColor crmLinkHover cP vaM" data-zcqa="atr_openSelectedRecords" onclick="{{action(\'openSelectedRecord\')}}"> {{unescape(getI18n(if(expHandlers(noOfSelected,\'===\',1),\'crm.assign.territory.no.of.territory.selected\',\'crm.territory.assign.territory.no.of.records.selected\'),noOfSelected))}} </span> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <span class="atr_clearBtn crmLabelColor pR mL5 cP vaM dIB" data-zcqa="atr_clearSelectedRecords" onclick="{{action(\'clearSelected\',true)}}">{{getI18n(\'crm.title.clear.name\')}}</span> </template></template> </template></template> </template></template> </template> <template is="yield" yield-name="itemYield"> <template is="for" items="{{assignedTerrObj}}" item="territory" index="index"> <template is="if" value="{{expHandlers(territory.id,\'===\',itemValue.id)}}"><template case="true"> <crmutil-icon data-zcqa="atr_assignedInfo" class="mL5 mT2" icon-name="info-solid" icon-class="zcicn-info-solid zcicn_grey" id="atr_infoIcon_{{territory.id}}" lt-prop-title="{{getI18n(\'crm.territory.assign.territory.assigned.by.and.assigned.on\',if(ifEquals(territory.$assigned,\'manually\'),territory.$assigned_by.name,getI18n(\'crm.record.lock.automatically\')),formatDateForTerritory(territory.$assigned_time))}} "></crmutil-icon> <template is="if" value="{{indexOf(manullyAddedCantRemove,itemValue.id,\'>=\',0)}}"><template case="true"> <crmutil-icon data-zcqa="atr_disabledLockInfo" icon-name="lock-locked-line" class="mL5 mT1" icon-class="zcicn-lock-locked-line crmBaseIcon" lt-prop-title="{{getI18n(\'crm.territory.detail.view.assign.territory.manual.assigned.disabled\')}}"></crmutil-icon> </template></template> </template></template> </template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(itemValue.id,\'!==\',orgTerrId),\'&amp;&amp;\',indexOf(manullyAddedCantRemove,itemValue.id,\'==\',expHandlers(1,\'-\'))),\'&amp;&amp;\',indexOf(userParticipationOnly,itemValue.id,\'>=\',0))}}"><template case="true"> <crmutil-icon data-zcqa="atr_LockedInfo" icon-name="lock-locked-line" class="mL5 mT1" icon-class="zcicn-lock-locked-line crmBaseIcon " lt-prop-title="{{getI18n(\'crm.territory.detail.view.assign.territory.lock.info\')}}"></crmutil-icon> </template></template> </template> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <template is="yield" yield-name="modalFooterYield"> <lyte-button onclick="{{action(\'onCancelTerritoryModalAction\')}}" data-zcqa="cx_territory_Cancel"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'saveAssignedTerritories\')}}" data-zcqa="cx_territory_add" lt-prop-disabled="{{disableSaveButton}}"> <template is="registerYield" yield-name="text"> <template is="if" value="{{expHandlers(terrLimit,\'===\',1)}}"><template case="true"> {{getI18n(\'crm.label.assign.manually\')}} </template><template case="false"> <template is="if" value="{{expHandlers(assignedTerrObj.length,\'>\',0)}}"><template case="true"> {{getI18n(\'crm.button.save\')}} </template><template case="false"> {{getI18n(\'crm.button.add\')}} </template></template> </template></template> </template> </lyte-button> </template> </template></template> </crux-territory> </template></template> <template is="if" value="{{showSummVieModal}}"><template case="true"> <lyte-modal id="at_selectedRecordsModal" lt-prop-height="auto" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;}" lt-prop-width="800px" lt-prop-show-close-button="{{if(expHandlers(isRecLocked,\'||\',expHandlers(expHandlers(isAdministrator,\'!\'),\'&amp;&amp;\',isLiteUser)),true,false)}}" on-before-show="{{method(\'showOrCloseSummarizeModal\')}}" on-before-close="{{method(\'showOrCloseSummarizeModal\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <div>{{tableHeader}}</div> <div class="flexAlignCenter mT10"> <lyte-search id="at_selectedRecordsModalSearch" lt-prop-close-icon="true" lt-prop-query-selector="{&quot;scope&quot; : &quot;.atr_table lyte-tbody&quot;, &quot;search&quot; : &quot;lyte-td:first-of-type&quot;, &quot;target&quot; : &quot;lyte-tr&quot;}" data-zcqa="lytSrchInAssignTerr" lt-prop-appearance="box" lt-prop-placeholder="{{getI18n(\'crm.globalsearch.search.title\')}}" on-search="{{method(\'onSearchLyteTable\')}}"></lyte-search> <template is="if" value="{{expHandlers(noOfSelected,\'>\',0)}}"><template case="true"> <div class="crm-font-regular crmBaseColor crm-base-font-size mL10" data-zcqa="atr_noofSelectTxt">{{unescape(getI18n(if(expHandlers(noOfSelected,\'===\',1),\'crm.assign.territory.no.of.territory.selected\',\'crm.territory.assign.territory.no.of.records.selected\'),noOfSelected))}}</div> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <div class="atr_clearBtn cP crm-font-regular crmLabelColor crm-base-font-size mL5 pR" onclick="{{action(\'clearSelected\',true)}}" data-zcqa="clearInDVSummarizeView">{{getI18n(\'crm.title.clear.name\')}}</div> </template></template> </template></template> </div> </lyte-modal-header> <lyte-modal-content> <div class="lyteOuterTable"> <lyte-table class="lyteFixedHeaderTable atr_table" lt-prop-yield="true"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-thead> <lyte-tr> <lyte-th class="crmLabelColor"> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <lyte-checkbox data-zcqa="summarizeHeaderChckBox" class="{{if(expHandlers(expHandlers(noOfSelected,\'!==\',0),\'&amp;&amp;\',expHandlers(isAllTerritoryChecked,\'!\')),\'lyteCheckboxPartial\',\'\')}}" lt-prop-name="checkbox" lt-prop-value="val" lt-prop-id="checkbox_all" on-checked="{{method(\'checkAllterritories\')}}" lt-prop-prevent-callback-observers="false" on-unchecked="{{method(\'clearSelected\',true)}}" lt-prop-checked="{{isAllTerritoryChecked}}" lt-prop-disabled="{{isMainCheckBoxDisabled}}"></lyte-checkbox> </template></template> <span class="dIB vaM">{{getI18n(\'Territory\')}} </span> </lyte-th> <lyte-th class="crmLabelColor w250"> {{getI18n(\'crm.territory.assign.territory.assigned.by\')}} </lyte-th> <lyte-th class="crmLabelColor"> {{getI18n(\'crm.territory.assign.territory.assigned.on\')}} </lyte-th> </lyte-tr> </lyte-thead> <lyte-tbody> <template is="for" items="{{changedSelectedTerrArr}}" item="assignedTerritory" index="index"> <lyte-tr> <lyte-td> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <lyte-checkbox data-zcqa="summarizeViewChckBox_{{assignedTerritory.id}}" class="dIB" lt-prop-name="checkbox" lt-prop-value="val" lt-prop-id="checkbox_{{assignedTerritory.id}}" lt-prop-checked="{{assignedTerritory.show}}" on-before-checked="{{method(\'selectTerritory\',,assignedTerritory.id,true)}}" on-before-unchecked="{{method(\'unSelectTerritory\',,assignedTerritory.id,true)}}" lt-prop-disabled="{{if(indexOf(disabledTerritories,assignedTerritory.id,\'<\',0),false,true)}}"></lyte-checkbox> </template></template> <lyte-text data-zcqa="summarizeViewTrNme_{{assignedTerritory.id}}" class="maxW190 dIB vaM" lt-prop-value="{{if(assignedTerritory.Name,assignedTerritory.Name,territoryIdVsName[assignedTerritory.id])}}"> </lyte-text> <template is="if" value="{{expHandlers(expHandlers(assignedTerritory.$assigned,\'===\',&quot;manually&quot;),\'&amp;&amp;\',expHandlers(assignedTerritory.can_remove,\'===\',false))}}"><template case="true"> <crmutil-icon icon-name="lock-locked-line" class="vaM" icon-class="zcicn-lock-locked-line crmBaseIcon " lt-prop-title="{{getI18n(\'crm.territory.detail.view.assign.territory.manual.assigned.disabled\')}}" data-zcqa="atr_TerrCantRemove_{{assignedTerritory.id}}"></crmutil-icon> </template><template case="false"><template is="if" value="{{indexOf(userParticipationOnly,assignedTerritory.id,\'>=\',0)}}"><template case="true"> <crmutil-icon icon-name="lock-locked-line" class="vaM" icon-class="zcicn-lock-locked-line crmBaseIcon " lt-prop-title="{{getI18n(\'crm.territory.detail.view.assign.territory.lock.info\')}}" data-zcqa="atr_TerrCantremoveLock_{{assignedTerritory.id}}"></crmutil-icon> </template></template></template></template> </lyte-td> <lyte-td class="h47"> <template is="if" value="{{assignedTerritory.$assigned}}"><template case="true"> <template is="if" value="{{expHandlers(assignedTerritory.$assigned,\'===\',&quot;manually&quot;)}}"><template case="true"> <img src="{{assignedTerritory.userImgLink}}" alt="user" class="w25 h25 atr_userImg vaM dIB"> <lyte-text data-zcqa="summarizeViewAssgnedBy_{{assignedTerritory.id}}" class="mL2 maxW200 dIB vaM" lt-prop-value="{{assignedTerritory.$assigned_by.name}}"> </lyte-text> </template><template case="false"> {{getI18n(\'crm.territory.label.auto.assigned\')}} </template></template> </template><template case="false"> - </template></template> </lyte-td> <lyte-td> <template is="if" value="{{assignedTerritory.$assigned_time}}"><template case="true"> {{formatDateForTerritory(assignedTerritory.$assigned_time)}} </template><template case="false"> - </template></template> </lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> <div class="noresultstyle dN" id="atr_noResult" data-zcqa="atr_noRows">{{getI18n(\'crm.label.no.rows\')}}</div> </div> </lyte-modal-content> <lyte-modal-footer class="dF spaceBetween"> <template is="if" value="{{expHandlers(expHandlers(isRecLocked,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(isLiteUser,\'!\'),\'||\',expHandlers(isAdministrator,\'&amp;&amp;\',isLiteUser)))}}"><template case="true"> <lyte-button lt-prop-class="outlineprimary" onclick="{{action(\'showAssignTerrPopup\')}}" data-zcqa="showAssignTerrPopup"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.territory.addterritory\')}} </template> </lyte-button> <div> <lyte-button onclick="{{action(\'onCancelTerritoryModalAction\',true)}}" data-zcqa="cancelTerritorySummzeView"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" data-zcqa="saveTerritorySummzeView" onclick="{{action(\'saveAssignedTerritories\')}}" lt-prop-disabled="{{disableSaveButton}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.save\')}} </template> </lyte-button> </div> </template></template> </lyte-modal-footer> </template> </lyte-modal> </template></template> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"text",position:[1,3]}]},{type:"registerYield",position:[1,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"attr",position:[3]},{type:"for",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}]},{type:"registerYield",position:[1,5],dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]},{type:"componentDynamic",position:[3]}]}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"if",position:[1,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1,1]},{type:"if",position:[1,1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"text",position:[1,1,1,1,3,0]},{type:"componentDynamic",position:[1,1,1,1]},{type:"text",position:[1,1,1,3,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"text",position:[1,1,1,5,1]},{type:"componentDynamic",position:[1,1,1,5]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},false:{dynamicNodes:[]}},default:{}},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[]}},default:{}},{type:"componentDynamic",position:[1,5]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1,1]},{type:"text",position:[3,1,3,0]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}],_observedAttributes:["seid","module","assignedTerrObj","disabledTerritories","assignedTerrforInput","canassign","potentialTerrLimit","orgTerrWithChild","userParticipationOnly","loadCruxTerritoryOnInit","orgTerrId","noOfSelected","disableSaveButton","isAdministrator","changedSelectedTerrArr","territoryIdVsName","alreadySelectedIds","isAllTerritoryChecked","isMainCheckBoxDisabled","managedTerritories","seTerrCount","tableHeader","manullyAddedCantRemove","isExpandNeeded","fromRl","isRecLocked","fromCanvasView","cxPropField","isLiteUser","showSummVieModal","fromCanvasEditor","summarizeViewClone","terrLimit","isDetailViewRevamp","parentOffloadEnabled"],data:function(){return{seid:Lyte.attr("string"),module:Lyte.attr("string"),assignedTerrObj:Lyte.attr("array",{default:[]}),disabledTerritories:Lyte.attr("array",{default:[]}),assignedTerrforInput:Lyte.attr("array",{default:[]}),canassign:Lyte.attr("boolean"),potentialTerrLimit:Lyte.attr("number",{default:1}),orgTerrWithChild:Lyte.attr("array",{default:[]}),userParticipationOnly:Lyte.attr("array",{default:[]}),loadCruxTerritoryOnInit:Lyte.attr("boolean",{default:!1}),orgTerrId:Lyte.attr("string"),noOfSelected:Lyte.attr("number",{default:0}),disableSaveButton:Lyte.attr("boolean",{default:!0}),isAdministrator:Lyte.attr("boolean",{default:Crm.userDetails.IS_ADMIN||Crm.userDetails.IS_ADMIN_ROLE}),changedSelectedTerrArr:Lyte.attr("array",{default:[]}),territoryIdVsName:Lyte.attr("object",{default:{}}),alreadySelectedIds:Lyte.attr("array",{default:[]}),isAllTerritoryChecked:Lyte.attr("boolean",{default:!0}),isMainCheckBoxDisabled:Lyte.attr("boolean",{default:!1}),managedTerritories:Lyte.attr("array",{default:[]}),seTerrCount:Lyte.attr("number",{default:0}),tableHeader:Lyte.attr("string",{default:I18n.getMsg("crm.territory.title.assign.territories")}),manullyAddedCantRemove:Lyte.attr("array",{default:[]}),isExpandNeeded:Lyte.attr("boolean",{default:!0}),fromRl:Lyte.attr("boolean",{default:!1}),isRecLocked:Lyte.attr("boolean",{default:!1}),fromCanvasView:Lyte.attr("boolean",{default:!1}),cxPropField:Lyte.attr("object",{hideAttr:!0,default:{}}),isLiteUser:Lyte.attr("boolean",{default:Crm.userDetails.LITE.IS_LITE_USER}),showSummVieModal:Lyte.attr("boolean",{default:!1}),fromCanvasEditor:Lyte.attr("boolean",{default:!1}),summarizeViewClone:Lyte.attr("array",{default:[]}),terrLimit:Lyte.attr("number",{default:1}),isDetailViewRevamp:Lyte.attr("boolean",{default:!1}),parentOffloadEnabled:Lyte.attr("boolean",{default:featuresAvailable.TERRITORY_PARENT_OFFLOAD_ENABLE})}},init:function(){var e,t=this,r={},a=t.getData("module");e="Potentials"===a?t.getData("potentialTerrLimit"):"custom"===moduleRecordMapping[a].generated_type?Crm.userDetails.TERRITORIES_PER_CUSTOM_MODULE_RECORDS:Crm.userDetails.TERRITORIES_PER_RECORD,this.setData("terrLimit",e),store.peekRecord(moduleRecordMapping[a].id,t.getData("seid"))||(r.record=store.findRecord(moduleRecordMapping[a].id,t.getData("seid"),{approved:"both"},!0,!0,{version:8})),r.territories=t.getTerritoryProm(),Lyte.resolvePromises(r).then((function(e){var r=store.peekAll("territory");if(t.setInitialData(t,r),t.getData("isDetailViewRevamp")){var i=$L("crm-detail-view")[0].component,o="Potentials"===a?"Territory":"Territories";t.getData("canassign")&&!t.getData("isRecLocked")&&!t.getData("fromCanvasView")&&(!t.getData("isLiteUser")||t.getData("isAdministrator")&&t.getData("isLiteUser"))?i.setData("content_json.meta_info.fieldvsEditType."+o,"showEdit"):i.setData("content_json.meta_info.fieldvsEditType."+o,"showEmpty")}}))},updateTerritories:function(e,t){var r=[];e&&e.length>0&&(1===t.getData("terrLimit")?e.forEach((e=>{r.push({id:e.id,name:e.Name,showRemove:"manually"===e.$assigned&&e.can_remove&&(t.getData("isAdministrator")||!t.getData("isAdministrator")&&t.getData("managedTerritories").contains(e.id)),$assigned:e.$assigned,$assigned_by:"manually"===e.$assigned?e.$assigned_by.name:void 0,$assigned_time:e.$assigned_time})})):e.forEach((e=>{e.Name&&r.push(e.Name)}))),t.setData("assignedTerrforInput",r)},actions:{assignTerritories:function(){this.openAssignTerritoriesPop()},showAssignTerrPopup:function(){var e=this;e.setData("summarizeViewClone",$L.extend(!0,[],this.getData("changedSelectedTerrArr"))),e.setData("loadCruxTerritoryOnInit",!0),e.showHideCruxTerritoryPopup(!0),this.setSelectedDataforCruxTerr($L.extend(!0,[],this.getData("changedSelectedTerrArr")))},openSelectedRecord:function(){var e=[],t=this.getData("assignedTerrObj");this.returnSelectedTerritories().forEach((r=>{void 0===t.find((t=>{if(t&&t.id===r.id)return t.show=!0,e.push(t),t}))&&e.push({id:r.id,show:!0})})),this.showHideCruxTerritoryPopup(!1),this.setData("changedSelectedTerrArr",e),this.setData("tableHeader",I18n.getMsg("crm.label.selected.territories")),this.showOrHideSummarizedView(!0),this.setIsAllTerritoryChecked()},handleRefresh:function(e){this.updateTerritories(e,this),Lyte.triggerEvent("ajaxEditTimeline")},removeSingleTerritory:function(){var e=this;store.peekRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid"))?e.removeSingleTerritoryAfterPromises(e):store.findRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid"),{},!0,!0,{version:8}).then((function(t){t[0]&&e.removeSingleTerritoryAfterPromises(e)}))},onCancelTerritoryModalAction:function(e){this.cancelTerritoryModalMethod(e)},saveAssignedTerritories:function(){Crm.client_tracking("Territories Assign or Unassign initiated");var e=this,t=e.returnSelectedTerritories(!0),r=e.getData("alreadySelectedIds"),a=[],i=[],o=[];if(e.showOrHideSummarizedView(!1),t.map((function(e){o.push(e.id)})),r.forEach((function(e){o.contains(e)||i.push({id:e})})),o.forEach((function(e){!r.contains(e)&&JSON.stringify(a).indexOf(e)<0&&a.push({id:e})})),!e.getData("isAdministrator")){var s=e.getData("module"),n=e.getData("terrLimit");if(e.getData("seTerrCount")-i.length+a.length>n)return void _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.non.admin.msg.limit.reached",[n,1===n?I18n.getMsg("Territory"):I18n.getMsg("Territories"),moduleRecordMapping[s].plural_label,e.getData("seTerrCount")]),ltPropType:"error",ltPropDuration:"3000"}})}store.peekRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid")).$.triggerAction("get_feature_specific_info",{module:moduleApiMapping[e.getData("module")],version:"8"},{features:"territory_scheduled_jobs"},!1,!1).then((function(t){if(t&&t.data[0].features_info[0].details)for(var r=t.data[0].features_info[0].details,o=r.length,s=0;s<o;s++){var n=r[s];if(-1!==n.source.indexOf("manual")&&"FAILED"!==n.status)return void _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.manual.in.progress"),ltPropType:"error",ltPropDuration:"2000"}})}e.setData("disableSaveButton",!0),e.showHideCruxTerritoryPopup(!1),i.length>0&&a.length>0?e.removalAPIMethod(i,e,a):i.length>0?e.removalAPIMethod(i,e):a.length>0&&e.addTerritoriesToRecord(a,e)}))},clearSelected:function(e,t,r,a,i){var o=this.getData("disabledTerritories"),s=[];return this.getData("changedSelectedTerrArr").forEach((e=>{e&&o.indexOf(e.id)<0&&s.push(e.id)})),e&&this.setEmptySearchValue(),this.unCheckSelectTerritory(s,e,i)},goToSelectedTerr:function(e){var t=$L("crux-territory")[0];t&&setTimeout((()=>{t.scrollToTerritory(e.id),this.setIsExpandNeeded()}),100)},expandAll:function(){var e=$L("crux-territory")[0];e&&(e.expandTerritories(),this.setData({isExpandNeeded:!1}),this.setSelectedTerrDivWidth())},collapseAll:function(){var e=$L("crux-territory")[0];e&&(e.collapseTerritories(),this.setData({isExpandNeeded:!0}),this.setSelectedTerrDivWidth())},backToSummarizeView:function(){this.setData("changedSelectedTerrArr",this.getData("summarizeViewClone")),this.showHideCruxTerritoryPopup(!1),this.setData("tableHeader",I18n.getMsg("crm.territory.title.assign.territories")),this.setIsAllTerritoryChecked(),this.setIsMainCheckBoxDisabled(this),this.showOrHideSummarizedView(!0)}},methods:{selectTerritory:function(e,t,r,a,i,o,s){return r&&(e=void 0===e?[]:e,this.getData("changedSelectedTerrArr").forEach((t=>{!0===t.show&&e.push(t.id)}))),this.checkSelectTerritory(e,[].concat(t),r,s)},unSelectTerritory:function(e,t,r,a,i,o,s){return this.unCheckSelectTerritory([].concat(t),r,s,e)},checkAllterritories:function(e,t,r,a){var i=[],o=[];return this.getData("changedSelectedTerrArr").forEach((e=>{!1===e.show?i.push(e.id):o.push(e.id)})),this.disableNoRowsFoundRow(),this.setEmptySearchValue(),this.checkSelectTerritory(o,i,!0,a)},clearSelected:function(e,t,r,a,i){var o=this.getData("disabledTerritories"),s=[];return this.getData("changedSelectedTerrArr").forEach((e=>{e&&o.indexOf(e.id)<0&&s.push(e.id)})),this.disableNoRowsFoundRow(),this.setEmptySearchValue(),this.unCheckSelectTerritory(s,e,i)},onSearchLyteTable:function(e){e.length>0?$L("#atr_noResult").addClass("dN"):$L("#atr_noResult").removeClass("dN"),document.querySelector(".atr_table").scrollTable(0,0)},onTerritoryTreeNodeOpen:function(){this.setIsExpandNeeded()},onTerritoryTreeNodeClose:function(){this.setData({isExpandNeeded:!0}),this.setSelectedTerrDivWidth()},showOrCloseSummarizeModal:function(){this.setEmptySearchValue()},onCancelTerritoryModal:function(){this.cancelTerritoryModalMethod()}},openAssignTerritoriesPop:function(){this.getData("isRecLocked")&&0===this.getData("assignedTerrforInput").length||this.onEditClick()},addTerritoryIdsForAssignPopup:function(e,t){var r=t.getData("userParticipationOnly"),a=t.getData("changedSelectedTerrArr"),i=[];r===[]&&(r=t.getCurrentUserParticipatedTerritories(e,t),t.setData("userParticipationOnly",r)),a.length>0&&(Lyte.arrayUtils(a,"splice",0,a.length),a=[]);var o=t.getData("module"),s=store.peekRecord(moduleRecordMapping[o].id,t.getData("seid")),n=[],l=[],d=[];if(i=$L.extend(!0,[],"Potentials"!==o&&s.Territories?s.Territories:"Potentials"===o&&s.Territory?s.Territory:[])){for(var p=[],c=i.length,m=0;m<c;m++){var y=i[m];y.show=!0,a.push(y),n.push(y.id),y.can_remove||p.push(y.id),"manually"===y.$assigned&&!1===y.can_remove&&d.push(y.id),"manually"===y.$assigned&&-1===l.indexOf(y.$assigned_by.id)&&l.push(y.$assigned_by.id)}l.length>0&&(commonUtils.showHideLoadingDiv(!0),store.findAll("user",{ids:l.join(",")},!0).then((function(e){e.forEach((e=>{var t=e.id;i.forEach((r=>{"manually"===r.$assigned&&r.$assigned_by.id===t&&(r.userImgLink=null!==e.image_link?e.image_link:commonUtils.getPhotoURL(e.zuid))}))})),t.setData({changedSelectedTerrArr:$L.extend(!0,[],i),assignedTerrObj:i}),commonUtils.showHideLoadingDiv(!1),t.showSummarizedViewOrCruxTerr(t)}))),r=r.concat(p),t.setData("noOfSelected",c),t.setData("isAllTerritoryChecked",!0)}t.setData({changedSelectedTerrArr:a,disabledTerritories:r,alreadySelectedIds:n,tableHeader:I18n.getMsg("crm.territory.title.assign.territories"),orgTerrWithChild:t.getData("isAdministrator")?[].concat(e.filter((e=>null===e.parent_id||!e.reporting_to))[0]):t.constructChildrenNodeToOrgTerritory(e),manullyAddedCantRemove:d}),t.setIsMainCheckBoxDisabled(t),0===l.length&&(t.setData("assignedTerrObj",i||[]),t.showSummarizedViewOrCruxTerr(t))},constructChildrenNodeToOrgTerritory:function(e){var t=e[0],r=Lyte.deepCopyObject(e[0]),a=Lyte.deepCopyObject(e),i=[t.id],o=t.children;delete r.children;for(var s=a.length,n=1;n<s;n++){var l=a[n],d=l.reporting_to?l.reporting_to.id:null,p=!1;if(d)if(i.contains(d))i.push(l.id),p=!0;else for(var c=n+1;c<s;c++){var m=a[c];if(m.id===d){i.push(m.id),i.push(l.id),p=!0;break}}!p&&d&&(l.reporting_to=r,store.peekRecord("territory",l.id).reporting_to=r,o?o.push(l):o=[].concat(l),i.push(l.id))}return t.children=o,[t]},removalAPIMethod:function(e,t,r){commonUtils.showHideLoadingDiv(!0),store.peekRecord(moduleRecordMapping[t.getData("module")].id,t.getData("seid")).$.triggerAction("remove_territories",{type:"POST"},!1,!1,{data:{Territories:e}}).then((function(){t.getData("isAdministrator")||t.setData("seTerrCount",t.getData("seTerrCount")-e.length),r?t.addTerritoriesToRecord(r,t):(t.getData("parentOffloadEnabled")&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.update.initiate.process"),ltPropType:"success",ltPropDuration:"1000"}}),commonUtils.showHideLoadingDiv(!1),t.setData("disableSaveButton",!0))}),(function(r){commonUtils.showHideLoadingDiv(!1);var a=JSON.parse(r.response);if("NOT_ALLOWED"===(r=a.data?a.data[0]:a.code?a:r).code&&r.message&&-1!==r.message.indexOf("remove was system assigned"))_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.removed.system.assigned"),ltPropType:"error",ltPropDuration:"3000"}});else if("LIMIT_EXCEEDED"===r.code)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.maximum.territory.per.record",[t.getData("terrLimit"),1===t.getData("terrLimit")?I18n.getMsg("Territory"):I18n.getMsg("Territories"),moduleRecordMapping[t.getData("module")].plural_label]),ltPropType:"error",ltPropDuration:"3000"}});else if("RECORD_LOCKED"===r.code)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.assign.territory.record.locked"),ltPropType:"error",ltPropDuration:"3000"}});else if(r.message&&r.message.indexOf("Given Territory was not associated with this record")>-1||r.message.indexOf("the id given seems to be invalid")>-1){var i=t.getData("territoryIdVsName"),o=r.details.json_path.indexOf("].id");o=r.details.json_path.slice(o-1,o),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg(r.message.indexOf("Given Territory was not associated with this record")>-1?"crm.assign.territory.already.removed":"crm.assign.territory.already.deleted",i[e[o].id]),ltPropType:"error",ltPropDuration:"3000"}})}else r.message&&r.message.indexOf("Lite Users Cannot add or Update the Territories in Records")>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.lite.users.update.not.allowed"),ltPropType:"error",ltPropDuration:"3000"}}):"ALREADY_SCHEDULED"===r.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.manual.in.progress"),ltPropType:"error",ltPropDuration:"3000"}}):r.message&&r.message.indexOf("The record Id given seems to be invalid")>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.invalid.deleted"),ltPropType:"error",ltPropDuration:"3000"}}):_cruxUtils.showCustomMessage({params:{ltPropMessage:r.message,ltPropType:"error",ltPropDuration:"3000"}})}))},addTerritoriesToRecord:function(e,t){commonUtils.showHideLoadingDiv(!0),store.peekRecord(moduleRecordMapping[t.getData("module")].id,t.getData("seid")).$.triggerAction("assign_territories",{type:"POST"},!1,!1,{data:{Territories:e}}).then((function(){t.getData("isAdministrator")||t.setData("seTerrCount",t.getData("seTerrCount")+e.length),t.getData("parentOffloadEnabled")&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.update.initiate.process"),ltPropType:"success",ltPropDuration:"1000"}}),commonUtils.showHideLoadingDiv(!1),t.setData("disableSaveButton",!0)}),(function(r){if(r){commonUtils.showHideLoadingDiv(!1);var a=JSON.parse(r.response);if("LIMIT_EXCEEDED"===(r=a.data?a.data[0]:a.code?a:r).code)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.maximum.territory.per.record",[t.getData("terrLimit"),1===t.getData("terrLimit")?I18n.getMsg("Territory"):I18n.getMsg("Territories"),moduleRecordMapping[t.getData("module")].plural_label]),ltPropType:"error",ltPropDuration:"3000"}});else if("RECORD_LOCKED"===r.code)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.assign.territory.record.locked"),ltPropType:"error",ltPropDuration:"3000"}});else if(r.message&&r.message.indexOf("the id given seems to be invalid")>-1){var i=t.getData("territoryIdVsName"),o=r.details.json_path.indexOf("].id");o=r.details.json_path.slice(o-1,o),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.assign.territory.already.deleted",i[e[o].id]),ltPropType:"error",ltPropDuration:"3000"}})}else r.message&&r.message.indexOf("Lite Users Cannot add or Update the Territories in Records")>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.lite.users.update.not.allowed"),ltPropType:"error",ltPropDuration:"3000"}}):r.message&&r.message.indexOf("The record Id given seems to be invalid")>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.invalid.deleted"),ltPropType:"error",ltPropDuration:"3000"}}):"ALREADY_SCHEDULED"===r.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.manual.in.progress"),ltPropType:"error",ltPropDuration:"3000"}}):_cruxUtils.showCustomMessage({params:{ltPropMessage:r.message,ltPropType:"error",ltPropDuration:"3000"}})}commonUtils.showHideLoadingDiv(!1)}))},addChildTerritoryIds:function(e,t){var r=t?t.children:void 0;if(r)for(var a=r.length,i=0;i<a;i++)e.push(r[i].id),this.addChildTerritoryIds(e,r[i])},getManagedTerritories:function(e,t){var r=e.length,a=Crm.userDetails.USER_ID,i=[];if(e&&r>0&&!t.getData("isAdministrator"))for(var o=0;o<r;o++)e[o].manager&&e[o].manager.id===a&&(i.push(e[o].id),t.addChildTerritoryIds(i,e[o]));return i},getCurrentUserParticipatedTerritories:function(e,t){for(var r=0===t.getData("managedTerritories").length?t.getManagedTerritories(e,t):t.getData("managedTerritories"),a=[],i=e.length,o=0;o<i;o++)r.contains(e[o].id)||a.push(e[o].id);return a},showHideCruxTerritoryPopup:function(e){var t=$L("crux-territory")[0];t&&(e?t.show():(t.close(),this.setData("loadCruxTerritoryOnInit",!1)))},returnSelectedTerritories:function(){var e=$L("crux-territory")[0],t=[];return e?t=e.getSelected():this.getData("changedSelectedTerrArr").forEach((e=>{!e||!0!==e.show&&!0!==e.checked||t.push({id:e.id})})),t},checkSelectTerritory:function(e,t,r,a){if("script"!==a&&t.length>0){var i=this.getData("module"),o=this.getData("terrLimit");if(o>1&&e.length+t.length>o)return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.maximum.territory.per.record",[o,I18n.getMsg("Territories"),moduleRecordMapping[i].plural_label]),ltPropType:"error",ltPropDuration:"3000"}}),!1;if(1===o){var s=e[0];if(s&&this.getData("disabledTerritories").indexOf(s)>-1)return this.showPotentialsErrorMsg(s),!1;var n=0;this.getData("changedSelectedTerrArr").find(((e,r)=>{e&&e.id===t[0]?(e.show=!0,++n):e.show=!1,Lyte.arrayUtils(this.getData("changedSelectedTerrArr"),"replaceAt",r,e)})),0===n&&Lyte.arrayUtils(this.getData("changedSelectedTerrArr"),"push",{id:t[0],show:!0})}else t.forEach((e=>{void 0===this.getData("changedSelectedTerrArr").find(((t,r)=>{if(t&&t.id===e)return t.show=!0,Lyte.arrayUtils(this.getData("changedSelectedTerrArr"),"replaceAt",r,t),t}))&&Lyte.arrayUtils(this.getData("changedSelectedTerrArr"),"push",{id:e,show:!0})}));this.doNecessaryActions(r),1===o&&this.getData("changedSelectedTerrArr").length>0&&this.setSelectedTerrDivWidth()}return!0},unCheckSelectTerritory:function(e,t,r,a){if("script"!==r&&e.length>0){if(1===this.getData("terrLimit")&&void 0!==a&&a.length>0){var i=a[0];if(i&&this.getData("disabledTerritories").indexOf(i)>-1)return this.showPotentialsErrorMsg(i),!1;e=a}e.forEach((e=>{this.getData("changedSelectedTerrArr").find(((t,r)=>{t&&t.id===e&&!0===t.show&&(t.show=!1,Lyte.arrayUtils(this.getData("changedSelectedTerrArr"),"replaceAt",r,t))}))})),this.doNecessaryActions(t)}return!0},setSelectedDataforCruxTerr:function(e){e.forEach(((t,r)=>{!1===t.show&&delete e[r]}));var t=$L("crux-territory")[0];t&&t.setData("cxPropValue",e)},showSummarizedViewOrCruxTerr:function(e){e.getData("assignedTerrObj").length>0&&e.getData("terrLimit")>1?e.showOrHideSummarizedView(!0):(e.setData("loadCruxTerritoryOnInit",!0),e.showHideCruxTerritoryPopup(!0))},showOrHideSummarizedView:function(e){this.setData("showSummVieModal",e);var t=$L("#at_selectedRecordsModal")[0];t&&t.ltProp("show",e)},setIsAllTerritoryChecked:function(){var e=!0,t=0;this.getData("changedSelectedTerrArr").find((r=>{r&&!1===r.show?e=!1:r&&r.show&&++t})),this.setData("noOfSelected",t),this.setData("isAllTerritoryChecked",e)},setIsMainCheckBoxDisabled:function(e){if(e.getData("isAllTerritoryChecked")){var t,r=e.getData("disabledTerritories");e.getData("changedSelectedTerrArr").forEach((e=>{t=r.indexOf(e.id)>-1&&(!1!==t||t)})),e.setData("isMainCheckBoxDisabled",!1!==t)}else e.setData("isMainCheckBoxDisabled",!1)},doNecessaryActions:function(e){this.setData("disableSaveButton",!1),this.setIsAllTerritoryChecked(),this.setIsMainCheckBoxDisabled(this),e&&this.setSelectedDataforCruxTerr($L.extend(!0,[],this.getData("changedSelectedTerrArr")))},setInitialData:function(e,t){var r=e.getData("module"),a=t.filter((e=>null===e.parent_id||!e.reporting_to))[0].id,i=store.peekRecord(moduleRecordMapping[r]&&moduleRecordMapping[r].id,e.getData("seid")),o=i.Locked__s&&i.$locked_for_me&&!i.$editable;e.setData("isRecLocked",o),e.setData("orgTerrId",a),e.getData("isAdministrator")?e.setData("canassign",!0):(e.setData("managedTerritories",e.getManagedTerritories(t,e)),e.setData("userParticipationOnly",e.getCurrentUserParticipatedTerritories(t,e)),e.setData("canassign",e.getData("managedTerritories").length>0));var s={};if(t.forEach((function(e){s[e.id]=e.name})),e.setData("territoryIdVsName",s),i&&("Potentials"!==r&&i.Territories||"Potentials"===r&&i.Territory)){var n="Potentials"!==r&&i.Territories?i.Territories:"Potentials"===r&&i.Territory?i.Territory:[];e.updateTerritories(n,e)}else e.setData("assignedTerrforInput",[])},setIsExpandNeeded:function(){this.setData({isExpandNeeded:!1});var e=$L("lyte-tree.cxTerritoryTree").find("lyte-tree")[0],t=e?e.closest("lyte-tree-body"):void 0;if(t)for(var r=$L(t).find("lyte-tree-icon"),a=r.length,i=0;i<a;i++){var o=r[i];o._cx&&"lyteTreeHasNoChild lyteTreeLastChild"!==o._cx.node.component.data.class&&o.outerHTML.includes("lyteIconClosed lyteTreeClose")&&this.setData({isExpandNeeded:!0})}this.setSelectedTerrDivWidth()},setSelectedTerrDivWidth:function(){var e=$L("#atr_selectTerrTxt")[0];if(1===this.getData("terrLimit")&&e){var t=$L("#atr_expandCollapseAll")[0].offsetWidth,r=$L("#atr_terrSelect"),a=r.closest(".cxTerritoryModalContent")[0].offsetWidth-60;r[0].style.maxWidth=a-(290+t+e.offsetWidth)+"px"}},setAssignterritoriesValues:function(e,t){if(e.getData("canassign")||e.getData("assignedTerrforInput").length>0){var r={};e.getData("isAdministrator")||e.getData("isApiHittenAlready")||(r.territory_count=t.$.triggerAction("associated_territories_count",{module:moduleApiMapping[e.getData("module")]},!1,!1)),Lyte.resolvePromises(r).then((function(t){if(t.territory_count){var r=t.territory_count.data[0].associated_territories_count;e.setData("seTerrCount",r),e.setData("isApiHittenAlready",!0)}var a=store.peekAll("territory");a.length>0&&e.addTerritoryIdsForAssignPopup(a,e)}))}},removeSingleTerritoryAfterPromises:function(e){var t=e.getData("module"),r=store.peekRecord(moduleRecordMapping[t].id,e.getData("seid")),a=1===e.getData("terrLimit")&&"Potentials"!==t?r.Territories[0]:r.Territory[0];if(a&&a.id){var i=[].concat([{id:a.id}]);e.removalAPIMethod(i,e)}if(!o)var o=window.event;o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation()},onEditClick:function(){var e=this,t=store.peekRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid"));void 0===t?store.findRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid"),{approved:"both"},!0,!0,{version:8}).then((function(r){r&&((t=store.peekRecord(moduleRecordMapping[e.getData("module")].id,e.getData("seid")))||_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.setup.editor.invalid.action"),ltPropSecondaryMessage:I18n.getMsg("crm.refresh.page"),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok")}]}}),t&&e.setAssignterritoriesValues(e,t))})):e.setAssignterritoriesValues(e,t)},cancelTerritoryModalMethod:function(e){this.setData("noOfSelected",0),this.setData("disableSaveButton",!0),this.showHideCruxTerritoryPopup(!1),e&&this.showOrHideSummarizedView(!1)},setEmptySearchValue:function(){var e=$L("#at_selectedRecordsModalSearch")[0];e&&e.setValue("")},disableNoRowsFoundRow:function(){var e=$L("#atr_noResult");e&&e.addClass("dN")},showPotentialsErrorMsg:function(e){this.getData("userParticipationOnly").indexOf(e)>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.detail.view.assign.territory.lock.info"),ltPropType:"error",ltPropDuration:"3000"}}):this.getData("manullyAddedCantRemove").indexOf(e)>-1?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.detail.view.remove.existing.assigned.territory"),ltPropType:"error",ltPropDuration:"3000"}}):_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.detail.view.remove.automatically.assgned"),ltPropType:"error",ltPropDuration:"3000"}})}},{mixins:["crm-territory-common-utils"]});
