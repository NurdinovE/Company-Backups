var crmLookupBusinessCard={moduleName:"",entityId:"",result:null,showingSide:"showOnRight",cleartimeout:"",getRecordJSon:function(e,t,s,r){if(crmLookupBusinessCard.moduleName===e&&crmLookupBusinessCard.entityId===t&&crmLookupBusinessCard.result)crmLookupBusinessCard.showBC(crmLookupBusinessCard.result,s);else{var o="/crm/v2.2/"+moduleRecordMapping[e].api_name+"/"+t;"Potentials"===e&&(o="/crm/v2.1/"+moduleRecordMapping[e].api_name+"/"+t);var n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/lookupTooltip"};clientPortalName&&(n["X-CRMPORTAL"]=clientPortalName);var a={apply_fields:"business_card",include:"fields",approved:"both"};null!==(r="Leads"===e?null!==r&&!0===r&&r:null)&&(a.converted=r),"Events"===e&&(a.fields="Remind_At"),(new crmRequestPool).initiate({action:o,data:a,type:"GET",headers:n,success:async function(r){if(r&&r.fields&&r.fields.length>1&&r.data&&1==r.data.length)r.data=r.data[0],crmLookupBusinessCard.result=r,crmLookupBusinessCard.moduleName=e,crmLookupBusinessCard.entityId=t,crmLookupBusinessCard.showBC(r,s);else{0===(await Lyte.registeredMixins["crm-view-utils"].getPublicFields(moduleRecordMapping[e].api_name)).length&&crmLookupBusinessCard.showBC(null,s)}}.bind(this),error:async function(){0===(await Lyte.registeredMixins["crm-view-utils"].getPublicFields(moduleRecordMapping[e].api_name)).length&&crmLookupBusinessCard.showBC(null,s)}.bind(this)})}},showBC:function(e,t){var s=networkUtils.returnDependencyFiles(["zcrm_toolTipBusinessCard.js"],ResourceConstants.CRM);Lyte.injectResources(s,void 0,(function(){var s,r=$(t).parents(".outlookInfoCont").length;null==e?s=I18n.getMsg("crm.security.error"):("Events"===crmLookupBusinessCard.moduleName&&$.each(e.fields,(function(e,t){"Venue"!==t.api_name&&"Owner"!==t.api_name&&("Remind_At"!==t.api_name||Crm.userDetails.CLIENT_ACCOUNT&&"Remind_At"===t.api_name)||(t.businesscard_supported=!0)})),s=crmLookupBusinessCard.isPhotoFieldPresence()||"Events"===crmLookupBusinessCard.moduleName&&(!Crm.userDetails.CLIENT_ACCOUNT||"Events"!==crmLookupBusinessCard.moduleName)?$(Handlebars.templates.ToolTipBusinessCard(e.fields.slice(1))):$(Handlebars.templates.ToolTipBusinessCard(e.fields))),r&&(crmLookupBusinessCard.showingSide="showOnBottom"),crmui.showTooltip({content:s,isHTML:!0,position:crmLookupBusinessCard.showingSide,target:t,classList:"customLookupDetails"});var o=$(".customLookupDetails");if(r&&o.addClass("outLookInside"),"showOnLeft"===crmLookupBusinessCard.showingSide){var n=o.offset().left,a=n-30;a<=50&&(a=(n=t.offset().left-o.width())-60,o.hasClass("showOnRight")&&o.removeClass("showOnRight").addClass("showOnLeft")),o.css("left",a)}o.hasClass("top")&&o.css("margin-top","5px")}))},isPhotoFieldPresence:function(){return!(!crmLookupBusinessCard.result||!crmLookupBusinessCard.result.fields[0]||"Record_Image"!==crmLookupBusinessCard.result.fields[0].api_name)},getFieldValue:function(e,t){var s=crmLookupBusinessCard.result.data[e.api_name],r="Salutation";if(!s)return"";var o=e.data_type;if("formula"===o?o=e.formula.return_type:"rollup_summary"===o&&(o=e.rollup_summary.return_type),"multiselectpicklist"===o&&"Tax"===e.api_name){var n=[];return s.forEach((function(e){n.push(e.value)})),$ESAPI.encoder().encodeForHTML(n.join(";"))}if(o.indexOf("lookup")>-1)return $ESAPI.encoder().encodeForHTML(s.name);if("boolean"===o)return s?'<span class="yes"></span>':"";if("datetime"===o){if(e.api_name){var a=s.replace(/[+-]\d{2}:\d{2}/,"");i=new Date(a)}else i=new Date(s);return Utils.getDateTimeInUserFormat(i,!0)}if("date"===o){var i=new Date(s+" 00:00:00");return isNaN(i.getTime())&&(i=new Date(s)),Utils.getDateInUserDatePattern(i,!0)}if("multiselectpicklist"===o)return $ESAPI.encoder().encodeForHTML(s.join(";"));if(t){if(crmLookupBusinessCard.moduleName===crmModuleConstants.Contacts||crmLookupBusinessCard.moduleName===crmModuleConstants.Leads){r=s[r];var u=s.First_Name,d="";if(Crm&&Crm.userDetails){var l=Crm.userDetails.NAME_FORMAT.split(","),m=s[l[0].replace(" ","_")],c=s[l[1].replace(" ","_")],p=s[l[2].replace(" ","_")];m&&(d=m+" "),c&&(d=d+c+" "),p&&(d+=p)}else r&&(d=r+" "),u&&(d=d+u+" "),d+=s.Last_Name;s=d}return moduleRecordMapping.Unknown&&moduleRecordMapping.Unknown.module_name===crmLookupBusinessCard.moduleName?s:s='<a  data-cid=\'detailView\' data-params=\'{"lookback":"true","module":"'+crmLookupBusinessCard.moduleName+'","id":"'+crmLookupBusinessCard.entityId+'"}\' href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module="+encodeURIComponent(crmLookupBusinessCard.moduleName)+"&id="+encodeURIComponent(crmLookupBusinessCard.entityId)+"\" onClick=\"crmNTCGlobal.closeGlobalNotifications(); Crm.trackSpotLightAction('Lookup Hover Click',{'Module':'"+crmLookupBusinessCard.moduleName+"'})\">"+$ESAPI.encoder().encodeForHTML(s)+"</a>"}return"Layout"==e.api_name?$ESAPI.encoder().encodeForHTML(s.name):e.ui_type==CrmField.UITYPES.SERVICE_DURATION?Handlebars.helpers.setServiceDuration(s):"Wizard"==e.api_name?$ESAPI.encoder().encodeForHTML(s.name):!e.separator||(e.ui_type!==CrmField.UITYPES.DATA_PARAM||"longinteger"!==e.rollup_summary.return_type&&"integer"!==e.rollup_summary.return_type&&"decimal"!==e.rollup_summary.return_type)&&e.ui_type!==CrmField.UITYPES.NUMERIC_FIELD&&e.ui_type!==CrmField.UITYPES.DECIMAL&&e.ui_type!==CrmField.UITYPES.LONG_INTEGER&&e.ui_type!==CrmField.UITYPES.AGGREGATE_FIELD&&e.ui_type!==CrmField.UITYPES.FORMULA?$ESAPI.encoder().encodeForHTML(s.toString()):$ESAPI.encoder().encodeForHTML(Search.formatNumber(s.toString()))},getEventStart_EndTime:function(e,t){var s=crmLookupBusinessCard.result.data[e.api_name],r=crmLookupBusinessCard.result.data[t.api_name],o=new Date(s),n=new Date(r);return crmLookupBusinessCard.result.data.All_day?o.getUTCDate()==n.getUTCDate()&&o.getUTCMonth()==n.getUTCMonth()&&o.getUTCFullYear()==n.getUTCFullYear()?(o=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),Utils.getDateInUserDatePattern(o,!0)):(n=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),Utils.getDateInUserDatePattern(o,!0)+" - "+Utils.getDateInUserDatePattern(n,!0)):Utils.getDateTimeInUserFormat(o,!0)+" - "+Utils.getDateTimeInUserFormat(n,!0)},getAlldayEvent:function(){if(crmLookupBusinessCard.result.data.All_day){var e=crmLookupBusinessCard.result.fields.filter((function(e){return"All_day"===e.api_name}));return'<tr><td><span class="dIB">'+$ESAPI.encoder().encodeForHTML(e[0].field_label)+'</span></td><td><span class="dIB"><span class="yes"></span></span></td></tr>'}return""},showLookupDetails:function(e){var t=(e=$(e))[0].parentElement,s=void 0!==t?t.parentElement:null,r=void 0!==$(s)?$(s).attr("class"):"",o=null,n=document.querySelectorAll("crm-client-portal-user-type-users").length;void 0===r||"timeline_Converted Leads"!==r.trim()&&"timeline_added Contacts"!==r.trim()&&"timeline_added Accounts"!==r.trim()&&"timeline_added Potentials"!==r.trim()||(o=!0);var a=e.data("params");crmLookupBusinessCard.showingSide="showOnRight",renderingUtils.windowWidth-e.offset().left<425&&(crmLookupBusinessCard.showingSide="showOnLeft"),a&&a.module&&a.id&&(clearTimeout(crmLookupBusinessCard.cleartimeout),crmui.hideTooltip(),n&&$("#wf_tooltip").hide(),crmLookupBusinessCard.cleartimeout=setTimeout((function(){e.is(":hover")&&crmLookupBusinessCard.getRecordJSon(a.module,a.id,e,o)}),250))},getPhotoField:function(e){if(crmLookupBusinessCard.isPhotoFieldPresence()){e=e.api_name;var t=crmLookupBusinessCard.result.fields[0].api_name,s=crmLookupBusinessCard.result.data,r=s[t];if(void 0!==r){var o="";if(r){o='<div id="imgContainer" class="emptyLCPhoto mR10 dIB vaM" style="background-position: 0px 0px;"><img src="'+(Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+encodeURIComponent(crmLookupBusinessCard.moduleName)+"&entityId="+encodeURIComponent(crmLookupBusinessCard.entityId)+"&actionName=readImage&fileId="+r)+'"></div>'}else{var n=["0px 0px","-53px 0px","-103px 0px","-154px 0px","-205px 0px","0px -55px","-53px -55px","-103px -55px","-154px -55px","-205px -55px"];o="background-position: "+n[Math.floor(Math.random()*n.length)];var a=s[e];crmLookupBusinessCard.moduleName!==crmModuleConstants.Contacts&&crmLookupBusinessCard.moduleName!==crmModuleConstants.Leads||(a=a.First_Name?a.First_Name:a.Last_Name),a&&null!=a&&(a=a.charAt(0)),o='<div id="imgContainer" class="emptyImgBusinesCard emptyLCPhoto mR10 dIB vaM">'+$ESAPI.encoder().encodeForHTML(a)+"</div>"}return o}}return""},isUnknownModule:function(e){return moduleRecordMapping.Unknown&&crmLookupBusinessCard.moduleName===moduleRecordMapping.Unknown.module_name?e.fn(this):e.inverse(this)}};Handlebars.registerHelper("getPhotoField",(function(e){return crmLookupBusinessCard.getPhotoField(e)})),Handlebars.registerHelper("getFieldValue",(function(e,t){let s=crmLookupBusinessCard.getFieldValue(e,t);return validationUtils.isNotEmpty(s)?s:"-"})),Handlebars.registerHelper("getEventStart_EndTime",(function(e,t){return crmLookupBusinessCard.getEventStart_EndTime(e,t)})),Handlebars.registerHelper("getAlldayEvent",(function(e,t){return crmLookupBusinessCard.getAlldayEvent(e,t)})),Handlebars.registerHelper("isUnknownModule",(function(e){return crmLookupBusinessCard.isUnknownModule(e)}));