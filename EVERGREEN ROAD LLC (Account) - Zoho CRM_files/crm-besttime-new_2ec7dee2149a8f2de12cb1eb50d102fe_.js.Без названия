Lyte.Component.register("crm-besttime-new",{_template:'<template tag-name="crm-besttime-new"> <template is="if" value="{{besttimeshow}}"><template case="true"> <div class="dIBestTimeContainer{{viewType}} dIBestTimetoCallContainer boxBB w100_per {{if(ifNotEquals(viewType,\'DetailsPage\'),\'schedule\',\'\')}}"> <div id="dIBestTime" class="boxBB dIBestTime dIBestTime{{viewType}} flexAlignCenter spaceBetween w100_per"> <div class="crm-font-bold crmHeadingColor crm-subheading-font-size mB5">{{getI18n("crm.best.time.to.label")}} <lyte-popover lt-prop-wrapper-class="besttimedropinlyte" lt-prop-scrollable="true" lt-prop-auto-align="true" lt-prop-origin-elem="{{lbind(orginElementRef)}}" lt-prop-max-width="400px" id="{{lbind(dayDropId)}}" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false" on-close="{{method(\'closeBestTimeDropDownPopover\')}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <template is="if" value="{{calendarshow}}"><template case="true"> <div class="dB"> <lyte-calendar lt-prop-header-type="dropdown" lt-prop-yield="true" lt-prop-format="YYYY/MM/DD" on-date-selected="{{method(\'changeDate\')}}" id="BestTimelyteCalendar" lt-prop-min-date="{{minimumDate}}"></lyte-calendar> </div> </template></template> <template is="if" value="{{dropdownshow}}"><template case="true"> <div class="dIBestTimeDropdown"> <ul class="m0 p0"> <template is="for" items="{{dropDownDisplayDates}}" item="item" index="index"> <li class="m0 {{if(checkComparison(label,inputDate,\'=\'),expHandlers(expHandlers(crm,\'-\',font),\'-\',bold),\'\')}}" data-zcqa="bt_dd_{{viewType}}_{{index}}" onclick="{{action(\'changeDateForViewType\',item.date,viewType)}}">{{dropDownDisplayDates[index].label}}</li> </template> </ul> <div class="dIBestTimeToOpenCalendar dIB pT10 cP w100_per crm-font-regular pB10" onclick="{{action(\'showCalendar\',this)}}"> <span class="pR" id="bestTimeCal">{{getI18n("crm.best.time.open.calendar")}}</span> </div> </div> </template></template> </lyte-popover-content> </template> </lyte-popover> </div> <div class="flexAlignCenter mB5"> <template is="if" value="{{expHandlers(showDetailedToday,\'!\')}}"><template case="true"> <span class="zcicncss-reload zcicn-cssIcons zcicncss15 zcicn_grey_mask cP" onclick="{{action(\'reloadBesettime\')}}"></span> </template></template> <template is="if" value="{{isDetailsPage}}"><template case="true"> <span id="{{lbind(dropDownId)}}" class="crm-font-regular crmLinkColor cP vaM mL5" data-zcqa="bt_{{viewType}}_date" onclick="{{action(\'showDayDropDownPopUp\',this,viewType)}}"> {{inputDate}} </span> </template><template case="false"> <span class="crm-font-regular crmLinkColor cP" data-zcqa="bt_{{viewType}}_date"> {{inputDate}} </span> </template></template> </div> </div> <template is="if" value="{{expHandlers(mailonly,\'!\')}}"><template case="true"> <div class=" mB22 mT20"> <div class=" w100_per"> <div class=" w100_per crmLabelColor crm-font-regular mB10 flexAlignCenter" data-value="Call"> <div class="dIB crmLabelColor crm-font-regular " data-value="Call">{{getI18n("Call")}}</div> <template is="if" value="{{isCallPreferred}}"><template case="true"> <div id="callPreferred" class="bestModePreferenceTag boxBB br6 crmGreenColor dIB mL5 pB2 pL10 pR10 pT2 vaM ">{{getI18n("crm.best.mode.preferred")}}</div> </template></template> </div> <template is="if" value="{{showDetailedToday}}"><template case="true"> <template is="if" value="{{allTimesLapsedCall}}"><template case="true"> <div class="dIBestTimeLabel dIB mL2"> <span class="dIB crmParagraphColor" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template><template case="false"> <div class="dIB besttimelinksizebig crm-font-light vaM crmLinkColor mB8 pL25"> <span id="{{lbind(remindMePopUpCallId)}}" class="crmLinkColor dIB vaM cP ico-starForEle lev{{bestTimeToShowCallLevel}} pR" data-zcqa="zia_setReminder" onclick="{{action(\'showRemindMePopupCall\',this,true)}}">{{bestTimeToShowCall}}</span> <span class="crmLabelColor besttimeminsagodiv crm-base-font-size crm-font-regular lh20" mints="{{diffTimeCall}}">{{bestTimeToShowEtaaCall}}</span> </div> </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(reminderTimeCall.length,\'>\',0)}}"><template case="true"> <div class="dIB w100_per"> <template is="for" items="{{reminderTimeCall}}" item="item" index="index"> <span id="{{bestTimeValueCall}}{{index}}" class="timeDi {{if(callActivityPermission,\'cP\',\'cDefault\')}} crm-font-medium besttimevaluecolor mR3 starredIcon pR lev{{item.level}}" onclick="{{action(\'showDetailsPagePopOver\',index,item.bestTime,item.dateTime,\'Call\')}}"><i></i>{{item.bestTime}}</span> </template> </div> </template><template case="false"> <div class=" w100_per dIB"> <span id="tryTomorrow" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template></template> </template></template> </div> </div> </template></template> <template is="if" value="{{expHandlers(callonly,\'!\')}}"><template case="true"> <div class="vaT"> <div class=" vaT w100_per"> <div class=" w100_per crmLabelColor crm-font-regular flexAlignCenter mB10" data-value="Text"> <div class="dIB crmLabelColor crm-font-regular" data-value="Text">{{getI18n("Email")}}</div> <template is="if" value="{{isEmailPreferred}}"><template case="true"> <div id="isEmailPreferred" class="bestModePreferenceTag boxBB br6 crmGreenColor dIB mL5 pB2 pL10 pR10 pT2 vaM5 ">{{getI18n("crm.best.mode.preferred")}}</div> </template></template> </div> <template is="if" value="{{showDetailedToday}}"><template case="true"> <template is="if" value="{{allTimesLapsedText}}"><template case="true"> <div class=" dIB"> <span id="tryTomorrow" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template><template case="false"> <div class="dIB besttimelinksizebig crm-font-light vaM crmLinkColor pL25"> <span id="{{lbind(remindMePopUpTextId)}}" class="crmLinkColor dIB vaM cP ico-starForEle lev{{bestTimeToShowTextLevel}} pR" data-zcqa="zia_setReminder" onclick="{{action(\'showRemindMePopupText\',this,true)}}">{{bestTimeToShowText}}</span> <span class="crmLabelColor besttimeminsagodiv crm-base-font-size lh20 crm-font-regular" id="dIBestTimeMins" mints="{{diffTimeText}}">{{bestTimeToShowEtaaText}}</span> </div> </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(reminderTimeText.length,\'>\',0)}}"><template case="true"> <div class="dIB w100_per"> <template is="for" items="{{reminderTimeText}}" item="item" index="index"> <span id="{{bestTimeValueText}}{{index}}" class="timeDi crm-font-medium mR3 {{if(mailActivityPermission,\'cP\',\'cDefault\')}} starredIcon besttimevaluecolor pR lev{{item.level}}" onclick="{{action(\'showDetailsPagePopOver\',index,item.bestTime,item.dateTime,\'Text\')}}"><i></i>{{item.bestTime}}</span> </template> </div> </template><template case="false"> <div class="dIB"> <span id="tryTomorrow" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template></template> </template></template> </div> </div> </template></template> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte zianewDetailView" lt-prop-scrollable="true" lt-prop-origin-elem="{{lbind(remindMePopUpCall)}}" id="{{lbind(bestTimeReminderCall)}}" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="remindMeTime"> <div class="w100_per dIB mT10 mB10"> <template is="for" items="{{reminderTimeCall}}" item="item" index="index"> <template is="if" value="{{getUserDetail(\'isZiaReminderEnabled\')}}"><template case="true"> <div id="reminderTime" class="crm-font-regular fL cBoth w100_per mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}"> <div class="mR10 vaM svgIcons dIB besttimestaricon"></div> <div class="dIB vaM bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB svgIcons besttimeclockicon vaM" data-zcqa="remindTime_{{index}}" onclick="{{action(\'onReminderIntiated\',index,item.bestTime,\'Call\')}}" lt-prop-title="{{getI18n(\'crm.best.time.set.reminder\')}}"></div> </div> </template><template case="false"> <div id="reminderTime" class="disableReminder crm-font-regular fL cBoth w100_per mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}" data-zcqa="remindTime_{{index}}"> <div class="mR10 vaM svgIcons dIB besttimestaricon"></div> <div class="dIB bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB hide"></div> </div> </template></template> </template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte zianewDetailView" lt-prop-scrollable="true" lt-prop-origin-elem="{{lbind(remindMePopUpText)}}" id="{{lbind(bestTimeReminderText)}}" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="remindMeTime"> <div class="w100_per dIB mT10 mB10"> <template is="for" items="{{reminderTimeText}}" item="item" index="index"> <template is="if" value="{{getUserDetail(\'isZiaReminderEnabled\')}}"><template case="true"> <div id="reminderTime" class="crm-font-regular fL cBoth w100_per mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}"> <div class="mR10 svgIcons vaM dIB besttimestaricon"></div> <div class="dIB bstTimeForGray vaM">{{item.bestTime}}</div> <div class="mL10 dIB svgIcons besttimeclockicon vaM" data-zcqa="remindTime_{{index}}" onclick="{{action(\'onReminderIntiated\',index,item.bestTime,\'Text\')}}" lt-prop-title="{{getI18n(\'crm.best.time.set.reminder\')}}"></div> </div> </template><template case="false"> <div id="reminderTime" class="disableReminder crm-font-regular fL cBoth w100_per mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}" data-zcqa="remindTime_{{index}}"> <div class="mR10 svgIcons vaM dIB besttimestaricon"></div> <div class="dIB bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB besttimeclockicon hide"></div> </div> </template></template> </template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte" lt-prop-content-padding="0px" lt-prop-scrollable="true" id="{{lbind(bestTimeActivitiesOptionCall)}}" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false" lt-prop-origin-elem="#{{bestTimeValueCall}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="activitesOptionPop"> <ul class="pB10 pT10 pL0 pR0 m0"> <template is="if" value="{{taskPermission}}"><template case="true"> <li id="Zia_CreateTaskCall" data-zcqa="Zia_CreateTask" onclick="{{action(\'triggerCreateTask\',event,this,\'Call\')}}"> {{getI18n("crm.button.create.task")}}</li> </template></template> <template is="if" value="{{callPermission}}"><template case="true"> <li id="Zia_CreateCall" data-zcqa="Zia_CreateCall" onclick="{{action(\'triggerCreateCall\',event,this)}}">{{getI18n("crm.button.create")}} {{getI18n("Call")}}</li> </template></template> </ul> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-content-padding="0px" lt-prop-wrapper-class="besttimedropinlyte" lt-prop-scrollable="true" id="{{lbind(bestTimeActivitiesOptionText)}}" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false" lt-prop-origin-elem="#{{bestTimeValueText}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="activitesOptionPop"> <ul class="pB10 pT10 pL0 pR0 m0"> <template is="if" value="{{taskPermission}}"><template case="true"> <li id="Zia_CreateTaskMail" data-zcqa="Zia_CreateTask" onclick="{{action(\'triggerCreateTask\',event,this,\'Email\')}}"> {{getI18n("crm.button.create.task")}}</li> </template></template> <template is="if" value="{{mailPermission}}"><template case="true"> <li id="Zia_ScheduleMail" data-zcqa="Zia_ScheduleMail" href="javascript:;" onclick="{{action(\'schedulemail\')}}">{{getI18n("crm.reportschedule")}} {{getI18n("crm.label.premium.email")}}</li> </template></template> </ul> </div> </lyte-popover-content> </template> </lyte-popover> </div> </template><template case="false"> <template is="if" value="{{expHandlers(isKioskComponent,\'||\',isTitleNeeded)}}"><template case="true"> <div id="title" class="crm-font-bold crmHeadingColor crm-subheading-font-size mB5">{{getI18n("crm.best.time.column.label")}}</div> </template></template> <template is="if" value="{{expHandlers(isKioskComponent,\'||\',isEmptyScreenNeeded)}}"><template case="true"> <div class="dIB crm-font-regular w100_per lh18 vaM crm-small-font-size aligncenter"> <div class="crmNotFoundColor dIB mT90 vaM">{{getI18n(\'crm.data.not.available\')}}</div> </div> </template></template> </template></template> <lyte-event-listener event-name="bestTimeActivityListener" on-fire="{{action(\'handleEventCreation\')}}"> <lyte-event-listener event-name="bestModeFlexListener" on-fire="{{action(\'updateBestModePreference\')}}"> </lyte-event-listener></lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,1,2]},{type:"registerYield",position:[1,1,1,2,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,0]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,2]},{type:"attr",position:[1,1,3,1]},{type:"if",position:[1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3,3]},{type:"if",position:[1,1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,7]},{type:"registerYield",position:[1,7,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,7]},{type:"attr",position:[1,9]},{type:"registerYield",position:[1,9,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,9]},{type:"attr",position:[1,11]},{type:"registerYield",position:[1,11,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"text",position:[1,2]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,11]},{type:"attr",position:[1,13]},{type:"registerYield",position:[1,13,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"text",position:[1,2]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,13]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]}],_observedAttributes:["viewType","dropDownDisplayDates","inputDate","diffTimeCall","diffTimeText","reminderTimeCall","reminderTimeText","showReminder","bestTimeToShowCall","bestTimeToShowCallLevel","bestTimeToShowText","bestTimeToShowTextLevel","bestTimeToShowEtaaCall","bestTimeToShowEtaaText","allTimesLapsedCall","allTimesLapsedText","showDetailedToday","seid","module","type","gmtTime","reminderTimeSetCall","reminderTimeSetText","besttimecomp","dueDate","minimumDate","besttimeshow","isDetailsPage","interval","intervalID","calendarshow","dropdownshow","dateinMS","dateForMail","calltextdrop","callTextDropDown","callonly","mailonly","storedata","name","isCallPreferred","isEmailPreferred","days","months","callPermission","taskPermission","mailPermission","callActivityPermission","mailActivityPermission","stateId","orginElementRef","dropDownId","dayDropId","bestTimeReminderCall","bestTimeReminderText","bestTimeActivitiesOptionCall","bestTimeActivitiesOptionText","remindMePopUpCall","remindMePopUpText","remindMePopUpCallId","remindMePopUpTextId","bestTimeValueCall","bestTimeValueText","isTitleNeeded","isKioskComponent","parentComponent","isEmptyScreenNeeded","isCanvasView"],data:function(){return{viewType:Lyte.attr("string"),dropDownDisplayDates:Lyte.attr("array"),inputDate:Lyte.attr("string"),diffTimeCall:Lyte.attr("number"),diffTimeText:Lyte.attr("number"),reminderTimeCall:Lyte.attr("array"),reminderTimeText:Lyte.attr("array"),showReminder:Lyte.attr("boolean"),bestTimeToShowCall:Lyte.attr("string"),bestTimeToShowCallLevel:Lyte.attr("string"),bestTimeToShowText:Lyte.attr("string"),bestTimeToShowTextLevel:Lyte.attr("string"),bestTimeToShowEtaaCall:Lyte.attr("string"),bestTimeToShowEtaaText:Lyte.attr("string"),allTimesLapsedCall:Lyte.attr("boolean",{default:!1}),allTimesLapsedText:Lyte.attr("boolean",{default:!1}),showDetailedToday:Lyte.attr("boolean",{default:!1}),seid:Lyte.attr("string"),module:Lyte.attr("string"),type:Lyte.attr("string"),gmtTime:Lyte.attr("object"),reminderTimeSetCall:Lyte.attr("string"),reminderTimeSetText:Lyte.attr("string"),besttimecomp:Lyte.attr("object"),dueDate:Lyte.attr("object"),minimumDate:Lyte.attr("string"),besttimeshow:Lyte.attr("boolean",{default:!1}),isDetailsPage:Lyte.attr("boolean",{default:!1}),interval:Lyte.attr("number"),intervalID:Lyte.attr("number"),calendarshow:Lyte.attr("boolean",{default:!1}),dropdownshow:Lyte.attr("boolean",{default:!0}),dateinMS:Lyte.attr("number"),dateForMail:Lyte.attr("number"),calltextdrop:Lyte.attr("array",{default:["Call","Text"]}),callTextDropDown:Lyte.attr("boolean",{default:!1}),callonly:Lyte.attr("boolean",{default:!1}),mailonly:Lyte.attr("boolean",{default:!1}),storedata:Lyte.attr("object"),name:Lyte.attr("string",{default:""}),isCallPreferred:Lyte.attr("boolean",{default:!1}),isEmailPreferred:Lyte.attr("boolean",{default:!1}),days:Lyte.attr("array",{default:["crm.best.time.day.short.sunday","crm.best.time.day.short.monday","crm.best.time.day.short.tuesday","crm.best.time.day.short.wednesday","crm.best.time.day.short.thursday","crm.best.time.day.short.friday","crm.best.time.day.short.saturday"]}),months:Lyte.attr("array",{default:["crm.best.time.month.short.january","crm.best.time.month.short.february","crm.best.time.month.short.march","crm.best.time.month.short.april","crm.best.time.month.short.may","crm.best.time.month.short.june","crm.best.time.month.short.july","crm.best.time.month.short.august","crm.best.time.month.short.september","crm.best.time.month.short.october","crm.best.time.month.short.november","crm.best.time.month.short.december"]}),callPermission:Lyte.attr("boolean",{default:!0}),taskPermission:Lyte.attr("boolean",{default:!0}),mailPermission:Lyte.attr("boolean",{default:!0}),callActivityPermission:Lyte.attr("boolean",{default:!0}),mailActivityPermission:Lyte.attr("boolean",{default:!0}),stateId:Lyte.attr("string",{default:""}),orginElementRef:Lyte.attr("string",{default:"#bestTimeDayDropDown"}),dropDownId:Lyte.attr("string",{default:"bestTimeDayDropDown"}),dayDropId:Lyte.attr("string",{default:"BestTimeDayDrop"}),bestTimeReminderCall:Lyte.attr("string",{default:"BestTimeRemindeMeCall"}),bestTimeReminderText:Lyte.attr("string",{default:"BestTimeRemindeMeText"}),bestTimeActivitiesOptionCall:Lyte.attr("string",{default:"BestTimeActivitiesOptionCall"}),bestTimeActivitiesOptionText:Lyte.attr("string",{default:"BestTimeActivitiesOptionText"}),remindMePopUpCall:Lyte.attr("string",{default:"#remindmepopcall"}),remindMePopUpText:Lyte.attr("string",{default:"#remindmepoptext"}),remindMePopUpCallId:Lyte.attr("string",{default:"remindmepopcall"}),remindMePopUpTextId:Lyte.attr("string",{default:"remindmepoptext"}),bestTimeValueCall:Lyte.attr("string",{default:"BestTimeValueCall"}),bestTimeValueText:Lyte.attr("string",{default:"BestTimeValueText"}),isTitleNeeded:Lyte.attr("boolean",{default:!1}),isKioskComponent:Lyte.attr("boolean",{default:!1}),parentComponent:Lyte.attr("object",{default:{}}),isEmptyScreenNeeded:Lyte.attr("boolean",{default:!1}),isCanvasView:Lyte.attr("boolean",{default:!1})}},didDestroy:function(){clearTimeout(this.getData("interval")),clearInterval(this.getData("intervalID"))},init:function(){var e=!Crm.userDetails.isBTPermissionMigrationRun||Crm.userDetails.permissions.Crm_Implied_View_Result_BestTime;if(void 0===e&&(e=!1),Crm.userDetails.isSandbox||Crm.userDetails.CLIENT_ACCOUNT||Crm.userDetails.LITE.IS_LITE_USER)$("#bestTimeToContactDiv").hide();else if(e)if(Crm.userDetails.isBestTimeEnabledCall||Crm.userDetails.isBestTimeEnabledMail){var t=this,i=t.getData("stateId");""!==i&&(t.setData("orginElementRef","#bestTimeDayDropDown"+i),t.setData("dropDownId","bestTimeDayDropDown"+i),t.setData("dayDropId","BestTimeDayDrop"+i),t.setData("bestTimeReminderCall","BestTimeRemindeMeCall"+i),t.setData("bestTimeReminderText","BestTimeRemindeMeText"+i),t.setData("bestTimeActivitiesOptionCall","BestTimeActivitiesOptionCall"+i),t.setData("bestTimeActivitiesOptionText","BestTimeActivitiesOptionText"+i),t.setData("remindMePopUpCall","#remindmepopcall"+i),t.setData("remindMePopUpText","#remindmepoptext"+i),t.setData("remindMePopUpCallId","remindmepopcall"+i),t.setData("remindMePopUpTextId","remindmepoptext"+i),t.setData("bestTimeValueCall","BestTimeValueCall"+i+"_"),t.setData("bestTimeValueText","BestTimeValueText"+i+"_")),Crm.userDetails.isBestTimeEnabledCall&&Crm.userDetails.isBestTimeEnabledMail?t.setData({callTextDropDown:!0,type:"CALLTEXT"}):Crm.userDetails.isBestTimeEnabledCall&&Crm.userDetails.permissions.Crm_Implied_Create_Calls?t.setData({callonly:!0,type:"Call"}):Crm.userDetails.isBestTimeEnabledMail&&t.setData({mailonly:!0,type:"Text"}),"Potentials"===t.getData("module")&&t.setData("module","Contacts"),t.getData("viewType")&&"DetailsPage"!==t.getData("viewType")||(t.setData("dueDate",$L.moment().toDate()),t.setDropDownDateDetails(),t.setMinimumDate()),t.getData("type")||t.setData("type","Call");var a=t.getData("seid"),s=t.getData("module"),o=t.getData("type"),l=t.getData("dueDate").getTime();if(a&&s&&o&&l){store.findAll("besttime_zia_new",{id:a,module:s,type:o,reqDate:l}).then((function(){var e=store.peekRecord("besttime_zia_new",t.getData("seid"));t.setData("storedata",e),t.setDataToThisComponent(e),"DetailsPage"===t.getData("viewType")&&(crmBstTime.setPosition(),t.startInterval())}),(function(e){e&&e.status}));var r=!1;"Leads"===s?r=!!Crm.userDetails.permissions.Crm_Implied_Send_Mail_Leads:"Contacts"===s&&(r=!!Crm.userDetails.permissions.Crm_Implied_Send_Mail_Contacts),t.setData({callPermission:!!Crm.userDetails.permissions.Crm_Implied_Create_Calls,taskPermission:!!Crm.userDetails.permissions.Crm_Implied_Create_Tasks,mailPermission:r}),t.setData({callActivityPermission:t.getData("callPermission")||t.getData("taskPermission"),mailActivityPermission:t.getData("mailPermission")||t.getData("taskPermission")}),Crm.userDetails.isBestModeEnabled&&Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("BestMode")],ResourceConstants.CRM)[0]],void 0,(function(){t.getBestModeData()}))}}else $("#bestTimeToContactDiv").hide();else this.setData({besttimeshow:!1,isEmptyScreenNeeded:!0,isTitleNeeded:!0})},actions:{handleEventCreation:function(e){this.getData("isKioskComponent")&&this.getData("parentComponent").setData("isBestTimePopupRendered",!1);e&&"task"===e.type&&renderingUtils.removeFreezeLayer()},updateBestModePreference:function(e){var t=this;Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("BestMode")],ResourceConstants.CRM)[0]],void 0,(function(){t.getPreferenceData(e)}))},showCalendar:function(){this.setData({calendarshow:!0,dropdownshow:!1})},showRemindMePopupCall:function(){document.getElementById(this.getData("bestTimeReminderCall")).ltProp("show",!0)},showRemindMePopupText:function(){document.getElementById(this.getData("bestTimeReminderText")).ltProp("show",!0)},showDetailsPagePopOver:function(e,t,i,a){if("DetailsPage"===this.getData("viewType")){var s="Call"===a;s?this.setData("dateForMail",this.getData("gmtTimeCall")[t]):this.setData("dateForMail",this.getData("gmtTimeText")[t]),crmBstTime.detailsPageDate=i,crmBstTime.detailsPageTime=t.match(new RegExp("(\\d+):(\\d+) ?("+I18n.getMsg("AM")+"|"+I18n.getMsg("PM")+"|)"));var o=s?document.getElementById(this.getData("bestTimeActivitiesOptionCall")):document.getElementById(this.getData("bestTimeActivitiesOptionText"));s?o.ltProp("originElem","#"+this.getData("bestTimeValueCall")+e):o.ltProp("originElem","#"+this.getData("bestTimeValueText")+e);var l=s?this.getData("taskPermission")||this.getData("callPermission"):this.getData("mailPermission")||this.getData("taskPermission");o.ltProp("show",l)}else{if("CreateTask"===this.getData("viewType")){var r=$("#Crm_Tasks_RemindAt_Start_Date1_TimeOption");r.val(t).effect("highlight",{},1e3);var n=r.val().split(" ")[0].split(":"),m=n[0],d=n[1];m="PM"===Utils.getMeridiem(r.timeEntry("getTime")).toUpperCase()?parseInt(m)+12:m;var p=crmCalendar.getDateObjectFromGivenDateString($("#Crm_Tasks_RemindAt_Start_Date1").val());p.setHours(m),p.setMinutes(d),$("#Tasks_fldRow_RemindAt_Start_Date1 #Crm_Tasks_RemindAt_Start_Date1").data("dateObj",p)}else"CreateCall"===this.getData("viewType")&&$("#Crm_Calls_CALLSTARTDATETIME_TimeOption").val(t).effect("highlight",{},1e3);Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:this.getData("viewType"),BestTimeTo:this.getData("type"),DateCri:crmBstTime.getDateCri(p)})}},triggerCreateCall:function(e,t){var i=this,a=i.getData("dateForMail");(document.getElementById(i.getData("bestTimeActivitiesOptionCall")).ltProp("show",!1),$L(t).addClass("BT"),this.getData("isKioskComponent"))?(this.getData("parentComponent").setData("isBestTimePopupRendered",!0),Crm.globalCreate(e,"best_time_call",t,a,null,null,{id:i.getData("seid"),name:i.getData("name"),module:i.getData("module")})):Crm.userDetails.isRelatedListLyteEnabled?isNewCallView?Crm.globalCreate(e,"best_time_call",t,a,null,null,{id:i.getData("seid"),name:i.getData("name"),module:i.getData("module")}):i.logCall(e,t):isNewCallView?Crm.globalCreate(e,"best_time_call",t,a):crmRelatedList.logCall(e,t);Crm.client_tracking("BestTime - Usage",{Module:i.getData("module"),viewType:"DetailsPage",BestTimeTo:i.getData("type"),DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)})},triggerCreateTask:function(e,t,i){var a=this;(document.getElementById(a.getData("bestTimeActivitiesOptionCall")).ltProp("show",!1),document.getElementById(a.getData("bestTimeActivitiesOptionText")).ltProp("show",!1),$L(t).addClass("BT"),a.getData("isKioskComponent"))&&a.getData("parentComponent").setData("isBestTimePopupRendered",!0);activityCreate(e,"Task",I18n.getMsg(i),a.getData("dateinMS"),null,null,a.getData("seid"),a.getData("module")),Crm.client_tracking("BestTime - Usage",{Module:a.getData("module"),viewType:"DetailsPage",BestTimeTo:a.getData("type"),DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)})},schedulemail:function(){document.getElementById(this.getData("bestTimeActivitiesOptionText")).ltProp("show",!1);var e=$L.moment(this.getData("dateForMail")).toDate(),t=e.getFullYear(),i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var a=e.getDate().toString(),s=i+"/"+(a=a.length>1?a:"0"+a)+"/"+t+"##"+crmBstTime.detailsPageTime[1]+":"+crmBstTime.detailsPageTime[2]+"##"+crmBstTime.detailsPageTime[3];(Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"Schedule Mail-DetailsPage",BestTimeTo:"Text",DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)}),this.getData("isKioskComponent"))&&this.getData("parentComponent").setData("isBestTimePopupRendered",!0);EntSendMail(this.getData("module"),this.getData("seid"),"BestTimeMail",this.getData("module").slice(0,-1),"","","","","",this.getData("dateForMail"),encodeURIComponent(s))},showDayDropDownPopUp:function(){"DetailsPage"===this.getData("viewType")&&(this.setData("dropdownshow",!0),document.getElementById(this.getData("dayDropId")).ltProp("show",!0))},onReminderIntiated:function(e,t,i){var a="Call"===i,s=store.peekRecord("besttime_zia_new",this.getData("seid")),o=a?s.$.get("bestTime_call")[e].reminder:s.$.get("bestTime_text")[e].reminder;a?s.$.set("bestTime_call["+e+"].reminder",!o):s.$.set("bestTime_text["+e+"].reminder",!o),crmui.hideTooltip(),this.setData("storedata",s);var l=a?this.getData("gmtTimeCall"):this.getData("gmtTimeText"),r="Contacts"===this.getData("module")?"-1":"-2",n={seId:this.getData("seid"),reminderTime:a?this.getData("gmtTimeCall")[t]:this.getData("gmtTimeText")[t],viewId:r,seModule:this.getData("module")},m=a?this.getData("reminderTimeSetCall"):this.getData("reminderTimeSetText"),d=a?s.$.get("bestTime_call").length:s.$.get("bestTime_text").length;if(o)n.operation="remove",a?this.setData("reminderTimeSetCall",void 0):this.setData("reminderTimeSetText",void 0),this.setData("reminderTimeSet",void 0);else{m&&(n.oldReminderTime=a?this.getData("gmtTimeCall")[m]:this.getData("gmtTimeText")[m]);for(var p=0;p<d;p++)p!=e&&(a?s.$.set("bestTime_call["+p+"].reminder",!1):s.$.set("bestTime_text["+p+"].reminder",!1));for(var c in n.reminderTime=l[t],n.operation="add",Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"DetailsPage",BestTimeTo:this.getData("type"),DateCri:"Today"}),n.userTZ=Crm.userDetails.USER_TIME_ZONE,n.timeFormat=Crm.userDetails.TIME_FORMAT,l)l[c]===n.reminderTime&&(a?this.setData("reminderTimeSetCall",c):this.setData("reminderTimeSetText",c),this.setData("reminderTimeSet",c))}this.sendBestTimeReminderRequest(n);var T=document.getElementById(this.getData("bestTimeReminderCall")),y=document.getElementById(this.getData("bestTimeReminderText"));T&&y&&(T.ltProp("show",!1),y.ltProp("show",!1))},changeDateForViewType:function(e){document.getElementById(this.getData("dayDropId")).ltProp("show",!1),e.setHours(0),e.setMinutes(0),e.setSeconds(0);var t=store.peekRecord("besttime_zia_new",this.getData("seid"));t&&t.$.deleteRecord(),this.getRecordForEmptyStore(e)},reloadBesettime:function(){this.getRecordForEmptyStore($L.moment().toDate())}},methods:{closeBestTimeDropDownPopover:function(){this.setData("calendarshow",!1),document.getElementById(this.getData("dayDropId")).ltProp("show",!1)},getDiffTime:function(e){(e=crmBstTime.component)&&e.getMethods()&&e.getMethods().getDiffTimeNewOne(e)},getDiffTimeNewOne:function(e){var t=[];if(e.getData("bestTimeToShowCall")&&t.push({timeString:e.getData("bestTimeToShowCall"),isCall:!0}),e.getData("bestTimeToShowText")&&t.push({timeString:e.getData("bestTimeToShowText"),isCall:!1}),t.length>0)for(var i=t.length,a=0;a<i;a++){var s=t[a].isCall,o=s?e.getData("gmtTimeCall"):e.getData("gmtTimeText"),l=-($L.moment().toDate()-$L.moment(o[t[a].timeString]).toDate())/6e4,r=Math.ceil(Math.ceil(l)%60),n=Math.ceil(Math.ceil(l)/60),m={};m[s?"diffTimeCall":"diffTimeText"]=l,m[s?"bestTimeToShowEtaaCall":"bestTimeToShowEtaaText"]=crmBstTime.getRemainingTimeText(n,r),e.setData(m)}else clearTimeout(e.getData("interval")),clearInterval(e.getData("intervalID"))},changeDate:function(){var e=(a=arguments[1]).split("/"),t=e[0],i=e[1]-1,a=e[2],s=new Date(t,i,a),o=store.peekRecord("besttime_zia_new",this.getData("seid"));o&&o.$.deleteRecord(),this.getRecordForEmptyStore(s),this.setData("calendarshow",!1),document.getElementById(this.getData("dayDropId")).ltProp("show",!1)}},setDataToThisComponent:function(e){if(void 0!==e&&(void 0!==e.bestTime_all||void 0!==e.bestTime_call||void 0!==e.bestTime_text)){var t=$L("#bestTimeToContactDiv"),i=$L("#BestTimeDetailsPage");if(0!==t.length&&t.removeClass("dN"),0!==i.length&&i.removeClass("dN"),"CALLTEXT"===this.getData("type"))this.setData({reminderTimeCall:e.bestTime_call,reminderTimeText:e.bestTime_text});else{var a="Call"===this.getData("type");a?this.setData({reminderTimeCall:e.bestTime_call,reminderTimeText:[]}):this.setData({reminderTimeText:e.bestTime_text,reminderTimeCall:[]}),this.setData("reminderTime",a?e.bestTime_call:e.bestTime_text)}this.setData("inputDate",e.inputDate),this.setData("dateinMS",e.dateInMS),this.getData("viewType")||this.setData("viewType","DetailsPage"),"DetailsPage"===this.getData("viewType")&&this.setData("isDetailsPage",!0);for(var s=this.getData("reminderTimeCall"),o=this.getData("reminderTimeText"),l=!(s&&s.length>0),r=!(o&&o.length>0),n=e.inputDate===I18n.getMsg("Today")&&"DetailsPage"===this.getData("viewType"),m={},d=void 0!==s?s.length:0,p=0;p<d;p++)m[s[p].bestTime]=s[p].dateTime.getTime();this.setData("gmtTimeCall",m),m={},d=void 0!==o?o.length:0;for(p=0;p<d;p++)m[o[p].bestTime]=o[p].dateTime.getTime();if(this.setData("gmtTimeText",m),s&&s.length>0&&n){crmBstTime.detailsPageDate=s[0].dateTime,this.setData({bestTimeToShowCall:s[0].bestTime,bestTimeToShowCallLevel:s[0].level});for(d=s.length,p=0;p<d;p++)s[p].reminder&&this.setData({reminderTimeSetCall:s[p].bestTime,reminderTimeSet:s[p].bestTime})}if(o&&o.length>0&&n){crmBstTime.detailsPageDate=o[0].dateTime,this.setData("bestTimeToShowText",o[0].bestTime),this.setData("bestTimeToShowTextLevel",o[0].level);for(d=o.length,p=0;p<d;p++)o[p].reminder&&this.setData({reminderTimeSetText:o[p].bestTime,reminderTimeSet:o[p].bestTime})}this.setData({allTimesLapsedCall:l,allTimesLapsedText:r,showDetailedToday:n,besttimeshow:!0}),"DetailsPage"===this.getData("viewType")&&n&&(crmBstTime.component=this,this.getMethods().getDiffTime(this))}},startInterval:function(){var e=$L.moment().toDate();e.setMinutes(e.getMinutes()+1),e.setSeconds(0);var t=this;this.setData("interval",setTimeout((function(){crmBstTime.component=t,t.callIntervalUpdate(t)}),e-$L.moment().toDate()))},getBestModeData:function(){var e=this,t=e.getData("seid"),i=moduleRecordMapping[e.getData("module")],a=store.peekRecord("zia-insights-v2",t);a&&a.best_mode_data?e.getPreferenceData(a.best_mode_data):store.peekRecord("features-status",i.api_name)?e.getZiaInsightsData(i,t,e):store.findAll("features-status",{module:i.api_name,group:"zia",page:1,per_page:20}).then((function(a){a&&e.getZiaInsightsData(i,t,e)}))},getZiaInsightsData:function(e,t,i){var a=Lyte.registeredMixins["zia-insights-utils"].getInsightsV2(e,t,{keys:"best_mode_data"},null,"best_mode_to_contact");a&&a.then((function(e){e&&e.zia_insights&&i.getPreferenceData(e.zia_insights.best_mode_data)}))},getPreferenceData:function(e){var t=e&&e.length>0?e[0]:{};if(t.preference){var i=null;"calls"===t.preference?(this.setData({isEmailPreferred:!1,isCallPreferred:!0}),i="Call"):"emails"===t.preference&&(this.setData({isEmailPreferred:!0,isCallPreferred:!1}),i="Email"),i&&Crm.client_tracking("Zia Best Mode - Preference",{Type:i})}},callIntervalUpdate:function(e){e?e.getData("inputDate")===I18n.getMsg("Today")&&(e.getData("gmtTimeCall")||e.getData("gmtTimeText"))&&(this.setData("intervalID",setInterval(e.getMethods().getDiffTime,6e4)),e.getMethods().getDiffTime(e)):(clearTimeout(e.getData("interval")),clearInterval(e.getData("intervalID")))},setMinimumDate:function(){var e=$L.moment().toDate(),t=e.getFullYear(),i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var a=e.getDate().toString();a=a.length>1?a:"0"+a,this.setData("minimumDate",t+"/"+i+"/"+a)},setDropDownDateDetails:function(){for(var e=[],t=0,i=0;i<7;i++){var a=$L.moment().toDate();a.setDate(a.getDate()+t++);var s={date:a};s.label=I18n.getMsg(this.getData("days")[a.getDay()])+", "+I18n.getMsg(this.getData("months")[a.getMonth()])+" "+a.getDate(),e.push(s)}e[0].label=I18n.getMsg("Today"),e[1].label=I18n.getMsg("Tommorow"),this.setData("dropDownDisplayDates",e)},getRecord:function(){var e=store.peekRecord("besttime_zia_new",this.getData("seid"));this.setDataToThisComponent(e)},getRecordForEmptyStore:function(e){var t=this,i=t.getData("seid"),a=t.getData("module"),s=t.getData("type"),o=e?e.getTime():$L.moment().toDate().getTime();i&&a&&s&&o&&store.findAll("besttime_zia_new",{id:i,type:s.toUpperCase(),module:a,reqDate:o}).then((function(){t.getRecord()}))},changeDate:function(e){document.getElementById(this.getData("dayDropId")).ltProp("show",!1);var t=e.split("/"),i=t[0],a=t[1]-1,s=(e=t[2],new Date(i,a,e)),o=store.peekRecord("besttime_zia_new",this.getData("seid"));o&&o.$.deleteRecord(),this.getRecordForEmptyStore(s)},changeDateForCreateTask:function(e){$L($("crm-besttime-new")[0]).show();var t=store.peekRecord("besttime_zia_new",this.getData("seid"));t&&t.$.deleteRecord(),this.getRecordForEmptyStore(e)},sendBestTimeReminderRequest:function(e){var t=this;store.findAll("zia_reminder",e,!1,!1).then((function(){if("remove"!==e.operation){var i=store.peekRecord("zia_reminder",t.getData("seid"));i&&("Call"===t.getData("type")?t.setData("reminderTimeSetCall",i.reminderTime):t.setData("reminderTimeSetText",i.reminderTime),t.setData("reminderTimeSet",i.reminderTime))}}))}},{mixins:["crm-related-list-utils"]});
