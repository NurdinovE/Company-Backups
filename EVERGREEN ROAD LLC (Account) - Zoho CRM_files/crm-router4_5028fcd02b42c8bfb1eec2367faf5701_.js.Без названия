Lyte.Router.registerRoute("crm.crm-mobile-intermediatepage",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-mobilepage.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-mobilepage.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("mobilewebintermediatepage")],ResourceConstants.CRM);return t.concat(e).concat(r)},renderTemplate:function(){return{outlet:"body",component:"crm-mobile-intermediatepage"}}}),Lyte.Router.registerRoute("crm.crm-error",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-module-error.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-module-error.css"],ResourceConstants.CRMClient);return e.concat(t)},afterModel:function(e,t){this.currentModel=this.transition.data},renderTemplate:function(e,t){return featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),!0===e.showError?{outlet:"#show",component:"crm-deleted-module-error-page"}:{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.offlineBackupAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["offlineBackupAdminTool.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["offlineBackupAdminTool.css"],ResourceConstants.CRMClient))},renderTemplate:function(){return{outlet:"#show",component:"crm-offlinebackupadmintool"}}}),Lyte.Router.registerRoute("crm.exportAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["exportAdminTool.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-fileupload.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["exportAdminTool.css"],ResourceConstants.CRMClient))},renderTemplate:function(){return{outlet:"#show",component:"crm-exportadmintool"}}}),Lyte.Router.registerRoute("crm.importAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["importAdminTool.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["importAdminTool.css"],ResourceConstants.CRMClient))},renderTemplate:function(){return{outlet:"#show",component:"crm-importAdminTool"}},afterRender:function(){$L("body").addClass("oH")},beforeExit:function(){$L("body").removeClass("oH")}}),Lyte.Router.registerRoute("crm.dcMigrationAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["dcMigrationAdminTool.js","lyte-progressbar.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["dcMigrationAdminTool.css"],ResourceConstants.CRMClient))},renderTemplate:function(){return{outlet:"#show",component:"crm-dcmigrationadmintool"}}}),Lyte.Router.registerRoute("crm.offlineQueryConsoleAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["offlineQueryConsoleAdminTool.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-offlinequeryconsoleadmintool.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},renderTemplate:function(){return{outlet:"#show",component:"crm-offlinequeryconsoleadmintool"}}}),Lyte.Router.registerRoute("crm.sccLogs",{getResources:function(){var e=networkUtils.returnDependencyFiles(["sccLogs.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-scclogs.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient))},model:function(){return Lyte.resolvePromises({scclogs:store.findAll("scc_log")})},renderTemplate:function(){return{outlet:"#show",component:"crm-scclogs"}},beforeExit:function(){$L("body").removeClass("oH")}}),Lyte.Router.registerRoute("crm.exportAuditLogAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["exportAuditLogAdminTool.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["exportAuditLogAdminTool.css"],ResourceConstants.CRMClient))},renderTemplate:function(){return{outlet:"#show",component:"crm-exportauditlogadmintool"}}}),Lyte.Router.registerRoute("crm.supportAccessAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["supportAccessAdminTool.js","lyte-daterangepicker.js","lyte-dateselect.js","crm-support-access-model.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-support-access-admin-tool.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("supportaccess")],ResourceConstants.CRM))},actions:{onError:function(e,t){(500===e.status&&(commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("error.unknown.problem")}}),t.resume()),400===e.status)&&("INVALID_REQUEST"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),this.transition.abort(),renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.tab.module.begin","Home")}))))}},model:function(){return store.triggerAction("support_access","support_access_active_orgs",void 0,{},"GET").then((function(e){if(null!==e)return commonUtils.showHideLoadingDiv(!1),{processData:e.support_access_active_orgs}}))},renderTemplate:function(){return{outlet:"#show",component:"crm-supportaccessadmintool"}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.emailAdminTool",{queryParams:["action"],getResources:function(){var e=networkUtils.returnDependencyFiles(["emailAdminTool.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["emailAdminTool.css"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},afterModel:function(){commonUtils.showHideLoadingDiv()},model:function(){var e={};return e.queryParams=this.transition.info.queryParams,e},renderTemplate:function(){return{outlet:"#show",component:"crm-emailadmintool"}}}),Lyte.Router.registerRoute("crm.adminTool",{}),Lyte.Router.registerRoute("crm.gamification",{getResources:function(){var e=[];return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=Crm.userDetails.CUSTOMIZE_INFO.motivator_dark_theme?Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-rtl-dark.css","gamescope-crux-components-rtl-dark.css","gamescope.css","gamescope-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-dark.css","gamescope-crux-components-dark.css","gamescope.css"],ResourceConstants.CRMClient)):Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-rtl.css","gamescope-crux-components-rtl.css","gamescope.css","gamescope-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components.css","gamescope-crux-components.css","gamescope.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamification"),"zohocrm_analytics.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamescopenotifications")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamescope")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-detailed-comp.js","gamescope-delete-modal.js","gamescope-alert.js","gamescope-threedotmenu.js","lytecombobox.js","lyte-hovercard.js","lyte-daterangepicker.js","lyte-dateselect.js","lyte-nav.js","crux-criteria-component.js","crux-criteria-conditions.js","gamescope-helpers.js","lyte-grouper.js","lyte-button-group.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-card.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel-comp.js","lyte-carousel.js","lyte-scrollspy.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-create-dashboard-comp.js","gamescope-game-chart.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-team-comp.js","lyte-fileupload.js","lyte-cropper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-team-comp.css","gamescope-create-game.css","gamescope-tvchannel.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-icons.css","gamescope-delete-modal.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-target-comp.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-threedot-menu.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-button-group.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-target-create-comp.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-game-comp.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-game-badge.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["motivator-notification-panel.js","motivator-notification-card.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["motivator-notification-panel.css","motivator-notification-card.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-report-dependencies.js","model-crm-report.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard-component.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-detailed.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-chart.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-about-game.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-record-deleted.js","lyte-scrollTo.js","lyte-clock.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope.js"],ResourceConstants.CRMClient))},getDependencies:function(){var e=[];return e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["motivator-notifications-model.js","gamescope-game-config-model.js","features_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["temp_components.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-game-rule-model.js","gamescope-game-badge.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-target.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-point-computation.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-game-team.js"],ResourceConstants.CRMClient))},model:function(){return Lyte.resolvePromises({user:store.findAll("user",{include_lite_users:!0}),features:store.findAll("features",{api_names:["sales_motivator_rules","sales_motivator_targets","sales_motivator_tvchannels","sales_motivator_tvchannels_comp","sales_motivator_dashboards","sales_motivator_dashboards_comp","sales_motivator_games","sales_motivator_games_rules","sales_motivator_games_users","sales_motivator_games_teams","sales_motivator_teams","sales_motivator_teams_users"].join(",")}),game_rule:store.findAll("game_rule",{include:"point_computation"}),targets:store.findAll("target"),gamescope_analytics:store.findAll("gamescope_analytics"),role:store.findAll("role"),tv_channels:store.findAll("tv_channels"),game_badge:store.findAll("game_badge"),game_team:store.findAll("game_team")})},renderTemplate:function(){try{CrmAnalytics.initChart()}catch(e){Lyte.Component.registeredHelpers.log("CrmAnalytics.initChart throws error")}return{outlet:"#basic",component:"gamescope-index"}},actions:{didTransition:function(){if(this.setTitle(I18n.getMsg("gs.salesmotivator")),$L("#gs_threedotmenu")[0].ltProp("show",!1),$L("body").hasClass("bodyWrapper")){$L("#gs_create_rule_modal")[0].ltProp("show",!1),$L("#gs_create_target_modal")[0].ltProp("show",!1),$L("#gs_create_team_modal")[0].ltProp("show",!1),$L("#gs_create_game_modal")[0].ltProp("show",!1),$L("#gs_create_dashboard_modal")[0].ltProp("show",!1);var e=$L("#gs_create_component_modal");e.length>0&&e[0].ltProp("show",!1);var t=$L("#gs_create_tvchannel_modal");t.length>0&&t[0].ltProp("show",!1),$L("#gs_delete_modal")[0].ltProp("show",!1)}},onError:function(e){if(e&&e.response)try{var t=JSON.parse(e.response);"NO_PERMISSION"===t.code&&"Gamification is not enabled"===t.message&&$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="gs_redText crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")}catch(e){return!1}}},afterRender:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-motivator-notification-components.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}}),Lyte.Router.registerRoute("crm.gamification.achievements",{queryParams:["type","selectedPeople","selectedPeopleType","icon_id","period"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-achievement.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-achievement-comp.js"],ResourceConstants.CRMClient))},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gamescope-achievements.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-game-badge.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-target.js"],ResourceConstants.CRMClient))},beforeModel:function(){store.unloadAll("game_achievements"),store.unloadAll("target_achievements")},model:function(e){var t=e.queryParams;"team"!==t.selectedPeopleType||store.peekRecord("game_team",t.selectedPeople)||(t.selectedPeopleType=void 0,t.selectedPeople=void 0);var r,s=t.type&&0!==t.type.length?t.type:"games",o=t.selectedPeopleType&&0!==t.selectedPeopleType.length?t.selectedPeopleType:"user",n=t.selectedPeople&&0!==t.selectedPeople.length?t.selectedPeople:Crm.userDetails.USER_ID,a={type:o,id:n};t.icon_id&&"0"!==t.icon_id&&(a.icon_id=t.icon_id),t.period||"games"!==t.type||(t.period="today"),t.period&&"all"!==t.period&&(a.period=t.period),"user"===o&&(r=void 0===store.peekRecord("user",n)?store.findRecord("user",n):Promise.resolve([store.peekRecord("user",n)]));var i=this.getTrhopyNames();return"games"===s?(a.include_inner_details="result.configs.start_date, result.configs.end_date",Lyte.resolvePromises({gameAchievement:store.findRecord("game_achievements",n,a,!0,!0),gameModel:store.findAll("game",{status:"completed"}),achievementType:s,selectedPeopleType:o,user:r,selectedPeople:n,trophyId:t.icon_id?t.icon_id:"0",selectedGameDuration:t.period,trophyNames:i,badges:store.findAll("game_badge")})):"targets"===s?Lyte.resolvePromises({targetAchievement:store.findRecord("target_achievements",n,a,!0,!0),badges:0===store.peekAll("game_badge").length?store.findAll("game_badge"):Promise.resolve(store.peekAll("game_badge")),targets:0===store.peekAll("target").length?store.findAll("target"):Promise.resolve(store.peekAll("target")),achievementType:s,selectedPeopleType:o,user:r,badgeId:t.icon_id,trophyNames:i,selectedTargetPeriod:t.period,selectedPeople:n}):{selectedPeopleType:"invalid",nodatafound:!0,message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"}},afterModel:function(e,t){var r=void 0!==t.queryParams.type?t.queryParams.type:"games";if("user"===e.selectedPeopleType){if(0===Object.keys(e.user).length||"deleted"===e.user[0].status)return e.nodatafound=!0,e.recordName=I18n.getMsg("gs.small.user"),this.currentModel=e;e.nodatafound=!1,e.user=e.user[0],e.selectedPeopleName=e.user.$.get("full_name")}else if("team"===e.selectedPeopleType){if(!store.peekRecord("game_team",e.selectedPeople))return e.nodatafound=!0,e.recordName=I18n.getMsg("gs.small.team"),this.currentModel=e;e.nodatafound=!1,e.selectedPeopleName=store.peekRecord("game_team",e.selectedPeople).$.get("name")}else{if("company"!==e.selectedPeopleType)return this.currentModel=e;if(e.selectedPeople!=crmZgid)return e.nodatafound=!0,e.recordName=I18n.getMsg("gs.allusers"),this.currentModel=e;e.selectedPeopleName=Crm.userDetails.orgName}if("targets"===r){if(e.badgeId&&"0"!==e.badgeId&&!e.badges.some((t=>t.id===e.badgeId)))return e.nodatafound=!0,e.recordName=I18n.getMsg("game.trophy.text"),this.currentModel=e;e.badges=e.badges.map((function(e){return e.$.toJSON()}));var s=e.targetAchievement,o={},n={},a=[];e.badges.forEach((function(e){o[e.name]=0,n[e.id]=[],s.badge_totals[e.id]?e.total=s.badge_totals[e.id]:e.total=0}));var i=["daily","weekly","monthly","yearly"],c={daily:[],weekly:[],monthly:[],yearly:[]};s.result.forEach((function(t,r){var s=store.peekRecord("target",t.target.id);t.repeatType=s.$.get("time_period").type,t.icon_id=s.$.get("icon_id");var l=store.peekRecord("game_badge",t.icon_id);t.icon_name=l.$.get("name"),o[t.icon_name]++,e.badges.forEach((function(e){t.icon_id===e.id&&n[e.id].push(objectUtils.cloneObject(t))})),i.forEach((function(e){t.repeatType===e&&c[e].push(objectUtils.cloneObject(t))})),a[r]=objectUtils.cloneObject(e.targetAchievement.result[r])})),e.targetResult=a,e.badgeWiseResultData=n,e.badgeWiseResultData[0]=a,c.all=a,e.repeatTypeWiseResultData=c,e.badgeData=o,e.targetAchievement.badgeTotalCount=s.result.length,e.badges.unshift({name:"allbadge",display_name:I18n.getMsg("gs.allbadge"),id:"0"})}else{if(e.trophyId&&"0"!==e.trophyId&&!e.trophyNames.some((t=>t.id===e.trophyId)))return e.nodatafound=!0,e.recordName=I18n.getMsg("gs.badge"),this.currentModel=e;var l=[];for(m=0;m<6;m++)l[m]=[];a=[];for(var d=e.gameAchievement.result.length,m=0;m<d;m++){var u=e.gameAchievement.result[m];a[m]=u,a[m]&&l[u.rank].push(a[m])}l[0]=a,e.trophyWiseResultData=l,e.gameResult=a}if("user"===e.selectedPeopleType&&e.user){var g=e.user;if(g){var p=g.$.get("profile");p&&(e.userProfileName=p.$.get("name"))}}e.badges&&e.badges.forEach((e=>{e.isSelected=!1}))},afterRender:function(){$L("#gs_nav_achievements").attr("selected",!0)},didDestroy:function(e,t){var r=t.queryParams,s=void 0!==r.type?r.type:"games",o=void 0===r.selectedPeopleType?"user":r.selectedPeopleType,n=void 0===r.selectedPeople?Crm.userDetails.USER_ID:r.selectedPeople,a={type:o,id:n,icon_id:r.icon_id,period:r.period};"games"===s?(a.include_inner_details="result.configs.start_date, result.configs.end_date",store.clearCachedQuery("game_achievements",n,a)):store.clearCachedQuery("target_achievements",n,a)},renderTemplate:function(e){return e.nodatafound?{outlet:"#gs_outlet",component:"gamescope-record-deleted"}:{outlet:"#gs_outlet",component:"gamescope-achievement",reRender:!0}},actions:{willTransition:function(){var e=this.queryParams,t=void 0!==e.type?e.type:"games",r=void 0===e.selectedPeopleType?"user":e.selectedPeopleType,s=void 0===e.selectedPeople?Crm.userDetails.USER_ID:e.selectedPeople,o={type:r,id:s,icon_id:e.icon_id,period:e.period};"games"===t?(o.include_inner_details="result.configs.start_date, result.configs.end_date",store.clearCachedQuery("game_achievements",s,o)):store.clearCachedQuery("target_achievements",s,o)},onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code&&"You don't have a permission to view this details"===r.message?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondenied"},"#gs_outlet")):"NO_PERMISSION"===r.code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}},{mixins:["gamescope_config"]}),Lyte.Router.registerRoute("crm.gamification.dashboards.index",{queryParams:["id"],getResources:function(){var e=[];return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["motivator-visiblity-dropdown.js","crux-combo-box.js","gamescope-grid.js","gamescope-game-chart.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard-create.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["motivator-visiblity-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getDependencies:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-game-models.js"],ResourceConstants.CRMClient))},beforeModel:function(e){store.unloadAll("gamescope_analytics"),store.unloadAll("gamescope_components"),store.unloadAll("motivator_live_components");var t=this,r=e.queryParams.id,s={};return s.gamescope_analytics=store.findAll("gamescope_analytics"),s.gamescope_analytics_recent=store.findAll("gamescope_analytics",{category:"recent"}),Lyte.resolvePromises(s).then((function(e){if(!e.gamescope_analytics||e.gamescope_analytics&&0===e.gamescope_analytics.length){if(r&&"new"===r){var s=Lyte.registeredMixins.gamescope_config.isgsFeatureLimitExceed("Dashboard");return Lyte.Component.registeredHelpers.isGsThreeDotMenuAccessible()?s?Promise.reject({response:JSON.stringify({code:"LIMIT_EXCEED"})}):Promise.resolve({}):Promise.reject({response:JSON.stringify({code:"NO_PERMISSION_FOR_CREATE"})})}if(!r)return t.transitionTo({route:"crm.gamification.dashboards.index",queryParams:{id:"default"}}),Promise.resolve({});if(r&&"default"!==r)return Promise.reject({response:JSON.stringify({code:"NO_RECORD_FOUND"})})}if(!r){if(e.gamescope_analytics_recent&&e.gamescope_analytics_recent[0]){var o=null===e.gamescope_analytics_recent[0]?"default":e.gamescope_analytics_recent[0].id;return t.transitionTo({route:"crm.gamification.dashboards.index",queryParams:{id:o}}),Promise.resolve({})}return t.transitionTo({route:"crm.gamification.dashboards.index",queryParams:{id:"default"}}),Promise.resolve({})}if("default"===r||"new"===r){s=Lyte.registeredMixins.gamescope_config.isgsFeatureLimitExceed("Dashboard");return"new"!==r||Lyte.Component.registeredHelpers.isGsThreeDotMenuAccessible()?"new"===r&&s?Promise.reject({response:JSON.stringify({code:"LIMIT_EXCEED"})}):Promise.resolve({}):Promise.reject({response:JSON.stringify({code:"NO_PERMISSION_FOR_CREATE"})})}if(e.gamescope_analytics)return e.gamescope_analytics.some((e=>e.id===r))?Promise.resolve({}):Promise.reject({response:JSON.stringify({code:"NO_RECORD_FOUND"})})}))},model:function(e){var t=e.queryParams.id,r={};return r.gamescope_analytics=store.findAll("gamescope_analytics"),r.gamescope_analytics_recent=store.findAll("gamescope_analytics",{category:"recent"}),r.rulesData=store.findAll("game_rule").then((function(){return Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()})),r.targetsData=store.findAll("target").then((function(){return store.findAll("points_acquired").then((function(){return Lyte.registeredMixins.gamescope_target.getConstructedTargetsDataForTargetDash()}))})),r.badges=store.findAll("game_badge"),r.gameConfig=store.findAll("game",{status:"ongoing"}),r.teams=store.findAll("game_team"),r.role=store.findAll("role"),"default"!==t&&"new"!==t?(r.components_alone=Lyte.registeredMixins.gamescope_tvchannel.getComponentsLiveDataWithRecords(t,"dashboard","game"),r.gamescope_analytics_record=store.findRecord("gamescope_analytics",t,void 0,void 0,void 0,{isFromThreeDot:!1})):"default"===t&&store.findRecord("gamescope_analytics",Crm.userDetails.USER_ID,void 0,void 0,void 0,{isFromThreeDot:!1}),Lyte.resolvePromises(r).then((function(e){if(e.dashboardId=t,e.totalDashboards=e.gamescope_analytics?e.gamescope_analytics.length:0,e.rulesData=e.rulesData&&0!==e.rulesData.length?JSON.parse(JSON.stringify(e.rulesData)):[],e.targetsData=e.targetsData&&0!==e.targetsData.length?JSON.parse(JSON.stringify(e.targetsData)):[],e.gameConfig=e.gameConfig?JSON.parse(JSON.stringify(e.gameConfig)):[],e.gamescope_analytics_record&&e.gamescope_analytics_record[0]){var r=e.gamescope_analytics_record[0];e.markAsFavourite=r.favourite,"shared"===r.access_type?e.selectedAccessType="custom":e.selectedAccessType=r.access_type}return("new"===t||"default"===t||e.gamescope_analytics_record&&0===e.gamescope_analytics_record[0].components.length)&&(e.disableDBSaveBut=!0),"new"===t?(e.isDbCreateMode=!0,e.dashboardName=""):e.gamescope_analytics_record?e.dashboardName=e.gamescope_analytics_record[0].name:(e.dashboardName=I18n.getMsg("gs.default"),e.rulesData&&e.rulesData.forEach((function(e){e.user={},e.user.id=Crm.userDetails.USER_ID,e.user.full_name=Crm.userDetails.DISPLAY_NAME,e.user.name=Crm.userDetails.DISPLAY_NAME,e.user.type="user"}))),e.dashboardFilter=void 0!==Lyte.Router.getRouteInstance().transition.data.filterType?Lyte.Router.getRouteInstance().transition.data.filterType:"all",e}))},afterModel:function(e){if("default"!==e.dashboardId){var t=store.peekAll("gamescope_components");if(t&&0!==t.length){e.gamescope_components=Lyte.registeredMixins.motivator_components.updateDashboardComp(t),e.isDashboardComponentLimitAvailable=Lyte.registeredMixins.gamescope_config.isDashboardComponentLimitAvailable(store.peekAll("gamescope_components"));var r=Lyte.registeredMixins.motivator_components.getStoredPositions();e.maxGridHeight=Lyte.registeredMixins.motivator_components.getMaxGridHeightForLyteGrid(r)}}return e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-dashboard",reRender:!0}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code?$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"LIMIT_EXCEED"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"limitExceed"},"#gs_outlet")):"NO_PERMISSION_FOR_CREATE"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondenied"},"#gs_outlet")):"NO_RECORD_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"deleted",recordName:I18n.getMsg("gs.dashboard")},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror",recordName:I18n.getMsg("gs.dashboard")},"#gs_outlet")),commonUtils.showHideLoadingDiv(!1),!1}}}),Lyte.Router.registerRoute("crm.gamification.dashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-dashboard.css","gamescope-dashboard-inner-card.css","gamescope-target-card.css","gamescope-rule-card.css","gamescope-ongoinggame-card.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-dashboard-mixins.js","gamescope-target-card.js","gamescope-dashboard-inner-card.js","gamescope-target-mixins.js","gamescope-target.js","gamescope-game-rule-model.js","gamescope-game-badge.js","gamescope-game-team.js","gamescope-about-kpi.js","gamescope-about-target.js","gamescope-about-game.js","motivator_live_components.js"],ResourceConstants.CRMClient))},afterRender:function(){$L("#gs_nav_dashboard").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.game.index",{queryParams:["status","page","viewType"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-games.css","gamescope-create-game.css","gamescope-ongoinggame-card.css","gamescope-game-scoreboard-comp.css","gamescope-game-participants-modal.css"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["gamescope-game-comp.js","gamescope-game-scoreboard-comp.js"],ResourceConstants.CRMClient).concat(e)},model:function(e){var t=void 0===e.queryParams.status||0===e.queryParams.status.length?"upcoming":e.queryParams.status,r=void 0===e.queryParams.page?1:e.queryParams.page,s="ongoing"===t?void 0:void 0===e.queryParams.viewType?"card":e.queryParams.viewType;return Lyte.resolvePromises({summary:store.findAll("game_summary",{status:t,page:r,per_page:50}),gameConfig:store.findAll("game",{status:t,page:r,per_page:50}),status:t,routeChanged:!1,viewType:s,page:r}).then((function(e){if("upcoming"===e.status?(e.summary=e.gameConfig,e.page=r,e.gameConfig&&(e.moreRecords=e.gameConfig.$.meta.more_records)):"completed"===e.status&&(e.page=r,e.summary&&(e.moreRecords=e.summary.$.meta.more_records)),e.summary||(e.summary=[]),e.summary=e.summary.map((function(e){return e.$.toJSON()})),e.gameConfig&&(e.gameConfig=e.gameConfig.map((function(e){return e.$.toJSON()}))),"list"===e.viewType)for(var t=e.summary,s=t.length,o=e.gameConfig,n=0;n<s;n++)t[n].created_by=o[n].created_by,t[n].repeat=o[n].repeat;return e}))},afterModel:function(e){var t=this.transition.data;e&&(e.prevSelectedGameID=t.prevSelectedGameID),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-games",reRender:!0}},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.game.point-summary",{queryParams:["selectedUser","selectedTeam"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-game-point-summary-comp.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gamescope-game-point-summary-comp.css"],ResourceConstants.CRMClient);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-scoreboard.js","gamescope-game-point-summary.js"],ResourceConstants.CRMClient)},beforeModel:function(e){var t=this,r=e.dynamicParam,s=e.queryParams.selectedUser,o=e.queryParams.selectedTeam;return Crm.getUserDetailsMap(),r&&(s||o)?Lyte.resolvePromises({game:store.findRecord("game",r)}).then((function(e){if("group"===e.game.type){var n=[],a=[],i=[];if(e.game.participants.forEach((function(e){a.push(e.id),e.members.forEach((function(t){n.push(t.id),i.push(e.id),i.push(t.id)}))})),s&&n.contains(s)){var c=i[i.findIndex((e=>e===s))-1];if(o&&!a.contains(o))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!o){var l={selectedUser:s,selectedTeam:c};t.transitionTo({route:"crm.gamification.game.point-summary",dynamicParams:[r],queryParams:l}).data=t.transition.data}}else{if(!o||!a.contains(o))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});var d=e.game.participants[a.findIndex((e=>e===o))].members[0].id;if(s&&!n.contains(s))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!s){l={selectedUser:d,selectedTeam:o};t.transitionTo({route:"crm.gamification.game.point-summary",dynamicParams:[r],queryParams:l}).data=t.transition.data}}}else{if("user"!==e.game.type)return Promise.reject({response:JSON.stringify({code:"NO_GAME_FOUND"})});if(s&&!e.game.participants.some((e=>e.id===s)))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!s)return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})})}}),(function(){return Promise.reject({response:JSON.stringify({code:"NO_GAME_FOUND"})})})):Promise.reject({response:JSON.stringify({code:"NO_PARAMS_FOUND"})})},model:function(e){var t=e.queryParams.selectedUser,r=e.queryParams.selectedTeam,s=e.dynamicParam,o=this,n=store.peekRecord("game",s);if("user"===n.type)var a=store.findRecord("game_summary",s);else a=store.findRecord("game_scoreboard",s,{group_by:"group",based_on:"user"});return Lyte.resolvePromises({pointSummary:store.findAll("point_summary",{user:t},!1,!0,{id:s}),participantPoints:a}).then((function(e){var s={},a=e.participantPoints,i=e.pointSummary;s.game=n,s.isCompletedGame="completed"===n.$.get("status"),s.records=i.records,s.selectedUser=t;var c,l={};if(n.rules.forEach((function(e){l[e.id]=0})),"user"===n.type){var d=a.participants.filter((e=>e.id===t));0!==d.length&&(c=d[0].rank)}var m=0;if(i.records.forEach((function(e){l[e.rule.id]=l[e.rule.id]+e.point,m+=e.point})),s.records=i.records.filter((function(e){return void 0!==e.name})),s.totalUserPoint=m,s.ruleCountObj=l,"group"===n.type){var u=n.participants.filter((function(e){if(void 0!==(e=e.members.filter((function(e){return e.id===t}))[0]))return!0}))[0];s.members=u.members,s.selectedTeam=u.id,s.selectedTeamName=u.name}else s.members=n.participants;var g=Crm.getUserDetailsMap(),p=[];s.members.forEach((function(e){var t=g[e.id],s={image:t&&t.avatar?t.avatar:networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM),id:e.id,name:e.name?e.name:"DELETED USER"};"user"===n.type?a.participants.every((function(t){return t.id!==e.id||(s.points=t.points,s.rank=t.rank,!1)})):a.details.every((function(t){return t.id!==r||(t.based_on.every((function(t){return t.id!==e.id||(s.points=t.point,!1)})),!1)})),p.push(s)})),s.partipantAvatars=p,"user"===n.type&&s.partipantAvatars&&(s.partipantAvatars=s.partipantAvatars.sortBy("rank"));var f=o.getObjFromGivenArray(s.members,t,"id"),y=f.index;return s.selectedUserName=-1!==y?f.data.name:e.pointSummary.user.name,s.fromDashboard=o.transition.data.fromDashboard,s.dashboardId=o.transition.data.dashboardId,s.viewType=o.transition.data.viewType,s.page=o.transition.data.page,s.selectedUserRank=c,s}))},afterModel:function(e,t){return store.findRecord("game_summary",t.dynamicParam).then((function(t){if("group"===e.game.type){let r=t.participants.filter((t=>t.id===e.selectedTeam));0!==r.length&&(e.selectedTeamRank=r[0].rank)}t.participants.forEach((function(t){e.selectedTeam===t.id&&(e.summaryPointTeam=t.points)}))}))},didDestroy:function(e,t){store.clearCachedQuery("point_summary",{user:t.queryParams.selectedUser})},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-game-point-summary"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);if("NO_PERMISSION"===r.code)$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>");else if("NO_PARTICIPANTS_FOUND"===r.code||"NO_GAME_FOUND"===r.code||"NO_PARAMS_FOUND"===r.code){t.innerHTML="";var s="NO_GAME_FOUND"===r.code?{recordName:I18n.getMsg("gs.game")}:{message:I18n.getMsg("gs.incorrect.url"),type:"permissiondenied"};Lyte.Component.render("gamescope-record-deleted",s,"#gs_outlet")}else t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet");commonUtils.showHideLoadingDiv(!1)},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}},{mixins:["gamescope_config"]}),Lyte.Router.registerRoute("crm.gamification.game.scoreboard",{queryParams:["isMultipleRuleIndividualGame","selectedTab","selectedTeam","selectedRule"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-game-scoreboard-comp.js","gamescope-about-kpi.js","gamescope-about-team.js","gamescope-allkpi-table.js","lyte-counter.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gamescope-game-scoreboard-comp.css","gamescope-game-participants-modal.css","gamescope-ongoinggame-card.css"],ResourceConstants.CRMClient);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-scoreboard.js"],ResourceConstants.CRMClient)},beforeModel:function(e){var t=e.dynamicParam;return Crm.getUserDetailsMap(),store.findRecord("game",t).then((function(e){if(!(e instanceof Record))throw new Exception("GameNotFound","Game is not available in server side")}))},model:function(e){var t,r=e.dynamicParam,s=store.peekRecord("game",r),o=this;switch(e.queryParams.selectedTab){case"Users":t={group_by:"user",based_on:"rule"};break;case"Teams":t={group_by:"group",based_on:"rule"},void 0!==e.queryParams.selectedTeam&&(t.filter_type="group",t.filter_value=e.queryParams.selectedTeam,t.group_by="rule",t.based_on="user");break;case"Rules":t="user"===s.$.get("type")?{group_by:"rule",based_on:"user"}:{group_by:"rule",based_on:"group"},void 0!==e.queryParams.selectedRule&&(t.filter_type="rule",t.filter_value=e.queryParams.selectedRule,t.group_by="group",t.based_on="user");break;default:t={group_by:"group",based_on:"user"}}return Lyte.resolvePromises({summary:store.findRecord("game_summary",this.getDynamicParam()),scoreboard:store.findRecord("game_scoreboard",e.dynamicParam,t,!1,!0),game:void 0===store.peekRecord("game",r)?store.findRecord("game",this.getDynamicParam()):Promise.resolve(store.peekRecord("game",r))}).then((function(r){var s={};s.scoreboard=r.scoreboard.$.toJSON(),s.game=r.game.$.toJSON(),s.summary=r.summary.$.toJSON();var n=[];if(s.summary&&s.scoreboard&&("Teams"===e.queryParams.selectedTab||"Users"===e.queryParams.selectedTab)&&(e.queryParams.selectedTeam||(s.summary.participants.forEach((function(e){n.push(s.scoreboard.details.filter((function(t){return t.id===e.id}))[0])})),s.scoreboard.details=n)),s.summary&&s.game){s.game.participants=s.summary.participants;var a=s.game.id,i=store.peekRecord("game",a);"group"===i.type&&s.game.participants&&s.game.participants.forEach((function(e){i.participants.forEach((function(t){t.id===e.id&&(e.members=t.members)}))}))}if(s.query=t,s.selectedTab=e.queryParams.selectedTab,s.selectedTeam=e.queryParams.selectedTeam,s.selectedRule=e.queryParams.selectedRule,"Users"===s.selectedTab||"Rules"===s.selectedTab||"group"===t.filter_type){for(var c=s.scoreboard.details,l=c.length,d=[],m=0;m<l;m++)if(m%2==0){var u=[c[m]];d.push(u)}else{d[parseInt(m/2)].push(c[m])}s.scoreboardData=d}return s.isCompletedGame="completed"===s.game.status,void 0!==t.filter_type&&(s.filterBy=t.filter_type,s.filterValue=t.filter_value),s.fromDashboard=o.transition.data.fromDashboard,s.dashboardId=o.transition.data.dashboardId,s.viewType=o.transition.data.viewType,s.page=o.transition.data.page,s}))},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-game-scorecard",reRender:!0}},actions:{onError:function(e){if(!(e instanceof Exception)){var t=JSON.parse(e.response);return"NO_PERMISSION"===t.code&&(commonUtils.showHideLoadingDiv(!1),"user not a part of this Game"===t.message?($L("#gs_outlet")[0].innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.game")},"#gs_outlet")):$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}commonUtils.showHideLoadingDiv(!1),$L("div.dummy_Body")[0].style.display="none",$L("#gs_outlet")[0].innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.game")},"#gs_outlet")},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}},{mixins:["gamescope_charts"]}),Lyte.Router.registerRoute("crm.gamification.game",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-game.js","gamescope-allkpi-table.js","gamescope-about-kpi.js","gamescope-about-team.js","gamescope-game-chart.js"],ResourceConstants.CRMClient)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-models.js","gamescope-game-rule-model.js","gamescope-point-computation.js","gamescope-dashboard-component.js","gamescope-game-team.js"],ResourceConstants.CRMClient)},afterRender:function(){$L("#gs_nav_games").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.home",{queryParams:[{notification:{refreshModel:!1,sticky:!1}}],renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-home"}},model:function(){return store.findAll("game_rule")},afterModel:function(e){this.currentModel={rule:e}},afterRender:function(){$L("#gs_nav_home").attr("selected",!0)},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.rules.dashboards",{renderTemplate:function(e){return e.isRuleAvailable?{outlet:"#gs_outlet",component:"gamescope-rule-dashboard-details"}:(e.type&&"permissiondeniedformodule"===e.type||(e.recordName=I18n.getMsg("gs.rule")),{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},beforeModel:function(e){var t=Lyte.Router.getRouteInstance().transition.data;"component"===t.source?Crm.client_tracking("SM - Inner component click",{type:"rule",place:"dashboard",view:t.comptype}):Crm.client_tracking("SM - Inner component click",{type:"rule",place:"rule_dashboard",view:"trend"});var r=e.dynamicParam;return store.unloadAll("dashboard_comp"),Crm.getUserDetailsMap(),0!==store.peekAll("game_rule").length&&store.peekRecord("game_rule",r)?Promise.resolve([store.peekRecord("game_rule",r)]):store.findRecord("game_rule",r)},model:function(e){var t,r,s,o,n,a=e.dynamicParam,i=this.transition.data,c=i.people,l=i.comptype,d=i.source,m=i.selectedfield;c&&c.id&&"org"!=c.type&&"All"!=c.type&&(r=c.id),i.moduleId&&(s=i.moduleId);var u=!(0===store.peekAll("game_rule").length||!store.peekRecord("game_rule",a));if(!u)return{isRuleAvailable:u,recordName:"KPI"};var g=store.peekRecord("game_rule",a),p=store.peekRecord("module",g.module.id);if("team_based"!==p.access_type&&p.profiles&&!p.profiles.some((function(e){return e.name===Crm.userDetails.PROFILE_NAME}))||"team_based"===p.access_type&&!p.private_profile)return{type:"permissiondeniedformodule"};var f=store.findAll("module"),y=new Promise((function(e){e(o=Promise.resolve([store.peekRecord("game_rule",a)]))})).then((function(e){o=e[0];var r=store.findAll("field",{module:o.module.api_name}).then((function(e){t=Lyte.registeredMixins.gamescope_rule.getFieldObject(e)})),s=app.store.makeRequest("findAll","field",{module:p.api_name,type:"all"},!1,!0,{apiVersion:"2.1"});return Promise.all([r,s])})).then((function(){i.duration||(i.duration="thismonth");var e=Lyte.registeredMixins.game_rules_record.getDateFilterValue(i.duration,i.customstartdate,i.customenddate);e&&!e.includes("undefined")&&((n={}).api_name=o.point_computation[0].date_field.api_name,n.comparator="between",n.value=e);var t,s="trend";if("component"==d&&l&&(s=l),o.source="rule",Crm.userDetails.isGameChartEnable){var a=i.duration;"customrange"===(a=a.toLowerCase())&&(a=[a,i.customstartdate,i.customenddate]),t=Lyte.registeredMixins.game_chart.chart_xhrHandle(s,o,c,a,s,"day",m)}else t=Lyte.registeredMixins.gamescope_rule.xhrObject(o,"chart","day",s,m,r,n);return t}));return Lyte.resolvePromises({newtoResolve:y,modules:f,customView:undefined}).then((function(){return{dashBoardId:a,moduleFields:t,ruleId:o.id,transitionData:i,dateRangeVal:n,byFiledFormField:m,duration:i.duration,isRuleAvailable:u,parentCriteriaModule:s,compType:l,source:d}}))},afterModel(e){var t=this.transition.data;e.customstartdate=t.customstartdate,e.customenddate=t.customenddate,e.parentcustomstartdate=t.customstartdate,e.parentcustomenddate=t.customenddate,e.comparableRules=0!==store.peekAll("game_rule")?JSON.parse(JSON.stringify(store.peekAll("game_rule"))):[],e.comparableTeam=0!==store.peekAll("game_team")?JSON.parse(JSON.stringify(store.peekAll("game_team"))):[],e.comparableRole=0!==store.peekAll("role")?store.peekAll("role"):[],e.comparableUsers=[],this.currentModel=e},actions:{onError:function(e){var t=$L("#gs_outlet")[0];if(e.response){var r=JSON.parse(e.response);"NO_PERMISSION"===r.code&&"Gamification is not enabled"===r.message?$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"NO_PERMISSION"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondeniedformodule"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet"))}else t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.rule")},"#gs_outlet");commonUtils.showHideLoadingDiv(!1)},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.gamification.rules.index",{renderTemplate:function(){return{outlet:"#gs_outlet",component:this.getRenderComponent()}},beforeModel:function(){store.unloadAll("game_rule")},model:function(){var e,t=store.findAll("game_rule",{include:"point_computation"}).then((function(t){return e=!1,t&&t.$&&(e=t.$.meta.more_records),Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()})),r=store.findAll("module");return Lyte.resolvePromises({modules:r,rules:t,page:1,perPage:50,isMoreRecords:e})},afterModel:function(e){var t=this.transition.data;if(e.selectedRuleId=t.selectedRuleId,t.parentCriteriaTime&&(e.duration=t.parentCriteriaTime,e.customStartDate=t.parentcustomstartdate,e.customEndDate=t.parentcustomenddate),t.parentCriteriaModule&&"undefined"!==t.parentCriteriaModule&&(e.module=store.peekRecord("module",t.parentCriteriaModule),e.selectedModuleName=e.module.plural_label),t.parentCriteriaPeople?e.people=t.parentCriteriaPeople:e.people={id:Crm.userDetails.USER_ID,type:"user",full_name:Crm.userDetails.DISPLAY_NAME},store.peekAll("game_rule").length>0){e.modules=Lyte.registeredMixins.gamescope.getDashboardSupportedModules();var r=store.peekAll("game_rule"),s=e.module;s&&s.id&&"All"!==s.id&&(r=r.filter((function(e){return s.api_name===e.module.api_name}))),e.ruleDashboards=JSON.parse(JSON.stringify(r))}this.currentModel=e},getRenderComponent:function(){return store.peekAll("game_rule").length>0?"gamescope-rule-dashboard":"gamescope-rule-basic"},actions:{onError:function(e){var t=JSON.parse(e.response);return"NO_PERMISSION"===t.code&&"Gamification is not enabled"===t.message&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.rules.list",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-kpi.js"],ResourceConstants.CRMClient)},renderTemplate:function(e){return Crm.userDetails.permissions.Crm_Implied_Manage_Motivator?{outlet:"#gs_outlet",component:this.action.getRenderComponent()}:(e.type="permissiondenied",{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},beforeModel:function(){store.unloadAll("game_rule")},model:function(){var e=store.findAll("game_rule",{include:"point_computation"});return Lyte.resolvePromises({ruleData:e})},afterModel:function(e){if("Activities_depreciation"===Lyte.Router.getRouteInstance().transition.info.queryParams.source){let t=[];Lyte.registeredMixins.gamescope_list_filter_options.getAllKPI().forEach((e=>{"Activities"===e.module.api_name&&t.push(e)})),e.ruleData=t}else e.ruleData=Lyte.registeredMixins.gamescope_list_filter_options.getAllKPI();e.moduleoptions=Lyte.registeredMixins.gamescope_list_filter_options.getModuleOptionsForKPI(),e.useroptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForKPI(),this.currentModel=e},action:{getRenderComponent:function(){return store.peekAll("game_rule").length>0?"gamescope-rule-list":"gamescope-rule-basic"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.gamification.rules",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-rule.css","gamescope-rule-dashboard-detail.css","gamescope-rule-card.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-rule-card.js","gamescope-about-kpi.js"],ResourceConstants.CRMClient))},afterRender:function(){$L("#gs_nav_rules").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.targets.dashboard",{queryParams:["userId"],beforeModel:function(){"dashboard_target"===Lyte.Router.getRouteInstance().transition.data.source?Crm.client_tracking("SM - Inner component click",{type:"target",place:"dashboard",view:"trend"}):Crm.client_tracking("SM - Inner component click",{type:"target",place:"target_dashboard",view:"trend"});var e=this.getDynamicParam(),t=this.getQueryParams().userId;return!e||e&&0===e.length||!t||t&&0===t.length?Promise.reject({response:JSON.stringify({code:"INVALID_PARAM"})}):store.findRecord("target",e).then((function(e){var r=store.peekRecord("module",e[0].rule.module.id).api_name;return e instanceof Object&&0===Object.keys(e).length||e instanceof Array&&!e[0].set_for.some((e=>e.id===t))?Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})}):"Emails"===r?store.findRecord("module",e[0].rule.module.id,void 0,void 0,void 0,{getFields:!0,allowMultiple:!0}):store.findRecord("module",e[0].rule.module.id)})).then((function(e){if(!e[0].profiles.some((e=>e.name===Crm.userDetails.PROFILE_NAME)))return Promise.reject({response:JSON.stringify({code:"NO_MODULE_PERMISSION"})})}),(function(e){var t=JSON.parse(e.response);return"NO_TARGET_FOUND"===t.code?Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})}):"NO_MODULE_PERMISSION"===t.code||"NO_PERMISSION"===t.code?Promise.reject({response:JSON.stringify({code:"NO_MODULE_PERMISSION"})}):Promise.reject({response:JSON.stringify({code:"QUERY_FAIL"})})}))},model:function(e){var t=this.getQueryParams().userId,r=e.dynamicParam,s=this.transition.data,o=s.target_time_period;s.people=s.people?s.people:store.peekRecord("target",r).set_for.filter((e=>e.id===t)).map((e=>({id:e.id,full_name:e.name,type:e.type})))[0];var n,a=s.people;if(a&&"user"===a.type&&(n=a.id),a&&"team"===a.type){var i=store.peekRecord("game_team",a.id);a.teamId=a.id;var c=[];i.$.get("members").forEach((function(e){c.push(e.id)})),c.push(i.lead.id),a.id=c.toString(),n=a.id}var l=r+"_"+e.queryParams.userId,d=store.peekRecord("target",r),m=store.peekRecord("points_acquired",r),u=[],g="";d.set_for.forEach((function(e){if(m&&m.individual.some((function(t){return t.id===e.id})))if("user"===e.type)g+=e.id+",";else if("team"===e.type){var t=JSON.parse(JSON.stringify(store.peekRecord("game_team",e.id)));u.push(t)}})),g.length>0&&(g=g.slice(0,g.length-1)),o||(o=d.time_period);var p=s.source,f=o?"weekly"===o.type?"thisweek":"monthly"===o.type?"thismonth":"yearly"===o.type?"thisyear":"daily"===o.type?"today":"customRange":"customRange",y=this.getTimeGranularityForTrendChart(f);if(!d||void 0===e.queryParams.userId||0===e.queryParams.userId.length||!d.set_for.some((function(t){return t.id===e.queryParams.userId})))return Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})});var _=store.peekRecord("points_acquired",r),C=d.$.get("rule").id,v=store.peekRecord("game_rule",C).$.toJSON();if(!_||!(_&&_.individual&&_.individual.some((e=>e.id===t))))return Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})});var R,h=JSON.parse(JSON.stringify(_)),M=Lyte.registeredMixins.gamescope_target.constructCriteriaForList(h,v),b=Lyte.registeredMixins.gamescope_target.constructCriteria(h,v),D=Lyte.registeredMixins.gamescope_target.getCustomDateRange(h),L=v.module.api_name;if(v.source="target",Crm.userDetails.isGameChartEnable){var P=P=["customrange",h.start_time,h.end_time],N="org"===a.type?void 0:a;R=Lyte.registeredMixins.game_chart.chart_xhrHandle(l+"_trend",v,N,P,"trend",y)}else R=Lyte.registeredMixins.gamescope_rule.xhrObject(v,"chart",y,"trend",void 0,n,b,l);var T={fields:store.findAll("field",{module:L}),dispalyField:app.store.makeRequest("findAll","field",{module:L,type:"all"},!1,!0,{apiVersion:"2.1"}),chart:R};return g.length>1&&$L.extend(T,{users:store.findAll("user",{ids:g,type:"ActiveConfirmedUsers"})}),Lyte.resolvePromises(T).then((function(e){var t=Lyte.registeredMixins.gamescope_rule.getFieldObject(e.fields),r=[];return e.users&&(r=e.users),{dashBoardId:l,moduleFields:t,ruleId:C,transitionData:s,pointAuiredData:h,dateRangeVal:b,duration:f,timeGranularity:y,appliedCriteria:M,customDateRange:D,source:"dashboard_target"===p?p:"target",comparableUsers:r,comparableTeam:u,badges:store.findAll("game_badge")}}),(function(){return Promise.reject({response:JSON.stringify({code:"QUERY_FAIL"})})}))},afterModel(e){var t=store.peekAll("target")&&0!==store.peekAll("target").length?JSON.parse(JSON.stringify(store.peekAll("target"))):[],r=[];t.forEach((e=>{var t=store.peekRecord("points_acquired",e.id);t&&(e.set_for=e.set_for.filter((function(e){return t.individual.some((t=>t.id===e.id))})),r.push(e))})),e.comparableTargets=r;var s=e.transitionData.people;s&&"org"!==s.type?(e.isUserDiisabled=!1,e.isTargetDisabled=!0):(e.isUserDiisabled=!0,e.isTargetDisabled=!1),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-rule-dashboard-details"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code&&"Gamification is not enabled"===r.message?$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"NO_MODULE_PERMISSION"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondeniedformodule"},"#gs_outlet")):"NO_TARGET_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.target")},"#gs_outlet")):"INVALID_PARAM"===r.code||"INVALID_USER_ID"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),commonUtils.showHideLoadingDiv(!1),!1},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}},{mixins:["gamescope_target","gamescope"]}),Lyte.Router.registerRoute("crm.gamification.targets.index",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-target-comp.js"],ResourceConstants.CRMClient)},beforeModel:function(){store.unloadAll("points_acquired"),store.unloadAll("target")},model:function(){var e=(0!==store.peekAll("game_rule").length?Promise.resolve(store.peekAll("game_rule")):store.findAll("game_rule",{include:"point_computation"})).then((function(){return Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()}));return{targets:store.findAll("target"),teams:0!==store.peekAll("game_team").length?Promise.resolve(store.peekAll("game_team")):store.findAll("game_team"),rules:e,pointAqurired:store.findAll("points_acquired"),badges:store.findAll("game_badge")}},afterModel:function(e){var t=this.transition.data;t.prevSelectedTargetId?e.prevSelectedTargetId=t.prevSelectedTargetId:e.prevSelectedTargetId=t.selectedRuleId,void 0===this.currentModel.targets&&(this.currentModel.targets=[])},renderTemplate:function(){return{outlet:"#gs_outlet",component:this.action.getRenderComponent(),reRender:!0}},action:{getRenderComponent:function(){return store.peekAll("target").length>0?"gamescope-target-dashboard":"gamescope-target"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.targets.list",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target-list.js","gamescope-about-target.js","gamescope-about-kpi.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-target-list.css"],ResourceConstants.CRMClient))},beforeModel:function(){store.unloadAll("target"),store.findAll("points_acquired")},model:function(){return Lyte.resolvePromises({targets:store.findAll("target"),badges:store.findAll("game_badge")})},afterModel:function(e){e.ruleOptions=Lyte.registeredMixins.gamescope_list_filter_options.getRuleOptionsForTarget(),e.userOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTarget(),e.durationOptions=Lyte.registeredMixins.gamescope_list_filter_options.getDurationOptionsForTarget(),this.currentModel=e},renderTemplate:function(e){return Crm.userDetails.permissions.Crm_Implied_Manage_Motivator?{outlet:"#gs_outlet",component:this.action.getRenderComponent()}:(e.type="permissiondenied",{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},action:{getRenderComponent:function(){return store.peekAll("target").length>0?"gamescope-target-list":"gamescope-target"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.gamification.targets",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target-comp.css","gamescope-rule-dashboard-detail.css","gamescope-target-card.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-target-card.js","gamescope-target-mixins.js","gamescope-about-target.js","gamescope-about-kpi.js"],ResourceConstants.CRMClient))},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-game-rule-model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["gamescope-game-team.js"],ResourceConstants.CRMClient))},model:function(){var e=store.findAll("target"),t=0!==store.peekAll("game_rule").length?Promise.resolve(store.peekAll("game_rule")):store.findAll("game_rule"),r=0!==store.peekAll("game_team").length?Promise.resolve(store.peekAll("game_team")):store.findAll("game_team"),s=store.findAll("points_acquired");return Lyte.resolvePromises([e,t,r,s])},afterRender:function(){$L("#gs_nav_target").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.team",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-team-comp.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gamescope-team-comp.js","gamescope-about-team.js","lyte-fileupload.js","crux-lazyLoad.js","lyte-cropper.js"],ResourceConstants.CRMClient);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-team.js"],ResourceConstants.CRMClient)},model:function(){return Lyte.resolvePromises({teams:store.findAll("game_team")})},afterModel:function(e){e.teams_table=Lyte.registeredMixins.gamescope_list_filter_options.getAllTeams(),e.leadOptions=Lyte.registeredMixins.gamescope_list_filter_options.getLeadOptionsForTeam(),e.userOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTeam(),this.currentModel=e},afterRender:function(){$L("#gs_nav_team").attr("selected",!0)},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-teams",reRender:!0}},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel.index",{beforeModel:function(){store.unloadAll("tv_channels");var e=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits("TvChannel");if(!e||0===e)return Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(){var e={};return e.tv_channels=store.findAll("tv_channels"),Lyte.resolvePromises(e)},afterModel:function(e){e.tvchannels=Lyte.registeredMixins.gamescope_list_filter_options.getAllTvchannel(),e.usersOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTvchannel();var t=this.transition.data;t&&(e.selectedUser=t.selectedUser?t.selectedUser:"000"),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-tvchannel-list"}},afterRender:function(){$L("#gs_nav_tv").attr("selected",!0)},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):"NO_ACCESS"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),!1}}}),Lyte.Router.registerRoute("crm.gamification.live",{queryParams:["id","type"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-dashboard.css","gamescope-dashboard-inner-card.css","gamescope-target-card.css","gamescope-rule-card.css","gamescope-ongoinggame-card.css","gamescope-tvchannel.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-dashboard-mixins.js","gamescope-target-card.js","gamescope-dashboard-inner-card.js","gamescope-target-mixins.js","gamescope-target.js","gamescope-game-rule-model.js","gamescope-game-badge.js","gamescope-game-team.js","motivator_live_components.js","gamescope-grid.js"],ResourceConstants.CRMClient))},getDependencies:function(){return networkUtils.returnDependencyFiles(["motivator_live_components.js","gamescope-game-models.js"],ResourceConstants.CRMClient)},beforeModel:function(e){store.unloadAll("motivator_live_components");var t=e.queryParams.id;store.findRecord("motivator_preview",t,void 0,!1,!1,{id:t,type:"dashboard"});var r=e.queryParams.type;if("tvchannel"!==r&&"dashboard"!==r)return Promise.reject({response:JSON.stringify({code:"INCORRECT_URL"})});var s="tvchannel"===r?"tv_channels":"gamescope_analytics",o="tvchannel"===r?"TvChannel":"Dashboard",n=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits(o);return n&&0!==n||"tvchannel"!==r?!t||t&&0===t?Promise.reject({response:JSON.stringify({code:"INCORRECT_URL"})}):t?store.findRecord(s,t).then((e=>e&&0===Object.keys(e).length?Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND",type:r})}):e?void 0:Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND",type:r})}))):void 0:Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(e){var t=e.queryParams.id,r=e.queryParams.type;return Lyte.registeredMixins.gamescope_tvchannel.getComponentsLiveData(t,r).then((function(e){if(e.type=r,"tvchannel"===r){var s=store.peekRecord("tv_channels",t);s&&s.transition_time_in_sec&&(e.slideDuration=1e3*s.transition_time_in_sec),e.tvSlides=JSON.parse(JSON.stringify(e.tv_channel_components)),e.tvSlides&&0!==e.tvSlides.length&&e.tvSlides.push({based_on:{type:"dummy"},sequence_number:e.tvSlides[e.tvSlides.length-1].sequence_number+1}),e.tv_channel=s,e.showPreviewComp=!0,e.activeIndex=0,e.noOfSlides=e.tvSlides.length,e.isFromListView=!0,e.showPreview=!0,e.autoPlay=!0,e.tvChannelName=s.name}else{e.dashboardId=t;var o=store.peekRecord("gamescope_analytics",t);e.dashboardName=o.name,e.isFullScreenMode=!0}return e}),(function(){return Lyte.Component.registeredHelpers.gameLog("Sever error on live route"),Promise.reject({response:JSON.stringify({code:"SOMETHING_WENT_WRONG"})})}))},renderTemplate:function(e){return{outlet:"#gs_outlet",component:"tvchannel"===e.type?"gamescope-tvchannel-preview":"gamescope-dashboard"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);if("NO_PERMISSION"===r.code)commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>");else if("INCORRECT_URL"===r.code)t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"},"#gs_outlet");else if("NO_ACCESS"===r.code)t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet");else if("RESOURCE_NOT_FOUND"===r.code){t.innerHTML="";var s="tvchannel"===r.type?I18n.getMsg("gs.tv"):I18n.getMsg("gs.dashboard");Lyte.Component.render("gamescope-record-deleted",{recordName:s},"#gs_outlet")}else t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet");return!1}},afterRender:function(e){"tvchannel"===e.type?$L("#gs_nav_tv").attr("selected",!0):"dashboard"===e.type&&$L("#gs_nav_dashboard").attr("selected",!0)},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}),Lyte.Router.registerRoute("crm.gamification.tvchannel.slides",{queryParams:["id"],getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-kpi.js","gamescope-about-target.js","gamescope-about-game.js","gamescope-allkpi-table.js","gamescope-game-chart.js"],ResourceConstants.CRMClient)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-models.js"],ResourceConstants.CRMClient)},beforeModel:function(e){var t=e.queryParams.id;store.unloadAll("tv_channel_components"),store.unloadAll("motivator_live_components");var r=Lyte.registeredMixins.gamescope_config.isgsFeatureLimitExceed("TvChannel"),s=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits("TvChannel");return s&&0!==s?t?store.findRecord("tv_channels",t,void 0,void 0,void 0,{isFromThreeDot:!1}).then((e=>e&&0===Object.keys(e).length?Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}):e?e&&0===Object.keys(e).length&&r?Promise.reject({response:JSON.stringify({code:"LIMIT_EXCEED"})}):void 0:Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}))):void 0:Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(e){var t=e.queryParams.id;if(void 0!==t){var r=Promise.resolve(store.peekRecord("tv_channels",t)),s=Lyte.registeredMixins.gamescope_tvchannel.getComponentsLiveDataWithRecords(t,"tvchannel","game",!0),o=store.findAll("target"),n=store.findAll("points_acquired"),a=store.findAll("game_rule"),i=store.findAll("game_team");return Lyte.resolvePromises({tv_channel:r,target_data:o,points_data:n,rules:a,analyticsId:t,tv_channel_components:s,teams:i,role:store.findAll("role"),badges:store.findAll("game_badge")}).then((function(e){return e.tv_channel=store.peekRecord("tv_channels",t),e.isEdit=!!store.peekRecord("tv_channels",t),e.tv_channel_components=Lyte.registeredMixins.gamescope_tvchannel.combineComponents(JSON.parse(JSON.stringify(e.tv_channel_components))),e.tv_channel_components&&0!==e.tv_channel_components.length&&(e.showNextButton=!1),e.channelId=t,e.name=e.tv_channel.name,e.transitionTime=e.tv_channel.transition_time_in_sec,e}))}},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-create-tvslides"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);"NO_PERMISSION"===r.code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aiCenter dF flexDC h100vh jcCenter"> <p class="crm-font-regular crmNegativeColor crm-heading-font-size">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="crmBaseColor mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):"LIMIT_EXCEED"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"limitExceed"},"#gs_outlet")):"NO_ACCESS"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet")):"RESOURCE_NOT_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.tv")},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet"))},didTransition:function(){$L("#gs_threedotmenu")[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel",{queryParams:["id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target-card.css","gamescope-dashboard-inner-card.css","gamescope-rule-card.css","gamescope-ongoinggame-card.css","gamescope-tvchannel.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-target-card.js","gamescope-target-mixins.js","gamescope-dashboard-inner-card.js","gamescope-target.js","gamescope-game-rule-model.js","gamescope-game-team.js","motivator-create-announcement.js"],ResourceConstants.CRMClient))},afterRender:function(){$L("#gs_nav_tv").attr("selected",!0)}}),Lyte.Router.registerRoute("crm-print",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-lyte-initial.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["lyte-initial-ui-comp3.js"],ResourceConstants.CRMClient)},beforeModel:function(){userInfo&&store.pushPayload("user",userInfo.users)}}),Lyte.Router.registerRoute("crm-print.export-pdf",{}),Lyte.Router.registerRoute("crm-print.send-mail",{});
