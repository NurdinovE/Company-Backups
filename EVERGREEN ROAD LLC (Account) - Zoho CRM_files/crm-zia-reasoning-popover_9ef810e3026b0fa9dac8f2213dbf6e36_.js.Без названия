Lyte.Component.register("crm-zia-reasoning-popover",{_template:'<template tag-name="crm-zia-reasoning-popover"> <template is="if" value="{{expHandlers(expHandlers(isShowBand,\'&amp;&amp;\',zorEnabled),\'&amp;&amp;\',zorAvailable)}}"><template case="true"> <div id="zORAvailabilityDivQC" data-zcqa="zORAvailabilityDivQC" class="aligncenter p8 zORBannerQC {{if(zORViewed,\'zORViewed\',\'zORFresh\')}}"> <p id="zORAvailabilityMsgQC" class="aligncenter pR" data-zcqa="zORAvailabilityMsgQC"><span class="dIB">{{unescape(getI18nwithoutParamI18n(\'crm.zor.availableMsg\',encodeHTML(moduleSingularLabel)))}}</span><span id="{{bandIdNew}}" data-zcqa="{{bandIdNew}}" class="crmLinkColor cP pL5 dIB" onclick="{{action(&quot;showRecommendations&quot;)}}">{{getI18n(\'crm.check.now\')}}</span> <span class="ziaAssignLoader {{if(expHandlers(isFetchingSuggestion,\'!\'),\'dN\')}}"></span></p> </div> </template></template> <template is="if" value="{{expHandlers(type,\'===\',&quot;show_recommendation&quot;)}}"><template case="true"> <template is="if" value="{{expHandlers(subtype,\'!\')}}"><template case="true"> <lyte-popover lt-prop-offset="{{if(expHandlers(isQC,\'!\'),offset)}}" lt-prop-origin-elem="{{if(isQC,originElement)}}" lt-prop-type="box" lt-prop-header-padding="10px 0" lt-prop-content-padding="0" lt-prop-footer-padding="10px 20px" lt-prop-show-close-button="true" lt-prop-close-on-escape="true" lt-prop-show="{{showZORPop}}" on-scroll="{{method(&quot;hideRecommendations&quot;)}}" on-close="{{method(&quot;hideRecommendations&quot;)}}" lt-prop-wrapper-class="zORAvailableWrap" lt-prop-freeze="false" lt-prop-force-scroll="true" lt-prop-width="500px"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <lyte-tabs lt-prop-height="auto" id="zorTabs"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="pR50 pL20"> <lyte-tab-title data-zcqa="recommendedUser" lt-prop-id="recommendedUser"><lyte-text lt-prop-value="{{getI18n(&quot;crm.zor.recommender.user&quot;)}}"></lyte-text></lyte-tab-title> <template is="if" value="{{expHandlers(expHandlers(otherRecommendations,\'&amp;&amp;\',expHandlers(otherRecommendations.length,\'>\',0)),\'&amp;&amp;\',expHandlers(noOR,\'!\'))}}"><template case="true"> <lyte-tab-title data-zcqa="otherRecommendations" lt-prop-id="otherRecommendations"><lyte-text lt-prop-value="{{getI18n(&quot;crm.zor.other.recommendations&quot;)}}"></lyte-text></lyte-tab-title> </template></template> </lyte-tab-head> <lyte-tab-body> <template is="if" value="{{thresholdExpforCU}}"><template case="true"> <lyte-tab-content id="recommendedUser"> <div class="zORRecommendedUserDiv"> <div class="dIB vaM"> <img data-zcqa="zORUserPhoto" class="zORUserPhoto" alt="User Photo" src="{{if(expHandlers(recommendedOwner.user.image_link,\'!=\',null),recommendedOwner.user.image_link,getImgUrl(recommendedOwner.user.zuid))}}"> </div> <div class="dIB vaM pL10 w80_per wbBreakAll"> <lyte-text data-zcqa="recommendedOwnerName" class="crm-font-bold maxW80per" lt-prop-value="{{if(recommendedOwner.user.full_name,recommendedOwner.user.full_name,recommendedOwner.user.name)}}"></lyte-text> <p>{{getI18n(\'crm.zor.confidence\')}} {{recommendedOwner.confidence_percentage}}%</p> </div> <template is="if" value="{{expHandlers(expHandlers(originElement,\'===\',&quot;#otherRecommendationZiaIconBC&quot;),\'||\',expHandlers(originElement,\'===\',&quot;#otherRecommendationZiaIcon&quot;))}}"><template case="true"> <span data-zcqa="notifyUser" class="crmLinkColor pL40 mL3 mT7 dIB cP {{if(expHandlers(ownerAssigned,\'!\'),\'dN\')}}" onclick="{{action(\'notifyUser\')}}">{{unescape(getI18nwithoutParamI18n(\'crm.zor.use.as.owner\',encodeHTML(ownerFieldLabel)))}}</span> </template><template case="false"> <span data-zcqa="ownerFieldLabel" class="crmLinkColor pL40 mL3 mT7 dIB cP {{if(expHandlers(ownerAssigned,\'!\'),\'dN\')}}" onclick="{{action(\'setAsOwner\')}}">{{unescape(getI18nwithoutParamI18n(\'crm.zor.use.as.owner\',encodeHTML(ownerFieldLabel)))}}</span> </template></template> </div> <div class="pL20 pT20 pR20 pB10"> <span class="crm-font-bold crmHeadingColor">{{getI18n(\'crm.zor.factors.considered\')}}</span> <lyte-table lt-prop-yield="true" lt-prop-width="100%" lt-prop-border="false" class="pL10 mT5 borderNone"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <template is="for" items="{{fcGrp}}" item="row" index="i"> <lyte-tr> <lyte-td class="w200 alignRight borderNone bg_white pT5 pB5 pR10"> <lyte-text data-zcqa="{{row[0].field.field_label}}" class="fCLabel crmLabelColor crm-base-font-size" lt-prop-value="{{row[0].field.field_label}}"></lyte-text> <span data-zcqa="confPercent" class="pL20 crm-base-font-size dIB vaT">{{row[0].weightage}}%</span> </lyte-td> <template is="if" value="{{expHandlers(row[1],\'!=\',null)}}"><template case="true"> <lyte-td class="w200 borderNone bg_white alignRight pT5 pB5"> <lyte-text data-zcqa="{{row[0].field.field_label}}" class="fCLabel crmLabelColor crm-base-font-size" lt-prop-value="{{row[1].field.field_label}}"></lyte-text> <span data-zcqa="confPercent" class="pL20 crm-base-font-size dIB vaT">{{row[1].weightage}}%</span> </lyte-td> </template></template> <template is="if" value="{{expHandlers(factConLen,\'==\',1)}}"><template case="true"> <lyte-td class="w200 alignRight borderNone bg_white pT5 pB5 pR10"></lyte-td> </template></template> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </div> <div class="zrInfoBanner mT20"> <span data-zcqa="zRUsrInfo">{{getI18n("crm.zor.owner.changed.info")}}</span> </div> </lyte-tab-content> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(recommendedOwner.assignment_allowed,\'!\'),\'||\',noRec)}}"><template case="true"> <lyte-tab-content id="noRecomendation"> <div class="p15 aligncenter"> <span class="crmLabelColor">{{getI18n("crm.zor.no.recommendations")}}</span> </div> </lyte-tab-content> </template><template case="false"> <lyte-tab-content id="recommendedUser"> <div class="zORRecommendedUserDiv"> <div class="dIB vaM"> <img data-zcqa="zORUserPhoto" class="zORUserPhoto" alt="User Photo" src="{{if(expHandlers(recommendedOwner.user.image_link,\'!=\',null),recommendedOwner.user.image_link,getImgUrl(recommendedOwner.user.zuid))}}"> </div> <div class="dIB vaM pL10 w80_per wbBreakAll"> <lyte-text data-zcqa="recommendedOwnerName" class="crm-font-bold maxW80per" lt-prop-value="{{if(recommendedOwner.user.full_name,recommendedOwner.user.full_name,recommendedOwner.user.name)}}"></lyte-text> <p>{{getI18n(\'crm.zor.confidence\')}} {{recommendedOwner.confidence_percentage}}%</p> </div> <template is="if" value="{{expHandlers(expHandlers(originElement,\'===\',&quot;#otherRecommendationZiaIconBC&quot;),\'||\',expHandlers(originElement,\'===\',&quot;#otherRecommendationZiaIcon&quot;))}}"><template case="true"> <span data-zcqa="notifyUser" class="crmLinkColor pL40 mL3 mT7 dIB cP {{if(expHandlers(ownerAssigned,\'!\'),\'dN\')}}" onclick="{{action(\'notifyUser\')}}">{{unescape(getI18nwithoutParamI18n(\'crm.zor.use.as.owner\',encodeHTML(ownerFieldLabel)))}}</span> </template><template case="false"> <span data-zcqa="ownerFieldLabel" class="crmLinkColor pL40 mL3 mT7 dIB cP {{if(expHandlers(ownerAssigned,\'!\'),\'dN\')}}" onclick="{{action(\'setAsOwner\')}}">{{unescape(getI18nwithoutParamI18n(\'crm.zor.use.as.owner\',encodeHTML(ownerFieldLabel)))}}</span> </template></template> </div> <div class="pL20 pT20 pR20 pB10"> <span class="crm-font-bold crmHeadingColor">{{getI18n(\'crm.zor.factors.considered\')}}</span> <lyte-table lt-prop-yield="true" lt-prop-width="100%" lt-prop-border="false" class="pL10 mT5 borderNone"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <template is="for" items="{{fcGrp}}" item="row" index="i"> <lyte-tr> <lyte-td class="w200 alignRight borderNone bg_white pT5 pB5 pR10"> <lyte-text data-zcqa="{{row[0].field.field_label}}" class="fCLabel crmLabelColor crm-base-font-size" lt-prop-value="{{row[0].field.field_label}}"></lyte-text> <span data-zcqa="confPercent" class="pL20 crm-base-font-size dIB vaT">{{row[0].weightage}}%</span> </lyte-td> <template is="if" value="{{expHandlers(row[1],\'!=\',null)}}"><template case="true"> <lyte-td class="w200 borderNone bg_white alignRight pT5 pB5"> <lyte-text data-zcqa="{{row[0].field.field_label}}" class="fCLabel crmLabelColor crm-base-font-size" lt-prop-value="{{row[1].field.field_label}}"></lyte-text> <span data-zcqa="confPercent" class="pL20 crm-base-font-size dIB vaT">{{row[1].weightage}}%</span> </lyte-td> </template></template> <template is="if" value="{{expHandlers(factConLen,\'==\',1)}}"><template case="true"> <lyte-td class="w200 alignRight borderNone bg_white pT5 pB5 pR10"></lyte-td> </template></template> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </div> </lyte-tab-content> <template is="if" value="{{expHandlers(otherRecommendations,\'&amp;&amp;\',expHandlers(otherRecommendations.length,\'>\',0))}}"><template case="true"> <lyte-tab-content id="otherRecommendations"> <lyte-table lt-prop-yield="true" lt-prop-width="100%" lt-prop-border="false" class="mT5 pB10 w400 borderNone"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <template is="for" items="{{otherRecommendations}}" item="recommendation" index="i"> <lyte-tr> <lyte-td class="w200 alignRight borderNone bg_white pT5 pB5"> <lyte-text data-zcqa="recommendedOwnerName" class="fCLabel crmParagraphColor" lt-prop-value="{{if(recommendation.user.full_name,recommendation.user.full_name,recommendation.user.name)}}"></lyte-text> <span class="zcrm_svgIcons ziaRecInfoblack op7 vaT {{if(expHandlers(recommendation.thresholdExpired,\'!\'),\'dNImp\')}}" lt-prop-title="{{getI18n(\'crm.zor.threshold.expired\')}}"></span> </lyte-td> <lyte-td class="w200 borderNone bg_white pT5 pB5"> <lyte-text data-zcqa="confPercent">{{recommendation.confidence_percentage}}%</lyte-text> </lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </lyte-tab-content> </template></template></template></template></template></template> </lyte-tab-body> </template> </lyte-tabs> </lyte-popover-content> </template> </lyte-popover> </template><template case="false"> <lyte-popover lt-prop-offset="{{offset}}" lt-prop-origin-elem="{{if(isQC,originElement)}}" lt-prop-type="box" lt-prop-header-padding="10px 0" lt-prop-content-padding="15px" lt-prop-footer-padding="10px 20px" lt-prop-show-close-button="true" lt-prop-close-on-escape="true" lt-prop-show="{{showNotifyPop}}" on-scroll="{{method(&quot;hideNotifyPop&quot;)}}" on-close="{{method(&quot;hideNotifyPop&quot;)}}" lt-prop-wrapper-class="zORAvailableWrap" lt-prop-freeze="false" lt-prop-force-scroll="true" lt-prop-width="500px"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div data-zcqa="ziaIcon" class="mB10"> <crmutil-icon icon-name="zia-logo" icon-class="zRIcon zcicn-zia-logo crmBaseIcon" class="mT5"></crmutil-icon> <div class="dIB vaM pL10 w80_per wbBreakAll"> <lyte-text data-zcqa="recommendedOwnerName" class="crm-font-bold maxW80per" lt-prop-value="{{if(recommendedOwner.user.full_name,recommendedOwner.user.full_name,recommendedOwner.user.name)}}"></lyte-text> </div> </div> <crm-threshold-checkbox-option class="mT20" id="ziaassignowner_applyRestriction" checked="{{lbind(restriction)}}" module="{{module}}" source="entityview"></crm-threshold-checkbox-option> <lyte-checkbox id="notifyOwner" data-zcqa="notifyOwner" lt-prop-checked="{{lbind(notify)}}" lt-prop-type="default" lt-prop-label="Send Email notification"></lyte-checkbox> <div class="mT20"> <input type="button" value="Assign" onclick="{{action(\'setAsOwner\')}}" class="primarybtn" style="display: inline-block;" id="assign"></div> </lyte-popover-content> </template> </lyte-popover> </template></template> </template><template case="false"><template is="if" value="{{expHandlers(type,\'===\',&quot;show_reasoning&quot;)}}"><template case="true"> <lyte-hovercard id="showReasoningHC" lt-prop-origin-elem="{{originElement}}" lt-prop-show="{{lbind(showZORPop)}}" lt-prop-keep-alive="true" on-hovercard-hide="{{method(\'hideZORPop\')}}" lt-prop-popover-wrapper-class="showReasoningHoverCard" lt-prop-width="650px"> <template is="registerYield" yield-name="hoverCardYield"> <lyte-hovercard-content class="bg_white"> <lyte-table lt-prop-yield="true" lt-prop-width="100%" lt-prop-border="false" class="mT5 mB7 w600 borderLeftNone bR0 borderTopNone borderBottomNone borderRightNone"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <lyte-tr> <lyte-td class="bg_white pL20 borderBottomNone w250 pR0"> <div class="w280"> <div class="dIB vaM"> <img class="zORUserDetailViewPhoto" alt="User Photo" src="{{if(expHandlers(recommendedOwner.user.image_link,\'!=\',null),recommendedOwner.user.image_link,getImgUrl(recommendedOwner.user.zuid))}}"> </div> <div data-zcqa="recommendedOwnerName" class="dIB vaM pL10 w80_per wbBreakAll"> <p class="crm-font-regular"> <lyte-text id="zORUser_{{recommendedOwner.user.id}}" class="crmBaseColor" lt-prop-value="{{if(recommendedOwner.user.full_name,recommendedOwner.user.full_name,recommendedOwner.user.name)}}"></lyte-text></p> <span class="crmBaseColor crm-small-font-size pB7 dIB">{{recommendedOwner.user.role.name}}, {{recommendedOwner.user.profile.name}}</span> <p class="crm-font-regular"><span class="ziaSuggestedUserSpan crm-small-font-size dIB">{{getI18n(\'crm.assignmentRule.zia.user\')}}</span></p> </div> <div data-zcqa="recommendedOwnerEmail" class="mT15"> <span class="dIB cxEmailIcon vaM"></span> <lyte-text class="vaT mL7 w180 maxW80per" lt-prop-value="{{recommendedOwner.user.email}}"></lyte-text> </div> <div data-zcqa="recommendedOwnerMobile" class="mT10"> <span class="dIB cxMobileIcon vaM"></span> <lyte-text class="vaT mL7 w180 maxW80per" lt-prop-value="{{recommendedOwner.user.mobile}}"></lyte-text> </div> <div data-zcqa="recommendedOwnerPhone" class="mT10"> <span class="dIB cxPhoneIcon vaM"></span> <lyte-text class="vaT mL7 w180 maxW80per" lt-prop-value="{{recommendedOwner.user.phone}}"></lyte-text> </div> </div> </lyte-td> <lyte-td class="bg_white vaT br_left_border3 borderBottomNone w250 pR0"> <div class="pL10 pB10"> <span class="crm-font-bold crmHeadingColor">{{getI18n(\'crm.zor.factors.considered\')}}</span> <div class="pL10"> <lyte-table lt-prop-yield="true" lt-prop-width="100%" lt-prop-border="false" class="mT5 borderNone zrFactors"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <template is="for" items="{{fcGrp}}" item="row" index="i"> <lyte-tr> <lyte-td class="w150 alignRight borderNone bg_white pT5 pB5 pR10"> <lyte-text data-zcqa="{{row[0].field.field_label}}" class="fCLabel crmLabelColor crm-base-font-size vaT" lt-prop-value="{{row[0].field.field_label}}"></lyte-text> </lyte-td> <lyte-td class="alignRight borderNone bg_white pT5 pB5"> <span class="pL20 crm-base-font-size w60 dIB vaT">{{row[0].weightage}}%</span> </lyte-td> </lyte-tr> <template is="if" value="{{expHandlers(row[1],\'!=\',null)}}"><template case="true"> <lyte-tr> <lyte-td class="w150 borderNone bg_white alignRight pT5 pB5 pR10"> <lyte-text data-zcqa="confPercent" class="fCLabel crmLabelColor crm-base-font-size" lt-prop-value="{{row[1].field.field_label}}"></lyte-text> </lyte-td> <lyte-td class="alignRight borderNone bg_white pT5 pB5"> <span data-zcqa="confPercent" class="pL20 crm-base-font-size dIB vaT">{{row[1].weightage}}%</span> </lyte-td> </lyte-tr> </template></template> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </div> </div> </lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </lyte-hovercard-content> </template> </lyte-hovercard> </template></template></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,3]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,0]},{type:"componentDynamic",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"componentDynamic",position:[1,1,3,1]},{type:"text",position:[1,1,3,3,0]},{type:"text",position:[1,1,3,3,2]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"text",position:[1,3,1,0]},{type:"registerYield",position:[1,3,3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3,3]},{type:"text",position:[1,5,1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"componentDynamic",position:[1,1,3,1]},{type:"text",position:[1,1,3,3,0]},{type:"text",position:[1,1,3,3,2]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"text",position:[1,3,1,0]},{type:"registerYield",position:[1,3,3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"componentDynamic",position:[1,1,3,1]},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"componentDynamic",position:[1,5]},{type:"attr",position:[1,7,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1,1,1,1]},{type:"attr",position:[1,1,1,1,1,3,1,1]},{type:"componentDynamic",position:[1,1,1,1,1,3,1,1]},{type:"text",position:[1,1,1,1,1,3,3,0]},{type:"text",position:[1,1,1,1,1,3,3,2]},{type:"text",position:[1,1,1,1,1,3,5,0,0]},{type:"attr",position:[1,1,1,1,1,5,3]},{type:"componentDynamic",position:[1,1,1,1,1,5,3]},{type:"attr",position:[1,1,1,1,1,7,3]},{type:"componentDynamic",position:[1,1,1,1,1,7,3]},{type:"attr",position:[1,1,1,1,1,9,3]},{type:"componentDynamic",position:[1,1,1,1,1,9,3]},{type:"componentDynamic",position:[1,1,1,1]},{type:"text",position:[1,1,1,3,1,1,0]},{type:"registerYield",position:[1,1,1,3,1,3,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,3,1,3,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}],_observedAttributes:["showZORPop","recommendedOwner","otherRecommendations","type","fcGrp","ownerFieldLabel","moduleSingularLabel","zORViewed","originElement","originElem","zia_suggested_users","entityId","module","isShowBand","isFetchingSuggestion","zia_owner_assignment","abz_details","moduleApiName","bandIdNew","zorContributingFieldsList","ownerAssigned","fieldOfLookupVal","onSave","ajaxEditOwnerValue","subtype","restriction","notify","dataBind","thresholdExpforCU","noOR","noRec","topVal","leftVal","offset","isQC","factConLen","isAllManFieldsFilled","mandatoryField","zorFieldsVsDatatypes","isZORRequestSent","isDataChangedAfterLastRequest"],data:function(){return{showZORPop:Lyte.attr("boolean",{default:!1}),recommendedOwner:Lyte.attr("object",{default:{}}),otherRecommendations:Lyte.attr("array",{default:[]}),type:Lyte.attr("string",{default:""}),fcGrp:Lyte.attr("array",{default:[]}),ownerFieldLabel:Lyte.attr("string"),moduleSingularLabel:Lyte.attr("string"),zORViewed:Lyte.attr("boolean",{default:!1}),originElement:Lyte.attr("string",{default:"#zORAvailableChkNow"}),originElem:Lyte.attr("string",{default:"#zORAvailableChkNow"}),zia_suggested_users:Lyte.attr("object",{default:{}}),entityId:Lyte.attr("string",{default:""}),module:Lyte.attr("string",{default:""}),isShowBand:Lyte.attr("boolean",{default:!1}),isFetchingSuggestion:Lyte.attr("boolean",{default:!1}),zia_owner_assignment:Lyte.attr("string"),abz_details:Lyte.attr("object",{default:{}}),moduleApiName:Lyte.attr("string"),bandIdNew:Lyte.attr("string"),zorContributingFieldsList:Lyte.attr("string"),ownerAssigned:Lyte.attr("boolean",{default:!0}),fieldOfLookupVal:Lyte.attr("array",{default:[]}),onSave:Lyte.attr("boolean",{default:!1}),ajaxEditOwnerValue:Lyte.attr("object",{default:{}}),subtype:Lyte.attr("boolean",{default:!1}),restriction:Lyte.attr("boolean",{default:!1}),notify:Lyte.attr("boolean",{default:!1}),dataBind:Lyte.attr("object",{default:{}}),thresholdExpforCU:Lyte.attr("boolean",{default:!1}),noOR:Lyte.attr("boolean",{default:!1}),noRec:Lyte.attr("boolean",{default:!1}),topVal:Lyte.attr("string"),leftVal:Lyte.attr("string"),offset:Lyte.attr("object",{default:{}}),isQC:Lyte.attr("boolean",{default:!1}),factConLen:Lyte.attr("number"),isAllManFieldsFilled:Lyte.attr("boolean",{default:!1}),mandatoryField:Lyte.attr("string"),zorFieldsVsDatatypes:Lyte.attr("object",{default:{}}),isZORRequestSent:Lyte.attr("boolean",{default:!1}),isDataChangedAfterLastRequest:Lyte.attr("boolean",{default:!1})}},lastZorFieldsAndValue:{},zorDITimeout:void 0,dataBind:{},init:function(){var e=this.getData("topVal"),t=this.getData("leftVal");this.lastZorFieldsAndValue={},this.zorDITimeout=void 0,this.setData({isQC:"#zORAvailableChkNow"===this.data.originElem,originElement:this.data.originElem,offset:{top:e+"px",left:t+"px"},moduleApiName:this.getData("module")?Crm.moduleInfo[this.getData("module")].apiname:""})},didConnect:function(){"show_reasoning"===this.data.type&&($L("#showReasoningHC")[0].component.setData("ltPropShow",!0),this.setData("showZORPop",!0))},actions:{setAsOwner:function(e){try{if("#zORAvailableChkNowQC"===this.data.originElement||"#zORAvailableChkNowQCTask"===this.data.originElement){var t;Crm.client_tracking("Zia Owner Recommendation - Made as owner from quick create pop-up (zor pop-up)",{ModuleName:this.data.module}),"#zORAvailableChkNowQC"===this.getData("originElement")?t=$L("#"+this.getData("module")+"_fldRow_SMOWNERID crm-user-wrapper")[0]:"#zORAvailableChkNowQCTask"===this.getData("originElement")&&(t=$L("crm-user-wrapper#qownerName_select")[0]),(o=Lyte.deepCopyObject(this.getData("recommendedOwner").user)).confidence_percentage=this.data.recommendedOwner.confidence_percentage,o.is_zia_suggested_user=!0,o.fields_considered=this.data.recommendedOwner.abz_details.fields_considered,t.component.executeMethod("onSelect",e,o),this.setData({zia_owner_assignment:"assigned_by_zia",abz_details:this.data.recommendedOwner.abz_details,showZORPop:!1,zORViewed:!0,zORAvailable:!1})}else{var o=Lyte.deepCopyObject(this.getData("recommendedOwner").user),a=this.data.recommendedOwner.user.id,i=this.getData("notify"),n=moduleRecordMapping[this.data.module].fields.filter((function(e){if(e.visible&&e.view_type.view&&e.association_details&&validationUtils.isNotEmpty(e.association_details)&&"Owner"===e.association_details.lookup_field.api_name)return e}));if(n.length>0){var s={};n&&n.length&&(s.fields=n.mapByKey("association_details").mapByKey("related_field").mapByKey("api_name").join()),store.findRecord("user",o.id,s,void 0,void 0,{usersAPIversion:"v2.2"}).then(function(e){if(e&&e[0]){for(var t=e[0],o={},i=n.mapByKey("association_details"),s=n.mapByKey("association_details").length,l=0;l<s;l++){var r=i[l].related_field;o[r.id]=t[r.api_name],"object"==typeof o[r.id]&&o[r.id].id&&o[r.id].name&&(o[r.id].ID=o[r.id].id,o[r.id].Name=o[r.id].name,delete o[r.id].id,delete o[r.id].name)}fieldOfLookup.getReferFromFieldIdVsColumnName(o,n[0].association_details.lookup_field.id,a,void 0)}}.bind(this))}else networkUtils.lyteInitiateRequest("/crm/v2/"+this.data.moduleApiName+"/"+this.data.entityId+"/actions/change_owner","POST",{params:{owner_id:this.data.recommendedOwner.user.id,notify:i,zia_owner_assignment:"assigned_by_zia",related_modules_api_name:this.data.moduleApiName,related_modules_id:this.data.entityId}}).then((function(){Lyte.Router.getRouteInstance().refresh()}));detailView.ziaRecommendation={}}}catch(e){this.setData("test","test")}this.hideNotifyPop(),this.hideRecommendations()},showRecommendations:function(){Crm.client_tracking("Zia Owner Recommendation - Check Now clicked from quick create popup",{ModuleName:this.data.module}),this.executeMethod("checkAndTriggerZiaOwnerRecommendation",null,null,!0,null,!0,!0)},notifyUser:function(){this.setData({subtype:!0,showNotifyPop:!0})},hideRecommendations:function(){this.setData({showZORPop:!1,zORViewed:!0,thresholdExpforCU:!1})}},methods:{hideRecommendations:function(){this.setData({showZORPop:!1,zORViewed:!0}),this.getData("thresholdExpforCU")&&this.checkAndChangeOwner()},hideNotifyPop:function(){this.hideNotifyPop(),this.getData("thresholdExpforCU")&&this.checkAndChangeOwner()},hideZORPop:function(){$L("#showReasoningHC")[0].component.setData("ltPropShow",!1),this.setData("showZORPop",!1),this.getData("thresholdExpforCU")&&this.checkAndChangeOwner()},checkAndTriggerZiaOwnerRecommendation:function(e,t,o,a,i,n){var s=this.data.module,l=this.getData("zorFieldsVsDatatypes")?this.getData("zorFieldsVsDatatypes"):{},r=moduleRecordMapping[s].fields,p=moduleRecordMapping[s].fields.length,d=!1,c=this.getData("dataBind");t&&(c[t]=e);for(var m=this.data.mandatoryField,y=(_=m?m.length:0)>0?m.split(","):"",u=y.length,f={},h=0;h<u;h++){var g=c[y[h]];f[y[h]]=!validationUtils.isEmpty(g)}for(var w=0;w<p;w++)if("Owner"===r[w].api_name&&r[w].read_only){d=!0;break}if(this.getData("isFetchingSuggestion")||d)return;var b=Object.values(f),v=0,_=b.length;for(w=0;w<_;w++)!1===b[w]&&v++;x=this.getData("isZORRequestSent")||v<=1;let z=this.lastZorFieldsAndValue;var R=this.getData("zorContributingFieldsList"),D=(_=R.length)>0?R.split(","):"";_=D.length;if(x||o){for(w=0;w<_;w++){l[D[w]]=a,this.setData("zorFieldsVsDatatypes",l);var O=c[D[w]],x=!1;"2"===a?""!==O&&(x=!0):x=!0,null!==t&&z&&x&&(validationUtils.isEmpty(z)||z[D[w]]!==O)&&(O?z[D[w]]=O:delete z[D[w]],!0,this.setData("isDataChangedAfterLastRequest",!0))}if(!this.getData("isZORRequestSent")&&x){var L=this.getData("isAllManFieldsFilled");if(void 0!==L&&!L){var N=Object.keys(f);_=N.length;for(w=0;w<_;w++)z[N[w]]=c[N[w]];this.setData({lastZorFieldsAndValue:z,isAllManFieldsFilled:!0})}}!this.getData("isZORRequestSent")||this.getData("isDataChangedAfterLastRequest")&&i?(this.setData({isZORRequestSent:!0,isDataChangedAfterLastRequest:!1}),clearTimeout(this.zorDITimeout),this.zorDITimeout=setTimeout(function(){this.getZORFromDIAPI(n)}.bind(this),100)):n&&this.showRecommendationPop(!0)}else n&&this.showRecommendationPop(!0);this.setData("dataBind",c)}},checkAndChangeOwner:function(){var e=$L("#otherRecommendationZiaIcon")[0],t=$L("#otherRecommendationZiaIconBC")[0],o='<table id=\'ziaOwnerRecIdBC\'><tr class="tabdiv"><td></td><td><div class="ziaReasonDiv dIB cP pR15 w300" id="otherRecommendationZiaIconBC" onclick="detailView.showZiaReasoningPopover(\'otherRecommendationZiaIconBC\', '+this.data.module+", 'show_recommendation', '"+this.data.ownerFieldLabel+'\' )"> <span id="oRPopoverBC"> <crmutil-icon icon-name="zia-logo" icon-class="zcicn-zia-logo zcicn_4a8de9 mL7" class="vaM"></crmutil-icon> </span> <span id="oRPopBC"></span><lyte-text class="vaM pL5 pR12 dIB w65_per maxW80per" lt-prop-value=\''+this.data.recommendedOwner.user.name+'\'></lyte-text><lyte-text class="vaM">'+this.data.recommendedOwner.confidence_percentage+"%</lyte-text> </div></td</tr></table>",a='<div id="ziaOwnerRecId"><div class="tabdiv"><span class="labelTab columnCal1" style="width: 123.993px;"></span><div class="ziaReasonDiv dIB cP pR15 w300"id="otherRecommendationZiaIcon"onclick="detailView.showZiaReasoningPopover(\'otherRecommendationZiaIcon\', '+this.data.module+", 'show_recommendation', '"+this.data.ownerFieldLabel+'\' )"> <span id="oRPopover"> <crmutil-icon icon-name="zia-logo" icon-class="zcicn-zia-logo zcicn_4a8de9 mL7" class="vaM"></crmutil-icon> </span> <span id="oRPop"></span><lyte-text class="vaM pL5 pR12 dIB w65_per maxW80per" lt-prop-value=\''+this.data.recommendedOwner.user.name+'\'></lyte-text><lyte-text class="vaM">'+this.data.recommendedOwner.confidence_percentage+"%</lyte-text> </div></div></div>",i=$L("#historyFrame")[0],n=null;(n=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:i.document).open(),n.write(o),n.close();var s=n.getElementById("ziaOwnerRecIdBC").firstChild.firstChild,l="#header_SMOWNERID",r=$L(l)[0].parentNode;t.outerHTML="";var p=r.parentNode,d=p.rows.length,c=Array.from(p.children).indexOf(r);c>=d?p.appendChild(s.cloneNode(!0)):p.insertBefore(s.cloneNode(!0),p.children[c+1]),n.open(),n.write(a),n.close(),e.outerHTML="",s=n.getElementById("ziaOwnerRecId"),l="#value_SMOWNERID",(p=$L(l)[0].parentNode.parentNode).appendChild(s.cloneNode(!0)),this.setData("thresholdExpforCU",!1)},hideNotifyPop:function(){this.setData({subtype:!1,showZORPop:!1,showNotifyPop:!1})},getZORFromDIAPI:function(e){var t=this.getData("zorFieldsVsDatatypes"),o=this.lastZorFieldsAndValue,a=Object.keys(o);if(null!==a&&0!==a.length){var i,n="100"===t[a[0]]?"in":"equals",s=void 0===o[a[0]]?null:o[a[0]];"221"!==t[a[0]]&&"133"!==t[a[0]]||(s=o[a[0]].id?o[a[0]].id:o[a[0]]),i={field:{api_name:a[0]},comparator:n,value:s};for(var l=a.length,r=1;r<l;r++){n="100"===t[a[r]]?"in":"equals",s=void 0===o[a[r]]?null:o[a[r]],"221"!==t[a[r]]&&"133"!==t[a[r]]||(s=o[a[r]].id?o[a[r]].id:o[a[r]]),i={group:[i,{field:{api_name:a[r]},comparator:n,value:s}],group_comparator:"and"}}var p=this;p.setData("isFetchingSuggestion",!0);store.triggerAction("zia_reasoning","zia_suggested_users",void 0,{module:this.getData("moduleApiName"),record_criteria:i,include_inner_details:"user.full_name,user.email,user.role,user.profile,user.image_link,user.zuid"},"GET").then((function(t){if(void 0===t||void 0===t.zia_suggested_users)return p.setData({zorAvailable:!1,isFetchingSuggestion:!1}),void(e&&p.showRecommendationPop(!0));for(var o=!1,a=t.zia_suggested_users[0],i=JSON.parse(JSON.stringify(a.zia_suggested_users)),n=i.length,s=p.getData("restriction_enabled_for_module"),l=p.getData("zia_threshold_enabled_for_module"),r=!0,d=JSON.parse(JSON.stringify(a.fields_considered)),c=0;c<n&&r;c++){var m=i[c];if(!s&&!l)if(m.assignment_allowed){m.factors_considered=d;var y={};y.confidence_percentage=m.confidence_percentage,y.user={id:m.user.id};var u={fields_considered:d,zia_suggested_users:[y]};m.abz_details=u,Lyte.arrayUtils(i,"removeAt",c,1),o=!0,p.setData({recommendedOwner:m,otherRecommendations:i,zORViewed:!1}),r=!1}else m.thresholdExpired=!0}r&&p.setData({isShowBand:!1,zORViewed:!1});for(var f=d.length,h=[],g=0;g<f;g++){if(d[g].field)store.peekRecord("field",d[g].field.id)&&h.push(d[g])}var w=[];if((f=h.length)>0)for(g=0;g<f;g+=2){var b=[];null!==h[g].field&&(h[g].field.field_label=store.peekRecord("field",h[g].field.id).field_label,b.push(h[g]),g<f-1&&null!==h[g+1].field&&(h[g+1].field.field_label=store.peekRecord("field",h[g+1].field.id).field_label,b.push(h[g+1])),w.push(b))}for(var v,_=Lyte.deepCopyObject(a.zia_suggested_users),z=(f=_.length,[]),R=0;R<f;R++){(m=_[R]).user.is_zia_suggested_user=!0,m.user.confidence_percentage=m.confidence_percentage,m.user.fields_considered=d,z.push(m.user)}"zORAvailableChkNowQC"===p.getData("bandIdNew")?v=$L("#"+p.getData("module")+"_fldRow_SMOWNERID crm-user-wrapper")[0]:"zORAvailableChkNowQCTask"===p.getData("bandIdNew")&&(v=$L("crm-user-wrapper#qownerName_select")[0]);var D={users:z,label:"Zia Suggestion"};v.component.setData({zorAvailable:o,zorEnabled:!0,recommendedUsersList:D}),p.setData({factConLen:f,fcGrp:w,isShowBand:!0,zia_suggested_users:a,zia_owner_assignment:"owner_recommendation_available",isFetchingSuggestion:!1,originElement:"#"+p.data.bandIdNew,type:"show_recommendation",zorAvailable:o,zorEnabled:!0}),e&&p.showRecommendationPop(!0)}),(function(){p.setData({isFetchingSuggestion:!1,zorAvailable:!1}),e&&p.showRecommendationPop(!0)}))}else this.setData("zorAvailable",!1)},hideRecommendations:function(){this.setData({showZORPop:!1,zORViewed:!0,thresholdExpforCU:!1})},triggerZiaChangeOwner:function(){var e=this.getData("ajaxEditOwnerValue"),t=this.getData("notify");this.getData("onSave")&&networkUtils.lyteInitiateRequest("/crm/v2/"+this.data.moduleApiName+"/"+this.data.entityId+"/actions/change_owner","POST",{params:{owner_id:this.data.recommendedOwner.user.id,notify:t,zia_owner_assignment:"assigned_by_zia",folAjaxValue:JSON.stringify(e.folOwnerAjaxVal),related_modules_api_name:this.data.moduleApiName,related_modules_id:this.data.entityId}}).then((function(){Lyte.Router.getRouteInstance().refresh()}))}.observes("onSave")},{mixins:["crm-create-mixin"]});
