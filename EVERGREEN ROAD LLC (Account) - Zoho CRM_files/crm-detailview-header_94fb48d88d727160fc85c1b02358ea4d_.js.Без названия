Lyte.Component.register("crm-detailview-header",{_template:'<template tag-name="crm-detailview-header"> <div id="detailViewButtonLayerMainTable"></div> <div id="kiosk_output_popup" class="kiosk_output_popup"></div> <div class="dv_header_container dF {{if(isRecordSummaryAvailable,\'dv_header_container_with_summary\',\'\')}}" role="complementary" lt-prop-landmark="true" aria-label=" {{getI18n(\'crm.record.lock.actions\')}}" tabindex="-1" lt-prop-landmark-label="{{getI18n(\'crm.landmark.comp\',\'crm.record.lock.actions\')}}"> <div class="cP {{if(showBackIcon,\'\',\'hide\')}}"> <a id="backArrowDV" class="accessibility-route-elem"> <span class="dF" onclick="{{action(\'returnBack\')}}" data-zcqa="backOneLevel" role="button" lt-prop-aria-keydown="true" aria-label="{{backTooltip()}}" tabindex="0" lt-prop-title="{{backTooltip()}}" lt-prop-tooltip-config="{&quot;position&quot; : &quot;bottom&quot;}"> <crmutil-icon icon-name="arrow-back" icon-class="zcicn-arrow-back crmBaseIcon "></crmutil-icon> </span> </a> </div> <template is="if" value="{{isProfileImageAccessible}}"><template case="true"> <div class="dv_profilePhoto_cont"> <crm-detail-view-avatarupload data-zcqa="dVLyteRecordImgComp" insights="{{visionInsights}}" currmodule-name="{{module}}" record-image="{{record.Record_Image}}" entity-id="{{record.id}}" entity-name="{{entityName}}" read-only="{{header_model.isProfileImageReadOnly}}" gdpr-lock="{{record.$.stop_processing}}" approval-state="{{record.$approval_state}}" edit-restricted="{{isRecordEditRestricted}}" edit-allowed-ap="{{inApRecordImageEditAllowed}}"></crm-detail-view-avatarupload> </div> </template></template> <div class="dv_profileTitle_cont"> <div id="cpq-breadcrumb"> <template is="if" value="{{isCPQ}}"><template case="true"> <crm-cpq-breadcrumb></crm-cpq-breadcrumb> </template></template> </div> <div id="topSectionTitle" class="sectionTitle"> <span class="crm-heading-font-size dv_head_top_sec_title dIF aiCenter"> <template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'===\',\'Calls\'))}}"><template case="true"> <crmutil-icon class="mR10" icon-name="{{callicon}}" icon-class="zcicn-{{callicon}} crmBaseIcon zcicn-color-mixed"></crmutil-icon> </template><template case="false"><template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'===\',\'Tasks\'))}}"><template case="true"> <crmutil-icon class="mR10" non-lyte="true" icon-name="tasks" icon-class="zcicn-tasks crmBaseIcon "></crmutil-icon> </template><template case="false"><template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'===\',\'Events\'))}}"><template case="true"> <crmutil-icon class="{{if(record.$colour_code,\'mR4\',\'mR10\')}}" non-lyte="true" icon-name="events" icon-class="zcicn-events crmBaseIcon "></crmutil-icon> </template><template case="false"> <span class="detailActivityIcon detailActivityIcon_{{module}} mR5"></span> </template></template></template></template></template></template> <template is="if" value="{{expHandlers(expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'===\',\'Events\')),\'&amp;&amp;\',record.$colour_code)}}"><template case="true"> <span class="activitesColor w8 h8 left0 top0 pR mR3 fShrink0" data-zcqa="eventTemplecolor" style="background:{{record.$colour_code}}"></span> </template></template> <span class="dI"> <template is="for" items="{{title_card_fields}}" item="field" index="index"> <template is="if" value="{{needToShowHpen(index,title_card_fields,record,record[field.api_name])}}"><template case="true"> <span class="crm-medium-large-font-size dI vaT"> - </span> </template></template> <span id="{{field.$ids.fld_containerId}}" class="dI wbBreakWord vaT dv_header_field_wrap {{getTitleBoldClass(index)}} {{if(field.$classes.is_highlight,\'wfFieldHighlight\',\'\')}}"> <crm-detailview-fields record="{{lbind(record)}}" module="{{module}}" layout_id="{{layout_id}}" field="{{field}}" meta_info="{{meta_info}}" place="{{field_usage_area}}" cscript_properties="{{cscript_properties}}"></crm-detailview-fields> </span> <template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'==\',\'Services\'))}}"><template case="true"> <template is="if" value="{{expHandlers(record.Status,\'!==\',getI18n(\'Available\'))}}"><template case="true"> <span class="unAvailable br4 mL7 lh20 dIB" id="unAvailableSpan" data-zcqa="value_SERVICESTATUS">{{record.Status}}</span> </template></template> </template></template> <template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'==\',\'Appointments\'))}}"><template case="true"> <template is="if" value="{{expHandlers(record.Status,\'!==\',getI18n(\'Scheduled\'))}}"><template case="true"> <span class="{{if(ifEquals(record.Status,\'Completed\'),\'greenCompletedTag\',\'\')}} vaT mT2 dIB unAvailable lh20 br2" data-zcqa="value_APPOINTMENTSTATUS">{{record.Status}}</span> </template></template> </template></template> <template is="if" value="{{expHandlers(expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'==\',\'Events\')),\'&amp;&amp;\',record.Recurring_Activity)}}"><template case="true"> <div id="eventRecurInfoDiv" class="dIB vaM h19 pB4 mL5 pR"> <span class="dIB h19" lt-prop-title="{{getRecurringTooltip(record.Recurring_Activity.RRULE)}}" lt-prop-tooltip-config="{&quot;position&quot; : &quot;right&quot;, &quot;appearance&quot; : &quot;box&quot;, &quot;margin&quot;: 10}"> <crmutil-icon icon-name="repeat" icon-class="zcicn-repeat crmBaseIcon "></crmutil-icon> </span> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'==\',\'Events\')),\'&amp;&amp;\',record.$event_cancelled)}}"><template case="true"> <span class="canEvent lh14">{{getI18n(\'crm.event.status.cancel.label\')}}</span> </template></template> <template is="if" value="{{automation_config_module}}"><template case="true"> <template is="if" value="{{isPFApiRecord}}"><template case="true"> <span class="dIF aiCenter"><i class="ico-info dIB vaM orch-parent-record"></i><span class="mL5 vaM crm-small-font-size">{{getI18n("crm.pathfinder.api.record")}}</span></span> </template><template case="false"><template is="if" value="{{showReadOnlyTag}}"><template case="true"> <span class="orchROTag crm-base-font-size vaT">{{getI18n("crm.label.readonly")}}</span> </template><template case="false"> <span class="dIF aiCenter"><i class="ico-info dIB vaM orch-parent-record"></i><span class="mL5 vaM crm-small-font-size">{{getI18n("crm.orchestration.parentrecord.deleted")}}</span></span> </template></template></template></template> </template></template> <template is="if" value="{{expHandlers(module,\'&amp;&amp;\',expHandlers(module,\'==\',\'Tasks\'))}}"><template case="true"> <template is="if" value="{{recordDetails.recevent}}"><template case="true"> <div id="taskRecurInfoDiv" class="dIB pR pR20"> <span class="dIB vaM mL5 mT5" lt-prop-title="{{recordDetails.recevent}}" lt-prop-tooltip-config="{&quot;position&quot; : &quot;right&quot;, &quot;appearance&quot; : &quot;box&quot;, &quot;margin&quot;: 10}"> <crmutil-icon icon-name="repeat" icon-class="zcicn-repeat crmBaseIcon "></crmutil-icon> </span> </div> </template></template> <template is="if" value="{{isProjectTask}}"><template case="true"> <i class="task_syncIconBig vaM mB5 {{if(recordDetails.recevent,\'\',\'mL4\')}}" onmouseover="{{action(\'showToolTip\')}}" onmouseout="{{action(\'hidett\')}}"></i> </template></template> </template></template> </template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(title_card_fields.length,\'===\',0),\'&amp;&amp;\',module),\'&amp;&amp;\',expHandlers(expHandlers(module,\'===\',&quot;Calls&quot;),\'||\',expHandlers(module,\'==\',&quot;Messages&quot;)))}}"><template case="true"> <span class="crm-font-bold crm-heading-font-size">{{defaultValue}}</span> </template></template> </span> <template is="if" value="{{shared_details}}"><template case="true"> <span class="dIB"> <span id="shareDetailPage" class="sharedIntimation cP dIF mL4 pR" onclick="{{action(\'showSharedInfo\')}}" onmouseenter="{{action(&quot;showShareToolTip&quot;,true)}}" onmouseout="{{action(&quot;showShareToolTip&quot;,false)}}"> <template is="if" value="{{expHandlers(shared_details.shared_type,\'===\',\'private\')}}"><template case="true"> <crmutil-icon class="shared-icons eventNone" icon-name="usergroup-solid" icon-class="zcicn-usergroup-solid crmBaseIcon "></crmutil-icon> </template><template case="false"> <crmutil-icon class="shared-icons eventNone" icon-name="globe" icon-class="zcicn-globe zcicn16 crmBaseIcon "></crmutil-icon> </template></template> </span> <lyte-hovercard id="recordSharedTooltip" lt-prop-origin-elem="#shareDetailPage"> <template is="registerYield" yield-name="hoverCardYield"> <lyte-hovercard-content class="p15 pT7 pB7"> <template is="if" value="{{expHandlers(shared_details.shared_user_count,\'>\',0)}}"><template case="true"> <span class="crm-extra-medium-font-size crm-font-bold pB5 dB">{{getI18n(\'crm.rls.sharedBy\')}}: </span><span class="dB crm-small-font-size">{{getI18n(\'crm.listview.display.role\',shared_details.sharedUserName,shared_details.shared_user_count)}}</span> </template><template case="false"> <span class="crm-extra-medium-font-size crm-font-bold pB5 dB">{{getI18n(\'crm.rls.sharedBy\')}}: </span><span class="dB crm-small-font-size">{{shared_details.sharedUserName}}</span> </template></template> </lyte-hovercard-content> </template> </lyte-hovercard> </span> </template></template> </span> <template is="if" value="{{expHandlers(expHandlers(isProfileImageAccessible,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(expHandlers(record.$approval_state,\'===\',\'approval_process_pending\'),\'||\',expHandlers(record.$approval_state,\'===\',\'approval_process_rejected\')),\'||\',expHandlers(record.$approval_state,\'===\',\'merge_pending\')))}}"><template case="true"> <span class="approval-headerlock-container dIB vaM"><span class="pR top2 zcicn_white_mask zcicncss-waitingapproval zcicn-cssIcons"></span></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(isProfileImageAccessible,\'!\'),\'&amp;&amp;\',isRecordEditRestricted)}}"><template case="true"> <span class="approval-headerlock-container dIB vaM"><span class="ico-lock-small-fill-white svgIcons approvalheaderlockicon dIB"></span></span> </template></template></template></template> <template is="if" value="{{header_model.tag_supported_mod}}"><template case="true"> <span class="dI"> <crm-detailview-tag data-zcqa="detailViewLyteTag" tag-values-new="{{record}}" module="{{module}}" approval-state="{{record.$approval_state}}" record-locking-details="{{recordLockingDetails}}" detailview-buttons="{{detailview_buttons}}"> </crm-detailview-tag> </span> </template></template> </div> </div> <template is="if" value="{{isRecordSummaryAvailable}}"><template case="true"> <crm-zia-record-summary class="dF fShrink0 zia_record_summary flexOne jcFlextEnd mR25 wsNowrap mL8" module="{{module}}" record-id="{{record.id}}"></crm-zia-record-summary> </template></template> <div class="dv_headerButton_cont flexAlignCenter jcFlextEnd"> <template is="if" value="{{expHandlers(rpRecordDtls,\'&amp;&amp;\',expHandlers(record.$stop_processing,\'!\'))}}"><template case="true"> <crm-reviewprocess-detailview-header class="dIF aiCenter" rp-record-dtls="{{lbind(rpRecordDtls)}}" portal-user="{{portalUser}}" portal-edit="{{portalEdit}}"></crm-reviewprocess-detailview-header> </template></template> <template is="if" value="{{isDataEnrichmentAvailable}}"><template case="true"><div id="enrichDiv"></div></template></template> <template is="if" value="{{expHandlers(module,\'!=\',\'Messages\')}}"><template case="true"> <crm-detailview-actions class="flexAlignCenter jcFlextEnd ZPBListnerCls ZPBcallListener" buttons="{{detailview_buttons}}" record="{{record}}" enrich-details="{{enrich_data}}" custom-buttons="{{custom_buttons}}" rp-record-dtls="{{rpRecordDtls}}" module="{{module}}" record-id="{{record.id}}" entity-name="{{entityName}}" record-details="{{recordDetails}}" transition_data="{{transition_data}}" unique_listener_id="{{unique_listener_id}}" record-locking-details="{{recordLockingDetails}}" layout-id="{{layoutId}}" is-kiosk-assoc-limit-reached="{{isKioskAssocLimitReached}}"></crm-detailview-actions> </template></template> </div> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(record.$approved,\'!==\',undefined),\'&amp;&amp;\',expHandlers(record.$approved,\'!\')),\'||\',record.$in_merge),\'&amp;&amp;\',isRequesterDV)}}"><template case="true"> <div class="dF jcFlextEnd aiCenter flexOne"> <template is="if" value="{{isApprovalProcessRender}}"><template case="true"><crm-approvalprocess-detailview record="{{lbind(record)}}" approval_process_data="{{lbind(approval_process_data)}}" approval_state="{{approval_details.approval_state}}" show-respond-link="{{approval_details.showRespondLink}}" delegate-deactivate="{{approval_details.delegateDeactivate}}" overall_approval_config="{{approval_details.overall_approval_config}}" is-portal-user="{{approval_details.isPortalUser}}" curr-level="{{approval_details.currLevel}}" total-approver-level="{{approval_details.totalApproverLevel}}" hasresubmit-link="{{approval_details.hasresubmitLink}}" comments="{{approval_details.comments}}" this-obj="{{approval_details.thisObj}}" timeline_info="{{timeline_info}}" val="{{lbind(val)}}"> </crm-approvalprocess-detailview></template></template> </div> </template></template> <template is="if" value="{{showNavigation}}"><template case="true"> <div class="dv_recordNav_cont dF"> <span class="zcicn-arrow-line-left-md-mask zcicn-cssIcons mR12 accessibility-route-elem {{if(navigation_status.previous,\'cP\',\'disabled\')}}" id="detailPrevious" data-zcqa="dvNavPrevious" tabindex="0" aria-label="{{getI18n(&quot;crm.label.previous.record&quot;)}}" lt-prop-title="{{getI18n(&quot;crm.label.previous.record&quot;)}}" role="button" lt-prop-aria-keydown="true" data-cid="{{if(navigation_status.previous,\'NavPrevious\',\'\')}}" data-params="{{navigation_data}}"></span> <span class="zcicn-arrow-line-right-md-mask zcicn-cssIcons zcicn-rotate-180 mL12 accessibility-route-elem {{if(navigation_status.next,\'cP\',\'disabled\')}}" id="detailNext" data-zcqa="dvNavNext" tabindex="0" aria-label="{{getI18n(&quot;crm.label.next.record&quot;)}}" role="button" lt-prop-title="{{getI18n(&quot;crm.label.next.record&quot;)}}" lt-prop-aria-keydown="true" data-cid="{{if(navigation_status.next,\'NavNext\',\'\')}}" data-params="{{navigation_data}}"></span> </div> </template></template> <template is="if" value="{{moverBCard}}"><template case="true"> <lyte-popover lt-prop-origin-elem=".eid{{moverBCard}}Header" class="bCardPop" lt-prop-duration="0" lt-prop-type="callout" lt-prop-placement="right" lt-prop-freeze="false" lt-prop-wrapper-class="profile-wrapper" lt-prop-show-close-button="false" lt-prop-width="400px" lt-prop-close-on-body-click="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="bCardPopTempHeader"></div> </lyte-popover-content> </template> </lyte-popover> </template></template> </div> <lyte-event-listener event-name="detail_view_masking_listener_{{record.id}}" on-fire="{{action(\'viewMasking\')}}"> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[5]},{type:"attr",position:[5,1]},{type:"attr",position:[5,1,1,1]},{type:"componentDynamic",position:[5,1,1,1,1]},{type:"attr",position:[5,3]},{type:"if",position:[5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[5,5,1,1]},{type:"if",position:[5,5,1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5,5,3,1,1]},{type:"if",position:[5,5,3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[5,5,3,1,3]},{type:"if",position:[5,5,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background:'","record.$colour_code"]}}}}]}},default:{}},{type:"attr",position:[5,5,3,1,5,1]},{type:"for",position:[5,5,3,1,5,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[7]},{type:"if",position:[7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[9]},{type:"if",position:[9],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1,1]}]}},default:{}},{type:"attr",position:[11]},{type:"if",position:[11],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[13]},{type:"if",position:[13],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[15]},{type:"if",position:[15],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1,1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]},{type:"attr",position:[5,5,3,1,5,3]},{type:"if",position:[5,5,3,1,5,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[5,5,3,1,7]},{type:"if",position:[5,5,3,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"text",position:[2,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]},{type:"text",position:[2,0]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]}]}},default:{}},{type:"attr",position:[5,5,3,3]},{type:"if",position:[5,5,3,3],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[5,5,3,5]},{type:"if",position:[5,5,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[5,7]},{type:"if",position:[5,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5,9,1]},{type:"if",position:[5,9,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5,9,3]},{type:"if",position:[5,9,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[5,9,5]},{type:"if",position:[5,9,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5,11]},{type:"if",position:[5,11],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"componentDynamic",position:[0]}]}},default:{}}]}},default:{}},{type:"attr",position:[5,13]},{type:"if",position:[5,13],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3]}]}},default:{}},{type:"attr",position:[5,15]},{type:"if",position:[5,15],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[7]},{type:"componentDynamic",position:[7]}],_observedAttributes:["fields","showNavigation","showBackIcon","automation_config_module","showReadOnlyTag","rpRecordDtls","header_model","portalUser","portalEdit","record_num","visionInsights","cscript_properties","navigation_status","field_usage_area","isCPQ","review_process_data","reviewProcessDetails","isDataEnrichmentAvailable","isRecordEditRestricted","isPFApiRecord","recordLockingDetails","isKioskRefresh","isKioskExecution","isKioskAssocLimitReached","isApprovalProcessRender","isRecordSummaryAvailable"],data:function(){return{fields:Lyte.attr("array"),showNavigation:Lyte.attr("boolean",{default:!1}),showBackIcon:Lyte.attr("boolean",{default:!0}),automation_config_module:Lyte.attr("boolean",{default:!1}),showReadOnlyTag:Lyte.attr("boolean",{default:!1}),rpRecordDtls:Lyte.attr("object"),header_model:Lyte.attr("object"),portalUser:Lyte.attr("boolean",{default:!1}),portalEdit:Lyte.attr("boolean",{default:!1}),record_num:Lyte.attr("number"),visionInsights:Lyte.attr("array"),cscript_properties:Lyte.attr("object",{default:{}}),navigation_status:Lyte.attr("object",{default:{previous:!0,next:!0}}),field_usage_area:Lyte.attr("string",{default:"title"}),isCPQ:Lyte.attr("boolean",{default:!1}),review_process_data:Lyte.attr("object"),reviewProcessDetails:Lyte.attr("object"),isDataEnrichmentAvailable:Lyte.attr("boolean",{default:!1}),isRecordEditRestricted:Lyte.attr("boolean",{default:!1}),isPFApiRecord:Lyte.attr("boolean",{default:!1}),recordLockingDetails:Lyte.attr("object"),isKioskRefresh:Lyte.attr("boolean",{default:!1}),isKioskExecution:Lyte.attr("boolean",{default:!1}),isKioskAssocLimitReached:Lyte.attr("boolean",{default:!1}),isApprovalProcessRender:Lyte.attr("boolean",{default:!1}),isRecordSummaryAvailable:Lyte.attr("boolean",{default:!1})}},init:function(){var e=this.getData("header_model"),t=this.getData("module");if(Crm.renderDVLyteFlow(t)){var a=Lyte.Component.registeredHelpers.isRequesterTeamModule(t);this.setData("isRequesterDV",a)}("Activities"===Crm.activityGrp[t]&&!featuresAvailable.NEXTGENUI_ENABLED&&($L("#rightPanel").length>0||$L("#taskKanbanViewContainer").length>0)||"Messages"===t||a)&&this.setData("showBackIcon",!1);var i=Crm.getCrmBasePath()+"/tab/"+t;this.setData("backIconLink",i);var o=t.startsWith("Orchestration")||t.startsWith("PathFinder");if(o&&e.title_card_fields&&e.title_card_fields[0]){var s=this.getData("record");if(t.startsWith("PathFinder"))"API__Record"===s.Current_Record_Name__s?(s.Current_Record_Name__s=void 0,this.setData("isPFApiRecord",!0)):!s.Current_Record_Name__s||s.Current_Record_Name__s.name&&null!==s.Current_Record_Name__s.name||(s.Current_Record_Name__s=void 0),(returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.RECORDID&&""!==returnJson.entityMapJson.RECORDID.defaultvalue2||void 0!==s.Current_Record_Name__s&&null!==s.Current_Record_Name__s.name)&&this.setData("showReadOnlyTag",!0);else s[e.title_card_fields[0].api_name]&&this.setData("showReadOnlyTag",!0)}Crm.isCpqActivated()&&Crm.userDetails.permissions.Crm_Implied_View_CPQ_Grouped_View&&!this.data.portalUser&&moduleRecordMapping&&moduleRecordMapping[t]&&moduleRecordMapping[t].parent_module&&moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[t].parent_module.module_name===moduleRecordMapping.ZohoCPQ.module_name&&this.setData("isCPQ",!0),"Calls"===t&&(this.setData("moverBCard",!0),this.setData("callicon",this.getCallIcon()));var r=Lyte.registeredMixins["crm-detailview-parser"];if(Crm.renderDVLyteFlow(t)&&(this.setData("isProfileImageAccessible",e.isProfileImageAccessible),this.setData("navigation_data",r.formNavigationData(this.data.transition_data,t)),this.setData("record_num",this.data.transition_data.recordNum),"Tasks"===t)){var n=this.data.meta_info.fieldColumnNameMap.RECURRING[1],l=this.getData("recordDetails")?this.getData("recordDetails"):{};l.recevent=this.data.record[n]?r.getRecurringInfoForTask(this.data.record[n]):"",this.setData("recordDetails",l),this.setData("isProjectTask",this.getData("record").$in_project_sync)}this.setData("showNavigation",this.checkForNavigationStatus(this.data.transition_data,t)),this.setData("automation_config_module",o),this.setData("title_card_fields",e.title_card_fields);var d=this.getData("zia_insights");if(d&&d.hasOwnProperty("zia_insights_keys")){var c=d.zia_insights_keys.vision_data;c&&this.setData("visionInsights",c)}if(!Crm.renderDVLyteFlow(t)){if(businessCardJson.rpRecordDtls){var p=businessCardJson.rpRecordDtls;p.reasonForRejection=JSON.stringify(p.reasonForRejection),this.setData("rpRecordDtls",p)}if(businessCardJson.isClientPortalUser)this.setData("portalUser",businessCardJson.isClientPortalUser),(s=this.getData("record")).$editable&&this.setData("portalEdit",s.$editable)}this.constructReviewProcessRecordDetails();var m=this.getData("record");if(this.setData("isRecordEditRestricted",m.$locked_for_me&&!m.$editable),e.title_card_fields&&e.title_card_fields[0])var u=Lyte.Component.registeredHelpers.getFieldViewValue(e.title_card_fields[0],this.getData("record"),t,!0);this.setData("entityName",u),this.setData("cscript_masking_property",{});var g=this.getData("detailview_buttons");this.setData("isDataEnrichmentAvailable",g&&g.actions&&Array.isArray(g.actions)&&g.actions.some((e=>"enrich_data"===e.name))),featuresAvailable.ZIA_RECORD_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_Generate_Zia_Record_Summary&&this.setData("isRecordSummaryAvailable",!0)},headerModelDataobserver:function(){var e=this.getData("header_model");this.setData("title_card_fields",e.title_card_fields)}.observes("header_model"),setRecordLockDetails:function(){var e=this.getData("recordLockingDetails");let t=e&&e.hasOwnProperty("isLockedForMe")&&e.isLockedForMe&&e.hasOwnProperty("restricted_actions")&&e.restricted_actions.contains("update");this.setData("isRecordEditRestricted",t)}.observes("recordLockingDetails"),didDestroy:function(){var e=Lyte.registeredMixins["crm-multi-selection-popup-mixin"];e&&e.deletePopup(),$L(".wfRefreshInfo").length>0&&_cruxUtils.removeCustomMessage()},methods:{show_lookup_tooltip_info:function(e){if(e){var t=this.getData("record"),a=this.getData("module"),i=t[e.api_name];if(!i)return;if(!$("#"+e.$ids.valueId).find("link-to").is(":hover"))return void crmui.hideTooltip();var o={};"multi_module_lookup"===e.data_type?o.module=i.module.api_name:o.module=e.lookup.module.api_name,o.id=i.id,store.peekAll("module").forEach((function(e){e.api_name!==o.module||(o.module=e.module_name)})),setTimeout(function(){var i=$("#"+e.$ids.valueId).find("link-to");if(i.is(":hover")){if("Calls"!==a)crmui.hideTooltip(),crmLookupBusinessCard.getRecordJSon(o.module,o.id,i);else if(i.addClass("eidtrueHeader"),this.$node.querySelector(".bCardPop").ltProp("show",!0),!this.getData("bCard")){var s=this.getData("entityName"),r=s.name;this.setData("bCard",!0);var n=void 0===t.$phone_number||isCallerInfoDisabled?r:r+" ( "+t.$phone_number+" )";Lyte.Component.render("static-businesscard",{module:s.module.api_name,entityId:s.id,headerName:n,highlightedText:t.$phone_number},".bCardPopTempHeader")}}else crmui.hideTooltip()}.bind(this),500)}return!1}},didConnect:function(){this.loadApprovalProcessResources(this);var e=this.getData("rpRecordDtls");e&&Crm.renderDVLyteFlow(this.getData("rpRecordDtls").module)&&this.formatDetailViewStrip(e,this)},actions:{returnBack:function(){var e=Lyte.Router.getRouteInstance().transition.data?Lyte.Router.getRouteInstance().transition.data.needClearCache:void 0;crmHistory.backOneLevel(void 0,void 0,void 0,e)},showHeaderTooltip:function(){loadToolTip()},hideHeaderTooltip:function(){renderingUtils.zctt.hidett(!0)},showSharedInfo:function(){selectAction("viewShare")},showShareToolTip:function(e){var t=document.getElementById("recordSharedTooltip");t&&t.ltProp("show",e)},viewMasking:function(e){e.field&&e.config&&this.setPropertyForMasking(e)},showToolTip:function(){var e=I18n.getMsg("crm.schedules.prefix.in")+I18n.getMsg("crm.integ.sync.message",I18n.getMsg("crm.project.integration.title"));renderingUtils.zctt.showtt(e)},hidett:function(){renderingUtils.zctt.hidett(1)}},getCallIcon:function(){var e=this.getData("record"),t=e.Call_Type,a=e.Outgoing_Call_Status,i=t,o=a,s=this.getData("business_card");return s&&s[0]&&(s=s[0].sections[0]),s.fields.forEach((function(e){"Call_Type"===e.api_name&&e.pick_list_values.forEach((function(e){e.display_value===t&&(i=e.actual_value)})),"Outgoing_Call_Status"===e.api_name&&e.pick_list_values.forEach((function(e){e.display_value===a&&(o=e.actual_value)}))})),Lyte.Component.registeredHelpers.getCallIconClass(i,o)},checkForNavigationStatus:function(e,t){if(e?this.allowNavigation(e,t):detailView.allowNavigation()){var a=this.getData("record_num");if(a){a=parseInt(a);var i=crmNavig.customViewKey;if(i&&crmNavig[i]){var o=crmNavig[i].recordId[a-1],s=crmNavig[i].recordId[a+1];return e&&(o&&"EOA"!==o||this.setData("navigation_status.previous",!1),s&&"EOA"!==s||this.setData("navigation_status.next",!1)),!!(s&&"EOA"!==s||o&&"EOA"!==o)}}}return!1},reloadApprovalProcessContent:function(){this.loadApprovalProcessResources(this)}.observes("approval_process_data"),loadApprovalProcessResources:function(e){if((!e.data.record.$approved||e.data.record.$in_merge)&&!e.data.record.$stop_processing&&Lyte.Router.getRouteInstance().transition.isRequesterDV){var t=e.getData("approval_details");if(Lyte.Component.registeredComponents["crm-approvalprocess-detailview"])e.setData("isApprovalProcessRender",!0),this.setData({approval_state:t.approval_state,currLevel:t.currLevel,delegateDeactivate:t.delegateDeactivate,hasresubmitLink:t.hasresubmitLink,overall_approval_config:t.overall_approval_config,showRespondLink:t.showRespondLink,thisObj:t.thisObj,totalApproverLevel:t.totalApproverLevel,comments:t.comments});else{var a=[];a=(a=a.concat(networkUtils.returnDependencyFiles(["crm-approval-process.js","crm-approval-process-rejectorlistshow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],ResourceConstants.CRMClient)),Lyte.injectResources(a,void 0,(function(){e.setData("isApprovalProcessRender",!0)}))}}},reloadReviewProcessComponent:function(){this.constructReviewProcessRecordDetails()}.observes("review_process_data"),constructReviewProcessRecordDetails:function(){if(this.getData("reviewProcessDetails")){var e=this.getData("reviewProcessDetails"),t=this.getData("record");if(!t.$stop_processing&&"Approved"!==t.$review&&"Unreviewed"!==t.$review&&void 0!==t.$review){var a=this.constructRpRecordDtls(e,module);this.setData("rpRecordDtls",a)}}},constructRpRecordDtls:function(e,t){var a={};return a.rpApprFields=e.approvedCount,a.rpRejFields=e.rejectedCount,a.rpTotalFields=e.totalCount,a.reviewedCount=e.reviewedCount,a.record_status=e.record_status,a.isResubmit=e.isResubmit,a.styledisplay=e.styledisplay,a.reasonForRejection=e.reasonForRejection,a.module=t,a.rpdeleteParams=e.rpdeleteParams,a.ruleId=e.ruleId,a},handlingKioskRefreshMessagePopup:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:"<p>"+I18n.getMsg("automation.deluge.fieldUpdate.note")+"<span class='crmLinkColor cP mL5' data-zcqa='refresh_now_banner' onclick='detailView.doLyteRefresh()'>"+I18n.getMsg("crm.module.refresh.now")+"</span></p>",ltPropYield:!0,ltPropType:"warning",ltPropCloseManually:!0,ltPropClass:"wfRefreshInfo"}})}},{mixins:["crm-detailview-common-utils","crm-data-enrichment-utils","reviewprocess"]}),Lyte.Component.register("crm-detailview-actions",{_template:'<template tag-name="crm-detailview-actions"> <template is="for" items="{{topAction}}" item="action" index="index"> <template is="if" value="{{expHandlers(action.name,\'===\',\'call\')}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(pbServiceName,\'===\',&quot;ZPB&quot;),\'||\',expHandlers(pbServiceName,\'===\',&quot;CRM_TELEPHONY&quot;))}}"><template case="true"> <call-button-new record-id="{{recordId}}" display-label="{{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}}" module="{{module}}" entity-name="{{entityName}}" lt-prop-title="{{action.title}}" data-zcqa="{{action.name}}" unique_listener_id="{{unique_listener_id}}" record="{{record}}"></call-button-new> </template></template></template><template case="false"><template is="if" value="{{expHandlers(action.name,\'===\',\'associate\')}}"><template case="true"> <phone-entity class="phoneentity_{{module}}_{{recordId}}" activity-id="{{recordId}}" display-label="{{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}}" isassociate="true" defaultvalue="{{record.$phone_number}}" lt-prop-title="{{action.title}}" data-zcqa="{{action.name}}" record="{{record}}"></phone-entity> </template><template case="false"><template is="if" value="{{action.hasSubActions}}"><template case="true"> <lyte-button data-zcqa="{{action.name}}" id="dv_convertBtn" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}}&quot;}" class="lyteDropdownButton" lt-prop-appearance="default" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-tabindex="0"> <template is="registerYield" yield-name="text"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} </template> </lyte-button> <lyte-menu lt-prop-yield="true" lt-prop-event="click" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-query="#dv_convertBtn button" on-before-open="{{method(\'onBeforeShowForIndependantActionMenu\',action.name)}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{action.sub_actions}}" item="sub_action" index="index"> <lyte-menu-item data-zcqa="{{sub_action.name}}" class="{{expHandlers(convertSubActions.length,\'?:\',\'sb1\',\'\')}}" onclick="{{action(\'trigger_action\',action.name,this,event,sub_action.name)}}"> {{getDisplayLabelForAction(sub_action.display_label,sub_action.name,csript_labelMap)}} </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template><template case="false"><template is="if" value="{{action.hasClubActions}}"><template case="true"> <template is="if" value="{{expHandlers(action.hide,\'!\')}}"><template case="true"> <div class="lyteClubbedButton mR8"> <lyte-button lt-prop-class="crmButtonOtherLangLineHeight" lt-prop-appearance="{{action.bgcolor}}" lt-prop-aria-keydown="true" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}}&quot;}" data-zcqa="{{action.name}}" onclick="{{action(\'trigger_action\',action.name,this,event)}}" id="{{action.name}}" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-tabindex="0"> <template is="registerYield" yield-name="text"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} </template> </lyte-button> <lyte-button lt-prop-appearance="{{action.bgcolor}}" lt-prop-aria-keydown="true" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getI18n(&quot;crm.label.more.action&quot;)}}&quot;,&quot;aria-haspopup&quot; : &quot;listbox&quot;}" id="dv_clubbedBt_{{action.name}}" lt-prop-tabindex="0"> <template is="registerYield" yield-name="text"> </template> </lyte-button> </div> <lyte-menu lt-prop-yield="true" lt-prop-event="click" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-query="#dv_clubbedBt_{{action.name}} button" lt-prop-position="downAlignLeft" on-before-open="{{method(\'onBeforeShowForIndependantActionMenu\',action.name)}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{action.club_actions}}" item="club_action" index="index"> <lyte-menu-item data-zcqa="{{club_action.name}}" class="{{expHandlers(clubActions.length,\'?:\',\'sb1\',\'\')}}" onclick="{{action(\'trigger_action\',club_action.name,this,event)}}"> {{getDisplayLabelForAction(club_action.display_label,club_action.name,csript_labelMap)}} </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template></template></template><template case="false"> <template is="if" value="{{expHandlers(action.hide,\'!\')}}"><template case="true"> <lyte-button lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{&quot;aria-label&quot;:&quot;{{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}}&quot;}" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" id="{{if(expHandlers(action.name,\'===\',\'reject\'),\'rpBtnReject\',expHandlers(\'btn_\',\'+\',action.name))}}" class="{{if(expHandlers(expHandlers(rpRecordDtls.reviewedCount,\'===\',0),\'&amp;&amp;\',expHandlers(action.name,\'===\',\'reject\')),\'dN\',\'dIB\')}}" lt-prop-class="{{if(expHandlers(action.name,\'===\',\'launch_webinar\'),\'outlineprimary\',\'\')}}" lt-prop-appearance="{{action.bgcolor}}" data-zcqa="{{action.name}}" onclick="{{action(\'trigger_action\',action.name,this,event)}}" lt-prop-tabindex="0"> <template is="registerYield" yield-name="text"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} </template> </lyte-button> </template></template></template></template></template></template></template></template></template></template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(customButtons.length,\'>\',0),\'||\',expHandlers(module,\'==\',\'Events\')),\'||\',expHandlers(module,\'==\',\'Tasks\')),\'&amp;&amp;\',expHandlers(expHandlers(rpRecordDtls,\'!\'),\'&amp;&amp;\',expHandlers(record.$stop_processing,\'!\')))}}"><template case="true"> <crm-custom-button class="dIF aiCenter convertBtndropDown" record="{{record}}" btnid="detailPageButton" custom-buttons="{{customButtons}}" module="{{module}}" on-button-click="{{action(\'executeCustomButton\')}}" position="view" csript_disabledactions="{{csript_disabledActions}}" record-locking-details="{{recordLockingDetails}}" unique-listener-id="{{unique_listener_id}}"> </crm-custom-button> </template></template> <template is="if" value="{{expHandlers(dropAction,\'&amp;&amp;\',dropAction.length)}}"><template case="true"><lyte-button id="dv_moreBtn" data-zcqa="CustomizeTools" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{&quot;aria-label&quot;:&quot;{{getI18n(&quot;crm.nsocial.tab.more.options&quot;)}}&quot;,&quot;aria-haspopup&quot; : &quot;listbox&quot;}" lt-prop-title="{{getI18n(&quot;crm.nsocial.tab.more.options&quot;)}}" lt-prop-class="dv_moreBtn" lt-prop-tabindex="0"> <template is="registerYield" yield-name="text"> <crmutil-icon class="dF" icon-name="more-hr" icon-class="zcicn-more-hr crmBaseIcon"></crmutil-icon> </template> </lyte-button></template></template> <lyte-menu id="actionsDrpDwn" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-yield="true" lt-prop-event="click" lt-prop-query="#dv_moreBtn button" on-before-close="{{method(\'checkForMacro\')}}" on-before-open="{{method(\'ModifyMoreActions\')}}" on-close="{{method(\'blurcurrentelement\')}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body id="dv_lyte_actions_drpdown1"> <template is="for" items="{{dropAction}}" item="value" index="index"> <template is="if" value="{{expHandlers(value.hide,\'!\')}}"><template case="true"> <lyte-menu-group> <template is="forIn" object="{{value}}" value="item" key="key"> <template is="for" items="{{item}}" item="action" index="index"><template is="if" value="{{expHandlers(action.name,\'===\',&quot;run_macro&quot;)}}"><template case="true"> <lyte-menu-item lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-title="{{action.title}}" data-zcqa="{{action.name}}" onclick="{{action(\'macroclick\',compId)}}" onmouseover="{{action(\'showRunMacroMenu\')}}" onmouseout="{{action(\'hideRunMacroMenu\',event)}}" id="lyteDivMacro_cid" lt-prop-aria-keydown="true" role="menuitem" lt-prop-popup-position="left" lt-prop-query="#divMacro_cid"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} </lyte-menu-item> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(action.name,\'===\',&quot;cadences&quot;),\'&amp;&amp;\',expHandlers(isLiteuser,\'!\'))}}"><template case="true"><template is="if" value="{{expHandlers(isCustomModule(module),\'||\',expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(module,\'===\',\'Leads\'),\'||\',expHandlers(module,\'===\',\'Contacts\')),\'||\',expHandlers(module,\'===\',\'Vendors\')),\'||\',expHandlers(module,\'===\',\'Potentials\')),\'||\',expHandlers(module,\'===\',\'Accounts\')),\'||\',expHandlers(module,\'===\',\'Quotes\')))}}"><template case="true"> <lyte-menu-item id="drop_action_{{action.name}}_{{record.id}}" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-title="{{action.title}}" data-zcqa="{{action.name}}" class="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',\'sb1\',\'\')}} {{if(action.dropItemDisabled,\'disabled\',\'\')}}" data-prop="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',action,\'\')}}" onclick="{{action(\'trigger_action\',action.name,this,event)}}"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} </lyte-menu-item> </template></template></template><template case="false"><template is="if" value="{{expHandlers(action.name,\'===\',&quot;kiosk&quot;)}}"><template case="true"> <lyte-menu-item id="drop_action_{{action.name}}" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-title="{{if(isKioskAssocLimitReached,getI18n(\'crm.kiosk.detail.view.association.limit.reached.message\'),action.title)}}" data-zcqa="{{action.name}}" class="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',\'sb1\',\'\')}} {{if(action.dropItemDisabled,\'disabled\',\'\')}}" data-prop="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',action,\'\')}}" onclick="{{action(\'trigger_action\',action.name,this,event)}}"> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} <crm-ui-loaders interaction-name="crmNewReleaseLoader"></crm-ui-loaders> </lyte-menu-item> </template><template case="false"> <lyte-menu-item id="drop_action_{{action.name}}_{{record.id}}" lt-prop-disabled="{{getDisableClassForActions(action.name,csript_disabledActions)}}" lt-prop-title="{{action.title}}" data-zcqa="{{action.name}}" class="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',\'sb1\',\'\')}} {{if(action.dropItemDisabled,\'disabled\',\'\')}}" data-prop="{{expHandlers(expHandlers(action.sub_actions,\'&amp;&amp;\',action.sub_actions.length),\'?:\',action,\'\')}}" onclick="{{action(\'trigger_action\',action.name,this,event,action)}}"> <template is="if" value="{{expHandlers(action.name,\'===\',\'tasks_addTo_projects\')}}"><template case="true"> <span class="task_syncIconBig mR7 mT0"></span> </template></template> {{getDisplayLabelForAction(action.display_label,action.name,csript_labelMap)}} <template is="if" value="{{expHandlers(action.name,\'===\',\'create_client_script\')}}"><template case="true"> <div class="addDvCscriptNewTag" lt-prop-title="New"><crm-ui-loaders interaction-name="crmNewReleaseLoader"></crm-ui-loaders></div> </template></template> <template is="if" value="{{expHandlers(action.name,\'===\',&quot;lock&quot;)}}"><template case="true"> <div class="dIB mT_3" lt-prop-title="New" aria-expanded="false"> <crm-ui-loaders interaction-name="crmNewReleaseLoader"></crm-ui-loaders> </div> </template></template> </lyte-menu-item> </template></template></template></template></template></template></template>  </template></lyte-menu-group></template></template></template> </lyte-menu-body> </template> </lyte-menu> <lyte-menu lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-position="right" lt-prop-event="mouseenter" lt-prop-yield="true" lt-prop-callout="true" lt-prop-query=" .sb1" on-before-open="{{method(\'subActionButton\')}}">&gt; <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{subActions}}" item="item" index="index"> <lyte-menu-item data-zcqa="{{item.name}}" onclick="{{action(\'trigger_action\',item.name,this,event,item)}}"> {{item.display_label}} </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <lyte-alert lt-prop-wrapper-class="duplicateEntryWarnPop" lt-prop-id="duplicateEntryWarnPop" lt-prop-show="{{lbind(duplicateEntryWarnPop)}}" lt-prop-secondary-message="{{getI18n(&quot;crm.email.duplicate.approve&quot;,getModuleLabel(module))}}" lt-prop="{&quot;buttons&quot; : [{&quot;type&quot;:&quot;reject&quot;,&quot;text&quot;:&quot;Cancel&quot;,&quot;appearance&quot;:&quot;default&quot;}, {&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;Ok&quot;,&quot;appearance&quot;:&quot;primary&quot;}]}" lt-prop-top="0px" lt-prop-type="confirm" lt-prop-show-close-button="false" lt-prop-width="550px" on-accept="{{method(&quot;confirmApproval&quot;)}}"></lyte-alert> <div style="display:none;" id="projectTaskSync"></div> <crm-macro class="dN" module="{{module}}" from="detailViewLyte"> </crm-macro> <lyte-event-listener event-name="detail_view_action_listener_{{recordId}}" on-fire="{{action(\'viewAction\')}}"> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"registerYield",position:[0,1],dynamicNodes:[{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"text",position:[1,3]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,0]}]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]},{type:"attr",position:[9]},{type:"registerYield",position:[9,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[9]},{type:"attr",position:[11]},{type:"componentDynamic",position:[11]},{type:"attr",position:[15]},{type:"componentDynamic",position:[15]},{type:"attr",position:[17]},{type:"componentDynamic",position:[17]}],_observedAttributes:["buttons","dropAction","topAction","subActions","rpRecordDtls","pbServiceName","recordDetails","isLiteuser","page_uuid","duplicateEntryWarnPop","popOver","macroShow","showDm","accountIds","isKioskAssocLimitReached","isAccessibilityConfigSupported","clientAccount"],data:function(){return{buttons:Lyte.attr("object"),dropAction:Lyte.attr("array"),topAction:Lyte.attr("array"),subActions:Lyte.attr("array"),rpRecordDtls:Lyte.attr("object"),pbServiceName:Lyte.attr("string"),recordDetails:Lyte.attr("object"),isLiteuser:Lyte.attr("boolean",{default:Crm.userDetails.LITE.IS_LITE_USER}),page_uuid:Lyte.attr("string"),duplicateEntryWarnPop:Lyte.attr("boolean",{default:!1}),popOver:Lyte.attr("boolean",{default:!1}),macroShow:Lyte.attr("boolean",{default:!1}),showDm:Lyte.attr("boolean",{default:!1}),accountIds:Lyte.attr("array"),isKioskAssocLimitReached:Lyte.attr("boolean",{default:!1}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),clientAccount:Lyte.attr("boolean",{default:Crm.userDetails.CLIENT_ACCOUNT})}},actions_parser:function(){var e=this.data.module,t=[],a=[],i=[],o=(h=Object.keys(this.data.buttons).length?this.data.buttons.actions:[])?h.length:0;this.data.showPortalChange=!1;for(var s=0;s<o;s++)if("change_owner"!==h[s].name&&"tags"!==h[s].name&&"data_privacy"!==h[s].name){if(h[s].features_supported&&-1!==h[s].features_supported.indexOf("cscript")){var r=this.get_system_or_csript_name(h[s].name,e,!1);i.push({api_name:r,type:"system",name:h[s].display_label})}if("button"===h[s].type){if("resubmit"===h[s].name||"call"===h[s].name||"send_mail"===h[s].name||Crm.renderDVLyteFlow(e)&&"close_task"===h[s].name)Lyte.objectUtils(h[s],"add","bgcolor","primary");else if("delete"===h[s].name&&"review_process_rejected"===this.data.record.$approval_state){if(Lyte.objectUtils(h[s],"add","bgcolor","failure"),o-2>=0){t.splice(o-2,0,h[s]);continue}}else Lyte.objectUtils(h[s],"add","bgcolor","default");"convert"===h[s].name&&h[s].sub_actions&&null!==h[s].sub_actions&&(h[s].hasSubActions=!0),t.push(h[s])}else if("clubbed_button"===h[s].type)"Calls"===e||"send_mail"===h[s].name?Lyte.objectUtils(h[s],"add","bgcolor","primary"):Lyte.objectUtils(h[s],"add","bgcolor","default"),null!==h[s].club_actions&&h[s].club_actions.length>0&&(h[s].hasClubActions=!0),t.push(h[s]);else if("custom_buttons"===h[s].name)crmTab.isZBCustomModule(e)||crmTab.isZSCustomModule(e)?t.push(h[s]):(h[s].dropItemDisabled=this.disableDropItem(h[s].name),a.push(h[s]));else if("create_client_script"===h[s].name){if(CScriptLib){const t=Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions();if(CScript.Utils.is_cscript_available()&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()&&t.find((t=>t.name===e||t.value===e))){const e=store.peekAll("cscript").filter((e=>"module_detail"===e.definition_name&&e.selectors.Module.id===this.data.module&&e.selectors.Layout.id===this.data.layoutId)).map((e=>e.uuid));e.length>0&&"create_client_script"===h[s].name&&(this.setData("page_uuid",e[0]),h[s].display_label=I18n.getMsg("crm.canvas.cscript.managecscript"),h[s].name="manage_client_script"),h[s].dropItemDisabled=this.disableDropItem(h[s].name),a.push(h[s])}}}else{if("mark_as_sent"===h[s].name){if("CustomModule5001"===e||"CustomModule5002"===e)if(void 0!==(n=returnJson.entMetaData.status)&&"draft"!==n)continue}else if("mark_as_accepted"===h[s].name){if("CustomModule5002"===e)if((n=returnJson.entMetaData.status)&&"sent"!==n&&"declined"!==n)continue}else if("mark_as_declined"===h[s].name){if("CustomModule5002"===e)if((n=returnJson.entMetaData.status)&&"sent"!==n&&"accepted"!==n)continue}else if("mark_as_void"===h[s].name){if("CustomModule5004"===e)if((n=returnJson.entMetaData.status)&&"open"!==n)continue}else if("reopen"===h[s].name){if("CustomModule5004"===e)if((n=returnJson.entMetaData.status)&&"closed"!==n)continue}else if("convert_to_open"===h[s].name){var n;if("CustomModule5003"===e||"CustomModule5004"===e)if((n=returnJson.entMetaData.status)&&"draft"!==n)continue}else if("run_macro"===h[s].name)store.unloadAll("macro");else{if("Calls"===e&&"cadences"===h[s].name)continue;if("cadences"===h[s].name&&returnJson&&returnJson.relListLabelsJson){var l=returnJson.relListLabelsJson.relListLabelJson,d=!1;if(l.forEach((e=>{"SERIESPERSONALITY"===e.name&&(d=!0)})),!d)continue}else"portal_user_preference"===h[s].name&&(this.data.showPortalChange=!0)}h[s].dropItemDisabled=this.disableDropItem(h[s].name),a.push(h[s])}}this.setData("topAction",t);var c=[],p={},m=a.length;for(s=0;s<m;s++)p[a[s].category]||(p[a[s].category]=[]),p[a[s].category].push(a[s]);for(var u=Object.keys(p).length?Object.keys(p):[],g=Math.max.apply(null,u),y=0;y<=g;y++)p[y]&&c.push({[y]:p[y]});var v=Lyte.Component.registeredHelpers.whichPBService();c[0]&&c[0][0]&&"ZPB"!==v&&"CRM_TELEPHONY"!==v&&"Calls"===this.getData("module")&&(c[0].hide=!0),this.setData("dropAction",c),this.setData("pbServiceName",v),this.setData("csript_suportedActions",i),this.setData("csript_labelMap",{}),this.setData("csript_disabledActions",[]);var h=this.getData("buttons").actions||[];"Campaigns"===e&&Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.renderDVLyteFlow(this.data.module)&&5===this.data.record.$campaign_type&&h.some((e=>"build_survey"===e.name))&&this.setBuildSurveyActionDetails()}.observes("buttons").on("init"),get_system_or_csript_name:function(e,t,a){if(a)switch(e){case"submit_review":return"resubmit";case"reschedule":case"reschedule_call":return"reschedule";case"mark_as_completed":case"mark_as_complete":case"mark_complete":return"mark_as_completed";case"cancel":case"cancel_call":case"cancel_event":return cancel;case"mark_available":return"mark_as_available";case"mark_not_in_use":return"mark_as_notinuse";case"send_invitation":return"invitation";case"share":return"manage_share";case"share_via_chat":return"share_via_cliq";case"share_via_ciscoteams":return"share_via_cisco_webex_teams";case"find_and_merge_duplicates":return"find_and_merge";case"send_portal_invite":return"send_portal_invitation";case"customize_related_details":return"organize_related_list_details";default:return e}else switch(e){case"resubmit":return"submit_review";case"reschedule":return"Calls"===t?"reschedule_call":e;case"mark_as_completed":return"Calls"===t?"mark_as_complete":"mark_complete";case"cancel":return"Calls"===t?"cancel_call":"Events"===t?"cancel_event":e;case"mark_as_available":return"mark_available";case"mark_as_notinuse":return"mark_not_in_use";case"invitation":return"send_invitation";case"manage_share":return"share";case"share_via_cliq":return"share_via_chat";case"share_via_cisco_webex_teams":return"share_via_ciscoteams";case"share_via_google_chat":return"share_via_google_chat";case"find_and_merge":return"find_and_merge_duplicates";case"send_portal_invitation":return"send_portal_invite";case"organize_related_list_details":return"customize_related_details";default:return e}},didConnect:function(){this.setData("updateDetailViewHeaderPortalActions_listener",Lyte.addEventListener("updateDetailViewHeaderPortalActions",function(){var e=this,t=moduleApiMapping[e.data.module];store.triggerAction("entity","available_actions",{module:t,entityId:e.data.recordId}).then((function(t){var a=t.actions,i=a.findIndex((e=>"send_portal_invitation"===e.name||"portal_user_preference"===e.name)),o=e.getData("dropAction"),s=o[1][2].findIndex((e=>"send_portal_invitation"===e.name||"portal_user_preference"===e.name));-1===i?o[1][2].splice(s,1):(o[1][2][s]=a[i],a[i]&&"portal_user_preference"===a[i].name?e.data.showPortalChange=!0:a[i]&&"send_portal_invitation"===a[i].name&&(e.data.showPortalChange=!1)),e.setData("dropAction",Object.assign([],o))}))}.bind(this))),this.setData("updateDetailViewHeaderPortalUserTypeDetails_listener",Lyte.addEventListener("updateDetailViewHeaderPortalUserTypeDetails",function(e){var t=this.getData("currentParentAction"),a=this.getData("dropAction"),i=a[1][2].findIndex((e=>e.name===t.name));a[1][2][i].details.user_type=e,this.setData("dropAction",Object.assign([],a))}.bind(this))),this.rerenderTagsComp()},didDestroy:function(){Lyte.removeEventListener(this.getData("updateDetailViewHeaderPortalActions_listener")),Lyte.removeEventListener(this.getData("updateDetailViewHeaderPortalUserTypeDetails_listener"))},changeDropAction:function(){var e=this.getData("pbServiceName"),t=this.getData("module");if(this.data.dropAction&&"Calls"===t&&this.getData("dropAction")[0][0]){var a="ZPB"===e||"CRM_TELEPHONY"===e;void 0!==this.data.callBtRendered&&(a=a&&this.data.callBtRendered);var i=this.data.topAction.findIndex((function(e){return"clubbed_button"===e.type||"mark_as_completed"===e.name}));Lyte.objectUtils(this.getData("topAction")[i],"add","hide",a),Lyte.objectUtils(this.getData("dropAction")[0],"add","hide",!a)}}.observes("pbServiceName","callBtRendered"),changeDMButtonAction:function(){if(this.getData("showDm"))for(var e=this.getData("topAction"),t=e.length,a=0;a<t;a++)"button"!==e[a].type||"send_mail"!==e[a].name?"clubbed_button"!==e[a].type||"send_mail"!==e[a].name||Lyte.objectUtils(this.getData("topAction")[a],"add","hide",!1):Lyte.objectUtils(this.getData("topAction")[a],"add","hide",!0)}.observes("showDm"),actions:{trigger_action:async function(e,t,a,i){if(-1===this.getData("csript_disabledActions").indexOf(e))switch(e){case"cadences":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].addSeries(this.data.module):crmRelatedList.addSeries(this.data.module);break;case"kiosk":if(this.getData("isKioskAssocLimitReached"))return;var o=Crm.renderDVLyteFlow(this.data.module)?moduleRecordMapping[this.data.module].id:returnJson.tabId,s=Crm.renderDVLyteFlow(this.data.module)?this.data.layoutId:returnJson.layout_jsonarrayObj.currLayoutId,r=networkUtils.returnDependencyFiles(["kiosk-execute.js"],ResourceConstants.CRMClient);Lyte.injectResources(r,void 0,function(){Lyte.registeredMixins.kiosk_execute.addKiosk(moduleRecordMapping[this.data.module],o,s,this)}.bind(this));break;case"reject":Crm.renderDVLyteFlow(this.getData("rpRecordDtls").module)?this.RPrejectBtn(this,moduleRecordMapping[this.data.module].api_name,this.data.recordId):detailView.RPrejectBtn(this,moduleRecordMapping[this.data.module].api_name,this.data.recordId);break;case"resubmit":this.RPResubmitBtn(this,moduleRecordMapping[this.data.module].api_name,this.data.recordId);break;case"review_history":Lyte.registeredMixins["crm-detailcanvas-utils"].showHistory(this,moduleRecordMapping[this.data.module].api_name,this.data.recordId);break;case"send_mail":crmTab.isZBCustomModule(this.data.module)?ZInvoice.emailZBCustommodule(this.data.module,returnJson.entMetaData.zbPKID):(EmailComposeUtil.sendMailButtonCalled=!0,EntSendMail(this.data.module,this.data.recordId,"",moduleRecordMapping[this.data.module].singular_label));break;case"send_dm":var n,l=networkUtils.returnDependencyFiles(["crm-social-direct-message.js","social_related_list_store.js","crm-social-common.js","crm-social-common-models.js","crm-social-helper.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["crm-social-common.css"],ResourceConstants.CRMClient));if(Crm.userDetails.RTL_ENABLED){var c=networkUtils.returnDependencyFiles(["crm-social-common-rtl.css","crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);n=l.concat(d).concat(c)}else n=l.concat(d);Lyte.injectResources(n,void 0,(function(){var e=$L("crm-detailview-actions")[0].component;Lyte.registeredMixins["crm-social-integration"].showSendDm(e.data.accountIds)}));break;case"mail_contact":if(Crm.renderDVLyteFlow(this.data.module)){Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton("sendMail",this.data.module,this.data.record.id,moduleRecordMapping[this.data.module].singular_label,this.data.record,"ContactMailList");break}mailoption("ContactMailList");break;case"mail_vendor":if(Crm.renderDVLyteFlow(this.data.module)){Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton("sendMail",this.data.module,this.data.record.id,moduleRecordMapping[this.data.module].singular_label,this.data.record,"VendorMailList");break}mailoption("VendorMailList");break;case"send_mail_related_mod":if("Calls"===this.data.module){var p,m;(L=store.peekRecord(moduleRecordMapping[this.data.module].id,this.data.recordId)).Who_Id?(p=L.Who_Id.id,m="Contacts"):L.What_Id&&(p=L.What_Id.id,m=L.$se_module),EntSendMail(m,p,"",moduleRecordMapping[m].singular_label,"","","","",this.data.module);break}if(this.disableDropItem(e)||"PurchaseOrders"===this.data.module)break;if(Crm.renderDVLyteFlow(this.data.module)){Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton("sendMail",this.data.module,this.data.record.id,moduleRecordMapping[this.data.module].singular_label,this.data.record);break}showSendMail();break;case"mail_merge":(u={}).module=this.data.module,u.id=this.data.record.id,selectAction("MailMerge",void 0,void 0,void 0,void 0,void 0,u);break;case"customize_business_card":if(Crm.userDetails.CUSTOMIZE_BUSINESSCARD_POPUP_LYTE||Crm.renderDVLyteFlow(this.data.module)){var u={};let e=this.data.module,t=this.data.record.id,a=store.peekRecord(moduleRecordMapping[e].id,t),i=store.peekRecord("module",moduleRecordMapping[e].id);a.$layout_id?u.layoutId=a.$layout_id.id:a.Layout?u.layoutId=a.Layout.id:u.layoutId=i.layouts[0].id,u.module=e,u.showModal=!0,u.recordId=t,commonUtils.showHideLoadingDiv(!0),store.findRecord("layout",u.layoutId,{module:moduleRecordMapping[e].api_name,mode:"all"},!1,!0,{apiVersion:"2.2",showHiddenLayouts:!0}).then((function(e){var t=$L("crm-customize-businesscard-popup");if(u.layoutDetails=e[0],0===t.length){var a=[];a.push(networkUtils.returnDependencyFiles(["crm-customize-businesscard.js","crux-column-list.js"],ResourceConstants.CRMClient)),a.push(networkUtils.returnDependencyFiles(["crm-customize-businesscard-styles.css","crux-column-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),a.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")],ResourceConstants.CRM)),Lyte.injectResources(a,void 0,(function(){Lyte.Component.render("crm-customize-businesscard-popup",u,"body")}))}else t[0].setData(u);commonUtils.showHideLoadingDiv(!1)}),(function(){commonUtils.showHideLoadingDiv(!1)}))}else{this.data.transition_data&&((u={}).module=this.data.module,u.id=this.data.record.id,u.cvid=this.data.transition_data.cvid?this.data.transition_data.cvid:"null",u.recordNum=this.data.transition_data.recordNum?this.data.transition_data.recordNum:"null"),showCustomizeBusinessCardPopup("SummaryView",this.data.module,u)}break;case"organize_related_list_details":this.data.transition_data&&((u={}).module=this.data.module,u.id=this.data.record.id,u.cvid=this.data.transition_data.cvid?this.data.transition_data.cvid:"null",u.recordNum=this.data.transition_data.recordNum?this.data.transition_data.recordNum:"null"),showCustomizePopup("RelatedList",this.data.module,void 0,void 0,void 0,void 0,void 0,void 0,void 0,u);break;case"close_task":var g=this.data.record.Owner.id!==Crm.userDetails.USER_ID;crmTasks.showMarkAsCompletedPopup(!0,g);break;case"edit":if(Lyte.registeredMixins["crm-entity-utils"].trackRecordEditSaveData(e),"Calls"===this.data.module){(u={from:"detailView",module:"Calls",calleeObj:"Crm",clickId:"editbtn"}).id=this.data.recordId,Crm.editEntity(a,t,u);break}if("Events"===this.data.module){(u={from:"detailView",module:"Events",calleeObj:"Crm",clickId:"editbtn"}).id=this.data.recordId,Crm.editEntity(a,t,u);break}if("Appointments"===this.data.module){(u={from:"detailView",module:"Appointments",calleeObj:"Crm",clickId:"editbtn"}).id=this.data.recordId,Crm.editEntity(a,t,u);break}var y={},v=this.data.record;v&&v.Layout&&v.Layout.id&&(y.layoutId=v.Layout.id),v&&v.Wizard&&v.Wizard.id&&("draft"===v.$state&&(y.state=v.$state),"edit"===e&&(y.wizardId=v.Wizard.id)),(0===Object.keys(y).length?Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[this.data.module,this.data.recordId]}):Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[this.data.module,this.data.recordId],queryParams:y})).data={reqFrom:"detailView"};break;case"convert":if("Leads"===this.data.module)Crm.linkToClick("crm.tab.module.entity.convert",this.data.module,this.data.recordId,{showPortalChange:this.data.showPortalChange});else if(crmTab.isZBCustomModule(this.data.module))switch(i){case"convertToInvoices":ZInvoice.convertToInvoice(this.data.module,this.data.recordId,returnJson.entMetaData.zbPKID);break;case"convertToSalesOrders":ZInvoice.convertToSO(returnJson.entMetaData.status,this.data.recordId,returnJson.entMetaData.zbPKID);break;case"convertToPurchaseOrders":ZInvoice.convertToPO(this.data.recordId,returnJson.entMetaData.zbPKID)}else{var h;h="convertToSalesOrders"===i?"SalesOrders":"Invoices",productDetails.convertQuote(this.data.module,h,this.data.recordId,this)}break;case"clone":if("Appointments"===this.data.module){(u={from:"detailView",module:"Appointments",calleeObj:"Crm",clickId:"clonebtn"}).id=this.data.recordId,Crm.cloneEntity(a,t,u);break}if("Events"===this.data.module){(u={from:"detailView",module:"Events",calleeObj:"Crm",clickId:"clonebtn",invitees:this.data.record.Participants}).id=this.data.recordId,Crm.cloneEntity(a,t,u);break}if(crmTab.isZBCustomModule(this.data.module)){ZInvoice.cloneZBTxns(this.data.module,this.data.recordId,returnJson.entMetaData.zbPKID);break}Crm.linkToClick("crm.tab.module.entity.clone",this.data.module,this.data.recordId,Crm.renderDVLyteFlow(this.data.module)?{reqFrom:"detailView"}:void 0);break;case"manage_share":(u={}).module=this.data.module,u.id=this.data.record.id,selectAction("manageShare",void 0,void 0,void 0,void 0,void 0,u);break;case"delete1":this.deleteRecord(a,t);break;case"delete":if("Campaigns"===(M=this.getData("module"))||"Tasks"===M&&!Crm.renderDVLyteFlow(M)){this.deleteRecord(a,t);break}var _=this.getData("recordId");if((L=this.getData("record")).$||(L=store.peekRecord(moduleRecordMapping[this.data.module].id,_)),L&&L.$.isUnloaded&&(L.$.isUnloaded=!1,store.createRecord(moduleRecordMapping[M].id,L),(L=store.peekRecord(moduleRecordMapping[M].id,_)).$.isNew=!1),!Crm.userDetails.permissions["Crm_Implied_Delete_"+M])return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();if("Accounts"!==M&&"Contacts"!==M||!moduleRecordMapping[M].zb_custommodule_enabled){if(Crm.userDetails.CLIENT_TYPE===M&&Crm.userDetails.CLIENT_ID===_)return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();var f=2;"Tasks"===M&&L.$u_id&&(f=4),"Events"===M&&L.Recurring_Activity&&(f=5),Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(L,f,M,null,null,null,!0,"detail_view")}else{var b=[_],D=moduleRecordMapping[M].singular_label;ZInvoice.fetchAssociatedIds(M,b,(function(e){if(e.length>0){var t=[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"default"}],a=I18n.getMsg("crm.cannot.delete.account.contact.header",D),i=I18n.getMsg("crm.cannot.delete.account.contact.singular",D.toLowerCase()),o=$L("#detailViewUtilAlert"),s={ltPropHeading:"",ltPropPrimaryMessage:a,ltPropTop:"0px",ltPropSecondaryMessage:i,ltPropButtons:t,id:"detailViewUtilAlert",ltpropWrapperClass:"dv_Alert",ltPropShowCloseButton:!1};0===o.length?o.push(Lyte.Component.render("lyte-alert",s,"body")):o[0].setData(s),o[0].ltProp("show",!0)}else Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(L,2,M,null,null,null,!0,"detail_view")}))}break;case"find_and_merge":Crm.linkToClick("crm.tab.module.entity.find-and-merge",this.data.module,this.data.recordId);break;case"send_portal_invitation":CPMF.getClientPortalProfilesRelatedToPersonalityModule(this.data.module,this.data.recordId,"invite",void 0,this.getData("unique_listener_id"));break;case"share_via_cliq":case"share_via_slack":case"share_via_cisco_webex_teams":case"share_via_microsoft_teams":var I={share_via_cliq:"cliq",share_via_slack:"slack",share_via_cisco_webex_teams:"cisco",share_via_microsoft_teams:"microsoft_teams",share_via_google_chat:"google_chat"};Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(I[e],this.data.module,this.data.recordId);break;case"share_via_google_chat":I={share_via_cliq:"cliq",share_via_slack:"slack",share_via_cisco_webex_teams:"cisco",share_via_google_chat:"google_chat"};Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(I[e],this.data.module,this.data.recordId);break;case"approve":this.webRecordApproval(this.data.module,this.data.recordId);break;case"custom_buttons":CustomButtonJSObjectInit.createCustBtnPage(this.getData("module"),"view");break;case"add_related_list":CustomRelatedListObj.addNewRelatedList({module:this.getData("module")});break;case"change_user_type":CPMF.getPortalUserTypesForTransfer(this.data.module,this.data.recordId,"transfer",void 0,this.getData("currentParentAction").details.user_type.id,this.getData("unique_listener_id"));break;case"deactivate_customer":this.togglePortalUserStatus(this,i,"deactivate");break;case"activate_customer":this.togglePortalUserStatus(this,i,"activate");break;case"resend_portal_invitation":CPMF.getClientPortalProfilesRelatedToPersonalityModule(this.data.module,this.data.recordId,"reinvite",this.getData("currentParentAction").details.user_type.id);break;case"remove_portal_access":CPMF.removePortalUser(this.getData("currentParentAction").details.user_type.id,this.data.recordId,this.getData("unique_listener_id"));break;case"print_preview":openPrintTemplatePop(this.data.recordId,this.data.module);break;case"print":crmTab.isZBCustomModule(this.data.module)&&ZInvoice.zbCustommodulePrintPDF(this.data.module,returnJson.entMetaData.zbPKID,returnJson.entMetaData.zbEntityNumber);break;case"enrich_data":Lyte.registeredMixins["enrichment-utils"].CheckTriggerData("detail",this.getData("record"),this.getData("module"),null);break;case"export_to_pdf":exportPDF(this.data.module,this.data.recordId);break;case"export_as_pdf":crmTab.isZBCustomModule(this.data.module)&&ZInvoice.zbCustommoduleExportAsPDF(this.data.module,returnJson.entMetaData.zbPKID,returnJson.entMetaData.zbEntityNumber);break;case"mark_as_completed":"Calls"===this.data.module&&Crm.fetchCallDetails("Completed",this.data.recordId,"detailView"),"Appointments"===this.data.module&&(Crm.renderDVLyteFlow(this.data.module)?this.markascompletedAppointment("Appointment",t,this.data.record,"detailView",this.data.recordId,this.getData("unique_listener_id")):this.setAppointmentStatus("Appointments",t));break;case"reschedule":"Calls"===this.data.module&&Crm.fetchCallDetails("Scheduled",this.data.recordId,"detailView"),"Appointments"===this.data.module&&this.setAppointmentStatus("Appointments",t,this.data.recordId,this.data.record.Service_Name.id);break;case"cancel":"Calls"===this.data.module&&Crm.fetchCallDetails("Cancelled",this.data.recordId,"detailView"),"Appointments"===this.data.module&&this.setAppointmentStatus("Appointments",t,this.data.recordId),"Events"===this.data.module&&Events.cancelEvent(this.data.recordId);break;case"add_job_sheet":var C=Crm.renderDVLyteFlow(this.data.module)?this.data.record.Job_Sheet_Section__s:this.data.recordDetails.sectionName;Lyte.registeredMixins["crm-appointments-mixin"].showAppointmentSectionPopup(this.data.recordId,C,"detailView",void 0,"edit",void 0);break;case"mark_as_temporarily_unavail":case"manage_unavailability":case"mark_as_notinuse":Crm.renderDVLyteFlow(this.data.module)?this.renderServiceAvailabilityPopup(this.data.recordId,e,this.getData("unique_listener_id")):this.showServiceAvailabilityPopupMenu(this.data.recordId,e);break;case"mark_as_available":Crm.renderDVLyteFlow(this.data.module)?this.submitServiceStatusMark(this.data.recordId,"Available",void 0,this.getData("unique_listener_id")):this.oldSubmitServiceStatusMark(this.data.recordId,"Available");break;case"build_survey":Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.renderDVLyteFlow(this.data.module)?networkUtils.openUrl(this.data.survey_editor_url,"blank"):Lyte.injectResources([networkUtils.returnDependencyFiles(["zsurvey_home-min.js"],ResourceConstants.CRM)],void 0,void 0).then((function(){ZSurvey.openSurveyBuilder()}));break;case"follow":case"unfollow":if(Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.renderDVLyteFlow(this.data.module)){var w=$L("crm-follower")[0].component;w.methods.toggleFollowup(this,this.data.module,this.data.recordId,e,w)}else toggleFollowup(this,e);break;case"skyeye_business_information":openBusinessInfoPopup(this.data.record.$skyeye_account_id);break;case"meet_now":if(null===i.sub_actions){let e={};e.name=i.toolName;let t={record_module:this.data.module,id:this.data.recordId,name:this.data.entityName};Lyte.registeredMixins["crm-detail-view-utils"].startCrmMeeting(e,t)}break;case"tasks_addTo_projects":this.openProjectTaskSyncModel();break;case"schedule_online_meeting":let T={record_module:this.data.module,id:this.data.recordId,name:this.data.entityName};Lyte.registeredMixins["crm-detail-view-utils"].scheduleOnlineMeeting(this.data.recordId,this.data.module,T);break;case"mark_as_sent":"CustomModule5001"!==this.data.module&&"CustomModule5002"!==this.data.module||ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,1,this.data.recordId);break;case"mark_as_accepted":"CustomModule5002"===this.data.module&&ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,2,this.data.recordId);break;case"mark_as_declined":"CustomModule5002"===this.data.module&&ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,3,this.data.recordId);break;case"mark_as_void":"CustomModule5004"===this.data.module&&ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,8,this.data.recordId);break;case"reopen":"CustomModule5004"===this.data.module&&ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,7,this.data.recordId);break;case"convert_to_open":"CustomModule5003"!==this.data.module&&"CustomModule5004"!==this.data.module||ZInvoice.zbChangeStatus(this.data.module,returnJson.entMetaData.zbPKID,4,this.data.recordId);break;case"launch_webinar":var L,R=(L=this.getData("record")).Native__Webinar__Extn__Webinar_Launch_URL;sE(a),networkUtils.openUrl(R,"_blank"),Crm.trackSpotLightAction("Zoho Webinar - Launch Webinar Click");break;case"create_poll":Lyte.triggerEvent("triggerCreatePoll");break;case"lock":if(Crm.renderDVLyteFlow(this.data.module)){var k=networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.js"],ResourceConstants.CRMClient);k=k.concat(networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var M=this.data.module,x=this.data.recordId;Lyte.injectResources(k,void 0,(function(){var e=$L("crm-detail-view-locking-details")[0].component;e.actions.showRecordLockingPopup(M,x,!1,void 0,e)}))}else detailView.showRecordLockingPopup(this.data.module,this.data.recordId);break;case"create_client_script":Lyte.registeredMixins["crm-cscript-global-mixin"].render_create_popup(void 0,this);break;case"manage_client_script":if(CScriptLib&&"undefined"!=typeof _cscript&&_cscript&&_cscript._is_preview_frame)return void _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("dxeditorpreview.settings.notsupported"),ltPropType:"error",ltPropDuration:"4000"}});var A=$L("crm-cscript")[0];A&&A.component.setData({cscriptTagShow:!1,available:CScript.Utils.is_cscript_available(),cscriptPaneShow:!0,page_uuid:this.getData("page_uuid")});break;case"export_event":Lyte.registeredMixins["crm-events-mixin"].exportEvent(this.data.recordId,this.$node,this.data.record.Event_Title);break;case"invitation":Events.SendMailToParticipant(this.data.recordId,"0");break;case"send_recordings":Events.sharedRecorded(this.data.recordId);break;case"start_meeting":Lyte.registeredMixins["crm-events-mixin"].startMeeting("Detail View",this.data.recordId);break;case"join_meeting":var N=this.data.record.$meeting_details.joinmeeting_url;networkUtils.openUrl(N);break;default:if("provider"===i.toolType){let e={record_module:this.data.module,id:this.data.recordId,name:this.data.entityName};Lyte.registeredMixins["crm-detail-view-utils"].startCrmMeeting(i,e)}}},executeCustomButton:function(e){if("Tasks"==this.getData("module")){let t=$L("crm-custom-button"),a=t&&t.length&&t[0].component.data||{},i=a.contactModCustomButtons,o=a.seModCustomButtons,s=a.customButtons;if(s&&s.filter((t=>t.id==e)).length>0)CustomButtonJSObjectInit.execute(e,"viewEntity",this.getData("recordId"),"",this.getData("module"));else if(i&&i.filter((t=>t.id==e)).length>0){let t=this.getData("record");t&&t.Who_Id&&t.Who_Id.id&&CustomButtonJSObjectInit.execute(e,"viewEntity",t.Who_Id.id,"","Contacts")}else if(o&&o.filter((t=>t.id==e)).length>0){let t=this.getData("record");t&&t.What_Id&&t.What_Id.id&&CustomButtonJSObjectInit.execute(e,"viewEntity",t.What_Id.id,"",t.$se_module)}}else CustomButtonJSObjectInit.execute(e,"viewEntity",this.getData("recordId"),"",this.getData("module"))},showRunMacroMenu:function(){var e=$L("#actionsDrpDwn")[0];e&&e.component.setData("ltPropFreeze",!1);var t=document.getElementById("divMacro_cid");if(t)t.ltProp("show",!0);else{var a=$L("crm-macro")[0];a.component.setData("showPopOver",!0),a.component.setData("placement","left"),a.component.setData("originElem","#lyteDivMacro_"),a.component.setData("compId","cid"),a.component.setData("width","225px")}},hideRunMacroMenu:function(e){e.relatedTarget.parentElement.className.includes("macro")||e.relatedTarget.className.includes("macro")||e.relatedTarget.className.includes("Macro")?this.popOver=!0:($L("crm-macro")[0].component.setData("showPopOver",!1),document.getElementById("divMacro_cid").ltProp("show",!1),this.popOver=!1)},macroclick:function(){$L("crm-macro")[0].component.setData("moreClickTrack",!0),this.macroShow=!0,$L("#macroSearchBox")[0]&&$L("#macroSearchBox lyte-input").focus()},viewAction:function(e){if(e){var t=this.getData("csript_disabledActions");t=objectUtils.cloneObject_new(t),e.id&&(e.apiName=e.id),e.apiName=this.get_system_or_csript_name(e.apiName,this.data.module,!0);var a=t.indexOf(e.apiName);if("disable"===e.type&&-1===a)t.push(e.apiName),this.setData("csript_disabledActions",t);else if("enable"===e.type&&-1!==a)t.splice(a,1),this.setData("csript_disabledActions",t);else if("set_newaction_label"===e.type){var i=this.getData("csript_labelMap");(i=objectUtils.cloneObject_new(i))[e.apiName]=e.new_label,this.setData("csript_labelMap",i)}}}},deleteRecord:function(e,t){document.querySelector("#actionsDrpDwn").ltProp("show",!1);var a={from:"detailView",delopt:this.data.recordDetails?this.data.recordDetails.delOpt:void 0};a.module=this.data.module,a.id=this.data.recordId,a.entityName=this.data.entityName,a.calleeObj="Crm",a.clickId="deleteEntity",Crm.deleteEntity(e,t,a)},methods:{onBeforeShowForIndependantActionMenu:function(e){return-1===this.getData("csript_disabledActions").indexOf(e)},ModifyMoreActions:function(){let e=this,t=e.getData("dropAction");if(CScriptLib){const a=Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions();if(CScript.Utils.is_cscript_available()&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()&&a.find((t=>t.name===e.getData("module")||t.value===e.getData("module"))))for(const a in t){const i=t[a];for(const t in i){const o=i[t];for(const i in o){const s=o[i];_cscript._info&&"create_client_script"===s.name?(e.setData("page_uuid",_cscript._info.uuid),s.display_label=I18n.getMsg("crm.canvas.cscript.managecscript"),s.name="manage_client_script",Lyte.arrayUtils(e.getData("dropAction")[a][t],"replaceAt",i,s)):_cscript._info||"manage_client_script"!==s.name||(e.setData("page_uuid",void 0),s.display_label=I18n.getMsg("com.cscript.createclientscript"),s.name="create_client_script",Lyte.arrayUtils(e.getData("dropAction")[a][t],"replaceAt",i,s))}}}}},blurcurrentelement:function(){document.activeElement.blur()},subActionButton:function(e,t,a){var i=JSON.parse(a.dataset.prop);this.setData("subActions",i.sub_actions),this.setData("currentParentAction",i)},confirmApproval:function(){this.confirmApproval(this.data.module,this.data.recordId)},checkForMacro:function(e,t){var a=$L("#divMacro_cid")[0],i=$L("#actionsDrpDwn")[0],o=!1;if(t&&t.target){var s=t.target.parentElement,r=s?s.parentElement:void 0;o=t.target.className.includes("macro")||s&&s.className.includes("macro")||r&&r.className.includes("macro")}if(a){var n=!1,l=$L("#macroSearchBox .macroSearchInput")[0];return l&&(n=l.classList.contains("lyteInputFocus")),n||this.macroShow||o?(this.macroShow=!1,!1):($L("crm-macro")[0].component.setData("showPopOver",!1),i.component.setData("ltPropFreeze",!0),!0)}return i.component.setData("ltPropFreeze",!0),!0}},webRecordApproval:function(e,t){var a=store.peekRecord(Crm.moduleInfo[e].Id,t);!(!a.$approved&a.$is_duplicate)?this.confirmApproval(e,t):this.setData("duplicateEntryWarnPop",!0)},confirmApproval:function(e,t){var a=store.peekRecord(Crm.moduleInfo[e].Id,t),i=Crm.getCrmBasePath()+"/ConfirmApproval.do";"Contacts"===e?i=Crm.getCrmBasePath()+"/ConfirmContactApproval.do":"Cases"===e?i=Crm.getCrmBasePath()+"/ConfirmCaseApproval.do":-1!==e.indexOf("CustomModule")&&(i=Crm.getCrmBasePath()+"/WebRecordConfirmApproval.do"),networkUtils.lyteInitiateRequest(i,"POST",{params:{idlist:a.id,approvalModule:e,formdetailView:!0}}).then((function(){commonUtils.showHideLoadingDiv(!1),crmui.showMsgBand("success",I18n.getMsg("webform.approve.success",Crm.moduleInfo[e].singularLabel),2e3);var t=$("#detailNext"),a=$("#detailPrevious");crmHistory.backOneLevel(),t.hasClass("disabled")&&!a.hasClass("disabled")?renderingUtils.triggerEvent("click",a):!t.hasClass("disabled")&&a.hasClass("disabled")?renderingUtils.triggerEvent("click",t):$("#btn_approve").remove()}))},togglePortalUserStatus:function(e,t,a,i){var o=e.getData("currentParentAction");if(Crm.userDetails.CLIENT_PORTAL_TEMPLATE_CUSTOMIZATION&&!i&&"activate"===a){let i=this;var s=networkUtils.returnDependencyFiles(["crm-client-portal-user-mixin.js","crm-client-portal-user-data-store.js"],ResourceConstants.CRMClient);Lyte.injectResources({parent:s},void 0,(function(){let s=store.peekRecord("user_type",o.details.user_type.id);s=s||store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"});let r=store.peekRecord("client_user",e.data.recordId);r=r||store.findAll("client_user",{ids:e.data.recordId},{},{},{user_type_id:o.details.user_type.id});let n=store.peekRecord(moduleRecordMapping[i.data.module].id,e.data.recordId);n=n||store.findRecord(moduleRecordMapping[i.data.module].id,e.data.recordId);let l={user_types:s,client_user:r,record:n};Lyte.resolvePromises(l).then((()=>{let s=store.peekRecord("user_type",o.details.user_type.id).invitation_field,r=store.peekRecord("client_user",e.data.recordId),n=store.peekRecord(moduleRecordMapping[i.data.module].id,e.data.recordId);var l=function(){i.togglePortalUserStatus(e,t,a,!0)};(r?r.$.get(33===s.ui_type?"phone":"email"):void 0)!==n.$.get(s.api_name)?Lyte.registeredMixins["crm-client-portal-user-util"].openConfirmationModelForSingleActivation(l,(function(){}),s):l()}))}))}else{e.changePortalUserStatus(e.data.recordId,o.details.user_type.id,a).then((function(i){if("success"===i.change_status[0].status){var s="activate"===a?I18n.getMsg("custmr.prtl.actvtd.success"):I18n.getMsg("custmr.prtl.deactvtd.success");crmui.showMsgBand("success",s,3e3);var r=e.getData("dropAction"),n=r[1][2].findIndex((e=>e.name===o.name)),l=r[1][2][n].sub_actions.findIndex((e=>_.isEqual(e,t)));"activate"===a?(t.display_label=I18n.getMsg("custmr.prtl.deactvt.custmr"),t.name="deactivate_customer"):(t.display_label=I18n.getMsg("custmr.prtl.actvt.custmr"),t.name="activate_customer"),r[1][2][n].sub_actions[l]=t,e.setData("dropAction",Object.assign([],r))}}),(function(t){e.showErrorMsg(t.responseJSON,void 0,o.details.user_type.id)}))}},disableDropItem:function(e){if("export_to_pdf"!==e&&"print_preview"!==e&&"send_mail_related_mod"!==e)return!1;if(!("Quotes,Invoices,SalesOrders".indexOf(this.data.module)>-1))return!1;var t=store.peekRecord(moduleRecordMapping[this.data.module].id,this.data.recordId);return!!(this.data.buttons&&this.data.buttons.info&&this.data.buttons.info.email_disabled&&"approval_process_pending"===t.$approval_state)||(!!("Quotes"===this.data.module&&this.data.buttons&&this.data.buttons.info&&this.data.buttons.info.disabled_actions&&"approval_process_pending"===t.$approval_state)||void 0)},openProjectTaskSyncModel:function(){var e=[],t=this.getData("recordId"),a=networkUtils.returnDependencyFiles(["crm-project-sync-task.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-zprojects-sync-task.css"],ResourceConstants.CRMClient);e=e.concat(a.concat(i)),Lyte.injectResources(e,void 0,(function(){void 0!==t&&store.findAll("crm-project-sync-task",{task_id:t},!1).then((function(){ZProjects.showProjectTaskSyncModel(!1)}))}))},RPrejectBtn:function(e,t,a){var i=this.getData("rpRecordDtls").ruleId,o={moduleName:t,entityId:a,notReviewedFields:parseInt($L("#rpReviewsCount")[0].textContent)-parseInt($L("#rpReviewedCount").text()),rjctdFields:parseInt($L("#rpRejCount").text()),apprFields:parseInt($L("#rpAppCount").text())};this.rejectPopUp(i,o,"crm-detailview-header",!0)},RPResubmitBtn:function(e,t,a){var i=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(i,void 0,(function(){$L("#rpBtnResubmit").attr("lt-prop-disabled",!0);var e=store.createRecord("reviewprocesspop",{}),i=t;e.$.save({module:i,recordId:a,resubmit:!0}).then((function(){var e=$L(".rp_resubmitRefresh");0===e.length&&(e=$L('<lyte-messagebox class="rp_resubmitRefresh" lt-prop-type = "info" lt-prop-duration="6500"></lyte-messagebox>'),$L(".rpHeaders").append(e.e[0]));var t=e[0];t.ltProp("message",I18n.getMsg("crm.rp.record.resubmit")),t.ltProp("show",!0),setTimeout((function(){Utils.windowLocationReload()}),1e3),$L("#pendingRereview").css("display","block"),$L("#pendingRpIcon").css("display","block"),$L("#rpBtnResubmit").hide(),$L("#rpBtnDelete").hide(),$L("#editRecordbtn").hide()})).catch((function(e){"CANNOT_PERFORM_ACTION"===JSON.parse(e.responseText).code?(Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:i,entityId:entityId},"#detailViewButtonLayerMainTable"),$L("#rpFieldReviewedPop").e.ltProp("show",!0),$L("#rpRecordReviewedUserMsg").hide(),$L("#rpFielddReviewedUserMsg").hide(),$L("#rpFieldSubmittedMsg").css("display","block")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}))}))},rerenderTagsComp:function(){var e=$L("crm-detailview-tag");if(e&&e[0]){var t=e[0].component,a=t.calculateTagsComponentWidth(t.getData("module"));t.setData("tagscompwidth",a-50)}},setBuildSurveyActionDetails:function(){var e=this;store.findAll("dummy",{},!1,!1,{url:"/crm/v2.2/Campaigns/"+this.data.record.id+"/actions/survey_status"}).then((function(t){t&&t.survey_status&&t.survey_status.editor_url&&e.setData("survey_editor_url",t.survey_status.editor_url)}))}},{mixins:["crm-client-portal-user-util","crm-view-utils","crm-services-mixin","reviewprocess","enrichment-utils","crm-appointments-mixin"]}),Lyte.Component.registerHelper("getGdprPhoneconsent",(function(e){return!(e.Data_Processing_Basis_Details&&!e.Data_Processing_Basis_Details.Contact_Through_Phone)})),Lyte.Component.registerHelper("isSurveyPublished",(function(e){return!(e&&e.isSurveyEnabled&&void 0!==e.survey_status&&!e.survey_status)})),Lyte.Component.registerHelper("isSurveyCampaign",(function(e){return!(!e||5!==e.$campaign_type)})),Lyte.Component.registerHelper("isBackstageCampaign",(function(e){var t=((e.Layout?e.Layout.id:moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.layouts?moduleRecordMapping.Campaigns.layouts[0].id:"")?moduleRecordMapping.Campaigns.layouts.filter((function(e){return e.created_for})):[]).map((function(e){if(e.created_for&&(e.status>=0||"active"===e.status))return e.created_for}));return!(!e||7!==e.$campaign_type||!t.includes("backstage"))})),Lyte.Component.registerHelper("isCampaignStripNeeded",(function(e){return!Crm.userDetails.CLIENT_ACCOUNT&&-1!==[0,1,2,3,4,5,7].indexOf(e.$campaign_type)})),Lyte.Component.registerHelper("isZohoCampaign",(function(e){return-1!==[1,2,3,6,8].indexOf(e.$campaign_type)})),Lyte.Component.registerHelper("getMXNFieldLabel",(function(e){var t=e.api_name;return e.multiselectlookup&&e.multiselectlookup.connectedlookup_apiname&&(t=e.multiselectlookup.connectedlookup_apiname),t})),Lyte.Component.registerHelper("getLastUpdatedInfo",(function(e,t,a){if(a&&(t.LASTACTIVITYTIME||t.MODIFIEDTIME)&&"review_process_pending"!==e.$approval_state&&"review_process_rejected"!==e.$approval_state)return I18n.getMsg("crm.calendar.lastsyncat")+" : "+I18n.getMsg("crm.general.a.while.ago");var i=t.LASTACTIVITYTIME&&e[t.LASTACTIVITYTIME[1]]?"LASTACTIVITYTIME":"MODIFIEDTIME";if(t[i]&&e[t[i][1]]&&"review_process_pending"!==e.$approval_state&&"review_process_rejected"!==e.$approval_state){var o=$L.moment().toDate(),s=$L.moment(e._$.original[t[i][1]]).toDate(),r=parseInt((o-s)/864e5),n=I18n.getMsg("crm.calendar.lastsyncat")+" : ";return 0===r?(s=s=$L.moment(e._$.original[t[i][1]]).toDate(),n+=Utils.getTimeInUserFormat(s,!0)):n+=I18n.getMsg("crm.label.days.ago.withDays",r),n}})),Lyte.Component.registerHelper("getAffectedTimeValue",(function(e,t,a){var i;switch(e.column_name){case"MODIFIEDBY":i="MODIFIEDTIME";break;case"SMCREATORID":i="CREATEDTIME";break;case"RESCHEDULEDBY":i="RESCHEDULEDTIME";break;case"CANCELLEDBY":i="CANCELLEDTIME";break;default:i=void 0}if(i&&t[e.api_name]&&t[a[i][1]])return t._$.original[a[i][1]]})),Lyte.Component.registerHelper("getEmptyFieldValueClass",(function(e,t,a,i,o){return Lyte.Component.registeredHelpers.isFormulaBooleanReturnTypeField(i)&&!1===t||i&&"LOCATION"===i.column_name&&o&&o.$meeting_details&&o.$meeting_details.tool_name||a||!(!t&&0!==t||t instanceof Array&&!t.length)||"business_card"!==e&&"view"!==e?"":"zcicn-minimize-window-empty zI3 zcicn-cssIcons zcicn_grey_mask dv_noDataSign pA"})),Lyte.Component.registerHelper("getFieldLabelForDV",(function(e,t,a){if("LASTNAME"===e.column_name&&("Leads"===t||"Contacts"===t)){var i=store.peekRecord("field",a.FULLNAME[0]);if(i)return i.field_label}return"CONTACTID"===e.column_name&&"Calls"===t?I18n.getMsg("crm.activities.call.label.fromto"):e.field_label})),Lyte.Component.registerHelper("showBooleanToolTip",(function(e,t){return!("EMAILOPTOUT"!==t.column_name||!e[t.api_name])})),Lyte.Component.registerHelper("getFieldViewValue",(function(e,t,a,i){var o="";switch(e.data_type){case"text":if(i&&a&&("Leads"===a||"Contacts"===a)&&"LASTNAME"===e.column_name){var s=Crm.userDetails.NAME_FORMAT;s=s.split(",");var r=[];s.forEach((function(e){switch("Salutation"!==e&&(e=e.replace(" ","_")),e){case"Salutation":e="Salutation";break;case"Last Name":e="Last_Name";break;case"First Name":e="First_Name"}t[e]&&r.push(t[e])})),o=r.join(" ")}else o="Events"===a&&"LOCATION"===e.column_name&&t.$meeting_details&&t.$meeting_details.tool_name?I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[t.$meeting_details.tool_name]):t[e.api_name];break;case"currency":o=t.$formatted_currency?t.$formatted_currency[e.api_name]:t[e.api_name];break;case"double":o=t[e.api_name];break;case"lookup":if("Calls"===a&&"CONTACTID"===e.column_name){o=Lyte.Component.registeredHelpers.getWhoWhatValue(t,"Who_Id");break}default:o=t[e.api_name]}return void 0===o&&(o=""),o})),Lyte.Component.registerHelper("getFormattedValueForCrux",(function(e,t,a){switch(e.component_data_type){case"multiselectpicklist":if(!t)return t;if(96===e.ui_type){for(var i=[],o=a._$.original[e.api_name],s=o.length,r=0;r<s;r++)o[r].value&&i.push(o[r].value);return i}return a._$.original[e.api_name];case"phone":case"fax_phone":return t?a._$.original[e.api_name]:t}return t})),Lyte.Component.registerHelper("needToShowHpen",(function(e,t,a){return 1!==t.length&&e+1===t.length&&""!==Lyte.Component.registeredHelpers.getFieldViewValue(t[e],a)})),Lyte.Component.registerHelper("getTitleBoldClass",(function(e){return 0===e?"crm-font-bold crm-heading-font-size":"crm-subheading-font-size"})),Lyte.Component.registerHelper("getForeCastTypeClassByProbability",(function(e){if(void 0!==e)return 100===e?"zcicncss-dealwon zcicn-cssIcons zcicn_green_mask mR10":0===e?"zcicncss-deallost zcicn-cssIcons zcicn_red_mask mR10":"zcicncss-dealsummary zcicn-cssIcons zcicn_grey_mask mR10"})),Lyte.Component.registerHelper("getShowHideClassForLR",(function(e,t,a,i,o){if(!t&&!o||!e||!i)return"";if("field"===i){if(t&&t.LRfieldvsMandate&&t.LRfieldvsMandate[e.api_name]&&!e[a].isLayoutConfigLevelMandatory&&(e[a].required="true"===t.LRfieldvsMandate[e.api_name]),t&&t.LRfieldvsShowType&&"hide"===t.LRfieldvsShowType[e.api_name])return"hide";if(o&&o[e.api_name])return"hide"===o[e.api_name].visible?"hide":""}else if("section"===i){var s=Lyte.registeredMixins["crm-detailview-parser"].getSectionNameWithoutSpace(e.api_name);if(t&&t.LRsectionvsShowType&&"hide"===t.LRsectionvsShowType[s])return"hide";if(t&&t.LRfieldvsShowType&&e.detailviewColumns){var r=!0;if(e.detailviewColumns.forEach((function(e){r&&e.forEach((function(e){t.LRfieldvsShowType[e.api_name]&&"hide"===t.LRfieldvsShowType[e.api_name]||(r=!1)}))})),r)return"hide"}if(o&&e.detailviewColumns){r=!0;if(e.detailviewColumns.forEach((function(e){r&&e.forEach((function(e){o[e.api_name]&&"hide"===o[e.api_name].visible||(r=!1)}))})),r)return"hide"}}else if("subform"===i){var n=e.subform_apiname?e.subform_apiname:e.fields.filterBy({ui_type:500})[0].api_name;if("hide"===t.LRsubformvsShowType[n])return"hide"}return""})),Lyte.Component.registerHelper("canShowManAsterixForField",(function(e,t){var a=!1;return Crm.userDetails.DV_MANDATORY_FIELD_ASTERIX_SYMBOL&&!(a=!0===e.required)&&t&&t.LRfieldvsMandate&&t.LRfieldvsMandate[e.api_name]&&(a="true"===t.LRfieldvsMandate[e.api_name]),a})),Lyte.Component.registerHelper("getReviewIconClass",(function(e,t){return t||void 0===e.allFieldIndexing?"":"data-rpicon"+e.allFieldIndexing+" RPfld RPfldRow"})),Lyte.Component.registerHelper("getReviewIconClassForSubform",(function(e,t,a,i){e.subform&&500!==e.ui_type&&116!==e.ui_type&&e.ui_type;return e.review_status?i[e.id]:""})),Lyte.Component.registerHelper("getReviewFieldDetails",(function(e,t){var a={};return a.fieldid=e.id,a.colname=e.api_name,t&&(a.issubformfield="true",a.subform_fieldid=e.id,a.subform_colname=e.api_name),a})),Lyte.Component.registerHelper("getDisableClassForActions",(function(e,t){return t&&-1!==t.indexOf(e)||"kiosk"===e&&$L("crm-detailview-actions").e[0].component.getData("isKioskAssocLimitReached")?"true":"false"})),Lyte.Component.registerHelper("getDisplayLabelForAction",(function(e,t,a){return a&&a[t]?a[t]:e})),Lyte.Component.registerHelper("getToolTipText",(function(e){return e.tooltip&&"Static Text"===e.tooltip.name?e.tooltip.value:"multiselectpicklist"===e.component_data_type?I18n.getMsg("None"):void 0})),Lyte.Component.registerHelper("getDefaultCriteria",(function(e,t){const a=t&&t.criteriaObj;return e?a?[...e,...a]:e:a||void 0})),Lyte.Component.registerHelper("getWhoWhatValue",(function(e,t){var a=e.$se_module,i=t;if("Who_Id"===t&&e[t]?a="Contacts":"Who_Id"===t&&e.What_Id&&"Leads"===a?(a="Leads",i="What_Id"):"What_Id"===t&&"Leads"!==a&&e[t]&&(a=e.$se_module),e[i]&&("What_Id"!==t||"Leads"!==a)){var o=objectUtils.cloneObject(e[i]);return o.module={api_name:a,id:moduleRecordMapping[moduleApiVsNameMapping[a]].id},o}})),Lyte.Component.registerHelper("getWhoWhatDynamicParams",(function(e,t){var a=Lyte.Component.registeredHelpers.getWhoWhatValue(e,t);return void 0===a?"":[a.module.api_name,a.id]})),Lyte.Component.registerHelper("isCustomModule",(function(e){return!(!e||!e.startsWith("CustomModule"))})),Lyte.Component.registerHelper("getFieldEditTypeClass",(function(e){switch(e){case"showEdit":return"zcicncss-editFilled zcicn-cssIcons zcicncss13 zcicn_grey_mask";case"showLock":return"zcicncss-lock zcicn-cssIcons";default:return""}})),Lyte.Component.registerHelper("getInfoValueFieldClass",(function(e,t,a,i,o,s,r){var n="cP dv_info_value_field ";if(r&&r.place===s&&r.column_name===e.column_name&&(n+=" dv_value_field_highlight "),"MODIFIEDBY"===e.column_name||"SMCREATORID"===e.column_name||e.column_name===i&&o&&o===s)n+=" dv_transBorder ";else{if("Calls"===t&&"CTIVOICEURL"===e.column_name&&a[e.api_name])return"dv_transBorder "+("CTIVOICEURL"===i?"dv_info_value_field":"aiFlexStart minW400");e.ui_type===CrmField.UITYPES.TERRITORY&&(n+=" dv_assign_territory_fld")}return"picklist"===e.component_data_type?n+="  dv_info_value_picklist ":"imageupload"===e.component_data_type?n+="  dv_info_value_imageupload":"textarea"===e.component_data_type?n+="  dv_info_value_multiline":"multiselectpicklist"===e.component_data_type&&(n+="  dv_info_value_multiselect"),n})),Lyte.Component.registerHelper("getCallReminderValue",(function(e){return Lyte.Transform.datetime.deserialize(e)})),Lyte.Component.registerHelper("getReadableRecurringPatternForTask",(function(e){if(e){var t,a=crmTasks.convertRruleToMap(e.RRULE),i=a.FREQ,o=a.INTERVAL,s=a.COUNT?a.COUNT:void 0,r=a.UNTIL?a.UNTIL:void 0;"-1"===r?t=1:s?t=2:(t=3,r=Utils.getDateInUserDatePattern($L.moment(r).toDate()));var n="";switch(i){case"DAILY":n="1"===o?1===t?I18n.getMsg("crm.recurrence.daily.option1"):2===t?I18n.getMsg("crm.recurrence.daily.option1.end2",s):I18n.getMsg("crm.recurrence.daily.option1.end3",r):1===t?I18n.getMsg("crm.recurrence.daily.custom.option1",o):2===t?I18n.getMsg("crm.recurrence.daily.custom.option1.end2",[o,s]):I18n.getMsg("crm.recurrence.daily.custom.option1.end3",[o,r]);break;case"WEEKLY":var l=[],d=a.BYDAY,c=["SU","MO","TU","WE","TH","FR","SA"];if(d){for(var p=d.split(","),m=p.length,u=0;u<m;u++){var g=c.indexOf(p[u])+1;l.includes(parseInt(g))||l.push(g)}for(var y=[],v=1;v<8;v++)l.includes(v)&&y.push(v)}if(1===y.length&&"1"===o)n=1===t?I18n.getMsg("crm.recurrence.week.option1"):2===t?I18n.getMsg("crm.recurrence.week.option1.end2",s):I18n.getMsg("crm.recurrence.week.option1.end3",r);else{c="";var h=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],_=y.length,f=!1,b=[0,0,0,0,0,0,0,0];if(_>4&&7!==_){f=!0;for(var D=0;D<_;D++)b[y[D]-1]=1}if(f)for(var I=0;I<7;I++)b[I]||(c=c+h[I]+",");else for(v=0;v<_;v++)c=c+h[y[v]-1]+",";c=c.substring(0,c.length-1),n="1"===o?f?1===t?I18n.getMsg("crm.recurrence.week.except.custom.option1",c):2===t?I18n.getMsg("crm.recurrence.week.except.custom.option1.end2",[c,s]):I18n.getMsg("crm.recurrence.week.except.custom.option1.end3",[c,r]):1===t?I18n.getMsg("crm.recurrence.week.custom.option1",c):2===t?I18n.getMsg("crm.recurrence.week.custom.option1.end2",[c,s]):I18n.getMsg("crm.recurrence.week.custom.option1.end3",[c,r]):f?1===t?I18n.getMsg("crm.recurrence.week.except.custom.option2",[o,c]):2===t?I18n.getMsg("crm.recurrence.week.except.custom.option2.end2",[o,c,s]):I18n.getMsg("crm.recurrence.week.except.custom.option2.end3",[o,c,r]):1===t?I18n.getMsg("crm.recurrence.week.custom.option2",[o,c]):2===t?I18n.getMsg("crm.recurrence.week.custom.option2.end2",[o,c,s]):I18n.getMsg("crm.recurrence.week.custom.option2.end3",[o,c,r])}break;case"MONTHLY":var C=(M=a.BYMONTHDAY)?1:2;if(1===C&&"1"===o)n=1===t?I18n.getMsg("crm.recurrence.month.option1"):2===t?I18n.getMsg("crm.recurrence.month.option1.end2",s):I18n.getMsg("crm.recurrence.month.option1.end3",r);else if(1===C){var w=M;n=1===t?I18n.getMsg("crm.recurrence.month.custom.option1.recur",[o,w]):2===t?I18n.getMsg("crm.recurrence.month.custom.option1.recur.end2",[o,w,s]):I18n.getMsg("crm.recurrence.month.custom.option1.recur.end3",[o,w,r])}else{var L=a.BYDAY;c=["SU","MO","TU","WE","TH","FR","SA"];M=a.BYSETPOS;var R=c.indexOf(L)+1;M="-1"===M?"5":M;var k=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercaselast")];h=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];n="1"===o?1===t?I18n.getMsg("crm.recurrence.month.custom.option2",[k[M-1],h[R-1]]):2===t?I18n.getMsg("crm.recurrence.month.custom.option2.end2",[k[M-1],h[R-1],s]):I18n.getMsg("crm.recurrence.month.custom.option2.end3",[k[M-1],h[R-1],r]):1===t?I18n.getMsg("crm.recurrence.month.custom.option2.recur",[o,k[M-1],h[R-1]]):2===t?I18n.getMsg("crm.recurrence.month.custom.option2.recur.end2",[o,k[M-1],h[R-1],s]):I18n.getMsg("crm.recurrence.month.custom.option2.recur.end3",[o,k[M-1],h[R-1],r])}break;case"YEARLY":var M=a.BYMONTHDAY,x=parseInt(a.BYMONTH)-1;if(1===(M?1:2))n=1===t?I18n.getMsg("crm.recurrence.yearly.option1"):2===t?I18n.getMsg("crm.recurrence.yearly.option1.end2",s):I18n.getMsg("crm.recurrence.yearly.option1.end3",r);else{L=a.BYDAY;c=["SU","MO","TU","WE","TH","FR","SA"],M=a.BYSETPOS;R=c.indexOf(L)+1,k=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercaselast")],h=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];var A=[I18n.getMsg("January"),I18n.getMsg("February"),I18n.getMsg("March"),I18n.getMsg("April"),I18n.getMsg("May"),I18n.getMsg("June"),I18n.getMsg("July"),I18n.getMsg("August"),I18n.getMsg("September"),I18n.getMsg("October"),I18n.getMsg("November"),I18n.getMsg("December")];M="-1"===M?"5":M,n=1===t?I18n.getMsg("crm.recurrence.yearly.custom.option2",[k[M-1],h[R-1],A[x]]):2===t?I18n.getMsg("crm.recurrence.yearly.custom.option2.end2",[k[M-1],h[R-1],A[x],s]):I18n.getMsg("crm.recurrence.yearly.custom.option2.end3",[k[M-1],h[R-1],A[x],r])}}return n}})),Lyte.Component.registerHelper("getReadableReminderTextForTask",(function(e,t){if(!e||!e.ALARM||"Tasks"!==this.getData("module"))return"";$L.moment().toDate().setHours(0,0,0,0);for(var a={},i=e.ALARM.split(";"),o=i.length,s=0;s<o;s++)a[i[s].split("=")[0]]=i[s].split("=")[1];var r=a.FREQ;r=r&&"NONE"===r?void 0:r;var n,l,d=a.ACTION?a.ACTION:"email",c=a.TRIGGER,p=c;if(c&&c.startsWith("DATE-TIME:"))n=c.length>34?c.substring(10,35):30===c.length?c.substring(10,30):c.substring(10,c.length),n=$L.moment(n).toDate();else{if(!(c&&c.startsWith("-P")&&c.length>=4&&a.TRIGGER_TIME))return"";var m=t._$.original[this.component.data.meta_info.fieldColumnNameMap.DUEDATE[1]];if(""===m)return"";switch((m=$L.moment(m).toDate()).setHours(a.TRIGGER_TIME.split(":")[0]),m.setMinutes(a.TRIGGER_TIME.split(":")[1]),n=m,l=p.substring(2,p.length-1),c.substring(c.length-1)){case"D":l+=" DAYS";break;case"W":l+=" WEEKS";break;case"M":l+=" MONTHS"}}if(n&&l){var u=l;if(u&&-1!==u.indexOf(" ")){var g=parseInt(u.substring(0,u.indexOf(" ")));switch(u.substring(u.indexOf(" ")+1,u.length)){case"DAYS":n.setDate(n.getDate()-g);break;case"WEEKS":n.setDate(n.getDate()-7*g);break;case"MONTHS":n.setMonth(n.getMonth()-g)}}}var y,v="",h="";switch(r){case"DAILY":v=I18n.getMsg("dailyfrom")+" ";break;case"WEEKLY":v=I18n.getMsg("weeklyfrom")+" ";break;case"MONTHLY":v=I18n.getMsg("monthlyfrom")+" ";break;case"YEARLY":v=I18n.getMsg("yearlyfrom")+" "}!d||"POPUP"!==d&&"EMAIL"!==d||("POPUP"===d?y="throughpopup":"EMAIL"!==d&&"EMAIL"!==d||(y="throughemail"),h=" "+I18n.getMsg(y));if(void 0===l)return v+CrmDateUtils.convertDateToUserPattern(n,void 0,!0)+" "+Utils.getTimeInUserFormat(n,!0)+h;var _,f=l.split(" ")[0],b=l.split(" ")[1];switch(_="0"===f?I18n.getMsg("On")+" ":f+" ",b){case"DAYS":_+=I18n.getMsg("crm.schedules.skipfreq.day");break;case"WEEKS":_+=I18n.getMsg("crm.schedules.skipfreq.week");break;case"MONTHS":_+=I18n.getMsg("crm.schedules.skipfreq.month")}return _+=" ","0"!==f&&(_+=I18n.getMsg("before")+" "),v+_+" ("+CrmDateUtils.convertDateToUserPattern(n,void 0,!0)+") "+I18n.getMsg("of.duedate")+" "+I18n.getMsg("crm.label.lowercase.at")+" "+Utils.getTimeInUserFormat(n,!0)+h})),Lyte.Component.registerHelper("addOnlineClass",(function(e,t){return"object"==typeof CrmTracking&&CrmTracking.isEntityOnline(e,t)?"online-entity":""})),Lyte.Component.registerHelper("getRelDetailsImgUrl",(function(e,t,a){return e&&t&&a?Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+e+"&entityId="+t+"&actionName=readImage&fileId="+a:"Accounts"===e?networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM):networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM)})),Lyte.Component.registerHelper("getRelatedRecordFieldIcon",(function(e,t){var a={};switch(e){case"phoneicon":a={name:"phone-green-filled",class:"zcicn-phone-green-filled"};break;case"mobileicon":a={name:"call-blue-filled",class:"zcicn-call-blue-filled zcicn16"};break;case"websiteicon":a={name:"link",class:"zcicn-link zcicn-link-blue-filled"};break;case"dobicon":a={name:"gift",class:"zcicn-gift"};break;case"locationicon":a={name:"location-green-filled",class:"zcicn-location-green-filled"}}return!t||a[t]})),Lyte.Component.registerHelper("getFieldHighlightClass",(function(e,t){return e||t&&t>0?"wfFieldHighlight":""})),Lyte.Component.registerHelper("getFieldSingleColClass",(function(e){let t=Lyte.Router.getRouteInstance().currentModel;return 1!==e||t&&t.show_right_panel&&t.show_cv_left_panel||!t||Lyte.Component.registeredHelpers.isRequesterTeamModule(t.module)?"":"dv_single_col_value"})),Lyte.Component.registerHelper("getSingleColClass",(function(e){let t=Lyte.Router.getRouteInstance().currentModel;return 1!==e||t&&t.show_right_panel&&t.show_cv_left_panel?"dv_field_column":"dv_field_single_column"})),Lyte.Component.registerHelper("addHideClassForEmailBlock",(function(e){let t=Lyte.Router.getRouteInstance().currentModel,a=t?t.blocked_info:null;if(a&&a.data[0]&&a.data[0].features_info&&a.data[0].features_info[0]&&a.data[0].features_info[0].details){let t=a.data[0].features_info[0].details;for(var i=t.length,o=0;o<i;o++)if(t[o].field.api_name===e.api_name)return""}return"hide"})),Lyte.Component.registerHelper("addFlexClassForEmailFields",(function(e,t){return t||"Email"!==e&&"Secondary_Email"!==e?"":"flexAlignCenter email_block_field"})),Lyte.Component.registerHelper("getSubformFieldId",(function(e){var t=e.fields.filterBy({ui_type:500})[0];return t&&t.id})),Lyte.Component.registerHelper("isSubformViewable",(function(e){if(!Crm.userDetails.SUBFORM_PERMISSIONS)return!0;var t=e.fields.filterBy({ui_type:500})[0];return!(!t||!t.subform)&&store.peekRecord("module",t.subform.id).viewable})),Lyte.Component.registerHelper("backTooltip",(function(){var e,t=history.state.backOneLevel?history.state.backOneLevel:history.state.data.backOneLevel;return t&&t.historyIndex&&(e=Crm.newHistoryArr[t.historyIndex]?Crm.newHistoryArr[t.historyIndex].toolTip:""),e=e?I18n.getMsg("BackButton.back.to.name",e):I18n.getMsg("BackButton.back"),revertSplChrs(e)})),Lyte.Component.registerHelper("isDarkBackground",(function(e){return"black"===getPickListFontColor(e)})),Lyte.Component.registerHelper("isFormulaBooleanReturnTypeField",(function(e){return!!(e&&e.formula&&e.formula.return_type&&"boolean"===e.formula.return_type)})),Lyte.Component.registerHelper("isDynamicCriteriaInvolved",(function(e){return!!(e&&e.lookup&&e.lookup.query_details&&e.lookup.query_details.criteria&&Lyte.registeredMixins["crm-lookup-filter-mixin"].isDynamicCriteriaInvolved(e.lookup.query_details.criteria))})),Lyte.Component.register("crm-detailview-tag",{_template:'<template tag-name="crm-detailview-tag"> <template is="if" value="{{expHandlers(from,\'==\',&quot;import&quot;)}}"><template case="true"> <crux-tag id="importtag" cx-prop-scope="#ITF-container .itb-body-class" cx-prop-class="hello" cx-prop-tag-options="{{tagarray}}" cx-prop-tags="{{selectedtags}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-prevent-key-list="[&quot;<&quot;,&quot;>&quot;,&quot;,&quot;]" on-error="{{method(\'onError\')}}" on-before-add-tag="{{method(&quot;validate_tags&quot;)}}" on-before-remove-tag="{{method(&quot;beforeremove&quot;)}}" on-color-tag-palette-hide="{{method(&quot;hideColor2&quot;)}}"> </crux-tag> </template><template case="false"> <div class="crm-detailview-tag"> <template is="if" value="{{expHandlers(displaytags.length,\'>\',0)}}"><template case="true"> <lyte-nav class="dvTagView pL25 pR mT5 dF aiCenter"> <template is="if" value="{{add_tag}}"><template case="true"> <span class="zcicncss-tag zcicn-cssIcons zcicn_grey_mask mR7 vaM pA left0 top2 dvTagIcon"></span> </template></template> <crux-tag-component data-zcqa="cruxTagCompdetailView" class="dIB vaM {{if(ifEquals(inEditMode,\'true\'),\'vH\',\'\')}}" cx-prop-module="{{module}}" cx-prop-trigger-tag-click="true" cx-prop-clip-mode="true" cx-prop-value="{{displaytags}}" cx-prop-is-color-code-enabled="true" cx-prop-width="{{expHandlers(tagscompwidth,\'+\',&quot;px&quot;)}}" cx-prop-redirect-url="{{redirectUrl}}"></crux-tag-component> <span data-zcqa="cruxTagComponentTagEditIcon" class="zcicncss-editFilled-hover tagEditIcon cP vH vaM mT1 mL5 zcicn-cssIcons zcicncss13 {{if(ifEquals(inEditMode,true),\'hide\',\'\')}} {{if(ifEquals(isRecordLocked,true),\'noEventTag\',\'\')}} {{if(ifEquals(cursor,true),\'defcursor\',\'\')}} {{if(ifNotEquals(tooltip,getI18n(\'crm.label.add.tags\')),\'addPermissionDenied\',\'\')}}" onclick="{{action(\'showAddTag\')}}" lt-prop-tooltip-config=" { &quot;showdelay&quot;:500,&quot;appearance&quot;:&quot;box&quot;,&quot;position&quot;:&quot;bottomright&quot;,&quot;margin&quot;:10} " tabindex="0" lt-prop-aria-keydown="true" role="button" aria-label="{{getI18n(\'crm.button.edit\')}}" lt-prop-title="{{tooltip}}"></span> </lyte-nav> </template><template case="false"> <div class="mT4"> <template is="if" value="{{add_tag}}"><template case="true"> <span class="zcicncss-tag zcicn-cssIcons zcicn_grey_mask dvTagIcon dIB vaM"></span> <span data-zcqa="detailViewLyteAddTag" tabindex="0" class="dIB vaM crm-base-font-size cP add_tag crmBaseColor accessibility-clickable-elem {{if(ifEquals(cursor,true),\'defcursor\',\'\')}} {{if(ifNotEquals(tooltip,getI18n(\'crm.label.add.tags\')),\'addPermissionDenied\',\'\')}}" lt-prop-tooltip-config=" { &quot;showdelay&quot;:500,&quot;appearance&quot;:&quot;box&quot;,&quot;position&quot;:&quot;bottomright&quot;,&quot;margin&quot;:10} " lt-prop-title="{{tooltip}}" onclick="{{action(\'showAddTag\')}}" lt-prop-aria-keydown="true" role="button" aria-label="{{getI18n(\'crm.label.add.tags\')}}">{{getI18n(\'crm.label.add.tags\')}}</span> </template></template> </div> </template></template> </div> <lyte-popover id="detailview_add_tag" lt-prop-width="570px" lt-prop-origin-elem=".crm-detailview-tag .dvTagIcon" lt-prop-placement="bottomLeft" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-show="false" lt-prop-wrapper-class="detailview_add_tag" lt-prop-type="box" lt-prop-boundary="{&quot;left&quot;:&quot;100&quot;,&quot;top&quot;:&quot;0&quot;}" lt-prop-content-padding="13px 35px" lt-prop-footer-padding="5px 35px 25px" lt-prop-close-on-body-click="true" lt-prop-allow-multiple="true" on-before-close="{{method(&quot;open_pop&quot;)}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <span class="zcicncss-tag zcicn-cssIcons zcicn_grey_mask pA mR7 left10 top20"></span> <crux-tag id="defaulttag" cx-prop-id="view" cx-prop-tag-options="{{tagarray}}" cx-prop-tags="{{selectedtags}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-prevent-key-list="[&quot;<&quot;,&quot;>&quot;,&quot;,&quot;]" on-before-add-tag="{{method(&quot;validate_tags&quot;)}}" on-before-remove-tag="{{method(&quot;beforeremove&quot;)}}" on-error="{{method(\'onError\')}}" on-color-tag-palette-hide="{{method(&quot;hideColor&quot;)}}"> </crux-tag> </lyte-popover-content> <lyte-popover-footer class="alignRight"> <lyte-button lt-prop-size="small" lt-prop-tabindex="0" onclick="{{action(\'hideAddTag\')}}" lt-prop-appearance="default" data-zcqa="canceltag_btn"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" lt-prop-tabindex="0" lt-prop-size="small" onclick="{{action(\'savetags\')}}" lt-prop-disabled="{{lbind(saveEnabled)}}" data-zcqa="savetag_btn"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.save\')}} </template> </lyte-button> </lyte-popover-footer> </template> </lyte-popover> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[3]},{type:"text",position:[3,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]}]}},default:{}}],_observedAttributes:["tagarray","selectedtags","idvsname","module","removedtags","displaytags","tagscompwidth","cvid","tagnamevstagid","tagidvstagname","tag","tagnamevsmodrefid","added_count","saveEnabled","tagnames","tooltip","added_count","from","add_tag","tagged_icon","isActivitySplitDone","sandboxAccount","cursor","showMoreTags","inEditMode","tagValuesNew","recordTagCount","editionCount","entityId","recordLockedinGDPR","tagsPermissionAvail","recordLockingDetails","approvalState","rerenderTagsComponent","isRecordLocked","sharingPermission","redirectUrl"],data:function(){return{tagarray:Lyte.attr("array",{default:[]}),selectedtags:Lyte.attr("array",{default:[]}),idvsname:Lyte.attr("object",{default:{}}),module:Lyte.attr("string",{default:""}),removedtags:Lyte.attr("string",{default:""}),displaytags:Lyte.attr("array",{default:[]}),tagscompwidth:Lyte.attr("number",{default:0}),cvid:Lyte.attr("string",{default:""}),tagnamevstagid:Lyte.attr("object",{default:{}}),tagidvstagname:Lyte.attr("object",{default:{}}),tag:Lyte.attr("array",{default:[]}),tagnamevsmodrefid:Lyte.attr("object",{default:{}}),added_count:Lyte.attr("number",{default:0}),saveEnabled:Lyte.attr("boolean",{default:!0}),tagnames:Lyte.attr("array",{default:[]}),tooltip:Lyte.attr("string",{default:""}),added_count:Lyte.attr("number",{default:0}),from:Lyte.attr("string",{default:"detailview"}),add_tag:Lyte.attr("boolean",{default:!0}),tagged_icon:Lyte.attr("boolean",{default:!0}),isActivitySplitDone:Lyte.attr("boolean"),sandboxAccount:Lyte.attr("boolean",{default:!1}),cursor:Lyte.attr("boolean",{default:!1}),showMoreTags:Lyte.attr("boolean",{default:!1}),inEditMode:Lyte.attr("boolean",{default:!1}),tagValuesNew:Lyte.attr("object",{default:{}}),recordTagCount:Lyte.attr("number",{default:0}),editionCount:Lyte.attr("number",{default:0}),entityId:Lyte.attr("string",{default:""}),recordLockedinGDPR:Lyte.attr("boolean",{default:!1}),tagsPermissionAvail:Lyte.attr("boolean",{default:!1}),recordLockingDetails:Lyte.attr("object",{default:{}}),approvalState:Lyte.attr("string",{default:""}),rerenderTagsComponent:Lyte.attr("boolean",{default:!1}),isRecordLocked:Lyte.attr("boolean",{default:!1}),sharingPermission:Lyte.attr("boolean",{default:!1}),redirectUrl:Lyte.attr("string")}},tagnamevscolor:[],init:function(){var e=moduleRecordMapping[this.getData("module")];if(e.timeline_view||e.canvas_view||e.card_view||e.table_view||e.kanban_view||e.chart_id&&e.chart_view_supported&&e.chart_view){var t=this.getCurrentListViewURL(this.getData("module")),a=e.canvas_view||e.card_view||e.table_view?"&":"?";this.setData("redirectUrl",t+a)}if(void 0===this.getData("redirectUrl")){var i=this.getData("module");t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.list",dynamicParams:[i,moduleRecordMapping[i].cvid]});this.setData("redirectUrl",t+"?")}if("import"!==this.getData("from")){i=this.getData("module");this.setData("isActivitySplitDone",Crm.isActivitySplitDone),moduleRecordMapping[i].custom_view&&("Tasks"!==i&&"Calls"!==i&&"Events"!==i||this.getData("isActivitySplitDone")?this.setData("cvid",moduleRecordMapping[i].custom_view.id):this.setData("cvid",moduleRecordMapping.Activities.custom_view.id))}if(!0!==isSandboxAcc&&"true"!==isSandboxAcc||this.setData("sandboxAccount",!0),void 0!==moduleRecordMapping[i]&&void 0!==store.peekRecord(moduleRecordMapping[i].id,detailView.entityId)){var o=[];if(o=Crm.lyteHeaderNeeded(i)?this.getData("tagValuesNew").Tag:store.peekRecord(moduleRecordMapping[i].id,detailView.entityId).Tag,this.setData("displaytags",o),void 0!==o){var s=o.length;s>3&&this.setData("count",s-3)}}this.setData({recordLockedinGDPR:this.getData("tagValuesNew").$stop_processing,sharingPermission:"read_only"===this.getData("tagValuesNew").$sharing_permission,tagsPermissionAvail:Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Tags_"+this.getData("module")),approvalState:this.getData("approvalState")})},didConnect:function(){var e=this,t=e.getData("module");if("Activities"===t&&(t=$("#module").val()),"Events"===t){var a=e.calculateTagsComponentWidth(e.getData("module"));e.setData("tagscompwidth",a),$L(".dv_profileTitle_cont").css({width:a+"px"})}"detail"===Lyte.Router.getRouteInstance().routeName&&window.addEventListener("resize",this.applyResizeHeight),$L("#detailviewTags").empty(),$L("#detailviewInfo").empty(),e.setData("module",t),e.setData("entityId",e.getData("tagValuesNew").id);var i=moduleRecordMapping[t].api_name,o=e.getData("tagValuesNew").Tag;if("Free"===Crm.userDetails.EDITION_NAME||"Starter"===Crm.userDetails.EDITION_NAME)"Free"===Crm.userDetails.EDITION_NAME?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.records.downgrade.free.edition")):(this.setData("tagged_icon",!1),this.setData("add_tag",!1)),e.disablecursor("default");else{var s=moduleRecordMapping[t].module_name;"linking"==Crm.userDetails.MODULE_LIST[s].generated_type||Crm.userDetails.MODULE_LIST[s].parent_module&&"Orchestration"==Crm.userDetails.MODULE_LIST[s].parent_module.module_name?(this.setData("tagged_icon",!1),this.setData("add_tag",!1),$(".tagged_icon").hide(),e.disablecursor("default")):("detail"!==Lyte.Router.getRouteInstance().routeName&&"entity"!==Lyte.Router.getRouteInstance().routeName&&store.unloadAll("tag"),store.findAll("tag",{module:i,fromPage:"view"},!0,!0).then((function(t){void 0===e.getData("tag")&&(e=$L("crm-detailview-tag")[0].component),e.setData({tag:t,recordTagCount:t.$.meta.record_limit,editionCount:t.$.meta.allowed_count});var a=0;e.getData("tagValuesNew").Tag&&(a=e.getData("tagValuesNew").Tag.length),a>3&&e.setData("count",a-3);var i=t.length,s={},r={},n={},l={};for(p=0;p<i;p++)Lyte.objectUtils(e.getData("idvsname"),"add",t[p].modRefId,t[p].name),s[t[p].name]=t[p].id,n[t[p].name]=t[p].modRefId,l[t[p].name]=t[p].color_code,r[t[p].id]=[t[p].name],name=t[p].name,"detailview"!==e.getData("from")||e.getData("tagarray").includes(t[p].modRefId)||Lyte.arrayUtils(e.getData("tagarray"),"push",{name:name,id:t[p].id,color_code:t[p].color_code}),Lyte.arrayUtils(e.getData("tagnames"),"push",name);e.setData("tagnamevstagid",s),e.setData("tagnamevsmodrefid",n),e.setData("tagnamevscolor",l),e.setData("tagidvstagname",r);var d=0;void 0!==o&&(d=o.length);for(var c=[],p=0;p<d;p++)c.push(o[p].name);for(var m=c.length,u=[],g=0;g<m;g++)u.push(n[c[g]]);var y=e.getData("idvsname");e.setData("selectedtags",[]);for(p=0;p<d;p++){var v=y[u[p]],h={name:v,id:s[v],color_code:l[v]};Lyte.arrayUtils(e.getData("selectedtags"),"push",h)}if(void 0===e.getData("displaytags")||0===e.getData("displaytags").length){var _=e.getData("selectedtags").slice();e.setData("displaytags",_)}var f=$L("#ApprovalProcess").children().length,b=e.getData("approvalState")&&"approved"!==e.getData("approvalState")&&"approval_process_rejected"!==e.getData("approvalState"),D=e.getData("approvalState")&&"approved"!==e.getData("approvalState")&&"approval_process_rejected"!==e.getData("approvalState")&&"approval_process_pending"!==e.getData("approvalState")&&"review_process_rejected"!==e.getData("approvalState"),I=e.getData("recordLockingDetails")?e.getData("recordLockingDetails").isLocked&&e.getData("recordLockingDetails").restricted_actions.includes("tags"):detailView.recordLockingDetails&&detailView.recordLockingDetails.lockedRecordDetails&&detailView.recordLockingDetails.lockedRecordDetails.length>0&&detailView.recordLockingDetails.lockingConfigJSON[0]&&detailView.recordLockingDetails.lockingConfigJSON[0].restricted_actions.contains("tags"),C=e.getData("recordLockedinGDPR"),w=e.getData("sharingPermission"),L=e.getData("tagsPermissionAvail");if(w||Crm.userDetails.ISROMODE||b||D||I||C||!L||Crm.userDetails.CLIENT_ACCOUNT)if(D?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.reviewprocess.detailview.create.no.permission.msg")):b?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):Crm.userDetails.CLIENT_ACCOUNT?(e.setData("tagged_icon",!1),$L(".tagged_icon").hide(),e.setData("add_tag",!1),e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg"))):L?I||C?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.lock.tag.restricted")):u.length>0||0==e.getData("selectedtags").length&&f||!f||w?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags")):(e.setData("tagged_icon",!1),$L(".tagged_icon").hide(),e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg"))),"import"!==e.getData("from")){e.disablecursor();l=this.tagnamevscolor}else $("#importTagFieldId").empty();else I?(e.setData("add_tag",!1),e.setData("tagged_icon",!1),e.disablecursor("default"),$L(".tag_edit_icon").hide()):e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags"))}),(function(){e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg"));var t=$L(".add_tag"),a=$L(".tag_edit_icon");(t.length>0||a.length>0)&&e.setData("cursor",!0)})))}},applyResizeHeight:function(){if(this.tagDVComp||(this.tagDVComp=$L("crm-detailview-tag")),this.tagDVComp&&this.tagDVComp[0]&&this.tagDVComp[0].component&&null!==this.tagDVComp[0].component){var e=this.tagDVComp[0].component,t=e.calculateTagsComponentWidth(e.getData("module"));e.setData("tagscompwidth",t),$L(".dv_profileTitle_cont").css({width:t+50+"px"})}},rerenderComponent:function(){var e=this,t=e.getData("recordLockingDetails");if(t){var a=t.restricted_actions.includes("tags");e.setData("isRecordLocked",a)}this.resetToolTipValue(e)}.observes("recordLockingDetails","recordLockedinGDPR","approvalState"),resetToolTipValue:function(e){var t=e.getData("approvalState")&&"approved"!==e.getData("approvalState")&&"approval_process_rejected"!==e.getData("approvalState"),a=e.getData("approvalState")&&"approved"!==e.getData("approvalState")&&"approval_process_rejected"!==e.getData("approvalState")&&"approval_process_pending"!==e.getData("approvalState")&&"review_process_rejected"!==e.getData("approvalState"),i=!!e.getData("recordLockingDetails")&&(e.getData("recordLockingDetails").isLocked&&e.getData("recordLockingDetails").restricted_actions.includes("tags")),o=e.getData("recordLockedinGDPR"),s=e.getData("tagsPermissionAvail");Crm.userDetails.ISROMODE||t||a||i||o||!s?a?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.reviewprocess.detailview.create.no.permission.msg")):t?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):s?i||o?e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.lock.tag.restricted")):e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags")):e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):i?(e.setData({add_tag:!1,tagged_icon:!1}),e.disablecursor("default"),$L(".tag_edit_icon").hide()):(e.enablecursor(!0),e.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags")))},getCurrentListViewURL:function(e){if(e&&moduleRecordMapping[e]&&moduleRecordMapping[e].cvid){var t="";return moduleRecordMapping[e].kanban_view?t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.kanban",dynamicParams:[e,moduleRecordMapping[e].cvid]}):moduleRecordMapping[e].chart_view?t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.chart",dynamicParams:[e,moduleRecordMapping[e].cvid]}):moduleRecordMapping[e].canvas_view&&moduleRecordMapping[e].viewid?t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.canvas",dynamicParams:[e,moduleRecordMapping[e].cvid,moduleRecordMapping[e].viewid],queryParams:{viewType:"CustomizedView"}}):moduleRecordMapping[e].card_view&&moduleRecordMapping[e].cardid?t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.canvas",dynamicParams:[e,moduleRecordMapping[e].cvid,moduleRecordMapping[e].cardid],queryParams:{viewType:"CardView"}}):moduleRecordMapping[e].table_view&&moduleRecordMapping[e].tableid?t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.canvas",dynamicParams:[e,moduleRecordMapping[e].cvid,moduleRecordMapping[e].tableid],queryParams:{viewType:"TableView"}}):moduleRecordMapping[e].timeline_view&&(t=Lyte.Router.getURL({route:"crm.tab.module.custom-view.timeline",dynamicParams:[e,moduleRecordMapping[e].cvid]})),t}},disablecursor:function(e){var t=$L(".add_tag"),a=$L(".tag_edit_icon");t.length>0?(t[0].setAttribute("click",""),void 0!==e&&t.css("cursor",e)):a.length>0&&(a[0].setAttribute("click",""),a.css("cursor",e))},enablecursor:function(e){var t=$L(".add_tag"),a=$L(".tag_edit_icon");t.length>0?(t[0].setAttribute("click","crm-detailview-tag => showAddTag()"),void 0!==e&&t.css("cursor",e)):a.length>0&&(a[0].setAttribute("click","crm-detailview-tag => showAddTag()"),a.css("cursor",e))},addTags:function(e){var t=this,a=t.getData("module");a="Activities"===a?store.peekRecord(moduleRecordMapping.Activities.id,selectedIds[0]).$activity_type:a;var i,o=t.getData("selectedtags"),s=[];if(i=Crm.renderDVLyteFlow(a)?t.getData("entityId"):detailView.entityId,0===o.length){var r=t.getData("removedtags"),n=0;if(1===(n=r.includes(",")?(r=r.split(",")).length:1)){var l={name:r};s.push(l)}else for(var d=0;d<n;d++){l={name:r[d]};s.push(l)}var c={tags:s,ids:i.toString()};t.addtagstoRec(t,c,i,!1,a,"detailview","remove",e,o.map((e=>e.name)),t.getData("displaytags").map((e=>e.name)))}else{var p=o.length;for(d=0;d<p;d++){var m=o[d].color_code;"#noFill"!==m&&"noFill"!==m||(m=null);l={name:o[d].name.replace(/  +/g," "),color_code:m};s.push(l)}c={tags:s,ids:i,over_write:!0};t.addtagstoRec(this,c,i,!0,moduleRecordMapping[a].api_name,"detailview","add",e,o.map((e=>e.name)),t.getData("displaytags").map((e=>e.name)))}},afteradd_detailview:function(e,t,a,i,o){CScriptLib&&(o?o.resolve_cscript():CScript.Engine.Global.dispatchEvent("onTagChanged",void 0,a.map((e=>({name:e}))),(a.diff(i)||[]).map((e=>({name:e}))),(i.diff(a)||[]).map((e=>({name:e}))))),e.setData("tag",t);var s=e.getData("tagnamevsmodrefid"),r=t.data[0].details.tags,n=r.length,l=[],d="";e.setData("selectedtags",[]),e.setData("displaytags",[]);for(var c=this.getData("tagnamevscolor"),p=0;p<n;p++){var m=r[p].name;d=s[m],l.push(d);var u={name:m,color_code:r[p].color_code};Lyte.arrayUtils(e.getData("selectedtags"),"push",u),Lyte.arrayUtils(e.getData("displaytags"),"push",u),void 0===c[m]&&(c.tag_name=r[p].color_code)}e.setData("tagnamevscolor",c),Crm.renderDVLyteFlow(e.getData("module"))?e.setData(e.getData("tagValuesNew").Tag,l):CrmTags.clientJSON.value=l;var g=l.length,y=e.getData("selectedtags");g>3&&e.setData("count",y.length-3),e.setData("removedtags","");var v=e.getData("tagarray"),h=e.getData("tagnamevsmodrefid");e.setData("tagarray",[]);var _=[];_=Crm.renderDVLyteFlow(e.getData("module"))?e.getData("tagValuesNew").Tag:CrmTags.clientJSON.value;var f=v.length;for(p=0;p<f;p++){var b=v[p].name;if(!_.includes(h[b])){u={name:b,color_code:c[b]};Lyte.arrayUtils(e.getData("tagarray"),"push",u)}}store.peekRecord(moduleRecordMapping[e.getData("module")].id,detailView.entityId)&&(store.peekRecord(moduleRecordMapping[e.getData("module")].id,detailView.entityId).Tag=e.getData("selectedtags")),CrmTags.edited=!0;var D=t.data.length;for(p=0;p<D;p++){var I=t.data[p];void 0!==I.details.$approval_state&&"approval_process_pending"===I.details.$approval_state&&reloadCurrentEntityView()}document.getElementById("detailview_add_tag").ltProp("show",!1),this.setData("inEditMode",!1),commonUtils.showHideLoadingDiv(!1),crmTab.deleteFromCache(e.getData("module"))},aftercreate_dv:function(e,t){if(t){for(var a=t.length,i=e.getData("tagnamevstagid"),o=e.getData("tagnamevsmodrefid"),s=e.getData("tagnamevscolor"),r=e.getData("tagnames"),n=0;n<a;n++){var l=t[n],d=l.modRefId,c=l.name;Lyte.objectUtils(e.getData("idvsname"),"add",d,c),i[c]=l.id,o[c]=d,s[c]=l.color_code,Lyte.objectUtils(e.getData("tagidvstagname"),"add",l.id,c);c=t[n].name;e.getData("tagnames").indexOf(c)&&Lyte.arrayUtils(e.getData("tagarray"),"push",{name:c,id:l.id,color_code:l.color_code}),r.push(c)}e.setData("tagnamevstagid",i),e.setData("tagnamevsmodrefid",o),e.setData("tagnamevscolor",s),e.setData("tagnames",r),e.addTags()}},methods:{onError:function(e,t){if(1===t.errorCode){renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters"));var a=document.querySelector("#defaulttag");null!==a&&(a.blur(),a.toggle("close"))}},validate_tags:function(e){var t;if(!(t=this.getData("tagnames").contains(e)?this.validatetags(e,this.getData("recordTagCount"),this.getData("selectedtags").length+1,0,0,"add","dv"):this.validatetags(e,this.getData("recordTagCount"),this.getData("selectedtags").length+1,this.getData("editionCount"),this.getData("tag").length+this.getData("added_count")+1,"add","dv"))){var a=document.querySelector("#defaulttag");return null!==a&&(a.blur(),a.toggle("close")),!1}if(!this.getData("tagnames").contains(e)){var i=this.getData("added_count");this.setData("added_count",i+1)}if(!t)return t;if(this.setData("saveEnabled",!1),"import"===this.getData("from")){var o=$L("#tagConfig");this.getData("tagnames").contains(e)||$("<input>",{type:"hidden",id:"newTags",name:"newTags",val:$ESAPI.encoder().encodeForHTML(e)}).appendTo(o)}return CrmTags.checkCharacter(e,!0)?void 0:(renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters")),a.blur(),a.toggle("close"),!1)},beforeremove:function(e){if(!this.data.tagnames.contains(e)){var t=this.getData("added_count");t--,this.setData("added_count",t)}var a=this.getData("removedtags"),i=null,o=null;a=""!==a?a+","+e:e;var s=this.getData("selectedtags"),r=s.length;for(p=0;p<r;p++){var n=s[p];if(n.name!==e||n.hasOwnProperty("isNewTag")){if(n.name===e&&n.hasOwnProperty("isNewTag")){t=this.getData("added_count");return this.setData("added_count",t),this.setData("removedtags",a),void this.setData("saveEnabled",!1)}}else i=n.color_code,n.hasOwnProperty("id")&&(o=n.id)}this.setData("removedtags",a),this.setData("saveEnabled",!1);for(var l=this.getData("tagarray"),d=l.length,c=!1,p=0;p<d;p++)l[p].name===e&&(c=!0);c||Lyte.arrayUtils(this.getData("tagarray"),"push",{name:e,color_code:i,id:o})},open_pop:function(){return null==document.querySelector(".alertPopup")&&(this.getData("inEditMode")?(this.setData("inEditMode",!1),!0):void 0)},hideColor:function(e,t){var a=this.$node.querySelector("lyte-popover"),i=a.component.childComp.querySelector("crux-tag"),o=i.component.bodyDrop.querySelector("crux-color-palette lyte-popover");!t||!t.target||a.component.childComp.contains(t.target)||i.component.bodyDrop.contains(t.target)||o.component.childComp.contains(t.target)||(i.toggle("close"),document.getElementById("detailview_add_tag").ltProp("show",!1),this.setData("inEditMode",!1))},hideColor2:function(e,t){var a=this.$node.querySelector("crux-tag"),i=a.component.bodyDrop.querySelector("crux-color-palette lyte-popover");t&&t.target&&!a.component.bodyDrop.contains(t.target)&&!i.component.childComp.contains(t.target)&&a.toggle("close")}},actions:{showAddTag:function(){$L("crux-tag").removeClass("eventNone");var e=Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags");if(this.getData("tooltip")===e&&detailView.isApproved){var t=moduleRecordMapping[this.getData("module")].api_name,a=this.getData("tagValuesNew").Tag,i=this.getData("tagarray");i&&this.setData("tagarray",""),store.findAll("tag",{module:t,fromPage:"view"},!0,!0,{apiVersion:"2.2"}).then((e=>{i&&this.setData("tagarray",[]),this.setData("tag",e);var t=0;this.getData("tagValuesNew").Tag&&(t=this.getData("tagValuesNew").Tag.length),t>3&&this.setData("count",t-3);var o=e.length,s=this.getData("tagnamevstagid"),r=(this.getData("tagidvstagname"),this.getData("tagnamevsmodrefid")),n=this.getData("tagnamevscolor");for(m=0;m<o;m++){Lyte.objectUtils(this.getData("idvsname"),"add",e[m].modRefId,e[m].name),name=e[m].name;var l=!!this.getData("tagValuesNew").Tag&&this.getData("tagValuesNew").Tag.includes(e[m].modRefId);"detailview"!==this.getData("from")||l||Lyte.arrayUtils(this.getData("tagarray"),"push",{name:name,id:e[m].id,color_code:e[m].color_code}),Lyte.arrayUtils(this.getData("tagnames"),"push",name)}for(var d=[],c=this.getData("displaytags"),p=c.length,m=0;m<p;m++)d.push(c[m].name);for(var u=d.length,g=[],y=0;y<u;y++)g.push(r[d[y]]);if(void 0!==(a=g))var v=a.length;var h=this.getData("idvsname");this.setData("selectedtags",[]);for(m=0;m<v;m++){var _=h[a[m]],f={name:_,id:s[_],color_code:n[_]};Lyte.arrayUtils(this.getData("selectedtags"),"push",f)}if(void 0===this.getData("displaytags")||0===this.getData("displaytags").length){var b=this.getData("selectedtags").slice();this.setData("displaytags",b)}var D=$L("#ApprovalProcess").children().length,I=this.getData("approvalState")&&"approved"!==this.getData("approvalState")&&"approval_process_rejected"!==this.getData("approvalState"),C=!!this.getData("recordLockingDetails")&&(this.getData("recordLockingDetails").isLocked&&this.getData("recordLockingDetails").restricted_actions.includes("tags")),w=this.getData("recordLockedinGDPR"),L=this.getData("tagsPermissionAvail"),R=this.getData("approvalState")&&"approved"!==this.getData("approvalState")&&"approval_process_rejected"!==this.getData("approvalState")&&"approval_process_pending"!==this.getData("approvalState")&&"review_process_rejected"!==this.getData("approvalState");if(Crm.userDetails.ISROMODE||I||R||C||w||!L)if(R?this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.reviewprocess.detailview.create.no.permission.msg")):I?comp.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):L?C||w?this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.lock.tag.restricted")):a.length>0||0===this.getData("selectedtags").length&&D||!D?this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg")):this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags")):(this.setData("tagged_icon",!1),$(".tagged_icon").hide(),this.setData("add_tag",!1),this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.tags.detailview.create.no.permission.msg"))),"import"!==this.getData("from")){this.disablecursor();n=this.tagnamevscolor}else $("#importTagFieldId").empty();else C?(comp.setData({add_tag:!1,tagged_icon:!1}),comp.disablecursor("default"),$L(".tag_edit_icon").hide()):this.setData("tooltip",Lyte.Component.registeredHelpers.getI18n("crm.label.add.tags"))})),document.getElementById("detailview_add_tag").ltProp("show",!0),this.setData("inEditMode",!0)}},hideAddTag:function(){this.setData("saveEnabled",!0);var e=$("#defaulttag")[0];""!==e.cxProp("inputValue")&&e.resetSearch();var t,a=this.getData("displaytags").slice(),i=this.getData("tagnamevscolor"),o=this.getData("tagnamevstagid"),s=[],r=a.length;for(t=0;t<r;t++)s[t]=a[t].name;o=this.getData("tagnamevstagid");var n=a.slice();r=n.length;for(t=0;t<r;t++){var l=n[t];if(!s.includes(l.name)){var d=l.name,c=i[d],p=o[d];l.id=p,l.color_code=c,Lyte.arrayUtils(this.getData("tagarray"),"push",l)}}this.setData("selectedtags",a),e.toggle("close"),document.getElementById("detailview_add_tag").ltProp("show",!1),this.setData("inEditMode",!1)},savetags:function(){var e=this.getData("selectedtags"),t=$L("#defaulttag")[0],a=$L("crux-tag");a.addClass("eventNone");var i=t.cxProp("inputValue");if(e.length===this.getData("recordTagCount")&&""!==i){var o=I18n.getMsg("crm.tags.records.limit.reached",this.getData("recordTagCount"));return _cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:o,ltPropContentAlign:"center"}}),a.removeClass("eventNone"),this.setData("inEditMode",!0),!1}if(""!==i){if(e.length>0)return a.removeClass("eventNone"),this.setData("inEditMode",!0),CrmTags.checkCharacter(i)?void renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.not.selected.text")):void renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters"));if(0===e.length)return renderingUtils.showAlertMsg(I18n.getMsg("crm.no.tag.selected")),a.removeClass("eventNone"),void this.setData("inEditMode",!0)}this.setData("saveEnabled",!0);var s=JSON.stringify(e);if(commonUtils.showHideLoadingDiv(!0),null!==e&&e.length>0&&s.includes('"isNewTag":true')){for(var r=this,n=moduleRecordMapping[r.getData("module")].api_name,l=e.length,d=[],c=0;c<l;c++)if(e[c].isNewTag){var p=e[c].color_code;"#noFill"!==p&&"noFill"!==p||(p=null);var m={name:e[c].name.replace(/  +/g," "),color_code:p};d.push(m)}r.createtagRec(d,r.getData("tagnames")),r.createtags(n,"dv","dv"),t.component&&void 0!==t.component.bodyDrop&&t.component.bodyDrop.querySelector("crux-color-palette").resetColorPalette()}else this.addTags();store.unloadAll("tag")}},didDestroy:function(){this.tagDVComp=null,window.removeEventListener("resize",this.applyResizeHeight)}},{mixins:["crm-tag-mixin"]}),Lyte.Component.register("crm-reviewprocess-detailview-header",{_template:'<template tag-name="crm-reviewprocess-detailview-header"> <template is="if" value="{{portalUser}}"><template case="true"> <div class="rpHeaders dIF aiCenter crm-base-font-size mR10"> <template is="if" value="{{expHandlers(rpRecordDtls.record_status,\'===\',&quot;pending_for_re-review&quot;)}}"><template case="true"> <div class="oH dF aiCenter"> <template is="if" value="{{isPending}}"><template case="true"> <span class="zcicncss-waitingreview zcicn-cssIcons zcicn_red_mask" id="pendingRpIcon"></span> <span class="mL7" id="pendingRereview" data-zcqa="rp_pendingForRereview">{{getI18n(\'crm.reviewprocess.record.rereview.pending\')}}</span> </template></template> </div> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(rpRecordDtls.record_status,\'===\',&quot;Rejected&quot;),\'&amp;&amp;\',expHandlers(portalEdit,\'!\'))}}"><template case="true"> <span class="crmNegativeColor">{{getI18n(\'crm.reviewprocess.record.rejected\')}}</span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(rpRecordDtls.record_status,\'===\',&quot;pending_for_review&quot;),\'||\',expHandlers(rpRecordDtls.record_status,\'===\',&quot;review_in_progress&quot;))}}"><template case="true"> <div class="oH dF aiCenter"> <template is="if" value="{{isPending}}"><template case="true"> <span class="zcicncss-waitingreview zcicn-cssIcons zcicn_red_mask" id="pendingRpIcon"></span> <span class="mL7" id="rPpendingStatus" data-zcqa="rp_reviewpending">{{getI18n(\'crm.reviewprocess.record.review.pending\')}}</span> </template></template> </div>  </template></template></template></template></template></template> </div></template><template case="false"> <div class="rpHeaders dIF aiCenter crm-base-font-size mR10"> <input type="hidden" id="rpFldIcon" value="0"> <div id="rpReasonForRejection" class="dN" data-rpresnforrejctn="{{rpRecordDtls.reasonForRejection}}"></div> <div id="rpPrevNext" class="rpPrevNext vaM mR5 {{if(expHandlers(rpRecordDtls.styledisplay,\'===\',\'none\'),\'dN\',\'dIB\')}}"> <span class="rpPrv dIB cP disable aligncenter" data-zcqa="rp_PrevRev" onclick="{{action(\'rpPrv\')}}"> <i class="dIB"></i> </span> <span class="rpNxt dIB vaM aligncenter" data-zcqa="rp_NxtRev" onclick="{{action(\'rpNxt\')}}"> <i class="dIB"></i> </span> </div> <div id="rPprogressCount" class="vaM {{if(expHandlers(rpRecordDtls.styledisplay,\'===\',\'none\'),\'dN\',\'dIB\')}}"> <span data-zcqa="rp_rpReviewedCount" id="rpReviewedCount">{{rpRecordDtls.reviewedCount}}</span> / <span id="rpReviewsCount" data-zcqa="rp_rpTotalCount">{{rpRecordDtls.rpTotalFields}} </span>{{getI18n(\'crm.reviewprocess.fields.reviewed\')}} </div> <div id="rPrejectedStatus" data-zcqa="rp_rprecordrejected" class="dN"> <span class="crmNegativeColor">{{getI18n(\'crm.reviewprocess.record.rejected\')}}</span> </div> <div id="rPreviewedStatus" class="dN"> <span class="crmGreenColor" data-zcqa="rp_rprecordreviewed">{{getI18n(\'crm.reviewprocess.record.reviewed\')}}</span> </div> <div class="{{if(expHandlers(portalUser,\'&amp;&amp;\',expHandlers(rpRecordDtls.record_status,\'===\',\'Rejected\')),\'canvas-cp-rp-reject\',\'\')}}"> <template is="if" value="{{expHandlers(rpRecordDtls.record_status,\'===\',&quot;pending_for_re-review&quot;)}}"><template case="true"> <div class="oH dF aiCenter"> <template is="if" value="{{isPending}}"><template case="true"> <span class="zcicncss-waitingreview zcicn-cssIcons zcicn_red_mask" id="pendingRpIcon"></span> <span class="mL7" id="pendingRereview" data-zcqa="rp_pendingForRereview">{{getI18n(\'crm.reviewprocess.record.rereview.pending\')}}</span> </template></template> </div> </template><template case="false"><template is="if" value="{{expHandlers(rpRecordDtls.record_status,\'===\',&quot;pending_for_review&quot;)}}"><template case="true"> <div class="oH dF aiCenter"> <template is="if" value="{{isPending}}"><template case="true"> <span class=" zcicncss-waitingreview zcicn-cssIcons zcicn_red_mask" id="pendingRpIcon"></span> <span class="mL7" id="rPpendingStatus" data-zcqa="rp_reviewpending">{{getI18n(\'crm.reviewprocess.record.review.pending\')}}</span> </template></template> </div> </template></template></template></template> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[3,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,3]},{type:"attr",position:[1,5]},{type:"attr",position:[1,5,1]},{type:"attr",position:[1,5,3]},{type:"attr",position:[1,7]},{type:"text",position:[1,7,1,0]},{type:"text",position:[1,7,3,0]},{type:"text",position:[1,7,4]},{type:"text",position:[1,9,1,0]},{type:"text",position:[1,11,1,0]},{type:"attr",position:[1,13]},{type:"attr",position:[1,13,1]},{type:"if",position:[1,13,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[3,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}],_observedAttributes:["rpRecordDtls","portalUser","portalEdit"],data:function(){return{rpRecordDtls:Lyte.attr("object"),portalUser:Lyte.attr("boolean",{default:!1}),portalEdit:Lyte.attr("boolean",{default:!1})}},init:function(){var e=this.getData("rpRecordDtls").reviewedCount,t=this.getData("rpRecordDtls").isResubmit;this.setData("isPending",!(void 0!==e&&0!==e||t))},actions:{rpNxt:function(){this.actions.rpNxtRev(this.getData("rpRecordDtls").module)},rpPrv:function(){this.actions.rpPrvRev(this.getData("rpRecordDtls").module)},rpNxtRev:function(e){var t=$L(".rpNxt"),a=$L(".rpPrv"),i=$L("#rpFldIcon"),o=$L(".rPgoNxtRev"),s=parseInt(i.val())+1,r=$L(".data-rpicon"+s),n=r.attr("data-rpfld"),l=renderingUtils.windowHeight;if(Crm.renderDVLyteFlow(e))var d=$L(".dv_content_tab_body");else d=$L("#dvinner");var c,p,m,u,g,y,v=d.scrollTop(),h=d.offset().top,_=r.offset().top,f=_+r.outerHeight()+v+100,b=f-l,D=Crm.userDetails.isSubformNewComponentEnabled?r.closest("crm-detail-view-subform").length>0:r.closest("table").is(".subformTabl");if(D&&(p=(c=Crm.userDetails.isSubformNewComponentEnabled?r.closest(".subformParentSection"):r.closest(".subFrmTablWrapper")).width(),m=c.offset().left,y=(C=(u=r.offset().left)-(g=m+p))+r.width()+c.scrollLeft()),f>l)d.scrollTop(b);else if(_<=h){d.scrollTop(0);var I=_-h;d.scrollTop(I)}if(D)if(u>=g)c.scrollLeft(y);else if(u<=m){c.scrollLeft(0);var C=u-m;c.scrollLeft(C)}i.val(s),n?(n=parseInt(n),o.removeClass("rPgoNxtRev"),r.addClass("rPgoNxtRev"),n<$L(".rpApproveRejIcon").length&&n>1?a.removeClass("disable"):n>=$L(".rpApproveRejIcon").length&&(1!==n&&a.removeClass("disable"),t.addClass("disable"))):this.rpNxtRev(e)},rpPrvRev:function(e){var t=$L(".rpNxt"),a=$L(".rpPrv"),i=$L(".rpApproveRejIcon").length,o=$L("#rpFldIcon"),s=$L(".rPgoNxtRev"),r=parseInt(o.val())-1,n=$L(".data-rpicon"+r),l=n.attr("data-rpfld"),d="#dvinner";if(Crm.renderDVLyteFlow(e))d=".dv_content_tab_body";var c,p,m,u,g,y=$L(d),v=renderingUtils.windowHeight,h=n.offset().top,_=y.scrollTop(),f=y.offset().top,b=h+n.outerHeight()+_+100,D=b-v,I=Crm.userDetails.isSubformNewComponentEnabled?n.closest("crm-detail-view-subform").length>0:n.closest("table").is(".subformTabl");if(I&&(p=(c=Crm.userDetails.isSubformNewComponentEnabled?n.closest(".subformParentSection"):n.closest(".subFrmTablWrapper")).offset().left,w=(m=n.offset().left)-(u=$L("#preHTMLContainer").width()),g=n.offset().left-renderingUtils.windowWidth+n.outerWidth()),b>v)y.scrollTop(D);else if(h<=f){y.scrollTop(0);var C=h-f;y.scrollTop(C)}if(I)if(m>=u)$L(".dv_content_tab_body").scrollLeft(g);else if(m<=p){c.scrollLeft(0);var w=m-p;c.scrollLeft(w)}o.val(r),l?(l=parseInt(l),s.removeClass("rPgoNxtRev"),n.addClass("rPgoNxtRev"),l>1&&l<i&&t.removeClass("disable"),1===l&&(l!==i&&t.removeClass("disable"),a.addClass("disable"))):this.rpPrvRev(e)}}}),Lyte.Component.register("crm-detail-view-avatarupload",{_template:'<template tag-name="crm-detail-view-avatarupload"> <div class="pR photoUploadSec" id="photoUploadSecedit_{{entityId}}" lt-prop-appearance="default"> <lyte-menu lt-prop-yield="true" on-before-open="{{method(\'checkOptionsForImage\')}}" lt-prop-query="#photoUploadSecedit_{{entityId}}" id="profOptionsList"> <template is="registerYield" yield-name="yield"> <lyte-menu-body id="photoMenu"> <lyte-menu-group> <lyte-menu-item data-zcqa="preview" id="preview" onclick="{{action(\'trigger_action\',\'preview\',this,event)}}"> {{getI18n(\'crm.recordImage.previewimage\')}} </lyte-menu-item> <lyte-menu-item data-zcqa="upload" id="upload" onclick="{{action(\'trigger_action\',\'upload\',this,event)}}"> {{getI18n(\'crm.FileuploadField.addNewImage\')}} </lyte-menu-item> </lyte-menu-group> <lyte-menu-item data-zcqa="remove" id="remove" onclick="{{action(\'trigger_action\',\'remove\',this,event)}}"> {{getI18n(\'crm.lar.ruleEntry.dontassociate\')}} </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <template is="if" value="{{readOnly}}"><template case="true"> <div tabindex="0" lt-prop-aria-keydown="true" role="button" class="lnPhoto pR dIB profileReadOnly" onmouseover="{{action(\'showReadOnlyTooltip\')}}" onmouseout="{{action(\'hideReadOnlyTooltip\')}}" onclick="{{action(\'previewPhoto\')}}"> <div tabindex="0" lt-prop-aria-keydown="true" role="button" class="LnuploadPhoto" onclick="sE(event);"> <div tabindex="0" lt-prop-aria-keydown="true" role="button" class="cameraIcon" onmouseover="{{action(\'showReadOnlyTooltip\')}}" onmouseout="{{action(\'hideReadOnlyTooltip\')}}" onclick="{{action(\'previewPhoto\')}}"> </div> </div> <template is="if" value="{{expHandlers(currmoduleName,\'===\',\'Accounts\')}}"><template case="true"> <template is="if" value="{{recordImage}}"><template case="true"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}" class="accLogo"> </div> </template><template case="false"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="emptyAccLogo dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}"> </div> </template></template></template><template case="false"> <template is="if" value="{{recordImage}}"><template case="true"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}" class="dvPhotoShadow"> </div> </template><template case="false"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvemptyImgContainer emptyLCPhoto dvprofileimage crmWhiteColor aligncenter ttCapitalize crm-font-thin"> </div> </template></template></template></template> </div> <input type="hidden" value="true" name="isNewUpload" id="isNewUpload"> <input type="hidden" value="{{avatar}}" name="imageSrc" id="imageSrc"> <input type="hidden" value="{{recordImage}}" name="photoID" id="photoID"> </template><template case="false"> <div tabindex="0" lt-prop-aria-keydown="true" aria-lable="{{getI18n(\'crm.imageType.profilePic\')}}" role="button" class="lnPhoto pR dIB {{if(editRestricted,\'profileReadOnly\',\'\')}}" onclick="{{action(\'checkOptionsForImage\')}}"> <div class="LnuploadPhoto"> <div tabindex="0" lt-prop-aria-keydown="true" role="button" class="cameraIcon" onclick="{{action(\'checkOptionsForImage\')}}"> </div> </div> <template is="if" value="{{expHandlers(currmoduleName,\'===\',\'Accounts\')}}"><template case="true"> <template is="if" value="{{recordImage}}"><template case="true"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}" class="accLogo"> </div> </template><template case="false"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="emptyAccLogo dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}"> </div> </template></template></template><template case="false"> <template is="if" value="{{recordImage}}"><template case="true"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvprofileimage crmWhiteColor aligncenter ttCapitalize "> <img id="{{currmoduleName}}_{{entityId}}_photo" src="{{avatar}}" class="dvPhotoShadow"> </div> </template><template case="false"> <div id="imgContainer" data-zcqa="detailViewLyteimgContainer" class="dvemptyImgContainer emptyLCPhoto dvprofileimage crmWhiteColor aligncenter ttCapitalize crm-font-thin"> </div> </template></template></template></template> <input type="hidden" value="true" name="isNewUpload" id="isNewUpload"> <input type="hidden" value="{{avatar}}" name="imageSrc" id="imageSrc"> <input type="hidden" value="{{recordImage}}" name="photoID" id="photoID"> </div> <template is="if" value="{{recordImage}}"><template case="true"> <div id="zia-vision-popup"></div> </template></template> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(approvalState,\'===\',\'approval_process_pending\'),\'&amp;&amp;\',expHandlers(editAllowedAp,\'!\')),\'||\',expHandlers(approvalState,\'===\',\'merge_pending\'))}}"><template case="true"> <span class="approval-headerlock-container dIB vaM"><span class="zcicn_white_mask zcicncss-waitingapproval zcicn-cssIcons approvalheaderlockicon dIB"></span></span> </template><template case="false"><template is="if" value="{{editRestricted}}"><template case="true"> <span class="approval-headerlock-container dIB vaM"><span class="ico-lock-small-fill-white svgIcons approvalheaderlockicon dIB"></span></span> </template><template case="false"><template is="if" value="{{expHandlers(approvalState,\'===\',\'review_process_pending\')}}"><template case="true"> <span class="approval-headerlock-container dIB vaM"><span class="zcicn_white_mask zcicncss-waitingreview zcicn-cssIcons approvalheaderlockicon dIB"></span></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(endsWith(avatar,&quot;.svg&quot;),\'!\'),\'&amp;&amp;\',renderDidIcon),\'&amp;&amp;\',expHandlers(isInZiaProcess,\'!\')),\'&amp;&amp;\',recordImage),\'&amp;&amp;\',expHandlers(gdprLock,\'!\'))}}"><template case="true"> <duplicate-image-detection-icon avatar="{{avatar}}" is-detail="true" module-name="{{currmoduleName}}" config-id="{{didConfigId}}" record-id="{{entityId}}"></duplicate-image-detection-icon> </template></template></template></template></template></template></template></template> <div class="visitorOnlineBcView visitorOnlineBCView_{{entityId}} {{if(isOnline,\'\',\'dN\')}}"></div> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"text",position:[1,1,3,1]},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[5]},{type:"attr",position:[7]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,7]},{type:"attr",position:[1,9]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,7]}],_observedAttributes:["currmoduleName","dataBind","currentLayout","class","recordImage","haveImagesource","imageSource","entityId","entityName","uploadId","avatar","readOnly","isOnline","isInZiaProcess","approvalState","gdprLock","editRestricted","ziaVisionStage","insights","ziaVisionId","ziaVisionApprovalId","editAllowedAp","renderDidIcon","isDidClick","didConfigId","skipPermission"],data:function(){return{currmoduleName:Lyte.attr("string"),dataBind:Lyte.attr("object"),currentLayout:Lyte.attr("string"),class:Lyte.attr("string"),recordImage:Lyte.attr("string"),haveImagesource:Lyte.attr("boolean",{default:!1}),imageSource:Lyte.attr("string"),entityId:Lyte.attr("string",{default:""}),entityName:Lyte.attr("string",{default:""}),uploadId:Lyte.attr("string",{default:null}),avatar:Lyte.attr("string"),readOnly:Lyte.attr("boolean",{default:!1}),isOnline:Lyte.attr("boolean",{default:!1}),isInZiaProcess:Lyte.attr("boolean",{default:!1}),approvalState:Lyte.attr("string"),gdprLock:Lyte.attr("boolean",{default:!1}),editRestricted:Lyte.attr("boolean",{default:!1}),ziaVisionStage:Lyte.attr("string"),insights:Lyte.attr("array"),ziaVisionId:Lyte.attr("string",{default:""}),ziaVisionApprovalId:Lyte.attr("string",{default:""}),editAllowedAp:Lyte.attr("boolean",{default:!1}),renderDidIcon:Lyte.attr("boolean",{default:!1}),isDidClick:Lyte.attr("boolean",{default:!1}),didConfigId:Lyte.attr("string"),skipPermission:Lyte.attr("boolean",{default:!1})}},init:function(){var e=this.getData("recordImage"),t=this.getData("currmoduleName"),a=this.getData("entityId");this.setData("dataBind",store.peekRecord(moduleRecordMapping[t].id,a));var i,o=this.getData("skipPermission"),s="crm.tab.module.create"===Lyte.Router.getRouteInstance().transition.info.route&&Lyte.Router.getRouteInstance().transition.data.isWizard;e?(i=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+t+(s?"":"&entityId="+a)+"&actionName=readImage&fileId="+e,o&&(i+="&skipPermission=true")):i="Accounts"===t?networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM):networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM),this.setData("avatar",i);var r=this.getData("approvalState"),n=this.getData("editRestricted");("approval_process_pending"!==r&&"approval_process_rejected"!==r||this.getData("editAllowedAp"))&&"merge_pending"!==r&&!n&&"review_process_pending"!==r||this.setData("readOnly",!0);var l=this.getData("insights");if(l)for(var d=l.length,c=0;c<d;c++){var p=l[c];if(void 0!==p&&p.hasOwnProperty("approval_details"))for(var m=p.approval_details,u=m?m.length:0,g=0;g<u;g++){var y=m[g].vision;"Record_Image"===y.field.api_name&&(this.setData("ziaVisionStage",m[g].type),this.setData("ziaVisionApprovalId",m[g].id),this.setData("ziaVisionId",y.id))}}},didConnect:function(){var e=this.getData("entityName");if(void 0!==e&&$L(".dvemptyImgContainer").html(Handlebars.helpers.encodeHTML(e.substring(0,1))),this.setData("isOnline",this.isEntityOnline(this.getData("currmoduleName"),this.getData("entityId"))),this.getData("ziaVisionApprovalId")){var t=$L(".photoUploadSec"),a=$L(".lnPhoto");a.find("img").hide();var i=Crm.getVisionMyJobsDependency(),o=this;Lyte.injectResources(i,void 0,(function(){!function(){var e=o.getData("currmoduleName"),i=o.getData("entityId"),s=o.getData("ziaVisionStage"),r=o.getData("ziaVisionApprovalId"),n=o.getData("ziaVisionId");t.addClass("cP"),o.setData("isInZiaProcess",!0),"image_processing"===o.getData("ziaVisionStage")?(a.addClass("lnPhoto_ziaVision lnPhoto_ziaVision_processing"),t.attr({onclick:"detailView.renderVisionErrorPopUp('"+s+"','"+e+"','"+i+"','"+n+"','undefined',"+!1+","+!0+")",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.processing.image")+"')",onmouseleave:"crmui.hideTooltip();"}),Lyte.Component.render("crm-zia-vision-error-popup",{action:s},"#zia-vision-popup")):(a.addClass("lnPhoto_ziaVision"),t.attr({onclick:"detailView.renderVisionErrorPopUp('"+s+"','"+e+"','"+i+"','"+n+"','"+r+"',"+!1+","+!0+")",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.validation.failure.msg")+"')",onmouseleave:"crmui.hideTooltip();"}),Lyte.Component.render("crm-zia-vision-error-popup",{action:s,moduleName:e,isDetailPage:!0,entityId:i,visionId:n,approvalId:r},"#zia-vision-popup"))}()}))}if(featuresAvailable.DUPLICATE_IMAGE_DETECTION){var s=this,r=Lyte.Router.getRouteInstance().getQueryParams(),n=r.wizardId&&r.wizardId.length>1,l=networkUtils.returnDependencyFiles(["duplicate-image-detection-icon.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("DuplicateImageDetection")],ResourceConstants.CRM),c=networkUtils.returnDependencyFiles(["duplicate-image-detection-icon.css","zia/zia-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);l=l.concat(c).concat(d),Lyte.injectResources([networkUtils.returnDependencyFiles(["duplicate-image-detection-model.js"],ResourceConstants.CRMClient)],void 0,(function(){store.findAll("duplicate_image_detection",{module:moduleApiMapping[s.getData("currmoduleName")]}).then((function(e){e&&e[0]&&"completed"===e[0].status&&e[0].enabled&&!n&&Lyte.injectResources(l,void 0,(function(){s.setData("didConfigId",e[0].id),s.setData("renderDidIcon",!0)}))}))}))}},isEntityOnline:function(){return!("object"!=typeof CrmTracking||!CrmTracking.isEntityOnline(this.getData("currmoduleName"),this.getData("entityId")))},editRestrictedObserver:function(){this.setData("readOnly",this.getData("editRestricted"));var e=this.getData("entityName");void 0!==e&&$L(".dvemptyImgContainer").html(e.substring(0,1))}.observes("editRestricted","readOnly"),methods:{setImgTagOnUpload:function(){var e=this.getData("currmoduleName")+"_"+this.getData("entityId")+"_photo",t=`<img id=${e} src=${this.getData("avatar")} class="accLogo" ></img>`,a=this.$node.querySelector(".dvemptyImgContainer");a?a.innerHTML=t:this.$node.querySelector("#"+e).getAttribute("src").valueOf(this.getData("avatar"))},checkOptionsForImage:function(){return this.getData("readOnly")||this.getData("isInZiaProcess")||this.getData("editRestricted")||this.getData("isDidClick")?(this.setData("isDidClick",!1),!1):checkOptionsForImage(this.getData("currmoduleName"),this.getData("entityId"))},setUploadIdinEntityRecord:function(){var e=this.$node.component.data;Lyte.Component.set(e.dataBind,e.Record_Image,e.uploadId)},syncLatestAvatar:function(){this.setData("avatar",$L("#imageSrc").val())}},actions:{trigger_action:function(e,t){switch(e){case"preview":previewPhoto(this.getData("entityId"));break;case"upload":showUploadPhoto(this.getData("currmoduleName"),this.getData("entityId"),"ajaxEdit");break;case"remove":var a=this.getData("entityId"),i=this.getData("currmoduleName");setTimeout((function(){showDeletePopup(I18n.getMsg("crm.image.remove.confirm"),I18n.getMsg("crm.workflow.rule.tag.remove.popup.confirm.button"),"","",t),document.getElementById("deleteButton").setAttribute("onclick","alertDeleteEntityImage('"+a+"','"+i+"','"+I18n.getMsg("crm.image.remove.confirm")+"');")}),5)}},checkOptionsForImage:function(){return!this.getData("readOnly")&&!this.getData("editRestricted")&&checkOptionsForImage(this.getData("currmoduleName"),this.getData("entityId"))},previewPhoto:function(){previewPhoto(this.getData("entityId"))},showUploadPhoto:function(e,t,a,i){showUploadPhoto(t,a,i),$(".profOptionList").addClass("dN")},showDeletePopup:function(e,t,a,i,o,s){showDeletePopup(t,a,i,o,s),$(".profOptionList").addClass("dN")},showReadOnlyTooltip:function(){this.getData("skipPermission")||renderingUtils.zctt.showtt(I18n.getMsg("crm.lable.read.only"))},hideReadOnlyTooltip:function(){renderingUtils.zctt.hidett()}}},{mixins:["crm-stop-event"]});
