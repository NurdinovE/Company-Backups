Lyte.Component.register("crm-tag-modal",{_template:'<template tag-name="crm-tag-modal" id="{{popUp}}_TagComp_{{from}}"> <template is="if" value="{{expHandlers(from,\'==\',&quot;convert&quot;)}}"><template case="true"> <template is="if" value="{{tagAvail()}}"><template case="true"> <lyte-table lt-prop-yield="true" class="convertLeadTagsMassConvert w500"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <lyte-tr class="convertLeadTagsMassConvertTr"> <lyte-td class="convertLeadTagsMassConvertTd vaT w170 crm-base-font-size crmBaseColor">{{getI18n(\'crm.tags.single.convert.info\')}}</lyte-td> <lyte-td class="convertLeadTagsMassConvertTd"> <div class="carryOverTag pB15"> <lyte-checkbox id="conTagCheck" lt-prop-label="{{contacts_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none;"> <crux-tag id="conTag" cx-prop-class="cxTags_conTag" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;conTag&quot;)}}"> </crux-tag> </div> </div> <div class="carryOverTag pB15"> <lyte-checkbox id="accTagCheck" lt-prop-label="{{acc_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none"> <crux-tag id="accTag" cx-prop-class="cxTags_accTag" cx-prop-tag-options="{{lbind(tagarray_Acc)}}" cx-prop-tags="{{lbind(selectedtags_Acc)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;accTag&quot;)}}"> </crux-tag> </div> </div> <div class="carryOverTag disabled crmBaseColor eventNone" id="pot_tag_checkbox"> <lyte-checkbox id="potTagCheck" lt-prop-label="{{deal_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none"> <crux-tag id="potTag" cx-prop-class="cxTags_potTag" cx-prop-tag-options="{{lbind(tagarray_Pot)}}" cx-prop-tags="{{lbind(selectedtags_Pot)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;potTag&quot;)}}"> </crux-tag> </div> </div> </lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </template></template> </template><template case="false"> <lyte-modal lt-prop-yield="true" id="{{popUp}}_TagPopUp" lt-prop-close-on-escape="{{expHandlers(isCommandCenterService,\'!\')}}" lt-prop-show-close-button="false" lt-prop-show="true" lt-prop-width="600px" lt-prop-freeze="true" lt-prop-wrapper-class="tagPopUpClass" lt-prop-allow-multiple="true" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" on-before-close="{{method(\'beforeTagPopUpClose\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{tagPopUpName}}</lyte-modal-header> <lyte-modal-content> <template is="if" value="{{isPreview}}"><template case="true"> <crux-tag-component cx-prop-value="{{tagarray_Preview}}"></crux-tag-component> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(popUp,\'==\',&quot;add&quot;),\'||\',expHandlers(popUp,\'==\',&quot;edit&quot;))}}"><template case="true"> <crux-tag id="tag_popup_{{from}}_add" cx-prop-id="{{popUp}}_TagPopUp" cx-prop-class="tags_{{from}}" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-prevent-key-list="[&quot;<&quot;,&quot;>&quot;,&quot;,&quot;]" on-error="{{method(\'onError\')}}" on-before-add-tag="{{method(&quot;validate_tag&quot;,&quot;add&quot;)}}" on-before-remove-tag="{{method(&quot;beforeremove&quot;)}}" on-remove-tag="{{method(&quot;removeTag&quot;)}}" on-add-tag="{{method(&quot;addTagCrux&quot;)}}"> </crux-tag> </template><template case="false"> <crux-tag id="tag_popup_{{from}}_remove" cx-prop-class="tags_{{from}}" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-allow-new-tag-creations="false" on-before-add-tag="{{method(&quot;validate_tag&quot;,&quot;remove&quot;)}}" on-remove-tag="{{method(&quot;removeTag&quot;)}}" on-add-tag="{{method(&quot;addTagCrux&quot;)}}"> </crux-tag> </template></template></template></template> <div class="pT10 dIB t_options" style="display: flex;"> <template is="if" value="{{expHandlers(expHandlers(popUp,\'==\',&quot;add&quot;),\'&amp;&amp;\',expHandlers(fromQuickActionsMenu,\'!\'))}}"><template case="true"> <lyte-checkbox lt-prop-disabled="{{isPreview}}" id="overwriteCheckbox_{{from}}" lt-prop-type="default" lt-prop-checked="{{lbind(isOverWrite)}}"></lyte-checkbox> <div class="dIB fL pT2">{{getI18n(\'crm.tag.record.overwrite\')}}</div> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(popUp,\'!=\',&quot;edit&quot;),\'&amp;&amp;\',expHandlers(popUp,\'!=\',&quot;add&quot;))}}"><template case="true"> <div class="dIB fL pT2">{{getI18n(\'crm.remove.tag.info\')}}</div> </template></template></template></template> </div> </lyte-modal-content> <lyte-modal-footer> <template is="if" value="{{expHandlers(expHandlers(isPreview,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(popUp,\'==\',&quot;add&quot;),\'||\',expHandlers(popUp,\'==\',&quot;edit&quot;)))}}"><template case="true"> <div class="footer_tagline fL crm-small-font-size crmLabelColor">{{getI18n(\'crm.tags.separate.info\')}}</div> </template></template> <template is="if" value="{{isPreview}}"><template case="true"> <lyte-button data-zcqa="close_btn" id="crCancelBtn" onclick="{{action(\'closeModalpop\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.close\')}}</template> </lyte-button> </template><template case="false"> <div class="fR"> <lyte-button id="tagModalCancelBtn_{{from}}" lt-prop-appearance="default" lt-prop-class="mR0" data-zcqa="{{concat(\'tagModal_\',popUp,\'_CancelBtn\')}}" onclick="{{action(\'closeModalpop\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Cancel\')}}</template> </lyte-button> <template is="if" value="{{expHandlers(expHandlers(popUp,\'==\',&quot;add&quot;),\'||\',expHandlers(popUp,\'==\',&quot;edit&quot;))}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-disabled="{{if(disableSaveFromQuickactions,\'true\',\'false\')}}" lt-prop-class="mR0" data-zcqa="{{concat(\'tagModal_\',popUp,\'_SaveBtn\')}}" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'add\')}}"> <template is="registerYield" yield-name="text">{{saveBtmMessage}}</template> </lyte-button> </template><template case="false"> <template is="if" value="{{expHandlers(from,\'===\',\'wf\')}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-class="mR0" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'remove\')}}"> <template is="registerYield" yield-name="text">{{saveBtmMessage}}</template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-appearance="failure" lt-prop-class="mR0" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'remove\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.remove\')}}</template> </lyte-button> </template></template> </template></template> </div> <div class="cBoth"></div> </template></template> </lyte-modal-footer> </template> </lyte-modal> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"componentDynamic",position:[1,1,1,1]},{type:"attr",position:[1,1,1,3,1,1]},{type:"componentDynamic",position:[1,1,1,3,1,1]},{type:"attr",position:[1,1,1,3,1,3,1]},{type:"componentDynamic",position:[1,1,1,3,1,3,1]},{type:"attr",position:[1,1,1,3,3,1]},{type:"componentDynamic",position:[1,1,1,3,3,1]},{type:"attr",position:[1,1,1,3,3,3,1]},{type:"componentDynamic",position:[1,1,1,3,3,3,1]},{type:"attr",position:[1,1,1,3,5,1]},{type:"componentDynamic",position:[1,1,1,3,5,1]},{type:"attr",position:[1,1,1,3,5,3,1]},{type:"componentDynamic",position:[1,1,1,3,5,3,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,3,1]},{type:"if",position:[3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[5,3]},{type:"if",position:[5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["moduleInfo","module","PopUpName","alltags","renderItems","newTagSysVal","message","undef","maxTagLimit","newTagCount","recordTagLimit","placeHolder","tagarray","tagarray_Preview","tagnamevstagid","selectedtags","selectedtaginfo","tagarray_Acc","tagarray_Pot","selectedtags_Acc","selectedtags_Pot","isOverWrite","isOrchestration","isCommandCenterService","isPreview","contacts_label","acc_label","deal_label","saveBtmMessage","tagnamevsmodrefid","fromQuickActionsMenu","recordObjForQuickAction","inputData","disableSaveFromQuickactions"],data:function(){return{moduleInfo:Lyte.attr("object"),module:Lyte.attr("string"),PopUpName:Lyte.attr("string"),alltags:Lyte.attr("array",{default:[]}),renderItems:Lyte.attr("array",{default:[]}),newTagSysVal:Lyte.attr("string"),message:Lyte.attr("string"),undef:Lyte.attr("number",{default:void 0}),maxTagLimit:Lyte.attr("number"),newTagCount:Lyte.attr("number",{default:0}),recordTagLimit:Lyte.attr("number"),placeHolder:Lyte.attr("string"),tagarray:Lyte.attr("array",{default:[]}),tagarray_Preview:Lyte.attr("array",{default:[]}),tagnamevstagid:Lyte.attr("object",{default:{}}),selectedtags:Lyte.attr("array",{default:[]}),selectedtaginfo:Lyte.attr("array",{default:[]}),tagarray_Acc:Lyte.attr("array",{default:[]}),tagarray_Pot:Lyte.attr("array",{default:[]}),selectedtags_Acc:Lyte.attr("array",{default:[]}),selectedtags_Pot:Lyte.attr("array",{default:[]}),isOverWrite:Lyte.attr("boolean",{default:!1}),isOrchestration:Lyte.attr("boolean",{default:!1}),isCommandCenterService:Lyte.attr("boolean",{default:!1}),isPreview:Lyte.attr("boolean",{default:!1}),contacts_label:Lyte.attr("string"),acc_label:Lyte.attr("string"),deal_label:Lyte.attr("string"),saveBtmMessage:Lyte.attr("string"),tagnamevsmodrefid:Lyte.attr("object",{default:{}}),fromQuickActionsMenu:Lyte.attr("boolean",{default:!1}),recordObjForQuickAction:Lyte.attr("object",{default:{}}),inputData:Lyte.attr("object"),disableSaveFromQuickactions:Lyte.attr("boolean",{default:!1})}},idvsname:{},tagnamevscolor:{},tagnames:[],tags_convert:[],tagrefidvsname:{},init:function(){var t=this.getData("module");this.setData("moduleInfo",moduleRecordMapping[t]),this.setData("isCommandCenterService",$L("crm-cc-actions").length>0);var e=this.getData("popUp");"add"===e?(this.setData("tagPopUpName",I18n.getMsg("crm.label.add.tags")),this.setData("currentPopup","add_tags")):"edit"===e?(this.setData("tagPopUpName",I18n.getMsg("crm.label.edit.module",I18n.getMsg("crm.label.small.tags"))),this.setData("currentPopup","edit_tags")):(this.setData("tagPopUpName",I18n.getMsg("crm.label.remove.tags")),this.setData("currentPopup","remove_tags")),"convert"===this.getData("from")&&(this.setData("contacts_label",moduleRecordMapping.Contacts.singular_label),this.setData("acc_label",moduleRecordMapping.Accounts.singular_label),this.setData("deal_label",moduleRecordMapping.Potentials.singular_label)),this.setData("saveBtmMessage",I18n.getMsg("crm.button.save"));for(var a=this.getData("alltags"),o=this.getData("selectedtaginfo"),s=a.length,r=0;r<s;r++)if(o.includes(a[r].name)){var i={name:a[r].name,color_code:a[r].color_code};Lyte.arrayUtils(this.getData("tagarray_Preview"),"push",i)}},didConnect:function(){for(var t={},e={},a={},o={},s=[],r=this.getData("alltags"),i=r.length,n=0;n<i;n++){t[r[n].name]=r[n].color_code,e[r[n].name]=r[n].id,a[r[n].modRefId]=r[n].name,o[r[n].name]=r[n].modRefId,s.push(r[n].name);var c={name:r[n].name,color_code:r[n].color_code};Lyte.arrayUtils(this.getData("tagarray"),"push",c)}if(this.tagnamevscolor=t,this.tagrefidvsname=a,this.setData("tagnamevscolor",t),this.setData("tagnamevstagid",e),this.setData("tagrefidvsname",a),this.setData("tagnamevsmodrefid",o),this.tagnames=s,"convert"===this.getData("from")){this.setData("tagarray",[]);var l=this.getData("tagnamevscolor"),d=this.getData("tagnamevstagid"),p=CrmTags.clientJSON.array,g=(i=p.length,this.getData("tagrefidvsname"));for(n=0;n<i;n++){var m={name:v=g[p[n]],id:d[v],color_code:l[v]};Lyte.arrayUtils(this.getData("selectedtags"),"push",m),Lyte.arrayUtils(this.getData("selectedtags_Acc"),"push",m),Lyte.arrayUtils(this.getData("selectedtags_Pot"),"push",m)}}else{var u=this.getData("selectedtaginfo"),y=this.getData("popUp");y&&"edit"===y&&this.getData("fromQuickActionsMenu")&&(u=this.getData("recordObjForQuickAction").Tag.map((t=>t.name)));var f=u.length;for(e=this.getData("tagnamevstagid"),t=this.tagnamevscolor,n=0;n<f;n++){var v,h=e[v=u[n]],D=t[v];this.getData("isOrchestration")&&void 0===D&&void 0===h&&(h=e[v=CrmTags.gettagname(v,"tagname")],D=t[v]);c={name:v,id:h,color_code:D};Lyte.arrayUtils(this.getData("selectedtags"),"push",c)}}},didDestroy:function(){window.removeEventListener("resize",this.windowResize)},closeModal:function(){for(var t=$("crux-tag"),e=t.length,a=0;a<e;a++){var o=t[a];o.resetSearch(),o.toggle("close"),o.component&&void 0!==o.component.bodyDrop&&o.component.bodyDrop.querySelector("crux-color-palette").resetColorPalette()}var s=this.getData("popUp")+"_TagPopUp",r=document.getElementById(s);r&&r.ltProp("show",!1),this.getData("fromQuickActionsMenu")&&(customViewObject.selectedIdForQuickAction=[],this.setData("fromQuickActionsMenu",!1));var i=$L("crm-kiosk-builder")[0];this.getData("isPreview")&&i&&(($L("#kioskDisconnectedCompConnect").length>0||$L("crm-kiosk-disconnected-components-popup").length>0)&&($L("#commonActionPage").removeClass("kioskActionPopZInd"),$L("#FreezeLayer").removeClass("kioskLeftPanActionZInd")),i.component.setData("isKioskStateClicked",!1))},showMsg:function(t,e,a,o){for(var s,r=!1,i=!1,n=e.data,c=0,l=0,d=0,p=n.length,g=0;g<p;g++)"permission denied to  update records"===n[g].message?c++:"Sorry, you cannot perform this operation as the record is locked."===n[g].message&&l++;if(a)s=I18n.getMsg("crm.tags.list.view.updated.successfully"),i=!0;else if(t.length==e.success_count)s=I18n.getMsg("crm.tags.list.view.added.successfully"),i=!0;else if(0==e.success_count||o)s=0==e.locked_count?1==t.length?I18n.getMsg("crm.tags.list.view.single.record.limit.reached",this.getData("recordTagLimit")):I18n.getMsg("crm.tags.list.view.all.records.limit.reached",this.getData("recordTagLimit")):1==t.length?I18n.getMsg("crm.tags.list.view.single.record.locked"):e.locked_count===l?I18n.getMsg("crm.record.lock.listview.popup","Add Tags",l):"<p id='secondMsg' class='crm-base-font-size pT5 pB5'>"+I18n.getMsg("crm.tags.list.view.some.record.not.updated",[t.length-e.locked_count])+"<br>"+I18n.getMsg("crm.tags.list.view.some.record.locked",[e.locked_count])+"</p>",r=!0;else{var m=e.success_count;s=t.length>1?'<p id="firstMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg1",m)+"</p>":"",c>0&&(s+='<p id="firstMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.list.view.perm.denied",c)+"</p>");var u=t.length-m-e.locked_count-c;u>0?0==e.locked_count?s+='<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg2",[u,this.getData("recordTagLimit")])+"</p>":s+='<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg3",[u,this.getData("recordTagLimit")])+"<br>"+I18n.getMsg("crm.tags.list.view.some.records.locked.remaining",[e.locked_count])+"</p>":e.locked_count>0&&(d=e.locked_count-l,s+=d>0&&l>0?'<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.list.view.some.records.locked.remaining",d)+"<br>"+I18n.getMsg("crm.record.lock.listview.popup",["Add Tags",l])+"</p>":d>0?'<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.tags.list.view.some.records.locked.remaining",d)+"</p>":'<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.record.lock.listview.popup",["Add Tags",l])+"</p>"),r=!0}i?_cruxUtils.showCustomMessage({params:{ltPropMessage:s}}):r&&setTimeout((function(){renderingUtils.showAlertMsg(s)}),500)},addTags:function(t){var e="",a=this.getData("selectedtags");this.getData("fromQuickActionsMenu")&&"edit"===this.getData("popUp")&&0===a.length&&(a=this.getData("recordObjForQuickAction").Tag);var o,s,r=a.length,i=this,n=this.data.fromQuickActionsMenu?customViewObject.selectedIdForQuickAction:customViewObject.selectedIds,c=Lyte.Router.getRouteInstance();for(o=void 0!==this.getData("moduleInfo")?this.getData("moduleInfo").api_name:this.getData("module"),s=0;s<r;s++)e=""===e?a[0].name.replace(/  +/g," "):e+","+a[s].name.replace(/  +/g," ");var l={over_write:p,type:"POST",fromPage:"view",module:o,from:this.getData("from")};if("Bundles__s"===o){var d={tags:a,ids:"["+n.join(",")+"]",over_write:p};l.tag_names=d,l.ids="["+n.join(",")+"]"}else l.tag_names=e,l.ids=n.join(",");if("add"===t){var p=!!("edit_tags"===this.getData("currentPopup")||"add_tags"===this.getData("currentPopup")&&this.getData("fromQuickActionsMenu"))||document.querySelector("#overwriteCheckbox_list").checked;l.over_write=p;var g={affected_data:!0};store.triggerAction("entity","add_tags",l,g).then((function(t){"list"===c.routeName||"kanban"===c.routeName?crmListView.reloadCurrentListView():(customViewObject.selectedIds=[],c.refresh().data={fetchOnlyBody:!0,clearCache:!0}),i.closeModal(),"permission denied to  update records"===t.message||"FAILURE"===t.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.add.tags.per.den.all.record")}}):i.showMsg(n,t,p)}),(function(t){var e=JSON.parse(t.response);e.data&&e.data[0]&&"CANNOT_PROCESS"===e.data[0].code?("list"!==c.routeName&&"kanban"!==c.routeName||crmListView.reloadCurrentListView(),i.showMsg(n,e,p)):i.ShowTagErrorMsg(t),commonUtils.showHideLoadingDiv(),i.closeModal()}))}else store.triggerAction("entity","remove_tags",l).then((function(t){if(c.parent&&c.parent.parent&&"voc"===c.parent.parent.routeName&&(customViewObject.selectedIds=[]),crmListView.reloadCurrentListView(),i.closeModal(),"permission denied to  update records"===t.message||"FAILURE"===t.code)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.add.tags.per.den.all.record")}});else if(t.locked_count>0){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM);Lyte.injectResources(e,void 0,(function(){var e='<p id="secondMsg" class="crm-base-font-size pT5 pB5">'+I18n.getMsg("crm.record.lock.listview.popup",["Remove Tags",t.locked_count])+"</p>";setTimeout((function(){renderingUtils.showAlertMsg(e)}),500)}))}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.removed.successfully")}})}),(function(t){var e=JSON.parse(t.response);e.data&&e.data[0]&&"CANNOT_PROCESS"===e.data[0].code?("list"!==c.routeName&&"kanban"!==c.routeName||crmListView.reloadCurrentListView(),i.showMsg(n,e,p,!0)):i.ShowTagErrorMsg(t),commonUtils.showHideLoadingDiv(),i.closeModal()}))},windowResize:function(){setTimeout((function(){for(var t=$("crux-tag"),e=t.length,a=0;a<e;a++)t[a].resetPosition()}),200)},aftercreate_list:function(t,e,a,o){for(var s=e.length,r={},i={},n=0;n<s;n++){var c=e[n].name,l=e[n].color_code;r[c]=e[n].id,i[c]=e[n].modRefId,t.tagnames.indexOf(c)&&(t.tagnames.indexOf(l)?Lyte.arrayUtils(t.getData("tagarray"),"push",{name:c,color_code:l}):Lyte.arrayUtils(t.getData("tagarray"),"push",{name:c})),t.setData("tagnamevstagid",r),t.setData("tagnamevsmodrefid",i),Lyte.arrayUtils(t.tagnames,"push",c),Crm.trackSpotLightAction("Tagging - List View Tags Create",{Module:o,Count:s})}t.addTags(a)},aftercreate_wf:function(t,e,a){if("remove"!==e&&void 0!==e)for(var o=e.length,s=0;s<o;s++){var r=e[s].name;Lyte.objectUtils(t.getData("tagnamevstagid"),"add",r,e[s].id),Lyte.objectUtils(this.tagnamevscolor,"add",e[s].name,e[s].color_code),Lyte.objectUtils(t.idvsname,"add",e[s].modRefId,r),Lyte.arrayUtils(t.tagnames,"push",r)}var i=t.getData("selectedtags"),n=[],c=[],l=i.length;for(s=0;s<l;s++){var d=i[s].name.replace(/  +/g," "),p=i[s].id;n.push(d),c.push(p)}CrmTags.clientJSON={},CrmTags.clientJSON.selectedIds=n,commonUtils.showHideLoadingDiv(),renderingUtils.removeFreezeLayer(),t.data.inputData&&t.data.inputData.mixin.executeAddTagSaveOperation?t.data.inputData.mixin.executeAddTagSaveOperation(n,t.data.inputData.mixin.actionId,a,t.data.inputData):wfTags.executeAddTagSaveOperation(n,wfTags.actionId,a),"add"===a?document.getElementById("add_TagPopUp").setAttribute("lt-prop-show",!1):document.getElementById("remove_TagPopUp").setAttribute("lt-prop-show",!1)},actions:{savetags:function(t){var e=this,a=e.getData("selectedtags"),o=$L("crux-tag")[0];e.getData("fromQuickActionsMenu")&&"edit"===e.getData("popUp")&&0===a.length&&(a=e.getData("recordObjForQuickAction").Tag,t="remove");var s=a.length;if("wf"===e.getData("from")&&e.data.selectedtaginfo.length>0&&0===e.data.selectedtags.length){var r;"add"===t?r="AddTags":"remove"===t&&(r="RemoveTags");var i=I18n.getMsg("crm.workflow.rule.label.confirm.deletepop.msg.detail1",I18n.getMsg("crm.workflow.actions.listing."+r)),n={val:I18n.getMsg("crm.button.ok"),fn:function(){var t=e.data.inputData&&e.data.inputData.mixin?e.data.inputData.mixin:wfTags,a=objectUtils.getValueFromObj(t,["calleeConfig","removeAction"]);"function"==typeof a&&a(),wfActions.deleteSingleAction(r,CrmTags.clientJSON.suffix),t.showHideTaggingOption("cancel","AddTags"===r?"add":"remove"),t.calleeConfig=void 0}},c={val:I18n.getMsg("crm.button.cancel"),fn:function(){$("#customConfirmationPop").hide()}};return renderingUtils.removeFreezeLayer(),"add"===t?document.getElementById("add_TagPopUp").setAttribute("lt-prop-show",!1):document.getElementById("remove_TagPopUp").setAttribute("lt-prop-show",!1),void renderingUtils.showCustomConfirmMessageNewModel(i,n,c)}if(!e.notagselected(s)){var l=e.getData("from");if(commonUtils.showHideLoadingDiv(!0),null!==a&&s>0&&JSON.stringify(a).includes('"isNewTag":true')){var d;if(d=this.getData("module"),"wf"==l){for(var p=[],g=this.getData("alltags"),m=g.length,u=0;u<m;u++)p.push(g[u].name);this.tagnames=p}e.createtagRec(a,this.tagnames),"list"===l&&e.createtags(d,"list-view",t),"wf"===l&&(e.createtags(d,"wf",t),"add"===t?document.getElementById("add_TagComp_wf").setAttribute("lt-prop-show",!1):document.getElementById("#remove_TagComp_wf").setAttribute("lt-prop-show",!1))}else"list"===l?e.addTags(t):e.aftercreate_wf(e,"",t);o.toggle("close"),o.resetSearch(),o.component&&void 0!==o.component.bodyDrop&&o.component.bodyDrop.querySelector("crux-color-palette").resetColorPalette(),store.unloadAll("tag")}},closeModalpop:function(){$L("crm-cc-actions").e[0]?ccCrmActions.cancelAction():this.closeModal()}},methods:{onError:function(t,e){1===e.errorCode&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters"))},beforeremove:function(t){var e=this.tagnames;if(!e.contains(t)){var a=this.getData("newTagCount");a--,this.setData("newTagCount",a)}"wf"!==this.getData("from")||e.contains(t)},beforeTagPopUpClose:function(){this.closeModal()},remove_tag_convert:function(t,e){var a=this.tagnamevscolor,o={name:e,id:this.getData("tagnamevstagid")[e],color_code:a[e]};if("conTag"===t){for(var s=(i=this.getData("tagarray")).length,r=0;r<s;r++)if(i[r].name===e)return;Lyte.arrayUtils(this.getData("tagarray"),"push",o)}else if("accTag"===t){for(s=(i=this.getData("tagarray_Acc")).length,r=0;r<s;r++)if(i[r].name===e)return;Lyte.arrayUtils(this.getData("tagarray_Acc"),"push",o)}else{var i;for(s=(i=this.getData("tagarray_Pot")).length,r=0;r<s;r++)if(i[r].name===e)return;Lyte.arrayUtils(this.getData("tagarray_Pot"),"push",o)}},showpop:function(){var t=$L("crm-tag-modal")[0].component;t.setData("selectedtags",[]);for(var e=t.getData("selectedtaginfo"),a=t.getData("tagnamevstagid"),o=t.tagnamevscolor,s=e.length,r=0;r<s;r++){var i,n={};i=CrmTags.isOrchestration?CrmTags.gettagname(e[r],"tagname"):e[r],n.name=i,n.id=a[i],n.color_code=o[i],Lyte.arrayUtils(t.getData("selectedtags"),"push",n)}},validate_tag:function(t,e){"add"!==t&&"remove"!==t&&(t=this.getData("popUp"));var a=this.tagnames;if("add"===t)if(a.contains(e))o=this.validatetags(e,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,0,0,"add",this.getData("from"));else var o=this.validatetags(e,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,this.getData("maxTagLimit"),this.getData("tagarray").length+this.getData("newTagCount")+1,"add",this.getData("from"));else o=this.validatetags(e,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,0,0,"remove",this.getData("from"));if(!o)return document.querySelector("crux-tag").toggle("close"),!1;if(!(a=this.tagnames).contains(e)){var s=this.getData("newTagCount")+1;this.setData("newTagCount",s)}},showHideCarryOverTagCont:function(t){var e=$L(t).closest(".carryOverTag").find(".carryOverTagCont");t.checked?e.slideDown():e.slideUp()},removeTag:function(){"wf"===this.getData("from")&&this.data.selectedtaginfo.length>0&&0===this.data.selectedtags.length&&this.setData("saveBtmMessage",I18n.getMsg("crm.workflow.actions.tags.action.remove.btnmsg")),this.getData("fromQuickActionsMenu")&&this.getData("disableSaveFromQuickactions")&&this.setData("disableSaveFromQuickactions",!1)},addTagCrux:function(){"wf"===this.getData("from")&&this.data.selectedtaginfo.length>0&&this.data.selectedtags.length>0&&this.setData("saveBtmMessage",I18n.getMsg("crm.button.save")),this.getData("fromQuickActionsMenu")&&this.getData("disableSaveFromQuickactions")&&this.setData("disableSaveFromQuickactions",!1)}},ShowTagErrorMsg:function(t){if((t=JSON.parse(t.response)).details&&t.details.permissions)-1!=t.details.permissions.indexOf("Crm_Implied_Tags_Accounts")&&1==t.details.permissions.length?renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.remove.permission.error"),"error"):renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.tags.per.den.all.record"),"error");else if(t.locked_count&&t.data&&t.data[0]&&("Sorry, you cannot perform this operation as the record is locked."===t.data[0].message||"record under merge is locked"===t.data[0].message)){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM);Lyte.injectResources(e,void 0,(function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.record.lock.tags.listview"),ltPropType:"error",ltPropDuration:"4000"}})}))}else renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.unsuccessful"),"error")}},{mixins:["crm-tag-mixin"]}),window.addEventListener("resize",this.windowResize);
