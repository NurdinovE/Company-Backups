Lyte.Component.register("crm-zia-feedback",{_template:'<template tag-name="crm-zia-feedback"> <div class="flexAlignCenter gap15"> <template is="if" value="{{expHandlers(feedbackPrimaryQuestion,\'&amp;&amp;\',expHandlers(feedbackPrimaryQuestion,\'!=\',\'\'))}}"><template case="true"><div class="crm-subheading-font-size" data-sider-select-id="8d21649f-9dd8-4064-85aa-6da64b7c8d76">{{feedbackPrimaryQuestion}}</div></template></template> <div data-zcqa="{{feature}}_like" class="h30 w30 br50per flexAlignCenter jcCenter cP {{if(enableLike,\'zia_feedback_positive eventNone\',\'bg_crmBg6\')}}" onclick="{{action(\'changeFeedback\',true)}}"> <span class="zcicncss-thumbsup zcicn-cssIcons {{if(enableLike,\'zcicn_green_mask eventNone\')}}"></span> </div> <div data-zcqa="{{feature}}_dislike" class="h30 w30 br50per flexAlignCenter jcCenter cP {{if(enableDisLike,\'zia_feedback_negative eventNone\',\'bg_crmBg6\')}}" onclick="{{action(\'changeFeedback\',false)}}"> <span class="zcicncss-thumbsup zcicn-cssIcons zcicn-rotate-180 {{if(enableDisLike,\'zcicn_red_mask\')}}"></span> </div> </div> <lyte-modal lt-prop-prevent-focus="{{isSubOptions(feedbackOptions)}}" lt-prop-height="{{if(isSubOptions(feedbackOptions),\'auto\',\'\')}}" lt-prop-width="{{if(isSubOptions(feedbackOptions),\'auto\',\'\')}}" lt-prop-show="{{lbind(showFeedbackModal)}}" lt-prop-max-height="{{if(isSubOptions(feedbackOptions),\'90%\',\'70%\')}}" lt-prop-show-close-button="false" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;,&quot;left&quot;:&quot;center&quot;}" on-before-close="{{method(&quot;markDislike&quot;)}}" on-close="{{method(\'onCloseModel\')}}" lt-prop-close-on-escape="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> {{feedbackSecondaryQuestion}} </lyte-modal-header> <lyte-modal-content> <template items="{{feedbackOptions}}" item="opt" index="index" is="for"> <template is="if" value="{{opt.sub_options}}"><template case="true"> <div class="crm-font-bold crmHeadingColor {{if(expHandlers(index,\'==\',0),\'\',\'mT30\')}}">{{opt.display_value}}</div> <template items="{{opt.sub_options}}" item="subOption" index="index2" is="for"><div class="mT20"> <lyte-checkbox lt-prop-checked="{{lbind(subOption.checked)}}" lt-prop-name="checkbox" lt-prop-value="{{subOption.system_value}}" lt-prop-id="checkbox" lt-prop-label="{{subOption.display_value}}" on-changed="{{method(\'changeFeedBack\',opt.system_value,subOption.system_value)}}"></lyte-checkbox> </div></template> </template><template case="false"><div class="{{if(expHandlers(index,\'==\',0),\'\',\'mT20\')}}"> <lyte-radiobutton lt-prop-type="primary" data-zcqa="{{feature}}_{{index}}" lt-prop-name="zia_feedback" lt-prop-label="{{getI18n(opt.system_value)}}" lt-prop-checked="{{ifEquals(opt.system_value,selectedFeedback)}}" lt-prop-value="{{opt.system_value}}" on-checked="{{method(\'selectNegativeFeedback\')}}"></lyte-radiobutton> </div></template></template> </template> <template is="if" value="{{isCommentNeeded}}"><template case="true"> <div class="crm-font-bold crmHeadingColor mT30">Comments if any</div> <crux-text-area-component cx-prop-value="{{lbind(comments)}}" class="mT10 dB w390" cx-prop-appearance="box" cx-prop-from="create" cx-prop-field-key="field_label" cx-prop-placeholder="Enter text"></crux-text-area-component> </template></template> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button onclick="{{action(\'skipFeedbackModal\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.skip\')}}</template> </lyte-button> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'sendFeedback\')}}" lt-prop-disabled="{{ifEquals(selectedFeedback,\'\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.submit\')}}</template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[0,0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,5]},{type:"attr",position:[1,5,1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"for",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"for",position:[3],dynamicNodes:[{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]}]}},default:{}}]},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["module","feature","featureFeedbackEvent","feedbackPrimaryQuestion","feedbackSecondaryQuestion","showFeedbackModal","enableLike","enableDisLike","selectedFeedback","feedbackObjectsArray","feedbackOptions","isCommentNeeded","comments","additionalProperties","isMailFeedbackNeeded"],data:function(){return{module:Lyte.attr("string",{default:""}),feature:Lyte.attr("string",{default:""}),featureFeedbackEvent:Lyte.attr("string",{default:""}),feedbackPrimaryQuestion:Lyte.attr("string",{default:""}),feedbackSecondaryQuestion:Lyte.attr("string",{default:""}),showFeedbackModal:Lyte.attr("boolean",{default:!1}),enableLike:Lyte.attr("boolean"),enableDisLike:Lyte.attr("boolean"),selectedFeedback:Lyte.attr("string",{default:""}),feedbackObjectsArray:Lyte.attr("array",{default:[]}),feedbackOptions:Lyte.attr("array",{default:[]}),isCommentNeeded:Lyte.attr("boolean",{default:!1}),comments:Lyte.attr("string",{default:!1}),additionalProperties:Lyte.attr("object",{default:{}}),isMailFeedbackNeeded:Lyte.attr("boolean",{default:!1})}},init:function(){this.resetOptions(),this.setData({feedbackPrimaryQuestion:I18n.getMsg(this.getData("feedbackPrimaryQuestion")),feedbackSecondaryQuestion:I18n.getMsg(this.getData("feedbackSecondaryQuestion"))})},resetOptions:function(){this.getData("feedbackOptions").forEach((e=>{e.sub_options?e.sub_options.forEach((e=>Lyte.objectUtils(e,"add","checked",!1))):Lyte.objectUtils(e,"add","checked",!1)}))},actions:{changeFeedback:function(e){this.resetOptions();var t=this.getData("module");if(e){this.setData({enableLike:!0,enableDisLike:!1}),_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"success",ltPropMessage:"Thank you for your feedback"}});var a={module:t,"Sub features":"Liked Count"};this.addAddnTrackings(a),Crm.client_tracking(this.getData("featureFeedbackEvent"),a)}else this.setData("showFeedbackModal",!0)},sendFeedback:function(){var e=this.getData("module"),t=this.getData("feature"),a=this.getData("selectedFeedback"),o=this,i=!1;if(o.getData("isCommentNeeded")&&o.getData("isMailFeedbackNeeded")&&o.getData("comments")){var s={__zia_feedback:[{feature:t,feedback:"negative",comment:o.getData("comments")}]};o.setData({showFeedbackModal:!1,comments:""}),i=!0,Lyte.resolvePromises({record_summary:app.store.makeRequest("sendXHR","/crm/v8/__zia_feedback","POST",{"Content-Type":"application/json"},JSON.stringify(s))}).then((function(){_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:"Thank you for your feedback"}}),Crm.client_tracking(o.getData("featureFeedbackEvent"),{Action:e,"Sub features":"Disliked Count",Others:"Submitted with comment"})}),(function(){_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:"Feedback not sent due to technical reason"}})}))}if(""!==a){var n=o.getData("feedbackOptions"),c=!1;if(n.length>0){var d={Action:e,"Sub features":"Disliked Count"};n.forEach((e=>{e&&e.sub_options&&e.sub_options.forEach((t=>{c=!0,t.checked&&"need_improvement"===e.system_value?(d.need_improvement=t.display_value,Crm.client_tracking(o.getData("featureFeedbackEvent"),d),delete d.need_improvement):t.checked&&(d.reason=t.display_value,Crm.client_tracking(o.getData("featureFeedbackEvent"),d),delete d.reason)}))}))}if(!c){d={module:e,sentiment:"dislike",reason:a};o.addAddnTrackings(d),Crm.client_tracking(o.getData("featureFeedbackEvent"),d)}}!i&&_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"success",ltPropMessage:"Thank you for your feedback"}}),o.setData({showFeedbackModal:!1,comments:""})},skipFeedbackModal:function(){var e=this.getData("module");this.setData({showFeedbackModal:!1,comments:""}),_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"success",ltPropMessage:"Thank You for your feedback"}});var t={Action:e,"Sub features":"Disliked Count",Others:"Skipped without feedback"};this.addAddnTrackings(t),Crm.client_tracking(this.getData("featureFeedbackEvent"),t)}},commentObserver:function(){const e=this.getData("comments");this.setData("selectedFeedback",e&&e.trim()?"comments":"")}.observes("comments"),methods:{changeFeedBack:function(e,t,a){let o=this.getData("feedbackOptions");o.forEach((o=>{o.system_value===e&&o.sub_options.forEach((e=>{e.system_value===t&&Lyte.objectUtils(e,"add","checked",a.checked)}))})),this.setData("selectedFeedback",o.some((e=>e.sub_options?e.sub_options.some((e=>e.checked)):e.checked))?t:"")},selectNegativeFeedback:function(e,t){this.setData("selectedFeedback",t.data.ltPropValue)},onCloseModel:function(e){this.setData({showFeedbackModal:!1,selectedFeedback:""}),e.setData("ltPropReRenderModal",!0)},markDislike:function(){this.setData({enableLike:!1,enableDisLike:!0})}},addAddnTrackings:function(e){var t=this.getData("additionalProperties");Object.keys(t).forEach((function(a){e[a]=t[a]}))}}),Lyte.Component.registerHelper("isSubOptions",(function(e){return e&&e.some((e=>e.sub_options))}));
