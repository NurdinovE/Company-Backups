var ZSurvey={};ZSurvey.surveyUrl="undefined"!=typeof Crm?Crm.getCrmBasePath()+"/SurveyConfig.do":"",ZSurvey.relatedListUrl="undefined"!=typeof Crm?Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&pname=SURVEYPERSONALITY":"",ZSurvey.surveyParams="&zcrmemail=${ZSURVEY.TOEMAIL}",ZSurvey.emailpopup="survey_mailpopup",ZSurvey.detailviewpopup="survey_detailpopup",ZSurvey.userInfo={},ZSurvey.objInfo={},ZSurvey.surveyInfo={};var ZProjects={},ZDesk={};function navigateProjectPersonallity(e,t){var r=1,o=objectUtils.URL(e);if(void 0!==o.getParams().pageno&&(r=o.getParams().pageno),!Crm.userDetails.isRelatedListLyteEnabled)var n=crmRelatedList.EachModuleData;var i={},s="1000000",a="";a=void 0!==o.getParams().sortorder?o.getParams().sortorder:$("#projects_sort").val();var l="",c="",d="",m="",u=detailView.changedBCJson.hidden.cvid;if(Crm.userDetails.isRelatedListLyteEnabled)(i=Lyte.Globals.get("relatedList.projectPersonality")?Lyte.Globals.get("relatedList.projectPersonality"):void 0)&&"PROJECTSPERSONALITY"===i.name&&(l=i.ProjectObj.authMsg,c=i.name.toLowerCase()+"_"+i.listRelationId,d=i.ProjectObj.projectIdList,m=i.listRelationId);else for(key1 in n)if(n.hasOwnProperty(key1)&&(i=n[key1],crmRelatedList.EachModuleData[key1]=i,"PROJECTSPERSONALITY"==i.name)){l=i.ProjectObj.authMsg,c=i.name.toLowerCase()+"_"+i.listRelationId,d=i.ProjectObj.projectIdList,m=i.listRelationId;break}d&&(void 0!==t&&t||(ZProjects.projectsNavigated=!0),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].getIntegList(s,m,Lyte.Globals.get("relatedList.entityId"),c,Lyte.Globals.get("relatedList.module"),u||$("#cvid").val(),"",l,r,d,Lyte.Globals.get("relatedList.entityId"),"","","","true",a):getIntegList(s,m,crmRelatedList.EntityId,c,crmRelatedList.Module,u||$("#cvid").val(),"",l,r,d,crmRelatedList.EntityId,"","","","true",a))}function validateProject(e,t,r,o,n,i,s,a){var l=$("#permission"),c=l.length?l.val():"",d=!1,m=$("#contacttabname");if("6401"==c)return renderingUtils.showCustomAlert(I18n.getMsg("crm.project.error.portalchanged")),!1;if("6832"==c)return renderingUtils.showCustomAlert(I18n.getMsg("crm.project.nopermissiontocreateproj")),!1;if("6504"==c.value)return renderingUtils.showCustomAlert(I18n.getMsg("crm.project.error.portalchanged")),!1;if("Accounts"==e){if(!o.length)return renderingUtils.showCustomAlert(I18n.getMsg("crm.field.empty.check",I18n.getMsg("Account name"))),!1;d=!0}if("Contacts"==e){if(void 0===s)return renderingUtils.showCustomAlert(I18n.getMsg("crm.project.nocontactemail",I18n.getMsg(m.val()))),!1;if(void 0!==n||"Create"!==t&&"Associate"!==t)d=!0;else{if("detail"===Lyte.Router.getRouteInstance().routeName){var u=$("[name='ID_PROJECTSPERSONALITY']").val();if(Crm.userDetails.isRelatedListLyteEnabled)var p=Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(u)?Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(u).ProjectObj:null;else p=crmRelatedList.getPersonalityModuleObj(u)?crmRelatedList.getPersonalityModuleObj(u).ProjectObj:null;if(d=!(p&&!p.projectIdList&&moduleRecordMapping.Accounts.visible&&returnJson.entityMapJson.ACCOUNTID)||ZProjects.showB2CAlert(t,"detail",e,r,i,a),renderingUtils.freezeBackground(),(w=$("#projectB2cAlert")).length)w.show(),w.parent().show();else{var v=$("<div>").attr({id:"projectsPopup",style:"display:none"});$("body").append(v);var g=$("#projectsPopup"),y={name:"div",child:[{name:"div",child:[{name:"form",child:[{name:"div",child:[{name:"div",child:[{name:"div",child:[{name:"text",content:I18n.getMsg("crm.projects.b2c.noaccounterror.new",[moduleRecordMapping.Accounts.singular_label,a])}],attr:{class:"crm-font-regular crm-heading-font-size content aligncenter",style:"font-size:1.9rem;"}}],attr:{class:"crmBaseColor"}}],attr:{class:"popup-model-content noBoxShadow fontsmooth pB0 oH",style:"width: 700px;overflow:hidden"}},{name:"div",child:[{name:"div",child:[{name:"input",child:[],attr:{type:"button",class:"primarybtn",value:I18n.getMsg("crm.yes.proceed"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');ZProjects.handleB2C('"+t+"','"+e+"','"+r+"','"+i+"')"}},{name:"input",child:[],attr:{name:"cancel",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.cancel"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');Crm.trackSpotLightAction('Projects Integration- B2C Popup Cancel');"}}],attr:{class:"aligncenter"}}],attr:{class:"popup-model-footer pB30"}}],attr:{}}],attr:{id:"",class:"zcrm-content"}}],attr:{id:"projectB2cAlert",class:"zcrm-modal zcrm-effect zcrm-show",style:"display: block;"}};g.append(renderingUtils.createHTML(y)),g.show()}return!1}var h=document.getElementsByTagName("crm-zprojects-rl")[0].component,f=h?h.getData("projectId"):"",C=moduleRecordMapping[e].fields,j=!1;C.forEach((function(e){"ACCOUNTID"===e.column_name&&(j=!0)})),d=!(!f&&moduleRecordMapping.Accounts.visible&&j)||ZProjects.showB2CAlert(t,"canvas",e,r,i,a)}}else{if(void 0===n&&("Create"===t||"Associate"===t)){u=$("[name='ID_PROJECTSPERSONALITY']").val();if(Crm.userDetails.isRelatedListLyteEnabled)p=Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(u)?Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(u).ProjectObj:null;else p=crmRelatedList.getPersonalityModuleObj(u)?crmRelatedList.getPersonalityModuleObj(u).ProjectObj:null;p&&!p.projectIdList&&moduleRecordMapping.Accounts.visible&&returnJson.entityMapJson.ACCOUNTID?void 0!==i&&(d=ZProjects.showB2CAlert(t,"detail",e,r,i,a)):d=!0,renderingUtils.freezeBackground();var w=$("#projectB2cAlert"),P=$("#projectB2cAlertWithoutContact");w.length?w.remove():P.length&&P.remove();v=$("<div>").attr({id:"projectsPopup",style:"display:none"});$("body").append(v);g=$("#projectsPopup"),y="";return y=void 0===i?{name:"div",child:[{name:"div",child:[{name:"form",child:[{name:"div",child:[{name:"div",child:[{name:"div",child:[{name:"text",content:I18n.getMsg("crm.salesnavigator.empty",[moduleRecordMapping.Accounts.singular_label,moduleRecordMapping.Contacts.singular_label,moduleRecordMapping[e].singular_label])}],attr:{class:"crm-font-regular crm-heading-font-size content aligncenter",style:"font-size:1.9rem;"}}],attr:{class:"crmBaseColor"}}],attr:{class:"popup-model-content noBoxShadow fontsmooth pB0 oH",style:"width: 700px;overflow:hidden"}},{name:"div",child:[{name:"div",child:[{name:"input",child:[],attr:{name:"cancel",class:"primarybtn",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:"renderingUtils.newcloseFreez('projectB2cAlertWithoutContact');Crm.trackSpotLightAction('Projects Integration- B2C Popup Cancel');"}}],attr:{class:"aligncenter"}}],attr:{class:"popup-model-footer pB30"}}],attr:{}}],attr:{id:"",class:"zcrm-content"}}],attr:{id:"projectB2cAlertWithoutContact",class:"zcrm-modal zcrm-effect zcrm-show",style:"display: block;"}}:{name:"div",child:[{name:"div",child:[{name:"form",child:[{name:"div",child:[{name:"div",child:[{name:"div",child:[{name:"text",content:I18n.getMsg("crm.projects.b2c.noaccounterror.new",[moduleRecordMapping.Accounts.singular_label,a])}],attr:{class:"crm-font-regular crm-heading-font-size content aligncenter",style:"font-size:1.9rem;"}}],attr:{class:"crmBaseColor"}}],attr:{class:"popup-model-content noBoxShadow fontsmooth pB0 oH",style:"width: 700px;overflow:hidden"}},{name:"div",child:[{name:"div",child:[{name:"input",child:[],attr:{type:"button",class:"primarybtn",value:I18n.getMsg("crm.yes.proceed"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');ZProjects.handleB2C('"+t+"','"+e+"','"+r+"','"+i+"')"}},{name:"input",child:[],attr:{name:"cancel",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.cancel"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');Crm.trackSpotLightAction('Projects Integration- B2C Popup Cancel');"}}],attr:{class:"aligncenter"}}],attr:{class:"popup-model-footer pB30"}}],attr:{}}],attr:{id:"",class:"zcrm-content"}}],attr:{id:"projectB2cAlert",class:"zcrm-modal zcrm-effect zcrm-show",style:"display: block;"}},g.append(renderingUtils.createHTML(y)),g.show(),!1}d=!0}return d}function projectProcess(e){var t=$("#projectlist");if(t.length){var r=document.getElementById("projectlist");$(r).empty(),r.innerHTML='<crm-zprojects-rl entity_id="'+e.accountid+"\" module='"+ZSEC.Encoder.encodeForHTML(e.module)+"' related_list_id=\""+e.listrelationid+'"></crm-zprojects-rl>',EvalInnerScript(t),"6401"!=(o=$("#permission").val())&&"6001"!=o&&"6000"!=o||($("#newproject").hide(),$("#projects_sort").parent().hide())}else{var o,n=$('[name="ID_PROJECTSPERSONALITY"]').val();(r=document.getElementById(n))&&($(r).empty(),r.innerHTML='<crm-zprojects-rl entity_id="'+e.accountid+"\" module='"+ZSEC.Encoder.encodeForHTML(e.module)+"' related_list_id=\""+e.listrelationid+'"no_permission="'+e.nopermission+'"></crm-zprojects-rl>'),EvalInnerScript($("#"+n)),"6401"!=(o=$("#permission").val())&&"6001"!=o&&"6000"!=o||($("#ract_"+n).hide(),$("#projects_sort").parent().hide())}}function resizeIframe(){$("#tabLayer");var e=renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+30;$("#externalIframe").css("height","calc(100vh - "+e+"px)")}function getFrameTargetElement(e){var t=e.contentWindow;return null==window.pageYOffset&&(t=t.document.documentElement?t.document.documentElement:t=document.body),t}function hideProjectDiv(){showCallCancel();var e=$("#projectSave"),t=$("#projectClose");e.length&&t.length&&(t.hide(),e.hide())}function showProjectDiv(){hideCallCancel();var e=$("#projectSave"),t=$("#projectClose");e.length&&t.length&&(t.show(),e.show())}function hideCallCancel(){$("#callCancel").hide()}function showCallCancel(){var e=$("#callCancel");e.length&&e.css({display:"table-cell"})}function hideSyncBtn(){var e=$L(".projectsTaskSyncBtn");e&&e.hide()}function isProjectAvailable(e,t,r,o,n){var i=$("#Crm_Tasks_SEID");if($("#projectSave").length&&$("#projectClose").length&&$("#modname").length&&"Leads"!=$("#leContModSel").val()&&0!=$("#leContModName").val().length){t=$('[name="property(modsel)"]').val();var s=$('[name="property(modid)"]').val();s||(s=Crm.userDetails.isRelatedListLyteEnabled?Lyte.Globals.get("relatedList.entityId")?Lyte.Globals.get("relatedList.entityId"):null:crmRelatedList?crmRelatedList.EntityId:null);var a=$('[name="property(leContModId)"]').val();void 0!==a&&a.length>0&&(t="Contacts",s=a);var l="/crm/v2/"+t+"/"+s+"/Zoho_Projects/client",c={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:l,type:"GET",headers:c,success:function(e){void 0!==e&&e.data&&"PROJECTS_AVAILABLE"==e.data.code&&e.data.client_projects[0].length>0?showProjectDiv():hideProjectDiv()}})}else{if(!i.length)return!1;l="/crm/v2/Tasks/"+n+"/Zoho_Projects?changedModule="+t,c={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:l,type:"GET",headers:c,success:function(e){if(e.data&&0==e.data.allow_module_change){renderingUtils.freezeBackground();var t=$("#projectTaskAlertDiv");if(t.length)t.show();else{var r=$("#Crm_Tasks_SEID_label"),o={name:"div",child:[{name:"div",child:[{name:"form",child:[{name:"div",child:[{name:"div",child:[{name:"div",child:[{name:"text",content:I18n.getMsg("crm.project.sync.dissociate")}],attr:{class:"crm-font-regular crm-heading-font-size content aligncenter",style:"font-size:1.9rem;"}}],attr:{class:"crmBaseColor"}}],attr:{class:"popup-model-content noBoxShadow pB0 oH",style:"width: 700px;overflow:hidden"}},{name:"div",child:[{name:"div",child:[{name:"input",child:[],attr:{type:"button",class:"primarybtn",value:I18n.getMsg("crm.confirm.deassociate"),onclick:"renderingUtils.newcloseFreez('projectTaskAlertDiv');ZProjects.handleTaskProjectSync(true)"}},{name:"input",child:[],attr:{name:"cancel",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.cancel"),onclick:"renderingUtils.newcloseFreez('projectTaskAlertDiv');ZProjects.handleTaskProjectSync(false)"}}],attr:{class:"aligncenter"}}],attr:{class:"popup-model-footer pB30"}}],attr:{}}],attr:{id:"",class:"zcrm-content"}}],attr:{id:"projectTaskAlertDiv",class:"zcrm-modal zcrm-effect zcrm-show",style:"display: block;"}};r.append(renderingUtils.createHTML(o))}}},error:function(){commonUtils.showHideLoadingDiv()}})}}ZProjects.projectsNavigated=!1,ZProjects.errorProject=void 0,ZProjects.callProjectsAPI=function(e,t,r,o,n){var i;commonUtils.showHideLoadingDiv("show");var s={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,Accept:"application/json","Content-type":"application/json; charset=utf-8"};(new crmRequestPool).initiate({action:t,type:e,headers:s,data:r,success:function(e){i=e,Lyte.registeredMixins["crm-utilities"].executeFunctionByName(o,window,n,e)},error:function(e){ZProjects.onFailureCallBack(e),o&&"ProjectsHome.setUsers"===o&&ProjectsHome.cancelCreateEditProjects()},complete:function(){if(commonUtils.showHideLoadingDiv(),void 0!==n&&n instanceof jQuery&&n.prop("disabled",!1),void 0!==o&&"ProjectsHome.setUsers"==o){var e=$("#newproject");e.attr("disabled",!1),i&&"PORTAL_OWNER_CHANGED"===i.code&&e.attr("disabled",!0)}}})},ZProjects.renderNewCrudComponent=function(e){var t=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud.js","integration/crm-zprojectsrl-store.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud.css"],ResourceConstants.CRMClient);if(r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("projectscrud")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED)var o=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud-rtl.css"],ResourceConstants.CRMClient),n=t.concat(r).concat(o);else n=t.concat(r);Lyte.injectResources(n,void 0,(function(){var t=$("<div>").attr({id:"projectsPopup"}),r=$("#projectsPopup");0===r.length&&$("body").append(t),r.empty();var o={};o.projects_data=e,Lyte.Component.render("crm-projects-crud",o,"#projectsPopup")}))},ZProjects.closeIframePopUp=function(){renderingUtils.newcloseFreez("freezeIframe"),$("#Iframe").attr("src",""),$("#detailViewzdiv").empty()},ZProjects.onFailureCallBack=function(e){if(e.code&&(500==e.code||400==e.code)||e.status&&(500==e.status||400==e.status)){var t=e.responseJSON;if(t){var r=t.details;if(r&&0!==Object.keys(r).length)return crmui.showMsgBand("error",I18n.getMsg("crm.zdesk.msg.errportal"),3e3,""),!1;crmui.showMsgBand("error",I18n.getMsg("crm.livedesk.error.exp.msg"),3e3,"")}}return!1},ZProjects.showUsrErrPopUp=function(){var e=document.getElementsByTagName("crm-projects-crud");e&&e[0].component.setData("unableToAdd",!0)},ZProjects.getPersonalityId=function(e){var t=new RegExp("("+e+"_[0-9]+)","g");if("detail"===Lyte.Router.getRouteInstance().routeName){if(Crm.userDetails.isRelatedListLyteEnabled){var r=store.peekAll("related_list").filterBy({personality_name:e.toUpperCase()})[0];if(r)return e+"_"+r.id}else{var o=crmRelatedList.personalityArr.match(t);if(o)return o[0]}return null}return e},ZProjects.getCreateDescResponse=function(e){var t=document.getElementById("proj_desc_response").contentWindow.document;t.designMode="On",t.open(),t.write(e),t.close(),$('[name="proj_desc_response"]').contents().find("html").css({"font-family":"var(--crm-font-regular)","font-size":14,color:"#666"})},ZProjects.sortProjectColumn=function(e){var t=document.getElementsByTagName("crm-zprojects-rl");if(t&&t.length>0){var r=$('[name="ID_PROJECTSPERSONALITY"]').val(),o=t[0].component;e="active"===e||"archived"===e?e:"active",o.setData("sortOrder",e),o.setData("pageNo",1);var n=o.setProjRLQueryParams(e);o.projectRelApi(n);var i=store.peekAll("zproject_rl").filter((function(t){if(t.ProjectStatus===e)return t})).length;0!=i?$("#newleft_"+r).find("span.numCountn").addClass("numCountVal").text(i):$("#newleft_"+r).find("span.numCountn").removeClass("numCountVal").text(" ")}},ZProjects.redirectToProjUpd=function(){"undefined"!=typeof Storage&&(sessionStorage.projUpd="Yes",location.href=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/extensions/zoho/projects"))},ZProjects.showIframe=function(e){var t=$("#canvasPopupDiv"),r=$("#tabLayer").outerWidth(),o=renderingUtils.tabLayerTop()+60;if(!t.length){var n=r-30,i=window.innerHeight-o+"px";r=n+"px";renderingUtils.freezeBackground(),$("#freezeIframe").css({height:i,width:r,left:"15px",right:"15px",display:"block",position:"fixed",zIndex:"1000",top:"15px"}),$("#"+e).css({color:"var(--baseColor)"}),ZProjects.uncolor(e)}},ZProjects.showProgressFrame=function(){var e=$("#progressIframe"),t=renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+5;$("#zProjFreezeLayer").removeClass("dN"),e.css({height:"80vh",width:"85vw","box-sizing":"border-box",left:"50%",transform:"translateX(-50%)",display:"block",position:"fixed","z-index":"33",top:t})},ZProjects.closeProgressframe=function(){$("#zProjFreezeLayer").add(".zProjCloseframeOuter").addClass("dN"),$("#detailViewzdiv").empty(),$("#progressIframe").hide()},ZProjects.loadProgressFrame=function(e,t){commonUtils.showHideLoadingDiv(!0);var r=Crm.getCrmBasePath()+"/ProjectConfig.do?event=loadIframe&projectId="+e+"&tab="+t;(new crmRequestPool).initiate({action:r,type:"POST",success:function(e){var t=$("#tabLayer").outerWidth()-30,r=renderingUtils.tabLayerTop()+60,o=window.innerHeight-r+"px",n=$("#canvasPopupDiv"),i={};i.iframeurl=e,i.iframeheight=o,i.completion=!0,n.length&&n.empty(),Lyte.Component.render("crm-zprojects-iframe",i,n.length?"#canvasPopupDiv":"#detailViewzdiv"),$("#freezeIframe").css({height:o,width:t+"px",display:"block",position:"fixed",zIndex:"21",top:"15px",left:"15px",right:"15px"})}})},ZProjects.loadIframe=function(e,t,r,o){var n;switch(commonUtils.showHideLoadingDiv(!0),t){case"mile":n="milestonediv";break;case"task":n="taskdiv";break;case"bug":n="bugsdiv"}var i=Crm.getCrmBasePath()+"/ProjectConfig.do?event=loadIframe&projectId="+e+"&tab="+t;(new crmRequestPool).initiate({action:i,type:"POST",success:function(e){var t=$("#tabLayer"),i=renderingUtils.tabLayerTop()+60,s=t.outerWidth()-30,a=window.innerHeight-i-45+"px",l=i+50,c=(window.innerHeight,s+"px"),d=$("#canvasPopupDiv"),m={};m.iframeurl=e,m.iframeheight=a,m.tabName=o,d.length&&d.empty(),Lyte.Component.render("crm-zprojects-iframe",m,d.length?"#canvasPopupDiv":"#detailViewzdiv"),$("#freezeIframe").css({height:"calc(100vh - "+i+"px)",width:c,left:"15px",right:"15px",display:"block",position:"fixed",zIndex:"21",top:"15px",bottom:"0"}),$L("#"+n).addClass("crmBaseColor"),commonUtils.showHideLoadingDiv(),$("#projNameSet").empty(),document.getElementById("projNameSet").innerHTML="<< "+$ESAPI.encoder().encodeForHTML(r),renderingUtils.freezeBackground()}})},ZProjects.changeUrl=function(e,t){var r=$("#canvasPopupDiv"),o=$("#Iframe"),n=null;r.length&&(n=document.querySelector("crm-zprojects-iframe"));var i=o.attr("src"),s=i.indexOf("Page=")+5,a=i.indexOf("&projId"),l=i.substring(0,s)+e+i.substring(a);r.length?n.component.setData("iframeurl",l):o.attr("src",l),$("#"+t).css({color:"var(--baseColor)"}),ZProjects.uncolor(t)},ZProjects.uncolor=function(e){"taskdiv"!=e&&$("#taskdiv").css({color:"#8b9ab9"}),"milestonediv"!=e&&$("#milestonediv").css({color:"#8b9ab9"}),"bugsdiv"!=e&&$("#bugsdiv").css({color:"#8b9ab9"})},ZProjects.showDeleteProjPopup=function(e,t){if(!(Crm&&Crm.userDetails&&Crm.userDetails.permissions)||Crm.userDetails.permissions.Crm_Implied_Delete_Projects){if(Crm.userDetails.isRelatedListLyteEnabled)var r=Lyte.Globals.get("relatedList.module")?Lyte.Globals.get("relatedList.module"):t;else r="undefined"!=typeof crmRelatedList&&""!=crmRelatedList.Module?crmRelatedList.Module:t;var o=moduleRecordMapping[r].singular_label,n=I18n.getMsg("crm.project.remove.warning",[I18n.getMsg(o),Crm.brandName]);showDeletePopup(I18n.getMsg(n),I18n.getMsg("crm.label.yes"),"","",$("#proj_del_icon_"+e))}else renderingUtils.showCustomAlert(I18n.getMsg("crm.projects.permissions.user.no.crmpermission"))},ZProjects.delProject=function(e,t,r,o,n,i,s){if(validateProject(r,"Delete",e,o,n,i,s)){hideAnimatePopup("deletepopup"),commonUtils.showHideLoadingDiv(!0);var a=store.peekRecord("zproject_rl",t);a.$.destroyRecord({moduleName:r,entity_id:e},{ids:t}).then((function(e){"PROJECT_DELETED"===e.data[0].code&&(commonUtils.showHideLoadingDiv(),renderingUtils.showMsgBox(I18n.getMsg("crm.custom.module.delete.success",I18n.getMsg("Project")),"success"),$("#canvasPopupDiv").length||$L("crm-zprojects-rl")[0].component.encryptProjIdApi())}),(function(){commonUtils.showHideLoadingDiv(),a&&a.$.rollBack(),renderingUtils.showMsgBox(I18n.getMsg("crm.translation.error.history"),"error")}))}},ZProjects.redirectToRelatedListPage=function(e,t,r,o){var n=Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+e+"&module="+t+"&cvid="+r+"&recordNum=1&returnAnchor="+o;commonUtils.showHideLoadingDiv("show"),(new crmRequestPool).initiate({action:n,type:"POST",success:function(e){commonUtils.showHideLoadingDiv();var t=document.getElementById("show");t.innerHTML=e,JSEvalScript(t),init(),Lyte.triggerEvent("relatedList",{module:Crm.isActivitySplitDone?"Tasks":"Activities"});var r=$("#projects_sort");r.length&&thirdPartyUtils.bindSelect2(r)},error:function(){commonUtils.showHideLoadingDiv()}})},ZProjects.showB2CAlert=function(e,t,r,o,n,i){renderingUtils.freezeBackground();var s=$("#projectsPopup");if(t&&"canvas"!==t&&0===s.length){var a=$("<div>").attr({id:"projectsPopup",style:"display:none"});$("body").append(a)}var l=t&&"canvas"===t?$("#canvasPopupDiv"):s;l.empty();var c={name:"div",child:[{name:"div",child:[{name:"form",child:[{name:"div",child:[{name:"div",child:[{name:"div",child:[{name:"text",content:I18n.getMsg("crm.projects.b2c.noaccounterror.new",[moduleRecordMapping.Accounts.singular_label,i])}],attr:{class:"crm-font-regular crm-heading-font-size content aligncenter",style:"font-size: 19px;"}}],attr:{class:"crmBaseColor"}}],attr:{class:"popup-model-content noBoxShadow fontsmooth pB0 oH",style:"width: 700px;overflow:hidden"}},{name:"div",child:[{name:"div",child:[{name:"input",child:[],attr:{type:"button",class:"primarybtn",value:I18n.getMsg("crm.yes.proceed"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');ZProjects.handleB2C('"+e+"','"+r+"','"+o+"','"+n+"')"}},{name:"input",child:[],attr:{name:"cancel",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.cancel"),onclick:"renderingUtils.newcloseFreez('projectB2cAlert');Crm.trackSpotLightAction('Projects Integration- B2C Popup Cancel');"}}],attr:{class:"aligncenter"}}],attr:{class:"popup-model-footer pB30"}}],attr:{}}],attr:{id:"",class:"zcrm-content"}}],attr:{id:"projectB2cAlert",class:"zcrm-modal zcrm-effect zcrm-show",style:"display: block;"}};return l.append(renderingUtils.createHTML(c)),l.show(),!1},ZProjects.showProjectTaskSyncModel=function(e){var t=[],r=networkUtils.returnDependencyFiles(["crm-zprojects-sync-task.js","crm-project-sync-task.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["crm-zprojects-sync-task.css"],ResourceConstants.CRMClient);t=t.concat(r.concat(o)),Lyte.injectResources(t,void 0,(function(){var t={},r=Lyte.Router.getRouteInstance().parent.getDynamicParam(),o=store.peekRecord("crm-project-sync-task",r);if(o){t.client_name=o.client_name,t.task_name=o.task_name,t.clientcompany_id=o.clientcompany_id,t.clientuser_id=o.clientuser_id,t.firstSelectedProjectId=o.firstSelectedProject,t.module=o.module,t.isB2C=o.isB2C,t.relatedEntityId=o.relatedEntityID,o.hasOwnProperty("is_strict_project")&&o.is_strict_project?(t.is_strict_project=o.is_strict_project,t.start_date=new CrmDate(crmCalendar.getDateObjectFromGivenDateString(o.project_start_date)).getDateInUserPattern(),t.end_date=new CrmDate(crmCalendar.getDateObjectFromGivenDateString(o.project_end_date)).getDateInUserPattern()):t.is_strict_project=!1;var n=e?$L("#select2-Crm_Tasks_PRIORITY-container").text():$L("#subvalue_PRIORITY").text();n=detailView.mapProjectPriority(n),t.prioritySelected=n;var i=e?$L("#Crm_Tasks_DUEDATE").val():$L("#subvalue_DUEDATE").text();i&&(t.due_date=new CrmDate(crmCalendar.getDateObjectFromGivenDateString(i)).getDateInUserPattern()),t.isEdit=!!e,e?(Lyte.Component.render("crm-projects-list",t,"#editProjectSync"),Crm.trackSpotLightAction("Add To Projects in Edit View",{Module:"editTaskSync"})):(Lyte.Component.render("crm-projects-list",t,"#projectTaskSync"),Crm.trackSpotLightAction("Add To Projects in Detail View",{Module:"TaskSync"})),document.getElementById("modalId").ltProp("show",!0)}}))},ZProjects.initProjectsIframe=function(){resizeIframe(),getFrameTargetElement(document.getElementById("externalIframe")).onscroll=function(){resizeIframe()},$L(window).scrollTo(0,0)},ZDesk.resizeDeskIframe=function(){var e=$("#mainMenuTabDiv"),t=e.offset().top,r=e.outerHeight(),o=renderingUtils.windowHeight-(t+r);jQuery("#externalIframe").css("height",o)},ZProjects.changeAccountLookup=function(e){var t=detailView.entityId;t||(t=window.Tasks.entityId);var r=e.value,o=$("#Crm_Tasks_CONTACTID_WhoId_select").val();"Contacts"!==o&&(r=o);var n=$("#Crm_Tasks_SEID_label_select").attr("data-lookup-module");"Accounts"!==r&&"Contacts"!==r&&"Potentials"!==r&&hideSyncBtn(),("Accounts"===r||"Potentials"===r&&""===$("#Crm_Tasks_SEID").val())&&hideSyncBtn(),("Accounts"==n&&"Accounts"==r||"Potentials"==n&&"Potentials"==r)&&"Contacts"==o||isProjectAvailable(void 0,r,void 0,void 0,t)},ZProjects.handleTaskProjectSync=function(e){if(1==e){commonUtils.showHideLoadingDiv("show");var t="/crm/v2/Tasks/"+(void 0!==detailView.entityId?detailView.entityId:window.Tasks.entityId)+"/Zoho_Projects",r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({type:"DELETE",url:t,headers:r,complete:function(){commonUtils.showHideLoadingDiv()},error:function(){crmui.showMsgBand("error",I18n.getMsg("crm.livedesk.error.exp.msg"),2e3)}})}else{var o=$("#Crm_Tasks_SEID_label_select"),n=o.val();if(void 0!==n&&"Accounts"!==n){var i=o.attr("data-lookup-module");o.val(i).trigger("change")}var s=$("#Crm_Tasks_CONTACTID_WhoId_select");if("Contacts"!==s.val()){s.val("Contacts").trigger("change");var a=$("#Crm_Tasks_CONTACTID"),l=a.attr("data-old-value"),c=a.attr("data-id");a.val(l),a.addClass("wsNowrap tOE"),a.attr("title",c),a.data("id",c),a.effect("highlight",{},1e3),a.focus()}var d=$("#Crm_Tasks_SEID"),m=d.attr("data-old-value"),u=d.attr("data-id");d.val(m),d.addClass("wsNowrap tOE"),d.attr("title",m),d.data("id",u),d.effect("highlight",{},1e3),d.focus()}},ZProjects.handleB2C=function(e,t,r,o){var n={},i={};void 0===o&&(o=r);var s=$L("crm-zprojects-rl")[0];if(s&&("Products"===t||"Campaigns"===t)){var a=s.component.data.contactArray;!o&&a&&a.length>0&&(o=a[0].value),i.contactsArr=a}i.crm_contact_id=o,i.crm_entity_id=r,i.module=t,i.action=e,n.projects_data=i;var l=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud.js","integration/crm-zprojectsrl-store.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud.css"],ResourceConstants.CRMClient);if(c=c.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("projectscrud")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED)var d=networkUtils.returnDependencyFiles(["integration/crm-zprojects-crud-rtl.css"],ResourceConstants.CRMClient),m=l.concat(c).concat(d);else m=l.concat(c);Lyte.injectResources(m,void 0,(function(){var e=$("<div>").attr({id:"projectsPopup"}),t=$("#projectsPopup");0===t.length&&$("body").append(e),t.empty(),Lyte.Component.render("crm-projects-crud",n,"#projectsPopup")})),Crm.trackSpotLightAction("Projects Integration- B2C Popup Proceed")},ZSurvey.gotoLink=function(e){var t=$(e).attr("href");return openNewTab(t,"template"),!1},ZSurvey.removeSurveyLink=function(e){var t=$(e).parent();t.prev("a").remove(),t.remove()},ZSurvey.editSurveyLink=function(e,t){var r=$(e).parent(),o=r.prev("a"),n=o.attr("data-id");ZSurvey.objInfo.editedObj=o;var i=$("#lookupdiv"),s=$("#emailEditor"),a=s.contents();if(t&&(i=a.find("#zcsurveylinkpop")),i.find("#surveyDetails").length>0)t?"htmlEditor"!==template.editorType?template.Builder.showAnimatePopup("zcsurveylinkpop"):s[0].contentWindow.showAnimatePopup("zcsurveylinkpop"):ZSurvey.showPopup("lookupdiv"),r.remove(),ZSurvey.setSurveyUrl(n,void 0,t),t?(a.find(".surveyField").val(o.text()),a.find("#surveyLinkQuery").focus()):($(".surveyField").val(o.text()),$("#surveyLinkQuery").focus());else{var l={action:"surveyDetails"},c=networkUtils.constructUrl(this.surveyUrl,l);l={},t&&(l.from="editor"),""===(getElemById("module")?getElemById("module").value:"")&&(l.from="sendsurvey"),l[csrfParamName]=csrfToken,(new crmRequestPool).doAjax(c,(function(e){t?(a.find("#zcsurveylinkpop").find(".popup-model-content").html(e),"htmlEditor"!==template.editorType?template.Builder.showAnimatePopup("zcsurveylinkpop"):s[0].contentWindow.showAnimatePopup("zcsurveylinkpop")):($("#lookupdiv").html(e),ZSurvey.showPopup("lookupdiv")),r.remove(),ZSurvey.setSurveyUrl(n,void 0,t),t?(a.find(".surveyField").val(o.text()),a.find("#surveyLinkQuery").focus()):($(".surveyField").val(o.text()),$("#surveyLinkQuery").focus())}),l,(function(e){ZSurvey.errorHandling(e)}))}},ZSurvey.redirectToSurvey=function(){if("undefined"!=typeof Storage){"undefined"==typeof hidecallout&&Crm.userDetails.isNewEditor&&EmailSendingUtil.composeActive?EmailUtil.hidecallout():hidecallout(),sessionStorage.surveySetup="Yes";var e=Crm.getCrmBasePath()+"/ShowSetup.do?tab=webInteg&subTab=zohoApps&appname=survey";networkUtils.openUrl(e,"blank")}ZSurvey.hidecallout(this.emailpopup)},ZSurvey.removeFreezeAndBodyScroll=function(){$(document.body).removeClass("ohide").css({height:""}),window.document.documentElement.style.overflow=""},ZSurvey.cancelPopup=function(e){var t=$L("#surveyResponse");if(t&&t.length>0&&t[0].childNodes.length>0&&"block"===t[0].style.display){crmui.modalZIndex("nonLyte",t[0],"close");var r=document.getElementById("FreezeLayer");r&&document.body.removeChild(r)}ZSurvey.removeFreezeAndBodyScroll(),$L("#"+e).removeClass("br4_bottom_curve").addClass("roundedCornerPop"),Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()?EmailUtil.removeCustomFreezeLayer():ZSurvey.removeFreezeAndBodyScroll();var o=$L("#"+e);"lookupdiv"===e&&o.length>0&&o[0].style&&"none"!==o[0].style.display&&crmui.modalZIndex("nonLyte",o[0],"close"),hide(e),ZSurvey.objInfo.editedObj=void 0},ZSurvey.showSurveyLink=function(e,t,r){var o=getElemById("module")?getElemById("module").value:"";t||(t=$("#insertSurvey")),e.contains(o)||"Potentials"===o||"SalesOrders"===o||"Invoices"===o||"Accounts"===o?t.show():r?t.remove():t.hide()},ZSurvey.showSurveyLinkEdit=function(e,t){var r=(e=$(e)).position(),o=$("#emailEditor").contents();if(t&&"htmlEditor"==template.editorType&&(o=o.find("iframe").eq(0).contents()),o.find(".editSurLink").remove(),0===e.next(".editSurLink").length){var n=e.attr("href"),i=e.attr("link");i&&""!=i||(i=e.text());var s={LINK:[n],TEXT:[i],linkTemp:"true"};networkUtils.loadFeatureScripts(["zsurvey_templates.js"],(function(){Handlebars.registerPartial("zsurveytemplate",Handlebars.templates.zsurveytemplate);var o=Handlebars.templates.zsurveytemplate(s),n=$(o).css({left:r.left,top:r.top+18});e.after(n),t&&("htmlEditor"==template.editorType?($(n).find(".chngLink").removeAttr("onclick").attr("onclick","parent.sE(event);parent.parent.ZSurvey.editSurveyLink(this,true)"),$(n).find(".prvwLink").removeAttr("onclick").attr("onclick","parent.sE(event);parent.parent.ZSurvey.gotoLink(this);return false;"),$(n).find(".rmvLink").removeAttr("onclick").attr("onclick","parent.sE(event);parent.parent.ZSurvey.removeSurveyLink(this)")):$(n).find(".chngLink").removeAttr("onclick").attr("onclick","parent.sE(event);parent.ZSurvey.editSurveyLink(this,true)"))}))}},ZSurvey.freezeBackAndRemoveScrollNotop=function(){var e=document.createElement("DIV");e.id="FreezeLayer",e.className="freezeLayer",$(e).css({width:renderingUtils.windowWidth,height:renderingUtils.windowHeight}).appendTo("body")},ZSurvey.viewResponse=function(e){var t=ZSurvey.constructUrl(e,ZSurvey.surveyUrl);(new crmRequestPool).doAjax(t,(function(e){var t=$("#surveyResponse"),r=renderingUtils.windowHeight-100;document.documentElement.scrollTop||document.body.scrollTop;ZSurvey.freezeBackAndRemoveScrollNotop(),t.attr({class:"zSurveyResponseDiv",style:""}),t.css({display:"block",width:"810px",height:r-100}),t.html(e)}),"",(function(e){ZSurvey.errorHandling(e)}))},ZSurvey.hidecallout=function(e){var t=this.surveyUrl;t=t+"?action=hidecallout&fname="+e,(new crmRequestPool).doAjax(t,(function(){}),Territory.csrf(),(function(e){ZSurvey.errorHandling(e)}))},ZSurvey.constructUrl=function(e,t){var r=$(e).attr("data-params");return r=JSON.parse(r),networkUtils.constructUrl(t,r)},ZSurvey.showSurveyDetails=function(e,t,r,o,n){networkUtils.loadFeatureScripts(["zsurvey_home-min.js"],(function(){var i=Crm.userDetails.isNewEditor,s=ZSurvey.constructUrl(e,ZSurvey.surveyUrl);if(t||(t="lookupdiv"),!ZSurvey.checkForEmail($(e).attr("data-params"))){var a=i?$("#moduleName_"+EmailComposeUtil.CURRENT_TAB).val():$("#moduleName").val();if(-1==s.indexOf("module")&&(null!=a&&null!=a||1==r&&null!=(a=$("#module").val())&&null!=a)&&(s=s+"&module="+a),null==r&&"Potentials"==a){var l=i?$("#ecEntityId_"+EmailComposeUtil.CURRENT_TAB).val():$("#ecEntityId").val();l||(s=s+"&entIdForZMail="+l)}(new crmRequestPool).doAjax(s,(function(e){var i=$("#emailEditor").contents(),s=i.find("#"+t),a=s.find(".popup-model-content");if(r){i.find("#zcsurveylinkpop").find(".popup-model-content").html(""),i.find("#zp_ZohoSurveytab").html(""),i.find("#zp_edtSurveyButton").html(""),o?(s.html(e).show(),n&&ZSurvey.setSurveyUrl(n,void 0,!0)):(a.html(e),JSEvalScript(a[0]),template.Builder.showAnimatePopup(t));var l=i.find("#zcsurveycommonpopup"),c=i.find("#assign_Unrelatedsurvey"),d=i.find("#error_Unrelatedsurvey"),m=c.outerHTML(),u=d.outerHTML();c.remove(),d.remove(),l.html(m),l.append(u)}else if(!e.hasOwnProperty("id")||"crm.zsurvey.no.survey.communication"!==e.id&&"crm.zsurvey.no.survey.email.communication"!==e.id&&"crm.record.lock.survey"!==e.id){var p=$("#"+t);p.removeAttr("style").css({display:"block",position:"absolute",left:"29%",top:"0"}),p.html(e),ZSurvey.showPopup(t)}else if(e.hasOwnProperty("status")&&"error"===e.status&&e.hasOwnProperty("message")){if("crm.record.lock.survey"===e.id)return void _cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg(e.id,[moduleRecordMapping[e.message].plural_label]),ltPropContentAlign:"center"}});renderingUtils.showCustomAlert(I18n.getMsg(e.message))}}),Territory.csrf(),(function(e){ZSurvey.errorHandling(e)}))}}))},ZSurvey.getSurveyIdFromATag=function(e){var t=e.getAttribute("data_id")||e.getAttribute("data-id");return t=(t=t.replace("${ZSURVEY.SURVEYID###","")).replace("}","")},ZSurvey.showPopup=function(e){Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()?EmailComposeUtil.showCustomFreezeLayer():ZSurvey.freezeBackAndRemoveScrollNotop();var t="#"+e;$(t).css({position:"absolute",left:"29%",top:"0px"}),getElemById(e).style.display="block",$(getElemById(e)).removeClass("topAlignEmailDetail"),$L(t).removeClass("roundedCornerPop").addClass("br4_bottom_curve"),"lookupdiv"===e?crmui.modalZIndex("nonLyte",$L(t)[0],"open"):"contDetails"===e&&crmui.adjustFreezeLayer()},ZSurvey.errorHandling=function(e){var t=JSON.parse(e.responseText);return"SURVEY_ORG_OAUTHMIGRATION_FAILED"===t.errorCode?(t.admin?renderingUtils.showCustomAlert(I18n.getMsg("crm.zsurvey.surveyinteg.stopped.adminmsg.brandchange",Crm.integrationsAppName.ZOHO_SURVEY),I18n.getMsg("crm.zsurvey.surveyinteg.stopped.brandchange",Crm.integrationsAppName.ZOHO_SURVEY),!1,(function(){var e=Lyte.Router.getURL("crm.settings.section.extensions.zoho-extensions.survey");networkUtils.openUrl("https://"+RebrandLinkUtil.getProperty("CRMURL")+e)}),null,I18n.getMsg("crm.zsurvey.check.config")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zsurvey.surveyinteg.stopped.usermsg.brandchange",Crm.integrationsAppName.ZOHO_SURVEY,Crm.integrationsAppName.ZOHO_SURVEY),I18n.getMsg("crm.zsurvey.surveyinteg.stopped.brandchange",Crm.integrationsAppName.ZOHO_SURVEY)),!1):(getElemById("error")?($("#error").show().removeClass("hide").html(t.message),$("#inputVerify, #emailVerify").removeClass("tickgreen"),$("#surveyKey, #emailId").addClass("errorField"),$("#zSurveyConfigSubmitBtn").add("#zSurveyConfigCancelBtn").prop("disabled",!1).css({cursor:"pointer"})):(t.message.includes("you are not able to connect to the Zoho Survey. please try again in a few minutes")&&Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()&&EmailComposeUtil.showCustomFreezeLayer(),renderingUtils.showCustomAlert(t.message)),!1)},ZSurvey.refreshSurveyPersonality=function(e,t){var r=ZSurvey.relatedListUrl+"&module="+e+"&id="+t;(new crmRequestPool).doAjax(r,(function(r){var o;(Crm.userDetails.isRelatedListLyteEnabled?(Lyte.Globals.get("relatedList.module")||Lyte.Globals.set("relatedList.module",e),Lyte.Globals.get("relatedList.entityId")||Lyte.Globals.set("relatedList.entityId",t)):(null!=crmRelatedList.Module&&""!=crmRelatedList.Module||(crmRelatedList.Module=e),null!=crmRelatedList.EntityId&&""!=crmRelatedList.EntityId||(crmRelatedList.EntityId=t)),"canvas"==Lyte.Router.getRouteInstance().routeName||Crm.userDetails.isRelatedListLyteEnabled)?((o=null!=opener?opener.document.getElementsByTagName("crm-zsurvey-rl-label")[0].component:document.getElementsByTagName("crm-zsurvey-rl-label")[0].component).data.module=e,o.data.entity_id=t,o.actions.reload.call(o)):crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,r)}),"",(function(e){ZSurvey.errorHandling(e)}))},ZSurvey.checkForEmail=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("from")){var r=t.from;if("attendsurvey"===r||"sendsurvey"===r){var o=t.module,n=$("#associatedContEmail");if(t.hasOwnProperty("emailDetails")&&(void 0!==t.emailDetails.rec_email&&t.emailDetails.rec_email.length>0||void 0!==t.emailDetails.rec_semail&&t.emailDetails.rec_semail.length>0))return!1;if(t.hasOwnProperty("emailDetails")){let e="Potentials"===o?I18n.getMsg("crm.zmail.unableto.potentials.sendmail",Crm.moduleInfo[o].translatedSingularLabel):I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[o].translatedSingularLabel);return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:e,ltPropContentAlign:"center"}}),!0}if("Potentials"===o&&(0===n.length||""===n.val()||"null"===n.val())||"Potentials"!=o&&""==$("#subvalue_EMAIL").text()&&""==$("#subvalue_ADDN_EMAIL").text())return"Potentials"==o?_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zmail.unableto.potentials.sendmail",Crm.moduleInfo[o].translatedSingularLabel),ltPropContentAlign:"center"}}):_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[o].translatedSingularLabel),ltPropContentAlign:"center"}}),!0}}return!1},ZSurvey.resetIntroVideoSrc=function(){var e=$("#surveyIntegHowToVideo");e.attr("src",e.attr("src"))},ZSurvey.removeEditLink=function(e,t){var r=$("#emailEditor").contents();t&&"htmlEditor"==template.editorType&&(r=r.find("iframe").eq(0).contents()),r.find(".editSurLink").remove(),r.find(".ze_body").off("click").on("click",(function(){r.find(".editSurLink").remove()}))},ZSurvey.postMessageListener=function(e){e?window.addEventListener("message",ZSurvey.handleListener):window.removeEventListener("message",ZSurvey.handleListener)},ZSurvey.handleListener=function(e){var t;(t=e&&"string"==typeof e.data&&ZSurvey.IsJsonString(e.data)?JSON.parse(e.data):e&&e.data)&&e.origin===window.location.origin&&("zsTemplate"===t?ZSurvey.showLyteSurveyPopup():"zsSurvey"===t.message&&("dragdropEditor"===t.editorType?editorBuilderImpl.insertsurveyLink(t.html):"htmlEditor"===t.editorType&&insertsurveyLink(t.html),ZSurvey.postMessageListener(!1)))},ZSurvey.showLyteSurveyPopup=function(){var e={title:"crm.zsurvey.label.insert.link",showsurveypopup:!0,buttonText:"Insert",module:$L("#module").val(),from:"template",iscomponentmethod:!0,executemethod:"insertText"};ZSurvey.showPopupLyte(["crm-zsurvey-survey-popup.js","crm-zsurvey-popup-dropdown.js","survey-configuration.js","crux-form-component.js"],!0,["zsurvey_home-min.js"],e,"#nTemailEditor",!0)},ZSurvey.showPopupLyte=function(e,t,r,o,n,i){var s=networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient);t&&(s=s.concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM))),s=s.concat(networkUtils.returnDependencyFiles(["crm-zsurvey-survey-popup.css"],ResourceConstants.CRMClient)),i&&(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zsurveypopup")],ResourceConstants.CRM))),Lyte.injectResources(s,void 0,(function(){o.title=I18n.getMsg(o.title),o.buttonText=I18n.getMsg(o.buttonText),Lyte.Component.render("crm-zsurvey-survey-popup",o,n),commonUtils.showHideLoadingDiv(!1)}))},ZSurvey.IsJsonString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0};