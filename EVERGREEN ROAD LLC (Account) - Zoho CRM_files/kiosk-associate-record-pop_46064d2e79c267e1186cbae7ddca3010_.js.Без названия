Lyte.Component.register("crm-kiosk-record-detail-view-popup",{_template:'<template tag-name="crm-kiosk-record-detail-view-popup"> <lyte-modal lt-prop-yield="true" id="detailViewAssociationPop" on-close="{{method(\'removeModalNode\')}}" lt-prop-show-close-button="false" lt-prop-show="{{showAddModal}}" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="cDefault">{{getI18n(\'crm.kiosk.detail.view.popup.add.header.message\')}}</lyte-modal-header> <lyte-modal-content> <crux-form-component lt-prop-yield="true" class="w100_per cDefault" id="createAssociationTable"> <template is="registerYield" yield-name="cruxFormComponent"> <template is="if" value="{{expHandlers(fromDetailView,\'!\')}}"><template case="true"> <div class="crmFormComponentRow"> <div class="lyteLabel"> {{getI18n(\'crm.label.module\')}} </div> <div class="lyteField"> <crux-dropdown data-zcqa="detailViewModule" id="detailViewModule" cx-prop-disabled="{{expHandlers(isEdit,\'||\',fromDetailView)}}" cx-prop-mandatory="true" class="w100_per" cx-prop-selected="{{lbind(module.api_name)}}" cx-prop-placeholder="{{getI18n(\'crm.label.select.module\')}}" on-option-select="{{method(\'fetchLayoutsForModule\')}}" cx-prop-options="{{modules}}" cx-prop-user-value="plural_label" cx-prop-system-value="api_name"></crux-dropdown> </div> </div> <div class="crmFormComponentRow {{if(isLayoutRuleAvailable,\'\',\'dN\')}}"> <div class="lyteLabel"> {{getI18n(\'crm.label.layout\')}} </div> <div class="lyteField"> <crux-dropdown id="detailViewModuleLayout" cx-prop-mandatory="true" cx-prop-disabled="{{disableLayout}}" class="w100_per" cx-prop-selected="{{lbind(layoutId)}}" data-zcqa="detailViewModuleLayout" on-option-select="{{method(\'enableOrDisableSaveBtn\')}}" cx-prop-placeholder="{{getI18n(\'crm.label.select.layout\')}}" cx-prop-options="{{lbind(layoutDropArr)}}" cx-prop-user-value="name" cx-prop-system-value="id"></crux-dropdown> </div> </div> </template></template> <div class="crmFormComponentRow"> <div class="lyteLabel"> {{getI18n(\'crm.label.name\')}} </div> <div class="lyteField"> <crux-text-component data-zcqa="detailViewComponentName" cx-prop-mandatory="true" cx-prop-from="create" cx-prop-maxlength="50" class="mandatoryField w100_per" cx-prop-value="{{lbind(ruleName)}}" on-value-change="{{method(\'enableOrDisableSaveBtn\')}}" id="detailViewComponentName" cx-prop-type="text" cx-prop-appearance="box"></crux-text-component> </div> </div> </template> </crux-form-component> </lyte-modal-content> <lyte-modal-footer> <lyte-button data-zcqa="detailViewCancelBtn" onclick="{{action(\'cancelRule\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button data-zcqa="detailViewCreateBtn" lt-prop-disabled="{{if(showCreateBtn,false,true)}}" lt-prop-appearance="primary" onclick="{{action(\'createRule\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'gs.save\')}} </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1]},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[3]},{type:"text",position:[3,1,1]},{type:"attr",position:[3,3,1]},{type:"componentDynamic",position:[3,3,1]}]}},default:{}},{type:"text",position:[3,1,1]},{type:"attr",position:[3,3,1]},{type:"componentDynamic",position:[3,3,1]}]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["layoutDropArr","modules","showAddModal","isEdit","fromDetailView","kioskOrderForScroll","lastAddedComponentId","layout","layoutId","module","resourceId","description","ruleName","disableLayout","oldRuleName","isFetchLayouts","fromComponentFlow","rules_meta","isLayoutRuleAvailable","showCreateBtn","kioskId"],data:function(){return{layoutDropArr:Lyte.attr("array",{default:[]}),modules:Lyte.attr("array"),showAddModal:Lyte.attr("boolean",{default:!1}),isEdit:Lyte.attr("boolean",{default:!1}),fromDetailView:Lyte.attr("boolean",{default:!1}),kioskOrderForScroll:Lyte.attr("string",{default:""}),lastAddedComponentId:Lyte.attr("string",{default:""}),layout:Lyte.attr("object",{default:{}}),layoutId:Lyte.attr("string"),module:Lyte.attr("object",{default:{}}),resourceId:Lyte.attr("string"),description:Lyte.attr("string"),ruleName:Lyte.attr("string"),disableLayout:Lyte.attr("boolean",{default:!0}),oldRuleName:Lyte.attr("string"),isFetchLayouts:Lyte.attr("boolean",{default:!1}),fromComponentFlow:Lyte.attr("string",{default:""}),rules_meta:Lyte.attr("object",{default:{}}),isLayoutRuleAvailable:Lyte.attr("boolean",{default:!0}),showCreateBtn:Lyte.attr("boolean",{default:!1}),kioskId:Lyte.attr("string",{default:""})}},moduleName:"",init:function(){if(this.getData("isFetchLayouts"))this.fetchLayoutsArrForModule(this.getData("module"),this);else if(this.getData("fromDetailView")){var t=this.getData("layoutDropArr");t.push(this.getData("layout")),this.setData("layoutDropArr",t)}this.getData("isEdit")&&(this.setData("oldRuleName",this.getData("ruleName")),this.setData("oldLayoutId",this.getData("layoutId")));var e=["Tasks","Meetings","Calls"];if(wmsBarInfo.isLiveDeskEnabled||e.push("Visits"),this.getData("modules")){var a=this.getData("modules").filter((t=>!e.includes(t.module_name)));a=this.getSupportedModules(a),this.setData("modules",a)}},methods:{fetchLayoutsForModule:function(t,e){this.setData("disableLayout",!0),this.enableOrDisableSaveBtnFun(this);var a=moduleRecordMapping[moduleApiVsNameMapping[e]];this.setData("layout",{}),this.setData("layoutId",""),this.setData("module",a),this.getData("isLayoutRuleAvailable")&&(this.setData("showCreateBtn",!1),commonUtils.showHideLoadingDiv(!0),this.fetchLayoutsArrForModule(a,this))},removeModalNode:function(){this.$node.remove();var t=Crm.renderDVLyteFlow(this.getData("module").name)?document.getElementById("kiosk_component_resource_id_"+this.getData("lastAddedComponentId")):document.getElementById("kioskDetailView_"+this.getData("kioskOrderForScroll"));this.getData("fromDetailView")&&t&&t.scrollIntoView({behavior:"smooth"})},enableOrDisableSaveBtn:function(){this.enableOrDisableSaveBtnFun(this)}},actions:{createRule:function(){var t=this.getData("isEdit");if(t&&this.getData("oldRuleName")===this.getData("ruleName")&&this.getData("layoutId")===this.getData("oldLayoutId"))this.setData("showAddModal",!1);else{var e=this.getData("module"),a=this.getData("fromComponentFlow"),o=e.id;if(!o)this.getData("modules").forEach((function(t){t.api_name!==e.api_name||(o=t.id)}));var i,l=this.getData("kioskId"),s=this.getData("ruleName"),r={};r.id=this.getData("layoutId"),i=this.getData("resourceId");var d=this.getData("fromDetailView")?"detail_view":void 0;this.addOrUpdateKioskToComponent(l,s,e,r,d,i,t,!1,a),commonUtils.showHideLoadingDiv(!0)}},cancelRule:function(){this.setData("showAddModal",!1);var t=$L("crm-kiosk-association-popup")[0];t&&t.component.setData("showAssociatePop",!0)}},enableOrDisableSaveBtnFun:function(t){var e=t.getData("module").api_name,a=t.getData("layoutId"),o=t.getData("ruleName"),i=""!==o&&void 0!==o&&void 0!==e&&""!==o.trim();t.getData("isLayoutRuleAvailable")&&""===a&&(i=!1),t.setData("showCreateBtn",i)}},{mixins:["kiosk","kiosk_execute"]});
