var crmNTCWms={handleMessage:function(e){if(SalesSignalsWrapper.isSignalIFrameOpen)SalesSignals.handleMessage(e);else{var t=e.notification;crmNTCGlobal.incrNotificationsCount(),crmNTCGlobal.updateNotificationCount(),crmNTCWms.prependGlobalNotification(t)}},prependGlobalNotification:function(e){var t=crmNTCGlobal.convert(e);if(0!=$("#notifications #notificationGroupList").length){var n=Handlebars.templates.notificationGroups(t);$(n).hide().prependTo("#notifications #notificationGroupList").slideDown("slow"),thirdPartyUtils.bindPerfectScrollUpdate("#notificationGrpList")}else $("#notificationList").html(Handlebars.templates.globalSignal(t)).removeClass("pR oH")},updateEntityStatus:function(){var e=$(".ntc-detail-foot-chat");if("object"==typeof CrmTracking&&CrmTracking.isSalesiqUser&&$("#notificationList #notificationGroupList").length>0)for(var t=$(".ntc-entity-group"),n=t.length,i=0;i<n;i++){var o,s=t.eq(i),a=s.data("ntc-entityid");if(crmNTCGlobal.isEntityOnline(a))s.find(".ntc-pic").addClass("ntc-online"),s.find(".ntc-chat-now").removeClass("dN"),void 0!==(o=$("#ntcBusinessCard"+a))&&o.is(":visible")&&(o.find(".ntc-pic").addClass("ntc-online"),o.find(".ntc-bc-chat").addClass("active"),e.show());else s.find(".ntc-pic").removeClass("ntc-online"),s.find(".ntc-chat-now").addClass("dN"),void 0!==(o=$("#ntcBusinessCard"+a))&&o.is(":visible")&&(o.find(".ntc-pic").removeClass("ntc-online"),o.find(".ntc-bc-chat").removeClass("active"),e.hide())}},resetBellCount:function(){crmNTCGlobal.live_global_notifications_count=0,crmNTCGlobal.updateNotificationCount()},updateSignalsCount:function(e){e.signals_count?crmNTCGlobal.signals_count=e.signals_count:crmNTCGlobal.signals_count=0,e.feeds_count&&(e.feeds_count<0&&(e.feeds_count=0),crmNTCGlobal.feeds_count=e.feeds_count),crmNTCGlobal.live_global_notifications_count=e.live_ntc_count,crmNTCGlobal.updateNotificationCount()},markAsRead:function(e){var t=e.entityId,n=e.ntc_ids.length;$("[data-ntc-entityId="+t+"]").find(".notificationgrpListRow").addClass("ntc-visited"),e.signals_count=crmNTCGlobal.signals_count-n,crmNTCWms.updateSignalsCount(e)},markAllAsRead:function(){$(".notificationgrpListRow").addClass("ntc-visited")}};!wmsBarInfo||Crm.isHeadless&&!wmsBarInfo.fromGameScope||wmsBarInfo.fromOutlook||wmsBarInfo.fromSalesSignal?wmsBarInfo&&(wmsBarInfo.fromOutlook||wmsBarInfo.fromSalesSignal)&&networkUtils.loadFeatureScripts([wmsBarInfo.wmsJSUrl],(function(){if(networkUtils.loadFeatureScripts(["zohocrm_chat.js","zohocrm_callReminder.js"],(function(){initiateWMS()}),!0),wmsLoaded=!0,wmsBarInfo.isAccountNotNull){var e=$("#subvalue_ACCOUNTID");e.html(wmsBarInfo.accName),e.attr("data-params",'{"lookback":"","module":"","id":""}'),e.data("params").id=wmsBarInfo.accId}var t={};t.entityId=wmsBarInfo.entityId,t.module=wmsBarInfo.module,t.fromAddr=wmsBarInfo.email,t.toAddr=wmsBarInfo.userEmail,t.rightPanelSource="outlook",wmsBarInfo.fromOutlook&&$$rightPanel.getRightPanel(t)}),!0):(wmsBarInfo.fromFooter&&networkUtils.loadFeatureScripts(wmsBarInfo.featureScript,void 0,!0),Lyte.injectResources([wmsBarInfo.wmsJSUrl,wmsBarInfo.wmsCSSUrl,networkUtils.returnDependencyFiles(["crm-sticky-mixin.js"],ResourceConstants.CRMClient)],void 0,(function(){networkUtils.loadFeatureScripts(["zohocrm_chat.js","zohocrm_callReminder.js"],(function(){"true"!==new URLSearchParams(window.location.search).get("isABM_CC_Page")?initiateWMS():Activities.reminderCount>0&&Activities.showHideRemainder()}),!0),wmsBarInfo.fromGameScope&&$(".remainder-notifi").hide(),wmsLoaded=!0;$L("#gamenotification").is(":visible");WmsUIImpl.UIReady=function(){if(!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.addActionsForWMSBar()}if(thirdPartyUtils.bindSelect2("#ldChatMultiplePortalSel"),wmsBarInfo.isLiveDeskEnabled&&Object.keys(wmsBarInfo.userScreenVsPortalJson).length>0)try{CrmTracking.setServerTimeDiff(wmsBarInfo.setServerTimeDiff),CrmTracking.userPortalsInfo=wmsBarInfo.userScreenVsPortalJson,CrmTracking.populateUserPortalsDD(),CrmTracking.initNotification()}catch(e){murphy.error(e)}if(wmsBarInfo.fromFooter){if(Crm.userDetails.isChatbotEnabled=wmsBarInfo.isChatbotEnabled,Crm.userDetails.isChatbotEnabled){var t=networkUtils.returnDependencyFiles(["crm-chatbot-helper.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["@zia/ziaSkillsSdk/assets/js/zia-skills-sdk.js"],ResourceConstants.CRMClient,ResourceConstants.ADDONS)),Lyte.injectResources(t,void 0,void 0)}if(showRecentIteminChatBar(),CTIAPI.chatBarCheck(),wmsBarInfo.diNotificationEnabled&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){$("#di-notification-icon").css("display","block"),CrmIntelligenceNew.checkAlertStatus()})),wmsBarInfo.isTwilioTelephonyUser&&wmsBarInfo.isTelephonyConfigured){var n=twilioConfigDetails.currentStatus||wmsBarInfo.telephonyUserStatus;TwilioConf.changeStatusIcon(n)}else wmsBarInfo.isAWSTelephonyUser&&wmsBarInfo.lilyUINotify&&wmsBarInfo.lilyUINotify.lilyLogin&&($("#lily_status_img").attr("onclick","lilyUINotify.showOrHideAllStatuses(true)"),lilyUINotify.setCurrentStatus());wmsBarInfo.isNotClientPortalUser&&Crm.userDetails.stickiesRemainderCount>0&&($("#sticky-notification-count").text(Crm.userDetails.stickiesRemainderCount).show(),isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["stickynotes",Crm.userDetails.stickiesRemainderCount]));try{"undefined"!=typeof WidgetHandler&&(WidgetHandler.Telephony.render(),WidgetHandler.StandAlone.render())}catch(e){var i=console;i.log("Widget initialization failed, Error log printed below"),i.error(e)}}Lyte&&Lyte.registeredMixins["crm-create-init-mixin"]&&Lyte.registeredMixins["crm-create-init-mixin"].cscriptMenuLessUIHandling()},WmsUIImpl.handleAnnouncement=function(){var e=$("#annmsgstrip");$("#wmsannmsg");e.length&&(e.remove(),$("body").prepend(e))},WMSUI.annHideAnimate=function(e){e=document.getElementById(e);var t=$("#homePageView"),n=$L("#wmstoolbar").outerHeight(),i=t.position(),o=setInterval((function(){var s=$L("#lftmnu-banner-cont"),a=s.outerHeight(),r=e.offsetHeight,l=e.offsetTop,c=$L(".ts-vis"),m=c.offset();if(e.style.top=l-1+"px",-l>=r&&(clearInterval(o),e.style.display="none",e.style.top="0px",t.size())){var d=renderingUtils.windowHeight-(i.top-12);if(t.css("height",d),featuresAvailable.NEXTGENUI_ENABLED){var f=renderingUtils.windowHeight-30;$("#crm-left-menu").css("max-height",f);var u=renderingUtils.windowHeight,g=$L("#wmstoolbar").length>0?n:28,h=$L(".manage-modules-cont"),w=s&&s.length>0&&!(h&&h.length>0)?a:0,p=c&&c.length>0?m.top:0,C=u-((p>0?p:0)+g+w);c.css({"max-height":C+30}),$(".ts-lftmnu-modules").css("max-height","calc(100vh - 70px)")}}}),8)},WMSUI.clearAnnBanner=function(){var e=document.getElementById("annmsgstrip"),t=$("#homePageView"),n=t.position(),i=$L("#wms-chatwindowcontainer").height(),o=$L("#wmstoolbar"),s=o.outerHeight(),a=$L("#lftmnu-banner-cont"),r=$L(".manage-modules-cont"),l=a.outerHeight(),c=$L(".ts-vis"),m=c.offset();if(e&&(e.style.display="none",t.size())){var d=renderingUtils.windowHeight-(n.top-12);if(t.css("height",d),featuresAvailable.NEXTGENUI_ENABLED){var f=renderingUtils.windowHeight-i;$("#crm-left-menu").css("max-height",f)}var u=renderingUtils.windowHeight,g=o.length>0?s:28,h=a&&a.length>0&&!(r&&r.length>0)?l:0,w=c&&c.length>0?m.top:0,p=u-((w>0?w:0)+g+h);c.css({"max-height":p+30}),$(".ts-lftmnu-modules").css("max-height","calc(100vh - 70px)")}},WMSUI.annShowAnimate=function(e){(e=document.getElementById(e)).style.display="block";var t=-e.offsetHeight;e.style.top=t+"px",$("#homePageView").size()&&featuresAvailable.NEXTGENUI_ENABLED&&$(".ts-lftmnu-modules").css("max-height","calc(100vh - 110px)");var n=setInterval((function(){e.style.top=(t+=1)+"px",t>=3&&clearInterval(n)}),8)}})));