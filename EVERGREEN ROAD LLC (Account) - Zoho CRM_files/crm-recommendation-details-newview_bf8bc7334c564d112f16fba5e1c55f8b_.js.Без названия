Lyte.Component.register("crm-recommendation-details-newview",{_template:'<template tag-name="crm-recommendation-details-newview"> <template is="if" value="{{expHandlers(isTitleNeeded,\'&amp;&amp;\',expHandlers(recommendationArry.length,\'===\',0))}}"><template case="true"> <span id="title" class="crm-font-bold pL10 pR10">{{getI18n(\'crm.setup.system.ziarecommendation\')}}</span> </template></template> <template is="for" items="{{recommendationArry}}" item="res" index="indexval"> <div class="{{if(expHandlers(showEmptyScreen,\'!\'),\'recommended-products h100_per\',\'w100_per\')}} dIB vaT slides pR"> <div class="crm-font-bold crmBaseColor w100_per mB25 pB3 dIB crm-subheading-font-size"> <template is="if" value="{{expHandlers(expHandlers(isCanvasView,\'===\',false),\'||\',isTitleNeeded)}}"><template case="true"> <div class="dIB mR5 crmBaseColor crm-font-bold vaM titleForshrinkwidth zcanvas_rl_hide"><template is="if" value="{{expHandlers(isClientPortal,\'===\',true)}}"><template case="true">{{currentRecommendation.displayType}}&nbsp;</template></template>{{getI18n(expHandlers(isClientPortal,\'?:\',\'crm.recommendation.for.you\',\'crm.zia.config.org.category.recomendation\'))}}</div> </template></template> <template is="if" value="{{expHandlers(noOfKeys(res.data),\'>\',1)}}"><template case="true"> <div class="fR mT5"><div class="ico-arrow-left2 AddDisabledBgClass cP svgIcons dIB mR10" onclick="{{action(\'clickToGoPrev\',this)}}"></div><div class="ico-arrow-right2 cP dIB svgIcons" onclick="{{action(\'clickToGoNext\',this)}}"></div></div><div class="recommendationTitleSection hide">{{prodata.displayType}}<template is="if" value="{{expHandlers(prodata.type,\'===\',&quot;Rebuy&quot;)}}"><template case="true"> within {{prodata.diffDays}} days </template></template></div> </template></template> </div> <div class="recommendedDivEleCnt"> <ul class="recommendedUL pR h100_per" style="width:calc( 100% * {{noOfKeys(res.data)}});{{navStyle}}"> <template is="for" items="{{res.data}}" item="prodata" index="indexvalproduct"> <li class="p0 m0 h100_per pR" style="width:calc(( 100% / {{noOfKeys(res.data)}}) - 2.8px);"> <div class="next-prod dIB w100_per recommendHidepro h100_per boxBB pB70"> <div class="recommended-list pR"> <template is="for" items="{{prodata.products}}" item="prosdata" index="indexvalproducts"> <template is="if" value="{{expHandlers(indexvalproducts,\'===\',0)}}"><template case="true"> <div class="w100_per dIB"> <template is="if" value="{{expHandlers(recommendationsDetails.what_to.photo_enabled,\'==\',true)}}"><template case="true"> <div class="dIB vaT imageParentRec"> <template is="if" value="{{expHandlers(indexvalproducts,\'!=\',0)}}"><template case="true"> <div class="mT5 aligncenter mB5 "> <span class="ico-plus-small-bold svgIcons aligncenter dIB"></span> </div> </template></template> <div class="dIB ImgContRecommend p0 vaT {{if(prosdata.Record_Image,\'ziaTransBg\',\'\')}} "> <template is="if" value="{{prosdata.Record_Image}}"><template case="true"> <img alt="{{prosdata.name}}" class=" dIB vaT cDefault recommend-listImg zFInh" src="{{getCrmBasePath()}}/EntityImageAttach.do?action_module={{whatModule.module_name}}&amp;entityId={{prosdata.id}}&amp;actionName=readImage&amp;fileId={{prosdata.Record_Image}}"> </template><template case="false"> <div class="ico-product-white svgIcons iconProductImage"></div> </template></template> </div> </div> </template></template> <div class="dIB {{if(recommendationsDetails.what_to.photo_enabled,\'pL15 ziaRecSmalWid\',\'w100_per\')}} vaT"> <div class="dIB vaT w100_per"> <div class="recommend_prod_type crm-font-regular mB5 {{if(isClientPortal,\'hide\',\'\')}}">{{prodata.displayType}}<template is="if" value="{{expHandlers(prodata.type,\'===\',&quot;Rebuy&quot;)}}"><template case="true"> {{prodata.displayDiffDays}} </template></template></div> <template is="if" value="{{expHandlers(expHandlers(expHandlers(prodata.count,\'===\',0),\'||\',expHandlers(prodata.type,\'===\',&quot;Already bought&quot;)),\'||\',expHandlers(prodata.type,\'===\',&quot;Rebuy&quot;))}}"><template case="true"> <link-to lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{whatModule.module_name}}&quot;,&quot;{{prosdata.id}}&quot;]" lt-prop-target="_blank"> <div class="crm-font-bold pB0 dIB mB0 fL w100_per mB2 pR40"><div class="dIB w100_per crm-font-bold recPrdLink ellipsisProd">{{prosdata.name}}</div></div> </link-to> {{unescape(getRecommendationBusinessCardJson(prosdata.businessCardJson))}} <template is="if" value="{{expHandlers(prodata.type,\'===\',&quot;Already bought&quot;)}}"><template case="true"> <div class="crm-font-regular pB0 dIB w100_per lh18 vaM mT5 crmBaseColor crm-base-font-size pR40"> <div class="dIB crm-font-regular crmParagraphColor w100_per lh18 vaM crm-base-font-size"><div class="dIB mT2 mR5 vaM">{{getI18n(\'crm.recommendation.last.buy\')}}</div> <link-to lt-prop-class="dIB w100_per vaM" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{whatModule.module_name}}&quot;,&quot;{{prodata.source.id}}&quot;]" lt-prop-target="_blank"> <div class="dIB recPrdLink w100_per lh18 pB0 vaM crm-base-font-size"><div class="dIB w100_per crm-font-bold crmBaseColor recPrdLink vaM">{{prodata.source.name}}</div></div> </link-to> </div> </div> </template></template> </template><template case="false"> <template is="for" items="{{prodata.products}}" item="item" index="index"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(index,\'===\',0),\'||\',expHandlers(index,\'===\',1)),\'||\',expHandlers(index,\'===\',2))}}"><template case="true"> <link-to lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{whatModule.module_name}}&quot;,&quot;{{item.id}}&quot;]" lt-prop-target="_blank"> <div class="crm-font-bold crmBaseColor pB0 dIB mB0 w100_per mB5 pR40 crm-subheading-font-size"><div class="dIB w100_per crmBaseColor crm-font-bold recPrdLink">{{arithResult(index,expHandlers(1,\'-\'),\'-\')}}.{{item.name}}</div></div> </link-to> </template></template> </template> </template></template> <template is="if" value="{{expHandlers(prodata.type,\'!==\',&quot;Already bought&quot;)}}"><template case="true"> <template is="if" value="{{expHandlers(prodata.count,\'!==\',0)}}"><template case="true"> <div class="link crm-font-regular dB cP mT10 recLinkCol crm-base-font-size"><span id="rec-option{{indexvalproduct}}{{unqId}}" data-zcqa="viewMore" onclick="{{action(\'showPopover\',this,prodata)}}">{{getI18n(\'crm.label.view.details\')}}</span></div> </template></template> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(prodata.reasons,\'!==\',undefined),\'&amp;&amp;\',expHandlers(prodata.reasons,\'!==\',null)),\'&amp;&amp;\',expHandlers(prodata.reasons.length,\'!==\',0))}}"><template case="true"> <span class="crm-base-font-size zia-link-color cP mT15 fL cBoth" data-zcqa="reasonKnowMore" id="reasoningKnowMore{{indexvalproduct}}{{unqId}}" onclick="{{action(\'showPopoverKnowMore\',this)}}">{{getI18n(\'crm.label.setup.banner.label\')}}</span> </template></template> </div> </div> </div> </template></template> </template> </div> <template is="if" value="{{expHandlers(expHandlers(expHandlers(currentRecommendation.displayType,\'!==\',&quot;Bundle&quot;),\'&amp;&amp;\',expHandlers(currentRecommendation.products[0].feedback_given,\'===\',false)),\'||\',expHandlers(expHandlers(currentRecommendation.products[1].feedback_given,\'===\',false),\'&amp;&amp;\',expHandlers(res.data.length,\'!==\',0)))}}"><template case="true"> <div class="pT15 dIB w100_per pA boxBB ziarecwashelpful"> <crm-recommendation-feedback recommendations-details="{{recommendationsDetails}}" recommendation-arry="{{lbind(recommendationArry)}}" current-recommendation="{{lbind(currentRecommendation)}}" whom-entity-id="{{entity_id}}" nav-style="{{lbind(navStyle)}}" array-index-nav="{{lbind(arrayIndexNav)}}" show-empty-screen="{{lbind(showEmptyScreen)}}" is-empty-screen-needed="{{lbind(isEmptyScreenNeeded)}}"> </crm-recommendation-feedback> </div> </template></template> <template is="if" value="{{expHandlers(currentRecommendation.reference_records,\'&amp;&amp;\',expHandlers(currentRecommendation.reference_records.length,\'!=\',0))}}"><template case="true"> <div class="dIB"> <div class="mT10 mB10"> <div class="dIB vaM mR10 refcusdefaultcolor crm-base-font-size crm-font-regular">{{getI18n(\'crm.workflow.createrecord.reference.value\')}} {{whomModule.plural_label}}</div> <div class="dIB pR vaM"> <template is="for" items="{{currentRecommendation.reference_records}}" item="item" index="index"> <div id="referenceCustomerEl{{expHandlers(expHandlers(expHandlers(expHandlers(entity_id,\'+\',\'_\'),\'+\',item.record.id),\'+\',\'_\'),\'+\',index)}}" class="referencecustomerImg vaM dIB {{if(expHandlers(referenceCustomerPopoverElem,\'===\',expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(\'#referenceCustomerEl\',\'+\',entity_id),\'+\',\'_\'),\'+\',item.record.id),\'+\',\'_\'),\'+\',index)),\'selRecUser\',\'\')}}" onclick="{{action(\'showPopoverReferenceCustomer\',expHandlers(expHandlers(entity_id,\'+\',\'_\'),\'+\',item.record.id),index,item)}}"> <template is="if" value="{{expHandlers(item.record.Record_Image,\'===\',null)}}"><template case="true"> <img alt="{{item.record.name}}" class=" dIB vaT recommend-listImg opNone zFInh cP" src="{{getCrmImageUrl(\'nophoto.png\')}}"> </template><template case="false"> <img alt="{{item.record.name}}" class=" dIB vaT recommend-listImg opNone zFInh cP" src="{{getCrmBasePath()}}/EntityImageAttach.do?action_module={{whomModule.module_name}}&amp;entityId={{item.record.id}}&amp;actionName=readImage&amp;fileId={{item.record.Record_Image}}"> </template></template> </div> </template> </div> </div> </div> </template></template> </div> </li> </template> </ul> </div> </div> </template> <lyte-popover lt-prop-footer-padding="15px 30px" lt-prop-type="callout" lt-prop-freeze="true" lt-prop-show-close-button="false" lt-prop-origin-elem="{{referenceCustomerPopoverElem}}" lt-prop-show="{{referenceCustomerPopoverShow}}" on-close="{{method(\'leavePopoverReferenceCustomer\')}}" id="lytePopoverrecommendationKnowMore" lt-prop-wrapper-class="recommendation_lytePopoverElement" lt-prop-content-padding="30px" lt-prop-close-on-body-click="true" lt-prop-width="500px" lt-prop-scrollable="true" data-zcqa="reasonKnowMorePopUp"> <template is="registerYield" yield-name="popover"> <lyte-popover-content onmouseleave="{{action(\'leavePopoverReferenceCustomer\')}}"> <div id="referenceCustomerMainPopOverDiv"> <div class="w100_per dIB"> <template is="if" value="{{expHandlers(recommendationsDetails.whom_to.photo_enabled,\'===\',true)}}"><template case="true"> <div class="dIB vaT imageParentRec referencecustomerImg forPopOver"> <template is="if" value="{{expHandlers(currentReferenceCustomer.record.Record_Image,\'===\',null)}}"><template case="true"> <img alt="{{currentReferenceCustomer.record.name}}" class=" dIB vaT recommend-listImg opNone zFInh cP" src="{{getCrmImageUrl(\'nophoto.png\')}}"> </template><template case="false"> <img alt="{{currentReferenceCustomer.record.name}}" class=" dIB vaT recommend-listImg opNone zFInh cP" src="{{getCrmBasePath()}}/EntityImageAttach.do?action_module={{whomModule.module_name}}&amp;entityId={{currentReferenceCustomer.record.id}}&amp;actionName=readImage&amp;fileId={{currentReferenceCustomer.record.Record_Image}}"> </template></template> </div> </template></template> <div class="dIB pL10 ziaRecSmalWid forRecReferencePop vaT"> <div class="dIB vaT w100_per"> <div class="crm-font-bold refcusnamecolor crm-subheading-font-size pB0 dIB mB0 w100_per cP"> <link-to lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{whomModule.module_name}}&quot;,&quot;{{currentReferenceCustomer.record.id}}&quot;]" lt-prop-target="_blank"> <div class="dIB ellipsisProd w100_per refcusnamecolor crm-font-bold">{{currentReferenceCustomer.record.name}}</div> </link-to> </div> <template is="if" value="{{expHandlers(referenceCustomerRecord.Account_Name,\'!==\',null)}}"><template case="true"> <div class="crm-font-regular refcusacccolor mT3 pB0 ellipsisProd crm-base-font-size">{{referenceCustomerRecord.Account_Name.name}}</div> </template></template> <div class="crm-font-regular mT5 pB0"> <span class="referenceCustomerScore crm-small-font-size">{{getI18n(\'zia.recommendation.reference.customer.similarity.score\',currentReferenceCustomer.score)}}</span> </div> </div> </div> </div> <template is="if" value="{{referenceCustomerTransactionInfo.first_transaction}}"><template case="true"><div class="w100_per dIB mT20"> <div class="dIB vaT w100_per mB10"> <div class="crm-font-regular refcusdefaultcolor crm-base-font-size"> <div class="dIB ico-diamond vaM"></div> <div class="dIB mL10">{{getI18n(\'First\')}} {{basedOnModule.singular_label}} {{getLastModified(referenceCustomerTransactionInfo.first_transaction)}}</div> </div> </div> <div class="dIB vaT w100_per"> <div class="crm-font-regular refcusdefaultcolor crm-base-font-size"> <div class="dIB ico-refclockIcon vaM"></div> <div class="dIB mL10">{{getI18n(\'zia.recommendation.reference.customer.prior\',basedOnModule.singular_label,whatModule.plural_label,referenceCustomerTransactionInfo.transaction_count)}}</div> </div> </div> </div></template></template> <template is="if" value="{{expHandlers(expHandlers(currentReferenceCustomer.reason,\'!==\',undefined),\'&amp;&amp;\',expHandlers(currentReferenceCustomer.reason.length,\'!==\',0))}}"><template case="true"><div class="w100_per dIB mT20"> <div class="dIB vaT w100_per"> <div class="pB0 dIB mB0 w100_per cP"> <div class="dIB w100_per crm-base-font-size crm-font-semibold refcusdefaultcolor">{{getI18n(\'zia.recommendation.reference.customer.why\',whomModule.singular_label)}}</div> </div> </div> <div class="dIB vaT w100_per mT15"> <ul class="reasoningReferenceCustomer p0 m0"> <template is="for" items="{{currentReferenceCustomer.reason}}" item="item" index="index"> <li class="m0 refcusdefaultcolor refCustomrItemLi crm-base-font-size">{{item}}</li> </template> </ul> </div> </div></template></template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-footer-padding="15px 30px" lt-prop-type="callout" lt-prop-freeze="true" lt-prop-show-close-button="false" lt-prop-origin-elem="{{reasoningPopoverElem}}" lt-prop-show="{{reasoningPopoverShow}}" on-close="{{method(\'reasoningPopoverClose\')}}" id="lytePopoverrecommendationKnowMore" lt-prop-wrapper-class="recommendation_lytePopoverElement" lt-prop-content-padding="30px 20px" lt-prop-close-on-body-click="true" lt-prop-max-height="500px" lt-prop-width="330px" lt-prop-scrollable="true" data-zcqa="reasonKnowMorePopUp"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="crm-base-font-size crm-font-bold zia-font-title-color mB15">{{getI18n(\'crm.recommendation.reason.title\')}}</div> <template is="for" items="{{currentRecommendation.reasons}}" item="reason" index="index"> <div class="crm-base-font-size crm-font-regular zia-font-body-color recResBulletPoint">{{reason}}</div> </template> </lyte-popover-content> </template> </lyte-popover> <lyte-popover id="lytePopoverrecommendation" lt-prop-wrapper-class="recommendation_lytePopoverElement" lt-prop-content-padding="30px" lt-prop-close-on-body-click="true" lt-prop-max-height="500px"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="recommendHide recMaxandminwid" id="recommendationdetails"> <div class="next-prod dIB w100_per recommendHidepro"> <div class="recommended-list pR"> <template is="for" items="{{currentRec.products}}" item="prosdata" index="indexvalproducts"> <div class="w100_per dIB"> <template is="if" value="{{expHandlers(indexvalproducts,\'!=\',expHandlers(1,\'-\'))}}"><template case="true"> <div class="dIB imageParentRec vaT"> <template is="if" value="{{expHandlers(indexvalproducts,\'>\',0)}}"><template case="true"> <div class="mT5 aligncenter mB5 "> <span class="ico-plus-small-bold svgIcons dIB aligncenter"></span> </div> </template></template> <template is="if" value="{{expHandlers(recommendationsDetails.what_to.photo_enabled,\'==\',true)}}"><template case="true"> <div class="dIB ImgContRecommend p0 vaT" style="{{if(prosdata.Record_Image,\'background-color:transparent;\',\'\')}}"> <template is="if" value="{{prosdata.Record_Image}}"><template case="true"> <img alt="image" class=" dIB vaT cDefault recommend-listImg opNone" src="{{getCrmBasePath()}}/EntityImageAttach.do?action_module={{whatModule.module_name}}&amp;entityId={{prosdata.id}}&amp;actionName=readImage&amp;fileId={{prosdata.Record_Image}}"> </template><template case="false"> <div class="ico-product-white svgIcons iconProductImage"></div> </template></template> </div> </template></template> </div> <div class="dIB {{if(ifEquals(indexvalproducts,0),\'\',\'mT30\')}} {{if(recommendationsDetails.what_to.photo_enabled,\'pL10 ziaRecSmalWid\',\'mT0 w100_per\')}} vaT"> <div class="dIB vaT w100_per"> <link-to lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{whatModule.module_name}}&quot;,&quot;{{prosdata.id}}&quot;]" lt-prop-target="_blank"> <div class="crm-font-bold crmBaseColor pB0 crm-medium-large-font-size w100_per mB0 pR40 dIB "><div class="dIB crm-font-bold crmBaseColor w100_per recPrdLink">{{prosdata.name}}</div></div> </link-to> {{unescape(getRecommendationBusinessCardJson(prosdata.businessCardJson))}} </div> </div> </template></template> </div> </template> </div> </div> </div> </lyte-popover-content> </template> </lyte-popover> <template is="if" value="{{expHandlers(isEmptyScreenNeeded,\'&amp;&amp;\',showEmptyScreen)}}"><template case="true"><div class="dIB crm-font-regular w100_per lh18 vaM aligncenter crm-small-font-size"> <div class="dIB mR5 vaM">{{getI18n(\'crm.zia.no.record.recommendation\')}}</div> </div></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"for",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"if",position:[1,0],cases:{true:{dynamicNodes:[{type:"text",position:[0]}]}},default:{}},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"attr",position:[1,1]},{type:"text",position:[2,0]},{type:"attr",position:[2,2]},{type:"if",position:[2,2],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:calc( 100% * '",{type:"helper",value:{name:"noOfKeys",args:["res.data"]}},"');'","navStyle"]}}}},{type:"attr",position:[1,3,1,1]},{type:"for",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:calc(( 100% / '",{type:"helper",value:{name:"noOfKeys",args:["res.data"]}},"') - 2.8px);'"]}}}},{type:"attr",position:[1,1,1,1]},{type:"for",position:[1,1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1,1]},{type:"text",position:[1,3,1,1,0]},{type:"attr",position:[1,3,1,1,2]},{type:"if",position:[1,3,1,1,2],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"attr",position:[1,3,1,3]},{type:"if",position:[1,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1]},{type:"text",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0,0]},{type:"attr",position:[1,1,2]},{type:"text",position:[1,1,2,1,0,0]},{type:"componentDynamic",position:[1,1,2]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"text",position:[1,1,0,2]},{type:"componentDynamic",position:[1]}]}},default:{}}]}]}},default:{}},{type:"attr",position:[1,3,1,5]},{type:"if",position:[1,3,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"text",position:[1,0,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1,7]},{type:"if",position:[1,3,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,1,2]},{type:"attr",position:[1,1,3,1]},{type:"for",position:[1,1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}]}},default:{}}]}]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,3,1,1,1]},{type:"text",position:[1,1,1,3,1,1,1,1,0]},{type:"componentDynamic",position:[1,1,1,3,1,1,1]},{type:"attr",position:[1,1,1,3,1,3]},{type:"if",position:[1,1,1,3,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"text",position:[1,1,1,3,1,5,1,0]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,1,3,0]},{type:"text",position:[0,1,1,3,2]},{type:"text",position:[0,1,1,3,4]},{type:"text",position:[0,3,1,3,0]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,1,1,0]},{type:"attr",position:[0,3,1,1]},{type:"for",position:[0,3,1,1],dynamicNodes:[{type:"text",position:[1,0]}]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]},{type:"registerYield",position:[9,1],dynamicNodes:[{type:"attr",position:[1,1,1,1,1]},{type:"for",position:[1,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"if",args:["prosdata.Record_Image","'background-color:transparent;'","''"]}}}},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1,1]},{type:"text",position:[3,1,1,1,0,0]},{type:"componentDynamic",position:[3,1,1]},{type:"text",position:[3,1,3]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[9]},{type:"attr",position:[11]},{type:"if",position:[11],cases:{true:{dynamicNodes:[{type:"text",position:[0,1,0]}]}},default:{}}],_observedAttributes:["unqId","isEmptyScreenNeeded","whatName","recommendationArry","currentRecommendation","entity_id","entity_module","rebuy_check","rebuy_check_today","newLink","isClientPortal","currentRec","isBoughtTogether","isCanvasView","diplayIndex","recommendationsDetails","arrayIndexNav","navStyle","reasoningPopoverShow","reasoningPopoverElem","whatModule","whomModule","basedOnModule","referenceCustomerDealInfo","referenceCustomerTransactionInfo","referenceCustomerRecord","currentReferenceCustomer","showEmptyScreen"],data:function(){return{unqId:Lyte.attr("number",{default:Math.floor(1e4*Math.random())}),isEmptyScreenNeeded:Lyte.attr("boolean",{default:!1}),whatName:Lyte.attr("string"),recommendationArry:Lyte.attr("array",{default:[]}),currentRecommendation:Lyte.attr("object"),entity_id:Lyte.attr("string"),entity_module:Lyte.attr("string"),rebuy_check:Lyte.attr("boolean",{default:!0}),rebuy_check_today:Lyte.attr("boolean",{default:!1}),newLink:Lyte.attr("boolean",{default:!1}),isClientPortal:Lyte.attr("boolean",{default:!1}),currentRec:Lyte.attr("object"),isBoughtTogether:Lyte.attr("boolean",{default:!1}),isCanvasView:Lyte.attr("boolean",{default:!1}),diplayIndex:Lyte.attr("number",{default:0}),recommendationsDetails:Lyte.attr("object"),arrayIndexNav:Lyte.attr("number",{default:0}),navStyle:Lyte.attr("string",{default:""}),reasoningPopoverShow:Lyte.attr("boolean",{default:!1}),reasoningPopoverElem:Lyte.attr("string",{default:""}),whatModule:Lyte.attr("object"),whomModule:Lyte.attr("object"),basedOnModule:Lyte.attr("object"),referenceCustomerDealInfo:Lyte.attr("object",{default:{}}),referenceCustomerTransactionInfo:Lyte.attr("object"),referenceCustomerRecord:Lyte.attr("object"),currentReferenceCustomer:Lyte.attr("object"),showEmptyScreen:Lyte.attr("boolean",{default:!1})}},didDestroy:function(){store.unloadAll("recommendations-details"),store.unloadAll("recommendations_reference_customer")},referenceRecordsSorting:function(e){return e.reference_records&&0!==e.reference_records.length&&(e.reference_records=e.reference_records.sort((function(e,t){var o=e.score,a=t.score;return o<a?-1:o>a?1:0}))),e},renderAfterProcess:function(e){var t=this.getData("recommendationArry");t.push(e),this.setData("recommendationArry",[]),this.setData("recommendationArry",t);var o=this.getData("recommendationsDetails");this.setData("whatModule",store.peekRecord("module",o.what_to.id)),this.setData("whomModule",store.peekRecord("module",o.whom_to.id)),this.setData("basedOnModule",store.peekRecord("module",o.based_on.id)),e.data.length&&($L("#recommendationDetailUi").show(),t&&this.setData("currentRecommendation",this.referenceRecordsSorting(t[0].data[0])))},init:function(){var e=this;if(e.setData("isClientPortal",void 0!==clientPortalName),!0===e.getData("isCanvasView")){var t=Lyte.registeredMixins["zia-insights-utils"].getInsightsV2(moduleRecordMapping[e.getData("entity_module")],e.getData("entity_id"),{keys:"recommendation_data"},null,"recommendation_early_access");t?t.then((function(t){var o=t.zia_insights,a=o.recommendation_data?o.recommendation_data[0]:void 0;if(a){var r=a.output;if(r.length){var i=e.$node,n=r[0],s=a.recommendation,d=store.createRecord("recommendations-details");d.$.set("recommendation_id",s.id),d.$.set("name",s.name),d.$.set("first_buy",n.first_buy),d.$.set("next_buy",n.next_buy),d.$.set("rebuy",n.rebuy),d.$.set("frequently_bought_together",n.frequently_bought_together),d.$.set("customer_also_bought",n.customer_also_bought),d.$.set("whom_to",s.whom_to),d.$.set("what_to",s.what_to),d.$.set("based_on",s.based_on),i.component.setData("recommendationsDetails",d),i.component.dataPageInitLoader(i.component,i.component.getData("entity_module"),d)}}else e.setData("isEmptyScreenNeeded",!0),e.setData("showEmptyScreen",!0)}),(function(){e.setData("isEmptyScreenNeeded",!0),e.setData("showEmptyScreen",!0)})):(e.setData("isEmptyScreenNeeded",!0),e.setData("showEmptyScreen",!0))}},didConnect:function(){let e=this;var t=$L("#entityName");this.setData("whatName",t?t.val():""),$(".recommendationsuccessBandClass").hide();var o=this.getData("entity_module");if(1!=store.peekRecord("module",moduleRecordMapping[o].id).isRecommendationsEnable&&this.getData("isCanvasView")){var a=$L(e.$node).find("#noResultRecommendation");0!==a.length&&a.show()}},actions:{showPopoverKnowMore:function(e){var t=$L(e).attr("id");this.setData("reasoningPopoverElem","#"+t),this.setData("reasoningPopoverShow",!0)},showPopover:function(e,t){var o=$L(e).attr("id"),a=$L(this.$node).find("#lytePopoverrecommendation").eq(0)[0];a.ltProp("originElem","#"+o),a.ltProp("show",!0),this.setData("currentRec",t),$L(this.$node).find(".recommendHidepro").css("display","block")},clickToGoPrev:function(e){var t=this.getData("arrayIndexNav");t-=1,this.setData("arrayIndexNav",t),Crm.userDetails.RTL_ENABLED?this.setData("navStyle","right:calc(-100% * "+t+" )"):this.setData("navStyle","left:calc(-100% * "+t+" )"),t<=0&&$L(e).addClass("AddDisabledBgClass"),$L(this.$node).find(".ico-arrow-right2").removeClass("AddDisabledBgClass");var o=this.getData("recommendationArry");o&&this.setData("currentRecommendation",this.referenceRecordsSorting(o[0].data[t]))},clickToGoNext:function(e){var t=this.getData("arrayIndexNav"),o=this.data.recommendationArry[0].data.length;t+=1,this.setData("arrayIndexNav",t),Crm.userDetails.RTL_ENABLED?this.setData("navStyle","right:calc(-100% * "+t+" )"):this.setData("navStyle","left:calc(-100% * "+t+" )"),t>=o-1&&$L(e).addClass("AddDisabledBgClass"),$L(this.$node).find(".ico-arrow-left2").removeClass("AddDisabledBgClass");var a=this.getData("recommendationArry");a&&this.setData("currentRecommendation",this.referenceRecordsSorting(a[0].data[t]))},showPopoverReferenceCustomer:function(e,t,o){var a=this;a.setData("referenceCustomerPopoverShow",!1),a.setData("currentReferenceCustomer",o);var r=a.getData("currentRecommendation"),i=a.getData("whomModule"),n=r.source.id,s=o.record.id,d={entity_module_api_name:moduleRecordMapping[a.getData("entity_module")].api_name,entity_id:a.getData("entity_id"),id:e},p={include:"recommendation_purchase_data",skip_other_data:!0,what_id:n,whom_id:s};commonUtils.showHideLoadingDiv(!0),(void 0===store.peekRecord("recommendations_reference_customer",e)?store.findAll("recommendations_reference_customer",p,!0,!0,d):Promise.resolve(store.peekRecord("recommendations_reference_customer",e))).then((function(r){a.setData("referenceCustomerTransactionInfo",r),(void 0===store.peekRecord(i.id,o.record.id)?store.findRecord(i.id,o.record.id):Promise.resolve(store.peekRecord(i.id,o.record.id))).then((function(){commonUtils.showHideLoadingDiv(!1);var r=store.peekRecord(i.id,o.record.id);a.setData("referenceCustomerRecord",r),a.setData("referenceCustomerPopoverElem","#referenceCustomerEl"+e+"_"+t),a.setData("referenceCustomerPopoverShow",!0)}),(function(){commonUtils.showHideLoadingDiv(!1)}))}),(function(){commonUtils.showHideLoadingDiv(!1)}))},leavePopoverReferenceCustomer:function(){this.setData("referenceCustomerPopoverElem",""),this.setData("referenceCustomerPopoverShow",!1)}},methods:{reasoningPopoverClose:function(){this.setData("reasoningPopoverElem",""),this.setData("reasoningPopoverShow",!1)},leavePopoverReferenceCustomer:function(){this.setData("referenceCustomerPopoverElem",""),this.setData("referenceCustomerPopoverShow",!1)}}},{mixins:["recommendation-util"]}),Lyte.Component.registerHelper("getUserFullName",(function(e){return e?e.full_name:""})),Lyte.Component.registerHelper("getRoleName",(function(e){return e?I18n.getMsg(e.role.name):""})),Lyte.Component.registerHelper("getCurrentShift",(function(e){return e&&e.$current_shift&&e.$current_shift.name?e.$current_shift.name:"-"})),Lyte.Component.registerHelper("getNextShift",(function(e){return e&&e.$next_shift&&e.$next_shift.name?e.$shift_effective_from?I18n.getMsg("crm.bh.changeshiftfrom",[e.$next_shift.name,CrmDateUtils.convertDateToUserPattern($L.moment(e.$shift_effective_from).i18N("YYYY-MM-DD"))]):e.$next_shift.name:"-"})),Lyte.Component.registerHelper("removeDoubleQuote",(function(e){return e?JSON.stringify(e).replace(/"/g,""):""})),Lyte.Component.registerHelper("arrToString",(function(e){return e?e.toString():""})),Lyte.Component.registerHelper("getStartTime",(function(e,t,o,a,r,i,n){if("breakHours"===e){var s=Lyte.registeredMixins["business-hours-utils"];if(s.CrmBusinessHours.onSave)return;return void 0!==r?"from"===t?a?o.vbv_time[r].trans_time[0]:o.vbv_time[r].time[0]:s.getBreakStart(s.timeToUsrFmtFrom24Hr(s.convertDecimalToTime(s.convertTimetoDecimal(o.break_hours[n].vbv_time[r].trans_time[0])+15)),void 0,o.vbv_time[r].trans_time[0],o.vbv_time[r].trans_time[1]):"from"===t?a?o.trans_time[0]:o.time[0]:s.getBreakStart(s.timeToUsrFmtFrom24Hr(s.convertDecimalToTime(s.convertTimetoDecimal(o.break_hours[n].trans_time[0])+15)),void 0,o.trans_time[0],o.trans_time[1])}})),Lyte.Component.registerHelper("getEndTime",(function(e,t,o,a,r,i,n){if("breakHours"===e){var s=Lyte.registeredMixins["business-hours-utils"];if(s.CrmBusinessHours.onSave)return;return void 0!==r?"from"===t?a?s.convertDecimalToTime(s.convertTimetoDecimal(o.vbv_time[r].trans_time[1])-1):s.timeToUsrFmtFrom24Hr(s.convertDecimalToTime(s.convertTimetoDecimal(o.vbv_time[r].trans_time[1])-1)):s.isBreakHoursGreater(o.vbv_time[r].trans_time[0],o.vbv_time[r].trans_time[1],o.break_hours[n].vbv_time[r].trans_time[0],o.vbv_time[r].trans_time[1],!0):"from"===t?a?s.convertDecimalToTime(s.convertTimetoDecimal(o.trans_time[1])-1):s.timeToUsrFmtFrom24Hr(s.convertDecimalToTime(s.convertTimetoDecimal(o.trans_time[1])-1)):s.isBreakHoursGreater(o.trans_time[0],o.trans_time[1],o.break_hours[n].trans_time[0],o.trans_time[1],!0)}})),Lyte.Component.registerHelper("getUserDatePattern",(function(){return Crm.userDetails.DATE_PATTERN.replace(/'/g,"")})),Lyte.Component.registerHelper("getNextShiftDateFormat",(function(e,t){return e&&"-"!==e?"popup"===t?e&&e.effEhift&&e.effective_from?I18n.getMsg("crm.bh.changeshiftfrom",[e.effEhift,e.effective_from]):"":e?I18n.getMsg("crm.bh.changeshiftfrom",[e.substring(0,e.indexOf("(")-1),e.substring(e.indexOf("(")+1,e.indexOf(")"))]):"":"-"})),Lyte.Component.registerHelper("hasAllShiftCreated",(function(e,t,o){var a=t[o],r=e?e.length:0,i=0;if(a)for(var n=0;n<r;n++)if(!a.contains(e[n].id)){i=1;break}return a||(i=1),0===i})),Lyte.Component.registerHelper("hasShiftCreated",(function(e,t,o){return t[o]&&t[o].contains(e)})),Lyte.Component.registerHelper("getDay",(function(e){var t=e.split("-");return I18n.getMsg(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(t[0],t[1]-1,t[2]).getDay()])})),Lyte.Component.register("crm-recommendation-feedback",{_template:'<template tag-name="crm-recommendation-feedback"> <div class="dIB vaM crm-base-font-size"> {{getI18n(\'zia.recommendation.feedback.question\')}} </div> <div class="dIB vaM mL10"> <lyte-button lt-prop-size="small" lt-prop-class="newwhitebtn" onclick="{{action(\'positiveFeedback\')}}" data-zcqa="saveRecYesFeedback"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.yes\')}} </template> </lyte-button> <lyte-button lt-prop-size="small" onclick="{{action(\'negativeFeedback\')}}" lt-prop-class="newwhitebtn" data-zcqa="saveRecNoFeedback"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.no\')}} </template> </lyte-button> </div> <lyte-modal id="recFeedbackId" lt-prop-wrapper-class="crmBoxModal" lt-prop-freeze="true" lt-prop-dimmer="{&quot;color&quot;:&quot;var(--modalFreezeLayerBg)&quot;,&quot;opacity&quot;:&quot;0.5&quot;}" lt-prop="{&quot;width&quot; : &quot;680px&quot;, &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-show="{{showModal}}" on-close="{{method(\'onCloseModal\')}}" lt-prop-show-close-button="false" lt-prop-transition="{&quot;animation&quot;:&quot;zoom&quot;}" lt-prop-offset="{&quot;top&quot;:&quot;center&quot;,&quot;left&quot;:&quot;center&quot;}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> {{getI18n(\'zia.recommendation.feedback.popup.heading\')}} </lyte-modal-header> <lyte-modal-content> <div class="crm-font-regular mB20 crmParagraphColor crm-base-font-size lh24"> {{getI18n(\'zia.recommendation.feedback.popup.brief\')}} </div> <div class="crm-font-bold ziaNotifyFontBold mB15"> {{getI18n(\'zia.recommendation.feedback.popup.subheading\')}} </div> <div class="crm-font-regular ziaNotifyFontReg showonlyonaskzia mB15"> <lyte-radiobutton lt-prop-type="primary" lt-prop-checked="true" lt-prop-fire-on-init="true" lt-prop-name="primary" lt-prop-value="different" on-checked="{{method(\'onChooseFeedback\')}}" lt-prop-label="{{getI18n(\'zia.recommendation.feedback.reason1\',labels.whatTo)}}"></lyte-radiobutton> </div> <div class="crm-font-regular ziaNotifyFontReg showonlyonaskzia mB15"> <lyte-radiobutton lt-prop-type="primary" lt-prop-name="primary" lt-prop-value="not_relevant" on-checked="{{method(\'onChooseFeedback\')}}" lt-prop-label="{{getI18n(\'zia.recommendation.feedback.reason2\',labels.whomTo)}}"></lyte-radiobutton> </div> <div class="crm-font-regular ziaNotifyFontReg showonlyonaskzia mB15"> <lyte-radiobutton lt-prop-type="primary" lt-prop-name="primary" lt-prop-value="not_interested" on-checked="{{method(\'onChooseFeedback\')}}" lt-prop-label="{{getI18n(\'zia.recommendation.feedback.reason3\',labels.whomTo)}}"></lyte-radiobutton> </div> <div class="crm-font-regular ziaNotifyFontReg showonlyonaskzia mB15"> <lyte-radiobutton lt-prop-type="primary" lt-prop-name="primary" lt-prop-value="too_many" on-checked="{{method(\'onChooseFeedback\')}}" lt-prop-label="{{getI18n(\'zia.recommendation.feedback.reason4\')}}"></lyte-radiobutton> </div> <div class="crm-font-regular ziaNotifyFontReg showonlyonaskzia mB15"> <lyte-radiobutton lt-prop-type="primary" lt-prop-name="primary" lt-prop-value="less_reason" on-checked="{{method(\'onChooseFeedback\')}}" lt-prop-label="{{getI18n(\'zia.recommendation.feedback.reason5\',labels.whomTo)}}"></lyte-radiobutton> </div> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button data-zcqa="cancelRecNoFeedbackChoice" onclick="{{action(\'cancelFeedback\')}}" lt-prop-class="newwhitebtn"> <template is="registerYield" yield-name="text"> {{getI18n(\'Cancel\')}} </template> </lyte-button> <lyte-button lt-prop-class="primarybtn" onclick="{{action(\'submitFeedback\')}}" lt-prop-appearance="primary" data-zcqa="saveRecNoFeedbackChoice"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.submit\')}} </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"text",position:[1,1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,1,1]},{type:"text",position:[3,3,1]},{type:"attr",position:[3,5,1]},{type:"componentDynamic",position:[3,5,1]},{type:"attr",position:[3,7,1]},{type:"componentDynamic",position:[3,7,1]},{type:"attr",position:[3,9,1]},{type:"componentDynamic",position:[3,9,1]},{type:"attr",position:[3,11,1]},{type:"componentDynamic",position:[3,11,1]},{type:"attr",position:[3,13,1]},{type:"componentDynamic",position:[3,13,1]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[5]}],_observedAttributes:["showModal","feedbackChoice","recommendationsDetails","currentRecommendation","recommendationArry","labels","whomEntityId","navStyle","arrayIndexNav","isEmptyScreenNeeded","showEmptyScreen"],data:function(){return{showModal:Lyte.attr("boolean",{default:!1}),feedbackChoice:Lyte.attr("string",{default:"success"}),recommendationsDetails:Lyte.attr("object"),currentRecommendation:Lyte.attr("object"),recommendationArry:Lyte.attr("array"),labels:Lyte.attr("object",{default:{}}),whomEntityId:Lyte.attr("string"),navStyle:Lyte.attr("string"),arrayIndexNav:Lyte.attr("number"),isEmptyScreenNeeded:Lyte.attr("boolean",{default:!1}),showEmptyScreen:Lyte.attr("boolean",{default:!1})}},actions:{positiveFeedback:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.newui.feedback.label.thankstatement")}}),this.removeFeedBack(this),this.setData("feedbackChoice","success"),this.makePOST(this,!0)},negativeFeedback:function(){this.setData("showModal",!0),this.setData("feedbackChoice","different")},submitFeedback:function(){this.setData("showModal",!1),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.newui.feedback.label.thankstatement")}}),this.makePOST(this,!1),this.removeRecommendationResult(this),this.refreshModal(this)},cancelFeedback:function(){this.setData("showModal",!1),this.refreshModal(this)}},methods:{onChooseFeedback:function(e,t){this.setData("feedbackChoice",t.data.ltPropValue)},onCloseModal:function(){this.setData("showModal",!1)}},init:function(){var e=this.getData("recommendationsDetails"),t={};t.whatTo=store.peekRecord("module",e.what_to.id).singular_label,t.whomTo=store.peekRecord("module",e.whom_to.id).singular_label,this.setData("labels",t)},getSuggestionTypeApiName:function(e){switch(e){case"First buy":return"first_buy";case"Next Buy":return"next_buy";case"Bought Together":return"frequently_bought_together";case"Already bought":return"customer_also_bought";default:return"rebuy"}},constructPayload:function(e,t){var o=e.getData("currentRecommendation"),a=o.products,r=a.length,i=e.getData("whomEntityId"),n={};return n.what_to={id:a[r-1].id,module:{id:t.what_to.id,api_name:t.what_to.api_name}},n.whom_to={id:i,module:{id:t.whom_to.id,api_name:t.whom_to.api_name}},n.suggestion_type=e.getSuggestionTypeApiName(o.type),n.feedback_given=e.getData("feedbackChoice"),{recommendation_feedback:n}},makePOST:function(e,t){var o=e.getData("recommendationsDetails"),a={};a.payLoad=e.constructPayload(e,o),a.url="/crm/v4/recommendations/"+o.recommendation_id+"/actions/feedback",store.triggerAction("recommendations","feedback",a,{},"POST").then((function(){var e={};e.Action=t?"Yes":"No",e.feedback=a.payLoad.recommendation_feedback.feedback_given,Crm.client_tracking("Recommendation feedback",e)}))},removeRecommendationResult:function(e){var t=e.getData("recommendationArry"),o=objectUtils.cloneObject_new(t),a=e.getData("currentRecommendation"),r=1;o[0].data=o[0].data.filter(((e,t)=>{var o=!_.isEqual(a,e);return o||(r=t),o})),Lyte.arrayUtils(t,"pop"),Lyte.arrayUtils(t,"push",o);var i=0===r?0:r-1;e.setData("navStyle","left:calc(-100% * "+i+")"),e.setData("arrayIndexNav",i),0!==i&&$L(".ico-arrow-left2").removeClass("AddDisabledBgClass"),o[0].data&&0!==o[0].data.length?(i+1===o[0].data.length&&$L(".ico-arrow-right2").addClass("AddDisabledBgClass"),e.setData("currentRecommendation",o[0].data[0])):(e.setData("isEmptyScreenNeeded",!0),e.setData("showEmptyScreen",!0),$L(e.$node).find("#recommendationDetailUi").hide())},removeFeedBack:function(e){var t=e.getData("currentRecommendation"),o=t.products,a=o.length;Lyte.objectUtils(o[a-1],"add","feedback_given",!0);var r=objectUtils.cloneObject_new(t);e.setData("currentRecommendation",r)},refreshModal:function(e){var t=$L("#recFeedbackId")[0];t&&t.setData("ltPropReRenderModal",!0),e.setData("feedbackChoice","success")}});
