Lyte.Component.registerHelper("getSplitValues",(function(e,t,a){return e.split(t)[a]})),Lyte.Component.registerHelper("getSelectedTab",(function(){return $(".selectTab")[0].id})),Lyte.Component.registerHelper("ifNotInventoryModule",(function(e){return"Quotes"!==e&&"Invoices"!==e&&"PurchaseOrders"!==e&&"SalesOrders"!==e})),Lyte.Component.registerHelper("isUserHasSendMailPermission",(function(e){var t=e,a=!0,i=moduleApiVsNameMapping[t];i&&(t=i);try{a=t&&Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+t],a=!Crm.SEND_MAIL_BUTTON_HIDE||a}catch(e){a=!0}return a||(a=!1),a})),Lyte.Component.registerHelper("isDropDownNeeded",(function(e){var t=e&&(e.all_emails||e.all_imap_shared_users||e.all_pop_shared_users||e.pop_users||e.imap_users||e.gmail_users);return!(!e||!(this.getData("isCRRLEnabled")&&"Potentials"===e.module&&e.mailConfigured||"Accounts"===e.module&&t||t))})),Lyte.Component.registerHelper("getZohoMailUsersLabel",(function(){return I18n.getMsg("crm.zmail.public.users",Crm.brandName)})),Lyte.Component.registerHelper("getSelValue",(function(e,t,a,i){var l="ALL",o=!1,s=0;if(!("Quotes"===a||"Invoices"===a||"Sales_Orders"===a||"Purchase_Orders"===a)){if(!0!==t.all_contacts_emails||i){if(t.imap_users&&t.imap_users.length>0)s+=t.imap_users.length,t.imap_users.forEach((function(e,t){e.hasOwnProperty("selected")&&(l=e.user_id+"_"+e.user_name,o=!0)}));if(t.pop_users&&t.pop_users.length>0)s+=t.pop_users.length,t.pop_users.forEach((function(e,t){e.hasOwnProperty("selected")&&(l=e.user_id+"_"+e.user_name,o=!0)}));if(t.gmail_users&&t.gmail_users.length>0)t.gmail_users.forEach((function(e,t){e.hasOwnProperty("selected")&&(l=e.user_id+"_"+e.user_name,o=!0)}))}var n=RebrandLinkUtil.getProperty("EMAILSRL_ALL_VIEW_LIMIT");!o&&s<=(void 0===n?200:n)&&t.isMailAppsFlow&&t.all_emails&&t.mailConfigured&&(l="ALL_MAIL_VIEW"),"ALL"===l&&e&&(!0!==t.all_contacts_emails||i)&&("Accounts"!==a||"Accounts"===a&&void 0!==t.contacts_details)&&("Accounts"!==t.module||"Accounts"===t.module&&t.hasOwnProperty("contacts_details"))&&(t.all_emails||void 0!==t.imap_users)&&(l="IMAP_ALL")}return l})),Lyte.Component.registerHelper("getAccountsDropDownSelValue",(function(e){if(this.getData("isEmailsForAllModuleEnabled")){var t=$("#contactSelDropdownInAcc").attr("lt-prop-selected");return t&&"ACCOUNTS_ALL"!==t?t:"ACCOUNTS_ALL"}return e.selectedContact?e.selectedContact:!0===e.all_contacts_emails?"ALL":e.contacts_details&&void 0!==e.contacts_details[0]?$ESAPI.encoder().encodeForHTMLAttribute(e.contacts_details[0].id):"ACCOUNTS_ALL"})),Lyte.Component.registerHelper("isContactRoleExist",(function(e,t){if(void 0!==t)if(e){if(t.prim_contact&&t.prim_contact.length>0)return!0}else if(t.contact_role&&t.contact_role.length>0)return!0;return!1})),Lyte.Component.registerHelper("loadAccountsDropdown",(function(e){return!!this.getData("isEmailsForAllModuleEnabled")||void 0===e.contacts_details&&!0!==e.all_contacts_emails})),Lyte.Component.registerHelper("isDealWithoutContact",(function(e){return e&&("Potentials"!==e.module||"Potentials"===e.module&&null!==e.entIdForZMail&&e.entIdForZMail!==e.entityId)})),Lyte.Component.register("crm-rl-users-list",{_template:'<template tag-name="crm-rl-users-list"> <template is="if" value="{{expHandlers(mailObj.module,\'==\',&quot;Potentials&quot;)}}"><template case="true"> <input type="hidden" name="contId" id="contId" value="{{mailObj.entIdForZMail}}"> </template></template> <input type="hidden" id="emailId" value="{{email}}"> <input type="hidden" id="fullname" value="{{fullName}}"> <input type="hidden" name="mailType" id="mailType" value="{{encodeForHTMLAttribute(mailObj.mailType)}}"> <input type="hidden" id="isMailAppsFlow" value="{{mailObj.isMailAppsFlow}}"> <span class="crm-base-font-size"><input type="hidden" value="{{rid}}" id="mailListRelId" name="mailListRelId"></span> <div class="rLETabsElement w100_per flexAlignCenter spaceBetween"> <div class="rLETabsList"> <ul class="cP nowrap"> <li class="selectTab crm-font-medium cP" id="mails" data-zcqa="mailsTab" onclick="{{action(\'showMailsList\',this)}}" role="button" tabindex="0" aria-label="{{getI18n(\'crm.label.mails\')}}" lt-prop-aria-keydown="true">{{getI18n(\'crm.label.mails\')}}</li> <template is="if" value="{{isEmailsForAllModuleEnabled}}"><template case="true"> <li id="draftMails" class="cP" data-zcqa="draftsTab" onclick="{{action(\'showMailsList\',this)}}" role="button" tabindex="0" aria-label="{{getI18n(\'crm.label.drafts\')}}" lt-prop-aria-keydown="true">{{getI18n(\'crm.label.drafts\')}}</li> <li id="scheduledMails" class="cP" data-zcqa="scheduledTab" onclick="{{action(\'showMailsList\',this)}}" role="button" tabindex="0" aria-label="{{getI18n(\'crm.label.schedulemail\')}}" lt-prop-aria-keydown="true">{{getI18n(\'crm.label.schedulemail\')}}</li> </template><template case="false"> <template is="if" value="{{expHandlers(expHandlers(mailObj.drafts,\'==\',true),\'&amp;&amp;\',expHandlers(expHandlers(mailObj.module,\'!=\',&quot;Accounts&quot;),\'||\',expHandlers(expHandlers(mailObj.module,\'==\',&quot;Accounts&quot;),\'&amp;&amp;\',expHandlers(mailObj.contacts_details,\'!=\',undefined))))}}"><template case="true"> <li id="draftMails" class="cP" data-zcqa="draftsTab" onclick="{{action(\'showMailsList\',this)}}" role="button" tabindex="0" aria-label="{{getI18n(\'crm.label.drafts\')}}" lt-prop-aria-keydown="true">{{getI18n(\'crm.label.drafts\')}}</li> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(mailObj.module,\'==\',&quot;Accounts&quot;),\'&amp;&amp;\',expHandlers(mailObj.contacts_details,\'==\',undefined)),\'!\')}}"><template case="true"> <li id="scheduledMails" class="cP" data-zcqa="scheduledTab" onclick="{{action(\'showMailsList\',this)}}" role="button" tabindex="0" aria-label="{{getI18n(\'crm.label.schedulemail\')}}" lt-prop-aria-keydown="true">{{getI18n(\'crm.label.schedulemail\')}}</li> </template></template> </template></template> </ul> </div> <div class="optionsListRLE alignRight dF {{if(isCanvasView,\'\',\'pR20\')}}"> <template is="if" value="{{expHandlers(isEmailsForAllModuleEnabled,\'&amp;&amp;\',expHandlers(mailObj.module,\'!==\',&quot;Potentials&quot;))}}"><template case="true"> <crm-email-rl-filter mailobj="{{mailObj}}" from-detail-view="{{fromDetailView}}"></crm-email-rl-filter> </template></template> <template is="if" value="{{expHandlers(mailObj.module,\'==\',&quot;Accounts&quot;)}}"><template case="true"> <div class="optionsListRLE dIB fR {{if(loadAccountsDropdown(mailObj),\'hide\',\'\')}}"> <lyte-dropdown id="contactSelDropdownInAcc" lt-prop-selected="{{getAccountsDropDownSelValue(mailObj)}}" on-option-selected="{{method(\'showMailsList\')}}" class="emails_rl_dropdown_list mL10 maxW190 {{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <template is="if" value="{{expHandlers(mailObj.all_contacts_emails,\'==\',true)}}"><template case="true"> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all.contacts.email.sent\')}}</lyte-drop-item> </template></template> <template is="if" value="{{expHandlers(mailObj.contacts_details,\'!=\',undefined)}}"><template case="true"><template is="for" items="{{mailObj.contacts_details}}" item="contact" index="index"><template is="if" value="{{ifAnyMatch(contact.email,\'!=\',&quot;&quot;,contact.secondary_email,\'!=\',&quot;&quot;)}}"><template case="true"> <lyte-drop-item data-value="{{encodeForHTMLAttribute(contact.id)}}" data-email="{{stringJoin(contact.email,contact.secondary_email)}}"><lyte-text lt-prop-value="{{contact.name}}"> </lyte-text></lyte-drop-item> </template></template> </template></template></template> <lyte-drop-item data-value="ACCOUNTS_ALL">{{getI18n(\'crm.label.all.accounts.email.sent\')}}</lyte-drop-item> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> </template></template> <template is="if" value="{{expHandlers(mailObj.module,\'==\',&quot;Accounts&quot;)}}"><template case="true"> <div class="optionsListRLE dIB fR {{if(loadAccountsDropdown(mailObj),\'hide\',\'\')}}"> <lyte-dropdown data-zcqa="accountsScheduled" class="{{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}} emails_rl_dropdown_list mL10 maxW190" name="accountsScheduled" id="accountsScheduled" on-option-selected="{{method(\'showMailsList\')}}" lt-prop-selected="{{getAccountsDropDownSelValue(mailObj)}}" style="display: none;"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <template is="if" value="{{expHandlers(mailObj.all_contacts_emails,\'==\',true)}}"><template case="true"><template is="if" value="{{mailObj.mailConfigured}}"><template case="true"> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all.contacts.email.scheduled\')}}</lyte-drop-item> </template><template case="false"> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all\')}}</lyte-drop-item> </template></template></template></template> <template is="for" items="{{mailObj.contacts_details}}" item="contact" index="index"><template is="if" value="{{ifAnyMatch(contact.email,\'!=\',&quot;&quot;,contact.secondary_email,\'!=\',&quot;&quot;)}}"><template case="true"> <lyte-drop-item id="emailContactId_{{encodeForHTMLAttribute(contact.id)}}" data-value="{{encodeForHTMLAttribute(contact.id)}}" data-email="{{stringJoin(contact.email,contact.secondary_email)}}"><lyte-text lt-prop-value="{{contact.name}}"> </lyte-text></lyte-drop-item> </template></template> </template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> <div class="optionsListRLE dIB fR {{if(loadAccountsDropdown(mailObj),\'hide\',\'\')}}"> <lyte-dropdown data-zcqa="accountsDrafts" name="accountsDrafts" class="{{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}} emails_rl_dropdown_list mL10 maxW190" id="accountsDrafts" on-option-selected="{{method(\'showMailsList\')}}" lt-prop-selected="{{getAccountsDropDownSelValue(mailObj)}}" style="display: none;"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <template is="if" value="{{expHandlers(mailObj.all_contacts_emails,\'==\',true)}}"><template case="true"><template is="if" value="{{mailObj.mailConfigured}}"><template case="true"> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all.contacts.email.drafts\')}}</lyte-drop-item> </template><template case="false"> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all\')}}</lyte-drop-item> </template></template></template></template> <template is="for" items="{{mailObj.contacts_details}}" item="contact" index="index"><template is="if" value="{{ifAnyMatch(contact.email,\'!=\',&quot;&quot;,contact.secondary_email,\'!=\',&quot;&quot;)}}"><template case="true"> <lyte-drop-item data-value="{{encodeForHTMLAttribute(contact.id)}}" data-email="{{stringJoin(contact.email,contact.secondary_email)}}"><lyte-text lt-prop-value="{{contact.name}}"> </lyte-text></lyte-drop-item> </template></template> </template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(isCRRLEnabled,\'&amp;&amp;\',isContactViewable),\'||\',expHandlers(isCRRLEnabled,\'!\'))}}"><template case="true"><template is="if" value="{{expHandlers(expHandlers(mailObj.module,\'==\',&quot;Potentials&quot;),\'&amp;&amp;\',expHandlers(isCRRLEnabled,\'&amp;&amp;\',expHandlers(crObj.prim_contact.length,\'||\',crObj.contact_role.length)))}}"><template case="true"> <div class="optionsListRLE dIB"> <lyte-dropdown data-zcqa="dealOnlyDropDown" class="dIB mL10 maxW190 emails_rl_dropdown_list {{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}}" name="dealOnlyDropDown" id="dealOnlyDropDown" on-option-selected="{{method(\'changeEmailsViewForDeals\',this)}}" lt-prop-selected="dealsOnly"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <lyte-drop-item data-value="dealsOnly">{{getModule(\'crm.relatedList.deals.ddown.deal\',\'Potentials\')}}</lyte-drop-item> <lyte-drop-item data-value="{{mailObj.entIdForZMail}}">{{if(isCRRLEnabled,getModule(\'crm.relatedList.deals.ddown.related.contact\',\'Contacts\'),getModule(\'crm.relatedList.deals.ddown.contact\',\'Contacts\'))}}</lyte-drop-item> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> <template is="if" value="{{isCRRLEnabled}}"><template case="true"> <div class="optionsListRLE dIB"> <lyte-dropdown data-zcqa="contactRolesDropDown" class="dIB mL10 maxW190 emails_rl_dropdown_list {{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}}" name="contactRolesDropDown" id="contactRolesDropDown" on-option-selected="{{method(\'changeEmailsViewForDeals\',this)}}" lt-prop-selected="{{lbind(selContact)}}" on-scroll="{{method(\'doStuff\')}}" on-show="{{method(\'doStuff\')}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <template is="if" value="{{expHandlers(expHandlers(crObj,\'!=\',undefined),\'&amp;&amp;\',expHandlers(crObj.contact_role.length,\'>\',50))}}"><template case="true"> <lyte-drop-header> <lyte-search id="contactRolesSearch" lt-prop-placeholder="Search Contacts" lt-prop-query-selector="{&quot;scope&quot;:&quot;lyte-drop-body.searchBody&quot;,&quot;search&quot;:&quot;lyte-drop-item.searchItem&quot;}"></lyte-search> </lyte-drop-header> </template></template> <lyte-drop-body class="searchBody"> <template is="if" value="{{expHandlers(selTab,\'==\',&quot;draftMails&quot;)}}"><template case="true"> <lyte-drop-item class="searchItem" data-value="{{mailObj.entityId}}_{{selTab}}" data-type="{{selTab}}"> {{getI18n(\'crm.label.all.contacts.email.drafts\')}} </lyte-drop-item> </template><template case="false"><template is="if" value="{{expHandlers(selTab,\'==\',&quot;scheduledMails&quot;)}}"><template case="true"> <lyte-drop-item class="searchItem" data-value="{{mailObj.entityId}}_{{selTab}}" data-type="{{selTab}}">{{getI18n(\'crm.label.all.contacts.email.scheduled\')}}</lyte-drop-item> </template><template case="false"><template is="if" value="{{expHandlers(selTab,\'==\',&quot;mails&quot;)}}"><template case="true"> <lyte-drop-item class="searchItem" data-value="{{mailObj.entityId}}_{{selTab}}" data-type="{{selTab}}">{{getI18n(\'crm.label.all.contacts.email.sent\')}}</lyte-drop-item> </template></template></template></template></template></template><template is="if" value="{{expHandlers(crObj,\'!=\',undefined)}}"><template case="true"><template is="if" value="{{isContactRoleExist(true,crObj,crObj.prim_contact.length)}}"><template case="true"> <lyte-drop-group label="{{getI18n(\'crm.label.deal.primary.contact\')}}" id="primContactEmailsOnlyDropDown"> <lyte-drop-item class="erlPrimContactHighLight searchItem" data-value="{{encodeForHTMLAttribute(crObj.prim_contact[0].id)}}" data-email="{{stringJoin(crObj.prim_contact[0].email,crObj.prim_contact[0].sec_email)}}">{{unescape(crObj.prim_contact[0].name)}}</lyte-drop-item> </lyte-drop-group> </template></template> <template is="if" value="{{isContactRoleExist(false,crObj,crObj.contact_role.length)}}"><template case="true"> <lyte-drop-group label="{{getI18n(\'crm.label.deal.contact.roles\')}}" id="secContactEmailsOnlyDropDown"> <template is="for" items="{{crObj.contact_role}}" item="contact" index="index"><template is="if" value="{{ifAnyMatch(contact.email,\'!=\',&quot;&quot;,contact.sec_email,\'!=\',&quot;&quot;)}}"><template case="true"> <lyte-drop-item class="erlPrimContactHighLight searchItem" data-value="{{encodeForHTMLAttribute(contact.id)}}" data-email="{{stringJoin(contact.email,contact.sec_email)}}">{{unescape(contact.name)}}</lyte-drop-item> </template></template> </template> </lyte-drop-group> </template></template></template></template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> </template></template></template></template></template></template> <input type="hidden" id="isALLOptOnly" value="{{mailObj.all_emails}}"> <div id="relatedMailList" class="optionsListRLE dIB fR"> <template is="if" value="{{expHandlers(expHandlers(ifNotInventoryModule(mailObj.module),\'&amp;&amp;\',expHandlers(isDealWithoutContact(mailObj),\'||\',expHandlers(isCRRLEnabled,\'&amp;&amp;\',expHandlers(crObj.prim_contact.length,\'||\',crObj.contact_role.length)))),\'&amp;&amp;\',isDropDownNeeded(mailObj))}}"><template case="true"> <lyte-dropdown name="selectMails" class="{{if(isRlLyteNew,\'crmSmallDropdown\',\'\')}} emails_rl_dropdown_list mL10 maxW160 vH" id="selectMails" lt-prop-selected="{{getSelValue(getUserStatus(\'IMAP_STATUS\'),mailObj)}}" on-option-selected="{{method(\'showMailsList\')}}" lt-prop-disable-item-tooltip="true"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <lyte-drop-item data-value="ALL">{{getI18n(\'crm.label.all.sent\')}}</lyte-drop-item> <template is="if" value="{{mailObj.isMailAppsFlow}}"><template case="true"> <template is="if" value="{{mailObj.all_emails}}"><template case="true"> <lyte-drop-item data-value="ALL_MAIL_VIEW">{{getI18n(\'crm.imap.all\')}}</lyte-drop-item> </template></template> <template is="if" value="{{mailObj.all_imap_shared_users}}"><template case="true"> <lyte-drop-item data-value="IMAP_ALL">{{getI18n(\'crm.imap.shared.users\')}}</lyte-drop-item> </template></template> <template is="if" value="{{mailObj.all_pop_shared_users}}"><template case="true"> <lyte-drop-item data-value="POP_ALL">{{getI18n(\'crm.pop.shared.users\')}}</lyte-drop-item> </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(mailObj.all_emails,\'||\',expHandlers(expHandlers(expHandlers(imapStatus,\'&amp;&amp;\',isCRRLEnabled),\'&amp;&amp;\',expHandlers(mailObj.module,\'==\',&quot;Potentials&quot;)),\'&amp;&amp;\',mailObj.mailConfigured))}}"><template case="true"> <lyte-drop-item data-value="IMAP_ALL">{{getI18n(\'crm.imap.all\')}}</lyte-drop-item> <template is="if" value="{{mailObj.all_imap_shared_users}}"><template case="true"> <lyte-drop-item data-value="IMAP_ALL">{{getI18n(\'crm.imap.shared.users\')}}</lyte-drop-item> </template></template> </template><template case="false"><template is="if" value="{{mailObj.all_imap_shared_users}}"><template case="true"> <lyte-drop-item data-value="IMAP_ALL">{{getI18n(\'crm.imap.shared.users\')}}</lyte-drop-item> </template></template></template></template></template></template> <template is="if" value="{{mailObj.imap_users}}"><template case="true"> <lyte-drop-group type="2" label="{{getI18n(\'crm.mailapps.imap.shared.users\')}}" id="imapUsers"> <template is="for" items="{{mailObj.imap_users}}" item="user" index="index"> <lyte-drop-item data-value="{{user.user_id}}_{{user.user_name}}"><lyte-text lt-prop-value="{{user.user_name}}"> </lyte-text></lyte-drop-item> </template> </lyte-drop-group> </template></template> <template is="if" value="{{mailObj.pop_users}}"><template case="true"> <lyte-drop-group type="1" label="{{getZohoMailUsersLabel()}}" id="zmailPublicUsers"> <template is="for" items="{{mailObj.pop_users}}" item="user" index="index"> <lyte-drop-item data-value="{{user.user_id}}_{{user.user_name}}" lt-prop-title="{{if(expHandlers(user.isOldFlow,\'&amp;&amp;\',isToolTipEnabled),getI18n(\'crm.label.old.pop.deal.error\'),\'\')}}"><lyte-text lt-prop-value="{{user.user_name}}"> </lyte-text></lyte-drop-item> </template> </lyte-drop-group> </template></template> <template is="if" value="{{mailObj.gmail_users}}"><template case="true"> <lyte-drop-group type="3" label="{{getI18n(\'crm.mailapps.gmail.shared.users\')}}" id="gmailAPIUsers"> <template is="for" items="{{mailObj.gmail_users}}" item="user" index="index"> <lyte-drop-item data-value="{{user.user_id}}_{{user.user_name}}"><lyte-text lt-prop-value="{{user.user_name}}"> </lyte-text></lyte-drop-item> </template> </lyte-drop-group> </template></template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </template></template> </div> </div> </div> <div class="rLESelectAction crm-rl-write-action" style="display:none;"> <span class="erLselectedCount crmBaseColor mR15 crm-base-font-size"><span class="crm-font-bold">{{selectedMailsCount}}</span> <span id="selectedText"></span></span> <div class="dIB crm-base-font-size crmBaseColor"> <span class="erlclearlink cP crm-base-font-size crmLinkColor" tabindex="0" aria-label="{{getI18n(\'crm.title.clear.name\')}}" role="button" lt-prop-aria-keydown="true" onclick="{{action(\'clearSelectedEmails\',this)}}" data-zcqa="clearButton">{{getI18n(\'crm.title.clear.name\')}}</span> <lyte-button id="deleteMailsButton" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-tabindex="0" lt-prop-aria-keydown="true" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getI18n(&quot;Delete&quot;)}}&quot;}" lt-prop-class="mL8" lt-prop-size="small" lt-prop-appearance="failure" onclick="{{action(\'showDeletePopup\',this)}}" data-zcqa="deleteButton"> <template is="registerYield" yield-name="text"> {{getI18n(\'Delete\')}} </template> </lyte-button> </div> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[5]},{type:"attr",position:[7]},{type:"attr",position:[9]},{type:"attr",position:[11,0]},{type:"attr",position:[13,1,1,1]},{type:"text",position:[13,1,1,1,0]},{type:"attr",position:[13,1,1,3]},{type:"if",position:[13,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"text",position:[3,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[13,3]},{type:"attr",position:[13,3,1]},{type:"if",position:[13,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[13,3,3]},{type:"if",position:[13,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"for",position:[0],dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]}]}},default:{}},{type:"text",position:[1,1,5,0]},{type:"componentDynamic",position:[1,1,5]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[13,3,5]},{type:"if",position:[13,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"for",position:[1,1,3],dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"for",position:[1,1,3],dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1]}]}},default:{}},{type:"attr",position:[13,3,7]},{type:"if",position:[13,3,7],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"text",position:[1,1,3,0]},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,2]},{type:"if",position:[1,3,2],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[13,3,9]},{type:"attr",position:[13,3,11,1]},{type:"if",position:[13,3,11,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,7]},{type:"if",position:[1,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,9]},{type:"if",position:[1,1,9],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"text",position:[15,1,0,0]},{type:"attr",position:[15,3,1]},{type:"text",position:[15,3,1,0]},{type:"attr",position:[15,3,3]},{type:"registerYield",position:[15,3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[15,3,3]}],_observedAttributes:["rid","isRecordLocked","mailObj","users","crObj","contact_details","selContact","isToolTipEnabled","isCRRLEnabled","cntMetaInfo","requestFired","imapStatus","selTab","isContactViewable","isRecordViewable","isCanvasView","isAccessibilityConfigSupported","isEmailsForAllModuleEnabled","fromDetailView","isRlLyteNew"],data:function(){return{rid:Lyte.attr("string"),isRecordLocked:Lyte.attr("boolean"),mailObj:Lyte.attr("object"),users:Lyte.attr("object"),crObj:Lyte.attr("object"),contact_details:Lyte.attr("object"),selContact:Lyte.attr("string",{default:""}),isToolTipEnabled:Lyte.attr("boolean",{default:!1}),isCRRLEnabled:Lyte.attr("boolean",{default:Crm.userDetails.CONTACT_ROLES_EMAILS_RL}),cntMetaInfo:Lyte.attr("object"),requestFired:Lyte.attr("boolean",{default:!1}),imapStatus:Lyte.attr("boolean",{default:Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS")}),selTab:Lyte.attr("string",{default:"mails"}),isContactViewable:Lyte.attr("boolean",{default:moduleRecordMapping&&moduleRecordMapping.Contacts&&moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.viewable}),isRecordViewable:Lyte.attr("boolean",{default:!0}),isCanvasView:Lyte.attr("boolean",{default:!(!Lyte.Router.getRouteInstance()||"canvas"!==Lyte.Router.getRouteInstance().routeName)}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),isEmailsForAllModuleEnabled:Lyte.attr("boolean",{default:Crm.userDetails.isEmailsForModuleEnabled}),fromDetailView:Lyte.attr("boolean"),isRlLyteNew:Lyte.attr("boolean",{default:Crm.userDetails.isRelatedListLyteEnabled})}},actions:{showMailsList:function(){showMailsListViaAPI("","-10","next",null,$(event.target).attr("id"))},clearSelectedEmails:function(e){selectAllMails(e)},showDeletePopup:function(e){showDeletePopup("mailsSub","crm.button.move.to.trash","","",e,!0)}},methods:{showMailsList:function(e,t){showMailsListViaAPI(t,"-10","next",null)},showOrHideContactRoles:function(){var e,t=$L("#dealOnlyDropDown"),a=$L("crm-rl-users-list")[0].component,i=t.attr("lt-prop-selected"),l=$L("#contactRolesDropDown"),o="Potentials";if("dealsOnly"!==i){o="Contacts";var s=a.getData("isRecordViewable"),n=a.getData("crObj");!s&&(!n||n&&n.contact_role&&0==n.contact_role.length)?(t.removeClass("maxW200"),l.hide()):(t.addClass("maxW200"),l.show())}else t.removeClass("maxW200"),l.hide();var r=Lyte.Component.registeredHelpers.isUserHasSendMailPermission(o);try{(e=$L("crm-rl-share-email")[0].component)&&e.setData("isUserHasSendMailPermission",r)}catch(e){murphy.error(e)}},changeEmailsViewForDeals:function(e){var t=$L("crm-rl-users-list")[0].component;if(t.getData("isCRRLEnabled")){t.methods.showOrHideContactRoles(),t.methods.reloadUserList(e);var a=$(".selectTab")[0].id;if(a&&"mails"===a&&$L("#relatedMailList").show(),"dealsOnly"===$L("#dealOnlyDropDown").attr("lt-prop-selected")){var i=$L("#contactRolesDropDown"),l=$L("crm-emailsrl-canvas-view"),o=l.attr("associated-cont-id")?l.attr("associated-cont-id"):$L("#cntId").val();""!==o&&"null"!==o&&i[0].ltProp("selected",o)}}EntityEmail.changeEmailsViewForDeals(e)},loadOnScroll:function(e){var t=$L("crm-rl-users-list")[0].component,a=t.getData("crObj"),i=[],l=[],o=$L("crm-emailsrl-canvas-view"),s=o.attr("associated-cont-id")?o.attr("associated-cont-id"):$L("#cntId").val();e&&e.forEach((function(e){var t;e.id===s?i.push({id:e.id,name:$ESAPI.encoder().encodeForHTMLAttribute(e.name),email:e.email,sec_email:e.secondary_email}):(a&&a.prim_contact&&a.prim_contact.length>0&&(t=a.prim_contact[0].id),t!==e.id&&l.push({id:e.id,name:$ESAPI.encoder().encodeForHTMLAttribute(e.name),email:e.email,sec_email:e.secondary_email}))})),a&&((!a.prim_contact||a.prim_contact&&0===a.prim_contact.length)&&Lyte.arrayUtils(a.prim_contact,"push",i),Lyte.arrayUtils(a.contact_role,"push",l),t.setData("requestFired",!1))},doStuff:function(){var e=$L("#contactRolesDropDown")[0].component.childComp.lastElementChild,t=$L("crm-rl-users-list")[0].component,a=t.getData("cntMetaInfo"),i=t.getData("mailObj.module"),l=t.getData("mailObj.entityId"),o=t.getData("requestFired");if(moduleRecordMapping.Contacts.visible)if(a){if(this.getData("crObj")&&e.scrollHeight<=Math.ceil(e.offsetHeight)+Math.ceil(e.scrollTop)&&!o){var s=a.page+1;t.setData("requestFired",!0),store.findAll("emails_rl_user",{page:s,per_page:30,fields:"id,Full_Name,Email,Secondary_Email"},!1,!1,{module:i,entityId:l,action:"getContactRoles"}).then((function(e){t.methods.loadOnScroll(e.emails_rl_user[0].data.contact_details),t.setData("cntMetaInfo",e.emails_rl_user[0].data.meta)}),(e=>{let t=e.responseText.replace("↵",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})}))}}else{s=1;t.setData("requestFired",!0),store.findAll("emails_rl_user",{page:s,per_page:30,fields:"id,Full_Name,Email,Secondary_Email"},!1,!1,{module:i,entityId:l,action:"getContactRoles"}).then((function(e){t.methods.loadOnScroll(e.emails_rl_user[0].data.contact_details),t.setData("cntMetaInfo",e.emails_rl_user[0].data.meta)}),(e=>{let t=e.responseText.replace("↵",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1);var i=!1,l=$L("crm-emails-related-list");if(l){var o=l[0].component.data.mailsList;o&&1===o.length&&"string"==typeof o[0]&&(i=!0)}i||_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})}))}},loadContactRoles:function(e){var t={prim_contact:[],contact_role:[]},a=$L("crm-rl-users-list")[0].component,i=[],l=[],o=e,s=$L("crm-emailsrl-canvas-view"),n=s.attr("associated-cont-id")?s.attr("associated-cont-id"):$L("#cntId").val();if(o&&o.forEach((function(e){e.id===n?i.push({id:e.id,name:$ESAPI.encoder().encodeForHTMLAttribute(e.name),email:e.email,sec_email:e.secondary_email}):l.push({id:e.id,name:$ESAPI.encoder().encodeForHTMLAttribute(e.name),email:e.email,sec_email:e.secondary_email})})),0===i.length){var r=$L("#cntId").val();if(r&&"null"!==r){var d=$L("#primEmail").val(),p=$L("#secondMail").val();i=[{name:$L("#associatedContName").val(),id:r,email:d,secondary_email:p}]}}t.prim_contact=i,t.contact_role=l,a.setData("crObj",t);var m=t.prim_contact.length?t.prim_contact[0].id:t.contact_role.length?t.contact_role[0].id:void 0;void 0!==m&&0!==m.length&&a.setData("selContact",m)},refreshContactRoles:function(e){var t=$L("crm-rl-users-list")[0].component,a=t.getData("crObj");if((a=a||{prim_contact:[],contact_role:[]})||e&&e.length>0){var i=a.prim_contact,l=a.contact_role;e&&(i=i.length>0?i:[e]);var o=Lyte.Globals.get("relatedList"),s="",n="";Crm.userDetails.isRelatedListLyteEnabled&&o?(s=o.module,n=o.entityId):(s=crmRelatedList.Module,n=crmRelatedList.EntityId),store.findAll("emails_rl_user",{page:1,per_page:30,fields:"id,Full_Name,Email,Secondary_Email"},!1,!1,{module:s,entityId:n,action:"getContactRoles"}).then((function(o){var s=!1;if(o&&o.data&&(s=o.data.some((t=>t.id===e))),e&&e.length>0){networkUtils.lyteInitiateRequest("/crm/v3/Contacts/"+e,"GET").then((function(o){if(o&&o.data&&o.data.length>0){var n=o.data[0],r={id:e,name:n.Full_Name,email:n.Email,sec_email:n.Secondary_Email},d=i.length>0&&l.some((e=>e.id===i[0].id));if(l.length>0&&l.some((t=>t.id===e))){var p=l.findIndex((t=>t.id===e));Lyte.arrayUtils(a.contact_role,"removeAt",p,1)}i&&i.length>0&&!d&&e!==i[0].id&&s&&Lyte.arrayUtils(a.contact_role,"push",i),Lyte.arrayUtils(a.prim_contact,"pop"),Lyte.arrayUtils(a.prim_contact,"push",r);var m=a.prim_contact.length?a.prim_contact[0].id:a.contact_role.length?a.contact_role[0].id:void 0;void 0!==m&&0!==m.length&&t.setData("selContact",m),$L("#cntId").val(e),$L("#primEmail").val(n.Email),$L("#secondMail").val(n.Secondary_Email),$L("#associatedContName").val(n.Full_Name),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("Emails"):reloadPersonality("emailspersonality")}}))}else{var n=i.length>0&&l.some((e=>e.id===i[0].id));i&&i.length>0&&!n&&e!==i[0].id&&s&&Lyte.arrayUtils(a.contact_role,"push",i),Lyte.arrayUtils(a.prim_contact,"pop");var r=a.prim_contact.length?a.prim_contact[0].id:a.contact_role.length?a.contact_role[0].id:void 0;void 0!==r&&0!==r.length&&t.setData("selContact",r);var d=$L("#dealOnlyDropDown")[0].component.data.ltPropSelected,p=$L("#contactRolesDropDown")[0];"dealsOnly"!==d&&t.methods.changeEmailsViewForDeals(p),$L("#cntId").val(""),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("Emails"):reloadPersonality("emailspersonality")}}))}},reloadUserList:function(){var e=$("#contactRolesDropDown").attr("lt-prop-selected"),t=$L("crm-rl-users-list")[0].component,a=t.getData("mailObj"),i=$L("#dealOnlyDropDown"),l=i.attr("lt-prop-selected"),o=t.getData("isRecordViewable");if(a&&(e||!o))if("dealsOnly"!==l&&e&&e!==a.entityId&&!e.includes(a.entityId))store.findAll("emails_rl_user",null,!1,!1,{module:"Contacts",entityId:e,action:"getUsers"}).then((function(e){var l=e.email_related_list[0];Lyte.objectUtils(a,"add","mailConfigured",l.mailConfigured),Lyte.objectUtils(a,"add","module","Potentials"),Lyte.objectUtils(a,"add","all_emails",l.all_emails),Lyte.objectUtils(a,"add","all_imap_shared_users",l.all_imap_shared_users),Lyte.objectUtils(a,"add","all_pop_shared_users",l.all_pop_shared_users),Lyte.objectUtils(a,"add","imap_users",l.imap_users),Lyte.objectUtils(a,"add","pop_users",l.pop_users),Lyte.objectUtils(a,"add","gmail_users",l.gmail_users),Lyte.objectUtils(a,"add","isMailAppsFlow",l.isMailAppsFlow),Lyte.objectUtils(a,"add","entIdForZMail",l.entIdForZMail),i&&i.length>0&&l.entIdForZMail&&i[0].ltProp("selected",l.entIdForZMail);var o=$L("#selectMails");if(l.isMailAppsFlow&&o&&o.length>0)o[0].ltProp("selected",""),l.all_emails?o[0].ltProp("selected","ALL_MAIL_VIEW"):l.all_imap_shared_users?o[0].ltProp("selected","IMAP_ALL"):l.all_pop_shared_users?o[0].ltProp("selected","POP_ALL"):o[0].ltProp("selected","ALL");else if(t.getData("imapStatus"))Lyte.objectUtils(a,"add","all_emails",!0),(l.all_emails||l.all_imap_shared_users)&&o[0].ltProp("selected","IMAP_ALL");else{Lyte.objectUtils(a,"delete","all_emails");var s=l.pop_users,n=l.gmail_users;if(s&&s.length)(r=s.findIndex((e=>e.user_id===Crm.userDetails.USER_ID)))>0?o[0].ltProp("selected",s[r].user_id+"_"+s[r].user_name):o[0].ltProp("selected",s[0].user_id+"_"+s[0].user_name);else if(n&&n.length){var r;(r=n.findIndex((e=>e.user_id===Crm.userDetails.USER_ID)))>0?o[0].ltProp("selected",n[r].user_id+"_"+n[r].user_name):o[0].ltProp("selected",n[0].user_id+"_"+n[0].user_name)}}var d=$("#relatedMailList"),p=$(".selectTab")[0].id;p&&"mails"!==p?d.hide():d.show()}),(e=>{let t=e.responseText.replace("↵",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1);var i=!1,l=$L("crm-emails-related-list");if(l){var o=l[0].component.data.mailsList;o&&1===o.length&&"string"==typeof o[0]&&(i=!0)}i||_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})}));else{Lyte.objectUtils(a,"add","all_imap_shared_users",!1),Lyte.objectUtils(a,"add","all_pop_shared_users",!1),Lyte.objectUtils(a,"add","imap_users",null),Lyte.objectUtils(a,"add","pop_users",null),Lyte.objectUtils(a,"add","gmail_users",null),Lyte.objectUtils(a,"add","all_emails",!0);var s=$L("#selectMails");s&&s.length>0&&(a.isMailAppsFlow?$L("#selectMails")[0].ltProp("selected","ALL_MAIL_VIEW"):$L("#selectMails")[0].ltProp("selected","IMAP_ALL"))}}}}),Lyte.Component.register("crm-emailsrl-canvas-view",{_template:'<template tag-name="crm-emailsrl-canvas-view"> <div class="alignRight"> <template is="if" value="{{fromDetailView}}"><template case="true"> <div class="rl_Header spaceBetween" data-zcqa="Related_list_Div_{{rlLabel}}" ddname="{{rlPersName}}" ddid="{{listRelationId}}"> <div class="relListHeader maxW450"><span name="{{toLowerCase(rlPersName)}}_{{listRelationId}}" id="{{toLowerCase(rlPersName)}}_{{listRelationId}}" class="relListHead ellipticText dIB" data-zcqa="Related_List_Name_{{rlLabel}}">{{rlLabel}}</span></div> <crm-rl-share-email users="{{mailAttrs}}" from-detail-view="{{fromDetailView}}"></crm-rl-share-email> </div> </template><template case="false"> <crm-rl-share-email users="{{mailAttrs}}"></crm-rl-share-email> </template></template> </div> <crm-rl-users-list users="{{users}}" from-detail-view="{{fromDetailView}}"></crm-rl-users-list> <crm-emails-related-list emails="{{emails}}" list-relation-id="{{listRelationId}}"></crm-emails-related-list> <input type="hidden" id="primEmail"> <input type="hidden" id="secondaryEmail"> <lyte-event-listener event-name="relatedList" on-fire="{{action(\'handleEmailRefresh\')}}"> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0]},{type:"text",position:[1,1,0,0]},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]},{type:"attr",position:[11]},{type:"componentDynamic",position:[11]}],_observedAttributes:["entityId","entityName","module","moduleApiName","email","primaryEmail","listRelationId","users","emails","associatedContId","mailAttrs","fromDetailView","rlPersName","rlLabel"],data:function(){return{entityId:Lyte.attr("string"),entityName:Lyte.attr("string"),module:Lyte.attr("string"),moduleApiName:Lyte.attr("string"),email:Lyte.attr("string"),primaryEmail:Lyte.attr("string"),listRelationId:Lyte.attr("string"),users:Lyte.attr("object"),emails:Lyte.attr("object"),associatedContId:Lyte.attr("string"),mailAttrs:Lyte.attr("object"),fromDetailView:Lyte.attr("boolean",{default:!1}),rlPersName:Lyte.attr("string"),rlLabel:Lyte.attr("string")}},init:function(){var e=networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient);Lyte.injectResources(e,void 0,void 0)},didConnect:function(){if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var e=store.peekRecord(moduleRecordMapping[this.data.module].id,this.data.entityId),t="";null!=e.Contact_Name&&(t=e.Contact_Name.id);var a=e.Email,i=a;null==a&&(a=e.Secondary_Email),this.setData("entityName",e.Full_Name),this.setData("email",a),this.setData("associatedContId",t),this.setData("primaryEmail",i)}this.methods.renderEmailsRL(this)},actions:{handleEmailRefresh:function(e){var t=!Crm.userDetails.isRelatedListLyteEnabled||"EMAILSPERSONALITY"===e.pname;if(e.id==this.getData("listRelationId")||t){var a=this.getData("entityId");null!=store.peekRecord("emails_rl_user","shared_users_"+a)&&store.deleteRecord("emails_rl_user","emails_"+a),$("#mails").hasClass("selectTab")?showMailsListViaAPI("","-10","next",null,"mails"):$("#scheduledMails").hasClass("selectTab")?showMailsListViaAPI("","-10","next",null,"scheduledMails"):showMailsListViaAPI("","-10","next",null,"draftMails")}}},methods:{setDataForChildComponents:function(e,t,a,i,l){let o=$("crm-emailsrl-canvas-view")[0].component.methods.postprocessSetDataForChildComponents;t&&"Potentials"!=t&&Lyte.Component.registeredHelpers.ifNotInventoryModule(t)&&"Accounts"!=t&&"Deals"!=t&&(document.getElementById("zmailRS").style.display=""),o(e,t,a,i,l),e.isCanvasView=!0},postprocessSetDataForChildComponents:function(e,t,a,i,l){document.querySelector("crm-emails-related-list").component.setData(e);var o=document.getElementById("selectMails");null!=o&&(o.style.visibility="visible","Accounts"==t&&"ALL"==$("#contactSelDropdownInAcc").attr("lt-prop-selected")&&$("#relatedMailList").hide());var s=$("#primEmail");null!=i&&"undefined"!=i||null==l||"Potentials"!=t&&"Deals"!=t?s.val(i):Lyte.registeredMixins["crm-detailcanvas-utils"].fetchRelatedModuleRecords("Contacts",l).then((function(e){var t="",a="";null==e.length?(t=e.Email,a=e.Secondary_Email):(t=e[0].Email,a=e[0].Secondary_Email),s.val(t),$("#secondaryEmail").val(a)}))},getMailsListOnLoad:function(e,t,a,i,l,o,s,n,r){store.pushPayload("emails_rl_user",{content:"shared_users_"+a,data:e});var d,p={};p.index=0;var m=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,t),c=t,u=a;"IMAP_ALL"===m&&"Accounts"!=t&&e.mailObj.all_emails&&(m="IMAP_CRMMAILS");var y=0,_="";"Accounts"===t&&e.mailObj&&e.mailObj.contacts_details&&1===e.mailObj.contacts_details.length&&!Crm.userDetails.isEmailsForModuleEnabled&&(c="Contacts",u=e.mailObj.contacts_details[0].id),"Accounts"===t&&Crm.userDetails.isEmailsForModuleEnabled?(y=6,_="sent_from_crm",m="sent_from_crm"):"Accounts"===t&&!Crm.userDetails.isEmailsForModuleEnabled&&e&&e.mailObj&&e.mailObj.all_contacts_emails?(y=4,_="all_contacts_sent_crm_emails",m="all_contacts_sent_crm_emails"):"Potentials"!=t&&"Deals"!=t||""!=n&&null!=n?"ALL"==m?(y=6,_="sent_from_crm"):"IMAP_ALL"==m||"IMAP_ALLUSERSMAILS"==m?(y=3,_=""):"IMAP_CRMMAILS"===m||"ALL_MAIL_VIEW"===m?y=5:(y=2,_="user_emails",d=Crm.userDetails.USER_ID):(m="ALL",_="sent_from_crm",y=1),""!=_&&(p.type=_);var L=document.querySelector("crm-rl-users-list");window.isCanvasSandboxDiff&&(L=document.querySelector("#sandboxObj_sandboxChanges crm-rl-users-list")),L.component.setData(e),L.component.methods.showOrHideContactRoles();var f=$L("crm-email-rl-filter");if(f.length>0){var b=f.get(0).component;b.methods.didConnectReRender.call(b)}if(("Potentials"===t||"Deals"===t)&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.viewable&&(store.findAll("emails_rl_user",{per_page:30,fields:"id,Full_Name,Email,Secondary_Email"},!1,!1,{module:t,entityId:a,action:"getContactRoles"}).then((function(e){var t=$L("crm-rl-users-list")[0].component;if(e&&e.emails_rl_user&&e.emails_rl_user.length&&e.emails_rl_user[0].data){var a=void 0!==e.emails_rl_user[0].data.contact_details?e.emails_rl_user[0].data.contact_details:t.data.contact_details;t.data.cntMetaInfo=void 0!==e.emails_rl_user[0].data.meta?e.emails_rl_user[0].data.meta:t.data.cntMetaInfo,t.methods.loadContactRoles(a)}t.methods.reloadUserList(),t.methods.showOrHideContactRoles()}),(e=>{let t=e.responseText.replace("↵",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})})),l=!0),o.getData("fromDetailView")){let e=Object.keys(moduleApiMapping).find((e=>moduleApiMapping[e]===t));if(Crm.renderDVLyteFlow(e)){var g=$L("crm-detailview-content")[0];v=g?g.getData("recordLockingDetails"):void 0}else v=detailView.recordLockingDetails.lockedRecordDetails?detailView.recordLockingDetails.lockingConfigJSON[0]:void 0}else var h=$L("crm-detailview-canvas")[0],v=h?h.getData("recordLockingDetails"):void 0;var D=Lyte.Component.registeredHelpers.isUserHasSendMailPermission(t);e.isSendMailRestricted=v&&v.restricted_communications&&v.restricted_communications.contains("send_mail"),e.isUserHasSendMailPermission=D,document.querySelector("crm-rl-share-email").component.setData(e);var I=$("#sendEntityMailLink");"Potentials"!==t&&"Deals"!==t||!e.mailObj.mailConfigured||disablePOPUsers(e.mailObj),"Accounts"===t&&(Crm.userDetails.isEmailsForModuleEnabled?$("#relatedMailList").hide():e.mailObj&&e.mailObj.all_contacts_emails&&($("#relatedMailList").hide(),I.hide())),store.findAll("emails_rl_user",p,!1,!1,{module:c,entityId:u,action:"getEmails"}).then((function(e){2==y&&(m=parseInt(document.querySelectorAll('lyte-drop-item[data-value="'+m+'"]')[0].parentElement.getAttribute("type")));var p=null!=e&&null!=e[0]?e[0].data:e;"undefined"==i&&null!=p&&"Quotes"!=t&&"Sales_Orders"!=t&&"Purchase_Orders"!=t&&"Invoices"!=t&&"Potentials"!=t&&"Deals"!=t&&"Accounts"!=t&&p.moduleEntityId!=a&&(p=void 0);var c=handleMailsList(p,m,a,t,0,s,l,y,"next",d);"Quotes"==t?Lyte.registeredMixins["crm-detailcanvas-utils"].fetchRelatedModuleRecords("Contacts",n).then((function(e){e&&e.length&&(c.associatedContEmail=e[0].Email),store.pushPayload("emails_rl_user",{content:"emails_"+$("#id").val(),data:c}),o.methods.setDataForChildComponents(c,t,null,r,n)})):(store.pushPayload("emails_rl_user",{content:"emails_"+$("#id").val(),data:c}),o.methods.setDataForChildComponents(c,t,i,r,n))}))},renderEmailsRL:function(e){if(e.getData("entityId")&&"undefined"!==e.getData("entityId")){var t=e.getData("entityId"),a=e.getData("entityName"),i=e.getData("email"),l=e.getData("module"),o=e.getData("moduleApiName"),s=e.getData("listRelationId"),n=e.getData("associatedContId"),r=e.getData("primaryEmail"),d=e,p=!1,m={};m.rid=s,m.mailObj={},m.email=i,m.fullName=a;var c=!1;"Potentials"!==l&&"Deals"!==l||(c=!0);var u=store.peekRecord("emails_rl_user","emails_"+t),y=store.peekRecord("emails_rl_user","shared_users_"+t);(void 0===u||void 0===y||"detail"===Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.isRelatedListLyteEnabled)&&(p=!0);var _=e.findZiaEmailConfigDetails();Crm.userDetails.EMAIL_THREAD_VIEW&&(_=Lyte.resolvePromises([_,store.findAll("email_column_widths")])),_.then((function(e){e&&e.zia_config&&Lyte.registeredMixins["crm-email-emotions-mixin"].setEmailsAIVariables(e);if($("#RL_dataCount_"+s).css({cursor:"auto",padding:"2px 5px",color:"#14161D",display:"inline-block","text-align":"center","font-size":"1.2rem","margin-left":"8px",background:"var(--bg_DBE6FF)","border-radius":"7px","min-width":"12px","line-height":"normal",height:"auto"}),p)store.findAll("emails_rl_user",{},!1,!1,{module:o,entityId:t,action:"getUsers"}).then((function(e){e&&(e.email_related_list?m.mailObj=e.email_related_list[0]:e[0]&&(m.mailObj=e[0].data.email_related_list[0]),"Potentials"!==l&&"Deals"!==l||!Crm.userDetails.CONTACT_ROLES_RELATED_LIST||(m.mailObj.contacts_details=e.email_related_list[0].contacts_details),m.mailObj.module=l,m.mailObj.entityId=t,m.mailObj.loginUserId=Crm.userDetails.USER_ID,m.mailObj.singularMod=moduleRecordMapping[l].singular_label,Crm.userDetails.mailConfigured=m.mailObj.mailConfigured,"Accounts"==o&&m.mailObj.contacts_details&&1==m.mailObj.contacts_details.length?store.findAll("emails_rl_user",{},!1,!1,{module:"Contacts",entityId:m.mailObj.contacts_details[0].id,action:"getUsers"}).then((function(e){(e=e||{}).rid=s,e.email_related_list?e.mailObj=e.email_related_list[0]:e.length&&(e.mailObj=e[0].data.email_related_list[0]),e&&e.mailObj&&(e.mailObj.contacts_details=m.mailObj.contacts_details,e.mailObj.module=l,e.mailObj.entityId=t,e.mailObj.loginUserId=Crm.userDetails.USER_ID,e.mailObj.singularMod=moduleRecordMapping[l].singular_label,e.mailObj.entIdForZMail=m.mailObj.entIdForZMail),d.methods.getMailsListOnLoad(e,o,t,i,c,d,a,n,r)})):d.methods.getMailsListOnLoad(m,o,t,i,c,d,a,n,r))}),(function(){m.rid=s,m.mailObj={},m.mailObj.module=l,m.mailObj.entityId=t,m.mailObj.loginUserId=Crm.userDetails.USER_ID,m.mailObj.singularMod=moduleRecordMapping[l].singular_label,m.email=i,m.fullName=a,("Accounts"===l||"Potentials"===l)&&m.mailObj.contacts_details&&crmTab.tabList.contains("Contacts")&&(m.mailObj.contactObject=m.mailObj.contacts_details),store.pushPayload("emails_rl_user",{id:t,users:m}),document.querySelector("crm-rl-users-list").component.setData(m);var e=$("#sendEntityMailLink");"Accounts"===o&&(Crm.userDetails.isEmailsForModuleEnabled?$("#relatedMailList").hide():m.mailObj&&m.mailObj.all_contacts_emails&&($("#relatedMailList").hide(),e.hide()))}));else{y=y.data,document.querySelector("crm-rl-users-list").component.setData(y);var _=$L("crm-email-rl-filter");if(_.length>0){var L=_.get(0).component;L.methods.didConnectReRender.call(L)}if("Potentials"!=o&&"Deals"!=o||disablePOPUsers(y.mailObj),d.getData("fromDetailView"))if(Crm.renderDVLyteFlow(l)){var f=$L("crm-detailview-content")[0];g=f?f.getData("recordLockingDetails"):void 0}else g=detailView.recordLockingDetails.lockedRecordDetails?detailView.recordLockingDetails.lockingConfigJSON[0]:void 0;else var b=$L("crm-detailview-canvas")[0],g=b?b.getData("recordLockingDetails"):void 0;var h=Lyte.Component.registeredHelpers.isUserHasSendMailPermission(o);y.isSendMailRestricted=g&&g.restricted_communications&&g.restricted_communications.contains("send_mail"),y.isUserHasSendMailPermission=h,document.querySelector("crm-rl-share-email").component.setData(y);var v=$("#sendEntityMailLink");"Accounts"===o&&(Crm.userDetails.isEmailsForModuleEnabled?$("#relatedMailList").hide():m.mailObj&&m.mailObj.all_contacts_emails&&($("#relatedMailList").hide(),v.hide()));var D=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),y.mailObj);"IMAP_ALL"===D&&"Accounts"!=l&&y.mailObj.all_emails&&(D="IMAP_CRMMAILS");var I=0;"Accounts"===o&&Crm.userDetails.isEmailsForModuleEnabled?(I=6,D="sent_from_crm"):"Accounts"===o&&!Crm.userDetails.isEmailsForModuleEnabled&&y&&y.mailObj&&y.mailObj.all_contacts_emails?(I=4,D="all_contacts_sent_crm_emails"):"Potentials"!=o&&"Deals"!=o||!Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS")||""!=n&&null!=n?I="ALL"==D?1:"IMAP_ALLUSERSMAILS"==D?3:"IMAP_ALL"===D||"IMAP_CRMMAILS"===D||"ALL_MAIL_VIEW"===D?5:2:(D="ALL",I=1),2==I&&(D=parseInt(document.querySelectorAll('lyte-drop-item[data-value="'+D+'"]')[0].parentElement.getAttribute("type"))),("Potentials"===o||"Deals"===o)&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.viewable&&(store.findAll("emails_rl_user",{per_page:30,fields:"id,Full_Name,Email,Secondary_Email"},!1,!1,{module:o,entityId:t,action:"getContactRoles"}).then((function(e){var t=$L("crm-rl-users-list")[0].component,a=void 0!==e.emails_rl_user[0].data.contact_details?e.emails_rl_user[0].data.contact_details:t.data.contact_details;t.data.cntMetaInfo=void 0!==e.emails_rl_user[0].data.meta?e.emails_rl_user[0].data.meta:t.data.cntMetaInfo,t.methods.loadContactRoles(a),t.methods.reloadUserList(),t.methods.showOrHideContactRoles()}),(e=>{let t=e.responseText.replace("↵",""),a=JSON.parse(t);commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:a.message,ltPropDuration:"3000",ltPropShow:!0}})})),c=!0);var M=handleMailsList(u.data,D,t,l,0,a,c,I,"next");d.methods.setDataForChildComponents(M,l,i,r,n)}}))}}}},{mixins:["crm-email-emotions-mixin"]});
