store.registerModel("scoring_rule",{id:Lyte.attr("string",{primaryKey:!0}),name:Lyte.attr("string",{default:""}),description:Lyte.attr("string",{default:""}),module:Lyte.attr("object"),layout:Lyte.attr("object"),active:Lyte.attr("boolean",{default:!0}),field_rules:Lyte.hasMany("scoring_field_rule",{serialize:"partial"}),signal_rules:Lyte.hasMany("scoring_signal_rule",{serialize:"partial"}),custom_fields:Lyte.hasMany("scoring_custom_field",{serialize:"partial"})},{actions:{clone:{},activate:{}}}),store.registerAdapter("scoring_rule",{namespace:"crm/v2.2/settings/automation",headersForRequest:function(e,r,t){var i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return t&&t.headers&&t.headers["X-CRM-ORG"]&&(i["X-CRM-ORG"]=t.headers["X-CRM-ORG"]),i},buildURL:function(e,r,t,i,s,l,n){if(n&&n.hostUrl&&n.hostUrl.url)if((s=n.hostUrl.url).match("sandbox/diff")){a=s.split("diff/").pop().split("v2.2/")[0];s=s.replace(a,"")}else{var a=s.split("crm/").pop().split("v2.2/")[0];s=s.replace(a,"")}else s=this.$super.buildURL(e,r,t,i,s,l,n);return s},methodForRequest:function(e,r,t,i,s){if("action"===r)switch(s){case"activate":return!0===i.status?"PUT":"DELETE";case"run_scoring_rules":return"PUT"}return"PATCH"===e?"PUT":e},processRequest:function(){commonUtils.showHideLoadingDiv(!0)}}),store.registerSerializer("scoring_rule",{normalize:function(e,r,t){if("findAll"===r&&t){t.totalFields=0,null!==t.field_rules&&(t.totalFields+=t.field_rules.length),null!==t.signal_rules&&(t.totalFields+=t.signal_rules.length);var i=t.modified_time?t.modified_time:t.created_time,s=t.modified_by?t.modified_by:t.created_by;t.modifiedTime=Utils.getDateTimeInUserFormat(Utils.ISO8601toDateObject(i),!0),t.modified_date_display_value=Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(i)),t.modified_time_display_value=Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(i),!0),t.modified_user_image=commonUtils.getPhotoURL(s.zuid),t.current_user=s,t.isSelected=!1,t.module=t.module.api_name}return r.indexOf("find")>=0&&t&&(t.signal_rules||(t.signal_rules=[]),t.field_rules||(t.field_rules=[]),t.custom_fields||(t.custom_fields=[]),t.description||(t.description="")),t},payloadKey:function(){return"scoring_rules"},normalizeResponse:function(e,r,t,i,s,l,n,a){if("createRecord"!==r&&"updateRecord"!==r||(t.scoring_rules=t.scoring_rules.map((function(e){return Object.assign(e,e.details),e}))[0],this.setDeletedId(t.scoring_rules,"field_rules",a),this.setDeletedId(t.scoring_rules,"signal_rules",a),this.setDeletedId(t.scoring_rules,"custom_fields",a)),"findRecord"===r&&t.scoring_rules&&(t.scoring_rules=t.scoring_rules[0]),"updateRecord"===r){var o=store.peekRecord(e,i),u=t.scoring_rules;o.field_rules&&u.field_rules&&0===o.field_rules.length&&u.field_rules.length&&delete u.field_rules,o.signal_rules&&u.signal_rules&&0===o.signal_rules.length&&u.signal_rules.length&&delete u.signal_rules}return this.$super.normalizeResponse.apply(this.$super,arguments)},serialize:function(e,r,t,i){if("createRecord"===e||"updateRecord"===e){var s={};return r.scoring_rule.signal_rules&&r.scoring_rule.signal_rules.forEach((function(e,r){"removed"===e.$.partialType&&(e._delete=null,i.signal_rules||(i.signal_rules={}),i.signal_rules[r]=e.id)})),r.scoring_rule.field_rules&&r.scoring_rule.field_rules.forEach((function(e,r){"removed"===e.$.partialType&&(e._delete=null,i.field_rules||(i.field_rules={}),i.field_rules[r]=e.id)})),r.scoring_rule.custom_fields&&r.scoring_rule.custom_fields.forEach((function(e,r){if("removed"===e.$.partialType&&(e._delete=null,i.custom_fields||(i.custom_fields={}),i.custom_fields[r]=e.id),"added"===e.$.partialType){var t={id:e.reference_field.id,api_name:e.reference_field.api_name};e.reference_field=t}})),s.scoring_rules=[r.scoring_rule],i.newRequestBody=s,s}},setDeletedId:function(e,r,t){t&&t[r]&&(e[r]||(e[r]=[]),Object.keys(t[r]).forEach((function(i){var s=t[r][i];e[r].splice(i,0,{id:s})})))}}).extends("application"),store.registerModel("scoring_field_rule",{id:Lyte.attr("string"),score:Lyte.attr("number"),criteria:Lyte.attr("object")}),store.registerAdapter("scoring_field_rule",{}),store.registerSerializer("scoring_field_rule",{payloadKey:function(){return"field_rules"}}),store.registerModel("scoring_signal_rule",{id:Lyte.attr("string"),score:Lyte.attr("number"),signal:Lyte.attr("object")}),store.registerAdapter("scoring_signal_rule",{}),store.registerSerializer("scoring_signal_rule",{payloadKey:function(){return"signal_rules"}}),store.registerModel("scoring_custom_field",{id:Lyte.attr("string"),field_label:Lyte.attr("string"),reference_field:Lyte.attr("object")}),store.registerSerializer("scoring_custom_field",{payloadKey:function(){return"custom_fields"}}),Lyte.Component.registerHelper("constructPointTxt",(function(e){var r=e>0?I18n.getMsg("crm.label.scoring.rules.initcap.add")+" ":I18n.getMsg("crm.label.scoring.rules.initcap.subtract")+" ";return r+=Math.abs(e)+" ",r+=Math.abs(e)>=2?I18n.getMsg("crm.label.scoring.rules.pts"):I18n.getMsg("crm.label.scoring.rules.point")})),Lyte.Component.registerHelper("isScoreAvailableForSignla",(function(e){return 3!==e.type&&e.signals.some((function(e){return e.feature_availability.scoring}))})),Lyte.Component.registerHelper("canShowHelpVideo",(function(){return!(Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser())})),Lyte.Component.registerHelper("getTranslatedLayoutName",(function(e){return"Standard"===e?I18n.getMsg(e):e})),Lyte.Component.registerHelper("getDescLength",(function(e){return e.trim().length}));
