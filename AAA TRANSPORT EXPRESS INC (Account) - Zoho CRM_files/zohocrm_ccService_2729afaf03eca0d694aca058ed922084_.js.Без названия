var ccCrmActions={ruleDetails:{processId:void 0,processName:void 0,ruleId:void 0,ruleName:void 0},addOrUpdateAssociateActions:function(e,t,r,i){i&&delete e.id;var o={module:r,type:t,details:e};this.addOrUpdateAction(o)},addOrUpdateAction:function(e){this.postMessageToParentWindow("SaveCRMActions",e)},addOrUpdateJSPFlowActions:function(e){var t=$L("crm-cc-actions")[0].component;this.addOrUpdateAction({module:t.data.module,type:t.data.action_type.replace("crm_",""),details:{id:e,type:t.data.action_type.replace("crm_","")}})},cancelAction:function(){this.postMessageToParentWindow("CancelCRMActions")},hideCCLogoLoader:function(){this.postMessageToParentWindow("HideLoader")},postMessageToParentWindow:function(e,t){var r={action:e,cbIdentifier:0,response:{message:e,data:t}},i=new URL(document.location.href).searchParams.get("frameorigin"),o=document.createElement("a");o.href=i,i=o.origin,parent.postMessage(r,i)}},mergeField={mergeOffset:{start:void 0,end:void 0},selection:void 0,range:void 0,elemToBind:void 0,mergeFieldJSON:void 0,onFocus:!1,filterCallBack:void 0,clearMergeFieldObj:function(){mergeField.elemToBind=void 0,mergeField.filterCallBack=void 0,mergeField.elemId=void 0},showMergeValuesDIV:function(e){var t=$("#mergeValuesDIV"),r=t.find("#moduleOptions"),i=r[0].options[0],o=$(i).attr("value");if($("#mergeValuesDIV_copy").length<1){var l=document.createDocumentFragment();$(l).append(t.clone(!0,!0)),$(l.querySelector("#mergeValuesDIV")).attr("id","mergeValuesDIV_copy"),t.parent().append(l)}else{l=document.createDocumentFragment();$(l).append($("#mergeValuesDIV_copy").children().clone(!0,!0)),t.children().remove(),t.append(l)}r.val(o).css({width:"100%"}),$("#searchMergeValues").css({display:"none"}),t.find(".modulesFields").css("display","none");var n=$("[id='"+o+"_ModuleFields']");n.css("display",""),n.find("li").css("display",""),setTimeout((function(){$("#listMergeValues").css("display",""),t.css({display:"block"}),thirdPartyUtils.bindSelect2("#moduleOptions",{minimumResultsForSearch:1/0}),setTimeout((function(){var e=$("#moduleOptions");e.on("select2:opening",(function(){$("#moduleOptionsList").next(".oA").addClass("preventClick")})),e.on("select2:close",(function(){$("#moduleOptionsList").next(".oA").removeClass("preventClick")}))}),100),$L(t).find(".oA").scrollTop(0),mergeField.mergeValueListSelection(),mergeField.setMergeFieldDivPos(e)}),10)},hideMergeValuesDIV:function(){var e=$("#mergeValuesDIV");if(e.length>0){e.css("display","none"),$("#mergeValuesDIV .select2-container").css("display","none");var t=e.parents(".add_transition");t.length>0&&t.perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1})}var r=$("#moduleOptions");r&&r.hasClass("select2-hidden-accessible")&&r.select2("close"),e.find(".selec").removeClass("selec")},changeMergevalues:function(e){$("#mergeValuesDIV").find(".modulesFields").css("display","none");var t=$(e).val(),r=$("[id='"+t+"_ModuleFields']");r.css("display",""),r.find("li").css("display",""),mergeField.mergeValueListSelection(),setTimeout((function(){mergeField.focusElem()}),1),$("#moduleOptionsList").next().perfectScrollbar("update")},setMergeValue:function(e){mergeField.focusElem();var t=mergeField.getSelectedFieldInfo(e),r=mergeField.elemToBind;if(mergeField.isInputElem(r)||mergeField.isRichTextElem(r)){if(r.length>0){var i=mergeField.getValueToInsertOnSelection(t);void 0===mergeField.searchValue||mergeField.searchValue.length;mergeField.searchValue=void 0;var o=r[0];if(r.data("datatype")&&"text"!=r.data("datatype")&&"textarea"!=r.data("datatype"))o.value=i,mergeField.setCursorPosition(o,mergeField.mergeOffset.start+i.length);else if(mergeField.isRichTextElem(r)){var l=r[0].querySelector("lyte-texteditor");l.clear(),l.insertHTML(i),r[0].component.executeMethod("validateMaxLengthAndSetVal",l)}else{var n=o.value;o.value=n.substring(0,mergeField.mergeOffset.start)+i+n.substring(mergeField.mergeOffset.end),mergeField.setCursorPosition(o,mergeField.mergeOffset.start+i.length)}}}else{var a=mergeField.getSpanElemToInsertOnSelection(t),d=mergeField.selection,s=mergeField.range,m=s.commonAncestorContainer;3!==m.nodeType&&(m=s.startContainer.childNodes[s.endOffset-1]),s.setStart(m,mergeField.mergeOffset.start),s.deleteContents(),s.insertNode(a),s.selectNode(a),s.setStartAfter(a),s.setEndAfter(a),d.removeAllRanges(),d.addRange(s),mergeField.saveSelection(),setTimeout((function(){mergeField.focusElem()}),300)}this.hideMergeValuesDIV(),mergeField.mergeFieldInsertCallback(r,t.field.data_type)},setCursorPosition:function(e,t){if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}else e.setSelectionRange&&(e.setSelectionRange(t,t),e.focus())},setEndOfContenteditable:function(e){var t,r;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(r=window.getSelection()).removeAllRanges(),r.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select()),$(e).focus()},getCaretCharacterOffsetWithin:function(e){var t=window.getSelection().getRangeAt(0),r=t.cloneRange();return r.selectNodeContents(e),r.setEnd(t.endContainer,t.endOffset),r.toString().length},doGetCaretPosition:function(e){var t=0;if(document.selection){e.focus();var r=document.selection.createRange();r.moveStart("character",-e.value.length),t=r.text.length}else(e.selectionStart||"0"===e.selectionStart)&&(t=e.selectionStart);return t},setMergeEntities:function(){var e=mergeField.elemToBind[0];if(mergeField.isInputElem(e)){var t=mergeField.doGetCaretPosition(e);mergeField.mergeOffset.start=t-1,mergeField.mergeOffset.end=t}else if(mergeField.isRichTextElem(e)){t=e.querySelector("lyte-texteditor").getCursor();mergeField.mergeOffset.start=t-1,mergeField.mergeOffset.end=t}else mergeField.mergeOffset.start=window.getSelection().getRangeAt(0).startOffset-1;mergeField.saveSelection()},saveSelection:function(){mergeField.selection=document.getSelection(),mergeField.range=mergeField.getRange(mergeField.selection)},focusElem:function(){if(mergeField.elemToBind.length>0&&!mergeField.onFocus){if(mergeField.elemToBind.focus(),void 0===mergeField.selection)return;var e=mergeField.selection;try{e.removeAllRanges()}catch(e){murphy.error(e)}e.addRange(mergeField.range)}},getRange:function(e){var t;try{t=e.getRangeAt?e.rangeCount>0&&e.getRangeAt(0)?e.getRangeAt(0):document.createRange():e.createRange()}catch(r){t=e.createRange()}return t},searchMergeValue:function(e,t){if(e){if($("#mergeValuesDIV").is(":visible")){mergeField.saveSelection(),mergeField.searchValue=t;for(var r=$("#mergeValuesDIV"),i=r.find(".modulesFields"),o="",l=i.length,n=0;n<l;n++)for(var a=i.eq(n),d=a.attr("modName"),s=a.find(".mergeOptions"),m=0,f=s.length,g=0;g<f;g++){var c=s.eq(g),u=c.text().trim().toLowerCase().indexOf(t.replace("Â "," ").toLowerCase());if(-1!=u){var p=c.text().trim(),v=p.substring(0,u),F=u+t.length,M=p.substring(u,F),h=p.substring(F,p.length);c.empty(),c[0].innerHTML=$ESAPI.encoder().encodeForHTML(v)+"<span id='mergeHigh' class='setupHighL'>"+$ESAPI.encoder().encodeForHTML(M)+"</span>"+$ESAPI.encoder().encodeForHTML(h),0==m&&"Appointments"!==d&&(o+="<li class='mergeSections crm-small-font-size crmNotFoundColor ttUppercase mT15 pR20'>"+$ESAPI.encoder().encodeForHTML(d)+"</li>"),o+=c[0].outerHTML,m++}}r.find("#searchMergeValues").html(o).css("display",""),r.find("#listMergeValues").css("display","none"),$("#listMergeValues").css("display","none"),""==o?r.css("display","none"):(r.css("display","block"),mergeField.elemToBind&&mergeField.setMergeFieldDivPos(mergeField.elemToBind)),mergeField.mergeValueListSelection(),$L("#searchMergeValues").scrollTop(0)}}else this.hideMergeValuesDIV()},keyPressBind:function(e){var t,r,i,o,l,n,a,d=e.keyCode?e.keyCode:e.charCode?e.charCode:e.which,s=$L("#searchMergeValues"),m=$L("#listMergeValues");if(s.is(":visible")?(t=(r=s).find(".selec"),o=(i=r).scrollTop(),l=t.outerHeight(),n=t.next(".mergeSections").outerHeight(),a=t.prev(".mergeSections").outerHeight()):m.is(":visible")&&(t=(r=m.find("ul:visible")).find(".selec"),o=(i=m.find(".oA")).scrollTop(),l=t.outerHeight(),n=t.next(".mergeSections").outerHeight(),a=t.prev(".mergeSections").outerHeight()),t.length<1){var f=r.find(".mergeOptions");t=f.eq(0),f.removeClass("selec"),t.addClass("selec"),i.scrollTop(0)}else 40===d?0===t.next(".mergeOptions").length&&t.next(".mergeSections").length>0?(r.find(".mergeOptions").removeClass("selec"),t.next().next().addClass("selec"),i.scrollTop(o+(l+n))):0===t.next(".mergeOptions").length?t.addClass("selec"):(r.find(".mergeOptions").removeClass("selec"),t.next(".mergeOptions").addClass("selec"),i.scrollTop(o+l)):38===d?0===t.prev(".mergeOptions").length&&0===t.prev(".mergeSections").prev().length&&t.prev(".mergeSections").length>0?t.addClass("selec"):0===t.prev(".mergeOptions").length&&t.prev(".mergeSections").length>0?(r.find(".mergeOptions").removeClass("selec"),t.prev(".mergeSections").prev().addClass("selec"),i.scrollTop(o-(l+a))):0===t.prev(".mergeOptions").length?(r.find(".mergeOptions").removeClass("selec"),t.addClass("selec")):(r.find(".mergeOptions").removeClass("selec"),t.prev(".mergeOptions").addClass("selec"),i.scrollTop(o-l)):13===d&&renderingUtils.triggerEvent("click",t)},mergeValueListSelection:function(){var e=$("#mergeValuesDIV").find("ul:visible li.mergeOptions");if(e.filter(".selec").length<1){var t=e.eq(0);e.removeClass("selec"),t.addClass("selec")}},setMergeFieldDivPos:function(e){Lyte.injectResources(networkUtils.returnDependencyFiles(["lyte-caret.js"],ResourceConstants.CRMClient),void 0,(function(){var t=$("#mergeValuesDIV .setDDPopupAbG"),r=$L(e).caret("offset"),i=r.top,o=r.left,l=e.parent(),n=l.offset().left-l.outerWidth(),a=mergeField.elemToBind.outerHeight(),d=mergeField.elemToBind.offset().top,s=$("#mergeValuesDIV"),m=s.outerHeight(),f=renderingUtils.windowHeight-28-(d+a),g=s.parent().offset(),c=g.top,u=g.left;i=i-c+a;var p=void 0!==wfmergefield&&"Blueprint"==wfmergefield.featureName&&"Webhook"!==wfmergefield.actionName,v=$("#socialCommentDiv");(p||"predefTextMessage"===e.attr("id")||"msgContent"===e.attr("id")||"WFChatMessageDiv"===e.attr("id"))&&(i=r.top-c+27);var F=renderingUtils.windowWidth-o-60;mergeField.isInputElem(mergeField.elemToBind)&&Crm.userDetails.RTL_ENABLED&&(F=n),void 0===wfmergefield||"webhooks"!==wfmergefield.actionName&&"tasks"!==wfmergefield.actionName&&"Task"!==wfmergefield.actionName&&"Webhook"!==wfmergefield.actionName||!Crm.userDetails.RTL_ENABLED||(F=0),o=o-u-15;var M,h=$L(".defaultView .pp-content"),w=h.scrollTop()+c-100;if(h.scrollTop(w),o>200&&p&&(o-=115,t.addClass("wfTaskDropPos")),void 0!==wfmergefield&&("AddMeeting"===wfmergefield.actionName||"ScheduleCall"===wfmergefield.actionName||"CreateConnectedRecord"===wfmergefield.actionName||"CreateRecord"===wfmergefield.actionName||"Convert"===wfmergefield.actionName||"Task"===wfmergefield.actionName||"tasks"===wfmergefield.actionName||"webhooks"===wfmergefield.actionName)){var C=e.offset().left,N=e.width();o>C+N&&(o=C+N)}if(f<=m-10?(M=Math.round(i-(m+30)),v.is(":visible")&&(M=Math.round(i-(m+30))-70)):(M=Math.round(i),v.is(":visible")&&(M=Math.round(i)-70)),mergeField.isTextArea(mergeField.elemToBind)&&(M=mergeField.getOffSetTopForTextArea(M,mergeField.elemToBind),"webhookRawBody"===mergeField.elemToBind.attr("id")&&(M-=130)),mergeField.isRichTextElem(e)){var k=e.find(".rtfCursor")[0],y=k.getBoundingClientRect();o=y.left-12,M=f+30<=m-10?y.top+y.height+5-(m+30):y.top+y.height+5,F=k.offsetLeft}Crm.userDetails.RTL_ENABLED?mergeField.isRichTextElem(e)?s.css({left:Math.round(F),top:M,display:"block"}):s.css({right:Math.round(F),top:M,display:"block"}):s.css({left:Math.round(o),top:M,display:"block"}),f<=m-10?t.addClass("setDDPopupAbGBot"):t.removeClass("setDDPopupAbGBot")}))},getOffSetTopForTextArea:function(e){return void 0===wfmergefield||"tasks"!==wfmergefield.actionName&&"webhooks"!==wfmergefield.actionName&&"Task"!==wfmergefield.actionName&&"Webhook"!==wfmergefield.actionName&&"CreateRecord"!==wfmergefield.actionName&&"CreateConnectedRecord"!==wfmergefield.actionName||(e-=50),e},bindMergeFieldOptions:function(e,t,r,i,o){$("#mergeValuesDIV").remove(),$("#mergeValuesDIV_copy").remove(),mergeField.elemToBind=e,mergeField.elemId=e,Handlebars.registerPartial("ProcessMergeFields",Handlebars.templates.ProcessMergeFields);var l=mergeField.constructMergeFieldsJSON(i);mergeField.mergeFieldJSON=l.mergeFieldJSON;var n=Handlebars.templates.ProcessMergeFields({modulesJSON:l.modulesJSON,mergeFieldJSON:l.mergeFieldJSON,Module:r});(t=t||e.parent()).addClass("pR").append(n),mergeField.titleForMergeFLd($("#mergeValuesDIV li")),$("#mergeValuesDIV").css({top:"30px",display:"none"}).attr("data-close",!0),mergeField.bindMergeFieldOptionsImpl(e),$("#listMergeValues").addClass("pT0"),o&&mergeField.isInputElem(e)&&mergeField.showMergePopAtEndOfContent(e)},showMergePopAtEndOfContent:function(e){var t=e[0],r=t.value;r.endsWith("#")||(r+="#"),t.value=r,mergeField.setCursorPosition(t,r.length),mergeField.setMergeEntities(),mergeField.showMergeValuesDIV(e)},bindMergeFieldOptionsImpl:function(e){var t=$("#mergeValuesDIV");t.unbind("mouseenter").on("mouseenter",".mergeOptions",(function(){var e=$(this);e.is(":visible")&&($("#listMergeValues .mergeOptions,#searchMergeValues .mergeOptions").removeClass("selec"),e.addClass("selec"))})),t.unbind("mouseleave").on("mouseleave",".mergeOptions",(function(){$(this).removeClass("selec")})),t.unbind("click").on("click",(function(){$("#mergeValuesDIV:visible").length>0&&mergeField.focusElem()})),e.unbind("keyup").on("keyup",(function(e){var t=this,r=$(t),i=e.keyCode?e.keyCode:e.charCode?e.charCode:e.which;if(!($("#mergeValuesDIV:visible").length>0)||40!=i&&38!=i&&13!=i){var o="",l=0;if(mergeField.isInputElem(t))o=t.value,l=mergeField.doGetCaretPosition(t),mergeField.mergeOffset.end=l;else if(mergeField.isRichTextElem(t)){var n=t.querySelector("lyte-texteditor");o=n.getCurrentNode().textContent,l=n.getCursor(),mergeField.mergeOffset.end=l}else o=t.textContent,l=mergeField.getCaretCharacterOffsetWithin(t);var a=o.substring(0,l);if("#"===a.slice(-1)&&27!==i){mergeField.setMergeEntities();var d=$(e.target);mergeField.isRichTextElem(t)&&(d=$(t)),mergeField.showMergeValuesDIV(d),e.preventDefault(),sE(e)}else{var s=a,m=s.substring(s.lastIndexOf("#")+1);m=m.trim();var f=!1;-1!==s.lastIndexOf("#")&&""!=m&&(f=!0),mergeField.searchMergeValue(f,m)}mergeField.keyUpCallback(r)}})),e.unbind("keydown").on("keydown",(function(e){var t=e.keyCode?e.keyCode:e.charCode?e.charCode:e.which;if($("#mergeValuesDIV:visible").length>0&&(40==t||38==t||13==t))return mergeField.keyPressBind(e),e.preventDefault(),sE(e),!1}))},doGetCaretPosition:function(e){var t=0;if(document.selection){e.focus();var r=document.selection.createRange();r.moveStart("character",-e.value.length),t=r.text.length}else(e.selectionStart||"0"===e.selectionStart)&&(t=e.selectionStart);return t},isInputElem:function(e){if(e){var t=$(e)[0].tagName;return"INPUT"==t||"TEXTAREA"==t}},isTextArea:function(e){if(e)return"TEXTAREA"==$(e)[0].tagName},isRichTextElem:function(e){if(e)return"CRM-RICHTEXT-COMPONENT"===$(e)[0].tagName},constructMergeFieldsJSON:function(e){for(var t={},r=[],i={},o=e.mergefields,l=o.length,n=0;n<l;n++){var a=o[n],d=a.module,s=mergeField.getModuleIdentifier(d),m={};m.id=s,m.label=d.display_name,"custom_lookup"!=d.type&&"system_field_lookup"!=d.type||(m.label=d.lookup_details.display_label),(!wfmergefield||"Kiosk"!==wfmergefield.featureName||"Webhook"!==wfmergefield.actionName||"kiosk_get_record_single"!==d.type&&"kiosk_get_record_multiple"!==d.type&&"kiosk_data_hub_multiple"!==d.type)&&(r.push(m),i[s]={},i[s].module=d,i[s].sections=a.sections)}return t.modulesJSON=r,t.mergeFieldJSON=i,t},getSelectedFieldInfo:function(e){for(var t,r=$(e),i={},o=mergeField.mergeFieldJSON,l=r.attr("moduleid"),n=o[l].module,a=o[l].sections,d=r.attr("val"),s=a.length,m=!1,f=0;f<s;f++){for(var g=a[f].fields,c=g.length,u=0;u<c;u++){var p=g[u];if(p.id==d){t=p,m=!0;break}}if(m)break}return i.module=n,i.field=t,i},getModuleIdentifier:function(e){var t=e.name;return e.lookup_details&&e.lookup_details.id&&(t+=":"+e.lookup_details.id),t},getValueToInsertOnSelection:function(e){var t=e.module,r=e.field;return CrmConvertMergeFields.getConvertedMergeField(t,r,void 0,mergeFieldsConstants.fromapi_to_label,!1)},getSpanElemToInsertOnSelection:function(e){var t=e.module,r=e.field,i=CrmConvertMergeFields.getConvertedMergeField(t,r,void 0,mergeFieldsConstants.fromapi_to_label,!0);return $(i)[0]},isInputElem:function(e){if(e){var t=$(e)[0].tagName;return"INPUT"==t||"TEXTAREA"==t}},titleForMergeFLd:function(e){$(e).off("mouseenter").on("mouseenter",(function(){var e=$(this);e.removeAttr("title"),this.offsetWidth<Math.floor(this.scrollWidth)&&this.offsetWidth!==Math.floor(this.scrollWidth)&&e.attr("title",$.trim(e.text()))}))},mergeFieldInsertCallback:function(e,t,r){if(void 0!==wfmergefield){"Webhook"==wfmergefield.actionName?wfwebhook.showHideDateTimeInfo(e.attr("id"),"add",t):"webhooks"===wfmergefield.actionName&&$L("crm-webhook-action").e[0].component.executeMethod("setShowDateTimeInfoVal");var i=$L("#element_mergefield_value");i&&i.length>0&&r&&$L("crm-kiosk-field-properties")[0].component.updateArtBoadActiveJson({meta__merge_field:r})}},keyUpCallback:function(e){void 0!==wfmergefield&&"Deluge"==wfmergefield.actionName&&wfdeluge.handleCustomParamSelection(e)}},wfmergefield={mainmodvsmergefieldsdata:{},relmodvsmergefieldsdata:{},suffix:"",featureName:"",actionName:void 0,mergefieldActions:["Convert","Cliq","Slack","CiscoTeams","CommentToPost","ReplyToTweet","ReplyToComment","AddLog","CreateRecord","CreateConnectedRecord","ReplyToMessage","AddMeeting","ScheduleCall","GoogleChat","MicrosoftTeams","Tasks","Task","send_message","convert","cliq_notifications","slack_notifications","cisco_notifications","comment_to_post","reply_to_comment","create_record","create_connected_record","reply_to_message","add_meeting","schedule_call","tasks","google_chat_notifications","microsoft_teams_notifications"],initMergeFieldDetl:function(e){wfmergefield.mainmodvsmergefieldsdata={},wfmergefield.relmodvsmergefieldsdata={},wfmergefield.featureName=e,wfmergefield.actionName=void 0},clearMergeFieldDetl:function(){wfmergefield.mainmodvsmergefieldsdata={},wfmergefield.relmodvsmergefieldsdata={},wfmergefield.featureName=void 0,wfmergefield.actionName=void 0,mergeField.clearMergeFieldObj(),wfmergefield.removeMergeFieldDivs()},setActionType:function(e){wfmergefield.actionName=e},isMergeFieldRequiredAction:function(e){return!!wfmergefield.iscustomAction(e)||wfmergefield.presentinJSONArray(e,wfmergefield.mergefieldActions)},presentinJSONArray:function(e,t){for(var r=t.length,i=0;i<r;i++)if(t[i]==e)return!0;return!1},iscustomAction:function(e){return"Workflow"==wfmergefield.featureName&&Lyte.registeredMixins["crm-automation-actions"].checkCustomAction(e)},getCustomActionName:function(e){return"Workflow"==wfmergefield.featureName?wfNew.customActionvsDetls[e].name:e},getMainModule:function(){if("Task"==wfmergefield.actionName||"Assignment Rules"==wfmergefield.featureName)return WFTask.getTaskModule();if("tasks"===wfmergefield.actionName)return Lyte.registeredMixins["crm-automation-actions"].getModuleNameToFetchMergeField(Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldModule);if("Webhook"===wfmergefield.actionName)return $("#entityType").val();if("webhooks"===wfmergefield.actionName)return Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldModule;if("Deluge"===wfmergefield.actionName)return customFunctionsObj.module;if(wfmergefield.actionName&&wfmergefield.actionName.includes("email_notification"))return Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldModule;if("Workflow"===wfmergefield.featureName||"workflow"===wfmergefield.featureName){var e=Lyte.registeredMixins["crm-automation-actions"].getActionComponent("workflow",wfmergefield.suffix).getActionModuleForSection(!1,wfmergefield.suffix);return Lyte.registeredMixins["crm-automation-actions"].fetchModuleName(e)}if("Orchestration"===wfmergefield.featureName)return $L("crm-orchestration-builder").e[0].component.currentStateData.module;if("guidedSelling"===wfmergefield.featureName)return moduleRecordMapping.Quotes.api_name;if("PathFinder"===wfmergefield.featureName)return(e=Lyte.registeredMixins.pathfinder_config.getTriggerModule())||(e=Lyte.registeredMixins.pathfinder_config.getpfModule()),e;if("Kiosk"===wfmergefield.featureName)return $L("crm-kiosk-builder").e[0].component.data.process.module.name;if("Blueprint"==wfmergefield.featureName)return ProcessBuilder.Process.Module;if("Approval"==wfmergefield.featureName)return approvalProcess.getModule();if("AutoDealCreation"===wfmergefield.featureName)return"Appointments";if("MassConvert"===wfmergefield.actionName)return"Leads";if("Emailparser"===wfmergefield.featureName)return $("#epnModuleMode").text();if("Series"===wfmergefield.featureName){var t=$L("crm-series-detail").e[0].component.getData("module");return t=Object.keys(moduleRecordMapping).find((e=>moduleRecordMapping[e].api_name===t)),t}return"CRMCCActions"===wfmergefield.featureName?ccCrmActions.module:void 0},getRelatedModule:function(){if("CRMCCActions"===wfmergefield.featureName)return"CRMCCActions";if("Task"==wfmergefield.actionName)return WFTask.getRelatedModule();if("tasks"===wfmergefield.actionName)return Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldRelModule;if("Webhook"===wfmergefield.actionName)return $("#relatedModule").val();if("webhooks"===wfmergefield.actionName)return Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldRelModule;if(wfmergefield.actionName&&wfmergefield.actionName.includes("email_notification"))return Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldRelModule;if("Deluge"==wfmergefield.actionName)return customFunctionsObj.relatedModule;if("Workflow"===wfmergefield.featureName||"workflow"===wfmergefield.featureName){var e=Lyte.registeredMixins["crm-automation-actions"].getActionComponent("workflow",wfmergefield.suffix).getRelatedModuleForAction(wfmergefield.suffix);return Lyte.registeredMixins["crm-automation-actions"].fetchModuleName(e)}if("Orchestration"==wfmergefield.featureName)return $L("crm-orchestration-builder").e[0].component.currentStateData.relatedModule;if("Kiosk"===wfmergefield.featureName){var t=$L("crm-kiosk-builder");if(t&&t.length>0)return t.e[0].component.data.process.module.name}return"PathFinder"===wfmergefield.featureName&&this.getMainModule()!==Lyte.registeredMixins.pathfinder_config.getpfModule()?Lyte.registeredMixins.pathfinder_config.getpfModule():void 0},getMergeJSONAvailable:function(e,t){var r={},i=wfmergefield.mainmodvsmergefieldsdata[e];if(r[e]=!!i,t){var o=wfmergefield.relmodvsmergefieldsdata[t];r[t]=!!o}return r},checkAvailabilityAndFetchMergeFieldAPIJSON:function(e,t,r){var i=wfmergefield.getMergeJSONAvailable(e,t);return i[e]?t&&!i[t]?wfmergefield.checkAvailabilityAndFetchRelModMergeFieldAPIJSON(t,(function(){r&&r()})):void(r&&r()):wfmergefield.fetchMergeFieldsAPIJson(e,t,!1,(function(){if(r&&r(),"Kiosk"===wfmergefield.featureName&&"Task"===wfmergefield.actionName&&featuresAvailable&&featuresAvailable.KIOSK_NEW_ACTIONS){var e=$L("crm-automation-task-due-date")[0].component;if(0===e.getData("dueDateFields").length){var t=[{value:"WFRule Trigger Date",name:I18n.getMsg("trigger.date")}],i=wfmergefield.getMainModule(),o=wfmergefield.mainmodvsmergefieldsdata[i].mergefields,l=CrmConvertMergeFields.getModuleObjectByModName(i,o),n=wfmergefield.relmodvsmergefieldsdata[wfmergefield.getRelatedModule()].mergefields,a=CrmConvertMergeFields.getModuleObjectByModName(wfmergefield.getRelatedModule(),n);wfmergefield.populateDateTypeFields(o,t,l,a),wfmergefield.populateDateTypeFields(n,t,l,a),WFTask.kioskDueDateField=CrmConvertMergeFields.replaceHtmlEncodedChars(WFTask.kioskDueDateField),e.setData({selectedField:WFTask.kioskDueDateField,dueDateFields:t})}}}))},checkAvailabilityAndFetchRelModMergeFieldAPIJSON:function(e,t){if(!wfmergefield.relmodvsmergefieldsdata[e])return wfmergefield.fetchMergeFieldsAPIJson(e,void 0,!0,(function(){t&&t()}))},fetchMergeFieldsAPIJson:function(e,t,r,i){var o=!r;return"PathFinder"===wfmergefield.featureName&&(o=!1),CrmConvertMergeFields.fetchMergeFieldsAPIJson(e,t,o,"automation",void 0,(function(o){wfmergefield.populateMergeJSONFromAPIResponse(o,e,t,r),i&&i()}))},populateMergeFieldsAPIJsonForLookups:function(e){if(e.length>0){for(var t=[],r=e.length,i=0;i<r;i++){var o=e[i];wfmergefield.relmodvsmergefieldsdata[o]||t.push(o)}if(t.length>0){var l=CrmConvertMergeFields.fetchMergeFieldsAPIJsonForLookups(t,"automation");if(l){var n=l.mergefields,a=n.length;for(i=0;i<a;i++){var d=n[i].module.name,s=[];s.push(n[i]);var m={};m.mergefields=s,wfmergefield.relmodvsmergefieldsdata[d]=m}}}}},getMergeFieldsAPIJsonForLookups:function(e,t,r,i){if(e.length>0){for(var o=e.length,l={},n=[],a=0;a<o;a++){var d=e[a],s=wfmergefield.relmodvsmergefieldsdata[d];s&&(n=n.concat(JSON.parse(JSON.stringify(s.mergefields))))}return l.mergefields=n,l=CrmConvertMergeFields.getMergeFieldsofDataType(void 0,wfmergefield.actionName,l,t,r,i)}},hideMergeFldComp:function(){var e=$L("crm-mergefield-multilevel #mergefieldspopup")[0];e&&e.ltProp("show",!1)},fetchMergeFieldsAPIJsonForLookups:function(e,t,r,i){wfmergefield.populateMergeFieldsAPIJsonForLookups(e);var o="";if(i){var l=wfmergefield.mainmodvsmergefieldsdata[wfmergefield.getMainModule()];l&&l.mergefields&&l.mergefields.forEach((function(e){e.module.lookup_details&&e.module.lookup_details.id===i&&(o=e.module.type)}))}return wfmergefield.getMergeFieldsAPIJsonForLookups(e,t,r,o)},populateMergeJSONFromAPIResponse:function(e,t,r,i){if(t&&!i)if(r){for(var o=e.mergefields,l=o.length,n=0;n<l;n++){if(o[n].module.name==r){var a=o.splice(n,1),d={};d.mergefields=a,wfmergefield.relmodvsmergefieldsdata[r]=d;break}}wfmergefield.mainmodvsmergefieldsdata[t]=e}else wfmergefield.mainmodvsmergefieldsdata[t]=e;else i&&(wfmergefield.relmodvsmergefieldsdata[t]=e)},clearMergeFieldCacheForModule:function(e){delete wfmergefield.mainmodvsmergefieldsdata[e],delete wfmergefield.relmodvsmergefieldsdata[e]},getMergeFieldAPIJSON:function(e,t,r,i){var o,l=wfmergefield.getMainModule(),n=wfmergefield.getRelatedModule(),a=wfmergefield.getMergeFieldAPIJSONForModules(l,n,t,e,r,i);if("AutoDealCreation"===wfmergefield.featureName&&("date"===e?o=wfmergefield.getMergeFieldAPIJSONForModules(l,n,t,"datetime",r,i).mergefields:"datetime"===e&&(o=wfmergefield.getMergeFieldAPIJSONForModules(l,n,t,"date",r,i).mergefields),o&&o.length>0&&o[0].sections[0])){var d=o[0].sections[0].fields;a.mergefields&&a.mergefields.length>0&&a.mergefields[0].sections[0]?a.mergefields[0].sections[0].fields=a.mergefields[0].sections[0].fields.concat(d):a.mergefields=o}return a},getMergeFieldAPIJSONForModules:function(e,t,r,i,o,l){var n=r?wfmergefield.relmodvsmergefieldsdata[e]:wfmergefield.mainmodvsmergefieldsdata[e];void 0===n&&void 0!==wfmergefield.relmodvsmergefieldsdata[e]&&(n=wfmergefield.relmodvsmergefieldsdata[e],wfmergefield.mainmodvsmergefieldsdata[e]=n,delete wfmergefield.relmodvsmergefieldsdata[e]);var a=n.mergefields;"CRMCCActions"===wfmergefield.featureName&&wfmergefield.checkAvailabilityAndFetchRelModMergeFieldAPIJSON("CRMCCActions",void 0);var d=[];if(a&&a.length>0)for(var s=a.length,m=0;m<s;m++)d.push(a[m].module.name);if(t&&wfmergefield.relmodvsmergefieldsdata[t]&&!d.includes(t)){var f=wfmergefield.relmodvsmergefieldsdata[t].mergefields;a=t.indexOf("Orchestration")>-1||t.indexOf("PathFinder")>-1?f.concat(a):a.concat(f)}var g={};g.mergefields=JSON.parse(JSON.stringify(a)),o&&CrmConvertMergeFields.removeUnsupportedModules(g,o);var c=r?void 0:e;return"Facebook"!==t&&"Twitter"!==t||wfmergefield.actionName.includes("email_notification")||(mergeField.filterCallBack=function(e,t,r){return wfmergefield.socialFilterJSON(e,t,r)}),CrmConvertMergeFields.isKioskModule(t)&&(mergeField.filterCallBack=function(e,t,r,i,o){return wfmergefield.kioskFilterJSON(e,t,r,i,o)}),g=CrmConvertMergeFields.getMergeFieldsofDataType(c,wfmergefield.actionName,g,i,l),"Orchestration"==wfmergefield.featureName?CrmConvertMergeFields.removeUnsupportedMultilevels(g):"PathFinder"===wfmergefield.featureName&&Lyte.registeredMixins.pathfinder_config.removeUnsupportedMultilevelsForPF(g),g},bindMergeFieldComponent:function(e,t,r,i,o,l){var n=wfmergefield.getMainModule(),a=wfmergefield.getRelatedModule();wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(n,a,(function(){var a=wfmergefield.getMergeFieldAPIJSON(r,!1,i,!0);"Orchestration"===wfmergefield.featureName||"CRMCCActions"===wfmergefield.featureName||"PathFinder"===wfmergefield.featureName||"guidedSelling"===wfmergefield.featureName||"Kiosk"===wfmergefield.featureName?wfmergefield.bindMultiLevelMergeFieldComponent(e,a,r,o,l):wfmergefield.bindSingleLevelMergeFieldComponent(e,t,n,a,o)}))},bindSingleLevelMergeFieldComponent:function(e,t,r,i,o){mergeField.bindMergeFieldOptions(e,t,r,i,o)},bindMultiLevelMergeFieldComponent:function(e,t,r,i,o){var l=$L("crm-function-customparam")[0];void 0!==l&&l.setData("isSaveBtnDisable","false"),$("crm-mergefield-multilevel").remove();var n={};if(n.elemToBind=e,n.mergeFieldJSON=t,n.datatype=r,n.type="mergefield",n.showmergepoponload=i,n.popupType="popup",!o||(o(n),!n.dontShowMultiDropDown))return n.mergeFieldJSON.mergefields.length||"richtext"===r||(n.popupType="noContentModal"),Lyte.Component.render("crm-mergefield-multilevel",n,n.appendDiv?n.appendDiv:"body")},getMergeFieldPopulateObject:function(e){var t=0,r={level_0:{id:e.module.name,type:"module"}};t+=1;var i,o=function(e){r["level_"+t]={id:e.id,type:e.type},t+=1},l=function(e){for(var t in e){var r=e[t];o(r)}};e.field.multilevel&&l(i=e.field.multilevel_props);if(e.lookuprelfield&&(l(i=e.lookuprelfield.multilevel_props),"Kiosk"!==wfmergefield.featureName||!CrmConvertMergeFields.isKioskModule(e.module.name)||"get_record"!==i.level1.type)){var n=e.lookuprelfield;o(n)}return o(e.field),r},removeMergeFieldDivs:function(){$("#mergeValuesDIV").remove(),$("#mergeValuesDIV_copy").remove(),$("crm-mergefield-multilevel").remove()},convertAsSysRefName:function(e){var t=wfmergefield.getMergeFieldAPIJSON();return wfmergefield.appendLookupsMergeJSON(t),CrmConvertMergeFields.convertMergeFieldsAsRequiredFormat(e,mergeFieldsConstants.fromlabel_to_api,t)},convertInfoToLabel:function(e,t,r){r&&wfmergefield.setActionType(void 0);var i=wfmergefield.getMergeFieldAPIJSON();return wfmergefield.appendLookupsMergeJSON(i),CrmConvertMergeFields.convertMergeFieldsAsRequiredFormat(e,mergeFieldsConstants.fromapi_to_label,i,t)},getUnsupportedFieldsList:function(e,t){var r=wfmergefield.getMergeFieldAPIJSON(t);return wfmergefield.appendLookupsMergeJSON(r,t),CrmConvertMergeFields.getUnsupportedMergeFields(e,mergeFieldsConstants.fromlabel_to_api,r)},getMergeFieldAsModuleInfo:function(e){var t=new RegExp(/\$\{([^\}].*?)\}/g).exec(e);if(t){var r=wfmergefield.getMergeFieldAPIJSON();return wfmergefield.appendLookupsMergeJSON(r),CrmConvertMergeFields.getModuleAndFieldInfo(r,t[1].split("."),mergeFieldsConstants.fromapi_to_label)}},getFieldsUsedForDataTypes:function(e,t,r){var i=wfmergefield.getMergeFieldAPIJSON();wfmergefield.appendLookupsMergeJSON(i);for(var o=CrmConvertMergeFields.getFieldsUsedInContent(e,t,i,r),l={},n=o.length,a=0;a<n;a++){var d=o[a],s=d.data_type;l[s]||(l[s]=[]),l[s].push(d)}return l},appendLookupsMergeJSON:function(e,t){var r;r="PathFinder"===wfmergefield.featureName?wfmergefield.getMainModule():wfmergefield.getRelatedModule();var i=[],o=[];if(r&&(r.indexOf("Orchestration")>-1||r.indexOf("PathFinder")>-1)){var l=wfmergefield.getMergeFieldAPIJSONForModules(r,void 0,"PathFinder"!==wfmergefield.featureName);if(l)l.mergefields.forEach((function(e){e.sections.forEach((function(e){e.fields.forEach((function(e){if(CrmConvertMergeFields.isSecondLevelLookupSupported(r,e)&&e.lookup_module){var t=e.lookup_module.id,l=store.peekRecord("module",t).module_name;CrmConvertMergeFields.presentinJSONArray(l,i)||i.push(l),e.lookup_used&&!CrmConvertMergeFields.presentinJSONArray(l,o)&&o.push(l)}}))}))}))}wfmergefield.populateMergeFieldsAPIJsonForLookups(o);var n=wfmergefield.getMergeFieldsAPIJsonForLookups(i,t);n&&(e.lookuprelmergefields=n.mergefields)},showUnsupportedFields:function(e,t,r,i){var o=networkUtils.returnDependencyFiles(["zohocrm_unsupportmergefields.js"],ResourceConstants.CRM);Lyte.injectResources(o,void 0,(function(){r||(r=I18n.getMsg("crm.workflow.actions.unsupported.merge.field.msg","<b>"+$ESAPI.encoder().encodeForHTML(t)+"</b>"));"Cliq"===t?I18n.getMsg("crm.label.chat.notification.title",Crm.integrationsAppName.ZOHO_CLIQ):I18n.getMsg("crm.workflow.actions.label."+t);wfmergefield.iscustomAction(t)&&wfmergefield.getCustomActionName(t);var o=$("#unsupportedMergeFieldPop"),l=$("#commonActionPage"),n=l.css("z-index");0==o.length&&$("body").append(Handlebars.templates.unsupport_mergefields);var a=$("#unsupportedMergeFieldPopSub");l.css("z-index","20");var d=$("#unsupportedBodyMergeField");if(a.html(r),template.showAnimatePopup("unsupportedMergeFieldPop"),e.length>0){for(var s=e.length,m='<div class="mT10">',f=0;f<s;f++)m=m+(f+1)+". "+$ESAPI.encoder().encodeForHTML(e[f])+"<br>";m+="</div>",d.html(m),d.show()}$("#unsupportedFieldMsg").html(I18n.getMsg("crm.workflow.actions.unsupported.merge.field.msg1",RebrandLinkUtil.getProperty("index_crmurl")+"help/automation/webhooks.html#Unsupported_Merge_Fields"));var g=$("#okTemplateBtn");return g.off("click"),g.on("click",(function(){var e=$("#unsupportedBodyMergeField");$("#commonActionPage").css("z-index",n),template.hideAnimatePopup("unsupportedMergeFieldPop"),e.hide(),"CreateRecord"===t||"CreateConnectedRecord"===t?($(".wfCreateRecordModal .lyteModal").removeClass("crFreezePop"),$L(".drCreateRecordModal .lyteModal").removeClass("crFreezePop")):"Tasks"===t&&renderingUtils.removeFreezeLayer(),i&&i()})),!1}))},getFieldObj:function(e,t){var r=CrmConvertMergeFields.isModuleAvail(wfmergefield.getMergeFieldAPIJSON(),e);if(r)return CrmConvertMergeFields.getFieldObject(r,t,mergeFieldsConstants.fromapi_to_label)},kioskFilterJSON:function(e,t,r,i,o){if("fileupload"===t||555===r.ui_type&&t)return!(!o||"CreateRecord"!==o&&"Fieldupdate"!==o||!e||!e.kiosk_module)&&!(!r||555!==r.ui_type||"fileupload"!==t);if("Fieldupdate"===o&&"bigint"===t){var l=$("#staticRefDrpDwn");if(l.length>0&&l.is(":visible")&&"reference"===l.val()&&"208"===l.data("uiType"))return"bigint"!==r.data_type||208===r.ui_type}return!(!t&&555===r.ui_type&&o&&"CreateRecord"!==o&&"Fieldupdate"!==o)&&("single_getrecord_field"!==r.type&&("multi_getrecord_field"===r.type||"multi_datahub_field"===r.type?!(!wfmergefield||"Deluge"!==wfmergefield.actionName):!!i))},socialFilterJSON:function(e,t,r){var i=r.api_name,o=wfNew.selectedTrigger;if("Facebook"===e.name||"Twitter"===e.name)if("HANDLE"===i&&(r.field_label="Brand Handle"),"PAGE"===i&&(r.field_label="Brand Page"),"fb_post_on_page"===o||"tw_mention_on"===o){if("COMMENT"===i||"MESSAGE"===i)return!1}else if("fb_comment_on_page"===o){if("POST"===i||"MESSAGE"===i)return!1}else if("fb_send_message"===o){if("COMMENT"===i||"POST"===i)return!1}else if("tw_comment_on_tweet"===o){if("TWEET"===i||"MESSAGE"===i)return!1}else if("tw_send_message"===o){if("COMMENT"===i||"TWEET"===i)return!1}else if(("tw_retweet_on_tweet"===o||"fb_like_on_post"===o)&&"PAGE"!==i&&"HANDLE"!==i)return!1;return!0===r.show},populateDateTypeFields:function(e,t,r,i){for(var o=e.length,l=0;l<o;l++){var n=!1,a=e[l].module.name;if("Users"!==a&&"Execution Info"!==a&&"Organization"!==a){var d=e[l].sections,s=e[l].module.display_name,m="${!"+e[l].module.api_name;if("kiosk_get_record_single"===e[l].module.type)s=e[l].module.lookup_details.display_label,m="${!"+i.api_name+"."+e[l].module.lookup_details.api_name,n=!0;else if(!CrmConvertMergeFields.isKioskModule(a))continue;for(var f=[],g=d.length,c=0;c<g;c++)for(var u=d[c].fields,p=u.length,v=0;v<p;v++){var F=u[v];if((!n||F.showinlookup)&&(F.show&&("date"===F.data_type||"datetime"===F.data_type))){var M={value:m.concat(".").concat(F.api_name).concat("}"),name:F.field_label};f.push(M)}}if(f.length>0){var h=wfmergefield.searchInnerOptJson(t,s);h?t[s]=h.concat(f):t.push({[s]:f})}}}return t},searchInnerOptJson:function(e,t){for(var r=e.length,i=0;i<r;i++){var o=e[i];if(o[t])return o[t]}}};