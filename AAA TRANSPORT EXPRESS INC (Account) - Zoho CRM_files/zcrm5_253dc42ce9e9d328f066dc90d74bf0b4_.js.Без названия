var crmCalendar={currCalDate:void 0,currDateObj:void 0,currMonth:void 0,currYear:void 0,currDate:void 0,currMonthEnd:[31,28,31,30,31,30,31,31,30,31,30,31],monthName:void 0,days:void 0,displayPanel:void 0,callFnAfterClose:void 0,sDate:void 0,eDate:void 0,isHideToday:void 0,goDate:void 0,crmCalposition:void 0,dayslist_lower:["sun","mon","tue","wed","thu","fri","sat"],calDefColor:"#515CCB",weekdays:{1:"Sunday",2:"Monday",3:"Tuesday",4:"Wednesday",5:"Thursday",6:"Friday",7:"Saturday"},months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},init:function(){this.monthName=[{html:I18n.getMsg("January"),value:0},{html:I18n.getMsg("February"),value:1},{html:I18n.getMsg("March"),value:2},{html:I18n.getMsg("April"),value:3},{html:I18n.getMsg("May"),value:4},{html:I18n.getMsg("June"),value:5},{html:I18n.getMsg("July"),value:6},{html:I18n.getMsg("August"),value:7},{html:I18n.getMsg("September"),value:8},{html:I18n.getMsg("October"),value:9},{html:I18n.getMsg("November"),value:10},{html:I18n.getMsg("December"),value:11}],this.monthNameWithThreeLetter=[{html:I18n.getMsg("Jan"),value:0},{html:I18n.getMsg("Feb"),value:1},{html:I18n.getMsg("Mar"),value:2},{html:I18n.getMsg("Apr"),value:3},{html:I18n.getMsg("May"),value:4},{html:I18n.getMsg("Jun"),value:5},{html:I18n.getMsg("Jul"),value:6},{html:I18n.getMsg("Aug"),value:7},{html:I18n.getMsg("Sep"),value:8},{html:I18n.getMsg("Oct"),value:9},{html:I18n.getMsg("Nov"),value:10},{html:I18n.getMsg("Dec"),value:11}],this.days=["ssunday","smonday","stuesday","swednesday","sthursday","sfriday","ssaturday"],this.dayNamesShort=["ssun","smon","stue","swed","sthu","sfri","ssat"],this.daysBasedOnPrefernce=["ssunday","smonday","stuesday","swednesday","sthursday","sfriday","ssaturday"];for(var e=0;e<Crm.calPreferences.WEEKSTARTSON;e++){var t=this.daysBasedOnPrefernce[0];this.daysBasedOnPrefernce.shift(1),this.daysBasedOnPrefernce.push(t);var i=this.dayNamesShort[0];this.dayNamesShort.shift(1),this.dayNamesShort.push(i)}if(this.daysFullString=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],this.weekSequence=[{html:I18n.getMsg("First"),value:1},{html:I18n.getMsg("Second"),value:2},{html:I18n.getMsg("Third"),value:3},{html:I18n.getMsg("Fourth"),value:4},{html:I18n.getMsg("Last"),value:-1}],"undefined"!=typeof featuresAvailable&&featuresAvailable.NEXTGENUI_ENABLED){var a=$L("#calendarCont");if(!!(a&&a.length>0)){var r=document.querySelector("crm-left-menu").component;r.setData("selectedMenu","calendar"),r.executeMethod("removeAllActiveBottomMenus",r),r.actions.showOrHideLeftPane(!1),r.actions.updateNavActiveClassForBottomMenu("leftPaneCalendar",!0)}}},setCurrMonthEnd:function(){1==this.currMonth&&(this.currMonthEnd[1]=this.currYear%400==0||this.currYear%4==0&&this.currYear%100!=0?29:28)},getTitle:function(){return this.monthName[this.currMonth].html+" "+this.currYear},getDateObjectFromGivenDateString:function(e,t){var i=CrmDateUtils.getDateObjectFromString(e,t?t.toUpperCase():t,!0);return this.currDateObj=i,this.currDate=i.getDate(),this.currMonth=i.getMonth(),this.currYear=i.getFullYear(),this.currDateObj},showCalendar:function(e,t,i,a,r,n,o,s){var l,c=document.getElementById("iskanbanview");if(Activities.RemainderHideOnly(),"topPanel"===t&&$("#leftPanelCalendarP").is(":visible"))return renderingUtils.stopEvent(e),!1;this.callFnAfterClose=i;var d,u=e.target;if(c&&"true"===c.value||$(u).parents(".diUserSettingContainerData").is(":visible")||$("#datFilter_-1").is(":visible")||$(".dIBestTimeDropdown").length||"Crm_Tasks_DUEDATE"===$(u).attr("id")&&$("#rmStatusMesg").length>0||hideMenu(),n?(l=$("input[name='"+n+"']")[0],e=window.event):"string"==typeof e?(l="A"===getElemById(e).nodeName?$("a[id='"+e+"']"):$("input[name='"+e+"']")[0],e=window.event):l=c&&"true"===c.value&&null!=calenderTargetElKv&&(void 0!==e.srcElement&&"input"!==e.srcElement.tagName.toLowerCase()||void 0!==e.target&&"input"!==e.target.tagName.toLowerCase())?getObj(calenderTargetElKv):renderingUtils.getTargetElem(e),"img"==l.nodeName)l.readOnly;else{if(d=l.value,void 0!==$(l).attr("data-other")){var m=$(l).attr("data-other");d=$("#"+m).val()}$(l).data("uitype",r)}if(!(l.name&&l.name.indexOf("searchdate")>-1&&0==l.value.indexOf("$"))){var p=$(l).data("datepattern"),g=p||(Crm.userDetails&&Crm.userDetails.DATE_PATTERN?Crm.userDetails.DATE_PATTERN:"mm/dd/yyyy"),h=l.value;if(d==g&&(h="",d=""),!Utils.isValidDate(g,d,void 0,!0)){var v=new Date;d=this.convertToUserDatePattern(v.getDate()+" "+v.getMonth()+" "+v.getFullYear(),p,!0)}"topPanel"==t||0==l.readOnly&&!d?(this.currDateObj=new Date,this.currMonth=this.currDateObj.getMonth(),this.currYear=this.currDateObj.getFullYear(),this.currYear<1e3&&(this.currYear+=1900),this.currDate=this.currDateObj.getDate()):(""!=g&&(this.currDateObj=this.getDateObjectFromGivenDateString(d,p)),this.currYear<1e3&&(this.currYear+=1900)),l.focus();var f=$(l);f.closest(".newInputStyleEle").length&&(f=f.parent());var C=f.offset();this.displayField=l.id,this.displayPanel=t||"leftPanel",this.createCalendar(this.currDate,this.currMonth,this.currYear,a,o,s);var I,y=$(".crmTrendDashBoard");if("topPanel"==this.displayPanel){var w=$("#leftPanelCalendarP"),L=$("#sCalenDar").offset();if(""!=crmCalendar.crmCalposition&&null!=crmCalendar.crmCalposition){var b=crmCalendar.crmCalposition.left,k=crmCalendar.crmCalposition.top,M=b;w.addClass("top0")}else b=C.left-w.outerWidth()/2+f.outerWidth()/2,k=C.top+f.height()-1,M=$(".lyteMenuSettings #sCalenDar").offset().left+$(".lyteMenuSettings #sCalenDar").outerWidth();if(Crm.userDetails.RTL_ENABLED)w.css({left:L.left-50+"px",top:k+14});else{var T=renderingUtils.windowWidth+$(window).scrollLeft()-M-65-95;w.css({top:k+14,right:T}),$("#leftPanelCalendarP .SocialArrow").css({right:25})}$("#conditionalFieldRightSection").length&&void 0!==e&&27!==e.which&&void 0!==e.which&&$("#conditionalFieldRightSection").css("right","-650px"),$("#validationRuleRightSection").length&&void 0!==e&&27!==e.which&&void 0!==e.which&&$("#validationRuleRightSection").hide(),$(".newCalendarIcon").addClass("newCalendarIconH").removeClass("newCalendarIcon")}else{var _=window.innerWidth?window.innerWidth:document.body.clientWidth,A=window.innerHeight?window.innerHeight:document.body.clientHeight,S=_-(C.left-document.body.scrollLeft);if($("#searchCreatePopup").is(":visible"))var P=A-(C.top-$L("html,body").scrollTop());else P=A-(C.top-document.body.scrollTop);if("INPUT"==l.nodeName){var E=$("#Calendar").width(),D=C.left,x=$("#Calendar").outerHeight(),N=f.outerHeight(),R=C.top+f.outerHeight()-1;E>S&&(D=D-E+f.outerWidth()-1),P<x&&(R=C.top-x);y=$(".crmTrendDashBoard");document.addEventListener("scroll",crmCalendar.scrollFix=function(e){var t,i=$(l).offset().top,a=A-i,r=$(e.target),n=r.offset().top,o=r.outerHeight(),s=$("#Calendar");t=a-28>x?i+N:i-x,s.css({top:t+"px"}),(n-N>=i||o+n<=i)&&(y.length||crmCalendar.close(),$(l).blur()),$("#searchCreatePopup").is(":visible")&&$("#Calendar").hide()},!0)}else D=C.left+f.outerWidth(),R=C.top-1;if($("#updateCallStatus").is(":visible")){R=f.position().top+f.outerHeight();$("#Calendar").show().css({position:"fixed",top:R+1+"px",left:D+"px"})}else $("#Calendar").show().css({position:"absolute",top:R+1+"px",left:D+"px"})}if(y.length&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-zianotification-helper"].calendarDropAppend()})),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value){var O=R+1+"px";TaskKanbanView.setCalenderScroll("kanbanTaskDetailctn",O)}crmCalendar.sDate=o,crmCalendar.eDate=s,this.goDate&&(I=new Date(this.goDate));var F=$("#Calendar");"Crm_Services_STARTING_DATE"==e.target.id||"Crm_Services_CLOSING_DATE"==e.target.id?(F.addClass("serviceCalender"),F.removeClass("serviceCalenderDates")):e.target.id.startsWith("Crm_Services_AVAILABLE_DATES")||"Crm_Services_AVAILABLE_DATES"==e.target.id?F.addClass("serviceCalender serviceCalenderDates"):F.removeClass("serviceCalender serviceCalenderDates"),crmCalendar.updateDatePicker(e,void 0,void 0,I),"INPUT"==l.nodeName&&l.setAttribute("autocomplete","off"),l.value=h,this.calendarNode=l,$(".dICal").length&&$(".dICal").removeClass("dICal"),renderingUtils.stopEvent(e)}},scrollFix:{},updateDatePicker:function(e,t,i,a,r){var n=$("#Calendar"),o=this;if("topPanel"==this.displayPanel&&(n=$("#leftPanelCalendarP")),void 0!==a?(this.currDate=a.getDate(),this.currMonth=a.getMonth(),this.currYear=a.getFullYear()):void 0!==t?1==t?11==this.currMonth?r?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){o.currMonth=Lyte.registeredMixins["crm-zianotification-helper"].inc})):(this.currMonth=0,this.currYear++):r?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){o.currMonth=Lyte.registeredMixins["crm-zianotification-helper"].inc})):this.currMonth++:0==this.currMonth?(this.currMonth=11,this.currYear--):this.currMonth--:void 0!==i&&(r?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){o.currYear=Lyte.registeredMixins["crm-zianotification-helper"].inc})):this.currYear=parseInt(this.currYear)+i),this.createCalendar(this.currDate,this.currMonth,this.currYear,this.showExecutionDay),n.show(),void 0!==crmCalendar.eDate){"object"!=typeof crmCalendar.eDate&&(crmCalendar.eDate=crmCalendar.eDate.replace(/,/g,"/"));var s=(u=new Date(crmCalendar.eDate)).getDate(),l=u.getMonth(),c=u.getFullYear();if(parseInt(c)>=this.currYear){if(parseInt(c)==this.currYear)if($(".yearNavRgt").addClass("disabledArow"),parseInt(l)>=this.currMonth){if(l==this.currMonth){$("#nm").addClass("disabledArow");var d=$("#calHeader td").length;$("#calHeader td").each((function(){var e=parseInt($("#calHeader td").eq(d-1).attr("onclick").substr($("#calHeader td").eq(d-1).attr("onclick").indexOf("('")+4,3)),t=parseInt($("#calHeader td").eq(d-1).attr("onclick").substr($("#calHeader td").eq(d-1).attr("onclick").indexOf("('")+2,2))+"_"+e;if(parseInt(s)+"_"+parseInt(l)==t)return!1;$("#calHeader td").eq(d-1).addClass("lightDisabledArr"),d-=1}))}}else $("#nm").addClass("disabledArow"),$("#calHeader td").each((function(){$(this).addClass("lightDisabledArr")}))}else $(".yearNavRgt").addClass("disabledArow"),$("#nm").addClass("disabledArow"),$("#calHeader td").each((function(){$(this).addClass("lightDisabledArr")}))}if(void 0!==crmCalendar.sDate){"object"!=typeof crmCalendar.sDate&&(crmCalendar.sDate=crmCalendar.sDate.replace(/,/g,"/"));var u;s=(u=new Date(crmCalendar.sDate)).getDate(),l=u.getMonth(),c=u.getFullYear();parseInt(c)<=this.currYear?parseInt(c)==this.currYear&&($(".yearNavLft").addClass("disabledArow"),parseInt(l)<=this.currMonth?l==this.currMonth&&($("#pm").addClass("disabledArow"),$("#calHeader td").each((function(){var e=parseInt($(this).attr("onclick").substr($(this).attr("onclick").indexOf("('")+4,3)),t=parseInt($(this).attr("onclick").substr($(this).attr("onclick").indexOf("('")+2,2))+"_"+e;if(parseInt(s)+"_"+parseInt(l)==t)return!1;$(this).addClass("lightDisabledArr")}))):($("#pm").addClass("disabledArow"),$("#calHeader td").each((function(){$(this).addClass("lightDisabledArr")})))):($(".yearNavLft").addClass("disabledArow"),$("#pm").addClass("disabledArow"),$("#calHeader td").each((function(){$(this).addClass("lightDisabledArr")})))}($(".crmTrendDashBoard").length&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-zianotification-helper"].calendarDropAppend()})),n.hasClass("serviceCalender"))&&((!e||!e.currentTarget||("nm"===e.currentTarget.id||"pm"===e.currentTarget.id||""===e.currentTarget.id?!this.calendarNode||"Crm_Services_AVAILABLE_DATES"===this.calendarNode.id:"Crm_Services_AVAILABLE_DATES"===e.currentTarget.id))&&(this.setHolidays(),this.setBusinessClosedDays()),n.hasClass("serviceCalenderDates")&&this.setAlreadySelectedDate());$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")&&"create"===Events.currentStatus&&this.hideNavigationAndPastDays(),renderingUtils.stopEvent(e)},createDatePicker:function(e,t,i){this.setCurrMonthEnd();var a=new Date(i,t,1),r=6,n=this.daysBasedOnPrefernce.indexOf(this.days[a.getDay()])+1;r=31===this.currMonthEnd[t]&&n>=6||30===this.currMonthEnd[t]&&7===n?7:28===this.currMonthEnd[t]&&1===n?5:6;var o=this.getTitle(e,i,t),s="topPanel"!=this.displayPanel?'<div id="calenDiv"><i id="calArrow" style="display:none;" class="dIB SocialArrow"></i><div>':'<div><i id="calArrow" class="dIB SocialArrow "></i><div>',l="topPanel"!=this.displayPanel?this.dayNamesShort:this.daysBasedOnPrefernce,c=s+"<div>";c+='<div class="aligncenter"><span class="calNav yearNavLft" onclick="crmCalendar.updateDatePicker(event,undefined, -1)"></span><span class="calNav dLft" onClick="crmCalendar.updateDatePicker(event,-1)" id="pm"></span><span class="sCalMon">'+o+'</span><span class="calNav dRgt" onClick ="crmCalendar.updateDatePicker(event,1)" id="nm"></span><span class="calNav yearNavRgt" onclick="crmCalendar.updateDatePicker(event,undefined, 1)"></span></div>',c+='<table  class="calDay"  id ="weekDays" style="color:#8b9ab9; font-size: var(--crm-small-font-size); margin-left:0"><tr> <th>'+I18n.getMsg(l[0])+"</th> <th>"+I18n.getMsg(l[1])+"</th><th>"+I18n.getMsg(l[2])+"</th><th>"+I18n.getMsg(l[3])+"</th> <th>"+I18n.getMsg(l[4])+"</th> <th>"+I18n.getMsg(l[5])+"</th> <th>"+I18n.getMsg(l[6])+"</th></tr></table>",c+="</div>",c+='<table id="calHeader" class="calDay" style="margin-left:0; margin-top:-5px;" width="100%" cellspacing="0" cellpadding="0" border="0" >';var d="",u=new Date,m=i||u.getFullYear(),p=e||u.getDate(),g=null==t?u.getMonth():t,h=this.currDateObj?this.currDateObj.getMonth():u.getMonth(),v=this.currDateObj?this.currDateObj.getFullYear():u.getFullYear(),f=this.currDateObj?this.currDateObj.getDate():u.getDate(),C=u.getMonth(),I=u.getFullYear(),y=u.getDate();C==t&&i==I&&(d=' style="display:none"');for(var w,L,b,k=a.getDay();k!==Crm.calPreferences.WEEKSTARTSON;)a.setDate(a.getDate()-1),k=a.getDay();for(var M=1;M<=r;M++){c+="<tr>";for(var T=1;T<8;T++){w=a.getMonth(),L=a.getFullYear(),b=a.getDate(),dateId=L+"-"+(parseInt(w)+1)+"-"+b;var _="cdate lt-gray";"topPanel"!=this.displayPanel&&b==p&&L==m&&w==g&&(_="cdate lt-gray"),w==g&&(_="cdate"),b==y&&w==C&&L==I&&(_="cDate crmCalendarToday"),b===f&&w===h&&L===v&&(_="sel"),"topPanel"!=this.displayPanel?c+='<td class="'+_+'" onClick="crmCalendar.displaySelectedDate(\''+b+" "+w+" "+L+"')\">"+b+"</td>":c+='<td id="day_'+dateId+'" class="'+_+'" onClick="crmCalendar.goToView(\''+dateId+"')\">"+b+"</td>",a.setDate(a.getDate()+1)}c+="</tr>"}if(c+="</table>",c+="<div>","topPanel"!=this.displayPanel?(this.isHideToday||(c+='<div id="calBtns" class="pT15 pB15 fL"><a'+d+' class="cP fL" href="javascript:;" id="todayBtn" onclick="crmCalendar.displaySelectedDate(\'today\')">'+I18n.getMsg("Today")+"</a>"),this.showExecutionDay&&(c+='<span id="calBtnsExec" class="fR"><a class="cP" href="javascript:;" id="executionDayBtn" onclick="crmCalendar.displaySelectedDate(\'executionDay\')">'+I18n.getMsg("workflow.filedUpdate.executeDay.label")+"</a></span>"),c+="</div>"):c+='<div id="calBtns" class="mT10 pT15"><p class="fL"><a class="cP" id="todayBtn" onclick="crmCalendar.updateDatePicker(event,undefined, undefined, new Date())" '+d+">"+I18n.getMsg("Today")+'</a></p><p id="calBtns1" class="fR"><a href="javascript:;"  id="cal_dayView" onclick="crmCalendar.goToView(\''+L+"-"+w+"-"+y+"', 'dayview')\">"+I18n.getMsg("crm.report.day")+'</a><a href="javascript:;" class="mL15" id="cal_weekView" onclick="crmCalendar.goToView(\''+L+"-"+w+"-"+y+"', 'weekview')\">"+I18n.getMsg("crm.report.week")+'</a><a href="javascript:;" class="mL15" id="cal_monthView" onclick="crmCalendar.goToView(\''+L+"-"+w+"-"+y+"', 'monthview')\">"+I18n.getMsg("crm.report.month")+"</a></p></div>",c+="</div>",c+="</div></div>","topPanel"==this.displayPanel){var A=new Date(i,t,1);A.setDate(1);var S=A.getFullYear()+"-"+(A.getMonth()+1)+"-"+A.getDate(),P=crmCalendar.calcTDWidth("monthview"),E=$("#topdivbg"),D=Math.ceil((renderingUtils.windowHeight-(E.length?E.height():0)-100)/100)+2;$.ajax({url:Crm.getCrmBasePath()+"/events/CalendarView.do",type:"POST",data:"type=monthview&secAction=dotsForSmallCal&obtaineddate="+S+"&tdWidthParam="+P+"&userFetchCnt="+D,success:function(e){crmCalendar.fillDot(e.split(":"))}})}return c},goToView:function(e,t){t||(t="dayview"),"string"==typeof e&&e.toLowerCase().includes("nan")&&(e=$L.moment().format("YYYY-MM-D"));var i=$("#topdivbg"),a=$(window).height(),r=i.height();$("#leftPanelCalendarP").hide();var n={type:t,obtaineddate:e,tdWidthParam:crmCalendar.calcTDWidth(t),userFetchCnt:Math.ceil((a-(i.length?r:0)-100)/100)+2},o={isSmallCal:!0};"true"===$("#isAllEventViewLoaded").val()&&(o.action="saveCalRecentView",n.idStr="ALLEVENT",o.calViewType="ALLEVENT"),Lyte.Router.getRouteInstance().getQueryParams().isMobile&&"true"===Lyte.Router.getRouteInstance().getQueryParams().isMobile.toString()&&(n.isMobile=!0),Lyte.Router.transitionTo({route:"crm.crm-calendar",queryParams:n}).data=o},fillDot:function(e){for(i=0;i<e.length;i++){var t=$("#day_"+e[i]);if(t.length>0){var a=t.attr("class");a&&("cdate"==a?t.attr("class","dot"):"cdate lt-gray"==a?t.attr("class","dot2"):t.attr("class","toDayDot"))}}},createCalendar:function(e,t,i,a){this.monthName||crmCalendar.init(),Crm.userDetails||(Crm.userDetails=window.opener.Crm.userDetails),this.showExecutionDay=a;var r=this.createDatePicker(e,t,i);"topPanel"==this.displayPanel?document.getElementById("leftPanelCalendarP").ltProp("show",!0):$("#Calendar").html(r)},close:function(){$("#Calendar").hide(),1!==$("#analyticalPageContainer").length&&1!==$("#createDashboardPanel").length||AnalyticsChart.rm_focusCalenderEle(),$(".dICal").length&&$(".dICal").removeClass("dICal"),$("#leftPanelCalendarP").hide(),this.calendarNode=void 0,document.removeEventListener("scroll",crmCalendar.scrollFix,!0),crmCalendar.scrollFix=null},displaySelectedDate:function(e,t){var i=this.calendarNode;if(!t)t=$(this.calendarNode);var a,r=$(t).data("datepattern");"today"==e&&(e=(a=new Date).getDate()+" "+a.getMonth()+" "+a.getFullYear());if("executionDay"==e){var n=t.data("uitype");o=786===n||14===n||333===n?crmConstants.executionTimeFormula:crmConstants.executionDayFormula,$("#execDayElems").show(),$(t).closest(".updateCalendarOption").find(".execDayTime").show(),$(t).closest(".updateCalendarOption").find(".newtimefrmt").hide(),$("#dateFrmSPAN").hide(),$("#timefrmspan").hide()}else{var o=this.convertToUserDatePattern(e,r);a=this.getDateObjectFromGivenDateString(o,r);var s=t.data("dateObj")?new Date(t.data("dateObj")):a;s.setDate(a.getDate()),s.setMonth(a.getMonth()),s.setFullYear(a.getFullYear()),t.data("dateObj",s),786===t.data("uitype")||14===t.data("uitype")||333===t.data("uitype")?($(t).closest(".updateCalendarOption").find(".newtimefrmt").show(),$("#dateFrmSPAN").hide(),$("#timefrmspan").show()):$("#timefrmspan").hide(),$("#execDayElems").hide(),$(t).closest(".updateCalendarOption").find(".execDayTime").hide()}if(t.val(o),t.focus(),renderingUtils.triggerEvent("change",t),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value&&getObj("headervaluetkv_Due Date")&&"inline"!==getObj("headervaluetkv_Due Date").style.display&&""!==getObj("headervaluetkv_Due Date").style.display){getObj("headervaluetkv_Due Date").innerText=o,getObj("headervaluetkv_Due Date").style.display="inline",getObj("headertextarea_Due Date").style.display="none";var l=document.getElementById("entityId").value;Callonclickofbutton("/crm/v2/","textbox_Due Date","headervaluetkv_Due Date","headertextarea_Due Date","Due Date","Tasks","subvalue_Due Date","24","CrmTask","DUEDATE",l,"false"),tkvajaxEdit=!1}crmCalendar.close(),this.callFnAfterClose&&this.callFnAfterClose(i)},setDayViewIconDate:function(){var e=new Date(calView.currCalDateObj);$("#calLeftIconDate").text(e.getDate()),$("#calLeftIconDay").text(I18n.getMsg(this.weekdays[e.getDay()+1])),$("#calLeftIconMonth").text(I18n.getMsg(this.months[e.getMonth()+1])+" "+e.getFullYear())},calcTDWidth:function(e,t){var i=155;if("dayview"==e){var a=$(window).width(),r=2*$("#tabLayer").offset().left+74,n=$("#calendarCont")&&$("#calendarCont").width()>0?$("#calendarCont").width()-70:a-r;$(".user")&&$(".user").next().remove();var o=216,s=6;a>=1280&&a<1366?o=215:a>=1366&&a<1440?o=218:a>=1440&&a<1600?o=214:a>=1600&&a<1680?(o=212,s=7):a>=1680&&a<1900||a>=1900&&a<2100?(o=216,s=8):a>=2100&&a<3e3&&(o=212,s=8),$(".user")&&$(".user").width(o);var l=(n-o-10)/s;i=u=Math.ceil(l)}else if("weekview"==e){i=186;a=$(window).width();var c=$("#calendarCont"),d=c.width();$("#calendarCont.month.multiUserCalCon").length&&(d+=15);n=c&&d>0?d-70:a-174;$(".user")&&$(".user").next().remove();o=210,s=5;(d&&d>1679||a>1679)&&(s=7),!t&&crmCalendar.selUserCalPreferences&&7!=crmCalendar.selUserCalPreferences.DAYSPERWEEK?s=-1==crmCalendar.selUserCalPreferences.HOLIDAY2&&7==s?6:5:!t||5!=t&&6!=t||7!=s||(s=t),$(".user")&&$(".user").width(o);l=(n-o-8)/s;var u=Math.ceil(l);d<1679&&(u+=2),i=u<i?i:u}return i},convertToUserDatePattern:function(e,t,i=!1){var a=e.split(" "),r=new Date(a[2],a[1],a[0]),n=t||Crm.userDetails.DATE_PATTERN;return CrmDateUtils.convertDateToUserPattern(r,n.toUpperCase(),i)},setHolidays:function(){if(null!=Crm.holidays){var e=Crm.holidays.length;if(e>0&&null==Crm.holidays[0].shift)for(var t=0;t<e;t++)for(var i=Crm.holidays[t].details.length,a=0;a<i;a++){var r=new Date(Crm.holidays[t].details[a].date);this.markHolidays(r)}}},setAlreadySelectedDate:function(){var e=Crm.holidays.selectedDate.length;if(e>0)for(var t=0;t<e;t++){var i=new Date(Crm.holidays.selectedDate[t]);this.markHolidays(i)}},markHolidays:function(e){for(var t="crmCalendar.displaySelectedDate('"+e.getUTCDate()+" "+e.getUTCMonth()+" "+e.getUTCFullYear()+"')",i=$("#calenDiv").find('td[class="cdate"],[class="sel"],[class="cdate lt-gray"]'),a=i.length,r=0;r<a;r++){var n=$(i[r]);n.attr("onclick")==t&&(n.removeAttr("onclick"),n.removeClass("lt-gray"),n.addClass("crmNegativeColor"))}},setBusinessClosedDays:function(){if(null!=Crm.businessJSON&&Crm.businessJSON.business_days){var e=Crm.businessJSON.business_days.length;if(e>0&&e<7)for(var t=$("#calenDiv").find('td[class="cdate"],[class="sel"],[class="cdate lt-gray"],[class="cdate crmNegativeColor"],[class="sel crmNegativeColor"]'),i=t.length/7,a=Crm.businessJSON.closedDay,r=a.length,n=0;n<r;n++)for(var o=0;o<i;o++){var s=CrmDateUtils.getDayNumber(a[n])-1,l=$(t[s+7*o]);l.removeAttr("onclick"),l.removeClass("lt-gray"),l.addClass("crmNegativeColor")}}},hideNavigationAndPastDays:function(){var e=$L.moment($L.moment().toDate().getTime()+6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE)).toDate(),t=e.getUTCDate(),i=e.getUTCMonth(),a=e.getUTCFullYear(),r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=$("#calenDiv"),o=r[this.currMonth],s=this.currYear,l=n.find(".yearNavLft"),c=n.find(".dLft");(s<=a||s-1===a&&r.indexOf(o)<i)&&l.remove(),(s<a||s===a&&r.indexOf(o)<=i)&&c.remove();var d=n.find('td[class="cdate"],[class="sel"],[class="cdate lt-gray"],[class="cdate crmNegativeColor"],[class="sel crmNegativeColor"],[class="cDate crmCalendarToday"]'),u=d.length;if(s<a&&!r[(i-1+12)%12].startsWith(o)||s===a&&r.indexOf(o)<i-1)for(var m=0;m<u;m++){(p=d.eq(m)).removeAttr("onclick")}if(s===a&&r[i].startsWith(o))for(m=0;m<u;m++){var p=d.eq(m);if(Number(p.text())===t&&!p[0].classList.contains("lt-gray"))break;p.removeAttr("onclick"),p.addClass("lt-gray")}if((s===a||s+1===a)&&r[(i-1+12)%12].startsWith(o))for(m=0;m<u;m++){p=d.eq(m);if(Number(p.text())===t&&m>27&&t<14)break;p.removeAttr("onclick")}if((s===a||s-1===a)&&r[(i+1)%12].startsWith(o)&&t>20)for(m=0;m<6;m++){p=d.eq(m);if(!(Number(p.text())>20&&Number(p.text())<t))break;p.removeAttr("onclick")}}},Search="object"!=typeof Search?{}:Search;function initSkyEyeAutoComplete(e){$(e).autocomplete({appendTo:e.parent(),source:function(e,t){$("#externalCompanyId").val("");var i=new crmRequestPool,a="searchmodule=Accounts&currFldName=Crm_Accounts_ACCOUNTNAME&acVersion=new&srchValue="+encodeURIComponent(e.term);commonUtils.showHideLoadingDiv(!0),i.initiate({action:Crm.getCrmBasePath()+"/FetchBusinessDetails.do",data:a,type:"GET",success:function(e){commonUtils.showHideLoadingDiv(),e&&t(e)}})},delay:750,minLength:2,change:function(e,t){if(t.item){var i=t.item.recInfo;Crm.fillAddressinfo(void 0,i)}},select:function(t,i){$(e).val(i.item.label);var a=new crmRequestPool,r=i.item.companyID;$("#externalCompanyId").val(r);var n="searchmodule=Accounts&acVersion=new&externalSourceId="+r;return commonUtils.showHideLoadingDiv(!0),a.initiate({action:Crm.getCrmBasePath()+"/FetchBusinessDetails.do?"+n,data:{},success:function(e){commonUtils.showHideLoadingDiv(),e?function(e){for(var t in e){var i="Crm_Accounts_"+t,a=$("#"+i);if(a){var r=a.attr("data-content-type"),n=e[t];switch(r){case"Date":case"DateTime":var o=new Date(Number(n)),s=Utils.getDateInUserDatePattern(o);a.val(s);break;case"Pick List":var l=a.data("mapVal");l||(l=a.data("values"));var c="select2-"+i+"-container span";if(n){void 0!==(u=a.attr("data-maxlength"))&&(n=n.slice(0,u));var d=l;d.push(n),a.data("mapVal",d),a.append($("<option>",{value:n,text:n})),a.val(n),$("#"+c).text(n)}else a.val(""),$("#"+c).text(I18n.getMsg("crm.label.picklist.none"));break;default:var u;void 0!==(u=a.attr("data-maxlength"))&&(n=n.slice(0,u)),a.val(n)}}}}(e):crmui.showMsgBand("error",I18n.getMsg("crm.skyeye.setup.msg.error"),4e3)}}),!1},open:function(){var e=$("#Crm_Accounts_ACCOUNTNAME").autocomplete("widget"),t=$("#Crm_Accounts_ACCOUNTNAME").parent(),i=t.offset().left,a=t.outerHeight()+t.offset().top,r=t.outerWidth();e.offset({top:a,left:i}),e.width(r)}}).data("ui-autocomplete")._renderItem=function(e,t){return $("<li class='ui-menu-item'>").append("<div tabindex='-1' class='ui-menu-item-wrapper'>"+t.value+"</div>").appendTo(e)}}Search.init=function(){Search.rowcnt=1,Search.calform="";ResourceConstants.IMAGES.CRM;FingerPrint.isEnabled&&(networkUtils.getCdnUrl(),ResourceConstants.IMAGES.CRM),Search.titleImageSrc=networkUtils.getImageUrl("search.png",ResourceConstants.CRM),Search.titleImageWidth=26,Search.titleImageHeight=31,Search.defaultMatch="all",Search.delImageSrc=networkUtils.getImageUrl("del.gif",ResourceConstants.CRM),Search.calImageSrc=networkUtils.getImageUrl("cal.gif",ResourceConstants.CRM),Search.calAltText="Calendar",Search.spacerImg=networkUtils.getImageUrl("spacer.gif",ResourceConstants.CRM),Search.userDatePattern=Crm.userDetails.DATE_PATTERN,Search._HOURVAL=new Array("01","02","03","04","05","06","07","08","09","10","11","12"),Search._MINUTEVAL=new Array("00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"),Search._AMPMVAL=[["AM",I18n.getMsg("AM")],["PM",I18n.getMsg("PM")]];var e=I18n.getMsg("is"),t=I18n.getMsg("isn't"),i=I18n.getMsg("is empty"),a=I18n.getMsg("is not empty"),r=I18n.getMsg("contains"),n=I18n.getMsg("doesn't contain"),o=I18n.getMsg("crm.filter.email.isblocked"),s=I18n.getMsg("crm.filter.email.isnotblocked");Search._ACTIVITYTYPES=[{html:I18n.getMsg("Tasks"),value:"Tasks"},{html:I18n.getMsg("Calls"),value:"Calls"},{html:I18n.getMsg(Crm.getModuleDisplayName(!1,!0,!0)),value:"Events"}],Search._ACTIVITYCRT=[{html:e,value:"is"},{value:"isn't",html:t}],Search.actCriteria={select:{events:{onchange:function(){Search.changeValue(this,"criteria")}}},option:Search._ACTIVITYCRT,type:"criteria"},Search.params={select:{attr:{class:"multiSel p10",multiple:"",style:"width:350px;","data-placeholder":" "},events:{onchange:function(){Search.changeValue(this,"type")}}},option:Search._ACTIVITYTYPES,multiSelect:"true",type:"type"},Search._MATCH=[["and",I18n.getMsg("crm.label.and")],["or",I18n.getMsg("crm.label.or")]],Search._USERCONDRG=Crm.userDetails.isRolesGroupCriteriaEnabled?[["equal",e],["not_equal",t],["equal_role",I18n.getMsg("crm.condition.belongs.to",I18n.getMsg("crm.role.text"))],["not_equal_role",I18n.getMsg("crm.condition.not.belongs.to",I18n.getMsg("crm.role.text"))]]:[["equal",e],["not_equal",t]],Search._USERCOND=[["is",e],["isn't",t],["is empty",i],["is not empty",a]],Search._MXNCOND=[["is empty",i],["is not empty",a]],Search._LAYOUTCOND=[["is",e],["isn't",t]],Search._WIZARDCOND=[["is",e],["isn't",t]],Search._CONSENTCOND=[["equal",e],["not_equal",t]],Search._TAGCOND=[["is",e],["isn't",t],["is empty",i],["is not empty",a]],Search._CAMPCVCOND=[["is",e],["isn't",t],["is empty",i],["is not empty",a]],Search._TXTCOND=[["None",I18n.getMsg("None")],["is",e],["isn't",t],["contains",r],["doesn't contain",n],["starts with",I18n.getMsg("starts with")],["ends with",I18n.getMsg("ends with")],["is empty",i],["is not empty",a]],Search._ENCTXTCOND=[["is empty",i],["is not empty",a]],Search._PICKLISTCOND=[["None",I18n.getMsg("None")],["is",e],["isn't",t],["is empty",i],["is not empty",a]],Search._CALLSTATUSCOND=[["None",I18n.getMsg("None")],["Scheduled",I18n.getMsg("Scheduled")],["Attended Dialled",I18n.getMsg("Attended Dialled")],["Unattended Dialled",I18n.getMsg("Unattended Dialled")],["Overdue",I18n.getMsg("Overdue")],["Cancelled",I18n.getMsg("Cancelled")],["Received",I18n.getMsg("Received")],["Missed",I18n.getMsg("Missed")]],Search._DATETIMECOND=[["is",e],["isn't",t],["is before",I18n.getMsg("is before")],["is after",I18n.getMsg("is after")],["between",I18n.getMsg("between")],["not between",I18n.getMsg("not between")],["Today",I18n.getMsg("Today")],["Tommorow",I18n.getMsg("Tommorow")],["Tommorow Onwards",I18n.getMsg("Tommorow Onwards")],["Yesterday",I18n.getMsg("Yesterday")],["Till Yesterday",I18n.getMsg("Till Yesterday")],["Last Month",I18n.getMsg("Last Month")],["Current Month",I18n.getMsg("Current Month")],["Next Month",I18n.getMsg("Next Month")],["Last Week",I18n.getMsg("Last Week")],["Current Week",I18n.getMsg("Current Week")],["Next Week",I18n.getMsg("Next Week")],["Last Year",I18n.getMsg("crm.prediction.analytics.filter.year")],["This Year",I18n.getMsg("crm.thisyear")],["Next Year",I18n.getMsg("crm.label.next.year")],["Previous FQ",I18n.getMsg("Previous FQ")],["Current FQ",I18n.getMsg("Current FQ")],["Next FQ",I18n.getMsg("Next FQ")],["Previous FY",I18n.getMsg("Previous FY")],["Current FY",I18n.getMsg("Current FY")],["Next FY",I18n.getMsg("Next FY")],["is empty",i],["is not empty",a],["Age in Days",I18n.getMsg("Age in Days")],["Due in Days",I18n.getMsg("Due in Days")]],Search._MINDATETIMECOND=[["is",e],["isn't",t],["is empty",i],["is not empty",a]],Search._NUMCOND=[["=","="],["!=","!="],["<","<"],["<=","<="],[">",">"],[">=",">="],["between",I18n.getMsg("between")],["not between",I18n.getMsg("not between")],["is empty",i],["is not empty",a]],Search._ENCNUMCOND=[["=","="],["!=","!="],["is empty",i],["is not empty",a]],Search._AGEINDAYSCOND=[["=","="],["!=","!="],["<","<"],["<=","<="],[">",">"],[">=",">="]],Search._BOOLEANCOND=[["is",e]],Search._PROFILECOND=[["is",e],["isn't",t]],Search._ROLECOND=[["is",e],["isn't",t]],Search.andOrMapping={},Search.andOrMapping[I18n.getMsg("and").trim()]="and",Search.andOrMapping[I18n.getMsg("or").trim()]="or",Search._TERRITORYCOND=[["is",e]],Search._DATETIMEFILTERS1=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["0",I18n.getMsg("on")],["7",I18n.getMsg("before")],["5",I18n.getMsg("crm.label.general.small.after")],["14",I18n.getMsg("between")],["${TODAY}",I18n.getMsg("Today")],["${YESTERDAY}",I18n.getMsg("Yesterday")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${LASTMONTH}",I18n.getMsg("Last Month")],["${EMPTY}",I18n.getMsg("crm.condition.till.today")]],Search._DATETIMEFILTERS=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["0",I18n.getMsg("on")],["7",I18n.getMsg("before")],["5",I18n.getMsg("crm.label.general.small.after")],["14",I18n.getMsg("between")],["${TODAY}",I18n.getMsg("Today")],["${YESTERDAY}",I18n.getMsg("Yesterday")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${LASTMONTH}",I18n.getMsg("Last Month")]],Search._DATETIMEFILTERS2=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["0",I18n.getMsg("on")],["7",I18n.getMsg("before")],["5",I18n.getMsg("crm.label.general.small.after")],["14",I18n.getMsg("between")],["${TODAY}",I18n.getMsg("Today")],["${YESTERDAY}",I18n.getMsg("Yesterday")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${LASTMONTH}",I18n.getMsg("Last Month")],["${UNTILNOW}",I18n.getMsg("condition.till.now")]],Search._ACTIVITYFILTERS=[["${TODAY}",I18n.getMsg("Today")],["${TOMORROW}",I18n.getMsg("Tommorow")],["${NEXT7DAYS}",I18n.getMsg("Next 7 Days")],["${TODAYANDOVERDUE}",I18n.getMsg("Today + Overdue"),"default"]],Search._NUMFILTERS=[["0","="],["1","!="],["7","<"],["6","<="],["5",">"],["4",">="],["14",I18n.getMsg("between")],["15",I18n.getMsg("not between")],["${EMPTY}",i],["${NOTEMPTY}",a]],Search._RFMNUMFILTERS=[["0","="],["1","!="],["7","<"],["6","<="],["5",">"],["4",">="],["14",I18n.getMsg("between")],["15",I18n.getMsg("not between")]],Search._ENCNUMFILTERS=[["0","="],["1","!="],["${EMPTY}",i],["${NOTEMPTY}",a]],Search._NUMFILTERS1=[["0","="],["1","!="],["7","<"],["6","<="],["5",">"],["4",">="]],Search._DEALPREFILTER=[["5",">"],["7","<"],["4",">="],["6","<="]],Search.defaultFilters=["${EMPTY}","${NOTEMPTY}","${TODAY}","${TOMORROW}","${NEXT7DAYS}","${TODAYANDOVERDUE}","${YESTERDAY}","${THISWEEK}","${THISMONTH}","${THISYEAR}","${LASTMONTH}","${LASTWEEK}","${CURRENTUSER}","${NEXTMONTH}","${NEXTWEEK}","${TOMORROWPLUS}","${YESTERDAYMINUS}","${UNTILNOW}","${LASTDAYS30}","${LASTDAYS60}","${LASTDAYS90}","${LASTYEAR}","${THISFY}","${THISFQ}","${PREVFY}","${PREVFQ}","${NEXTYEAR}","${NEXTFY}","${NEXTFQ}","${OPEN}","${CLOSEDWON}","${CLOSEDLOST}"],Search._LEADPREFILTER=[["7","<"],["5",">"],["6","<="],["4",">="],["14",I18n.getMsg("between")]],Search._T=[["0",e],["1",t],["2",r],["3",n],["10",I18n.getMsg("starts with")],["11",I18n.getMsg("ends with")],["${EMPTY}",i],["${NOTEMPTY}",a]],Search._BOUNCE=[["${BLOCKED}",o],["${NOTBLOCKED}",s]],Search.bounceDefaultFilters=["${BLOCKED}","${NOTBLOCKED}"],Search._ENCT=[["${EMPTY}",i],["${NOTEMPTY}",a]],Search._CS=[["${Calls.Call Status.Scheduled}",I18n.getMsg("Scheduled")],["${Calls.Call Status.Attended Dialled}",I18n.getMsg("Attended Dialled")],["${Calls.Call Status.Unattended Dialled}",I18n.getMsg("Unattended Dialled")],["${Calls.Call Status.Overdue}",I18n.getMsg("Overdue")],["${Calls.Call Status.Cancelled}",I18n.getMsg("Cancelled")],["${Calls.Call Status.Received}",I18n.getMsg("Received")],["${Calls.Call Status.Missed}",I18n.getMsg("Missed")]],Search._DT=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["Due in Days",I18n.getMsg("crm.zinvoice.dueIn")],["0",I18n.getMsg("on")],["7",I18n.getMsg("before")],["5",I18n.getMsg("crm.label.general.small.after")],["14",I18n.getMsg("between")],["${TODAY}",I18n.getMsg("Today")],["${YESTERDAY}",I18n.getMsg("Yesterday")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${LASTMONTH}",I18n.getMsg("Last Month")],["${EMPTY}",i],["${NOTEMPTY}",a]],Search._MONTHFILTERS=[["${LASTAGEINMONTHS1}",I18n.getMsg("game.month.left")],["${LASTAGEINMONTHS2}",I18n.getMsg("game.months.left",2)],["${LASTAGEINMONTHS3}",I18n.getMsg("game.months.left",3)],["${LASTAGEINMONTHS4}",I18n.getMsg("game.months.left",4)],["${LASTAGEINMONTHS5}",I18n.getMsg("game.months.left",5)],["${LASTAGEINMONTHS6}",I18n.getMsg("game.months.left",6)]],Search._RESTRICTEDDTFILTERS=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${LASTMONTH}",I18n.getMsg("Last Month")]],Search._EMPTYCOND=[["${EMPTY}",i],["${NOTEMPTY}",a]],Search._TRACKINGFILTERS=[["Age in Days",I18n.getMsg("crm.condition.in.last")],["${TODAY}",I18n.getMsg("Today")],["${THISWEEK}",I18n.getMsg("crm.thisweek")],["${THISMONTH}",I18n.getMsg("crm.label.this.month")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${LASTDAYS30}",I18n.getMsg("crm.condition.last.30.days")],["${LASTDAYS60}",I18n.getMsg("crm.condition.last.60.days")],["${LASTDAYS90}",I18n.getMsg("crm.condition.last.90.days")],["${NOTEMPTY}",I18n.getMsg("crm.condition.until.now")]],Search._DEFAULT=[["equal",e],["not_equal",t]],Search._SERVICESTATUSCOND=[["equal",e],["not_equal",t]],Search._TXTCOND1=[["None",I18n.getMsg("None")],["equal",e],["not_equal",t],["contains",r],["not_contains",n],["starts_with",I18n.getMsg("starts with")],["ends_with",I18n.getMsg("ends with")],["No of Characters",I18n.getMsg("crm.criteria.editor.no.of.characters")]],Search._MULTISELECTPICKLISTCOND=[["None",I18n.getMsg("None")],["equal",e],["not_equal",t],["contains",r],["not_contains",n],["starts_with",I18n.getMsg("starts with")],["ends_with",I18n.getMsg("ends with")],["include_all",I18n.getMsg("includes all")],["include_any",I18n.getMsg("include any")],["exclude_all",I18n.getMsg("excludes all")],["exclude_any",I18n.getMsg("exclude any")]],Search._ENCTXTCOND1=[],Search._DATETIMECOND1=[["equal",e],["not_equal",t],["less_than",I18n.getMsg("is before")],["greater_than",I18n.getMsg("is after")],["between",I18n.getMsg("between")],["not_between",I18n.getMsg("not between")],["${TODAY}",I18n.getMsg("Today")],["${TOMORROW}",I18n.getMsg("Tommorow")],["${TOMORROWPLUS}",I18n.getMsg("Tommorow Onwards")],["${YESTERDAY}",I18n.getMsg("Yesterday")],["${YESTERDAYMINUS}",I18n.getMsg("Till Yesterday")],["${LASTMONTH}",I18n.getMsg("Last Month")],["${THISMONTH}",I18n.getMsg("Current Month")],["${NEXTMONTH}",I18n.getMsg("Next Month")],["${LASTWEEK}",I18n.getMsg("Last Week")],["${THISWEEK}",I18n.getMsg("Current Week")],["${NEXTWEEK}",I18n.getMsg("Next Week")],["${LASTYEAR}",I18n.getMsg("crm.prediction.analytics.filter.year")],["${THISYEAR}",I18n.getMsg("crm.thisyear")],["${NEXTYEAR}",I18n.getMsg("crm.label.next.year")],["${PREVFQ}",I18n.getMsg("Previous FQ")],["${THISFQ}",I18n.getMsg("Current FQ")],["${NEXTFQ}",I18n.getMsg("Next FQ")],["${PREVFY}",I18n.getMsg("Previous FY")],["${THISFY}",I18n.getMsg("Current FY")],["${NEXTFY}",I18n.getMsg("Next FY")],["Age in Days",I18n.getMsg("Age in Days")],["Due in Days",I18n.getMsg("Due in Days")]],Search._NUMCOND1=[["equal","="],["not_equal","!="],["less_than","<"],["less_equal","<="],["greater_than",">"],["greater_equal",">="],["between",I18n.getMsg("between")],["not_between",I18n.getMsg("not between")]],Search._AGEINDAYSCOND1=[["equal","="],["not_equal","!="],["less_than","<"],["less_equal","<="],["greater_than",">"],["greater_equal",">="]],Search._AGEINDAYSCOND1=[["equal","="],["not_equal","!="],["less_than","<"],["less_equal","<="],["greater_than",">"],["greater_equal",">="]],Search._SOURCETRACKING=[["BOTH",I18n.getMsg("crm.source.user.and.system")],["EITHER",I18n.getMsg("crm.source.user.or.system")],["USER",I18n.getMsg("User")],["SYSTEM",I18n.getMsg("crm.label.system2")],["USERONLY",I18n.getMsg("crm.source.user.only")],["SYSTEMONLY",I18n.getMsg("crm.source.system.only")]],Search._ENCNUMCOND1=[["equal","="],["not_equal","!="]],Search._PREDEFINED=[["equal",e],["not_equal",t]],Search.typeVsCondMap={picklist:"text",datetime:"date",CML:"defwithempty",ServiceStatus:"servicestatus",U:"user",multiselectpicklist:"text"},Search.fieldTypeVsDataType={textarea:"text",mediumtext:"text",integer:"num",currency:"num",bigint:"num",double:"num",ownerlookup:"U",lookup:"text",website:"text",email:"text",phone:"text",autonumber:"text",multiselectpicklist:"text",longinteger:"num"},Search.isFormRuleCriteria=!1,Search.isVRCriteria=!1,Search.isFromScoringRule=!1,Search.DEFAULTCOND={equal:e,not_equal:t},Search.TXTCOND={None:I18n.getMsg("None"),equal:e,not_equal:t,contains:r,not_contains:n,starts_with:I18n.getMsg("starts with"),ends_with:I18n.getMsg("ends with")},Search.DATETIMECOND={equal:e,not_equal:t,less_than:I18n.getMsg("is before"),greater_than:I18n.getMsg("is after"),between:I18n.getMsg("between"),not_between:I18n.getMsg("not between"),"${TODAY}":I18n.getMsg("Today"),"${TOMORROW}":I18n.getMsg("Tommorow"),"${TOMORROWPLUS}":I18n.getMsg("Tommorow Onwards"),"${YESTERDAY}":I18n.getMsg("Yesterday"),"${YESTERDAYMINUS}":I18n.getMsg("Till Yesterday"),"${LASTMONTH}":I18n.getMsg("Last Month"),"${THISMONTH}":I18n.getMsg("Current Month"),"${NEXTMONTH}":I18n.getMsg("Next Month"),"${LASTWEEK}":I18n.getMsg("Last Week"),"${THISWEEK}":I18n.getMsg("Current Week"),"${NEXTWEEK}":I18n.getMsg("Next Week"),"${LASTYEAR}":I18n.getMsg("crm.prediction.analytics.filter.year"),"${THISYEAR}":I18n.getMsg("crm.thisyear"),"${NEXTYEAR}":I18n.getMsg("crm.label.next.year"),"${PREVFQ}":I18n.getMsg("Previous FQ"),"${THISFQ}":I18n.getMsg("Current FQ"),"${NEXTFQ}":I18n.getMsg("Next FQ"),"${PREVFY}":I18n.getMsg("Previous FY"),"${THISFY}":I18n.getMsg("Current FY"),"${NEXTFY}":I18n.getMsg("Next FY"),"Age in Days":I18n.getMsg("Age in Days"),"Due in Days":I18n.getMsg("Due in Days")},Search.NUMCOND={equal:"=",not_equal:"!=",less_than:"<",less_equal:"<=",greater_than:">",greater_equal:">=",between:I18n.getMsg("between"),not_between:I18n.getMsg("not between")},Search.DATATYPEVSCMPMAP={boolean:Search.DEFAULTCOND,textarea:Search.TXTCOND,picklist:Search.TXTCOND,text:Search.TXTCOND,num:Search.NUMCOND,ownerlookup:Search.DEFAULTCOND,U:Search.DEFAULTCOND,date:Search.DATETIMECOND,datetime:Search.DATETIMECOND,mediumtext:Search.TXTCOND,integer:Search.NUMCOND,currency:Search.NUMCOND,bigint:Search.NUMCOND,double:Search.NUMCOND,lookup:Search.TXTCOND,website:Search.TXTCOND,email:Search.TXTCOND,phone:Search.TXTCOND,autonumber:Search.TXTCOND,multiselectpicklist:Search.TXTCOND,layout:Search.DEFAULTCOND,L:Search.DEFAULTCOND,tag:Search.DEFAULTCOND},Search._STAGECOND=[["None",I18n.getMsg("None")],["equal",e],["not_equal",t],["${OPEN}",I18n.getMsg("is OPEN")],["${CLOSEDWON}",I18n.getMsg("is WON")],["${CLOSEDLOST}",I18n.getMsg("is LOST")],["contains",r],["not_contains",n],["starts_with",I18n.getMsg("starts with")],["ends_with",I18n.getMsg("ends with")]],Search._STAGECOND1=[["None",I18n.getMsg("None")],["is",e],["isn't",t],["is OPEN",I18n.getMsg("is OPEN")],["is WON",I18n.getMsg("is WON")],["is LOST",I18n.getMsg("is LOST")],["contains",r],["doesn't contain",n],["starts with",I18n.getMsg("starts with")],["ends with",I18n.getMsg("ends with")],["is empty",i],["is not empty",a]],Search._STAGECONDFORM=[["None",I18n.getMsg("None")],["is",e],["isn't",t],["is OPEN",I18n.getMsg("is OPEN")],["is WON",I18n.getMsg("is WON")],["is LOST",I18n.getMsg("is LOST")],["is empty",i],["is not empty",a]]},Handlebars.registerHelper("getEntityImgSrc",(function(e,t,i){var a=networkUtils.getImageUrl("user.jpg",ResourceConstants.CRM);return"Contacts"===e||"Leads"===e?validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(i)&&(a=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+e+"&entityId="+t+"&actionName=readImage&fileId="+i):a="",a})),Handlebars.registerHelper("ctiapi_businesscard_entityimage",(function(e,t,i,a){var r=Handlebars.helpers.getEntityImgSrc(e,t,i),n="";return""!==r&&(n='<div class="fL ',n+=1==a?'zchat-propic"':'pR10"',n+='id="ctiapi_businesscard_entityimage"><img src="'+r+'" width="42"></div>'),new Handlebars.SafeString(n)})),Handlebars.registerHelper("ctiapi_businesscard_entityextradetails",(function(e,t,i,a){var r="";return r="Contacts"===e&&validationUtils.isNotEmpty(t)?'<p><a href="javascript:void(0);" class="crmLabelColor ellipsistext dB w250" id="ctiapi_businesscard_entityextradetails" onclick="CTIAPI.openUrl(\''+t+"','"+i+"');\">"+$ESAPI.encoder().encodeForHTML(a)+"</a></p>":'<p><a href="javascript:void(0);" class="crmLabelColor ellipsistext dB w250" id="ctiapi_businesscard_entityextradetails">'+$ESAPI.encoder().encodeForHTML(a)+"</a></p>",new Handlebars.SafeString(r)})),Handlebars.registerHelper("ctiapi_businesscard_entityextradetails_forchat",(function(e,t,i,a){var r;return r='<span id="ctiapi_businesscard_entityextradetails_forchat"> - '+$ESAPI.encoder().encodeForHTML(a)+"</span>",new Handlebars.SafeString(r)})),Handlebars.registerHelper("ctiapi_businesscard_create",(function(e){var t,i="",a=e.isForChat;if(!a){var r=e.useridVsProfileidMap,n=e.moduleVsProfiles,o=n[e.entitymodule][r[void 0!==Crm.userDetails.USER_ID?Crm.userDetails.USER_ID:ctiApiUrlUserId]];t=Object.keys(o)}if(a){i+="<div>",i+='<div class="zchat-msgbox pL15 pR15">',i+='<div class="zchat-msgtitle ellipsis"><span class="subtitle"></span></div>',i+='<div class="zchat-msgcntbdy">',i+='<div class="zchat-msgtble">',i+='<div class="zchat-thmeslabcnt">';for(var s=e.orderedbusinessCard.length,l=0;l<s;l++){var c=(h=e.orderedbusinessCard[l]).labelName,d=h.displayLabelName,u=h.p_moduleName,m=h.uiType;if(i+='<div class="zchat-zcmslble">',i+=$ESAPI.encoder().encodeForHTML(d),i+="</div>",i+='<div class="zchat-zcmsnme">',validationUtils.isNotEmpty(e.businessCard[c]))if("301"!==m||e.forPostingChat)if("3"===m)i+='<div id="setWidthForCallRemDesc" style="width:175px;" class="ellipsistext">'+$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"")+"</div>";else if("24"===m||"202"===m){var p=e.businessCard[c]+"";p=Utils.getDateInUserDatePattern(p,!0),i+=$ESAPI.encoder().encodeForHTML(p+"")}else if("33"===m&&e.iscallallowed&&!(!0===CallReminder.get("outgoingEnable")||window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()))if(Crm.userDetails.ZPBENABLED){var g='asyncFn(crmCallsNew.getClick2CallPromise,"'+e.entityid+'","'+e.entitymodule+'","'+$ESAPI.encoder().encodeForJavaScript(e.entityname)+'")';i+="<div class='pR pR20'><span class='dIB vaM'>"+e.businessCard[c]+"</span><span class='callReminderPH phoneIcon_lv m0'><zpb-phone number='"+e.businessCard[c]+"' module='"+e.entitymodule+"' recordid='"+e.entityid+"' callbackparamfn='"+g+"'></zpb-phone></span></div>"}else i+="<div class='callReminderPH dIB'>"+e.businessCard[c]+"<a class='pH2 ' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+e.businessCard[c]+"?call' onclick='sE();'></a></div>";else i+=$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"");else!0===e.businessCard[c]||"true"===e.businessCard[c]?i+='<span " class="yes" style="display: block; position: absolute;" width="13px" height="12px"><span>':i+="";i+="</div>"}i+="</div></div></div></div></div>"}else{i+='<table cellpadding="0" cellspacing="0" border="0" class="pT10 fixedlayout" width="100%" >';for(s=e.orderedbusinessCard.length,l=0;l<s;l++){var h;c=(h=e.orderedbusinessCard[l]).labelName,d=h.displayLabelName,u=h.p_moduleName,m=h.uiType;if(void 0!==r&&void 0!==n&&-1!==t.indexOf(c)||a){if(i+="<tr>",i+='<td class="crmLabelColor pR15 pT5 crm-small-font-size" valign="top">',i+=$ESAPI.encoder().encodeForHTML(d),i+="</td>",i+='<td class="crmBaseColor pT5 crm-small-font-size ellipsistext" valign="top"><div class="ellipsistext '+(e.forPostingChat?"w300":"")+'">',validationUtils.isNotEmpty(e.businessCard[c]))if("9"===m&&"Vendors"===u){var v=e.businessCard[c],f=v.entityid,C=v.entityName;validationUtils.isNotEmpty(C)&&(i+="<a href='javascript:void(0);' onclick=\"CTIAPI.openUrl('"+f+"','"+u+"')\">"+$ESAPI.encoder().encodeForHTML(C)+"</a>")}else if("301"!==m||e.forPostingChat)if("3"===m)i+='<div id="setWidthForCallRemDesc" style="width:175px;" class="ellipsistext">'+$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"")+"</div>";else if("21"===m){var I="http://",y=e.businessCard[c].toLowerCase().includes("https://")||e.businessCard[c].toLowerCase().includes(I),w=e.businessCard[c];!1===y&&(w=I+w),i+="<a href='"+w+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"")+"</a>"}else if("25"===m)i+="<a href='mailto:"+e.businessCard[c]+"'>"+$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"")+"</a>";else if("33"===m&&e.iscallallowed&&!(!0===CallReminder.get("outgoingEnable")||window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()))if(Crm.userDetails.ZPBENABLED){g='asyncFn(crmCallsNew.getClick2CallPromise,"'+e.entityid+'","'+e.entitymodule+'","'+$ESAPI.encoder().encodeForJavaScript(e.entityname)+'")';i+="<div class='pR pR20'><span class='dIB vaM'>"+e.businessCard[c]+"</span><span class='callReminderPH phoneIcon_lv m0'><zpb-phone number='"+e.businessCard[c]+"' module='"+e.entitymodule+"' recordid='"+e.entityid+"' callbackparamfn='"+g+"'></zpb-phone></span></div>"}else i+="<div class='callReminderPH dIB'>"+e.businessCard[c]+"<a class='pH2 ' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+e.businessCard[c]+"?call' onclick='sE();'></a></div>";else i+=$ESAPI.encoder().encodeForHTML(e.businessCard[c]+"");else!0===e.businessCard[c]||"true"===e.businessCard[c]?i+='<span " class="yes" style="display: block; position: absolute;" width="13px" height="12px"><span>':i+="";i+="</div></td>",i+="</tr>"}}i+="</table>"}return new Handlebars.SafeString(i)})),Handlebars.registerHelper("ctiapi_singlepotential_create",(function(e){var t="",i=e.potentials.potential1,a=e.useridVsProfileidMap,r=e.moduleVsProfiles,n=void 0!==a,o=void 0!==r,s=r.Potentials[a[void 0!==Crm.userDetails.USER_ID?Crm.userDetails.USER_ID:ctiApiUrlUserId]],l=Object.keys(s);t+='<table cellpadding="0" cellspacing="0" border="0" class="pT5">';for(var c=i.orderedbusinessCard.length,d=0;d<c;d++){var u=i.orderedbusinessCard[d],m=u.labelName,p=u.displayLabelName,g=u.p_moduleName,h=u.uiType;if(n&&o&&-1!==l.indexOf(m)){if(t+="<tr>",t+='<td class="crmLabelColor pR15 pT5 crm-small-font-size" valign="top">',t+=$ESAPI.encoder().encodeForHTML(p),t+="</td>",t+='<td class="crmBaseColor pT5 crm-small-font-size ellipsistext" valign="top"><div class="ellipsistext">',validationUtils.isNotEmpty(i.businessCard[m]))if("4"!==h&&"13"!==h&&"5"!==h||"Contacts"!==g&&"Accounts"!==g&&"Campaigns"!==g)if("21"===h){var v="http://",f=i.businessCard[m].toLowerCase().includes("https://")||i.businessCard[m].toLowerCase().includes(v),C=i.businessCard[m];!1===f&&(C=v+C),t+="<a href='"+C+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(i.businessCard[m]+"")+"</a>"}else t+="25"===h?"<a href='mailto:"+i.businessCard[m]+"'>"+$ESAPI.encoder().encodeForHTML(i.businessCard[m]+"")+"</a>":$ESAPI.encoder().encodeForHTML(i.businessCard[m]+"");else{var I=i.businessCard[m],y=I.entityid,w=I.entityName;validationUtils.isNotEmpty(w)&&(t+="<a href='javascript:void(0);' onclick=\"CTIAPI.openUrl('"+y+"','"+g+"')\">"+$ESAPI.encoder().encodeForHTML(w)+"</a>")}t+="</div></td>",t+="</tr>"}}return t+="</table>",new Handlebars.SafeString(t)})),Handlebars.registerHelper("ctiapi_singlepotential",(function(e){return new Handlebars.SafeString(Handlebars.templates.ctiapi_businesscard_single_potential(e))})),Handlebars.registerHelper("ctiapi_businesscard_multi_potential_tablebody",(function(e){return new Handlebars.SafeString(Handlebars.templates.ctiapi_businesscard_multi_potential_tablebody(e))})),Handlebars.registerHelper("ctiapi_businesscard",(function(e){return new Handlebars.SafeString(Handlebars.templates.ctiapi_businesscard(e))})),Handlebars.registerHelper("ctiapi_dialpad_keypad",(function(e){for(var t=[1,2,3,4,5,6,7,8,9,"*",0,"#"],i="",a=t.length,r=0;r<a;r++)i+=e.fn(t[r]);return i})),Handlebars.registerHelper("ctiapi_calltransfer_to_repslistview",(function(e){return Handlebars.templates.ctiapi_calltransfer_to_repslistview(e)})),Handlebars.registerHelper("ctiapi_calldesc_div_create",(function(e){var t="",i=e.moduleVsProfiles,a=e.useridVsProfileidMap,r=i.Calls[a[void 0!==Crm.userDetails.USER_ID?Crm.userDetails.USER_ID:ctiApiUrlUserId]];t='<div id="ctiapi_calldesc_div" class="clearFix" style="display:none;">';return-1!=Object.keys(r).indexOf("Description")&&(t+='<textarea class="w100_per p10 h70 fL borderLeftNone boxBB" id="ctiapi_calldesc" placeholder="'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callnotes")+'" onkeyup="ctiApiNotifier.new_editDesc(this.value);ctiApiNotifier.descTextAreaAdjust(this)"></textarea><div class="svgIcons callrResizeIcon dIB bg_white"></div>'),t+="</div>",new Handlebars.SafeString(t)})),Handlebars.registerHelper("ctiapi_businesscard_potential_count_multiple",(function(e){var t=moduleRecordMapping.Potentials.plural_label,i="("+e+")",a=I18n.getMsg("crm.right.open.module",t+" "+i);return new Handlebars.SafeString(a)})),Handlebars.registerHelper("ctiapi_pass_multipotential",(function(e){return JSON.stringify(e)})),Handlebars.registerHelper("ctiapi_businesscard_potential_count_single",(function(){var e=moduleRecordMapping.Potentials.singular_label,t=I18n.getMsg("crm.right.open.module",e);return new Handlebars.SafeString(t)})),Handlebars.registerHelper("getFormatedName",(function(e,t){return CTIAPI.getFormatedName(e,t)})),Handlebars.registerHelper("ifSingleNo",(function(e,t){return 1===Object.keys(e.phoneNo).length?t.fn(e):($("#businessView").closest("td").css("width","150px"),t.inverse(e))})),Handlebars.registerHelper("getWidth",(function(e){return e&&e.phoneNo&&Object.keys(e.phoneNo).length>1?new Handlebars.SafeString("width:150px;"):new Handlebars.SafeString("width:140px;")})),Handlebars.registerHelper("getPhoneFiled",(function(e){for(var t in e)if(e.hasOwnProperty(t))return e[t];return""})),Handlebars.registerHelper("getActivityId",(function(e){return!e.callStatus||e.callStatus.toUpperCase()!=="scheduled".toUpperCase()&&e.callStatus.toUpperCase()!=="overdue".toUpperCase()?"":e.entityid})),Handlebars.registerHelper("getActivityIdCallBack",(function(e){if(!e.callStatus||e.callStatus.toUpperCase()!=="scheduled".toUpperCase()&&e.callStatus.toUpperCase()!=="overdue".toUpperCase())return"";var t={};return t.callActivityId=e.entityid,JSON.stringify(t)})),Handlebars.registerHelper("getEnableValue",(function(e,t){return"type3"==t?I18n.getMsg("crm.button.enable"):"type4"===t?e?I18n.getMsg("crm.phonebridge.provider.getitnow"):I18n.getMsg("crm.phonebridge.provider.comingsoon"):I18n.getMsg("crm.button.enable")})),Handlebars.registerHelper("getClickFn",(function(e,t,i,a){return"AWSLily"===i?"ctiApiConfig.enableLily()":"type4"===t||"type2"===t?a?'window.open("'+e+'")':'CTIAPI.sendEmail("'+i+'")':"widget"===t?'window.open("'+e+'")':void 0})),Handlebars.registerHelper("isVideoAvail",(function(e,t){for(var i in e)if(e.hasOwnProperty(i)&&validationUtils.isNotEmpty(e[i])&&-1===e[i].indexOf(".jpg")&&-1===e[i].indexOf(".png"))return t.fn(e[i]);return null})),Handlebars.registerHelper("iterImage",(function(e,t){var i="";return Object.keys(e).forEach((function(a,r){!validationUtils.isNotEmpty(e[r])||-1===e[r].indexOf(".jpg")&&-1===e[r].indexOf(".png")||(i+=t.fn(e[r]))})),i})),Handlebars.registerHelper("isBetaAccessProvider",(function(e){return e&&"*"===e.trim()?"openAccess":"betaAccess"})),Handlebars.registerHelper("getModFromMap",(function(e){var t=e.slice(0,e.length-1);return moduleRecordMapping[e].singular_label!==t?moduleRecordMapping[e].singular_label:I18n.getMsg(t)})),Handlebars.registerHelper("getDisableFunc",(function(e,t,i){var a="";switch(e){case"type3":"AWSLily"===t&&(a="ctiApiConfig.disableLily()");break;case"type4":a="crmui.showPopup('revokePop');";break;case"widget":a='window.open("'+i+'")'}return a}));var Browser={zuid:void 0,getBrowserDetails:function(){var e,t=navigator.userAgent,i=t.match(/(opera|crios|chrome|safari|firefox|msie|FxiOS|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"msie",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:(/crios/i.test(i[1])&&(i[1]="Chrome"),/fxios/i.test(i[1])&&(i[1]="Firefox"),"Chrome"===i[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{name:"opera",version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),{name:i[0],version:i[1]}))},supportedVersion:{chrome:49,firefox:44,msie:11,safari:9,opera:45},checkVersion:function(){var e=this.getBrowserDetails();e.name.toLowerCase(),e.version}};$(document).ready((function(){Browser.checkVersion()})),$(window).unload((function(){CTIAPI.documentUnload()})),$(window).on("beforeunload",(function(){CTIAPI.documentBeforeunload()}));var qCreateCall={createUrl:Crm.getCrmBasePath()+"/QCreate.do",formData:null,entityId:null,entityModule:null,relId:null,relModule:null,desc:null,formOrder:{"Who Id":1,Subject:2,"Call Purpose":3,"What Id":4,"Call Type":5,"Call Start Time":6,"Call Duration":7,Description:8,"Call Result":9,Billable:10,"Call Owner":11,"Created By":12,"Modified By":13,getOrder:function(e){return this[e]?this[e]:-1},putElemInOrder:function(e){var t=this.getNextMaxElem(e);if(null!==t)t.before(e);else{var i=this.getLastElem(e,"left"),a=i.data()?i.data().order:0,r=this.getLastElem(e,"right");a>(r.data()?r.data().order:0)?i.after(e):r.after(e)}},getLastElem:function(e,t){return $("#sectioncontainerholder .ui-layout-"+t+" .liHolder").find("li:last")},getNextMaxElem:function(e){var t=e.data("order");if(t<=0)return null;var i=null;return $("ul.sortAllowed").find("li").each((function(){var e=$(this).data("order");e>t&&(null===i||e<i.data("order"))&&(i=$(this))})),i}},createQCForm:function(e,t,i,a,r,n){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else if(isNewCallView)Crm.globalCreate(e,t,i,a,r,n);else{var o={module:"Calls",recordNum:"1",fromCreate:"QuickCreate"};Q.url=this.createUrl,Q.anchor=null,Q.operation="NewCall",Q.callFrom="global",Q.formName="qCreate",networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({action:this.createUrl,cache:!1,type:"POST",data:o,success:function(e){Q.loadResponse(e),$(".Crm_Calls_ISCALLBILLABLE").closest("div").remove()}}),"onboardSchedule"===t&&$("#whichCall3").click()}},get paramFormData(){return localStorage.getItem("callsFormData")},set paramFormData(e){localStorage.setItem("callsFormData",e)},get entityIdVal(){return this.entityId?this.entityId:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").entityId:null},get entityModuleVal(){return this.entityModule?this.entityModule:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").entityModule:null},get relModuleVal(){return this.relModule?this.relModule:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").relModule:null},get callDescVal(){return this.desc?this.desc:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").desc:null},setCallDetails:function(e,t,i,a,r){this.entityId=e,this.entityModule=validationUtils.isEmpty(e)?null:t,this.relId=i,this.relModule=validationUtils.isEmpty(i)?null:a,this.desc=r;var n={entityId:e,entityModule:t,relId:i,relModule:a,desc:r};SalesSignalsWrapper.isSignalIFrameOpen?localStorage.setItem("callDetails",n):localStorage.setObject("callDetails",n)},openCallPopup:function(e,t){if(t=t||quickCreateValidateAction("All","Calls",e.name)){if($("#startCurrCall").prop("disabled",!0).css("opacity","0.7"),Crm.userDetails.LITE.IS_LITE_USER)return;if(validationUtils.isNotEmpty(this.paramFormData)&&"quickCreate"===$("#popupFrom").val()&&"callhungup"===CTIAPI.get("callState")){this.saveCall(null,(function(){qCreateCall.openCallPopup(e,!0)})),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&hideMenu()}else{this.paramFormData=this.getFormData(e);var i=$(getElm(e.name,"property(Description)")).val();i=i||"";var a=$(getElm(e.name,"leContModId")).val(),r=$(getElm(e.name,"leContModSel")).val(),n=$(getElm(e.name,"modid")).val(),o=$(getElm(e.name,"modsel")).val();validationUtils.isEmpty(a)&&(a=n,r=o,n=null,o=null),this.setCallDetails(a,r,n,o,i),Q.close(),networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){qCreateCall.getPopup("calldialed")}))}1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(hideMenu(),detailView.hideDetailviewMenu(!0))}},getFormData:function(e){var t=commonUtils.formData2QueryString(e);return t="module=Calls&property(module)=Calls&viewType=callQC&"+(t+="&ajax=true")},getPopup:function(e){var t={mode:"callFromQC",callState:e,recordId:this.entityIdVal,recModule:this.entityModuleVal,tabid:ctiApiNotifier.tabid};networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:t,success:function(t){WebMessanger.systemdown&&ctiApiNotifier.ctiApiNotification(t),"callhungup"===e&&qCreateCall.updateCallDuration()}});var i=localStorage.getObject("crm-presentCallDetails");if(i){var a=e;if("callhungup"===e){var r=(new Date).getTime()-CTIAPI.CallTimer.callStartedTimeInMilliSeconds;r/=1e3,a=a+"_"+(r=Math.floor(r))}i.qcStatus=a,localStorage.setObject("crm-presentCallDetails",i)}},saveCall:function(e,t){qCreateCall.updateFormData(e);ctiApiNotifier.saveCalls(this.paramFormData,!0,this.getEntityInView(),(function(){t(),qCreateCall.destroy()}))},rejectCall:function(){isNewCallView?ctiApiNotifier.saveCallEntity(!1):(qCreateCall.updateFormData(),this.saveCall(null,ctiApiNotifier.closeNotify))},updateCallDuration:function(){var e=$("#ctiapi_calltimer_min").text(),t=$("#ctiapi_calltimer_sec").text(),i={"property(DurationInMinute)":e,"property(DurationInSecond)":t,"property(Call%20Duration)":e+encodeURIComponent(":")+t};this.paramFormData=CTIAPI.updateQueryParams(this.paramFormData,i)},updateFormData:function(e){var t="";2!==e&&3!==e&&(t=(t=$("#ctiapi_calldesc").val())||qCreateCall.callDescVal);var i={"property(Description)":encodeURIComponent(t)};if(ctiApiNotifier.isUnknownConverted()){var a=ctiApiNotifier.getCreatedOrAssocEntity();a&&(i["property(leContModSel)"]=a.entityModule,i["property(leContModName)"]=a.entityName,i["property(leContModId)"]=a.entityId,"Contacts"===a.entityModule&&a.relatedId&&(i["property(modsel)"]=a.relatedModule,i["property(modname)"]=a.relatedName,i["property(modid)"]=a.relatedId))}this.paramFormData=CTIAPI.updateQueryParams(this.paramFormData,i)},showOrHideCallFields:function(e){$("form[name='"+e+"'] #whichCall1").is(":checked")?($(getElm(e,"saveCall")).hide(),$(getElm(e,"startCurrCall")).show(),$(getElm(e,"selMoreFields")).addClass("dN")):($(getElm(e,"saveCall")).show(),$(getElm(e,"startCurrCall")).hide(),$(getElm(e,"selMoreFields")).removeClass("dN"))},isEntityAssociated:function(e,t){var i=$("#leContModName");if(0!==i.length&&""===i.val()){var a=-1===$("form[name='"+e+"']").get(0).action.indexOf("QuickCreate")?"crm.call.callto.empty.check":"CurrentCall"===t?"crm.call.callto.empty.check.qcreate.current":"crm.call.callto.empty.check.qcreate";return CTIAPI.customCtiApiConfirm(I18n.getMsg(a)),!1}return!0},destroy:function(){this.paramFormData=null,this.entityId=null,this.entityModule=null,this.desc=null,localStorage.setObject("callDetails",null)},getEntityInView:function(){var e=Crm.userDetails.isRelatedListLyteEnabled?Lyte.Globals.get("relatedList.entityId"):crmRelatedList.EntityId,t=crmHistory.getState();return-1===(t.url?t.url:"").indexOf(e)?null:(ctiApiNotifier.isUnknownConverted()&&this.setUnknownConvertedDetails(),this.entityId===e||this.relId===e?e:null)},setUnknownConvertedDetails:function(){var e=ctiApiNotifier.getCreatedOrAssocEntity();e&&e.length&&(this.entityId=e.entityId,this.entityModule=e.entityModule,this.relId=e.relatedId,this.relModule=e.relatedModule)},onCallTypeChange:function(e){var t=$(e).closest("form").get("0").name,i=$("form[name='"+t+"']");if(i.find("#whichCall2").is(":checked")){var a=i.find("#Crm_Calls_CALLTYPE"),r=i.find("input[name='property(Call Duration)']").parent();"Missed"===a.children("option:selected").attr("actualvalue")?(i.find("input[name='property(DurationInMinute)']").val(""),i.find("input[name='property(DurationInSecond)']").val(""),r.css("display","none").parent().css("display","none")):r.css("display","inline-block").parent().css("display","inline-block")}}},CTIAPI={entitycreationresponse:{},zpbRecDetails:{},zpbCallback:{listeners:[],succListeners:[]},isClientTabinitialised:!1,cti_obj:{debug:!1},CTI:{ctiname:""},set obj(e){for(var t in e)this.put(t,e[t])},get:function(e){var t=this.cti_obj;if(void 0!==e)return t[e]},put:function(e,t){this.cti_obj[e]=t},remove:function(e){return!!this.has(e)&&(delete this.cti_obj[e],!0)},has:function(e){return this.cti_obj.hasOwnProperty(e)},keys:function(){var e=this.cti_obj;return Object.keys(e)},updateDisplayStatusInClientStorage:function(e,t){var i=localStorage.getObject("crm-presentCallDetails");i?e===i.callRefId&&(i.displayStatus=t,localStorage.setObject("crm-presentCallDetails",i)):validationUtils.isNotEmpty(e)&&CTIAPI.storeInClientStorage(e,"PhoneBridge",0,0,t,null,Date.now())},updateAnsweredTimeInClientStorage:function(e,t){var i=localStorage.getObject("crm-presentCallDetails");!i||""!==e&&e!==i.callRefId||(i.answeredTimeMillis=t,i.displayStatus="",localStorage.setObject("crm-presentCallDetails",i))},updatePausedTimeInClientStorage:function(e,t){var i=localStorage.getObject("crm-presentCallDetails");!i||""!==e&&e!==i.callRefId||(i.pausedTimeInMillis=t,i.displayStatus="",localStorage.setObject("crm-presentCallDetails",i))},storeInClientStorage:function(e,t,i,a,r,n,o,s,l){var c={callRefId:e,callId:l,callSource:t=t||"PhoneBridge",answeredTimeMillis:i=i||0,pausedTimeInMillis:a,displayStatus:r=r||"crm.tpi.ctiapi.calling",qcStatus:n=n||"calldialed",callStartTime:o,isAnswerable:s};localStorage.setObject("crm-presentCallDetails",c)},removeClientStorage:function(e){var t=localStorage.getObject("crm-presentCallDetails");Crm.isHeadless||!t||""!==e&&e!==t.callRefId&&e!==t.callId||(localStorage.removeItem("crm-presentCallDetails"),isNewCallView&&localStorage.removeItem("callDetails"))},showCurrentCallPopup:function(){var e=localStorage.getObject("crm-presentCallDetails");if(validationUtils.isEmpty(e))return!1;if(Date.now()-e.callStartTime>36e5)return CTIAPI.removeClientStorage(""),!1;var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={mode:"getNotificationDetails",callrefid:e.callRefId,callSource:e.callSource,ctiname:CTIAPI.CTI.ctiname,ctiapitype:CTIAPI.CTI.ctitype};if("quickCreate"===e.callSource){if(!localStorage.getObject("callDetails")||!e.qcStatus)return CTIAPI.removeClientStorage(""),!1;i={mode:"getNotificationDetails",callState:e.qcStatus,callId:e.callId,callSource:e.callSource,recordId:localStorage.getObject("callDetails").entityId,recModule:localStorage.getObject("callDetails").entityModule}}(new crmRequestPool).initiate({action:t,cache:!1,type:"GET",data:i,success:function(t){if(!validationUtils.isNotEmpty(t))return CTIAPI.removeClientStorage(""),!1;var i="",a="";localStorage.CTIAPI&&JSON.parse(localStorage.CTIAPI).call_desc&&(i=JSON.parse(localStorage.CTIAPI).call_desc),localStorage.getObject("crm-presentCallDetails")&&localStorage.getObject("crm-presentCallDetails").callStartTime&&(a=localStorage.getObject("crm-presentCallDetails").callStartTime),t.i18nCallState="CallingAgent"===e.displayStatus?I18n.getMsg("crm.tpi.ctiapi.calling.user",Crm.userDetails.DISPLAY_NAME):I18n.getMsg("crm.tpi.ctiapi.calling"),t.agentnumber=localStorage.getItem("login-username"),t.qcStatus=e.qcStatus,t.callStartTime=a;var r=[networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],ResourceConstants.CRM),networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","crux-lookupfilter-component.js","crux-column-list.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient)];Lyte.injectResources(r,void 0,(function(){(ctiApiNotifier.setAllowedOperationKeys(t),t.isAnswerable=e.isAnswerable,ctiApiNotifier.showCallNotification(t),CTIAPI.put("callrefid",e.callRefId),CTIAPI.put("ctiname",CTIAPI.CTI.ctiname),"quickCreate"!==t.source)&&("Ringing"===t.presentState&&"outbound"===t.calltype&&"type4"===CTIAPI.CTI.ctitype?$("#ctiapi_call_endcall_button").show():"AWSlily"===CTIAPI.CTI.ctiname&&"Ringing"===t.presentState&&"inbound"===t.calltype&&$("#ctiapi_call_endcall_button").hide(),"twilio"===CTIAPI.CTI.ctiname&&(twilioNotifier.isBrowserMode()&&$("#ctiapi_twilio_call_ctrl_bts").show(),"inRinging"==CTIAPI.get("twiCurrentStatus")&&"true"==$("#ctinotifier").attr("is")&&twilioCallDetails.hasOwnProperty(e.callRefId)&&"ringing"==twilioCallDetails[e.callRefId].status?$("#ctiapi_inboundcall_answer_button").show():$("#ctiapi_inboundcall_answer_button").hide()));if("Answering"===t.presentState){var a=e.answeredTimeMillis,r=e.pausedTimeInMillis;if(r&&r>a){var n=parseInt(r-a),o=Math.floor(n/1e3);ctiApiNotifier.new_startTimer(a,r),ctiApiNotifier.holdNotify(),ctiApiNotifier.new_updateNotificationDuration(o)}else ctiApiNotifier.new_startTimer(a);"AWSlily"===CTIAPI.CTI.ctiname&&(lilyCallDetails[e.callRefId]={},lilyCallDetails[e.callRefId].callConnectedTime=a)}else"AfterCallWork"===t.presentState&&(CTIAPI.put("callState","quickCreate"===e.callSource?"callhungup":"completed"),$("#ctiapi_calldesc").text(i),ctiApiNotifier.new_updateNotificationDuration(t.callDuration),ctiApiNotifier.new_endCall());if(isNewCallView){$("#ctinotifier").attr("is","false").hide();var s={id:t.callRefID||t.callId,tabId:clienttab.browserTabId};WindowsCommunicator.notifyOtherTabs("get-call-back-param",s)}}))}})},IFrame:{Origin:void 0,sendMessagetoParent:function(e){if(null==this.Origin){var t=new URL(window.location.href).searchParams.get("frameorigin");this.Origin=t.split(",")[0]}window.parent.postMessage(e,this.Origin)},backToProviderList:function(){this.sendMessagetoParent({from:"DetailPage",to:"ListingPage"})}},Windows:{Lead:void 0,Contact:void 0,leadIntervalID:void 0,contactIntervalID:void 0,windowInfo:void 0,set changeWindowInfo(e){this.windowInfo=e},set leadInterval(e){this.leadIntervalID=e},set contactInterval(e){this.contactIntervalID=e},set childLead(e){this.Lead=e},set childContact(e){this.Contact=e},removeChildLead:function(){this.Lead&&(this.Lead.close(),this.Lead=null),this.leadIntervalID=void 0},removeChildContact:function(){this.Contact&&(this.Contact.close(),this.Contact=null),this.contactIntervalID=void 0}},LocalStorage:{hasStorage:!0,tempStorage:{},get cti_obj(){var e=localStorage.CTIAPI;return void 0===e?this.tempStorage:JSON.parse(e)},set CTIAPI(e){this.hasStorage?localStorage.CTIAPI=JSON.stringify(e):this.tempStorage=e},get:function(e){var t=this.cti_obj;if(void 0!==e)return t[e]},put:function(e,t){var i=this.cti_obj;i[e]=t,this.CTIAPI=i},remove:function(e){if(this.has(e)){var t=this.cti_obj;return delete t[e],this.CTIAPI=t,!0}return!1},has:function(e){return this.cti_obj.hasOwnProperty(e)},keys:function(){var e=this.cti_obj;return Object.keys(e)},reset:function(){var e=localStorage.CTIAPI;try{void 0!==e&&"undefined"!==e||(this.CTIAPI=this.cti_obj)}catch(e){this.hasStorage=!1}Object.freeze(this)}},CallTimer:{Minute:0,Second:0,TimerID:0,timerRun:!1,callStartedTimeInMilliSeconds:0,callPausedTimeInMilliSeconds:0,start:function(e,t,i,a){0===this.TimerID&&!1===this.timerRun&&(this.callStartedTimeInMilliSeconds=i||(new Date).getTime(),this.callPausedTimeInMilliSeconds=a||this.callPausedTimeInMilliSeconds,this.TimerID=setInterval(e,t),this.timerRun=!0)},increment:function(){this.setCurrentMinAndSecForTimer(),this.timerRun=!0},reset:function(){clearInterval(this.TimerID),this.callStartedTimeInMilliSeconds=this.callPausedTimeInMilliSeconds=this.Minute=this.Second=this.TimerID=0,this.timerRun=!1},pause:function(){0===this.callPausedTimeInMilliSeconds&&(this.callPausedTimeInMilliSeconds=(new Date).getTime()),clearInterval(this.TimerID),this.timerRun=!1},resume:function(e,t){if(0!==this.callPausedTimeInMilliSeconds&&!1===this.timerRun){var i=(new Date).getTime(),a=this.callPausedTimeInMilliSeconds-this.callStartedTimeInMilliSeconds;this.callStartedTimeInMilliSeconds=i-a,this.TimerID=setInterval(e,t),this.callPausedTimeInMilliSeconds=0,this.timerRun=!0}else 0===this.TimerID&&!1===this.timerRun&&(this.TimerID=setInterval(e,t))},toggleTimerRun:function(e,t,i){this.timerRun?(this.pause(),$(e).attr("title",I18n.getMsg("crm.button.start.call"))):(this.resume(t,i),$(e).attr("title",I18n.getMsg("crm.button.pause.call")))},getTotalSeconds:function(){return 60*this.Minute+this.Second},setCurrentMinAndSecForTimer:function(){var e=(new Date).getTime();if(0!==this.callStartedTimeInMilliSeconds){var t=e-this.callStartedTimeInMilliSeconds,i=Utils.getMillisecondsToBasicDateProperties(t);this.Minute=i.hours>0?i.mins+60*i.hours:i.mins,this.Second=i.secs}}},DisplayCallTimer:function(){CTIAPI.CallTimer.increment();var e=$("#ctiapi_calltimer_min");void 0!==e?(e.html((CTIAPI.CallTimer.Minute<=9?"0":"")+CTIAPI.CallTimer.Minute),$("#ctiapi_calltimer_sec").html((CTIAPI.CallTimer.Second<=9?"0":"")+CTIAPI.CallTimer.Second)):CTIAPI.CallTimer.reset()},audioControl:{gainNode:null,play:function(){context.createGain||(context.createGain=context.createGainNode),this.gainNode=context.createGain();var e=context.createBufferSource();e.buffer=audioLoader.loadedBuffer,e.connect(this.gainNode),this.gainNode.connect(context.destination),e.loop=!0,e.start||(e.start=e.noteOn),e.start(0),this.source=e},stop:function(){this.source.stop||(this.source.stop=source.noteOff),this.source.stop(0)},toggle:function(){this.playing?this.stop():this.play(),this.playing=!this.playing},changeVolume:function(e){var t=parseInt(e.value)/parseInt(e.max);this.gainNode.gain.value=t*t},toggleAudio:function(){this.isMuted?this.unMute():this.mute(),this.isMuted=!this.isMuted},mute:function(){audioControl.previousGain=this.gainNode.gain.value,this.gainNode.gain.value=0},unMute:function(){this.gainNode.gain.value=audioControl.previousGain}},audioLoader:{loadedBuffer:null,init:function(e,t,i){window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=new AudioContext;$("#downloadAudio").attr({href:e,download:"MyName.mp3"}),this.loadBuffer(a,e,t,i)},loadBuffer:function(e,t,i,a){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){e.decodeAudioData(r.response,(function(e){audioLoader.loadedBuffer=e}))},a?(r.setRequestHeader("authtoken",i),r.send()):r.send("authtoken="+i)}},tabCountIncrease:function(){var e=CTIAPI.LocalStorage.get("noOfTabs");e=void 0!==e&&e>0?e:0,e+=1,CTIAPI.LocalStorage.put("noOfTabs",e),CTIAPI.tabCountIncrease=null},tabVisibilityStateChange:function(){$("#ctiapi_calldesc").val(CTIAPI.LocalStorage.has("call_desc")?CTIAPI.LocalStorage.get("call_desc"):""),CTIAPI.decideShowHide_CloseBT(),networkUtils.loadFeatureScripts(["zohocrm_callReminder.js"],(function(){updateRemindersTime()}))},getCtiNotifier:function(){return $("#ctinotifier").clone()},showaudiourl:function(){$("#audiourl").show()},tabInitialise:function(){try{if(navigator.userAgent.indexOf("Firefox")>-1?clienttab.ismaster=!0:clienttab.tabinitializer(),!clienttab.ismaster&&"inbound"==localStorage.getItem("incall")){var e=$("#callrefid").val();"inRinging"==CTIAPI.get("twiCurrentStatus")&&"true"==$("#ctinotifier").attr("is")&&twilioCallDetails.hasOwnProperty(e)&&"ringing"==twilioCallDetails[e].status&&$("#ctiapi_twilio_call_ctrl_bts").show()}}catch(e){murphy.error(e)}finally{CTIAPI.isClientTabinitialised=!0}},documentReady:function(){try{if(Lyte.addEventListener("crm-quick-create",(function(e){e.messageType="crm-quick-create",notifyParentWindow(e)})),Lyte.addEventListener("crm-associate-search",(function(e){e.messageType="crm-associate-search",notifyParentWindow(e)})),CTIAPI.isClientTabinitialised||CTIAPI.tabInitialise(),isNewCallView&&(crmTemplate.arrayNewClass=["Events","Tasks"]),!window.performance||"1"!==window.top.performance.navigation.type&&1!==window.top.performance.navigation.type){if(!Crm.isHeadless){var e=CTIAPI.showCurrentCallPopup();if((!1===e||"false"===e)&&isConfiguredUser("twilio")){var t=twilioConfigDetails.currentStatus;"5"===t&&(t=1,ctiApiNotifier.ctiapiUpdateUserStatus(t,5,"twilio")),"7"===t&&(t=3,ctiApiNotifier.ctiapiUpdateUserStatus(t,7,"twilio")),TwilioConf.twilioUpdateUserStatus(t)}}}else CTIAPI.removeClientStorage(""),CTIAPI.CTI.ctiname&&ctiApiNotifier.logMessage("Refreshed",localStorage.getObject("crm-presentCallDetails"))}catch(e){murphy.error(e)}},pot_calcInverse:function(e,t){return e-t},documentUnload:function(){var e=CTIAPI.LocalStorage.get("noOfTabs");e=void 0!==e&&e>0?e:1,e-=1,CTIAPI.LocalStorage.put("noOfTabs",e)},documentBeforeunload:function(){var e=CTIAPI.get("ctiname"),t=CTIAPI.get("callState"),i=CTIAPI.LocalStorage.get("noOfTabs"),a="true"===$("#call_desc_mandatory").val(),r=validationUtils.isEmpty($("#ctiapi_calldesc").val()),n=$("#ctinotifier");if("twilio"===e){var o=twiOutgoingConn;if(Object.keys(twiIncomingConn).length>0&&(o=twiIncomingConn),""!==n.html()&&"completed"===t&&1===i||("in-progress"===t||"ringing"===t)&&validationUtils.isNotEmpty(o)&&"open"===o.status())return"completed"===t?a?r?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc.empty"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete"):a?r?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress.man.desc.empty"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress")}else if("phonebridge"!==e&&""!==n.html()&&("callhungup"===t||"callended"===t)&&1===i||"callanswered"===t&&1===i)return a?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete")},chatBarCheck:function(){var e=$("#ctinotifier"),t=$("#wmstoolbar"),i=t.is(":visible"),a=t.height();i?(e.css({bottom:a+"px"}),$("#ctireminder").css({bottom:a+"px"}),$("#ctiapi_multireminder_bussinessview").css({bottom:a+"px"})):(e.css({bottom:"0px"}),$("#ctireminder").css({bottom:"0px"}),$("#ctiapi_multireminder_bussinessview").css({bottom:"0px"}))},keypadShowHide:function(){var e=$("#ctiapi_dialpad_keypad");e.is(":visible")?(e.hide(),$("#ctiapi_dialpad_bt_keypad").removeClass("active"),$("#ctiapi_businesscard,#ctiapi_calldesc_div").show()):($("#ctiapi_businesscard,#ctiapi_calldesc_div").hide(),e.show(),$("#ctiapi_dialpad_bt_keypad").addClass("active"),renderingUtils.setEndToInputBox($("#ctiapi_dialpad_keypad_numbers").val("")))},keypadClick:function(e){CTIAPI.removeNotRequiredKeypadKeys(e),CTIAPI.ctiapiSendDigits(e)},removeNotRequiredKeypadKeys:function(e){var t=$("#ctiapi_dialpad_keypad_numbers"),i=t.val()+e;i=i.replace(/[^0-9*#]/g,""),t.val(i)},ctiapiSendDigits:function(e){renderingUtils.setEndToInputBox($("#ctiapi_dialpad_keypad_numbers"));var t=CTIAPI.get("ctiname"),i=$("#call_type").val(),a=CTIAPI.get("ctiapitype");if("twilio"===t)if(void 0!==twiOutgoingConn.sendDigits)twiOutgoingConn.sendDigits(e);else if(void 0!==twiIncomingConn.sendDigits)twiIncomingConn.sendDigits(e);else{var r=new crmRequestPool,n={mode:"Twiliodialpad",calltype:i,digit:e};networkUtils.setCsrfParam(n),r.initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!0,data:n,type:"POST",success:function(){}})}else"type4"===a?ctiApiNotifier.type4KeyPress(e):"AWSlily"===t&&lilyActions.sendDigit(e)},openUrl:function(e,t,i,a,r,n){validationUtils.isEmpty(i)&&(i=Crm.getCrmBasePath()+"/EntityInfo.do?id="+e+"&module="+t);var o=n||"_blank",s=a||"auto",l=r||"auto";"_blank"===o&&"auto"===l&&"auto"===s?networkUtils.openUrl(networkUtils.getOrgSpecificURL(i),o):networkUtils.openUrl(networkUtils.getOrgSpecificURL(i),o,"width="+s+",height="+l)},encodeForHTMLWithoutNull:function(e){var t=$ESAPI.encoder().encodeForHTML(e);return null===t?"":t},checkCTICallNotifed:function(e,t){var i=CTIAPI.get("ctiname"),a=Crm.userDetails.USER_ID;if(!1===t){var r=CTIAPI.LocalStorage.get("isCallNotified");if(CTIAPI.LocalStorage.put("isCallNotified",!0),!0!==r){var n=Crm.getCrmBasePath()+"/CtiApiConfig.do",o={mode:"updateCtiCallNotifyStatus",callrefid:e,answeruserid:a+""};networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({action:n,cache:!1,type:"POST",data:o})}}else if(validationUtils.isNotEmpty(e)&&"twilio"!==i&&"phonebridge"!==i&&"AWSlily"!==i){var s=parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random());CTIAPI.LocalStorage.put("isCallNotified",!1),setTimeout((function(){CTIAPI.checkCTICallNotifed(e,!1)}),s)}},print:function(){if(this.get("debug")){var e=console;for(var t in arguments)e.log("%c"+arguments[t],"background: #222; color: #bada55")}},showHide_RevokeDiv:function(e,t){var i=$("#ctiapi_revoke");if(e)i.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow","");else{CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.tpi.ctiapi.revoke.confirmation.new",t),(function(){murphy.error(new Error("user clicked continue to revoke telephony")),CTIAPI.revokeProvider()}),(function(){CTIAPI.showHide_RevokeDiv(!0)}),I18n.getMsg("crm.button.continue"))}},customCtiApiConfirm:function(e,t,i,a,r){var n=$("#ctiapi_revoke"),o=$("#cti_okBt"),s=$("#cti_cancelBt"),l=$("#calBd");$("body").append('<div class="ctiapiFreezeLayer" id="ctiapiRevokeFreezeLayer"></div>');var c=$("#ctiapiRevokeFreezeLayer");l.is(":visible")&&c.css("z-index","40"),o.removeClass("ctidisablebtn"),null!=a?o.attr("value",a):o.attr("value",I18n.getMsg("crm.button.ok")),null!=r?s.attr("value",r):s.attr("value",I18n.getMsg("crm.button.cancel"));validationUtils.isEmpty(t)&&validationUtils.isEmpty(i)?s.hide():s.show(),o.click((function(){o.addClass("ctidisablebtn"),null!=t&&t(),n.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow",""),o.prop("onclick",null).off("click"),s.prop("onclick",null).off("click")})),s.click((function(){n.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow",""),o.prop("onclick",null).off("click"),s.prop("onclick",null).off("click"),null!=i&&i()})),$("#ctiapi_revoke_confirmation_msg").text(e);var d=$("#ctiapi_revoke .warning_icon");d.length||(d="<div class='mB15 aligncenter warning_icon'><img style='width:100px' src='"+networkUtils.getImageUrl("warning-illustration.png",ResourceConstants.CRMClient)+"'></div>",n.prepend(d)),n.show(),l.is(":visible")&&o.css({background:""}),setCenter(n.get(0)),$("#qCreate").hasClass("ziaForEmailsCheck")&&(c.css("z-index","315"),n.css("z-index","316")),$("html").css("overflow","hidden")},revokeProvider:function(){var e=$("#ctiapi_revoke_providername").val();if(""!==e){commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={mode:"revokeTelephony",ctiname:e};networkUtils.setCsrfParam(i),(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:i,success:function(){Lyte.Router.getRouteInstance().actions.changeToDisableView(),CTIAPI.showHide_RevokeDiv(!0)}})}},callThisFunctionOneTime:function(e,t,i,a){a=a||parseInt(3e3*Math.random()),!1===CTIAPI.LocalStorage.get(e)?(CTIAPI.LocalStorage.remove(e),i()):!0===t?setTimeout((function(e,t){CTIAPI.LocalStorage.put(e,!1),CTIAPI.callThisFunctionOneTime(e,!1,t)}),a):CTIAPI.print(e+" Already called")},getAvailPhnFlds:function(e,t,i,a){if(!validationUtils.isEmpty(e)){var r={mode:"getAvailablePhoneFieldMap",entityId:t,module:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",type:"GET",data:r,success:function(t){t.sort((function(e,t){return e.fieldValue||t.fieldValue?e.fieldValue?t.fieldValue&&!0===e.isPrimaryCol?-1:1:-1:!0===e.isPrimaryCol?-1:1})),t.length?i(e,t):a&&a()}})}},noFieldErrFn:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noassociate.field"),void 0,void 0,(function(){$("#crm_phnoconversion_freezeLayers").remove(),Crm.isHeadless&&"undefined"!=typeof WindowsCommunicator&&WindowsCommunicator.notifyParent("cancel-operation")}))},loadTelephonyHomePage:function(e,t){var i=Crm.getCrmBasePath()+"/CtiApiConfig.do",a="GET",r={mode:"telephony",view:2,isFromBack:!1};e&&(networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],void 0),i=Crm.getCrmBasePath()+"/ZTIConfig.do",r={event:"buyNow"},t&&(r.from="creategroup"),a="POST",networkUtils.setCsrfParam(r)),(new crmRequestPool).initiate({action:i,type:a,data:r,success:function(e){var t=$("#otherApps"),a=t.html();$("#currentTab").html(a),i===Crm.getCrmBasePath()+"/CtiApiConfig.do"&&"object"==typeof e&&"providerList"===e.view?ctiApiConfig.renderProviderList(e):$("#result").html(e),JSEvalScript(document.getElementById("result")),commonUtils.showHideLoadingDiv(),t.addClass("sel")}})},setIE9Placeholder:function(e){if(navigator.appVersion.match(/MSIE [\d.]+/)){var t=(e=$(e)).attr("placeholder");e.blur((function(){""===e.val()&&e.val(t)})).focus((function(){e.val()===t&&e.val("")})).blur().val(t)}},checkOldCallSaved:function(e,t){var i=e.callrefid,a=CTIAPI.get("old_callrefid"),r=CTIAPI.get("old_callstate");if("true"!==$("#ctinotifier").attr("is")||a===i||"callhungup"!==r&&"callended"!==r&&"completed"!==r)$.isFunction(t)&&t(e);else{ctiApiNotifier.createCaid((function(i,a){if(CTIAPI.put("caid",i),$.isFunction(t)){ctiApiNotifier.saveCallWithCaid((function(){t(e)}),a,e)}else ctiApiNotifier.saveCallWithCaid()}),1,!0,e)}},setCallState:function(e){var t=CTIAPI.get("callState");CTIAPI.put("old_callstate",t),CTIAPI.put("callState",e)},setCallRefid:function(e){var t=CTIAPI.get("callrefid");CTIAPI.put("callrefid",e),CTIAPI.put("old_callrefid",t)},getFormatedName:function(e,t){var i=Crm.userDetails.NAME_FORMAT.split(",");return Crm.userDetails.NAME_FORMAT&&"Last Name"===i[2]?e+" "+t:t+" "+e},tabVisible_hiddenSet:function(){!function(){var e="hidden";function t(e){var t="visible",i="hidden",a={focus:t,focusin:t,pageshow:t,blur:i,focusout:i,pagehide:i},r=!1;(e=e||window.event).type in a?"visible"===a[e.type]&&(r=!0):this.hidden||(r=!0),r&&CTIAPI.tabVisibilityStateChange()}e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t,void 0!==document.hidden&&t({type:document[e]?"blur":"focus"})}()},getCtiApicsrfParam:function(){return csrfParamName+"="+encodeURIComponent(csrfToken)},showCallButtonlabel:function(e){$(e).children("#calllabel1").css({display:"inline"})},hideCallButtonlabel:function(e){$(e).children("#calllabel1").hide()},createFreezeLayer:function(){$("<div class='freezeLayer' id='freezelayer'></div>").appendTo("body")},ctiapisetCenter:function(e){document.getElementById(e).style.display="block";var t=$("#"+e);CTIAPI.createFreezeLayer();var i=$window.height()/2,a=t.innerHeight()/2,r=$window.width()/2,n=t.width()/2;t.css({top:i-a,left:r-n})},removeRCSpecialChars:function(e){if(""!==e&&null!=e)for(var t="~`!@#$^&%*()=-_[]/{}|:<>?. '\"\\",i=t.length,a=0;a<i;a++)e=e.split(t.charAt(a)).join("");return e},sendEmail:function(e){localStorage.setItem("pbxusernotified","true");var t={mode:"userNotify",ctiname:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:t})},showNumber:function(e,t){var i=$(e).closest("td"),a=i.offset(),r=$("#callButtonContainer");if(r.css("position","absolute").css("top",a.top+i.height()).css("left",a.left),""===$.trim(r.html())){var n=i.find("#entityPhDiv_"+t);n.css("display","block"),r.html(n.prop("outerHTML")),n.remove(),r.show()}else r.toggle()},createContact:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{commonUtils.showHideLoadingDiv(!0),t&&$("#editActivity").val("true"),e=e.trim();var i=$("#ctiapi_entitys_create_contact");if("true"===i.attr("is")&&!t)CTIAPI.create_EditContactCallBack(!0);else{void 0!==e&&"null"!==e&&null!==e&&e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(e="");var a=Crm.getCrmBasePath()+"/QCreate.do",r={module:"Contacts",fromCreate:"QuickCreate",recordNum:1,ctiapi:!0,phoneno:e};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:r,success:function(t){if(-1!==t.indexOf("createEntityForm")){Crm.downloadValidationRules(Crm.getCrmBasePath()+"/QCreate.do?module="+r.module,r.module),i.html(t),CTIAPI.create_EditContactCallBack(!1),thirdPartyUtils.bindSelect2("#ctiapi_entitys_create_contact select");var a=$("form[name=createEntityFormctiapiContacts]"),n=a.find("input[name='property(Phone)']"),o=a.find("input[name='property(Mobile)']"),s=a.find("input[name='property(Other Phone)']");e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&(n.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(n,e):n.val(e):o.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(o,e):o.val(e):s.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(s,e):s.val(e):$("#qcFieldsContent .labelValCreate").each((function(t,i){var a=$(i).find("input");if(a&&("33"===a.data("uitype")||33===a.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(a,e):a.val(e),!1})))}else"noPhoneFields"===t?($("#editActivity").val("false"),CTIAPI.add_remove_cancelContactCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelContact()},error:function(){CTIAPI.cancelContact()}})}}},create_EditContactCallBack:function(e){$("#ctiapi_contact_freezeLayers").remove(),$("body").append("<div id='ctiapi_contact_freezeLayers' class='ctiapiFreezeLayer' style='opacity:0.1;z-index:30;'></div>"),(e=e||!1)&&$("#ctiapi_module_head_msg_Contact").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Contact")));var t=$("#ctinotifier_center");t.show(),$("#ctiapi_entitys_create_contact").show();var i=t.outerHeight()/2;t.css("margin-top","-"+i+"px"),commonUtils.showHideLoadingDiv()},add_remove_cancelContactCallBack:function(){commonUtils.showHideLoadingDiv(),$("#ctinotifier_center,#ctiapi_entitys_create_contact").hide(),$("#ctiapi_contact_freezeLayers").remove()},cancelContact:function(){if(Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"close"});else{var e=document.getElementsByClassName("errorMsgDesc"),t=e[0],i=document.getElementsByName("createEntityFormctiapiContacts")[0];i.contains(t)&&i.reset();for(var a=e.length,r=0;r<a;r++){var n=e[r];n.parentElement.removeChild(n)}}$("#editActivity").val("false"),CTIAPI.add_remove_cancelContactCallBack()},addContact:function(e){var t=$(e).closest("form").get(0).name;new Promise((function(e){e(CVRExec.evalRules("edit","Contacts"))})).then((function(e){if(e&&quickCreateValidateAction("All","Contacts",t)){multiSelectRemoval(t),$("#ctiapi_entitys_create_contact").attr("is","true");var i=commonUtils.formData2QueryString(document.createEntityFormctiapiContacts,"Contacts"),a=document.getElementsByName("property(Last Name)")[0].value,r=$("form[name=createEntityFormctiapiContacts] [name='property(First Name)']").val(),n=(void 0!==r?r+" ":"")+a,o=$("#is_contact_created"),s=!0===o.val()||"true"===o.val(),l=$("#editActivity"),c=l.val();if(s&&"true"!==c&&(i+="property(id)="+$("#Ctiapi_associated_contact_id").val()+"&",i+="ActionType=Edit"),CTIAPI.put("contactformDataTemp",i),"true"===l.val()){$("#Ctiapi_associated_contact_nameActivity").val(n.trim());var d=$("#callActivityId").val();CTIAPI.saveContact(d,"false")}else CTIAPI.saveContact()}return!1}))},createLead:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{commonUtils.showHideLoadingDiv(!0),t&&$("#editActivity").val("true"),e=e.trim();var i=$("#ctiapi_entitys_create_lead");if("true"===i.attr("is")&&!t)CTIAPI.create_EditLeadCallBack(!0);else{void 0!==e&&"null"!==e&&null!==e&&e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(e="");var a=Crm.getCrmBasePath()+"/QCreate.do",r={module:"Leads",fromCreate:"QuickCreate",ctiapi:!0,phoneno:e};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:r,success:function(t){if(-1!==t.indexOf("createEntityForm")){Crm.downloadValidationRules(Crm.getCrmBasePath()+"/QCreate.do?module="+r.module,r.module),i.html(t),thirdPartyUtils.bindSelect2("#ctiapi_entitys_create_lead select"),CTIAPI.create_EditLeadCallBack(!1);var a=$("form[name=createEntityFormctiapiLeads]"),n=a.find("input[name='property(Phone)']"),o=a.find("input[name='property(Mobile)']");e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&(n.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(n,e):n.val(e):o.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(o,e):o.val(e):$("#qcFieldsContent .labelValCreate").each((function(t,i){var a=$(i).find("input");if(a&&("33"===a.data("uitype")||33===a.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(a,e):a.val(e),!1})))}else"noPhoneFields"===t?($("#editActivity").val("false"),CTIAPI.add_remove_cancelLeadCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelLead()},error:function(){CTIAPI.cancelLead()}})}}},changeLayout:function(e,t){commonUtils.showHideLoadingDiv(!0),void 0!==t&&"null"!==t&&null!==t&&t!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(t="");var i=Crm.getCrmBasePath()+"/QCreate.do",a={module:e,fromCreate:"QuickCreate",layoutId:$("#layoutdetails").val(),ctiapi:!0,phoneno:t};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:i,cache:!1,type:"POST",data:a,success:function(i){if(-1!==i.indexOf("createEntityForm")){"Leads"===e?($("#ctiapi_entitys_create_lead").html(i).attr("is","true"),CTIAPI.create_EditLeadCallBack(!1)):"Contacts"===e&&($("#ctiapi_entitys_create_contact").html(i).attr("is","true"),CTIAPI.create_EditContactCallBack(!1));var a=$("form[name=createEntityFormctiapi"+e+"]"),r=a.find("input[name='property(Phone)']"),n=a.find("input[name='property(Mobile)']");t!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&""!==t&&(r.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(r,t):r.val(t):n.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(n,t):n.val(t):$("#qcFieldsContent .labelValCreate").each((function(e,i){var a=$(i).find("input");if(a&&(33===a.data("uitype")||"33"===a.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(a,t):a.val(t),!1})))}else"noPhoneFields"===i?($("#editActivity").val("false"),"Leads"===e?CTIAPI.add_remove_cancelLeadCallBack():"Contacts"===e&&CTIAPI.add_remove_cancelContactCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelLead()},error:function(){CTIAPI.cancelLead()}})},create_EditLeadCallBack:function(e){$("#ctiapi_lead_freezeLayers").remove(),$("body").append("<div id='ctiapi_lead_freezeLayers' class='ctiapiFreezeLayer' style='opacity:0.1;z-index:30;'></div>"),(e=e||!1)&&$("#ctiapi_module_head_msg_Lead").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Lead")));var t=$("#ctinotifier_center");t.show(),$("#ctiapi_entitys_create_lead").show();var i=t.outerHeight()/2;t.css("margin-top","-"+i+"px"),commonUtils.showHideLoadingDiv()},add_remove_cancelLeadCallBack:function(){commonUtils.showHideLoadingDiv(),$("#ctinotifier_center,#ctiapi_entitys_create_lead").hide(),$("#ctiapi_lead_freezeLayers").remove()},cancelLead:function(){if(Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"close"});else{var e=document.getElementsByClassName("errorMsgDesc"),t=e[0],i=document.getElementsByName("createEntityFormctiapiLeads")[0];i.contains(t)&&i.reset();for(var a=e.length,r=0;r<a;r++){var n=e[r];n.parentElement.removeChild(n)}}$("#editActivity").val("false"),CTIAPI.add_remove_cancelLeadCallBack()},addLead:function(e){var t=$(e).closest("form").get(0).name;new Promise((function(e){e(CVRExec.evalRules("edit","Leads"))})).then((function(e){if(e&&quickCreateValidateAction("All","Lead",t)){multiSelectRemoval(t),$("#ctiapi_entitys_create_lead").attr("is","true");var i=commonUtils.formData2QueryString(document.createEntityFormctiapiLeads,"Lead"),a=document.getElementsByName("property(Last Name)")[0].value,r=$("form[name=createEntityFormctiapiLeads] [name='property(First Name)']").val(),n=(void 0!==r?r+" ":"")+a,o=$("#is_lead_created"),s="true"===o.val()||!0===o.val(),l=$("#editActivity"),c=l.val();if(s&&"true"!==c&&(i+="property(id)="+$("#Ctiapi_associated_lead_id").val()+"&",i+="ActionType=Edit"),CTIAPI.put("leadformDataTemp",i),"true"===l.val()){$("#Ctiapi_associated_lead_nameActivity").val(n.trim());var d=$("#callActivityId").val();CTIAPI.saveLead(d,"false")}else CTIAPI.saveLead()}return!1}))},associateContact:function(e){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;CTIAPI.Windows.changeWindowInfo="open",e&&$("#editActivity").val("true");var t=CTIAPI.Windows.Lead,i=CTIAPI.Windows.Contact,a=CTIAPI.Windows.contactIntervalID;if(i)i&&!i.closed&&i.focus();else{t&&CTIAPI.Windows.removeChildLead();var r=function(){if(e)var t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Contacts&fldName=Ctiapi_associated_contact_nameActivity&fldId=Ctiapi_associated_contact_idActivity&targetForm=ctiapicontactsearchActivity";else t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Contacts&fldName=Ctiapi_associated_contact_name&fldId=Ctiapi_associated_contact_id&targetForm=ctiapicontactsearch";var r=renderingUtils.windowWidth;commonUtils.openCustomLookup(t,void 0,"topBandPopup",r-300),window.clearInterval(a),a=window.setInterval(CTIAPI.checkContactChildWindow,1e3),CTIAPI.Windows.contactInterval=a,CTIAPI.Windows.childContact=i};$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Contacts",void 0,r,CTIAPI.noFieldErrFn):r()}},checkContactChildWindow:function(){var e=CTIAPI.Windows.contactIntervalID,t=$("#Ctiapi_associated_contact_id"),i=$("#editActivity");if("true"===i.val()&&(t=$("#Ctiapi_associated_contact_idActivity")),"closed"===CTIAPI.Windows.windowInfo||t.val())if(CTIAPI.Windows.changeWindowInfo=void 0,window.clearInterval(e),CTIAPI.Windows.removeChildContact(),validationUtils.isEmpty(t.val()))i.val("false"),$("#is_contact_associated").val("false"),Crm.isHeadless&&Lyte.triggerEvent("crm-associate-search",{message:"close"});else{var a=t.val();$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Contacts",a,CTIAPI.showAvailablePhnFields,CTIAPI.noFieldErrFn):CTIAPI.associateEntity("Contacts",a)}},associateContactName:function(e){if(e){var t=$(".ctiapi_unknownActivity");t.hide();var i=$("#Ctiapi_associated_contact_idActivity").val(),a=$("#Ctiapi_associated_contact_nameActivity").val();t.remove();var r='<a class="link" id="subvalue_CONTACTID" data-zcqa="value_CONTACTID" data-cid="detailView" ';r+='data-params="{&quot;lookback&quot;:&quot;true&quot;,&quot;module&quot;:&quot;Contacts&quot;,&quot;id&quot;:&quot;'+i+'&quot;}" ',r+='href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module=Contacts&amp;id="+i+'">'+a+"</a>",$("#value_CONTACTID").append(r),$("#headervalue_CONTACTID").append(r)}else $(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_associated_contact_name").text($("#Ctiapi_associated_contact_name").val()),$("#ctiapi_unknown_associated_contact").show(),$("#is_contact_associated").val("true"),$("#is_lead_associated").val("false"),CTIAPI.decideShowHide_CloseBT()},openAssociateContact:function(){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;var e=$("#Ctiapi_associated_contact_id");if(!validationUtils.isNotEmpty(e.val()))return!1;CTIAPI.openUrl(e.val(),"Contacts")},associateLead:function(e){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;CTIAPI.Windows.changeWindowInfo="open",e&&$("#editActivity").val("true");var t=CTIAPI.Windows.Contact,i=CTIAPI.Windows.Lead,a=CTIAPI.Windows.leadIntervalID;if(i)i&&!i.closed&&i.focus();else{t&&CTIAPI.Windows.removeChildContact();var r=function(){if(e)var t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Leads&fldName=Ctiapi_associated_lead_nameActivity&fldId=Ctiapi_associated_lead_idActivity&targetForm=ctiapileadsearchActivity";else t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Leads&fldName=Ctiapi_associated_lead_name&fldId=Ctiapi_associated_lead_id&targetForm=ctiapileadsearch";var r=renderingUtils.windowWidth;commonUtils.openCustomLookup(t,void 0,"topBandPopup",r-300),window.clearInterval(a),a=window.setInterval(CTIAPI.checkLeadChildWindow,1e3),CTIAPI.Windows.leadInterval=a,CTIAPI.Windows.childLead=i};$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Leads",void 0,r,CTIAPI.noFieldErrFn):r()}},checkLeadChildWindow:function(){var e=CTIAPI.Windows.leadIntervalID,t=$("#Ctiapi_associated_lead_id"),i=$("#editActivity");if("true"===i.val()&&(t=$("#Ctiapi_associated_lead_idActivity")),"closed"===CTIAPI.Windows.windowInfo||t.val())if(CTIAPI.Windows.changeWindowInfo=void 0,window.clearInterval(e),CTIAPI.Windows.removeChildLead(),validationUtils.isEmpty(t.val()))i.val("false"),$("#is_lead_associated").val("false"),Crm.isHeadless&&Lyte.triggerEvent("crm-associate-search",{message:"close"});else{var a=t.val();$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Leads",a,CTIAPI.showAvailablePhnFields,CTIAPI.noFieldErrFn):CTIAPI.associateEntity("Leads",a)}},associateLeadName:function(e){if(e){var t=$(".ctiapi_unknownActivity");t.hide();var i=$("#Ctiapi_associated_lead_idActivity").val(),a=$("#Ctiapi_associated_lead_nameActivity").val();t.remove();var r='<a class="link" id="subvalue_CONTACTID" data-zcqa="value_CONTACTID" data-cid="detailView" ';r+='data-params="{&quot;lookback&quot;:&quot;true&quot;,&quot;module&quot;:&quot;Leads&quot;,&quot;id&quot;:&quot;'+i+'&quot;}" ',r+='href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module=Leads&amp;id="+i+'">'+a+"</a>",$("#value_CONTACTID").append(r),$("#headervalue_CONTACTID").append(r)}else $(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_associated_lead_name").text($("#Ctiapi_associated_lead_name").val()),$("#ctiapi_unknown_associated_lead").show(),$("#is_contact_associated").val("false"),$("#is_lead_associated").val("true"),CTIAPI.decideShowHide_CloseBT()},openAssociateLead:function(){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;var e=$("#Ctiapi_associated_lead_id");if(!validationUtils.isNotEmpty(e.val()))return!1;CTIAPI.openUrl(e.val(),"Leads")},showAvailablePhnFields:function(e,t){if(t.filter((e=>!1===e.isFieldLocked)).length>0){var i={};i.availFields=t,i.module=e,i.saveFn="CTIAPI.saveNumber()",i.cancelFn="CTIAPI.cancelSave()",CTIAPI.enableFreeze();var a=Handlebars.templates.show_available_phn_fields(i);$("#availField").html(a).show();var r=$("input.availPhnField:not(:disabled)");r.eq(0).siblings(".fieldValue").length<1?r.eq(0).attr("checked",!0):$("#save").attr("disabled",!0),r.on("change",CTIAPI.changePhoneField)}else CTIAPI.noFieldErrFn()},saveNumber:function(){var e=$("input[type=radio][name='availPhnField']:checked").siblings(".fieldValue");e.text()?CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.phonebridge.overwriting.no",e.text()),CTIAPI.saveNumberToEntity,null,I18n.getMsg("crm.button.continue"),I18n.getMsg("crm.creator.cancelbutton")):CTIAPI.saveNumberToEntity()},associateEntityName:function(e,t){"Leads"===e?CTIAPI.associateLeadName(t):"Contacts"===e&&CTIAPI.associateContactName(t)},associateEntityInActivity:function(e,t){var i=$("#callActivityId").val();CTIAPI.associateEntityName(e,!0),CTIAPI.associateEntityWithCall(t,e,i,!1,null,"activity")},associateEntity:function(e,t){"true"===$("#editActivity").val()?CTIAPI.associateEntityInActivity(e,t):(CTIAPI.associateEntityName(e),ctiApiNotifier.showFollowUpCreate())},saveNumberToEntity:function(){var e=$("input[type=radio][name='availPhnField']:checked"),t=JSON.parse(e.attr("value")),i=$("#fldsModule").attr("value"),a=null,r=null;"true"===$("#editActivity").val()?("Leads"===i?a=$("#Ctiapi_associated_lead_idActivity").val():"Contacts"===i&&(a=$("#Ctiapi_associated_contact_idActivity").val()),r=$("#call_ctinumberActivity").val(),CTIAPI.updatePhnoInAssociatedEntity(i,a,r,t,(function(){CTIAPI.associateEntityInActivity(i,a)}))):("Leads"===i?a=$("#Ctiapi_associated_lead_id").val():"Contacts"===i&&(a=$("#Ctiapi_associated_contact_id").val()),r=$("#call_ctinumber").val(),Crm.isHeadless&&Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:i,recordid:a}}),CTIAPI.updatePhnoInAssociatedEntity(i,a,r,t,(function(){CTIAPI.associateEntityName(i)})),ctiApiNotifier.showFollowUpCreate())},changePhoneField:function(){1===$(this).siblings(".fieldValue").length?$("#save").attr({disabled:!1,value:I18n.getMsg("crm.button.replace")}):$("#save").attr({disabled:!1,value:I18n.getMsg("Save")})},cancelSave:function(){Crm.isHeadless&&Lyte.triggerEvent("crm-quick-create",{message:"close"});var e=$("#fldsModule").attr("value"),t=$("#editActivity");"true"===t.val()?(t.val("false"),"Leads"===e?$("#Ctiapi_associated_lead_idActivity, #Ctiapi_associated_lead_nameActivity").attr("value",""):"Contacts"===e&&$("#Ctiapi_associated_contact_idActivity, #Ctiapi_associated_contact_nameActivity").attr("value","")):("Leads"===e?$("#Ctiapi_associated_lead_id, #Ctiapi_associated_lead_name").attr("value",""):"Contacts"===e&&$("#Ctiapi_associated_contact_id, #Ctiapi_associated_contact_name").attr("value",""),$("#is_lead_associated, #is_contact_associated").val("false")),$("#availField").empty().hide(),renderingUtils.removeFreezeLayer()},updatePhnoInAssociatedEntity:function(e,t,i,a,r){if(!validationUtils.isEmpty(t)){var n="/crm/v2/",o={},s=[],l={};if(validationUtils.isNotEmpty(a)){n=n+e+"/"+t+"?affected_data=true",o[a.SYS_REF_NAME]=i,s.push(o),l.data=s;var c={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(c["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:n,type:"PUT",data:JSON.stringify(l),contentType:"application/json",headers:c,success:function(){$("#availField").empty().hide(),renderingUtils.removeFreezeLayer(),$.isFunction(r)&&r()},error:function(){CTIAPI.errorRCMessage("crm.privileges.restrict")}})}}},saveLead:function(e,t){var i=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true",a=CTIAPI.get("leadformDataTemp");(new crmRequestPool).initiate({action:i,type:"POST",data:a,success:function(e){CTIAPI.handleEntityCreationResponse(e,"leads")},error:function(){}})},associateEntityWithCall:function(e,t,i,a,r,n){var o=$("#editActivity");if(validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(i)){commonUtils.showHideLoadingDiv(!0);var s=Crm.getCrmBasePath()+"/CtiApiConfig.do",l="activity"===n?detailView.changedBCJson.callStatus:"NonMissed",c={mode:"associateEntityWithCall",entityId:e+"",module:t,activityid:i+"",callrefid:r,isFrom:n,callstatus:l};networkUtils.setCsrfParam(c),(new crmRequestPool).initiate({action:s,cache:!1,type:"POST",data:c,success:function(i){if(commonUtils.showHideLoadingDiv(),"true"===o.val())return i.phoneNo&&Object.keys(i.phoneNo).length>0?$("#businessView").html(Handlebars.templates.CallButton(i)):$("#businessView").hide(),void o.val("false");ctiApiNotifier.saveTask(e,t,a)}})}else"true"!==o.val()&&ctiApiNotifier.saveTask(e,t,a)},saveContact:function(e,t){var i=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true",a=CTIAPI.get("contactformDataTemp");(new crmRequestPool).initiate({action:i,type:"POST",data:a,success:function(e){CTIAPI.handleEntityCreationResponse(e,"contacts")},error:function(){}})},decideShowHide_CloseBT:function(){var e=$("#ctiapi_calldesc"),t=$("#agentdisp option:selected"),i=validationUtils.isNotEmpty(e.val()),a=void 0!==t.val()&&"default"!==t.val(),r="true"===$("#is_task_created").val(),n="true"===$("#is_call_created").val(),o=validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text()),s="true"===$("#is_contact_created").val()||"true"===$("#is_lead_created").val(),l="true"===$("#is_contact_associated").val()||"true"===$("#is_lead_associated").val();i||r||n||o||s||l||a?($("#ctiapi_close_bt").hide(),$("#ctiapi_save_bt,#ctiapi_cancel_bt").show()):($("#ctiapi_close_bt").show(),$("#ctiapi_save_bt,#ctiapi_cancel_bt").hide())},ctiapiUnknownAdd_associate:function(e,t){if(sE(event),t){$("#ctinotifier_center").html('<div class="ctiapi_activitys" id="ctiapi_entitys_create_contact"></div><div class="ctiapi_activitys" id="ctiapi_entitys_create_lead" style="display:none;" ></div>').hide();var i=$(e.target).closest(".ctiapi_unknownActivity"),a=i.offset(),r=i.height(),n=a.left,o=a.top,s=$("#addAssociateCont");if(s.css("position","absolute").css("left",n).css("top",o+r+5),""===$.trim(s.html())){var l=$("#ctiapi_unknown_add_associateActivity");l.css("display","block"),s.html(l.prop("outerHTML")),l.remove(),s.show()}else{s.toggle(),$("#addAssociateCont > .ctiAddRecord").show()}}else{var c=$("#ctiapi_unknown_add_associate_plus"),d=$("#ctiapi_unknown_add_associate"),u=c.position().top+25,m=c.position().left-d.outerWidth()/2;d.css({left:m+"px",top:u+"px"}).show(),Crm.userDetails.RTL_ENABLED&&d.css({left:"10px",top:u+"px"}).show()}},enableFreeze:function(){renderingUtils.freezeBackground(),$(".freezeLayer").show(),$("html").css("overflow","hidden")},errorRCMessage:function(e){crmui.showMsgBand("error",I18n.getMsg(e),"infinity",null),$(".crm-msg").css({"max-width":"550px",padding:"0px 0px 0px 0px"}),$(".crm-msg-cnt").css({padding:"10px 40px 5px 60px","font-size":"13px"})},hideElem:function(e){if(e)return e instanceof jQuery||(e=$(e)),e.hide(),e},updateQueryParams:function(e,t){return"object"!=typeof t||Object.getOwnPropertyNames(t).forEach((function(i){var a=new RegExp("([?&])"+CTIAPI.escapeRegExp(i)+"=.*?(&|#|$)(.*)","gi");a.test(e)&&(e=e.replace(a,"$1"+i+"="+t[i]+"$2$3"))})),e},escapeRegExp:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},getValueFromQuery:function(e,t){if(e&&t){var i=e.indexOf(t);if(-1===i)return null;if((0===i||"&"===e.charAt(i-1))&&"="===e.charAt(i+t.length)){var a=e.substring(i).indexOf("&");return a=-1!==a?i+a:e.length,e.substring(i+t.length+1,a)}}return null},isError:function(e){return!(!e||"string"!=typeof e||-1===e.indexOf(I18n.getMsg("crm.unable.to.process.request")))},trigger_event:function(e){try{if(clienttab.ismaster&&"twilioanswercall"===e.key){var t=JSON.parse(localStorage.getItem("twilioanswercall"));if(null!==t){var i=t.buttonid;$(i).click()}}else if(clienttab.ismaster&&"triggerclick2calltwilio"===e.key){var a=JSON.parse(localStorage.getItem("triggerclick2calltwilio"));null!==a&&(twilioNotifier.twilioMakeCallFinally(a.params,a.c2cEntityName,a.iter),localStorage.removeItem("triggerclick2calltwilio"))}else if(clienttab.ismaster||"showcallctrl"!==e.key)clienttab.ismaster||"resumecall"!==e.key||(twilioNotifier.holdNotify("unhold"),CTIAPI.put("twiCurrentStatus","inprogress"),localStorage.removeItem("resumecall"));else{var r=$("#callrefid").val();if("inRinging"===CTIAPI.get("twiCurrentStatus")&&"true"===$("#ctinotifier").attr("is")&&twilioCallDetails.hasOwnProperty(r)&&"ringing"===twilioCallDetails[r].status)$("#ctiapi_twilio_call_ctrl_bts").show();else{var n=localStorage.getItem("showcallctrl");null!==n&&twilioNotifier.twilioGetCallDetailsByAjax(n,null)}}}catch(e){murphy.error(e)}},makeConnection:function(){"undefined"!=typeof twilioNotifier&&twilioNotifier.twilioRegisterBrowser()},destroyConnection:function(){"undefined"!=typeof twilioNotifier&&(twilioNotifier.twilioDestroyBrowser(),twiIncomingConn={},twiOutgoingConn={})},handleEntityCreationResponse:function(e,t){if(null!=e.STATUS)for(var i=e.INFO,a=i.length,r=0;r<a;r++){var n="#Crm_";"leads"===t?n+="Leads_":"contacts"===t&&(n+="Contacts_");var o=i[r];n+=o.COLUMNNAME,$(n).parent().append('<span id="quickcreateerror_'+o.COLUMNNAME+'" class="errMsg errorMsgDesc" style="clear: both; color: rgb(221, 0, 0); font-size: var(--crm-extra-medium-font-size); display: block;">'+I18n.getMsg("crm.duplicate.value.not.allowed")+"</span>")}else if(null!=e.entityModule){var s=$("#editActivity").val(),l="true"===$("#is_task_created").val(),c=$("#callActivityId").val();if("Contacts"===e.entityModule)if(CTIAPI.add_remove_cancelContactCallBack(),"true"!==s&&($(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_added_contact").show(),$("#ctiapi_unknown_added_contact_name").text(e.entityName),$("#is_contact_created").val("true"),$("#removeContact_link").show(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.showFollowUpCreate()),Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:e.entityModule,recordid:e.entityId}});else{var d=e.entityId;"true"===s?($("#Ctiapi_associated_contact_idActivity").val(d.trim()),CTIAPI.associateContactName(!0),CTIAPI.associateEntityWithCall(d,"Contacts",c,l,null,"activity"),$("#ctiapi_entitys_create_contact").html("")):$("#Ctiapi_associated_contact_id").attr("value",d)}else if("Leads"===e.entityModule)if(CTIAPI.add_remove_cancelLeadCallBack(),"true"!==s&&($(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_added_lead").show(),$("#ctiapi_unknown_added_lead_name").text(e.entityName),$("#is_lead_created").val("true"),$("#removeLead_link").show(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.showFollowUpCreate()),Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:e.entityModule,recordid:e.entityId}});else{var u=e.entityId;"true"===s?($("#Ctiapi_associated_lead_idActivity").val(u.trim()),CTIAPI.associateLeadName(!0),CTIAPI.associateEntityWithCall(u,"Leads",c,l,null,"activity"),$("#ctiapi_entitys_create_lead").html("")):$("#Ctiapi_associated_lead_id").attr("value",u)}}},loadRecording:function(){!CTIAPI.zpbRecDetails.loaded&&"undefined"!=typeof PB&&CTIAPI.zpbCallback.isloaded&&(PB.loadRecording(),CTIAPI.zpbRecDetails.loaded=!0)},isTelephonyIntegrated:function(){return validationUtils.isNotEmpty(CTIAPI.CTI.ctiname)||"undefined"!=typeof PB&&PB.isIntegrationEnabled&&PB.isIntegrationEnabled()}};Object.freeze(CTIAPI),CTIAPI.LocalStorage.reset(),CTIAPI.tabCountIncrease();var callbackZPB=function(){if(CTIAPI.zpbRecDetails.required&&"undefined"!=typeof PB&&CTIAPI.loadRecording(),!CTIAPI.zpbCallback.isloaded){CTIAPI.zpbCallback.isloaded=!0;for(var e=CTIAPI.zpbCallback.listeners,t=e.length,i=0;i<t;i++)e[i]()}},callbackZPBSuccess=function(){var e=$(".ZPBListnerCls"),t=e.length;if(t)for(var i=Lyte.Component.registeredHelpers.whichPBService(),a=0;a<t;a++)e[a].component&&e[a].component.setData("pbServiceName",i);if(!CTIAPI.zpbCallback.successLoaded){CTIAPI.zpbCallback.successLoaded=!0;var r=CTIAPI.zpbCallback.succListeners,n=r.length;for(a=0;a<n;a++)r[a]()}},crmLayout={};crmLayout.Resize=function(){function e(){$("#homePageView").length&&$("#homePageView").css("height",$(window).height()-($("#homePageView").position().top+26)),$("#cobouterdiv").length&&$("#cobouterdiv").css({height:renderingUtils.windowOuterHeight-(renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+28),top:renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()}),$("#hd_inner_container").length&&$("#hd_inner_container").css({height:$("#helpdesk").outerHeight()-renderingUtils.tabLayerTop()-30}),$("#feedLeftMenuContainer").is(":visible")&&setfFeedsGroupContainerHeight(),CrmDashboard.populateVisibleComponents("homePageView")}function t(){if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)crmLayout.Resize.DetailpageResizeRevamp();else{if(!$("#newLeftPanel").length||!$("#newInfoDiv").length)return;var e=renderingUtils.getHeightFromTabLayer();if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){$("#leftPanel").css("min-height","initial");var t=$("#annoncement");e=t.length?e-t.outerHeight():e}if($("#newLeftPanel").length&&(thirdPartyUtils.unbindPerfectScroll("#newLeftPanel"),$("#newLeftPanel").removeClass("oH"),$("#newLeftPanel").css("height",e).addClass("oH pR"),thirdPartyUtils.bindPerfectScroll("#newLeftPanel",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1})),$("#newInfoDiv").length){var i=$("#dvinner"),a=$("#newLeftPanel").outerWidth(),r=$(window).width(),n=r-a,o=($("#dvinner").offset().left,e),s=$("#newInfoDiv");s.css("overflow","hidden");var l=r-a;r<1040&&(l=1e3,s.css("overflow","auto")),s.css({height:o,width:n}),e-=$("#dv-button-layer").outerHeight()+17,"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&(e-=37),i.css({width:l,height:e,overflow:"auto","box-sizing":"border-box"})}}var c=document.querySelector("crm-entityscores-view");c&&(c.component.getData("showTable")||(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].showSrChart():crmRelatedList.showSrChart()))}function i(){if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI){var e=$("#newLeftPanel");if(!e.length||!e.length)return;var t=$("#newHistoryDiv"),i=$("#newDataPrivacyDiv"),a=$("#newInfoDiv"),r=renderingUtils.getHeightFromTabLayer();detailView.tabsLayerHeight=r,e.length&&detailView.setDetailViewNewLeftPanelProp(),a.length&&detailView.setDetailViewNewInfoDivProp(),"block"==t.css("display")&&detailView.datatimeLineHeight(),"block"==i.css("display")&&detailView.dataPrivacyHeight(),crmLayout.Resize.setWidthHeightStage($("#stageContain"))}}function a(){if($("#reportIntegdiv").length){var e=$(window).height()-$("#dashboardList").offset().top;isChatEnabled&&(e-=26),$("#reportIntegdiv").length&&(e-=$("#reportIntegdiv").outerHeight()),$("#dashboardList").css("height",e),thirdPartyUtils.bindPerfectScroll("#dashboardList",{wheelSpeed:1,preventOnEnd:!1,preventHorizontal:!1})}$("#dashboardItems").length&&$("#dashboardItems").css("height",$(window).height()-($("#dashboardItems").offset().top+26));var t=$("#idCVDiv");if(t.length>0){var i=renderingUtils.windowHeight,a=!0===$("#wmstoolbar").is(":visible")?$("#wmstoolbar").outerHeight():28,r=i-(renderingUtils.tabLayerOuterHeight()+a);t.css({height:r+"px",overflow:"auto"})}}function r(){$("#reportLookupDiv").length&&crmReports.setHeightWidth()}function n(){var e=$("#ImportedRecordsSummary"),t=$("crm-client-portal-tabs-configuration").is(":visible"),i=$("crm-client-portal-field-permissions").is(":visible"),a=$L("crm-client-portal-user-type-summary-header").is(":visible"),r=$L("#cpT_navCtn").is(":visible"),n=$(".cpT_listRow").length,o=$("crm-client-portal-user-type-users").is(":visible");if(e.length>0){var s="undefined"!=typeof importHistory&&null!=importHistory.recordType?importHistory.recordType:"undefined"!=typeof translationHistory&&null!=translationHistory.record_type?translationHistory.record_type:null;if(null!=s){var l=$("#importedlistview div.scrollElementDiv"),c=$("#"+s+"Table"),d=c.find(".itb-body-class"),u=e.outerHeight(),m=c.offset().top,p=l.outerHeight(),g=u-m;l.height(g-35),d.height(p-45)}}if($("#setupLinkDiv").length||$("#setup_new_ContentDiv").length){var h=$(window).height();if($("#setupLinkDiv").length){var v=$("#setupLinkDiv").offset().top,f=h-(v+=28)-15,C=h-($("#setup_new_leftmenuDiv").offset().top+28+16);$("#setup_new_leftmenuDiv").css({height:C+"px"}),thirdPartyUtils.unbindPerfectScroll("#setupLinkDiv"),$(".crmsetup-sideMenu").css({"max-height":f+"px"})}if(1!==$("#builder_container").length){if($(".newSetupRightShow").length)var I=h-($("#setup_new_ContentDiv").offset().top+28);else I=h-($("#setup_new_ContentDiv").offset().top+28+16);$("#setup_new_ContentDiv").css({height:I+"px"});var y=$("#preferences"),w=$("#preferencesSaveCancel");y.is(":visible")&&y.css("height",I-w.outerHeight()-30).addClass("oA"),$("#availableCal").length>0&&$("#API_container").height(I-10)}setZiaVisionPageHeight()}if("undefined"!=typeof crmProfilePage&&(crmProfilePage.setInnerLeftPaneHeight(),$("#pfList_maincontent").length>0)){var L=$(window).width()-260;$("#pf_list_container").width(L)}if(t&&Lyte.registeredMixins["crm-client-portal-util"].portalResizeTabsFunc(),i&&Lyte.registeredMixins["crm-client-portal-util"].portalResizeFieldPermFunc(),a&&r&&Lyte.registeredMixins["crm-client-portal-util"].portalConfigPageFunc(),o&&n>0&&Lyte.registeredMixins["crm-client-portal-user-util"].portalConfigUsersPageFunc(),1==$("#builder_container").length){var b=renderingUtils.windowWidth;$("#tabLayer").hasClass("newTopbar")?CML.layoutWidth=b-299:CML.layoutWidth=-320,CML.layoutResize()}if($("#layout_landing_left").is(":visible")&&CML.layoutLandingResize(),"undefined"!=typeof CMB&&$("#setupshow").is(":visible")&&CMB.organizeModuleFieldsListScroll(),$(".validation-rule-container-inner").length>0){var k=renderingUtils.windowHeight,M=$(".validation-rule-container-inner"),T=k-M.offset().top-30;M.css("height",T)}var _=document.querySelectorAll("crm-setup");_.length&&_[0].component.showSetupScrollBtn()}function o(){var e=$(".convFlowShapesActive").attr("data-attr");networkUtils.loadFeatureScripts(["zohocrm_attributions.js"],(function(){Attribution.setHeightForAttribution(),Attribution.widthUpdate(),Attribution.updateShapesAfterAddStage(e),"U_SHAPE"===e||"W_SHAPE"===e?(Attribution.svgWidthHeightUpdate(),Attribution.generateAndInitializeShape(e),Attribution.drawTopLine(),$(".convFlowAddActive").is(":visible")&&Attribution.addStagePositioning(".convFlowAddActive"),$(".convFlowEditModActive").is(":visible")&&Attribution.addStagePositioning(".convFlowEditModActive",!1)):"LINEAR"!==e&&"TIME_DECAY"!==e||(Attribution.linearDecaySvgWidth(),Attribution.generateLineShape(),Attribution.drawTopLineLinearDecay())}))}function s(){var e=$("#setup_new_ContentDiv").outerHeight(),t=$("#zso_setup"),i=$("#zso_importContainer"),a=$("#kso_adminSettings");t.length&&t.css("height",e),i.length&&i.css("height",e),a.length&&a.css("height",e),$("#socAddToCrmPop").children().length&&zsoEntity.setTopValueForAddToCrmPopup(),$("#socViewConvPopup .socViewConvoParent").length&&zsoTab.setHeightForConvoPopup("Convo"),$("#socViewConvPopup .socViewMsgParent").length&&zsoTab.setHeightForConvoPopup("Msg")}function l(){if($(".zcrm-show, .showPpTop").is(":visible")){var e,t,i=renderingUtils.windowHeight,a=$("#rItemDataDiv"),r=a.css("display"),n=$("#feedsPreferenceDiv").css("display"),o=$("#addAggFldPopup").css("display"),s=$("#pickMapPopup:visible"),l=s.length,c=$(".entityNameLookupNew").length>0;if("block"===n&&(e=$("#feedsPreferenceDiv .feed_pref_info").outerHeight(),t=$("#feedsPreferenceDiv .notes_section").outerHeight()),"block"===o)var d=$("#addAggFldPopup .pp-header").outerHeight(),u=$("#addAggFldPopup .pp-footer").outerHeight();$("#popup-height-style,#popup-height-styles").remove();var m=i-175,p=i-230;if(l&&(p=i-s.find(".pp-header").outerHeight()-s.find(".pp-footer").outerHeight()-70),"block"===r){var g=i-100;a.css("max-height",g),$("#rItemDataSubDiv").css("max-height",g-95)}g=i-100;if($("#remainder-notifi").css("max-height",g),$("#remainderpopup").css("max-height",g-95),c)(m-=$("#entityLookupdiv .cvpadding").outerHeight())<120&&(m=120);if($('<style type="text/css" id="popup-height-style">.popup-model-content{ max-height:'+m+"px !important;}</style>").appendTo(document.head),"block"!==n)if("block"!==o){var h=$("#fieldtyperesult"),v=$("#fieldtyperesult2");1===v.find("#picklistFieldFPPopup").length&&(h=v);var f=$(".zb-email-popup"),C=h.find(".picklistFieldFPPopup");if(C.length>0){var I=h.find(".pp-header:visible").outerHeight(),y=h.find(".popup-model-footer:visible").outerHeight(),w=i-I-10;C.css({height:w+"px"});var L=C.outerHeight()-I-y;$('<style type="text/css" id="popup-height-styles">.pp-content.importDiv{ max-height:'+L+"px !important;min-height:"+L+"px !important;}</style>").appendTo(document.head)}f.length>0?f.css({"max-height":renderingUtils.windowHeight-60,padding:"0",overflow:"hidden"}):$('<style type="text/css" id="popup-height-styles">.pp-content{ max-height:'+p+"px !important;}</style>").appendTo(document.head);var b=h.find("#masterPickList");if(b.length>0){var k=b.find(".importDiv"),M=k.next().outerHeight(),T=k.outerHeight(),_=$L(".stageForecastNoteSection #stageForecastNote")[1],A=_?_.offsetHeight:"";b.parent().height(T+M+A)}}else $("#addAggFldFPPopup").css({"max-height":i-(d+u+215)});else $("#feedsPreferenceDiv .feeds_content .table_wrapper").css({"max-height":i-(e+t+300)})}}function c(){var e=$("#stageContain:not(.crmStageNoResize)");if(e.length&&null!=e){var t=$("#stageContain").find(".lineStage .order-step"),i=e.find(".lineStage");setWidthHeightStageObject(e,t,i)}}function d(){$("li.subformList").each((function(){var e=$(this),t=e.find(".subFormContainer"),i=e.find(".subFormShadowAddedRght"),a=e.find(".subFormContainerInner"),r=a.outerWidth(),n=Math.round(r-15);a.css("max-width",t.width()-($(".addSubFormFields").outerWidth()+1)),i.css("left",n),Crm.userDetails.RTL_ENABLED&&i.css("right",n),e.addClass("subFrmAct"),CrmSubform.subFormFldShadow(),$(".subFrmAct").find(".subFormContainerInner").animate({scrollLeft:0},0),e.removeClass("subFrmAct")}))}function u(){let e=$L("#userDetailView"),t=$L("#userlistview");if(e.length&&t.length){let i=parseInt($L("#setup_new_ContentDiv").css("height")),a=$L("#viewUserFrmAllUserstd .setup-space"),r=parseInt(a.css("padding-top"));r+=parseInt(a.css("margin-top")),r+=15;let n=i-r;e.css("max-height",n+"px").addClass("oA");let o=$L("#viewalluserstd .setup-space1"),s=parseInt(o.css("padding-top"));s+=parseInt(o.css("margin-top")),s+=parseInt($L("#users_listTbl").css("height")),s+=5,s+=15;let l=i-s;t.css("max-height",l+"px").addClass("oA")}}function m(){$(".abFormCreate").length>0&&Lyte.registeredMixins.webform.leftPanelHghtCal()}function p(){let e=$L(".new_setupview");var t=renderingUtils.windowWidth-$(".setupleftmenutd").width(),i=renderingUtils.getHeightFromTabLayer()-$("#abTestingViewHead").outerHeight()-parseFloat(e.css("padding-bottom"))-parseFloat(e.css("padding-top"))-5;$(".variantPrevListWrap").css("max-width",t),$("#abtesting_Preview, #abtesting_Analytics,#abT_analytics").css("height",i+"px"),$("#ABTestPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-2)}function g(){var e=$("#webformPrevHead");if(e.is(":visible")){var t=renderingUtils.getHeightFromTabLayer()-e.outerHeight();$("#webF_Preview").css("height",t),$("#WebFormPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-36)}}function h(){var e=renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight(),t=renderingUtils.windowHeight-(e+58),i=$("#pipelineHeaderDiv").outerHeight(),a=t-(i+$(".pipelineHeader").outerHeight()+$(".stageAddBtn").outerHeight()+55);$(".pipelineStagesList").css("max-height",a),$(".pipelineWraperInner").css("min-height",t-(i+15))}function v(){crmNTCGlobal.setNTCContainerHt(),crmNTCDetailView.SetSignalDetailHeight(),crmNTCGlobal.setNotificationHeight(),crmNTCDetailView.SetBcDivDetailHeight(),$("#signalPopupViewContent").is(":visible")&&$("#signalPopupViewContent").find("#feed_detail_outer_div").length&&crmNTCDetailView.socialDetailViewPopupHt(),$("#setupshow").is(":visible")&&$("#ntcSettingInnerScrollDiv").is(":visible")&&crmNTCSettings.resizeSignalSettings()}function f(){var e=$("#importContainer");if(e.length&&$("#ITF-container").is(":visible")){var t=$(".ITF-container"),i=$(window).height()-t.offset().top-$(".footerTableCon").height();t.height(i),Import.FixedHeaderFunct("ITF-container"),$(".ITF-container .itb-body-class").height(i-$(".ITF-container .itb-header-class").outerHeight()),Import.importFieldContainer()}if(e.length&&$("#createNewFieldlist").is(":visible")){var a=$(window),r=$("#createNewFieldlist"),n=a.height(),o=350;n>470&&(o=n-120),r.css({height:o},"z-index","100");var s=a.height()/2,l=r.innerHeight()/2;r.css({top:s-l});var c=r.height()-(r.find(".popup-model-header").outerHeight()+r.find(".popup-model-footer").outerHeight()),d=$("#createFieldTableDiv");d.css("max-height",c),Import.FixedHeaderFunct("createFieldTableDiv"),d.css("height",c);var u=$("#createFieldTableDiv .itb-body-class");u.css("height",c),u.height(d.height()-$("#createFieldTableDiv .itb-header-class table").outerHeight())}}function C(){$("#cobouterdiv").css({height:renderingUtils.windowOuterHeight-(renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+28),top:renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()}),$("#hd_inner_container").css({height:$("#helpdesk").outerHeight()-$("#cobouterdiv .mig_chatbar").outerHeight()-renderingUtils.tabLayerTop()-30})}function I(){if($("#customHome").is(":visible")){var e=$("#edit_section");if(1===e.length)return void e.css("height",$(window).height()-(e.offset().top+26));$("#customHome").css("height",$(window).height()-($("#customHome").offset().top+26)),CustomHomePage.setComponentSelectionDivHeight(!1),CrmDashboard.populateVisibleComponents("customHome")}}function y(){$("#analyticalPageContainer, #createDashboardPanel").length&&"block"===$("#analyticalPageContainer, #createDashboardPanel").css("display")&&CrmAnalytics.layoutResize()}function w(){if($("crm-home-blankpage:visible").length>0){if(Lyte.registeredMixins.onboarding.setOnboardingHomeHeight(),$("crm-onboarding-migration:visible").length>0)Lyte.registeredMixins.onboarding.setOnboardingMigrationHeight();else if($("onboarding-tour:visible").length>0){Lyte.registeredMixins.onboarding.setOnboardingTourHeight();var e=$(".showtourimage"),t=e.outerHeight();e.offset();$L("#img_container").css("height",t)}}else($("crm-leads-blankpage:visible").length>0||$("crm-contacts-blankpage:visible").length>0||$("crm-accounts-blankpage:visible").length>0||$("crm-deals-blankpage:visible").length>0||$("crm-activities-blankpage:visible").length>0||$("crm-activitysub-blankpage:visible").length>0)&&(Lyte.registeredMixins.onboarding.setHeight(),Lyte.registeredMixins.onboarding.setSameWidthtoBUttons(),Lyte.registeredMixins.onboarding.setSplitOrposition())}function L(){$L("crm-recommendation-gallery-comp .templateContainer").is(":visible")&&Lyte.registeredMixins["recommendation-util"].resizeGallaryPage(document.querySelector("crm-recommendation-gallery-comp"))}function b(){$L("crm-orchestration-builder").is(":visible")?(Lyte.registeredMixins.orchestration_builder.setBuilderHeight(),Lyte.registeredMixins.orchestration_builder.setTabBodyHeight()):$L("crm-orchestration-reports").is(":visible")&&(Lyte.registeredMixins.orchestration_report.setReportContainerHeight(),Lyte.registeredMixins.orchestration_report.reRenderCharts())}function k(){if($("#z_editor").is(":visible")){var e=editor.zEditor;e&&($L(".email_option_dropbox").is(":visible")||$(e.body[0]).trigger("click"),$(e.document).trigger("click"),$(e.z_doc).trigger("click"))}}function M(){var e=$L("#UsersMenuListDiv").closest("table").outerWidth()-90-($L("#adduserbutton").outerWidth()+$L("#importUsers").outerWidth());e<=230&&$L("#userlistCV").css({"min-width":e-35+"px","max-width":e+"px"})}return{All:function(){var T,_,A,S;if(Crm.isHeadless||("crm.tab.module.custom-view.list"!==(Lyte&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().transition?Lyte.Router.getRouteInstance().transition.info.route:void 0)&&(renderingUtils.resizeWindowHW(),renderingUtils.tableSorter("listViewTable","2",""),crmListView.bindPerfectScrollbar(),renderingUtils.windowHeight=$(window).height(),$("#stageViewContainer").length&&crmListView.setWHforStageView(),$("#taskKanbanViewContainer").length&&setTimeout((function(){TaskKanbanView.setlayoutHt(".leftContainerctn"),null!=$("#taskKanbanViewContainer").height()&&TaskKanbanView.setkanbanTaskHt(),taskDetailsview.setComposeWindow()}),500),renderingUtils.resizeWindowHW(),$("#merge-field-mapping-list").length&&crmDeduplicate.setheader(),$("#deduplicatemergefield").length&&crmDeduplicate.fixedHeaderDedpulicate(),$("#idForCV").length&&$("#columnListId").length&&$("#columnListId").css({"min-height":"0px","max-height":$(window).height()-($("#addColumn").offset().top+$("#wmstoolbar").outerHeight()+36+$("#addColumn").outerHeight())-120})),e(),t(),i(),r(),n(),l(),$("#dayLeft").length&&(thirdPartyUtils.unbindFullcalendar($("#calendarBd").parent()),$("#calendarBd").html(""),crmCalendarReady()),s(),$("#LDPOP").is(":visible")&&CrmTracking.popupState&&CrmTracking.initPerfectscroll(),C(),function(){if($("#processBuilderContain").length){var e=renderingUtils.tabLayerTop(),t=renderingUtils.tabLayerOuterHeight(),i=0;if($("#annoncement").is(":visible")&&(t+=$("#annoncement").outerHeight()),featuresAvailable.NEXTGENUI_ENABLED){var a=$L(".ts-fxd-sc");i=a&&a.length>0?a.outerWidth():64}var r=$("#canvasContainer"),n=$("#pb_dragAndDropBox"),o=1==$("#wmstoolbar").is(":visible")?$("#wmstoolbar").outerHeight():28,s=$(window).height()-(t+o),l=renderingUtils.windowOuterWidth-(480+i),c=l/2-200,d=$("#pb_all_saveCancel"),u=(s-d.outerHeight())/2-200;$("#setup_new_ContentDiv").height(s),$("#processDropCanvas").css({height:s-1,width:l}),d.css({width:l}),r.css({height:s,width:l}),n.css({left:c,top:u}),$(".pb_property_toll").css({width:480,height:s,top:t+e+"px"});var m=s-51;$(".pb_transitionInfo, .pb_processInfo").css({height:m}),ProcessBuilder.setFieldDivHeight()}}(),v(),f(),1!=Crm.userDetails.detailView_newUI&&crmBstTime.setPosition(),I(),c(),"undefined"!=typeof sandbox&&sandbox.sandboxListResize(),function(){if($(".lookupListTable").is(":visible")){var e=renderingUtils.windowWidth/100*5;$(".lookupListTable .lyteModal").css({right:e,left:e,width:"auto"});var t=renderingUtils.windowHeight/2;$(".entityLookupTable").css("max-height",t),hideAnimatePopup("columnList"),sE()}}(),_=$("crm-image-preview"),$(".imagePreviewParent").is(":visible")&&!1===_[0].component.data.zoomConfiguration.imageZoomState?_[0].component.calculateInitialImageSize():$(".uploadPlatform").is(":visible")&&$("crm-image-upload-picker")[0].component.calculatePickUI(),o(),$("#dataPrivacyContainerDiv").is(":visible")&&DataPrivacy.privacyLayoutResizeDV(),w(),b(),k(),L(),m(),p(),g(),(T=(T=document.querySelector("crm-admin-email-sharing"))||document.querySelector("crm-admin-email-sharing-preference"))&&T.component.emailSharingHeight()),a(),y(),function(){if($("#cv_ctn").length){var e=$("#outerTable"),t=e.offset().top,i=$("#cvbutton").outerHeight(),a=renderingUtils.windowHeight-(t+i);e.height(a)}}(),(A=$L("crm-scoringrule-details")).is(":visible")&&A[0].component.calcTableHeight(),(S=$L("#zBSColumnChart")).length&&S.find(".d3container")[0].__data__.redraw(),function(){var e=$L(".depLogsHistoryCont");if(e&&e.length){var t=e.offset().top,i=$L("#wmstoolbar").height(),a=document.querySelector("crm-sandbox-deploymentlogs"),r=renderingUtils.windowHeight-(t+i+17);a.setData("logsContentHeight",r)}}(),u(),"function"==typeof template.setlistViewPage&&template.setlistViewPage(),"function"==typeof template.setEditorHtResize&&template.setEditorHtResize(),"function"==typeof template.setContainerHt&&template.setContainerHt("galleryCtn","templateGalleySection"),"function"==typeof template.listViewPreviewFrameHt&&$("#previewIframe").length>0&&template.listViewPreviewFrameHt(),"function"==typeof template.previewAttachPos&&template.previewAttachPos(),"function"==typeof editorHt&&editorHt(),$("#crmNewTemplate").length>0&&template.isTemplateEditorEnabled&&$("#emailEditor").length>0&&"function"==typeof $("#emailEditor")[0].contentWindow.elemPositionFunc&&$("#emailEditor")[0].contentWindow.elemPositionFunc(),$("#conditionalFieldContainer .conditionalFieldinner").length){var P=$(window).height()-$("#show").offset().top-30;$(".conditionalFieldinner").css("height",P)}$(".userLookup:visible")&&$(".userLookup:visible").length>0&&($(".userLookup").hide(),$(".popup-model-content,.pp-content").removeClass("oH")),$("li.subformList").length>0&&d(),$(".subFrmTablWrapper").length>0&&crmTemplate.subFrmLeftRightMask(),$(".fieldLeftCountDiv").length>0&&$(".fieldLeftCountDiv").css("max-height",renderingUtils.windowHeight-150),$("crm-templates-view").length&&$("crm-templates-view")[0].component.previewPopSetHt.call(this,"#galleryTemplatePreview"),$("crm-templates-view").length&&$("crm-templates-view")[0].component.setContainerHt.call(this,"galleryCtn","templateGalleySection");var E=$(".customUserDiv");E.is(":visible")&&E.hide(),(E=$(".customChannelDiv")).is(":visible")&&E.hide(),$(".pipelineWraperOuter").length&&h(),$L("#importUsers").length&&M()},Home:e,blankPageOnboardingResize:w,customHome:I,DetailpageResize:t,DetailpageResizeRevamp:i,Dashboard:a,ReportsResize:r,Setup:n,PopupHeightResize:l,socialResize:s,signalsResize:v,importResize:f,COBresize:C,aDashboarResize:y,subFrmResize:d,setWidthHeightStage:c,marketingAttribution:o,orchestrationResize:b,recommendationResize:L,aBTestleftPanelHghtCal:m,usersPageResize:u,aBTestingPreviewCal:p,webformPreviewCal:g,pipelineStagesHght:h,importUsersWidth:M,composeEditorResize:k}}();var crmTab={redirectToSalesInbox:void 0,isMailClientActive:!1,isMailClientEnabled:!1,selectedTab:void 0,tabCount:void 0,tabList:void 0,tabVsSubTabs:{},li:void 0,liSelected:void 0,countCache:{},cacheObj:{},filterCache:{},isZBCustomModule:function(e){return["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005"].indexOf(e)>=0},isZECustomModule:function(e){return["CustomModule5006","CustomModule5007","CustomModule5008"].indexOf(e)>=0},isZSCustomModule:function(e){return["CustomModule5009","CustomModule5010"].indexOf(e)>=0},isOrchestrationModule:function(e){return e.indexOf("Orchestration")>=0},isZCpqTab:function(e){return["Quotes","SalesOrders","PurchaseOrders","Invoices"].indexOf(e)>=0},isZCpqSubTab:function(e){return["Products","PriceBooks","Bundles"].indexOf(e)>=0},getFirstZBModule:function(e){if(!moduleRecordMapping[e].viewable){var t=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}));t.length>0&&(e=t[0].module_name)}return e},isZBStatusColumn:function(e){return["COBJ5001CF5","COBJ5002CF5","COBJ5003CF5","COBJ5004CF5"].indexOf(e)>=0},isZInvoiceCustomModule:function(e){return["CustomModule5001","CustomModule5002","CustomModule5005"].indexOf(e)>=0},isBooksIntegrated:function(){return this.tabList.contains("Zoho Books")},isInvoiceIntegrated:function(){return this.tabList.contains("Zoho Invoice")},isZExpenseSubModule:function(e){return["CustomModule5006","CustomModule5007"].indexOf(e)>=0},isLinkingModule:function(e){return e&&e.indexOf("LinkingModule")>-1},removeOrShowZBTabLayer:function(e){var t=$("#zbModuleTabLayer");t.css("display",e?"inline-block":"none"),featuresAvailable.NEXTGENUI_ENABLED||t.css({"margin-bottom":"-2px",width:"100%"})},removeOrShowZInvoiceTabLayer:function(e){var t=$("#zInvoiceModuleTabLayer");t.css("display",e?"inline-block":"none"),t.css({"margin-bottom":"-6px",width:"100%"})},removeOrShowZExpenseTabLayer:function(e){$("#zohoExpenseTabLayer").css("display",e?"block":"none")},putInCache:function(e,t){this.cacheObj[e]=t},putFiltersInCache:function(e,t){this.filterCache[e]=t},getFiltersFromCache:function(e){return this.filterCache[e]},getFromCache:function(e){return this.cacheObj[e]},checkPresenceInCache:function(e){return Crm.isActivitySplitDone||"Tasks"!=e&&"Calls"!=e&&"Events"!=e||(e="Activities"),!!this.cacheObj[e]},deleteFromCache:function(e,t){if("Tasks"!=e&&"Calls"!=e&&"Events"!=e||Lyte.Router&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().parent.parent&&"Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()&&(e="Activities"),delete this.cacheObj[e],!t&&Lyte.Router.getRouteInstance()&&"detail"===Lyte.Router.getRouteInstance().routeName)return Lyte.Router.getRouteInstance().transition.data||(Lyte.Router.getRouteInstance().transition.data={}),void(Lyte.Router.getRouteInstance().transition.data.needClearCache=!0);if(moduleRecordMapping[e]){var i=moduleRecordMapping[e].id;store.modelFor(i)&&store.unloadAll(i)}},deleteFromCacheCount:function(e,t){this.countCache[e]&&delete this.countCache[e][t]},emptyCache:function(e){this.cacheObj&&this.cacheObj[e]?delete this.cacheObj[e]:this.cacheObj={}},clickEventIdVsMethodMapping:{sortingRecords:"crmListView.recordChange",navigate_previous:"Crm.lyteTransition",navigate_next:"Crm.lyteTransition",changeOption:"Crm.lyteTransition"},updateTabContent:function(e){!Crm.isActivitySplitDone&&Crm.activityGrp[e]&&(e=Crm.activityGrp[e]),moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[e]&&moduleRecordMapping[e].parent_module&&moduleRecordMapping[e].parent_module.module_name===moduleRecordMapping.ZohoCPQ.module_name&&(e=moduleRecordMapping.ZohoCPQ.module_name),crmplusImplTriggerActions("selectEntity",["module",featuresAvailable.NEXTGENUI_ENABLED?"modules":e])},getDisplayName:function(e,t){var i;"Zoho Finance"!=e&&"Zoho Books"!=e&&"Zoho Invoice"!=e||(crmTab.isBooksIntegrated()?(e="Zoho Books",i=I18n.getMsg("Zoho")):e="Zoho Invoice");var a=Crm.userDetails.MODULE_LIST[e];if(a)return a.modified_by?(t?a.singular_label:a.plural_label)||"":(t?I18n.getMsg(a.singular_label,i):I18n.getMsg(a.plural_label,i))||""},reloadTabMenu:function(e,t){var i,a="undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&"undefined"!=typeof CrmPlusLib,r=new Promise((function(e){var t=Crm.getCrmBasePath()+"/RefreshMenu.do";a&&(t+="?loadCrmPlusTabJSON=true"),(new crmRequestPool).doAjax(t,(function(t){var i=document.getElementById("tabLayer"),a=document.createElement("div");a.innerHTML=t,$L("#createsubmenu").length>0&&a.children.createsubmenu&&$("#createsubmenu").html(a.children.createsubmenu.innerHTML),EvalInnerScript(a,i),e(t)}))}));e&&(i=store.findAll("module")),store.unloadAll("feature_supported_modules"),store.unloadAll("tab_group"),Lyte.resolvePromises([r,i]).then((function(){featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED?document.querySelector("crm-left-menu").component.executeMethod("reRenderTeamspace"):store.findAll("tab_group").then((function(e){if(featuresAvailable.NEXTGENUI_ENABLED){var i=document.querySelector("crm-left-menu").component;i.executeMethod("reRenderTabGroups",i)}else{for(var a,r=e.length,n=0;n<r;n++)if(e[n].default){a=e[n].modules.sortBy("sequence_number");break}if(document.getElementsByTagName("crm-tab")[0].setData("tabModules",a),t){var o=document.getElementsByTagName("crm-tab-group");o[0].setData("tabGroupsName",e),o[0].setData("rendered",!0)}var s=document.querySelector("crm-menu");s&&(r>1?s.setData("showTabGroup",!0):s.setData("showTabGroup",!1))}}));if(reloadMenuData(),a&&($("#mainMenuTabDiv").addClass("mainMenuTabDiv"),$("#ThemesContainer").hide(),"undefined"!=typeof crmPlusModule)){var e=["module",crmPlusModule];CrmPlusImpl.trigger("modifyUI",e);var i=["addrecordoption",crmPlusAddRecOption];CrmPlusImpl.trigger("modifyUI",i)}}))},clearAdwordCache:function(e){var t=!1,i=new Array("accId","campId","gid","zgid","kid","adid");for(obj in i)i[obj]==e&&(t=!0),t&&(adwordParams[i[obj]]="")}};function reloadMenuData(){var e=["isSandboxAcc","showEdition","cvPermission","showMailMagnet","newMailCount","isTrialEnable","zohoBundleOrgHasPermission","zohoBundleOrgPaymentLink","zohoBundleOrgResult","zorgHasPermission","zorgPaymentLink","zorgResult","isFreeEdtionWithAddon","isZohoOneUser","isCrmPlusUser","elseResult","logoutURL","isJiveSignup","trialCount","usersCount","firstTimeTrialFromSetup","notPbxVendor","isMultipleTrialProvisionDisabled"],t={},i=document.getElementsByTagName("crm-menu")[0];if(i){for(var a=e.length,r=0;r<a;r++)t[e[r]]=window[e[r]];i.setData(t)}}var Activities={moduleName:"Activities",isRequestSent:!1,currentStatus:void 0,selectedIds:0,reminderCount:0,reminderList:"",keyVsFieldLabel:void 0,init:function(){Handlebars.registerPartial("singleReminder",Handlebars.templates.singleReminder),Activities.reminderTemplate=Handlebars.templates.ActivityReminder,Activities.detaildivTemplate=Handlebars.compile('<div class="rmindrdet-type clearFix" style="display: none;"><span class="remLabel">{{{fieldLabel}}}</span>-<span class="remValue">{{{fieldvalue}}}</span></div>'),Activities.currentDiv=Handlebars.templates.singleReminder},makeRequest:function(e,t,i,a){Activities.isRequestSent=!0;var r=new crmRequestPool;t=csrfParamName+"="+encodeURIComponent(csrfToken);r.initiate({action:e,type:"POST",data:t,success:function(e){var t=networkUtils.returnDependencyFiles(["zohocrm_SAReminder.js"],ResourceConstants.CRM);Lyte.injectResources(t,void 0,(function(){if(Activities.isRequestSent=!1,"show"===i){var t="",r=$(".remindertemp").length;null==Activities.reminderTemplate&&Activities.init(),Activities.keyVsFieldLabel=e.keyVsFieldLabel,e&&e.details&&(e=crmBstTime.populateActivityReminderBestTime(e.details)),t=Activities.reminderTemplate(e);for(var n=0,o=e.length,s=0;s<o;s++)n+=e[s].length;Activities.reminderCount=Activities.reminderCount+n;var l="#notificationCount";$(l).text(Activities.reminderCount).show(),Activities.notifyCountToCrmPlusFrame(Activities.reminderCount),n>=25&&($(l).text(Activities.reminderCount+"+").show(),t=t+'<div class="mT5 mB5 pT10 aligncenter cP" id="viewMoreAct"><div onclick="Activities.constructReminder(null)">'+I18n.getMsg("crm.nsocial.tab.view.more")+"</div></div>");var c="#viewMoreAct";$(c).length>0&&$(c).remove();var d=$("#reminderContent");if(d.append(t),$("#currentEvt").length>0){var u=$(".remainderList")[0],m=$(".remainderList")[1];for(s=1;s<u.children.length-1;s++)id=u.children[s].id,$(m).find($("li[id='"+id+"']")).remove(),$(m).children().length<3&&m.remove()}$(".remainder-notifi").slideDown(),0==$(".remindertemp").length&&($("#notificationCount").hide(),d.html("<div id='noReminder' class='pB20 pL20'>"+I18n.getMsg("crm.module.empty.message",I18n.getMsg("crm.activity.reminder"))+"</div>")),thirdPartyUtils.bindPerfectScroll("#remainderpopup",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1}),$("#remainderpopup").addClass("oH");var p=$(".remindertemp");for(o=e.length,s=0;s<o;s++)for(var g=0;g<e[s].length;g++)Activities.reminderList=Activities.reminderList+e[s][g].activityId+";",p.eq(r).data("details",e[s][g]),r++;$("#reminder_notification").hide()}else"dismiss"===i?"success"==e&&(Activities.selectedIds=0,Activities.showHideReminderDetail()):"later"===i&&$("#errorMsg").text(e).show().fadeOut(4e3);null!=a&&"function"==typeof a&&a()}))},error:function(e){Activities.isRequestSent=!1,e.responseText&&(555==e.status?$("#errorMsg").text(e.responseText).show().fadeOut(4e3):550==e.status&&$(".timericon").css("display","none"))}})},constructReminder:function(e){var t=0,i=26;0!=Activities.reminderCount&&(i+=t=Activities.reminderCount+1);var a=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=showreminder&fromIndex="+t+"&toIndex="+i;this.makeRequest(a,null,"show",e)},showMoreDetails:function(e){if($(e).hasClass("remainderactive"))return $(e).removeClass("remainderactive"),!1;$(".remainder-notifi").show(),Activities.showHideReminderDetail(),$(e).addClass("remainderactive");var t="",i=$(e).data("details");$.each(i,(function(e,a){if(Activities.keyVsFieldLabel[e])if("Meeting_Venue"===e){if("Client location"===a||"In-office"===a)var r={fieldLabel:i.Meeting_Venue,fieldvalue:i.Location};else r={fieldLabel:i.Meeting_Venue,fieldvalue:i.Provider};t+=Activities.detaildivTemplate(r)}else{r={fieldLabel:e=Activities.keyVsFieldLabel[e],fieldvalue:a};t+=Activities.detaildivTemplate(r)}else{var n=i.module;if("relatedTo"===e||"relatedCont"===e){var o=a.seModule;a='<a  class="crm-font-bold crmBaseColor"  href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module="+a.seModule+"&id="+a.id+'" target="_blank">'+a.name+"</a>",e=I18n.getMsg("crm.right.related.module",moduleRecordMapping[o].singular_label);r={fieldLabel:$ESAPI.encoder().encodeForHTML(e),fieldvalue:a};t+=Activities.detaildivTemplate(r)}else if("Events"!=n&&"Calls"!=n||"dueDate"!=e){if("Appointments"==n&&("serviceName"==e||"appointmentFor"==e||"HOSTNAMEVAL"==e||"appointmentLocation"==e)){"serviceName"==e?e=I18n.getMsg("crm.appointmentreminder.servicename"):"appointmentFor"==e?e=I18n.getMsg("crm.appointmentreminder.line5"):"HOSTNAMEVAL"==e?e=I18n.getMsg("crm.appointmentreminder.appointmentowner"):"appointmentLocation"==e&&(e=I18n.getMsg("crm.appointmentreminder.line7"));r={fieldLabel:e,fieldvalue:a};t+=Activities.detaildivTemplate(r)}}else{e="startTime",a=a.split("-")[0],n=i.sing_moduleName,e=I18n.getMsg("crm.label.call.start.time",I18n.getMsg(n)),"Appointment"==n&&(e=I18n.getMsg("crm.appointmentreminder.line3"));var r={fieldLabel:e,fieldvalue:a};t+=Activities.detaildivTemplate(r)}}})),$(t).addClass("remainderactive"),$(e).append(t).find(".rmindrdet-type").slideDown(200)},showHideRemainder:function(e){crmui.fromCloseOther||crmui.closeOtherWMSBars("reminder");var t=$L("#predictedPopover",$L("crm-target-deals-popover"));t&&t.length&&"INPUT"!=document.activeElement.nodeName&&t[0].ltProp("show",!1);var i=$L("crm-accessibility-shortcut")[0];i&&i.component.getData("showModal")&&i.component.setData("showModal",!1),Crm.menu.globalHideMenu(),hideFeedBackPopup(),massActionNotification.hideMassOperationProgressDiv(),crmNTCGlobal.closeGlobalNotifications();var a=$("#reminderContent").html(),r=$("#remainder-notifi");if(r.is(":visible"))Activities.RemainderHideOnly(),Crm.sharedworker.makeRequest("trigger","trigger","Activities.RemainderHideOnly");else if(null!=a&&""==a.trim())$(".timericon").addClass("footIconActive timericonAct"),this.constructReminder((function(){$("#noReminder").length>0?$(".remainder-notifi").hide():setTimeout((function(){$(".timericon").addClass("footIconActive timericonAct"),$("#reminder_notification").hide()}),2e3),crmui.fromFooter("remainder-notifi")}));else{if(document.getElementById("remainder-notifi")){var n=r[0].style.bottom;n||(n=r.outerHeight()-(isChatEnabled||Crm.userDetails.CLIENT_ACCOUNT?26:0),r.css({bottom:"-"+n+"px"})),r.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),crmui.fromFooter("remainder-notifi"),$(".timericon").addClass("footIconActive timericonAct"),null!=e&&"function"==typeof e&&e(),$("#reminder_notification").hide()}crmui.WMSBarOpened(r[0])}},RemainderHideOnly:function(){var e="#notificationCount";"0"!==$(e).text()&&$("#reminder_notification").text($(e).text()).show(),crmui.toFooter("remainder-notifi"),$(".timericon").removeClass("footIconActive timericonAct"),Activities.showHideReminderDetail()},showHideReminderDetail:function(){var e=".remainderdet-wrap";$(e).length>0&&$(e).is(":visible")&&($(e).remove(),$("ul li").removeClass("remainderactive")),$(".remainderactive").length>0&&$("ul li").removeClass("remainderactive"),$("#remainderpopup").find(".rmindrdet-type").length>0&&$(".rmindrdet-type").slideUp(200,(function(){$(this).remove()}))},dismissReminder:function(e){if(e||(e=Activities.getSelectedIds())){var t=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=dismiss&idList="+e;this.makeRequest(t,void 0,"dismiss",(function(){var t={id:e};Activities.removeDismissedActivities(e),Crm.sharedworker.makeRequest("trigger","trigger","Activities.removeDismissedActivities",t)}))}},laterReminder:function(e,t){var i=document.getElementById("laterRemind_"+e);if("Tasks"===t){var a=[{colname:"RemindLater_Start_Date1",customfield:"false",displaylabel:"Remind At",label:"Start Date",mandate:"false",maxlength:"120",readonly:"false",type:"Date",uitype:"786",defaultvalue:new Date}],r="#RemindLaterdiv";if($(r).length<=0){crmTemplate.createSubFields(t,i,"RemindLaterdiv",a),$("#Crm_Tasks_RemindLater_Start_Date1").data("mandate",!0);var n='<div class="p10 alignRight"><button type="button" class="primarybtn" onclick="Activities.validateReminder(\''+e+"');sE(event);\">"+I18n.getMsg("crm.button.ok")+"</button>";n+='<button type="button" class="newgraybtn" onclick="Activities.cancelReminder();sE(event);">'+I18n.getMsg("crm.button.cancel")+"</button></div>",$(r).append(n)}else $(r).show();$("#actionButton").hide(),setTimeout((function(){$("#Crm_Tasks_RemindLater_Start_Date1_TimeOption_List").css("z-index","250"),$("#Crm_Tasks_RemindLater_Start_Date1").focus()}),1e3);var o=$(".remainderdet-wrap").offset().top;$(".remainderdet-wrap").css({top:o-55})}else{var s=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=later&id="+e+"&module="+t;this.makeRequest(s,void 0,"later",(function(){setTimeout((function(){var t={id:e};Activities.showHideReminderDetail(),Activities.removeDismissedActivities(e),Crm.sharedworker.makeRequest("trigger","trigger","Activities.laterReminderHide",t)}),1e3)}))}},cancelReminder:function(){$("#actionButton").show(),$("#RemindLaterdiv").hide();var e=$(".remainderdet-wrap").offset().top;$(".remainderdet-wrap").css({top:e+55})},validateReminder:function(e){var t="#Crm_Tasks_RemindLater_Start_Date1_TimeOption",i=$(t).val().split(" ")[0],a=Utils.getMeridiem($(t).timeEntry("getTime")).toUpperCase();Activities.laterReminder(e,"Tasks&Date="+Crm_Tasks_RemindLater_Start_Date1.value+"&Time="+i+" "+a)},showHideBulkDismiss:function(e){renderingUtils.stopEvent(event);var t="#checkAllRecord";$(e).prop("checked")?(Activities.selectedIds++,$(e).parent().addClass("remindSelctBg"),$("#reminder_bulkdismiss").show().find('input[value="Dismiss"]').show(),$(t).prop("checked",!1),$("#reminderContent").find('input[type="checkbox"]:checked').length==$("#reminderContent").find('input[type="checkbox"]').length&&$(t).prop("checked",!0)):(Activities.selectedIds--,$(e).parent().removeClass("remindSelctBg"),0===Activities.selectedIds&&$("#reminder_bulkdismiss").hide(),$(t).is(":checked")&&$(t).prop("checked",!1))},getSelectedIds:function(){var e=$("#reminderContent").find('input[type="checkbox"]:checked'),t=e.length,i="";if(0===t)return $("#reminder_bulkdismiss").hide(),i;i=e.eq(0).attr("id").replace("chk_","");for(var a=1;a<t;a++)i=i+","+e.eq(a).attr("id").replace("chk_","");return i},removeDismissedActivities:function(e){$("#reminder_bulkdismiss").hide();for(var t=0,i=(e=e.split(",")).length,a=0;a<i;a++){var r=$("li[id='"+e[a]+"']").closest("ul");$("li[id='"+e[a]+"']").length>0&&($("li[id='"+e[a]+"']").remove(),t++),r.children().length<3&&r.remove()}var n=Activities.reminderCount-t,o="#notificationCount",s="#reminder_notification";$(o).html().indexOf("+")>-1?$(o).html(n+"+"):($(o).html(n),$(s).html(n)),Activities.reminderCount=n,Activities.notifyCountToCrmPlusFrame(n),0===$(".remainderList").length&&0===$("#viewMoreAct").length?($(s).hide(),$(o).hide(),$("#reminderContent").html("<div id='noReminder' class='pB20 pL20'>"+I18n.getMsg("crm.module.empty.message",I18n.getMsg("crm.activity.reminder"))+"</div>")):0==$(".remainderList").length&&0!=$("#viewMoreAct").length&&this.constructReminder()},checkAll:function(){var e=$("#reminderContent").find('input[type="checkbox"]'),t=".remindertemp";$("#checkAllRecord").is(":checked")?($(t).addClass("remindSelctBg"),$("#reminder_bulkdismiss").find('input[value="Dismiss"]').show(),$(e).prop("checked",!0),this.selectedIds=$(e).length):($(t).removeClass("remindSelctBg"),$(e).prop("checked",!1),$("#reminder_bulkdismiss").find('input[value="Dismiss"]').hide(),this.selectedIds=0)},checkForReminderDate:function(e,t){var i=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=checkReminderDate";e[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:i,type:"POST",data:e,success:t})},checkForTaskReminderDate:function(e,t){var i=new Date(e.date),a=e.ampm,r=e.hour,n=e.minute,o=e.eventBefore;a&&a.includes("PM")&&(r=(parseInt(r)+12).toString());var s,l=Crm.userDetails.TIME_ZONE.substring(0,1)+6e4*(60*parseInt(Crm.userDetails.TIME_ZONE.substring(1).split(".")[0])+parseInt(Crm.userDetails.TIME_ZONE.substring(1).split(".")[1])),c=new Date,d=c.getTime()+6e4*c.getTimezoneOffset()+61e3,u=Utils.getDateInGivenPattern(i,"yyyy-mm-dd").split("-"),m=new Date(u[0],parseInt(u[1])-1,u[2],r,n,"00","000");if(""==o.trim())(s=m.getTime()-parseInt(l))<d;else{var p=o.split(" ")[0],g=o.split(" ")[1];if("days"==g){var h=24*parseInt(p)*60*60*1e3;s=m.getTime()-parseInt(l)-h}else if("weeks"==g){h=7*parseInt(p)*24*60*60*1e3;s=m.getTime()-parseInt(l)-h}else if("months"==g)if(Activities.monthLastDay(m)){var v=m.getMonth()-parseInt(p);s=new Date(m.getFullYear(),v+1,0,r,n,"00","000").getTime()}else m.setMonth(m.getMonth()-parseInt(p)),s=m.getTime()-parseInt(l)}t((s<d).toString())},resetReminderSection:function(){var e=$("#notificationCount").text();$("#reminder_notification").text(e).show(),$(".remainder-notifi").slideUp(),$(".timericon").removeClass("footIconActive timericonAct"),Activities.notifyCountToCrmPlusFrame(e),$("#reminderContent").empty(),Activities.reminderCount=0,Activities.reminderList=""},monthLastDay:function(e){return new Date(e.getYear(),e.getMonth()+1,0).getDate()==e.getDate()},notifyCountToCrmPlusFrame:function(e){isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["reminder",e])},convertRecurringPatternToReadableFormat:function(e){if(e){for(var t={},i=e.split(";"),a=i.length,r=0;r<a;r++)t[i[r].split("=")[0]]=i[r].split("=")[1];var n,o=t.FREQ,s=t.INTERVAL,l=t.COUNT?t.COUNT:void 0,c=t.UNTIL?t.UNTIL:void 0;"-1"===c?n=1:l?n=2:(n=3,c=Utils.getDateInUserDatePattern($L.moment(c).toDate()));var d="";switch(o){case"DAILY":d="1"===s?1===n?I18n.getMsg("crm.recurrence.daily.option1"):2===n?I18n.getMsg("crm.recurrence.daily.option1.end2",l):I18n.getMsg("crm.recurrence.daily.option1.end3",c):1===n?I18n.getMsg("crm.recurrence.daily.custom.option1",s):2===n?I18n.getMsg("crm.recurrence.daily.custom.option1.end2",[s,l]):I18n.getMsg("crm.recurrence.daily.custom.option1.end3",[s,c]);break;case"WEEKLY":var u=[],m=t.BYDAY,p=["SU","MO","TU","WE","TH","FR","SA"];if(m){for(var g=m.split(","),h=g.length,v=0;v<h;v++){var f=p.indexOf(g[v])+1;u.includes(parseInt(f))||u.push(f)}var C=[];for(r=1;r<8;r++)u.includes(r)&&C.push(r)}if(1===C.length&&"1"===s)d=1===n?I18n.getMsg("crm.recurrence.week.option1"):2===n?I18n.getMsg("crm.recurrence.week.option1.end2",l):I18n.getMsg("crm.recurrence.week.option1.end3",c);else{p="";var I=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],y=C.length,w=!1,L=[0,0,0,0,0,0,0,0];if(y>4&&7!==y){w=!0;for(var b=0;b<y;b++)L[C[b]-1]=1}if(w)for(var k=0;k<7;k++)L[k]||(p=p+I[k]+",");else for(r=0;r<y;r++)p=p+I[C[r]-1]+",";p=p.substring(0,p.length-1),d="1"===s?w?1===n?I18n.getMsg("crm.recurrence.week.except.custom.option1",p):2===n?I18n.getMsg("crm.recurrence.week.except.custom.option1.end2",[p,l]):I18n.getMsg("crm.recurrence.week.except.custom.option1.end3",[p,c]):1===n?I18n.getMsg("crm.recurrence.week.custom.option1",p):2===n?I18n.getMsg("crm.recurrence.week.custom.option1.end2",[p,l]):I18n.getMsg("crm.recurrence.week.custom.option1.end3",[p,c]):w?1===n?I18n.getMsg("crm.recurrence.week.except.custom.option2",[s,p]):2===n?I18n.getMsg("crm.recurrence.week.except.custom.option2.end2",[s,p,l]):I18n.getMsg("crm.recurrence.week.except.custom.option2.end3",[s,p,c]):1===n?I18n.getMsg("crm.recurrence.week.custom.option2",[s,p]):2===n?I18n.getMsg("crm.recurrence.week.custom.option2.end2",[s,p,l]):I18n.getMsg("crm.recurrence.week.custom.option2.end3",[s,p,c])}break;case"MONTHLY":var M=(S=t.BYMONTHDAY)?1:2;if(1===M&&"1"===s)d=1===n?I18n.getMsg("crm.recurrence.month.option1"):2===n?I18n.getMsg("crm.recurrence.month.option1.end2",l):I18n.getMsg("crm.recurrence.month.option1.end3",c);else if(1===M){var T=S;d=1===n?I18n.getMsg("crm.recurrence.month.custom.option1.recur",[s,T]):2===n?I18n.getMsg("crm.recurrence.month.custom.option1.recur.end2",[s,T,l]):I18n.getMsg("crm.recurrence.month.custom.option1.recur.end3",[s,T,c])}else{var $=t.BYDAY;p=["SU","MO","TU","WE","TH","FR","SA"];S=t.BYSETPOS;var _=p.indexOf($)+1;S="-1"===S?"5":S;var A=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercaselast")];I=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];d="1"===s?1===n?I18n.getMsg("crm.recurrence.month.custom.option2",[A[S-1],I[_-1]]):2===n?I18n.getMsg("crm.recurrence.month.custom.option2.end2",[A[S-1],I[_-1],l]):I18n.getMsg("crm.recurrence.month.custom.option2.end3",[A[S-1],I[_-1],c]):1===n?I18n.getMsg("crm.recurrence.month.custom.option2.recur",[s,A[S-1],I[_-1]]):2===n?I18n.getMsg("crm.recurrence.month.custom.option2.recur.end2",[s,A[S-1],I[_-1],l]):I18n.getMsg("crm.recurrence.month.custom.option2.recur.end3",[s,A[S-1],I[_-1],c])}break;case"YEARLY":var S=t.BYMONTHDAY,P=parseInt(t.BYMONTH)-1;if(1===(S?1:2))d=1===n?I18n.getMsg("crm.recurrence.yearly.option1"):2===n?I18n.getMsg("crm.recurrence.yearly.option1.end2",l):I18n.getMsg("crm.recurrence.yearly.option1.end3",c);else{$=t.BYDAY;p=["SU","MO","TU","WE","TH","FR","SA"],S=t.BYSETPOS;_=p.indexOf($)+1,A=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercaselast")],I=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];var E=[I18n.getMsg("January"),I18n.getMsg("February"),I18n.getMsg("March"),I18n.getMsg("April"),I18n.getMsg("May"),I18n.getMsg("June"),I18n.getMsg("July"),I18n.getMsg("August"),I18n.getMsg("September"),I18n.getMsg("October"),I18n.getMsg("November"),I18n.getMsg("December")];S="-1"===S?"5":S,d=1===n?I18n.getMsg("crm.recurrence.yearly.custom.option2",[A[S-1],I[_-1],E[P]]):2===n?I18n.getMsg("crm.recurrence.yearly.custom.option2.end2",[A[S-1],I[_-1],E[P],l]):I18n.getMsg("crm.recurrence.yearly.custom.option2.end3",[A[S-1],I[_-1],E[P],c])}}return d}},convertRemainderPatternIntoReadableFormat:function(e,t){if(!e||!e.ALARM)return"";$L.moment().toDate().setHours(0,0,0,0);for(var i={},a=e.ALARM.split(";"),r=a.length,n=0;n<r;n++)i[a[n].split("=")[0]]=a[n].split("=")[1];var o=i.FREQ;o=o&&"NONE"===o?void 0:o;var s,l,c=i.ACTION?i.ACTION:"email",d=i.TRIGGER,u=d;if(d&&d.startsWith("DATE-TIME:"))s=d.length>34?d.substring(10,35):30===d.length?d.substring(10,30):d.substring(10,d.length),s=$L.moment(s).toDate();else{if(!(d&&d.startsWith("-P")&&d.length>=4&&i.TRIGGER_TIME))return"";var m=t._$.original.Due_Date;if(""===m)return"";switch((m=$L.moment(m).toDate()).setHours(i.TRIGGER_TIME.split(":")[0]),m.setMinutes(i.TRIGGER_TIME.split(":")[1]),s=m,l=u.substring(2,u.length-1),d.substring(d.length-1)){case"D":l+=" DAYS";break;case"W":l+=" WEEKS";break;case"M":l+=" MONTHS"}}if(s&&l){var p=l;if(p&&-1!==p.indexOf(" ")){var g=parseInt(p.substring(0,p.indexOf(" ")));switch(p.substring(p.indexOf(" ")+1,p.length)){case"DAYS":s.setDate(s.getDate()-g);break;case"WEEKS":s.setDate(s.getDate()-7*g);break;case"MONTHS":s.setMonths(s.getMonths()-g)}}}var h,v="",f="";switch(o){case"DAILY":v=I18n.getMsg("dailyfrom")+" ";break;case"WEEKLY":v=I18n.getMsg("weeklyfrom")+" ";break;case"MONTHLY":v=I18n.getMsg("monthlyfrom")+" ";break;case"YEARLY":v=I18n.getMsg("yearlyfrom")+" "}!c||"POPUP"!==c&&"EMAIL"!==c||("POPUP"===c?h="throughpopup":"EMAIL"!==c&&"EMAIL"!==c||(h="throughemail"),f=" "+I18n.getMsg(h));if(void 0===l)return v+CrmDateUtils.convertDateToUserPattern(s,void 0,!0)+" "+Utils.getTimeInUserFormat(s,!0)+f;var C,I=l.split(" ")[0],y=l.split(" ")[1];switch(C="0"===I?I18n.getMsg("On")+" ":I+" ",y){case"DAYS":C+=I18n.getMsg("crm.schedules.skipfreq.day");break;case"WEEKS":C+=I18n.getMsg("crm.schedules.skipfreq.week");break;case"MONTH":C+=I18n.getMsg("crm.schedules.skipfreq.month")}return C+=" ","0"!==I&&(C+=I18n.getMsg("before")+" "),v+C+" ("+CrmDateUtils.convertDateToUserPattern(s,void 0,!0)+") "+I18n.getMsg("of.duedate")+" "+I18n.getMsg("crm.label.lowercase.at")+" "+Utils.getTimeInUserFormat(s,!0)+f}};!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).CrmKanbanViewColumns=e({1:function(e,t,i,a,r){var n;return' <div id=\'norecordmsg\' class="p0 crm-base-font-size notasks crmLabelColor h100_per w100_per"><span class="vaM" style="display: table-cell;">'+e.escapeExpression(e.lambda(null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.norecordmsg:n,t))+"</span></div> "},3:function(e,t,i,a,r,n,o){var s,l=e.lambda,c=e.escapeExpression,d=null!=t?t:{};return' <li  id="recordid_'+c(l(null!=t?t.ACTIVITYID:t,t))+'" class="pL5per pR5per pB0 positionRelative cursorpointer"  data-cid="kanbanviewentity" data-params=\'{"module":"'+c(l(null!=t?t.ACTIVITYTYPE:t,t))+'","fromDetailView":"true","activitytype":"'+c(l(null!=t?t.ACTIVITYTYPE:t,t))+'","id":"'+c(l(null!=t?t.ACTIVITYID:t,t))+'","view":"kanbanview","cvid":"'+c(l(null!=t?t.CVID:t,t))+'","relid":"'+c(l(null!=t?t.SEID:t,t))+'","conid":"'+c(l(null!=t?t.CONTACTID:t,t))+'","setype":"'+c(l(null!=t?t.SEMODULE:t,t))+'"'+(null!=(s=i.ifEquals.call(d,null!=t?t.isFromActivity:t,"true",{name:"ifEquals",hash:{},fn:e.program(4,r,0,n,o),inverse:e.noop,data:r}))?s:"")+', "recordNum":"'+c(l(null!=t?t.RECORDNUM:t,t))+"\" }' onclick=TaskKanbanView.getentitypopup(this) name='"+c(l(null!=t?t.columntype:t,t))+"' onmouseover='TaskKanbanView.showEditClose(\""+c(l(null!=t?t.ACTIVITYID:t,t))+"\")' onmouseout='TaskKanbanView.hideEditClose(\""+c(l(null!=t?t.ACTIVITYID:t,t))+'")\'> <div id="div'+c(l(null!=t?t.ACTIVITYID:t,t))+'" align="center" class="EditClose fontSmoothAntialiased hide"  > '+(null!=(s=i.if_nq.call(d,null!=t?t.RECORDAPPROVED:t,"2",{name:"if_nq",hash:{},fn:e.program(6,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' </div> <div class="overflhidden"> '+(null!=(s=i.if_eq.call(d,null!=t?t.newCallView:t,!0,{name:"if_eq",hash:{},fn:e.program(24,r,0,n,o),inverse:e.program(26,r,0,n,o),data:r}))?s:"")+" </div> </li> "},4:function(e,t,i,a,r){return',"fromActivityListView":"true"'},6:function(e,t,i,a,r,n,o){var s,l=null!=t?t:{};return" "+(null!=(s=i.if_eq.call(l,null!=t?t.ACTIVITYTYPE:t,"Events",{name:"if_eq",hash:{},fn:e.program(7,r,0,n,o),inverse:e.program(9,r,0,n,o),data:r}))?s:"")+" "+(null!=(s=i.if_eq.call(l,null!=t?t.ACTIVITYTYPE:t,"Tasks",{name:"if_eq",hash:{},fn:e.program(18,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "},7:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <a onclick="Crm.editEntity(undefined,this);sE(event);" class="crmBaseColor editMore" id="listViewEdit_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" data-cid="editbtn" data-params=\'{"module":"Events","id":"'+o(n(null!=t?t.ACTIVITYID:t,t))+'","from":"detailView","calleeObj":"Crm","clickId":"editbtn"}\'>'+o(n(null!=t?t.EDIT:t,t))+"</a> "},9:function(e,t,i,a,r,n,o){var s;return" "+(null!=(s=i.if_eq.call(null!=t?t:{},null!=t?t.ACTIVITYTYPE:t,"Calls",{name:"if_eq",hash:{},fn:e.program(10,r,0,n,o),inverse:e.program(13,r,0,n,o),data:r}))?s:"")+" "},10:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if_eq.call(null!=t?t:{},null!=t?t.showEditBtn:t,!0,{name:"if_eq",hash:{},fn:e.program(11,r,0),inverse:e.noop,data:r}))?n:"")+" "},11:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <a onclick="Crm.editEntity(undefined,this);sE(event);" class="crmBaseColor editMore" id="listViewEdit_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" data-cid="editbtn" data-params=\'{"module":"Calls","id":"'+o(n(null!=t?t.ACTIVITYID:t,t))+'","from":"detailView","calleeObj":"Crm","clickId":"editbtn"}\'>'+o(n(null!=t?t.EDIT:t,t))+"</a> "},13:function(e,t,i,a,r,n,o){var s;return" "+(null!=(s=i.if_eq.call(null!=t?t:{},null!=o[1]?o[1].isFromActivityModule:o[1],"true",{name:"if_eq",hash:{},fn:e.program(14,r,0,n,o),inverse:e.program(16,r,0,n,o),data:r}))?s:"")+" "},14:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <link-to lt-prop-td=\'{"from":"kvlistview"}\' lt-prop-route="crm.tab.module.entity.edit" lt-prop-class="tkveditlist alignRight" lt-prop-id="listViewEdit_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" lt-prop-qp=\'{"sub_module":"'+o(n(null!=t?t.ACTIVITYTYPE:t,t))+'"}\' lt-prop-dp=\'["Activities","'+o(n(null!=t?t.ACTIVITYID:t,t))+'"]\' data-zcqa="editBtn" >'+o(n(null!=t?t.EDIT:t,t))+"</link-to> "},16:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <link-to lt-prop-td=\'{"from":"kvlistview"}\' lt-prop-route="crm.tab.module.entity.edit" lt-prop-class="tkveditlist alignRight" lt-prop-id="listViewEdit_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" lt-prop-dp=\'["'+o(n(null!=t?t.ACTIVITYTYPE:t,t))+'","'+o(n(null!=t?t.ACTIVITYID:t,t))+'"]\' data-zcqa="editBtn" >'+o(n(null!=t?t.EDIT:t,t))+"</link-to> "},18:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if_eq.call(null!=t?t:{},null!=t?t.isCloseTaskReq:t,!0,{name:"if_eq",hash:{},fn:e.program(19,r,0),inverse:e.noop,data:r}))?n:"")+" "},19:function(e,t,i,a,r){var n;return' \x3c!--span class="seperatorLine '+e.escapeExpression(e.lambda(null!=(n=null!=t?t.commonClasses:t)?n.taskCloseClass:n,t))+'">|</span--\x3e '+(null!=(n=i.if_eq.call(null!=t?t:{},null!=t?t.isFromActivityModule:t,"true",{name:"if_eq",hash:{},fn:e.program(20,r,0),inverse:e.program(22,r,0),data:r}))?n:"")+" "},20:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <a class="smalledit tkvcancelLinklist mL5 mR5 '+s(o(null!=(n=null!=t?t.commonClasses:t)?n.taskCloseClass:n,t))+'" id="listViewClose_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" onclick=\'javascript:closeTask("'+s(i.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:r}))+"/TaskKanbanView.do?action=CloseTask&taskid="+s(o(null!=t?t.ACTIVITYID:t,t))+"&id="+s(o(null!=t?t.ACTIVITYID:t,t))+"&module=Activities&iskanbanview=true\")'>"+s(o(null!=t?t.CLOSE:t,t))+"</a> "},22:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <a class="smalledit tkvcancelLinklist mL5 mR5 '+s(o(null!=(n=null!=t?t.commonClasses:t)?n.taskCloseClass:n,t))+'" id="listViewClose_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" onclick=\'javascript:closeTask("'+s(i.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:r}))+"/TaskKanbanView.do?action=CloseTask&taskid="+s(o(null!=t?t.ACTIVITYID:t,t))+"&id="+s(o(null!=t?t.ACTIVITYID:t,t))+"&module=Tasks&iskanbanview=true\")'>"+s(o(null!=t?t.CLOSE:t,t))+"</a> "},24:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <calls-kanbancard activity-id="'+o(n(null!=t?t.ACTIVITYID:t,t))+'" call-type="'+o(n(null!=t?t.SYSREFCALLTYPE:t,t))+'" contact-name="'+o(n(null!=t?t.CONTACTNAME:t,t))+'" contact-id="'+o(n(null!=t?t.CONTACTID:t,t))+'" se-name="'+o(n(null!=t?t.ENTITYNAME:t,t))+'" se-id="'+o(n(null!=t?t.SEID:t,t))+'" se-module="'+o(n(null!=t?t.SEMODULE:t,t))+'" phone-id="'+o(n(null!=t?t.INDEXEDPHONENO:t,t))+'" phone-no="'+o(n(null!=t?t.PHONENO:t,t))+'" formatted-start-time="'+o(n(null!=t?t.CALLSTARTDATETIME:t,t))+'" status="'+o(n(null!=t?t.CALLSTATUS:t,t))+'" duration="'+o(n(null!=t?t.CALLDURATION:t,t))+'" owner-name="'+o(n(null!=t?t.USERNAME:t,t))+'" owner-id="'+o(n(null!=t?t.ACTIVITYOWNERID:t,t))+'"></calls-kanbancard> '},26:function(e,t,i,a,r,n,o){var s,l=e.lambda,c=e.escapeExpression,d=null!=t?t:{};return' <div class="pT20 pB20 tkInnerInfo dIB w100_per"> <div class="dIB w100_per mB4" id="kanban_'+c(l(null!=t?t.ACTIVITYID:t,t))+'"> '+(null!=(s=i.if_nq.call(d,null!=t?t.colorCode:t,"",{name:"if_nq",hash:{},fn:e.program(27,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' <span class="fL kanbanviewImages mR10 '+c(l(null!=t?t.ACTIVITYTYPE:t,t))+'"><crmutil-icon non-lyte="true" icon-name="'+c(i.toLowerCase.call(d,null!=t?t.ACTIVITYTYPE:t,{name:"toLowerCase",hash:{},data:r}))+'" icon-class="zcicn-'+c(i.toLowerCase.call(d,null!=t?t.ACTIVITYTYPE:t,{name:"toLowerCase",hash:{},data:r}))+" crmBaseIcon \"></crmutil-icon></span> <span id='name' class=\"fL "+c(l(null!=(s=null!=t?t.commonClasses:t)?s.subjectClass:s,t))+" overflhidden kv_Name_"+c(l(null!=t?t.ACTIVITYID:t,t))+'" style="text-overflow: ellipsis;white-space:nowrap; '+c(l(null!=(s=null!=t?t.commonClasses:t)?s.subjectStyle:s,t))+'"> '+(null!=(s=i.if_eq.call(d,null!=o[1]?o[1].isFromActivityModule:o[1],"true",{name:"if_eq",hash:{},fn:e.program(29,r,0,n,o),inverse:e.program(31,r,0,n,o),data:r}))?s:"")+' <span id="Subject" title="'+c(l(null!=t?t.SUBJECT:t,t))+'" class = "kv_Subject_'+c(l(null!=t?t.ACTIVITYID:t,t))+'">'+c(l(null!=t?t.SUBJECT:t,t))+"</span> </a> </span> "+(null!=(s=i.ifEquals.call(d,"Tasks",null!=t?t.ACTIVITYTYPE:t,{name:"ifEquals",hash:{},fn:e.program(33,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "+(null!=(s=i.if_eq.call(d,null!=t?t.RECORDAPPROVED:t,"2",{name:"if_eq",hash:{},fn:e.program(36,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "+(null!=(s=i.if.call(d,null!=t?t.Locked__s:t,{name:"if",hash:{},fn:e.program(38,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "+(null!=(s=i.if_eq.call(d,null!=t?t.ACTIVITYTYPE:t,"Tasks",{name:"if_eq",hash:{},fn:e.program(43,r,0,n,o),inverse:e.program(48,r,0,n,o),data:r}))?s:"")+" </div> "+(null!=(s=i.if_nq.call(d,null!=t?t.RELATEDTITLE:t,"",{name:"if_nq",hash:{},fn:e.program(50,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' <span id="relatedto" class="crmLabelColor dIB fL  ellipsistext maxW43per vaM"> '+(null!=(s=i.if_nq.call(d,null!=t?t.SEID:t,"null",{name:"if_nq",hash:{},fn:e.program(52,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" </span> "+(null!=(s=i.if_nq.call(d,null!=t?t.SEID:t,"null",{name:"if_nq",hash:{},fn:e.program(54,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' <span id="contactname" class="crmLabelColor dIB fL ellipsistext vaM" style="width:40%;"> '+(null!=(s=i.if_nq.call(d,null!=t?t.CONID:t,"null",{name:"if_nq",hash:{},fn:e.program(57,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" </span> "+(null!=(s=i.if_nq.call(d,null!=t?t.RELATEDTITLE:t,"",{name:"if_nq",hash:{},fn:e.program(59,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' <span class="fR '+c(l(null!=(s=null!=t?t.commonClasses:t)?s.priorityDurationClass:s,t))+" tkvPriority color_616e88  ellipsistext cP crm-font-regular crm-extra-small-font-size kv_Priority_"+c(l(null!=t?t.ACTIVITYID:t,t))+'" title="'+c(l(null!=(s=null!=t?t.commonClasses:t)?s.priorityDurationTitle:s,t))+'">'+c(l(null!=(s=null!=t?t.commonClasses:t)?s.priorityDurationDisplay:s,t))+'</span> <div class="dIB w70per mB4 mT4"> <a href="'+c(i.getCrmBasePath.call(d,{name:"getCrmBasePath",hash:{},data:r}))+"/ShowSetup.do?tab=usersPermi&subTab=viewUser&userId="+c(l(null!=t?t.ACTIVITYOWNERID:t,t))+"\" id='taskOwner' target='_blank' class=\"color_313949 dIB fL mW42per fL ellipsistext  crm-font-regular\" title=\""+c(l(null!=t?t.USERNAME:t,t))+'">'+c(l(null!=t?t.USERNAME:t,t))+"</a> "+(null!=(s=i.if_nq.call(d,null!=(s=null!=t?t.commonClasses:t)?s.statusLocationType:s,"",{name:"if_nq",hash:{},fn:e.program(61,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" <a id='Status' class=\"color_313949 dIB fL  mL7 "+c(l(null!=(s=null!=t?t.commonClasses:t)?s.statusLocationType:s,t))+" ellipsistext mW45per crm-font-regular kv_Status_"+c(l(null!=t?t.ACTIVITYID:t,t))+"\" title='"+c(l(null!=(s=null!=t?t.commonClasses:t)?s.statusLocationType:s,t))+"'>"+c(l(null!=(s=null!=t?t.commonClasses:t)?s.statusLocationType:s,t))+"</a> </div> "+(null!=(s=i.if_eq.call(d,null!=t?t.ispotvisibile:t,!0,{name:"if_eq",hash:{},fn:e.program(63,r,0,n,o),inverse:e.noop,data:r}))?s:"")+' <div class="cBoth"></div> </div> '},27:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <span class="activitesColor" data-zcqa="colorspankanban_'+o(n(null!=t?t.SUBJECT:t,t))+'" style="background: '+o(n(null!=t?t.colorCode:t,t))+'"></span> '},29:function(e,t,i,a,r){var n=e.escapeExpression,o=e.lambda;return' <a id=\'kvshowpopup\' class="kvsubtitle" href="'+n(i.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:r}))+"/tab/Activities/"+n(o(null!=t?t.ACTIVITYID:t,t))+"?sub_module="+n(o(null!=t?t.ACTIVITYTYPE:t,t))+'"> '},31:function(e,t,i,a,r){var n=e.escapeExpression,o=e.lambda;return' <a id=\'kvshowpopup\' class="kvsubtitle" href="'+n(i.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:r}))+"/tab/"+n(o(null!=t?t.ACTIVITYTYPE:t,t))+"/"+n(o(null!=t?t.ACTIVITYID:t,t))+'"> '},33:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if.call(null!=t?t:{},null!=t?t.isProjectTask:t,{name:"if",hash:{},fn:e.program(34,r,0),inverse:e.noop,data:r}))?n:"")+" "},34:function(e,t,i,a,r){var n=null!=t?t:{},o=e.escapeExpression;return' <a style="margin-bottom: 2px; margin-left:3px;" class="task_syncIcon vaM" onmouseover=\'renderingUtils.zctt.showtt(" '+o(i.getI18n.call(n,"crm.schedules.prefix.in",{name:"getI18n",hash:{},data:r}))+" "+o(i.getI18n.call(n,"crm.integ.sync.message","crm.project.integration.title",{name:"getI18n",hash:{},data:r}))+'")\' onmouseout="renderingUtils.zctt.hidett(1)"></a> '},36:function(e,t,i,a,r){return' <span id="lockicon" class="dIB vaM mL5"><crmutil-icon non-lyte="true" icon-name="lock-locked" icon-class="zcicn-lock-locked crmBaseIcon "></crmutil-icon></span> '},38:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if.call(null!=t?t:{},null!=t?t.locked_for_me:t,{name:"if",hash:{},fn:e.program(39,r,0),inverse:e.program(41,r,0),data:r}))?n:"")+" "},39:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <span id="reclock_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" data-zcqa="lockedforMeKanban_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" class="iconlock_ap zcrm_svgIcons recordLockingiconlock_ap mL5" lt-prop-title="'+o(i.getI18n.call(null!=t?t:{},"crm.record.lock.record.locked",{name:"getI18n",hash:{},data:r}))+'" lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span> '},41:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <span id="reclock_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" data-zcqa="lockedforOthersKanban_'+o(n(null!=t?t.ACTIVITYID:t,t))+'" class="iconlock_ap zcrm_svgIcons recordLockingiconlock_ap mL5" lt-prop-title="'+o(i.getI18n.call(null!=t?t:{},"crm.record.record.locked.other",{name:"getI18n",hash:{},data:r}))+'" lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span> '},43:function(e,t,i,a,r){var n;return' <span class="fR date_act_kv crmLabelColor  alignRight positionRelative" > '+(null!=(n=i.ifCondLogic.call(null!=t?t:{},null!=t?t.ISDUEDATE:t,"=","true","&&",null!=t?t.ISCOMPLETED:t,"!=","true",{name:"ifCondLogic",hash:{},fn:e.program(44,r,0),inverse:e.program(46,r,0),data:r}))?n:"")+" </span> "},44:function(e,t,i,a,r){var n=e.lambda,o=e.escapeExpression;return' <span class="overDueCtn"> <span class="crmNegativeColor overDueTask" >'+o(n(null!=t?t.DUEDATE:t,t))+'</span> <span class="overdue hide" >'+o(n(null!=t?t.DUEDAYS:t,t))+"</span> </span> "},46:function(e,t,i,a,r){return" "+e.escapeExpression(e.lambda(null!=t?t.DUEDATE:t,t))+" "},48:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <span class="fR '+s(o(null!=(n=null!=t?t.commonClasses:t)?n.dateClass:n,t))+' date_evtact_kv mT3 alignRight " style="'+s(o(null!=(n=null!=t?t.commonClasses:t)?n.dateStyle:n,t))+"\" title='"+s(o(null!=(n=null!=t?t.commonClasses:t)?n.dateTitle:n,t))+"'> "+s(o(null!=(n=null!=t?t.commonClasses:t)?n.dateDisplayVal:n,t))+" </span> "},50:function(e,t,i,a,r){var n,o=e.lambda;return' <div class="overflhidden fL '+e.escapeExpression(o(null!=(n=null!=t?t.commonClasses:t)?n.relatedTitleClass:n,t))+'"  title="'+(null!=(n=o(null!=t?t.RELATEDTITLE:t,t))?n:"")+'"> '},52:function(e,t,i,a,r){var n=null!=t?t:{},o=e.escapeExpression,s=e.lambda;return" <a class=\"kt_smalltxt\"  id='kvshowpopup' href='"+o(i.getCrmBasePath.call(n,{name:"getCrmBasePath",hash:{},data:r}))+"/EntityInfo.do?module="+o(i.encodeURL.call(n,null!=t?t.SEMODULE:t,{name:"encodeURL",hash:{},data:r}))+"&id="+o(s(null!=t?t.SEID:t,t))+"' target='_blank'>"+o(s(null!=t?t.ENTITYNAME:t,t))+"</a> "},54:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if_nq.call(null!=t?t:{},null!=t?t.CONID:t,"null",{name:"if_nq",hash:{},fn:e.program(55,r,0),inverse:e.noop,data:r}))?n:"")+" "},55:function(e,t,i,a,r){return" <span class='mL3 mR3 dIB fL vaM crmLabelColor'>-</span> "},57:function(e,t,i,a,r){var n=e.escapeExpression,o=e.lambda;return' <a class="kt_smalltxt" href=\''+n(i.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:r}))+"/EntityInfo.do?module=Contacts&id="+n(o(null!=t?t.CONTACTID:t,t))+"'  target='_blank'>"+n(o(null!=t?t.CONTACTNAME:t,t))+"</a> "},59:function(e,t,i,a,r){return" </div> "},61:function(e,t,i,a,r){return' <span class="dIB grayFilledCircle fL mL7 mT8"></span> '},63:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if.call(null!=t?t:{},null!=t?t.AMOUNT:t,{name:"if",hash:{},fn:e.program(64,r,0),inverse:e.noop,data:r}))?n:"")+" "},64:function(e,t,i,a,r){return' <br> <a  class="dIB aligncenter ellipsistext dealAmount mT4 crm-font-regular crm-small-font-size">'+e.escapeExpression(e.lambda(null!=t?t.AMOUNT:t,t))+"</a> "},66:function(e,t,i,a,r){var n;return" "+(null!=(n=i.if_eq.call(null!=t?t:{},null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.size:n,"20",{name:"if_eq",hash:{},fn:e.program(67,r,0),inverse:e.noop,data:r}))?n:"")+" "},67:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <div id="'+s(o(null!=t?t.columntype:t,t))+'_tkvshowmore"  class="tkvshowmore" > <input type="hidden" id="'+s(o(null!=t?t.columntype:t,t))+'_startindex" name="'+s(o(null!=t?t.columntype:t,t))+'_startindex" value="20"> '+(null!=(n=i.if_eq.call(null!=t?t:{},null!=t?t.isFromActivityModule:t,"true",{name:"if_eq",hash:{},fn:e.program(68,r,0),inverse:e.program(70,r,0),data:r}))?n:"")+" </div> "},68:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <a id=\'tkvshowmore1\' href="javascript:void(0)"  data-zcqa="tkvshowmore" data-cid="tkvshowmore" data-params=\'{"module":"Activities","kvmodule":"'+s(o(null!=t?t.columntype:t,t))+'","view":"kanbanview","kvstatus":"enable","isload":"true","startindex":"'+s(o(null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.startindex:n,t))+'","step":"loadmore"}\'>'+s(o(null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.ShowMoreLabel:n,t))+"</a> "},70:function(e,t,i,a,r){var n,o=e.lambda,s=e.escapeExpression;return' <a id=\'tkvshowmore1\' href="javascript:void(0)"  data-zcqa="tkvshowmore" data-cid="tkvshowmore" data-params=\'{"module":"'+s(o(null!=t?t.kvmodule:t,t))+'","kvmodule":"'+s(o(null!=t?t.columntype:t,t))+'","view":"kanbanview","kvstatus":"enable","isload":"true","startindex":"'+s(o(null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.startindex:n,t))+'","step":"loadmore"}\'>'+s(o(null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.ShowMoreLabel:n,t))+"</a> "},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,r,n,o){var s,l=null!=t?t:{};return" <ul id='"+e.escapeExpression(e.lambda(null!=t?t.columntype:t,t))+'_Container\' class="p0 positionRelative kanbanList_activities"> '+(null!=(s=i.if_eq.call(l,null!=(s=null!=(s=null!=t?t.kvColumnObj:t)?s.jsonobj:s)?s.NORECORD:s,"true",{name:"if_eq",hash:{},fn:e.program(1,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "+(null!=(s=i.each.call(l,null!=(s=null!=t?t.kvColumnObj:t)?s.jsonarrayObj:s,{name:"each",hash:{},fn:e.program(3,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" </ul> "+(null!=(s=i.if_eq.call(l,null!=t?t.isloadmore:t,"false",{name:"if_eq",hash:{},fn:e.program(66,r,0,n,o),inverse:e.noop,data:r}))?s:"")+" "},useData:!0,useDepths:!0})}();var multiLookupsView={multiLookups:{},lookupPopupRecordCount:10,currentMultiLookup:{},dissociateMLRecords:function(e,t){if(e||(e=multiLookupsView.currentMultiLookup.fldName),e.id&&(e=e.id),t)multiLookupsView.checkLinkingModulePermission("remove",multiLookupsView.dissociateMLRecords,e);else{multiLookupsView.confirmUnSelectedAction(e);var i=multiLookupsView.getParamJson(e);if(multiLookupsView.currentMultiLookup.lookuprel&&"all"===multiLookupsView.currentMultiLookup.confirmunselectedid){var a=$("#topSectionTitle").find(".dvTitle").text().trim(),r=$L("crm-detailview-header");r&&r[0]&&(a=(r=r[0]).component.data.entityName),i.entityname=a}Crm.trackSpotLightAction("Multi Select Lookup - Remove",{Module:i.module}),i.select=!0,i.FROM_INDEX=1,i.mlaction="remove",i.TO_INDEX=multiLookupsView.lookupPopupRecordCount;var n=$L("crm-detailview-canvas");n&&n[0]&&(i.isAjaxEdit=n[0].getData("isAjaxEdit")),multiLookupsView.removeTempWarningPopup(),multiLookupsView.submitMultiLookupForm("dissociate",Crm.getCrmBasePath()+"/Search.do","topBandPopup",i);var o=$L("#freezeBackGround");o.css("z-index","30"),multiLookupsView.currentMultiLookup.unselectedCount=0}if(!t){var s,l,c=Lyte.Router.getRouteInstance().transition.info.route,d=!!Lyte.Router.getRouteInstance().getQueryParams().wizardId&&$L("crm-canvas-form").length;if("crm.tab.module.create.canvas"===c||"crm.tab.module.entity.edit.canvas"===c||"crm.tab.module.entity.clone.canvas"===c||d?(s="#"+e,(l=$L(s)&&$($L(s)).closest("crm-canvas-form")[0]).setData("mxnLoopupFldName",e)):(s='crm-create-fields[fld-id="'+e+'"]',l=$L(s)[0]),l){var u=l.getData("observeMultichanges");l.setData("observeMultichanges",!u)}}var m=$L("crm-canvas-quicksavepopup")[0];m&&m.component.getData("showPopup")&&(border.addClass("zcanavsZI312"),o.addClass("zcanavsZI312"))},associateLookupRelUpdate:function(){multiLookupsView.removeLookupUpdateWarningPopup(),$("#freezeBackGround").css("z-index","30"),$(".animateMl").css("visibility","hidden").addClass("cvTableAct"),$("#selected-records").css("visibility","visible")},removePermissionDeniedWarningPopup:function(){var e=$("#freezeBackGround"),t=$("#mxnEntityLookupdiv");e.attr("style","z-index:30"),t.length||$("#lookupUpdateWarningPopup").length&&e.attr("style","display:none"),renderingUtils.removeFreezeLayer(),multiLookupsView.removeLookupUpdateWarningPopup(),e.css("z-index","30")},openAddMorePopup:function(e,t){e.id&&(e=e.id);var i=multiLookupsView.currentMultiLookup.selectedCount;if(multiLookupsView.currentMultiLookup&&multiLookupsView.currentMultiLookup.confirmselectedid&&""!=multiLookupsView.currentMultiLookup.confirmselectedid&&(i+=multiLookupsView.currentMultiLookup.confirmselectedid.split(",").length)>=100)renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",100));else if(t)multiLookupsView.checkLinkingModulePermission("addmore",multiLookupsView.openAddMorePopup,e);else{var a=multiLookupsView.getParamJson(e);multiLookupsView.setSelfRefParams(a,e),Crm.trackSpotLightAction("Multi Select Lookup - Add More Click",{Module:a.module}),a.select=!1,a.FROM_INDEX=1,a.mlaction="addmore",a.TO_INDEX=multiLookupsView.lookupPopupRecordCount;var r=Lyte.Router.getRouteInstance(),n=r&&"canvas"===r.routeName;const t=n?store.peekRecord("field",e):$("#"+e);if(CScriptLib&&t){let e=n?t.criteria:multiLookupsView.getCscriptFilterCriteria(t);e&&""!==e.criteria&&(a.filtercriteria=JSON.stringify({criteria:e.criteria}))}multiLookupsView.currentMultiLookup.searchString="",multiLookupsView.submitMultiLookupForm("confirm",Crm.getCrmBasePath()+"/Search.do","topBandPopup",a)}},setSelfRefParams:function(e,t){var i;if(e.searchmodule===e.parentModule&&!e.relatedlist&&!e.lookuprel&&(i="X"===t[t.length-1]?t.substring(0,t.length-1):t+"X",multiLookupsView.multiLookups[i])){var a=$("#"+i).data("selectedid");if(a&&""!==a&&"-"!==a&&(e.selectedidx=a,a.indexOf("-")>-1)){var r=a.split("-");e.selectedidx=r[0],e.unselectedidx=r[1]}}},checkLinkingModulePermission:function(e,t,i){var a=multiLookupsView.multiLookups[i].linkingmodule,r={crmcsrfparam:csrfToken,actionName:"permissionCheck",mlaction:e,linkingmodule:a,fldName:i,unselectedid:multiLookupsView.currentMultiLookup.unselectedid,parentModule:multiLookupsView.getParamJson(i).parentModule,entityId:multiLookupsView.getParamJson(i).entityId};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/Search.do?",data:r,type:"POST",success:function(e){$("#popupnew").removeClass("mxnPermDeniedCheck"),t&&t(multiLookupsView.currentMultiLookup.fldName)},error:function(e){setTimeout((function(){$("#popupnew").addClass("mxnPermDeniedCheck"),$("#freezeBackGround").show().css("z-index","30"),multiLookupsView.cancelDeleteWarningPopup(),$("#FreezeLayer").css("z-index",252)}),10)}})},closeMLPopup:function(e){var t=$("#multipleFieldsEditPop").is(":visible");e||(e=multiLookupsView.currentMultiLookup.fldName),e.id&&(e=e.id),multiLookupsView.multiLookups[e]&&multiLookupsView.multiLookups[e].relatedlist?multiLookupsView.multiLookups={}:(multiLookupsView.currentMultiLookup.selectedid="",multiLookupsView.currentMultiLookup.unselectedid="",multiLookupsView.currentMultiLookup.confirmselectedid="",multiLookupsView.currentMultiLookup.confirmunselectedid="",multiLookupsView.currentMultiLookup.selectedCount=0,multiLookupsView.currentMultiLookup.unselectedCount=0,multiLookupsView.currentMultiLookup.searchString="",multiLookupsView.currentMultiLookup.prodQuantity={},multiLookupsView.multiLookups[e]&&multiLookupsView.multiLookups[e].variedLookupValues&&(multiLookupsView.multiLookups[e].variedLookupValues=multiLookupsView.currentMultiLookup)),multiLookupsView.currentMultiLookup=null;var i=$("#searchCreatePopup:visible").length;$("#topBandPopup").css("z-index",""),hideAnimatePopup("topBandPopup",!0),i?($("#freezeBackGround").css("z-index","30"),renderingUtils.showFreezeLayer()):t||removeFreezeLayer2(),multiLookupsView.fieldStatusUpdate(e);var a=document.querySelector(".lcMSelectLookupModalOpen");a&&a.classList.remove("lcMSelectLookupModalOpen")},callMultiLookupPopup:function(e){if(multiLookupsView.frameMLJSON(e),e&&e.fldName&&"Crm_Bundles_MXNDUMMYCOLUMNBUNDLE"===e.fldName&&!e.mlaction){var t,i=multiLookupsView.currentMultiLookup.productIdVsQtyObj?multiLookupsView.currentMultiLookup.productIdVsQtyObj:{},a=(t=e.body).length;if(multiLookupsView.currentMultiLookup.confirmselectedid)for(var r=0;r<a;r++){var n=t[r].ENTITYID;1!==multiLookupsView.currentMultiLookup.productIdVsQtyObj[n]&&(e.body[r].CONTENT[4]=multiLookupsView.currentMultiLookup.productIdVsQtyObj[n])}multiLookupsView.currentMultiLookup.productIdVsQtyObj=i}if("true"===e.select&&multiLookupsView.currentMultiLookup.unselectedid)e.selectedid=multiLookupsView.currentMultiLookup.unselectedid,e.selectedIds=e.selectedid,e.selectedCount=multiLookupsView.currentMultiLookup.unselectedCount;else if(multiLookupsView.currentMultiLookup.selectedid){if(Crm.userDetails.isDynamicLookupFilterEnabled){var o=[];e.body.filter((function(e){o.push(e.ENTITYID)}));let t=multiLookupsView.currentMultiLookup.selectedid.split(",");if(multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId&&multiLookupsView.currentMultiLookup.hasOwnProperty("newlyCreatedAndAssociatedRecordIdSatisfiesLookupFilterCriteria")&&!multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordIdSatisfiesLookupFilterCriteria){let i="<a target='_blank' href='"+(Crm.getCrmBasePath()+"/tab/"+e.module+"/"+multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId)+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";crmui.showMsgBand("success",I18n.getMsg("crm.lookup.success.relatedlist.record.created.not.associated",[$ESAPI.encoder().encodeForHTML(moduleRecordMapping[e.module].singular_label),$ESAPI.encoder().encodeForHTML(e.fieldlabel),i]),5e3),t=t.filter((e=>e!==multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId))}multiLookupsView.currentMultiLookup.selectedid=t.join(","),multiLookupsView.currentMultiLookup.selectedCount=t.length,multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId=""}e.selectedid=multiLookupsView.currentMultiLookup.selectedid,e.selectedIds=e.selectedid,e.selectedCount=multiLookupsView.currentMultiLookup.selectedCount}else{if(Crm.userDetails.isDynamicLookupFilterEnabled&&Object.keys(e).contains("relid")){o=[];e.body.filter((function(e){o.push(e.ENTITYID)}));let t=multiLookupsView.currentMultiLookup.selectedid.split(",");if(multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId&&multiLookupsView.currentMultiLookup.hasOwnProperty("newlyCreatedAndAssociatedRecordIdSatisfiesLookupFilterCriteria")&&!multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordIdSatisfiesLookupFilterCriteria){let i="<a target='_blank' href='"+(Crm.getCrmBasePath()+"/tab/"+e.module+"/"+multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId)+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";crmui.showMsgBand("success",I18n.getMsg("crm.lookup.success.relatedlist.record.created.not.associated",[$ESAPI.encoder().encodeForHTML(moduleRecordMapping[e.module].singular_label),$ESAPI.encoder().encodeForHTML(e.fieldlabel),i]),5e3),t=t.filter((e=>e!==multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId))}multiLookupsView.currentMultiLookup.selectedid=t.join(","),multiLookupsView.currentMultiLookup.selectedCount=t.length,multiLookupsView.currentMultiLookup.newlyCreatedAndAssociatedRecordId=""}e.selectedid="",e.selectedCount=0}return e.from="mLookup",e.hideAddMoreButton=Crm.userDetails.CLIENT_ACCOUNT&&e.parentModule&&(Crm.userDetails.CLIENT_TYPE===e.parentModule||Crm.userDetails.moduleVsCriteriaLookup[e.parentModule][0]===e.fldId),e.hideAddMoreButton=e.hideAddMoreButton?e.hideAddMoreButton:!Lyte.Component.registeredHelpers.showAddRecord(multiLookupsView.multiLookups[e.fldId].linkingmodule),Handlebars.templates.crmMxNLookup(e)},fieldStatusUpdate:function(e){var t;if(Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck())(t=$L("input#"+e)).closest(".zcanvas-value-container").addClass("highlightcanvasformfield"),setTimeout((function(){$L(".highlightcanvasformfield").removeClass("highlightcanvasformfield")}),800);else if(t=$("input#"+e)[0]){var i=$L("crm-create-layout")[0];t.style.backgroundColor=i?"var(--tableHighlight)":"#ffff99",setTimeout((function(){t.style.backgroundColor="transparent"}),800)}},partialCallBodyMultiLookupPopup:function(e){if(multiLookupsView.frameMLJSON(e),e&&e.fldName&&"Crm_Bundles_MXNDUMMYCOLUMNBUNDLE"===e.fldName&&!e.mlaction){var t,i=multiLookupsView.currentMultiLookup.productIdVsQtyObj?multiLookupsView.currentMultiLookup.productIdVsQtyObj:{},a=(t=e.body).length;if(multiLookupsView.currentMultiLookup.confirmselectedid)for(var r=0;r<a;r++){var n=t[r].ENTITYID;1!==multiLookupsView.currentMultiLookup.productIdVsQtyObj[n]&&(e.body[r].CONTENT[4]=multiLookupsView.currentMultiLookup.productIdVsQtyObj[n])}multiLookupsView.currentMultiLookup.productIdVsQtyObj=i}"true"===e.select&&multiLookupsView.currentMultiLookup.unselectedid?(e.selectedid=multiLookupsView.currentMultiLookup.unselectedid,e.selectedIds=e.selectedid,e.selectedCount=multiLookupsView.currentMultiLookup.unselectedCount):multiLookupsView.currentMultiLookup.selectedid?(e.selectedid=multiLookupsView.currentMultiLookup.selectedid,e.selectedIds=e.selectedid,e.selectedCount=multiLookupsView.currentMultiLookup.selectedCount):(e.selectedid="",e.selectedCount=0);var o="",s="",l=$("#mxnlistViewTable");if(e.body.length>0){e.from="mLookup",Handlebars.registerPartial("body",Handlebars.templates.body);for(var c=[],d=e.fromIndex-1,u=e.body.length,m=0;m<u&&void 0!==e.body[m];m++)c[d++]=e.body[m];e.body=c,s=Handlebars.templates.navigateByRecords(e),o=Handlebars.templates.body(e)}else{var p=$(l.find("#lvNoRecordsFound"));if(p){var g=p.closest("tbody");g&&g.html("")}Handlebars.registerPartial("noRecordsFound",Handlebars.templates.noRecordsFound),o=Handlebars.templates.noRecordsFound(e)}l.find("tbody").eq(0).html(o),$("#mxnnavigationlookup")[0].innerHTML=s,0===$(".customCheckBox[data-cid=mLookupselectEntity]").length&&$(".customCheckBoxChecked[data-cid=mLookupselectEntity]").length>0?$("#checkAll").attr("class","customCheckBoxChecked"):$("#checkAll").attr("class","customCheckBox")},frameMLJSON:function(e){var t={};if(multiLookupsView.multiLookups[e.fldName])t=multiLookupsView.multiLookups[e.fldName];else{var i=$("#multipleFieldsEditPop").is(":visible"),a=$("#"+e.fldName),r={selectedid:"",unselectedid:"",needconfirmid:""};if(i&&void 0!==a&&void 0!==a.data("confirmselectedid")?r.confirmselectedid=a.data("confirmselectedid"):r.confirmselectedid="",i&&void 0!==a&&void 0!==a.data("confirmunselectedid")?r.confirmunselectedid=a.data("confirmunselectedid"):r.confirmunselectedid="",window[e.parentModule]&&"clone"===window[e.parentModule].currentStatus){var n=$("#"+e.fldName).data();r.confirmselectedid=n.selectedid}r.selectedCount=0,r.unselectedCount=0,r.searchString="",r.select=e.select,r.lookuprel=!1,e.lookuprel&&(r.lookuprel=!0,t.lookuprel=!0),t.variedLookupValues=r,multiLookupsView.multiLookups[e.fldName]=t}t.relatedlist=e.relatedlist,e.relid&&(t.relid=e.relid),t.link=e.link,t.fldName=e.fldName,t.fldId=e.fldName,t.fldLabel=e.fldLabel,t.parentModule=e.parentModule,t.module=e.parentModule,t.searchmodule=e.searchmodule,t.modulesingularlabel=e.modulesingularlabel,t.modulelabel=e.modulelabel,t.entityId=e.entityId,t.linkingmodule=e.linkingmodule,t.variedLookupValues.modulesingularlabel=e.modulesingularlabel,t.variedLookupValues.modulelabel=e.modulelabel,t.variedLookupValues.select=e.select,t.variedLookupValues.fldName=e.fldName,t.sortOrderString=e.sortOrderString,t.sortColumnString=e.sortColumnString,t.mlaction=e.mlaction,t.parentColumn=e.parentColumn,multiLookupsView.currentMultiLookup=t.variedLookupValues,multiLookupsView.currentMultiLookup.parentColumn=e.parentColumn},associateMLRecords:function(e,t){e.id&&(e=e.id),$(t.target).filter("input[type=button]").prop("disabled",!0),multiLookupsView.confirmSelectedAction(e);var i=multiLookupsView.getParamJson(e);i.select=!0,i.relatedlist&&(i.select=!1),Crm.trackSpotLightAction("Multi Select Lookup - Association Save",{Place:i.relatedlist,Module:i.module}),i.mlaction="confirm",i.FROM_INDEX=1,i.TO_INDEX=multiLookupsView.lookupPopupRecordCount,i.fldValue="";var a,r,n=$L("crm-detailview-canvas");if(n&&n[0]&&(i.isAjaxEdit=n[0].getData("isAjaxEdit")),multiLookupsView.currentMultiLookup.searchString="",multiLookupsView.submitMultiLookupForm("confirm",Crm.getCrmBasePath()+"/Search.do","topBandPopup",i,t),!Crm.isFromSalesInbox){var o=Lyte.Router.getRouteInstance().transition.info.route,s=!!Lyte.Router.getRouteInstance().getQueryParams().wizardId&&$L("crm-canvas-form").length;if("crm.tab.module.create.canvas"===o||"crm.tab.module.entity.edit.canvas"===o||"crm.tab.module.entity.clone.canvas"===o||s?(a="#"+e,(r=$L(a)&&$($L(a)).closest("crm-canvas-form")[0]).setData("mxnLoopupFldName",e)):(a='crm-create-fields[fld-id="'+e+'"]',r=$L(a)[0]),r){var l=r.getData("observeMultichanges");r.setData("observeMultichanges",!l)}}},nextSelectRecords:function(e){e.id&&(e=e.id),Crm.trackSpotLightAction("Multi Select Looktup - Next");var t=multiLookupsView.getParamJson(e);t.FROM_INDEX=1,t.TO_INDEX=multiLookupsView.lookupPopupRecordCount,t.select=!1,t.mlaction="next",t.fldValue="",multiLookupsView.currentMultiLookup.searchString="",multiLookupsView.submitMultiLookupForm("next",Crm.getCrmBasePath()+"/Search.do","topBandPopup",t)},getParamJson:function(e){var t=jQuery.extend(!0,{},multiLookupsView.multiLookups[e]);return t.page=null,t.variedLookupValues=null,t},selectMultiSelectAllEntity:function(e,t){var i="";t=$(t);var a=0,r=t.data("params"),n=!1,o=t.attr("class"),s=multiLookupsView.currentMultiLookup.fldName;r&&(n=r.select),""===n&&(n=!1),"true"===n||!0===n?(i=multiLookupsView.currentMultiLookup.unselectedid,a=multiLookupsView.currentMultiLookup.unselectedCount):"false"!==n&&!1!==n||(r&&"next"===r.mlaction&&(multiLookupsView.currentMultiLookup.needconfirm&&""!==multiLookupsView.currentMultiLookup.needconfirm||(multiLookupsView.currentMultiLookup.needconfirm=multiLookupsView.currentMultiLookup.selectedid)),i=multiLookupsView.currentMultiLookup.selectedid,a=multiLookupsView.currentMultiLookup.selectedCount);var l=t.attr("class"),c=multiLookupsView&&multiLookupsView.currentMultiLookup&&multiLookupsView.currentMultiLookup.productIdVsQtyObj?multiLookupsView.currentMultiLookup.productIdVsQtyObj:{};if("customCheckBox"===l){var d=$(".customCheckBox[data-cid=mLookupselectEntity]"),u=$(".customCheckBoxDisabled[data-cid=mLookupselectEntity]"),m=d.length,p=u.length;if(a+m>100)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.mxn.assign.maximum.records.alert",100));for(var g=0;g<m;g++){if((C=$(d.eq(g))).attr("class","customCheckBoxChecked").attr("style","visibility:visible"),!("false"!==n&&!1!==n&&"true"!==n&&!0!==n||void 0!==r.mlaction&&"next"===r.mlaction)){var h=C.closest("tr"),v=h.prev("tr");h.addClass("highlgtMLookup").addClass("setTdBorBtm"),!1===v.hasClass("setTdBorBtm")&&v.addClass("setTdBorBtm")}var f=C.data("params").entityId;f+""!="error"&&(i.indexOf(f)>-1||(""===i?i=f:i+=","+f,a++,s&&"Crm_Bundles_MXNDUMMYCOLUMNBUNDLE"===s&&(c[f]=1)))}for(g=0;g<p;g++){var C;(C=$(u.eq(g))).attr("class","customCheckBoxDisabledHover").attr("style","visibility:visible")}a>0&&($("#mxnlistViewTable #checkAll").attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked"))}else $.each($(".customCheckBoxChecked[data-cid=mLookupselectEntity]"),(function(e,t){var r=$(t);if("true"===n||!0===n?multiLookupsView.currentMultiLookup.unselectedCount>10?r.attr("class","customCheckBox").attr("style","visibility:visible"):r.attr("class","customCheckBox onHover").attr("style","visibility:hidden"):r.attr("class","customCheckBox").attr("style","visibility:visible"),"false"===n||!1===n||"true"===n||!0===n){var o=r.closest("tr"),s=o.prev("tr");o.removeClass("highlgtMLookup").removeClass("setTdBorBtm"),!0===s.hasClass("setTdBorBtm")&&s.removeClass("setTdBorBtm")}var l=r.data("params").entityId;i.indexOf(l)>-1&&(i=(i=(i=i.replace(l+",","")).replace(","+l,"")).replace(l,""),a--)})),a>0?$.each($(".customCheckBox.onHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBox").attr("style","visibility:visible")})):$.each($(".customCheckBox.onHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).closest("tr").removeClass("highlgtMLookup").removeClass("setTdBorBtm")})),$("#mxnlistViewTable #checkAll").attr("class","customCheckBox"),$("#fixedChkSelAll").attr("class","customCheckBox"),$.each($(".customCheckBoxDisabledHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBoxDisabled").attr("style","visibility:hidden")}));if("true"===n||!0===n){if(multiLookupsView.currentMultiLookup.unselectedid=i,multiLookupsView.currentMultiLookup.unselectedCount=a,(I=$(".mlSelectedRecord"))&&I.length>0)I.html(multiLookupsView.currentMultiLookup.unselectedCount),(y=$("#mlSelectedRecordMsg")).text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedPluralLabel)),1===multiLookupsView.currentMultiLookup.unselectedCount&&y.text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedSingularLabel));(w=$(".mlUnConfirmSelectedRecordCount"))&&w.html(multiLookupsView.currentMultiLookup.unselectedCount)}else if("false"===n||!1===n){var I,y,w;if(multiLookupsView.currentMultiLookup.selectedid=i,multiLookupsView.currentMultiLookup.selectedCount=a,(I=$(".mlSelectedRecord"))&&I.length>0)I.html(multiLookupsView.currentMultiLookup.selectedCount),(y=$("#mlSelectedRecordMsg")).text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedPluralLabel)),1===multiLookupsView.currentMultiLookup.selectedCount&&y.text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedSingularLabel));(w=$(".mlUnConfirmSelectedRecordCount"))&&w.html(multiLookupsView.currentMultiLookup.selectedCount)}var L=!1;if("customCheckBox"!=o||multiLookupsView.currentMultiLookup.dontShowWarning||multiLookupsView.currentMultiLookup.reassign||"false"!=n&&0!=n||"next"==multiLookupsView.multiLookups[s].mlaction||(L=!0),multiLookupsView.currentMultiLookup.selectedCount>0||multiLookupsView.currentMultiLookup.unselectedCount>0){if(a>0){var b;if($("#nextStep").prop("disabled",!1),$("#confirmStep").prop("disabled",!1),$("#removeAllBtn").css("visibility","hidden").css("display","none"),$("#selected-records").css("visibility","visible"),$("#selected-records .mlSelectedRecord").css("visibility","visible"),"true"===multiLookupsView.multiLookups[s].variedLookupValues.select)(b=document.getElementsByName("AddMore")[0]).setAttribute("style","display:none;visibility:hidden");L||($(".animateMl").css("visibility","hidden").addClass("cvTableAct"),$("#selected-records").css("visibility","visible"))}}else if($("#nextStep").prop("disabled",!0),$("#confirmStep").prop("disabled",!0),$(".animateMl").css("visibility","visible").removeClass("cvTableAct"),$("#selected-records").css("visibility","hidden"),$("#selected-records .mlSelectedRecord").css("visibility","hidden"),$("#removeAllBtn").css("visibility","visible").css("display","initial"),"true"===multiLookupsView.multiLookups[s].variedLookupValues.select&&(b=document.getElementsByName("AddMore")[0])){b.setAttribute("style","display:initial;visibility:visible");var k=document.getElementById("removeAllBtn");null!=k&&k.setAttribute("style","display:initial;visibility:visible")}L&&multiLookupsView.callPermissionDeniedWarningPopupFormSelectAll(t.attr("id")),multiLookupsView.currentMultiLookup.productIdVsQtyObj=c,multiLookupsView.currentMultiLookup.reassign=!1},callPermissionDeniedWarningPopupFormSelectAll:function(e){for(var t=multiLookupsView.currentMultiLookup.fldName,i=($("#listviewHeaderRow").find("td"),$("#mxnBody").find("tr")),a=i.length,r=0;r<a;r++){var n=i.eq(r);if($(n.find(".customCheckBox.disable")).length>0)return void multiLookupsView.permissionIssueWarningShow(null,null,multiLookupsView.multiLookups[t].searchmodule,3,e)}multiLookupsView.callLookupUpdateAllWarningPopup(e)},callLookupUpdateAllWarningPopup:function(e){var t,i=multiLookupsView.currentMultiLookup.fldName,a=$("#listviewHeaderRow").find("td"),r=a.length;for(t=0;t<r&&$(a.eq(t).find("a")).attr("id")!==multiLookupsView.currentMultiLookup.parentColumn;t++);var n=$("#mxnBody").find("tr"),o=n.length,s=!1;for(iy=0;iy<o;iy++){var l=n.eq(iy);if(0==$(l.find(".customCheckBox.disable")).length){var c=$(l.find("td").eq(t)).find("a").text();if(c&&c.trim().length>0){s=!0;$(l.find(".customCheckBoxChecked")).data("params").entityId}}}if(s){$(".animateMl").css("visibility","visible").removeClass("cvTableAct"),$("#selected-records").css("visibility","hidden");var d=$("#topBandPopup .pp-content").position().top,u=multiLookupsView.multiLookups[i].parentModule,m=moduleRecordMapping[multiLookupsView.multiLookups[i].searchmodule].plural_label.toLowerCase(),p=moduleRecordMapping[u].singular_label.toLowerCase(),g=$ESAPI.encoder(),h=I18n.getMsg("crm.mxnlookup.select",[g.encodeForHTML(moduleRecordMapping[multiLookupsView.multiLookups[i].searchmodule].plural_label)]),v=$("#topSectionTitle").find(".dvTitle").text().trim(),f=I18n.getMsg("crm.mxnlookup.lookuprel.updateselectalllookupwarning",[g.encodeForHTML(m),g.encodeForHTML(moduleRecordMapping[u].plural_label.toLowerCase()),g.encodeForHTML(m),g.encodeForHTML(p),g.encodeForHTML(v)]),C=multiLookupsView.createLookupUpdateWarningPopup(h,0,f,e,1,u);return $("#freezeBackGround").css("z-index","250"),C.css("z-index","301"),crmui.modalZIndex("nonLyte",$L("#tempWarningPopup")[0],"open"),void C.show().addClass("zcrm-show").css("top",d)}$(".animateMl").css("visibility","hidden").addClass("cvTableAct"),$("#selected-records").css("visibility","visible")},callLookupUpdateWarningPopup:function(e,t,i){var a,r=multiLookupsView.currentMultiLookup.fldName,n=$("#listviewHeaderRow").find("td"),o=n.length;for(a=0;a<o&&$($(n.eq(a)).find("a")).attr("id")!==multiLookupsView.currentMultiLookup.parentColumn;a++);var s=$("#mLookup_"+e).text(),l=(e=$(i.find(".customCheckBoxChecked")).data("params").entityId,$(i.find("td").eq(a)).find("a").text());if(l&&l.trim().length>0){$(".animateMl").css("visibility","visible").removeClass("cvTableAct"),$("#selected-records").css("visibility","hidden");var c=$("#topBandPopup .pp-content").position().top,d=multiLookupsView.multiLookups[r].parentModule,u=moduleRecordMapping[multiLookupsView.multiLookups[r].searchmodule].singular_label,m=moduleRecordMapping[d].singular_label.toLowerCase(),p=I18n.getMsg("crm.mxnlookup.select",[moduleRecordMapping[multiLookupsView.multiLookups[r].searchmodule].plural_label]),g=$("#topSectionTitle").find(".dvTitle").text().trim(),h=$ESAPI.encoder(),v=I18n.getMsg("crm.mxnlookup.lookuprel.updatelookupwarning",[h.encodeForHTML(u),h.encodeForHTML(s),h.encodeForHTML(m),h.encodeForHTML(l),h.encodeForHTML(m),h.encodeForHTML(g),h.encodeForHTML(g),h.encodeForHTML(g)]),f=multiLookupsView.createLookupUpdateWarningPopup(p,0,v,t,0,d);return $("#freezeBackGround").css("z-index","250"),f.css("z-index","301"),crmui.modalZIndex("nonLyte",$L("#tempWarningPopup")[0],"open"),void f.show().addClass("zcrm-show").css("top",c)}$(".animateMl").css("visibility","hidden").addClass("cvTableAct"),$("#selected-records").css("visibility","visible")},selectMultiSelectEntity:function(e,t){var i=(t=$(t)).closest("tr"),a=i.prev("tr"),r="",n=t.attr("class"),o=0,s=multiLookupsView.currentMultiLookup.fldName,l=multiLookupsView&&multiLookupsView.currentMultiLookup&&multiLookupsView.currentMultiLookup.productIdVsQtyObj?multiLookupsView.currentMultiLookup.productIdVsQtyObj:{},c=t.data("params"),d=c.select;if("customCheckBoxDisabled"!==n){""===d&&(d=!1),"true"===d||!0===d?(r=multiLookupsView.currentMultiLookup.unselectedid,o=multiLookupsView.currentMultiLookup.unselectedCount):"false"!==d&&!1!==d||("next"===c.mlaction&&(multiLookupsView.currentMultiLookup.needconfirm&&""!==multiLookupsView.currentMultiLookup.needconfirm||(multiLookupsView.currentMultiLookup.needconfirm=multiLookupsView.currentMultiLookup.selectedid)),r=multiLookupsView.currentMultiLookup.selectedid,o=multiLookupsView.currentMultiLookup.selectedCount);var u,m=c.entityId;if("customCheckBoxDisabled"!==n&&"customCheckBoxDisabledHover"!==n)if("customCheckBox onHover"===n||"customCheckBox"===n){if(o+1>100)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",100));if(t.attr("class","customCheckBoxChecked"),$.each($(".customCheckBox[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("style","visibility:visible")})),$.each($(".customCheckBox.onHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBox").attr("style","visibility:visible")})),$.each($(".customCheckBoxDisabled[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBoxDisabledHover").attr("style","visibility:visible")})),"false"!==d&&!1!==d&&"true"!==d&&!0!==d||void 0!==c.mlaction&&"next"===c.mlaction||(i.addClass("highlgtMLookup").addClass("setTdBorBtm"),!1===a.hasClass("setTdBorBtm")&&a.addClass("setTdBorBtm")),m+""=="error")return;""===r?r=m:r+=","+m,0===$(".customCheckBox[data-cid=mLookupselectEntity]").length&&$("#checkAll").attr("class","customCheckBoxChecked"),o++}else("true"===d||!0===d)&&1===multiLookupsView.currentMultiLookup.unselectedCount?($.each($(".customCheckBox[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBox onHover").attr("style","visibility:hidden")})),$.each($(".customCheckBoxDisabledHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBoxDisabled").attr("style","visibility:hidden")})),t.attr("class","customCheckBox onHover").attr("style","visibility:visible")):t.attr("class","customCheckBox"),"false"!==d&&!1!==d&&"true"!==d&&!0!==d||(i.removeClass("highlgtMLookup").removeClass("setTdBorBtm"),!0===a.hasClass("setTdBorBtm")&&a.removeClass("setTdBorBtm")),r.indexOf(m)>-1&&(r=(r=(r=r.replace(m+",","")).replace(","+m,"")).replace(m,""),$("#checkAll").attr("class","customCheckBox"),o--);if("true"===d||!0===d)multiLookupsView.currentMultiLookup.unselectedid=r,multiLookupsView.currentMultiLookup.unselectedCount=o,(h=$(".mlSelectedRecord"))&&h.length>0&&h.html(multiLookupsView.currentMultiLookup.unselectedCount);else if("false"===d||!1===d){multiLookupsView.currentMultiLookup.selectedid=r,multiLookupsView.currentMultiLookup.selectedCount=o,(h=$(".mlSelectedRecord"))&&h.length>0&&h.html(multiLookupsView.currentMultiLookup.selectedCount);var p=$(".mlUnConfirmSelectedRecordCount");p&&p.html(multiLookupsView.currentMultiLookup.selectedCount)}multiLookupsView.currentMultiLookup.selectedCount>1||multiLookupsView.currentMultiLookup.unselectedCount>1?$("#mlSelectedRecordMsg").text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedPluralLabel)):$("#mlSelectedRecordMsg").text(I18n.getMsg("crm.label.deduplicate.selected",Crm.moduleInfo[multiLookupsView.multiLookups[s].searchmodule].translatedSingularLabel)),""===multiLookupsView.currentMultiLookup.unselectedid&&""===multiLookupsView.currentMultiLookup.selectedid&&("true"!==d&&!0!==d||($.each($(".customCheckBox.onHover[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("style","visibility:hidden")})),$.each($(".customCheckBox[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("style","visibility:hidden")})),t.attr("class","customCheckBox onHover").attr("style","visibility:visible"))),"customCheckBox"!=n||multiLookupsView.currentMultiLookup.dontShowWarning||multiLookupsView.currentMultiLookup.reassign||!multiLookupsView.currentMultiLookup.lookuprel||"false"!=d&&0!=d||"next"==multiLookupsView.multiLookups[s].mlaction||(u=!0);var g,h=$(".mlSelectedRecord");if(l[m]=1,multiLookupsView.currentMultiLookup.productIdVsQtyObj=l,multiLookupsView.currentMultiLookup.selectedCount>0||multiLookupsView.currentMultiLookup.unselectedCount>0?($("#nextStep").prop("disabled",!1),$("#confirmStep").prop("disabled",!1),$("#removeAllBtn").css("visibility","hidden").css("display","none"),h.css("visibility","visible"),$("#selected-records").css("visibility","visible"),u||($(".animateMl").css("visibility","hidden").addClass("cvTableAct"),h.css("visibility","visible"))):($("#nextStep").prop("disabled",!0),$("#confirmStep").prop("disabled",!0),$(".animateMl").css("visibility","visible").removeClass("cvTableAct"),$("#selected-records").css("visibility","hidden"),$("#removeAllBtn").css("visibility","visible").css("display","initial"),h.css("visibility","hidden")),"true"===d||!0===d)if(multiLookupsView.currentMultiLookup.unselectedCount>0)document.getElementsByName("AddMore")[0].setAttribute("style","display:none;visibility:hidden"),null!=(g=document.getElementById("removeAllBtn"))&&g.setAttribute("style","display:none;visibility:hidden");else document.getElementsByName("AddMore")[0].setAttribute("style","display:initial;visibility:visible"),null!=(g=document.getElementById("removeAllBtn"))&&g.setAttribute("style","display:initial;visibility:visible");u&&multiLookupsView.callLookupUpdateWarningPopup(m,t.attr("id"),i),multiLookupsView.currentMultiLookup.reassign=!1}},confirmUnSelectedAction:function(e){var t="",i="",a=multiLookupsView.currentMultiLookup.confirmselectedid.split(",").length;""===multiLookupsView.currentMultiLookup.confirmselectedid&&(a=0);var r=$("#"+e);if(r&&!(i=r.data("id"))&&(i=r.data("selectedid"))){var n=i.split("-");t=n.length>1?n[1]:"",multiLookupsView.multiLookups[e]&&(multiLookupsView.multiLookups[e].variedLookupValues.confirmunselectedid=t)}"all"===multiLookupsView.currentMultiLookup.unselectedid&&(multiLookupsView.currentMultiLookup.confirmunselectedid="all",multiLookupsView.currentMultiLookup.confirmselectedid="",e&&$("#"+e).val(""));if(""!==multiLookupsView.currentMultiLookup.confirmunselectedid&&"all"!==multiLookupsView.currentMultiLookup.unselectedid&&(multiLookupsView.currentMultiLookup.confirmunselectedid+=","+multiLookupsView.currentMultiLookup.unselectedid),""===multiLookupsView.currentMultiLookup.confirmunselectedid&&(multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.unselectedid),""!==multiLookupsView.currentMultiLookup.confirmunselectedid){var o=multiLookupsView.currentMultiLookup.confirmunselectedid.split(",");""!==o&&"all"===o[0]&&"all"!==multiLookupsView.currentMultiLookup.unselectedid&&(o[0]=multiLookupsView.currentMultiLookup.unselectedid);for(var s=o.length,l=0;l<s;l++){var c=o[l];multiLookupsView.currentMultiLookup.confirmselectedid.includes(c)&&"ajaxEdit"===$(r).data("currentstatus")&&(multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(c+",",""),multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(","+c,""),multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(c,"")),multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(c+",",""),multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(","+c,""),multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(c,"")}}if(!multiLookupsView.multiLookups[e].relatedlist){var d=r.data().selectedid;let t=multiLookupsView.currentMultiLookup.confirmselectedid,i=multiLookupsView.currentMultiLookup.confirmunselectedid;d=void 0===d||""==t&&""==i?"":t+"-"+i,"create"===window[multiLookupsView.multiLookups[e].module].currentStatus&&"-all"===d&&(d=""),"-all"===d&&(d=d+"-"+a),r.data().selectedid=d,$("."+e).val(d)}multiLookupsView.currentMultiLookup.unselectedid=""},confirmSelectedAction:function(e){var t=$("#"+e),i="";if(t&&!(i=t.data("id"))&&(i=t.data("selectedid"))){var a=i.split("-");i=a[0],multiLookupsView.multiLookups[e]&&(multiLookupsView.multiLookups[e].variedLookupValues.confirmselectedid=i)}if(""===multiLookupsView.currentMultiLookup.confirmselectedid?multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.selectedid:multiLookupsView.currentMultiLookup.confirmselectedid+=","+multiLookupsView.currentMultiLookup.selectedid,""!==multiLookupsView.currentMultiLookup.confirmselectedid)for(var r=multiLookupsView.currentMultiLookup.confirmselectedid.split(","),n=r.length,o=0;o<n;o++){var s=r[o];multiLookupsView.currentMultiLookup.confirmunselectedid.includes(s)&&"ajaxEdit"===$(t).data("currentstatus")&&(multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(s+",",""),multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(","+s,""),multiLookupsView.currentMultiLookup.confirmselectedid=multiLookupsView.currentMultiLookup.confirmselectedid.replace(s,"")),multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(s+",",""),multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(","+s,""),multiLookupsView.currentMultiLookup.confirmunselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid.replace(s,"")}if(!multiLookupsView.multiLookups[e].relatedlist){var l=t.data().selectedid;let i=multiLookupsView.currentMultiLookup.confirmunselectedid,a=multiLookupsView.currentMultiLookup.confirmselectedid;l=void 0===l||"all"==i||""==i&&""==a?a:a+"-"+i,t.data().selectedid=l,$("."+e).val(l)}multiLookupsView.currentMultiLookup.selectedid=""},getCscriptFilterCriteria:function(e){let t;if(e){const i=e&&e.data("sysrefname"),a=i&&Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(!a){const t=e.data&&e.data();return t&&t.criteria&&{criteria:t.criteria.criteria,config:{filterOnSearch:!!t.criteria.filterOnSearch}}}{const e=a.component.data.moduleData.fields.find((e=>e.api_name===i));t=e&&e.$.get("criteria")}}return t?{criteria:t.criteria,config:t.config}:void 0},sortColumnsInMultiLookup:function(e,t,i,a,r){t.id&&(t=t.id);var n=multiLookupsView.getParamJson(t);n.select=multiLookupsView.currentMultiLookup.select,n.FROM_INDEX=1,n.TO_INDEX=multiLookupsView.lookupPopupRecordCount,n.sortColumnString=e,n.sortOrderString=a===e&&"sort_asc"===r?"sort_desc":"sort_asc";var o=Lyte.Router.getRouteInstance(),s=o&&"canvas"===o.routeName;let l=s?store.peekRecord("field",t):$("#"+t);if(CScriptLib&&l){let e=s?l.criteria:multiLookupsView.getCscriptFilterCriteria(l);e&&""!==e.criteria&&(n.filtercriteria=JSON.stringify({criteria:e.criteria}))}multiLookupsView.submitMultiLookupForm("sort",Crm.getCrmBasePath()+"/Search.do","topBandPopup",n)},clearSearchAction:function(e){e.id&&(e=e.id);var t=$("#topBandPopup");if(t){var i=t.find('input[name = "searchString"]');i&&i.val()&&(i.val(""),i.focus(),multiLookupsView.currentMultiLookup.searchString="")}$(".mlSearchClose").removeClass("activesearch"),$(".mlSearchClose span").removeClass("activesearch");var a=multiLookupsView.getParamJson(e);a.FROM_INDEX=1,a.TO_INDEX=multiLookupsView.lookupPopupRecordCount,a.isPartialLoad=!0,a.select=multiLookupsView.currentMultiLookup.select,a.fldValue=multiLookupsView.currentMultiLookup.searchString;var r=Lyte.Router.getRouteInstance(),n=r&&"canvas"===r.routeName;let o=n?store.peekRecord("field",e):$("#"+e);if(CScriptLib&&o){let e=n?o.criteria:multiLookupsView.getCscriptFilterCriteria(o);e&&""!==e.criteria&&(a.filtercriteria=JSON.stringify({criteria:e.criteria}))}multiLookupsView.submitMultiLookupForm(a.mlaction,Crm.getCrmBasePath()+"/Search.do","topBandPopup",a)},navigatePrevious:function(e,t){var i=$(t).data("params"),a=i.fldName,r=parseInt(i.fromIndex),n=parseInt(i.toIndex);if(a.id&&(a=a.id),r&&r>=11){var o=multiLookupsView.getParamJson(a);multiLookupsView.setSelfRefParams(o,a),n=r-1,r-=multiLookupsView.lookupPopupRecordCount,o.select=multiLookupsView.currentMultiLookup.select,o.fldValue=multiLookupsView.currentMultiLookup.searchString,o.isPartialLoad=!0,o.FROM_INDEX=r,o.TO_INDEX=n;var s=Lyte.Router.getRouteInstance(),l=s&&"canvas"===s.routeName;let e=l?store.peekRecord("field",a):$("#"+a);if(CScriptLib&&e){let t=l?e.criteria:multiLookupsView.getCscriptFilterCriteria(e);t&&""!==t.criteria&&(o.filtercriteria=JSON.stringify({criteria:t.criteria}))}multiLookupsView.submitMultiLookupForm(o.mlaction,Crm.getCrmBasePath()+"/Search.do","topBandPopup",o)}},navigateNext:function(e,t){var i=$(t).data("params"),a=i.fldName,r=parseInt(i.fromIndex),n=parseInt(i.toIndex);a.id&&(a=a.id);var o=multiLookupsView.getParamJson(a);n=(r+=multiLookupsView.lookupPopupRecordCount)+(multiLookupsView.lookupPopupRecordCount-1),o.FROM_INDEX=r,o.TO_INDEX=n,o.isPartialLoad=!0,o.fldValue=multiLookupsView.currentMultiLookup.searchString,o.select=multiLookupsView.currentMultiLookup.select;var s=Lyte.Router.getRouteInstance(),l=s&&"canvas"===s.routeName;let c=l?store.peekRecord("field",a):$("#"+a);if(CScriptLib&&c){let e=l?c.criteria:multiLookupsView.getCscriptFilterCriteria(c);e&&""!==e.criteria&&(o.filtercriteria=JSON.stringify({criteria:e.criteria}))}multiLookupsView.setSelfRefParams(o,a),multiLookupsView.submitMultiLookupForm(o.mlaction,Crm.getCrmBasePath()+"/Search.do","topBandPopup",o)},submitSearchAction:function(e){e.id&&(e=e.id);var t=multiLookupsView.getParamJson(e);t.FROM_INDEX=1,t.TO_INDEX=multiLookupsView.lookupPopupRecordCount,t.select=multiLookupsView.currentMultiLookup.select,t.page=multiLookupsView.currentMultiLookup.page,multiLookupsView.setSelfRefParams(t,e);var i=$("#topBandPopup"),a=0,r=document.getElementById("error_msg");if(i){var n=i.find('input[name = "searchString"]');if(n&&/([\uD800-\uDBFF][\uDC00-\uDFFF])/i.test(n.val())){if(r)return;let e=n[0],t=document.createElement("span");return t.className="lyteErrorMsg create-custom-err",t.id="error_msg",t.textContent=I18n.getMsg("crm.label.error.msg"),void e.parentNode.insertBefore(t,e.nextSibling)}r&&r.remove(),n&&n.val()?(multiLookupsView.currentMultiLookup.searchString=n.val(),t.fldValue=n.val(),a=1):(multiLookupsView.currentMultiLookup.searchString="",t.fldValue="")}t.isPartialLoad=!0,t.lookuprel||""!==multiLookupsView.currentMultiLookup.unselectedid&&0===a&&""!=n.val()&&(t.select=!0,t.mlaction="addmore");var o=Lyte.Router.getRouteInstance(),s=o&&"canvas"===o.routeName;let l=s?store.peekRecord("field",e):$("#"+e);if(CScriptLib&&l){const e=s?l.criteria:multiLookupsView.getCscriptFilterCriteria(l),i=e&&e.config&&e.config.filterOnSearch?e.criteria:void 0;i&&""!==i&&(t.filtercriteria=JSON.stringify({criteria:i,filterOnSearch:!0}))}multiLookupsView.submitMultiLookupForm(t.mlaction,Crm.getCrmBasePath()+"/Search.do","topBandPopup",t)},submitMultiLookupForm:function(e,t,i,a,r){if(a&&Crm.userDetails.isMultiSelectionPopupSupported&&!Crm.isFromSalesInbox){var n=$("#relatedListCols");n.is(":visible")&&n.css("display","none");var o=!1;if(Lyte.Router.getRouteInstance()&&"canvas"===Lyte.Router.getRouteInstance().routeName)(s=$L("crm-detailview-canvas"))&&s[0]&&(o=s[0].component.data.recordLockingDetails&&s[0].component.data.recordLockingDetails.fieldIds.contains(a.fldName));else if(Crm.userDetails.DETAIL_VIEW_LYTE){var s;(s=$L("crm-detailview-content"))&&s[0]&&(o=s[0].component.data.recordLockingDetails&&s[0].component.data.recordLockingDetails.fieldIds.contains(a.fldName))}else"detail"===Lyte.Router.getRouteInstance().routeName&&(o="detail"===Lyte.Router.getRouteInstance().routeName&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&detailView.changedBCJson.recordLockingDetails.fieldIds.length&&detailView.changedBCJson.recordLockingDetails.fieldIds.contains(a.fldName));return $L("#topBandPopup").empty(),void Lyte.Component.render("crm-multi-selection-popup",{isLookUp:!!a.lookuprel,entityId:a.entityId,parentModule:a.parentModule,relatedListId:a.relid,isRelatedList:!0,linkingModule:a.linkingmodule,module:a.searchmodule,fieldId:a.fldName,isMxnLockExculdedField:o,isEdit:"edit"===a.link,isFromField:!!a.fromField,action:"edit"!==a.link?"unassign":"assign"},"#topBandPopup")}a&&delete a.fromField,a&&("sort"==e&&(e=a.mlaction),"next"==e?(multiLookupsView.currentMultiLookup.needconfirm&&""!=multiLookupsView.currentMultiLookup.needconfirm||(multiLookupsView.currentMultiLookup.needconfirm=multiLookupsView.currentMultiLookup.selectedid),a.needconfirmid=multiLookupsView.currentMultiLookup.needconfirm,a.confirmpageselectedid=multiLookupsView.currentMultiLookup.selectedid):(multiLookupsView.currentMultiLookup.needconfirm="",a.selectedid=multiLookupsView.currentMultiLookup.confirmselectedid,a.unselectedid=multiLookupsView.currentMultiLookup.confirmunselectedid)),$("#searchCreatePopup").is(":visible")&&(a.fromSearchCreate=!0);var l=objectUtils.URL(t).getParams();if(l&&"remove"===l.mlaction&&!isNaN(l.unselectedid)&&l.searchmodule&&"true"===l.relatedlist&&!isNaN(l.fldId)&&!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(l.searchmodule)){Crm.VR||(Crm.VR={});var c=$("#newleft_"+l.fldId).data().columnname;c&&(Crm.VR.ajaxEditFieldLabel=c);var d={module:l.searchmodule,entityId:l.unselectedid,layoutId:""};return d[csrfParamName]=encodeURIComponent(csrfToken),d.onlyEntityDetails=!0,d.includeVR=!0,void(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:d,type:"POST",success:function(e){Crm.VR.entityDetails=$.parseJSON(e.entityInfo),Crm.validationRuleJSONData[l.searchmodule]=JSON.parse(e.validationRuleJSON),Crm.VR.entityDetails.entityMapJson[c]?new Promise((function(e){e(multiLookupsView.executeVRRule(l.unselectedid,t,l.searchmodule,r,i,a,c))})).then((function(e){e||commonUtils.openCustomLookup(t,a,i,renderingUtils.windowWidth-300,void 0,void 0,r)})):commonUtils.openCustomLookup(t,a,i,renderingUtils.windowWidth-300,void 0,void 0,r)},error:function(){}})}commonUtils.openCustomLookup(t,a,i,renderingUtils.windowWidth-300,void 0,void 0,r)},executeVRRule:function(e,t,i,a,r,n,o){return Crm.VR.lookup_unassign=!0,CVRExec.storeStageValue("",o),CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view",i,o,!0,!0,!1,!1,!0))})).then((function(e){return Crm.VR&&delete Crm.VR.lookup_unassign,!e&&(hideAnimatePopup("deletepopup"),!0)}))},newMultiSelectAction:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{if(multiLookupsView.currentMultiLookup&&multiLookupsView.currentMultiLookup.selectedCount&&""!=multiLookupsView.currentMultiLookup.selectedCount){var t=multiLookupsView.currentMultiLookup.selectedCount;if(multiLookupsView.currentMultiLookup.confirmselectedid&&""!==multiLookupsView.currentMultiLookup.confirmselectedid&&(t+=multiLookupsView.currentMultiLookup.confirmselectedid.split(",").length),t>=100)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.mxn.assign.maximum.records.alert",100))}e.id&&(e=e.id);var i=multiLookupsView.getParamJson(e);delete i.page,i.select=!1,i.FROM_INDEX=1,i.TO_INDEX=multiLookupsView.lookupPopupRecordCount,i.targetForm="searchCreatePopup",i.fldValue=multiLookupsView.currentMultiLookup.searchString,i.module=i.searchmodule,i.newModel=!0,i.select=!1,i.selectedid=multiLookupsView.currentMultiLookup.confirmselectedid,multiLookupsView.currentMultiLookup.lookuprel&&(i.entitylabel=$("#topSectionTitle").find(".dvTitle").text().trim());var a;a=Crm.getCrmBasePath()+"/QuickCreateAction.do",renderingUtils.hideFreezeLayer(),$("#formName").removeClass("zcrm-show").css({top:"0px",display:"none"}).width(""),commonUtils.openCustomLookup(a,i,"searchCreatePopup"),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(i.module))&&Crm.downloadValidationRules(a+"?module="+i.module+(i.layoutId?"&layoutId="+i.layoutId:""),i.module);var r=$L("crm-canvas-quicksavepopup")[0];if(r&&r.component.getData("showPopup"))$L("#searchCreatePopup").addClass("zcanavsZI313"),$L("#freezeBackGround").addClass("zcanavsZI312");$("#freezeBackGround").css({"background-color":"#000",opacity:"0.2"})}},removeMLRecord:function(e,t,i){Crm.trackSpotLightAction("Multi Select Lookup - Remove All Click",{Module:multiLookupsView.multiLookups[e].searchmodule});var a=$("#mxnBody tr").length,r=$("#multipleFieldsEditPop").is(":visible")||$L("crm-blueprint-exec-popup").is(":visible"),n=$("#"+multiLookupsView.currentMultiLookup.fldName);if("all"===multiLookupsView.currentMultiLookup.unselectedid&&($("#searchCreatePopup").is(":visible")?$("#freezeBackGround").css("z-index","251"):$("#freezeBackGround").css("z-index","30")),0!==a){e.id&&(e=e.id);var o=$("#topBandPopup .pp-content").position().top;void 0!==t&&""===multiLookupsView.currentMultiLookup.unselectedid&&(multiLookupsView.currentMultiLookup.unselectedid="all"===t&&r?n.data("selectedid").replace("-",","):t+"");var s="crm.msg.selected",l=moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].singular_label;if(t||(s="",l=moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].plural_label,"all"===t&&(multiLookupsView.currentMultiLookup.unselectedid=r?n.data("selectedid").replace("-",","):t)),s=I18n.getMsg(s),"all"===t)if(s="",l=moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].plural_label,$("#heading_title").length)if("Edit"===$(heading_title).text().trim().substring(0,$(heading_title).text().trim().indexOf(" ")))var c=I18n.getMsg("crm.mxnlookup.editpopup.unassignall.popup",[l,moduleRecordMapping[multiLookupsView.multiLookups[e].parentModule].singular_label.toLowerCase()]);else c=I18n.getMsg("crm.mxnLookup.dissociatemessage",[l.toLowerCase(),i,moduleRecordMapping[multiLookupsView.multiLookups[e].parentModule].singular_label.toLowerCase()]);else c=I18n.getMsg("crm.mxnLookup.dissociatemessage",[l.toLowerCase(),i,moduleRecordMapping[multiLookupsView.multiLookups[e].parentModule].singular_label.toLowerCase()]);else if(1===multiLookupsView.currentMultiLookup.unselectedCount)c=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[$("#mLookup_"+multiLookupsView.currentMultiLookup.unselectedid).text(),moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].singular_label.toLowerCase(),i,moduleRecordMapping[multiLookupsView.multiLookups[e].parentModule].singular_label.toLowerCase()]);else c=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[multiLookupsView.currentMultiLookup.unselectedCount,moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].plural_label.toLowerCase(),i,moduleRecordMapping[multiLookupsView.multiLookups[e].parentModule].singular_label.toLowerCase()]);var d=multiLookupsView.createTempWarningPopup(c,"mxnDissociate");d.show().addClass("zcrm-show").css("top",o),d.css("z-index","301"),crmui.modalZIndex("nonLyte",$L("#tempWarningPopup")[0],"open")}},cancelDeleteWarningPopup:function(){"all"===multiLookupsView.currentMultiLookup.unselectedid&&(multiLookupsView.currentMultiLookup.unselectedid=""),$(".selectedRow").removeClass("selectedRow trialyellowbox").addClass("unselectedRow");var e=$L("#freezeBackGround");$("#searchCreatePopup").is(":visible")?e.css("z-index","251"):e.css("z-index","30"),multiLookupsView.removeTempWarningPopup();var t=$L("crm-canvas-quicksavepopup")[0];t&&t.component.getData("showPopup")&&(e.removeClass("zcanavsZI312"),$L("#tempWarningPopup").removeClass("zcanavsZI312"))},cancelLookupUpdatePopup:function(e,t){$(".selectedRow").removeClass("selectedRow trialyellowbox").addClass("unselectedRow"),$("#freezeBackGround").css("z-index","30");var i=$("#"+e);if(multiLookupsView.currentMultiLookup.reassign=!0,multiLookupsView.removeLookupUpdateWarningPopup(),1==t||"1"==t){var a,r=$("#listviewHeaderRow").find("td"),n=r.length;for(a=0;a<n&&$(r.eq(a).find("a")).attr("id")!==multiLookupsView.currentMultiLookup.parentColumn;a++);for(var o=$("#mxnBody").find("tr"),s=o.length,l=0;l<s;l++){var c=o.eq(l).find("td"),d=$(c.eq(a)).find("a").text(),u="#"+$(c.eq(0)).find("span").attr("id");d&&d.trim().length>0&&multiLookupsView.selectMultiSelectEntity(null,u)}}else multiLookupsView.selectMultiSelectEntity(null,i)},cancelMxNLookupWarning:function(e){e.id&&(e=e.id);var t=$("#topBandPopup .pp-content").position().top,i=I18n.getMsg("crm.mxnLookup.conformclosewarning",moduleRecordMapping[multiLookupsView.multiLookups[e].searchmodule].singular_label),a=multiLookupsView.createTempWarningPopup(i,"mxnCloseConfirm");a.show().addClass("zcrm-show").css("top",t),$("#freezeBackGround").css("z-index","250"),a.css("z-index","251")},hideCancelPopup:function(){var e=$L("#freezeBackGround");e.css("z-index","30"),multiLookupsView.removeTempWarningPopup();var t=$L("crm-canvas-quicksavepopup")[0];t&&t.component.getData("showPopup")&&(e.removeClass("zcanavsZI312"),$L("#tempWarningPopup").removeClass("zcanavsZI312"))},mlrecordclear:function(){var e=!1;multiLookupsView.currentMultiLookup.selectedCount>0&&(e=!0);var t=$("#checkAll"),i=$(".mlSelectedRecord");if(t.attr("class","customCheckBox"),multiLookupsView.currentMultiLookup.unselectedCount>1)for(var a=multiLookupsView.currentMultiLookup.unselectedid.split(","),r=0;r<multiLookupsView.currentMultiLookup.unselectedCount;r++){$("#selectEntity_"+a[r]).attr("class","customCheckBox onHover").attr("style","visibility:hidden")}else if(1===multiLookupsView.currentMultiLookup.unselectedCount){$("#selectEntity_"+multiLookupsView.currentMultiLookup.unselectedid).attr("class","customCheckBox onHover").attr("style","visibility:hidden")}!1===e&&$.each($(".customCheckBox[data-cid=mLookupselectEntity]"),(function(e,t){$(t).attr("class","customCheckBox onHover").attr("style","visibility:hidden")})),multiLookupsView.currentMultiLookup.selectedid="",multiLookupsView.currentMultiLookup.selectedCount=0,multiLookupsView.currentMultiLookup.unselectedid="",multiLookupsView.currentMultiLookup.unselectedCount=0,multiLookupsView.selectMultiSelectAllEntity(t,!1),i&&i.length>0&&i.html(multiLookupsView.currentMultiLookup.selectedCount)},showMxNLookup:function(e){var t,i=$(e.target).closest("div").data("params"),a=$ESAPI.encoder().encodeForJavaScript(i.pname);if(Crm.userDetails.isRelatedListLyteEnabled){var r=$L("crm-related-list-view")[0];t=(r?r.getData("relatedList"):[]).filter((function(e){return e.personality_name===a}))[0],Lyte.registeredMixins["crm-related-list-utils"].addRelatedListsToDom(t?t.id:"",a,r)}var n=$("div[ddname = "+a+"]"),o=n.offset().top,s=$L("#dvinner");n&&n.length&&(s.animate({scrollTop:o-s.offset().top+s.scrollTop()-20},200),Crm.userDetails.isRelatedListLyteEnabled&&Lyte.Globals.set("relatedList.scrollAfterLoad",t?t.id:""))},validateRenameRelList:function(e,t){var i=$.trim(e).toUpperCase(),a=!0;return $.trim(e)?/^CUSTOMMODULE[0-9]{1,4}$/.test(i)||relatedListHeader.specialKeywords.contains(i)||"Potentials"==detailView.currentModule&&"INVOICES"==i?(t.push(I18n.getMsg("crm.mb.field.common.sykw")),a=!1):splCharCheck(e)||(t.push(I18n.getMsg("crm.mb.field.common.splc")),a=!1):(t.push(I18n.getMsg("crm.mb.field.common.empt")),a=!1),a},updateLookupView:function(){var e=$("crm-entity-lookup")[0].component,t=$("input[name=fldName]").val();e.updateLookUpView.call(e,t)},updateMXNFieldValue:function(e,t,i){var a="",r=$("#multipleFieldsEditPop").is(":visible");if(void 0!==i){if(e)a=e,$("#"+a).val(i);else{a=(crmRelatedList.EachModuleData[t]?crmRelatedList.EachModuleData[t]:"").mxndummycolumn;var n=$("#mouseArea__"+a).data("params");n&&(n.defaultvalue=i);var o=$("#subvalue_"+a);o.text(i),0==o.length&&$("#value_"+a).text(i)}if(multiLookupsView.fieldStatusUpdate(e),e&&3===e.split("_").length){let t=$L("crm-create-fields");Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()&&(t=$L("crm-canvas-form"));var s=t.length,l=e.split("_")[2],c=$("#"+e),d="edit";if(c&&(c.closest("#searchCreateDiv").length>0||c.closest("#createEntityFormQC").length>0&&Crm.isFromSalesInbox)&&(d="quick_create"),r||"quick_create"!==d&&0!==s||"ajaxEdit"===$(c).data("currentstatus"))for(var u=0;u<s;u++){let e=t[u];if(e.id.endsWith(l)){e.component.$node.setData("mxnFldValue",i),e.component.checkLayoutrules(e.component.$node);break}}else{var m=c.val();CFRExec.setValue(l,m,CFRExec.OPERATIONCONSTANT.QUICK_CREATE),CFRExec.isColTriggerLayoutRule&&CFRExec.evalRules(d,!0)}}}},mlSearchCloseIcon:function(e){$(e)[0]&&($(e)[0].value.length>0?$(".mlSearchClose span").addClass("activesearch"):$(".mlSearchClose span").removeClass("activesearch"))},createTempWarningPopup:function(e,t){var i=$("<div/>");i.attr("id","tempWarningPopup"),i.attr("class","zcrm-modal zcrm-effect zcrm-show");var a=$("<div/>");a.attr("style","padding:60px; text-align:center;"),a.attr("class","crm-heading-font-size zcrm-content");var r=$("<span/>");r.attr("id","warningMsg"),r.text(e);var n=$("<div/>");n.attr("class","pT30 aligncenter");var o=$("<input/>");o.attr("type","button"),o.attr("class","newgraybtn"),o.attr("onclick","multiLookupsView.cancelDeleteWarningPopup()");var s=$("<input/>");s.attr("type","button"),s.attr("class","redbtn"),"mxnDissociate"==t?(s.attr("onclick","multiLookupsView.dissociateMLRecords(undefined,true);"),s.attr("value",I18n.getMsg("crm.mxnlookup.dissociate")),o.attr("value",I18n.getMsg("Cancel"))):"mxnCloseConfirm"==t&&(s.attr("onclick","multiLookupsView.hideCancelPopup();multiLookupsView.closeMLPopup();"),s.attr("value",I18n.getMsg("crm.button.yes.move.away")),o.attr("value",I18n.getMsg("crm.button.stay.here"))),n.append(o),n.append(s),a.append(r),a.append(n);var l=$L("crm-canvas-quicksavepopup")[0];return l&&l.component.getData("showPopup")&&(i.addClass("zcanavsZI312"),$L("#freezeBackGround").addClass("zcanavsZI312")),i.append(a),i.appendTo("body"),i},permissionIssueWarningShow:function(e,t,i,a,r,n,o){$("#freezeBackGround").attr("style","z-index:250");var s="";e&&(s=$("#mLookup_"+e).text());var l=!1;null!=i&&null==moduleRecordMapping[i]&&(i=i.moduleName,l=!0);var c,d=moduleRecordMapping[i].singular_label.toLowerCase(),u=moduleRecordMapping[i].plural_label.toLowerCase(),m=I18n.getMsg("crm.mxnlookup.select",[moduleRecordMapping[i].plural_label]),p=($("#topSectionTitle").find(".dvTitle").text().trim(),$ESAPI.encoder());if(1===a||2===a)c=I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[p.encodeForHTML(d),p.encodeForHTML(s),p.encodeForHTML(Crm.appName)]),l&&(m=I18n.getMsg("crm.nsocial.start.denied"));else if(3==a)c=I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedassociatewarning.new",[p.encodeForHTML(u),p.encodeForHTML(Crm.appName)]);else if(4===a)c=I18n.getMsg("crm.mxnlookup.lookuprel.permissiondenieddissociatewarning.new",[p.encodeForHTML(u),p.encodeForHTML(Crm.appName)]);else if(5===a||6===a||7===a||11===a){var g=u;m=I18n.getMsg("crm.mxnlookup.remove.title",[p.encodeForHTML(moduleRecordMapping[i].plural_label)]),6===a?(m=I18n.getMsg("crm.mxnlookup.removeall.title",[p.encodeForHTML(moduleRecordMapping[i].plural_label)]),g=d):11===a&&(m=I18n.getMsg("crm.mxnlookup.clone.scheduler.progress.title")),c=I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning1",[p.encodeForHTML(g),p.encodeForHTML(n),p.encodeForHTML(g)])+I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning2",[p.encodeForHTML(g),p.encodeForHTML(n)]),7===a?(m=I18n.getMsg("crm.mxnlookup.removeall.title",[p.encodeForHTML(moduleRecordMapping[i].plural_label)]),c=I18n.getMsg("crm.mxnlookup.lookuprel.removeall.scheduled.msg",[p.encodeForHTML(u)])):11===a&&(c=n)}else 8===a?(s.length>7&&(s=s.slice(0,5)+"..."),"true"===n?(m=I18n.getMsg("crm.delete.checkAssigned"),c=I18n.getMsg("crm.delete.checkContentAssigned",[p.encodeForHTML(moduleRecordMapping[r].plural_label),p.encodeForHTML(d)])):(m=I18n.getMsg("crm.delete.checkAssigned"),c=I18n.getMsg("crm.mxnrelatedlist.selectcheckbox.permissionmsg.noprofileaccess",[p.encodeForHTML(d),o]))):9===a?(m=I18n.getMsg("crm.delete.checkAssigned"),c=I18n.getMsg("crm.delete.checkContentAssigned",[p.encodeForHTML(moduleRecordMapping[r].plural_label),p.encodeForHTML(d)])):10===a?(m=I18n.getMsg("crm.delete.checkAssigned"),c=I18n.getMsg("crm.mxnrelatedlist.selectcheckbox.permssionmsg.nosharing",[p.encodeForHTML(u),p.encodeForHTML(moduleRecordMapping[r].plural_label),p.encodeForHTML(u),p.encodeForHTML(d)])):12===a?(m=I18n.getMsg("crm.mxnlookup.editpopup.unassignall.modify"),c=I18n.getMsg("crm.mxnlookup.editpopup.unassignall.modifymessage",[u,moduleRecordMapping[t].singular_label.toLowerCase()])):13===a?(m=I18n.getMsg("crm.mxnlookup.unassignall.scheduler.progress.title"),c=n):14===a?(m=I18n.getMsg("crm.mxnlookup.remove.title",[moduleRecordMapping[i].plural_label]),c=I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[p.encodeForHTML(d),p.encodeForHTML(s),p.encodeForHTML(Crm.appName)])):15===a?(m=I18n.getMsg("crm.nsocial.start.denied"),c=I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[p.encodeForHTML(d),p.encodeForHTML(s),p.encodeForHTML(Crm.appName)])):16===a?(m=I18n.getMsg("crm.mxnlookup.editpopup.unassignall.modify"),c=I18n.getMsg("crm.mxnlookup.editpopup.unassignall.connectedmodifymessage",[u,moduleRecordMapping[t].singular_label.toLowerCase()])):18===a?(m=I18n.getMsg("crm.mxnlookup.mxnconvert.scheduler.progress.title"),c=n):17===a?(m=o,c=n):19!==a&&20!==a||(m=19===a?I18n.getMsg("crm.mxnlookup.assign.title",[moduleRecordMapping[i].plural_label]):I18n.getMsg("crm.mxnlookup.remove.title",[moduleRecordMapping[i].plural_label]),c=I18n.getMsg("crm.record.action.restricted"));var h=multiLookupsView.createLookupUpdateWarningPopup(m,1,c,null,2,null,a);if(renderingUtils.freezeBackground(),h.css("z-index","301"),crmui.modalZIndex("nonLyte",$L("#tempWarningPopup")[0],"open"),$("#topBandPopup .pp-content").length>0){var v=$("#topBandPopup .pp-content").position().top;h.show().addClass("zcrm-show").css("top",v)}else h.show().addClass("zcrm-show")},dontShowWarningPopup:function(e){e.checked?multiLookupsView.currentMultiLookup.dontShowWarning=!0:multiLookupsView.currentMultiLookup.dontShowWarning=!1},createLookupUpdateWarningPopup:function(e,t,i,a,r,n,o){var s=$("<div/>");s.attr("id","lookupUpdateWarningPopup"),s.attr("class","zcrm-modal zcrm-effect zcrm-show w705 ");var l=$("<div/>");l.attr("class","crm-heading-font-size zcrm-content pT30 pL30 pB25 pR25");var c=$("<span/>");c.attr("class","ico-warning-small-red svgIcons vaM mR10 zcrm_svgicon_transform mL3 dIB");var d=$("<div/>");d.attr("class","crm-heading-font-size crm-font-bold crmHeadingColor w80_per dIB vaM mL3 errorMsgNew"),d.html(e);var u=$("<div/>");u.attr("class","dIB  crm-font-regular mT15 mL32 crmBaseColor w550 f0");var m=$("<span/>");m.attr({id:"warningMsg",class:"crm-base-font-size crm-font-regular","data-zcqa":"cxPermDeniedPopupReason"}),m.html(i),u.append(m);var p=$("<div/>");if(p.attr("class","mT20"),0==r||1==r){i+=I18n.getMsg("crm.mxnlookup.lookuprel.updatelookupwarning2"),m.html(i);var g,h=$("<span/>");h.attr("id","warningMsg2"),h.attr("class","crm-subheading-font-size crm-font-regular dB mT14 crmBaseColor"),1==r?g=moduleRecordMapping[n].plural_label.toLowerCase():0==r&&(g=moduleRecordMapping[n].singular_label.toLowerCase()),h.html(I18n.getMsg("crm.mxnlookup.lookuprel.updatelookupwarning3",[$ESAPI.encoder().encodeForHTML(g)])),u.append(h);var v=$("<div/>");v.attr("class","dIB mL32");var f=$("<label/>");f.attr("class","newCustomchkbox-md crm-font-regular"),v.append(f);var C=$("<input/>");C.attr("type","checkbox").attr("data-zcqa","dontshowwarncheckbox"),C.attr("onclick","multiLookupsView.dontShowWarningPopup(this)"),f.append(C);var I=$("<span/>");I.attr("class","vaM chkbxIcon "),f.append(I);var y=$("<span/>");y.attr("class","dIB vaM crm-base-font-size mL5 crmNotFoundColor"),y.text(I18n.getMsg("crm.mxnlookup.lookuprel.dontshowwarningmsg")),f.append(y);var w=$("<div/>");w.attr("class","fR");var L=$("<input/>");L.attr("type","button"),L.attr("class","newgraybtn"),L.attr("onclick",'multiLookupsView.cancelLookupUpdatePopup("'+a+'",'+r+");"),(k=$("<input/>")).attr("type","button").attr("class","redbtn mR0").attr("data-zcqa","mulreassign").attr("onclick","multiLookupsView.associateLookupRelUpdate();"),k.attr("value",I18n.getMsg("crm.mxnlookup.lookuprel.reassign")),1==r?(L.attr("data-zcqa","mulnoreassign"),L.attr("value",I18n.getMsg("crm.mxnlookup.lookuprel.noreassign"))):0==r&&(L.attr("data-zcqa","mulno"),L.attr("value",I18n.getMsg("crm.button.no")));var b=$("<div/>");b.attr("class","cBoth "),p.append(v),w.append(L),w.append(k),p.append(w),p.append(b)}else{var k;(k=$("<input/>")).attr({type:"button",class:"newwhitebtn mR0",value:I18n.getMsg("crm.button.ok")}),Crm.userDetails.isMultiSelectionPopupSupported&&!Crm.isFromSalesInbox?k.attr("data-zcqa","crm_permission_error"):k.attr("data-zcqa","rpok"),s.attr("class","zcrm-modal zcrm-effect zcrm-show w500 "),u.attr("class","dIB  crm-font-regular mT15 mL32 crmBaseColor  f0"),p.addClass("aligncenter"),c.attr("class","ico-readonly-small svgIcons vaM mR10 zcrm_svgicon_transform mL3 dIB"),6!=o&&5!=o&&7!=o||(c.attr("class","zcrm-title-waring-icon svgIcons vaM zcrm_svgicon_transform dIB mR5"),d.attr({class:"crm-heading-font-size crm-font-bold crmHeadingColor w80_per dIB vaM errorMsgNew crmBaseColor zcrm-new-title","data-zcqa":"cxPermDeniedPopupTitle"}),s.attr("class","zcrm-modal zcrm-effect zcrm-show w700 minW650")),3===o&&null!=a?k.attr("onclick","multiLookupsView.removePermissionDeniedWarningPopup();multiLookupsView.callLookupUpdateAllWarningPopup("+a+")"):k.attr("onclick","multiLookupsView.removePermissionDeniedWarningPopup();"),p.append(k)}return l.append(c),l.append(d),l.append(u),l.append(p),s.append(l),s.appendTo("body"),s},removeTempWarningPopup:function(){var e=$L("#tempWarningPopup");crmui.modalZIndex("nonLyte",e[0],"close"),e[0].remove()},removeLookupUpdateWarningPopup:function(){$("#lookupUpdateWarningPopup").remove()},LinkingModuleExport:function(e,t){var i="/crm/v2/settings/export?module="+e+"&ids="+t;networkUtils.lyteInitiateRequest(i,"POST")}},relatedListHeader={errMsg:[],specialKeywords:["VISIT SUMMARY","GOOGLE ADWORDS INFORMATION"],editElement:function(e){var t=$(e),i=t.parent(),a=i.next("span");i.hide(),a.css("display","inline-block");var r=a.find("input.moduleNameMXN");r.val(i.text().trim()),r.focus(),t.parents("table").addClass("mB10"),r.on("keyup",(function(e){if(13==e.which){var t=e.target;$(t).parent().find(".saveLink").trigger("click")}})),t.closest(".noDataFountDetail").addClass("dvLookUpEdit")},cancelEdit:function(e){var t=$(e),i=t.parent().parent();i.hide();var a=$(i.find(".textField"))[0];$(a).value="";var r=$($(i.find("#errorMsgDescMXN"))[0]);relatedListHeader.errMsg=[],r.text(""),r.addClass("dN"),t.closest("td").find(".relListHead").show(),r.next(".moduleNameMXN").removeClass("errrorMxn"),t.parents("table").removeClass("mB10"),$(".dvLookUpEdit").removeClass("dvLookUpEdit")},save:function(e,t){var i=$(e),a=i.parent().parent(),r=$($(a.find(".textField"))[0]),n=$($(a.find("#errorMsgDescMXN"))[0]);if(!multiLookupsView.validateRenameRelList(r.val(),relatedListHeader.errMsg)){var o=relatedListHeader.errMsg[0];return n.text(o),n.removeClass("dN"),n.next(".moduleNameMXN").addClass("errrorMxn"),!1}t=t+"&relatedListName="+encodeURIComponent(r.val())+"&module="+detailView.currentModule,(new crmRequestPool).initiate({action:t,type:"POST",data:csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){var t=e.ERROR;if(t)return n.text(t),n.removeClass("dN"),n.next(".moduleNameMXN").addClass("errrorMxn"),!1;n.addClass("dN");var a=i.closest("td"),o=i.parents("table");o.find(".moduleNameMXN").removeClass("errrorMxn");var s=$ESAPI.encoder().encodeForHTML(r.val())+'<span class="mxneditIconSvg vH cP mL10" onclick="relatedListHeader.editElement(this);"></span>';a.find(".relListHead").show().html(s),a.find(".labelValTwo").css("display","none"),o.removeClass("mB10");var l=$("#lp_rellist").find("#newleft_"+e.LISTRELATIONID+" a");l&&l.length&&l.text(r.val())}}),$(".dvLookUpEdit").removeClass("dvLookUpEdit")}},crmModuleConstants={Cases:"Cases",Leads:"Leads",Accounts:"Accounts",Contacts:"Contacts",Tasks:"Tasks",Events:"Events",Calls:"Calls",PriceBooks:"PriceBooks"},crmConstants_new={init:function(){this.plusImg=networkUtils.getImageUrl("plus.gif",ResourceConstants.CRM),this.minusImg=networkUtils.getImageUrl("minus.gif",ResourceConstants.CRM),Search.spacerImg=networkUtils.getImageUrl("spacer.gif",ResourceConstants.CRM),Search.yesImg=networkUtils.getImageUrl("yes.gif",ResourceConstants.CRM),this.helpUrl=[]},requestMethods:{GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},adminProfileName:"Administrator",importNotSupportedModule:["Visits","Activities","Invoices","SalesOrders","PurchaseOrders","Quotes","Forecasts","Calls","Events","Tasks","Messages"],stdOptionFields:["CALLTYPE","OUTBOUNDCALLSTATUS"],text_operator:["contains","doesn't contain","is","isn't","starts with","ends with","Is empty","Is not empty"],date_operator:["contains","doesn't contain","is after","is before","Is empty","Is not empty"],arithmetic_operator:["=","<","<=",">",">=","Is empty","Is not empty"],boolean_operator:["","true","false"],maxSelectCount:100,moduleVsCrossModules:{Leads:["Campaigns","Visits"],Contacts:["Campaigns","Deals","Visits"],Accounts:["Deals"]},tagNotSupMod:["Activities","Visits","Messages","CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"],moduleDisplayField:{Leads:["Full_Name","Last_Name"],Activities:["Subject"],Accounts:["Account_Name"],Contacts:["Full_Name","Last_Name"],Deals:["Deal_Name"],Potentials:["Deal_Name"],Campaigns:["Campaign_Name"],Cases:["Subject"],Solutions:["Solution_Title"],Products:["Product_Name"],Vendors:["Vendor_Name"],PriceBooks:["Price_Book_Name"],Quotes:["Subject"],SalesOrders:["Subject"],PurchaseOrders:["Subject"],Invoices:["Subject"],Visits:["Visited_Page"],Services:["Service_Name"],Appointments:["Appointment_Name"],Tasks:["Subject"],Events:["Event_Title"],Meetings:["Event_Title"],Calls:["Subject"],Attachments:["File_Name"],Competitors:["Competitor_Name"],Messages:["Message By"],CalendarBookings:["Booking_Form_Name__s"],Entity_Cadences:["Name"],Cadences_Followups:["Cadence_Name"],Automation_Cadences:["Name__s"],Bundles:["Name"]},serviceHiddenFieldColName:["AVAILABLE_DATES","AVAILABLE_DAYS","UNAVAILABLE_TILL","AVAILABLE_CUSTOM_TIMING","STARTING_DATE","CLOSING_DATE","AVAILABLE_CUSTOM_TIMING","SERVICEAVAILABILITY","UNAVAILABLE_FROM","JOBSHEETSECTION"],appointmentsHiddenFieldColName:["APPOINTMENTID","APPOINTMENTFOR","RESCHEDULEDFROM","ENDTIME","ISJOBSHEETCREATED","JOBSHEETSECTION"],maxSelectCountforMassConvert:50,userPartialLoadCount:200,maxRecOperCnt:100,livedeskURL:"",setupversion:"0",maxCrtCnt:25,maxCrtCntForListView:10,include_exclude_comparator_limit:5,include_exclude_values_limit:5,Z_Retrying:"ZPending",Z_Scheduled:"ZScheduled",ZFSDown:"true",WMS_STATUS:-1,EVENT_STATUS_PREPARED:"0",EVENT_STATUS_CONFIRMED:"1",EVENT_STATUS_CANCELED:"-1",EVENT_STATUS_LOC_CHANGED:"2",EVENT_STATUS_TIME_CHANGED:"3",EVENT_STATUS_TIMELOC_CHANGED:"4",executionDayFormula:"${EXECUTION_DAY}",executionTimeFormula:"${EXECUTION_TIME}",clientTemplatingSupported:{Leads:!0,Accounts:!0,Contacts:!0,Potentials:!0,Calls:!0,Events:!0,PurchaseOrders:!0,SalesOrders:!0,Quotes:!0,Invoices:!0,Tasks:!0,Campaigns:!0,Potentials:!0,Cases:!0,PriceBooks:!0,SalesOrders:!0,Solutions:!0,Invoices:!0,Quotes:!0,PurchaseOrders:!0,Products:!0,Vendors:!0,CustomModule1:!0,CustomModule2:!0,CustomModule3:!0,CustomModule4:!0,CustomModule5:!0},recurringEndDateLimit:{daily:365,weekly:730,monthly:1825,yearly:3650},imgStaticPath:"",errorStatusCode:401,limitExceedsCode:406,errorLabel:"X-errorLabel",enableCopyAddressForModules:{Accounts:!0,Contacts:!0,SalesOrders:!0,Quotes:!0,Invoices:!0,PurchaseOrders:!0},defaultHiddenFields:{SMCREATORID:!0,MODIFIEDBY:!0,CALLOWNER:!0,LASTACTIVITYTIME:!0,SALUTATION:!0,CALLDURATIONINSEC:!0},specialTextNode:{Tasks:{Subject:!0}},helpUrl:void 0,taskCompleted:"Completed",emailRegex:/^[a-zA-Z0-9]([\w\-.+']*)@([\w\-.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/,defaultWhatId:{},defaultWhoId:{Events:{},Calls:{},Tasks:{}},weekdaysArray:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],htmlElementsCache:{},contactsPhotoURL:"",hoursArray:[1,2,3,4,5,6,7,8,9,10,11,12],minutesArray:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],dateArray:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],fullDaysArray:[],listViewMandatoryColumns:{Leads:"LASTNAME",Activities:"SUBJECT",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Bundles:"BUNDLENAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Forecasts:"FORECASTNAME",Visits:"VISITEDPAGE",Services:"SERVICENAME",Appointments:"APPOINTMENTNAME",Tasks:"SUBJECT",Calls:"SUBJECT",Events:"SUBJECT"},uiRenderingDetails:{Calls:{sectionHeading:{style:"width: 70%"},sectionContent:{style:"width:580px",cellspacing:6,cellpadding:0},fieldLabel:{class:"labelTabCreate pL5"},field:{2:{style:"width:16px;"},26:{style:"width:"},4:{class:"textField wsNowrap tOE"}}},Tasks:{sectionHeading:{style:"width\t: 70%"},sectionContent:{style:"width:70%",cellspacing:0},field:{19:{class:"sFieldText",style:"width:20px"},2:{style:"width:50%"},28:{class:"taskSubSelect",style:"width:115px"},26:{style:"width:50%"},8:{style:"width:70%",class:"textField"},32:{class:"textField vaM",style:"width:"},1:{style:"width:60%"}}},Events:{field:{2:{class:"textField",style:"width:135px"},200:{class:"textField"},201:{class:"textField"},786:{class:"textField w110"},30:{class:"textField"},24:{class:"textField"},202:{class:"textField"},28:{class:" ",style:"width:115px"},301:{class:"textField"},300:{class:"textField"},39:{class:"select",style:"width:182px"},77:{class:"textField"},36:{class:"textField",style:"width:70%"},42:{class:" ",style:"width:115px"},4:{class:"textField",style:"width:182px"},5:{class:"textField wsNowrap tOE"},6:{class:"textField wsNowrap tOE",style:"width:160px"},7:{class:"textField wsNowrap tOE",style:"width:160px"},8:{nowrap:"nowrap",class:"customSel",style:"width:110px"},9:{class:"textField wsNowrap tOE",style:"width:160px"},10:{class:"textField wsNowrap tOE",style:"width:160px"},12:{class:"textField wsNowrap tOE",style:"width:160px"},13:{class:"textField wsNowrap tOE",style:"width:160px"},15:{class:"textField wsNowrap tOE",style:"width:160px"},132:{class:"textField",style:"width:160px"},133:{class:"textField",style:"width:160px"},135:{class:"textField",style:"width:160px"},444:{class:"textField",style:"width:160px"},25:{class:"textField",style:"width:182px"},26:{class:"select"},11:{style:"width:100%",colspan:"2"},1:{class:"textField sFieldText",style:"width:182px"},21:{class:"textField",style:"width:182px"},33:{class:"textField"},35:{class:"textField",style:"width:182px"},52:{class:"textField",style:"width:182px"},32:{class:"textField vaM",style:"width:"},3:{style:"width:100%",class:"textField"},110:{class:"textField",style:"width:100%"},14:{class:"textField"},60:{class:"textField",style:"width:182px"},19:{class:" ",style:"width: 182px"},22:{class:"textField",style:"width:182px;padding-left:20px"},27:{class:"textField"},34:{class:"textField",style:"width:182px"},38:{class:"textField",style:"width:182px"},37:{class:"textField",style:"width:182px"},16:{class:" "},116:{class:"textField"},117:{class:"textField"},50:{class:"textField"},51:{class:"textField"},91:{class:"textField"},100:{class:"multiSelect select",style:"width:115px"},111:{class:"textField"},123:{},143:{class:"textField",style:"width:182px"},144:{class:"textField",style:"width:182px"},145:{class:"textField",style:"width:182px"},127:{class:"textField",style:"width:182px"},99:{class:"textField",style:"width:182px"},333:{class:"textField w110"},1234:{},11:{style:"width:400px;position:relative; z-index:101; background: none;",class:"textField txtfld"},14:{style:"width:110px",class:"textField borderNone"}},htmlContainer:{id:"preHTMLContainer",class:""},sectionHeading:{style:"width:100%"},sectionContent:{style:"width:100%",class:" ",cellspacing:0},fieldLabel:{class:"labelTabCreate pL5"}},default:{htmlContainer:{id:"preHTMLContainer",class:"p30 lbox set_mw"},sectionHeading:{style:"width:100%",cellspacing:"0",cellpadding:"0"},sectionContent:{style:"width:100%",class:"secContent mT0",border:0,cellspacing:1,cellpadding:0},fieldLabel:{class:"labelTabCreate pL5 pR"},field:{1234:{style:"width:135px"},60:{class:"textField",style:"width:182px"},2:{class:"select",style:"width:120%"},555:{class:"select",style:"width:120%"},200:{class:"textField",style:"width:90px"},201:{class:"textField",style:"width:90px"},786:{class:"textField fL sFieldText"},30:{class:"textField",style:"width:90px"},24:{class:"textField",nowrap:"true",style:"width:85%"},202:{class:"textField",nowrap:"true",style:"width:85%"},28:{class:"",style:"width: 90px"},301:{},300:{},39:{class:"select",style:"width:90%"},77:{class:"textField",style:"width:90%"},36:{class:"textField",style:"width:77%"},42:{class:" "},4:{class:"textField wsNowrap tOE",style:"width:77%"},5:{class:"textField wsNowrap tOE",style:"width:77%"},6:{class:"textField wsNowrap tOE",style:"width:77%"},7:{class:"textField wsNowrap tOE",style:"width:77%"},8:{nowrap:"nowrap",style:"width:87%"},9:{class:"textField wsNowrap tOE",style:"width:77%"},10:{class:"textField wsNowrap tOE",style:"width:77%"},12:{class:"textField wsNowrap tOE",style:"width:77%"},13:{class:"textField wsNowrap tOE",style:"width:77%"},15:{class:"textField wsNowrap tOE",style:"width:77%"},132:{class:"textField wsNowrap tOE",style:"width:81%"},133:{class:"textField wsNowrap tOE",style:"width:81%"},221:{class:"textField wsNowrap tOE",style:"width:81%"},135:{class:"textField wsNowrap tOE",style:"width:81%"},444:{class:"textField wsNowrap tOE",style:"width:81%"},25:{class:"textField",style:"width:100%"},26:{class:"select",style:"width:100%"},11:{style:"width:100%",colspan:"2",class:"textField  txtfld"},1:{class:"textField",style:"width:100%"},21:{class:"textField",style:"width:100%"},33:{class:"textField",style:"width:100%"},35:{style:"width:100%",class:"textField"},52:{class:"textField",style:"width:100%"},32:{class:"textField",style:"width:100%"},3:{class:"textField tAreaF",style:"width:100%;max-width:100%;"},110:{class:"textField",style:"width:100%"},14:{class:"textField",style:"width:100%"},19:{class:""},22:{style:"width:88%;padding-left:2px",class:"textField"},27:{class:"textField",style:"width:inherit"},34:{class:"textField",style:"width:100%"},38:{style:"width:100%",class:"textField"},37:{style:"width:100%",class:"textField"},16:{class:"textField wsNowrap tOE",style:"width:77%"},116:{class:"textField",style:"width:100%"},117:{class:"textField",style:"width:100%"},55:{nowrap:"nowrap",style:"width:87%"},50:{class:"textField",style:"width:100%"},51:{class:"textField",style:"width:100%"},91:{class:"textField",style:"width:100%"},100:{class:"multiSelect select",style:"width:100%"},111:{class:"textField",style:"width:100%"},123:{},143:{class:"textField",style:"width:77%"},144:{class:"textField",style:"width:88%"},145:{class:"textField",style:"width:95%"},127:{class:"textField",style:"width:100%"},333:{class:"textField fL sFieldText"},1234:{},11:{style:"width:320px; padding-left: 10px; position:relative; z-index:101; background: none;",class:"textField txtfld"},14:{style:"width:100px",class:"textField sFieldText"}}}},moduleVsSingularNameMapping:{Leads:"Lead",Contacts:"Contact",Cases:"Case"},FileUploader:{accept:"application/json",cacheControl:"no-cache",invoker:"crm",uploadServerPath:"webupload",uploadMethod:{NORMAL:"normal",ZFS:"zfs",ZFSNG:"zfsng"},relatedListAttachments:{uploadLimit:10,uploadSizeLimit:100,uploadSizeFlex:0,parallelUpload:2,fileSizeBase:1024,progressratio:.9,acceptedfiles:".msg,.rar,.ics,.jar,.htm,.dat,.vcf,.class,.do,.map,.jsp,.java,.zip,.php,.kml,.txt,.html,.xml,.pdf,.jpeg,.jpg,.gif,.png,.webp,.bmp,.svg,.doc,.docx,.zdoc,.odt,.rtf,.csv,.xls,.xlsx,.ots,.xlsm,.ods,.numbers,.fcs,.bks,.rdf,.odp,.pps,.pot,.pptx,.ppt,.avi,.wmv,.mp4,.mpeg,.mpg,.mov,.flv,.mkv,.webm,.mp3,.ogg,.oga,.wma,.m4p,.m4a,.au,.3gp,.3ds,.dct,.dgn,.dwfx,.dwg,.dxf",previewtemplate:'<div class="dz-preview dz-file-preview cBoth"><div class="dz-details vaM"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size"><span data-dz-size></span></div></div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message vaM hide" lt-prop-tooltip-class="wdFileUploadFailTooltip" lt-prop-title="Upload failed"><span class="virusAlert"></span>&nbsp;<span class="wdFileUploadWarningIcon vaM dIB svgIcons mR5"></span><span data-dz-errormessage class="vaM dIB mB2"></span></div><div class="dz-remove ico-close-small svgIcons" data-dz-remove></div>',action:"relatedlist",saveElement:"#file_attach",clickableElement:"#attachDropClick",previewElement:"#attachPreview",cancelElement:"#file_attach_cancel",mainformElement:"fileAttachForm",tabLoadElement:"#ajax_load_tab",targetAttachFrameElement:"#AttachmentFrame",popupName:"topBandPopup"},fileUploadFieldAttachments:{uploadLimit:5,uploadSizeLimit:20,uploadSizeFlex:0,parallelUpload:2,fileSizeBase:1024,progressratio:.9,acceptedfiles:".msg,.rar,.ics,.jar,.htm,.dat,.vcf,.class,.do,.map,.jsp,.java,.zip,.php,.kml,.txt,.html,.xml,.pdf,.jpeg,.jpg,.gif,.png,.webp,.bmp,.svg,.doc,.docx,.zdoc,.odt,.rtf,.csv,.xls,.xlsx,.ots,.xlsm,.ods,.numbers,.fcs,.bks,.rdf,.odp,.pps,.pot,.pptx,.ppt,.avi,.wmv,.mp4,.mpeg,.mpg,.mov,.flv,.mkv,.webm,.mp3,.ogg,.oga,.wma,.m4p,.m4a,.au,.3gp,.3ds,.dct,.dgn,.dwfx,.dwg,.dxf",previewtemplate:'<div class="dz-preview dz-file-preview cBoth"><div class="dz-details vaM"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size"><span data-dz-size></span></div></div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message vaM hide" lt-prop-tooltip-class="wdFileUploadFailTooltip" lt-prop-title="Upload failed"><span class="virusAlert"></span>&nbsp;<span class="wdFileUploadWarningIcon vaM dIB svgIcons mR10"></span><span data-dz-errormessage class="vaM dIB mB2"></span></div><div class="dz-remove ico-close-small svgIcons" data-dz-remove></div>',action:"fileuploadfieldattachments",saveElement:"#file_attach",clickableElement:"#attachDropClick",previewElement:"#attachPreview",cancelElement:"#file_attach_cancel",mainformElement:"fileAttachForm",tabLoadElement:"#ajax_load_tab",targetAttachFrameElement:"#AttachmentFrame",popupName:"topBandPopup"}},Docs:{ResourceTypes:{COMPANY_LOGO:"CompanyLogo",VOICE_NOTES:"VoiceNotes",ENTITY_ATTACHMENTS:"EntityAttachments",TEMPLATE_ATTACHMENTS:"TemplateAttachments",MAIL_MERGE_TEMPLATES:"MailMergeTemplates",LEAD_PHOTO:"LeadPhoto",CONTACT_PHOTO:"ContactPhoto",GAMIFICATION:"Gamification",CAREERS_WEBSITE_IMAGES:"CareersWebsiteImages",EMAIL_TEMPLATES:"EmailTemplates",INVENTORY_TEMPLATES:"InventoryTemplates"},WorkSpace:{WS_ATTACHMENT_LIBRARY:"WS_ATTACHMENT_LIBRARY",WS_ATTACHMENT_MAIL_MERGE_LIBRARY:"WS_ATTACHMENT_MAIL_MERGE_LIBRARY"}},defaultUiTypeToCruxMapping:{2:"picklist",25:"email",33:"phone",8:"user",21:"website",301:"boolean",100:"picklist",22:"twitter",200:"date-time",786:"date-time",24:"date",202:"date",333:"date-time",209:"tag",3:"text-area",110:"text-area",300:"boolean",14:"date-time",1:"text",4:"lookup",111:"text",32:"number",36:"number",77:"number",208:"layout",143:"number",144:"number",145:"number",40:"number",34:"number",221:"user",55:"user"},Pipelines:{hideLayoutsEdition:["F","N","L","S","D","R","P","Y","I","B","X","R","E"],max_limit:{R:10,E:20,S:5,X:5,Y:5,P:10,A:20,C:50,Z:20,U:50,D:3,I:5,B:1,Trial:3},default_max_limit:20},forecastHierarchyObj:{Roles:"Role",Territory:"Territory",Reporting_To:"Reporting_To"},forecastHierarchyVsModel:{Role:"role",Territory:"territory",Reporting_To:"user"},forecastTypeVsKey:{Deal_Revenue:"Amount",Deal_Quantity:"Quantity"},wizardExcludedModules:["Calls","Tasks","Events","Activities","Messages","Products"],moduleBuilderSpecialModules:["Users","Meetings"],wizardIncludedModules:["Leads","Contacts","Accounts","Deals","Potentials","Vendors","PriceBooks","Invoices","PurchaseOrders","SalesOrders","Quotes","Solutions","Cases","Campaigns"],cachedModules:["Leads","Contacts","Accounts","Deals","Potentials"],defaultUiTypeToCruxMapping:{999:"layout",25:"email",33:"phone",8:"user",20:"user",21:"website",301:"boolean",100:"picklist",22:"twitter",200:"date-time",786:"date-time",24:"date",202:"date",333:"date-time",209:"tag",3:"text-area",110:"text-area",300:"boolean",14:"date-time",1:"text",4:"lookup",111:"text",32:"number",36:"number",77:"number",207:"layout",208:"layout",143:"number",144:"number",145:"number",40:"number",34:"number",221:"user",55:"user",2:"picklist",52:"number",38:"number",26:"picklist",39:"picklist",133:"lookup",5:"lookup"},uiTypeLookup:{4:!0,5:!0,6:!0,7:!0,9:!0,10:!0,12:!0,13:!0,15:!0,16:!0,42:!0,43:!0,44:!0,62:!0,133:!0,444:!0},dateTimeComparisonFieldsMapping:[{start:"STARTDATE",end:"ENDDATE"},{start:"SALES_START_DATE",end:"SALES_END_DATE"},{start:"SUPPORT_START_DATE",end:"SUPPORT_EXPIRY_DATE"}],entityjsonTypeMapping:{boolean:"boolean",jsonobject:"object",integer:"number",double:"number",jsonarray:"array"},entityuiTypeMapping:{221:"object",445:"array",555:"array",24:"date",202:"date",200:"datetime",786:"datetime",333:"datetime",14:"datetime",100:"multi-picklist",96:"tax",33:"phone",999:"territory",35:"phone",80:"time-in-hrs",445:"multi-user",47:"array",53:"millisec-to-time"},entityforumlaMapping:{datetime:"datetime",date:"date",jsonobject:"object",integer:"number",double:"number",jsonarray:"array"},entitydataParamMapping:{datetime:"datetime",date:"date",integer:"number",double:"number"},entitycolumnMapping:{PARENT_CAMPAIGNID:"object",TOTALTIME:"millisec-to-time",TIMESPENT:"time-in-minutes",AVERAGETIMESPENT:"time-in-minutes",EXPECTEDREVENUE:"expected-revenue",LAYOUTID:"object",WIZARDID:"object"},cpqDashboardObject:{isCacheLoaded:!1},lyteCreateInitialModules:["Leads","Contacts","Accounts","Potentials","Deals","Products","Solutions","Vendors","Cases","Campaigns","Services","Appointments","Bundles"],lyteCreateInventoryModules:["SalesOrders","Quotes","PurchaseOrders","Invoices","PriceBooks"],formulaMapping:{currency:"number",text:"text",boolean:"boolean",datetime:"date-time",date:"date",double:"number",decimal:"number",integer:"number"},subformDefMaxRowsPerParent:200};crmConstants="object"!=typeof crmConstants?crmConstants_new:_.extend(crmConstants,crmConstants_new),crmConstants_new=void 0;var UserModule={};function rolesList(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles")}function setTextArea(e,t){if(t=void 0!==t?t:50,void 0!==e&&e.length>t){var i=e.substring(0,t);e=i+"..."}return e}function updateNewFCManagerInForm(){if($("#fcManagerDropdown")[0]){var e=$("#fcManagerDropdown")[0].component.getData("cxPropSelectedUser");e&&$("#forecastManagerId").val(e.id)}}function transDelRole(){var e=!0;if(getObj("transferToId").value=getObj("reportsToId").value,validationUtils.isFieldEmpty($(getObj("reportsTo"))))renderingUtils.displayErrorDiv("reportsTo","crm.security.role.transferTo","crm.field.empty.check"),e=!1;else if(!commonUtils.emptyCheck("reportsTo","crm.security.role.transferTo"))return!1;if(e)return!0}function rolesLookUp(e,t,i,a){var r=Crm.getCrmBasePath()+"/Role.do?action=rolesLookUp&operation="+t+"&transferId="+i+"&frmPage="+a,n={success_callback:function(e){var t;if("frmEditUser"===a){var i=$("#profileEditPopup");t=i.is(":visible")?i:null}else{var r=$("#topBandPopup");t=r.is(":visible")?r:null}t&&t.addClass("hideBehind"),$("#lookupPopup").html(e),showAnimatePopup("lookupPopup"),null!=$("#tpUsers")&&null!=$("#tpUsers").val()&&setTimeout((function(){$("#tpUsers").select2({allowClear:!1,matcher:function(e,t){return matchStart(e,t)},templateResult:tpuserName,templateSelection:tpuserName,placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),escapeMarkup:function(e){return e}})}),10)}};networkUtils.makeRequest(r,"GET",n)}function setReportsTo(e,t){getElemById("reportsToId").value=e,getElemById("reportsTo").value=t,hideAnimatePopup("lookupPopup")}function setUserRole(e,t,i){var a;if("frmAddUser"===i){getElemById("roleId_Add").value=e,getElemById("roleName_Add").value=t;var r=$("#topBandPopup");a=r.is(":visible")?r:null}else if("frmEditUser"==i){$("#UserEditView #roleId").val(e),getElemById("Crm_Users_ROLEID").value=t;var n=$("#profileEditPopup");a=n.is(":visible")?n:null}else if(i.startsWith("searchrole")){var o="#"+i,s=$(o+" option:selected").map((function(){return this.value})).get();s.contains(e)||(s.push(e),$(o).val(s).trigger("change"))}else if(i.indexOf("::")>-1){var l=i.substr(i.indexOf("_")+1,i.length);getElemById("roleId_"+l).value=e,getElemById("roleName_"+l).value=t}else getElemById("roleId").value=e,getElemById("roleName").value=t;if("frmAddUser"===i){var c="";if(Crm.userDetails.isUserHierarchy&&"CEO"!==t){var d='{"role_id":'.concat('"').concat(e).concat('"')+',"include_support_user":false}';c=c+'<td nowrap="nowrap">'+I18n.getMsg("crm.user.hierarchy.reportingto")+"</td>",c+='<td nowrap="nowrap" id="reportingDropdown" style="min-width:324px;">',c+="<div>",c+='<crux-user-dropdown id="reportingToDropdown" cx-prop-class="noDropdownStyle w100_per" cx-prop-filterable="false" cx-prop-query-param='.concat(d).concat(" ").concat('cx-prop-filter-selected="ParentRoleUsers" cx-prop-forced-fetch=true></crux-user-dropdown>'),c+='<input type="hidden" id="reportingtoId" name="reporting" value="">',c+="</div>",c+="</td>"}$("#userReporting").html(c)}hideAnimatePopup("lookupPopup"),a&&a.removeClass("hideBehind")}function showRoleOptionImages(e,t){Territory.editMode||(jQuery("#mo"+e).css("visibility","visible"),t&&$(t).find("span").eq(0).addClass("crmLinkColor cP"),t&&$(t).find("span").length>0&&$(t).addClass("hover"))}function hideRoleOptionImages(e,t){jQuery("#mo"+e).css("visibility","hidden"),t&&$(t).removeClass("hover"),$(t).find("span").eq(0).removeClass("crmLinkColor cP")}function groupsList(e){if(getObj("backto")&&"zti"==getObj("backto").value){getObj("event").value,getObj("zti_id").value,csrfParamName,encodeURIComponent(csrfToken);urlToLoad=Crm.getCrmBasePath()+"/ZTIConfig.do",loadUrl("result",urlToLoad,params)}else Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.index-groups")}function editGroup(e){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.edit-group",e)}function showCreateGroup(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.create-group")}function valCreateGroup(){var e=$("#groupName");if(validationUtils.isFieldEmpty(e))return renderingUtils.displayErrorDiv("groupName","crm.security.group.name","crm.field.empty.check.alert"),!1;if(!checkSplChars("groupName","groupName"))return!1;if(!checkSplChars("groupDesc","groupDesc"))return!1;if($("#groupDesc").val().length>250)return alert(I18n.getMsg("DescMaxLen")),!1;e.val();var t="",a=$("#groupId");a.length>0&&(t=a.val()),$("#save").prop("disabled",!0);var r=new crmRequestPool,n=$("#selectedGroupSrc option"),o=$(n[0]).val();for(i=1;i<n.length;i++)o=o+",,,"+$(n[i]).val();$("#selectedGrpObj").val(o);var s=commonUtils.formData2QueryString(document.createEditGroupForm),l=$("#createEditGroupForm").attr("action");return commonUtils.showHideLoadingDiv(!0),r.initiate({data:s,action:l,success:function(e){if(commonUtils.showHideLoadingDiv(!1),"object"==typeof e&&null!=e.error)return alert(e.error),$("#save").prop("disabled",!1),!1;$("#feedsLookupDiv").is(":visible")&&($("#feedsLookupDiv").hide(),renderingUtils.removeFreezeLayer(),$("#feedsGroupMembersDiv").hide(),Utils.windowLocationReload());var i=$("#result");(i.html(e),"undefined"!=typeof searchedGroupUsersJsonObj&&(searchedGroupUsersJsonObj=[]),"undefined"!=typeof groupUsersJsonObj&&(groupUsersJsonObj=[]),i.find("#groupid").length>0&&null!=i.find("#groupid").val()&&""!==i.find("#groupid").val()&&"null"!==i.find("#groupid").val())&&(Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.view-group",$("#result").find("#groupid").val()).data={data:e});return""==t&&Crm.trackSpotLightAction("Group Created"),!1}}),!1}function changeAvilGroupSrc(e,t){var i=e.value;""==i&&(i="availEmailFieldPL");var a=null;if(i.indexOf(":")>-1){var r=i;i=r.split(":")[0],a=r.split(":")[1]}getObj("availGroupsPLDiv").style.display="none",getObj("availRolesPLDiv").style.display="none",getObj("availRolesubsPLDiv").style.display="none",getObj("availUsersPLDiv").style.display="none";var n=getElemById("availTerritoriesPLDiv");n&&(n.style.display="none");var o=getElemById("availTerrWithChildsPLDiv");o&&(o.style.display="none");var s=getObj("availEmailFieldPLDiv");s&&(s.style.display="none");var l=getObj("availRelEmailFieldPLDiv");if(l){var c;if(l.style.display="none",t){for(m=(d=$("#availRelEmailFieldPL")).children().length-1;m>=0;m--)d.empty(m);(u=$("#availRelEmailFieldPLTemp"))&&(c=u.children().length)}else{var d,u;for(m=(d=getElemById("availRelEmailFieldPL")).length-1;m>=0;m--)d.remove(m);(u=getElemById("availRelEmailFieldPLTemp"))&&(c=u.length)}if(u)for(var m=0;m<c;m++){if(t)var p=(g=u.children()[m]).attributes["data-value"].value;else{var g;p=(g=u.options[m]).value}if(p.indexOf(":"+a)>-1&&-1==p.indexOf(":"+a+"_")||null!=a&&0==a.indexOf("Lookup_")&&p.indexOf(a.substring(7)+":")>-1){if(t){var h=document.createElement("LI");if((I=document.createAttribute("data-value")).value=p,h.setAttributeNode(I),h.textContent=g.textContent,0==!g.textContent.indexOf("*")){h.setAttribute("data-onClick","addGroupItems(this);"),h.setAttribute("onmouseenter","showAddButton(this);"),h.setAttribute("onmouseleave","hideAddButton(this);");var v=document.createElement("INPUT");v.setAttribute("type","button"),v.setAttribute("class","addSelLi cP primarybtn bt-smallprimarybtn"),v.setAttribute("onClick","addGroupItems(this)"),v.setAttribute("value",I18n.getMsg("crm.label.add")),v.setAttribute("style","display:none"),h.appendChild(v)}d.append(h)}else{(h=document.createElement("OPTION")).value=p,h.text=g.text,d.add(h)}(p.indexOf("EF:")>-1||p.indexOf("REF:")>-1)&&"C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"A"!==Crm.userDetails.LICENSE_TYPE&&"E"!==Crm.userDetails.LICENSE_TYPE&&(h.disabled=!0)}}}callComboUnSelect("availGroupsPL"),callComboUnSelect("availRolesPL"),callComboUnSelect("availRolesubsPL"),callComboUnSelect("availUsersPL"),getElemById("availTerritoriesPL")&&callComboUnSelect("availTerritoriesPL"),getElemById("availTerrWithChildsPL")&&callComboUnSelect("availTerrWithChildsPL"),getObj("availEmailFieldPL")&&callComboUnSelect("availEmailFieldPL"),getObj("availRelEmailFieldPL")&&callComboUnSelect("availRelEmailFieldPL"),callComboUnSelect("selectedGroupSrc"),getObj(i+"Div").style.display="block";var f=$("#"+i),C=I18n.getMsg("crm.label.picklist.none");if(t){if(0==f.children("li").length){var I;h=document.createElement("LI");(I=document.createAttribute("data-value")).value="--None--",h.setAttributeNode(I),h.textContent=C;var y=document.createAttribute("class");y.value="wf_empty_li",h.setAttributeNode(y),f.append(h)}}else if(0==$("#"+i+" option").length){var w=document.createElement("OPTION");w.value="--None--",w.text=C,f.append(w)}}function buttonenable(){var e=$("#selectedGroupSrc option");e.length>=1&&"--None--"!=e[0].value&&$("#save").prop("disabled",!1)}function addGroupItems(e){blockContent("otherEmails",event);var t=I18n.getMsg("crm.label.picklist.none"),a=getObj("selectedGroupSrc");for(i=0;i<a.length;i++)a.options[i].selected=!1;var r=getElemById("groupSrcType").value;r=r.split(":")[0];var n=getObj(r),o=null;"availRelEmailFieldPL"==r&&(o=getElemById("availRelEmailFieldPLTemp"));var s,l=getGrpsrcType(r),c=new Array,d=0;for(i=0;i<n.length;i++){if(1==(s=n.options[i]).selected&&s.value!=t&&"--None--"!=s.value)c[d++]=i,(g=document.createElement("OPTION")).value=s.value,g.text=""!==l?l+": "+s.text:s.text,g.style="width : 200%",a.appendChild(g),g.selected=!0;s.selected=!1}if(e){var u=$(e).parent();if(u.data("value")!=t&&"--None--"!=u.data("value")){(g=document.createElement("LI")).setAttribute("data-value",u.data("value")),g.setAttribute("onmouseenter","showRmvButton(this);"),g.setAttribute("onmouseleave","hideRmvButton(this);"),g.setAttribute("data-onClick","delGroupItems(this);");var m=""!=l?"<span>"+l+": "+$ESAPI.encoder().encodeForHTML(u.text())+"</span>":"<span>"+$ESAPI.encoder().encodeForHTML(u.text())+"</span>";m+="<input type='button' class='rmvSelLi cP redbtn bt-smallredbtn' value='"+I18n.getMsg("crm.label.remove")+"' onClick='delGroupItems(this);' style='display: none;'>",$(g).empty(),g.innerHTML=m,a.appendChild(g);var p=g.parentNode.getElementsByClassName("wf_empty_li");p.length>0&&(p[0].style.display="none")}if(u.remove(),0==n.children.length){var g=' <li data-value="--None--" class="wf_empty_li">'+t+"</li>";$(n).empty(),n.innerHTML=g}"function"==typeof showHideFromAddress&&showHideFromAddress()}for(i=c.length-1;i>=0;i--){var h=n[c[i]].value;if(n.remove(c[i]),o)for(d=o.length-1;d>=0;d--)o[d].value==h&&o.remove(d)}0==n.length&&((g=document.createElement("OPTION")).value="--None--",g.text=t,n.appendChild(g));a.length>1&&"--None--"==a.options[0].value&&a.remove(0)}function getGrpsrcType(e){return"availGroupsPL"==e?G:"availRolesPL"==e?R:"availRolesubsPL"==e?RS:"availUsersPL"==e?U:"availTerritoriesPL"==e?T:"availTerrWithChildsPL"==e?TS:"availEmailFieldPL"==e||"availRelEmailFieldPL"==e?"":void 0}function delGroupItems(e){var t,a,r=I18n.getMsg("crm.label.picklist.none"),n=getObj("selectedGroupSrc"),o=new Array,s=0,l=/^[^:]+:[ ]?/g;for(i=0;i<n.length;i++){if("--None--"==(a=n.options[i]).value)a.selected=!1;else if(1==a.selected){var c=null;if(f=a.text,g=null,(t=a.value).indexOf("G:")>-1)g=getObj("availGroupsPL");else if(t.indexOf("R:")>-1)g=getObj("availRolesPL");else if(t.indexOf("RS:")>-1)g=getObj("availRolesubsPL");else if(t.indexOf("U:")>-1)g=getObj("availUsersPL");else if(t.indexOf("T:")>-1)g=getElemById("availTerritoriesPL");else if(t.indexOf("TS:")>-1)g=getElemById("availTerrWithChildsPL");else if(0==t.indexOf("EF:"))g=getObj("availEmailFieldPL");else if(t.indexOf("REF:")>-1)c=getElemById("availRelEmailFieldPLTemp"),(!(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)||t.split(":")[1]==getElemById("groupSrcType").value.split(":")[1]||t.indexOf(":"+getElemById("groupSrcType").value.split(":")[1]+":")>-1)&&(g=getObj("availRelEmailFieldPL"));else if(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1){var d=t.split(":")[1];getElemById("groupSrcType").options[0].getAttribute("module")==d?g=getObj("availEmailFieldPL"):(c=getElemById("availRelEmailFieldPLTemp"),d==getElemById("groupSrcType").value.split(":")[1]&&(g=getObj("availRelEmailFieldPL")))}if(-1==t.indexOf("REF:")&&-1==t.indexOf("EF:")&&(f=f.replace(l,"")),(v=document.createElement("OPTION")).value=t,v.text=f,v.style="width : 200%",g&&g.appendChild(v),c){var u=document.createElement("OPTION");u.value=t,u.text=f,c.appendChild(u)}v.selected=!0,o[s++]=a}null!=g&&g.length>1&&"--None--"==g.options[0].value&&g.remove(0)}for(var m=0;m<o.length;m++)n.removeChild(o[m]);0==n.length&&((v=document.createElement("OPTION")).value="--None--",v.text=r,n.appendChild(v),$("#save").prop("disabled",!0));if(e){var p=$(e).parent();if(0==p.length)return;var g=null;(t=p.data("value")).indexOf("G:")>-1?g=getObj("availGroupsPL"):t.indexOf("R:")>-1?g=getObj("availRolesPL"):t.indexOf("RS:")>-1?g=getObj("availRolesubsPL"):t.indexOf("U:")>-1?g=getObj("availUsersPL"):t.indexOf("T:")>-1?g=getElemById("availTerritoriesPL"):t.indexOf("TS:")>-1?g=getElemById("availTerrWithChildsPL"):0==t.indexOf("EF:")?g=getObj("availEmailFieldPL"):t.indexOf("REF:")>-1?(c=getElemById("availRelEmailFieldPLTemp"),(!(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)||t.split(":")[1]==getElemById("groupSrcType").value.split(":")[1]||t.indexOf(":"+getElemById("groupSrcType").value.split(":")[1]+":")>-1)&&(g=getObj("availRelEmailFieldPL"))):(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)&&(d=p.data("value").split(":")[1]);var h=null;d=p.data("value").split(":")[1];getElemById("groupSrcType").options[0].getAttribute("module")==d?g=getObj("availEmailFieldPL"):(c=getElemById("availRelEmailFieldPLTemp"),d==getElemById("groupSrcType").value.split(":")[1]&&(g=getObj("availRelEmailFieldPL")));var v,f=p.text();if(-1==t.indexOf("REF:")&&-1==t.indexOf("EF:")&&(f=f.replace(l,"")),(v=document.createElement("LI")).setAttribute("data-value",p.data("value")),v.setAttribute("onmouseenter","showAddButton(this);"),v.setAttribute("onmouseleave","hideAddButton(this);"),v.setAttribute("data-onClick","addGroupItems(this);"),v.innerHTML="<span>"+$ESAPI.encoder().encodeForHTML(f)+"</span>",v.innerHTML+="<input type='button' class='addSelLi cP primarybtn bt-smallprimarybtn' value='"+I18n.getMsg("crm.label.add")+"' onClick='addGroupItems(this);' style='display: none' >",null!=g)g.appendChild(v),h=v.parentNode.getElementsByClassName("wf_empty_li");else{var C=document.createElement("LI");C.setAttribute("data-value",p.data("value")),C.setAttribute("onmouseenter","showAddButton(this);"),C.setAttribute("onmouseleave","hideAddButton(this);"),C.setAttribute("data-onClick","addGroupItems(this);"),$(C).empty(),C.innerHTML="<span>"+$ESAPI.encoder().encodeForHTML(f)+"</span>",C.innerHTML+="<input type='button' class='addSelLi cP primarybtn bt-smallprimarybtn' value='"+I18n.getMsg("crm.label.add")+"' onClick='addGroupItems(this);' style='display: none' >",c.appendChild(C),h=C.parentNode.getElementsByClassName("wf_empty_li")}if(h.length>0&&(h[0].style.display="none"),p.remove(),1==n.children.length)(h=n.getElementsByClassName("wf_empty_li")).length>0&&(h[0].style.display="");"function"==typeof showHideFromAddress&&showHideFromAddress()}}function showAddButton(e){$(e).find(".addSelLi").css({display:"inline"})}function hideAddButton(e){$(e).find(".addSelLi").hide()}function showRmvButton(e){$(e).find(".rmvSelLi").css({display:"inline"})}function hideRmvButton(e){$(e).find(".rmvSelLi").hide()}function showSharingRules(){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.data-sharing.index-data-sharing"),featuresAvailable.NEXTGENUI_ENABLED&&app.prevTransition&&app.prevTransition.route&&app.prevTransition.route.startsWith("crm.tab")&&Lyte.Router.getRouteInstance().transitionTo(app.prevTransition)}function editOrgDefPer(e){var t=Crm.getCrmBasePath()+"/SharingSetting.do?action=editOrgDefPer&tabId="+encodeURIComponent(e);new AjaxAPI({id:"editOrgDefDiv",url:t,callbackfn:function(e){checkSessionExpired(e),setFocus("editOrgDefPer"),showAnimatePopup("editOrgDefDiv")}}).post()}function editAllDefSRPer(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.edit-default-data-sharing")}function updateOrgDefPer(e){var t=getObj("editOrgDefPer").value,i=Crm.getCrmBasePath()+"/SharingSetting.do?action=updateOrgDefPer&tabId="+encodeURIComponent(e)+"&permission="+t;document.deleteForm.action=i,UpdateDetails("",deleteForm,"")}function newSharingRule(e){var t=new RegExp("Leads|Accounts|Contacts|Services|Appointments|Potentials|Campaigns|Activities|Calls|Tasks|Events|Cases|Solutions|Products|Bundles|Vendors|PriceBooks|Quotes|SalesOrders|PurchaseOrders|Invoices|CustomModule[1]?[1-9]|CustomModule10|CustomModule20|LinkingModule([1-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|50|500[1-8])");e.match(t)&&Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.create-data-sharing","",{module:e})}function valNewShareRule(){if(!validateSharingRuleData(!0))return!1;var e=$("#createRule"),t=$("#updateRule"),i=e.length>0?e:t;return doAjaxUpdateForm("result",document.shareruleform,(function(e){if($L("#setup_new_ContentDiv").scrollTop(0),null!=e){switch(e.message){case"sharing_from_roleId_invalid":renderingUtils.displayErrorDiv("sharingSrc_R","crm.security.sharing.from","crm.security.sr.role.deleted");break;case"sharing_to_roleId_invalid":renderingUtils.displayErrorDiv("sharingTo_R","crm.security.sharing.to","crm.security.sr.role.deleted");break;case"sharing_from_groupId_invalid":renderingUtils.displayErrorDiv("sharingSrc_G","crm.security.sharing.from","crm.security.sr.group.deleted");break;case"sharing_to_groupId_invalid":renderingUtils.displayErrorDiv("sharingTo_G","crm.security.sharing.to","crm.security.sr.group.deleted");break;case"scheduler already running":crmui.showPopup("scheduler_Sharing_Rule"),commonUtils.showHideLoadingDiv();break;case"module_unavailable":crmui.showPopup("module_Sharing_Rule"),commonUtils.showHideLoadingDiv();break;case"Sharing Rule Name is duplicated":renderingUtils.displayErrorDiv("sharingRuleName",[],"crm.alert.sec.sharingrulename.duplicate");break;case"The given api_name seems to be invalid":crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.field.invalid"),4e3);break;case"invalid_ruleid":crmui.showMsgBand("error",I18n.getMsg("crm.datasharingrules.save.error.unavailable"),4e3);break;case"exception in parsing filter":crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.filter.error"),4e3);break;default:crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.internal.error"),4e3)}i.removeClass("disabled")}})),!1}function validateSharingRuleData(e){var t=!0,i=!0,a=!1,r=document.getElementById("shareSrcType").value,n=document.getElementById("shareToType").value,o=document.getElementById("sharingSrc_G").value,s=document.getElementById("sharingTo_G").value,l=document.getElementById("share_criteria_editor"),c=document.getElementById("sharingRuleName");if(c){var d=c.value.trim();if(""===d)e&&renderingUtils.displayErrorDiv("sharingRuleName","crm.security.records.sharing.name","crm.field.empty.check"),t=!1;else if(e){var u=getClrTxtPtnResChars(d,/[^~`#,%^&*()+={}[\]|;"<>\\]/g).join(" ");if(""!==u){var m=I18n.getMsg("crm.security.records.sharing.name"),p=1===u.length?"crm.clearTextPattern.validationFail.alert":"crm.clearTextPattern.validationFail.alert.moreThanOneChar";renderingUtils.displayErrorDiv("sharingRuleName",[m,u],p),t=!1}}var g=document.getElementById("category_enable");g&&(i=g.checked);var h=document.getElementById("criteria_enable");h&&(a=h.checked)}if(a&&($("#share_criteria_editor .editPatternInput").length>0&&(t=!1),e)){var v=l.getCriteria();!0===a&&void 0===v&&e&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.datasharing.criteria.empty")),t=!1),!0!==a||null!==v&&!1!==v||(t=!1)}return"G"!==r&&(o=document.getElementById("sharingSrc_R").value),"G"!==n&&"AU"!==n&&(s=document.getElementById("sharingTo_R").value),!0===i&&""===o&&(e&&("G"===r?renderingUtils.displayErrorDiv("sharingSrc_G","crm.security.sharing.from","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingSrc_R","crm.security.sharing.from","crm.field.empty.check")),t=!1),""===s&&"AU"!==n&&(e&&("G"===n?renderingUtils.displayErrorDiv("sharingTo_G","crm.security.sharing.to","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingTo_R","crm.security.sharing.to","crm.field.empty.check")),t=!1),document.getElementById("shareSrcId").value=o,document.getElementById("shareToId").value=s,t}function changeSRSrcType(e){var t=e.value;getObj("sharingSrcGDiv").style.display="none",getObj("sharingSrcRDiv").style.display="none",thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"G"==t?getObj("sharingSrcGDiv").style.display="inline-block":(getObj("sharingSrcRDiv").style.display="inline-block",blockContent("sharingSrc_R"),blockContent("sharingSrc_G"),blockContent("sharingTo_G"),blockContent("sharingTo_R")),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),10)}function changeSRToType(e){var t=e.value,i=$("#isSuperiorAllowedCheckBox"),a=$("#isSuperiorsAllowedLabel");i.attr("disabled",!1),a.removeClass("cDefault"),i.removeClass("cDefault"),a.removeAttr("onmouseleave onmouseenter"),getObj("sharingToGDiv").style.display="none",getObj("sharingToRDiv").style.display="none",thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"G"==t?getObj("sharingToGDiv").style.display="inline-block":"AU"===t?($("sharingToGDiv").addClass("dN"),i.prop("checked",!1),i.attr("disabled",!0),a.addClass("cDefault"),i.addClass("cDefault"),a.attr("onmouseenter","crmui.showTooltip({content: '"+I18n.getMsg("crm.sharing.rules.allusers.note")+"',position: 'center'})").attr("onmouseleave","crmui.hideTooltip();")):getObj("sharingToRDiv").style.display="inline-block",setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),10)}function delShareRule(e,t){var i=Crm.getCrmBasePath()+"/SharingSetting.do?action=delRule&ruleId="+encodeURIComponent(e);document.deleteForm.action=i,UpdateDetails("",deleteForm,"","",(function(e){if(void 0===e){var i={status:"progress"};i.module=t;var a=$("#sharingRulesNew_"+i.module);i.id=a.attr("data-tabid");var r=I18n.getMsg(a.attr("data-zcqa").replace("security_dataSharing_newrule_",""));i.message=I18n.getMsg("crm.security.sharing.rules.in.progress",r),dsNotificationScheduler.addOrUpdateSchedulerStatus(i,I18n.getMsg("crm.security.sharing.rules.popup.title"))}else"deleted_role/group/DSR_selected"===e.error&&(crmui.showMsgBand("error",I18n.getMsg("com.datasharingrules.error.unavailable"),4e3),commonUtils.showHideLoadingDiv())}))}function editShareRule(e,t){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.edit-data-sharing",e,{module:t})}function recalculateSR(){var e=document.getElementById("compute_Sharing_Rule").getAttribute("data-moduleid");e&&loadUrl("result",Crm.getCrmBasePath()+"/SharingSetting.do?action=recalculate&tabid="+e,"",!0)}function showPerTabSuccessMessage(e){getObj("loadingDiv").style.position="absolute",$(getObj("loadingDiv")).empty(),getObj("loadingDiv").innerHTML=e,getObj("loadingDiv").style.width="300px",getObj("loadingDiv").className="successMsg",mailsetCenter("loadingDiv"),$("#loadingDiv").fadeIn().delay(2e3).fadeOut("slow")}function clearLookupField(e,t){if(getObj(e).value="",getObj(t).value="",null!=t&&""!=t&&-1!=t.indexOf("_")){var i=t.substring(t.indexOf("_")+1,t.length),a=$("#clearLookupField_"+i);null!=a.attr("class")&&a.hasClass("show-close")&&a.removeClass("show-close"),"property(Campaign Source)"===fldName&&$("#clearCampaigns").addClass("vH")}}function checkSessionExpired(e){var t=e.responseText;(t.indexOf("Why does my session expire")>-1||t.indexOf("Affordable for Medium Business")>-1)&&(location.href="/crm/Reauth.sas")}function setFocus(e){getObj(e)&&getObj(e).focus()}function callComboUnSelect(e){$($("#"+e).find(":selected")).prop("selected",!1)}function showBlockMsgDiv(e){"config_backup"==e?(renderingUtils.freezeBackground(),mailsetCenter("configBackupDiv")):"config"==e?(renderingUtils.freezeBackground(),mailsetCenter("configDiv")):"backup"==e&&(renderingUtils.freezeBackground(),mailsetCenter("backupDiv"))}UserModule.getSaveParam=function(e){return{"First Name":"firstName","Last Name":"lastName",Email:"email",Role:"roleName",Alias:"alias",Phone:"phone",Mobile:"mobile",Website:"url",Fax:"fax",Profile:"profileId",Street:"street",City:"city",State:"state",Country:"country","Zip Code":"zip",Language:"langCode","Time Zone":"timeZone","Time Format":"userTimeFormat",Currency:"currencyISOCode","Date of Birth":"dob"}[e]},UserModule.newValidateSharingRuleData=function(e){var t,i=!0,a=!0,r=!1,n=document.getElementById("shareToType").cxProp("Selected"),o=document.getElementById("sharingSrc_G"),s=document.getElementById("sharingSrc_R"),l=(o?o.cxProp("Selected"):"")||(s?s.cxProp("Selected"):""),c=document.getElementById("sharingTo_G"),d=document.getElementById("sharingTo_R"),u=(c?c.cxProp("Selected"):"")||(d?d.cxProp("Selected"):""),m=document.getElementById("share_criteria_editor"),p=document.getElementById("sharingRuleName");if(p){var g=p.cxProp("value").trim();if(""===g)e&&$L("#sharingRuleName")[0].setData("cxPropErrorMessage",I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.security.records.sharing.name"))),i=!1;else if(e){var h=getClrTxtPtnResChars(g,/[^~`#,%^&*()+={}[\]|;"<>\\]/g).join(" ");if(""!==h){var v=I18n.getMsg("crm.security.records.sharing.name"),f=1===h.length?"crm.clearTextPattern.validationFail.alert":"crm.clearTextPattern.validationFail.alert.moreThanOneChar";$L("#sharingRuleName")[0].setData("cxPropErrorMessage",I18n.getMsg(f,[v,h])),i=!1}else if(isemojipresent(g)){var C=I18n.getMsg("crm.profile.name.emoji.error");$L("#sharingRuleName")[0].setData("cxPropErrorMessage",C),i=!1}else g.length>50&&($L("#sharingRuleName")[0].setData("cxPropErrorMessage",I18n.getMsg("crm.security.sr_rule.name.exceed.max.limit",[I18n.getMsg("crm.security.records.sharing.name"),50])),i=!1)}var I=document.getElementById("category_enable");I&&(a=I.ltProp("checked"));var y=document.getElementById("criteria_enable");y&&(r=y.ltProp("checked"))}if(r&&($L("#share_criteria_editor .editPatternInput").length>0&&(i=!1),e)){var w=m.getCriteria();!0===r&&void 0===w&&(_cruxUtils.showCustomAlert({params:{LtPropPrimaryMessage:I18n.getMsg("crm.datasharing.criteria.empty")}}),i=!1),!0!==r||null!==w&&!1!==w||(i=!1)}return!0===a&&("G"!==(t=document.getElementById("shareSrcType").cxProp("Selected"))&&(l=s.cxProp("Selected")?s.cxProp("Selected"):""),""===l&&(e&&("G"===t?renderingUtils.displayErrorDiv("sharingSrc_G","crm.security.sharing.from","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingSrc_R","crm.security.sharing.from","crm.field.empty.check")),i=!1)),"G"!==n&&"AU"!==n&&(u=d.cxProp("Selected")?d.cxProp("Selected"):""),""===u&&"AU"!==n&&(e&&("G"===n?renderingUtils.displayErrorDiv("sharingTo_G","crm.security.sharing.to","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingTo_R","crm.security.sharing.to","crm.field.empty.check")),i=!1),i},UserModule.enableSaveSharingRuleBtn=function(){var e=$("#createRule"),t=$("#updateRule"),i=e.length>0?e:t;validateSharingRuleData(!1)?i.prop("disabled",!1):i.prop("disabled",!0)},UserModule.enableSaveSharingRuleBtnLyte=function(){var e=$L("#sr_saveBtn")[0];this.newValidateSharingRuleData(!1)?e.ltProp("disabled",!1):e.ltProp("disabled",!0)},UserModule.showSharingRuleSuccessPopup=function(e){"createRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.crt.success.message"),4e3):"updateRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.upd.success.message"),4e3):"delRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.del.success.message"),4e3):"recalculate"===e&&crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.rerun.success.message"),4e3)},UserModule.setSharingRuleConditions=function(){return{date:[{system:"equal",display:_cruxUtils.getI18n("is")},{system:"not_equal",display:_cruxUtils.getI18n("isn't")},{system:"less_than",display:_cruxUtils.getI18n("is before")},{system:"greater_than",display:_cruxUtils.getI18n("is after")},{display:_cruxUtils.getI18n("between"),system:"between"},{display:_cruxUtils.getI18n("not between"),system:"not_between"},{system:"${EMPTY}",display:_cruxUtils.getI18n("is empty")},{system:"${NOTEMPTY}",display:I18n.getMsg("isnotempty")}]}},UserModule.focusInSharingRuleName=function(){$("#sharingRuleNameDiv").addClass("focusEleField")},UserModule.focusOutSharingRuleName=function(){$("#sharingRuleNameDiv").removeClass("focusEleField")},UserModule.showSharingRulePopUp=function(e,t){crmui.showPopup({id:"compute_Sharing_Rule"}),document.getElementById("sharingRuleHeading").innerText=I18n.getMsg("crm.security.sr.rerun.note1",t),document.getElementById("compute_Sharing_Rule").setAttribute("data-moduleid",e)};var allUserList=new Array;function setUserInfo(e,t,i){this.email=e,this.userid=t,this.zuid=i}function IntegrationService(){new Array,new Array,new Array,new Array,new Array;this.is_service_alert="N",this.allUserObjArr=allUserList}function getCurrentUserEmail(){var e=new Array;return e[0]=getObj("email").value,e}function compareSelectedEmailWithServiceEmail(e,t,i){var a="";if(null!=t)for(var r=0;r<t.length;r++)if(null!=t[r])for(var n=0;n<e.length;n++)if(null!=e[n]&&trimBoth(t[r])==trimBoth(e[n])){a+="ZTI"==i?'<b class="dim">'+$ESAPI.encoder().encodeForHTML(t[r])+" </b>":'<p><b class="dim">'+$ESAPI.encoder().encodeForHTML(t[r])+"</b></p>";break}return a}function getEmailByServiceUserId(e,t){for(var i=new Array,a=0,r=0;r<t.length;r++)if(null!=t[r]&&null!=e)for(prop in e)if(null!=e[prop]&&null!=e[prop].userid&&trimBoth(t[r])==trimBoth(e[prop].userid)){i[a++]=e[prop].email;break}return i}function getEmailByServiceZUID(e,t){for(var i=new Array,a=0,r=0;r<t.length;r++)if(null!=t[r]&&null!=e)for(prop in e)if(null!=e[prop]&&null!=e[prop].zuid&&trimBoth(t[r])==trimBoth(e[prop].zuid)){i[a++]=e[prop].email;break}return i}function getServiceResponse(e,t){new Array;return e[t].substring(1,e[t].length-1).split(",")}function checkDBStatusAndOpenZReports(e){var t=Crm.getCrmBasePath()+"/ZReportsConfig.do",i="mode=checkDBStatus&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(t,(function(t){"true"==t?window.open(e):document.location.href=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/ShowSetup.do?tab=webInteg&subTab=zohoApps&mode=showConfig")}),i)}function replaceSplChrs(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&amp;/g,"&")}function revertSplChrs(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;")}IntegrationService.isServiceAlerted="N",IntegrationService.pageName="VIEW_ALL_USER",IntegrationService.prototype.setIntegrationService=function(e){var t="zuids="+encodeURIComponent(this.getZUIDS()),i=Crm.getCrmBasePath()+"/License.do?actionType=checkUserService";mR(i,(function(t){var i="object"==typeof t?t:JSON.parse(t);if(IntegrationService.pageName=e,this.allUserEmail=(new IntegrationService).allUserEmails(),"VIEW_ALL_USER"==IntegrationService.pageName)this.selectedUserEmail=getSelectedUsersEmailList();else if("ACTIVATE_USER"==IntegrationService.pageName){var a=new Array;this.selectedUserEmail=a}else this.selectedUserEmail=getCurrentUserEmail();this.zti_reference_users_zuid=getServiceResponse(i,"ZTI"),this.project_users_email=getServiceResponse(i,"ZOHOPROJECT"),this.zti_reference_users_email=getEmailByServiceZUID((new IntegrationService).allUserObjArr,this.zti_reference_users_zuid)}),t)},IntegrationService.prototype.getZUIDS=function(){var e=(new IntegrationService).allUserObjArr,t="";for(prop in e)null!=e[prop].zuid&&"null"!=e[prop].zuid&&""!=e[prop].zuid&&(t+=e[prop].zuid+"###");return t},IntegrationService.prototype.allUserEmails=function(){var e=(new IntegrationService).allUserObjArr,t=new Array,i=0;for(prop in e)null!=e[prop].email&&(t[i++]=e[prop].email);return t},IntegrationService.prototype.doValidate=function(e){var t="";"VIEW_ALL_USER"==IntegrationService.pageName?selectedUserEmail=getSelectedUsersEmailList():"ACTIVATE_USER"==IntegrationService.pageName&&(selectedUserEmail=getEmailByServiceUserId(this.allUserObjArr,e)),""!==(t=compareSelectedEmailWithServiceEmail(selectedUserEmail,zti_reference_users_email,"ZTI"))&&getObj("ZTIservice")&&getObj("ZTIServiceEmail")&&(getObj("ZTIservice").style.display="block",$(getObj("ZTIServiceEmail")).empty(),getObj("ZTIServiceEmail").innerHTML=t,IntegrationService.isServiceAlerted="S"),t="",""!==(t=compareSelectedEmailWithServiceEmail(selectedUserEmail,project_users_email,"Project"))&&$("#projectService")&&$("#ProjectServiceEmail")&&($("#projectService").show(),$("#ProjectServiceEmail").html(t),IntegrationService.isServiceAlerted="S")};var clrTxtPtnRegex=/[^~`#%^&*()+={}[\]|\;"<>\\]/g,uNameEmail=/^(([A-Za-z0-9_.]+)|([A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[a-zA-Z]{2,6}))$/g,clrTxtPtnRegexWithSingleQuote=/[^~`#%^&*+=[\]|\;"<>\\]/g;function getClrTxtPtnResChars(e,t){return t=void 0===t?clrTxtPtnRegex:t,eliminateDuplicates(e.replace(t,"").split(""))}function eliminateDuplicates(e){var t,i=e.length,a=[],r={};for(t=0;t<i;t++)r[e[t]]=0;for(t in r)a.push(t);return a}function showOrHideUserDetail(e){null!=Crm.userDetails&&Crm.userDetails.CUSTOMIZE_INFO.ShowUserDV&&(e.hide(),e.find("#showHideDetail").addClass("hideDetailArrow").html(I18n.getMsg("crm.button.hide.details")),e.find("#UserInfoDiv").css({display:"block"}),setTimeout((function(){e.show()}),150))}function checkForWindowOpener(e,t,i){if("A"!=e.nodeName&&"AREA"!=e.nodeName)return!1;if(href=e.getAttribute("href"),!href)return!1;"http:"!=e.protocol&&"https:"!=e.protocol||(targetName=e.getAttribute("target"),(i||targetName&&"_top"!==targetName&&"_self"!==targetName&&"_parent"!==targetName)&&e.setAttribute("rel","noopener noreferrer"))}function updateReportingForRoleChange(e,t,i){var a={};if("roleChange"==t||"subordinates"==t?a.roleId=$("#roleIdForChange").val():a.userId=$("#userIdForChange").val(),"roleChangePopUp"==e){var r=$("#reportingToDropdown");if(void 0===(n=r[0].component.getData("cxPropSelectedUser").id))return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),r[0]),!1;a.reportingToId=n}else if("branchChangePopup"==e){var n,o=$("#subUserDropdown");if(void 0===(n=o[0].component.getData("cxPropSelectedUser").id))return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),$L(o[0].parentElement)),!1;a.reportingToId=n;var s=$("#managerDropdown"),l=s[0].component.getData("cxPropSelectedUser").id;if(void 0===l)return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),s),!1;a.userReportingToId=l}"roleChangeWithSub"===t&&(t="roleChange"),"roleChangeDeleteWithSub"===t&&(t="roleChangeDelete"),a.actionType=t;var c=$("#roleChangePopUp"),d=$("#branchChangePopup");if(c.length>0){var u=$("#RoleAction");u.length>0&&Territory.doUpdateForm("result",u[0],!0,!0,void 0,void 0,void 0,void 0,a);var m=$("#deleteRoleForm");m.length>0&&UpdateDetails(["transDelRole"],m[0],void 0,void 0,void 0,void 0,a)}"subordinates"!==t&&"manager"!==t&&"submanagerchange"!==t||addorupdateUsers("editUser",a,i),c.remove(),d.remove()}function setRoleToUserFilter(e,t){var i="subUserDD"===t?$("#subUserDropdown")[0].component:"managerDD"===t?$("#managerDropdown")[0].component:$("#reportingToDropdown")[0].component;i.setData("cxPropSelectedUser",{});var a='[{"comparator":"equal","field":"role.id","value":'.concat('"').concat(e).concat('"').concat("}]");i.setData("cxPropCriteria",a);var r='{"role_id":'.concat('"').concat(e).concat('"').concat("}");i.setData("cxPropQueryParam",r)}function isemojipresent(e){var t=e.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g);return!!(t&&t.length>0)}function userSelect(){if($("#roleChangePopUp").length>0){var e=$("#roleDD"),t=$("#userDD");thirdPartyUtils.bindSelect2(e,t),e.change((function(){var e=$("#userDD"),t=$(this).val(),i=0;e.children().each((function(){$(this).attr("data-group")!=t?($(this).attr("disabled","disabled").prop("selected",""),$(this).addClass("dN")):(0==i&&$(this).prop("selected","selected"),$(this).removeAttr("disabled"),$(this).removeClass("dN"),i+=1)})),thirdPartyUtils.bindSelect2(e)}))}else if($("#branchChangePopup").length>0){var i=$("#userRoleDD");thirdPartyUtils.bindSelect2(i,$("#userReportingDD")),i.change((function(){for(var e=$(this).val(),t=$("#userReportingDD"),i=t.children(),a=i.length,r=!0,n=0;n<a;n++){var o=$(i[n]);o.attr("data-group")!=e?(o.attr("disabled","disabled").prop("selected",!1),o.addClass("dN")):(r&&o.prop("selected",!0),o.removeAttr("disabled"),o.removeClass("dN"),r=!1)}thirdPartyUtils.bindSelect2(t)}));var a=$("#subRoleDD");thirdPartyUtils.bindSelect2(a,$("#subUserDD")),a.change((function(){for(var e=$(this).val(),t=$("#subUserDD"),i=t.children(),a=i.length,r=!0,n=0;n<a;n++){var o=$(i[n]);o.attr("data-group")!=e?(o.attr("disabled","disabled").prop("selected",!1),o.addClass("dN")):(r&&o.prop("selected",!0),o.removeAttr("disabled"),o.removeClass("dN"),r=!1)}thirdPartyUtils.bindSelect2(t)}))}}function checkHierarchyForRoleChange(e){var t=$("#oldRoleId");if(t.val()&&$("#roleId").val()!=t.val()){var i=Crm.getCrmBasePath()+"/Role.do",a={};a.oldRole=t.val(),a.action="checkHierarchy",a.type="userRoleChange",a.viewedUserId=e,networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:i,type:"POST",data:a,success:function(e){"none"!=e.misMatchType&&networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change);var t=e.misMatchType;if($("#transfer").html(Handlebars.templates.role_branch_change(e)),"manager"==e.misMatchType||"subordinates"==e.misMatchType){var i=$("#roleDD"),a=[];i.children().each((function(){var e=$(this).val();a.contains(e)?$(this).remove():a.push(e)}))}else if("submanagerchange"==e.misMatchType){var r=$("#userRoleDD"),n=[];r.children().each((function(){var e=$(this).val();n.contains(e)?$(this).remove():n.push(e)}));var o=$("#subRoleDD"),s=[];o.children().each((function(){var e=$(this).val();s.contains(e)?$(this).remove():s.push(e)}))}"manager"==t||"subordinates"==t?showAnimatePopup("roleChangePopUp"):"submanagerchange"==t&&showAnimatePopup("branchChangePopup"),userSelect(),$("#roleDD").trigger("change")}))}})}}function branchChange(e,t,i,a){if(e.val())if(t.val()!=e.val()){var r=Crm.getCrmBasePath()+"/Role.do",n={};n.roleId=t.val(),n.oldRole=i.val(),n.action="checkHierarchy",n.type="roleChange",networkUtils.setCsrfParam(n),(new crmRequestPool).initiate({action:r,type:"POST",data:n,success:function(e){"none"!=e.misMatchType?networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change),$("#roleChangePopUp").length>0&&$("#roleChangePopUp").remove(),$("#show").append(Handlebars.templates.role_branch_change(e));var t=$("#roleDD"),i=[];t.children().each((function(){var e=$(this).val();i.contains(e)?$(this).remove():i.push(e)})),showAnimatePopup("roleChangePopUp"),userSelect(),$("#roleDD").trigger("change"),$("#subOrdinateList").hide()})):Territory.doUpdateForm("result",a,!0,!0)}})}else Territory.doUpdateForm("result",a,!0,!0)}function getDetailsForDelete(e){var t={},i=Crm.getCrmBasePath()+"/Security.do";t.actionName="getDeleteDetails",t.userId=e,networkUtils.setCsrfParam(t),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:i,type:"POST",data:t,success:function(e){networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("modifyHierarchy",Handlebars.templates.modifyHierarchy),$("#hierarchypopups").html(Handlebars.templates.modifyHierarchy(e)),commonUtils.showHideLoadingDiv();var t=$("#subs").text();$("#subs").text(t.substring(0,t.length-1)),$("#deleteUserAlertDiv").hide(),showAnimatePopup("transferAlertDiv")}))}})}function showPrevTargetDetails(e,t){stopEvent(t);var i=JSON.parse($("#"+e).attr("data-info")),a=$("#current_achieved").text().split(" ")[0];$("#current_achieved").text(a+" "+i.currentAchieved),$("#current_pipe").text(a+" "+i.currentPipeline),$("#previous_target").text(a+" "+i.target),$("#previous_achieved").text(a+" "+i.achieved),$("#previous_pipe").text(a+" "+i.pipeline);var r=$("#"+e).position(),n=r.left,o=r.top,s=getElemById("suggestDetails");s.style.display="",s.style.left=n+190+"px",s.style.top=o-26+"px"}function saveForecastSettings(){var e={},t=Crm.getCrmBasePath()+"/ReportingForecast.do";networkUtils.setCsrfParam(e),e.forecastField=$("#forecastField").val(),e.targetPeriod=$("#targetPeriod").val(),e.fiscalStart=$("#fiscalStart").val(),e.fYDisplay=$("input[name=fYDisplay]:checked","#fiscalYear").val(),e.actionName="saveSettings",commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:t,type:"POST",data:e,success:function(e){Territory.cancelTerritoryPopup("forecastsettingpopup"),networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){loadForecastViewOrCreate(e)}))}})}function saveForecastOnCreate(){var e={},t=$("#forecastYear").val(),i=$("#forecastMonth").val(),a=Crm.getCrmBasePath()+"/ReportingForecast.do";e.fcQuarter=i,e.fcYear=t;var r="",n="";networkUtils.setCsrfParam(e),e.totalTarget=$("#userQuota").val(),e.actionName="saveOnCreate",$("#allTargets").find("[id*=subs]:visible").each((function(){r+=$(this).attr("id").split("_")[1]+";",n+=$(this).val()+";"})),e.userList=r,e.userTargets=n,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:a,type:"POST",data:e,success:function(e){loadForecastViewOrCreate(e)}})}function showHideRoleList(e){e?(crmui.hideTooltip(),$("#confirmReporting").css("z-index","20"),mailsetCenter("roleNameList")):($("#roleNameList").hide(),$("#confirmReporting").css("z-index",""))}function hierarchySelect(e){var t=$("#user").val(),i=$("#strictly").val();e?($("#compliance").slideUp(),"true"==t?$("#EnaRepActions").removeClass("eventNone disable"):$("#EnaRepActions").addClass("eventNone disable")):($("#compliance").slideDown(),"false"==t?$("#EnaRepActions").removeClass("eventNone disable"):("false"==i?$("#nonStrict").click():$("#strict").click(),$("#EnaRepActions").addClass("eventNone disable")))}function complianceSelect(e){var t=$("#strictly").val();"true"==$("#user").val()&&(e&&"false"==t||!e&&"true"==t?$("#EnaRepActions").removeClass("eventNone disable"):$("#EnaRepActions").addClass("eventNone disable"))}function cancelHierarchy(){var e=$("#user").val(),t=$("#strictly").val();"false"==e?($("#roleHier").click(),$("#nonStrict").click()):"true"==e&&($("#repoHier").click(),"false"==t?$("#nonStrict").click():$("#strict").click())}function saveHierarchy(e,t,i,a){var r=$("#user").val(),n=$("#hierType input:checked").attr("id"),o=!1,s=!1,l=!1;if(e&&newForecastsEnabled&&!t&&"repoHier"===n){var c=$("#compliance input:checked").attr("id");c&&r&&("nonStrict"===c||"strict"===c)&&"true"===r&&(l=!0)}if(e&&newForecastsEnabled&&!t&&!l){crmui.hidePopup("confirmReporting");var d=document.querySelector("crm-forecast-hierarchy-popup"),u={errorMsgTitle:I18n.getMsg("crm.forecast.hierarchy.preference.title.warning"),errorMsg1:I18n.getMsg("crm.forecast.hierarchy.preference.confirmation.warning"),errorMsg5:I18n.getMsg("crm.forecast.hierarchy.preference.configuration.changes.warning"),fromConfig:!1};"repoHier"===n?(u.errorMsg2=I18n.getMsg("crm.forecast.hierarchy.preference.completed.period.warning",I18n.getMsg("crm.role.text")),u.errorMsg3=I18n.getMsg("crm.forecast.hierarchy.preference.current.upcoming.period.warning",I18n.getMsg("cob.role")),u.errorMsg4=I18n.getMsg("crm.forecast.hierarchy.preference.new.flow.warning",I18n.getMsg("crm.forecast.reporting.lower.case")),a&&(u.errorMsg6=I18n.getMsg("crm.forecast.hierarchy.preference.existing.new.approval.process",I18n.getMsg("crm.forecast.reporting.lower.case")))):(u.errorMsg2=I18n.getMsg("crm.forecast.hierarchy.preference.completed.period.warning",I18n.getMsg("crm.forecast.reporting.lower.case")),u.errorMsg3=I18n.getMsg("crm.forecast.hierarchy.preference.current.upcoming.period.warning",I18n.getMsg("crm.forecast.reporting.camel.case")),u.errorMsg4=I18n.getMsg("crm.forecast.hierarchy.preference.new.flow.warning",I18n.getMsg("crm.role.text")),a&&(u.errorMsg6=I18n.getMsg("crm.forecast.hierarchy.preference.existing.new.approval.process",I18n.getMsg("crm.role.text")))),d?d.setData(u):Lyte.Component.render("crm-forecast-hierarchy-popup",u,"#basic"),document.querySelector("#forecast-hierarchy-popup").ltProp("show",!0)}else if(("true"===r&&"roleHier"===n||"false"===r&&"repoHier"===n)&&a){crmui.hidePopup("confirmReporting");d=document.querySelector("crm-forecast-hierarchy-popup");(u={errorMsgTitle:I18n.getMsg("crm.forecast.hierarchy.preference.title.warning"),errorMsg1:I18n.getMsg("crm.forecast.hierarchy.preference.confirmation.warning"),errorMsg5:I18n.getMsg("crm.forecast.hierarchy.preference.configuration.changes.warning"),fromConfig:!1}).errorMsg6="repoHier"===n?I18n.getMsg("crm.forecast.hierarchy.preference.existing.new.approval.process",I18n.getMsg("crm.forecast.reporting.lower.case")):I18n.getMsg("crm.forecast.hierarchy.preference.existing.new.approval.process",I18n.getMsg("crm.role.text")),d?d.setData(u):Lyte.Component.render("crm-forecast-hierarchy-popup",u,"#basic"),document.querySelector("#forecast-hierarchy-popup").ltProp("show",!0)}else{if("repoHier"==n)o=!0,"strict"==$("#compliance input:checked").attr("id")&&(s=!0);if("roleHier"===n&&!i)return void showAssociationList(e,t,a);var m={},p=Crm.getCrmBasePath()+"/Role.do";m.userReporting=o,m.strictlyReporting=s,m.action="updateHierarchy",networkUtils.setCsrfParam(m),commonUtils.showHideLoadingDiv(!0),$("#EnaRepActions").addClass("eventNone disable"),(new crmRequestPool).initiate({action:p,type:"POST",data:m,success:function(e){var t=e;commonUtils.showHideLoadingDiv(),crmui.hidePopup("confirmReporting"),networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){var e=document.querySelector("#forecast-hierarchy-popup");e&&e.ltProp("show",!1);var i=I18n.getMsg("crm.user.hierarchy.role.message");"true"==t.reporting&&(i=I18n.getMsg("crm.user.hierarchy.reporting.message")),renderHierarchyPage(t),o.toString()!=r&&(crmui.showMsgBand("success",i,4e3),"true"==t.reporting?Crm.userDetails.isUserHierarchy=!0:Crm.userDetails.isUserHierarchy=!1)}))}})}}var ReportingHierarchy={reportingTo:null,res:null};function renderHierarchyPage(e){Handlebars.registerPartial("hierarchyDetails",Handlebars.templates.hierarchyPreference),$("#result").html(Handlebars.templates.hierarchyPreference(e));var t,i,a,r=e.count,n=e.roleList,o="";if(r>0&&(t="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+n[0].id+"\"]' data-zcqa='openRole_"+n[0].roleName+"'>"+n[0].roleName+"</link-to>",r>1&&(i="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+n[1].id+"\"]' data-zcqa='openRole_"+n[1].roleName+"'>"+n[1].roleName+"</link-to>"),r>2&&(a="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+n[2].id+"\"]' data-zcqa='openRole_"+n[2].roleName+"'>"+n[2].roleName+"</link-to>")),1==r)o=t;else if(2==r){var s=[t,i];o=I18n.getMsg("crm.user.hierarchy.role.two",s)}else if(3==r){s=[t,i,a];o=I18n.getMsg("crm.user.hierarchy.role.three",s)}else if(r>3){s=[t,i,a,r-3];o=I18n.getMsg("crm.user.hierarchy.role.many",s),o+=r-3==1?" "+I18n.getMsg("Other"):" "+I18n.getMsg("Others")}if($("#shareRoleList").html(o),r>3){var l=10,c="";r<10&&(l=r);for(var d=0;d<l;d++)c+=n[d].roleName+"<br />";if(r>10)c+=I18n.getMsg("crm.event.more.event.and",[r-10]);e='{content:"'+c+'",isHTML: true,position: "left"}';$("#tooltip").attr("onmouseover","crmui.showTooltip("+e+")")}"true"==e.reporting&&$("#compliance").removeClass("dN")}function formatState(e){if(!e.element||!e.element.value||"None"==e.element.value||!e.element.getAttribute("data-src")&&!e.element.getAttribute("data-email"))return e.text;var t=Crm.userDetails.contactServerUrl;return $('<span><img src="'+t+"/file?ID="+e.element.getAttribute("data-src")+'&fs=thumb" width="25" height="25" class="img-flag dIB vaM fL" /><div class="dIB w200 mL10"><span title="'+$ESAPI.encoder().encodeForHTML(e.text)+'" class="ellipsistext dB"> '+$ESAPI.encoder().encodeForHTML(e.text)+"</span><label title="+e.element.getAttribute("data-email")+' class="dB ellipsistext">'+e.element.getAttribute("data-email")+"</label></div> </span>")}function loadGroupUsers(e,t,i,a){var r=e.length;if(t<=r)for(var n=0,o=t;n<i&&o<r;o++){var s=e[o];for(var l in s)if(!a||0===$('#selectedGroupSrc option[value="U:'+l+'"]').length){var c=document.createElement("option");c.value="U:"+l,c.text=s[l],getObj("availUsersPL").appendChild(c),n++}}}function availUsersPLDivScroll(){var e=$L("#availUsersPL"),t=e[0].scrollHeight;if(e.outerHeight()-2==t-e.scrollTop()){var i=$("#availUsersPL option").length;loadGroupUsers(searchedGroupUsersJsonObj.length>0?searchedGroupUsersJsonObj:groupUsersJsonObj,i,i+loadingUsersLimit,!0)}}function searchGroupUser(e){searchedGroupUsersJsonObj=[],clearTimeout(userGroupSearch),userGroupSearch=setTimeout((function(){if(""!=e)for(var t=groupUsersJsonObj.length,i=new RegExp(e,"i"),a=0;a<t;a++){var r=groupUsersJsonObj[a];for(var n in r){var o=r[n];i.test(o)&&searchedGroupUsersJsonObj.push(r)}}else searchedGroupUsersJsonObj=groupUsersJsonObj;$("#availUsersPL").empty(),loadGroupUsers(searchedGroupUsersJsonObj,0,loadingUsersLimit,!0)}),300)}function showAssociationList(e,t,i){store.findAll("layout",{module:"users"}).then((function(a){for(var r=a[0].id,n=null,o=a[0].fields.length,s=0;s<o;s++){var l=a[0].fields[s];"Reporting_To"===l.api_name&&(n=l.id)}var c={success_callback:function(a){if(a.error)crmui.showMsgBand("error",I18n.getMsg("game.common.error"),3e3);else if(null!==a.fields_associations[0].associated){var r=constructAssociationData(a.fields_associations[0].associated);if(Object.keys(r).length>0){var n=networkUtils.returnDependencyFiles(["crm-hierarchypreference-modal.js"],ResourceConstants.CRMClient);Lyte.injectResources(n,void 0,(function(){Lyte.Component.render("crm-hierarchypreference-modal",{show:!0,deleteContent:r},"#hierarchyPreferenceChangePop")}))}}else saveHierarchy(e,t,!0,i)},failure_callback:function(){crmui.showMsgBand("error",I18n.getMsg("game.common.error"),3e3)},params:"ids="+n+"&module=Users&layout_id="+r};networkUtils.makeRequest("/crm/v2.2/settings/fields/actions/associated","GET",c)}))}function constructAssociationData(e){for(var t={},i=e.length,a=0;a<i;a++){var r=e[a],n=r.type;if("workflow_custom_function"===n||"workflow_tasks"===n){var o=n.split("_");r.action=o[o.length-1],n=r.feature_type}if("workflow"===n&&("create_record"!==r.action&&"function"!==r.action||(n=n+"_"+r.action),"webhooks"!==r.action&&"tasks"!==r.action||(n=r.action)),"orchestration"===n&&("create_record"!==r.action&&"webhooks"!==r.action&&"tasks"!==r.action&&"function"!==r.action||(n=n+"_"+r.action)),n in t)var s=t[n].items;else{s=[];t[n]={}}s.push(r),t[n].items=s}return i>0&&appendAssociationLinks(t),t}function appendAssociationLinks(e){for(var t={workflow_create_record:{topic:I18n.getMsg("crm.workflow.title")+" - "+I18n.getMsg("crm.workflow.actions.listing.CreateRecord"),route:"crm.settings.section.workflow-rules.view-workflow-rule",dynamicParam:[]},orchestration_create_record:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.CreateRecord"),route:"crm.settings.section.orchestration.edit-orchestration",dynamicParam:[]},email_template:{topic:I18n.getMsg("crm.fielddelete.emailtemplate"),route:"crm.settings.section.crm-templates",dynamicParam:[],queryParam:{type:"email",step:"edit"}},dashboard_components:{topic:I18n.getMsg("crm.label.analytical.dashboard.components"),route:"crm.tab.dashboards.view",dynamicParam:[]},custom_button:{topic:I18n.getMsg("crm.customize.custombutton.label"),route:"crm.settings.section.modules.module.custom-button.custom-button-index",dynamicParam:[]},custom_link:{topic:I18n.getMsg("crm.customlink"),route:"crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",dynamicParam:[]},Reports:{topic:I18n.getMsg("crm.report.reports"),route:"crm.tab.module.entity.detail",dynamicParam:["Reports"]},inventory:{topic:I18n.getMsg("crm.fielddelete.inventorytemplate"),route:"crm.settings.section.crm-templates",dynamicParam:[],queryParam:{type:"inventory",step:"edit"}},orchestration_add_log:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.orchestration.state.action.instant.label.addlog"),route:"crm.settings.section.orchestration.edit-orchestration",dynamicParam:[]},workflow_function:{topic:I18n.getMsg("crm.auditlog.workflowdeluge"),route:"crm.settings.section.workflow-deluge",queryParam:{}},tasks:{topic:I18n.getMsg("crm.tasks.title"),route:"crm.settings.section.tasks.view-task",dyanamicParam:[]},webhooks:{topic:I18n.getMsg("workflow.label.webhooks"),route:"crm.settings.section.webhooks.view-webhook",dyanamicParam:[]},orchestration_function:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.Deluge"),route:"crm.settings.section.workflow-deluge",queryParam:{}},orchestration_tasks:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.Task"),route:"crm.settings.section.tasks.view-task",dyanamicParam:[]},orchestration_webhooks:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("workflow.label.webhooks"),route:"crm.settings.section.webhooks.view-webhook",dyanamicParam:[]},"assignment rule":{topic:I18n.getMsg("crm.common.menu.assignmentRules"),queryParam:{},dynamicParam:[]},"lookup filter criteria":{topic:I18n.getMsg("crm.label.lookupfilter.criteria"),route:"crm.settings.section.modules.module.layouts.view-layout",queryParam:{},dynamicParam:[]}},i=Object.keys(e),a=i.length,r=0;r<a;r++){var n=i[r],o=e[n],s=e[n].items,l=s.length;switch(n){case"dashboard_components":for(var c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.id)}break;case"Reports":for(c=0;c<l;c++){(d=s[c]).dynamicParam=["Reports"],d.dynamicParam.push(d.id)}break;case"inventory":case"email_template":for(c=0;c<l;c++){(d=s[c]).queryParam={},d.queryParam=t[n].queryParam,d.queryParam.templateId=d.id}break;case"orchestration":case"logs":case"orchestration_create_record":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.rule_id)}n="logs"===n?"orchestration_add_log":n;break;case"workflow_create_record":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.rule_id)}break;case"webhooks":case"orchestration_webhooks":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.id)}break;case"workflow_function":case"orchestration_function":for(c=0;c<l;c++){(d=s[c]).queryParam={},d.queryParam.delugeId=d.id}break;case"custom_button":case"custom_link":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.module)}break;case"tasks":case"orchestration_tasks":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.id)}break;case"assignment rule":for(c=0;c<l;c++){(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.id)}break;case"lookup filter criteria":for(c=0;c<l;c++){var d;(d=s[c]).dynamicParam=[],d.dynamicParam.push(d.module),d.dynamicParam.push(d.details.layout.id)}}void 0!==t[n]?(o.topic=t[n].topic,o.route=t[n].route):delete e[n]}}function showCruxLookUp(e,t,i,a){var r=null,n=t.split("Manager");if("changeOwner"===e){var o=$("#cruxUserLookupComponentOutlet").find("crm-userlookup-wrapper-component")[0];o||(o=Lyte.Component.render("crm-userlookup-wrapper-component",{wrapperClass:"crmTerritoryManagerPopWrapper",okButton:I18n.getMsg("crm.button.save")},"#cruxUserLookupComponentOutlet")),(r=o.component).setData("isTerritoryManagement",!0),r.setData("queryParams",{type:"ActiveUsers"})}else if("changeFCManager"===e){var s=$("#cruxRoleUserLookupComponentOutlet").find("crm-userlookup-wrapper-component")[0];s||(s=Lyte.Component.render("crm-userlookup-wrapper-component",{},"#cruxRoleUserLookupComponentOutlet")),(r=s.component).setData("isTerritoryManagement",!1),r.setData("queryParams",{type:"ActiveUsers",filters:'[{"comparator":"equal","field":"role.id","value":"'+n[1]+'"}]'})}a&&r.setData("managerStatus",a);var l=$("#"+t).data("ownerid"),c={cruxLookupId:"cruxLookup"+t,fldLabel:t,entityId:n[1],entityName:i};r.setData(c),l?r.setData("ownerId",l):r.setData("ownerId",""),r.setData("showPopup",!0)}Handlebars.registerHelper("isHelpNotPresent",(function(e,t){return Handlebars.helpers.canShowHelpVideo(t).length===t.fn(this).length&&-1===Crm.userDetails.RELEVANT_LOCALE.indexOf("ja_JP")&&Handlebars.helpers.getHelpUrl(e)===crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl[e]?t.fn(this):t.inverse(this)}));