Lyte.Mixin.register("cv-anomaly-utils",{getCustomViewAnomalyData:function(e){var a={noAnomaly:!0};return["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&["Leads","Deals","Contacts","Accounts","Calls","Events","Campaigns","Tasks","Cases","Quotes","Products","Quoted_Items","Purchase_Orders","Vendors","Messages","Sales_Orders","Solutions","Invoices"].includes(e.api_name)?store.findAll("dummy",null,!1,!1,{url:"/crm/v7/__zia_notifications?type=custom_view_anomaly&per_page=1&page=1"}).then((function(e){var t=e&&e.__zia_notifications?e.__zia_notifications.length:0;for(let n=0;n<t;n++)"custom_view_anomaly"===e.__zia_notifications[n].type&&(a.noAnomaly=!e.__zia_notifications[0].associated_resources[0].details||e.__zia_notifications[0].associated_resources[0].details.result_seen,a.anomaly=e.__zia_notifications[0],a.cv_id=a.anomaly.associated_resources[0].details.custom_view.id);return a})):new Promise((function(e){e(a)}))},openAnomalyDetails:function(e,a,t,n){var o=networkUtils.returnDependencyFiles(["zia/anomaly/customview_result.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CVAnomalyResult")],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles(["zia/anomaly/customview_result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=o.concat(i).concat(s),l=this;Lyte.Component.registeredComponents["crm-intelligence-config-result"]?document.querySelector("crm-zia-cv-anomaly-result").component.renderChart():Lyte.injectResources(r,void 0,(function(){Lyte.Component.render("crm-zia-cv-anomaly-result",{result:{}},"#"+t)})).then((function(){var t=e.anomaly,o=document.querySelector("crm-zia-cv-anomaly-result");if(Array.isArray(t.chart_data)){var s=[];t.chart_data.forEach((e=>{for(let a in e)"0"!==a&&s.push(e[a].anomaly)}));var i={name:moduleRecordMapping.Potentials.plural_label};o.component.setData({name:t.title,id:t.id,module:i,anomaly:t.chart_data[0][0].anomaly,chartData:t.chart_data[0][0].details,stageDetails:s,isDealsStageAnomaly:!0,from:n})}else{(i=t.associated_resources[0].details.module).name=a?a.plural_label:moduleRecordMapping[i.api_name].plural_label,o.component.setData({name:t.title,id:t.id,module:i,anomaly:t.chart_data.anomaly,chartData:t.chart_data.details,isDealsStageAnomaly:!1,from:n})}var r={};r.transition={animation:"list"===n?"slideFromTop":"slideFromRight",duration:"0.5"},r.offset="list"===n?{top:"0px"}:{right:"435px",top:"54px"},r.height="list"===n?"":"calc(100% - 54px)",r.maxheight="100%",r.class="list"===n?"crmModalWithoutFooter":"",featuresAvailable.NEXTGENUI_ENABLED&&(r.offset="list"===n?{top:"0px"}:{right:"436px",top:"0px"},r.height="list"===n?"":"100%"),o.component.setData("modalProperty",r),o.component.renderChart(),"list"!==n||t.associated_resources[0].details.result_seen||l.updateCVAnomalySeen(t.id)}))},updateCVAnomalySeen:function(e){var a="action=cvanomalyseen&id="+e+"&"+csrfParamName+"="+csrfToken,t={url:Crm.getCrmBasePath()+"/crminotification.do",method:"POST",payLoad:a,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};store.findAll("dummy",{},!1,!1,t)}});
