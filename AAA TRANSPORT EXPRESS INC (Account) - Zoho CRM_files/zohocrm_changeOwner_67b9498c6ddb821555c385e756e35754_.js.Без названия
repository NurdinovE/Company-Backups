var changeOwner={relatedRecords:[],notifyOwner:[],massTransferRecords:"",massTransferNotify:!1,unconfirmedUsersList:[],isLoaded:!1,handleMassActionOk:function(){changeOwner.disabledButton();var e="<input type='button' data-zcqa='btn_MassChangeOwnerSave' value='"+I18n.getMsg("crm.mass.actions.ok.proceed")+"' class='primarybtn' id='buttonMassChangeOwner' name='buttonChangeOwner' onclick=\"changeOwner.handleMassTransferWorkFlowPopUpProceed()\">",t=crmListView.getObject().module,a=getWorkflowPopUpContent(e,"changeOwner.handleMassTransferWorkFlowPopUpCancel",t);$("#massActionWorkFlowPopUp").html(a)},disabledButton:function(){var e=document.getElementById("changeOwnerPopUp"),t="";null!==e&&(t=Object.values(e)[0].id);if(null!==e&&""===t){var a=$("#okBtn");a.css("opacity","0.7"),a.prop("disabled","disabled")}},enableButton:function(){var e=$("#okBtn");e.prop("disabled",""),e.css("opacity","1")},catchEnter:function(e){if(13==e.keyCode)return!1},handleChangeOwnerFromListView:function(e,t,a,r){var n=!1,s=crmListView.getObject().cvId,o=crmListView.getObject().module;null==t&&(t=$("#changeOwnerPopUp").data("id"));var i=getIdsAndNames().idList,c=crmListView.getObject().fromIndex,l=crmListView.getObject().toIndex,d=objectUtils.getKeys(crmListView.startIndex).sort()[0];c=d,l=parseInt(d)+parseInt(crmListView.getObject().currentOption)-1;var m=crmListView.getObject().doMassActioninScheduler,u="";m?((u=crmListView.getObject().totalCount)>Crm.massOperationWorkflowLimit&&void 0===e?n=!0:(u<=Crm.massOperationWorkflowLimit||void 0!==e)&&(n=!1),(1==n||"true"==n||u<=Crm.massOperationWorkflowLimit)&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Confirmed",{Module:o})):null==(u=crmListView.getObject().selectedIds.length)&&(u=1);var h=crmListView.getObject().includeChild?1:0,g=crmListView.getObject().territoryId,p={id:i,fromIndex:c,toIndex:l},f=changeOwner.getChoosenRelatedRecords(o,a,r),v=$("#notifyOwner").find("input").is(":checked")?"true":"false",w=Crm.getCrmBasePath()+"/ChangeOwnership.do";"list"==Lyte.Router.getRouteInstance().routeName&&(p.from="listview"),p[csrfParamName]=csrfToken,p.module=o,p.cvid=s,p.target="showcvdetails",p.ajaxRequest="true",p.SalesManId=t,p.isMassJobScheduled=m,p.isWfTriggerCheck=n,p.territoryId=g,p.includechild=h,p.relatedRecords=f,p.notify=v,p.fetchOnlyBody="true",p.featureId="5",crmListView.getObject().isWorkFlowRequired=!1,changeOwner.doMassUpdateOwner(o,w,p,i.split(";"))},isConfirmedUser:function(e,t){var a=$("#"+e+"changeOwnerPopUp"+t),r=a.data("id");if(""!=changeOwner.unconfirmedUsersList&&null!=changeOwner.unconfirmedUsersList&&-1!=changeOwner.unconfirmedUsersList.indexOf(r)){var n=$("#alertMessage");renderingUtils.freezeBackground(),$("#freezeBackGround").css("z-index","251");var s=a.attr("user-name").trim(),o=[];return o[0]=s,n.text(""),n.text(I18n.getMsg("crm.unconfirmed.user.notification",o)),$("#notifyOwner").find("input").prop("checked",""),!1}return!0},hideAlertPop:function(){renderingUtils.removeFreezeLayer(),$("#freezeBackGround").css("z-index","22"),crmui.hidePopup("showAlertPopUp")},handleMassTransferWorkFlowPopUpProceed:function(){hideAnimatePopup("massActionWorkFlowPopUp");changeOwner.handleChangeOwnerFromListView(!1);var e=crmListView.getObject().module;Crm.trackSpotLightAction("Mass Scheduler - Change Owner Workflow Ok Proceed",{Module:e})},handleMassTransferWorkFlowPopUpCancel:function(e){hideAnimatePopup("massActionWorkFlowPopUp",!0),hideAnimatePopup("changeOwnerPopup"),Crm.trackSpotLightAction("Mass Scheduler - Change Owner Workflow Cancel",{Module:e})},checkRelatedRecordsPermission:function(e,t,a){for(var r=$("#recordViewPerm").val(),n=""!==r?JSON.parse(r):"",s=e.split(","),o=$("#"+t+"changeOwnerPopUp"+a),i=o.data("profileId"),c=o[0].hasAttribute("lyte-rendered")?o[0].component.data.userName.trim():o.text().trim(),l=s.length,d=$("#alertMessage"),m=0;m<l;m++){var u=s[m];if(!(""===n||n[u]&&n[u].contains(i))){var h=[];return h[0]=c,h[1]="Events"===u?I18n.getMsg("crm.module.pluralLabel.Meetings"):u,d.text(""),d.text(I18n.getMsg("crm.change.owner.permission.alert",h)),crmui.showPopup("showAlertPopUp"),!1}}return!0},showRestrictionInfo:function(e,t,a){var r="#"+e+"_fldRow_SMOWNERID";"Products"===e&&(r="#"+e+"_fldRow_HANDLER"),this.getRestrictionInfo(e,t,a).then((function(t){if($("crm-threshold-grant").remove(),!1===t.allow){var a=document.createElement("crm-threshold-grant"),n=$(r+" .labelValCreate"),s=n.position().left,o=n.width();Crm.userDetails.RTL_ENABLED&&(s=-$(r+" .labelTabCreate").outerWidth());var i="position:relative;left:"+s+"px;width:"+o+"px;top:10px";return a.setData("rsGrantStyle",i),a.setData("moduleName",e),n.after(a),void commonUtils.showHideLoadingDiv()}}))},getRestrictionInfo:function(e,t,a){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,a)},changeEntityOwner:function(e,t,a,r,n,s,o,i){t="customview"===t?t="listview":t;var c=o,l=i,d=$("#"+c+"changeOwnerPopUp"+l),m=d.data("id"),u=$("#isDeletedUser");if(null==m){var h=$("[name=radiobtn]:checked");m=(m=h.attr("id")).substr(0,m.indexOf("_"))}var g="";g=d.attr("user-name")?d.attr("user-name").trim():d.text().trim(),I18n.getMsg("crm.tpi.ctiapi.label.selectsupportrep")===g&&(g="");var p=changeOwner.getChoosenRelatedRecords(e,c,l);"true"==u.val()&&(p=changeOwner.getRelatedModulesList(e),p=changeOwner.checkRelatedrecordsPresence(p,c,l));var f=$("#"+c+"notifyOwner"+l).find("input").is(":checked")?"true":"false";if(""!=g||""!=m){if(changeOwner.isLoaded)return changeOwner.isLoaded=!1,changeOwner.isLoaded;if(""!=p&&"workflowconvert"!=t&&!changeOwner.checkRelatedRecordsPermission(p,c,l))return changeOwner.isLoaded=!0,!1;if("true"==f&&!changeOwner.isConfirmedUser(c,l))return void crmui.showPopup("showAlertPopUp");if(changeOwner.disabledButton(),Events.withMeetingTool&&-1!=JSON.stringify(Events.meetingConfZuid).indexOf(Events.meetingToolName)&&(Events.checkAuthorizeDone(Events.meetingToolName,"ChangeOwner"),Events.userChange))return Events.userChange=!1,!0;var v={},w=$L("#changeOwnerPopUp")[0],O=w?w.component:w;if(O&&O.getData()&&O.getData().isFieldLookup){var C=O.ajaxEditOwnerValue,y=O.editOwnerValue;_.isEmpty(C)?_.isEmpty(y)||Crm.setRefFieldValues(O,O.getData().dataId,y):v=C.folOwnerAjaxVal}if(("dealconvert"===t||"convert"===t||"workflowconvert"===t)&&Search.folUserRefValues.length>0){for(var k=d.data("fieldidfoldeal"),R={},I=Search.folUserRefValues,L=I.length,b=0;b<L;b++)if(I[b].seId===m){R.item=I[b];break}var x=R.item.refFieldsInfo;x&&R.item.parentFieldsColumnName&&(x=x||{},Crm.setRefFieldValues(k,"",x,1))}switch(t){case"listview":changeOwner.handleMassActionOk(),changeOwner.handleChangeOwnerFromListView(void 0,m,c,l);break;case"detailview":var V=$("#Crm_"+e+"_SMOWNERID"),M=V.find("span");M.text(g),M.attr("title",g),V.data("id",m),changeOwner.relatedRecords[a]=p,changeOwner.notifyOwner[a]=f,this.showRestrictionInfo(e,m,a);break;case"caseOwner":$("#ownerName").val(g),$("#ownerId").val(m),$("#cases_relatedRecords").val(p);break;case"caseEscalationOwner":$("#escUserName").val(g),$("#escUserId").val(m);break;case"massTransferTo":$("#transferto").val(g),$("#SalesManId").val(m),$("#relatedRecords").val(p),changeOwner.massTransferRecords=p,changeOwner.massTransferNotify=f,$("#notify").val(f),changeOwner.handleMassActionOk();break;case"massTransferFrom":$("#transferfrom").val(g),$("#fromUserId").val(m);break;case"convert":$L("#assignedto")[0].ltProp("value",g),(A=$L("crm-convert-lead")[0].component).setData("relatedRecords",p),A.setData("SalesManId",m),A.addRestrictionMsgOnConvertPage(m,null,"checkAll"),A.executeMethod("enableNotifyChkbx");break;case"massconvert":var A;if("Leads"===e)(A=$L("crm-mass-convert")[0].component).setData("salesmanid",m),A.setData("relatedRecords",p),A.setData("ownerName",g),A.executeMethod("executeOwnerUpdateAction");else $("#convertownerName").text(g),$("#convertOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#relatedRecords").val(p),$("#convertownerId").val(m);changeOwner.handleMassActionOk();break;case"blueprint":var S=$("#relatedRecordsText"),P=$L("#arCheckbox").e;$("#fieldValue1").val(g),$("#ownerId").val(m),$("#relatedRecords").val(p),$("#notify").val(f),$("#isAssignmentRestricted").val(void 0!==P&&P.checked),S.text(""),""!=p&&(S.text(I18n.getMsg("crm.change.owner.relatedRecordsText",changeOwner.getRelatedRecordsText(p,g))),S.show());break;case"workflowconvert":if(Crm.userDetails.isNewConvertUIEnabled){var U=$L("crm-convert-action").e[0];U.setData("ownerId",m),U.setData("ownerName",g),U.component.relatedRecords=p}else changeOwner.enableNotifyChkbx(),$("#convertownerName").text(g),$("#defaultOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#convertownerId").val(m),$("#relatedRecords").val(p);break;case"macro":var T=$("[data-zcqa="+("Macro_FieldValue_Users_"+s)+"]").find(".textinmacro.normal.updatefield");T.attr("data-params",'{"USERID":"'+m+'"}'),$(".textinmacro.noneclass").hide(),T.show(),$("[data-zcqa="+("macro_ownerNameSpan_"+s)+"]").hide();var E=$("[data-zcqa="+("macro_ownerName_"+s)+"]");E.text(""),E.text(g).show(),$("[data-zcqa="+("macro_relatedRec_"+s)+"]").val(p),$("[data-zcqa="+("macro_notifyOwner_"+s)+"]").val(f);P=$L("#arCheckbox").e;$("[data-zcqa="+("macro_applyRestriction_"+s)+"]").val(void 0!==P&&P.checked);var N=$("[data-zcqa="+("relatedRecordsTxt_"+s)+"]");N.text(""),""!=p&&N.text(I18n.getMsg("crm.change.owner.relatedRecordsText",changeOwner.getRelatedRecordsText(p,g)));var F=N.outerHeight();$(".relatedRecordsTxt").closest(".Macro_droplistupdate").css({"margin-bottom":F});break;case"itsfromwebform":return changeOwner.handleMassActionOk(),changeOwner.handleChangeOwnerFromApprovalWeb(m);case"entityview":const t=Lyte.Router.getRouteInstance().transition.info.route;if(["crm.tab.module.entity.canvas","crm.tab.module.entity.detail"].includes(t))if(window.CScriptLib)if("crm.tab.module.entity.canvas"===t)CanvasDetailPageHandler.intercept_owner_field(m).then((function(){changeOwner.handleChangeOwnerFromEntityView(m,g,p,f,e,a,v)}),(function(){}));else{const t=$L("#changeOwnerForm crm-user-wrapper")[0],{id:r,name:n,email:s}=t&&t.getData("userRecord");r?CScript.Engine.Global.dispatchIEvent("onBeforeUpdate",store.peekAll("field").find((t=>"Owner"===t.api_name&&t.module[0].api_name===moduleRecordMapping[e].api_name)).id,{id:r,name:n,email:s}).then((function(t){!0===t&&changeOwner.handleChangeOwnerFromEntityView(m,g,p,f,e,a,v)})):changeOwner.handleChangeOwnerFromEntityView(m,g,p,f,e,a,v)}else changeOwner.handleChangeOwnerFromEntityView(m,g,p,f,e,a,v);else changeOwner.handleChangeOwnerFromEntityView(m,g,p,f,e,a,v);break;default:changeOwner.setownervalues(n)}var D=$("#convertModal");if(D&&D.is(":visible")&&$("#freezeBackGround").removeClass("wfqcIndex"),"listview"!=t){if(hideAnimatePopup("topBandPopup",!0),"massconvert"==t)$("#freezeBackGround").css("z-index","25");else{var B=document.querySelector("#multipleFieldsEditPop");B=!!B&&"none"!=B.style.display;var j=$("#eventCreatePopup"),z=$("#createEditCallDiv");B||"workflowconvert"==t||j.is(":Visible")||z.is(":Visible")||renderingUtils.removeFreezeLayer()}Events.userChange=!1}return!0}return r?renderingUtils.showCustomAlert(I18n.getMsg("crm.manager.change.alert.noselect")):renderingUtils.showCustomAlert(I18n.getMsg("crm.owner.change.alert.noselect")),!1},enableNotifyChkbx:function(){var e=$("#changeOwnerPopUp").data("id"),t=$("#LeadOwnerId").val(),a=$("#loginUserId").val();t!=a?t!=e?$("#notifyEx").css("display",""):($("#notifyEx").css("display","none"),$("#notifyLeadOwner").prop("checked",!1)):t==e&&($("#notifyEx").css("display","none"),$("#notifyLeadOwner").prop("checked",!1)),a!=e?($("#notifyRecOwner").css("display",""),a!=t&&$("#notify").prop("checked",!0)):a==e&&($("#notifyRecOwner").css("display","none"),$("#notify").prop("checked",!1))},toggleCheckBox:function(e,t,a){var r=e,n=$("#"+r),s=a,o=t,i=$("#"+o+"RecordsSpan"+s);i.find(".coma").removeClass("removecoma");var c=n.attr("label");(changeOwner.toggleInputCheckBox(r),n.is(":checked"))?($("#"+c).show(),$("#"+o+"noneId"+s).hide()):($("#"+c).hide(),changeOwner.getSelectedRecords(o,s)&&$("#"+o+"noneId"+s).show());i.find(".coma:visible").last().addClass("removecoma")},toggleInputCheckBox:function(e){var t=$("#"+e);t.is(":checked")?t.prop("checked",!1):t.prop("checked",!0)},getRelatedRecordsText:function(e,t){var a=[];return e=(e=(e=(e=(e=(e=e.replace("Tasks","Open Tasks")).replace("Calls","Open Calls")).replace("Events","Open Events")).replace("Contacts","Open Contacts")).replace("Potentials","Open Potentials")).replace(/,/g,", "),a[0]=e,a[1]=t,a},getRelatedModulesList:function(e){var t="";switch(e){case"Accounts":t="Contacts,Potentials,Events,Tasks,Calls";break;case"Contacts":t="Potentials,Events,Tasks,Calls";break;case"Events":case"Calls":case"Tasks":case"Activities":t="";break;default:t="Events,Tasks,Calls"}return t},trackChangeOwnerCancel:function(){crmListView.getObject().doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Cancel",{Module:crmListView.getObject().module});var e=$L("crm-mass-convert");e.length>0&&(e[0].setData("buttonDisp",!1),e[0].setData("moveBackGroundFreeze",!1));var t=$("#convertModal");t&&t.is(":visible")&&$("#freezeBackGround").removeClass("wfqcIndex")},getSelectedRecords:function(e,t){var a=!0,r=e,n=t,s=$("#"+r+"Tasks"+n),o=$("#"+r+"Calls"+n),i=$("#"+r+"Events"+n),c=$("#"+r+"Contacts"+n),l=$("#"+r+"Potentials"+n);return a=s.length?"none"==s.css("display")&&a:a,a=o.length?"none"==o.css("display")&&a:a,a=i.length?"none"==i.css("display")&&a:a,a=c.length?"none"==c.css("display")&&a:a,a=l.length?"none"==l.css("display")&&a:a},checkRelatedrecordsPresence:function(e,t,a){var r=$("#"+t+"Tasks"+a),n=$("#"+t+"Calls"+a),s=$("#"+t+"Events"+a),o=$("#"+t+"Contacts"+a),i=$("#"+t+"Potentials"+a),c=$("#openRelatedRecords").val();return e=(e=r.length||-1!=c.indexOf("Tasks")?e:e.replace("Tasks","")).replace(",,",","),e=(e=n.length||-1!=c.indexOf("Calls")?e:e.replace("Calls","")).replace(",,",","),e=(e=s.length||-1!=c.indexOf("Events")?e:e.replace("Events","")).replace(",,",","),e=(e=o.length||-1!=c.indexOf("Contacts")?e:e.replace("Contacts","")).replace(",,",","),e=(e=(e=(e=i.length||-1!=c.indexOf("Potentials")?e:e.replace("Potentials","")).replace(",,",",")).endsWith(",")?e.slice(0,-1):e).startsWith(",")?e.slice(1,e.length):e},showRelatedRecords:function(e,t,a){var r=a,n=$(event.currentTarget),s=$("#"+t+"AvailableRecords"+r),o=s.css("display"),i=$(".filterDropdownElement"),c=$("#"+e).offset();$("#topBandPopup").after(i),"none"==o?(i.css({left:c.left,top:c.top+34}),s.show(),n.addClass("focusEleField")):(s.hide(),n.removeClass("focusEleField"))},getChoosenRelatedRecords:function(e,t,a){var r="";null==a&&(a="");var n=a,s=t;null==s&&(s="");var o=$("#"+s+"Contacts"+n),i=$("#"+s+"Potentials"+n),c=$("#"+s+"Tasks"+n),l=$("#"+s+"Calls"+n),d=$("#"+s+"Events"+n);return"Tasks"!=e&&c.length>0&&"none"!=c.css("display")&&(r+="Tasks,"),"Calls"!=e&&l.length>0&&"none"!=l.css("display")&&(r+="Calls,"),"Events"!=e&&d.length>0&&"none"!=d.css("display")&&(r+="Events,"),"Accounts"==e&&o.length&&"none"!=o.css("display")&&(r+="Contacts,"),"Accounts"!=e&&"Contacts"!=e||!i.length||"none"==i.css("display")||(r+="Potentials,"),r=r.endsWith(",")?r.slice(0,-1):r},constructFieldValueJson:function(e,t,a,r){var n={};return n.ownerId=e,n.notify=t,n.relatedRecords=a,r&&(n.applyRestriction=r),n},handleChangeOwnerFromEntityView:function(e,t,a,r,n,s,o,i){commonUtils.showHideLoadingDiv(!0);var c,l="true"===$("#iskanbanview").val(),d="&pfrom=entityview";if("none"==$("#detailPrevious").display&&"none"==$("#detailNext").display||(d+="&navig=true"),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var m=store.peekRecord(moduleRecordMapping[n].id,s);c=Crm.getCrmBasePath()+"/ChangeOwnership.do?target=viewentity&id="+s+"&module="+n+"&name="+encodeURIComponent(m.Full_Name)+"&SalesManId="+e+d+"&cvid=null&recordNum=null&relatedRecords="+a+"&notify="+r+"&featureId=5&isZiaSuggestedUser="+i}else c=Crm.getCrmBasePath()+"/ChangeOwnership.do?target=viewentity&id="+s+"&module="+n+"&name="+encodeURIComponent($("#entityName").val())+"&SalesManId="+e+d+"&cvid="+document.viewentityform.cvid.value+"&recordNum="+document.viewentityform.recordNum.value+"&relatedRecords="+a+"&notify="+r+"&featureId=5&isZiaSuggestedUser="+i;"Tasks"===n&&$("#rightPanel").length&&(c+="&fromTaskDetailView=true"),void 0!==o&&(c+="&folAjaxValue="+encodeURIComponent(JSON.stringify(o))),(new crmRequestPool).initiate({action:c,type:"POST",data:$("#token").serialize(),success:function(r){if("crm.tab.module.entity.canvas"!==Lyte.Router.getRouteInstance().transition.info.route){if(null!=document.viewentityform&&crmTab.deleteFromCache(document.viewentityform.module.value),a){var o={};o.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),crmSchedulerNotification.addOrUpdateStatus(o,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}var i={};"canvas"!==Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(n)&&moduleRecordMapping.LockingInformation&&detailView.recordLockingDetails&&detailView.recordLockingDetails.lockingConfigJSON&&detailView.recordLockingDetails.lockingConfigJSON.length&&(i.records=store.findRecord(moduleRecordMapping[n].id,s,{approved:"both",converted:"both",formatted_currency:!0}),i.lockedRecord=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/"+moduleRecordMapping[n].api_name+"/"+s+"/Locking_Information__s",method:"GET"}),detailView.recordLockingDetails.lockingInfoFields||(i.lockingInfoFields=store.findAll("field",{module:moduleRecordMapping.LockingInformation.api_name},void 0,!0,{apiVersion:"2.2"})));var c=Lyte.Router.getRouteInstance().transition.lyteHeaderSupported;c&&(i.detailview_buttons=store.triggerAction("entity","available_actions",{module:moduleRecordMapping[n].api_name,entityId:s}).then((function(e){return e}),(function(e){murphy.error(e)})),i.record=store.findRecord(moduleRecordMapping[n].id,s,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0})),CScriptLib&&detailView.invokeClientScript(),Lyte.resolvePromises(i).then((function(a){detailView.recordLockingDetails&&(detailView.recordLockingDetails.lockedRecordDetails=a.lockedRecord?a.lockedRecord.data:void 0,a.lockingInfoFields&&(detailView.recordLockingDetails.lockingInfoFields=a.lockingInfoFields)),c&&(detailView.lyte_headerDataHolder.detailview_buttons=a.detailview_buttons),changeOwner.reloadAfterChangeOwner(r,e,t,n,s,l)}),(function(a){murphy.error(a),changeOwner.reloadAfterChangeOwner(r,e,t,n,s,l)})),commonUtils.showHideLoadingDiv()}else Lyte.Router.getRouteInstance().refresh()},error:function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}})},setownervalues:function(e){changeOwner.enableNotifyChkbx();var t=$("#FreezeLayer");if(""!=val&&""!=id&&""!=actualVal){var a=$("input[name="+fldName+"]"),r=$("input[name="+fldId+"]");if(fldName.indexOf("searchtext")>-1)a.val(actualVal);else if(fldName.indexOf("searchusercv")>-1||fldName.indexOf("searchuser")>-1)if("is"!=condition&&"isnt"!=condition){var n=$("temp_"+fldName);a.value=id,","==actualVal[actualVal.length-1]?n.val(actualVal.substring(0,actualVal.length-1)):n.val(actualVal)}else{n=$("temp_"+fldName);a.val(id),n.val(val)}else if(fldName.indexOf("searchuser")>-1){n=$("temp_"+fldName);a.val(id),n.val(val)}else fldName.indexOf("changeOwner")>-1?Territory.changeManager(id,actualVal,fldName):fldName.indexOf("changeFCManager")>-1?Territory.changeFcOwner(id,actualVal,fldName):"callOwnerName"==fldName?(t.show(),t.css("zIndex","19"),$("#updateCallStatusDiv").css("zIndex","25"),a.val(val)):a.val(val);r&&("true"==e?$(a).data("id",id):r.val(id))}},reloadAfterChangeOwner:function(e,t,a,r,n,s){if("SUCCESS"===e&&"Tasks"===r)return updateTaskOwner(t,a,s),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(r))&&Crm.downloadLayoutRules(Crm.getCrmBasePath()+"/ShowEntityInfo.do",{module:r,id:n,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)})),!1;if("Calls"===r&&isNewCallView)reloadCurrentEntityView(detailView.entityId,detailView.currentModule);else{$("#show").html(e),init(void 0,void 0,void 0,Lyte.Router.getRouteInstance().transition.lyteHeaderSupported),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(r))&&Crm.downloadLayoutRules(Crm.getCrmBasePath()+"/ShowEntityInfo.do",{module:r,id:n,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)}));var o=$("#recordNum"),i=o.length?parseInt(o.val()):"";i&&crmNavig.setNavigButtonState(i)}},doMassUpdateOwner:function(e,t,a,r){var n;if(n=isWFSchedulerUser()?r.splice(0,r.length):r.splice(0,crmConstants.maxRecOperCnt),a.id=n.join(";"),1===r.length&&""===r[0]||r.length<=0){a.lastPage="false";var s=crmListView.getObject();if(s.criteriaSearch&&1==s.criteriaSearch){var o=[];a.rowCount=Search.rowcnt;for(var i=1;i<=Search.rowcnt;i++){var c={text:s["searchfield"+i],type:s["searchfieldtype"+i],match:s["match"+i]};a["searchfield"+i]=s["searchfield"+i],1!=i&&(a["match"+i]=s["match"+i]),a["searchfieldtype"+i]=s["searchfieldtype"+i];var l=s["searchfieldtype"+i];"U"==l?(c={ptn:s["usercondition"+i],value:s["searchuser"+i]},a["searchuser"+i]=s["searchuser"+i],a["usercondition"+i]=s["usercondition"+i],Search.formUserConditionValues(c,i,"temp_value",c.value),a["temp_searchuser"+i]=c.temp_value):"T"==l?(c.ptn=a["textcondition"+i]=s["textcondition"+i],c.value=a["searchtext"+i]=s["searchtext"+i]):"picklist"==l?(c.value=a["searchpicklist"+i]=s["searchpicklist"+i],c.ptn=a["textpicklistcondition"+i]=s["textpicklistcondition"+i]):"N"==l?(c.value=a["searchnum"+i]=s["searchnum"+i],c.ptn=a["numcondition"+i]=s["numcondition"+i]):"B"==l?(c.value=a["searchboolean"+i]=s["searchboolean"+i],c.ptn=a["booleancondition"+i]=s["booleancondition"+i]):"CML"==l?(c.value=dataOb["searchcampcv"+i]=s["searchcampcv"+i],c.ptn=a["campcvcondition"+i]=s["campcvcondition"+i],c.temp_value=a["temp_searchcampcv"+i]=s["temp_searchcampcv"+i]):"D"==l?(c.ptn=a["datecondition"+i]=s["datecondition"+i],s["datecondition"+i]==Search.ageCrt||s["datecondition"+i]==Search.dueCrt?(c.ageindayscondition=a["ageindayscondition"+i]=s["ageindayscondition"+i],c.ageindays=a["ageindays"+i]=s["ageindays"+i]):(c.value=a["searchdate"+i]=s["searchdate"+i],c.edate=a["searchedate"+i]=s["searchedate"+i])):"DT"==l?(c.ptn=a["datetimecondition"+i]=s["datetimecondition"+i],s["datetimecondition"+i]==Search.ageCrt||s["datecondition"+i]==Search.dueCrt?(c.ageindayscondition=a["ageindayscondition"+i]=s["ageindayscondition"+i],c.ageindays=a["ageindays"+i]=s["ageindays"+i]):(c.value=a["searchdatedate"+i]=s["searchdatedate"+i],c.sthour=a["searchsthour"+i]=s["searchsthour"+i],c.stminute=a["searchstminute"+i]=s["searchstminute"+i],c.stampm=a["searchstampm"+i]=s["searchstampm"+i],c.enddate=a["searchenddate"+i]=s["searchenddate"+i],c.ethout=a["searchethour"+i]=s["searchethour"+i],c.etminute=a["searchetminute"+i]=s["searchetminute"+i],c.stime=a["searchstime"+i]=s["searchstime"+i],c.etime=a["searchetime"+i]=s["searchetime"+i],c.etampm=a["searchetampm"+i]=s["searchetampm"+i])):"territory"==l&&(c.ptn=a["territorycondition"+i]=s["territorycondition"+i],c.value=a["searchterritory"+i]=s["searchterritory"+i]),o.push(c)}a.patternVal=s.patternVal,a.criteriaSearch=!0,o.push(s.patternVal)}if("All"!=s.searchletter&&(a.searchletter=s.searchletter),s.filters||s.cross_filters){var d=Lyte.Router.getRouteInstance().routeName;"list"!=d&&"canvas"!=d&&"kanban"!=d||(a.isNewFilter=!0),s.filters&&(a.filters=JSON.stringify(s.filters)),s.cross_filters&&(a.cross_filters=JSON.stringify(s.cross_filters))}}var m=a;(new crmRequestPool).initiate({action:t,type:"POST",data:m,dataType:"json",success:function(n){var s=crmListView.getObject().doMassActioninScheduler,o=crmListView.getObject().totalCount;if(a.relatedRecords&&(!1===s||"false"===s)||(!0===s||"true"===s)&&o<500){var i={};i.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),crmSchedulerNotification.addOrUpdateStatus(i,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}if(1===r.length&&""===r[0]||r.length<=0){if(n.body&&0!=n.body.length){for(var c=[],l=n.fromIndex-1,d=0;l<=n.toIndex;l++,d++)n.body[d]?c[l]=n.body[d]:c[l]=null;n.body=c}var u=crmTab.getFromCache(e);if(1==n.isWfTriggered&&1==n.approvalProcessTriggered){var h=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")])+" & "+I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]);return void showTransferRelatedRulesAlert(h)}if(1==n.isWfTriggered){h=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")]);return void showTransferRelatedRulesAlert(h)}if(1==n.approvalProcessTriggered){h=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]);return void showTransferRelatedRulesAlert(h)}if(0==n.isWfTriggered)commonUtils.showHideLoadingDiv(),renderingUtils.removeFreezeLayer();else{if(1==n.isScheduledMassOperation||"true"==n.isScheduledMassOperation){if(hideAnimatePopup("massActionWorkFlowPopUp"),hideAnimatePopup("topBandPopup"),renderingUtils.removeFreezeLayer(),renderingUtils.hideFreezeLayer(),$("#freezeBackGround").css({opacity:"0.0",background:"var(--bg_white)",zIndex:"26"}),"listview"!=m.from&&(crmListView.checkAll(),showHideListViewBtnFn(),crmListView.selectAllEntity("",$("#selectAllEntity"))),0==n.isValidInterval)return;if(1==n.success){var g=I18n.getMsg("crm.mass.actions.mass.transfer.job");g=n.isQueued?g+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"):g+" "+I18n.getMsg("crm.mass.actions.scheduled.success"),crmui.showMsgBand("success",g,4e3,"");var p=$("#selectAllRecords");p.length>0&&(p.hide(),customViewObject.showSelectAll=!1,customViewObject.moreActions.push("hideSelectAllRecords")),crmListView.setHideActionInModule()}else if(1==n.jobRunningForCvid)crmui.showMsgBand("info",I18n.getMsg("crm.mass.actions.cv.running"),4e3,"");else{var f=I18n.getMsg("crm.mass.actions.transfer"),v=I18n.getMsg("crm.mass.actions.scheduled.fail",[f]);crmui.showMsgBand("error",v,18e4,"")}return}if("false"==n.error||"listview"==m.from){if(isWFSchedulerUser()&&!s&&n.isWFScheduler){var w=m.id.split(";").length,O=n.wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(O);var C=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(w);return commonUtils.showHideLoadingDiv(!0),void setTimeout((function(){var e=$("#changeOwnerForm");e.length>0&&automationActionsNotificationScheduler.showNotificationInProgress(O,e)}),C)}1==u.isStageView?u.stageBoardDetails=n.stageBoardDetails:u.body=n.body,"listview"!=m.from&&(u.fromIndex=n.fromIndex,u.toIndex=n.toIndex,u.selectedIds=[]),customViewObject.isCustomizedView?crmListView.reloadCurrentListView():1==u.isStageView?($("#lv_stageview").html(Handlebars.templates.stageView(u)),crmListView.loadStageSummary(),crmListView.afterRenderStageView(u)):"listview"!=m.from?n.body&&0!=n.body.length?($(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(u)),$("#lvTred").html(Handlebars.templates.body(u)),renderingUtils.tableSorter("listViewTable","2","")):($("#listViewTable").trigger("destroy"),$("#lvTred").html(""),$(Handlebars.templates.noRecordsFound(u)).insertAfter("#lvTred"),renderingUtils.tableSorter("listViewTable","0","")):crmListView.reloadCurrentListView(),"listview"!=m.from&&(1!=u.isStageView&&(crmListView.getNavigationDiv(u),crmListView.checkAll()),showHideListViewBtnFn())}else u=n,crmListView.createTemplate(n)}if(crmHistory.getCurrentStateData().fromIndex&&crmHistory.getCurrentStateData().fromIndex!=n.fromIndex){var y=Lyte.Router.getRouteInstance(),k=y.getQueryParams();Lyte.Router.transitionTo({route:y.transition.info.route,dynamicParams:y.transition.info.dynamicParams,queryParams:k})}if("listview"!=m.from){crmTab.putInCache(e,u),crmTab.updateTabContent(e);var R=$("#checkAll");R.attr("class","customCheckBoxChecked")&&R.attr("class","customCheckBox"),setDataFetchDate()}hideAnimatePopup("topBandPopup",!0),renderingUtils.removeFreezeLayer();o=0;if(s&&(o=crmListView.getObject().totalCount),!s||s&&o<Crm.massOperationUserThreadLimit){s&&overLayForSelectAllClick(!1);var I=$("#bulkUpdateSuccess");setCenter(I[0]),crmui.showMsgBand("success",I18n.getMsg("crm.massupdate.updatedsuccesfully"),"4000","")}}else changeOwner.doMassUpdateOwner(e,t,m,r);crmListView.startIndex={}},error:function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}})},handleChangeOwnerFromApprovalWeb:function(e){var t="",a=document.forms.namedItem("approvalForm"),r=a.elements.idlist.value,n=a.elements.startIndex.value,s=a.elements.endIndex.value,o=a.elements.approvalModule.value,i=document.forms.namedItem("approvalForm1"),c=i.elements.actionName.value,l=i.elements.showDuplicates.value;return l||(l=0),t=Crm.getCrmBasePath()+"/ConfirmApproval.do?idlist="+r+"&startIndex="+n+"&endIndex="+s+"&assignOwner="+e+"&approvalModule="+o+"&isfromApproval=yes","Contacts"==o?t=Crm.getCrmBasePath()+"/ConfirmContactApproval.do?idlist="+r+"&startIndex="+n+"&endIndex="+s+"&assignOwner="+e+"&approvalModule="+o+"&isfromApproval=yes":"Cases"==o?t=Crm.getCrmBasePath()+"/ConfirmCaseApproval.do?idlist="+r+"&startIndex="+n+"&endIndex="+s+"&assignOwner="+e+"&approvalModule="+o+"&isfromApproval=yes":-1!=o.indexOf("CustomModule")&&(t=Crm.getCrmBasePath()+"/WebRecordConfirmApproval.do?idlist="+r+"&startIndex="+n+"&endIndex="+s+"&assignOwner="+e+"&approvalModule="+o+"&isfromApproval=yes"),t=t+"&actionName="+c+"&showDuplicates="+l,document.deleteForm.action=t,document.deleteForm.method="post",doAjaxUpdateForm("show",document.deleteForm),closeownernamedialog(),!1}};