Lyte.Router.registerRoute("crm.global-search",{oldSearch:!0,recordsCount:0,modulesCount:0,didTransitionCalled:!1,queryParams:["searchword","modules","criteria","isRelevance","refineCriteria","filter_by","isReload","sModules","userOption","filteredModules"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-list-view.js","crm-services-appointments.js","crm-global-search.js","crux-smart-filter.js","crux-smart-filter-input.js","crux-criteria-conditions.js","crux-column-list.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("globalsearch")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["crux-column-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(e){if(Crm.userDetails.isNewGlobalSearch&&(this.oldSearch=!1),this.oldSearch){var t={ajaxSearch:"true",searchword:(r=this.getQueryParams()).searchword,searchCategory:"AllEntities",newModel:!0};return r.sModules?t.sModules=r.sModules:t.sModules="AllEntities",r.userOption&&(t.userOption=r.userOption),this.transition.data.selectedmodule?t.selectedmodule=this.transition.data.selectedmodule:t.selectedmodule="Home",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GSearch.do","POST",{params:t})}this.transition.data.refresh=!1;var r,s=this.transition.data,i=(r=this.getQueryParams()).searchword,a=(e={},r.modules);a||(r.modules="AllModules",a="AllModules");var n,o=r.filter_by;if(o?e.filter_by=o:e.modules=a,r.criteria&&(e.criteria=r.criteria),void 0===e.page&&(e.page=1),i&&(e.searchword=i),void 0===s.filteredModules&&(s.filteredModules=r.filteredModules?r.filteredModules:[]),s.filteredModules.length>0)for(var c of s.filteredModules)void 0===n?n=c.api_name:n+=","+c.api_name;return void 0!==n&&(e.modules=n),e.isRelevance=r.isRelevance,r.refineCriteria&&("object"==typeof r.refineCriteria?e.refineCriteria=JSON.stringify(r.refineCriteria):e.refineCriteria=r.refineCriteria),e.per_page=10,e.apply_fields="search_layout_fields",commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises(store.findAll("global-search",e,!1,!1)).then((function(e){return commonUtils.showHideLoadingDiv(!1),$L(".s_moduleSearchList").scrollTo(0,0),e.data&&0===e.data.length?{meta:{meta:void 0}}:e}),(function(){return $L(".s_moduleSearchList").scrollTo(0,0),commonUtils.showHideLoadingDiv(!1),{meta:{meta:void 0}}}))},redirect:function(){var e=this.transition.data;e.refresh&&(e.refresh=!1,this.refresh().data=e)},didDestroy:function(){if(Crm.userDetails.isNewGlobalSearch)$L("#mainMenuTabDiv").show();else if(featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu").component;e.isLoadedInCrmPlusBundle()||(e.getData("resetGlobalSearch")?e.actions.showSearchInput(!0):e.setData("isGlobalSearch",!1))}},afterModel:function(){if(!this.oldSearch){var e=this.getDataFromModuleRecordMapping().sysRefNameVsModuleDetailsMap,t=this.getQueryParams(),r=t.searchword,s=t.modules;this.currentModel.searchword=r;for(var i={},a={},n=crmConstants.moduleDisplayField,o=this.currentModel.data,c={},l=void 0!==(a=this.currentModel.meta.field_details)?a.length:0,d=0;d<l;){var u=a[d].module.api_name;e.hasOwnProperty(u)?d++:(Lyte.arrayUtils(this.currentModel.meta.field_details,"removeAt",d,1),l--)}void 0!==a&&a.filter((function(t){t.show=!1;var r=t.module.api_name;e.hasOwnProperty(r)&&(c[e[r].module_name]=t.fields)}));var m=this.currentModel.meta.info?this.currentModel.meta.info.total_count:0,p=m>500;if(0!==m){var h={};this.currentModel.meta.info.records_count.filter((function(e){var t={};t.total_records_count=e.total_records_count,t.count=e.count>=10?10:e.count,t.more_records=e.count>10,t.page=1,t.module=e.module,t.per_page=10,t.startIndex=0,h[e.module.api_name]=t}));var f={},g=[];for(key in h){var y=h[key],v={};v.module=y.module,v.more_records=y.more_records;var _={};_=y,v.count=_.total_records_count,g.push(v),_.startIndex=0,f[y.module.api_name]=_}f.total_count=m,f.records_count=g,this.currentModel.meta.info=f}var C={};for(var s in c){var R=moduleRecordMapping[s];if(c.hasOwnProperty(s)){for(var b=o.length,w=0;w<b;w++){var M=moduleApiMapping[s];((y=o[w]).module===M||y.$setype===M||"AllModules"!==t.modules&&!t.modules.includes(","))&&("Notes"===M&&(o[w].Note_Content=this.formatNotesContent(o[w].Note_Content)),o[w].hasOwnProperty("Territories")&&null!==o[w].Territories&&(o[w].Territories=o[w].Territories.map((e=>e.Name)).join(", ")),i[s]||(C[s]=[],i[s]=[]),o[w].cxPropClass="cgsRfTableRow",C[s].push(o[w]),i[s].length<10&&i[s].push(o[w]))}var D=c[s],P=D.length;for(d=0;d<P;d++){var L=D[d];delete L.yieldName,"currency"!==L.data_type&&116!==L.ui_type&&117!==L.ui_type||(L.cxPropClass="alignRight",delete L.decimal_place),116===L.ui_type&&L.formula.dynamic&&(c[s].removeElement(L),d--,P--),"Full_Name"!==L.api_name||"Contacts"!==R.module_name&&"Leads"!==R.module_name||(L.field_label=I18n.getMsg("custommodule.crmfield.fl.name",R.singular_label)),("Appointments"===s&&"Appointment_For"===L.api_name||"Connected_To__s"===L.api_name||"Notes"===s&&("Note_Content"===L.api_name||"Note_Title"===L.api_name)||"lookup"===L.data_type||(R.module_name.indexOf("CustomModule")>-1||R.module_name.indexOf("LinkingModule")>-1)&&"Name"===L.api_name||n[s]&&n[s].indexOf(L.api_name)>-1)&&(L.yieldName="lookup")}}}this.currentModel.values=i;var k={};for(var y in C)if(C.hasOwnProperty(y)){var I=C[y],U=[];this.moduleCacheFormation(U,I),k[y]=U}g=0;var E=0;const q={};for(let e of Object.keys(k))q[e]=0,k[e].length>20&&(k[e]=k[e].splice(0,20));if(crmNavig.NAVIGCACHEOBJ.globalSearch={data:k,dropCount:q},this.currentModel.fieldTypeMapping=crmConstants.defaultUiTypeToCruxMapping,void 0!==this.currentModel.meta.field_details){var A=0,j=(l=this.currentModel.meta.field_details.length,$L("crm-global-search-refine")[0]);for(d=0;d<l;d++){var T=this.currentModel.meta.info[this.currentModel.meta.field_details[d].module.api_name];g+=T.count,A+=T.total_records_count,g<=20&&E<4?(E++,this.currentModel.meta.field_details[d].show=!0):void 0!==j&&j.setData("isScrollResultToFetch",!0),store.modelFor(this.currentModel.meta.field_details[d].module.api_name+"_global")||store.registerModel(this.currentModel.meta.field_details[d].module.api_name+"_global",{});for(var F=this.currentModel.meta.field_details[d].fields.length,S=0;S<F;S++)store.addField(this.currentModel.meta.field_details[d].module.api_name+"_global",this.currentModel.meta.field_details[d].fields[S].api_name,Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(this.currentModel.meta.field_details[d].fields[S])));var x=this.currentModel.values[this.currentModel.meta.field_details[d].module.api_name];if(void 0!==x)this.currentModel.values[this.currentModel.meta.field_details[d].module.api_name]=store.pushPayload(this.currentModel.meta.field_details[d].module.api_name+"_global",x);else{var N=void 0!==e[this.currentModel.meta.field_details[d].module.api_name]?e[this.currentModel.meta.field_details[d].module.api_name].module_name:void 0;void 0!==N&&(this.currentModel.values[N]=store.pushPayload(this.currentModel.meta.field_details[d].module.api_name+"_global",this.currentModel.values[N]))}}this.recordsCount=g,this.modulesCount=E;var O=this.currentModel.meta.has_more_records;if(j)if(j=j.component,O)j.setData("isScrollResultToFetch",!0),j.setData("retryMech",!0);else if(p&&(j.setData("currentTotalCount",A),j.data.meta.info=f,m===A?(j.setData("currentTotalCount",0),j.setData("isScrollResultToFetch",!1)):(j.setData("isScrollResultToFetch",!0),j.executeMethod("scrollingNextRecord",Lyte.Router.getRouteInstance().getQueryParams())),m>500&&A!==m)){for(d=E;d<l;d++)Lyte.objectUtils(this.currentModel.meta.field_details[d],"add","show","true"),E++;this.modulesCount=E,j.executeMethod("getRecords",Lyte.Router.getRouteInstance().getQueryParams())}}}},renderTemplate:function(e,t){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",I18n.getMsg(["crm.title.global.search.results",Crm.partnerName]))),this.oldSearch){var r=document.querySelector("crm-left-menu");return featuresAvailable.NEXTGENUI_ENABLED&&r&&r.component&&!r.component.isLoadedInCrmPlusBundle()&&(r.component.setData("isGlobalSearch",!0),r.component.setData("isAutoSuggestSearch",!1)),{outlet:featuresAvailable.NEXTGENUI_ENABLED&&r&&r.component&&!r.component.isLoadedInCrmPlusBundle()?".gSearchContainerNew":"#gsearchContainer",html:e}}$L("#mainMenuTabDiv").hide(),e.appliedTags=[],this.transition.data.appliedTags&&(e.appliedTags=this.transition.data.appliedTags),t.queryParams.module&&(e.selectedModule=t.queryParams.module);var s=$L("crm-global-search-input")[0];return void 0!==s&&void 0!==s.component&&s.component.setData("isPrimarySearch",!1),{outlet:"#show",component:"crm-global-search-refine"}},afterRender:function(e,t){if($("#gsearchparentdiv").addClass("searchOverlayAct fullSearchBg").css("display","block").show(),this.oldSearch){"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&"undefined"!=typeof CrmPlusLib&&($L("#newgsearchouterdiv").hide(),$L(".adSearchClose").hide(),$L(".primarySearchList").hide(),this.didTransitionCalled&&!this.methods.isTransitionToSearch(app.prevTransition)||(CrmPlusImpl.trigger("searchView.onafterload"),this.didTransitionCalled=!0));var r=$L("#searchStr"),s=r.val();if(r.val(s+" "),r.val(s),r.focus(),featuresAvailable.NEXTGENUI_ENABLED){var i=document.querySelector("crm-left-menu");if(i&&i.component&&!i.component.isLoadedInCrmPlusBundle())renderingUtils.freezeBackground(),$L("#FreezeLayer").attr("onclick","closeGlobalSearch();")}}else{var a=$L("crm-global-search-refine")[0].component;if(this.currentModel.meta.has_more_records)a.setData("isScrollResultToFetch",!0),a.setData("retryMech",!0),a.executeMethod("getRecords",Lyte.Router.getRouteInstance().getQueryParams());else{var n=this.currentModel.meta.info?this.currentModel.meta.info.total_count:0;if(n<500&&0!==n){var o=$L(".s_moduleSearchList")[0];if(o.scrollHeight===o.offsetHeight)for(var c=this.currentModel.meta.field_details,l=c.length,d=this.modulesCount;d<l;d++){var u=this.currentModel.meta.info[c[d].module.api_name];this.recordsCount+=u.count,Lyte.objectUtils(c[d],"add","show","true"),this.modulesCount+=1}}}a.setData("recordsCount",this.recordsCount),a.setData("modulesCount",this.modulesCount)}},actions:{onBeforeLoad:function(){"reload"!==Lyte.Router.history.fromHistory&&"forward"!==Lyte.Router.history.fromHistory||(this.transition.data=Object.assign(this.transition.data,{criteria:this.getQueryParams().criteria,refineCriteria:this.getQueryParams().refineCriteria,appliedTags:[],pendingTags:[],isTagsEnabled:!1,filteredModules:[],isReload:!0})),"undefined"!=typeof CrmPlusImpl&&this.methods.isTransitionToSearch(app.prevTransition)&&CrmPlusImpl.trigger("searchView.onbeforeload")},didTransition:function(){"undefined"==typeof CrmPlusImpl||this.didTransitionCalled&&!this.methods.isTransitionToSearch(app.prevTransition)||(CrmPlusImpl.trigger("searchView.onafterload"),this.didTransitionCalled=!0)},willTransition:function(e){"undefined"!=typeof CrmPlusImpl&&-1===e.target.indexOf("crm.global-search")&&CrmPlusImpl.trigger("searchView.onclose")}},methods:{isTransitionToSearch:function(e){return void 0===e||void 0===e.route||-1===e.route.indexOf("crm.global-search")}}},{mixins:["crm-global-search-mixin"]}),Lyte.Router.registerRoute("crm.crm-calendar",{queryParams:["type","idStr","userFetchCnt","isTailLoadCall","pageNo","obtaineddate","tdWidthParam","module","searchword","searchCategory","calViewType","openCalPref","isMobile"],getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["zohocrm_calendar_view.js","zohocrm_services.js","zohocrm_customView.js","zohocrm_changeOwner.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-user-eventtype.js","crm-event-picklist.js","lyte-colorpicker.js","businessHoursCommon.js","crm-detail-view-services.js","businessHoursmixin.js","services-businesshours.js","shift_hours_model.js","business_hours-model.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js","crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)),r=networkUtils.returnDependencyFiles(["crm-user-eventtype.css","crm-picklist-colorpicker.css","crmbusinesshourswrapper.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient);e=(e=(e=(e=e.concat(t.concat(r))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM));var s=networkUtils.getI18nJSUrl("serviceentitykeys");return e=e.concat(networkUtils.returnDependencyFiles([s],ResourceConstants.CRM))},model:function(e){returnJson=void 0;var t=Crm.getCrmBasePath()+"/events/CalendarView.do",r=e.queryParams,s=this.transition.data;for(var i in s)r[i]=s[i];r.module=e.queryParams.sModule||"Events";var a={params:r},n=this;return store.unloadAll("servapp_preferences"),networkUtils.lyteInitiateRequest(t,"POST",a).then((function(e){return e}),(function(e){return s&&0!=Object.keys(s).length?(Lyte.Router.transitionTo(app.prevTransition).info.preservePopup=!0,void(crmHistory.handleAjaxErrorLyte=!0)):(n.error=!0,e.responseText)}))},renderTemplate:function(e,t){return{outlet:"#show",html:e}},beforeExit:function(){try{$("#calendarBd").fullCalendar("destroy")}catch(e){}var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.actions.updateNavActiveClassForBottomMenu("leftPaneCalendar",!1)},afterRender:function(){if(this.error){var e=$L("crux-permission-denied-alert")[0];e&&e.getData("cxPropShow")&&comp.setData("cxPropShow",!1),hide("popupnew"),renderingUtils.removeFreezeLayer(),document.getElementById("popupnew").style.zIndex=30,this.error=!1}}}),Lyte.Router.registerRoute("crm.tab",{queryParams:["newSignUp"],getResources:function(){var e=networkUtils.returnDependencyFiles(["custom_button_model.js"],ResourceConstants.CRMClient);return crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),e},beforeModel:function(e){if(window.self!==window.top&&e&&e.queryParams&&e.queryParams.newSignUp&&(window.top.location=window.self.location),featuresAvailable.NEXTGENUI_ENABLED){var t=document.querySelector("crm-left-menu");t&&t.component&&t.setData("selectedMenu","modules")}},checkTeamspacePresence:function(e){if(featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED){e=e||this.transition;var t=$L("crm-left-menu-teamspace")[0];t&&((t=t.component)&&t.checkAndRenderNotifyAdmin()&&e.abort(),t.methods.visibleModulesAvailability(t)||(history.pushState(null,null,e.url),e.abort()))}},model:function(){if(app.refetchModulesMeta)return app.refetchModulesMeta=!1,store.findAll("module",{include:"territory"})},renderTemplate:function(){var e=$L("crm-left-menu")[0];(e=e?e.component:null)&&e.executeMethod("showModulesOnRouteTransition"),this.checkTeamspacePresence()},actions:{willTransition:function(e){e.target.startsWith("crm.tab")&&this.checkTeamspacePresence(e)},didTransition:function(){var e,t=!1,r=null,s=(r=document.querySelector("crm-left-menu-modules"),document.querySelector("crm-left-menu-requests"));if(featuresAvailable.NEXTGENUI_ENABLED){var i=document.querySelector("crm-left-menu").component;(o=Lyte.Router.getRouteInstance().transition.target).includes("crm.tab.newReports")||o.includes("crm.tab.reports")||o.includes("crm.tab.dashboards")||o.includes("crm.tab.newDashboards")||o.includes("crm.tab.requesters")||(r?i.executeMethod("hideContentLoader"):(i.actions.openSelectedMenu("modules",!1,!1),i.methods.showModules(),r=document.querySelector("crm-left-menu-modules"))),"crm.tab"===o&&i.methods.selectLastAccessedTab(i)}var a=document.querySelector("crm-tab");if(!Crm.isHeadless){var n="";if(a&&a.component.getData("selected")&&(n=a.component.getData("selected").module_name),-1!=this.transition.info.route.indexOf("crm.tab.module"))e=this.getRouteInstance("crm.tab.module").getDynamicParam();else if(-1!==this.transition.info.route.indexOf("crm.tab.requesters.module"))e=this.getRouteInstance("crm.tab.requesters.module").getDynamicParam();else{var o;(o=this.transition.info.route.split(".")[2])&&(e=o.charAt(0).toUpperCase()+o.slice(1))}if(("Zoho Books"==n||"Zoho Expense"==n||"Zoho Subscriptions"==n)&&e.indexOf("CustomModule")>-1&&(e=n,t=!0),"NewReports"===e&&(e=this.getRouteInstance("crm.tab.newReports.records")&&this.getRouteInstance("crm.tab.newReports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.newReports.records").getQueryParams().action?"Appointments":"Reports"),"Reports"===e&&this.getRouteInstance("crm.tab.reports.records")&&this.getRouteInstance("crm.tab.reports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.reports.records").getQueryParams().action&&(e="Appointments"),"Zohocpq"===e&&(e=moduleRecordMapping.ZohoCPQ.module_name),!featuresAvailable.NEXTGENUI_ENABLED&&("Quotes"===e||"SalesOrders"===e||"PurchaseOrders"===e||"Invoices"===e||"Products"===e||"Bundles"===e||"PriceBooks"===e)){var c=e;if(moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[e].parent_module===moduleRecordMapping.ZohoCPQ&&n!==moduleRecordMapping.ZohoCPQ.module_name){e=moduleRecordMapping.ZohoCPQ.module_name,(l={}).child_module=c,l.parent_module=e,murphy.addCustomTracking({name:"CPQ - Active Tab",message:JSON.stringify(l)})}else{var l;if(e=moduleRecordMapping.ZohoCPQ&&moduleRecordMapping.ZohoCPQ.module_name===n&&e!==n?moduleRecordMapping.ZohoCPQ.module_name:e,moduleRecordMapping.ZohoCPQ&&moduleRecordMapping.ZohoCPQ.module_name&&e===moduleRecordMapping.ZohoCPQ.module_name)(l={}).child_module=c,l.parent_module=e,murphy.addCustomTracking({name:"CPQ - Active Tab",message:JSON.stringify(l)});a&&moduleRecordMapping[e]&&!t&&a.setData("selected",moduleRecordMapping[e]),t=!0}}"OneFeeds"==e&&(e="Feeds"),"NewDashboards"===e&&(e="Dashboards"),"Google-adwords"===e&&(e="Google AdWords"),n==e||t||(a&&moduleRecordMapping[e]?a.setData("selected",moduleRecordMapping[e]):r&&r.component?moduleRecordMapping[e]?(r.component.setData("selectedModule",moduleRecordMapping[e]),r.component.setData("previouslySelectedModule",moduleRecordMapping[e].module_name),r.component.methods.addActiveClassForSelectedModule(r.component)):r.component.methods.addActiveClassForModule(r.component,e):s&&s.component&&moduleRecordMapping[e]&&s.component.setData("selectedModule",e),(e.includes("Orchestration")||e.includes("PathFinder"))&&(e="Orchestration"),featuresAvailable.NEXTGENUI_ENABLED||crmplusImplTriggerActions("selectEntity",["module",e])),Crm.isHeadless||featuresAvailable.NEXTGENUI_ENABLED||$("#mainMenuTabDiv").show()}}}}),Lyte.Router.registerRoute("crm.tab.approvals.index",{queryParams:["is_others_view","process_opt"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs.js","lyte-dateselect.js","lyte-daterangepicker.js","crm-vision-validation.js","crm-vision-match-utils.js","crm-vision-create.js","reviewprocess.js","lyte-selector.js","crm-vision-image-utils.js","crm-ziavision.js","crm-ui-loaders.js","crux-criteria-conditions.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-multi-selection-popup.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","kiosk-execute.js","crux-form-component.js"],ResourceConstants.CRMClient)},getDependencies:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs-model.js","crm-ziavision-myjobs.js","crm-image-mixin.js","crm-image-preview.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js"],ResourceConstants.CRMClient);t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_module_common.js"],ResourceConstants.CRM)),e=(e=(e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","crm-list-view-rtl.css","crm-reviewprocess-rtl.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css","crm-myjobs.css","crm-approval-myjobs-rtl.css","crm-approval-myjobs.css","crm-ziavision-myjobs.css","crm-ziavision-myjobs-rtl.css","crm-image-preview.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css","crm-myjobs.css","crm-approval-myjobs.css","crm-ziavision-myjobs.css","crm-image-preview.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css","custom-view-layer-new.css","crm-inner-list-new.css","crm-list-view-new.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-multi-selection-popup.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var r=t.concat(e).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("ziavision")],ResourceConstants.CRM));return r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiSelectPopup")],ResourceConstants.CRM))},model:function(e){var t,r=10;if(this.transition.data&&Object.keys(this.transition.data).length>0){var s=this.transition.data;s&&(s.process_count&&s.approval_count&&s.review_count&&s.imageValidation_count&&((t={}).review_process=s.review_count,t.approval=s.approval_count,t.process=s.process_count,s.imageValidation_count&&"undefined"!==s.imageValidation_count&&(t.image_validation=s.imageValidation_count),s.others_awaiting&&"undefined"!==s.others_awaiting&&(t.others_awaiting=s.others_awaiting)),r=s.recordPerPage?s.recordPerPage:r)}var i=e.queryParams;return t||(t=store.triggerAction("Approval","features_count",void 0,void 0,"GET",!1).then((function(e){for(var t=e.features_count,r=t.length,s={},i=0;i<r;i++)s[t[i].name]=t[i].count;return e.jobs_count=s,e.jobs_count.id||(e.jobs_count.id="123"),s})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code||"INVALID_MODULE"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))),i&&(i.process_opt||void 0!==i.is_others_view)&&"ReviewProcess"!==i.process_opt&&"ImageValidation"!==i.process_opt?Lyte.resolvePromises({jobs_count:t,is_others_view:i.is_others_view,process_opt:i.process_opt,recordPerPage:r}):Lyte.resolvePromises({status:i.status,recordPerPage:r,jobs_count:t})},renderTemplate:function(e,t){if(this.currentModel.jobs_count){var r=t.queryParams;return"ImageValidation"===r.process_opt&&(e.process_opt=r.process_opt),{outlet:"#show",component:"crm-myjobs"}}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.approvals.logs",{queryParams:["type"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs.js","crm-vision-create.js","lyte-dateselect.js","lyte-daterangepicker.js","reviewprocess.js"],ResourceConstants.CRMClient)},getDependencies:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs-model.js"],ResourceConstants.CRMClient);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient),t.concat(e).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")],ResourceConstants.CRM))},model:function(e){var t=e.queryParams;if(t&&"review"===t.type){var r=networkUtils.lyteInitiateRequest("/crm/v2/Approvals/history/meta","GET",{params:{type:"review"}}),s=store.findAll("review-log",{action:"All Actions",type:"review",per_page:20});return Lyte.resolvePromises({logData:s,metaData:r})}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Approvals",action:"approvallog"}})},afterModel:function(e,t){var r=t.queryParams;if(r&&"review"===r.type){var s=e.metaData.data.modules;s.unshift({display_label:I18n.getMsg("crm.label.AllModules"),name:"All Entity"}),e.modules=s;var i=e.metaData.data.users;i.unshift({name:I18n.getMsg("crm.api.allusers"),id:"All Users"}),e.users=i,e.actions=e.metaData.data.actions,e.logData=store.peekAll("review-log"),delete e.metaData,e.type="review"}},renderTemplate:function(e,t){var r=t.queryParams;return r&&"review"===r.type?{outlet:"#show",component:"crm-review-logs"}:{outlet:"#show",html:e}},actions:{willTransition:function(){auditLog.clearFliter()}}}),Lyte.Router.registerRoute("crm.tab.approvals.view",{queryParams:["recModule","entityId","triggerAction"],getResources:function(){return networkUtils.returnDependencyFiles(["crux-form-component.js"],ResourceConstants.CRMClient)},model:function(e){var t=this.transition.data;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",{params:{module:"Approvals",triggerAction:e.queryParams.triggerAction?e.queryParams.triggerAction:"",action:t.action?t.action:"showDetailedView",entityId:e.queryParams.entityId,isOthersView:!!t.isOthersView&&t.isOthersView,recModule:e.queryParams.recModule}})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.approvals",{getResources:function(){return networkUtils.returnDependencyFiles(["reviewprocess.js","automation_datahub_module.js","modal-scroll-box-shadow.js"],ResourceConstants.CRMClient)},redirect:function(){if("crm.tab.approvals"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.tab.approvals.index"}).data=e}}}),Lyte.Router.registerRoute("crm.tab.commandcenter.index-commandcenter",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-commandcenter-listview-iframe.js"],ResourceConstants.CRMClient)},beforeModel:function(){moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.plural_label&&(document.title=I18n.getMsg(moduleRecordMapping.Orchestration.plural_label)+" - Zoho CRM"),$L("#show").empty(),"P"!==Crm.userDetails.LICENSE_TYPE&&"R"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE&&"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE&&moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.cc_enabled||(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort())},renderTemplate:function(){return{component:"crm-commandcenter-listview-iframe",outlet:"#show"}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED&&0===$("#CCComponent").length){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams;$L("#show").addClass("w100_per pA");var t={iframestyle:"width: 100%; background: transparent; border: none; height: 100%;"};setTimeout((function(){CommandCenterLoader.loadRecordsDetailView(e[0],e[1],"ccListViewIframe",t);var r=document.querySelector("crm-tab"),s=document.querySelector("crm-left-menu-modules");r&&r.component.setSelectedFromDropdown("Orchestration"),s&&s.component.methods.addActiveClassForModule(null,"Orchestration")}),500),featuresAvailable.NEXTGENUI_ENABLED&&$("#show").parent().addClass("pR")}},beforeExit:function(){let e=$("#show");e.empty(),e.attr("style",""),e.removeClass("w100_per pA"),e.parent().removeClass("pR")}}),Lyte.Router.registerRoute("crm.tab.commandcenter.module.index-module",{renderTemplate:function(){return{component:"crm-commandcenter-listview-iframe",outlet:"#show"}}}),Lyte.Router.registerRoute("crm.tab.commandcenter.module.record",{renderTemplate:function(){return{component:"crm-commandcenter-listview-iframe",outlet:"#show"}}}),Lyte.Router.registerRoute("crm.tab.commandcenter.module",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-commandcenter-listview-iframe.js"],ResourceConstants.CRMClient)},beforeModel:function(){moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.plural_label&&(document.title=I18n.getMsg(moduleRecordMapping.Orchestration.plural_label)+" - Zoho CRM"),$L("#show").empty(),"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE&&moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.cc_enabled||(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort())},renderTemplate:function(){return{component:"crm-commandcenter-listview-iframe",outlet:"#show"}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED&&0===$("#CCComponent").length){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams;$L("#show").addClass("w100_per pA");var t={iframestyle:"width: 100%; background: transparent; border: none; height: 100%;"};setTimeout((function(){CommandCenterLoader.loadRecordsDetailView(e[0],e[1],"ccListViewIframe",t);var r=document.querySelector("crm-tab"),s=document.querySelector("crm-left-menu-modules");r&&r.component.setSelectedFromDropdown("Orchestration"),s&&s.component.methods.addActiveClassForModule(null,"Orchestration")}),500),featuresAvailable.NEXTGENUI_ENABLED&&$("#show").parent().addClass("pR")}},beforeExit:function(){let e=$("#show");e.empty(),e.attr("style",""),e.removeClass("w100_per pA"),e.parent().removeClass("pR")}}),Lyte.Router.registerRoute("crm.tab.commandcenter",{renderTemplate:function(){return{component:"crm-commandcenter-listview-iframe",outlet:"#show"}},beforeModel:function(){moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.plural_label&&(document.title=I18n.getMsg(moduleRecordMapping.Orchestration.plural_label)+" - Zoho CRM"),$L("#show").empty(),"P"!==Crm.userDetails.LICENSE_TYPE&&"R"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE&&"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE&&moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.cc_enabled||"crm.tab.commandcenter.commandcenter-re-authorize-services"===!this.transition.target&&(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort())}}),Lyte.Router.registerRoute("crm.tab.dashboards.dashboardId.records",{queryParams:["criteria","FROM_INDEX","summaryValue","summaryCol","sortCol","orderBy","drill_down","subComponentId"],beforeModel:function(){featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=this.getQueryParams();return(t=t||{}).dbItemId=this.getDynamicParam(),t.action="fetchRecords",t.reportId=1,t.criteria=e.queryParams.criteria,t.drill_down=e.queryParams.drill_down,t.FROM_INDEX=e.queryParams.FROM_INDEX,t.summaryValue=e.queryParams.summaryValue,t.summaryCol=e.queryParams.summaryCol,t.isAjax=this.isAjax,t.subComponentId=e.queryParams.subComponentId,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ReportsRelatedCV.do","GET",{params:t})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return this.isAjax?e.FAILURE?void renderingUtils.showCustomAlert(parsedData.FAILURE,void 0,!1):{outlet:"#CVTable",html:(0,Handlebars.templates.SummaryReport)(e)}:{outlet:"#show",html:e}},afterRender:function(e){if(this.isFromCall)return $("#reportsPagNation").html(""),void CrmDashboard.setCallsNavigationDiv(e);this.isAjax&&($("#reportsPagNation").html(""),CrmDashboard.setNavigationDiv(e.requestedObj))}}),Lyte.Router.registerRoute("crm.tab.dashboards.dashboardId",{}),Lyte.Router.registerRoute("crm.tab.dashboards.index",{queryParams:["is_component_suggestion_popup"],getDependencies:function(){if(void 0===store.modelFor("zia_component_suggestion"))return networkUtils.returnDependencyFiles(["zia-component-suggestion-model.js"],ResourceConstants.CRMClient)},getResources:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion")){var e=networkUtils.returnDependencyFiles(["zia-component-suggestions-component.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["analytics-zia-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaComponentSuggestions"),networkUtils.getI18nJSUrl("activitydepbanner")],ResourceConstants.CRM);return e.concat(t)}},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){if(this.transition.data||(this.transition.data={}),this.transition.data.ajaxLoad=!0,"crm.tab.dashboards.view"==this.transition.target)this.transition.data.ajaxLoad=!1;else if("crm.tab.dashboards.view.expand"!=this.transition.target)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Dashboards",isload:!0}})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e,t){if(e)return networkUtils.initChart(),{outlet:"#show",html:e}},actions:{willTransition:function(e){"0"==e.info.dynamicParams[0]&&e.abort()}},afterRender:function(){$("#dash_0").parent().addClass("sel");var e=$("#dashboardList");Territory.doHighLight("#dashboardList",e.find(".sel").eq(0),250,$(window).height()-280)},actions:{onError:function(e,t){if(commonUtils.showHideLoadingDiv(),t.abort(),555===e.status&&"Dashboard Not Available"===e.responseText){var r=I18n.getMsg("crm.dashboard.not.available");renderingUtils.showCustomAlert(r,void 0,!1),$("#custom_alert_button").bind("click",(function(){Lyte.Router.transitionTo({route:"crm.tab.dashboards.index"})}))}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.dashboards.view.expand",{queryParams:["isAnalyticsTrends"],model:function(e){var t={params:{action:"showDashboard",dbId:this.parent.getDynamicParam(),ajaxLoad:!0,isload:!0,window:"new",isAnalyticsTrends:e.queryParams.isAnalyticsTrends}};return t.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#show",html:e}},afterRender:function(){featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide()}}),Lyte.Router.registerRoute("crm.tab.dashboards.view",{queryParams:["from","popup"],getDependencies:function(){if(void 0===store.modelFor("zia_component_suggestion"))return networkUtils.returnDependencyFiles(["zia-component-suggestion-model.js"],ResourceConstants.CRMClient)},getResources:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion")){var e=networkUtils.returnDependencyFiles(["zia-component-suggestions-component.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["analytics-zia-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaComponentSuggestions")],ResourceConstants.CRM);return e=e.concat(t),"msteams"===this.getQueryParams().from&&(e=e.concat(networkUtils.returnDependencyFiles(wmsBarInfo.featureScript,ResourceConstants.CRM))),e}},beforeModel:function(){commonUtils.showHideLoadingDiv(!0),CrmDashboard.favoriteTimeout&&"crm.tab.dashboards.view.expand"!=this.transition.target&&CrmDashboard.setFavorites(void 0,void 0)},model:function(e){var t=this.getQueryParams().from;if("msteams"==t&&(CrmDashboard.fromMicrosoftTeams=!0),t&&"auditLog"===t&&(CrmDashboard.fromAuditLog=!0),this.transition.data&&"string"==typeof this.transition.data){var r=this.transition.data,s=$("#dashboardList");r=r.split("###");var i=CrmDashboard.dashboardListTemplate({DBID:r[0],DBNAME:r[1]});return $("#dbId").val(r[0]),$("#dbTitle").html(r[1]),$("#dashWithFav").find(".sel").removeClass("sel"),s.find("div").eq(0).append(i),$("#dashboardItems").height(0).find("#dashboardItemsSort").children().remove(),$("#dashboardItemCount").val(0),$("#emptyDashboard").css("display","").find('input[data-cid="addComponent"]').css("display",""),$("#emptyDbMsg").text(I18n.getMsg("crm.dashboard.nocomponent")),$("#addCompdiv").hide(),CrmDashboard.showDashboardSettings(),$("#show").html()}if("crm.tab.dashboards.view.expand"!=this.transition.target){var a={params:{action:"showDashboard",dbId:e.dynamicParam,isload:!0}};return this.transition.data&&this.transition.data.ajaxLoad&&(a.params.ajaxLoad=!0),a.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",a)}},afterModel:function(){commonUtils.showHideLoadingDiv(),CrmDashboard.hidePopup()},renderTemplate:function(e,t){if(t.queryParams&&"actpophide"===t.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}if(e)return this.transition.data&&this.transition.data.ajaxLoad?{outlet:"#showdbItems",html:e}:{outlet:"#show\t",html:e}},afterRender:function(e,t){if(e){var r=t.dynamicParam;$("#dash_"+r).parent().addClass("sel");var s=$("#dashboardList");Crm.isHeadless||Territory.doHighLight("#dashboardList",s.find(".sel").eq(0),250,$(window).height()-280)}},actions:{onError:function(e,t,r){if(r.queryParams&&"actpophide"===r.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}if("crm.tab.dashboards.view.expand"!==t.target&&CrmPlusImpl.trigger("serviceView.showError",["analytic_dashboard",{key:r.dynamicParam+"",errorType:"NO_ACCESS"}]),commonUtils.showHideLoadingDiv(),t.abort(),555===e.status&&"Dashboard Not Available"===e.responseText){var s=I18n.getMsg("crm.dashboard.not.available");renderingUtils.showCustomAlert(s,void 0,!1),$("#custom_alert_button").bind("click",(function(){Lyte.Router.transitionTo({route:"crm.tab.dashboards.index"})}))}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.dashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-analytics.js","lyte-progressbar.js","crux-form-component.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-ui-loaders.css","crm-ui-loaders.js","crm-analytics-anomaly-table.css","crm-analytics-strategy.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))},beforeModel:function(){featuresAvailable.NEXTGENUI_ENABLED&&(document.querySelector("crm-left-menu").component.setData("selectedMenu","dashboards"),document.querySelector("crm-left-menu-loader").component.setData("view","analytics"))},actions:{onError:function(){crmHistory.handleAjaxErrorLyte=!0},didTransition:function(){var e=Crm.userDetails.MODULE_LIST.Dashboards,t=e&&e.modified_by?e.plural_label:I18n.getMsg("Dashboards");Crm.isRebrandingEnabled?this.setTitle(t+" - "+Crm.productBrandName):this.setTitle(I18n.getMsg("crm.title.general.revamped",[t,Crm.partnerName]))}},beforeExit:function(){var e=$("#show");thirdPartyUtils.unbindChildSelect2(e),thirdPartyUtils.unbindHighcharts(e),thirdPartyUtils.unbindZohoCharts(e),store.unloadAll("zia_component_suggestion")}}),Lyte.Router.registerRoute("crm.tab.forecasts.create",{queryParams:["fcYear","fcQuarter","territoryId","roleId"],model:function(){var e=Crm.getCrmBasePath()+"/",t=this.getQueryParams();return 1===Crm.userDetails.TMENABLED||t.territoryId?e+="TerritoryForecast":e+="RoleForecast",t.roleId||t.territoryId?(e+=".do?action=setTarget&module=Forecasts&isload=true&fcYear="+t.fcYear+"&fcQuarter="+t.fcQuarter,t.roleId?e+="&roleId="+t.roleId:e+="&territoryId="+t.territoryId,networkUtils.lyteInitiateRequest(e)):networkUtils.lyteInitiateRequest(e+".do?action=createForecast&module=Forecasts&isload=true")},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts.editSettings",{model:function(){var e="RoleForecast";return 1==Crm.userDetails.TMENABLED&&(e="TerritoryForecast"),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/"+e+".do","GET",{params:{module:"Forecasts",action:"editForecastSettings"}})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts.index",{queryParams:["mode","fcYear","fcQuarter","roleId","territoryId","ownerId"],getResources:function(){var e=[networkUtils.returnDependencyFiles(["crm-forecast-onboarding.js","crux-video.js"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-forecast-onboarding.css"],ResourceConstants.CRMClient)];return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-onboarding-RTL.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ForecastOnboarding")],ResourceConstants.CRM))},model:function(){if(this.transition.data&&this.transition.data.cachedResponse)return this.transition.data.cachedResponse;var e=this.getQueryParams();if("viewAll"===e.mode||"viewChild"===e.mode||"viewUser"===e.mode){e.module="Forecasts",e.isload=!0;var t="RoleForecast";return(e.territoryId||1===Crm.userDetails.TMENABLED)&&(t="TerritoryForecast"),e.action="viewForecast",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/"+t+".do","GET",{params:e})}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Forecasts",isload:!0}})},renderTemplate:function(e){if("object"!=typeof e)return{outlet:"#show",html:e};loadForecastViewOrCreate(e)},actions:{onError:function(e){555===e.status&&(crmui.showMsgBand("info",I18n.getMsg("crm.forecast.enable.mail.sub"),4e3),Utils.windowLocationReload(!0))},didTransition:function(){store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.2/Forecasts/actions/get_migration_requirements",method:"GET"}).then((function(e){if(e.data.isOnboardingMessageShown)if(Lyte.Component.render("crm-forecast-onboarding-popup",e.data,"#fconboardingcontent"),e.data.failureNotification)$L("#failureMessage")[0].ltProp("show",!0),store.findAll("dummy",{failureNotificationShown:!0},!1,!1,{url:"crm/v2.2/Forecasts/actions/set_onboarding_status",method:"POST"});else if(e.data.migrationStatus&&("SCHEDULED"===e.data.migrationStatus||"STARTED"===e.data.migrationStatus)){var t=renderingUtils.tabLayerOuterHeight();$L("body").addClass("oH"),$L("#fcNewVertionMoveLoadingWrap").css("top",t).removeClass("dN").addClass("dF")}}))}}}),Lyte.Router.registerRoute("crm.tab.forecasts.pipeline",{queryParams:["ownerId","isParent","closed","others","roleId","territoryId","fcYear","fcQuarter","parModule","rangeValue"],model:function(){var e=this.getQueryParams();return e.actiontype="viewPipeline",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ViewPipeline.do","GET",{params:e})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts",{getResources:function(){if(Crm.userDetails.isUserHierarchy)return networkUtils.returnDependencyFiles(["zohocrm_forecastTemplate.js"],ResourceConstants.CRM)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){if("crm.tab.forecasts"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.tab.forecasts.index"}).data=e}},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-accounts",{queryParams:["startDate","endDate"],model:function(e){var t={action:"accDesc"};e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate);var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-metrics",{queryParams:["startDate","endDate"],model:function(e){var t={action:"reports",newModel:!0};return e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-offline",{queryParams:["startDate","endDate"],model:function(e){var t={action:"offline",dateFilter:0,newModel:!0};return e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-view",{queryParams:["accountId","campaignId","groupId","zgid","startDate","endDate"],model:function(e){var t={action:"accSummary"};return t.accId=e.queryParams.accountId,e.queryParams.campaignId&&(t.action="campSummary",t.campId=e.queryParams.campaignId),e.queryParams.groupId&&(t.action="groupSummary",t.gid=e.queryParams.groupId,t.zgid=e.queryParams.zgid),e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),t.newModel=!0,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords",{model:function(e){var t={module:"Google AdWords",isload:!0},r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",r)},renderTemplate:function(e,t){if(!validationUtils.isJson(e))return{outlet:"#show",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName)),validationUtils.isJson(e)?e.adword_enabled&&"crm.tab.google-adwords"===this.transition.target&&this.transitionTo("crm.tab.google-adwords.adword-accounts"):"crm.tab.google-adwords"!==this.transition.target&&this.transition.abort()}}),Lyte.Router.registerRoute("crm.tab.marketplace",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-marketplace-promo.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-marketplace-promo.css"],ResourceConstants.CRMClient);return e.concat(t)},redirect:function(){if("undefined"!=typeof crmTab&&!crmTab.isMarketPlacePromoTab){if("undefined"!=typeof Crm&&Crm.userDetails&&"Administrator"!==Crm.userDetails.PROFILE_NAME)return void renderingUtils.displayPermissionDenied();Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:["Home"]})}},renderTemplate:function(){return{outlet:"#show",component:"crm-marketplace-promo"}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.messages.begin",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-msg-begin"}}}),Lyte.Router.registerRoute("crm.tab.messages.custom-view",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-msg-list-view.js","crm-customview-dropdown.js","crm-custom-filter.js","crux-smart-filter.js","crm-customview-helpers.js","crux-criteria-conditions.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js","crux-form-component.js","crm-dataprivacy-mixins.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-msg-list-view.css","custom-view-layer.css","crm-customview-dropdown.css","crm-custom-filter.css"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],ResourceConstants.CRMClient)));var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmlistview")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){var e=moduleRecordMapping.Messages,t={saved_filters:app.store.makeRequest("findAll","filter",{module:e.api_name,cvid:this.getDynamicParam()},!0,void 0,{cvid:this.getDynamicParam(),module:e.api_name}),custom_view_Info:app.store.makeRequest("findRecord","custom_view",this.getDynamicParam()+"",{module:"messages__s"}),fields:app.store.makeRequest("findAll","field",{module:"messages__s"},!1,!0,{apiVersion:"2.2"})};return Lyte.resolvePromises(t).then((function(e){return e}))},afterModel:function(e){var t=crmTab.getFromCache("Messages");this.cachedObj=t||{};var r=moduleRecordMapping.Messages;if(e.custom_view_Info){var s=this.getDynamicParam(),i=store.peekRecord("custom_view",s);i.sort_by||e.fields.forEach((function(e){"message_time__s"===e.api_name&&(i.$.set("sort_by",{id:e.id}),i.$.set("sort_order","desc"),store.triggerAction("custom_view","change_sort",{sort_by:i.sort_by,sort_order:i.sort_order,module:r.api_name,id:s}))}))}var a="Messages";this.currentModel.module=a,this.currentModel.module_name=a,this.currentModel.module_info=r,this.currentModel.cvid=this.currentModel.selectedCustomViewId=this.getDynamicParam(),this.currentModel.saved_filters=this.currentModel.saved_filters?this.currentModel.saved_filters:[]},renderTemplate:function(e){var t={queryParams:this.getRouteInstance().queryParams};this.setDataBeforeRender(e,e.cvid,t),app.renderTemplate(this,{outlet:"#show",component:"crm-msg-index"})},afterRender:function(e){"crm.tab.messages.custom-view"===this.transition.target&&this.transitionTo("crm.tab.messages.custom-view.list",e.selectedCustomViewId)},actions:{onError:function(){crmHistory.transitionError=!1;var e=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),t=window.location.pathname.split(e)[1],r=this.replaceWith("crm.crm-error",t);return commonUtils.showHideLoadingDiv(!1),crmTab.reloadTabMenu(),r.data={showError:!0,module:"Messages",errorMsg:I18n.getMsg("module.not.available")},!1},onBeforeLoad:function(){_cruxUtils.removeCustomAlert()},willTransition:function(){_cruxUtils.removeCustomAlert()}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.messages.custom-view.list",{queryParams:["filters","sort_by","sort_order","page","per_page","filter_id","cross_filters"],model:function(){var e=this.parent.currentModel.selectedCustomViewId,t=store.peekRecord("custom_view",e),r=moduleRecordMapping.Messages,s={},i={},a=this.getQueryParams(),n=a.page&&a.page>=1?a.page:1,o=a.sort_by?a.sort_by:t.sort_by.id,c=a.sort_order?a.sort_order:t.sort_order,l=a.per_page;-1===[10,20,30,40,50,100,"10","20","30","40","50","100"].indexOf(l)&&(l=r.per_page),-1===["100",100].indexOf(l)||Crm.userDetails.ISPAID_USER||(l=50),s.page=i.page=n,s.per_page=i.per_page=l,s.sort_by=i.sort_by=o,s.sort_order=i.sort_order=c,s.cvid=i.selectedCustomViewId=e,s.module=i.module="Messages",a.filters&&(s.filters=i.filters=a.filters),a.cross_filters&&(s.cross_filters=i.cross_filters=a.cross_filters),a.filter_id&&(s.filter_id=i.filter_id=a.filter_id),this.transition.data.hasOwnProperty("fromNotification")&&(s.filters={group_operator:"AND",group:[{field:{api_name:"message_time__s",id:""},comparator:"less_equal",value:"${AGEINDAYS}+1"},{field:{api_name:"conversation_status__s",id:""},comparator:"not_equal",value:"Replied"}]}),i.start_index=0;var d=this.loadConversations(s,null,this.parent.currentModel.saved_filters),u=this;return Lyte.resolvePromises(d).then((function(t){if(t){var r=crmTab.getFromCache("Messages");r=r||{},i.conversations=t.messages,i.customview_records=t.messages,i.more_records=t.info.more_records,i.total_count=r.total_count?r.total_count:t.info.count,i.per_page=t.info.per_page,i.total_new_count=i.total_count||0===i.total_count?"###":i.total_count,u.constructNavigObject(e,i.conversations,"Messages",moduleRecordMapping.Messages.per_page)}return commonUtils.showHideLoadingDiv(!1),i}))},redirect:function(){crmHistory.transitionError&&this.handleError("Messages")},renderTemplate:function(e){var t=$L("#customFilter")[0].component.getFilterCriteria(),r=document.querySelector("crm-custom-filter");!t.queryParams&&(e.filters||e.filter_id||e.cross_filters)&&r.setData("filterQueryParams",{filter_id:e.filter_id,filters:e.filters,cross_filters:e.cross_filters}),r.component.getData("preventUserAction",!1),r.component.preventUserAction=!1,app.renderTemplate(this,{outlet:"#msgListViewContainer",component:"crm-msg-list-view"})},actions:{onError:function(e){return this.currentModel=e,this.handleError("Messages"),!1}}},{mixins:["crm-msg-common","crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.messages",{beforeModel:function(){if(moduleRecordMapping.Messages)commonUtils.showHideLoadingDiv(!0),this.setTitle(I18n.getMsg("crm.title.general.revamped",[moduleRecordMapping.Messages.plural_label,Crm.partnerName]));else{var e=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),t=window.location.pathname.split(e)[1];this.replaceWith("crm.crm-error",t).data={showError:!0,module:"Messages",errorMsg:I18n.getMsg("module.not.available")}}},model:function(){var e={message_module:store.findRecord("module",moduleRecordMapping.Messages.id)};return store.model[moduleRecordMapping.Messages.id]||store.registerModel(moduleRecordMapping.Messages.id,{},{extends:"entity"}),Lyte.resolvePromises(e).then((function(e){return e}))},actions:{didTransition:function(){var e=$L("crm-tab");e&&e.length>0&&(e[0].component.resizeMenu(),e.find(".lyteMenuActive").removeClass("lyteMenuActive"),e.find("[data-value*=Messages]").addClass("lyteMenuActive")),this.setTitle(I18n.getMsg("crm.title.general.revamped",[moduleRecordMapping.Messages.plural_label,Crm.partnerName]))}},redirect:function(){var e=moduleRecordMapping.Messages;if(e.visible&&e.viewable){if(this.transition.url.endsWith("Messages/")&&this.replaceWith("crm.tab.messages"),"crm.tab.messages"===this.transition.info.route){var t=crmTab.getFromCache("Messages");t&&(delete t.total_count,crmTab.putInCache("Messages",t)),this.replaceWith("crm.tab.messages.custom-view.list",moduleRecordMapping.Messages.cvid?moduleRecordMapping.Messages.cvid:moduleRecordMapping.Messages.custom_view.id)}}else crmHistory.handleAjaxErrorLyte=!0,crmHistory.doNotReload=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()}}),Lyte.Router.registerRoute("crm.tab.messages.view",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_merge_fields.js"],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js","lyte-colorbox.js","lyte-hovercard.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-msg-detail-view.js","crm-imtemplate.js","crm-permission-error.js","crm-cloud-picker-mixin.js","crm-merge-field-mixin.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_module_settings_common.js","zohocrm_integration_home.js"],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["crm-msg-detail-view.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],ResourceConstants.CRMClient)));var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmdetailview")],ResourceConstants.CRM);return t.concat(r).concat(s).concat(e)},model:function(){var e;window.Messages={moduleName:"Messages",currentStatus:"view",entityId:this.transition.info.dynamicParams[0]},e=this.transition.data.cvid?this.transition.data.cvid:moduleRecordMapping.Messages.cvid,this.transition.data.recordNum&&(crmTab.getFromCache("Messages").recordNum=this.transition.data.recordNum);var t=store.peekRecord("custom_view",e),r={record:store.findRecord("immessage",this.transition.info.dynamicParams[0])};return t&&t.sort_by||(r.custom_view=store.findRecord("custom_view",e,{module:"messages__s"})),Lyte.resolvePromises(r).then((function(e){return e}))},afterModel:function(e){commonUtils.showHideLoadingDiv(!0),validationUtils.isEmpty(e.record)&&(this.currentModel.error=!0)},renderTemplate:function(e){if(renderingUtils.resizeWindowHW(),this.currentModel={selectedConversationId:this.transition.info.dynamicParams[0]},this.transition.data.cvid){var t=this.transition.data.cvid;this.currentModel.selectedCustomViewId=t}else this.currentModel.selectedCustomViewId=moduleRecordMapping.Messages.cvid;return this.currentModel.error=e.error,this.currentModel.showDetailView=!0,this.currentModel.showManageText=!1,commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-msg-detail-skeleton"}},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(!1),this.currentModel=e,this.handleError("Messages"),!1}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.module.actions.add-to-campaigns",{queryParams:["entity-id"],model:function(e){var t={actiontype:"mass_addRecords",lookback:"showdetails"};t.entityId=e.queryParams["entity-id"],t.module=this.parent.parent.getDynamicParam(),delete t.backOneLevel;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MassRecords.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.approvals",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_changeOwner.js"],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvals")],ResourceConstants.CRM))},queryParams:["actionName","showDuplicates","fromIndex","toIndex"],model:function(e){var t=e.queryParams;t.newModel=!0;var r=this.parent.parent.getDynamicParam(),s="Contacts"==r?Crm.getCrmBasePath()+"/WebContactApproval.do":"Cases"==r?Crm.getCrmBasePath()+"/WebCaseApproval.do":Crm.getCrmBasePath()+"/WebLeadApproval.do";return(r.indexOf("CustomModule")>-1||"Vendors"===r)&&(s=Crm.getCrmBasePath()+"/WebRecordApproval.do"),s+="?module="+r,networkUtils.lyteInitiateRequest(s,"POST",{params:t})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.index-deduplicate",{model:function(e){var t={};t.module=moduleRecordMapping[this.parent.parent.parent.getDynamicParam()].api_name;var r={params:t};return[networkUtils.lyteInitiateRequest("/crm/v2/deduplicate","GET",r),store.findAll("product_configurator").then((function(e){return e}),(function(){return[]})),store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/settings/cpq/pricing_rules",method:"GET"}).then((function(e){return e}),(function(){return[]}))]},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam(),s=e[1];let i=!1,a=s.length;for(let e=0;e<a;e++){let t=s[e];if(t.entity_lookup&&t.entity_lookup.module&&moduleApiMapping[r]===t.entity_lookup.module.api_name){i=!0;break}}var n=e[2];if(n=n.pricing_rules,!i&&n)for(let e in n){let t=n[e];if(t.entity_lookup&&t.entity_lookup.module&&moduleApiMapping[r]===t.entity_lookup.module.api_name){i=!0;break}}if(!(e=e[0]).exceptionObject&&i?e.deduplicate.cpq_involved=!0:e.exceptionObject||(e.deduplicate.cpq_involved=!1),e.exceptionObject){var o=e.exceptionObject;"NO_PERMISSION"==o.code?renderingUtils.displayPermissionDenied():"FEATURE_NOT_AVAILABLE"==o.code?(crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.module.not.supported",r,"Deduplication")):"INTERNAL_ERROR"==o.code&&renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"))}else if(e.deduplicate.columnsForDeduplication)e.modname=moduleRecordMapping[r].plural_label,e.singularmodulename=moduleRecordMapping[r].singular_label,$("#show").empty().html(Handlebars.templates.MassFindDuplicates(e));else{crmDeduplicate.loadPopup(),(t=[]).push(e.deduplicate.userName),t.push(moduleRecordMapping[r].plural_label);var c=renderingUtils.createHTML({name:"div",attr:{id:"msgpopup",class:"aligncenter"}}),l=renderingUtils.createHTML({name:"div"});l.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"waring-info-icon mB20 svgIcons"}})),l.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular crm-subheading-font-size dB oH mB20"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message1",t)}]})),l.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular crm-base-font-size dB mB10"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message2")}]})),l.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular crm-base-font-size dB"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message3")}]})),c.appendChild(l).appendChild(renderingUtils.createHTML({name:"input",attr:{class:"primarybtn mT20 mR0",type:"button",value:I18n.getMsg("crm.mb.newversion.msg4"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}})),renderingUtils.freezeBackground(),$("#deduplication_start_popup").html(c),crmui.showPop("deduplication_start_popup")}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.list-conflicts",{queryParams:["jobId","fromIndex","toIndex","isFromLink"],model:function(e){var t=e.queryParams;t.fromIndex||t.toIndex||(this.transition.data.indexData?(t.fromIndex=this.transition.data.indexData.fromIndex,t.toIndex=this.transition.data.indexData.toIndex):(t.fromIndex=1,t.toIndex=10));var r=t.fromIndex,s=(t.toIndex,t.isFromLink),i={};i.module=moduleRecordMapping[this.parent.parent.parent.getDynamicParam()].api_name,r&&(i.page=r),void 0===s&&(s=!1),i.isFromLink=s;var a={params:i};return networkUtils.lyteInitiateRequest("/crm/v2/deduplicate/"+t.jobId,"GET",a)},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam(),s=t.queryParams,i=s.fromIndex,a=s.toIndex,n=s.jobId,o=moduleRecordMapping[r].singular_label,c=moduleRecordMapping[r].plural_label;if(e.exceptionObject){var l=e.exceptionObject;if("NO_PERMISSION"==l.code)renderingUtils.displayPermissionDenied();else if("FEATURE_NOT_AVAILABLE"==l.code)crmDeduplicate.loadPopup(),crmui.showPop("deduplication_start_popup");else if("INTERNAL_ERROR"==l.code)renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"));else if("LINK_EXPIRED"==l.code||"NO_DATA"==l.code){crmDeduplicate.loadPopup();t=[c];(C=renderingUtils.createHTML({name:"div",attr:{id:"mergePopup"}})).appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-medium-large-font-size crm-font-regular dB mB10 color_010101"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication",c)}]})),"LINK_EXPIRED"==l.code?(C.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular crmBaseColor crm-base-font-size lh20"},child:[{name:"text",content:I18n.getMsg("crm.label.conflictlink.expired.message1",t)}]})),C.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.deduplicate.button",c),onclick:'crmDeduplicate.showDeduplication("'+r+'")'}},{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]}))):(C.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-base-font-size crm-font-regular dB"},child:[{name:"text",content:I18n.getMsg("crm.label.alert.allresolved",c)}]})),C.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]}))),$("#deduplication_start_popup").html(C),renderingUtils.freezeBackground(),crmui.showPop("deduplication_start_popup")}}else if($.isEmptyObject(e.deduplicate))crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.label.alert.allresolved",r);else if(null==e.deduplicate.fields){var d=a-i+1,u=!0,m=e.deduplicate.defaultColumn,p=e.deduplicate.conflictObject,h=p.conflictRecordDetails,f=null;null!=h&&(f=h.length),f>d&&(u=!1,h.splice(10,1),f-=1),f=parseInt(i)+parseInt(f)-1,1==e.deduplicate.duplicateColumns.length?e.showTab=!1:e.showTab=!0,p.module=r,p.jobId=n,p.disableEndIndex=u,p.startIndex=i,p.endIndex=a,p.displayCount=f,p.defaultColumn=m,p.singularmodname=o;var g=$("#conflictDetails").children("#undefined");if(null!=g.html()||""==g.html()?$(g).html(Handlebars.templates.ConflictDetails(p)):(e.modname=moduleRecordMapping[r].plural_label,e.singularmodname=o,Handlebars.registerPartial("ConflictDetails",Handlebars.templates.ConflictDetails),$("#show").empty().html(Handlebars.templates.ViewConflictList(e))),crmDeduplicate.FixedHeaderFunctDF("duplicateDataTableCon_"+p.currentColumn),crmDeduplicate.FixedHeaderDedup("duplicateDataTableCon_"+p.defaultColumn),e.deduplicate.MatchCount>0){var y=[];y.push(e.deduplicate.MatchCount),y.push(r)}}else{var v=null,_=e.deduplicate.fields;crmDeduplicate.loadPopup();var C=renderingUtils.createHTML({name:"div",attr:{id:"mergePopup"}});t=[];if(1==_.length)v="crm.label.conflictlink.nofield.message1",t.push(_[0]);else if(2==_.length)v="crm.label.conflictlink.nofield.message2",t.push(_[0]),t.push(_[1]);else{v="crm.label.conflictlink.nofield.message3";f=_.length;for(var R=0;R<f;R++)t.push(_[R])}t.push(c),C.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-medium-large-font-size crm-font-regular dB mB10 color_010101"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication",c)}]})),C.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular crmBaseColor crm-base-font-size lh20"},child:[{name:"text",content:I18n.getMsg(v,t)}]})),C.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.deduplicate.button",c),onclick:'crmDeduplicate.showDeduplication("'+r+'")'}},{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]})),renderingUtils.freezeBackground(),$("#deduplication_start_popup").html(C),crmui.showPop("deduplication_start_popup")}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.merge",{queryParams:["jobId","currentColumn","currentColVal","currentColId","currentFieldLabel","fromFindAndMerge","startIndex","ids","recordCount","fromConflicts","conflictfromIndex","conflictendIndex","orginRecordid"],getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Deduplication")],ResourceConstants.CRM);return(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-merge-entity.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-merge-entity.js","crm-merge-mixin.js","crm-ui-loaders.js","lyte-hovercard.js"],ResourceConstants.CRMClient))},beforeModel:function(){var e=this.parent.parent.parent.getDynamicParam();if(!moduleRecordMapping[e]||!moduleRecordMapping[e].visible||!Crm.userDetails.permissions["Crm_Implied_Merge_"+e]){var t=Lyte.Component.render("crux-permission-denied-alert",{},"body");t.setMethods({onAccept:function(){if(moduleRecordMapping[e]&&moduleRecordMapping[e].visible&&Crm.userDetails.permissions["Crm_Implied_View_"+e]){r=moduleRecordMapping[e].module_name;var t=moduleRecordMapping[r].cvid;Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[r,t]})}else{var r=moduleRecordMapping.Home.module_name;Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:[r]})}}}),t.setData("cxPropShow",!0),this.transition.abort()}var r=moduleRecordMapping[e].id;return Lyte.resolvePromises({ldmoduleData:store.findRecord("module",r)})},model:function(e){var t=e.queryParams,r=this.parent.parent.parent.getDynamicParam(),s=moduleRecordMapping[r].id,i=t.ids,a=[];if("string"==typeof i)for(var n=i.split(","),o=n.length,c=0;c<o;c++)a.push(n[c]);else a=i;return a.length>3?{ids:a}:Lyte.resolvePromises([store.findAll(s,{ids:i.toString()},void 0,void 0,{from:"merge"})]).then((function(e){return{data:e,ids:a}}))},afterModel:function(e,t){var r=this,s=r.parent.parent.parent.getDynamicParam(),i={};if(this.transition.data.criteriaData&&((i=this.transition.data.criteriaData).selectedIds=e.ids[0],i.data=e.data),e&&e.ids.length>3)_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.alert.maxlength.merge")}});else if(!e||0!==e.ids&&e.ids.length!==e.data[0].length){_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.alert.deduplicate.deleted.conflicted.record.message")}});var a,n=t.queryParams;if(r.currentModel.jobId=n.jobId?n.jobId:"",r.currentModel.module=s,r.currentModel.masterRecordId=e.data[0].id,r.currentModel.modname=Crm.moduleInfo[s].translatedPluralLabel,a=e.data[0][0]&&e.data[0][0].id?e.data[0][0].id:e.ids[0],"false"===t.queryParams.fromFindAndMerge)crmDeduplicate.showDuplicates(s,n.jobId,n.currentColumn,n.currentColVal,n.currentFieldLabel,"true",n.startIndex,"");else Lyte.Router.transitionTo({route:"crm.tab.module.entity.find-and-merge",dynamicParams:[s,a]}).data={queryParams:i}}else{var o=!1,c={},l={},d={};if(0!==(h=moduleRecordMapping[this.parent.parent.parent.getDynamicParam()].fields).length){for(var u,m,p=h,h=[],f=[],g={},y={},v={},_={},C={},R={},b={},w={},M=0,D=[31,103,116,117,444,445,999,207],P=[13,17],L=["SMCREATORID","MODIFIEDBY","SE_STATUS","LASTACTIVITYTIME","FULLNAME","POSITIVE_SCORE","NEGATIVE_SCORE","TP_SCORE","TP_POSITIVE_SCORE","TP_NEGATIVE_SCORE","CONVERTED_CONTACTID","CONVERTED_ACCOUNTID","CONVERTED_POTENTIALID","QUALIFICATIONDURATION","CONVERTED","CONVERTEDDATE","PROCESSINGBASIS","CONSENTID","ISLOCKED"],k=["id","Recency","Frequency","Monetary","Segment_Label","Enrich_Status__s","Last_Enriched_Time__s","Unsubscribed_Mode","Unsubscribed_Time","Expected_Revenue","Reason_For_Loss__s","Sales_Cycle_Duration","Overall_Sales_Duration","Change_Log_Time__s"],I=["Owner","Created_Time","Modified_Time","Exchange_Rate"],U=p.length,E=0;E<U;E++){var A=p[E];if(-1===D.indexOf(A.ui_type)&&null===A.external&&-1===L.indexOf(A.column_name)&&-1===k.indexOf(A.api_name)&&(-1===P.indexOf(A.show_type)||"Tag"!==!A.api_name)){if(c[A.column_name]={id:A.id,api_name:A.api_name,ui_type:A.ui_type},l[A.api_name]=A.display_label,555===A.ui_type||556===A.ui_type){C[A.api_name]=A.length;for(var j,T=0,F=0,S=[],x=e.ids.length,N=!1,O=0;O<x;O++){var q=[];if(j=e.data[0][O][A.api_name]){for(var V=j.length,B=0;B<V;B++)if(F<=(A.maximum_allowed_size?A.maximum_allowed_size:20971520)&&T<A.length&&!N&&(S.push(555===A.ui_type?j[B].attachment_Id:j[B].id),T++,F+=parseInt(555===A.ui_type?j[B].original_Size_Byte:j[B].Size)),556===A.ui_type){var z={};z.id=j[B].id,z.fileId=j[B].File_Id,q.push(z)}556===A.ui_type&&crmDeduplicate.makeThumbNailReq(q,A.id,e.data[0][O].id,s),555!==A.ui_type||N?556!==A.ui_type||N||(R[A.column_name]=S,b[A.column_name]=T,w[A.column_name]=F,m=e.data[0][O].id,M=V,d[A.api_name]=[{id:m,fileids:Array.from(S),index:O,read_only:A.read_only}]):(y[A.column_name]=S,v[A.column_name]=T,_[A.column_name]=F,u=e.data[0][O].id,d[A.api_name]=[{id:u,fileids:Array.from(S),index:O,read_only:A.read_only}]),N=!0}}}if(void 0===A.subformtabid){if(66===A.ui_type?h.unshift(A):h.push(A),555!==A.ui_type&&556!==A.ui_type){var $=!0;if(Crm.userDetails.SUBFORM_PERMISSIONS&&500===A.ui_type){var H=store.peekRecord("module",A.subform.id);H.creatable&&H.editable||($=!1)}var J=this.getCheckedIndex(e.data[0],A.api_name,A.ui_type);null===J||"Probability"===A.api_name||"Closing_Date"===A.api_name||A.read_only?-1!==I.indexOf(A.api_name)||A.read_only||111===A.ui_type||118===A.ui_type?d[A.api_name]={id:e.data[0][0].id,index:0,showRadio:!1}:"Stage"!==A.api_name&&"Pipeline"!==A.api_name&&"Probability"!==A.api_name&&"Closing_Date"!==A.api_name||(d[A.api_name]={id:e.data[0][0].id,index:0,showRadio:!1}):500!==A.ui_type||$?d[A.api_name]={id:J.id,index:J.index,showRadio:!0}:d[A.api_name]={id:J.id,index:J.index,showRadio:$}}}else 500===A.ui_type?f.push(A):(void 0===g[A.subformtabid]&&(g[A.subformtabid]=[]),g[A.subformtabid].push(A));"Pipeline"===A.api_name&&(r.currentModel.showStage=!1)}}var G=f.length;for(E=0;E<G;E++){h.push(f[E]);var W=this.getCheckedIndex(e.data[0],f.api_name,f.ui_type);null!==W&&(d[f.api_name]={id:W.id,index:W.index});var Q=void 0===g[f[E].subformtabid]?0:g[f[E].subformtabid].length;for(O=0;O<Q;O++){h.push(g[f[E].subformtabid][O]);var Z=this.getCheckedIndex(e.data[0],g.api_name,g.ui_type);null!==Z&&(d[g.api_name]={id:Z.id,index:Z.index})}}Object.keys(y).length>0&&(r.currentModel.fileuploadmasterAttachIdList=y,r.currentModel.fileuploadRecordId=u),Object.keys(v).length>0&&(r.currentModel.fileuploadmasterAttachedCountList=v),Object.keys(_).length>0&&(r.currentModel.fileuploadmasterAttachedSizeList=_),Object.keys(R).length>0&&(r.currentModel.imguploadmasterAttachIdList=R,r.currentModel.imageuploadRecordId=m,r.currentModel.firstRecordCount=M),Object.keys(b).length>0&&(r.currentModel.imguploadmasterAttachedCountList=b),Object.keys(w).length>0&&(r.currentModel.imguploadmasterAttachedSizeList=w),r.currentModel.fileimguploadMaxLenObj=C,"Leads"!==s&&"Contacts"!==s&&"Accounts"!==s||crmDeduplicate.addSocialFields(h);var K=(n=t.queryParams).recordCount,X="Crm_Implied_Merge_"+s;if(Crm.userDetails.permissions[X]){V=e.data[0].length;if(e.data[0].length>1){r.currentModel.data=e.data[0],e.data[0].$process_flow&&(r.currentModel.transRcd=!0),o=!0,r.currentModel.masterRecordId=e.data[0].id,r.currentModel.jobId=n.jobId?n.jobId:"",r.currentModel.module=s,r.currentModel.modname=Crm.moduleInfo[s].translatedPluralLabel,r.currentModel.singularmodname=Crm.moduleInfo[s].translatedSingularLabel,r.currentModel.currentCol=n.currentColumn,r.currentModel.currentColVal=n.currentColVal,r.currentModel.currentColId=n.currentColId,r.currentModel.currentFieldLabel=n.currentFieldLabel,r.currentModel.conflictfromIndex=n.conflictfromIndex,r.currentModel.conflicttoIndex=n.conflictendIndex,r.currentModel.startIndex=n.startIndex,r.currentModel.fromFindAndMerge=n.fromFindAndMerge,r.currentModel.activitymodname=Crm.moduleInfo.Activities.translatedPluralLabel,r.currentModel.prodmodname=Crm.moduleInfo.Products.translatedPluralLabel,r.currentModel.fromConflicts=n.fromConflicts,r.currentModel.fieldsMap=c,r.currentModel.fieldsApiNameVsColNameMap=l,r.currentModel.masterRecdLabel=I18n.getMsg("crm.label.merge.record",1);var Y=r.currentModel.ids;r.currentModel.recordIds=Y,this.transition.data.criteriaData&&(r.currentModel.totalCriteria=this.transition.data.criteriaData.totalCriteria,r.currentModel.crtType=this.transition.data.criteriaData.crtType,r.currentModel.criteriaData=this.transition.data.criteriaData.criteriaData),(n.fromFindAndMerge||K>0)&&(r.currentModel.recordCount=K),r.currentModel.fields=h,r.currentModel.loadfields=h.slice(0,50),d.Layout&&d.Layout.showRadio&&void 0!==d.Stage&&(d.Stage.showRadio=!1),d.Stage&&d.Pipeline&&d.Pipeline.showRadio&&(d.Stage.showRadio=!1),d.Layout&&d.Layout.showRadio&&d.Pipeline&&(d.Pipeline.showRadio=!1),d.Pipeline&&!d.Pipeline.showRadio&&(r.currentModel.showStage=!0),r.currentModel.selfldVsRcdMap=d,r.currentModel.orginRecordid=n.orginRecordid,crmDeduplicate.FixedHeaderFunctDF("mergerFieldTable")}}else if(!1===o){var ee=Lyte.Component.render("crux-permission-denied-alert",{},"body");ee.setMethods({onAccept:function(){crmHistory.backOneLevel()}}),ee.setData("cxPropShow",!0),this.transition.abort()}}}},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-merge-entity"}},lyteConvertionSupported:!0},{mixins:["crm-merge-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.show-duplicates",{queryParams:["jobId","currentColumn","currentColVal","currentColId","disableEndIndex","currentFieldLabel","fromViewConflicts","startIndex","ids","selectedIds","conflictfromIndex","conflictendIndex"],model:function(e){var t=e.queryParams,r=this.parent.parent.parent.getDynamicParam(),s="/crm/v2.2/"+moduleRecordMapping[r].api_name,i=[],a=t.ids;if("string"==typeof a)for(var n=a.split(","),o=n.length,c=0;c<o;c++)i.push(n[c]);else i=a;this.ids=i;var l=i.length;l>0&&(s+="?ids=");for(var d=0;d<l;d++)s+=i[d],d!==l-1&&(s+=",");return networkUtils.lyteInitiateRequest(s,"GET")},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam(),s=this.ids,i=e.data;if(0===crmDeduplicate.fields.length)crmDeduplicate.initReq("/crm/v2.2/settings/fields","GET","module="+moduleRecordMapping[r].api_name,{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/deduplication"},(function(e){var a=e.fields;crmDeduplicate.fields=[];for(var n=[],o={},c=a.length,l=0;l<c;l++){var d=a[l];void 0===d.subformtabid?66===d.ui_type?crmDeduplicate.fields.unshift(d):crmDeduplicate.fields.push(d):500===d.ui_type?n.push(d):(void 0===o[d.subformtabid]&&(o[d.subformtabid]=[]),o[d.subformtabid].push(d))}var u=n.length;for(l=0;l<u;l++){crmDeduplicate.fields.push(n[l]);for(var m=void 0===o[n[l].subformtabid]?0:o[n[l].subformtabid].length,p=0;p<m;p++)crmDeduplicate.fields.push(o[n[l].subformtabid][p])}crmDeduplicate.addSocialFields(crmDeduplicate.fields);var h=t.queryParams;if(h.selectedIds&&0!==h.selectedIds.length)if("string"==typeof h.selectedIds)for(var f=h.selectedIds.split(","),g=f.length,y=0;y<g;y++)crmDeduplicate.selectedIds.push(f[y]);else crmDeduplicate.selectedIds=h.selectedIds;else crmDeduplicate.selectedIds=[];var v=h.jobId,_=h.currentColId,C=h.currentColumn,R=h.currentColVal,b=h.currentFieldLabel,w=h.fromViewConflicts,M=h.startIndex,D=h.disableEndIndex,P=s.length,L="Crm_Implied_Merge_"+r,k={},I={};Crm.userDetails.permissions[L]?(I.data=i,I.module=r,k.recordDetails=I,k.currentColId=_,k.startIndex=M,k.disableEndIndex=D,k.displayCount=1==M?P:parseInt(M)+(P-1),k.conflictfromIndex=$("#conflictstartIndex").val(),k.conflicttoIndex=$("#conflictendIndex").val(),k.jobId=v,k.module=r,k.modname=moduleRecordMapping[r].plural_label,k.singularmodname=moduleRecordMapping[r].singular_label,k.currentCol=C,k.currentColVal=R,k.currentFieldLabel=b,k.recordCount=P,I.selectedIds=crmDeduplicate.selectedIds,I.fields=crmDeduplicate.fields,"false"===w?($("#dupTable").html(Handlebars.templates.DuplicateRecords(k.recordDetails)),$("#navigate").html(Handlebars.templates.DuplicateRecordNavigation(k)),$("#defixedrowTd").html(Handlebars.templates.DuplicateCheckBox(k.recordDetails))):(Handlebars.registerPartial("DuplicateRecords",Handlebars.templates.DuplicateRecords),Handlebars.registerPartial("DuplicateCheckBox",Handlebars.templates.DuplicateCheckBox),Handlebars.registerPartial("DuplicateRecordNavigation",Handlebars.templates.DuplicateRecordNavigation),$("#show").html(Handlebars.templates.ViewDuplicates(k))),crmDeduplicate.fixedHeaderDedpulicate(),crmDeduplicate.checkOfRecordMerge()):renderingUtils.displayPermissionDenied()}));else{var a=t.queryParams;a.selectedIds&&0!==a.selectedIds.length?crmDeduplicate.selectedIds=a.selectedIds:crmDeduplicate.selectedIds=[];var n=a.jobId,o=a.currentColId,c=a.currentColumn,l=a.currentColVal,d=a.currentFieldLabel,u=a.fromViewConflicts,m=a.startIndex,p=a.disableEndIndex,h=s.length,f="Crm_Implied_Merge_"+r,g={},y={};if(Crm.userDetails.permissions[f]){i=e.data;y.data=i,y.module=r,g.recordDetails=y,g.currentColId=o,g.startIndex=m,g.disableEndIndex=p,g.displayCount=1==m?h:parseInt(m)+(h-1),g.conflictfromIndex=$("#conflictstartIndex").val(),g.conflicttoIndex=$("#conflictendIndex").val(),a.conflictfromIndex&&a.conflictendIndex&&(g.conflictfromIndex=a.conflictfromIndex,g.conflicttoIndex=a.conflictendIndex),g.jobId=n,g.module=r,g.modname=moduleRecordMapping[r].plural_label,g.singularmodname=moduleRecordMapping[r].singular_label,g.currentCol=c,g.currentColVal=l,g.currentFieldLabel=d,g.recordCount=h,y.selectedIds=crmDeduplicate.selectedIds,y.fields=crmDeduplicate.fields,"false"===u?($("#dupTable").html(Handlebars.templates.DuplicateRecords(g.recordDetails)),$("#navigate").html(Handlebars.templates.DuplicateRecordNavigation(g)),$("#defixedrowTd").html(Handlebars.templates.DuplicateCheckBox(g.recordDetails))):(Handlebars.registerPartial("DuplicateRecords",Handlebars.templates.DuplicateRecords),Handlebars.registerPartial("DuplicateCheckBox",Handlebars.templates.DuplicateCheckBox),Handlebars.registerPartial("DuplicateRecordNavigation",Handlebars.templates.DuplicateRecordNavigation),$("#show").html(Handlebars.templates.ViewDuplicates(g))),crmDeduplicate.fixedHeaderDedpulicate(),crmDeduplicate.checkOfRecordMerge()}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-mass-action.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=e.concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js"],ResourceConstants.CRMClient)),networkUtils.returnDependencyFiles(["zohocrm_deduplicate.js",networkUtils.getI18nJSUrl("deduplication")],ResourceConstants.CRM).concat(e)}}),Lyte.Router.registerRoute("crm.tab.module.actions.draft",{queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","territory_id","filter_id","draftView"],getResources:function(){var e=networkUtils.returnDependencyFiles(["user_type.js","crm-record-draft-view.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js","crux-criteria-component.js","crux-criteria-conditions.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["wizard-draft.css","crm-list-mass-action.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("wizardsdrafts")],ResourceConstants.CRM)},beforeModel:function(){var e=Lyte.Router.getRouteInstance("crm.tab.module").transition.info.dynamicParams[0];Crm.userDetails.permissions["Crm_Implied_Create_"+moduleRecordMapping[e].module_name]&&moduleRecordMapping[e].visible||(crmHistory.handleAjaxErrorLyte=!0,this.transition.abort(),renderingUtils.displayPermissionDenied())},model:function(){var e=Lyte.Router.getRouteInstance("crm.tab.module").transition.info.dynamicParams[0],t={};return store.findRecord("module",moduleRecordMapping[e].id).then((function(r){t.modules=r;let s={per_page:10,state:"draft",home_converted_currency:!0,formatted_currency:!0};return store.findAll(moduleRecordMapping[e].id,s).then((function(e){return t.records=e,t}))}))},afterModel:function(e){var t=["Lead_Conversion_Time","Converted_Account","Converted_Contact","Converted_Deal","Unsubscribed_Time","Unsubscribed_Mode"],r=e.modules[0].custom_view.fields;if("Leads"===e.modules[0].api_name)r=e.modules[0].custom_view.fields.filter((function(e){return!t.includes(e.api_name)}));var s=r.length<6?r.length:6;e.custom_view_fields=r.slice(0,s),e.fields_list=e.custom_view_fields.map((function(e){return e.api_name})).join(),e.module=e.modules[0],e.criteriaFields=e.module.fields.filter((function(e){return e.filterable})),e.records.length&&(e.moreRecords=e.records.$.meta.more_records,e.records.$.meta.per_page>e.records.$.meta.count?e.perPage=e.records.$.meta.count:(e.perPage=e.records.$.meta.per_page,e.absolutePerPage=e.records.$.meta.per_page))},renderTemplate:function(){return{outlet:"#show",component:"crm-record-draft-view"}},actions:{willTransition:function(e){if(e.info.dynamicParams&&2==e.info.dynamicParams.length&&store.model[moduleRecordMapping[e.info.dynamicParams[0]].id]){var t=store.peekRecord(moduleRecordMapping[e.info.dynamicParams[0]].id,e.info.dynamicParams[1]);if(t){if(!t.$editable)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.record.edit.denied"),ltPropDuration:"2000",ltPropShow:!0}}),void e.abort();for(var r=t.Layout&&t.Layout.id?t.Layout.id:this.currentModel.module.layouts[0].id,s=store.peekRecord("layout",r),i=!1,a=s.profiles.length,n=0;n<a;n++){var o=Crm.userDetails.PROFILE_ID;window.clientPortalName||(o=userInfo.users[0].profile.id);var c=moduleRecordMapping[e.info.dynamicParams[0]];if("team_based"===c.access_type&&(o=c.private_profile.id),s.profiles[n].id===o){i=!0;break}}if(!i)return renderingUtils.displayPermissionDenied(),void e.abort()}}}}}),Lyte.Router.registerRoute("crm.tab.module.actions.generate-po",{beforeModel:function(){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort())},model:function(e){var t={params:{newModel:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GeneratePO.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.mass-tools",{queryParams:["type","filter","page","per_page"],isReload:!1,getDependencies:function(){return networkUtils.returnDependencyFiles(["features_model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=Lyte.Router.getRouteInstance().getQueryParams().type,t=networkUtils.returnDependencyFiles(["zohocrm_changeOwner.js","zohocrm_customView.js","zohocrm_ProcessFlow.js","zohocrm_phoneNumbers.js"],ResourceConstants.CRM);return"mass_email"!==e?(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-mass-tools.css","crm-mass-tool-header.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-inner-list-new.css","crm-page-navigator.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("masstools")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-mass-tools.js","crm-mass-tool-header.js","crm-inner-list.js","crm-page-navigator.js","crm-list-helpers.js","crm-mass-action-mixin.js","crux-criteria-component.js","crux-criteria-conditions.js","crux-lookupfilter-component.js","crux-column-list.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)):t},beforeModel:function(e){var t=this.parent.parent.getDynamicParam();moduleRecordMapping[t]||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})));var r=(this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:e.queryParams).type;if((r&&"convert"===r||"mass_convert"===r)&&(Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort()),!moduleRecordMapping.Contacts.visible)){var s=[];s.push(moduleRecordMapping.Leads.plural_label),s.push(moduleRecordMapping.Contacts.plural_label),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.lead.no.conversion",s),ltPropType:"error"}}),commonUtils.showHideLoadingDiv(!1),this.transition.abort()}this.unloadProperty("field",moduleRecordMapping[t].fields)},model:function(e){var t=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:e.queryParams,r={},s=t.type,i=t.filter,a=t.page,n=t.per_page,o=Crm.getCrmBasePath()+"/MassRecords.do";r.module=this.parent.parent.getDynamicParam(),r.actiontype=s;var c=moduleRecordMapping[r.module];if(i){var l=JSON.parse($ESAPI.encoder().decodeFromURL(i));delete l.calleeObj,delete l.backOneLevel;var d=n?parseInt(n):void 0,u=a?parseInt(a):void 0;if(d&&n){var m=u*d-d+1>0?u*d-d+1:1;l.from_index=m,l.to_index=m+d-1}if($("#fromIndex").length>0&&l.NorP){var p=l.NorP,h=$("#fromIndex").val()?parseInt($("#fromIndex").val()):void 0;d=$("#currentOption").val()?parseInt($("#currentOption").val()):void 0;if("next"==p){if(h&&d){var f=h+d;l.from_index=f,l.to_index=f+d-1}}else if("previous"==p&&h&&d){f=h-d;l.from_index=f>0?f:1,l.to_index=f+d-1}}delete l.NorP}if(this.transition.data&&this.transition.data.onlyFilter){var g={params:l};return networkUtils.lyteInitiateRequest(o,"POST",g)}if(i){g={params:r};var y=networkUtils.lyteInitiateRequest(o,"POST",g),v={params:r=l},_=networkUtils.lyteInitiateRequest(o,"POST",v);return Lyte.resolvePromises({withoutFilter:y,withFilter:_})}if("mass_delete"===s||"mass_update"===s||"mass_transfer"===s||"mass_convert"===s){store.unloadAll(c.id);var C="team_based"===c.access_type,R={},b=this,w=C?c.private_profile.id:store.peekRecord("user",Crm.userDetails.USER_ID).profile.id;return R.privacy_preference=store.findAll("dummy",void 0,!1,!1,{url:"crm/v2/settings/privacy_preferences",method:"GET"}),R.fields=store.findAll("field",{module:c.api_name,type:"all"},void 0,void 0,{apiVersion:"2.2"}),R.profile=store.findRecord("profile",w),"mass_convert"===s&&(R.massConvertData=store.findAll("features",{api_names:"mass_convert"})),"Contacts"===c.module_name&&moduleRecordMapping.Accounts.visible&&(R.relativeFields=store.findAll("field",{module:moduleRecordMapping.Accounts.api_name,type:"all"},void 0,void 0,{apiVersion:"2.2"})),Lyte.resolvePromises(R).then((function(e){"mass_convert"===s&&(e.massConvertLimit=e.massConvertData[0].details.limits.total),e.preference=e.privacy_preference.privacyPreference[0].preference,e.consent_modules=JSON.parse(e.preference.consent_modules);var t="mass_transfer"===s?"Transfer":"mass_update"===s?"Update":"mass_delete"===s?"Delete":"mass_convert"===s?"Convert":"Others",r=C?b.checkPermissionForTeamModule("Potentials"===c.module_name?"Deals":c.module_name,t):b.checkPermission(w,"Potentials"===c.module_name?"Deals":c.module_name,t);C&&r&&e.fields.filter((e=>"userlookup"===e.data_type||"ownerlookup"===e.data_type)).forEach((e=>{Lyte.objectUtils(e,"add","cxUserProperties",{queryParam:{include_lite_users:!0}})}));if(r)return e;b.transition.abort(),crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()}),(function(e){var t=JSON.parse(e.response);403!==e.code&&"NO_PERMISSION"!==t.code&&"INTERNAL_ERROR"!==t.code||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),b.transition.abort())}))}g={params:r};return networkUtils.lyteInitiateRequest(o,"GET",g)},afterModel:function(e,t){var r=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams,s=this.currentModel.type=r.type.split("mass_")[1],i=r.type;if(this.currentModel.module=this.parent.parent.getDynamicParam(),this.currentModel.module_info=moduleRecordMapping[this.parent.parent.getDynamicParam()],this.currentModel.instruction1="crm.mass."+s+".instruction1",this.currentModel.instruction2="crm.mass."+s+".instruction2","update"===s)this.currentModel.actionName="crm.module.mass.update",this.currentModel.helpKey="help.update.response";else if("convert"===s){this.currentModel.actionName="crm.mass.convert.button",this.currentModel.helpKey="help.lead.massconvert",Lyte.registeredMixins["crm-view-utils"].massConvertLimit=e.massConvertLimit}else this.currentModel.actionName="crm.button."+s,this.currentModel.helpKey="transfer"===s?"help.mass.records."+s:"help.mass."+s;if("mass_delete"===i||"mass_update"===i||"mass_transfer"===i||"mass_convert"===i){this.currentModel.columnFields=this.getHardCodedColumns();var a=Lyte.deepCopyObject(moduleRecordMapping[this.currentModel.module].fields);if(this.currentModel.fields=this.getCriteriaFields(a),"Contacts"===this.currentModel.module&&moduleRecordMapping.Accounts.visible){a=Lyte.deepCopyObject(moduleRecordMapping.Accounts.fields);var n=this.getCriteriaFields(a,crmConstants.moduleDisplayField.Accounts[0]);this.currentModel.fields=this.currentModel.fields.concat(n)}}},renderTemplate:function(e,t){var r=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams;return"mass_delete"===r.type||"mass_update"===r.type||"mass_transfer"===r.type||"mass_convert"===r.type?{outlet:"#show",component:"crm-mass-tools"}:r.filter?this.transition.data&&this.transition.data.onlyFilter?(thirdPartyUtils.unbindChildEvents("#massResult"),{outlet:"#massResult",html:e}):(thirdPartyUtils.unbindChildEvents("#show"),{outlet:"#show",html:e.withoutFilter}):(thirdPartyUtils.unbindChildEvents("#show"),{outlet:"#show",html:e})},afterRender:function(e,t){var r=0,s=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams,i=s.type,a=s.filter,n=s.page,o=JSON.parse($ESAPI.encoder().decodeFromURL(a)),c=!!this.transition.data&&this.transition.data.onlyFilter;(c?(delete this.transition.data.onlyFilter,r=o.rowCount):a&&($("#massResult").html(e.withFilter),r=isNaN(parseInt(o.rowCount))?0:parseInt(o.rowCount)),n)&&$('<input id="page_no" type="hidden" value="'+n+'" />').insertAfter("#fromIndex");if("mass_update"===i||c||"mass_delete"===i||"mass_transfer"===i||"mass_convert"===i||(r>0?(Search.setValues("create",o),Search.rowcnt=r):(Search.setDefaultValues("create",void 0,void 0,void 0,void 0,!0),Search.rowcnt=1,thirdPartyUtils.bindSelect2("select"))),"mass_email"!==i){var l=this.transition.data;if(l.mass_data){var d=l.mass_data,u=$L("crm-mass-tools")[0].component;u.setData({criteria:d.criteria,per_page:d.pageDet.per_page}),"mass_transfer"===i&&u.setData({fromValue:d.userDetails.fromValue,toValue:d.userDetails.toValue,massqp:d.userDetails.massqp}),u.fetchRecords(void 0,d.pageDet.page,d.pageDet.per_page,!0,{searchClick:!0}),u.setData("showToggleBtn",!0)}var m=networkUtils.returnDependencyFiles(["crm-mass-actions.js","crm-lookuplimit-exceed-popup.js","lyte-hovercard.js","pipeline_picklist_model.js"],ResourceConstants.CRMClient);m=m.concat(networkUtils.returnDependencyFiles(["crm-mass-action.css","crm-lookuplimit-exceed-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(m)}},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),void 0!==e.responseText&&e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1&&renderingUtils.showCustomAlert(I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1])),e.status===crmConstants.limitExceedsCode&&Search.displayLookupExceedsMsg(e),crmHistory.handleAjaxErrorLyte=!0,!1},willTransition:function(e){"crm.tab.module.entity.detail"!==e.target&&(this.transition.data.mass_data=void 0)}},beforeExit:function(){var e=this.parent.parent.getDynamicParam();store.unloadAll(moduleRecordMapping[e].id);var t=$L("crm-mass-tools");t[0]&&t.find(".massActionBodyWrapDiv")[0].removeEventListener("scroll",t[0].component._scroll,!0)}},{mixins:["crm-module-mixin","crm-mass-action-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.actions",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-inner-actions-template.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}}),Lyte.Router.registerRoute("crm.tab.module.activities-banner",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-activity-depreciation-banner-records.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["crm-activity-banner.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=[networkUtils.getI18nJSUrl("activitydepbanner")],r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRM);return e=e.concat(r)},model:function(e){if(moduleRecordMapping[e.dynamicParam]&&moduleRecordMapping[e.dynamicParam].viewable)return Lyte.resolvePromises({activity_banner_records:store.findAll("dummy",{actionName:"activitydepreciation",module:e.dynamicParam,page:1},!1,!1,{url:Crm.getCrmBasePath()+"/ActivityReminder.do",method:"POST"})})},afterModel:function(e,t){if(this.currentModel={},this.currentModel.relModule=t.dynamicParam,void 0!==e&&moduleRecordMapping[t.dynamicParam])this.currentModel.curModData=e.activity_banner_records.dummy[t.dynamicParam],this.currentModel.info=e.activity_banner_records.dummy.info;else if(moduleRecordMapping[t.dynamicParam]&&!moduleRecordMapping[t.dynamicParam].viewable){var r=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",s).data={showError:!0,module:t.dynamicParam,errorMsg:I18n.getMsg("module.not.available")}}},redirect:function(e,t){if(!Crm.userDetails.actBannerEnabled&&moduleRecordMapping[t.dynamicParam])this.replaceWith("crm.tab.module.begin","Home");else if(void 0===moduleRecordMapping[t.dynamicParam]){var r=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",s).data={showError:!0,module:"Activities",errorMsg:I18n.getMsg("crm.cc.portal.invalid.pid")}}},renderTemplate:function(e){return{outlet:"#show",component:"crm-activity-depreciation-banner-records",data:e}}}),Lyte.Router.registerRoute("crm.tab.module.associate-search",{getResources:function(){var e=[networkUtils.returnDependencyFiles(["phone-entity.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient)];return Crm.userDetails.isPhoneNoNewView&&(e=e.concat(Crm.returnPhoneFieldDependencyFiles())),e},queryParams:["phonenumber"],model:function(e){var t=e.queryParams.phonenumber,r=this.parent.getDynamicParam(),s=$("#ctinotifier");if(isNewCallView){var i="Leads"==r?"associate_lead":"associate_contact",a=document.createElement("phone-entity"),n=t?t.replace(/[^0-9]/g,""):t;a.setData({defaultvalue:t,defaultid:n,autotrigger:i}),a.style="display:none",document.body.appendChild(a)}else switch(Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("phonenumberassociate")],ResourceConstants.CRM)[0]]),r){case"Leads":s.append('<form name="ctiapileadsearch" onsubmit="return false;"><input type="hidden" id="Ctiapi_associated_lead_id"><input type="hidden" id="Ctiapi_associated_lead_name"></form>'),s.append('<input type="hidden" id="call_ctinumber" value="'+t+'">'),CTIAPI.associateLead();break;case"Contacts":s.append('<form name="ctiapicontactsearch" onsubmit="return false;"><input type="hidden" id="Ctiapi_associated_contact_id"> <input type="hidden" id="Ctiapi_associated_contact_name"><input type="hidden" name="property(modname)" id="Ctiapi_associated_contact_modname" value=""><input type="hidden" name="property(modid)" id="Ctiapi_associated_contact_modid"><input type="hidden" name="property(modsel)" id="Ctiapi_associated_contact_modsel" value="Accounts"></form>'),s.append('<input type="hidden" id="call_ctinumber" value="'+t+'">'),CTIAPI.associateContact()}}}),Lyte.Router.registerRoute("crm.tab.module.begin",{queryParams:["customizationId","category","popup"],getDependencies:function(){return networkUtils.returnDependencyFiles(["servapp_preferences_model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-blank-states.js","crm-home-blankpage.js","crux-criteria-component.js","crux-criteria-conditions.js","lyte-dateselect.js","lyte-daterangepicker.js","model-crm-report.js","crm-customview-helpers.js","crm-home-blankpage.js","crm-lightuser-picker-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);t=t.concat(networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css","crm-blank-states.css"],ResourceConstants.CRMClient)),e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics.js","crm-report-util.js","lyte-progressbar.js","lyte-video.js","automation_datahub_module.js","kiosk-execute.js","zia-insights.js"],ResourceConstants.CRMClient)),t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-strategy.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css","crm-analytics-component-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-teammodule-blankpage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var r=[networkUtils.getI18nJSUrl("activitysubonboarding"),networkUtils.getI18nJSUrl("activitydepbanner"),networkUtils.getI18nJSUrl("ServiceEntityKeys")];r.push(networkUtils.getI18nJSUrl("TeamModuleBegin")),r.push(networkUtils.getI18nJSUrl("Leadchain")),void 0!==Crm.userDetails.PROFILE_POPUP&&(r.push(networkUtils.getI18nJSUrl("onboardingPageRevampHomePage")),t=featuresAvailable.NEXTGENUI_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-home-blankpage-nextgen.css","lyte-ui-video.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)):t.concat(networkUtils.returnDependencyFiles(["crm-home-blankpage.css","lyte-ui-video.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)));var s=networkUtils.returnDependencyFiles(r,ResourceConstants.CRM);return s=(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CPQQuotesBegin")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("activitydashboardComponent")],ResourceConstants.CRM)),e=(e=e.concat(s)).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),"Invoices"==this.parent.getDynamicParam()&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zoho_books")],ResourceConstants.CRM))),e.concat(t)},beforeModel:function(){var e=this.parent.getDynamicParam(),t=document.querySelector("crm-left-menu");if((t=t?t.component:null)&&t.methods.hideContentLoader(),"Home"===e&&featuresAvailable.NEXTGENUI_ENABLED){var r=$L("crm-left-menu-loader")[0];if(r=r?r.component:null){r.setData("view","analytics");var s=setTimeout((function(){r.executeMethod("showLoaderBasedOnView",r)}),2e3)}t.methods.clearLoaderTimeout(),t.setData("loaderTimeout",s),app.prevTransition&&"crm.settings.edit-home-customization"===app.prevTransition.route&&($L(".nextGenUILeftMenu").show(),t.actions.showOrHideLeftPane(!0));var i=Lyte.Router.getRouteInstance().transition;if(featuresAvailable.TEAMSPACE_ENABLED&&i.transId>2){var a=$L("crm-left-menu-teamspace")[0];a&&(a=a.component).executeMethod("checkModuleOccurrenceAndOpen",a,moduleRecordMapping.Home.id,i,!0,!1)}}},model:function(e){var t=this.parent.getDynamicParam();if(!("Home"!=t||this.transition.data&&this.transition.data.changeView)){var r={module:"Home",isload:!0};e.queryParams.customizationId&&(r.customizationId=e.queryParams.customizationId,r.category=e.queryParams.category),store.unloadAll("servapp_preferences");var s={params:r};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",s)}if(this.transition.response&&"Home"!=t&&(1==this.transition.response.isDataWaitingForApproval||1==this.transition.response.data_waiting_for_approval))return store.findRecord("module",moduleRecordMapping[t].id,void 0,void 0,!0,{getMeta:!0})},redirect:function(){if(this.transition.response&&"Visits"==this.parent.getDynamicParam()&&!this.transition.data.donotRefresh){var e=this.refresh();e.response=this.transition.response,e.data={donotRefresh:!0}}},renderTemplate:function(e,t){if(t.queryParams&&"actpophide"===t.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}if(Crm.userDetails.settings_disabled&&$("#tab_Setup").remove(),!this.transition.data||!this.transition.data.changeView){var r=this.parent.getDynamicParam();if("Home"!=r){if(this.currentModel=this.transition.response,this.currentModel.module_info&&"Potentials"==this.currentModel.module_info.module_name)if(this.currentModel.module_info.layouts&&this.currentModel.module_info.layouts.length){var s=this.currentModel.module_info.layouts.filterBy({name:"Standard"})[0];this.currentModel.deallayoutId=s?s.id:this.currentModel.module_info.layouts[0].id}else this.currentModel.deallayoutId=this.currentModel.deallayoutId?this.currentModel.deallayoutId:"";this.currentModel.begin_page=!0,this.currentModel.module_name=r;if(this.currentModel.zbModuleName={CustomModule5001:"Invoices",CustomModule5002:"Quotes",CustomModule5003:"PurchaseOrders",CustomModule5004:"SalesOrders"}[r],this.currentModel.hideGreyArea=!0,"Visits"==r){var i={allportals:I18n.getMsg("crm.salesiq.all.accounts")},a=this.currentModel.portal_name?this.currentModel.portal_name:customViewObject.screenName?customViewObject.screenName:"allportals";this.currentModel.screenName=a,this.currentModel.cvid=moduleRecordMapping.Visits.cvid;var n=objectUtils.cloneObject(CrmTracking.portalsInfo);for(var o in n)i[o]=n[o];this.currentModel.portalName=customViewObject.portalName="allportals"==this.currentModel.portal_name?i.allportals:i[this.currentModel.portal_name],this.currentModel.screenVsPortalJson=n,this.currentModel.portals=i}return 1==this.currentModel.isDataWaitingForApproval||1==this.currentModel.data_waiting_for_approval||"Visits"==r?(this.currentModel.cvid=this.currentModel.module_info.custom_view.id,{outlet:"#show",component:"crm-custom-outer-box"}):(this.currentModel.isZBCustomModule=crmTab.isZBCustomModule(r),this.currentModel.isZSCustomModule=crmTab.isZSCustomModule(r),this.currentModel.isDescriptionAvailable=this.currentModel.module_info.description&&null!==this.currentModel.module_info.description,this.currentModel.isTeamModule="team_based"===this.currentModel.module_info.access_type,this.parent.currentModel&&this.parent.currentModel.cpqObj&&moduleRecordMapping.ZohoCPQ&&(crmTab.isZCpqTab(r)||crmTab.isZCpqSubTab(r))&&(this.currentModel.cpqobj=this.parent.currentModel.cpqObj,this.currentModel.enableCpqTab=!0),{outlet:"#show",component:"crm-begin-page"})}networkUtils.initChart(),$("#show").empty().html(e)}},afterRender:function(e){featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader();var t=this.transition.data;Object.keys(t).length>0&&(t.changeView?(CrmDashboard.loadDashboards(void 0,void 0,t.dataObj),this.transition.data.changeView=!1):t.homePageObj&&CrmDashboard.showSelectedHomePage(t.homePageObj,t.selectedHomeId,t.currentDate)),("Visits"==this.parent.getDynamicParam()||this.currentModel&&(1==this.currentModel.isDataWaitingForApproval||1==this.currentModel.data_waiting_for_approval))&&(customViewObject=e,this.renderVisitBlankState(customViewObject,"Visits"==this.parent.getDynamicParam()),CustomView.initFavorite()),Crm.userDetails.isAccessibilityConfigSupported&&(this.globalAccessibilityServices.getVariable("standardNavigationOrder")||$L("#HomePage_Selector").focus(),this.globalAccessibilityServices.tabIndexChange())},beforeExit:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"]&&Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].unbindShortcutsBeforeExit("Records View")},renderVisitBlankState:function(e,t){e.isKanbanView&&t?Lyte.Component.render("crm-begin-page",e,"#visits_parent_div"):($("#idForCV").empty(),Lyte.Component.render("crm-begin-page",e,"#idForCV")),t&&(networkUtils.loadFeatureScripts(["zohocrm_visitsetup.js"],(function(){"allportals"!=e.screenName?VisitsConfig.getEmbedCode(e.screenName):VisitsConfig.getEmbedCode()})),0==$("#printviewBtn").length&&$(".customPluswithImpotBtnCon").hide())},actions:{willTransition:function(e){if(e.data&&e.data.checkPermission){var t,r=featuresAvailable.NEXTGENUI_ENABLED?$(".left-bdy-modules-lst .lyteMenuActive").data("value"):$(".lyteMenuItems .lyteMenuActive").data("value"),s=e.pause(),i=e.info.route;if(!t)switch(r){case"Home":default:t=!0;break;case"Leads":"crm.tab.module.create"===i||"crm.tab.module.create.canvas"===i?t=Crm.userDetails.permissions.Crm_Implied_Create_Leads:"crm.settings.import"===i?t=Crm.userDetails.permissions.Crm_Implied_Import_Leads:"crm.settings.section.extensions.social-extensions"===i?t=!0:"crm.settings.section.webform.index-webform"===i?t=Crm.userDetails.permissions.Crm_Implied_Web_To_Leads:"crm.settings.section.email-parser.index-email-parser"===i||"crm.settings.section.extensions.zoho-extensions.visit"===i?t="Administrator"===Crm.userDetails.PROFILE_NAME:"crm.settings.section.extensions.google-extensions.google-contacts"===i&&(t=Crm.userDetails.permissions.Crm_Implied_Gcontact_Sync);break;case"Contacts":"crm.tab.module.create"===i||"crm.tab.module.create.canvas"===i?t=Crm.userDetails.permissions.Crm_Implied_Create_Contacts:"crm.settings.import"===i?t=Crm.userDetails.permissions.Crm_Implied_Import_Contacts:"crm.settings.section.telephony"===i?t=Crm.userDetails.permissions.Crm_Implied_Zoho_PhoneBridge_Integ:"crm.settings.section.email-settings"===i?t=Crm.userDetails.permissions.Crm_Implied_Zoho_Mail_Integ:("crm.settings.section.extensions.social-extensions"===i||"crm.settings.section.sales-signals"===i)&&(t=!0);break;case"Accounts":"crm.tab.module.create"===i||"crm.tab.module.create.canvas"===i?t=Crm.userDetails.permissions.Crm_Implied_Create_Accounts:"crm.settings.import"===i?t=Crm.userDetails.permissions.Crm_Implied_Import_Accounts:"crm.settings.section.modules.index-modules"===i&&(t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM);break;case"Potentials":"crm.settings.section.modules.module.layouts.view-layout"===i?t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM:"crm.tab.module.create"===i||"crm.tab.module.create.canvas"===i?t=Crm.userDetails.permissions.Crm_Implied_Create_Potentials:"crm.settings.import"===i?t=Crm.userDetails.permissions.Crm_Implied_Import_Potentials:"crm.tab.dashboards.index"===i&&(t=Crm.userDetails.permissions.Crm_Implied_View_Dashboards);break;case"Activities":"crm.tab.module.create"===i||"crm.tab.module.create.canvas"===i?t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM:"crm.settings.section.telephony"===i&&(t=Crm.userDetails.permissions.Crm_Implied_Zoho_PhoneBridge_Integ)}t?s.resume():(s.abort(),renderingUtils.displayPermissionDenied())}},didTransition:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].bindShortcutsAfterRender("Records View",!0),commonUtils.showHideLoadingDiv();var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.methods.hideContentLoader()}}}),Lyte.Router.registerRoute("crm.tab.module.create.canvas",{queryParams:["layoutId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","canvasview_model.js","custom_link_model.js","crm-canvas-create-router-util.js"],ResourceConstants.CRMClient)},getResources:function(){return Lyte.registeredMixins["crm-create-init-mixin"].downloadFormViewResources()},beforeModel:function(e){var t={intRoute:"create",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,canvasId:e.dynamicParam,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasBeforeModelHook(t)},model:function(e){var t={intRoute:"create",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,canvasId:e.dynamicParam,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasModelHook(t)},afterModel:function(e){var t={model:e};return this.canvasAfterModelHook(t)},renderTemplate:function(e){var t={model:e};return this.canvasRenderTemplateHook(t)},afterRender:function(e){var t={model:e};this.canvasAfterRenderHook(t)},beforeExit:function(){this.canvasBeforeExitHook()},didDestroy:function(e){var t={model:e};this.canvasDidDestroyHook(t)},actions:{willTransition:function(e){this.canvasWillTransitionHook(e,this.transition)},refreshRoute:function(){this.canvasRefreshRouteHook()}}},{mixins:["crm-create-mixin","crm-detailcanvas-utils","crm-formview-mixin","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery","crm-canvas-create-router-util","crm-create-route-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.create.canvas",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Crm.userDetails.isCanvasFormViewEnabled&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.createpage")+" ("+I18n.getMsg("crm.canvas.title")+")",unique_name:"module_create_canvas",handlers:["CanvasCreatePageHandler"],display_tag:!0,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.create.canvas:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}},{name:"CanvasCreate",label:"Canvas",key:"$dynamicParam:crm.tab.module.create.canvas:1",definition:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=document.querySelector("crm-detailview-oldeditor");if(r||(r=document.querySelector("crm-detailview-canvas")),r){var s=r.getData("currView")?r.getData("currView").id:r.getData("viewId"),i=store.peekRecord("canvasview",s);i&&t([{name:i.name,value:s}])}else app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}).then((function(e){var r=e.map((function(e){return{name:e.name,value:e.id}}));t(r)}))}))}}],page_info:function(e){return{name:"FormView",module:store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name}},preview_route:async function(e){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);let t=store.peekRecord("canvasview",e.CanvasCreate);if(t||await app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}),t=store.peekRecord("canvasview",e.CanvasCreate),t&&t.canvas_enabled)return{route:"crm.tab.module.create.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,e.CanvasCreate],queryParams:{layoutId:e.Layout}}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.label.field"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:()=>[{event:"onMandatoryFormLoad",args:["field"]}]},button:{name:I18n.getMsg("com.cscript.canvasbuttonevents","Canvas"),label:I18n.getMsg("zc.editor.button"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[],s=document.querySelector("crm-detailview-oldeditor");if(s){var i=s.getData("lastsavedmapping")||{},a=Object.keys(i),n=$(".zccbutton.zclayout").filter(":data(zcanvasdata)");r=n.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid&&a.indexOf(e.systemid)>-1)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var o=e.CanvasCreate;store.findRecord("canvasview",o).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Canvas Button"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("zc.editor.button"),list:()=>[{event:"onClick",args:[]}]},icon:{name:I18n.getMsg("com.cscript.iconevents"),label:I18n.getMsg("crm.canvas.editor.icon"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstaticicon ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Icon"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.canvas.editor.icon"),list:()=>[{event:"onClick",args:[]}]},text:{name:I18n.getMsg("com.cscript.textevents"),label:I18n.getMsg("crm.label.text"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstatictext ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Text"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.label.text"),list:()=>[{event:"onClick",args:[]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.create",{queryParams:["layoutId","wizardId","entityid","listRelationId","fillUpModule","redirect","assignment","fillupDataDetails"],getDependencies:function(e){var t=this.parent.getDynamicParam();if("Activities"===t||"Tasks"===t){"Activities"===t&&(t=this.parent.getQueryParams().sub_module);var r=this.parent.getQueryParams().layoutId;(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(t))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/Create.do?format=json&module="+t+(r?"&layoutId="+r:""),t)}return this.loadRouteDependencies(e,t)},getResources:function(e){var t={isCreate:!0,currentFeature:"create",getResourcesParams:e,moduleName:this.parent.getDynamicParam(),transitionData:this.transition.data};return this.getResourcesHook(t)},beforeModel:function(e){return this.beforeModelHook(this.getCreateRouteBasicDataProps(!0),this.transition.data,e.queryParams)},model:function(e){return this.modelHook(Object.assign({modelParams:e},this.getCreateRouteBasicDataProps(!0)),this.transition.data,e.queryParams)},afterModel:function(e){if(Crm.userDetails.isAccessibilityConfigSupported){var t=this.globalAccessibilityServices.getVariable("accessibility");this.transition.data.accessibilityObj=t}return this.afterModelHook(this.getCreateRouteBasicDataProps(),e,this.transition.data,this.getQueryParams())},redirect:function(){return this.redirectHook(this.getCreateRouteBasicDataProps())},actions:{willTransition:function(){if(LytePopup.components.length>0)for(var e=LytePopup.components,t=e.length,r=0;r<t;r++)!e[r].$node.id||"chat-popup"!==e[r].$node.id&&"selectpop"!==e[r].$node.id||e[r].setData("ltPropBindToBody",!1)}},renderTemplate:function(e,t){return this.renderTemplateHook(this.getCreateRouteBasicDataProps(!0),this.transition.data,e,t)},afterRender:function(e){if(Crm.userDetails.isAccessibilityConfigSupported&&!this.globalAccessibilityServices.getVariable("standardNavigationOrder")){var t=$L("crm-create-sections")[0];if(t){var r=t.querySelector("[data-tabindex]");r&&r.focus()}}this.afterRenderHook(this.getCreateRouteBasicDataProps(),e,this.transition.data)},didDestroy:function(){var e=this.component?this.component.querySelector("crm-create-layout"):void 0,t={lyteConvertionSupported:this.lyteConvertionSupported,formViewType:"create"};e&&(t.rectobeUnloaded=e.getData("dataBind"),t.currsubformApinames=e.getData("currsubformApinames")),this.didDestroyHook(t)},beforeExit:function(){this.beforeExitHook(Object.assign({wizardId:this.getQueryParams().wizardId},this.getCreateRouteBasicDataProps(!0)))},actions:{willTransition:function(e){this.willTransitionHook(Object.assign({nextTransition:e},this.getCreateRouteBasicDataProps()))},onError:function(e,t){this.onErrorActionHook({error:e,pausedTrans:t,lyteConvertionSupported:this.lyteConvertionSupported,formViewType:"create"})}}},{mixins:["crm-create-mixin","crm-create-mixin2","crm-create-route-mixin","crm-create-init-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.create",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.createpage")+" ("+I18n.getMsg("Standard")+")",unique_name:"module_create",handlers:["CreatePageHandler"],display_tag:!0,sequence:1,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.create:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:function(e){return{route:"crm.tab.module.create",dynamicParams:[e.Module],queryParams:{layoutId:e.Layout}}},page_info:function(e){return{name:I18n.getMsg("com.page.createpage"),module:store.peekAll("module").find((t=>t.module_name===e.Module)).api_name,layout_id:e.Layout}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}}}}},{enabled:function(){var e=Lyte.Router.getRouteInstance();return!(!e||"create"!==e.routeName||!e.transition.info.queryParams.wizardId)||store.peekAll("module").filter((e=>e.api_supported&&"team_based"!==e.access_type&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name))).filter((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]||"crm-cscript"===Lyte.Router.getRouteInstance().routeName)).length>0},name:I18n.getMsg("com.page.createpage")+" ("+I18n.getMsg("crm.label.widgets.WIZARD")+")",unique_name:"module_wizard_create",handlers:["WizardRecordPageHandler","CreatePageHandler"],display_tag:!0,sequence:8,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.create:0",definition:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_module_definitions(e)}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_layout_definitions(e)}},{name:"Wizard",label:I18n.getMsg("crm.label.widgets.WIZARD"),key:"$queryParam:wizardId",definition:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_definitions(e)}}],preview_route:async function(e){await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient));if(await Lyte.registeredMixins["crm-wizard-util-mixin"].isWizardAvailableForCurrentUser(e.Wizard,e.Layout,e.Module))return{route:"crm.tab.module.create",dynamicParams:[e.Module],queryParams:{layoutId:e.Layout,wizardId:e.Wizard}}},events:function(){return{page:{name:I18n.getMsg("crm.settings.wizard.cscript.wizardevent"),label:I18n.getMsg("crm.label.wizard"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("wizard")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}}}}}]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.canvas",{forceFetch:function(){return!0},queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","territory_id","filter_id","cross_filters","include_child","viewType"],getDependencies:function(){var e=[];return e=(e=e.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat(networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","canvasview_model.js","features_model.js","custom_link_model.js"],ResourceConstants.CRMClient))},getResources:function(){var e=["crm-list-view.js","crm-detailcanvas-utils.js","crm-skype-field.js","crm-upcoming-activity.js","crm-email-field.js","crm-phone-field.js","crm-tag.js","crm-canvasview.js","crux-textautocomplete-options.js","crm-canvas-helpers.js","crm-zexpense-rl.css","crm-zfinance-rl-all.css","crm-zfinance-stock-info.css","crm-subscription-rl.css","crm-inventory-detail-view.js","crm-feed-follower-datastore.js","crm-follower.js","crm-activity-rel-wrapper.js","crm-rl-users-list.js","crm-canvas-listview.js","crm-listview-canvas.js","crm-list-view-modal.js","lyte-colorpicker.js","crm-canvas-core.js","crm-fiscal-periods-util.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js"],t=["zohocrm_lookupBusinessCard.js"],r=[networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("scoringRulesChart")],s=[];return CScriptLib&&(e=e.concat(["crm-canvas-listview-cscript-handler.js"])),Crm.userDetails.RTL_ENABLED&&(e=e.concat(["crm-list-view-new-rtl.css"]),t=t.concat(["zcanvas-rtl.css"])),s=(s=(s=(s=(s=(s=s.concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-listview-canvas.css","crm-upcoming-activity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient))).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crm-stage-history.css","crux-boolean-component.css"],ResourceConstants.CRMClient)}])},beforeModel:function(e){if(!this.transition.data||!this.transition.data.reloadAll)return this.preFetchForCanvas(this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),this.getDynamicParam(),"ListView",this.transition.data,this.getQueryParams())},model:function(e){return this.transition.data&&this.transition.data.reloadAll?{}:this.FetchForCanvas(e,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),objectUtils.cloneObject(this.transition.data),!1,Lyte.Router.getRouteInstance(),"ListView")},afterModel:function(e){this.transition.info.dynamicParams[2];return this.transition.data&&this.transition.data.reloadAll?{}:this.postFetch(e,this.getQueryParams(),this.parent.parent.getDynamicParam())},renderTemplate:function(e,t){moduleRecordMapping[this.parent.parent.getDynamicParam()];var r=document.body.querySelector(".zc-iframe");r||((r=document.createElement("iframe")).classList.add("zc-iframe"),document.body.appendChild(r)),e.viewConfig={type:"CanvasView",view:this.getDynamicParam(),subtype:this.getQueryParams().viewType},window.CScriptLib&&CScript.Engine.Global.Init(),this.parent.currentModel.custom_view_data&&(e.layerBtn=this.parent.currentModel.custom_view_data.layerBtn),this.renderHTMLTemplate(e,t,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),this.transition.data)},afterRender:function(e,t){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].bindShortcutsAfterRender("Records View");let r=$L("#cscriptcreateaction");r.length>0&&r[0].remove(),void 0===Customization.canvasRefresh[this.parent.parent.getDynamicParam()]&&(Customization.canvasRefresh[this.parent.parent.getDynamicParam()]=!1),this.postRender(e,t,this.parent.getDynamicParam()),CScriptLib&&CScript.Engine.Global.dispatchEvent("onCustomViewLoad",null,{id:this.currentModel.cvId,name:this.currentModel.cv_name}),Crm.userDetails.RTL_ENABLED&&$(".crm-list-view-canvas-container").addClass("zc-rtl"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[moduleRecordMapping[e.module].plural_label,Crm.partnerName])),this._trackAjaxforListView(this.getQueryParams().viewType,"canvas view landed")},beforeExit:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"]&&Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].unbindShortcutsBeforeExit("Records View")},actions:{didTransition:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].bindShortcutsAfterRender("Records View"),this.currentModel.module&&(moduleRecordMapping[this.currentModel.module].custom_view.id=this.parent.getDynamicParam()),delete this.fromNavigator,delete this.clearselectedIds},getRecord:function(e,t,r,s,i){var a=Lyte.Router.getRouteInstance(),n={page:t,per_page:e};return a.getQueryParams().filter_id&&(n.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,n.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters),this.fetchCount=!1,this.fromNavigator=!0,this.fromPerpage=r,a.setQueryParams(n),!1},sortOrder:function(e,t,r){this.fetchCount=!1;var s=$L("crm-list-view-layer-canvas")[0].component;return"unsort"===t?(s.setData("selectedSortColumn","0"),s.setData("selectedSortOrder","asc")):(s.setData("selectedSortColumn",e),s.setData("selectedSortOrder",t)),this.setQueryParams({sort_by:e,sort_order:t,page:1,per_page:r}).data={clearCache:!0},!1},onError:function(e,t){if(e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1);var r=e.responseText.split("####")[1];this.displayLimitExceededPopup(r);var s=$L("crm-custom-filter")[0];s&&(s.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),customViewObject.filters=customViewObject.cross_filters=void 0}if(400===e.status){var i=JSON.parse(e.responseText);if("FEATURE_NOT_SUPPORTED"===i.code){var a=this.transition.info;return void this.replaceWith("crm.tab.module.custom-view.list",a.dynamicParams[0],a.dynamicParams[1])}if("INVALID_DATA"===i.code){var n=moduleRecordMapping[this.parent.parent.getDynamicParam()];function o(e){if("ALLVIEWS"===e.system_name)return e}return delete n.custom_view,store.findAll("custom_view",{module:n.api_name}).then((function(e){for(var t=$L("crm-cverror-page")[0],r=e.filter(o),s=r[0],i=r.length,a=0;a<i;a++)if(r[a].name.startsWith("All")){s=r[a];break}var c=s.display_value;t&&(t.setData("cvdisplayName",c),t.setData("module_name",n.module_name)),n.cvid=s.id,n.custom_view=s})),app.renderTemplate(this,{outlet:"#show",component:"crm-cverror-page"}),void this.transition.abort()}}this.handleError(this.parent.parent.getDynamicParam());var c=e.response?JSON.parse(e.response):void 0;if(!c||"COMPARATOR_LIMIT_EXCEEDED"!==c.code&&"DEPENDENT_MISMATCH"!==c.code&&"LOOKUP_LIMIT_EXCEEDED"!==c.code)return this.currentModel=e,!1;t.resume()},willTransition:function(e){"crm.tab.module.entity"!==e.info.route&&"crm.tab.module.entity.detail"!==e.info.route||!e.data||(e.data.FROM_INDEX=crmListView.getObject().fromIndex,e.data.TO_INDEX=crmListView.getObject().toIndex)}}},{mixins:["crm-view-utils","crux-filter-utils","crm-list-view-modal-util","crm-detailcanvas-utils","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.chart",{forceFetch:!0,queryParams:["filters","territory_id","filter_id","cross_filters","include_child","chart_id","cvid","module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-chart-view-initial.js"],ResourceConstants.CRMClient)},getResources:function(){return this.getChartViewResources(!0)},beforeModel:function(e){var t=this.transition.data;if(!t||!t.reloadAll)return this.preFetch(e.queryParams,this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),t)},model:function(e){if(crmHistory.transitionError)return this.currentModel;if(this.transition.data&&this.transition.data.reloadAll)return{};var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];app.prevTransition&&"crm.tab.module.entity.detail"===app.prevTransition.route&&t.custom_view&&"UNREADVIEWS"===t.custom_view.system_name&&(store.unloadAll(t.id),this.transition.data.clearselectedIds=!0),e.queryParams.chart_id&&t.$.set("chart_id",e.queryParams.chart_id);var r=t.module_name,s=!!this.$.model&&(!!this.$.model.isFromModal&&this.$.model.isFromModal),i=this.transition.data,a=!(!e.queryParams.chart_id&&!i.refreshTemplate&&this.prevModule===r&&t.chart_id&&!this.currentModel.cvDeletePage);return this.fetchDefaultView(e,r,Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),s,a)},afterModel:function(e){if(crmHistory.transitionError)return this.currentModel;if(this.transition.data&&this.transition.data.reloadAll)return{};var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];return t.chart_id||t.chart_view_supported||(this.transition.abort(),this.transitionTo("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam())),e.chart_views&&(t.chart_views=e.chart_views),this.postFetch(e,this.getQueryParams(),this.parent.parent.getDynamicParam())},lyteConvertionSupported:!0,renderTemplate:function(e){if(!1!==this.fetchCount){if(crmHistory.transitionError&&!this.currentModel.cvDeletePage&&!this.currentModel.errorOnModel)return;this.renderOuterComponentData(e)}},redirect:function(e){crmHistory.transitionError?this.handleError(this.parent.parent.getDynamicParam()):crmTab.putInCache(e.module,this.cachedObj)},afterRender:function(e,t){this.afterRenderChartView(e,t)},beforeExit:function(){var e=$("#show");thirdPartyUtils.unbindZohoCharts(e)},actions:{didTransition:function(){this.currentModel.module&&(moduleRecordMapping[this.currentModel.module].custom_view.id=this.parent.getDynamicParam()),delete this.clearselectedIds},willTransition:function(e){var t=$L("#listViewPopup")[0],r=$L("crm-chart-view")[0];t?t.component.closeModal():r&&r.getData("isRepublish")&&("crm.tab.module.custom-view.chart"!==e.target||this.prevModule!==e.info.dynamicParams[0]||e.data.reloadAll)&&(e.pause(),r.component.cancelChanges(e,r.component))}}},{mixins:["crm-chartview-utils","crm-view-utils","crm-dashboard-utils","crm-list-view-modal-util"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.kanban",{forceFetch:!0,queryParams:["filters","territory_id","sort_by","sort_order","layout_id","filter_id","cross_filters","include_child","pipeline","kvId","action"],getDependencies:function(){return this.getKanbanDependencyFiles()},getResources:function(){return this.getKanbanResourcesFiles(this.parent.parent.getDynamicParam())},beforeModel:function(e){if(Crm&&Crm.userDetails&&Crm.userDetails.CLIENT_ACCOUNT&&(this.transition.abort(),this.transitionTo("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam())),!this.transition.data||!this.transition.data.reloadAll){if(featuresAvailable.NEXTGENUI_ENABLED){var t=document.querySelector("crm-left-menu-loader").component;t.setData("view","kanban");var r=setTimeout((function(){t.executeMethod("showLoaderBasedOnView",t)}),2e3),s=document.querySelector("crm-left-menu").component;s.methods.clearLoaderTimeout(),s.setData("loaderTimeout",r)}return this.preFetchKanban(e.queryParams,this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),this.transition.data)}},model:function(e){if(this.transition.data&&this.transition.data.reloadAll)return{};this.isRecordFetched=!1;var t=this.parent.parent.getDynamicParam(),r="Potentials"===t?"Deals":t,s=this.transition.data?objectUtils.cloneObject(this.transition.data):{};return this.fetchKanban(e.queryParams,r,this.parent.getDynamicParam(),s)},afterModel:function(e,t){return customViewObject&&customViewObject.collapseStages&&customViewObject.collapseStages.length>0&&(e.collapseStages=customViewObject.collapseStages),customViewObject&&customViewObject.hasOwnProperty("userLevelConfig")&&e&&(e.userLevelConfig=customViewObject.userLevelConfig),this.transition.data&&this.transition.data.reloadAll?{}:this.postFetchKanban(e,this.getQueryParams(),this.parent.parent.getDynamicParam(),this.transition.data)},lyteConvertionSupported:!0,renderTemplate:function(e){var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];if(e.showKanbanPopup||t.kanban_view||(t.$.set("default_view",{name:"kanban_view",id:t.custom_view.id}),t.$.set("kanban_view",!0),t.$.set("zia_view",!1),t.$.set("canvas_view",!1),t.$.set("chart_view",!1)),e.showKanbanPopup&&e.isCustomizationPermissionAvailable){if(this.setKanbanSettingsData(t,e),crmListView.kanbanSettingData=e,!crmHistory.length||e.showNewKanbanPopup)return void this.replaceWith("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam());moduleRecordMapping[this.parent.parent.getDynamicParam()].$.set("kanban_view",!1),this.transition.abort(),history.back()}else if(e.showKanbanPopup&&!e.isCustomizationPermissionAvailable)return void this.replaceWith("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam());if(-1===["Activities","Visits"].indexOf(e.module)&&(e.isKanbanView=t.kanban_view,e.isStageView=t.stage_view),!e.isStageView&&!e.isKanbanView)return this.transition.abort(),void this.transitionTo("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam());"Calls"===e.module&&(e.unaccountedVisibilitySupport=!0),-1!==["Activities","Tasks","Calls","Events","Appointments","Visits"].indexOf(e.module)&&(e.hideCreateRecFooter=!0),-1===["Visits","Activities"].indexOf(e.module)&&(e.isStageView=t.stage_view?t.stage_view:t.kanban_view,t.$.set("stage_view",e.isStageView),this.setKanbanDataFromRoute(e)),this.cachedObj&&this.cachedObj.selectedIds&&this.cachedObj.selectedIds.length>0&&(this.currentModel.selectedIds=this.cachedObj.selectedIds),commonUtils.showHideLoadingDiv();var r=this.getQueryParams();this.setDataFromRoute(e,this.parent.getDynamicParam(),r),this.currentModel.pipeline=r.pipeline,this.parent.currentModel.custom_view_data&&(this.currentModel.layerBtn=this.parent.currentModel.custom_view_data.layerBtn),this.currentModel.search_letter=e.searchletter,this.currentModel.customViewHeader=e.heading,this.currentModel.viewType="kanban",this.currentModel.filterQueryParams={filters:r.filters,cross_filters:r.cross_filters,filter_id:r.filter_id},this.currentModel.queryParamObject=this.currentModel.queryParamObject?this.currentModel.queryParamObject:{},this.parent.currentModel.custom_view_data&&(this.currentModel.queryParamObject.layerBtn=this.parent.currentModel.custom_view_data.layerBtn),this.currentModel.queryParamObject.filterQueryParams={filters:r.filters,cross_filters:r.cross_filters,filter_id:r.filter_id};var s=!!this.transition.data.reRender,i=$L("crm-kanbanview-component")[0];i&&i.setData("preventBoardDetailObserver",!0),this.transition.data.isFilterApply?i&&!i.component.getData("categorizeByDeleted")&&($L(".lyteKanbanviewScrollDivSelector")[0].scrollLeft=0):s=!0,Crm.userDetails.isMultipleKanbanViewsEnabled&&i&&(i.setData("kanbanId",e.kvId),i.setData("setKanbanData",!0)),this.transition.data.isKvSelected&&(s=!1);var a=$L("crm-customview-layer");a[0]&&(a=a[0].component,e&&e.categoryField&&"STAGE"===e.categoryField.column_name&&e.Pipelines?a.setData("showPipeline",!0):a.setData("showPipeline",!1)),app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box",reRender:s})},afterRender:function(e,t){return this.afterRenderKanban(e,t)},beforeExit:function(){_cruxUtils.removeCustomAlert()},actions:{willTransition:function(e){if(!("crm.tab.module.entity"!==e.target&&"crm.tab.module.entity.detail"!==e.target||"Activities"!=this.parent.parent.getDynamicParam()&&"Tasks"!==this.parent.parent.getDynamicParam()&&"Events"!==this.parent.parent.getDynamicParam()&&"Calls"!==this.parent.parent.getDynamicParam())){var t=e.info.dynamicParams[1],r=$("#recordid_"+t).attr("name");this.savekanbanData&&(this.savekanbanData.Closed=this.currentModel,e.kanbanData=this.savekanbanData[r]),e.column_name=r,Crm.kanbanObj={column_name:r,kanbanData:e.kanbanData}}},didTransition:function(){this.currentModel.module&&(moduleRecordMapping[this.currentModel.module].cvid=this.parent.getDynamicParam()),delete this.cachedObj},onError:function(e,t){if(_cruxUtils.removeCustomAlert(),e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1);var r=e.responseText.split("####")[1];this.displayLimitExceededPopup(r);var s=$L("crm-custom-filter")[0];s&&(s.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),customViewObject.filters=customViewObject.cross_filters=void 0}return this.currentModel=e,this.handleError(this.parent.parent.getDynamicParam()),!!(e.response&&e.response.indexOf('{"param_name":"cvid"}')>-1)&&(featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),this.renderHTMLTemplate({cvDeletePage:!0},null,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),this.transition.data),this.transition.abort())}}},{mixins:["crm-view-utils","crux-filter-utils","crm-kanban-mixin","crm-kanbanview-util"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.list",{forceFetch:!0,queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","search_field","territory_id","filter_id","cross_filters","include_child"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-view.js","crm-detail-view-services.js","crm-column-list.js","crm-list-view-modal.js","crm-inner-list.js","servapp_preferences_model.js","canvasview_model.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient);if(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","crm-list-view-crux.css","crm-image-upload-ziaError.css","crm-listview-relatedfields-popover.css","crm-inner-list-new.css","crux-tag.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css"],ResourceConstants.CRMClient))),CScriptLib&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-listview-cscript-handler.js"],ResourceConstants.CRMClient))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_finance_suite.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("listview"),networkUtils.getI18nJSUrl("activitydepbanner")],ResourceConstants.CRM)),e=(e=isnewCalendarBookingEnabled?e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM)):e).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")],ResourceConstants.CRM)),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE){var t=[];t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js","crm-zia-smart-prompt.js","crm-zia-smart-prompt-store.js","note_model.js","lyte-draggable.js","lyte-resize.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SmartPrompt")],ResourceConstants.CRM)),e=e.concat(t)}return e},beforeModel:function(e){var t=this.transition.data;if(!t||!t.reloadAll){if(featuresAvailable.NEXTGENUI_ENABLED){var r=document.querySelector("crm-left-menu-loader").component;r.setData("view","list");var s=setTimeout((function(){r.executeMethod("showLoaderBasedOnView",r)}),2e3),i=document.querySelector("crm-left-menu").component;i.methods.clearLoaderTimeout(),i.setData("loaderTimeout",s)}return this.preFetch(e.queryParams,this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),t)}},model:async function(e){if(crmHistory.transitionError)return this.currentModel;if(this.transition.data&&this.transition.data.reloadAll)return{};var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];if(app.prevTransition&&"crm.tab.module.entity.detail"==app.prevTransition.route&&t.custom_view&&"UNREADVIEWS"==t.custom_view.system_name&&(store.unloadAll(t.id),this.transition.data.clearselectedIds=!0),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&t&&(t.parent_module&&"Orchestration"===t.parent_module.api_name||"Campaigns"===t.api_name)&&(!store.peekAll("orchestration_process")||!store.peekAll("orchestration_process").length))try{Crm.userDetails.permissions.Crm_Implied_Manage_ABM?await store.findAll("orchestration_process",{category:"abm"}):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&await store.findAll("orchestration_process")}catch(e){murphy.error(e)}return this.fetch(e,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),objectUtils.cloneObject(this.transition.data),!1,Lyte.Router.getRouteInstance())},afterModel:function(e){return crmHistory.transitionError?this.currentModel:this.transition.data&&this.transition.data.reloadAll?{}:(e&&(e.showLastAddedNote=!0),this.postFetch(e,this.getQueryParams(),this.parent.parent.getDynamicParam()))},redirect:function(e,t){if(crmHistory.transitionError)this.handleError(this.parent.parent.getDynamicParam());else{var r=moduleRecordMapping[this.parent.parent.getDynamicParam()];r.$.set("chart_view",!1);var s=t.queryParams;if(this.currentModel&&!window.clientPortalName&&(e&&e.show_begin_page&&Lyte.Component.registeredHelpers.showAddRecord(e.module)||e&&e.data_waiting_for_approval)&&("Visits"==e.module&&!s.filter_id&&!s.filters&&!s.cross_filters||"Visits"!=e.module)){if(this.currentModel.module_info=r,"null"!=e.canvasid&&e.isCustomizedView&&"Leads"==e.module||"Contacts"==e.module||"Accounts"==e.module||"Products"==e.module)moduleRecordMapping[e.module].$.set("viewid",e.canvasid);e.isFromModuleInfo=!0,e.skipRedirect=!0,e.data_waiting_for_approval?e.data_waiting_for_approval=!0:e.showBlankState=!0,e.module_name=this.parent.parent.getDynamicParam(),delete e.show_begin_page,e.portal_name=this.cachedObj.screenName=this.portalName,crmTab.putInCache(e.module_name,this.cachedObj),this.replaceWith("crm.tab.module.begin",r.module_name).response=e}}},lyteConvertionSupported:!0,renderTemplate:function(e,t){if(this.currentModel=this.currentModel?this.currentModel:{},!crmHistory.transitionError||this.currentModel.cvDeletePage||this.currentModel.errorOnModel){CScriptLib&&CScript.Engine.Global.Init(),this.parent.currentModel.custom_view_data&&(e.list_cv_btn=this.parent.currentModel.custom_view_data.list_cv_btn,e.related_lists=this.parent.currentModel.custom_view_data.related_lists,e.layerBtn=this.parent.currentModel.custom_view_data.layerBtn),this.renderHTMLTemplate(e,t,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),this.transition.data);this.isRecordFetched}},afterRender:function(e,t){featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),this.postRender(e,t,this.parent.getDynamicParam()),CScriptLib&&!Lyte.Router.getRouteInstance().prevent_cscript_onLoad&&CScript.Engine.Global.dispatchEvent("onCustomViewLoad",null,{id:this.currentModel.cvId,name:this.currentModel.cv_name}),CScriptLib&&(Lyte.Router.getRouteInstance().prevent_cscript_onLoad=void 0),setTimeout((function(){var e=$L("#listcrux");Crm.userDetails.isAccessibilityConfigSupported&&!Lyte.Service.getInjected("globalAccessibilityServices").getVariable("standardNavigationOrder")&&e&&e[0]&&e.focus()}),800)},beforeExit:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"]&&Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].unbindShortcutsBeforeExit("Records View"),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&Lyte.Component.render("crm-zia-smart-prompt",{},"#show")},actions:{onError:function(e,t){featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),this.currentModel=e;var r=$L("crm-customview-layer")[0];r&&r.setData("show_loading",!1);var s=e.response?JSON.parse(e.response):void 0;!s||"COMPARATOR_LIMIT_EXCEEDED"!==s.code&&"DEPENDENT_MISMATCH"!==s.code&&"LOOKUP_LIMIT_EXCEEDED"!==s.code?crmHistory.transitionError=!0:this.handleError(this.parent.parent.getDynamicParam()),t.resume()},sortOrder:function(e,t,r){return this.fetchCount=!1,this.setQueryParams({sort_by:e,sort_order:t,page:1,per_page:r}).data={clearCache:!0},!1},getRecord:function(e,t,r){var s=Lyte.Router.getRouteInstance(),i={page:t,per_page:e};return s.getQueryParams().filter_id&&(i.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,i.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters),this.fetchCount=!1,this.fromNavigator=!0,this.fromPerpage=r,s.setQueryParams(i),!1},didTransition:function(){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].bindShortcutsAfterRender("Records View"),this.currentModel.module&&!this.currentModel.cvDeletePage&&(moduleRecordMapping[this.currentModel.module].cvid=this.parent.getDynamicParam()),delete this.currentModel.cvDeletePage,delete this.portalName,delete this.fromNavigator;var e=Crm.userDetails.isMultipleKanbanViewsEnabled,t=crmListView.kanbanSettingData;t&&(!e&&t.showKanbanPopup||e&&t.showNewKanbanSetting)&&(delete t.showNewKanbanSetting,this.handleKanbanSettingPopup());var r=this.transition.data;if(r.showTvSettings){r.showTvSettings=!1;var s=$L("crm-timeline-view-settings");s.length&&s[0].remove();var i=moduleRecordMapping[this.parent.parent.getDynamicParam()],a={moduleName:i.module_name,moduleInfo:i,cvId:this.parent.getDynamicParam(),showTvSettingsPopup:!0,isSettingsCreate:!0};Lyte.Component.render("crm-timeline-view-settings",a,"#show")}},willTransition:function(e){if(LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,s=0;s<r;s++)t[s].$node&&t[s].$node.id&&"rsoExpiredPopUp"===t[s].$node.id&&t[s].setData("ltPropShow",!1);"crm.tab.module.entity"!=e.info.route&&"crm.tab.module.entity.detail"!==e.info.route||!e.data||(e.data.FROM_INDEX=crmListView.getObject().fromIndex,e.data.TO_INDEX=crmListView.getObject().toIndex)}}},{mixins:["crm-view-utils","crux-filter-utils","crm-list-view-modal-util"]}),app.cscript_registry({route_name:"crm.tab.module.custom-view.list",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.listpage","Standard"),unique_name:"module_list",handlers:["ListViewHandler"],display_tag:!1,sequence:4,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.custom-view.list:0",definition:function(){return new Promise((function(e){var t=store.peekAll("module");e(t=t.filter((function(e){return e.api_supported&&"team_based"!==e.access_type&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&"Appointments__s"!==e.api_name&&"Services__s"!==e.api_name&&"Forecasts"!==e.api_name&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name)})).map((function(e){return{name:e.plural_label,value:e.module_name}})))}))}}],preview_route:function(e){return{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid]}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:()=>[{event:"onCustomViewLoad",args:["custom_view"]},{event:"onBeforeCustomViewChange",args:["custom_view"]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.timeline",{forceFetch:!1,queryParams:["filters","territory_id","sort_by","sort_order","filter_id","cross_filters","include_child","action"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-timeline-view-initializer.js","holidays-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-timeline-view.js","lyte-draggable.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-custom-view.js","crm-list-helpers.js","crm-create-mixin.js","business_hours-model.js","crm-chart-view-initial.js","crm-validation-rule-error.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css","crux-smart-filter.css","crm-timeline-view.css","lyte-timeline-view.css","lyte-follower.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","custom-view-layer-new.css","custom-view-layer-common.css","crm-list-view-crux.css","lyte-timeline-view-dependency.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timelineview")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(t)},beforeModel:function(e){var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];return this.moduleInfo=t,this.moduleName=t.module_name,(this.prevModule!==t.module_name||this.transition.data.refreshTemplate)&&(store.unloadAll("timeline_view"),store.unloadAll("record_locking_configurations")),store.unloadAll(t.id),this.preFetchTimeline(e,this)},model:function(e){return e.queryParams.page=1,this.fetchTimelineRecords(e,this.moduleName,this.transition.info.dynamicParams[1],this.viewConfig)},afterModel:function(e){return e.module=this.moduleName,e.customview_records=e.cv_records,e.viewConfig=this.viewConfig?this.viewConfig:{},this.postFetch(e,this.getQueryParams(),this.parent.parent.getDynamicParam())},lyteConvertionSupported:!0,renderTemplate:function(e){var t=this.moduleInfo;Crm.userDetails.fetchCountValues&&(this.triggerRecordCount=!0);const r=store.peekRecord("custom_view",this.parent.getDynamicParam());e.viewType="timeline",e.sortColumnString=r.sort_by?r.sort_by.id:null,e.sortOrderString=r.sort_order?r.sort_order:"asc";var s=t.fields.filter((function(e){return e.visible&&-1===[17,9].indexOf(e.show_type)&&(0!==e.show_type||"FULLNAME"===e.column_name)&&("QUALIFICATIONDURATION"!==e.column_name||"Leads"!==t.module_name)&&-1===[41,123,1234,444,445,500,555,556,104,66,250].indexOf(e.ui_type)&&e.available_in_user_layout&&"SENDNOTIFICATION"!==e.column_name}));e.sortFields=s.sort(((e,t)=>e.field_label.toLowerCase()>t.field_label.toLowerCase()?1:e.field_label.toLowerCase()<t.field_label.toLowerCase()?-1:0)),e.layerBtn=this.parent.currentModel.layerBtn,(t=moduleRecordMapping[e.module]).$.set("kanban_view",!1),t.$.set("chart_view",!1),Crm.userDetails.CLIENT_ACCOUNT||(t.$.set("canvas_view",!1),t.$.set("card_view",!1),t.$.set("table_view",!1)),t.$.set("timeline_view",!0),this.setDataFromRoute(e,this.parent.getDynamicParam(),this.getQueryParams()),customViewObject=e;var i=!1;"timeline"===Lyte.Router.getRouteInstance().routeName&&this.prevModule===this.moduleName||(i=!0),this.prevModule=this.moduleName,app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box",reRender:i})},afterRender:function(e){var t=$L("#KanbanViewSortColumnDropdown")[0],r=$L("#KanbanViewSortOrderDropdown");e.sortColumnString?(t.ltProp("selected","0"),t.ltProp("selected",e.sortColumnString),r[0].ltProp("selected",e.sortOrderString),r.removeClass("nlvDisableOption")):r.addClass("nlvDisableOption");var s=this.getQueryParams(),i=$L("crm-custom-filter");i[0]&&i[0].setData("filterQueryParams",{filters:s.filters,cross_filters:s.cross_filters,filter_id:s.filter_id}),e.filterQueryParams={filters:s.filters,cross_filters:s.cross_filters,filter_id:s.filter_id},crmTab.putInCache(e.module,e);var a=$L("#cscriptcreateaction");a.length>0&&a[0].remove(),app.store.makeRequest("findAll","layout",{module:e.module_info.api_name},!0,!0,{apiVersion:"2.2",moduleSet:!0})},beforeExit:function(){_cruxUtils.removeCustomAlert()}},{mixins:["crm-view-utils","crm-timeline-view-utils"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.zia",{forceFetch:!0,queryParams:["filters","territory_id","sort_by","sort_order","layout_id","filter_id","cross_filters","include_child"],model:function(e){if(this.transition.data&&this.transition.data.reloadAll)return{};this.isRecordFetched=!1;var t=objectUtils.cloneObject(this.transition.data),r=moduleRecordMapping[this.parent.parent.getDynamicParam()],s={};s.module=r.module_name;var i=moduleRecordMapping[r.module_name];0==r.zia_view&&i.$.set("zia_view",!0),1==r.kanban_view&&i.$.set("kanban_view",!1),r.canvas_view&&i.$.set("canvas_view",!1),(c=e.queryParams).filter_id&&delete c.filter_id;var a=!!c.filters&&this.parse_Nested_Json(c.filters);if(a&&this.isOldCriteria(a))try{var n=this.oldCriteria_to_newCriteria(a,this.getRouteInstance().transition.info.dynamicParams[0]);return n||(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete c.filters),c.filters=!!n.filters&&JSON.stringify(n.filters),n.cross_filters&&(c.cross_filters=JSON.stringify(n.cross_filters)),this.transition.abort(),void(this.setQueryParams(c).data={clearCache:!0})}catch(e){this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete c.filters}if((c.filters||c.cross_filters||c.filter_id)&&i&&i.id&&store.model[i.id]&&store.unloadAll(i.id),"Potentials"!=s.module&&"Leads"!=s.module||!crmTab.getFromCache(s.module)||t.clearCache||crmTab.getFromCache(s.module).cvId!=this.parent.getDynamicParam()?(delete t.cachedData,delete t.fetchOnlyBody):t.cachedData=crmTab.getFromCache(s.module),t.fetchOnlyBody&&(this.fetchOnlyBody=!0),this.td=t,t.cachedData&&t.clearselectedIds&&(t.cachedData.selectedIds=[]),delete t.clearselectedIds,delete t.clearCache,t&&!t.cachedData){for(var o in s.isload=!0,t)"refreshTemplate"!=o&&(s[o]=t[o]);var c;if(s.normListView=!1,s.predictview=!0,s.cvid=this.transition.info.dynamicParams[1],c=e.queryParams)for(var l=0;l<this.queryParams.length;l++){c[o=this.queryParams[l]]&&("filter_id"==o?s.filterId=c[o]:"filters"==o||"cross_filters"==o?(s[o]=c[o],s.isNewFilter=!0):"include_child"==o&&(s.includechild=1),"territory_id"==o&&(s.territoryId=c[o]),"layout_id"==o&&(s.layoutId=c[o]))}var d={params:s};return this.isRecordFetched=!0,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",d)}return t.cachedData},afterModel:function(e,t){if(this.transition.data&&this.transition.data.reloadAll)return{};if("string"==typeof e)this.replaceWith("crm.tab.module.index-module",Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam()).response={model:e,skipRedirect:!0};else if(this.td&&!this.td.cachedData){if(1==e.showBlankState)e.isFromModuleInfo=!0,this.replaceWith("crm.tab.module.begin",e.module).response=e}var r=this.getQueryParams();this.cachedObj.filters=e.filters=r.filters?JSON.parse(r.filters):void 0,this.cachedObj.cross_filters=e.cross_filters=r.cross_filters?JSON.parse(r.cross_filters):void 0},renderTemplate:function(e){this.currentModel.actions=moduleRecordMapping[e.module].actions,this.currentModel.module_name=e.module,this.currentModel.search_letter=e.searchletter,this.currentModel.module_info=moduleRecordMapping[e.module],this.currentModel.cvid=moduleRecordMapping[e.module].cvid,this.setDataFromRoute(e);var t=this.getQueryParams();this.currentModel.filterQueryParams={filters:t.filters,cross_filters:t.cross_filters,filter_id:t.filter_id},app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box"})},afterRender:function(e){var t=crmTab.getFromCache(e.module);if(!0===e.isPredictView&&this.fetchOnlyBody&&t){t.selectedIds=e.selectedIds,t.heading=e.heading,t.filters=e.filters,t.cross_filters=e.cross_filters,t.predictData=e.predictData,t.stageBoards=e.stageBoards,t.stageSize=e.stageSize,t.layoutId=e.layoutId,t.sortColumnString=e.sortColumnString,t.sortOrderString=e.sortOrderString,crmTab.putInCache(e.module,t);var r=this.transition.data;if((r.isload&&"true"==r.isload||r.refresh&&"true"==r.refresh)&&!0,$("#lv_stageview").html(Handlebars.templates.stageView(t)),crmListView.afterRenderStageView(t),t.filterId!==e.filterId&&(e.filterId||0===$("#lv_filter_save_opt:visible").length)&&($(".filter_listcontent").removeClass("f_listclick-view"),t.filterId=e.filterId,t.filterId)){crmListView.setFiltersToDefaultState();var s={filters:e.filters,filterId:e.filterId};crmTab.putFiltersInCache(e.module,s),r.filters=JSON.stringify(crmTab.getFiltersFromCache(r.module).filters),crmListView.renderSelectedFilters(t,s),$L("#lv_filter_scroll").scrollTop(0)}e.fetchCountValues&&showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false")}else crmListView.createTemplate(e);crmTab.putInCache(e.module,e);e.isload&&"true"==e.isload||e.refresh&&e.refresh,null!=e&&e.isPredictView&&!e.showBlankState?crmListView.loadPredictSummary():e.showBlankState||($("#tab_Activities img").attr("src",networkUtils.getImageUrl("listview-task-deactive.png",ResourceConstants.CRM)),$("#changer img").attr("src",networkUtils.getImageUrl("listview-task-kanban-active.png",ResourceConstants.CRM))),crmNavig.parseCurrentListView()},beforeModel:function(){if(!this.transition.data||!this.transition.data.reloadAll){this.fetchOnlyBody=!1;this.transition.data;var e=crmTab.getFromCache(this.parent.parent.getDynamicParam());return this.cachedObj=e||{},this.makeCustomViewRequest(this.parent.getDynamicParam(),this.parent.parent.getDynamicParam())}},actions:{didTransition:function(){this.handleKanbanSettingPopup(),delete this.cachedObj},onError:function(e,t){if(e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1),Search.displayLookupExceedsMsg(e);var r=$L("crm-custom-filter")[0];r&&(r.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1})),customViewObject.filters=customViewObject.cross_filters=void 0}return this.currentModel=e,this.handleError(this.parent.parent.getDynamicParam()),!1}}},{mixins:["crm-view-utils","crux-filter-utils"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view",{forceFetch:function(){if(this.transition.info.queryParams.filters){var e=this.transition.info.queryParams,t=JSON.parse(e.filters),r=0,s=t.length;for(r=0;r<s;r++)if(t[r]&&"tag"==t[r].searchfieldtype)return this.isOldTagCriteria=t[r],!1}return!0},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-view.js","crm-ui-loaders.js","crm-custom-filter.js","crm-custom-button-wrapper.js","crm-vision-helper.js","crm-list-helpers.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","scoringrules_store.js","crm-customview-helpers.js","crm-tag-modal.js","crm-tag-helpers.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-tag-mixin.js","crm-page-navigator.js","crux-criteria-conditions.js","crux-lookupfilter-component.js","crux-column-list.js","assignment_threshold_model.js","crm-territory-common-utils.js","crm-lookuplimit-exceed-popup.js"],ResourceConstants.CRMClient),t=this.transition.info.dynamicParams[0];if(-1===t.indexOf("Orchestration")&&-1===t.indexOf("PathFinder"))e=e.concat(networkUtils.returnDependencyFiles(["pathfinder_meta_model.js"],ResourceConstants.CRMClient));Crm.seriesEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["series_store.js"],ResourceConstants.CRMClient))),e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["automation_datahub_module.js","kiosk-execute.js","zia-insights.js","kiosk-pb-builder-output.js","kiosk-associate-record-pop.js","crm-emailconversation-view-helpers.js","lyte-fileupload.js","kiosk-file-api.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zlib_phonenumber.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["kiosk-common.css","kiosk-associate-record-pop.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient)));var r=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css","custom-view-layer-common.css","crm-page-navigator.css"],ResourceConstants.CRMClient);if(r=(r=r.concat(networkUtils.returnDependencyFiles(["custom-view-layer-new.css","crm-ui-loaders.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))),"Services"!=this.parent.getDynamicParam()&&"Appointments"!==this.parent.getDynamicParam()||(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("ServiceEntityKeys")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient))),Crm.isCpqActivated()&&moduleRecordMapping.Quotes&&this.parent&&this.parent.parent&&this.parent.getDynamicParam()===moduleRecordMapping.Quotes.module_name){var s=networkUtils.returnDependencyFiles(["crm-cpqdashboard.js"],ResourceConstants.CRMClient);s=(s=(s=s.concat(networkUtils.returnDependencyFiles(["crm-cpqdashboard.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM)),e=e.concat(s)}!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("abmsmartfilter")],ResourceConstants.CRM))),e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),this.parent&&this.parent.getDynamicParam()&&("Leads"===this.parent.getDynamicParam()||"Contacts"===this.parent.getDynamicParam())&&moduleRecordMapping&&moduleRecordMapping[this.parent.getDynamicParam()]&&moduleRecordMapping[this.parent.getDynamicParam()].isCompetitorMentionEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CompetitorAlertsSmartFilter")],ResourceConstants.CRM))),e=e.concat(networkUtils.returnDependencyFiles(["crm-custom-button.js"],ResourceConstants.CRMClient));var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation_custom")],ResourceConstants.CRM);return i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking"),networkUtils.getI18nJSUrl("MassTools"),networkUtils.getI18nJSUrl("listview"),networkUtils.getI18nJSUrl("voccustomization")],ResourceConstants.CRM)),Crm.userDetails.activityBadgeUpgradeEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-listpage-components.js"],ResourceConstants.CRMClient)),i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workqueue")],ResourceConstants.CRM)),r=r.concat(networkUtils.returnDependencyFiles(["crm-listpage-components.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e.concat(networkUtils.returnDependencyFiles(["zohocrm_customView.js","zohocrm_changeOwner.js","zohocrm_ProcessFlow.js","zohocrm_phoneNumbers.js"],ResourceConstants.CRM)).concat(r).concat(i)},getDependencies:function(){var e=[];return e.push(networkUtils.returnDependencyFiles(["feature-supported-modules.js"],ResourceConstants.CRMClient)),!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&e.push(networkUtils.returnDependencyFiles(["crm-abm-configuration.js"],ResourceConstants.CRMClient)),e},model:function(){if(this.transition.data&&this.transition.data.reloadAll)return{};var e,t=this.parent.getDynamicParam(),r=moduleRecordMapping[t],s=r?r.child_module:[];if(void 0!==s)for(var i=-1,a=s.length;++i<a;){var n=moduleRecordMapping[s[i].module_name];if(n&&"subform"===n.generated_type&&n.parent_module&&t===n.parent_module.module_name){e=!0;break}}if(!0===e){var o=store.peekAll("layout",{module:r.api_name}).filter((e=>{if(e.module)return e.module.api_name===r.api_name}));if(o&&o.length>0){a=o.length,i=-1;for(e=!1;++i<a;)if(!o[i].sections){e=!0;break}}}return Lyte.resolvePromises({import_supported_modules:store.findAll("feature_supported_modules",{feature_name:"import"},!0).then((function(e){return e})).catch((function(){return"INTERNAL_ERROR"})),layouts:e?store.findAll("layout",{module:r.api_name},!0,void 0,{apiVersion:"2.2"}).then((function(e){return e})).catch((function(){return"INTERNAL_ERROR"})):[],custom_view_data:this.getCustomViewData(t,this.getDynamicParam(),this.transition)})},afterModel:function(e){if(crmHistory.transitionError)return{};var t=this.parent.getDynamicParam();try{!Crm.userDetails.lastAccessedTimeofModuleForMobile||app.prevTransition&&app.prevTransition.route&&-1!==app.prevTransition.route.indexOf("crm.tab.module.custom-view")&&app.prevTransition.dynamicParams[0]===this.transition.info.dynamicParams[0]||this.updateLastAccessedTime(t)}catch(e){murphy.error(e)}if(this.transition.data&&this.transition.data.reloadAll)return{};e.module_name=t,e.module_info=moduleRecordMapping[t],e.module_info&&(e.actions=moduleRecordMapping[t].actions),e.cvid=this.getDynamicParam(),e.saved_filters=[],this.currentModel&&this.currentModel.custom_view_data&&(e.related_lists=this.currentModel.custom_view_data.related_lists),this.currentModel.custom_view_data&&this.currentModel.custom_view_data.saved_filters&&(e.saved_filters=this.currentModel.custom_view_data.saved_filters)},redirect:function(){},afterRender:function(){var e=$(".cvBtnHeader").hasClass("topFixed");if("Potentials"!=this.parent.getDynamicParam()&&"Visits"!=this.parent.getDynamicParam()||Crm.trackSpotLightAction(this.parent.getDynamicParam()+" - Page Visited"),e){var t=$("#cvpadding").outerHeight();$L(window).scrollTo(0,t)}else null==Crm.latestEntId&&$L(window).scrollTo(0,0);var r=networkUtils.returnDependencyFiles(["crm-mass-actions.js","lyte-hovercard.js","crm-mass-action-mixin.js","pipeline_picklist_model.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles(["crm-mass-action.css","crm-lookuplimit-exceed-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(r),cruxAssets&&Crm.userDetails.multiSelectFilterOptions&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!0,cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist="picklist"),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&Lyte.Component.render("crm-zia-smart-prompt",{},"#show")},actions:{onError:function(e,t){t.resume()},onBeforeLoad:function(){var e=$L("crux-alert");if(e&&e[0]&&e[0].component&&e[0].component.data&&e[0].component.data.cxPropSecondaryMessage){var t=e[0].component.data.cxPropSecondaryMessage;(t.includes("Formula field(s) that are set to auto-refresh cannot be used in Saved filter")||t.includes("cannot be used in Custom View Criteria as it is set to auto-refresh"))&&_cruxUtils.removeCustomAlert()}},didTransition:function(){this.transition.data&&(delete this.transition.data.clearCache,delete this.transition.data.clearselectedIds)},willTransition:function(e){0==e.target.indexOf("crm.tab.module.actions")&&(store.clearCachedQuery("layout"),crmTab.deleteFromCache(this.parent.getDynamicParam()));var t=$L("crux-alert");if(t&&t[0]&&t[0].component&&t[0].component.data&&t[0].component.data.cxPropSecondaryMessage){var r=t[0].component.data.cxPropSecondaryMessage;(r.includes("Formula field(s) that are set to auto-refresh cannot be used in Saved filter")||r.includes("cannot be used in Custom View Criteria as it is set to auto-refresh"))&&_cruxUtils.removeCustomAlert()}}},beforeExit:function(){commonUtils.getTextWidthUsingCanvas.canvasElem&&commonUtils.destroyCanvasElem();-1!=["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(this.parent.getDynamicParam())&&crmTab.deleteFromCache(this.parent.getDynamicParam()),store.unloadAll("custom_button"),cruxAssets&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!1,delete cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist)}},{mixins:["crm-view-utils","feature-util"]}),Lyte.Router.registerRoute("crm.tab.module.entity.add-contact-role",{queryParams:["returnAnchor","accId"],model:function(e){var t={};t.returnAnchor=e.queryParams.returnAnchor,t.step="addContactRole",t.id=this.parent.getDynamicParam(),t.accId=e.queryParams.accId;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/ShowContactsRolesMapping.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.entity.canvas",{queryParams:["showShared"],getDependencies:function(){return this.getDependenciesFileArray()},getResources:function(){"undefined"==typeof detailView&&(detailView={}),"undefined"==typeof returnJson&&(returnJson={});var e=["zohocrm_emailTrackingStatus.js","zohocrm_detail_canvas_common.js","zohocrm_lookupBusinessCard.js","zohocrm_customnew.js","zohocrm_fol.js","zohocrm_Sales_Navigator.js","crm_finance_suite.js","zcrm_customization.js","gdprDetailview.css"];Crm.userDetails.isRelatedListLyteEnabled||(e.push("crm_related_list_old_flow.css"),Crm.userDetails.RTL_ENABLED&&e.push("crm_related_list_old_flow_rtl.css"));var t=["canvas-detailview-less.css","crm-canvas-export.css","kiosk-common.css","kiosk-associate-record-pop.css","zia/scoring_rule/zia-score-result.css","zia/nba/nba-common.css","crm-zia-call-analytics.css","crm-zia-call-transcription.css","crm-activity-split-allview.css","crm-richtext-resources-less.css","lyte-ui-editor.css","crm-multi-selection-popup.css","crux-smart-filter.css","crm-email-unblocking.css","crux-note.css","crux-image-component.css","crm-image-upload-component.css","crux-file-upload-component.css","crm-file-upload-component.css","crm-assign-territory-detail-view.css","crux-note.css"],r=[networkUtils.getI18nJSUrl("zdeskrelatedlist"),networkUtils.getI18nJSUrl("scoringRulesChart"),networkUtils.getI18nJSUrl("circuits"),networkUtils.getI18nJSUrl("salesnavigator"),networkUtils.getI18nJSUrl("emailsForAllModules"),networkUtils.getI18nJSUrl("chronologicalview"),networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("detailview"),networkUtils.getI18nJSUrl("kiosk"),networkUtils.getI18nJSUrl("MultiSelectPopup"),networkUtils.getI18nJSUrl("SimilarityRecommendation"),networkUtils.getI18nJSUrl("NextBestAction"),networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("crossorgs"),networkUtils.getI18nJSUrl("emailsummary"),networkUtils.getI18nJSUrl("richtext"),networkUtils.getI18nJSUrl("crrl"),networkUtils.getI18nJSUrl("emailthreadview"),networkUtils.getI18nJSUrl("emailintent"),networkUtils.getI18nJSUrl("emailunblocking"),networkUtils.getI18nJSUrl("emailsRelatedList"),networkUtils.getI18nJSUrl("ZiaReasoning"),networkUtils.getI18nJSUrl("Recommendation-detail"),networkUtils.getI18nJSUrl("assignterritory"),networkUtils.getI18nJSUrl("RecordLocking")],s=["crm-canvasview.js","crm-canvas-helpers.js","crm-canvas-core.js","crm-canvas-common-utils.js","crm-canvas-import-button.js","crm-activity-edit-delete-view-icon-canvas-helpers.js","lyte-shortcut.js","lyte-fileupload.js","lyte-hovercard.js","lyte-colorbox.js","lyte-colorpicker.js","lyte-hovercard.js","crux-criteria-conditions.js","crux-criteria-component.js","crux-video.js","crux-tag.js","crux-color-palette.js","crux-smart-filter.js","crux-smart-filter-input.js","crux-image-upload.js","crux-textautocomplete-options.js","crm-approval-process-rejectorlistshow.css","crm-approval-process-rejectorlistshow.js","crm-approval-process-menu.js","reviewprocess_model.js","crm-list-view-new.css","crm-inner-list-new.css","custom-view-layer-new.css","crm-ui-loaders.css","crm-multi-selection-popup.js","crm-custom-filter.js","crm-custom-view.js","crm-permission-dropdown.css","crm-ui-loaders.js","crm-richtext-resources.js","crm-lyte-editor-pannel.js","crm-cloud-picker-mixin.js","crm-detailview-common-footer.js","servapp_preferences_model.js","crm-uploadfields-mixin.js","crm-list-helpers.js","crm-tag-modal.js","crm-tag-helpers.js","crm-tag-mixin.js","delete-popup.js","crm-social-convo-inner-new.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-custom-button-wrapper.js","crm-macro.js","macro-model.js","crm-column-list.js","crux-column-list.js","crm-image-mixin.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","social_related_list_store.js","crm-phone-field.js","calls-button.js","crm-fiscal-periods-util.js","crm-emailconversation-view-helpers.js","crm-email-rl-filter.js","admin-email-sharing-model.js","email-sharing-alert.js","crm-email-unblocking.js","crm-emailsai-config.js","zia-insights.js","zia-helpers.js","zia_reminder_model.js","crm-model-kiosk.js","automation_datahub_module.js","kiosk-execute.js","kiosk-pb-builder-output.js","kiosk-associate-record-pop.js","kiosk-file-api.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-circuits-helper.js","crm-circuits-mixin.js","crm-circuits-rl-all.js","crm-circuits-rl-label.js","crm-detail-canvas-common-files.js","crm-attachments.js","crm-tag.js","crux-note.js","note_model.js","crm-emails-related-list.css","crm-rl-share-email.css","crm-relatedlist-checklist.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crm-custom-rl.css","crm-entity-utils.js","crm-inventory-detail-view.js","crm-feed-follower-datastore.js","crm-follower.js","crm-zexpense-rl.js","crm-subscription-rl.js","crm-custom-rl.js","crm-related-list-checklist.js","crm-zfinance-rl.js","crm-related-list-view-header.js","crm-multi-lookup.js","crm-detail-view-initial-files.js","crm-subscription-rl.css","crm-zfinance-rl-all.css","crm-zfinance-stock-info.css","crm-zexpense-rl.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","crm-permission-error.js","crux-lookupfilter-component.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js","crm-skype-field.js","crm-email-field.js","crm-tag.js","crm-assign-territory-detail-view.js","crm-territory-crux-components.js","crm-territory-helper.js","lyte-tree.js","crm-territory-common-utils.js","crm-circuits-rl-all.css"];e=e.concat(networkUtils.includeChartFiles()),Crm.userDetails.ValidationAlertPreference&&(s=s.concat(["crm-validation-rule-error.js"]),t=t.concat(["crm-validation-rule-error-less.css"]),r=r.concat([networkUtils.getI18nJSUrl("ValidationAlert")]));["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&(r=r.concat([networkUtils.getI18nJSUrl("portals"),networkUtils.getI18nJSUrl("portalmisc")])),Crm.userDetails.timelineRevamp&&(r=(r=r.concat([networkUtils.getI18nJSUrl("timeline")])).concat([networkUtils.getI18nJSUrl("journeys")]),t=t.concat(["crm-notes-timeline.css","crm-journeys.css"]),s=s.concat(["lyte-dateselect.js","lyte-daterangepicker.js"])),featuresAvailable.ZIA_RECORD_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_Generate_Zia_Record_Summary&&(r=r.concat([networkUtils.getI18nJSUrl("ZiaSummary")]),s=s.concat(["crm-zia-record-summary.js","crm-zia-feedback.js"]),t=t.concat(["crm-zia-record-summary.css","crm-zia-feedback.css"])),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&(t=t.concat(["crm-zia-smart-prompt.css"]),s=s.concat(["crm-ui-loaders.js","crm-notes-timeline.js","crm-zia-smart-prompt.js","crm-zia-smart-prompt-store.js","note_model.js","lyte-draggable.js","lyte-resize.js"]),r=r.concat([networkUtils.getI18nJSUrl("SmartPrompt")])),Crm.seriesEnabled&&(s=s.concat(["series_store.js","series_entityseries.js"]),r=r.concat([networkUtils.getI18nJSUrl("Series")]));const i=this.parent.parent.getDynamicParam();if(!["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)||Crm.userDetails.isSandbox||"Leads"!==i&&"Accounts"!==i&&"Contacts"!==i&&"Vendors"!==i&&!i.startsWith("CustomModule")||(r=r.concat([networkUtils.getI18nJSUrl("AutoEnrichment")]),s=s.concat(["zia-data-enrichment-util.js","zia-data-enrichment-util-model.js"])),Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(i)&&(s=s.concat(["crm-detail-view-record-locking-popup.js"]),t=t.concat(["crm-detail-view-record-locking-popup.css"])),Crm.userDetails.isSegmentationEnabled&&(r=r.concat([networkUtils.getI18nJSUrl("segmentation")])),s=s.concat(["crm-canvas-cscript-handler.js"]),"Activities"!==this.parent.parent.getDynamicParam()&&(s=s.concat(["crm-image-upload.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-vision-create.js","crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"]),Crm.userDetails.RTL_ENABLED&&(s=s.concat(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"])),r=r.concat([networkUtils.getI18nJSUrl("imageupload")])),Crm.vocEntityModules&&Crm.vocEntityModules.contains(this.parent.parent.getDynamicParam())&&(s=s.concat(["voc-entity-store.js","voc-common-store.js","voc-common-utils.js","voc-entity.js","voc-component-store.js","gamescope-grid.js"])),"Potentials"===this.parent.parent.getDynamicParam()&&(r=r.concat([networkUtils.getI18nJSUrl("detailview_stage")])),!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&(t=t.concat(["crm-abm-widget.css"]),s=s.concat(["crm-abm-widget.js"]),r=r.concat([networkUtils.getI18nJSUrl("abmwidget")])),Crm.userDetails.isSubformNewComponentEnabled&&(s=s.concat(["crm-canvas-detail-view-subform.js","crux-subform.js"]),t=t.concat(["crux-subform.css"]),Crm.isInventoryModule(this.parent.parent.getDynamicParam())&&(s=s.concat(["crm-create-dependencies.js","crm-detail-view-subform-inventory-dependencies.js"]),t=t.concat(["crm-detail-view-subform-inventory-dependencies.css"])),r=r.concat(["zlib_phonenumber.js"])),Crm.isCpqActivated()){var a=this.parent.parent.getDynamicParam();(crmTab.isZCpqTab(a)||crmTab.isZCpqSubTab(a))&&(s=s.concat(["crm-cpq-breadcrumb.js"]),t=t.concat(["crm-cpq-breadcrumb.css"])),moduleRecordMapping[a].child_module&&moduleRecordMapping[a].child_module.length>0&&(s=s.concat(["crm-cpq-appliedrules.js","modal-scroll-box-shadow.js","cpq-utils.js","crm-cpq-appliedrules.css"]))}Crm.userDetails.RTL_ENABLED?(s=s.concat(["crm-circuits-rtl.css","crm-list-view-new-rtl.css","crux-territory-rtl.css","crm-list-view-rtl.css"]),e=e.concat(["zcanvas-rtl.css"])):s=s.concat(["crux-territory-ltr.css"]),"Campaigns"===this.parent.parent.getDynamicParam()&&(s=s.concat(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js","lyte-step.js","crm-campaigns-detail-view.css","crm-setup-campaign-index.css"]),r=(r=r.concat([networkUtils.getI18nJSUrl("campaignsdetail")])).concat([networkUtils.getI18nJSUrl("zohowebinar")]));var n=[];if(["Forecasts","Emails","Visits","Activities","Tasks","Events","Calls","Services","Appointments"].contains(this.parent.parent.getDynamicParam())||(n=n.concat(Crm.getVisionMyJobsDependency())),"Tasks"!==this.parent.parent.getDynamicParam()&&"Calls"!==this.parent.parent.getDynamicParam()&&"Events"!==this.parent.parent.getDynamicParam()||(s=s.concat(["crm-detail-view-initial-files.js","crm-msg-utils.js"])),"Tasks"===this.parent.parent.getDynamicParam()&&(s=s.concat(["crm-task-markascompleted-popup.js"]),r=r.concat([networkUtils.getI18nJSUrl("taskDetailView")])),"Calls"===this.parent.parent.getDynamicParam()&&(s=s.concat(["phone-entity.js","lyte-voicenote.js","lyte-multislider.js","call-transcription-comp.js","calls-button.js"]),r=r.concat([networkUtils.getI18nJSUrl("calls_detailview")]),e=e.concat(["zohocrm_phoneNumbers.js"]),t=t.concat(["lyte-ui-voicenote.css"])),"Events"!==this.parent.parent.getDynamicParam()&&"Appointments"!==this.parent.parent.getDynamicParam()||(s=s.concat(["crm-events-view-utils.js"])),"Services"!==this.parent.parent.getDynamicParam()&&"Appointments"!==this.parent.parent.getDynamicParam()||(s=s.concat(["crm-services-create-resources.js","crm-services-appointments.js"]),e=e.concat(["zohocrm_services.js"])),"Services"===this.parent.parent.getDynamicParam()&&(r=r.concat([networkUtils.getI18nJSUrl("servicesDetailView")])),n=(n=n.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-rl-users-list.css","crm-list-view-crux.css","crm-phone-field.css"],ResourceConstants.CRMClient)}]),Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.userDetails.isPrivacySettingEnabled){let e=[networkUtils.returnDependencyFiles(["lyte-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)];e=e.concat(networkUtils.returnDependencyFiles(["crm-detailview-data-privacy.js","crux-parent-form-component.js","lyte-connection.elbow.js","lyte-connection.js"],ResourceConstants.CRMClient,void 0,void 0)),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dataPrivacy")],ResourceConstants.CRM)),n=n.concat(e)}return n=(n=(n=(n=n.concat(networkUtils.returnDependencyFiles(s,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM))},beforeModel:function(){var e=this.transition.data;e.stageId&&e.cvid&&(crmNavig.customViewKey=e.cvid+"#"+e.stageId,crmNavig.fromKanbanView=!0);var t=void 0===this.EntityCanvasBeforeModelPromiseHandling?this.getDependenciesFileArray():[];return Lyte.injectResources(t).then(function(){var e=this.prefetchrecordfornavigation(this.transition.data),t=this,r=t.parent.parent.getDynamicParam(),s=t.parent.getDynamicParam(),i=t.getDynamicParam(),a={skipRecordFetch:t.transition.data.skipRecordFetch},n=t.EntityCanvasBeforeModelPromiseHandling(r,s,i,a);return e&&e.then&&(n.navRec=e),Lyte.resolvePromises(n).then((function(e){return t.EntityCanvasBeforeModelHandling(e,r,s,t)}))}.bind(this))},lyteConvertionSupported:!0,zia_suggested_user:{},model:function(){var e=this,t=e.parent.parent.getDynamicParam(),r=e.parent.getDynamicParam(),s=e.getDynamicParam();this.constructCacheObject(s);var i=e.EntityCanvasModelPromiseHandling(t,r,s);return Lyte.resolvePromises(i).then((function(r){return e.EntityCanvasModelHandling(r,t,s,e)}))},redirect:function(e){"undefined"!=typeof businessCardJson&&e.record&&("approval_process_rejected"===e.record.$approval_state||"approval_process_pending"===e.record.$approval_state)&&e.record.$editable&&(businessCardJson.approversNameList=e.entityDetails.approversNameList),e&&e.record&&e.record.$converted&&"Leads"===moduleRecordMapping[e.module].api_name&&this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[this.parent.parent.getDynamicParam(),this.parent.getDynamicParam()]})},renderTemplate:function(e){return this.EntityCanvasRenderTemplateHandling(e)},afterRender:function(e){this.EntityCanvasAfterRenderTemplateHandling(e)},beforeExit:function(){this.EntityCanvasBeforeExitHandling(),"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.throwEventtoAll("onDestroy")},actions:{refreshRoute:function(){var e={refreshTemplate:!0};store.findAll("module").then(function(){this.refresh(e)}.bind(this))},getRecord:function(e){var t=store.peekAll(moduleRecordMapping[this.currentModel.module].id),r=this.currentModel.record.recnum,s="next"===e||"delete"===e?r+1:r-1,i=t.filter((function(e){return e.recnum===s}))[0];if("delete"===e&&!i){var a=r-1;i=t.filter((function(e){return e.recnum===a}))[0]}var n=this;store.findRecord(moduleRecordMapping[this.currentModel.module].id,i.id,{approved:"both",converted:"both"}).then((function(t){if(t){i=t[0];var r=Crm.getCanvasId(moduleRecordMapping[n.currentModel.module].id,i.id);r?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[n.currentModel.module,i.id,r]}).data={recordNum:s,skipRecordFetch:!0}:crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n.currentModel.module,i.id],queryParams:{redirect:"false"},target:"_blank"}).data={recordNum:s,FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,cvid:crmNavig.customViewKey,fromDel:!1,navig:!0}:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n.currentModel.module,i.id],queryParams:{redirect:"false"},target:"_blank"}).data={recordNum:s}}else if("delete"===e){var a=n.currentModel.module,o=store.peekRecord("module",moduleRecordMapping[a].id).custom_view.id;Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[n.currentModel.module,o]})}return!1}))},didTransition:function(){this.EntityCanvasDidTransitionHandling()},willTransition:function(e){this.EntityCanvasWillTransitionHandling(e)}},didDestroy:function(){this.EntityCanvasDidDestroyHandling()},getDependenciesFileArray:function(){var e=networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","crm-detailcanvas-utils.js","crm-canvas-router-utils.js","canvasview_model.js","features_model.js","custom_link_model.js"],ResourceConstants.CRMClient);return!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-abm-configuration.js"],ResourceConstants.CRMClient))),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&"Campaigns"===this.transition.info.dynamicParams[0]&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),e=e.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])}},{mixins:["crm-detail-view-utils","crm-detailcanvas-utils","crm-abm-utils","crm-canvas-router-utils","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery","crm-detail-view-initial-files","crm-detailview-common-utils"]}),app.cscript_registry({route_name:"crm.tab.module.entity.canvas",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){var e=Lyte.Router.getRouteInstance();return!(!e||"canvas"!==e.routeName)||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&!Crm.userDetails.RTL_ENABLED},name:I18n.getMsg("com.page.detailpagecanvas","Canvas"),unique_name:"module_view_canvas",handlers:["CanvasDetailPageHandler"],display_tag:!1,sequence:6,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.entity.canvas:0",definition:function(){return new Promise((function(e){store.findAll("module").then((function(t){var r=["Visits","Activities","Tasks","Events","Calls","Campaigns","Services__s","Appointments__s","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"],s=["ZohoCPQ__s"],i=t.filter((function(e){return e.visible&&"team_based"!==e.access_type&&e.api_supported&&e.show_as_tab&&-1===r.indexOf(e.api_name)&&("default"===e.generated_type||"custom"===e.generated_type||"linking"===e.generated_type)&&!(e.parent_module&&-1===s.indexOf(e.parent_module.api_name))})).map((function(e){return{name:e.plural_label,value:e.module_name}}));e(i)}))}))}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$transitionData:layoutId",definition:function(e){return new Promise((function(t){var r=store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name;store.findAll("layout",{module:r}).then((function(e){var r=e.map((function(e){return{name:"Standard"===e.name?I18n.getMsg("Standard"):e.name,value:e.id}}));t(r)}))}))}},{name:"Canvas",label:"Canvas",key:"$dynamicParam:crm.tab.module.entity.canvas:2",definition:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=document.querySelector("crm-detailview-oldeditor");if(r||(r=document.querySelector("crm-detailview-canvas")),r){var s=r.getData("viewId"),i=store.peekRecord("canvasview",s);i&&t([{name:i.name,value:s}])}else app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"DetailView",layout_id:e.Layout}).then((function(e){var r=e.map((function(e){return{name:e.name,value:e.id}}));t(r)}))}))}}],preview_route:async function(e){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);let t=store.peekRecord("canvasview",e.Canvas);if(t||await app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"DetailView"}),t=store.peekRecord("canvasview",e.Canvas),t&&t.canvas_enabled){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).filter((e=>e.visible)).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id,e.Canvas]}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:()=>[{event:"onLoad",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return new Promise((function(t){var r=store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name;store.findAll("layout",{module:r}).then((function(r){var s=r.filter((function(t){return t.id===e.Layout}))[0].sections,i=[],a=["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"];s.forEach((function(e){i.push.apply(i,e.fields.filter((function(e){var t=store.peekRecord("field",e.id),r=t.api_name;return"profileimage"!==t.data_type&&"multiselectlookup"!==t.data_type&&"Reporting_To"!==r&&"Currency"!==r&&"Probability"!==r&&"Pricing_Model"!==r&&"Wizard"!==r&&"territory_updated_time"!==r&&("imageupload"===t.data_type&&556===t.ui_type||"fileupload"===t.data_type?!!CScript.Utils.is_uploadfields_event_enabled():-1!==a.indexOf(t.column_name)||t.view_type.edit)})).map((function(e){return{name:e.field_label,value:e.id}})))})),t(i)}))}))},child_label:I18n.getMsg("crm.label.field"),list:()=>[{event:"onBeforeUpdate",args:["value"]}]},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:()=>[{event:"onBeforeMandatoryFormSave",args:["value"]},{event:"onMandatoryFormLoad",args:["field"]}]},blueprint:{name:I18n.getMsg("com.cscript.blueprintevents"),label:I18n.getMsg("BluePrint"),list:()=>CScript.Utils.is_blueprint_aftertransition_event_enabled()?[{event:"beforeTransition",args:["transition"]},{event:"afterTransition",args:["transition"]}]:[{event:"beforeTransition",args:["transition"]}]},tag:{name:I18n.getMsg("com.cscript.tagevents"),label:I18n.getMsg("Tag"),list:()=>[{event:"onTagChanged",args:["tags_added","tags_removed"]}]},button:{name:I18n.getMsg("com.cscript.canvasbuttonevents","Canvas"),label:I18n.getMsg("zc.editor.button"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[],s=document.querySelector("crm-detailview-oldeditor");if(s){var i=s.getData("lastsavedmapping")||{},a=Object.keys(i),n=$(".zccbutton.zclayout").filter(":data(zcanvasdata)");r=n.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid&&a.indexOf(e.systemid)>-1)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var o=e.Canvas;store.findRecord("canvasview",o).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Canvas Button"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("zc.editor.button"),list:()=>[{event:"onClick",args:[]}]},icon:{name:I18n.getMsg("com.cscript.iconevents"),label:I18n.getMsg("crm.canvas.editor.icon"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstaticicon ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.Canvas;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Icon"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.canvas.editor.icon"),list:()=>[{event:"onClick",args:[]}]},text:{name:I18n.getMsg("com.cscript.textevents"),label:I18n.getMsg("crm.label.text"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstatictext ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.Canvas;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Text"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.label.text"),list:()=>[{event:"onClick",args:[]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.clone.canvas",{queryParams:["layoutId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["custom_link_model.js","crm-canvasrule-model.js","crm-canvas-create-router-util.js"],ResourceConstants.CRMClient)},getResources:function(){return Lyte.registeredMixins["crm-create-init-mixin"].downloadFormViewResources()},beforeModel:function(e){var t={intRoute:"clone",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,entityId:this.parent.parent.getDynamicParam(),canvasId:e.dynamicParam,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasBeforeModelHook(t)},model:function(e){var t=!1;this.transition.data.skipRecordFetch||(t=!0);var r={intRoute:"clone",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,canvasId:e.dynamicParam,entityId:this.parent.parent.getDynamicParam(),fetchRecord:t,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasModelHook(r)},afterModel:function(e){var t={model:e};return this.canvasAfterModelHook(t)},renderTemplate:function(e){var t={model:e};return this.canvasRenderTemplateHook(t)},afterRender:function(e){var t={model:e};this.canvasAfterRenderHook(t)},beforeExit:function(){this.canvasBeforeExitHook()},didDestroy:function(e){var t={model:e};this.canvasDidDestroyHook(t)},getMultiSelectLookupRecords:function(e,t){return store.triggerAction(moduleRecordMapping[e.module_name].id,"fetchrelatedList",{entityid:this.parent.parent.getDynamicParam(),relapiname:t.multiselectlookup.api_name}).then((function(r){r.data&&r.data.length>100&&(e.hasMorethan100MxNRecords=!0,e.msFldsHasMorethan100MxNRecords.push(t.id))}))},actions:{willTransition:function(e){this.canvasWillTransitionHook(e,this.transition)},refreshRoute:function(){this.canvasRefreshRouteHook()}}},{mixins:["crm-create-mixin","crm-detailcanvas-utils","crm-formview-mixin","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery","crm-canvas-create-router-util"]}),app.cscript_registry({route_name:"crm.tab.module.entity.clone.canvas",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Crm.userDetails.isCanvasFormViewEnabled&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.clonepage")+" ("+I18n.getMsg("crm.canvas.title")+")",unique_name:"module_clone_canvas",handlers:["CanvasCreatePageHandler"],display_tag:!0,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.entity.clone.canvas:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}},{name:"CanvasCreate",label:"Canvas",key:"$dynamicParam:crm.tab.module.entity.clone.canvas:2",definition:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=document.querySelector("crm-detailview-oldeditor");if(r||(r=document.querySelector("crm-canvas-forms")),r){var s=r.getData("currView")?r.getData("currView").id:r.getData("viewId"),i=store.peekRecord("canvasview",s);i&&t([{name:i.name,value:s}])}else app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}).then((function(e){var r=e.map((function(e){return{name:e.name,value:e.id}}));t(r)}))}))}}],page_info:function(e){return{name:"FormView",module:store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name}},preview_route:async function(e){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);let t=store.peekRecord("canvasview",e.CanvasCreate);if(t||await app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}),t=store.peekRecord("canvasview",e.CanvasCreate),t&&t.canvas_enabled){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).filter((e=>e.visible)).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.clone.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id,e.CanvasCreate],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.create.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,e.CanvasCreate],queryParams:{layoutId:e.Layout}}}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.label.field"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:()=>[{event:"onMandatoryFormLoad",args:["field"]}]},button:{name:I18n.getMsg("com.cscript.canvasbuttonevents","Canvas"),label:I18n.getMsg("zc.editor.button"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[],s=document.querySelector("crm-detailview-oldeditor");if(s){var i=s.getData("lastsavedmapping")||{},a=Object.keys(i),n=$(".zccbutton.zclayout").filter(":data(zcanvasdata)");r=n.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid&&a.indexOf(e.systemid)>-1)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var o=e.CanvasCreate;store.findRecord("canvasview",o).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Canvas Button"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("zc.editor.button"),list:()=>[{event:"onClick",args:[]}]},icon:{name:I18n.getMsg("com.cscript.iconevents"),label:I18n.getMsg("crm.canvas.editor.icon"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstaticicon ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Icon"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.canvas.editor.icon"),list:()=>[{event:"onClick",args:[]}]},text:{name:I18n.getMsg("com.cscript.textevents"),label:I18n.getMsg("crm.label.text"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstatictext ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Text"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.label.text"),list:()=>[{event:"onClick",args:[]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.clone",{queryParams:["layoutId","redirect"],getDependencies:function(){var e=this.parent.parent.getDynamicParam();return this.loadRouteDependencies(e)},getResources:function(e){var t={isClone:!0,currentFeature:"create",getResourcesParams:e,moduleName:this.parent.parent.getDynamicParam(),transitionData:this.transition.data};return this.getResourcesHook(t)},beforeModel:function(e){return this.beforeModelHook(this.getEditCloneRouteBasicDataProps(!0,"clone"),this.transition.data,e.queryParams)},model:function(e){return this.modelHook(Object.assign({parentTransitionData:this.parent.parent.transition.data,modelParams:e},this.getEditCloneRouteBasicDataProps(!1,"clone")),this.transition.data,e.queryParams)},afterModel:function(e){return this.afterModelHook(this.getEditCloneRouteBasicDataProps(!1,"clone"),e,this.transition.data,this.getQueryParams())},redirect:function(){return this.redirectHook(Object.assign({currentTransition:this.transition},this.getEditCloneRouteBasicDataProps(!1,"clone")))},renderTemplate:function(e,t){return this.renderTemplateHook(this.getEditCloneRouteBasicDataProps(!0,"clone"),this.transition.data,e,t)},afterRender:function(e){this.afterRenderHook(this.getEditCloneRouteBasicDataProps(!1,"clone"),e,this.transition.data)},didDestroy:function(){var e=this.component?this.component.querySelector("crm-create-layout"):void 0,t={lyteConvertionSupported:this.lyteConvertionSupported,formViewType:"clone"};e&&(t.rectobeUnloaded=e.getData("dataBind"),t.currsubformApinames=e.getData("currsubformApinames")),this.didDestroyHook(t)},beforeExit:function(){this.beforeExitHook(this.getEditCloneRouteBasicDataProps(!0,"clone"))},actions:{willTransition:function(e){const t=e=>e&&e.data&&e.data.skipDirtyCheck;if(!t(this.transition)&&!t(e)&&e&&this.isRecordModified()){e.pause();const t=$L("crm-create-layout")[0];if(t)return t.setData("unsavedChangesPopupInfo",{isLayoutSwitch:!1,transition:e}),t.setData("disableFormbuttons",!1),void this.displayUnsavedChangesAlert()}const r=e=>e&&e.data&&delete e.data.skipDirtyCheck;r(this.transition),r(e)}}},{mixins:["crm-create-mixin","crm-create-mixin2","crm-create-init-mixin","crm-create-route-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.entity.clone",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.clonepage")+" ("+I18n.getMsg("Standard")+")",unique_name:"module_clone",handlers:["CreatePageHandler"],display_tag:!0,sequence:3,selectors:[{name:"Module",key:"$dynamicParam:crm.tab.module.entity.clone:0",label:I18n.getMsg("crm.label.module"),definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",key:"$queryParam:layoutId",label:I18n.getMsg("crm.lable.layout"),definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:async function(e){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).filter((e=>e.visible)).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.clone",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.convert",{queryParams:["showPortalChange"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-convertlead.js","user_type.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-ui-loaders.js"],ResourceConstants.CRMClient);Crm.userDetails.ValidationAlertPreference&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM))),e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("convertlead")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-convert-lead.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-convert-lead-rtl.css"],ResourceConstants.CRMClient)));var t=e.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient));return t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext"),"zohocrm_changeOwner.js"],ResourceConstants.CRM))},beforeModel:function(){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort());var e=moduleRecordMapping.Leads.id;return Lyte.resolvePromises({ldmoduleData:store.findRecord("module",e)})},model:function(){var e=moduleRecordMapping.Leads.id,t=this.parent.getDynamicParam(),r=store.peekRecord("module",e),s=null,i=r.related_lists?r.related_lists:null;if(null!==i)for(var a=i.length,n=0;n<a;n++)i[n].module&&"Attachments"===i[n].module.api_name&&(s=i[n].id);commonUtils.showHideLoadingDiv(!0);var o=null;return null!=s&&(o={relatedId:t,relationId:s}),Lyte.resolvePromises([store.findRecord(e,t),store.findAll(e,o,null,!0,!1),store.triggerAction("entity","convert",{id:t,action:"convert",method:"GET"}),store.findAll("features",{api_names:"lead_conversion_layoutrule"},!1,!0,{version:"v7"})]).then((function(e){if("read_only"!==e[0][0].$sharing_permission){if(!e[2].__conversion_options&&!moduleRecordMapping.Contacts.visible){var t=[];return t.push(moduleRecordMapping.Leads.plural_label),t.push(moduleRecordMapping.Contacts.plural_label),crmui.showMsgBand("error",I18n.getMsg("crm.lead.no.conversion",t),3e3),void commonUtils.showHideLoadingDiv(!1)}var r=e[0][0]&&void 0!==e[0][0].Layout?e[0][0].Layout.id:null;return Lyte.resolvePromises([store.findAll("layout",{module:moduleRecordMapping.Leads.api_name})]).then((function(t){for(var s=t[0].length,i=0;i<s;i++)if(null!==r&&r===t[0][i].id||(null===r||1===s)&&"system"===t[0][i].generated_type)return{convert_mapping:t[0][i].convert_mapping,data:e,leadFieldData:t[0][i].fields,lead_layout_id:t[0][i].id}}))}renderingUtils.displayPermissionDenied()}),function(r){var s=JSON.parse(r.response);if("INVALID_DATA"===s.code)return Lyte.resolvePromises([store.findRecord(e,t,{converted:!0})]).then((function(e){return e[0][0]?{converted_detail:e[0]}:{LeadDeleted:"DeletedRecord"}}),(function(){renderingUtils.displayPermissionDenied()}));"NO_PERMISSION"===s.code||"NOT_APPROVED"===s.code||"CANNOT_PROCESS"===s.code||"RECORD_LOCKED"===s.code||"NOT_REVIEWED"===s.code||"REVIEW_REJECTED"===s.code?(crmHistory.handleAjaxErrorLyte=!0,!s.details||"record_locking"!==s.details.action&&"merge"!==s.details.action?renderingUtils.displayPermissionDenied():renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.record.locking.permission.denied")),this.transition.abort()):crmui.showMsgBand("error",I18n.getMsg("crm.lead.error.conversion",moduleRecordMapping.Leads.singular_label),1e3),commonUtils.showHideLoadingDiv(!1)}.bind(this))},afterModel:function(e,t){var r=t.queryParams;if(void 0!==e.data){if(e.Leads=e.data[0][0],e.LEAD_CONVERSION_LAYOUTRULE=!!e.data[3],void 0!==e.Leads.Tag){for(var s=e.Leads.Tag.length,i={},a={},n=0;n<s;n++)i[e.Leads.Tag[n].name]=e.Leads.Tag[n].id,a[e.Leads.Tag[n].name]=e.Leads.Tag[n].color_code;e.acntSelTags=e.Leads.Tag,e.cntSelTags=e.Leads.Tag,e.dealSelTags=e.Leads.Tag,e.tagnamevstagid=i,e.tagnamevscolor=a}if(e.attach=void 0!==e.data[1]&&(void 0!==e.data[1].length&&e.data[1].length>0),void 0!==e.data[2].__conversion_options?e.__conversion_options=e.data[2].__conversion_options:e.__conversion_options=void 0,e.singularModName=moduleRecordMapping.Leads.singular_label,e.acntsingularModName=moduleRecordMapping.Accounts.singular_label,e.cntsingularModName=moduleRecordMapping.Contacts.singular_label,e.dealsingularModName=moduleRecordMapping.Deals.singular_label,e.companyAvailable=!1,moduleRecordMapping.Accounts.visible)for(var o=e.leadFieldData.length,c=0;c<o;c++){if("COMPANY"===e.leadFieldData[c].column_name){e.companyAvailable=!0;break}}if(e.id=e.Leads.id,void 0!==e.__conversion_options&&null!==e.__conversion_options.modules_with_multiple_layouts){var l=[moduleRecordMapping.Accounts.id,moduleRecordMapping.Contacts.id,moduleRecordMapping.Deals.id],d=e.__conversion_options.modules_with_multiple_layouts;for(s=d.length,n=0;n<s;n++){var u=d[n].id;l[0]===u?e.showAcntLayout=!0:l[1]===u?e.showCntLayout=!0:l[2]===u&&(e.showDealLayout=!0)}}if(void 0!==e.__conversion_options&&e.__conversion_options.preference_field_matched_value&&null!==e.__conversion_options.preference_field_matched_value){e.disableAcnt=!1;var m=e.__conversion_options.preference_field_matched_value.Accounts&&null!==e.__conversion_options.preference_field_matched_value.Accounts?e.__conversion_options.preference_field_matched_value.Accounts:null,p=null!==e.__conversion_options.preference_field_matched_value.Contacts?e.__conversion_options.preference_field_matched_value.Contacts:null,h=null!==m?m.length:0;for(n=0;n<h;n++)if(null!==m[n].field.unique)e.disableAcnt=!0;else if("Account_Name"===m[n].field.api_name&&null===m[n].field.unique){e.disableAcnt=!1;break}var f=null!==p?p.length:null;for(n=0;n<f;n++)if(null!==p[n].field.unique){e.disablecnt=!0;break}}if(r&&!0===r.showPortalChange||"true"===r.showPortalChange)return Lyte.resolvePromises([store.findAll("user_type")]).then((function(t){for(var r=t[0],s=r.length,i=[],a=Crm.userDetails.PORTALS_LICENSE_UNIFICATION_ENABLED,n=0;n<s;n++){var o=r[n],c=!!a||!1===o.default;if(!0===o.active&&"Contacts"===o.personality_module.api_name&&c){var l={};l.displayName=o.name,l.profileId=o.id,i.push(l)}}i.length>0?(e.portal_profiles=i,e.portalUserType=i[0].profileId):e.portalWarningMessage=I18n.getMsg("client.portal.convert.delete.user.warning.message",[e.cntsingularModName,e.singularModName])}));e.fromConvertAction=!0}else e.converted_detail&&e.converted_detail[0]?(void 0!==e.converted_detail[0].Converted_Account&&(e.accountObj=e.converted_detail[0].Converted_Account),void 0!==e.converted_detail[0].Converted_Contact&&(e.contactObj=e.converted_detail[0].Converted_Contact),void 0!==e.converted_detail[0].Converted_Deal&&(e.dealObj=e.converted_detail[0].Converted_Deal),e.Leads=e.converted_detail[0],e.singularModName=moduleRecordMapping.Leads.singular_label,e.acntsingularModName=moduleRecordMapping.Accounts.singular_label,e.cntsingularModName=moduleRecordMapping.Contacts.singular_label,e.dealsingularModName=moduleRecordMapping.Deals.singular_label,e.fromConvertAction=!(!this.transition.data||!this.transition.data.fromSrc||"blueprint"!==this.transition.data.fromSrc),e.converted=!0):"DeletedRecord"===e.LeadDeleted&&(e.RcdDeleted=!0)},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-convert-lead"}},actions:{willTransition:function(){var e=Lyte.registeredMixins["crm-multi-selection-popup-mixin"];e&&e.deletePopup(),Crm.VR&&delete Crm.VR,Crm.validationRuleJSONData.Potentials&&delete Crm.validationRuleJSONData.Potentials}},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-convert-lead.css"],ResourceConstants.CRMClient))}}),Lyte.Router.registerRoute("crm.tab.module.entity.detail",{queryParams:["sub_module","showShared","iframe_src","newSignUp","scrollToElem"],getDependencies:function(){var e=this.parent.parent.getDynamicParam();if(void 0!==this.getQueryParams().sub_module&&"Activities"===e&&(e=this.getQueryParams().sub_module),"Meetings"===e&&(e="Events"),this.transition.lyteHeaderSupported=Crm.lyteHeaderNeeded(e),this.transition.renderFullLytePage=Crm.renderDVLyteFlow(e),this.transition.renderFullLytePage)return this.getDependenciesFiles(void 0,!0);var t=[];featuresAvailable.DUPLICATE_IMAGE_DETECTION&&(t=t.concat(networkUtils.returnDependencyFiles(["duplicate-image-detection-model.js"],ResourceConstants.CRMClient))),t=t.concat(networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient));var r=networkUtils.returnDependencyFiles(["features_model.js"],ResourceConstants.CRMClient),s=t.concat(r);s=s.concat(networkUtils.returnDependencyFiles(["zohocrm_invoice_template.js"],ResourceConstants.CRM));var i=networkUtils.returnDependencyFiles(["recommendation-detailed-main.js"],ResourceConstants.CRMClient);s=s.concat(i),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&"Campaigns"===this.transition.info.dynamicParams[0]&&(s=s.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient)));var a=networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM);return s=s.concat(a),s=this.getDependenciesFiles(s,!1)},getResources:function(){var e=[];detailView.lyte_headerDataHolder={};var t=this.parent.parent.getDynamicParam(),r=t;if(void 0!==this.getQueryParams().sub_module&&"Activities"===t&&(t=this.getQueryParams().sub_module),"Meetings"===t&&(t="Events"),this.transition.lyteHeaderSupported=Crm.lyteHeaderNeeded(t),this.transition.renderFullLytePage=Crm.renderDVLyteFlow(t),this.transition.lyteHeaderSupported){var s=networkUtils.returnDependencyFiles(["crm-detailview-header-less.css","crux-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);s=s.concat(networkUtils.returnDependencyFiles(["crm-detailview-tag-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(s)).concat(networkUtils.returnDependencyFiles(["crm-detailview-header.js","crm-detailview-fields.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-custom-button-wrapper.js","crm-custom-button.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["custom-view-layer.css","custom-view-layer-new.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-colorpicker.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-tag-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-entity-utils.js"],ResourceConstants.CRMClient));if(["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&void 0!==Crm.userDetails.CLIENT_PORTAL_PROFILES&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portalmisc"),networkUtils.getI18nJSUrl("portals")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_clientPortalMiscFuncs.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-client-portal-user-data-store.js","crm-client-portal-user-mixin.js","portal-model.js"],ResourceConstants.CRMClient))),!["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)||Crm.userDetails.isSandbox||"Leads"!==t&&"Accounts"!==t&&"Contacts"!==t&&"Vendors"!==t&&!t.startsWith("CustomModule")||(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zia-data-enrichment-util.js","zia-data-enrichment-util-model.js","crm-ui-loaders.js"],ResourceConstants.CRMClient))),this.transition.renderFullLytePage)return CScriptLib&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-detailview-cscript-handler.js"],ResourceConstants.CRMClient))),this.getLyteResources(t,e,r)}featuresAvailable.ZIA_RECORD_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_Generate_Zia_Record_Summary&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zia-record-summary.js","crm-zia-feedback.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-record-summary.css","crm-zia-feedback.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM))),e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zia-insights.js","modal-scroll-box-shadow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-lookup-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-detailview-tag.js","crm-tag-helpers.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-tag-mixin.js","lyte-nav.js","phone-entity.js","call-fromto-field.js","calls-kanbancard.js","calls-cvcard.js","crm-detailview-common-footer.js","crm-zia-reasoning-popover.js","lyte-hovercard.js","entity-field.js","businesscard_model.js","features_model.js","automation_datahub_module.js","kiosk-execute.js","kiosk-pb-builder-output.js","kiosk-associate-record-pop.js","crm-emailconversation-view-helpers.js","lyte-fileupload.js","kiosk-file-api.js","zia-insights.js"],ResourceConstants.CRMClient)),featuresAvailable.DUPLICATE_IMAGE_DETECTION&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("DuplicateImageDetection")],ResourceConstants.CRM))),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zlib_phonenumber.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["gdprDetailview.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["kiosk-common.css","kiosk-associate-record-pop.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css","crm-detailview-tag-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js","crux-criteria-conditions.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-helpers.js","crm-multi-selection-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css","custom-view-layer-new.css","crm-inner-list-new.css","crm-list-view-new.css"],ResourceConstants.CRMClient)),!0===Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","crm-list-view-rtl.css"],ResourceConstants.CRMClient))),e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiSelectPopup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-multi-selection-popup.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.ValidationAlertPreference&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM))),e=e.concat(networkUtils.returnDependencyFiles(["crm-zia-reasoning-popover.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.timelineRevamp&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.js","crm-timeline-helpers.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM))),featuresAvailable.ZIA_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_View_Zia_Notes_Summary&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-notes.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-table-component-v1.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chronologicalview")],ResourceConstants.CRM))).concat();var i,a=this.parent.parent.getDynamicParam(),n=moduleRecordMapping[a];if(("Leads"===a||"Accounts"===a||"Contacts"===a||"Potentials"===a||n&&"custom"===n.generated_type)&&(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-territory-helper.js","crm-assign-territory-detail-view.js","crm-territory-crux-components.js","lyte-tree.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-assign-territory-detail-view.css","crux-territory.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignterritory")],ResourceConstants.CRM))),"Leads"!==a&&"Contacts"!==a&&"Calls"!==a||(e=e.concat(networkUtils.returnDependencyFiles(["calls-button.js"],ResourceConstants.CRMClient))),Crm.userDetails.isPhoneNoNewView&&(e=e.concat(Crm.returnPhoneFieldDependencyFiles())),"Campaigns"===this.parent.parent.getDynamicParam()){var o=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js","lyte-step.js","crm-child-campaigns.js"],ResourceConstants.CRMClient);o=o.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM));var c=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],ResourceConstants.CRMClient);c=c.concat(networkUtils.returnDependencyFiles(["crm-child-campaigns.css"],ResourceConstants.CRMClient)),e=e.concat(o.concat(c)),Crm.userDetails.RTL_ENABLED&&e.push(networkUtils.returnDependencyFiles(["crm-campaigns-detail-view-rtl.css"],ResourceConstants.CRMClient));var l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")],ResourceConstants.CRM);if(e=e.concat(l),"undefined"==typeof webinar){var d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")],ResourceConstants.CRM);e=e.concat(d)}"undefined"==typeof ZCampaigns&&(e=e.concat(networkUtils.returnDependencyFiles(["ZCrmCampaigns.js"],ResourceConstants.CRM)))}else"Services"===this.parent.parent.getDynamicParam()?(e.push(networkUtils.returnDependencyFiles(["crm-user-list.js","crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["services-availability.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("ServiceEntityKeys")],ResourceConstants.CRM)),isnewCalendarBookingEnabled&&(e.push(networkUtils.returnDependencyFiles(["crm-calendar-booking-relatedlist.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)))):"Appointments"===this.parent.parent.getDynamicParam()?(e.push(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("ServiceEntityKeys")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles(["crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient))):"Potentials"===this.parent.parent.getDynamicParam()||"Deals"===this.parent.parent.getDynamicParam()?(e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles(["crm-stage-detailview.js","lyte-step.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["crm-stage-detailview.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&e.push(networkUtils.returnDependencyFiles(["crm-stage-detailview-rtl.css"],ResourceConstants.CRMClient))):isNewCallView&&("Calls"===this.parent.parent.getDynamicParam()||"Activities"===this.parent.parent.getDynamicParam()&&"Calls"===this.parent.parent.getQueryParams().sub_module)?(e.push(networkUtils.returnDependencyFiles(["zcrm_callsnew2.js"],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_detailview")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles(["lyte-voicenote.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["lyte-multislider.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["lyte-ui-voicenote.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.push(networkUtils.returnDependencyFiles(["calls-businesscard.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&e.push(networkUtils.returnDependencyFiles(["calls-businesscard-rtl.css"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["calls-dpmenu.js","crux-lookupfilter-component.js","crux-column-list.js","crm-entity-utils.js","crm-detail-view-initial-files.js"],ResourceConstants.CRMClient))):"Events"===t?(e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailEditor")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles(["crm-entity-utils.js"],ResourceConstants.CRMClient))):Crm.vocEntityModules&&Crm.vocEntityModules.contains(this.parent.parent.getDynamicParam())&&(e.push(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles(["voc-entity-store.js","voc-common-store.js","voc-common-utils.js","voc-entity.js","voc-component-store.js","gamescope-grid.js"],ResourceConstants.CRMClient)));e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-pathfinder-detailview-pop-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-pathfinder-detailview-pop-ltr.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess"),"zohocrm_phoneNumbers.js"],ResourceConstants.CRM)),i=(i=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.css","crm-activity-rel-customize.css","crm-activity-rel-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.css","crm-activity-rel-customize.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-activity-split-allview.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var u=networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.js","crm-canvas-helpers.js","crm-detailcanvas-utils.js","crm-tag-modal.js","crm-tag.js","crm-canvas-core.js","crm-detail-view-services.js"],ResourceConstants.CRMClient);e=(e=(e=(e=e.concat(i.concat(u))).concat(networkUtils.returnDependencyFiles(["crm-zia-call-analytics.css","crm-zia-call-transcription.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zia-call-analytics")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["call-transcription-comp.js"],ResourceConstants.CRMClient));var m=networkUtils.returnDependencyFiles(["crm-workflow-fields-update-popup.js"],ResourceConstants.CRMClient),p=networkUtils.returnDependencyFiles(["crm-workflow-fields-update-popup.css"],ResourceConstants.CRMClient);e=(e=e.concat(p)).concat(m);var h=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM),f=networkUtils.returnDependencyFiles(["similarity-details-page.js","zia-helpers.js"],ResourceConstants.CRMClient),g=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=e.concat(f).concat(g).concat(h);l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")],ResourceConstants.CRM);if(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")],ResourceConstants.CRM))).concat(p),Crm.seriesEnabled&&(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Series")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["series_store.js"],ResourceConstants.CRMClient))),e=(e=e.concat(l)).concat(m),Crm.userDetails.isSegmentationEnabled){var y,v=networkUtils.returnDependencyFiles(["related-list-rfm.js","segmentation-utils.js"],ResourceConstants.CRMClient);y=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["related-list-rfm.css","related-list-rfm-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["related-list-rfm.css"],ResourceConstants.CRMClient);var _=v.concat(y);e=e.concat(_)}Crm.seriesEnabled&&(e=e.concat(networkUtils.returnDependencyFiles("series_mixin.js",ResourceConstants.CRMClient))),Crm.userDetails.isBestTimeEnabled&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-besttime-new.js","besttime_zia_new_model.js","zia_reminder_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-besttime-new.css"],ResourceConstants.CRMClient))),this.parent.parent.getDynamicParam().indexOf("PathFinder")>-1&&(e=e.concat(networkUtils.returnDependencyFiles("crm-pathfinder.js",ResourceConstants.CRMClient))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js","crux-image-upload.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-image-component.css","crm-image-upload-component.css","crux-file-upload-component.css","crm-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),"Activities"!==this.parent.parent.getDynamicParam()&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-vision-create.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM));var C=networkUtils.returnDependencyFiles(["integration/crm-zprojectsrl-store.js","crm-existing-email-quickinfo.js","crm-image-upload-ziaError.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js","lyte-shortcut.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-list-helpers.js","crm-zsurvey-rl-all.js","survey-configuration.js","crm-circuits-helper.js","crm-circuits-rl-all.js","crm-circuits-common.js","crm-circuits-rl-label.js","crm-project-detail-view.js","crm-zohoprojects-iframe.js"],ResourceConstants.CRMClient);C=C.concat(networkUtils.returnDependencyFiles(["crm-circuits-mixin.js"],ResourceConstants.CRMClient));var R=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css","crm-zsurvey-rl-label.css","crm-list-view-crux.css","crm-zdesk-rl-all-wrapper.css","crm-circuits-rl-all.css","integration/crm-zprojects-rl-all.css"],ResourceConstants.CRMClient),b=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zdeskrelatedlist")],ResourceConstants.CRM);e=e.concat(b);var w=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("projects")],ResourceConstants.CRM);e=e.concat(w);["Forecasts","Emails","Visits","Activities","Tasks","Events","Calls","Services","Appointments"].contains(this.parent.parent.getDynamicParam())||(e=e.concat(Crm.getVisionMyJobsDependency())),Crm.userDetails.RTL_ENABLED&&(R=R.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(C.concat(R));var M=networkUtils.returnDependencyFiles(["zohocrm_fol.js"],ResourceConstants.CRM);e=(e=(e=e.concat(M)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FieldOfLookup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],ResourceConstants.CRM)),CScriptLib&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-detailview-cscript-handler.js"],ResourceConstants.CRMClient))),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=0!=e.length?e.concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.js","crm-rl-users-list.js","crm-rl-share-email.js","email-summary.js","email-emotions.js","admin-email-sharing-model.js","email-sharing-alert.js","crm-email-rl-filter.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.css","crm-rl-users-list.css","crm-rl-share-email.css","email-summary.css"],ResourceConstants.CRMClient))):networkUtils.returnDependencyFiles(["crm-emails-related-list.js","crm-rl-users-list.js","crm-rl-share-email.js","email-summary.js","email-emotions.js","admin-email-sharing-model.js","email-sharing-alert.js","crm-email-rl-filter.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.css","crm-rl-users-list.css","crm-rl-share-email.css","email-summary.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsForAllModules")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-email-intent-helper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-emailconversation-view.js","crm-emailconversation-view-helpers.js","crm-email-activity-suggestions.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-emailconversation-view.css","crm-email-activity-suggestions.css","zia/zia-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailthreadview")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("activityv2")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaemail")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FeedbackMechanism")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("threadsummaryandtranslation")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-email-summary-view.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-email-summary-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-email-summary.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-emailsai-config.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-email-unblocking.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-email-unblocking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailunblocking")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_customnew.js","zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM)),Crm.userDetails.isRelatedListLyteEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Customization"),networkUtils.getI18nJSUrl("salesnavigator")],ResourceConstants.CRM))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")],ResourceConstants.CRM));var D=networkUtils.returnDependencyFiles(["zohocrm_blueprintattachment.js"],ResourceConstants.CRM);e=e.concat(D),"Leads"!==this.parent.parent.getDynamicParam()&&"Contacts"!==this.parent.parent.getDynamicParam()||(e=e.concat(networkUtils.returnDependencyFiles(["crm-salesiq-detail-view.js"],ResourceConstants.CRMClient))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-client-portal-user-mixin.js","portal-model.js","user_type.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-image-mixin.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-related-list-view-header.js","crm-attachments.js","crm-cloud-picker-mixin.js","crux-note.js","note_model.js"],ResourceConstants.CRMClient)),Crm.userDetails.isRelatedListLyteEnabled&&(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-column-list.js","crux-smart-filter.js","crm-detail-canvas-common-files.js","crm-activity-edit-delete-view-icon-canvas-helpers.js","crm-custom-button-wrapper.js","crm-msg-related-list.js","crm-msg-utils.js","crm-related-list-view.js","sales-navigator.js","delete-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-note.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-zexpense-rl.js","crm-subscription-rl.js","crm-custom-rl.js","crm-related-list-checklist.js","crm-zfinance-rl.js","crm-related-list-view-header.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-relatedlist-checklist.css"],ResourceConstants.CRMClient))),Crm.userDetails.isConnectedRecordsEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-connected-record.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-connected-record.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ConnectedRecords")],ResourceConstants.CRM))),e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-related-list-attachments.css","crm-image-preview.css","crm-related-list-view-header.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crrl")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsRelatedList")],ResourceConstants.CRM));var P=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],ResourceConstants.CRM);if(e=(e=(e=e.concat(P)).concat(networkUtils.returnDependencyFiles(["zohocrm_emailTrackingStatus.js","zohocrm_detail_canvas_common.js","zohocrm_Sales_Navigator.js","crm_finance_suite.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&Crm.userDetails.isRelatedListLyteEnabled){var L=networkUtils.returnDependencyFiles(["crm-related-list-actions-rtl.css"],ResourceConstants.CRMClient);e=e.concat(L)}if(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["assignment_threshold_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaReasoning")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-detailview-actions-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js"],ResourceConstants.CRMClient)),Crm.userDetails.isSubformNewComponentEnabled){var k=["crm-detail-view-subform-component.js","crm-file-upload.js","crux-subform.js","crm-detail-view-subform.css"];Crm.isInventoryModule(this.parent.parent.getDynamicParam())&&(k=k.concat(["crm-create-dependencies.js","crm-detail-view-subform-inventory-dependencies.js"]),e=e.concat(networkUtils.returnDependencyFiles(["crm-detail-view-subform-inventory-dependencies.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-subform.css","crux-table-component-v1.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(k,ResourceConstants.CRMClient))}if(Crm.userDetails.IS_SMART_PROMPT_AVAILABLE){var I=[];I=(I=(I=I.concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js","crm-zia-smart-prompt.js","crm-zia-smart-prompt-store.js","note_model.js","lyte-draggable.js","lyte-resize.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SmartPrompt")],ResourceConstants.CRM)),e=e.concat(I)}return Crm.userDetails.isWorkdriveConfigured&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workdrive")],ResourceConstants.CRM))),Crm.isCpqActivated()&&((crmTab.isZCpqTab(a)||crmTab.isZCpqSubTab(a))&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-breadcrumb.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-cpq-breadcrumb.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),moduleRecordMapping[a]&&moduleRecordMapping[a].child_module&&moduleRecordMapping[a].child_module.length>0&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.js","modal-scroll-box-shadow.js","cpq-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.css"],ResourceConstants.CRMClient)))),Crm.userDetails.isFinanceIntegPresent&&"Products"===a&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-zfinance-stock-info.css","crm-zfinance-rl.js"],ResourceConstants.CRMClient))),Crm.userDetails.isRelatedListLyteEnabled||(e=e.concat(networkUtils.returnDependencyFiles(["crm_related_list_old_flow.css"],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm_related_list_old_flow_rtl.css"],ResourceConstants.CRM)))),e},lyteConvertionSupported:!1,afterModel:function(e){e=e||{};var t=this.parent.parent.getDynamicParam();if(e.entId=this.parent.getDynamicParam(),e.module=t,this.transition.renderFullLytePage)return returnJson={},this.lyteConvertionSupported=!0,this.afterModelHandler(e);if(void 0!==this.getQueryParams().sub_module&&"Activities"===t&&(t=this.getQueryParams().sub_module),store.model[moduleRecordMapping[t].id]||store.registerModel(moduleRecordMapping[t].id,{},{extends:"entity"}),Crm.userDetails.isSubformNewComponentEnabled&&Crm.isSubformSupportedModule(t)){var r=store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam())&&store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam()).Layout?store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam()).Layout.id:void 0;if(!r){var s=moduleRecordMapping[t];r=s.layouts[0].id,"downgraded"===s.layouts.filter((function(e){return e.id===r}))[0].status&&(r=s.layouts.filter((function(e){return"system"===e.generated_type}))[0].id)}var i={},a=moduleRecordMapping[t].api_name,n=store.peekRecord("layout",r,{module:a}),o={layoutId:r,moduleSet:!0,peekField:!1,from:"lyteCreate"};n=store.findRecord("module",moduleRecordMapping[t].id,void 0,void 0,!0,o),i.layoutResp=n;var c=store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam());if(Crm.isInventoryModule(t)){i.taxDetails=store.findAll("tax-detail"),i.productModule=new Promise((function(e){return store.findRecord("module",moduleRecordMapping.Products.id).then((function(t){e(t)}),(function(){e()}))}));var l=store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam()),d={Invoices:"Invoiced_Items",PurchaseOrders:"Purchase_Items",SalesOrders:"Ordered_Items",Quotes:"Quoted_Items"}[t],u=[];l&&l.hasOwnProperty(d)&&l[d]&&l[d].length&&l[d].forEach((function(e){e&&e.Price_Book_Name&&e.Price_Book_Name.id&&u.push(e.Price_Book_Name.id)})),u.length&&(store.model[moduleRecordMapping.PriceBooks.id]||store.registerModel(moduleRecordMapping.PriceBooks.id,{},{extends:"entity"}),i.priceBookModule=new Promise((function(e){return store.findAll(moduleRecordMapping.PriceBooks.id,{ids:u.toString(),approved:"both"}).then((function(t){e(t)}),(function(){e()}))}))),c||(i.recordsResp=store.findRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam(),{approved:"both"},void 0,!0,{version:4}))}else c||(i.recordsResp=store.findRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam(),{approved:"both"},void 0,!0));(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(t))&&(i.validation_rule=store.findAll("validation_rule",{layout_id:r,module:a,download_rules:!0},!1));var m=detailView;return!c||c.$stop_processing||!c.$review||"Review in Progress"!==c.$review&&"Pending for Review"!==c.$review&&"Rejected"!==c.$review&&"Pending for ReReview"!==c.$review?m.review_processForSubform=void 0:i.review_processForSubform=store.triggerAction(moduleRecordMapping[t].id,"review_process",{module:moduleRecordMapping[t].api_name,entityId:this.parent.getDynamicParam()}),Lyte.resolvePromises(i).then(function(e){e.recordsResp&&(this.currentModel.entityRecord=e.recordsResp),e.review_processForSubform&&(m.review_processForSubform=e.review_processForSubform)}.bind(this),function(){}.bind(this))}return store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam())?void 0:store.findRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam(),{approved:"both"})},beforeModel:function(){this.url=void 0,this.doSendRequest=!0,this.obj=void 0,Crm.kanbanObj&&(this.transition.column_name=Crm.kanbanObj.column_name,this.transition.kanbanData=Crm.kanbanObj.kanbanData,Crm.kanbanObj=void 0);var e=objectUtils.cloneObject(this.transition.data);(this.transition.info.queryParams&&"gsearch"===this.transition.info.queryParams.pfrom&&(e.pfrom="gsearch"),e.id=e.id?e.id:this.parent.getDynamicParam(),e.module=e.module?e.module:this.parent.parent.getDynamicParam(),!Crm.userDetails.isRelatedListLyteEnabled||"Campaigns"!==e.module&&"Contacts"!==e.module&&"Leads"!==e.module||app.store.makeRequest("findAll","field",{module:"Campaign_Leads_Members"},!0),"Deals"==e.module&&(e.module="Potentials"),"Meetings"==e.module&&(e.module="Events"),"Activities"==e.module)&&(void 0!==this.parent.parent.getQueryParams().sub_module?e.module=this.parent.parent.getQueryParams().sub_module:(r=store.peekRecord(moduleRecordMapping[e.module].id,e.id))&&void 0!==r.Activity_Type&&(e.module=r.Activity_Type));this.getQueryParams().iframe_src&&(e.iframe_src=this.getQueryParams().iframe_src),"CustomModule5004"==e.module&&Handlebars.registerPartial("ZOMPackagesPartial",Handlebars.templates.ZOMPackagesPartial),delete e.backOneLevel,delete e.clearCache,delete e.kafkaWFData,delete e.needClearCache,delete e.listeners,delete e.skipDirtyCheck,delete e.save,detailView.recordLockingDetails={},detailView.recordLockingDetails.lockingConfigJSON=e.locking_configuration,delete e.locking_configuration;var t={};if(Crm.latestEntId=this.parent.getDynamicParam(),this.transition.data&&this.transition.data.fromid&&(Crm.latestEntId=this.transition.data.fromid,delete e.fromid),("true"==e.navig||e.cvid)&&"rel"!=e.pfrom&&e.recordNum){crmNavig.customViewKey=e.cvid&&"null"!=e.cvid?e.cvid:e.module,crmNavig.customViewKey=validationUtils.isNotEmpty(e.stageId)?crmNavig.customViewKey+"#"+e.stageId:crmNavig.customViewKey;var r,s=e.FROM_INDEX?parseInt(e.FROM_INDEX):$("input[name=cvFromIndex]")[0]?parseInt($("input[name=cvFromIndex]").val()):$("input[name=fromIndex]")?parseInt($("input[name=fromIndex]").val()):1,i=$("input[name=rangeValue]")[0]?parseInt($("input[name=rangeValue]").val()):$("input[name=cvRangeValue]")?parseInt($("input[name=cvRangeValue]").val()):10,a=e.TO_INDEX?parseInt(e.TO_INDEX):parseInt(s)+i-1;s&&(e.FROM_INDEX=s),a&&(e.TO_INDEX=a),r="true"!=e.fromDel?parseInt(e.recordNum)<=s?parseInt(e.recordNum)-1:parseInt(e.recordNum)+1:parseInt(e.recordNum),crmNavig.customViewKey&&-1!==crmNavig.customViewKey.indexOf("#")&&crmNavig[crmNavig.customViewKey]&&crmNavig[crmNavig.customViewKey].recordId&&(s=1,a=crmNavig[crmNavig.customViewKey].recordId.length-1),"kanbanview"!==e.view||!featuresAvailable.NEXTGENUI_ENABLED||"Tasks"!==e.module&&"Events"!==e.module&&"Calls"!==e.module&&"Activities"!==e.module||(delete e.view,delete e.clickId,e.FROM_INDEX=s,e.TO_INDEX=a,this.transition.data=e),(parseInt(e.recordNum)===s||parseInt(e.recordNum)===a||"true"===e.fromDel&&"Activities"!==Crm.activityGrp[e.module])&&crmNavig[crmNavig.customViewKey]&&crmNavig.triggerFetch(s,a,r,e,void 0,void 0,t)}if(delete e.navig,delete e.fromRL,delete e.primary_module,delete e.record_response,delete e.skipRecordFetch,delete e.recordId,delete e.affected_data,e.fromDetailView&&$("#detailCView").length){var n;if(this.transition.renderFullLytePage&&(n={},this.transition.act_dV_props=n),!this.transition.renderFullLytePage&&this.transition.lyteHeaderSupported)return this.fetchDVModuleInfo(e,!0,n,t);loadActivityDetails(void 0,void 0,e,e.id,void 0,void 0,void 0,void 0,n),this.transition.act_dV_props&&this.transition.act_dV_props.outlet&&(this.transition.act_dV_props.loadingadded=!0,$("#"+this.transition.act_dV_props.outlet).html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>'))}else if("kanbanview"!=e.view){var o=!0;!featuresAvailable.NEXTGENUI_ENABLED&&(e.fromActivityListView||e.fromActSubModuleListView||e.fromDetailView)&&0===$("#detailCView").length&&"Activities"===Crm.activityGrp[e.module]&&(o=!1),delete e.activitytype,delete e.view,Crm.origin&&(e.origin=Crm.origin),e.format="json";if("Forecasts"==e.module&&delete e.isload,e.pfrom||(e.pfrom="cv"),"Activities"===Crm.activityGrp[e.module]&&(Crm.isPageLoad||featuresAvailable.NEXTGENUI_ENABLED)&&(e.fromDetailView&&delete e.fromDetailView,e.fromActivityListView&&delete e.fromActivityListView),featuresAvailable.NEXTGENUI_ENABLED&&(e.fromActSubModuleListView||e.fromActivityListView)&&!1!==o&&"Activities"===Crm.activityGrp[e.module]||!e.fromActSubModuleListView&&!e.fromActivityListView&&!1!==o||(e.fromActSubModuleListView||e.fromActivityListView)&&"Activities"!==Crm.activityGrp[e.module]){var c=Crm.getCrmBasePath()+"/ShowEntityInfo.do",l=0;for(var d in e)/\b(calleeObj|clickId)\b/.test(d)||void 0!==e[d]&&(c+=0==l?"?":"&",c+=d+"="+encodeURIComponent(e[d]),l++);(e.module||e.parModule)&&(e.module?crmTab.updateTabContent(e.module):crmTab.updateTabContent(e.parModule)),this.url=c,isRelatedListLoaded=!0}0==o&&(this.doSendRequest=!1,this.obj=e)}var u=this.parent.parent.getDynamicParam(),m=this,p=this.parent.getDynamicParam(),h=store.peekRecord(moduleRecordMapping[u].id,p),f=h&&h.Layout?h.Layout.id:store.peekRecord("module",moduleRecordMapping[u].id).layouts[0].id;return app.store.makeRequest("findAll","related_list",{module:moduleRecordMapping[u].api_name,layout_id:f},!1,!0,{record:h}).then((function(e){Lyte.Globals.set("relatedList.layoutId",f),Lyte.Globals.set("relatedList.rlData",e),Lyte.Globals.set("relatedList.rlReqResolved",!0),m.processRlPreFetch(u,p,e,f)})),detailView&&(detailView.cscriptFieldAttribs={},detailView.cscriptButtonAttribs={}),this.fetchDVModuleInfo(e,void 0,void 0,t)},fetchDVModuleInfo:function(e,t,r,s){s||(s={}),thisObj=this;var i=moduleRecordMapping[e.module].id,a=!1,n=!1;if(store.model[i]||(store.registerModel(i,{},{extends:"entity"}),n=!0),store.modelFor(i)&&store.peekAll(i)&&0!==store.peekAll(i).length||(a=!0,s.module=store.findRecord("module",i)),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&"Campaigns"===thisObj.transition.info.dynamicParams[0]&&(Crm.userDetails.permissions.Crm_Implied_Manage_ABM?s.orchestrations=store.findAll("orchestration_process",{category:"abm"}):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&(s.orchestrations=store.findAll("orchestration_process"))),this.transition.info.skipRecordFetch||(n=!0),featuresAvailable.NEXTGENUI_ENABLED){var o="Activities"===Crm.activityGrp[e.module],c=document.querySelector("crm-left-menu-loader").component;c.setData("isActivityModule",o),c.setData("view","detail");var l=setTimeout((function(){c.executeMethod("showLoaderBasedOnView",c)}),2e3),d=document.querySelector("crm-left-menu").component;d.methods.clearLoaderTimeout(),d.setData("loaderTimeout",l)}var u=store.peekRecord(moduleRecordMapping[this.parent.parent.getDynamicParam()].id,e.id);u&&u.Locked__s&&detailView.recordLockingDetails&&detailView.recordLockingDetails.lockingConfigJSON&&(s.lockedRecord=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/"+moduleRecordMapping[e.module].api_name+"/"+e.id+"/Locking_Information__s",method:"GET"}).then((function(e){return e}),(function(e){return e})),s.lockingInfoFields=store.findAll("field",{module:moduleRecordMapping.LockingInformation.api_name},!0,!0,{apiVersion:"2.2"})),store.modelFor(i)&&moduleRecordMapping[e.module].fields||(a||(s.module=store.findRecord("module",i)),n=!0);var m=store.peekRecord(i,e.id);if(n||!m){n=!1;var p=Crm.renderDVLyteFlow(e.module)&&Crm.isInventoryModule(e.module)?{version:4,fromDetailRoute:!0}:{};s.moduleRecordInfo_new=store.findRecord(i,e.id,Crm.get_params_for_getRecord(),void 0,!0,p).then((function(t){if(t[0]){if(t[0]&&t[0].Locked__s&&detailView.recordLockingDetails&&detailView.recordLockingDetails.lockingConfigJSON){var r={};return r.lockedRecord=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/"+moduleRecordMapping[e.module].api_name+"/"+e.id+"/Locking_Information__s",method:"GET"}).then((function(e){return e}),(function(){})),r.lockingInfoFields=store.findAll("field",{module:moduleRecordMapping.LockingInformation.api_name},!0,!0,{apiVersion:"2.2"}),r.response=t,Lyte.resolvePromises(r)}return t}}),(function(e){murphy.error(e)}))}var h=Lyte.resolvePromises(s);return h.then(function(s){s&&s.moduleRecordInfo_new&&s.moduleRecordInfo_new.lockingInfoFields&&s.moduleRecordInfo_new.lockedRecord&&(s.lockingInfoFields=s.moduleRecordInfo_new.lockingInfoFields,s.lockedRecord=s.moduleRecordInfo_new.lockedRecord,s.moduleRecordInfo_new=s.moduleRecordInfo_new.response),s&&s.lockedRecord&&(detailView.recordLockingDetails.lockedRecordDetails=s.lockedRecord.data,detailView.recordLockingDetails.lockingInfoFields=s.lockingInfoFields),t&&(r=this.fetchApiData(),this.transition.lyteReqsSent=!0,loadActivityDetails(void 0,void 0,e,e.id,void 0,void 0,void 0,void 0,r));var a=store.peekRecord(i,e.id,Crm.get_params_for_getRecord());if(n||!a)return store.findRecord(i,e.id,Crm.get_params_for_getRecord()).then((function(e){return e[0]?e:void 0}),(function(e){murphy.error(e)}))}.bind(this),(function(e){murphy.error(e)})),h},actions:{willTransition:function(e){if(void 0!==this.viewPortSettingsDebounce&&Crm.userDetails.isRelatedListLyteEnabled&&(Lyte.Component.viewPortSettings.debounce=this.viewPortSettingsDebounce),LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,s=0;s<r;s++)t[s].$node&&t[s].$node.id&&"chat-popup"==t[s].$node.id&&t[s].setData("ltPropBindToBody",!1);null!==crmBstTime.updateTimeout&&(clearTimeout(crmBstTime.updateTimeout),crmBstTime.updateTimeout=null),null!==crmBstTime.updateInterval&&(clearInterval(crmBstTime.updateInterval),crmBstTime.updateInterval=null);var i=$("#zWebSendInvite");i&&i.is(":visible")&&CrmCampaignInteg.hideListView(),Notes.noteContent="";var a=$L("#noteContentTxt");a.length>0&&a.hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("noteContentTxt"),store.unloadAll("zia_insights"),store.unloadAll("zia-insights-v2");var n=Lyte.registeredMixins["email-sharing-alert"];n&&n.closeEmailSharingAlertPopup();var o=$L("#field_mapping_popup")[0];o&&o.ltProp("show",!1),delete Crm.isDVRefreshForLock,delete Crm.DVRefreshData},didTransition:function(){if(this.bindShortcutsAfterRender("Record Details View"),this.actfromKanban){var e=$("#recordid_"+this.parent.getDynamicParam()),t=this.transition.column_name,r=$("#"+t+"_leftContainerctn");Territory.doHighLight("#"+t+"_leftContainerctn",e,r.offset().top,r.height()-20),e.addClass("ligraybackground"),delete this.transition.column_name,delete this.actfromKanban,delete this.kanbanResolve}if(Crm.userDetails.isRelatedListLyteEnabled){var s=$L("crm-manual-call-list")[0];s&&s.remove&&s.remove()}}},model:function(){if(Crm.userDetails.isChronologicalviewEnabled&&Crm.userDetails.actUserRelViewObj){let e;e=Crm.userDetails.actUserRelViewObj.actviewobj?Crm.userDetails.actUserRelViewObj.actviewobj.detail:Crm.userDetails.actUserRelViewObj.detail,Crm.userDetails.openActRelView=e.openActRelView,Crm.userDetails.closedActRelView=e.closedActRelView}if("undefined"==typeof Detail_API_Optimisation||1!=Detail_API_Optimisation)try{var e=this.parent.parent.getDynamicParam(),t=moduleRecordMapping[e].api_name,r=Lyte.Router.getRouteInstance().parent.parent.currentModel.module.module_name;if("crm.tab.module.entity.detail"===this.transition.target&&t&&!Crm.userDetails.DETAIL_VIEW_LYTE){var s=store.peekRecord(moduleRecordMapping[r].id,this.parent.getDynamicParam()),i=store.peekRecord("module",moduleRecordMapping[r].id),a="";a=s.$layout_id?s.$layout_id.id:s.Layout?s.Layout.id:i.layouts[0].id;let e={from:"Chronological"};store.findAll("related_list",{module:t,layout_id:a},!1,void 0,e)}}catch(e){murphy.error(e)}if(!this.transition.renderFullLytePage&&this.transition.lyteHeaderSupported&&!this.transition.lyteReqsSent)var n=this.fetchApiData();if(!0===this.transition.renderFullLytePage){this.transition.data&&"kanbanview"===this.transition.data.view&&($("#entitypopup").html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>'),$("#dv-button-layer,#rp_td").addClass("dN")),this.transition.act_dV_props&&this.transition.act_dV_props.outlet&&!this.transition.act_dV_props.loadingadded&&$("#"+this.transition.act_dV_props.outlet).html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>');var o=Lyte.Router.getRouteInstance().parent.getDynamicParam();if(this.transition.info&&this.transition.info.requestErrorInfo)try{if("NO_PERMISSION"===JSON.parse(this.transition.info.requestErrorInfo.responseText).code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort(),!1}catch(e){murphy.error(e)}r=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();if(!(s=store.peekRecord(moduleRecordMapping[r].id,o)))return featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),Lyte.registeredMixins["crm-detailview-common-utils"].renderPermissionDenied(o,r),this.transition.abort(),!1;var c=r;if(void 0!==Lyte.Router.getRouteInstance().getQueryParams().sub_module&&"Activities"===r&&(c=Lyte.Router.getRouteInstance().getQueryParams().sub_module),("Leads"===r||-1!==r.indexOf("LinkingModule"))&&!0===s.$converted){var l=networkUtils.returnDependencyFiles(["crm-convertlead.js"],ResourceConstants.CRMClient);return l=(l=l.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("convertlead")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-convert-lead.css"],ResourceConstants.CRMClient)),Lyte.injectResources(l,void 0).then((function(){return{converted_detail:[s]}}))}if("Messages"===r){var d;window.Messages={moduleName:"Messages",currentStatus:"view",entityId:this.transition.info.dynamicParams[0]},d=this.transition.data.cvid?this.transition.data.cvid:moduleRecordMapping.Messages.cvid,this.transition.data.recordNum&&(crmTab.getFromCache("Messages").recordNum=this.transition.data.recordNum),crmTab.getFromCache("Messages")&&(this.transition.data.recordNum=crmTab.getFromCache("Messages").recordNum,this.transition.data.TO_INDEX=crmTab.getFromCache("Messages").fromIndex,this.transition.data.FROM_INDEX=crmTab.getFromCache("Messages").toIndex);s=store.peekRecord("custom_view",d);var u={record:store.findRecord("immessage",this.transition.info.dynamicParams[1])};s&&s.sort_by||(u.custom_view=store.findRecord("custom_view",d,{module:"messages__s"}));var m=Lyte.registeredMixins["crm-detailview-common-utils"].initiateModelRequests(void 0,void 0,c,o);return Lyte.resolvePromises(u).then((function(e){return{messages:e,fields:m.fields}}))}var p=this,h=objectUtils.cloneObject(this.transition.data);return this.url||!1!==this.doSendRequest?Lyte.registeredMixins["crm-detailview-common-utils"].initiateModelRequests(void 0,void 0,c,o):new Promise((function(e){var t={};p.transition.act_detReq=t;var r=Lyte.registeredMixins["crm-detailview-common-utils"].initiateModelRequests(t,void 0,c,o);loadDVWithRp(p.obj,e,t,r)}))}p=this,e=this.parent.parent.getDynamicParam(),h=objectUtils.cloneObject(this.transition.data);var f=!!(this.transition.kanbanData||h.view&&"kanbanview"===h.view);if(f&&featuresAvailable.NEXTGENUI_ENABLED&&("Tasks"===h.module||"Events"===h.module||"Calls"===h.module||"Activities"===h.module)&&(f=!1),f)return this.kanbanResolve={},new Promise((function(e){TaskKanbanView.kvrecordid=h.id,void 0!==n?Lyte.resolvePromises(n).then((function(t){n.detailview_buttons=t.detailview_buttons,n.business_card=t.business_card,n.custom_buttons=t.custom_buttons,n.zia_insights=t.zia_insights,loadActivityDetails(void 0,void 0,h,h.id,void 0,void 0,e,p.kanbanResolve)})):loadActivityDetails(void 0,void 0,h,h.id,void 0,void 0,e,p.kanbanResolve)}));if(Crm.isSubformSupportedModule(e)&&Crm.userDetails.isSubformTimelineUISupportEnabled){var g=store.peekRecord("module",moduleRecordMapping[e].id).child_module;if(g)(void 0!==(g=g.filter((e=>"subform"===e.generated_type||"static_subform"===e.generated_type)))?g:[]).forEach((function(e){void 0===e.layouts&&store.findAll("field",{module:e.api_name,type:"all"},!1,void 0,{apiVersion:"2.2"})}))}return store.unloadAll("servapp_preferences"),this.url?new Promise((function(t,r){Crm.downloadValidationRules(p.url,e),void 0!==n?(n.dvRender=detailView.entityInfoCall(p.url,void 0,t,void 0,void 0,"show"),Lyte.resolvePromises(n).then((function(e){n.detailview_buttons=e.detailview_buttons,n.business_card=e.business_card,n.custom_buttons=e.custom_buttons,n.zia_insights=e.zia_insights,n.associated_kiosks=e.associated_kiosks,e.dvRender&&detailView.load(p.url,void 0,void 0,void 0,t,void 0,detailView.successEntityCallback,e.dvRender)}))):detailView.load(p.url,void 0,void 0,void 0,t)})):0==this.doSendRequest?new Promise((function(e,t){void 0!==n?Lyte.resolvePromises(n).then((function(t){n.detailview_buttons=t.detailview_buttons,n.business_card=t.business_card,n.custom_buttons=t.custom_buttons,n.zia_insights=t.zia_insights,loadDVWithRp(p.obj,e)})):loadDVWithRp(p.obj,e)})):void 0},renderTemplate:function(e){if(!0===this.transition.renderFullLytePage){var t=$L("#show");if(e.converted_detail)return t.empty(),{outlet:"#show",component:"crm-convert-lead"};if(e.messages)return renderingUtils.resizeWindowHW(),e.selectedConversationId=this.transition.info.dynamicParams[1],e.selectedCustomViewId=this.transition.data.cvid?this.transition.data.cvid:moduleRecordMapping.Messages.cvid,e.showDetailView=!0,e.showManageText=!1,e.record=e.messages.record,e.isDetailView=!0,commonUtils.showHideLoadingDiv(!1),t.empty(),{outlet:"#show",component:"crm-detail-view"};if(this.transition.kanbanData&&!featuresAvailable.NEXTGENUI_ENABLED&&"Activities"===Crm.activityGrp[this.transition.data.module]){var r=this.transition.column_name;customViewObject.columns=[r];var s=["Closed","Open","RelatedTo","other"];customViewObject.position=s.indexOf(r),customViewObject.fromDetailRoute=!0;var i=Handlebars.templates.TaskKanbanView(customViewObject);t.html(i),crmListView.kanbanView(this.transition.kanbanData),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),e.show_cv_left_panel=!0,$("#"+this.transition.column_name+"_header").find(".leftheaderBack").show(),delete this.transition.kanbanData,this.actfromKanban=!0}if(!1===this.doSendRequest&&this.transition.act_detReq&&this.transition.act_detReq.html)return e.show_cv_left_panel=!0,t.html(this.transition.act_detReq.html),EvalInnerScript(t[0]),$L("#taskDetailsPart").empty(),{component:"crm-detail-view",outlet:"#taskDetailsPart"};var a=this.actfromKanban?"#kventitydetailspage":"#show";this.transition.data&&"kanbanview"===this.transition.data.view&&($("#dv-button-layer,#rp_td").addClass("dN"),$(".kanbanTaskDetailCenterContainer").addClass("w100_per").removeClass("fL"),a="#entitypopup"),this.transition.act_dV_props&&this.transition.act_dV_props.outlet&&(a="#"+this.transition.act_dV_props.outlet);var n=$L(a);return n&&n.length?n.empty():a="#show",{component:"crm-detail-view",outlet:a}}this.transition.data&&"kanbanview"===this.transition.data.view&&$(".kanbanTaskDetailCenterContainer").addClass("fL").removeClass("w100_per");var o=this.parent.parent.getDynamicParam();if(Crm.userDetails.isSubformNewComponentEnabled&&Crm.isSubformSupportedModule(o)&&this.currentModel&&this.currentModel.entityRecord&&store.pushPayload(moduleRecordMapping[o].id,this.currentModel.entityRecord),this.transition.kanbanData){if(o=this.transition.kanbanData.kvmodule,featuresAvailable.NEXTGENUI_ENABLED&&("Tasks"===o||"Events"===o||"Calls"===o||"Activities"===o))return e;r=this.transition.column_name;customViewObject.columns=[r];s=["Closed","Open","RelatedTo","other"];return customViewObject.position=s.indexOf(r),customViewObject.fromDetailRoute=!0,{outlet:"#show",html:i=Handlebars.templates.TaskKanbanView(customViewObject)}}return e},afterRender:function(e,t){Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&Lyte.Component.render("crm-zia-smart-prompt",{},"#show"),CFRExec.ruleExecutedinDetailViewPage=!1,!this.transition.renderFullLytePage&&this.transition.lyteHeaderSupported&&returnJson&&(returnJson.record_actions=detailView.lyte_headerDataHolder.detailview_buttons?objectUtils.cloneObject(detailView.lyte_headerDataHolder.detailview_buttons):{},returnJson.business_card_meta=detailView.lyte_headerDataHolder.business_card,returnJson.custom_buttons=detailView.lyte_headerDataHolder.custom_buttons?detailView.lyte_headerDataHolder.custom_buttons:{},returnJson.zia_insights=detailView.lyte_headerDataHolder.zia_insights,returnJson.dv_layoutId=detailView.lyte_headerDataHolder.dv_layoutId,returnJson.associated_kiosks=detailView.lyte_headerDataHolder.associated_kiosks);var r=this.parent.parent.getDynamicParam(),s=this.parent.getDynamicParam();if(featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),this.transition.renderFullLytePage){if(e.converted_detail||e.messages)return void this.initializeClientScript();$L("#newRelDetails").hide();var i=$L("crm-detailview-related-record");i&&i[0]&&i[0].remove(),this.loadRelatedRecords(this,r,s),"Activities"===Crm.activityGrp[r]&&selectCurrentCV(s);var a=e.entity_name;if("Calls"===r&&a&&(a=a.name),a)n=a+" ("+(n=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label)+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[n,Crm.appName]))}if(this.getQueryParams().newSignUp&&CPMF.getClientPortalUserLocaleInfo(),!this.transition.renderFullLytePage){var n,o=t.queryParams,c=!!this.transition.kanbanData;if(c&&featuresAvailable.NEXTGENUI_ENABLED)"Tasks"!==(r=this.transition.kanbanData.kvmodule)&&"Events"!==r&&"Calls"!==r&&"Activities"!==r||(c=!1);if(c){crmListView.kanbanView(this.transition.kanbanData),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#"+this.transition.column_name+"_header").find(".leftheaderBack").show(),delete this.transition.kanbanData;var l=$L("#entitypopup")[0];l.innerHTML=e,this.actfromKanban=!0,Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",o.sub_module,this.parent.getDynamicParam()),EvalInnerScript(l),init(void 0,void 0,void 0,this.transition.lyteHeaderSupported)}if(this.kanbanResolve&&this.kanbanResolve.dummyPromise&&($$rightPanel.prerequisitesSettings(),this.kanbanResolve.resolve(this.kanbanResolve.responseData)),Crm.userDetails.isRelatedListLyteEnabled||(crmRelatedList.filters={}),delete CustomButtonJSObjectInit.checkBox,this.url){if(adSearchClose(),isKanbanView="true"===$("#iskanbanview").val(),getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$L("#basic").scrollTo({axis:"y",duration:1,offset:-50});commonUtils.showHideLoadingDiv(),this.transition.data.affected_data&&(detailView.affectedData=this.transition.data.affected_data,delete this.transition.data.affected_data),init(void 0,void 0,void 0,this.transition.lyteHeaderSupported),enableSkype(),isWorking=!1;var d=void 0;if($("#recordNum").length>0&&(d=parseInt($("#recordNum")[0].value)),crmNavig.setNavigButtonState(d),returnJson&&!Crm.userDetails.isRelatedListLyteEnabled){for(var u=returnJson.relListLabelsJson.relListLabelJson.length,m=[],p=0;p<u;p++)m[p]=returnJson.relListLabelsJson.relListLabelJson[p].name.toLowerCase()+"_"+returnJson.relListLabelsJson.relListLabelJson[p].id;if(crmRelatedList.personalityArr=m.join("||"),returnJson.relListLabelsJson){returnJson.layout_jsonarrayObj&&(returnJson.relListLabelsJson.layoutId=returnJson.layout_jsonarrayObj.currLayoutId),returnJson.relListLabelsJson.moduleApiName=moduleApiMapping[returnJson.relListLabelsJson.module];var h=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(h),$("#projects_sort")&&thirdPartyUtils.bindSelect2("#projects_sort"),$("#portalRList")&&thirdPartyUtils.bindSelect2("#portalRList select")}}if(r.startsWith("Orchestration")||r.startsWith("PathFinder"))return;if(detailView.refreshInWms)return"Activities"==r&&(r=t.queryParams.sub_module),detailView.hideElementsForKafkaWorkFlow(r),void(automationActionsNotificationScheduler.singleRecordOffloadTimeout=setTimeout((function(){detailView.refreshInWms&&(detailView.refreshInWms=!1,detailView.singleRecordLyteOffloading=!1,detailView.callLyteRefresh(r))}),1e3));if("CustomModule5004"==r&&$("#zbCMDetailsIframe").on("load",(function(){try{$("#zbCMDetailsIframe").contents().find("div#inventoryPackages").remove()}catch(e){}})),getObj("messageValue"))var f=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&messageValue="+getObj("messageValue").value;else f=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData";var g=document.getElementById("relNEID"),y="";if(g&&/^[0-9]+$/.test(g.value)&&(y="&neid="+g.value),f+=y,getObj("parentCurrencyISOCode")&&getObj("parentExchangeRate")&&(f+="&parentCurrencyISOCode="+getObj("parentCurrencyISOCode").value+"&parentExchangeRate="+getObj("parentExchangeRate").value),getObj("zproject_errorcode")&&""!=getObj("zproject_errorcode").value&&"null"!=getObj("zproject_errorcode").value&&(f+="&errorcode="+getObj("zproject_errorcode").value),getObj("zproject_not_added_clients")&&""!=getObj("zproject_not_added_clients").value&&"null"!=getObj("zproject_not_added_clients").value&&(f+="&zproject_not_added_clients="+getObj("zproject_not_added_clients").value),"Potentials"==r){var v=$("#cntId");v.length>0&&"null"!==v.val()&&(f+="&relCntId="+v.val())}else"Activities"==r&&(r=this.parent.parent.getQueryParams().sub_module);var _={module:decodeURIComponent(r),id:s,fromIndex:1};if(returnJson&&returnJson.relListLabelsJson&&Crm.userDetails.isRelatedListLyteEnabled){crmConstants.isVocCustomisable||(returnJson.relListLabelsJson.vocOldFlow=!0),returnJson.layout_jsonarrayObj&&(returnJson.relListLabelsJson.layoutId=returnJson.layout_jsonarrayObj.currLayoutId),returnJson.relListLabelsJson.moduleApiName=moduleApiMapping[returnJson.relListLabelsJson.module];var C="#relatedPageContent";"Events"===r&&($L("#eventsRightPanelAttachDiv").length?C="#eventsRightPanelAttachDiv":$L("#eventsRightPanelNotesDiv").length&&(C="#eventsRightPanelNotesDiv"));var R="Events"!==r?"#relatedPageContent":C;this.viewPortSettingsDebounce=Lyte.Component.viewPortSettings.debounce,Lyte.Component.viewPortSettings.debounce=200,Lyte.Globals.set("relatedList.detailViewAfterRender",!0),Lyte.Globals.set("relatedList.rlOutlet",R),this.processRlPreFetch(r,s,void 0,void 0,R),$L("#projects_sort")&&thirdPartyUtils.bindSelect2("#projects_sort"),$L("#portalRList")&&thirdPartyUtils.bindSelect2("#portalRList select")}if(!Crm.userDetails.isRelatedListLyteEnabled)var b=new crmRequestPool,w={action:f,type:"GET",data:_,success:function(e){if(crmRelatedList.load(r,s,e,!0),("Accounts"===_.module||"Contacts"===_.module||"Potentials"===_.module)&&e.ZFinance_Rel_Count)var t=e.ZFinance_Rel_Count.estimates+e.ZFinance_Rel_Count.salesOrders+e.ZFinance_Rel_Count.invoice,i=e.ZFinance_Rel_Count.subscriptions;if("Vendors"===_.module&&e.ZFinance_Rel_Count)t=e.ZFinance_Rel_Count.purchaseOrders;var a=$('[data-zcqa= "newleft__Zoho Finance"]');a.length||(a=$('[data-zcqa= "newleft__Zoho Books"]'));var n=$('[data-zcqa= "newleft__Zoho Billing"]'),o=n.find("span.numCountn"),c=a.find("span.numCountn");if(i&&0!=n.length&&o.addClass("numCountVal").text(i),i||0==n.length||o.text("").removeClass("numCountVal"),t&&0!=a.length&&c.addClass("numCountVal").text(t),t||0==a.length||c.text("").removeClass("numCountVal"),"Accounts"===_.module){var l=$('div[ddname="CONTACTSPERSONALITY"]');if($("#contactTreePopup").closest("#RelatedListCommonDiv").find("[id^=norec_]").length>0){let e;l.find("[id=contactTreePopup]").addClass("disabledArow");let t=moduleRecordMapping.Contacts;if(t&&t.fields){e=t.fields;var d=!1,u=e.length;for(p=0;p<u;p++)if("REPORTINGTOCONTACTID"===e[p].column_name){d=!0;break}d||l.find("[id=contactTreePopup]").remove()}else store.findAll("field",{module:"Contacts"},!0,!0,{apiVersion:"2.2"}).then((function(e){var t=!1,r=e.length;for(p=0;p<r;p++)if("REPORTINGTOCONTACTID"===e[p].column_name){t=!0;break}t||l.find("[id=contactTreePopup]").remove()}))}}else if("Contacts"===_.module){(l=$('div[ddname="REPORTINGCONTACTSPERSONALITY"]')).find("[id^=norec_]").length>0&&l.find("[id=contactTreePopup]").addClass("disabledArow")}}};var M={newModel:!0};M.module=r,Crm.executeLayoutRule(this.url,M,"view"),Crm.userDetails.isRelatedListLyteEnabled||b.initiate(w)}else if(0==this.doSendRequest){var D=$("#detailCView").children().length;if(D<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var P=parseInt(getObj("cvFromIndex").value);parseInt(getObj("cvToIndex").value);$("#from_To").text(P+" - "+(P+D-1))}}if(Crm.userDetails.detailView_newUI&&detailView.setCurrentStageSetReload(),a=$("#entityName").val())n=a+" ("+(n=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label)+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[n,Crm.appName]))}if("true"==this.transition.info.queryParams.showShared){var L=moduleRecordMapping[r].profiles,k=[],I=[],U=[],E="(profile:in:",A=L.length;for(p=0;p<A;p++)"Administrator"!==L[p].name&&(I.push(L[p].id),k.push(L[p].name));var j={};1===I.length?(E="(profile:equals:"+k[0].toString().replace("(","\\(").replace(")","\\)")+")",j.comparator="equal",j.field="profile.id",j.value=I[0]):(j.value=I,j.comparator="in",j.field="profile.id",E=E+k.join(",").replace("(","\\(").replace(")","\\)")+")"),U.push(j),U.push("and");var T=this.parent.getDynamicParam(),F=networkUtils.returnDependencyFiles(["crm-detailview-share-modal.js","lyte-hovercard.js"],ResourceConstants.CRMClient);F=(F=F.concat(networkUtils.returnDependencyFiles(["crm-detailview-share-modal.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recordlevelsharing")],ResourceConstants.CRM)),commonUtils.showHideLoadingDiv(!0);let e=this.transition.renderFullLytePage?"crm-detail-view":".DetailViewInnerPage";$(e).append('<div id="shareContactPopup"></div>'),Lyte.resolvePromises({roles:store.findAll("role",null,!1,!0),filesResolved:Lyte.injectResources(F),shareData:store.triggerAction("entity","share",{type:"GET",module:moduleRecordMapping[r].api_name,entityId:T}),moduleInfo:store.peekRecord("module",moduleRecordMapping[r].id),recordInfo:new Promise((function(e){var t=store.peekRecord(moduleRecordMapping[r].id,T);t?e(t):store.findRecord(moduleRecordMapping[r].id,T).then((function(t){e(t[0])}))}))}).then((function(e){commonUtils.showHideLoadingDiv(!1);var t={comparator:"not_equal",field:"role.name"},s=e.roles.filter((function(e){if(!e.reporting_to)return e}))[0];t.value=s.name,U.push(t);var i={type:"SubordinateRoleUsers",role_id:s.id,include_lite_users:!0},a=[{users:Array.from(new Set([Crm.userDetails.USER_ID,e.recordInfo.Owner.id])),roles:[s.id],groups:[]}],n=Lyte.Component.render("crm-detailview-share-modal",{userCriteria:U,searchCriteria:E,queryParam:i,module:r,entityId:T,shareData:e.shareData,moduleInfo:e.moduleInfo,excludeModel:a,excludeMembers:a,forceFetch:!0},"#shareContactPopup");n.show?n.show(!1):n.component.show&&n.component.show(!1)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.responseText);"403"==e.status||"400"==e.status?"Scheduler is running"===t.message?(Lyte.Component.render("crm-detailview-share-modal",{onProcess:!0,module:r},"#shareContactPopup"),$L("#crm-detailview-share-modal")[0].ltProp("show",!0)):renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.mb.alert.complete.operation.later"),36e4)}))}var S=$L("#recentItemsModal");S[0]&&S[0].ltProp("show")&&S[0].ltProp("show",!1),this.initializeClientScript();var x=this.transition.data.kafkaWFData;if(Crm.renderDVLyteFlow(r)&&x){var N=$L("crm-detail-view")[0];Lyte.registeredMixins["crm-detailview-common-utils"].singleRecordKafkaWFOffload(N,r,x)}if(Crm.isDVRefreshForLock=!0,Crm.DVRefreshData&&r===Crm.DVRefreshData.currentModule&&s===Crm.DVRefreshData.currentEntityId)if(Crm.renderDVLyteFlow(r)){var O=$L("crm-detail-view");if(O&&O[0]&&O[0].component){var q=O[0].component.data.unique_listener_id;Lyte.triggerEvent("detail_view_listener_"+q,{componentsToBeReloaded:["all_components"],triggerCPQAPIS:Crm.DVRefreshData.triggerCPQAPIS})}}else reloadCurrentEntityView(Crm.DVRefreshData.currentEntityId,Crm.DVRefreshData.currentModule);setTimeout((function(){for(var e=$(".custLinkTxt"),t=e?e.length:0,r=0;r<t;r++)detailView.setTitleforEllipsis(e.eq(r)[0],!0)}),1500)},beforeExit:function(){_cruxUtils.removeCustomMessage(),!this.transition.renderFullLytePage&&detailView.haveSpotEdited&&(crmTab.deleteFromCache(this.parent.parent.getDynamicParam()),detailView.haveSpotEdited=!1),detailView.readOnlyField=!1,itsonview=!1;var e=$("#fieldHighlightId").eq(0);e&&e.remove(),detailView.socialVisible=!1;var t=$("#projectsPopup");t&&t.length>0&&t.remove(),"undefined"!=typeof customFunctionsObj&&(customFunctionsObj.listRelationId=null,customFunctionsObj.postRouteProcess());var r=$("#subSecondaryPopup");if(r.is(":visible")&&r.find("#cancel").trigger("click"),$("#markPopups").empty(),Lyte.Component.viewPortSettings.debounce=0,this.transition.data.needClearCache)this.transition.data.primary_module?crmTab.deleteFromCache(this.transition.data.primary_module,!0):crmTab.deleteFromCache(this.transition.info.dynamicParams[0],!0);else{var s=$("#dv-button-layer").find("crm-detailview-header");if(s&&s[0]&&(s=s[0].component)){var i=s.getData("record");(i.$.isDirty()||i.$.getDirtyAttributes().length>0)&&(this.transition.data.primary_module?crmTab.deleteFromCache(this.transition.data.primary_module,!0):crmTab.deleteFromCache(this.transition.info.dynamicParams[0],!0))}}"undefined"!=typeof crmLookupBusinessCard&&(crmLookupBusinessCard.result=null),detailView.fetchingZiaRecommendation=!1,detailView.ziaRecommendation={};var a=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];a&&a.unbindShortcutsBeforeExit("Record Details View");var n=$L("#detailViewUtilAlert");n&&n[0]&&n[0].ltProp("show",!1);var o=Lyte.registeredMixins["email-sharing-alert"];o&&o.closeEmailSharingAlertPopup(),store.unloadAll("cpq_logs"),featuresAvailable.DUPLICATE_IMAGE_DETECTION&&store.unloadAll("duplicate_image_detection"),store.unloadAll("custom_button")},fetchApiData:function(){if(null==this.parent.detailapiPreload){var e={},t=this.transition.data,r=this.parent.parent.getDynamicParam();if(t.primary_module=r,"Messages"===r)return;e.primary_module=r,"Activities"===r&&void 0!==this.getQueryParams().sub_module&&(r=this.getQueryParams().sub_module);var s=this.parent.getDynamicParam();t.recordId=s;var i=store.peekRecord(moduleRecordMapping[this.parent.parent.getDynamicParam()].id,s);if(!i||"Leads"===r&&!0===i.$converted)return;var a=store.peekRecord("module",moduleRecordMapping[r].id),n=a.api_name,o=null;if(o=i.Layout?i.Layout.id:a.layouts[0].id,moduleRecordMapping[r]&&moduleRecordMapping[r].api_name&&!store.peekRecord("features-status",moduleRecordMapping[r].api_name)&&["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&!Crm.userDetails.isSandbox&&!["Visits","Forecasts"].includes(moduleRecordMapping[r].api_name)&&(e.zia_features_config=store.findAll("features-status",{module:moduleRecordMapping[r].api_name,group:"zia",page:1,per_page:20},!0)),e.initialPeekRecord=i,featuresAvailable.hasOwnProperty("ZiaVision")&&featuresAvailable.ZiaVision){var c=Lyte.registeredMixins["zia-insights-utils"],l={keys:"vision_data"},d=moduleRecordMapping[r];if(e.zia_features_config)e.zia_insights=e.zia_features_config.then((()=>c.getInsights(d,s,l,null,"zia_vision")));else{var u=c.getInsights(d,s,l,null,"zia_vision");e.zia_insights=u}}if(r.startsWith("Orchestration")||r.startsWith("PathFinder")||(e.detailview_buttons=store.triggerAction("entity","available_actions",{module:n,entityId:s}).then((function(e){return e}),(function(e){murphy.error(e)}))),"Events"!=r){var m={moduleSet:!0,peekField:!1};m.layoutId=o;var p=store.peekRecord("layout",o,{module:n});if(p&&p.sections&&"Calls"!==r){for(var h=!1,f=p.sections.length,g=0;g<f;g++){var y=p.sections[g];if(y&&"Business Card"===y.api_name&&y.fields&&0!==y.fields.length){h=!0;break}}e.business_card=h?p:store.findRecord("module",a.id,{},void 0,!0,m).then((function(e){return e[0].layouts.filter((function(e){return e.id===o}))}))}else e.business_card=store.findRecord("module",a.id,{},void 0,!0,m).then((function(e){return e[0].layouts.filter((function(e){return e.id===o}))}))}const v=Lyte.registeredMixins["crm-view-utils"];return"Calls"===r||"Services"===r||"Appointments"===r||"Activities"===r||r.startsWith("Orchestration")||r.startsWith("PathFinder")||(store.clearCachedQuery("custom_button",{module:n}),e.custom_buttons=new Promise(((e,t)=>{store.findAll("custom_button",{module:n,fields:"id,name,description,profiles,layouts,action,sequence_number,position,user_types,details"},!0,void 0,{apiVersion:6}).then((t=>{let s={position:"view",layoutId:o,moduleName:r};e(v.filterButtonData(t,s))})).catch((()=>e([])))}))),Crm.isKioskEnabled&&Lyte.registeredMixins.kiosk_execute&&(e.associated_kiosks=Lyte.registeredMixins.kiosk_execute.getDetailViewAssociations(r,o)),e.dv_layoutId=o,detailView.lyte_headerDataHolder=e,e}return detailView.lyte_headerDataHolder=this.parent.detailapiPreload,this.parent.detailapiPreload}},{mixins:["crm-detail-view-utils","crm-detailview-parser","crm-detailview-common-utils","crm-create-mixin","crm-create-init-mixin","crm-entity-utils","zia-insights-utils","crm-lookup-mixin","crm-lookup-parser-mixin","crm-detailview-resources-downloader","crm-keyboard-shortcutsmixin","crm-related-list-utils"]}),app.cscript_registry({route_name:"crm.tab.module.entity.detail",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.detailpagecanvas","Standard"),unique_name:"module_detail",handlers:["DetailViewHandler"],display_tag:!1,sequence:5,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.entity.detail:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:async function(e){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.detail",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{redirect:"false"}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:()=>[{event:"onLoad",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:async function(e){const t=["text","picklist","ownerlookup","email","phone","website","integer","currency","textarea","lookup","date","bigint","double","boolean","userlookup"],r=store.peekAll("module").find((t=>t.module_name===e.Module)).api_name,s=store.peekAll("layout").filter((e=>e.module.api_name===r)),i=["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"];return(s.length&&s[0].sections?s:await store.findAll("layout",{module:r})).find((t=>t.module.api_name===r&&t.id===e.Layout)).sections.map((e=>e.isSubformSection?e.fields.filter((e=>e.subform&&![116,117,500].includes(e.ui_type)&&e.view_type.edit&&e.visible&&!e.read_only)).map((e=>({name:e.field_label,value:e.id}))):e.fields.filter((e=>(CScript.Utils.is_uploadfields_event_enabled()?t.concat(["fileupload","imageupload"]).includes(e.data_type):t.includes(e.data_type))&&![51,208,207].includes(e.ui_type)&&!["Reporting_To","Currency","Probability","Pricing_Model","Wizard","territory_updated_time","Change_Log_Time__s"].includes(e.api_name)&&null===e.refer_from_field&&e.view_type.edit&&e.visible&&!e.read_only||-1!==i.indexOf(e.column_name))).map((e=>({name:e.field_label,value:e.id}))))).flat()},child_label:I18n.getMsg("crm.label.field"),list:()=>[{event:"onBeforeUpdate",args:["value"]}]},blueprint:{name:I18n.getMsg("com.cscript.blueprintevents"),label:I18n.getMsg("BluePrint"),list:()=>CScript.Utils.is_blueprint_aftertransition_event_enabled()?[{event:"beforeTransition",args:["transition"]},{event:"afterTransition",args:["transition"]}]:[{event:"beforeTransition",args:["transition"]}]},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:()=>[{event:"onBeforeMandatoryFormSave",args:["form"]},{event:"onMandatoryFormLoad",args:["form"]}]},tag:{name:I18n.getMsg("com.cscript.tagevents"),label:I18n.getMsg("Tag"),list:()=>[{event:"onTagChanged",args:["tag","added","removed"]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.edit.canvas",{queryParams:["layoutId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["custom_link_model.js","crm-canvasrule-model.js","crm-canvas-create-router-util.js"],ResourceConstants.CRMClient)},getResources:function(){return Lyte.registeredMixins["crm-create-init-mixin"].downloadFormViewResources()},beforeModel:function(e){var t={intRoute:"edit",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,entityId:this.parent.parent.getDynamicParam(),canvasId:e.dynamicParam,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasBeforeModelHook(t)},model:function(e){var t=!1;this.transition.data.skipRecordFetch||(t=!0);var r={intRoute:"edit",module_name:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],queryParams:e.queryParams,canvasId:e.dynamicParam,entityId:this.parent.parent.getDynamicParam(),fetchRecord:t,transitionData:Lyte.Router.getRouteInstance().transition.data};return this.canvasModelHook(r)},afterModel:function(e){var t={model:e};return this.canvasAfterModelHook(t)},renderTemplate:function(e){var t={model:e};return this.canvasRenderTemplateHook(t)},afterRender:function(e){var t={model:e};this.canvasAfterRenderHook(t)},beforeExit:function(){this.canvasBeforeExitHook()},didDestroy:function(e){var t={model:e};this.canvasDidDestroyHook(t)},actions:{willTransition:function(e){this.canvasWillTransitionHook(e,this.transition)},refreshRoute:function(){this.canvasRefreshRouteHook()}}},{mixins:["crm-create-mixin","crm-detailcanvas-utils","crm-formview-mixin","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery","crm-canvas-create-router-util"]}),app.cscript_registry({route_name:"crm.tab.module.entity.edit.canvas",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Crm.userDetails.isCanvasFormViewEnabled&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.editpage")+" ("+I18n.getMsg("crm.canvas.title")+")",unique_name:"module_edit_canvas",handlers:["CanvasCreatePageHandler"],display_tag:!0,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.entity.edit.canvas:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}},{name:"CanvasCreate",label:"Canvas",key:"$dynamicParam:crm.tab.module.entity.edit.canvas:2",definition:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=document.querySelector("crm-detailview-oldeditor");if(r||(r=document.querySelector("crm-canvas-form")),r){var s=r.getData("currView")?r.getData("currView").id:r.getData("viewId"),i=store.peekRecord("canvasview",s);i&&t([{name:i.name,value:s}])}else app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}).then((function(e){var r=e.map((function(e){return{name:e.name,value:e.id}}));t(r)}))}))}}],page_info:function(e){return{name:"FormView",module:store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name}},preview_route:async function(e){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);let t=store.peekRecord("canvasview",e.CanvasCreate);if(t||await app.store.makeRequest("findAll","canvasview",{module:moduleRecordMapping[e.Module].api_name,feature:"FormView",layout_id:e.Layout}),t=store.peekRecord("canvasview",e.CanvasCreate),t&&t.canvas_enabled){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).filter((e=>e.visible)).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.edit.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id,e.CanvasCreate],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.create.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,e.CanvasCreate],queryParams:{layoutId:e.Layout}}}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.label.field"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:()=>[{event:"onMandatoryFormLoad",args:["field"]}]},button:{name:I18n.getMsg("com.cscript.canvasbuttonevents","Canvas"),label:I18n.getMsg("zc.editor.button"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[],s=document.querySelector("crm-detailview-oldeditor");if(s){var i=s.getData("lastsavedmapping")||{},a=Object.keys(i),n=$(".zccbutton.zclayout").filter(":data(zcanvasdata)");r=n.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid&&a.indexOf(e.systemid)>-1)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var o=e.CanvasCreate;store.findRecord("canvasview",o).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Canvas Button"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("zc.editor.button"),list:()=>[{event:"onClick",args:[]}]},icon:{name:I18n.getMsg("com.cscript.iconevents"),label:I18n.getMsg("crm.canvas.editor.icon"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstaticicon ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Icon"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.canvas.editor.icon"),list:()=>[{event:"onClick",args:[]}]},text:{name:I18n.getMsg("com.cscript.textevents"),label:I18n.getMsg("crm.label.text"),child:function(e){return new Promise((async function(t){await Lyte.injectResources([networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient)]);var r=[];if(document.querySelector("crm-detailview-oldeditor")){var s=$(".zcstatictext ").filter(":data(zcanvasdata)");r=s.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var i=e.CanvasCreate;store.findRecord("canvasview",i).then((function(e){if(e){var s=(e=e[0]).ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(s).map((function(e){if("Static Text"===s[e].action)return{name:s[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.label.text"),list:()=>[{event:"onClick",args:[]}]}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.edit-contact-role",{queryParams:["returnAnchor","accId"],model:function(e){var t={};t.returnAnchor=e.queryParams.returnAnchor,t.step="editContactRole",t.id=this.parent.getDynamicParam(),t.accId=e.queryParams.accId,t.pageIndex="0";var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/ShowContactsRolesMapping.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.entity.edit",{queryParams:["layoutId","wizardId","state","redirect"],getDependencies:function(e){var t=this.parent.parent.getDynamicParam();return this.loadRouteDependencies(e,t)},getResources:function(e){var t={isEdit:!0,currentFeature:"create",getResourcesParams:e,moduleName:this.parent&&this.parent.parent.getDynamicParam(),transitionData:this.transition.data,subModule:this.parent&&this.parent.parent.getQueryParams().sub_module};return this.getResourcesHook(t)},beforeModel:function(e){var t=this.parent.parent.getDynamicParam();if("Activities"===t||"Tasks"===t){t="Activities"===t?this.parent.parent.getQueryParams().sub_module:t;var r=this.parent.getDynamicParam();(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(t))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/Edit.do?format=json&module="+t+"&id="+r+(e.queryParams.layoutId?"&layoutId="+e.queryParams.layoutId:""),t)}return this.beforeModelHook(this.getEditCloneRouteBasicDataProps(!0,"edit"),this.transition.data,e.queryParams)},model:function(e){return this.modelHook(Object.assign({parentTransitionData:this.parent.parent.transition.data,modelParams:e},this.getEditCloneRouteBasicDataProps(!0,"edit")),this.transition.data,e.queryParams)},afterModel:function(e){if(Crm.userDetails.isAccessibilityConfigSupported){var t={};t.formDisplayMode=this.globalAccessibilityServices.getVariable("formDisplayMode"),t.mandatoryField=this.globalAccessibilityServices.getVariable("mandatoryField"),t.standardNavigationOrder=this.globalAccessibilityServices.getVariable("standardNavigationOrder"),t.customError=this.globalAccessibilityServices.getVariable("customError"),this.transition.data.accessibilityObj=t}return this.afterModelHook(this.getEditCloneRouteBasicDataProps(!1,"edit"),e,this.transition.data,this.getQueryParams())},redirect:function(){return this.redirectHook(Object.assign({currentTransition:this.transition},this.getEditCloneRouteBasicDataProps(!1,"edit")))},renderTemplate:function(e,t){return this.renderTemplateHook(this.getEditCloneRouteBasicDataProps(!0,"edit"),this.transition.data,e,t)},afterRender:function(e){this.afterRenderHook(this.getEditCloneRouteBasicDataProps(!1,"edit"),e,this.transition.data)},didDestroy:function(){var e=this.component?this.component.querySelector("crm-create-layout"):void 0,t={lyteConvertionSupported:this.lyteConvertionSupported,isWizard:this.isWizard,formViewType:"edit"};e&&(t.rectobeUnloaded=e.getData("dataBind"),t.currsubformApinames=e.getData("currsubformApinames")),this.didDestroyHook(t)},beforeExit:function(){this.beforeExitHook(Object.assign({wizardId:this.getQueryParams().wizardId},this.getEditCloneRouteBasicDataProps(!0,"edit")))},actions:{willTransition:function(e){var t={lyteConvertionSupported:this.lyteConvertionSupported,nextTransition:e,formViewType:"edit"};this.willTransitionHook(t)},onError:function(e){this.onErrorActionHook({lyteConvertionSupported:this.lyteConvertionSupported,error:e,formViewType:"edit"})}}},{mixins:["crm-create-mixin","crm-create-mixin2","crm-create-route-mixin","crm-create-init-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.entity.edit",category:{value:"Module",name:I18n.getMsg("crm.label.module")},config:[{enabled:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()},name:I18n.getMsg("com.page.editpage")+" ("+I18n.getMsg("Standard")+")",unique_name:"module_edit",handlers:["CreatePageHandler"],display_tag:!0,sequence:2,selectors:[{name:"Module",key:"$dynamicParam:crm.tab.module.entity.edit:0",label:I18n.getMsg("crm.label.module"),definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",key:"$queryParam:layoutId",label:I18n.getMsg("crm.lable.layout"),definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:async function(e){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).filter((e=>e.visible)).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.edit",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},events:function(){return{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:()=>Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("page")},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}}}}},{enabled:function(){var e=Lyte.Router.getRouteInstance();return!(!e||"edit"!==e.routeName||!e.transition.info.queryParams.wizardId)||store.peekAll("module").filter((e=>e.api_supported&&"team_based"!==e.access_type&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name))).filter((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]||"crm-cscript"===Lyte.Router.getRouteInstance().routeName)).length>0},name:I18n.getMsg("com.page.editpage")+" ("+I18n.getMsg("crm.label.widgets.WIZARD")+")",unique_name:"module_wizard_edit",handlers:["WizardRecordPageHandler","CreatePageHandler"],display_tag:!0,sequence:8,selectors:[{name:"Module",key:"$dynamicParam:crm.tab.module.entity.edit:0",label:I18n.getMsg("crm.label.module"),definition:async function(){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_module_definitions()}},{name:"Layout",key:"$queryParam:layoutId",label:I18n.getMsg("crm.lable.layout"),definition:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_layout_definitions(e)}},{name:"Wizard",label:I18n.getMsg("crm.label.widgets.WIZARD"),key:"$queryParam:wizardId",definition:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_definitions(e)}}],preview_route:async function(e){if(await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),!await Lyte.registeredMixins["crm-wizard-util-mixin"].isWizardAvailableForCurrentUser(e.Wizard,e.Layout,e.Module))return;store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{per_page:1,approved:"both",formatted_currency:!0,filters:JSON.stringify({group_operator:"AND",group:[{comparator:"equal",field:{api_name:"Wizard"},value:[{id:e.Wizard}]},...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).length>1?[{comparator:"equal",field:{api_name:"Layout"},value:[{id:e.Layout}]}]:[]]})});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.edit",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{layoutId:e.Layout,wizardId:e.Wizard}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},events:function(){return{page:{name:I18n.getMsg("crm.settings.wizard.cscript.wizardevent"),label:I18n.getMsg("crm.label.wizard"),list:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("wizard")}},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:async function(e){return await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-wizard-util-mixin.js"],ResourceConstants.CRMClient)),Lyte.registeredMixins["crm-wizard-util-mixin"].get_wizard_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:function(e,t){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_events_list("field",t,e)}},subform:{name:I18n.getMsg("com.cscript.subformevents"),label:I18n.getMsg("crm.label.customize.subform"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_subform(e)},child_label:I18n.getMsg("crm.label.customize.subform"),list:function(){return[{event:"onCellChange",args:["field_name","value","index"]},{event:"onRowAdd",args:["row_data","index"]},{event:"beforeRowDelete",args:["row_data","index"]},{event:"onRowDelete",args:["row_data","index"]}]},is_event_enabled:function(){return CScript.Utils.is_subform_event_enabled()}}}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.find-and-merge",{queryParams:["filter","findDupFldName"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-merge-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-find-merge.css","crm-mass-tool-header.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-inner-list-new.css","crm-page-navigator.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Deduplication")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-merge.js","crm-mass-tool-header.js","crux-criteria-component.js","crux-criteria-conditions.js","crm-inner-list.js","crm-page-navigator.js","crm-list-helpers.js"],ResourceConstants.CRMClient))},beforeModel:function(){var e=this.parent.parent.getDynamicParam();if(!moduleRecordMapping[e]||!moduleRecordMapping[e].visible||!Crm.userDetails.permissions["Crm_Implied_Merge_"+e]){crmHistory.handleAjaxErrorLyte=!0;var t=Lyte.Component.render("crux-permission-denied-alert",{},"body");t.setMethods({onAccept:function(){if(Crm.userDetails.permissions["Crm_Implied_View_"+e])crmHistory.backOneLevel();else{var t=moduleRecordMapping.Home.module_name;Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:[t]})}}}),t.setData("cxPropShow",!0),this.transition.abort()}},model:function(){var e=this.transition.data.queryParams,t=this.parent.getDynamicParam(),r=moduleRecordMapping[this.parent.parent.getDynamicParam()].module_name,s=moduleRecordMapping[this.parent.parent.getDynamicParam()].id,i=this;return e&&(this.selectedIds=e.selectedIds),Lyte.resolvePromises([store.findRecord(s,t),store.findAll("field",{module:moduleRecordMapping[this.parent.parent.getDynamicParam()].api_name,type:"all"},void 0,void 0,{apiVersion:"2.2",from:"merge"}),store.findAll("dummy",void 0,!1,!1,{url:"crm/v2/settings/privacy_preferences",method:"GET"})]).then((function(s){if(s[0][0]){var a=i.getCriteriaFields(Lyte.deepCopyObject(s[1]),r),n=Lyte.deepCopyObject(s[1]);if(e&&e.criteriaData){var o=e.criteriaData,c=e.criteriaData;return i.getRecordsBasedOnFields("initial",r,n,s[0],moduleRecordMapping[r],s[2],c,1,10,o,t,a.length)}if(null===(o=i.getCriteriaPattern(a,s,r,!0))&&"Potentials"===r)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.merge.closed.rcd",Crm.moduleInfo[r].translatedPluralLabel)}}),Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[r,t]});c=i.getCriteriaPattern(a,s,r,!1);return i.getRecordsBasedOnFields("initial",r,n,s[0],moduleRecordMapping[r],s[2],c,1,10,o,t,a.length)}_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.label.recordNotAvailable")}}),crmTab.deleteFromCache(r);var l=moduleRecordMapping[r].cvid;Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[r,l]})}),function(e){var t=JSON.parse(e.response);t.code&&"NO_PERMISSION"===t.code&&(Lyte.Component.render("crux-permission-denied-alert",{},"body").setData("cxPropShow",!0),commonUtils.showHideLoadingDiv(!1))}.bind(this))},afterModel:function(){this.currentModel.module=moduleRecordMapping[this.parent.parent.getDynamicParam()].module_name,this.currentModel.module_info=moduleRecordMapping[this.parent.parent.getDynamicParam()],this.currentModel.helpKey="help.crm.find.merge.duplicate",this.currentModel.type="merge",this.currentModel.actionName="crm.button.next";var e=[];e.push({name:I18n.getMsg("crm.label.match.all"),id:"matchall"}),e.push({name:I18n.getMsg("crm.label.match.any"),id:"matchany"}),this.currentModel.criteriaTypes=e,this.currentModel.crtType=e[1].id,this.currentModel.columnFields=this.getMergeTableColumns(),this.currentModel.prevTransitionUrl=Crm.ViewedCanvasState?Crm.ViewedCanvasState.target:"crm.tab.module.entity.detail",this.currentModel.prevTransitionParams=Crm.ViewedCanvasState?[Crm.ViewedCanvasState.info.dynamicParams[0],this.currentModel.id.split("RecordId")[1],Crm.ViewedCanvasState.info.dynamicParams[2]]:[this.currentModel.module,this.currentModel.id.split("RecordId")[1]],this.transition.data.queryParams&&this.transition.data.queryParams.totalCriteria?(this.currentModel.setCriteria=this.transition.data.queryParams.totalCriteria,this.currentModel.crtType=this.transition.data.queryParams.crtType):this.currentModel.setCriteria=this.currentModel.filters,"matchall"===this.currentModel.crtType?this.currentModel.crtAndOr="and":this.currentModel.crtAndOr="or",this.currentModel.page=1;var t=this.currentModel.resp.records;if(this.currentModel.getCount=!0,void 0!==this.currentModel.resp.count.count&&(this.currentModel.total_records_count=this.currentModel.resp.count.count),this.constructNavigObject(this.currentModel.module_info.cvid,t,this.currentModel.module_info.module_name,this.currentModel.module_info.per_page),this.currentModel.customview_records=t,this.currentModel.startIndex=0,t.length>0?(this.currentModel.more_records=t.$.meta.more_records,this.currentModel.end_index=t.$.meta.count+0):this.currentModel.more_records=!1,this.currentModel.total_count=this.currentModel.total_records_count,this.currentModel.showResult=!0,this.currentModel.page=1,this.currentModel.per_page=10,this.currentModel.orginRecordid=this.transition.info.dynamicParams[1],t.length){var r=1;t.forEach((function(e){e.recnum=r++}))}this.headerSelection(this.currentModel.module_info,"merge",this.selectedIds,t)},renderTemplate:function(e,t){return{outlet:"#show",component:"crm-find-merge"}},lyteConvertionSupported:!0},{mixins:["crm-merge-mixin","crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.module.entity",{queryParams:["redirect","newSignUp"],beforeModel:function(){if(Lyte.Globals.get("relatedList.scrollToId")||Lyte.Globals.set("relatedList",{module:this.parent.getDynamicParam(),entityId:this.getDynamicParam(),filters:!1,new_social:!1,projectPersonality:{}}),"undefined"==typeof detailView&&(detailView={}),"undefined"==typeof returnJson&&(returnJson={}),"crm.tab.module.entity.edit.canvas"!==this.transition.target&&"crm.tab.module.entity.clone.canvas"!==this.transition.target&&"crm.tab.module.entity"===this.transition.target&&"false"!==this.getQueryParams().redirect||!app.prevTransition.route&&"crm.tab.module.entity.detail"===this.transition.target){var e=this.parent.getDynamicParam(),t=this,r=moduleRecordMapping[this.parent.getDynamicParam()].id;if(store.modelFor(r)&&moduleRecordMapping[this.parent.getDynamicParam()].fields){var s=this.transition.url.endsWith("gsearch");t.detailViewAPIs();var i=this.addDetailViewRequests(moduleRecordMapping[this.parent.getDynamicParam()].id,e,s);return Lyte.resolvePromises(i).then((function(e){t.entityCallBack(e)}),(function(r){store.peekRecord(moduleRecordMapping[e].id,t.getDynamicParam())&&store.unloadRecord(moduleRecordMapping[e].id,t.getDynamicParam());var s=t.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[e,t.getDynamicParam()],queryParams:t.transition.info.queryParams});s.data=t.transition.data,s.info.skipRecordFetch=!0,s.info.requestErrorInfo=r,murphy.error(r)}))}return store.findRecord("module",r).then(function(){t.detailViewAPIs();var s=t.addDetailViewRequests(r,e);Lyte.resolvePromises(s).then(t.entityCallBack,(function(r){store.peekRecord(moduleRecordMapping[e].id,t.getDynamicParam())&&store.unloadRecord(moduleRecordMapping[e].id,t.getDynamicParam());var s=t.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[e,t.getDynamicParam()],queryParams:t.transition.info.queryParams});s.info.skipRecordFetch=!0,s.info.requestErrorInfo=r,murphy.error(r)}))}.bind(this))}},redirect:function(){var e=Lyte.Router.getRouteInstance().parent.getDynamicParam(),t=Lyte.Router.getRouteInstance().getDynamicParam();if("entity"===Lyte.Router.getRouteInstance().routeName&&app.prevTransition.dynamicParams.includes(e)&&app.prevTransition.dynamicParams.includes(t)){Crm.getCanvasId(moduleRecordMapping[e].id,t)?this.replaceWith({route:"crm.tab.module.entity.canvas",dynamicParams:[e,t,Crm.getCanvasId(moduleRecordMapping[e].id,t)]}).data=this.transition.data:this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[e,t]}).data=this.transition.data;var r=$L("crm-connected-record")[0];void 0!==r&&r.component.setData("showCreatePopup",!1)}t="canvas"===Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().parent.parent.getDynamicParam():Lyte.Router.getRouteInstance().parent.getDynamicParam();var s=(e="canvas"===Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().parent.parent.parent.getDynamicParam():Lyte.Router.getRouteInstance().parent.parent.getDynamicParam())?moduleRecordMapping[e].id:void 0;if(this.transition&&this.transition.data&&!this.transition.data.fromEntityCallBack&&"detail"===Lyte.Router.getRouteInstance().routeName){var i=this;if(store.modelFor(s)&&moduleRecordMapping[this.parent.getDynamicParam()].fields){this.detailViewAPIs();var a=this.addDetailViewRequests(s,e);return Lyte.resolvePromises(a).then((function(e){return e.locking_configuration&&(i.transition.data.locking_configuration=e.locking_configuration),e.findRecordCalled&&(i.transition.info.skipRecordFetch=e.findRecordCalled),e}),(function(e){murphy.error(e)}))}return store.findRecord("module",s).then((function(){i.detailViewAPIs();var t=i.addDetailViewRequests(s,e);Lyte.resolvePromises(t).then((function(e){return e.locking_configuration&&(i.transition.data.locking_configuration=e.locking_configuration),e.findRecordCalled&&(i.transition.info.skipRecordFetch=e.findRecordCalled),e}),(function(e){murphy.error(e)}))}))}this.transition&&this.transition.data&&this.transition.data.fromEntityCallBack&&delete this.transition.data.fromEntityCallBack},getResources:function(){var e=this.parent.getDynamicParam();if("crm.tab.module.entity.canvas"===this.transition.target&&"undefined"!=typeof Detail_API_Optimisation&&Detail_API_Optimisation&&(showEntityReqRes=void 0,EntityReqRes=void 0,actions_resp=void 0,apiResponses={custom_buttons:{},related_Lists:{},associations:{},record_locking:{},zia_features_config:{},moduleCache:{},fields:{},tag:{},layout:{}}),this.parent.getQueryParams()&&void 0!==this.parent.getQueryParams().sub_module&&"Activities"===e&&(e=this.parent.getQueryParams().sub_module),Crm.renderDVLyteFlow(e))return[];var t=networkUtils.returnDependencyFiles(["crm-global-search.js","crm-existing-email-quickinfo.js","exif-plugin.js","lyte-colorbox.js","crm-entity-lookup.js","crux-combo-box.js","crm-permission-error.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient),s=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup"),networkUtils.getI18nJSUrl("approvals"),"zohocrm_customView.js","zohocrm_changeOwner.js","zohocrm_ProcessFlow.js"],ResourceConstants.CRM))).concat(r);return Crm.userDetails.isPhoneNoNewView&&(s=s.concat(Crm.returnPhoneFieldDependencyFiles())),s},beforeExit:function(){commonUtils.getTextWidthUsingCanvas.canvasElem&&commonUtils.destroyCanvasElem(),store.clearCachedQuery("layout")},addDetailViewRequests:function(e,t,r){var s={};if(Crm.userDetails.isSubformNewComponentEnabled){["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].forEach((function(e){_lyteUiUtils.updateI18n(e,I18n.getMsg(e))})),Crm.isInventoryModule(t)&&(s.version=4),s.fromDetailRoute=!0}let i=this.transition.dynamicParams&&this.transition.dynamicParams[2]&&this.transition.dynamicParams[2].needPeek,a=store.peekRecord(moduleRecordMapping[this.parent.getDynamicParam()].id,this.getDynamicParam());var n;if(r&&(s["X-CRM-FEATURE-NAME"]="globalsearch"),i&&a?(n={records:[a]}).findRecordCalled=!0:((n=void 0!==EntityReqRes&&void 0!==EntityReqRes[this.getDynamicParam()]?{records:EntityReqRes[this.getDynamicParam()]}:{records:store.findRecord(e,this.getDynamicParam(),Crm.get_params_for_getRecord(),void 0,!0,s)}).findRecordCalled=!0,void 0!==EntityReqRes&&void 0!==EntityReqRes[this.getDynamicParam()]&&EntityReqRes[this.getDynamicParam()].then((function(t){store.pushPayload(e,JSON.parse(t).data)}))),moduleRecordMapping[t]&&moduleRecordMapping[t].api_name&&!store.peekRecord("features-status",moduleRecordMapping[t].api_name)&&["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&!Crm.userDetails.isSandbox&&!["Visits","Forecasts"].includes(moduleRecordMapping[t].api_name)&&(n.zia_features_config=store.findAll("features-status",{module:moduleRecordMapping[t].api_name,group:"zia",page:1,per_page:20},!0)),("crm.tab.module.entity"===this.transition.target||"crm.tab.module.entity.detail"===this.transition.target)&&moduleRecordMapping.LockingInformation){var o="Activities"===t?this.parent.getQueryParams().sub_module:t;!Crm.renderDVLyteFlow(o)&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(o)&&(n.locking_configuration=store.findAll("record_locking_configurations",{module:moduleRecordMapping[o].api_name},!0))}var c=this;return Lyte.resolvePromises(n).then((function(r){if(r.records&&r.records[0]&&r.records[0].Layout)var s=r.records[0].Layout.id;else s=store.peekRecord("module",e).layouts[0].id;if(!i)var i="Activities"===t?c.parent.getQueryParams().sub_module:t;var a={records:r.records,findRecordCalled:r.findRecordCalled,locking_configuration:r.locking_configuration};if(store.peekRecord("layout",s)||(a.layoutInfo=store.findRecord("layout",s,{module:moduleRecordMapping[i].api_name,mode:"all"})),!0===Crm.renderDVLyteFlow(t)&&!0===Crm.isInventoryModule(t)){a.taxDetails=Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-create-dependencies.js"],ResourceConstants.CRMClient),void 0).then((function(){store.findAll("tax-detail")})),a.productModule=new Promise((function(e){return store.findRecord("module",moduleRecordMapping.Products.id).then((function(t){e(t)}),(function(){e()}))}));var n=r.records[0],o={Invoices:"Invoiced_Items",PurchaseOrders:"Purchase_Items",SalesOrders:"Ordered_Items",Quotes:"Quoted_Items"}[t],l=[];n&&n.hasOwnProperty(o)&&n[o]&&n[o].length&&n[o].forEach((function(e){e&&e.Price_Book_Name&&e.Price_Book_Name.id&&l.push(e.Price_Book_Name.id)})),l.length&&(store.model[moduleRecordMapping.PriceBooks.id]||store.registerModel(moduleRecordMapping.PriceBooks.id,{},{extends:"entity"}),a.priceBookModule=new Promise((function(e){return store.findAll(moduleRecordMapping.PriceBooks.id,{ids:l.toString(),approved:"both"}).then((function(t){e(t)}),(function(){e()}))})))}return Lyte.resolvePromises(a)}))},entityCallBack:function(e){var t,r=this.parent.getDynamicParam(),s=this.getDynamicParam(),i=this.transition.data;return i.fromEntityCallBack=!0,e.records[0]?("undefined"!=typeof detailView&&("Leads"!==r||void 0===window[r].currentStatus||"create"!==window[r].currentStatus&&"edit"!==window[r].currentStatus&&"clone"!==window[r].currentStatus||!e.records[0].$converted?detailView.isBlueprintPageRefresh&&(detailView.isBlueprintPageRefresh=!1):detailView.isRecordConverted=!0),e.locking_configuration&&(i.locking_configuration=e.locking_configuration),e.records[0].$state&&"draft"===e.records[0].$state?void this.replaceWith({route:"crm.tab.module.entity.edit",dynamicParams:[r,s]}):"false"===this.transition.info.queryParams.redirect||e.records[0].$converted&&!["SalesOrders","Quotes"].contains(r)||!Crm.getCanvasId(moduleRecordMapping[r].id,s)?"crm.tab.module.entity.detail"!==this.transition.target?((t=this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[r,s],queryParams:this.transition.info.queryParams})).data=i,void(t.info.skipRecordFetch=e.findRecordCalled)):void("crm.tab.module.entity.detail"===this.transition.info.route&&(this.transition.info.skipRecordFetch=e.findRecordCalled)):(i.stageId?(crmNavig.customViewKey=i.cvid+"#"+i.stageId,crmNavig.fromKanbanView=!0):crmNavig.fromKanbanView=!1,void(this.replaceWith({route:"crm.tab.module.entity.canvas",dynamicParams:[r,s,Crm.getCanvasId(moduleRecordMapping[r].id,s)]}).data={replaced:!0,recordNum:i.recordNum,cvId:i.cvId,skipRecordFetch:!0,newSignUp:this.getQueryParams().newSignUp}))):(store.peekRecord(moduleRecordMapping[r].id,s)&&store.unloadRecord(moduleRecordMapping[r].id,s),(t=this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[r,s],queryParams:this.transition.info.queryParams})).data={recordNum:i.recordNum,cvid:i.cvid},void(t.info.skipRecordFetch=e.findRecordCalled))},detailViewAPIs:function(){if(Detail_API_Optimisation){var e={},t=this.transition.data,r=this.parent.getDynamicParam();t.primary_module=r,e.primary_module=r,"Activities"===r&&void 0!==this.getQueryParams().sub_module&&(r=this.getQueryParams().sub_module);var s=this.getDynamicParam();t.recordId=s;var i=store.peekRecord(moduleRecordMapping[this.parent.getDynamicParam()].id,s);if(!i||"Leads"===r&&!0===i.$converted)return;var a=store.peekRecord("module",moduleRecordMapping[r].id),n=a.api_name,o=null;if(o=i.Layout?i.Layout.id:a.layouts[0].id,moduleRecordMapping[r]&&moduleRecordMapping[r].api_name&&!store.peekRecord("features-status",moduleRecordMapping[r].api_name)&&["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&!Crm.userDetails.isSandbox&&!["Visits","Forecasts"].includes(moduleRecordMapping[r].api_name)&&(e.zia_features_config=store.findAll("features-status",{module:moduleRecordMapping[r].api_name,group:"zia",page:1,per_page:20},!0)),e.initialPeekRecord=i,featuresAvailable.hasOwnProperty("ZiaVision")&&featuresAvailable.ZiaVision){var c=Lyte.registeredMixins["zia-insights-utils"],l={keys:"vision_data"},d=moduleRecordMapping[r];if(e.zia_features_config)e.zia_insights=e.zia_features_config.then((()=>c.getInsights(d,s,l,null,"zia_vision")));else{var u=c.getInsights(d,s,l,null,"zia_vision");e.zia_insights=u}}if(r.startsWith("Orchestration")||r.startsWith("PathFinder")||(e.detailview_buttons=void 0!==actions_resp?actions_resp.then((function(e){if(void 0!==e.obj[s])return e.obj[s];store.triggerAction("entity","available_actions",{module:n,entityId:s}).then((function(e){return e}))})):store.triggerAction("entity","available_actions",{module:n,entityId:s}).then((function(e){return e}),(function(){}))),"Events"!=r){var m={moduleSet:!0,peekField:!1};m.layoutId=o;var p=store.peekRecord("layout",o,{module:n});if(p&&p.sections&&"Calls"!==r){for(var h=!1,f=p.sections.length,g=0;g<f;g++){var y=p.sections[g];if(y&&"Business Card"===y.api_name&&y.fields&&0!==y.fields.length){h=!0;break}}e.business_card=h?p:store.findRecord("module",a.id,{},void 0,!0,m).then((function(e){return e[0].layouts.filter((function(e){return e.id===o}))}))}else e.business_card=store.findRecord("module",a.id,{},void 0,!0,m).then((function(e){return e[0].layouts.filter((function(e){return e.id===o}))}))}const E=Lyte.registeredMixins["crm-view-utils"];if("Calls"===r||"Services"===r||"Appointments"===r||"Activities"===r||r.startsWith("Orchestration")||r.startsWith("PathFinder")||(store.clearCachedQuery("custom_button",{module:n}),e.custom_buttons=new Promise((e=>{store.findAll("custom_button",{module:n,fields:"id,name,description,profiles,layouts,action,sequence_number,position,user_types"},!0,void 0,{apiVersion:6}).then((t=>{let s={position:"view",layoutId:o,moduleName:r};e(E.filterButtonData(t,s))})).catch((()=>e([])))}))),Crm.isKioskEnabled){var v="/crm/v6/settings/kiosks/associations",_=[];e.associated_kiosks=store.findAll("dummy",{module:n,include_inner_details:"_associations.detail_view_page.module,_associations.detail_view_page.layout"},!0,!1,{url:v}).then((function(e){return function(e){if(e)for(var t=e.kiosks.length,s=0;s<t;s++){var i=e.kiosks[s]._associations;if(i)for(var a=i.length,n=0;n<a;n++)if(i[n].detail_view_page)for(var c=i[n].detail_view_page,l=c.length,d=0;d<l;d++){var u=c[d];if(u.module.id===moduleRecordMapping[r].id&&u.layout.id===o){var m={};m.kioskId=e.kiosks[s].id,m.name=u.name,m.resourceId=u.id,_[u.sequence_number]=m}}}return _}(e)}),(function(e){if(e)return commonUtils.showHideLoadingDiv(!1),_}))}e.dv_layoutId=o,detailView.lyte_headerDataHolder=e,this.detailapiPreload=e;try{var C=this.parent.getDynamicParam(),R=moduleRecordMapping[C].api_name;if("crm.tab.module.entity.detail"===this.transition.target&&R){let e={from:"Chronological"};store.findAll("related_list",{module:R},!1,void 0,e)}}catch(e){murphy.error(e)}if(null==showEntityReqRes||showEntityReqRes=={}){var b=!0;Crm.kanbanObj&&(this.transition.column_name=Crm.kanbanObj.column_name,this.transition.kanbanData=Crm.kanbanObj.kanbanData,Crm.kanbanObj=void 0);var w=objectUtils.cloneObject(this.transition.data);if(this.transition.info.queryParams&&"gsearch"===this.transition.info.queryParams.pfrom&&(w.pfrom="gsearch"),w.id=w.id?w.id:this.getDynamicParam(),w.module=w.module?w.module:this.parent.getDynamicParam(),!Crm.userDetails.isRelatedListLyteEnabled||"Campaigns"!==w.module&&"Contacts"!==w.module&&"Leads"!==w.module||app.store.makeRequest("findAll","field",{module:"Campaign_Leads_Members"},!0),"Deals"==w.module&&(w.module="Potentials"),"Meetings"==w.module&&(w.module="Events"),"Activities"==w.module)if(void 0!==this.parent.getQueryParams().sub_module)w.module=this.parent.getQueryParams().sub_module;else(M=store.peekRecord(moduleRecordMapping[w.module].id,w.id))&&void 0!==M.Activity_Type&&(w.module=M.Activity_Type);if(this.getQueryParams().iframe_src&&(w.iframe_src=this.getQueryParams().iframe_src),"CustomModule5004"==w.module&&Handlebars.registerPartial("ZOMPackagesPartial",Handlebars.templates.ZOMPackagesPartial),delete w.backOneLevel,delete w.clearCache,delete w.needClearCache,delete w.listeners,delete w.save,Crm.latestEntId=this.getDynamicParam(),this.transition.data&&this.transition.data.fromid&&(Crm.latestEntId=this.transition.data.fromid,delete w.fromid),("true"==w.navig||w.cvid)&&"rel"!=w.pfrom&&w.recordNum){crmNavig.customViewKey=w.cvid&&"null"!=w.cvid?w.cvid:w.module,crmNavig.customViewKey=validationUtils.isNotEmpty(w.stageId)?crmNavig.customViewKey+"#"+w.stageId:crmNavig.customViewKey;var M,D=w.FROM_INDEX?parseInt(w.FROM_INDEX):$("input[name=cvFromIndex]")[0]?parseInt($("input[name=cvFromIndex]").val()):$("input[name=fromIndex]")?parseInt($("input[name=fromIndex]").val()):1,P=$("input[name=rangeValue]")[0]?parseInt($("input[name=rangeValue]").val()):$("input[name=cvRangeValue]")?parseInt($("input[name=cvRangeValue]").val()):10,L=w.TO_INDEX?parseInt(w.TO_INDEX):parseInt(D)+P-1;D&&(w.FROM_INDEX=D),L&&(w.TO_INDEX=L),M="true"!=w.fromDel?parseInt(w.recordNum)<=D?parseInt(w.recordNum)-1:parseInt(w.recordNum)+1:parseInt(w.recordNum),crmNavig.customViewKey&&-1!==crmNavig.customViewKey.indexOf("#")&&crmNavig[crmNavig.customViewKey]&&crmNavig[crmNavig.customViewKey].recordId&&(D=1,L=crmNavig[crmNavig.customViewKey].recordId.length-1),"kanbanview"!==w.view||!featuresAvailable.NEXTGENUI_ENABLED||"Tasks"!==w.module&&"Events"!==w.module&&"Calls"!==w.module&&"Activities"!==w.module||(delete w.view,delete w.clickId,w.FROM_INDEX=D,w.TO_INDEX=L,this.transition.data=w),(parseInt(w.recordNum)===D||parseInt(w.recordNum)===L||"true"===w.fromDel&&"Activities"!==Crm.activityGrp[w.module])&&crmNavig[crmNavig.customViewKey]&&crmNavig.triggerFetch(D,L,M,w)}if(delete w.navig,delete w.fromRL,delete w.primary_module,delete w.recordId,delete w.affected_data,w.fromDetailView&&$("#detailCView").length){if(this.transition.lyteHeaderSupported)return this.fetchDVModuleInfo(w,!0,e);loadActivityDetails(void 0,void 0,w,w.id,void 0,void 0,void 0,void 0,e)}else if("kanbanview"!=w.view){b=!0;!featuresAvailable.NEXTGENUI_ENABLED&&(w.fromActivityListView||w.fromActSubModuleListView||w.fromDetailView)&&0===$("#detailCView").length&&"Activities"===Crm.activityGrp[w.module]&&(b=!1),delete w.activitytype,delete w.view,Crm.origin&&(w.origin=Crm.origin),w.format="json";if("Forecasts"==w.module&&delete w.isload,w.pfrom||(w.pfrom="cv"),"Activities"===Crm.activityGrp[w.module]&&(Crm.isPageLoad||featuresAvailable.NEXTGENUI_ENABLED)&&(w.fromDetailView&&delete w.fromDetailView,w.fromActivityListView&&delete w.fromActivityListView),featuresAvailable.NEXTGENUI_ENABLED&&(w.fromActSubModuleListView||w.fromActivityListView)&&!1!==b&&"Activities"===Crm.activityGrp[w.module]||!w.fromActSubModuleListView&&!w.fromActivityListView&&!1!==b||(w.fromActSubModuleListView||w.fromActivityListView)&&"Activities"!==Crm.activityGrp[w.module]){v=Crm.getCrmBasePath()+"/ShowEntityInfo.do";g=0;for(var k in w)/\b(calleeObj|clickId)\b/.test(k)||void 0===w[k]||(v+=0==g?"?":"&",v+=k+"="+encodeURIComponent(w[k]),g++);(w.module||w.parModule)&&(w.module?crmTab.updateTabContent(w.module):crmTab.updateTabContent(w.parModule)),isRelatedListLoaded=!0}var I=new XMLHttpRequest;for(var U in window.showEntityReqUrl=window.location.origin+v,I.open("POST",showEntityReqUrl),window.headers)I.setRequestHeader(U,headers[U]);window.showEntityReqRes={},showEntityReqRes[window.location.pathname.split("/").slice(-1)[0]]=new Promise((e=>{I.onload=function(){var t=I.response;e(t)}})),I&&I.send(JSON.stringify({newModel:"true"}))}}}},detailapiPreload:null,generalFailureFunction:function(e){this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[module,this.getDynamicParam()],queryParams:this.transition.info.queryParams}).data=this.transition.data,this.transition.abort(),murphy.error(e)}}),Lyte.Router.registerRoute("crm.tab.module.fields-value-collector",{queryParams:["sub_module","hiddenFieldsSysRefName","requiredSectionsSysRefName"],beforeModel:function(e){var t=e.queryParams.sub_module;"Activities"===this.parent.currentModel.module_name&&"Calls"===t&&isNewCallView||renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))},model:function(e){var t=e.queryParams,r=null;t.requiredSectionsSysRefName&&(r=t.requiredSectionsSysRefName.split(","));var s=Crm.getCrmBasePath()+"/GetFieldsForCallSections.do",i={};i.sectionsName=r&&JSON.stringify(r);var a={params:i};return networkUtils.lyteInitiateRequest(s,"GET",a)},afterRender:function(e,t){if(e.Calls&&e.Calls.section&&e.Calls.section[0]&&Object.keys(e.Calls.section[0]).length>0){var r=e.Calls.section.length>1,s=r?Calls.getCallHeaderLabel():e.Calls.section[0].displaylabel,i=!1,a=e.Calls.section.length,n=t.queryParams,o=null;n.hiddenFieldsSysRefName&&(o=n.hiddenFieldsSysRefName.split(","));for(var c=a-1;c>=0;c--){var l=e.Calls.section[c];if(l.FL instanceof Array)for(var d=l.FL.length-1;d>=0;d--){var u=l.FL[d];-1==o.indexOf(u.sysRefName)&&"true"!==u.readonly?i=!0:l.FL.splice(d,1)}else-1==o.indexOf(l.FL.sysRefName)&&"true"!==l.FL.readonly?i=!0:e.Calls.section.splice(c,1)}if(!i||e.Calls.section.length<=0)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}));var m=new CrmCallForm("FieldsCollectorForm",$("#createEditCallHeader"),s,$("#createEditCallPopup"),e);m.postRenderProcess=function(){m.postRenderProcessForCommonDiv(!0),!r&&m.showDiv.find(".editParentSection").find("table:first").remove(),$("#createEditCallButtons,#c2cPromiseButtons").hide(),$("#fieldsValueCollectorButtons").show(),crmTemplate.setDependentFields("Calls",window.Calls.currentStatus,m.showDiv)},m.show()}else renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))},actions:{onError:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))}}}),Lyte.Router.registerRoute("crm.tab.module.index-module",{queryParams:["id","action","key","widgetparams"],getDependencies:function(){var e=this.transition.url;if(void 0!==e&&e.includes("tab/Documents"))return networkUtils.returnDependencyFiles(["zworkdrive-model.js","zworkdrive-conf-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=this.transition.url;if(void 0!==e&&e.includes("tab/Documents")){var t=networkUtils.returnDependencyFiles(["zworkdrive.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zworkdrive.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workdrive")],ResourceConstants.CRM);return t.concat(r).concat(s)}},beforeModel:function(){var e=this.parent.getDynamicParam();if(null!=moduleRecordMapping[e]||"OneFeeds"==e){var t=this.transition.url;if(void 0!==t&&t.includes("tab/Documents")){var r=this.parent.currentModel;return Lyte.resolvePromises({config:store.findAll("workdrive-conf")}).then((function(e){r.is_workdrive_available=e.config[0].available,r.is_module_supported=e.config[0].module_supported}))}}else{var s=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),i=window.location.pathname.split(s)[1];this.replaceWith("crm.crm-error",i).data={showError:!0,module:e,errorMsg:I18n.getMsg("module.not.available")}}},model:async function(){var e=this.parent.currentModel.module_name;if("SalesInbox"==e){if(!crmTab.isSalesInboxAvailable)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));if(crmTab.isMailClientEnabled&&!crmTab.isMailClientActive)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SalesInboxIntro.do","GET",{params:{action:"showIntro"}});crmTab.isMailClientActive&&(this.transition.abort(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?window.open(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+networkUtils.getOrgSpecificURL(Urls.Salesinbox)):window.location=crmHistory.locationOrigin+networkUtils.getOrgSpecificURL(Urls.Salesinbox))}else{if("Documents"===e&&this.parent.currentModel.is_workdrive_available){var t=this;if(!this.parent.currentModel.is_module_supported||!moduleRecordMapping.Documents.visible){var r=I18n.getMsg("crm.security.error");return renderingUtils.displayPermissionDenied(r,void 0,void 0,void 0,void 0,(function(){crmHistory.length<=1?t.transitionTo({route:"crm.tab.module",dynamicParams:["Home"]}):crmHistory.backOneLevel()}),void 0),void Lyte.Router.getRouteInstance().transition.abort()}return Lyte.resolvePromises({config:store.peekAll("workdrive-conf"),associated_team_folders_main:store.findAll("workdrive-team-folders",{associated:!0})}).then(null,(function(e){var r=JSON.parse(e.response),s=I18n.getMsg("crm.security.error");r.code&&"INTERNAL_ERROR"===r.code&&(s=I18n.getMsg("error.unknown.problem")),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:s}}),crmHistory.length<=1?t.transitionTo({route:"crm.tab.module",dynamicParams:["Home"]}):crmHistory.backOneLevel(),Lyte.Router.getRouteInstance().transition.abort()}))}if("ABM"==e){if(this.transition.abort(),!crmTab.isABMAvailable)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));this.transition.abort();var s,i,a="/crm/"+crmPortal+"/abm/connect";return crmTab.isABMConfigured&&(a="/crm/"+crmPortal+"/abm/home"),void("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?(crmplusImplTriggerActions("selectEntity",["module","ABM"]),i=(i=(a=this.getABMUrl()).substring(a.indexOf("/crm/"))).includes("?")?i.split("?")[0]:i,cookieUtils.setCookie("abm_iframe","true",1,"/crm/"+crmPortal+"/abm/"),this.addABMEventListener(),history.replaceState({},"",i),s=(s=networkUtils.returnDependencyFiles(["crm-abm-container.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["abm-app.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(s,void 0,(function(){$L("#show").html(""),crmplusImplTriggerActions("showLoading"),Lyte.Component.render("crm-abm-container",{frameSource:a},"#show")}))):window.location=window.location.origin+a)}if(!this.transition.response||!this.transition.response.skipRedirect||this.transition.response.refetchInfo){var n={isload:!0};n.module=e;var o=Crm.getCrmBasePath()+"/ShowDetails.do",c=networkUtils.returnDependencyFiles(["crm-groups-mixin.js"],ResourceConstants.CRMClient);(moduleRecordMapping[e].web_link||moduleRecordMapping[e].generated_type&&"webtab_lux"===moduleRecordMapping[e].generated_type)&&(n.webTab=!0);var l=objectUtils.cloneObject(this.transition.data);if(delete l.backOneLevel,Object.assign(n,l),"Feeds"==e&&"showAutoFollowRules"==this.getQueryParams().action){this.getQueryParams().id;n.action="showAutoFollowRules",n.id=this.getQueryParams().id}else"Feeds"!=e&&"OneFeeds"!=e||!this.getQueryParams().key||(c=(c=c.concat(networkUtils.returnDependencyFiles(["crm_feeds.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Feeds")],ResourceConstants.CRM)),n.action=this.getQueryParams().action,n.key=this.getQueryParams().key,0===$(".Feeds_notifications").length&&(n.fetchNotifications=!0),n.module=this.parent.getDynamicParam());var d={params:n};return Lyte.injectResources(c,void 0,void 0),networkUtils.lyteInitiateRequest(o,"GET",d)}}},renderTemplate:function(e,t){if("Documents"===this.parent.currentModel.module_name&&this.parent.currentModel.is_workdrive_available){var r="crm-content-libraries";return e.config[0].configured&&(r="crm-content-libraries-home"),{outlet:"#show",component:r}}return this.transition.response&&this.transition.response.skipRedirect&&(e=this.transition.response.model),"SalesInbox"==this.parent.currentModel.module_name&&Crm.trackSpotLightAction("SalesInbox - Tab Click"),{outlet:"#show",html:e}},afterRender:function(e,t){var r=this.parent.currentModel.module_name;"Feeds"!=r&&"OneFeeds"!=r||$("#feedParentDiv").show()},beforeExit:function(){"undefined"!=typeof CrmWidget&&CrmWidget&&CrmWidget.FreezeWidget&&(WidgetHandler.EventNotifier.pageUnload(CrmWidget.FreezeWidget),$("#crmPopContent").addClass("hide"))}},{mixins:["crm-menu-utils"]}),Lyte.Router.registerRoute("crm.tab.module.modal-create",{queryParams:["sub_module","listenData","callType","callStatus","formName"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-call-form-resources.js","crux-lookupfilter-component.js","crux-column-list.js","crm-detail-view-utils.js","crm-uploadfields-mixin.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-call-menu.js","crm-manual-call-list.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["user_type.js","crm-create-fields.js","crm-create-resources.js","crm-create-pricingdetails.js","crm-create-helpers.js","crm-wizard-common-helpers.js","crm-entity-lookup.js","crux-tag.js","crux-color-palette.js","lyte-step.js","crm-create-dependent-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-create-dependent-resources.css","crm-list-view-crux.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-create-resources-less.css","crm-create-dependent-resources-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-services-create-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-call-form-resources-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-call-form-resources.css"],ResourceConstants.CRMClient))},beforeModel:function(e){var t=this.parent.currentModel.module_name;e.queryParams;"Calls"!==t&&this.transition.abort(),"Outgoing"!==e.queryParams.callType&&"outgoing"!==e.queryParams.callType||(e.queryParams.callType="Outbound"),"Incoming"!==e.queryParams.callType&&"incoming"!==e.queryParams.callType&&"missed"!==e.queryParams.callType||(e.queryParams.callType="Inbound")},model:function(e){var t=this.parent.getDynamicParam(),r=objectUtils.cloneObject(this.transition.data);delete r.refreshPage,delete r.backOneLevel,delete r.checkPermission;var s={};"Activities"===(t=this.parent.currentModel.module_name)&&(t=this.parent.getQueryParams().sub_module),s.module=t,crmTab.isZBCustomModule(t)||crmTab.isZSCustomModule(t)?s.newModel=!0:s.format="json",(s=Object.assign(s,r)).relmodule&&"Deals"===s.relmodule&&(s.relmodule="Potentials"),s.primmodule&&"Products"===s.primmodule&&(s["property(productId)"]=s.entityid);var i,a=this.parent.currentModel,n=a.module_name;return"Activities"===a.module_name?(n=this.parent.getQueryParams().sub_module,i=moduleRecordMapping[n].id):i=moduleRecordMapping[a.module_name].id,this.getModuleData().then(function(t){for(var r,a,o=t[0],c=o?o.layouts:[],l=c?c.length:0,d=[],u=0,m=Crm.userDetails.PROFILE_NAME,p=0;p<l;p++){for(var h=c[p].profiles.length,f=0;f<h;f++)if(c[p].profiles[f].default&&m===c[p].profiles[f].name){r=c[p].name,a=c[p].id;break}d[u]={uservalue:c[p].name,systemvalue:c[p].id,id:c[p].id},u++}var g,y=e.queryParams.formName,v={};"true"===e.queryParams.listenData&&(g=this.getCallBackparamPromise());var _={};_.layoutId=a,_.moduleapi=o.api_name,_.moduleName=n;var C=this.getModulePromise(_),R=this.getWhatIdArrPromise();return Promise.all([C,R,g]).then(function(t){for(var c=t[0],l=c.layout[0].sections,u=l.length,m={},p=0;p<u;p++){for(var h=!1,f=l[p].api_name,g=l[p].fields.length,_=0;_<g;_++){"Description"===l[p].fields[_].api_name&&(l[p].fields[_].visible=!1,h=!0)}(g<=0||g<=1&&h)&&(m[f]=!0)}var C=this.checkNoFieldsErrorHandling(e.queryParams.callType,e.queryParams.callStatus,m);return C||this.transition.abort(),v=this.getAdditionalEntityData(C.callType,C.callStatus),this.removeMandatoryFromLayoutRules(c.layout_rule,"Who_Id"),{formName:y,formTitle:"Add Call Details",initRoute:"create",entityrecordData:c.editEntitydata?c.editEntitydata[0]:{},transitionData:s,layoutRules:c.layout_rule,validationRules:c.validation_rule,customButtons:c.custom_button,moduleData:o,moduleId:i,moduleName:n,layoutddData:d,layoutddSelected:r,selectedLayoutid:a,moduleSections:c.layout[0].sections,layoutDet:c.layout,additionalEntityData:v,callBackParam:t[2],whatIdModuleArray:this.whatIdArr,whoIdLabel:I18n.getMsg("crm.activities.call.label.callee"),isServerData:this.getIsServerData()}}.bind(this))}.bind(this))},renderTemplate:function(){return{outlet:"#show",component:"crm-call-form"}}},{mixins:["crm-create-mixin","crm-call-form-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.promo",{getDependencies:function(){var e=networkUtils.getI18nJSUrl("promopagekeys");return[networkUtils.returnDependencyFiles([e],ResourceConstants.CRM)]},getResources:function(){var e=networkUtils.returnDependencyFiles(["get-started.js","lyte-carousel.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["get-started.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js","zohocrm_tabsAndFieldsApiNames.js"],ResourceConstants.CRM),s=e.concat(t);return s=s.concat(r)},renderTemplate:function(){return{outlet:"#show",component:"crm-get-started"}},afterRender:function(){Crm.isRebrandingEnabled?this.setTitle(this.transition.info.dynamicParams[0]+" - "+Crm.productBrandName):this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(this.transition.info.dynamicParams[0]),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.tab.module.quick-create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.js","crm-vision-match-utils.js","crm-vision-validation.js","crm-vision-create.js","crm-image-upload-ziaError.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js","phone-entity.js","crux-lookupfilter-component.js","crux-column-list.js","crm-uploadfields-mixin.js","crm-detail-view-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient);t.push(networkUtils.returnDependencyFiles(["zohocrm_headless_quickcreate.css"],ResourceConstants.CRM));var r=e.concat(t);return r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),Crm.userDetails.isPhoneNoNewView&&(r=r.concat(Crm.returnPhoneFieldDependencyFiles())),r},queryParams:["sub_module","phonenumber","entityid","entitymodule","entityname"],model:function(e){window.returnJson=window.returnJson?window.returnJson:{};var t=e.queryParams,r=this.parent.getDynamicParam(),s=t.phonenumber?t.phonenumber:null,i=t.entityid?t.entityid:null,a=t.entitymodule?t.entitymodule:null,n=t.entityname?t.entityname:null,o=$("#ctinotifier_center");if(isNewCallView||"Leads"!==r&&"Contacts"!==r||!s||Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("phonenumberassociate")],ResourceConstants.CRM)[0]]),isNewCallView&&("Leads"===r||"Contacts"===r)&&s){var c="Leads"==r?"add_lead":"add_contact",l=document.createElement("phone-entity"),d=s?s.replace(/[^0-9]/g,""):s;l.setData({defaultvalue:s,defaultid:d,autotrigger:c}),l.style="display:none",document.body.appendChild(l)}else if("Leads"===r)o.append('<div class="ctiapi_activitys" id="ctiapi_entitys_create_lead" style="display:none;"></div>'),CTIAPI.createLead(s,"true");else if("Contacts"===r)o.append('<div class="ctiapi_activitys" id="ctiapi_entitys_create_contact" style="display:none;"></div>'),CTIAPI.createContact(s,"true");else if("Activities"===r||["Calls","Events","Tasks"].contains(r)){o.css("z-index",50);var u=t.sub_module;["Calls","Events","Tasks"].contains(r)&&(u=r);var m=["zohocrm_phonebridge_notifier.js"];isNewCallView&&(m=m.concat("zcrm_callsnew.js")),networkUtils.loadFeatureScripts(m,function(){switch(u){case"Calls":isNewCallView?((validationUtils.isEmpty(i)||validationUtils.isEmpty(a))&&(i=a=n=null),this.getEntityInfo(a,i,n).then((function(e){var t=CrmDateUtils.getCrmDateAfterMins(30),r=new AutoFillFormData(e.primaryEntity,e.whoEntity,e.whatEntity,null,t,"Outbound","Scheduled");e.primaryEntity&&(r.autoPopRelated=!0);Calls.showCreateForm(r,["ScheduledCall"],["Crm_Calls_CALLTYPE","Crm_Calls_OUTBOUNDCALLSTATUS"])}))):(o.append('<div class="ctiapi_activitys" id="ctiapi_activitys_create_call" style="display:none;"></div>'),ctiApiNotifier.createCall(i,a,!0));break;case"Events":ctiApiNotifier.createEventfromZPB(i,a);break;case"Tasks":o.width(545),o.css("marginLeft","-272px"),o.append('<div class="ctiapi_activitys" id="ctiapi_activitys_create_task" style="display:none;"></div>'),ctiApiNotifier.createTask(i,a,!0)}}.bind(this))}},afterRender:function(e,t){setTimeout((function(){var e=t.queryParams,r=Lyte.Router.getRouteInstance("crm.tab.module.quick-create").transition.info.queryParams,s={},i=["4","5","6","7","9","10","12","13","15","16","42","43","44",CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY.toString(),"133",CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY.toString(),"210"],a=$(".qcpopuparrow");for(var n in a&&a.hide(),r.data&&(s=JSON.parse(r.data)),s){if(r.sub_module&&"Events"==r.sub_module)var o=document.querySelector('[data-fieldid="'+n+'"]');else o=document.querySelector('[data-fieldid="field_'+n+'"]');if(o){var c=o.getAttribute("data-uitype"),l=s[n];if(i.contains(c))l=JSON.parse(l),o.value=l.id.toString(),document.querySelector('[data-fieldid="fields_'+n+'"]').value=l.name.toString();else if("2"==c||"26"==c){var d=o.getAttribute("id");$("#"+d).val(l).trigger("change")}else"786"==c?"Calls"==e.sub_module&&$('[value="'+l+'"]').click():o.value=l.toString()}}}),700)},actions:{willTransition:function(){var e=this.parent.currentModel.module_name,t=Lyte.registeredMixins["crm-multi-selection-popup-mixin"];if(t&&t.deletePopup(),"Activities"===e||"Tasks"===e){var r=this.getQueryParams().sub_module;switch("Tasks"===e&&(r="Tasks"),r){case"Calls":case"Events":break;case"Tasks":var s=$("#ctinotifier_center");s.html(""),s.hide()}}}},getEntityInfo:function(e,t,r){return new Promise((function(s){var i={};validationUtils.isEmpty(t)?s(i):validationUtils.isNotEmpty(r)?(i.primaryEntity=new BasicEntityInfo(e,t,r),s(i)):(i.primaryEntity=new BasicEntityInfo(e,t,r),new Promise((function(e,t){Calls.resolveWindowsCommunication=e,Calls.rejectWindowsCommunication=t,WindowsCommunicator.notifyParent("get-pbcall-info",null,{action:"getCallBackParam"})})).then((function(r){r.Who_Id&&(r.Who_Id.id===t&&(i.primaryEntity=new BasicEntityInfo(e,t,r.Who_Id.name)),i.whoEntity=new BasicEntityInfo("Contacts",r.Who_Id.id,r.Who_Id.name)),r.What_Id&&(r.What_Id.id===t&&(i.primaryEntity=new BasicEntityInfo(e,t,r.What_Id.name)),i.whatEntity=new BasicEntityInfo(r.$se_module,r.What_Id.id,r.What_Id.name)),s(i)})))}))}}),Lyte.Router.registerRoute("crm.tab.module",{queryParams:["sub_module"],forceFetch:function(){if(this.transition.info.queryParams.filters){var e=this.transition.info.queryParams,t=JSON.parse(e.filters);if(t[0]&&t[0].searchfield)return!1}return"crm.tab.module.custom-view.list"===this.transition.target||"crm.tab.module.custom-view.kanban"===this.transition.target||"crm.tab.module.custom-view.canvas"===this.transition.target||"crm.tab.module.custom-view.zia"===this.transition.target||"crm.tab.module.custom-view.chart"===this.transition.target||"crm.tab.module.custom-view.timeline"===this.transition.target},getDependencies:function(e){var t=e.dynamicParam,r=[];if((t.indexOf("Orchestration")>=0||t.indexOf("PathFinder")>=0)&&(r=r.concat(networkUtils.returnDependencyFiles(["pathfinder_meta_model.js"],ResourceConstants.CRMClient))),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),Crm.isCpqRelatedTab(this.getDynamicParam())){var s=networkUtils.returnDependencyFiles(["cpq-utils.js"],ResourceConstants.CRMClient);r=r.concat(s)}return r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-dataprivacy-mixins.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-utils.js","zia-insights.js","features_model.js","zia_features_resource.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient))},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["approvalprocess-mixins.js","crm-macro.js","macro-model.js","crm-create-route-mixin.js","crm-create-mixin.js","crm-create-mixin2.js","crux-form-component.js","campaign_status_model.js","crm-email-auth-util.js","crm-email-deliverability-handling.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-macro.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient),s=t.concat(r);(s=(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_module_settings_common.js","zohocrm_module_common.js","zohocrm_macro_common.js","zohocrm_integration_home.js"],ResourceConstants.CRM)),Crm.isCpqActivated()&&!0===Crm.isCpqActivated())&&(e=(e=featuresAvailable.NEXTGENUI_ENABLED?networkUtils.returnDependencyFiles(["lytecombobox.js","lyte-nav.js","cpq-helpers.js"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["lytecombobox.js","zohocpq-tab.js","lyte-nav.js","cpq-helpers.js","cpq-utils.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["zohocpq-tab.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],ResourceConstants.CRMClient))),s=(s=s.concat(e)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq"),networkUtils.getI18nJSUrl("CPQCommonEntity")],ResourceConstants.CRM)));if("Feeds"===this.getDynamicParam()){var i=networkUtils.returnDependencyFiles(["crm_feeds.css"],ResourceConstants.CRM);s=s.concat(i);var a=networkUtils.returnDependencyFiles(["crm-activity-right-panel.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-activity-right-panel.css"],ResourceConstants.CRMClient);s=s.concat(a.concat(n))}if(moduleRecordMapping.Services){var o=networkUtils.getI18nJSUrl("serviceentitykeys");s.push(networkUtils.returnDependencyFiles([o],ResourceConstants.CRM)),s.push(networkUtils.returnDependencyFiles(["business_hours-model.js","holidays-model.js","crm-services-appointments.js"],ResourceConstants.CRMClient)),s.push(networkUtils.returnDependencyFiles(["crm-create-service-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}if(moduleRecordMapping.Bundles){o=networkUtils.getI18nJSUrl("bundles");s.push(networkUtils.returnDependencyFiles([o],ResourceConstants.CRM))}var c=networkUtils.getI18nJSUrl("LineItemSubformCRUD");return s.push(networkUtils.returnDependencyFiles([c,networkUtils.getI18nJSUrl("Notes")],ResourceConstants.CRM)),s},beforeModel:async function(e){if(featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&featuresAvailable.TEAM_MODULE_ENABLED&&void 0!==moduleRecordMapping[e.dynamicParam]&&"team_based"===moduleRecordMapping[e.dynamicParam].access_type&&moduleRecordMapping[e.dynamicParam].private_profile&&"Requesters"===moduleRecordMapping[e.dynamicParam].private_profile.name){var t=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),r=window.location.pathname.split(t)[1];this.replaceWith("crm.crm-error",r).data={showError:!0,module:a,errorMsg:I18n.getMsg("module.not.available")}}else if(!this.transition.data||!this.transition.data.reloadAll){if(Crm.isActivitySplitDone&&e.dynamicParam&&"Activities"===e.dynamicParam&&this.transition.target.indexOf("crm.tab.module.entity.detail")>-1){var s=moduleRecordMapping.Activities&&moduleRecordMapping.Activities.show_as_tab;if(!this.transition.data.fromActivityListView&&!this.transition.data.fromDetailView&&!s){var i=this.getQueryParams().sub_module;this.transitionTo("crm.tab.module.entity",i,this.transition.info.dynamicParams[1])}}var a=this.getDynamicParam();if(null==moduleRecordMapping[e.dynamicParam]&&e.dynamicParam.indexOf("CustomModule")>-1){t=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),r=window.location.pathname.split(t)[1];this.replaceWith("crm.crm-error",r).data={showError:!0,module:a,errorMsg:I18n.getMsg("module.not.available")}}else{if("Zoho Books"==e.dynamicParam||crmTab.isZBCustomModule(e.dynamicParam)){if("Zoho Books"==e.dynamicParam)(d=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}))).length>0&&this.replaceWith("crm.tab.module",d[0].module_name);crmTab.isBooksIntegrated()&&($("#zbModuleTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam).addClass("activeLiList"))}else if(!window.clientPortalName&&moduleRecordMapping.ZohoCPQ&&("ZohoCPQ"===e.dynamicParam||crmTab.isZCpqTab(e.dynamicParam)||crmTab.isZCpqSubTab(e.dynamicParam)))if(Lyte.registeredMixins["crm-cpq-utils"]){var n=Lyte.registeredMixins["crm-cpq-utils"].generateCPQTabs("1"),o=Lyte.registeredMixins["crm-cpq-utils"].generateCPQTabs("2"),c=e.dynamicParam;0===n.length&&(o.length>0?(n=o,o=[]):(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())),"ZohoCPQ"===e.dynamicParam&&this.replaceWith("crm.tab.module.index-module",n[0].module_name);var l={};l.cpqTabs=n,l.cpqTabSelected=c,l.cpqSubTabs=o,this.cpqObj=l}else Lyte.Component.registeredHelpers.log("isCPQActivated - ",Crm.isCpqRelatedTab(this.getDynamicParam()));else if("Zoho Invoice"===e.dynamicParam||crmTab.isZInvoiceCustomModule(e.dynamicParam)){var d;if("Zoho Invoice"==e.dynamicParam)(d=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}))).length>0&&this.replaceWith("crm.tab.module",d[0].module_name);crmTab.isInvoiceIntegrated()&&($("#zInvoiceModuleTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam).addClass("activeLiList"))}else if("Zoho Expense"===e.dynamicParam)this.replaceWith("crm.tab.module","CustomModule5006"),crmTab.isZExpenseSubModule(e.dynamicParam)&&($("#zohoExpenseTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam.replace(" ","_")).addClass("activeLiList"));else if(e.dynamicParam.indexOf("Orchestration")>=0||e.dynamicParam.indexOf("PathFinder")>=0){if(Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter)return renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),void this.transition.abort();if(!Crm.userDetails.permissions.Crm_Implied_Manage_Workflow)return renderingUtils.displayPermissionDenied(),void this.transition.abort();Lyte.registeredMixins.orchestration.getPathFinderMeta();var u=async function(){var e=Lyte.Router.getRouteInstance().transition;if(e&&e.url&&e.url.indexOf("Orchestration")>=0){var t=Lyte.registeredMixins.orchestration.fetchOnlyOrchestrationChildModules().sort((function(e,t){return e.sequence_number-t.sequence_number}));if(crmTab.isABMCCAvailable&&crmTab.isABMConfigured){if(!store.peekAll("orchestration_process")||!store.peekAll("orchestration_process").length)try{Crm.userDetails.permissions.Crm_Implied_Manage_ABM?await store.findAll("orchestration_process",{category:"abm"}):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&await store.findAll("orchestration_process")}catch(e){murphy.error(e)}t=Lyte.registeredMixins.orchestration.filterOutAbmOrchestrations(t)}}if(e&&e.url&&e.url.indexOf("PathFinder")>=0||0===t.length)t=Lyte.registeredMixins.orchestration.fetchPathfinderChildModules().sort((function(e,t){return e.sequence_number-t.sequence_number}));t.length>0&&Lyte.Router.getRouteInstance().transitionTo({route:"crm.tab.module",dynamicParams:[t[0].module_name]})};if(moduleRecordMapping[e.dynamicParam]){if("Orchestration"===e.dynamicParam||"PathFinder"===e.dynamicParam)return void await u();e.dynamicParam.indexOf("PathFinder")>=0?e.dynamicParam.indexOf("PathFinder")>=0&&(moduleRecordMapping[e.dynamicParam].pathFinderModule?this.replaceWith("crm.tab.module",moduleRecordMapping[e.dynamicParam].pathFinderModule):moduleRecordMapping.Orchestration.pathFinderModule=e.dynamicParam,moduleRecordMapping.Orchestration.isPFModInLast=!0):(moduleRecordMapping[e.dynamicParam].orchestrationModule?this.replaceWith("crm.tab.module",moduleRecordMapping[e.dynamicParam].orchestrationModule):moduleRecordMapping.Orchestration.orchestrationModule=e.dynamicParam,moduleRecordMapping.Orchestration.isPFModInLast=!1)}else{var m=Lyte.Component.render("lyte-alert",{ltPropType:"info",ltPropButtonPosition:"center",ltPropSecondaryMessage:e.dynamicParam.indexOf("PathFinder")>=0?I18n.getMsg("pf.doesnotexist"):I18n.getMsg("orch.listview.deleted.info"),ltPropContentAlign:"center",ltPropShowCloseButton:!1,ltPropTop:"0px"},"body");m.setData("ltPropShow",!0),m.setMethods({onAccept:u}),this.transition.abort()}}else{if("Visits"==e.dynamicParam&&"undefined"==typeof CrmTracking)return delete moduleRecordMapping.Visits.cvid,delete moduleRecordMapping.Visits.custom_view,void("crm.tab.module.index-module"!=this.transition.info.route&&this.replaceWith("crm.tab.module.index-module","Visits"));if("Messages"===a&&(-1!=="crm.tab.module.custom-view.kanban".indexOf(this.transition.target)||-1!=="crm.tab.module.custom-view.canvas".indexOf(this.transition.target)))return void this.replaceWith("crm.tab.messages");if(this.transition.target.indexOf("crm.tab.module.custom-view")>-1&&("Home"==e.dynamicParam||"Reports"==e.dynamicParam||"Dashboards"==e.dynamicParam||"Forecasts"==e.dynamicParam||"Emails"==e.dynamicParam||"SalesInbox"==e.dynamicParam||"Projects"==e.dynamicParam||"ABM"==e.dynamicParam))return void("Home"==e.dynamicParam?this.replaceWith("crm.tab.module.begin",e.dynamicParam):this.replaceWith("crm.tab.module.index-module",e.dynamicParam))}crmTab.removeOrShowZBTabLayer(crmTab.isZBCustomModule(e.dynamicParam)&&crmTab.isBooksIntegrated()||"Zoho Books"==e.dynamicParam),crmTab.removeOrShowZInvoiceTabLayer(crmTab.isZBCustomModule(e.dynamicParam)&&crmTab.isInvoiceIntegrated()||"Zoho Invoice"==e.dynamicParam),crmTab.removeOrShowZExpenseTabLayer(crmTab.isZExpenseSubModule(e.dynamicParam)||"Zoho Expense"==e.dynamicParam);var p=e.dynamicParam,h=moduleRecordMapping[p];if(h){var f=h.api_name;"Activities"===p?(moduleRecordMapping.Activities.child_module.forEach((function(e){store.clearCachedQuery("tag",{module:e.api_name,fromPage:"view"})})),f="Tasks"):store.clearCachedQuery("tag",{module:h.api_name,fromPage:"view"}),store.clearCachedQuery("record_locking_configurations",{module:f})}}}},model:function(e){return this.transition.data&&this.transition.data.reloadAll?{}:(this.currentModuleData=this.getModuleData(e.dynamicParam,this.transition.target),this.currentModuleData)},redirect:function(e,t){if(!crmHistory.transitionError){(s=e.module_name)||(s=t.dynamicParam);var r,s=this.currentModel.module;if(crmTab.requiredPromoTabs.hasOwnProperty(t.dynamicParam)&&Crm.userDetails.SERVICES_PROMO_VISIBILITY?"crm.tab.module.index-module"===this.transition.target&&this.replaceWith("crm.tab.module.promo",this.transition.info.dynamicParams[0],null):"crm.tab.module.promo"!==this.transition.target||moduleRecordMapping[t.dynamicParam]||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()),s){r=s.module_name;var i=this.transition.target;if(!Crm.userDetails.CLIENT_ACCOUNT||"crm.tab.module.custom-view.list"!=i&&"crm.tab.module.custom-view.canvas"!=i){if("crm.tab.approvals"!=this.transition.target&&"crm.tab.module.create"!=this.transition.target&&(!this.transition.response||!this.transition.response.isFromModuleInfo&&!this.transition.response.skipRedirect))if((("crm.tab.module"===this.transition.target||"crm.tab.module.begin"===this.transition.target)&&"Home"!==s.api_name||"crm.tab.module.index-module"===this.transition.target||"crm.tab.module.custom-view"===this.transition.target||(window.location.pathname.endsWith("custom-view")||window.location.pathname.endsWith("custom-view/"))&&"crm.tab.module.entity.detail"===this.transition.target)&&(s.cvid||s.custom_view)){s.cvid=s.cvid?s.cvid:s.custom_view.id;var a=crmTab.getFromCache(r);l={};if(a&&((a.filter_id||a.filterId)&&(l.filter_id=a.filter_id?a.filter_id:a.filterId),a.filters&&(l.filters=JSON.stringify(a.filters)),a.cross_filters&&(l.cross_filters=JSON.stringify(a.cross_filters))),s.kanban_view)this.replaceWith("crm.tab.module.custom-view.kanban",r,s.cvid,l);else if(s.canvas_view&&s.viewid||s.card_view&&s.cardid||s.table_view&&s.tableid){l.viewType=s.canvas_view?"CustomizedView":s.card_view?"CardView":"TableView";d=s.canvas_view?s.viewid:s.card_view?s.cardid:s.tableid;this.replaceWith("crm.tab.module.custom-view.canvas",r,s.cvid,d,l)}else if(s.zia_view)this.replaceWith("crm.tab.module.custom-view.zia",r,s.cvid,l);else if(s.chart_view)this.replaceWith("crm.tab.module.custom-view.chart",r,s.cvid,l).data=this.transition.data;else if(s.timeline_view)this.replaceWith("crm.tab.module.custom-view.timeline",r,s.cvid,l).data=this.transition.data;else{if("crm.tab.module"===this.transition.target&&"Leads"===r&&app.prevTransition&&"crm.tab.module.entity.convert"===app.prevTransition.route){var n=s.total_count,o=s.per_page,c=s.start_index+1;n&&n>1&&c-n==0&&(l.page=(c-1)/o,l.per_page=o)}this.replaceWith("crm.tab.module.custom-view.list",r,s.cvid,l).data=this.transition.data}}else"Home"===s.api_name&&"crm.tab.module.activities-banner"===this.transition.target||("Home"!==s.api_name||"crm.tab.module.begin"===this.transition.target)&&"crm.tab.module.promo"!==this.transition.target?("Analytics"===s.api_name||"Dashboards"===s.api_name)&&"crm.tab.module.activities-banner"===this.transition.target||s.cvid||s.custom_view||"Home"===s.api_name||"Reports"===s.api_name||"Dashboards"===s.api_name||"crm.tab.module.index-module"===this.transition.target||"crm.tab.module.entity.detail"===this.transition.target||(-1!==r.indexOf("/")&&(r=r.replace("/"," ")),this.replaceWith("crm.tab.module.index-module",r)):this.replaceWith("crm.tab.module.begin",r)}else if("crm.tab.module.custom-view.list"===i&&(s.canvas_view&&s.viewid||s.card_view&&s.cardid||s.table_view&&s.tableid)){var l;(l={}).viewType=s.canvas_view?"CustomizedView":s.card_view?"CardView":"TableView";var d=s.canvas_view?s.viewid:s.card_view?s.cardid:s.tableid;this.replaceWith("crm.tab.module.custom-view.canvas",r,s.cvid,d,l)}else"crm.tab.module.custom-view.canvas"!==i||s.canvas_view||s.card_view||s.table_view||this.replaceWith("crm.tab.module.custom-view.list",r,s.cvid);"crm.tab.module.custom-view.canvas"!=this.transition.target||s.customized_view||(this.replaceWith("crm.tab.module.custom-view.list",r,s.cvid).data=this.transition.data)}var u=this.transition.data;if(u&&u.reloadAll){s=this.getDynamicParam();["crm.tab.module.custom-view","crm.tab.module.index-module","crm.tab.module.custom-view.list","crm.tab.module.custom-view.chart","crm.tab.module.custom-view.zia","crm.tab.module.custom-view.kanban","crm.tab.module.custom-view.canvas","crm.tab.module.custom-view.timeline"].contains(this.transition.target)&&(this.removeTotalCache(this.transition.info.dynamicParams[0],this.transition.info.dynamicParams[1]),delete u.reloadAll,u.refreshTemplate=!0,u.clearCache=!0,app.prevTransitionBeforeRefresh=app.prevTransition,this.refresh({refreshTemplate:!0}).data=u)}else-1==this.transition.target.indexOf("crm.tab.module.custom-view")||moduleRecordMapping[t.dynamicParam].crux_customViewAccessedModules||(u?u.refreshTemplate=!0:u={refreshTemplate:!0},this.refresh({refreshTemplate:!0}).data=u)}},renderTemplate:function(){var e=$L("crm-left-menu")[0];(e=e?e.component:null)&&e.executeMethod("showModulesOnRouteTransition")},afterRender:function(e){e.module&&(Crm.isRebrandingEnabled?this.setTitle(e.module.plural_label+" - "+Crm.productBrandName):this.setTitle(I18n.getMsg("crm.title.general.revamped",[e.module.plural_label,Crm.partnerName])));var t=this.getDynamicParam();this.postModuleDataFetch(t),this.cpqObj&&(this.currentModel.cpqObj=this.cpqObj)},actions:{onError:function(e,t){if(this.currentModel&&this.currentModel.status&&200!==this.currentModel.status&&201!==this.currentModel.status)return crmHistory.transitionError=!0,this.handleError(this.getDynamicParam()),!1},didTransition:function(){var e=document.querySelector("crm-tab");if(-1==["create","edit","detail","clone","canvas"].indexOf(this.getRouteInstance().routeName)){var t=this.getDynamicParam();"Home"==t?Crm.isRebrandingEnabled?this.setTitle(I18n.getMsg("crm.title.show.home.revamped.dynamic",[Crm.productBrandName])):this.setTitle(I18n.getMsg("crm.title.show.home.revamped.dynamic",[Crm.appName])):e&&crmTab.getDisplayName(t,!1)&&(Crm.isRebrandingEnabled?this.setTitle(crmTab.getDisplayName(t,!1)+" - "+Crm.productBrandName):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName(t,!1),Crm.partnerName])))}if(!Crm.isHeadless&&e&&!e.querySelector(".lyteMenuItems .lyteItem.lyteMenuActive")&&e){var r=e.getData("selected"),s=e.getData("visibleTabs");r&&s.forEach((function(t){t.module_name===r.module_name&&e.querySelector(".lyteMenuItems div[data-value="+r.module_name+"]").classList.add("lyteMenuActive")}))}},willTransition:function(e){var t=e.info.dynamicParams[0];if(featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED){var r=$L("crm-left-menu-teamspace")[0],s=null;(r=r?r.component:null)&&(s=(s=$L("crm-left-menu")[0])?s.component:null),s&&t&&moduleRecordMapping[t]&&moduleRecordMapping[t].viewable&&"requesters"!==s.data.selectedMenu&&r.executeMethod("checkModuleOccurrenceAndOpen",r,moduleRecordMapping[t].id,e,!1,!0)}Notes.feedsContent="",Notes.feedCommentsContent="";var i=$L("#feed_status");i.length>0&&i.hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("feed_status");var a=Notes.mentionedCommentIds?Notes.mentionedCommentIds.length:0;if(a>0){for(var n=0;n<a-1;n++)Notes.destroyMentionsComponent(Notes.mentionedCommentIds[n]);Notes.mentionedCommentIds.length=0}}},beforeExit:function(e,t){Crm.ViewedCanvasState&&(Crm.ViewedCanvasState=void 0),crmTab.removeOrShowZBTabLayer(!1),crmTab.removeOrShowZInvoiceTabLayer(!1),crmTab.removeOrShowZExpenseTabLayer(!1),store.unloadAll("features-status")},handlePromo:function(e){return"Services"===e&&moduleRecordMapping.Appointments&&!moduleRecordMapping.Appointments.cvid&&this.initializeCvid("Appointments"),this.initializeCvid(e)},initializeCvid:function(e){return store.findAll("custom_view",{module:moduleRecordMapping[e].api_name}).then((function(t){return t&&(moduleRecordMapping[e].cvid=t.$.meta.default),{module:moduleRecordMapping[e]}}))}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.newDashboards.clone",{getDependencies:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion"))return networkUtils.returnDependencyFiles(["zia-component-suggestion-model.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-analytics-create-page.js"],ResourceConstants.CRMClient)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e,t,r=$L("crm-analytics-container")[0];if(r){e=r.getData("featureKeys");var s=$L("crm-analytics-view")[0];t=s?s.getData("userPermission"):void 0}else{var i=$L("crm-manage-dashboards")[0];i&&(e=i.getData("featureKeys"),t=i.getData("userPermission"))}return Lyte.resolvePromises({analytics:store.findRecord("Analytics",this.getDynamicParam(),{include_inner_details:"$..field.label,$..field.ui_type,$..field.data_type,$..field_involved.label,$..field.enable_colour_code,$..field.formula",include:"component_preferences"},void 0,!0,{apiVersion:"2.2"}),permission:void 0===t?store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details",fields:"profile",inner_details_filters:{inner_detail_filters:[{api_name:"profile.permissions_details",filters:{field:{api_name:"module"},comparator:"equal",value:moduleApiMapping.Dashboards}}]}},!1,!1,{tempApiVersion:"V2.2"}):t,fromView:!this.transition.data.fromView||this.transition.data.fromView,alertNeeded:!1,featureKeys:void 0===e?store.triggerAction("Analytics","feature_keys",{action:"feature_keys",type:"GET",apiVersion:"2.2"}):e})},afterModel:function(e){if(e.permission&&(!e.permission.user[0].profile.permissions_details||!e.permission.user[0].profile.permissions_details[1].enabled)){this.transition.abort();var t={status:403};t.responseText=JSON.stringify({status:"error",code:"NO_PERMISSION"}),Lyte.registeredMixins["crm-dashboard-utils"].handleErrorsByDefault(t),this.transitionTo("crm.tab.newDashboards.index").errorObj=t}if(e.analytics&&0!==Object.keys(e.analytics).length)if(e.analytics[0].Components&&e.analytics[0].Components.length>0){for(var r=[],s=e.analytics[0].Components.length,i=0;i<s;i++){var a=e.analytics[0].Components[i],n=a._error_details?a._error_details.code:null;if(("FIELD_NOT_AVAILABLE"===n||"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"===n||"FIELD_LIMIT_EXCEEDED"===n||"MODULE_NOT_AVAILABLE"===n||"FIELD_IN_CRITERIA_NOT_AVAILABLE"===n||"NO_PERMISSION"===n&&"stage"===a.type)&&(e.alertNeeded=!0),"COMPONENT_NOT_SUPPORTED"!==n&&"FIELD_NOT_AVAILABLE"!==n&&"MODULE_NOT_AVAILABLE"!==n&&"NO_PERMISSION"!==n&&"FIELD_IN_CRITERIA_NOT_AVAILABLE"!==n&&"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"!==n&&"FIELD_LIMIT_EXCEEDED"!==n){var o=a.$.toJSON();delete o.id;var c=store.createRecord("analytics_component",o);r.push(c)}}e.analytics=e.analytics[0].$.toJSON(),e.analytics.Components=r}else e.analytics=e.analytics[0].$.toJSON();else this.transition.abort(),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.dashboard.not.available")}}),$("#custom_alert_button").bind("click",(function(){Lyte.Router.transitionTo({route:"crm.tab.newDashboards.index"})}));e.analytics.Components||(e.analytics.Components=[]);var l=this.currentModel.analytics.name+"_"+I18n.getMsg("crm.label.cloned");(this.currentModel.analytics.name=l,this.currentModel.fromView=e.fromView,this.currentModel.parentIdForClone=this.currentModel.analytics.id,delete this.currentModel.analytics.id,this.currentModel.transitionData=this.transition.data,this.currentModel.featureKeys=void 0===e.featureKeys.feature_keys?e.featureKeys:e.featureKeys.feature_keys,this.currentModel.permission=void 0===e.permission.userPermission?e.permission:e.permission.userPermission,featuresAvailable.NEXTGENUI_ENABLED)&&$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1);commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-dashboard-create",data:e}},afterRender:function(e){if(CrmAnalytics.initChart(),e.alertNeeded){var t=I18n.getMsg("crm.dashboard.permissionless.component.clone"),r=document.querySelector("#analyticsMsg");r||(r=Lyte.Component.render("lyte-messagebox",{},"#show")),r.ltProp("type","warning"),r.ltProp("message",t),r.ltProp("show",!0),r.ltProp("duration",4e3)}},actions:{onError:function(e){"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.create",{getDependencies:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion"))return networkUtils.returnDependencyFiles(["zia-component-suggestion-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-analytics-create-page.js"],ResourceConstants.CRMClient);if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion")){var t=networkUtils.returnDependencyFiles(["zia-component-suggestions-component.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["analytics-zia-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaComponentSuggestions")],ResourceConstants.CRM);return e.concat(s,r,t)}return e},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){Crm.client_tracking("AD - Create Dashboard");var e,t=$L("crm-analytics-container")[0];if(t)e=t.getData("featureKeys");else{var r=$L("crm-manage-dashboards")[0];e=r?r.getData("featureKeys"):void 0}return Lyte.resolvePromises({fromView:!this.transition.data.fromView||this.transition.data.fromView,permission:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details",fields:"profile",inner_details_filters:{inner_detail_filters:[{api_name:"profile.permissions_details",filters:{field:{api_name:"module"},comparator:"equal",value:moduleApiMapping.Dashboards}}]}},!1,!1,{tempApiVersion:"V2.2"}),featureKeys:void 0===e?store.triggerAction("Analytics","feature_keys",{action:"feature_keys",type:"GET",apiVersion:"2.2"}):e})},afterModel:function(e){var t=this.transition.data;if(e.permission&&!(e.permission.user[0].profile.permissions_details&&e.permission.user[0].profile.permissions_details[1].enabled&&e.permission.user[0].profile.permissions_details[0].enabled)){if(this.transition.abort(),e.permission.user[0].profile.permissions_details&&!e.permission.user[0].profile.permissions_details[0].enabled)return crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied(),window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.showError",["dashboard_creation"]),!1;var r={status:403};return r.responseText=JSON.stringify({status:"error",code:"NO_PERMISSION"}),this.transitionTo("crm.tab.newDashboards.index").errorObj=r,void(window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.showError",["dashboard_creation"]))}if(t.countExceeds)return this.transition.abort(),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.dashboard.customdashboard.limit.exceeds",t.dashboardMaxCnt),ltPropDuration:"4000",ltPropShow:!0}}),commonUtils.showHideLoadingDiv(!1),void(window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.showError",["dashboard_creation"]));(this.currentModel.transitionData=this.transition.data,this.currentModel.featureKeys=void 0===e.featureKeys.feature_keys?e.featureKeys:e.featureKeys.feature_keys,featuresAvailable.NEXTGENUI_ENABLED)&&$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1);commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-dashboard-create",data:e}},afterRender:function(){CrmAnalytics.initChart(),window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.afterLoad",["dashboard_creation"])},actions:{onError:function(e,t){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,t.abort(),renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.dashboardId.records",{queryParams:["page","criteria","formula","sort_by","sort_order","column","value","hierarchy_id","hierarchy_name","title","action","subComponentId","drill_down"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-records-view.js","crm-sort-popup.js","crm-report-generator.js","crm-report-data.js","crm-column-list.js","crux-column-list.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-crux.css","crm-list-view-new.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dashboardsDrillDown")],ResourceConstants.CRM))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){return Lyte.resolvePromises({component:store.findRecord("analytics_component",e.dynamicParam,{include_inner_details:"$..field.label,$..field.ui_type,$..field.enable_colour_code,$..field.formula",include:"component_preferences"},void 0,!0,{apiVersion:"2.2",dashboardId:this.getRouteInstance().transition.info.dynamicParams[0]}),analytics:store.findRecord("Analytics",this.getRouteInstance().transition.info.dynamicParams[0],{include_inner_details:"$..field.label,$..field.ui_type,$..field.data_type,$..field_involved.label,$..field.enable_colour_code,$..field.formula",include:"component_preferences"},void 0,!0,{apiVersion:"2.2"}),subComponentId:e.queryParams.subComponentId,criteria:e.queryParams.criteria,formula:e.queryParams.formula,hierarchy_id:e.queryParams.hierarchy_id,drill_down:e.queryParams.drill_down,sort_order:e.queryParams.sort_order,sort_by:e.queryParams.sort_by})},afterModel:function(e){(0===Object.keys(e.component).length?(this.transition.abort(),Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getMsg("crm.dashboard.empty",I18n.getMsg("crm.auditlog.component")))):(e.component=e.component[0],e.analytics=e.analytics[0]),e.drillDown=!0,e.page=1,e.per_page=100,featuresAvailable.NEXTGENUI_ENABLED)&&$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1);commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-records-view",data:e}},actions:{onError:function(e,t){var r=e.response.constructor===String?JSON.parse(e.response):e.response;r.details&&r.details.permissions&&r.details.permissions[0]&&"Crm_Implied_View_Dashboards"===r.details.permissions[0]?setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0):Lyte.registeredMixins["crm-dashboard-utils"].handleErrorsByDefault(e,void 0,!0,void 0,!0),t.abort()}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.dashboardId",{}),Lyte.Router.registerRoute("crm.tab.newDashboards.deleted",{queryParams:["tab"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-analytics-deleted.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics-deleted.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecentlyDeleted")],ResourceConstants.CRM))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=$L("crm-analytics-view")[0],t={apiVersion:"2.2",deleted:!0},r={per_page:100,page:1,sort_by:"deleted_time",sort_order:"desc",include_inner_details:"deleted_by.zuid"},s=this.getQueryParams();return store.triggerAction("Analytics","metadata",{action:"metadata",type:"GET",apiVersion:"2.2"}).then((function(i){var a,n=i.analytics_metadata,o=s&&s.tab?s.tab:n.deleted_view&&n.deleted_view.scope?n.deleted_view.scope:"Dashboard";return"Dashboard"===o?a=store.findAll("Analytics",Object.assign({},r),void 0,!0,t):(r.include_inner_details="deleted_by.zuid,analytics.sharing_permissions,analytics.created_by",a=store.findAll("analytics_component",Object.assign({},r),void 0,!0,t)),Lyte.resolvePromises({metadata:n,featureKeys:void 0===e?store.triggerAction("Analytics","feature_keys",{action:"feature_keys",type:"GET",apiVersion:"2.2"}):e.component.data.featureKeys,params_dashboard:r,params_component:r,scope:o,data:a,dashboard_count:store.triggerAction("Analytics","count",t),component_count:store.triggerAction("analytics_component","count",t)})}))},afterModel:function(e){commonUtils.showHideLoadingDiv();var t=e.metadata&&e.metadata.analytics_metadata?e.metadata.analytics_metadata:e.metadata;this.currentModel.scope=e.scope,this.currentModel.view=t.deleted_view&&t.deleted_view.view?t.deleted_view.view:"list",this.currentModel.featureKeys=void 0===e.featureKeys.feature_keys?e.featureKeys:e.featureKeys.feature_keys;var r=e.params_dashboard,s=e.params_component;if("Dashboard"===this.currentModel.scope){var i=e.data;r.page=i&&i.length>0?i.$.meta.page:1,this.currentModel.dashboards=i}else{var a=e.data;s.page=a&&a.length>0?a.$.meta.page:1,this.currentModel.components=a}this.currentModel.componentCount=e.component_count.count,this.currentModel.dashboardCount=e.dashboard_count.count,this.currentModel.params_dashboard=r,this.currentModel.params_component=s;var n=this.transition.data;(this.currentModel.isFromManageDB=!(!n||!n.isFromManageDB),featuresAvailable.NEXTGENUI_ENABLED)&&$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1)},renderTemplate:function(e){return{outlet:"#show",component:"crm-analytics-deleted",data:e}},actions:{willTransition:function(){_cruxUtils.removeCustomAlert();var e=this.component,t={deleted_view:{scope:e.getData("scope"),view:e.getData("view")},action:"metadata"};t.type=crmConstants.requestMethods.POST,t.apiVersion="2.2",store.triggerAction("Analytics","metadata",t),store.unloadAll("Analytics")},onError:function(e){"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.index.view.expand",{queryParams:["isAnalyticsTrends"],model:function(e){var t={params:{action:"showDashboard",dbId:this.parent.getDynamicParam(),ajaxLoad:!0,isload:!0,window:"new",isAnalyticsTrends:e.queryParams.isAnalyticsTrends}};return t.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",t)},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.index.view",{queryParams:["isTrendDashboard","from"],getDependencies:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion"))return networkUtils.returnDependencyFiles(["zia-component-suggestion-model.js"],ResourceConstants.CRMClient)},getResources:function(){if((featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&void 0===store.modelFor("zia_component_suggestion")){var e=networkUtils.returnDependencyFiles(["zia-component-suggestions-component.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["analytics-zia-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaComponentSuggestions")],ResourceConstants.CRM);return e.concat(t)}},beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam(),t=this.getQueryParams();if(featuresAvailable.NEXTGENUI_ENABLED){var r=document.querySelector("crm-left-menu-loader").component;r.setData("view","analytics");var s=setTimeout((function(){r.executeMethod("showLoaderBasedOnView",r)}),2e3),i=document.querySelector("crm-left-menu").component;i.methods.clearLoaderTimeout(),i.setData("loaderTimeout",s)}if(validationUtils.isValidNumber(e)){var a=this;return store.findRecord("Analytics",e,{include_inner_details:"$..field.label,$..field.ui_type,$..field.data_type,$..field_involved.label,$..field.enable_colour_code,$..field.formula",include:"component_preferences"},void 0,!0,{apiVersion:"2.2"}).then((function(e){0===Object.keys(e).length&&(t&&"auditLog"===t.from?Lyte.registeredMixins["crm-report-util"].showOrHideModel("dashboard_inaccess_modal",!0):Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getValueForFields("crm.dashboard.not.available"),void 0,void 0,!0),a.transition.abort())}),(function(e){a.errorHandling(a,e,a.transition)}))}},model:function(){var e=!1;if("crm.tab.newDashboards.index.view.expand"!==this.transition.target){var t=this.getDynamicParam(),r=store.peekRecord("Analytics",t);return r&&(e=r.trends),Lyte.resolvePromises({analytics:validationUtils.isValidNumber(t)?e?networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",{params:{dbId:t,action:"showDashboard",isAnalyticsTrends:!0,isload:!0,ajaxLoad:!0,crmcsrfparam:csrfToken}}):store.peekRecord("Analytics",t):"favorites"===t?store.findAll("analytics_component",{category:"favorite",include_inner_details:"$..field.label,$..field.ui_type,$..field.data_type,$..field_involved.label,$..field.enable_colour_code,$..field.formula"},void 0,!0,{apiVersion:"2.2"}):void 0})}},afterModel:function(e){if(e){var t="favorites"===this.getDynamicParam(),r=!1,s=this.getDynamicParam(),i=this.getQueryParams(),a=store.peekRecord("Analytics",s);a&&(r=a.trends);var n=!(!e.analytics||!e.analytics[0]||"ANALYTICS_PITCH"!==e.analytics[0].feature_type);if(e.analytics&&0!==Object.keys(e.analytics).length?e.analytics=t?{Components:e.analytics}:e.analytics instanceof Array?e.analytics[0]:e.analytics:(i&&"auditLog"===i.from?(this.transition.abort(),Lyte.registeredMixins["crm-report-util"].showOrHideModel("dashboard_inaccess_modal",!0)):t||r||(this.transition.abort(),Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getValueForFields("crm.dashboard.not.available"),void 0,void 0,!0)),e.analytics={},window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.showError",["analytic_dashboard",{key:a.id+"",errorType:"NO_ACCESS"}])),n){var o=e.analytics.dashboard_status;if((o=o?o.split("_"):o)&&"available"===o[0]){var c=[networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)],l=[networkUtils.returnDependencyFiles(["analytics-zia-pitch-v3.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)];"v4"===o[1]?(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch-v3.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)),Lyte.injectResources(c,void 0,void 0)):(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(l,void 0,void 0))}}this.currentModel.from_view=!0,this.currentModel.isDefaultFavouriteDash=t,this.currentModel.isTrendDashboard=r,this.currentModel.isPitchDashboard=n,commonUtils.showHideLoadingDiv(),CrmAnalytics.fetchActivityMigrationPossibilitesDashoardId(s),this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-dashboard-utils"].handleErrorsByDefault(this.currentModel.errorObj,void 0,!0),window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.showError",["analytic_dashboard",{key:a.id+"",errorType:"NO_ACCESS"}])),"msteams"===this.transition.info.queryParams.from&&(this.currentModel.isFromMsTeams=!0)}},renderTemplate:function(e){if(e){var t=featuresAvailable.NEXTGENUI_ENABLED?"#show":"#analyticsRightPanel";return e.isTrendDashboard?{outlet:t,html:e.analytics}:{outlet:t,component:"crm-analytics-view",data:e,reRender:!0}}},afterRender:function(e,t,r){if(e){CrmAnalytics.initChart();var s=document.querySelector("crm-analytics-container").component;if(s.setData("selected_dash",t.dynamicParam),!e.isTrendDashboard){var i=r.querySelector("#gridComponent");if(i){i.scrollTop=0,i.reRender();var a=i.getBoundingClientRect().top;a=window.innerHeight-a,a-=26,i.style.height=a+"px"}(featuresAvailable.COMPONENT_SUGGESTION||featuresAvailable.COMPONENT_SUGGESTION_EARLY_ACCESS)&&Lyte.registeredMixins["crm-analytics-utils"].loadAnomalySuggestionInZiaNotification(!0)}var n=this.getDynamicParam(),o={scope:s.getData("scope"),dashboardId:validationUtils.isValidNumber(n)?n:"0"};t=Object.assign({},o);o.action="metadata",o.type=crmConstants.requestMethods.PUT,o.apiVersion="2.2",store.triggerAction("Analytics","metadata",o),window.hasOwnProperty("CrmPlusImpl")&&CrmPlusImpl.trigger("serviceView.afterLoad",["analytic_dashboard",{key:n+""}]),featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader()}},actions:{willTransition:function(){_cruxUtils.removeCustomAlert();var e=this.transition.info.dynamicParams[0],t=store.peekRecord("Analytics",e),r=t?t.Components:void 0;r&&r.forEach((function(e){void 0===e.compFltrOptionSaved||e.compFltrOptionSaved||store.unloadRecord("analytics_cache",e.id)})),Lyte.registeredMixins["crm-dashboard-utils"].showOrHideModel("crm-analytics-add-component-alert",!1)},onError:function(e,t){this.errorHandling(this,e,t)}},errorHandling:function(e,t,r){if(400===t.status||555===t.status&&t.responseText&&"Dashboard Not Available"===t.responseText)Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getValueForFields("crm.dashboard.not.available"),void 0,void 0,!0);else{var s;t.response&&t.response.length>0&&(s=t.response.constructor===String?JSON.parse(t.response):t.response);var i=Lyte.registeredMixins["crm-report-util"];s.Analytics&&s.Analytics[0]&&"INVALID_DATA"===s.Analytics[0].code?(r.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:t.readyState,response:t.response,responseText:t.responseText,responseURL:t.responseURL,status:t.status})):"NO_PERMISSION"===s.code?(s.details&&s.details.permissions[0]&&"Crm_Implied_View_Dashboards"===s.details.permissions[0]?setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0):Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getMsg("crm.label.insufficient.privileges"),I18n.getMsg("crm.label.creator.noPermission"),void 0,!0),e.transition&&e.transition.abort()):(r.abort(),i.replaceRouteWithCurrentInstance(),Lyte.registeredMixins["crm-dashboard-utils"].handleErrorsByDefault(t,void 0,!0)),featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader()}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.index",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-analytics-view-page.js","lyte-tree.js","crm-new-report-popup.js","voc-setup-store.js"],ResourceConstants.CRMClient)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.resolvePromises({metadata:store.triggerAction("Analytics","metadata",{action:"metadata",type:"GET",apiVersion:"2.2"}),featureKeys:store.triggerAction("Analytics","feature_keys",{action:"feature_keys",type:"GET",apiVersion:"2.2"}),chats_settings:networkUtils.lyteInitiateRequest("/crm/v2/settings/chats","GET",{skip_load_tab:!0})})},afterModel:function(e){"msteams"===this.transition.info.queryParams.from&&(this.currentModel.isFromMsTeams=!0),e&&e.analytics&&e.analytics.$&&(this.currentModel.more_records=e.analytics.$.meta.more_records,this.currentModel.page=Number(e.analytics.$.meta.page));var t=e.metadata&&e.metadata.analytics_metadata?e.metadata.analytics_metadata:e.metadata;this.currentModel.featureKeys=e.featureKeys.feature_keys;var r={};r.category=t.scope,this.currentModel.params=r,0===Object.keys(t).length?this.currentModel.analyticsTour=!0:this.currentModel.analyticsTour=!1,t.scope||t.recently_accessed_dashboard?(this.currentModel.scope=t.scope,t.recently_accessed_dashboard&&(this.currentModel.selected_dash=null===t.recently_accessed_dashboard.id?"favorites":t.recently_accessed_dashboard.id,this.currentModel.trends=t.recently_accessed_dashboard.trends),"favorites"!==t.scope||t.recently_accessed_dashboard||(this.currentModel.selected_dash="favorites")):this.currentModel.scope="everything";var s={};if(e.chats_settings&&e.chats_settings.chats){for(var i=e.chats_settings.chats,a=i.length,n=0;n<a;n++)if(i[n].active)switch(i[n].type){case"cliq":s.cliq_enabled=!0;break;case"cisco":s.cisco_enabled=!0;break;case"google_chat":s.google_chat_enabled=!0;break;case"slack":s.slack_enabled=!0;break;case"microsoft_teams":s.microsoft_teams_enabled=!0}delete e.chats_settings}if(this.currentModel.sharing_props=s,this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-dashboard-utils"].handleErrorsByDefault(this.currentModel.errorObj,void 0,!0)),store.findAll("zia_notification_common_config",{type:"anomaly"}),featuresAvailable.NEXTGENUI_ENABLED){var o=document.querySelector("crm-left-menu").component;o.actions.showOrHideLeftPane(!0),o.methods.showOrHideLeftMenuLoader(!1)}},renderTemplate:function(e){return $L(".ts-lftmnu-modules").empty(),{outlet:featuresAvailable.NEXTGENUI_ENABLED?".ts-lftmnu-modules":"#show",component:"crm-analytics-container",data:e}},redirect:function(e){if("crm.tab.newDashboards.index"===Lyte.Router.getRouteInstance().transition.info.route&&e.selected_dash){var t=!0;this.transition.data&&void 0!==this.transition.data.redirect&&!1===this.transition.data.redirect&&(t=!1);var r=e.selected_dash+"";if(t)this.replaceWith({route:"crm.tab.newDashboards.index.view",dynamicParams:[r]}).data={redirect:!1}}},didDestroy:function(){if(featuresAvailable.NEXTGENUI_ENABLED){var e=app.nextTransition?app.nextTransition.info.route:null;if(e&&e.startsWith("crm.tab.newDashboards"))$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1)}},actions:{onError:function(e){this.errorHandling(e,this)}},errorHandling:function(e,t){var r;(e.response.length>0&&(r=e.response.constructor===String?JSON.parse(e.response):e.response),r&&"NO_PERMISSION"===r.code)?r.details&&r.details.permissions&&r.details.permissions[0]&&"Crm_Implied_View_Dashboards"===r.details.permissions[0]?(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),t.transition&&t.transition.abort()):t.replaceWith({route:"crm.tab.newDashboards.index.view",dynamicParams:["skipDashboard"]}).data={redirect:!1}:r&&"NOT_SUPPORTED_FEATURE"===r.code?(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),t.transition&&t.transition.abort()):555===e.status&&"Dashboard Not Available"===e.responseText||400===e.status?(t.transition&&t.transition.abort(),Lyte.registeredMixins["crm-dashboard-utils"].showAlert(I18n.getValueForFields("crm.dashboard.not.available"),void 0,void 0,!0)):renderingUtils.displayPermissionDenied();if(window.hasOwnProperty("CrmPlusImpl")){var s=t.transition.info.dynamicParams[0];CrmPlusImpl.trigger("serviceView.showError",["analytic_dashboard",{key:s+"",errorType:"NO_ACCESS"}])}}}),Lyte.Router.registerRoute("crm.tab.newDashboards.manage-dashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-manage-dashboards.js","crm-sort-popup.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["analytics-manage-dashboards.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=$L("crm-analytics-view")[0];return Lyte.resolvePromises({metadata:store.triggerAction("Analytics","metadata",{action:"metadata",type:"GET",apiVersion:"2.2"}),featureKeys:void 0===e?store.triggerAction("Analytics","feature_keys",{action:"feature_keys",type:"GET",apiVersion:"2.2"}):e.component.data.featureKeys})},afterModel:function(e){commonUtils.showHideLoadingDiv(),Crm.client_tracking("AD - Manage Dashboard");var t=e.metadata&&e.metadata.analytics_metadata?e.metadata.analytics_metadata:e.metadata,r=t.manage_view&&t.manage_view.scope?t.manage_view.scope:"everything",s={};(s.category=r,this.currentModel.params=s,this.currentModel.scope=r,this.currentModel.view=t.manage_view&&t.manage_view.view?t.manage_view.view:"list",this.currentModel.featureKeys=void 0===e.featureKeys.feature_keys?e.featureKeys:e.featureKeys.feature_keys,featuresAvailable.NEXTGENUI_ENABLED)&&$L("crm-left-menu")[0].component.actions.showOrHideLeftPane(!1)},renderTemplate:function(e){return{outlet:"#show",component:"crm-manage-dashboards",data:e}},actions:{onError:function(e){"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}}),Lyte.Router.registerRoute("crm.tab.newDashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crux-combo-box.js","crux-criteria-component.js","crux-criteria-conditions.js","crm-analytics-new.js","crm-analytics-chart.js","crm-analytical-component-model.js","crm-analytics-basic-components.js","crux-form-component.js","lyte-code-snippet.js","lyte-dateselect.js","lyte-daterangepicker.js","crm-ui-loaders.js","gamescope-grid.js","model-crm-report.js","crm-report-error.js","crm-report-util.js","crm-lyte-slider.js","crm-territory-common-utils.js","crm-analytics-chart-table.js","crux-column-list.js","crm-report-category.js","crm-report-helpers.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM)),-1===["P","R","S","X","Y"].indexOf(Crm.userDetails.LICENSE_TYPE)&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics-components.js","lyte-multislider.js","lyte-progressbar.js"],ResourceConstants.CRMClient))),e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css","crm-analytics-strategy.css","lyte-ui-code-snippet.css","crm-report-edit-page.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-dashboards.css","analytics-creation.css","analytics-zia-pitch.css","lyte-ui-code-snippet.css","crm-ui-loaders.css","crm-analytics-component-filter.css","crm-report-popup.css","crux-column-list.css","crm-report-category.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-analytics-anomaly-table.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient)),RebrandLinkUtil.getProperty("ZohoReports").toUpperCase()==="true".toUpperCase()&&Crm.userDetails.IS_ADMIN&&featuresAvailable.Zoho_Reports_Intergration&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zanalytics-promotion-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zanalytics-promotion-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZAnalytics_promotion_popup")],ResourceConstants.CRM))),e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dashboard")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["Analytics.js","child_relationship_model.js"],ResourceConstants.CRMClient)},beforeModel:function(){featuresAvailable.NEXTGENUI_ENABLED&&(document.querySelector("crm-left-menu").component.setData("selectedMenu","dashboards"),document.querySelector("crm-left-menu-loader").component.setData("view","analytics"));commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return cruxAssets&&Crm.userDetails.multiSelectFilterOptions&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!0,cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist="picklist"),{outlet:"#show",html:'<div id="sample"><div>'}},beforeExit:function(){store.unloadAll("Analytics"),store.unloadAll("analytics_component"),store.unloadAll("analytics_cache"),store.unloadAll("child_relationship"),store.unloadAll("zia_component_suggestion"),cruxAssets&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!1,delete cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist)},redirect:function(){var e=this.transition.data;if(e&&e.reloadAll){["crm.tab.newDashboards.index.view"].contains(this.transition.target)&&(delete e.reloadAll,e.refreshTemplate=!0,this.refresh({refreshTemplate:!0}).data=e)}},didDestroy:function(){if(-1===Lyte.Router.getRouteInstance().transition.info.route.indexOf("newDashboards")){-1!==Lyte.Router.getRouteInstance().transition.info.route.indexOf("newReports")?Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css","analytics-dashboards.css","analytics-manage-dashboards.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)):Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css","analytics-dashboards.css","analytics-manage-dashboards.css","analytics-creation.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var e=$("#show");thirdPartyUtils.unbindHighcharts(e),thirdPartyUtils.unbindZohoCharts(e)}},actions:{didTransition:function(){var e=Crm.userDetails.MODULE_LIST.Dashboards,t=e&&e.modified_by?e.plural_label:I18n.getMsg("Dashboards");this.setTitle(I18n.getMsg("crm.title.general.revamped",[t,Crm.partnerName]))}}}),Lyte.Router.registerRoute("crm.tab.newForecasts.bread-crum",{queryParams:["id","type","user_id","role_id","hierarchy_id","territory_id","filters","period","period_type","start_period","end_period"],forceFetch:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-list.js","crm-forecast-search.js","crm-forecast-create-popup.js","crm-forecast-deals-modal.js","crm-macro.js","macro-model.js","crm-forecast-progress.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-list.css","crm-forecast-create.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css","crm-forecast-progress.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-macro.css"],ResourceConstants.CRMClient))},beforeModel:function(e){var t={},r=this,s={};t.filters=e.queryParams.filters?JSON.parse(e.queryParams.filters):e.queryParams.filters,e.queryParams.id&&(s={comparator:"equal",field:{api_name:"Group_Id"},value:e.queryParams.id},t.filters=this.construct_group(t.filters,s,"AND"));var i=e.queryParams.start_period,a=e.queryParams.end_period;s={},(i||a)&&(s=this.getCriteriaBetweenYear(i,a,!1,"Period_Name")),s=this.construct_group(s,{field:{api_name:"Period_Name.Type"},comparator:"equal",value:e.queryParams.period_type},"AND"),s=this.construct_group(s,{field:{api_name:"Is_Archived"},comparator:"equal",value:!1},"AND"),t.filters=this.construct_group(t.filters,s,"AND"),t.filters=JSON.stringify(t.filters),store.unloadAll("Forecast"),store.unloadAll("forecast_data");var n={};return n.fcGroup=app.store.makeRequest("findRecord","forecast_group",e.queryParams.id),n.forecast=app.store.makeRequest("findAll","Forecast",t),n.fiscalPeriod=store.findAll("fiscal_period",{},!0),e.queryParams.user_id&&(n.user=app.store.makeRequest("findRecord","user",e.queryParams.user_id)),Lyte.resolvePromises(n).then((function(e){r.transition.data.forecasts=e.forecast}),(function(e){if("INVALID_DATA"===(e=JSON.parse(e.response)).data[0].code){var t=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(t)[1];r.replaceWith("crm.crm-error",s).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")},r.transition.abort()}}))},model:function(e){var t=this,r=!0,s=store.peekAll("forecast_configuration")[0];store.unloadAll("forecast_data"),e.queryParams.user_id&&(r=!1);var i=this.getCriteriaBasedOnHierarchy(s.hierarchy,e.queryParams),a={};if(this.transition.data.associatedTerritories&&!i.searchValue.associatedTerritories&&(i.searchValue.associatedTerritories=this.transition.data.associatedTerritories),t.transition.data.forecasts&&t.transition.data.forecasts.length){var n={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.getDataFromArray(t.transition.data.forecasts,"id")};i.criteria=this.construct_group(i.criteria,n,"AND"),i.criteria=JSON.stringify(i.criteria),this.predictionCriteria.field.api_name="Forecast_Quota."+this.predictionCriteria.field.api_name;var o=this.predictionCriteria;delete this.predictionCriteria,this.getPredictionData(this.construct_group(n,o,"AND")),a.forecast_data=app.store.makeRequest("findAll","forecast_data",{filters:i.criteria},!0)}var c={comparator:"equal",field:{api_name:"Type"},value:e.queryParams.period_type};if(this.currentYear=this.getPeriodMonthQuarter(),"MONTH"===e.queryParams.period_type)var l=this.currentYear.startdate,d=this.currentYear.enddate,u=this.getCriteriaBetweenYear(l,d,!1,"");else u=this.getCriteriaBetweenYear(this.currentYear.startdate,this.currentYear.enddate,!1,"");return c=this.construct_group(u,c,"AND"),a.period=app.store.makeRequest("findAll","fiscal_period",{filters:JSON.stringify(c)},!0),a.forecast_category=store.findAll("forecast_category"),Lyte.resolvePromises(a).then((function(a){var n={filters:e.queryParams.filters,baseForecast:store.peekRecord("forecast_group",e.queryParams.id),forecasts:t.transition.data.forecasts,forecastConfiguration:s,isAccordian:r,periodCriteria:a.period,selectedSearchvalue:i.searchValue};return a.period.$.meta.more_records?t.getFiscalPeriodRecursively(n,c):n}),(function(e){"NO_PERMISSION"===(e=JSON.parse(e.response)).code&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()),this.transition.abort()}))},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-crum-component",reRender:!0}},afterModel:function(e){this.constructForecastData(e.forecasts);var t,r,s=Lyte.Router.getRouteInstance().getQueryParams();s.start_period&&s.end_period?(e.selectedPeriod={start_period:s.start_period,end_period:s.end_period,type:s.period_type,period:s.period},e.periodCriteria1=e.periodCriteria.filter((function(e){return e.End_Date>=s.start_period}))):(e.baseForecast.Forecast.forEach((function(e,s){0===s?(t=e.Period_Name.Start_Date,r=e.Period_Name.End_Date):(t=t>e.Period_Name.Start_Date?e.Period_Name.Start_Date:t,r=r<e.Period_Name.End_Date?e.Period_Name.End_Date:r)})),e.periodCriteria1=e.periodCriteria.filter((function(e){return e.End_Date>=t})),e.selectedPeriod={start_period:t,end_period:r,type:s.period_type,period:s.period})},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.clone",{queryParams:["Fiscal_Period"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-create.css","crm-forecast-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},actions:{onError:function(e,t){t.resume()}},beforeModel:function(e){var t=e.queryParams;if(!e.queryParams.Fiscal_Period)return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.errorpage.note1"),ltPropType:"error"}}),void this.replaceWith("crm.tab.newForecasts.index");var r=store.peekRecord("user",Crm.userDetails.USER_ID);this.admin_user=this.checkisAdminUser(r);var s={field:{api_name:"id"},comparator:"equal",value:JSON.parse(t.Fiscal_Period).id},i=this;this.base_forecast_rec=this.getPreviousForecast([store.peekRecord("Forecast",this.getDynamicParam())]);var a={prediction_status:app.store.makeRequest("triggerAction","Forecast","prediction_status",{forecast_id:this.base_forecast_rec.id}),currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(s)}),response_obj:i.fetchHierarchyInfo()};return Lyte.resolvePromises(a).then((function(e){i.currentPeriodInfo=e.currentPeriodInfo[0],i.response_obj=e.response_obj,e.prediction_status.prediction_status.length&&(i.prediction_status=e.prediction_status.prediction_status[0].status)}))},model:function(e){if("Denied"!==this.redirectToForecast()){var t,r=this;t=store.createRecord("Forecast",{Forecast_Group:this.base_forecast_rec.Forecast_Group,Period_Name:JSON.parse(e.queryParams.Fiscal_Period)});var s=this.getForecastBasedOnPreviousYear(t.Forecast_Group.Forecast,this.getPreviousYearSet(this.currentPeriodInfo.Start_Date,2));store.unloadAll("forecast_data"),store.unloadAll("predicted_data");for(var i,a={field:{api_name:"Closing_Date"},comparator:"between",value:[r.currentPeriodInfo.Start_Date,r.currentPeriodInfo.End_Date]},n=store.peekAll("forecast_configuration")[0].hierarchy.api_name,o=r.response_obj.IdData.hierarchyIds,c=store.peekAll("forecast_configuration")[0].forecast_types,l=c.length,d=t.Forecast_Group.Forecast_Type.id,u=0;u<l;u++)c[u].id===d&&(i=c[u].field);var m,p={aggregated_field:{api_name:i.api_name,id:i.id},deal_criteria:a};"Territory"===n&&(p.territory_ids=o);var h,f=s.length,g=(m=f>0?s:this.base_forecast_lists).length,y={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:m[g-(f>=0?1:2)].id}};(f>1||g>2)&&(h={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:m[g-(f>=1?2:3)].id}});var v=this.base_forecast_rec&&this.base_forecast_rec.id?JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.base_forecast_rec.id}):void 0;return Lyte.resolvePromises({record:t,previousForecastData1:app.store.makeRequest("findAll","forecast_data",y),previousForecastData2:h?app.store.makeRequest("findAll","forecast_data",h):void 0,base_forecast_data:v?app.store.makeRequest("findAll","forecast_data",{filters:v},!0):void 0,base_predicted_data:v?app.store.makeRequest("findAll","predicted_data",{filters:v},!0):void 0,response_obj:r.response_obj,dealStatusCriteria:p})}this.transition.abort()},afterModel:function(e){var t=this,r=store.peekAll("forecast_configuration")[0];e.hierarchy=r.hierarchy.api_name,e.is_admin=this.admin_user,e.hierarchyObj=r.hierarchy,e.showCriteriaEdit=this.showCriteriaEdit,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.base_forecast_fiscal=this.base_forecast_lists,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.previousForecasts=[];var s=[];e.previousForecastData1&&(e.previousForecastData1.length>0&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency),s.push(t.getSumForecastDataMap(e.previousForecastData1,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(s.push(t.getSumForecastDataMap(e.previousForecastData2,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.base_predicted_data&&(e.predictedDataMap=t.getPredictedDataMap(e.base_predicted_data,r.hierarchy.api_name)),e.dealStatusData=new Map,e.previousForecastsMap=s,"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.response_obj.non_reporting_users.forEach((function(t){"deleted"!==t.status&&e.non_reporting_users.push(t)}))),e.hierarchy_data=e.response_obj.hierarchy;var i=e.hierarchy_data[0].children;return e.hierarchy_data[0]._children=i,"Territory"===e.hierarchyObj.api_name?e.hierarchy_data[0].$.triggerAction("associated_users",{version:"v2.1"}).then((t=>{t&&t.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2);var r=[],s=store.peekRecord("user",Crm.userDetails.USER_ID);if(s&&s.territories&&s.territories.length>0)for(var i of s.territories)if(i.id!==e.hierarchy_data[0].id)return r.push(i.$.triggerAction("associated_users",{version:"v2.1"}).then((e=>{var t=i.children;t.length>50?(i._children=t.slice(0,50),i.moreChildren=!0):i._children=t,e&&e.meta.more_records&&(i.more_users=!0,i.page=2)}))),Lyte.resolvePromises(r)})):"Roles"===e.hierarchyObj.api_name?store.findAll("user",{filters:[{comparator:"equal",field:"role.name",value:e.hierarchy_data[0].name}]}).then((t=>{t.$&&t.$.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2)})):(e.isContinue=!0,void(e.isCloned=!0))},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.create",{queryParams:["Forecast_Name","Fiscal_Period","group_id","criteria","Forecast_Type","status"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js","crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(e){var t=store.peekAll("forecast_configuration");if((t?t.length:0)<=0)return renderingUtils.displayPermissionDenied(),void this.transition.abort();var r=e.queryParams;if(!(r.Fiscal_Period&&r.group_id||r.Fiscal_Period&&r.Forecast_Name&&r.Forecast_Type))return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.errorpage.note1"),ltPropType:"error"}}),void this.replaceWith("crm.tab.newForecasts.index");var s=r.group_id,i=store.peekRecord("user",Crm.userDetails.USER_ID);this.admin_user=this.checkisAdminUser(i);var a={field:{api_name:"id"},comparator:"equal",value:JSON.parse(r.Fiscal_Period).id},n=this;if(s){var o=store.peekRecord("forecast_group",s);this.base_forecast_rec=this.getPreviousForecast(o.Forecast,store.peekRecord("fiscal_period",JSON.parse(r.Fiscal_Period).id));var c={prediction_status:this.base_forecast_rec?app.store.makeRequest("triggerAction","Forecast","prediction_status",{forecast_id:this.base_forecast_rec.id}):void 0,currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(a)}),response_obj:n.fetchHierarchyInfo()};return Lyte.resolvePromises(c).then((function(e){n.currentPeriodInfo=e.currentPeriodInfo[0],n.response_obj=e.response_obj,e.prediction_status&&e.prediction_status.prediction_status.length&&(n.prediction_status=e.prediction_status.prediction_status[0].status)}))}c={currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(a)}),response_obj:n.fetchHierarchyInfo()};return Lyte.resolvePromises(c).then((function(e){n.currentPeriodInfo=e.currentPeriodInfo[0],n.response_obj=e.response_obj}))},model:function(e){if("Denied"!==this.redirectToForecast()){var t,r,s,i=e.queryParams,a=this,n=e.queryParams.group_id;n&&(r=store.peekRecord("forecast_group",n),s=a.getForecastBasedOnPreviousYear(r.Forecast,a.getPreviousYearSet(a.currentPeriodInfo.Start_Date,2)),t=store.createRecord("Forecast",{Forecast_Group:r,Period_Name:JSON.parse(i.Fiscal_Period)})),t||(r=store.createRecord("forecast_group",{Forecast_Group_Name:i.Forecast_Name,Forecast_Type:JSON.parse(i.Forecast_Type)}),t=store.createRecord("Forecast",{Period_Name:JSON.parse(i.Fiscal_Period),Forecast_Group:r}),this.showCriteriaEdit=!0),i.criteria&&r.$.set("criteria",JSON.parse(i.criteria)),store.unloadAll("forecast_data"),store.unloadAll("predicted_data");for(var o,c={field:{api_name:"Closing_Date"},comparator:"between",value:[a.currentPeriodInfo.Start_Date,a.currentPeriodInfo.End_Date]},l=store.peekAll("forecast_configuration")[0].hierarchy.api_name,d=a.response_obj.IdData.hierarchyIds,u=store.peekAll("forecast_configuration")[0].forecast_types,m=u.length,p=t.Forecast_Group.Forecast_Type.id,h=0;h<m;h++)u[h].id===p&&(o=u[h].field);var f={aggregated_field:{api_name:o.api_name,id:o.id},deal_criteria:c};if("Territory"===l&&(f.territory_ids=d),n){var g,y,v=s.length,_=(g=v>0?s:this.base_forecast_lists).length,C={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:g[_-(v>0?1:2)].id}};(v>1||_>2)&&(y={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:g[_-(v>1?2:3)].id}});var R=this.base_forecast_rec&&this.base_forecast_rec.id?JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.base_forecast_rec.id}):void 0;return Lyte.resolvePromises({record:t,previousForecastData1:app.store.makeRequest("findAll","forecast_data",C),previousForecastData2:y?app.store.makeRequest("findAll","forecast_data",y):void 0,base_forecast_data:R?app.store.makeRequest("findAll","forecast_data",{filters:R},!0):void 0,base_predicted_data:R?app.store.makeRequest("findAll","predicted_data",{filters:R},!0):void 0,response_obj:a.response_obj,dealStatusCriteria:f,isContinue:!0,existingForecast:store.findAll("forecast_group",{filters:'{ "group_operator":"and","group":[ { "comparator": "not_equal", "field": { "api_name": "id" }, "value":"${EMPTY}"} ] }'})})}return Lyte.resolvePromises({record:t,response_obj:a.response_obj,dealStatusCriteria:f,isContinue:!1,existingForecast:store.findAll("forecast_group",{filters:'{ "group_operator":"and","group":[ { "comparator": "not_equal", "field": { "api_name": "id" }, "value":"${EMPTY}"} ] }'})})}this.transition.abort()},afterModel:function(e,t){var r=this,s=store.peekAll("forecast_configuration")[0],i=this.getAllForecastCategoriesExceptOmitted();if(e.hierarchy=s.hierarchy.api_name,e.is_admin=this.admin_user,e.hierarchyObj=s.hierarchy,e.showCriteriaEdit=this.showCriteriaEdit,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.base_forecast_fiscal=this.base_forecast_lists,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.fc_category_count=Object.keys(i).length,e.existingForecast&&e.existingForecast.length){for(var a=e.existingForecast.length,n=0,o=0;o<a;o++)e.existingForecast[o].Is_Group_Archived||n++;e.noOfForecast=n}else e.noOfForecast=0;e.previousForecasts=[];var c=[];e.previousForecastData1&&e.previousForecastData1.length&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency,c.push(r.getSumForecastDataMap(e.previousForecastData1,s.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(c.push(r.getSumForecastDataMap(e.previousForecastData2,s.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.base_predicted_data&&(e.predictedDataMap=r.getPredictedDataMap(e.base_predicted_data,s.hierarchy.api_name,"create")),e.dealStatusData=new Map,e.previousForecastsMap=c,"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.response_obj.non_reporting_users.forEach((function(t){"deleted"!==t.status&&e.non_reporting_users.push(t)}))),e.hierarchy_data=e.response_obj.hierarchy;var l=e.hierarchy_data[0].children;e.hierarchy_data[0]._children=l,t.queryParams.group_id&&(e.quickset_targets=this.getQuickTarget(t.queryParams.status,e.previousForecastData1&&e.previousForecastData1.length));var d=this,u=!1;if("Territory"===e.hierarchyObj.api_name)return e.hierarchy_data[0].$.triggerAction("associated_users",{version:"v2.1"}).then((t=>{t&&t.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2);var r=Crm.userDetails.USER_ID,s=[],i=store.peekRecord("user",r);if(i&&i.territories&&i.territories.length>0)for(var a of i.territories)if(a.id!==e.hierarchy_data[0].id)return s.push(a.$.triggerAction("associated_users",{version:"v2.1"}).then((e=>{var t=a.children;t&&t.length>50?(a._children=t.slice(0,50),a.moreChildren=!0):a._children=t,e&&e.meta.more_records&&(a.more_users=!0,a.page=2)}))),u=!0,Lyte.resolvePromises(s).then((()=>{e.hierarchy_data.forEach(function(e){this.recursiveSetChildrenData(e)}.bind(this))}));u||e.hierarchy_data.forEach((function(e){d.recursiveSetChildrenData(e)}))}));if("Roles"===e.hierarchyObj.api_name){var m=store.peekRecord("user",Crm.userDetails.USER_ID).role,p={firstRole:store.findAll("user",{type:"ActiveUsers",filters:[{comparator:"equal",field:"role.name",value:e.hierarchy_data[0].name}]}).then((t=>{t.$&&t.$.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2)}))};if(e.hierarchy_data[0].name!=m.name){var h=m.children;h&&h.length>50?m._children=h.slice(0,50):m._children=h,p.currentRole=store.findAll("user",{filters:[{comparator:"equal",field:"role.name",value:m.name}]}).then((e=>{e.$&&e.$.meta.more_records&&(m.more_users=!0,m.page=2)}))}return Lyte.resolvePromises(p)}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},actions:{onError:function(e){return this.handleError(e),commonUtils.showHideLoadingDiv(!1),!1}},recursiveSetChildrenData:function(e){var t=e.children;if(e.users&&e.users.length&&t&&t.length&&Lyte.Component.set(e,"_children",t),t)for(var r=e._children?e._children.length:0,s=0;s<r;s++)this.recursiveSetChildrenData(e._children[s])},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){var e=store.peekAll("forecast_configuration");return(e?e.length:0)<=0?(renderingUtils.displayPermissionDenied(),void this.transition.abort()):(this.target_id=this.getDynamicParam(),"Denied"!==this.redirectToForecast()?this.fetchParentItemInfo(this.target_id):void this.transition.abort())},model:function(){var e=store.peekRecord("Forecast",this.getDynamicParam());"completed"===e.status&&this.errorPageRedirection(I18n.getMsg("crm.forecast.completed.configuration.cant.updated.new")),this.base_forecast_rec=this.getPreviousForecast(e.Forecast_Group.Forecast,e.Period_Name);var t,r=this.getParentItemIds(this.parent_data[0]),s=e&&e.id?JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:e.id}):void 0,i=crmConstants.forecastHierarchyObj[this.forecast_config.hierarchy.api_name];if("Reporting_To"===i&&this.is_admin&&this.non_reporting_data.length){var a=this.getParentItemIds(this.non_reporting_data[0]);t=this.fetchForecastData(a,"users",i,this.target_id,void 0,void 0,!0,void 0,!0)}return"completed"!==e.status&&this.fetchUsersCount(i,e),Lyte.resolvePromises({forecast_data_children:this.fetchForecastData(r,"children",i,this.target_id),forecast_data_user:this.fetchForecastData(r,"users",i,this.target_id),fetch_non_reporting:t,record:e,predicted_data:s?app.store.makeRequest("findAll","predicted_data",{filters:s},!0):void 0,fiscal_period:store.findRecord("fiscal_period",e.Period_Name.id)}).then(function(e){var t,r,s=this.getForecastBasedOnPreviousYear(e.record.Forecast_Group.Forecast,this.getPreviousYearSet(e.fiscal_period[0].Start_Date,2)),i=s.length,a=(t=i>0?s:this.base_forecast_lists).length,n={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:t[a-(i>=0?1:2)].id}};(i>1||a>2)&&(r={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:t[a-(i>1?2:3)].id}});var o=Object.assign({previousForecastData1:app.store.makeRequest("findAll","forecast_data",n),previousForecastData2:r?app.store.makeRequest("findAll","forecast_data",r):void 0},e);return Lyte.resolvePromises(o)}.bind(this))},afterModel:function(e){e.hierarchy=this.forecast_config.hierarchy.api_name,e.base_forecast_fiscal=this.base_forecast_lists,e.hierarchyObj=this.forecast_config.hierarchy,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0;var t=this.parent_data[0];this.setPredictedInfo(t,this.fc_type),e.hierarchy_data=this.company_fc_data?[this.company_fc_data[0]]:this.hierarchy_data_info,e.is_admin=this.is_admin,this.is_admin&&"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=e.fetch_non_reporting.non_reporting_users,e.non_reporting_user_config=e.fetch_non_reporting.non_reporting_user_config),e.from_page="edit";var r=store.peekAll("forecast_configuration")[0];e.previousForecasts=[];var s=[];e.previousForecastData1&&(e.previousForecastData1.length>0&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency),s.push(this.getSumForecastDataMap(e.previousForecastData1,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(s.push(this.getSumForecastDataMap(e.previousForecastData2,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.predicted_data&&(e.predictedDataMap=this.getPredictedDataMap(e.predicted_data,r.hierarchy.api_name)),e.previousForecastsMap=s;for(var i,a=r.forecast_types,n=a.length,o=e.record.Forecast_Group.Forecast_Type.id,c=this.parent.currentModel.hierarchyIds,l=0;l<n;l++)a[l].id===o&&(i=a[l].field);var d={aggregated_field:{api_name:i.api_name,id:i.id},deal_criteria:{field:{api_name:"Closing_Date"},comparator:"between",value:[e.fiscal_period[0].Start_Date,e.fiscal_period[0].End_Date]}};"Territory"===store.peekAll("forecast_configuration")[0].hierarchy.api_name&&(d.territory_ids=c),e.dealStatusCriteria=d,e.dealStatusData=new Map;var u=e.hierarchy_data[0].children;if(e.hierarchy_data[0]._children=u,"Reporting_To"==e.hierarchyObj.api_name){var m=u&&u.length;for(l=0;l<m;l++)e.hierarchy_data[0]._children[l]._children=u[l].children}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},lyteConvertionSupported:!0,actions:{onError:function(e,t){e&&e.status&&400===e.status&&e.response&&("The given forecast_id seems to be invalid"===JSON.parse(e.response).message&&this.errorPageRedirection(I18n.getMsg("crm.forecast.not.available")));t.resume()}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.index",{getResources:function(){return[networkUtils.returnDependencyFiles(["crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-forecast-popup.css","crm-forecast-create.css","crm-forecast-common.css","crm-forecast-hierarchy-pop.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)]},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={getforecastconfig:store.findAll("forecast_configuration"),fiscalPeriod:store.findAll("fiscal_period",{},!0)};return Lyte.resolvePromises(e)},afterModel:function(e){this.currentModel={},this.currentModel.getforecastconfig=e.getforecastconfig,Crm.userDetails.IS_ADMIN?this.currentModel.isAdminUser=!0:this.currentModel.isAdminUser=!1,commonUtils.showHideLoadingDiv()},renderTemplate:function(e){if(e.getforecastconfig&&e.getforecastconfig.id)Lyte.Router.transitionTo("crm.tab.newForecasts.list",null,{});else if(e.getforecastconfig){return{outlet:"#show",component:"crm-forecast-initial-page"}}}}),Lyte.Router.registerRoute("crm.tab.newForecasts.list",{queryParams:["id","type","forecast_id","user_id","role_id","filters","status","territory_id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-list.js","crm-forecast-search.js","crm-forecast-create-popup.js","crm-forecast-deals-modal.js","crm-macro.js","macro-model.js","crm-forecast-progress.js","crux-video.js","crux-form-component.js","crm-ui-loaders.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js","voc-setup-store.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-forecast-popup.css","crm-forecast-create.css","crm-forecast-common.css","crm-forecast-hierarchy-pop.css","crm-forecast-progress.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-forecast-list.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-macro.css","crm-forecast-onboarding.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"],ResourceConstants.CRM))},beforeModel:function(e){var t=store.peekAll("forecast_configuration");if((t?t.length:0)<=0)return renderingUtils.displayPermissionDenied(),void this.transition.abort();var r=this.transition.data;if(!r||!r.reloadAll){var s={},i={},a=this;if(e.queryParams.filters&&(s.filters=JSON.parse(e.queryParams.filters),this.parseFilterCriteria(i,s.filters)),!i.periodCriteria&&"archived"!==e.queryParams.status){var n=this.getPeriodMonthQuarter().currentfiscalyear;i.periodCriteria=this.getCriteriaByYear(n,!1,"Period_Name"),i.selectedPeriod=n,s.filters=this.construct_group(s.filters,i.periodCriteria,"AND")}var o={field:{api_name:"Is_Archived"},comparator:"equal",value:!1};if("archived"===e.queryParams.status)o.value=!0,i.isArchived=!0;else if(e.queryParams.status){var c=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),l=window.location.pathname.split(c)[1];this.replaceWith("crm.crm-error",l).data={showError:!0,isBodyText:!0,bodyText:I18n.getMsg("crm.error.page.msg2"),errorMsg:I18n.getMsg("crm.error.page.msg1")}}if(i.isArchived&&(1!==Crm.userDetails.TMENABLED||!this.isReportingToHasPermission())){s.filters=this.construct_group(s.filters,{field:{api_name:"Group_Id.Forecast_Hierarchy"},comparator:"not_equal",value:"Territory"},"AND")}if(i.isArchived&&(o.value=!0),s.filters=JSON.stringify(this.construct_group(s.filters,o,"AND")),this.filterObj=i,store.unloadAll("Forecast"),store.unloadAll("forecast_data"),store.unloadAll("forecast_group"),i.isArchived){var d={forecast:store.findAll("Forecast",s),dealFields:store.findAll("field",{module:"Deals",type:"all"},!1,!1,{apiVersion:"2.2"})};return Lyte.resolvePromises(d).then((function(e){a.transition.data.forecasts=e.forecast}))}d={forecast:store.findAll("Forecast",s)};return 0===store.peekAll("forecast_category").length&&(d.forecast_category=store.findAll("forecast_category")),Lyte.resolvePromises(d).then((function(e){a.transition.data.forecasts=e.forecast}))}},model:function(e){var t=this;if(!(r=this.transition.data)||!r.reloadAll){var r,s=store.peekAll("forecast_configuration")[0],i=this,a=e.queryParams;if((r=this.transition.data).searchValue){(a={})[{user:"user_id",role:"role_id",terrtory:"territory_id"}[r.searchValue.type]]=r.searchValue.id}var n={};if(i.filterObj.isArchived||(n=this.getCriteriaBasedOnHierarchy(s.hierarchy,a)),i.filterObj.isArchived||!this.transition.data.associatedTerritories||n.searchValue.associatedTerritories||(n.searchValue.associatedTerritories=this.transition.data.associatedTerritories),r.searchValue&&(n.searchValue=r.searchValue,r.searchValue.subtype&&"all"!==r.searchValue.subtype&&!i.filterObj.isArchived&&(this.filterObj.selectedTerritory=r.searchValue.subtype,n.criteria=this.construct_group(n.criteria,{field:{api_name:"Territory"},comparator:"equal",value:r.searchValue.subtype},"AND"))),n.searchValue=void 0===n.searchValue?{}:n.searchValue,i.transition.data.forecasts&&i.transition.data.forecasts.length){var o={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.getDataFromArray(i.transition.data.forecasts,"id")};i.filterObj.isArchived||(this.predictionCriteria.field.api_name="Forecast_Quota."+this.predictionCriteria.field.api_name,this.childCriteria=this.predictionCriteria,delete this.predictionCriteria);for(var c=o.value,l={},d=1,u=!0;u;)if(0!==c.length){c.length>0&&c.length<50?(o.value=c,u=!1):o.value=c.splice(0,50),i.filterObj.isArchived||(l["predicted_data"+d]=this.getPredictionData(this.construct_group(o,this.childCriteria,"AND")));var m=void 0===n.criteria?this.getAllHierarchyCriteria():n.criteria;if(i.filterObj.isArchived){m=this.construct_group(m,{field:{api_name:"Forecast_Name.Is_Archived"},comparator:"equal",value:!0},"AND")}l["fcData"+d]=app.store.makeRequest("findAll","forecast_data",{filters:JSON.stringify(this.construct_group(m,o,"AND"))}),d+=1}else u=!1;n.searchValue=void 0===n.searchValue?{}:n.searchValue,l.fiscalPeriod=store.findAll("fiscal_period",{},!0),i.filterObj.isArchived&&i.filterObj.selectedForecastGroup&&(l.forecastGroup=store.findRecord("forecast_group",i.filterObj.selectedForecastGroup));var p={};p.type=crmConstants.requestMethods.GET,p.action="metadata",l.forecastMetaData=store.triggerAction("Forecast","metadata",p);var h="Bottom_Up"===s.model.api_name,f=this.checkisAdminUser(store.peekRecord("user",Crm.userDetails.USER_ID));if(h&&!f&&!i.filterObj.isArchived){var g=s.hierarchy.api_name,y=this.checkisForecastManager(store.peekRecord("user",Crm.userDetails.USER_ID),g),v=store.peekAll("forecast_category").filterBy({api_name:"Pipeline"})[0].id;if("Reporting_To"===g&&y)var _={field:{api_name:"Reporting_To.id"},comparator:"equal",value:Crm.userDetails.USER_ID},C=this.construct_group(_,{field:{api_name:"User.id"},comparator:"equal",value:"${EMPTY}"},"AND");else C={field:{api_name:"User.id"},comparator:"equal",value:Crm.userDetails.USER_ID};var R={field:{api_name:"Forecast_Category"},comparator:"equal",value:v},b={field:{api_name:"Forecast_Name.Period_Name.Name"},comparator:"contains",value:i.filterObj.selectedPeriod},w=this.construct_group(C,R,"AND");w=this.construct_group(w,b,"AND");var M=this.construct_group({field:{api_name:"Forecast_Quota.Amount"},comparator:"equal",value:"${EMPTY}"},{field:{api_name:"Forecast_Quota.Previous_Amount__s"},comparator:"equal",value:"${EMPTY}"},"AND"),D=this.construct_group({field:{api_name:"Forecast_Quota.Quantity"},comparator:"equal",value:"${EMPTY}"},{field:{api_name:"Forecast_Quota.Previous_Quantity__s"},comparator:"equal",value:"${EMPTY}"},"AND"),P=this.construct_group(M,D,"AND");w=this.construct_group(w,P,"AND"),l.waitingTargetSubmit=store.findAll("forecast_data",{filters:w})}return Lyte.resolvePromises(l).then((function(e){var r;return r=!(e.forecastMetaData.forecast_metadata.performance_tour||!e.forecastMetaData.forecast_metadata.view_tour||!t.isPerformancePageSupported()),{forecasts:i.transition.data.forecasts,forecastConfiguration:s,isAdminUser:n.isAdminUser,selectedSearchvalue:n.searchValue,filtersCriteria:i.filterObj,isArchived:i.filterObj.isArchived,forecastGroupName:i.transition.data.forecastGroupName,selectedForecastGroup:e.forecastGroup,showPerformanceTourPopup:r,waitingTargetSubmit:e.waitingTargetSubmit}}),(function(e){var t=JSON.parse(e.response);"NO_PERMISSION"===t.code?(renderingUtils.displayPermissionDenied(),i.transition.abort()):"MANDATORY_FILTER_NOT_FOUND"!=t.code&&"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"!=t.code&&500!=e.status&&(i.transitionTo("crm.tab.newForecasts.list").data={reloadAll:!0})}))}return{forecasts:[],forecastConfiguration:s,isAdminUser:n.isAdminUser,selectedSearchvalue:n.searchValue,filtersCriteria:i.filterObj,isArchived:i.filterObj.isArchived,forecastGroupName:i.transition.data.forecastGroupName}}},afterModel:function(e){var t=this.transition.data;if(!(t&&t.reloadAll||(this.constructForecastData(e.forecasts,e.isArchived),e.navigateToGroupId=this.transition.data.gotoGroup,0===e.forecasts.length))){e.baseForecast=store.peekAll("forecast_group").slice(0);for(var r=e.baseForecast.length,s=0,i=0;i<r;i++)e.baseForecast[i-s].Forecast&&e.baseForecast[i-s].Forecast.length||(e.baseForecast.splice(i-s,1),s++);e.isAdmin="Administrator"===store.peekRecord("user",Crm.userDetails.USER_ID).profile.name,e.selectedSearchvalue.period=e.filtersCriteria.selectedPeriod,e.isArchived&&!e.filtersCriteria.selectedPeriod&&(e.selectedSearchvalue.period="allTime",e.filtersCriteria.selectedPeriod="allTime")}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-list-container",reRender:!0}},afterRender:function(){this.transition.data.initial&&this.setCreatePopValues()},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(e&&e.status&&400===e.status&&e.response){var r=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",s).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}t.resume()}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.view.performance",{queryParams:["parent_hierarchy_id","forecast_id","quota_id","quota_type","hierarchy_id","from_company","user_deleted","hierarchy_type","error_code"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-user-performance.js","crm-forecast-deals-modal.js","crm-report-dependencies.js","crm-forecast-chart.js","lyte-dateselect.js","lyte-daterangepicker.js","crm-macro.js","macro-model.js","crux-user-view.js","model-crm-report.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-forecast-user-performance.css","crm-forecast-chart.css","crm-forecast-deals-modal.css","crm-forecast-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-user-view.css","crm-macro.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"],ResourceConstants.CRM))},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.currentModel={};var t,r,s=this,i=e.queryParams,a={};a.modules=store.findAll("module"),a.forecast=i.forecast_id?store.findRecord("Forecast",i.forecast_id):void 0;var n=store.peekRecord("user",Crm.userDetails.USER_ID);if(Crm.userDetails.USER_ID===i.hierarchy_id||Crm.userDetails.IS_ADMIN_ROLE||"Administrator"===n.profile.name)s.isVisible=!0;else{this.is_admin=this.checkisAdminUser(n);var o=crmConstants.forecastHierarchyObj[i.hierarchy_type];if(s.isVisible=this.checkisFMUser(n,o),s.isVisible){var c=this.getSelQuotaDatapiName("group",i.hierarchy_type),l={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:i.forecast_id};if("group"===i.quota_type&&(r={field:{api_name:c+".id"},comparator:"equal",value:i.hierarchy_id},t=this.construct_group(l,r,"AND")),"user"===i.quota_type){var d={field:{api_name:"User.id"},comparator:"equal",value:i.hierarchy_id};t=this.construct_group(l,d,"AND")}a.permissionVisibility=store.findAll("forecast_data",{filters:t})}else s.isVisible=!1,renderingUtils.displayPermissionDenied(),s.transition.abort()}return Lyte.resolvePromises(a).then((function(e){if(s.allDealFields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,s.forecastRec=e.forecast,s.visible=!!(e.permissionVisibility&&e.permissionVisibility.length>0),void 0===e.forecast||void 0===e.forecast.length){var t=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),r=window.location.href.split(t)[1];return s.replaceWith("crm.crm-error",r).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")},!1}s.transition.data&&!s.transition.data.fromView&&(Lyte.Router.getRouteInstance().transitionTo({route:"crm.tab.newForecasts.view",dynamicParams:[i.forecast_id]}).data={fromPerformance:!0}),s.chartFieldPermission=s.checkFieldPermission(s.allDealFields,s.forecastRec)}))},actions:{onError:function(e){return 403===e.status&&renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1),!1}},model:function(e){var t,r,s,i,a,n,o,c=e.queryParams,l={};(this.fc_record=this.forecastRec[0],c.error_code)||(t=this.fc_record.Forecast_Group.Forecast_Hierarchy.api_name,r=this.fc_record.Forecast_Group.Forecast_Type.name,this.fetchCommonCriteria(c,t,this.fc_record),this.periodCriteria=this.getCurrentPeriodCriFilter(this.fc_record),l.foreCategoryTranslatedObj=this.constructForeCategoryPickListObj(this.allDealFields),l.xAxisLabels=this.constructXAxisLabelForCharts(this.allDealFields),l.isSinceLastWeekFallWithinThePeriod=this.isSinceLastWeekFallWithinThePeriod(this.fc_record),l.targetFieldObject=this.getTargetFieldObj(this.allDealFields,r),n={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:c.forecast_id},a={field:{api_name:"Forecast_Quota.id"},comparator:"equal",value:c.quota_id},o=this.construct_group(n,a,"AND"),l.sel_forecast_data=store.findAll("forecast_data",{filters:o}),l.sel_predicted_data=store.findAll("predicted_data",{filters:o}),l.analysisData=c.quota_id?store.findAll("prediction_analysis",{quota_id:c.quota_id}):void 0,l.userInfo=store.findAll("user",{filters:[{comparator:"equal",field:"id",value:c.hierarchy_id}]}),l.predictionStatus=store.findAll("prediction_status",{forecast_id:this.fc_record.id}),this.chartFieldPermission&&("current"===this.fc_record.status&&l.isSinceLastWeekFallWithinThePeriod&&(s=this.getKpiChartDataReport(r,l.foreCategoryTranslatedObj,l.targetFieldObject),l.kpiReport=store.triggerAction("report","run",{Reports:[s]})),i=this.getDealsByForeCategoryReport(r,l.targetFieldObject),l.dealsByForeCategoryReport=store.triggerAction("report","run",{Reports:[i]})));return l.userInfo=store.findAll("user",{filters:[{comparator:"equal",field:"id",value:c.hierarchy_id}]}),Lyte.resolvePromises(l)},afterModel:function(e){var t=this;t.currentModel={};var r,s,i=t.getQueryParams(),a=t.fc_record,n={},o=a.Forecast_Group.Forecast_Type.name,c=a.Forecast_Group.Forecast_Hierarchy.api_name,l=i.quota_type,d=i.user_deleted;if(r="Deal_Revenue"===o?"Amount":"Quantity",i.error_code=i.error_code?i.error_code:t.checkifTargetPresent(e.sel_forecast_data,r),i.error_code){var u=a.Period_Name.Name;t.currentModel.userNotAvailable=!0,t.currentModel.userErrorMsg=t.errorCodeMsg(i.error_code,u)}else s=t.getSelQuotaDatapiName(l,c),t.chartFieldPermission&&t.resolveDealsByForeCategoryReport(e,t.currentModel,t.allDealFields),t.getSelectedQuotaInfo(e,t.currentModel,r,s,i),t.getPredictedDataInfo(e,t.currentModel,r),t.currentModel.isSinceLastWeekFallWithinThePeriod=e.isSinceLastWeekFallWithinThePeriod,"current"===a.status&&e.isSinceLastWeekFallWithinThePeriod&&t.chartFieldPermission&&t.resolveKpiChartData(e,t.currentModel),1===e.predictionStatus.length&&(t.currentModel.lastRefreshTime=CrmDateUtils.getDateInPattern(e.predictionStatus[0].last_refresh_time,Crm.userDetails.DATE_PATTERN.toUpperCase())),t.currentModel.forecastHierType=c,t.currentModel.forecastType=o,t.currentModel.forecastCategoriesDisplayValArr=t.fetchForeCateDispValForCompAcrossPeriodChart(t.currentModel),t.currentModel.componentData=t.kpiDataConstruction(t.currentModel),t.currentModel.analysisData=e.analysisData,t.currentModel.quotaId=i.quota_id,t.currentModel.selectedUserObj=n,t.currentModel.targetCompleted=t.isTargetCompleted(t.currentModel),t.currentModel.xAxisLabels=e.xAxisLabels,t.currentModel.allDealFields=t.allDealFields,t.currentModel.foreCategoryTranslatedObj=e.foreCategoryTranslatedObj,t.currentModel.closedPicklistId=e.foreCategoryTranslatedObj.Closed_id,t.currentModel.userNotAvailable=!1,t.currentModel.isMonthlyForecast=t.isMonthlyForecast(a),t.currentModel.targetFieldObj=e.targetFieldObject,t.currentModel.commonCriteria=t.commonCriteria,t.currentModel.periodCriteria=t.periodCriteria,t.currentModel.drillDownObj=t.drillDownObj,t.currentModel.territoryFilter=t.territoryFilter,t.currentModel.module_api_name=t.module_api_name,t.currentModel.chartFieldPermission=t.chartFieldPermission,t.currentModel.performancePopupShowHide=!0;e.userInfo&&1===e.userInfo.length&&(n.id=i.hierarchy_id,n.full_name=e.userInfo[0].full_name),"user"===l&&"true"!==d&&"Reporting_To"!==c&&(t.currentModel.userCriteria=t.fetchUserListCriBasedOnParentHierarchy(c,i)),t.currentModel.selectedUserObj=n,t.currentModel.forecastRec=a,commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){var e=$("#performanceModal");thirdPartyUtils.unbindZohoCharts(e)},renderTemplate:function(){app.renderTemplate(this,{outlet:"#performancePopup",component:"crm-forecast-user-performance",reRender:!0})},getDealsByForeCategoryReport:function(e,t){var r,s=this,i=s.fetchAggregateFuncObj(t);return r=s.commonCriteria?s.construct_group(s.commonCriteria,s.periodCriteria,"AND"):s.periodCriteria,s.createReportJson("dealsByForeCategoryReport",s.module_api_name,[{api_name:"Deal_Name"}],i.show_record_count,i.aggregate_functions,[{type:"row",field:{api_name:"Forecast_Category__s"},sort_order:"asc"}],r,s.drillDownObj,s.territoryFilter,!0)},getSelectedQuotaInfo:function(e,t,r,s,i){var a=i.quota_type,n=e.sel_forecast_data,o=n.length;if(n&&o>0){for(var c=0;c<o;c++)if("Closed"===n[c].Forecast_Category.api_name)if(t.target=null===n[c].Forecast_Quota[r]?null:n[c].Forecast_Quota[r],t.formatted_currency=null===n[c].Forecast_Quota.formatted_currency?null:n[c].Forecast_Quota.formatted_currency,t.achievement=t.Closed,t.achievement_percentage=t.target&&t.achievement>0?Number((t.achievement/t.target*100).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]):0,n[c][s]){var l={},d={},u={};"user"===a?(d.id=n[c][s].id,d.full_name=n[c][s].name,null!==n[c].Territory&&(u.Territory={},u.Territory.id=n[c].Territory.id,u.Territory.name=n[c].Territory.name,t.parentRecordObj=u),t.baseForecast=!1,t.quotaType=a,l[s]=d,t.recordObj=l,t.groupName=d.full_name):(t.baseForecast=!1,t.quotaType=a,"Reporting_To"!==s||n[c].Reporting_To?(i.from_company&&(t.baseForecast=!0,l.companyName=Crm.userDetails.orgName),n[c].Parent_Item||(t.baseForecast=!0),d.id=n[c][s].id,d.name=n[c][s].name,t.groupName=d.name,l[s]=d,t.recordObj=l):repoToCompanyAndSingleCeoCase(t,n[c]))}}else{var m=i.forecast_id;Lyte.Router.transitionTo("crm.tab.newForecasts.view",m)}},checkifTargetPresent:function(e,t){var r;return e&&e[0]&&e[0].Forecast_Quota[t]&&(r=e[0].Forecast_Quota[t]),r?void 0:"0"},getPredictedDataInfo:function(e,t,r){var s=e.sel_predicted_data,i=s.length,a=0;if(s&&i>0){if(t.predicted_target=null===s[0][r]?null:s[0][r],t.predicted_target_percentage=t.target&&t.predicted_target>0?Number((t.predicted_target/t.target*100).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]):0,featuresAvailable.FORECASTS_DI_PHASE_THREE){var n="Amount"===r?"Likely_To_Win_Amount__s":"Likely_To_Win_Quantity__s";t.likely_to_win=null===s[0][n]?null:s[0][n],t.deals_expected_to_close={};for(var o=["Expected_Closed_Deals_First_Period__s","Expected_Closed_Deals_Second_Period__s","Expected_Closed_Deals_Third_Period__s"],c=["Expected_Closed_Deals_First_Count__s","Expected_Closed_Deals_Second_Count__s","Expected_Closed_Deals_Third_Count__s"],l=0;l<3;l++)if(s[0][o[l]]&&null!==s[0][c[l]]){var d=I18n.getMsg(s[0][o[l]]),u=s[0][c[l]];a+=u,t.deals_expected_to_close[o[l]]=d;var m=1===u?moduleRecordMapping.Potentials.singular_label:moduleRecordMapping.Potentials.plural_label;t.deals_expected_to_close[c[l]]=u+" "+m}}}else t.predicted_target=null,featuresAvailable.FORECASTS_DI_PHASE_THREE&&(t.likely_to_win=null,t.deals_expected_to_close={});featuresAvailable.FORECASTS_DI_PHASE_THREE&&(t.total_deals_likely_to_win=a)},kpiDataConstruction:function(e){var t={},r={},s=0;t.target_achievement={},t.forecast_category={},t.prediction_data={},r.title=I18n.getMsg("crm.forecast.list.achievement"),r.value=e.achievement,r.percentage=e.achievement_percentage,t.target_achievement.achievement=r,(r={}).title=I18n.getMsg("crm.label.forecast.target"),r.value=e.target,t.target_achievement.target=r,(r={}).title=I18n.getMsg("Open Potentials",moduleRecordMapping.Potentials.plural_label),r.value=e.open_deals,t.forecast_category.open_deals=r;var i=this.getAllForecastCategories(),a=["Closed","Omitted"];for(var n in i){if(a.contains(n))(r={}).title=i[n].display_value,r.value=e[n],r.color_code=i[n].color_code,"Omitted"===n?r.title=I18n.getMsg("crm.forecast.category.closed.lost.deals",moduleRecordMapping.Potentials.plural_label):"Closed"===n&&(r.title="closed"),t.forecast_category[n]=r}var o=this.getOpenForecastCategories(),c={};for(var l in o)void 0!==e[l]&&(c[l]={display_value:o[l].display_value,amount:e[l],color_code:o[l].color_code},s++);return Object.keys(c).length>0&&(t.forecast_category.openCategories=c),e.totalForeCategoryCount=s,(r={}).title=I18n.getMsg("crm.forecast.prediction.label"),r.value=e.predicted_target,r.percentage=e.predicted_target_percentage,t.prediction_data.prediction=r,featuresAvailable.FORECASTS_DI_PHASE_THREE&&((r={}).title=I18n.getMsg("crm.forecast.prediction.likely.to.win"),r.value=e.likely_to_win,t.prediction_data.likely_to_win=r,(r={}).title=I18n.getMsg("crm.forecast.prediction.total.deals.Likely.to.win",[moduleRecordMapping.Potentials.plural_label,e.total_deals_likely_to_win]),r.value=e.deals_expected_to_close,r.valuePresent=0!==Object.keys(e.deals_expected_to_close).length,t.prediction_data.deals_expected_to_close=r),t},getTargetFieldObj:function(e,t){for(var r=store.peekAll("forecast_configuration")[0],s=r?r.forecast_types.length:0,i=0;i<s;i++)if(r.forecast_types[i].name===t){for(var a=e.length,n=0;n<a;n++)e[n].id===r.forecast_types[i].field.id&&(r.forecast_types[i].field.field_label=e[n].field_label);return r.forecast_types[i].field}},isTargetCompleted:function(e){return!!(e.achievement&&e.target&&e.achievement>=e.target)},fetchUserListCriBasedOnParentHierarchy:function(e,t){var r,s=t.parent_hierarchy_id,i=t.hierarchy_id;return s?"Roles"===e?r="[{'comparator':'equal','field':'role.id','value':'"+s+"'}]":"Territory"===e&&(r="[{'comparator':'in','field':'territories','value':['"+s+"']}]"):r="[{'comparator':'equal','field':'id','value':'"+i+"'}]",r},repoToCompanyAndSingleCeoCase:function(e,t){if(t.User){var r={},s={};e.quotaType="user",r.id=t.User.id,r.name=t.User.name,e.groupName=r.name,s.User=r,e.recordObj=s}else e.baseForecast=!0,s.companyName=OrgName},isSinceLastWeekFallWithinThePeriod:function(e){var t,r,s,i={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}[Crm.userDetails.businessDetails.weekStartOn],a=$L.moment().toDate().getDay();if(a<i){var n=i-a;r=(c=$L.moment().toDate()).setDate(c.getDate()+n);var o=$L.moment(r).toDate();s=o.setDate(o.getDate()-14),s=CrmDateUtils.getDateInPattern(s,"YYYY-MM-DD")}else{var c;n=a-i;t=(c=$L.moment().toDate()).setDate(c.getDate()-n);var l=$L.moment(t).toDate();s=l.setDate(l.getDate()-7),s=CrmDateUtils.getDateInPattern(s,"YYYY-MM-DD")}var d=e.Period_Name.Start_Date;return $L.moment(s).toDate()>=$L.moment(d).toDate()},getActValueVsSysRefNameFromForeCategory:function(e){var t={};for(var r in e)t[e[r].actual_value]=r;return t},resolveDealsByForeCategoryReport:function(e,t,r){for(var s=this.getActValueVsSysRefNameFromForeCategory(this.getAllForecastCategories()),i=r.length,a={},n=0;n<i;n++)if("Forecast_Category__s"===r[n].api_name)for(var o=r[n].pick_list_values,c=o.length,l=0;l<c;l++){var d=s[o[l].actual_value];(e.sel_forecast_data[0][d]||"Omitted"===d)&&(a[o[l].id]=d,t[d]=null)}t.open_deals=null;var u=e.dealsByForeCategoryReport;if(u.data_map&&u.data_map.row_groupings&&u.data_map.row_groupings.groupings){var m=u.data_map.row_groupings.groupings,p=m.length;for(n=0;n<p;n++){var h=m[n].key,f=m[n].value,g=u.data_map[h].aggregates[0].value,y=u.data_map[h].aggregates[0].label;(d=a[f])&&g&&0!==g&&(t[d]=g,"Closed"!==d&&"Omitted"!==d&&g&&(t.open_deals+=g),"Omitted"===d&&(t[d]=y))}}},resolveKpiChartData:function(e,t){var r=e.kpiReport;if(r.data_map&&r.data_map.row_groupings&&r.data_map.row_groupings.groupings){var s=r.data_map.row_groupings.groupings,i={},a=s.length,n=["last_week","this_week"];if(1===a){var o=$L.moment(s[0].value).toDate();o=o.setDate(o.getDate()+6);var c=CrmDateUtils.getDateInPattern($L.moment().toDate(),"YYYY-MM-DD");$L.moment(c).toDate()<=$L.moment(o).toDate()?i.this_week=r.data_map[0].aggregates[0].value:i.last_week=r.data_map[0].aggregates[0].value}else for(var l=0;l<a;l++)r.data_map[s[l].key].aggregates&&r.data_map[s[l].key].aggregates[0]&&(i[n[l]]=r.data_map[s[l].key].aggregates[0].value);if(i){var d={};i.last_week&&i.this_week?i.last_week>i.this_week?(d.gap=i.last_week-i.this_week,d.loss=!0):(d.gap=i.this_week-i.last_week,d.loss=!1):i.last_week?(d.gap=0,d.loss=!0):i.this_week&&(d.gap=i.this_week,d.loss=!1),d&&(t.kpiAchievedResp=d)}}},getKpiChartDataReport:function(e,t,r){var s,i,a,n,o,c,l=this,d=this.fetchAggregateFuncObj(r),u=[{type:"row",field:{api_name:"Closing_Date"},sort_order:"asc",date_granularity:"fiscal_week"}];return s={field:{api_name:"Closing_Date"},comparator:"equal",value:"${LASTWEEK}"},i={field:{api_name:"Closing_Date"},comparator:"equal",value:"${THISWEEK}"},n={field:{api_name:"Forecast_Category__s"},comparator:"equal",value:t.Closed},a=l.construct_group(s,i,"OR"),o=l.construct_group(a,n,"AND"),c=this.commonCriteria?l.construct_group(this.commonCriteria,o,"AND"):o,l.createReportJson("kpiData",this.module_api_name,[{api_name:"Deal_Name"}],d.show_record_count,d.aggregate_functions,u,c,this.drillDownObj,this.territoryFilter,!1)},errorCodeMsg:function(e,t){switch(e){case"0":return I18n.getMsg("crm.forecast.user.target.not.available");case"1":return I18n.getMsg("crm.module.empty.message",I18n.getMsg("crm.auditlog.user"));case"2":return I18n.getMsg("crm.forecast.user.not.available.completed.forecast",t)}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.view",{queryParams:["forecast_type","forecast_hierarchy","status","forecast_field_label"],getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dashboard"),"zohocrm_analytics.js"],ResourceConstants.CRM);return e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-view.js","crm-analytics.js","crm-forecast-search.js","crm-forecast-deals-modal.js","crm-macro.js","macro-model.js","crm-forecast-progress.js","crm-report-dependencies.js","crm-forecast-chart.js","lyte-dateselect.js","lyte-daterangepicker.js","model-crm-report.js","crux-form-component.js","crm-ui-loaders.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-forecast-view.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css","crm-forecast-progress.css","crm-forecast-chart.css","analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-macro.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js","highcharts.js","crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-strategy.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["voc-setup-store.js","voc-dependencies-store.js","voc-dashboard-store.js","voc-component-store.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-email-auth-util.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("voccommon")],ResourceConstants.CRM))},beforeModel:function(){var e=store.peekAll("forecast_configuration");if((e?e.length:0)<=0)return renderingUtils.displayPermissionDenied(),void this.transition.abort();var t=this.transition.data;if(!t||!t.reloadAll){if("undefined"!=typeof CrmAnalytics&&"undefined"!=typeof AnalyticsChart){CrmAnalytics.resetAllVariables();var r=this.getDynamicParam(),s=this.getQueryParams();if(newForecastsPitchEnabled){var i=CrmAnalytics.base_url+"?feature_type=forecast_pitch";CrmAnalytics.ForecastPitchId&&""!==CrmAnalytics.ForecastPitchId||CrmAnalytics.getApiData(i,crmConstants.requestMethods.GET,(function(e){if(e&&e.Analytics){var t=CrmAnalytics.base_url+"/"+e.Analytics[0].id+"/describe";CrmAnalytics.getApiData(t,crmConstants.requestMethods.GET,(function(e){var t=e.Analytics[0].dashboard_status;if((t=t?t.split("_"):t)&&"available"===t[0]){var r=[networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)],s=[networkUtils.returnDependencyFiles(["analytics-zia-pitch-v3.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)];"v3"===t[1]?(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(s,void 0,void 0)):(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["analytics-zia-pitch-v3.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)),Lyte.injectResources(r,void 0,void 0));var i=e.Analytics[0].components[0],a=i.aggregates[0].name;CrmAnalytics.ForecastPitchField={field:a,type:i.aggregates[0].functions[0]},CrmAnalytics.ForecastPitchId=e.Analytics[0].id}}),void 0,void 0,void 0,void 0,void 0)}}),void 0,void 0,void 0,void 0)}return s.status&&"archived"===s.status?this.fetchParentItemInfo(r,void 0,s.forecast_hierarchy,!0):this.fetchParentItemInfo(r)}Lyte.Router.getRouteInstance().refresh().data=t}},model:function(){var e=this.transition.data;if(!e||!e.reloadAll){var t=this.getQueryParams(),r=!1;t.status&&"archived"===t.status&&(r=!0);var s,i=this.getDynamicParam(),a=store.peekRecord("Forecast",i),n=store.findAll("module");if(a.Is_Archived&&!r){var o=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),c=window.location.pathname.split(o)[1];this.replaceWith("crm.crm-error",c).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.archived.not.available"),isForecast:!0}}a.Forecast_Group&&(s={field:{api_name:"Group_Id"},comparator:"equal",value:a.Forecast_Group.id});var l,d,u,m,p,h,f,g,y,v=JSON.stringify(s),_=store.findAll("Forecast",{filters:v}),C=a.id?JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:a.id}):void 0,R=this.parent_data.length?this.getParentItemIds(this.parent_data[0]):[],b="Period_Name.",w=CrmDateUtils.getFormattedDate($L.moment().toDate()),M=this.forecast_config.forecast_types,D=M.length;if(CrmAnalytics.ForecastPitchField&&2===D&&"current"===a.status&&!a.Forecast_Group.criteria){for(var P="COUNT"===CrmAnalytics.ForecastPitchField.type?"Deal_Quantity":"Deal_Revenue",L=0;L<D;L++)M[L].name!==P&&(d=M[L].id,m={api_name:M[L].field.api_name,field_label:"id"===M[L].field.api_name?I18n.getMsg("crm.forecast.count.of",Crm.moduleInfo.Potentials.translatedPluralLabel):M[L].field.field_label}),M[L].name===P&&(p={api_name:M[L].field.api_name,field_label:"id"===M[L].field.api_name?I18n.getMsg("crm.forecast.count.of",Crm.moduleInfo.Potentials.translatedPluralLabel):M[L].field.field_label});v={group_operator:"AND",group:[{group_operator:"AND",group:[{comparator:"less_equal",field:{api_name:b+"Start_Date"},value:w},{comparator:"greater_equal",field:{api_name:b+"End_Date"},value:w}]},{field:{api_name:"Group_Id.Forecast_Type"},comparator:"equal",value:d}]};v=JSON.stringify(v),u=store.findAll("Forecast",{filters:v})}if(l=r?this.FORECAST_UNIQUE_HIERARCHY_API_NAME[t.forecast_hierarchy].apiname:crmConstants.forecastHierarchyObj[this.forecast_config.hierarchy.api_name],R.length&&(f=this.fetchForecastData(R,"children",l,i),g=this.fetchForecastData(R,"users",l,i)),"Reporting_To"===l&&this.is_admin&&this.non_reporting_data.length){var k=this.getParentItemIds(this.non_reporting_data[0]);h=this.fetchForecastData(k,"users",l,i,void 0,void 0,!0,void 0,!0)}return"completed"!==a.status&&this.fetchUsersCount(l,a),y="completed"===this.prediction_status&&C?app.store.makeRequest("findAll","predicted_data",{filters:C},!0):[],Lyte.resolvePromises({forecast_data_children:f,forecast_data_user:g,fetch_non_reporting:h,record:a,predicted_data:y,allCurrforecast:u,group_forecasts:_,forecastGroupFields:r?store.findAll("field",{module:"Forecast_Groups",type:"all"},!1,!0,{apiVersion:"2.2"}):void 0,isArchived:r,recreatePitchField:m,currentPitchField:p,forecast_field_label:r?t.forecast_field_label:void 0,all_users:store.findAll("user",{type:"ActiveUsers"},!0,!1),modules:n})}},afterModel:function(e){var t=this.transition.data;if(e.predicted_data&&e.predicted_data.length>0){Crm.client_tracking("Forecast Prediction Available - View Page",{})}if(!t||!t.reloadAll){e.isArchived&&(e.archivedFieldLabel=e.forecast_field_label),e.fc_category_count=this.fc_category_count,e.Fiscal_Periods=this.constructFiscalPeriod(e.group_forecasts);var r=e.record;if(e.is_admin=this.is_admin,e.forecast_manager=this.forecast_manager,e.daydiff=Utils.getDayDiff(new Date(r.Period_Name.End_Date),new Date(r.Period_Name.Start_Date)),e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.forecast_conf=this.forecast_config,e.forecast_type=r.Forecast_Group.Forecast_Type.name,e.isPitchDelete=!1,e.ziaPitchId=r.Forecast_Group.pitch_dashboard?r.Forecast_Group.pitch_dashboard.id:null,e.ziaPitchId&&!r.Forecast_Group.criteria&&(e.ziapitchPopupShowHide=!0,e.showViewStrategy=!0),e.fc_target_key="Deal_Revenue"===e.forecast_type?"formatted_target_amount":"formatted_target_quantity",e.isArchived){var s=this.getQueryParams(),i=this.getForecastHierarchy(e.forecastGroupFields,s.forecast_hierarchy);e.hierarchy=i.api_name,e.hierarchyObj=i}else e.hierarchy=e.forecast_conf.hierarchy.api_name,e.hierarchyObj=e.forecast_conf.hierarchy;e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,this.setPredictedInfo(this.parent_data[0],this.fc_type),e.hierarchy_data=this.company_fc_data?[this.company_fc_data[0]]:this.hierarchy_data_info;var a=r.Forecast_Group.criteria?this.getCriteriaLen(r.Forecast_Group.criteria):0;e.criteriaLen=a.length,this.is_admin&&"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.fetch_non_reporting.non_reporting_users.forEach((function(t){(t.User&&"deleted"!==t.User.status||t.Reporting_To&&"deleted"!==t.Reporting_To.status)&&e.non_reporting_users.push(t)})),e.non_reporting_user_config=e.fetch_non_reporting.non_reporting_user_config),e.record.Forecast_Quotas&&(e.record.Forecast_Quotas=[]),e.hierarchy_name=crmConstants.forecastHierarchyObj[e.hierarchyObj.api_name],this.without_territory&&(e.without_territory=e.forecast_data_children.without_territory),delete this.without_territory;var n=e.record.Created_Time,o=e.record.Modified_Time,c=$L.moment(n.split(" ")[0]).toDate();Utils.convertToUserTimezone(c);var l=$L.moment(o.split(" ")[0]).toDate();if(Utils.convertToUserTimezone(l),e.created_time=Utils.getDateTimeInUserFormat(c,!0),e.modified_time=Utils.getDateTimeInUserFormat(l,!0),e.userCountBottomUp=e.all_users.meta.count,fiscalCustomPeriodsEnabled){var d="custom"===store.peekAll("fiscal_year")[0].calendar_type;e.isCustomFY=d}}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-view",reRender:!0}},afterRender:function(){var e=$L("crm-forecast-view");e&&e.length&&e[0].component.setLastChangedTime(),this.getVocForecastinsights(e)},beforeExit:function(){var e=$("#show");thirdPartyUtils.unbindZohoCharts(e),_cruxUtils.removeCustomAlert()},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(!(e&&e.status&&400===e.status&&e.response))return commonUtils.showHideLoadingDiv(!1),!1;var r=JSON.parse(e.response);if("The given forecast_id seems to be invalid"===r.message||"UNABLE_TO_PARSE_DATA_TYPE"===r.code){var s=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),i=window.location.pathname.split(s)[1];this.replaceWith("crm.crm-error",i).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}t.resume()},didTransition:function(){commonUtils.showHideLoadingDiv("refreshing"===this.currentModel.record.$computation_status)}}},{mixins:["crm-forecast-util","voc-route-mixin"]}),Lyte.Router.registerRoute("crm.tab.newForecasts",{queryParams:["forecast_type","forecast_hierarchy","status"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-forecast-datastore.js","crm-forecast-category.js","crm-forecast-config-store.js","org-model.js","crm-forecast-util.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Forecasts"),"zohocrm_clientPortalMiscFuncs.js"],ResourceConstants.CRM);return e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-helpers.js","crm-canvasview.js","crux-textautocomplete-options.js","crm-canvas-helpers.js","lyte-progressbar.js","crm-detail-canvas-common-files.js","crm-activity-edit-delete-view-icon-canvas-helpers.js","crm-related-list-action-wrapper.js","lyte-colorbox.js","crux-tag.js","crux-color-palette.js","crm-cloud-picker-mixin.js","crux-lookupfilter-component.js","crux-column-list.js","crm-detail-view-utils.js","crm-create-mixin.js","zia_reminder_model.js","features_model.js","servapp_preferences_model.js","note_model.js","reviewprocess_model.js","besttime_zia_new_model.js","nba-detail-page.js","zia/nbx/crm-nba-mixins.js","voc-common-store.js","lyte-tree.js","crux-criteria-component.js","crux-criteria-conditions.js","series_entityseries.js","crux-form-component.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-inventory-detail-view.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-multi-lookup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-feed-follower-datastore.js","crm-follower.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-rl-users-list.js","crm-zexpense-rl.js","crm-subscription-rl.js","crm-custom-rl.js","crm-related-list-checklist.js","crm-zfinance-rl.js","crm-related-list-view-header.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("fiscalYear")],ResourceConstants.CRM))},beforeModel:function(){return store.addField("user","Reporting_To",Lyte.belongsTo("user",{inverse:"Reporting_To"})),Lyte.resolvePromises({fc_rec:store.findAll("forecast_configuration"),deal:app.store.makeRequest("findRecord","module",moduleRecordMapping.Deals.id,{},!0,void 0,{getFields:!0}),custom_view:store.findAll("custom_view",{module:moduleApiMapping.Deals},!0,!0),forecast_category:store.findAll("forecast_category"),fiscal_year:store.findAll("fiscal_year")})},model:function(){if(crmHistory.transitionError&&this.currentModel)return this.currentModel;var e,t,r=store.peekAll("forecast_configuration")[0];moduleRecordMapping.Deals&&(e=store.findAll("field",{module:"Deals",type:"all"},void 0,!0,{apiVersion:"2.2"}));var s=this.getQueryParams();r&&(t=s.status&&"archived"===s.status?s.forecast_hierarchy?this.fetchHierarchyInfo(this.FORECAST_HIERARCHY_PICKLIST_VALUE_MAP[s.forecast_hierarchy].apiname,!1):this.fetchHierarchyInfo(void 0,!0):this.fetchHierarchyInfo());var i,a,n=this.transition.info;if("crm.tab.newForecasts.create"===n.route){var o=n.queryParams.group_id;i=(i=o?store.peekRecord("forecast_group",o):void 0)||(o?app.store.makeRequest("findRecord","forecast_group",o,{},!0):void 0),a=app.store.makeRequest("findAll","Forecast",{},!0)}r=store.peekAll("forecast_configuration")[0];return Lyte.resolvePromises({forecasts:a,hierarchy:t,forecast_group:i,criteria_fields:e,deletedItems:r?this.fetchDeletedItems(crmConstants.forecastHierarchyObj[r.hierarchy.api_name]):[]}).then((function(e){return e.hierarchy&&(e.hierarchyIds=e.hierarchy.IdData.hierarchyIds,e.hierarchy=e.hierarchy.hierarchy),e.criteria_fields&&(e.criteria_fields=e.criteria_fields.field),e}))},redirect:function(){if(crmHistory.transitionError)this.handleError(this.currentModel);else{var e=this.transition.data;e&&e.fromCreate&&(this.refreshModel=!0);var t=!1;this.transition.data&&this.transition.data.fromPerformance&&(t=!0),!app.prevTransition.route||"crm.tab.newForecasts.view"!==this.transition.target||this.refreshModel||t||(this.refreshModel=!0,this.refresh().data=e),e&&e.reloadAll&&(delete e.reloadAll,e.refreshTemplate=!0,this.refresh({refreshTemplate:!0}).data=e)}},actions:{onError:function(e,t){if(this.currentModel=e,crmHistory.transitionError=!0,e&&e.status&&400===e.status&&e.response){var r=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",s).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}t.resume()},didTransition:function(){delete this.refreshModel,Crm.isRebrandingEnabled?this.setTitle(crmTab.getDisplayName("Forecasts",!1)+" - "+Crm.productBrandName):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Forecasts",!1),Crm.partnerName]))}},beforeExit:function(){store.clearCachedQuery("role"),store.clearCachedQuery("org"),store.clearCachedQuery("user"),store.clearCachedQuery("module"),store.addField("user","Reporting_To","object"),setTimeout((function(){store.unloadAll("territory"),store.unloadAll("role");var e=store.peekRecord("user",Crm.userDetails.USER_ID).$.toJSON();store.unloadAll("user"),store.pushPayload("user",e)}),1e3)}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newReports.clone",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=Lyte.registeredMixins["crm-report-util"].getCommonRequests(!1);return this.transition&&this.transition.data.report?(e.serialized_report=this.transition.data.report,e.fromView=!!this.transition.data.fromView&&this.transition.data.fromView):e.request_serialized_report=store.findRecord("report",this.getDynamicParam()),Lyte.resolvePromises(e)},afterModel:function(e){var t=!0;if(e.serialized_report){if("joined"===e.serialized_report.type)for(var r=e.serialized_report.sub_reports.length,s=0;s<r;s++){if("Activities"!==(c=e.serialized_report.sub_reports[s]).module.api_name){for(var i=c.joins?c.joins.length:0,a=0;a<i;a++)if("Activities"===c.joins[a].module.api_name){t=!1;break}}else t=!1}else if("Activities"!==e.serialized_report.module.api_name){for(i=e.serialized_report.joins?e.serialized_report.joins.length:0,s=0;s<i;s++)if("Activities"===e.serialized_report.joins[s].module.api_name){t=!1;break}}else t=!1;if(!t)return this.transition.abort(),this.transitionTo("crm.tab.newReports.index").errorObj={response:'{"code" : "ACTIVITY_MODULE_NOT_AVAILABLE"}',status:"422"},"crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.newReports.index.list"===Lyte.Router.getRouteInstance().transition.info.route?void(Lyte.Router.getRouteInstance().refresh().errorObj={response:'{"code" : "ACTIVITY_MODULE_NOT_AVAILABLE"}',status:"422"}):void 0;if(e.serialized_report.is_converted_report)(n=e.serialized_report.filters)&&(n.field.api_name="Converted__s");this.currentModel={report:e.serialized_report}}else if(e.request_serialized_report){var n,o=e.request_serialized_report[0];if("joined"===o.type)for(r=o.sub_reports.length,s=0;s<r;s++){var c;if("Activities"!==(c=o.sub_reports[s]).module.api_name){for(i=c.joins?c.joins.length:0,a=0;a<i;a++)if("Activities"===c.joins[a].module.api_name){t=!1;break}}else t=!1}else if("Activities"!==o.module.api_name){for(i=o.joins?o.joins.length:0,s=0;s<i;s++)if("Activities"===o.joins[s].module.api_name){t=!1;break}}else t=!1;if(!t)return this.transition.abort(),this.transitionTo("crm.tab.newReports.index").errorObj={response:'{"code" : "ACTIVITY_MODULE_NOT_AVAILABLE"}',status:"422"},"crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.newReports.index.list"===Lyte.Router.getRouteInstance().transition.info.route?void(Lyte.Router.getRouteInstance().refresh().errorObj={response:'{"code" : "ACTIVITY_MODULE_NOT_AVAILABLE"}',status:"422"}):void 0;if(o&&o.is_converted_report)(n=o.filters)&&(n.field.api_name="Converted__s");this.currentModel={report:o}}var l=this.currentModel.report.name+"_"+I18n.getMsg("crm.label.cloned");l.length<=100&&(this.currentModel.report.name=l),this.currentModel.clone_mode=!0,this.currentModel.fromView=e.fromView,this.currentModel.parentRepIdForClone=this.currentModel.report.id,this.currentModel.popups=e.popups.Reports_Onboard,this.currentModel.orgConfigurations=e.orgConfigurations.Reports_Configuration,delete this.currentModel.report.id,delete this.currentModel.report.source,commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-builder",data:e}},actions:{onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),s=document.querySelector("crm-reports-container");s&&s.component.setData("selectedReport",{id:r});var i=Lyte.registeredMixins["crm-report-util"],a=JSON.parse(e.response);a.Reports&&a.Reports[0]&&"INVALID_DATA"===a.Reports[0].code?(s.component.executeMethod("invalidReport"),t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):a.code&&"NO_PERMISSION"===a.code&&a.details&&a.details.permissions&&"Crm_Implied_View_Reports"===a.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status};return!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.create",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-report-select-module.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-report-select-module.css"],ResourceConstants.CRMClient))},beforeExit:function(){this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){store.unloadAll("child_relationship");var t=Lyte.registeredMixins["crm-report-util"].getCommonRequests(!0);return t.permission=store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details",fields:"profile",inner_details_filters:{inner_detail_filters:[{api_name:"profile.permissions_details",filters:{field:{api_name:"module"},comparator:"equal",value:moduleApiMapping.Reports}}]}},!1,!1,{tempApiVersion:"V2.2"}),t.module_api_name=e.queryParams.module,t.related_modules=store.findAll("module"),Lyte.resolvePromises(t)},afterModel:function(e){commonUtils.showHideLoadingDiv();for(var t=e.related_modules.length,r=!1,s=0;s<t;s++){var i=e.related_modules[s];if(i.display_label=i.plural_label,("Activities"!==e.module_api_name||!Crm.isActivitySplitDone)&&e.module_api_name===i.api_name){e.module=i,r=!0;break}}if(!Crm.userDetails.MODULE_LIST.Reports.visible||e.permission&&(!e.permission.user[0].profile.permissions_details||!e.permission.user[0].profile.permissions_details[1].enabled||!e.permission.user[0].profile.permissions_details[0].enabled))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort();if(!r)return this.transition.abort(),this.transitionTo("crm.tab.newReports.index").errorObj={response:'{"code" : "MODULE_NOT_AVAILABLE"}',status:"422"},"crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.newReports.index.list"===Lyte.Router.getRouteInstance().transition.info.route?void(Lyte.Router.getRouteInstance().refresh().errorObj={response:'{"code" : "MODULE_NOT_AVAILABLE"}',status:"422"}):void 0;if(!Crm.userDetails.permissions.Crm_Implied_Manage_Reports||!featuresAvailable.Custom_Reports){this.transition.abort();var a={status:403},n={status:"error",response:'{"code" : "NO_PERMISSION"}'};return a.response=JSON.stringify(n),void(this.transitionTo("crm.tab.newReports.index").errorObj=n)}var o={module:e.module,relatedModules:e.related_modules};this.currentModel={root:o,popups:e.popups.Reports_Onboard,orgConfigurations:e.orgConfigurations.Reports_Configuration}},renderTemplate:function(e){if(this.transition.data&&this.transition.data.isActivityReportConversion){var t={report:{sub_reports:[this.transition.data.report],name:this.transition.data.report.name,description:this.transition.data.report.description,folder:this.transition.data.report.folder,show_detail_rows:this.transition.data.report.show_detail_rows,show_grand_total:this.transition.data.report.show_grand_total,show_sub_totals:this.transition.data.report.show_sub_totals,show_row_count:this.transition.data.report.show_row_count,aggregate_type:this.transition.data.report.aggregate_type},popups:e.popups,orgConfigurations:e.orgConfigurations};return $L("#show").empty(),this.currentModel=t,this.currentModel.isActivitySplitReportConverison=!0,this.currentModel.splitModule=this.transition.data.splitModule,this.currentModel.activityParentReport={id:this.transition.data.parentReportId},{outlet:"#show",component:"crm-report-builder"}}return{outlet:"#show",component:"crm-report-module-selector",data:e}},actions:{onError:function(e){return Lyte.registeredMixins["crm-report-util"].errorPopup(e),this.transitionTo("crm.tab.newReports.index"),!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(t.setData("lastClickedRoute",e.info),e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.edit",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=Lyte.registeredMixins["crm-report-util"].getCommonRequests(!0);if(this.transition&&this.transition.data.report){var t=this.transition.data.report;t.preview=!0,Lyte.objectUtils(t,"delete","more_records"),e.serialized_report=t,e.run_response=store.triggerAction("report","run",{Reports:[t]}),e.isReportChanged=this.transition.data.isReportChanged,e.isColumnResized=this.transition.data.isColumnResized,e.fromView=!!this.transition.data.fromView&&this.transition.data.fromView,e.report=t.id?store.findRecord("report",t.id):void 0}else e.request_serialized_report=store.findRecord("report",this.getDynamicParam());return e.activityReportDetails=store.findAll("dummy",{},!1,!1,{url:Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=getSplitReportsData&reportId="+this.getDynamicParam(),method:"POST"}),Lyte.resolvePromises(e)},afterModel:function(e){if(e.serialized_report)this.currentModel={report:e.serialized_report,run_response:e.run_response},this.currentModel.isColumnResized=!!e.isColumnResized;else if(e.request_serialized_report){this.currentModel={report:e.request_serialized_report[0]};var t=Lyte.registeredMixins["crm-report-util"];this.currentModel.isColumnResized=t.isWidthAvailable(this.currentModel.report,t)}this.currentModel.edit_mode=!0,this.currentModel.isReportChanged=!!e.isReportChanged,this.currentModel.fromView=e.fromView,this.currentModel.popups=e.popups.Reports_Onboard,this.currentModel.orgConfigurations=e.orgConfigurations.Reports_Configuration,e.activityReportDetails=e.activityReportDetails.dummy,e.activityReportDetails&&"MIGRATED_REPORT"===e.activityReportDetails.status&&(this.currentModel.isActivitySplitReportConverison=!0,this.currentModel.activityParentReport={id:e.activityReportDetails.parentReportId}),commonUtils.showHideLoadingDiv()},renderTemplate:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Reports)return store.unloadAll("role"),Crm.client_tracking("Crm Report : Edit"),{outlet:"#show",component:"crm-report-builder",data:e};var t={status:403};t.response=JSON.stringify({status:"error",code:"NO_PERMISSION",message:"permission denied",details:{"permissions needed":["Crm_Implied_Manage_Reports"]}}),Lyte.registeredMixins["crm-report-util"].errorPopup(t)},actions:{onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),s=document.querySelector("crm-reports-container");s&&s.component.setData("selectedReport",{id:r});var i=Lyte.registeredMixins["crm-report-util"];(a=JSON.parse(e.response)).Reports&&a.Reports[0]&&"INVALID_DATA"===a.Reports[0].code?(s.component.executeMethod("invalidReport"),t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):a.code&&"NO_PERMISSION"===a.code&&a.details&&a.details.permissions&&"Crm_Implied_View_Reports"===a.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else{var a;"FIELD_COMPARISON_NOT_SUPPORTED_FOR_MULTICURRENCY"===(a=JSON.parse(e.response)).code||"FIELD_LIMIT_EXCEEDED"===a.code||"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"===a.code?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status,report_name:"",report_id:this.getDynamicParam()}:this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}}return!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(t.setData("lastClickedRoute",e.info),e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.index.list",{queryParams:["folder_id","category","sort_by","sort_order","searchword"],model:function(){var e={},t=this.getQueryParams(),r="everything";for(var s in t)if(t[s]&&void 0!==t[s])if("folder_id"===s){var i=store.peekRecord("report_folder",t[s]),a=store.peekAll("report_folder");i||0===a.length?(r=t[s],e[s]=t[s]):(delete t[s],delete e[s],t.category="everything",e.category="everything")}else"category"===s?(r=t[s],e[s]=t[s]):e[s]=t[s];var n=document.querySelector("crm-reports-container"),o=document.querySelector("crm-report-folders"),c="";o&&(c=(o=o.component).getData("query_params")?o.getData("query_params").selected_folder:""),"everything"===r&&"everything"===c&&n&&n.component.getData("isSearch")&&!e.searchword&&this.transition.abort();var l={params:e,scope:r,need_checkbox:"favorites"!==r,folder:validationUtils.isValidNumber(r)?store.findRecord("report_folder",r):r};return"deleted"!==l.scope&&e.searchword?l.defaultReportsTriggered=!0:("deleted"===l.scope&&e.sort_by&&!["name","deleted_time"].contains(e.sort_by)&&(e.sort_by="deleted_time"),l.reports=store.findAll("report",Object.assign({},e))),Lyte.resolvePromises(l)},beforeModel:function(){if(commonUtils.showHideLoadingDiv(!0),featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu-loader").component;e.setData("view","list");var t=setTimeout((function(){e.executeMethod("showLoaderBasedOnView",e)}),2e3),r=document.querySelector("crm-left-menu").component;r.methods.clearLoaderTimeout(),r.setData("loaderTimeout",t)}},afterModel:function(e){if(e&&e.defaultReportsTriggered)var t=Object.assign({},e.params),r=this.currentModel,s=this.transition,i=store.findAll("report",t).then((function(t){e.reports=t,e&&!e.reports&&(e.reports=[]),e.params.searchword&&/^[~`#^*()+={}[\]|;"<>\\]+$/.test(e.params.searchword)&&(e.reports=[]),e&&e.folder&&"string"!=typeof e.folder&&(r.folder=e.folder[0],r.folder.visible||(s.abort(),Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}))),e&&e.reports.$&&(r.more_records=e.reports.$.meta.more_records,r=e.reports.$.meta.page),commonUtils.showHideLoadingDiv(),"string"==typeof e.folder&&(e.folder={id:e.folder})}));else e&&!e.reports&&(e.reports=[]),e&&e.folder&&"string"!=typeof e.folder&&(this.currentModel.folder=e.folder[0],this.currentModel.folder.visible||(this.transition.abort(),Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}))),e&&e.reports.$&&(this.currentModel.more_records=e.reports.$.meta.more_records,this.currentModel.page=e.reports.$.meta.page),commonUtils.showHideLoadingDiv(),"string"==typeof e.folder&&(e.folder={id:e.folder});return this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),i},renderTemplate:function(e){return{outlet:featuresAvailable.NEXTGENUI_ENABLED?"#show":"#report_container",component:"crm-reports-container",data:e}},actions:{onError:function(e){var t=e.response.constructor===String?JSON.parse(e.response):e.response;"NO_PERMISSION"===t.code?(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort()):t.Report_Folders&&"INVALID_DATA"===t.Report_Folders[0].code&&(renderingUtils.displayPermissionDenied(),this.transition.abort())},willTransition:function(){var e=document.querySelector("crm-reports-container");if(e){var t=$L(".recentDelete-container");t.hide(),e.component.setData("selected_ids",[]),e.component.actions.deselectRecords(e.component),setTimeout((function(){t.show()}),500)}}},afterRender:function(e,t,r){r=r.component;var s=document.querySelector("crm-reports-list"),i=this.transition.data?this.transition.data.scrollLeftAvailable:void 0;s&&s.component.executeMethod("resize"),r.executeMethod("setReporHeading",r),r.setData("refresh",!0);var a=document.querySelector("#crm-reports-listtable");a&&a.component.data.ltPropContent.length&&!i&&a.scrollTable(0,0);var n=window.innerHeight-a.getBoundingClientRect().top;n-=$L("#wms-chatwindowcontainer")[0]?26:0,$L("#ReportsNoRecordsFound").css("line-height",n-77);var o=e.params,c=Object.assign({},o);c.selected_folder=e.scope;var l=document.querySelector("crm-report-folders").component;l.setData("query_params",c);var d=l.executeMethod("getSelectedFolderIndex",void 0===c.folder_id?c.category:c.folder_id,l.getData("wholeFolders"));-1!==d&&l.executeMethod("scrollToGivenIndex",d);var u=!!(e.params&&e.params.searchword&&e.params.searchword.length>0);if(r.setData("isSearch",u),r.setData("personalAccount",Crm.userDetails.PERSONAL_ACCOUNT),r.setData("show_force_migration_alert",l.getData("show_force_migration_alert")),r.setData("isMigrationScheduled",l.getData("isMigrationScheduled")),r.setData("migrationScheduledTime",l.getData("migrationScheduledTime")),r.executeMethod("setTooltipMessage",r),this.transition.data.option&&"updateMetaData"===this.transition.data.option){var m={lastViewed:e.scope};for(var p in o)"deleted"!==e.scope&&o[p]&&void 0!==o[p]&&("sort_by"!==p&&"sort_order"!==p||(m[p]=o[p]));t=Object.assign({},m);m.action="configuration",m.type=crmConstants.requestMethods.POST,store.triggerAction("report","configuration",m).then((function(e){e&&(validationUtils.isValidNumber(t.lastViewed)?t.folder_id=t.lastViewed:t.category=t.lastViewed,delete t.lastViewed,moduleRecordMapping.Reports.query_params=t)}))}var h=$L("#reportSearchGobal2");if(h.length>0){h.lytefind({scope:"#crm-reports-listtable",search:".report-list a lyte-text span:not(.highlightdiv)"});var f=r.getData("params"),g=f&&f.searchword?f.searchword:"";document.querySelector("#reportSearchGobal2").setValue(g),(h=document.querySelector("#reportSearchGobal"))&&h.ltProp("value")!==g&&(r.setData("initialSearchSet",!0),h.ltProp("value",g))}if(featuresAvailable.NEXTGENUI_ENABLED){var y=document.querySelector("crm-left-menu").component;y.getData("isCreateMode")&&(l.actions.openPrimaryModuleSelector(),y.setData("isCreateMode",!1)),y.methods.hideContentLoader()}}}),Lyte.Router.registerRoute("crm.tab.newReports.index.schedule.list",{queryParams:["status","sort_by","sort_order"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-report-list-page.js"],ResourceConstants.CRMClient)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={},t=this.getQueryParams(),r=this.transition.data.scheduleMsg?this.transition.data.scheduleMsg:"",s="active";for(var i in t)t[i]&&(e[i]=t[i],"status"===i&&(s=t[i]));e.hasOwnProperty("sort_by")||"active"!==s&&"stopped"!==s||(e.sort_by="active"===s?"repeat_type":"modified_time",e.sort_order="desc");var a=document.querySelector("#crm-reports-listtable");return a&&(a.style.visibility="hidden",a.scrollTable(0,0)),Lyte.resolvePromises({reports:store.findAll("scheduled_report",e),params:e,scope:s,need_checkbox:!1,scheduleMsg:r,table:a})},afterModel:function(e){e.reports||(e.reports=[]),e&&e.reports.$&&(this.currentModel.more_records=e.reports.$.meta.more_records,this.currentModel.page=e.reports.$.meta.page),e.table&&(e.table.style.visibility="visible");for(var t=[],r=e.reports.length,s=0;s<r;s++){var i=Object.assign({},e.reports[s]);i.schedule&&(i.repeat_type=Lyte.registeredMixins["crm-report-util"].getRepeatTypeConstant(i.schedule.repeat_type),i.schedule.details&&(i.next=i.schedule.details.next,i.previous=i.schedule.details.previous),delete i.schedule),t.push(i)}e.reports=t,this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:featuresAvailable.NEXTGENUI_ENABLED?"#show":"#report_container",component:"crm-schedule-container",data:e}},afterRender:function(e,t,r){var s=$L("#scheduled");r.setData("reportHeading",s.text().trim()),r.setData("refresh",!0);var i=e.params,a=Object.assign({},i);a.selected_folder="scheduled";var n=document.querySelector("crm-report-folders").component,o=n.getData("query_params");a.sort_by=o.sort_by,a.sort_order=o.sort_order,n.setData("query_params",a);var c=document.querySelector("#crm-reports-listtable");if(c){var l=window.innerHeight-c.getBoundingClientRect().top;l-=$L("#wms-chatwindowcontainer")[0]?26:0,$L("#ReportsNoRecordsFound").css("line-height",l-77)}if(this.transition.data.option&&"updateMetaData"===this.transition.data.option){var d={lastViewed:"scheduled",action:"configuration"};d.type=crmConstants.requestMethods.POST,store.triggerAction("report","configuration",d).then((function(e){e&&(moduleRecordMapping.Reports.query_params={category:"scheduled"})}))}if(featuresAvailable.NEXTGENUI_ENABLED){var u=document.querySelector("crm-left-menu").component;u.getData("isCreateMode")&&(n.actions.openPrimaryModuleSelector(),u.setData("isCreateMode",!1)),u.methods.hideContentLoader()}},actions:{onError:function(e,t){t.abort();var r=JSON.parse(e.response);r&&r.code&&"NOT_SUPPORTED_FEATURE"===r.code?Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}).data={option:"updateMetaData"}:Lyte.registeredMixins["crm-report-util"].errorPopup(e,!0)}}}),Lyte.Router.registerRoute("crm.tab.newReports.index.schedule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){"crm.tab.newReports.index.schedule"===this.transition.info.route&&this.replaceWith("crm.tab.newReports.index.schedule.list")}}),Lyte.Router.registerRoute("crm.tab.newReports.index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-report-list-page.js"],ResourceConstants.CRMClient),t=[networkUtils.getI18nJSUrl("activitydepbanner")],r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRM);return e=e.concat(r)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return store.unloadAll("report_folder"),Lyte.resolvePromises({reportfolders:store.findAll("report_folder"),metadata:store.triggerAction("report","configuration",{action:"configuration",type:"GET"})})},afterModel:function(e){e.reportfolders||(e.reportfolders=[]),e&&e.reportfolders.$&&(this.currentModel.more_records=e.reportfolders.$.meta.more_records,this.currentModel.page=Number(e.reportfolders.$.meta.page));var t=e.metadata&&e.metadata.Reports_Configuration?e.metadata.Reports_Configuration:e.metadata;if(t&&t.last_viewed_report_folder){var r=t.last_viewed_report_folder.id?t.last_viewed_report_folder.id:t.last_viewed_report_folder.name;validationUtils.isValidNumber(r)?t.folder_id=r:(r="scheduled"!==r||featuresAvailable.Schedule_Reports?r:"everything",t.category=r),delete t.last_viewed_report_folder,moduleRecordMapping.Reports.query_params=t,this.currentModel.query_params=t,this.currentModel.paramObj=t}if(this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),this.transition.data&&this.transition.data.show_incompatibility){this.currentModel.errorObj={status:400,response:'{"status":"error","code":"REPORT_NOT_SUPPORTED"}'}}if(commonUtils.showHideLoadingDiv(),featuresAvailable.NEXTGENUI_ENABLED){var s=document.querySelector("crm-left-menu").component;s.actions.showOrHideLeftPane(!0),s.methods.showOrHideLeftMenuLoader(!1)}},renderTemplate:function(e){return $L(".ts-lftmnu-modules").empty(),{outlet:featuresAvailable.NEXTGENUI_ENABLED?".ts-lftmnu-modules":"#show",component:"crm-report-folders",data:e}},redirect:function(e){if("crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route){var t=!0;if(this.transition.data&&void 0!==this.transition.data.redirect&&!1===this.transition.data.redirect&&(t=!1),e.paramObj&&e.paramObj.category&&"scheduled"===e.paramObj.category&&featuresAvailable.Schedule_Reports&&t)this.replaceWith({route:"crm.tab.newReports.index.schedule.list",queryParams:{status:"active"}}).data={redirect:!1};else if(t){this.replaceWith({route:"crm.tab.newReports.index.list",queryParams:e.paramObj}).data={redirect:!1}}}},didDestroy:function(){if(featuresAvailable.NEXTGENUI_ENABLED){var e=app.nextTransition?app.nextTransition.info.route:null;if(e&&e.startsWith("crm.tab.newReports"))document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1)}},actions:{onError:function(e,t){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,t.abort(),renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.newReports.records",{queryParams:["page","criteria","sort_by","sort_order","column","value","formula","sub_report","date_filter","apply_date_filter","hierarchy_id","hierarchy_name","action","title","action"],model:function(e){return"viewAppointments"===e.queryParams.action?Lyte.registeredMixins["crm-report-util"].getModelForReportsView(e):"viewMeetings"===e.queryParams.action?Events.getModelForReportsView(e):Lyte.resolvePromises({report:store.findRecord("report",e.dynamicParam),criteria:e.queryParams.criteria,apply_date_filter:e.queryParams.apply_date_filter,sub_report:e.queryParams.sub_report,date_filter:e.queryParams.date_filter,formula:e.queryParams.formula,hierarchy_id:e.queryParams.hierarchy_id,sort_order:e.queryParams.sort_order,sort_by:e.queryParams.sort_by,column:e.queryParams.column,value:e.queryParams.value})},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-view",data:e}},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(),e.queryParams.action&&"viewAppointments"!==e.queryParams.action&&e.queryParams.action&&"viewMeetings"!==e.queryParams.action){this.transition.abort();var t=networkUtils.returnDependencyFiles(["crm-new-reports-popup.js"],ResourceConstants.CRMClient);Lyte.injectResources(t,void 0,(function(){var e=Lyte.Component.render("crm-new-reports-popup",{},"#reportlookupdiv");e&&e.component.showOrHideModel("drillDownNotSupportedAlert",!0)}))}},afterModel:function(e){var t=Lyte.registeredMixins["crm-report-util"];if(e.report&&(e.report=e.report[0]),void 0!==e.sub_report&&(e.report=e.report.sub_reports[e.sub_report]),e.report){var r=[];if(e.report.fields)for(var s=e.report.fields.length,i=0;i<s;i++){var a={full_api_name:(n=e.report.fields[i]).api_name,display_label:n.label,ui_type:n.ui_type,encrypted:n.encrypted};"bucket"===n._custom_type?a=t.getBucketField(e.report.buckets,n.reference_id?n.reference_id:n.api_name):n.data_type&&(a.data_type=n.data_type),t.addUniqueFields(r,a)}if(e.report.group_by){s=e.report.group_by.length;for(i=0;i<s;i++){a={full_api_name:(n=e.report.group_by[i]).field.api_name,display_label:n.field.label,ui_type:n.field.ui_type,encrypted:n.encrypted};"bucket"===n.field._custom_type?a=t.getBucketField(e.report.buckets,n.field.api_name):n.field.data_type&&(a.data_type=n.field.data_type),t.addUniqueFields(r,a)}}if(e.report.aggregate_functions){s=e.report.aggregate_functions.length;for(i=0;i<s;i++){var n;if("count"!==(n=e.report.aggregate_functions[i]).name){a={full_api_name:n.field.api_name,display_label:n.field.label,ui_type:n.field.ui_type,encrypted:n.encrypted};n.field.data_type&&(a.data_type=n.field.data_type),t.addUniqueFields(r,a)}}}e.apply_date_filter&&(e.report.date_filter=e.date_filter?JSON.parse(e.date_filter):null),e.hierarchy_id&&(e.report.hierarchy_drilldown={drill_by:"user",hierarchy_filter_id:e.hierarchy_id}),e.report.fields=r,e.report.group_by=[],delete e.report.row_group_by,delete e.report.column_group_by,e.report.aggregate_functions=[]}t.addFilterToReport(e,!0),e.formula&&(e.report.formula=JSON.parse(e.formula)),e.sort_by&&(e.report.sort_by={api_name:e.sort_by},e.report.sort_order=e.sort_order?e.sort_order:"asc"),delete e.sort_by,delete e.sort_order,e.report=t.deserializeReport(t.convertToTabular(e.report)),e.drill_down=!0,e.per_page=100,commonUtils.showHideLoadingDiv()},actions:{onError:function(e,t){Lyte.registeredMixins["crm-report-util"].errorPopup(e),t.abort()}}}),Lyte.Router.registerRoute("crm.tab.newReports.schedule-create",{getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatintegrations")],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js","crm-chat-options.js","chat-mixin.js","chat-integ-store.js","slack-setup-store.js","chat-setup-store.js","google-chat.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css","crm-chat-options.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("ChatIntegrationAuthError")],ResourceConstants.CRM)),crmConstants.isGoogle_ChatEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))),e},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.resolvePromises({checkPermission:store.triggerAction("scheduled_report","checkPermission",{action:"checkPermission"})})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(){return{outlet:"#show",component:"crm-scheduled-report"}},actions:{onError:function(e){this.transition.abort();var t=app.prevTransition&&"crm.tab.newReports.index.schedule.list"===app.prevTransition.route?app.prevTransition.queryParams:{status:"active"};return app.prevTransition&&"crm.tab.newReports.index.schedule.list"===app.prevTransition.route?(Lyte.Router.transitionTo({route:"crm.tab.newReports.index.schedule.list",queryParams:t}),Lyte.Router.getRouteInstance().refresh().errorObj=e):Lyte.Router.transitionTo({route:"crm.tab.newReports.index.schedule.list",queryParams:t}).errorObj=e,!1}}}),Lyte.Router.registerRoute("crm.tab.newReports.schedule-edit",{getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatintegrations")],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js","crm-chat-options.js","chat-mixin.js","chat-integ-store.js","slack-setup-store.js","chat-setup-store.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css","crm-chat-options.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("ChatIntegrationAuthError")],ResourceConstants.CRM))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){if(this.getDynamicParam())return Lyte.resolvePromises({scheduledReport:store.findRecord("scheduled_report",this.getDynamicParam())})},afterModel:function(e){e.scheduledReport||(e.scheduledReport=[]),e&&(this.currentModel.scheduledReport=JSON.parse(JSON.stringify(e.scheduledReport[0])),this.currentModel.edit_mode=!0),e.scheduledReport.notification_medium&&"google_chat"===e.scheduledReport.notification_medium&&e.scheduledReport.notify_to&&"space"===e.scheduledReport.notify_to.type&&(e.scheduledReport.notify_to.type="channel"),commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-scheduled-report",data:e}},actions:{onBeforeLoad:function(){if(!Crm.userDetails.permissions.Crm_Implied_Schedule_Reports){var e=Lyte.registeredMixins["crm-report-util"],t={status:403};t.response=JSON.stringify({status:"error",code:"NO_PERMISSION",message:"permission denied",details:{"permissions needed":["Crm_Implied_Schedule_Reports"]}}),this.transition.abort(),e.replaceRouteWithCurrentInstance(),e.errorPopup({readyState:t.readyState,response:t.response,responseText:t.responseText,responseURL:t.responseURL,status:t.status})}},onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),s=document.querySelector("crm-schedule-container");s&&s.component.setData("selectedId",r);var i=Lyte.registeredMixins["crm-report-util"],a=JSON.parse(e.response);a.Reports_Scheduled&&a.Reports_Scheduled&&a.Reports_Scheduled[0]&&"INVALID_DATA"===a.Reports_Scheduled[0].code?(s.component.executeMethod("invalidReport"),t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):a.code&&"NO_PERMISSION"===a.code&&a.details&&a.details.permissions&&"Crm_Implied_View_Reports"===a.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),i.replaceRouteWithCurrentInstance(),i.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}}}}),Lyte.Router.registerRoute("crm.tab.newReports.view",{queryParams:["popup"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.registeredMixins["crm-report-util"].unloadSpecificProperties(this.getDynamicParam()),Lyte.resolvePromises({reportAndFields:store.findRecord("report",this.getDynamicParam()).then((function(e){var t=Lyte.registeredMixins["crm-report-util"].getRequests(e[0]);return{report:e,fields:Lyte.resolvePromises(t)}})),run_response:store.triggerAction("report","run",{action:"run",reportId:this.getDynamicParam()}),chats_settings:networkUtils.lyteInitiateRequest("/crm/v2.2/settings/chats","GET",{skip_load_tab:!0}),saved_report:!0,orgConfigurations:Lyte.resolvePromises(Lyte.registeredMixins["crm-report-util"].getCommonRequests(!1)),activityReportDetails:store.findAll("dummy",{},!1,!1,{url:Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=getSplitReportsData&reportId="+this.getDynamicParam(),method:"POST"})})},afterModel:function(e){if(e.reportAndFields.report){e.report=e.reportAndFields.report[0];var t=Lyte.registeredMixins["crm-report-util"];e.cached_grand_total=t.getGrandTotals(e.report,e.run_response),e.isColumnResized=t.isWidthAvailable(e.report,t),e.orgConfigurations=e.orgConfigurations.orgConfigurations.Reports_Configuration}else e.report={};if(e.chats_settings&&e.chats_settings.chats){for(var r=e.chats_settings.chats,s=r.length,i=0;i<s;i++)if(r[i].active)switch(r[i].type){case"cliq":e.cliq_enabled=!0;break;case"cisco":e.cisco_enabled=!0;break;case"slack":e.slack_enabled=!0;break;case"google_chat":e.google_chat_enabled=!0;break;case"microsoft_teams":e.microsoft_teams_enabled=!0}delete e.chats_settings}return commonUtils.showHideLoadingDiv(),this.transition.errorObject&&"emptyReport"===this.transition.errorObject.code&&(e.emptyExport=this.transition.errorObject),e.activityReportDetails=e.activityReportDetails.dummy,e.activityReportDetails&&"MIGRATION_COMPLETED"===e.activityReportDetails.status&&(e.activityReportDetails.activitiesPostMigrationModules=Lyte.registeredMixins["crm-report-util"].getModulesStringFromActivitiesSPlitModule(e.activityReportDetails.modules),e.activityReportDetails.activitiesPostMigrationReportsLinks=Lyte.registeredMixins["crm-report-util"].getActivitiesSplitModulesReportLinks(e.activityReportDetails.reports)),e.reportAndFields.fields},renderTemplate:function(e,t){if(t.queryParams&&"actpophide"===t.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}return{outlet:"#show",component:"crm-report-view",data:e}},actions:{onError:function(e,t,r){if(r.queryParams&&"actpophide"===r.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}if(this.transition.data.option&&"fromListView"===this.transition.data.option){var s=this.getDynamicParam(),i=document.querySelector("crm-reports-container");i&&i.component.setData("selectedReport",{id:s});var a=Lyte.registeredMixins["crm-report-util"];if((n=JSON.parse(e.response)).Reports&&n.Reports[0]&&"INVALID_DATA"===n.Reports[0].code)i.component.executeMethod("invalidReport"),t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status});else if(n.code&&"NO_PERMISSION"===n.code&&n.details&&n.details.permissions&&"Crm_Implied_View_Reports"===n.details.permissions)this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status};else{t.abort(),a.replaceRouteWithCurrentInstance(),"REPORT_NOT_SUPPORTED"===(n.code?n.code:n.Reports&&n.Reports[0]?n.Reports[0].code:null)&&i?i.component.showOrHideModel("reportNotSupportedAlert",!0):"FIELD_COMPARISON_NOT_SUPPORTED_FOR_MULTICURRENCY"===n.code||"FIELD_LIMIT_EXCEEDED"===n.code||"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"===n.code?a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status,report_name:store.peekRecord("report",s).name,report_id:s}):a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})}}else{var n;"FIELD_COMPARISON_NOT_SUPPORTED_FOR_MULTICURRENCY"===(n=JSON.parse(e.response)).code||"FIELD_LIMIT_EXCEEDED"===n.code||"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"===n.code?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status,report_name:"",report_id:this.getDynamicParam()}:this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}}}},didDestroy:function(){var e=$("#show");thirdPartyUtils.unbindHighcharts(e)}}),Lyte.Router.registerRoute("crm.tab.newReports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_reports.js"],ResourceConstants.CRM),t=["crm-report.js","crm-report-error.js","lyte-sticky.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-report-edit-page.js","crm-report-view-page.js","crm-report-table.js","lyte-tree.js","lyte-carousel.js","lyte-hovercard.js","crux-combo-box.js","crux-criteria-component.js","crux-criteria-conditions.js","crux-criteria-conditions.js","crux-form-component.js","crux-parent-form-component.js","campaign_status_model.js","crm-sort-popup.js","crm-new-report-popup.js","crm-report-generator.js","crm-report-data.js","crm-report-util.js","crm-report-chart-common.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js","crm-territory-common-utils.js","crux-column-list.js","crm-report-category.js","crm-report-helpers.js"];newDashbordsEnabled&&(t.push("crm-analytics-chart.js"),t.push("crm-analytical-component-model.js"));var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient);r=(r=(r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-Reports.css","crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-report.css","crm-report-edit-page.css","crm-report-view-page.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient));var s=["crm-report-popup.css","crm-richtext-resources-less.css","lyte-ui-editor.css","crux-column-list.css","crm-report-category.css"];return newDashbordsEnabled&&s.push("analytics-creation.css"),r=r.concat(networkUtils.returnDependencyFiles(s,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],ResourceConstants.CRMClient)),s=s.concat(["crm-report-category-rtl.css"])),r=r.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),r=e.concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-report-dependencies.js","child_relationship_model.js","Analytics.js","model-crm-report.js"],ResourceConstants.CRMClient)},beforeModel:function(){if(featuresAvailable.NEXTGENUI_ENABLED){var e=Lyte.Router.getRouteInstance().routeName,t=document.querySelector("crm-left-menu").component;t.setData("selectedMenu","reports"),t.actions.showOrHideLeftPane("index"===e||"list"===e)}commonUtils.showHideLoadingDiv(!0)},beforeExit:function(){for(var e in store.unloadAll("field"),store.unloadAll("report_folder"),store.unloadAll("report_chart"),store.unloadAll("dashboard"),store.unloadAll("child_relationship"),store.unloadAll("scheduled_report"),moduleRecordMapping)this.removeTotalCache(e,moduleRecordMapping[e].cvid);delete moduleRecordMapping.Reports.query_params,cruxAssets&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!1,delete cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist)},renderTemplate:function(){return cruxAssets&&Crm.userDetails.multiSelectFilterOptions&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!0,cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist="picklist"),networkUtils.initChart(),{outlet:"#show",html:'<div id="sample"><div>'}},didDestroy:function(){store.unloadAll("report"),-1===Lyte.Router.getRouteInstance().transition.info.route.indexOf("newReports")&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-report.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],ResourceConstants.CRMClient)))},actions:{didTransition:function(){"viewAppointments"===Lyte.Router.getRouteInstance().getQueryParams().action?this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Appointments",!1),Crm.partnerName])):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Reports",!1),Crm.partnerName]))}},lyteConvertionSupported:!0},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.projects",{queryParams:["projectId"],model:function(e){var t={module:"Projects",isload:!0};e.queryParams.projectId&&(t.projId=e.queryParams.projectId,t.tabToShow="dashboard");var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.reports.create",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=newReport";return networkUtils.lyteInitiateRequest(t,"GET",{params:{isload:!0}})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",html:e}},afterRender:function(e,t){crmReports.setHeightWidth(!1),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}}),Lyte.Router.registerRoute("crm.tab.reports.edit",{queryParams:["folderId","repType","isCopyReport"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{};t.isload=!0,t.reportId=this.getDynamicParam();var r=this.getQueryParams();r&&(t.folderId=r.folderId,t.repType=r.repType,t.isCopyReport=r.isCopyReport);var s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=customize","GET",s)},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",html:e}},afterRender:function(e,t){crmReports.customizeReport(this.getQueryParams().repType)}}),Lyte.Router.registerRoute("crm.tab.reports.index",{queryParams:["folder"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=!1;if(this.transition.data&&this.transition.data.show_incompatibility&&(t=!0,Lyte.objectUtils(this.transition.data,"delete","show_incompatibility")),Object.keys(this.transition.data).length){(s=objectUtils.cloneObject(this.transition.data)).isload=!0,this.getQueryParams()&&(validationUtils.isValidNumber(this.getQueryParams().folder)?s.folderId=this.getQueryParams().folder:s.view=this.getQueryParams().folder);var r=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getReports";return{data:networkUtils.lyteInitiateRequest(r,"GET",{params:s}),show_incompatibility:t}}var s={module:"Reports",isload:!0};return this.getQueryParams()&&this.getQueryParams().folder&&(validationUtils.isValidNumber(this.getQueryParams().folder)?s.folderId=this.getQueryParams().folder:s.view=this.getQueryParams().folder),{data:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:s}),show_incompatibility:t}},renderTemplate:function(e){return this.transition.abort(),Utils.windowLocationHref(""),{outlet:Object.keys(this.transition.data).length?"#reportMain":"#show",html:e.data}},afterRender:function(e,t){e.show_incompatibility&&Lyte.registeredMixins["crm-report-util"].errorPopup({status:400,response:'{"status":"error","code":"REPORT_NOT_SUPPORTED"}'},!0),crmReports.renderReports()}}),Lyte.Router.registerRoute("crm.tab.reports.records",{queryParams:["action","stdDateFilter","criteria","module","userId","status","summaryValue","dbItemId","summaryCol","FROM_INDEX","sortCol","orderBy","drill_down","from_hierarchy","title"],beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),!e.queryParams.action){this.transition.abort();var t=networkUtils.returnDependencyFiles(["crm-new-reports-popup.js"],ResourceConstants.CRMClient);Lyte.injectResources(t,void 0,(function(){var e=Lyte.Component.render("crm-new-reports-popup",{},"#reportlookupdiv");e&&e.component.showOrHideModel("drillDownNotSupportedAlert",!0)}))}},model:function(e){var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{},r=this.getQueryParams();return(r=r||{}).reportId=this.getDynamicParam(),t&&t.isAjax&&(r.isAjax=this.isAjax=!0),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ReportsRelatedCV.do","GET",{params:r})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return this.isAjax?e.FAILURE?void renderingUtils.showCustomAlert(parsedData.FAILURE,void 0,!1):{outlet:"#CVTable",html:(0,Handlebars.templates.ReportsRelatedCV)(e)}:{outlet:"#show",html:e}},afterRender:function(e,t){if(this.isFromCall)return $("#reportsPagNation").html(""),void CrmDashboard.setCallsNavigationDiv(e);this.isAjax&&($("#reportsPagNation").html(""),CrmDashboard.setNavigationDiv(e.requestedObj))}}),Lyte.Router.registerRoute("crm.tab.reports.redirect-to-index",{redirect:function(){this.replaceWith("crm.tab.reports.index")}}),Lyte.Router.registerRoute("crm.tab.reports.view",{queryParams:["fromDashboard","folderId","repType","viewtype","type","isrepupdate","repdesc","category","mailtype","entitytype","usertype","periodtype","startdate","enddate","nextpagenum","prevpagenum","customoption","userid","groupid","sort","sortorder","pagenum","catsort","repname","reprunorsave","tempusrsort","datatype","groupbychange","repoption","option","selectedfolder","stdDateFilterField","stdDateFilter","stdageindayscondition","stdageindays","isfrompopup","popup"],getResources:function(e){var t=networkUtils.returnDependencyFiles([networkUtils.includeChartFiles()[0],"zohocrm_analytics.js"],ResourceConstants.CRM);return"email"==e.queryParams.type&&(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_emailStats.js"],ResourceConstants.CRM))),t},beforeModel:function(e){"email"==e.queryParams.type&&$('<div class="pA zeTransparent" style="top:0;bottom:0;left:0;right:0;margin:auto;background-color:transparent"></div>').appendTo("body")},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=objectUtils.cloneObject(this.getQueryParams());(t=t||{}).reportId=this.getDynamicParam();t.reportId&&["list","schedule"].includes(t.reportId)&&(this.transition.abort(),Lyte.Router.transitionTo({route:"crm.tab.reports.index"}));var r=Crm.getCrmBasePath()+"/specific/CustomReport.do?",s="GET";return"email"==t.type?(r=Crm.getCrmBasePath()+"/ShowEmailStats.do",delete t.type,s="POST"):(t.isload=!0,t.actionItem="run"),networkUtils.lyteInitiateRequest(r,s,{params:t})},afterModel:function(){},renderTemplate:function(e,t){return"email"==t.queryParams.type?(crmEmailStats.init(),crmEmailStats.renderReports(e)):(networkUtils.initChart(),{outlet:"#show",html:e})},afterRender:function(e,t){if(t.queryParams&&"actpophide"===t.queryParams.popup){let e=$L("crm-activity-depreciation-banner");e.length>0&&e[0].component.setData("showActBanner",!1)}crmReports.setHeightWidth(!1,!0),"email"!=t.queryParams.type||this.error_key||crmEmailStats.afterRender(e,t.queryParams)},actions:{onError:function(e,t,r){"email"==r.queryParams.type&&t.abort()}}}),Lyte.Router.registerRoute("crm.tab.reports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_reports.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-report-dependencies.js","crm-report.js","crm-report-error.js","crm-folder-sharing.js","lyte-carousel.js","lyte-hovercard.js","crux-combo-box.js","crux-form-component.js","crux-parent-form-component.js","crm-sort-popup.js","crm-new-report-popup.js","crm-report-generator.js","model-crm-report.js","crm-report-util.js","crm-territory-common-utils.js","crm-report-helpers.js"],ResourceConstants.CRMClient);return t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-Reports.css","crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-report.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-report-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],ResourceConstants.CRMClient))),t=e.concat(t)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){"crm.tab.reports"==this.transition.info.route&&this.replaceWith("crm.tab.reports.index")},actions:{didTransition:function(){"viewAppointments"===Lyte.Router.getRouteInstance().getQueryParams().action?this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Appointments",!1),Crm.partnerName])):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Reports",!1),Crm.partnerName]))},willTransition:function(){crmReports.selectedModules=[],crmReports.selectedCount=0}}}),Lyte.Router.registerRoute("crm.tab.requesters.module.create",{beforeModel:function(){var e=this.transition.info.dynamicParams[0];void 0===moduleRecordMapping[e]||moduleRecordMapping[e].visible||this.getFirstRequesterModule()},lyteConvertionSupported:!0,renderTemplate:function(){$L("#show").empty();var e={transitionData:this.transition.data,queryParams:{}};this.qcCallbacks={onSave:function(e,t,r,s){"save"===s&&Lyte.Router.transitionTo("crm.tab.requesters.module.index-module.entity.detail",r.moduleName,e.id)},onCancel:function(e,t){Lyte.Router.transitionTo("crm.tab.requesters.module.index-module",t.moduleName)},updateZindexes:function(){return{preventUpdate:!0}},transitionAbort:function(){return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),!1},onLayoutDropdownSelection:function(e,t){let r=t.transitionData.isWizard?"wizards":"create";$L("crm-quick-entity-setup")[0].closePop(),this.triggerCreatePage(e.moduleName,e.type,r,e.renderLocation,{transitionData:t.transitionData,queryParams:{layoutId:t.layoutId,wizardId:t.wizardId}},this.qcCallbacks)}.bind(this)},this.triggerCreatePage(this.transition.info.dynamicParams[0],"create","create","#show",e,this.qcCallbacks)},triggerCreatePage:function(e,t,r,s,i,a){Lyte.triggerEvent("quickCreate",{moduleName:e,type:t,formType:r,renderLocation:s,routeInfo:i,callbacks:a})},actions:{onBeforeLoad:function(){this.transition.data.isCreate=!0,this.transition.data.isWizard=!(!this.transition.info||!this.transition.info.queryParams.wizardId),this.transition.data.isWizard&&(this.transition.data.wizardId=this.transition.info.queryParams.wizardId)}}},{mixins:["crm-left-menu-util"]}),Lyte.Router.registerRoute("crm.tab.requesters.module.index-module.entity.detail",{getDependencies:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["crm-detail-view-initial-files.js","crm-lookup-parser-mixin.js","features_model.js"],ResourceConstants.CRMClient))},getResources:function(){var e=[],t=this.parent.parent.parent.getDynamicParam();if(this.transition.lyteHeaderSupported=Crm.lyteHeaderNeeded(t),this.transition.renderFullLytePage=Crm.renderDVLyteFlow(t),this.transition.renderFullLytePage&&(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-detail-view.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-lookup-mixin.js","crm-create-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-less.css","crux-user-component.css","crux-user-tooltip.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")],ResourceConstants.CRM))),this.transition.lyteHeaderSupported){var r=networkUtils.returnDependencyFiles(["crm-detailview-header-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=(e=(e=(e=e.concat(r)).concat(networkUtils.returnDependencyFiles(["crm-detailview-header.js","crm-detailview-fields.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-entity-utils.js"],ResourceConstants.CRMClient))}e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-nav.js","phone-entity.js","lyte-hovercard.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-preview.js","crm-image-upload-create.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css"],ResourceConstants.CRMClient))),e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js","crux-image-upload.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-file-upload-component.css","crm-file-upload-component.css","crux-image-component.css","crm-image-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var s=networkUtils.returnDependencyFiles(["zohocrm_fol.js"],ResourceConstants.CRM);if(e=(e=(e=(e=(e=(e=e.concat(s)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FieldOfLookup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-image-mixin.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-attachments.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-related-list-view-header.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-related-list-attachments.css","crm-image-preview.css","crm-related-list-view-header.css"],ResourceConstants.CRMClient)),Crm.userDetails.isRelatedListLyteEnabled){if(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-column-list.js","crux-smart-filter.js","crm-rl-users-list.js","crm-detail-canvas-common-files.js","crm-activity-edit-delete-view-icon-canvas-helpers.js","crm-custom-button-wrapper.js","crm-msg-related-list.js","crm-msg-utils.js","crm-related-list-view.js","sales-navigator.js","crux-note.js","note_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-note.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-relatedlist-checklist.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED){var i=networkUtils.returnDependencyFiles(["crm-related-list-actions-rtl.css"],ResourceConstants.CRMClient);e=e.concat(i)}}else e=e.concat(networkUtils.returnDependencyFiles(["crm_related_list_old_flow.css"],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm_related_list_old_flow_rtl.css"],ResourceConstants.CRM)));if(Crm.userDetails.isConnectedRecordsEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-connected-record.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),Crm.userDetails.timelineRevamp&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.js","crm-timeline-helpers.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM))),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE){var a=[];a=(a=(a=a.concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js","crm-zia-smart-prompt.js","crm-zia-smart-prompt-store.js","note_model.js","lyte-draggable.js","lyte-resize.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SmartPrompt")],ResourceConstants.CRM)),e=e.concat(a)}if(Crm.userDetails.isSubformNewComponentEnabled){e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-subform.css","crux-table-component-v1.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-lookupfilter-component.js","crm-detail-view-subform-component.js","crux-subform.js","crm-detail-view-subform.css"],ResourceConstants.CRMClient))}return e},afterModel:function(e){var t=this.parent.parent.parent.getDynamicParam();return e.entId=this.parent.getDynamicParam(),e.module=t,this.transition.renderFullLytePage?this.afterModelHandler(e):(store.model[moduleRecordMapping[t].id]||store.registerModel(moduleRecordMapping[t].id,{},{extends:"entity"}),store.peekRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam())?void 0:store.findRecord(moduleRecordMapping[t].id,this.parent.getDynamicParam(),{approved:"both"}))},beforeModel:function(){"undefined"==typeof detailView&&(detailView={}),detailView.lyte_headerDataHolder={},this.url=void 0;var e=objectUtils.cloneObject(this.transition.data);e.id=e.id?e.id:this.parent.getDynamicParam(),e.module=e.module?e.module:this.parent.parent.parent.getDynamicParam(),e.format="json";this.transition.isRequesterDV=!0,Crm.origin&&(e.origin=Crm.origin),delete e.cvid,delete e.fromid,delete e.recordNum,delete e.primary_module,delete e.recordId;var t=Crm.getCrmBasePath()+"/ShowEntityInfo.do",r=0;for(var s in e)/\b(calleeObj|clickId)\b/.test(s)||void 0===e[s]||(t+=0===r?"?":"&",t+=s+"="+encodeURIComponent(e[s]),r++);return this.url=t,isRelatedListLoaded=!0,this.fetchDVModuleInfo(e)},fetchDVModuleInfo:function(e){var t={},r=moduleRecordMapping[e.module].id,s=!1,i=!1;store.model[r]||(store.registerModel(r,{},{extends:"entity"}),i=!0),store.modelFor(r)&&store.peekAll(r)&&0!==store.peekAll(r).length||(s=!0,t.module=store.findRecord("module",r)),store.modelFor(r)&&moduleRecordMapping[e.module].fields||(s||(t.module=store.findRecord("module",r)),i=!0);var a=store.peekRecord(r,e.id);!i&&a||(t.moduleRecordInfo_new=store.findRecord(r,e.id,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}),t.moduleRecordInfo_new.then((function(e){return e[0]?e:void 0}),(function(e){murphy.error(e)})));var n=Lyte.resolvePromises(t);return n.then(function(t){var s=store.peekRecord(r,e.id,Crm.get_params_for_getRecord());if(i||!s)return store.findRecord(r,e.id,Crm.get_params_for_getRecord()).then((function(e){return e[0]?e:void 0}),(function(e){murphy.error(e)}))}.bind(this),(function(e){murphy.error(e)})),n},actions:{willTransition:function(){if(void 0!==this.viewPortSettingsDebounce&&Crm.userDetails.isRelatedListLyteEnabled&&(Lyte.Component.viewPortSettings.debounce=this.viewPortSettingsDebounce),LytePopup.components.length>0)for(var e=LytePopup.components,t=e.length,r=0;r<t;r++)e[r].$node.id&&"chat-popup"===e[r].$node.id&&e[r].setData("ltPropBindToBody",!1);var s=$("#zWebSendInvite");s&&s.is(":visible")&&CrmCampaignInteg.hideListView(),Notes.noteContent="";var i=$L("#noteContentTxt");i.length>0&&i.hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("noteContentTxt"),store.unloadAll("zia_insights")}},model:function(){if(!this.transition.renderFullLytePage&&this.transition.lyteHeaderSupported&&!this.transition.lyteReqsSent)var e=this.fetchApiData();var t=this,r=t.parent.parent.parent.getDynamicParam(),s=this.parent.getDynamicParam();return this.transition.renderFullLytePage?this.initiateModelRequests(void 0,void 0,r,s,void 0,void 0,!0):this.url?new Promise((function(r,s){void 0!==e?Lyte.resolvePromises(e).then((function(s){e.detailview_buttons=s.detailview_buttons,e.business_card=s.business_card,e.custom_buttons=s.custom_buttons,detailView.load(t.url,void 0,void 0,"requesterDetailPage",r)})):detailView.load(t.url,void 0,void 0,void 0,r)})):!1===this.doSendRequest?new Promise((function(r,s){void 0!==e?Lyte.resolvePromises(e).then((function(s){e.detailview_buttons=s.detailview_buttons,e.business_card=s.business_card,e.custom_buttons=s.custom_buttons,loadDVWithRp(t.obj,r)})):loadDVWithRp(t.obj,r)})):void 0},renderTemplate:function(e){if(this.transition.renderFullLytePage&&!$L("crm-requester-list-view")[0].getData("requestOnProcess")){return{component:"crm-detail-view",outlet:"#requesterDetailPage"}}return e},afterRender:function(e){if(!this.transition.renderFullLytePage&&this.transition.lyteHeaderSupported&&returnJson&&(returnJson.record_actions=detailView.lyte_headerDataHolder.detailview_buttons?objectUtils.cloneObject(detailView.lyte_headerDataHolder.detailview_buttons):{},returnJson.business_card_meta=detailView.lyte_headerDataHolder.business_card,returnJson.custom_buttons=detailView.lyte_headerDataHolder.custom_buttons?detailView.lyte_headerDataHolder.custom_buttons:{},returnJson.zia_insights=detailView.lyte_headerDataHolder.zia_insights,returnJson.dv_layoutId=detailView.lyte_headerDataHolder.dv_layoutId,returnJson.hideDetailsViewInnerTabs=!0,crmRelatedList.filters={},delete CustomButtonJSObjectInit.checkBox),this.transition.renderFullLytePage){if(v=e.entity_name)_=v+" ("+(_=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label)+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[_,Crm.appName]))}else{if(this.url){if(adSearchClose(),getObj("basic"))0!==(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$L("#basic").scrollTo({axis:"y",duration:1,offset:-50});commonUtils.showHideLoadingDiv(),init(void 0,void 0,void 0,this.transition.lyteHeaderSupported);var t=this.parent.parent.parent.getDynamicParam(),r=this.parent.getDynamicParam();if(returnJson)if(Crm.userDetails.isRelatedListLyteEnabled){if(returnJson.relListLabelsJson){returnJson.layout_jsonarrayObj&&(returnJson.relListLabelsJson.layoutId=returnJson.layout_jsonarrayObj.currLayoutId),this.viewPortSettingsDebounce=Lyte.Component.viewPortSettings.debounce,Lyte.Component.viewPortSettings.debounce=200;var s="#relatedPageContent";"Events"===t&&($L("#eventsRightPanelAttachDiv").length?s="#eventsRightPanelAttachDiv":$L("#eventsRightPanelNotesDiv").length&&(s="#eventsRightPanelNotesDiv"));var i="Events"!==t?"#relatedPageContent":s;Lyte.Component.render("crm-related-list-view",{module:t,entityId:r},i),$L("#remainingList").show()}}else{for(var a=returnJson.relListLabelsJson.relListLabelJson.length,n=[],o=0;o<a;o++)n[o]=returnJson.relListLabelsJson.relListLabelJson[o].name.toLowerCase()+"_"+returnJson.relListLabelsJson.relListLabelJson[o].id;if(crmRelatedList.personalityArr=n.join("||"),returnJson.relListLabelsJson){returnJson.layout_jsonarrayObj&&(returnJson.relListLabelsJson.layoutId=returnJson.layout_jsonarrayObj.currLayoutId);var c=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(c)}}if(!Crm.userDetails.isRelatedListLyteEnabled){if(getObj("messageValue"))var l=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&messageValue="+getObj("messageValue").value;else l=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData";var d=document.getElementById("relNEID"),u="";d&&/^[0-9]+$/.test(d.value)&&(u="&neid="+d.value),l+=u;var m={module:decodeURIComponent(t),id:r,fromIndex:1},p=new crmRequestPool,h={action:l,type:"GET",data:m,success:function(e){crmRelatedList.load(t,r,e,!0)}}}var f={newModel:!0};f.module=t,Crm.executeLayoutRule(this.url,f,"view"),Crm.userDetails.isRelatedListLyteEnabled||p.initiate(h)}else if(!1===this.doSendRequest){var g=$("#detailCView").children().length;if(g<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var y=parseInt(getObj("cvFromIndex").value);$("#from_To").text(y+" - "+(y+g-1))}}var v,_;if(Crm.userDetails.detailView_newUI&&detailView.setCurrentStageSetReload(),v=$("#entityName").val())_=v+" ("+(_=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label)+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[_,Crm.appName]))}var C=$L("#recentItemsModal");C[0]&&C[0].ltProp("show")&&C[0].ltProp("show",!1);var R=$L("crm-requester-list-view")[0];if(!R.getData("requestOnProcess")&&(document.querySelector("crm-left-menu").component.methods.hideContentLoader(),R)){let e=this.parent.getDynamicParam();R.setData("selectedRecordId",e)}},beforeExit:function(){var e=$("#fieldHighlightId").eq(0);e&&e.remove(),"undefined"!=typeof customFunctionsObj&&(customFunctionsObj.listRelationId=null,customFunctionsObj.postRouteProcess());var t=$("#subSecondaryPopup");t.is(":visible")&&t.find("#cancel").trigger("click"),this.transition.data.needClearCache&&(this.transition.data.primary_module?crmTab.deleteFromCache(this.transition.data.primary_module,!0):crmTab.deleteFromCache(this.transition.info.dynamicParams[0],!0));var r=$("#dv-button-layer").find("crm-detailview-header");r&&r[0]&&((r=r[0].component)&&r.getData("record").$.rollBack());if(this.transition.data&&this.transition.data.listeners)for(var s=this.transition.data.listeners.length,i=0;i<s;i++)Lyte.removeEventListener(this.transition.data.listeners[i]);var a=$L("#detailViewUtilAlert");a&&a[0]&&a[0].ltProp("show",!1)},fetchApiData:function(){var e=this.transition.data,t=this.parent.parent.parent.getDynamicParam();e.primary_module=t;var r=this.parent.getDynamicParam();e.recordId=r;var s=store.peekRecord(moduleRecordMapping[t].id,r),i=store.peekRecord("module",moduleRecordMapping[t].id),a=i.api_name,n=null;n=s&&s.Layout?s.Layout.id:i.layouts[0].id;var o={};o.initialPeekRecord=s;var c={moduleSet:!0,peekField:!1};c.layoutId=n;var l=store.peekRecord("layout",n,{module:a});if(l&&l.sections){for(var d=!1,u=l.sections.length,m=0;m<u;m++){var p=l.sections[m];if(p&&"Business Card"===p.api_name){d=!0;break}}o.business_card=d?l:store.findRecord("module",i.id,{},void 0,!0,c).then((function(e){return e[0].layouts.filter((function(e){return e.id===n}))}))}else o.business_card=store.findRecord("module",i.id,{},void 0,!0,c).then((function(e){return e[0].layouts.filter((function(e){return e.id===n}))}));return o.dv_layoutId=n,detailView.lyte_headerDataHolder=o,o}},{mixins:["crm-detailview-common-utils","crm-detailview-parser","crm-create-mixin","crm-create-init-mixin","crm-lookup-mixin","crm-entity-utils","crm-lookup-parser-mixin","crm-detailview-resources-downloader"]}),Lyte.Router.registerRoute("crm.tab.requesters.module.index-module.entity",{beforeModel:function(){if(Lyte.Globals.get("relatedList.scrollToId")||Lyte.Globals.set("relatedList",{module:this.parent.getDynamicParam(),entityId:this.getDynamicParam(),filters:!1,new_social:!1,projectPersonality:{}}),"crm.tab.requesters.module.index-module.entity"===this.transition.target&&"false"!==this.getQueryParams().redirect||!app.prevTransition.route&&"crm.tab.requesters.module.index-module.entity.detail"===this.transition.target){var e=this.parent.parent.getDynamicParam(),t=this,r=moduleRecordMapping[e].id;if(store.modelFor(r)&&moduleRecordMapping[e].fields){var s=this.addDetailViewRequests(moduleRecordMapping[e].id);return Lyte.resolvePromises(s).then((function(e){t.entityCallBack(e)}),(function(r){t.replaceWith({route:"crm.tab.requesters.module.index-module.entity.detail",dynamicParams:[e,t.getDynamicParam()],queryParams:t.transition.info.queryParams}),murphy.error(r)}))}return store.findRecord("module",r).then((function(){var e=t.addDetailViewRequests(r);Lyte.resolvePromises(e).then(t.entityCallBack,(function(e){murphy.error(e)}))}))}},redirect:function(){var e=Lyte.Router.getRouteInstance().parent.parent.parent.getDynamicParam(),t=Lyte.Router.getRouteInstance().parent.getDynamicParam();"entity"===Lyte.Router.getRouteInstance().routeName&&app.prevTransition.dynamicParams.includes(e)&&app.prevTransition.dynamicParams.includes(t)&&(this.replaceWith({route:"crm.tab.requesters.index.module.entity.detail",dynamicParams:[e,t]}).data=this.transition.data)},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-colorbox.js","crm-entity-lookup.js","crm-permission-error.js","crm-detail-view-utils.js","crux-form-component.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-custom-rl.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient)));var r=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-vision-create.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup"),"zohocrm_changeOwner.js","zohocrm_requester.js","zohocrm_ProcessFlow.js",networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM))).concat(t);return r=(r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-global-search.js"],ResourceConstants.CRMClient)),Crm.userDetails.isPhoneNoNewView&&(r=r.concat(Crm.returnPhoneFieldDependencyFiles())),r},addDetailViewRequests:function(e){return{records:store.findRecord(e,this.getDynamicParam(),{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"})}},entityCallBack:function(e){var t=this.parent.parent.getDynamicParam(),r=this.getDynamicParam(),s=this.transition.data;e.records[0]?this.replaceWith({route:"crm.tab.requesters.module.index-module.entity.detail",dynamicParams:[t,r],queryParams:this.transition.info.queryParams}).data=s:this.transition.data.isRecDeleted=!0}}),Lyte.Router.registerRoute("crm.tab.requesters.module.index-module",{beforeModel:function(){var e=document.querySelector("crm-left-menu-loader").component;e.setData("view","requesters"),e.executeMethod("showLoaderBasedOnView",e)},lyteConvertionSupported:!0,model:function(){var e=this.parent.getDynamicParam();return Lyte.resolvePromises({selectedModuleRecord:store.findRecord("module",moduleRecordMapping[e].id,{include:"business_card_fields,layouts,related_lists"})}).then((function(e){return e}))},afterModel:function(e){var t={};t.selectedModuleRecord=e.selectedModuleRecord[0],t.selectedModuleName=this.parent.getDynamicParam(),t.renderFullLytePage=Crm.renderDVLyteFlow(this.parent.getDynamicParam()),this.currentModel=t},renderTemplate:function(e){return networkUtils.initChart(),{outlet:"#show",component:"crm-requesters-container",data:e,reRender:!0}},afterRender:function(e,t,r){r.component.setData("selectedModuleId",moduleRecordMapping[e.selectedModuleName].id)},actions:{onError:function(){if(this.currentModel&&this.currentModel.status&&200!==this.currentModel.status&&201!==this.currentModel.status)return crmHistory.transitionError=!0,this.handleError(this.parent.getDynamicParam()),!1}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.requesters.module",{beforeModel:function(){this.getDynamicParam()},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.tab.requesters",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-requester-components.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-requester-components.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("requesters")],ResourceConstants.CRM))},beforeModel:function(){featuresAvailable.TEAMSPACE_ENABLED&&featuresAvailable.TEAM_MODULE_ENABLED?(document.querySelector("crm-left-menu").component.setData("selectedMenu","requesters"),commonUtils.showHideLoadingDiv(!0)):(this.transition.abort(),renderingUtils.displayPermissionDenied())},renderTemplate:function(){return{outlet:".ts-lftmnu-modules",component:"crm-left-menu-requests"}},afterRender:function(e,t,r){this.transition.target&&"crm.tab.requesters.module.index-module.entity.detail"===this.transition.target||this.transition.data.isCreate||r.component.executeMethod("selectLastAccessedTab")},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.tab.social.dashboard",{renderTemplate:function(){document.getElementById("socialTabNew").openTab("dashboard");var e=$L(".selectedBrand").attr("value"),t=$L(".socConvMsgs").find(".sel").attr("type");if(t||(t=$L("#socInnerTab").find(".socInnerActive")[0].getAttribute("type")),"Convo"===t)this.getFeeds(void 0,e,void 0,void 0,void 0,"dashboard_feeds");else if("Message"===t){$L("crm-social-tab-new")[0].component.getMessages(void 0,e,void 0,void 0,void 0,"dashboard_feeds")}this.getReports()},afterRender:function(){$L(".socChooseBrand").removeClass("dN");var e=$L("crm-social-tab-new")[0].component.methods;e.tabHeight("#socialTabNew"),e.innerTabHeight("#socInnerTab")},beforeExit:function(){this.beforeExitTab()}},{mixins:["crm-social-tab"]}),Lyte.Router.registerRoute("crm.tab.social.log",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-social-activityLog.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-social-tab.js","crm-social-common-mixins.js","crm-social-tab-rl-common.js","crm-social-activity.js"],ResourceConstants.CRMClient)},model:function(){return store.findAll("social_activityLog")},renderTemplate:function(){return{outlet:".zsoActivityContaienr",component:"crm-social-activity-list"}},afterRender:function(){$L(".socChooseBrand").addClass("dN"),document.getElementById("socialTabNew").openTab("log"),$L("crm-social-tab-new")[0].component.methods.tabHeight("#socialTabNew")},afterModel:function(e){var t,r=e;r&&(r.$&&r.$.meta&&(t=r.$.meta.cursor),delete this.currentModel,this.currentModel={},this.currentModel.data=r,this.currentModel.cursor=t)}},{mixins:["crm-social-tab","crm-social-tab_actions"]}),Lyte.Router.registerRoute("crm.tab.social.monitor",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-social-tab.js","crm-social-tab-monitor-column.js","crm-social-tab-entity.js","crm-social-post-detail-outer.js","crm-social-common-mixins.js","crm-social-tab-rl-common.js","crm-social-post-detail.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-social-tab-monitor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);if(Crm.userDetails.RTL_ENABLED){var s=networkUtils.returnDependencyFiles(["crm-social-tab-monitor-rtl.css"],ResourceConstants.CRMClient);e=t.concat(r).concat(s)}else e=t.concat(r);return e},model:function(){var e={brand_id:$L(".selectedBrand").attr("value")};return store.findAll("monitor_column",e)},afterModel:function(e){var t=$L(".selectedBrand").attr("value"),r=Lyte.registeredMixins["crm-social-tab"];this.currentModel=r.processFilters(e,t)},renderTemplate:function(){return{outlet:"#socMonitorContent",component:"crm-social-tab-filter-inner"}},afterRender:function(e){$L(".socChooseBrand").removeClass("dN"),document.getElementById("socialTabNew").openTab("monitor"),$L("crm-social-tab-new")[0].component.methods.tabHeight("#socialTabNew"),$L("#socMonitorContent").removeClass("dN");var t=0,r=$L(".selectedBrand").attr("value");$.each(e.monitor_column,(function(e,t){Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},"#"+t.type+"_"+t.network+"_column_lists_"+t.id)}));var s=this;$.each(e.monitor_column,(function(e,i){null!==s.getAccountByBrandIdAndNetwork(r,i.network)&&++t<5&&s.getFilterFeeds(i,r)})),e.monitor_column.length?this.setMonitorContentWidth():$L("#socMonitorEmpty").removeClass("dN")},beforeExit:function(){this.beforeExitTab()}},{mixins:["crm-social-tab","crm-social-tab_actions"]}),Lyte.Router.registerRoute("crm.tab.social.posts",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-social-tab.js","crm-social-tab-posts-column.js","crm-social-posts.js","crm-social-common-mixins.js","crm-social-tab-rl-common.js"],ResourceConstants.CRMClient)},model:function(){var e=$L(".selectedBrand").attr("value");return this.getNetworkBrandJson(e)},afterModel:function(e){var t={},r=store.peekAll("Social");r&&!0===r[0].social_admin&&(t.can_post=!0),t.networks=e,this.currentModel=t},renderTemplate:function(){return{outlet:".socPostContent",component:"crm-social-my-posts-outer"}},afterRender:function(e){$L(".socChooseBrand").removeClass("dN"),document.getElementById("socialTabNew").openTab("posts");var t=$L(".selectedBrand").attr("value"),r=$L(".socNwPostsLists"),s=r.find(".socColumnHeading").outerHeight();$.each(e.networks,(function(e,t){Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},"#"+t.info.network+"_my_col_posts")})),r.length&&r.find(".socColumnContent").css("height","calc(100% - "+s+"px)");var i=this.getNetworkJsonByBrandId(t);if(1===e.networks.length)r.addClass("socNwPostsListsSingle");else if(2===i.length)r.addClass("w49_per");else{var a=Math.round(Utils.windowOuterWidth/i.length-20);r.css("width",a)}var n=this;$.each(e.networks,(function(e,r){n.getMyPosts(void 0,t,void 0,r.info.network,"social_post_tab")})),$L("crm-social-tab-new")[0].component.methods.tabHeight("#socialTabNew")},beforeExit:function(){this.beforeExitTab()}},{mixins:["crm-social-tab","crm-social-tab_actions"]}),Lyte.Router.registerRoute("crm.tab.social",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-social-tab-models.js","crm-social-report-models.js","crm-social-models.js","crm-social-setup-models.js","crm-social-common-models.js","crm-social-common.js","crm-social.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-social-tab-report.js","crm-social-report-models.js","crm-social-tab-entity.js","crm-social-post-detail-outer.js","crm-social-helper.js","crm-social-common-mixins.js","crm-social-tab-new.js","crm-social-post-detail.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-social-tab.css","crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["crm-social-common.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient)),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social"),networkUtils.getI18nJSUrl("richtext"),networkUtils.getI18nJSUrl("Notes")],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles(["zohocrm_crm_formulainit.js","zohocrm_module_settings_common.js","zohocrm_integration_home.js"],ResourceConstants.CRM),a=Crm.returnPhoneFieldDependencyFiles();if(Crm.userDetails.RTL_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-social-common-rtl.css","crm-social-tab-rtl.css"],ResourceConstants.CRMClient);e=r.concat(n).concat(s).concat(t).concat(i).concat(a)}else e=r.concat(s).concat(t).concat(i).concat(a);return e},model:function(){Crm.userDetails.isSandbox&&"true"===localStorage.getItem("social_inprogress_"+Crm.userDetails.ZGID)&&(crmui.showMsgBand("error",I18n.getMsg("crm.social.deployment.inprogress"),3e3),this.transition.abort()),Crm.isRebrandingEnabled?this.setTitle(moduleRecordMapping.Social.plural_label+" - "+Crm.productBrandName):document.title=I18n.getMsg(moduleRecordMapping.Social.plural_label)+" - Zoho CRM";var e=Crm.userDetails.USER_ID,t=userInfo.users.find((t=>t.id===e)).profile.id;if(!(Crm.userDetails.PROFILE_ID===t))return renderingUtils.displayPermissionDenied(),!1;var r=store.findAll("Social",void 0,void 0,void 0,"get_social"),s=store.findAll("crm_social_brand",{isSetup:!1}),i=store.triggerAction("Social","popup_status");return Lyte.resolvePromises({deskDetails:r,brandDetails:s,bannerInfo:i})},afterModel:function(e){if(void 0!==e){var t=e.brandDetails.$.meta;if(void 0!==e.brandDetails)if(e.brands=e.brandDetails,delete e.brandDetails,e.brands.length>t.brand_limit)this.currentModel={start_page:!0,social_admin:t.social_admin,render:e.bannerInfo};else{var r=[],s=[];$.each(e.brands,(function(e,t){$.each(t.accounts,(function(e,t){s.push(t)}))})),e.accounts=s,$.each(e.brands,(function(t,s){$.each(e.accounts,(function(e,t){if(t.brand&&t.brand.id===s.id)return r.push(s),!1}))}));var i=r,a={};if(i.length>0){$.each(e.accounts,(function(e,t){t.brand&&t.brand.id===i[0].id&&(a[t.network]=t.id)}));var n=[{value:"Leads",name:moduleRecordMapping.Leads.singular_label},{value:"Contacts",name:moduleRecordMapping.Contacts.singular_label},{value:"Potentials",name:moduleRecordMapping.Potentials.singular_label},{value:"Customers",name:I18n.getMsg("crm.nsocial.customers")},{value:"Accounts",name:moduleRecordMapping.Accounts.singular_label},{name:I18n.getMsg("crm.social.lead.opp"),value:"Unknown"}];this.currentModel={brands:i,accounts:e.accounts,filter:n,network:a,social_admin:t.social_admin,configered_desk_detials:e.deskDetails[0].configered_desk_detials,render:e.bannerInfo}}else this.currentModel={start_page:!0,social_admin:t.social_admin}}}},renderTemplate:function(){return{outlet:"#show",component:"crm-social-tab-new"}},afterRender:function(e,t){if(0===t.length){var r=document.createElement("crm-social-tab-new");r.setData({start_page:!0,social_admin:e.social_admin}),document.getElementById("show").innerHTML="",$L("#show").append(r);var s=$L("#socDashInitPage");$L("#socialDashboard").css("height","calc(100vh - "+remainHgt+"px)"),s.length&&s.css("top",topVal+"px")}var i=networkUtils.returnDependencyFiles(["crm-social-tab.js","crm-social-tab-rl-common.js"],ResourceConstants.CRMClient),a=this;Lyte.injectResources(i,void 0,(function(){if(store.unloadAll("Social"),e.id||(e.id=Math.floor(1e5*Math.random()+1)),store.pushPayload("Social",e),(t=e.brands).length>0){void 0!==e.configered_desk_detials&&e.configered_desk_detials.desk_department&&crmNTCDetailView.populateSupportIntegDetails(),a.getReports();var r=t[0].name;$L(".selectedBrand").html($ESAPI.encoder().encodeForHTML(r)),a.renderReauthAccounts(!0,e)}!0===e.social_admin&&e.render&&e.render.social_popup_status&&e.render.social_popup_status.enabled&&!0===e.render.social_popup_status.enabled&&Lyte.Component.render("crm-social-marketing-popup",{service:"Zoho Social"},"#social_sidebar"),a.appendDepartment(e.configered_desk_detials)}))},actions:{onError:function(e){switch((e.responseJSON?e.responseJSON:e.response?JSON.parse(e.response):e).code){case"SOCIAL_PERMISSION_DENIED":crmui.showMsgBand("error",I18n.getMsg("crm.creator.error.access"),3e3);break;case"INTERNAL_ERROR":crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3);break;case"NO_PERMISSION":renderingUtils.displayPermissionDenied()}return!1}},beforeExit:function(){this.beforeExitTab()}},{mixins:["crm-social-tab"]}),Lyte.Router.registerRoute("crm.tab.voc.analytics.view",{getResources:function(){return networkUtils.returnDependencyFiles(["voc-create-modal.css","voc-components.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)},beforeModel:function(){this.transition.data&&this.transition.data.refresh&&this.parent.parent.refresh();var e=store.peekAll("voc_configurations"),t=store.peekAll("voc_source"),r={configurations:e&&e.length?Promise.resolve(e):store.findAll("voc_configurations"),integrations:t&&t.length?Promise.resolve(t):store.findAll("voc_source")};let s=store.peekAll("module");return r.modules=s&&s.length>0?s:store.findAll("module"),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises(r).then(function(r){if(e=r.configurations,t=r.integrations,!e||!e.length)throw{status:204,message:"no module configurations"}}.bind(this))},checkAndAddDashboardErrors:function(e,t,r,s){var i={call_analytics_dashboard:"Calls"},a=s.filter((function(t){return i.hasOwnProperty(e.api_name)&&i[e.api_name]===t.api_name&&t.visible&&t.viewable}));if(e.feature_dependency&&e.feature_dependency.feature&&!e.feature_dependency.feature.active){var n=this.featureDepDetails[e.feature_dependency.feature.api_name];r.errorMsg=I18n.getMsg("voc.error.dashboard.feature.dependency.not.available",[Crm.getCrmBasePath()+n.feature_url,I18n.getMsg(n.labelKey)]),r.showHeader=!1,r.isError=!0}else if(i.hasOwnProperty(e.api_name)&&a&&0===a.length)r.isError=!0,r.errorMsg=I18n.getMsg("voc.dashboard.access.permission.denied");else if(e.computations&&e.computations.length){var o=e.computations.slice(-1)[0];if(o.voc_configuration){var c=t.filter((e=>e.id===o.voc_configuration.id))[0].primary_module_configuration.module.api_name;r.supportedModules.mapByKey("api_name").includes(c)||(r.isError=!0,r.errorMsg=I18n.getMsg("voc.dashboard.access.permission.denied"))}}else{r.isError=!0,store.peekAll("voc_source").filter((e=>!0===e.integrated))[0]&&(!r.selectedDashboard.feature_dependency||"Zoho_Survey_Intergration"!==r.selectedDashboard.feature_dependency.feature.api_name&&r.selectedDashboard.feature_dependency.feature.active)&&!r.selectedDashboard.modified_time?r.errorMsg=I18n.getMsg("voc.dashboard.no.computations.with.active.source"):r.errorMsg=I18n.getMsg("voc.dashboard.no.computations")}},displayUnsavedChangesAlert:function(){commonUtils.showHideLoadingDiv();const e=document.querySelector("#tabSwitch");e.ltProp("transition",{animation:"slideFromTop",duration:"0"}),e.ltProp("showCloseButton",!1),e.ltProp("show",!0)},model:function(e){var t=e.dynamicParam,r=store.peekRecord("voc_dashboard",t);if(!r)throw{status:404,message:I18n.getMsg("voc.invalid.component.operation.error")};var s={components:store.findAll("voc_component",null,t,!0,{version:"6.1",dashboardId:t}),forecast:r.feature_dependency&&"forecasts"===r.feature_dependency.feature.api_name.toLowerCase()?store.findAll("Forecast"):null,compAndDashboardLimit:store.findAll("dummy",{},void 0,!1,{url:"crm/v2.2/__features?api_names=voc_component_limit,voc_dashboard_limit"})};0===Object.keys(Lyte.registeredMixins["voc-route-mixin"].cachedAnalyticComponentMeta).length&&(s.compMeta=store.findAll("dummy",{},void 0,!1,{url:"crm/voc/v6/settings/analytics_component_meta"})),s.chatExtns=0===store.peekAll("chat_setting").length?store.findAll("chat_setting",{},!0,!0):store.peekAll("chat_setting");var i=this;return Lyte.resolvePromises(s).then((function(e){var t=store.peekAll("voc_configurations"),s=store.peekAll("voc_source"),a=store.peekAll("module"),n=e.components;e.compMeta&&(Lyte.registeredMixins["voc-route-mixin"].cachedAnalyticComponentMeta=e.compMeta);var o,c=Lyte.registeredMixins["voc-customisation-mixin"].formCompProp(Lyte.registeredMixins["voc-route-mixin"].cachedAnalyticComponentMeta),l=Lyte.registeredMixins["voc-customisation-mixin"].getChatConfig(e.chatExtns);e.forecast&&(o=e.forecast);var d={},u=i.getVocConfigurationDetails(t),m=i.getVocSupportedModulesData(a,u,"feature"===r.category,r.feature_dependency?r.feature_dependency.feature.api_name:null);return d.isDefault="normal"===r.category,d.selectedDashboard=r,d.supportedModules=m,d.components=n,d.isError=!1,d.supportedSources=s.filter((e=>e.integrated)),d.showHeader=!0,d.chartCompProps=c.chartCompProps,d.componenttypes=c.componenttypes,d.visTypeVsCons=c.visTypeVsCons,d.activeChatExtns=l.activeExtns,d.isCliqAuthorized=l.isCliqAuthorized,"feature"===r.category?i.checkAndAddForecastDashboardErrors(r,u,o,d,t):i.checkAndAddDashboardErrors(r,t,d,a),e.compAndDashboardLimit&&e.compAndDashboardLimit.__features.forEach((function(e){if("voc_component_limit"===e.api_name)d.isAddComponent=n.length<e.details.limits.total&&d.supportedModules.length>0;else{let t=getElemById("crmvocdashboardlist").component;t.setData("dashboardTypeVsDashbaords",t.executeMethod("getDashboardTypeVsDashboards",store.peekAll("voc_dashboard")));let r=t.data.dashboardTypeVsDashbaords.customDashboards.dashboards.length<e.details.limits.total;if(t.setData("createDashboardAvailable",r),t.setData("dashboardTitle",r?I18n.getMsg("crm.label.dashboard.create"):I18n.getMsg("voc.dashboard.limit.tooltip")),this.data&&this.data.isFromOtherFeature)return;let s=getElemById("crmvocdashboardlist").component;s.data.createDashboardAvailable&&d.supportedModules&&0===d.supportedModules.length&&s.setData({createDashboardAvailable:!1,dashboardTitle:I18n.getMsg("voc.dashboard.module.permission.tooltip.info")})}})),d}),(function(e){var t=store.peekAll("module"),s=store.peekAll("voc_configurations"),a=i.getVocConfigurationDetails(s),n=i.getVocSupportedModulesData(t,a,"FEATURE"===r.category,r.feature_dependency?r.feature_dependency.feature.api_name:null),o=I18n.getMsg("error.unknown.problem");if(400===e.status&&e.responseText.includes("INVALID_DATA"))throw e;if(e.status>=400&&e.status<500)o=Lyte.registeredMixins["voc-analytics-mixin"].getApiErrorMsg(null,JSON.parse(e.response));else if(500===e.status)throw e;return{isError:!0,errorMsg:o,selectedDashboard:r,showHeader:!1,supportedModules:n,supportedSources:store.peekAll("voc_source").filterWithLimit((e=>e.integrated))}}))},afterModel:function(e,t){var r=document.getElementsByTagName("crm-voc-module-container")[0];r&&(r.component.setData("selectedDashboard",t.dynamicParam),r.component.setData("isV5Enabled",!crmConstants.isVocFlowMigrated||e.isV5Enabled)),e.isError||e.selectedDashboard.computations&&(e.computationalStatus=e.selectedDashboard.computations.length>1?"in_progress":"default")},actions:{onError:function(e,t){if(500===e.status){$L("crm-voc-module-container")[0].component.setData("error",!0),$L("#vocErrorDiv")[0].innerHTML="";var r=I18n.getMsg("voc.load.error");Lyte.Component.render("crm-voc-error-page",{message:r,isRefresh:!0},"#vocErrorDiv")}else if(401===e.status||403===e.status)crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")}),void 0);else if(204===e.status&&"no module configurations"===e.message)$L("crm-voc-module-container")[0].component.setData("error",!0),commonUtils.showHideLoadingDiv(!1);else if(404===e.status||400===e.status&&e.responseText.includes("dashboard id")&&e.responseText.includes("seems to be invalid"))if(e.message){var s={success:()=>{Lyte.Router.transitionTo({route:"crm.tab.voc.analytics"})},successParams:[]};Lyte.registeredMixins["voc-analytics-mixin"].showAlertForVoc("error",{secondaryMessage:e.message},s)}else Lyte.registeredMixins["voc-customisation-mixin"].handleInvalidOperationErrors(JSON.parse(e.response),this.getDynamicParam());else e.response&&this.handleError(JSON.parse(e.response));t.abort()},willTransition:function(e){const t=$L("#vocdashbaordBuilder")[0];t&&t.component&&(t.component.data.nameEdited||t.component.data.componentAdded)&&(e.pause(),t.setData({transition:e}),this.displayUnsavedChangesAlert());var r=$L("#listViewPopup")[0];r&&r.component.closeModal()},didTransition:function(){document.getElementsByClassName("lyteModalOpened").forEach((function(e){e.component.setData("ltPropShow",!1)})),document.getElementsByClassName("lyteAlertOpened").forEach((function(e){e.component.setData("ltPropShow",!1)})),this.transition.data&&this.transition.data.key&&Crm.client_tracking(this.transition.data.key,{page:this.transition.data.page})}},renderTemplate:function(){return{outlet:"#vocRightPanel",component:"crm-voc-dashboard",reRender:!0}},afterRender:function(e,t){var r=$L("#vocDashboardViewGridStack");r.length>0&&r.scrollTo({left:0,top:0}),this.transition.data.clonedCompId&&Lyte.triggerEvent("highlightComponent",{id:this.transition.data.clonedCompId});let s=e.selectedDashboard.system_generated?e.selectedDashboard.api_name:"User Dashboard";Crm.client_tracking("VOC - Dashboard Access",{type:s,origin:this.transition.data&&this.transition.data.redirectedFrom?this.transition.data.redirectedFrom:void 0}),commonUtils.showHideLoadingDiv(!1)},didDestroy:function(){this.dropVocRelatedCache(),Lyte.registeredMixins["voc-analytics-mixin"].cachedSurveyData=[],Lyte.registeredMixins["voc-route-mixin"].cachedAnalyticComponentMeta={}}},{mixins:["voc-route-mixin"]}),Lyte.Router.registerRoute("crm.tab.voc.analytics",{getResources:function(){var e=networkUtils.returnDependencyFiles(["voc-chart-utils.js","voc-dashboards.js","voc-components.js","crm-help-link.js","lyte-hovercard.js","crux-criteria-component.js","crux-criteria-conditions.js","crm-ui-loaders.js","crm-analytics-view-page.js","crm-analytical-component-model.js","crm-zia-feedback.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-ui-loaders.css","voc-dashboards.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){var e=this;if(!this.transition.data.errorData){if(Crm.isDataSourceSettingsAvailable)return store.unloadAll("voc_source_setting"),Lyte.resolvePromises({data_source:store.findAll("voc_source_setting"),voc_sources:store.findAll("voc_source")}).then((function(t){var r=[];t.data_source.forEach((function(e){r.push(e.integration.name)})),t.voc_sources.some((function(e){return e.integrated&&r.includes(e.source)}))||($L("crm-voc-module-container")[0].component.setData("error",!0),$L("#vocErrorDiv")[0].innerHTML="",Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.data.source.not.available")},"#vocErrorDiv"),e.transition.abort())}));var t=["Zoho Mail","Zoho Desk","Zoho Survey"];return store.findAll("voc_source").then((function(r){(r=r.filter((function(e){return"social"!==e.source&&"notes"!==e.source}))).some((function(e){return e.integrated}))||($L("crm-voc-module-container")[0].component.setData("error",!0),$L("#vocErrorDiv")[0].innerHTML="",Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.data.source.not.available.old",t.toString())},"#vocErrorDiv"),e.transition.abort())}))}$L("crm-voc-module-container")[0].component.setData("error",!0),$L("#vocErrorDiv")[0].innerHTML="","NOT_SUPPORTED"===this.transition.data.errorData?Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("crm.setup.feature.not.supported")},"#vocErrorDiv"):"FEATURE_DISABLED"===this.transition.data.errorData&&Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.disable.error.message",Crm.getCrmBasePath()+"/settings/voice-of-customer")},"#vocErrorDiv"),e.transition.abort()},redirect:function(){this.transition.data&&this.transition.data.refresh?this.parent.refresh():"crm.tab.voc.analytics"===this.transition.target&&(this.replaceWith("crm.tab.voc.analytics.view",store.peekAll("voc_dashboard")[0].id).data=this.transition.data)},actions:{onError:function(e,t){400===e.status&&e.responseText.includes("is not supported in your current edition")||e.responseText.includes("the feature is currently in disabled state")?this.transition.abort():500===e.status?($L("#vocErrorDiv")[0].innerHTML="",$L("crm-voc-module-container")[0].component.setData("error",!0),Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.load.error"),isRefresh:!0},"#vocErrorDiv")):this.handleError(JSON.parse(e.response)),t.abort()}}},{mixins:["voc-route-mixin"]}),Lyte.Router.registerRoute("crm.tab.voc.promo",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocsetup")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["lyte-scrollspy.js","lyte-sticky.js","voc-get-started.js","crm-help-link.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["voc-get-started.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(r).concat(e)},beforeModel:function(){window.isSandboxAcc&&"true"===window.isSandboxAcc?(renderingUtils.displayPermissionDenied(),this.transition.abort()):crmTab&&crmTab.showVocPromoTab||this.replaceWith("crm.tab.voc.analytics")},model:function(){return{}},afterRender:function(){this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName])),Crm.client_tracking("VOC Promo Tab Clicked");var e={plural_label:I18n.getMsg("Voice of the Customer"),module_name:"Voice of the Customer",visibility:1,visible:!0,viewable:!0,show_as_tab:!0,route:"crm.tab.voc",icon:"voiceofthecustomer"};if(featuresAvailable.NEXTGENUI_ENABLED){var t=document.querySelector("crm-left-menu-modules");t&&t.component&&(t.component.setData({selectedModule:e,previouslySelectedModule:e.module_name}),t.component.methods.addActiveClassForSelectedModule(t.component))}else document.getElementsByTagName("crm-tab")[0].setData({selected:e,vocPromoSelected:!0})},renderTemplate:function(){return{outlet:"#show",component:"crm-voc-get-started-wrapper"}}}),Lyte.Router.registerRoute("crm.tab.voc",{getDependencies:function(){if(!crmTab||!crmTab.showVocPromoTab)return networkUtils.returnDependencyFiles(["voc-dependencies-store.js","voc-dashboard-store.js","voc-component-store.js","crm-forecast-datastore.js","crm-forecast-category.js","voc_configuration.js","voc-user-preference.js"],ResourceConstants.CRMClient)},getResources:function(){if(!crmTab||!crmTab.showVocPromoTab){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("voccommon"),networkUtils.getI18nJSUrl("voc"),networkUtils.getI18nJSUrl("voccustomization")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["voc-feedback.js","voc.js","voc-common-utils.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","gamescope-grid.js","crux-form-component.js","crux-parent-form-component.js","voc-common-store.js","lyte-code-snippet.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["voc.css","lyte-ui-code-snippet.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(r).concat(e)}},beforeModel:function(){"crm.tab.voc"===this.transition.target&&crmTab&&crmTab.showVocPromoTab&&this.replaceWith("crm.tab.voc.promo")},model:function(){if(!crmTab||!crmTab.showVocPromoTab)return Lyte.resolvePromises([store.findAll("voc_dashboard"),store.findAll("features",{api_names:"voc_dashboard_limit"},!0,!0),store.findAll("voc_user_preference",{},!0,!0)])},afterModel:function(){if(!crmTab||!crmTab.showVocPromoTab){var e=this.currentModel[0];e||(e=[{voc_component_limit:10,voc_dashboard_limit:2}]),this.currentModel=Object.assign({},{dashboardData:e})}},renderTemplate:function(){if(!crmTab||!crmTab.showVocPromoTab)return{outlet:"#show",component:"crm-voc-module-container"}},afterRender:function(){if(!crmTab||!crmTab.showVocPromoTab){this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName]));var e=moduleRecordMapping[moduleRecordMapping["Voice Of Customer"]?"Voice Of Customer":"Voice of the Customer"];if(featuresAvailable.NEXTGENUI_ENABLED){var t=document.querySelector("crm-left-menu-modules");t&&t.component&&(t.component.setData("selectedModule",e),t.component.setData("previouslySelectedModule",e.module_name),t.component.methods.addActiveClassForSelectedModule(t.component))}else document.getElementsByTagName("crm-tab")[0].setData("selected",e);Crm.client_tracking("VOC tab clicked")}},beforeExit:function(){store.unloadAll("voc_source"),store.unloadAll("dummy"),store.unloadAll("voc_dashboard"),store.unloadAll("voc_component"),window.drp=void 0},redirect:function(){crmTab&&crmTab.showVocPromoTab||"crm.tab.voc"!==this.transition.target||this.replaceWith("crm.tab.voc.analytics")},actions:{onError:function(){if(400===this.currentModel.status)this.currentModel.responseText.includes("is not supported in your current edition")?this.transition.data={errorData:"NOT_SUPPORTED"}:this.currentModel.responseText.includes("the feature is currently in disabled state")&&(this.transition.data={errorData:"FEATURE_DISABLED"}),this.transition.resume();else if(this.currentModel&&this.currentModel.status&&200!==this.currentModel.status&&201!==this.currentModel.status)return crmHistory.transitionError=!0,this.handleError(this.getDynamicParam()),!1}}},{mixins:["crm-view-utils"]});
