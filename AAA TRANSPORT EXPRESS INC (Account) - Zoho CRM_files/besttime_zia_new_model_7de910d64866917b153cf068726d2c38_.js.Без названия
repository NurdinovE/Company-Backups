store.registerModel("besttime_zia_new",{dateInMS:Lyte.attr("number"),inputDate:Lyte.attr("string"),id:Lyte.attr("string"),module:Lyte.attr("string"),bestTime_call:Lyte.attr("array"),bestTime_text:Lyte.attr("array"),bestTime_all:Lyte.attr("array")}),store.registerAdapter("besttime_zia_new",{namespace:"crm/di/",headersForRequest:function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return"undefined"!=typeof crmZgid&&crmZgid&&(e["X-CRM-ORG"]=crmZgid),e},buildURL:function(e,t,r,i,a){return a=a.replace("besttime_zia_new","besttime")}}),store.registerSerializer("besttime_zia_new",{payloadKey:function(e){return e},normalizeResponse:function(e,t,r){var i="ALL-NOWEB"===r.type,a=!!r.type&&"call"===r.type.toLowerCase(),s={id:r.id,dateInMS:r.day,inputDate:this.getInputDate(r.day)},m=r.besttime;return m?i?(s.bestTime_call=this.getBestTimeArrayNew(m,"call"),s.bestTime_text=this.getBestTimeArrayNew(m,"text")):a?s.bestTime_call=this.getBestTimeArrayNew(m,"call"):s.bestTime_text=this.getBestTimeArrayNew(m,"text"):(r.besttime=[],s.besttime=[]),r[e]=s,r},getInputDate:function(e){var t=$L.moment().toDate(),r=$L.moment(e).toDate();return Utils.dateEquals(r,t)?I18n.getMsg("Today"):r-t<864e5&&t<r?I18n.getMsg("Tommorow"):I18n.getMsg(crmBstTime.days[r.getDay()])+", "+I18n.getMsg(crmBstTime.months[r.getMonth()])+" "+r.getDate()},getBestTimeArrayNew:function(e,t){for(var r=e.length,i=[],a=0;a<r;a++)if(e[a].type===t){var s=e[a],m={weight:s.score,bestTimeDate:$L.moment(s.timestamp.substring(0,s.timestamp.length-5)).toDate(),reminder:s.reminder};i.push(m)}i.sort(crmBstTime.sortDateBestTime);var n=[],o=i.length,g="hh:mm a"===Crm.userDetails.TIME_FORMAT;for(a=0;a<o;a++){var l={bestTime:crmBstTime.getFormattedTime(g,i[a].bestTimeDate),level:crmBstTime.getLevel(i[a].weight),dateTime:i[a].bestTimeDate,reminder:i[a].reminder};n.push(l)}return n}});
