Lyte.Component.register("lyte-counter",{_template:'<template tag-name="lyte-counter"> <div class="counterDiv {{ltPropClass}}" tabindex="{{ltPropTabIndex}}" data-tabindex="{{ltPropDataTabIndex}}"> <span class="counterNegative">{{negative}}</span> <span class="counterPrefix">{{ltPropPrefix}}</span> <span class="counterValue">{{result}}</span> <span class="counterSuffix">{{ltPropSuffix}}</span> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"text",position:[1,3,0]},{type:"text",position:[1,5,0]},{type:"text",position:[1,7,0]}],_observedAttributes:["ltPropStart","ltPropEnd","ltPropPrefix","ltPropSuffix","ltPropDecimals","ltPropDuration","ltPropUseEasing","ltPropUseGrouping","ltPropSeparator","ltPropDecimalSeparator","ltPropState","ltPropClass","ltPropAria","ltPropAriaAttributes","ltPropTabIndex","ltPropDataTabIndex","negative","startValue","endValue","result"],data:function(){return{ltPropStart:Lyte.attr("number",{default:0}),ltPropEnd:Lyte.attr("number",{default:0}),ltPropPrefix:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","prefix","")}),ltPropSuffix:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","suffix","")}),ltPropDecimals:Lyte.attr("number",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","decimals",0)}),ltPropDuration:Lyte.attr("number",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","duration",2)}),ltPropUseEasing:Lyte.attr("boolean",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","useEasing",!0)}),ltPropUseGrouping:Lyte.attr("boolean",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","useGrouping",!0)}),ltPropSeparator:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","separator",",")}),ltPropDecimalSeparator:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","decimalSeparator",".")}),ltPropState:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","state","")}),ltPropClass:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-counter","class","")}),ltPropAria:Lyte.attr("boolean",{default:!1}),ltPropAriaAttributes:Lyte.attr("object",{default:{}}),ltPropTabIndex:Lyte.attr("number",{default:0}),ltPropDataTabIndex:Lyte.attr("number",{default:0}),negative:Lyte.attr("string",{default:""}),startValue:Lyte.attr("number",{default:0}),endValue:Lyte.attr("number"),result:Lyte.attr("string")}},didConnect:function(){if(this._rAFId&&window.cancelAnimationFrame(this._rAFId),this._initialized=!1,""===this.getData("seperator")&&this.getData("ltPropUseGrouping",!1),null==this.getData("ltPropEnd"))throw new TypeError('"endValue" is null or not defined');if(!this.checkForNumber(Number(this.getData("ltPropStart"))))throw new TypeError('"Start Value" is not a number');if(!this.checkForNumber(Number(this.getData("ltPropEnd"))))throw new TypeError('"End Value" is not a number');this._startVal=Number(this.getData("ltPropStart")),this._endVal=Number(this.getData("ltPropEnd")),delete this._startTime,delete this._paused,this.initialize(),"START"==this.getData("ltPropState").toUpperCase()&&this.start()},ariaObserver:function(t){this.getData("ltPropAria")&&_lyteUiUtils.setAttribute(this.$node.querySelector(".counterDiv"),this.getData("ltPropAriaAttributes")||{},{})}.observes("ltPropAriaAttributes").on("didConnect"),stateObs:function(){"START"==this.getData("ltPropState").toUpperCase()?this.start():"RESET"==this.getData("ltPropState").toUpperCase()?this.reset():"PAUSE"==this.getData("ltPropState").toUpperCase()?this._initialized&&(this._paused=!0,cancelAnimationFrame(this._rAFId)):"RESUME"==this.getData("ltPropState").toUpperCase()&&this._paused&&this.resume()}.observes("ltPropState"),updateObs:function(){this._endVal=Number(this.getData("ltPropEnd")),"Running"==this.getData("ltPropState")&&this.update(this.getData("ltPropEnd"))}.observes("ltPropEnd"),startObs:function(){this._rAFId&&window.cancelAnimationFrame(this._rAFId),this._initialized=!1,this._startVal=Number(this.getData("ltPropStart")),this._endVal=Number(this.getData("ltPropEnd")),delete this._startTime,delete this._paused,this.initialize()}.observes("ltPropStart"),start:function(){this._rAFId&&window.cancelAnimationFrame(this._rAFId),this._initialized=!1,delete this._startTime,delete this._paused,this.initialize(),this.setData("ltPropState","Running"),this._startVal=this.getData("ltPropStart"),this._rAFId=requestAnimationFrame(this.count.bind(this))},reset:function(){this._paused=!1,delete this._startTime,this._initialized=!1,this.setData("ltPropState",""),this.initialize()&&(window.cancelAnimationFrame(this._rAFId),this.printValue(this.getData("ltPropStart")))},update:function(t){this._initialized&&this.checkForNumber(t)&&t!==this._frameVal&&(window.cancelAnimationFrame(this._rAFId),this._paused=!1,delete this._startTime,this._startVal=this._frameVal,this.setData("ltPropEnd",t),this._endVal=t,this._endValue=this._endVal,this._countDown=this._startVal>this._endVal,this._rAFId=window.requestAnimationFrame(this.count.bind(this)))},resume:function(){this._initialized&&(this._paused=!1,delete this._startTime,this._remaining&&(this._duration=this._remaining),this._frameVal&&(this._startVal=this._frameVal),this.setData("ltPropState","running"),requestAnimationFrame(this.count.bind(this)))},count:function(){var t=(new Date).getTime();this._startTime||(this._startTime=t),this._timestamp=t;var e=t-this._startTime;if(this._remaining=this._duration-e,this.getData("ltPropUseEasing")?this._countDown?this._frameVal=this._startVal-this.executeMethod("easingFunction",e,0,this._startVal-this._endVal,this._duration):this._frameVal=this.executeMethod("easingFunction",e,this._startVal,this._endVal-this._startVal,this._duration):this._countDown?this._frameVal=this._startVal-(this._startVal-this._endVal)*(e/this._duration):this._frameVal=this._startVal+(this._endVal-this._startVal)*(e/this._duration),this._countDown?this._frameVal=this._frameVal<this._endVal?this._endVal:this._frameVal:this._frameVal=this._frameVal>this._endVal?this._endVal:this._frameVal,this._frameVal=Math.round(this._frameVal*this._dec)/this._dec,this.printValue(this._frameVal),e<=this._duration){var a=this.count.bind(this);this._rAFId=window.requestAnimationFrame(a)}else{var i=this;if(this.getData("ltPropAria"))this.$node.querySelector(".counterDiv").focus();setTimeout((function(){i.getMethods("onComplete")&&i.executeMethod("onComplete")}),100),this.setData("ltPropState",""),this._initialized=!1}},initialize:function(){return!!this._initialized||!(!this.checkForNumber(this._startVal)||!this.checkForNumber(this._endVal))&&(this._decimals=Math.max(0,this.getData("ltPropDecimals")||0),this._dec=Math.pow(10,this._decimals),this._duration=1e3*Number(this.getData("ltPropDuration"))||2e3,this._countDown=this._startVal>this._endVal,this._frameVal=this._startVal,this._initialized=!0,this.printValue(this._startVal),!0)},checkForNumber:function(t){var e=Number(t);return"number"==typeof e&&!isNaN(e)},printValue:function(t){var e;this.getMethods("onValueChange")&&(e=this.executeMethod("onValueChange",t,this)),e||(e=this.formatNumber(t)),this.setData("result",e)},formatNumber:function(t){var e,a,i,r,s,l,n=t<0;if(t=Math.abs(t).toFixed(this.getData("ltPropDecimals")),a=(e=(t+="").split("."))[0],i=e.length>1?this.getData("ltPropDecimalSeparator")+e[1]:"",this.getData("ltPropUseGrouping")){for(r="",s=0,l=a.length;s<l;++s)0!==s&&s%3==0&&(r=this.getData("ltPropSeparator")+r),r=a[l-s-1]+r;a=r}return this.setData("negative",n?"-":""),a+i},methods:{easingFunction:function(t,e,a,i){return a*(1-Math.pow(2,-10*t/i))*1024/1023+e}}});
