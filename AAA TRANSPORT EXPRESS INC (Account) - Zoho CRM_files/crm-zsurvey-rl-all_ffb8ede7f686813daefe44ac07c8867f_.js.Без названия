Lyte.Mixin.register("crm-zsurvey-rl-utils",{loadCompData:function(e){for(var t,a=this,i=store.peekRecord("zsurvey_rl","SURVEYPERSONALITY"),r=[],o=0,s=(i=objectUtils.cloneObject(i)).heading.length,l=0;l<s;l++)"RESPONSEID"===i.heading[l].COLUMNNAME&&(t=i.heading[l],o++),i.heading[l].api_name=i.heading[l].COLUMNNAME,i.heading[l].id=i.heading[l].COLUMNNAME,"SOURCE"!==i.heading[l].COLUMNNAME&&"UNIQUEID"!==i.heading[l].COLUMNNAME||(i.heading[l].yieldName=i.heading[l].COLUMNNAME);i.heading.removeLastOccurenceOfElement(t);for(var n=i.body.length,d=0;d<n&&!(d>=10);d++){var p={},c=i.body[d].CONTENT.length-o;for(l=0;l<c;l++)p[i.heading[l].COLUMNNAME]=i.body[d].CONTENT[l].replaceAll("&#39;","'");r[d]=p}if(Crm.userDetails.isRelatedListLyteEnabled)var m=Lyte.registeredMixins["crm-related-list-utils"].showNavigation(i.fromIndex,i.toIndex,10,i.body.length);else m=crmRelatedList.showNavigation(i.fromIndex,i.toIndex,10,i.body.length);a.setData("showNavigation",m);var u=i.fromIndex-1+i.body.length;m&&(a.setData("navigationEndIndex",getEndIndex(i.fromIndex,i.toIndex,10,i.body,!0)),a.setData("showPrevNav",1!==i.fromIndex),a.setData("showNextNav",void 0!==i.body[10]),a.setData("navStartIndex",i.fromIndex-1),a.setData("totalRecord",u));var y=i.ACTIONS.slice(0);y.forEach((function(e){e.data_cid=e["data-cid"]})),i.content=r,i.ACTIONS=y;var v,g=Crm.userDetails.isRelatedListLyteEnabled?e:crmRelatedList.Module;if(returnJson[[g]]&&returnJson[[g]].recordLockingDetails&&returnJson[[g]].recordLockingDetails.isLockedForMe&&businessCardJson.isSendSurveyLocked&&(i.hideSendSurveyBtn=!0),a.setData("rlData",i),a.setData("loading",!1),v=u<=i.toIndex?u:i.toIndex+"+",Crm.userDetails.isRelatedListLyteEnabled){var _=a.getData("related_list_id");a.removeRelatedListCountKey(a.getData("rlIdVsCount"),_),Lyte.triggerEvent("relatedListCountDetail",{id:_,count:u<=i.toIndex?u:i.toIndex,more_records:!(u<=i.toIndex)})}var f=document.querySelector("crm-zsurvey-rl-label").component;if(f.setData("rlData",i),f.setData("rlCount",v),"canvas"!==Lyte.Router.getRouteInstance().routeName&&0!==v)$("#newleft_"+i.listRelationId).find("span.numCountn").addClass("numCountVal").text(v);else if("CANVAS"===this.getData("type")&&Crm.userDetails.isRLCountSupportedForCanvas){var D={};D[f.getData("related_list_id")]=v,Lyte.registeredMixins["crm-detailcanvas-utils"].handleCountforRL(D)}},removeRelatedListCountKey:function(e,t){e&&Object.values(e).length&&Lyte.objectUtils(e,"delete",t)}}),store.registerModel("zsurvey_rl",{name:Lyte.attr("string",{primaryKey:!0}),ACTIONS:Lyte.attr("array"),heading:Lyte.attr("array"),body:Lyte.attr("array"),customButton:Lyte.attr("boolean"),filtersAvailable:Lyte.attr("boolean"),fromIndex:Lyte.attr("number"),isCustLookUp:Lyte.attr("boolean"),isCustomModule:Lyte.attr("boolean"),isCustomRel:Lyte.attr("boolean"),isShowColumns:Lyte.attr("boolean"),isStandardLookup:Lyte.attr("boolean"),label:Lyte.attr("string"),listRelationId:Lyte.attr("string"),module:Lyte.attr("string"),sortOrderString:Lyte.attr("string"),surveyEnabled:Lyte.attr("number"),toIndex:Lyte.attr("number")}),store.registerAdapter("zsurvey_rl",{namespace:"crm/",buildURL:function(e,t,a,i,r){return r.replace("zsurvey_rl","NewRelatedList.do")}}),store.registerSerializer("zsurvey_rl",{normalizeResponse:function(e,t,a,i,r,o,s,l){if(Crm.userDetails.isRelatedListLyteEnabled)return{zsurvey_rls:a[s.module][l]};for(var n in a)for(var d in a[n])return a={zsurvey_rls:a[n][d]}}}),Lyte.Component.register("crm-zsurvey-rl-body",{_template:'<template tag-name="crm-zsurvey-rl-body"> <template is="if" value="{{loading}}"><template case="true"> <table width="100%" cellspacing="0" cellpadding="0" class="norec"> <tbody> <tr> <td valign="center"> <div class="pR30">Loading...</div> </td> </tr> </tbody> </table> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(rlData,\'&amp;&amp;\',rlData.body),\'&amp;&amp;\',expHandlers(rlData.body.length,\'==\',0))}}"><template case="true"> <table width="100%" cellspacing="0" cellpadding="0" class="norec"> <tbody> <tr> <td valign="center"> <div class="fontsmooth mR0 mL0 mT5 pR10">{{getI18n(\'crm.new.label.no.records\')}}</div> <div data-zcqa="zSListRelationId" id="norec_{{rlData.listRelationId}}"></div> <crm-zsurvey-rl-actions entity_id="{{entity_id}}" module="{{module}}" actions="{{rlData.ACTIONS}}" related_list_id="{{rlData.listRelationId}}" hide_send_survey="{{rlData.hideSendSurveyBtn}}" record="{{record}}" record-locking-details="{{recordLockingDetails}}"></crm-zsurvey-rl-actions> </td> </tr> </tbody> </table> </template><template case="false"> <template is="if" value="{{expHandlers(type,\'==\',&quot;CANVAS&quot;)}}"><template case="true"> <table class="borderNone aligncenter" width="100%" cellspacing="0" cellpadding="0"> <tbody> <tr height="25"> <td></td> <td class="alignRight vaM"> <crm-zsurvey-rl-actions entity_id="{{entity_id}}" module="{{module}}" actions="{{rlData.ACTIONS}}" related_list_id="{{rlData.listRelationId}}" record="{{record}}" record-locking-details="{{recordLockingDetails}}"></crm-zsurvey-rl-actions> </td> </tr> </tbody> </table> </template></template> <crux-table-component cx-prop-table-class="noBorderTable crmTableBottomBorder crmNoCapitalizeTableHeader mB15" cx-prop-header="{{rlData.heading}}" cx-prop-label-selector="FIELDLABEL" cx-prop-content="{{rlData.content}}" cx-prop-header-row-id="listviewHeaderRow" cx-prop-sort-columns="true" cx-prop-body-id="lvTred" cx-prop-column-cell-class="sort mW100" cx-prop-field-type-mapping-selector="COLUMNNAME" on-sort="{{action(\'showSortDropdown\')}}" cx-prop-sorted-column="{{sort_by}}" cx-prop-sorted-order="{{sort_order}}" cx-prop-table-id="listviewtable" data-zcqa="listViewTable" class="listviewtable zSurveyDetListTable" cx-prop-row-zcqa="detailView" cx-prop-module="{{module}}" cx-prop-add-search="false" cx-prop-enable-body-scroll="false"> <template is="yield" yield-name="body-SOURCE"> {{getI18n(recordObj.SOURCE)}} </template> <template is="yield" yield-name="body-UNIQUEID"> <template is="if" value="{{expHandlers(expHandlers(recordObj.UNIQUEID,\'!=\',undefined),\'&amp;&amp;\',expHandlers(recordObj.UNIQUEID,\'!=\',0))}}"><template case="true"> <template is="if" value="{{expHandlers(rlData.surveyEnabled,\'==\',1)}}"><template case="true"> <span class="crmLinkColor cP crm-base-font-size" data-zcqa="viewResponse" onclick="{{action(\'viewResponse\',this)}}" data-params="{&quot;action&quot; : &quot;viewResponse&quot;, &quot;uniqueid&quot;:&quot;{{recordObj.UNIQUEID}}&quot;, &quot;responseid&quot;:&quot;{{rlData.body[indexVal].RESPONSEID}}&quot; , &quot;zcrmemail&quot;:&quot;{{encodeURIComponent(rlData.body[indexVal].sEmail)}}&quot;}">{{getI18n(\'crm.zsurvey.label.view.response\')}}</span> </template><template case="false"> <a href="javascript:void(0);" data-zcqa="viewResponse" onmouseenter="{{action(\'showTooltip\',getI18n(\'crm.zsurvey.no.viewresponse.surveydisabled.brandchange\',surveyPartnerAppName))}}" onmouseleave="{{action(\'hideTooltip\')}}">{{getI18n(\'crm.zsurvey.label.view.response\')}}</a> </template></template> </template><template case="false"> <span class="crm-small-font-size" data-zcqa="zsYetToRespond">{{getI18n(\'crm.survey.response.yettorespond\')}}</span> </template></template> </template> </crux-table-component> <template is="if" value="{{showNavigation}}"><template case="true"> <div class="rl_navigator"> <lyte-navigator class="mlAuto fR" on-next="{{method(\'navigNext\')}}" on-previous="{{method(\'navigPrevious\')}}" lt-prop-yeild="false" lt-prop-value="{{navStartIndex}}" lt-prop-records="{{totalRecord}}" lt-prop-perpage="10"></lyte-navigator> </div> </template></template> <lyte-menu lt-prop-yield="true" lt-prop-event="click" lt-prop-query="lyte-th.sort" on-menu-click="{{method(\'sortRecord\')}}" data-zcqa="sort_div_zsurvey" lt-prop-freeze="false"> <template is="registerYield" yield-name="yield"> <lyte-menu-body id="sort_div_zsurvey" class="ddM"> <template is="for" items="{{sortDetails}}" item="order" index="index"> <lyte-menu-item data-value="{{order}}" data-zcqa="sorting_{{order}}"> <template is="if" value="{{expHandlers(order,\'==\',&quot;unsort&quot;)}}"><template case="true"> {{getI18n("crm.column.unsort")}} </template><template case="false"> {{getI18n(concat("crm.column.sort.",order))}} </template></template><template is="if" value="{{ifAnyMatch(order,\'=\',\'asc\',order,\'=\',\'desc\')}}"><template case="true"> <span class="svgIcons sort_{{if(ifEquals(order,\'asc\'),\'asc\',\'desc\')}}"></span> </template></template> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template></template></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,1,0]},{type:"attr",position:[1,1,1,1,3]},{type:"attr",position:[1,1,1,1,5]},{type:"componentDynamic",position:[1,1,1,1,5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1,3,1]},{type:"componentDynamic",position:[1,1,1,3,1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"registerYield",position:[3,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"attr",position:[1,2]},{type:"if",position:[1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]}]}},default:{}}]}},default:{}}],_observedAttributes:["module","entity_id","related_list_id","loading","rlData","rlIdVsCount","showNavigation","navStartIndex","totalRecord","navigationEndIndex","showPrevNav","showNextNav","sortField","sort_order","sort_by","sortDetails","rendered_from","surveyPartnerAppName","record","recordLockingDetails","type"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),loading:Lyte.attr("boolean",{default:!0}),rlData:Lyte.attr("object"),rlIdVsCount:Lyte.attr("object",{default:{}}),showNavigation:Lyte.attr("boolean"),navStartIndex:Lyte.attr("number",{default:0}),totalRecord:Lyte.attr("number",{default:0}),navigationEndIndex:Lyte.attr("number",{default:10}),showPrevNav:Lyte.attr("boolean",{default:!1}),showNextNav:Lyte.attr("boolean",{default:!1}),sortField:Lyte.attr("string"),sort_order:Lyte.attr("string"),sort_by:Lyte.attr("string"),sortDetails:Lyte.attr("array"),rendered_from:Lyte.attr("string"),surveyPartnerAppName:Lyte.attr("string",{default:Crm.integrationsAppName.ZOHO_SURVEY}),record:Lyte.attr("object"),recordLockingDetails:Lyte.attr("object",{default:{}}),type:Lyte.attr("string")}},didConnect:function(){var e=this;if("non_canvas"!==e.getData("rendered_from")){var t={action:"getData",pname:"SURVEYPERSONALITY",module:e.getData("module"),id:e.getData("entity_id")};store.clearCachedQuery("zsurvey_rl",t),Crm.userDetails.isRelatedListLyteEnabled?app.store.makeRequest("findAll","zsurvey_rl",t,!0,!0,e.getData("related_list_id")).then((function(){e.loadCompData(e.getData("module"))})):app.store.makeRequest("findAll","zsurvey_rl",t,!0,!0).then((function(){e.loadCompData()}))}},actions:{navigate:function(e){this.navigate(e)},viewResponse:function(e){ZSurvey.viewResponse(e)},showSortDropdown:function(e,t){var a=t.target,i=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,r=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;this.setData("sortField",e.api_name);var o=a.offsetLeft,s=t.target.getBoundingClientRect(),l=document.getElementById("sort_div_zsurvey");if(l&&(l.style.position="fixed"),r>0&&0===i&&(l.style.left=o+"px"),i<50)l.style.left=o-r+"px";else{var n=document.getElementById("cvpadding");void 0===document.getElementById("copyListviewHeaderDiv")&&n&&"pFixed"===n.getAttribute("class")?l.style.top=a.DOCUMENT_POSITION_CONTAINS+a.offsetHeight+82-(n.offsetHeight+15)-i+"px":l.setAttribute("class","fixedTopColumnList"),l.style.position="fixed",l.style.left=o-r+"px",l.style.zIndex=2502}var d=document.getElementById("sorted_column_"+e.api_name);d&&"asc"===this.getData("sort_order")?this.setData("sortDetails",["desc","unsort"]):d&&"desc"===this.getData("sort_order")?this.setData("sortDetails",["asc","unsort"]):this.setData("sortDetails",["asc","desc"]),l.style.display="block",l.style.left=s.left+"px",l.style.top=s.top+s.height+"px"},showTooltip:function(e){crmui.showTooltip(e)},hideTooltip:function(){crmui.hideTooltip()}},methods:{navigNext:function(){this.navigate("next")},navigPrevious:function(){this.navigate("prev")},sortRecord:function(e){var t=this,a=document.getElementsByClassName("lyteMenuSelected")[0].id,i=t.getfieldName(a),r={action:"getData",pname:"SURVEYPERSONALITY",module:t.getData("module"),id:t.getData("entity_id"),fromIndex:1};"asc"!==e&&"desc"!==e||(r.sortOrderString="sort_"+e,r.sortColumnId=i,r.isSortRequest=!0),t.setData("sort_order",e),t.setData("sort_by",a),store.clearCachedQuery("zsurvey_rl",r),Crm.userDetails.isRelatedListLyteEnabled?app.store.makeRequest("findAll","zsurvey_rl",r,!0,!0,t.getData("related_list_id")).then((function(){t.loadCompData(t.getData("module"))})):app.store.makeRequest("findAll","zsurvey_rl",r,!0,!0).then((function(){t.loadCompData()}))}},getfieldName:function(e){for(var t=this.getData("rlData"),a=t.heading.length,i=0;i<a;i++)if(t.heading[i].api_name===e)return t.heading[i].FIELDLABEL},navigate:function(e){var t=this,a={action:"getData",pname:"SURVEYPERSONALITY"};a.module=t.getData("module"),a.id=t.getData("entity_id"),a.rid=t.getData("related_list_id"),a.isSortRequest=!1,"next"===e?a.fromIndex=parseInt(t.getData("rlData.fromIndex"))+10:"prev"===e&&(a.fromIndex=parseInt(t.getData("rlData.fromIndex"))-10),store.clearCachedQuery("zsurvey_rl",a),Crm.userDetails.isRelatedListLyteEnabled?app.store.makeRequest("findAll","zsurvey_rl",a,!0,!0,t.getData("related_list_id")).then((function(){t.loadCompData(t.getData("module"))})):app.store.makeRequest("findAll","zsurvey_rl",a,!0,!0).then((function(){t.loadCompData()}))}},{mixins:["crm-zsurvey-rl-utils"]}),Lyte.Component.register("crm-zsurvey-rl-actions",{_template:'<template tag-name="crm-zsurvey-rl-actions" class="zSurveyRLAction"> <div id="ract_{{related_list_id}}" class="enableRelLinks crm-rl-write-action"> <template is="if" value="{{isCanvasView}}"><template case="true"> <template is="if" value="{{expHandlers(module,\'==\',\'Potentials\')}}"><template case="true"> <input type="hidden" data-zcqa="zSassociatedContEmail" id="associatedContEmail" value="{{associatedContEmail}}"> <input type="hidden" data-zcqa="zSentIdForZMail" id="entIdForZMail" value="{{entIdForZMail}}"> </template><template case="false"> <div class="dN"> <a class="link" data-zcqa="value_EMAIL" id="subvalue_EMAIL" href="mailto:{{subvalue_EMAIL}}">{{subvalue_EMAIL}}</a> <a class="link" data-zcqa="value_ADDN_EMAIL" id="subvalue_ADDN_EMAIL" href="mailto:{{subvalue_ADDN_EMAIL}}">{{subvalue_ADDN_EMAIL}}</a> </div> </template></template> <input type="hidden" data-zcqa="zSentId" id="id" name="id" value="{{entity_id}}"> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(reviewStatus,\'==\',\'Review in Progress\'),\'||\',expHandlers(reviewStatus,\'==\',\'Pending for Review\')),\'||\',expHandlers(reviewStatus,\'==\',\'Rejected\')),\'||\',expHandlers(reviewStatus,\'==\',\'Pending for ReReview\')),\'!\')}}"><template case="true"> <template is="for" items="{{actions}}" item="action" index="actionIndex"> <template is="if" value="{{expHandlers(action.data_cid,\'==\',\'createsurvey\')}}"><template case="true"> <a href="http://{{action.URL}}" data-zcqa="{{action.data_cid}}" target="_blank" rel="noopener noreferrer" name="newsurveybutton" id="newsurveybutton1" class="tb_newsmallbtn crm-base-font-size cP mR8 mL0">{{action.label}}</a> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(isLiteUser,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(action.data_cid,\'==\',&quot;sendsurvey&quot;),\'||\',expHandlers(action.data_cid,\'==\',&quot;attendsurvey&quot;)))}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(action.data_cid,\'==\',&quot;sendsurvey&quot;),\'&amp;&amp;\',isSendMailPermisstionAvailable)}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-class="outlineprimary" lt-prop-size="small" onclick="{{action(\'sendSurveyValidate\',\'sendsurvey\')}}" data-zcqa="{{action.data_cid}}" data-relid="{{related_list_id}}"><template is="registerYield" yield-name="text">{{action.label}}</template></lyte-button> </template><template case="false"><template is="if" value="{{expHandlers(action.data_cid,\'==\',&quot;attendsurvey&quot;)}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-class="outlineprimary" lt-prop-size="small" onclick="{{action(\'sendSurveyValidate\',\'attendsurvey\')}}" data-zcqa="{{action.data_cid}}" data-relid="{{related_list_id}}" class="mR0"><template is="registerYield" yield-name="text">{{action.label}}</template></lyte-button> </template></template></template></template> </template></template></template></template> </template> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[3]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}]}},default:{}}],_observedAttributes:["module","entity_id","related_list_id","entIdForZMail","associatedContEmail","subvalue_EMAIL","subvalue_ADDN_EMAIL","reviewStatus","isCanvasView","isLiteUser","showSurveyPopup","isValidationNeeded","from","isPopupRendered","emailOptOut","contactMode","showalertmsg","isSendSurveyRestricted","alertmsg","record","isSendMailPermisstionAvailable","recordLockingDetails"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),entIdForZMail:Lyte.attr("string"),associatedContEmail:Lyte.attr("string",{default:""}),subvalue_EMAIL:Lyte.attr("string",{default:""}),subvalue_ADDN_EMAIL:Lyte.attr("string",{default:""}),reviewStatus:Lyte.attr("string"),isCanvasView:Lyte.attr("boolean",{default:!0}),isLiteUser:Lyte.attr("boolean",{default:Crm.userDetails.LITE.IS_LITE_USER}),showSurveyPopup:Lyte.attr("boolean",{default:!0}),isValidationNeeded:Lyte.attr("boolean",{default:!0}),from:Lyte.attr("string"),isPopupRendered:Lyte.attr("boolean",{default:!1}),emailOptOut:Lyte.attr("boolean",{default:!1}),contactMode:Lyte.attr("string"),showalertmsg:Lyte.attr("boolean",{default:!1}),isSendSurveyRestricted:Lyte.attr("boolean",{default:!1}),alertmsg:Lyte.attr("string"),record:Lyte.attr("object"),isSendMailPermisstionAvailable:Lyte.attr("boolean",{default:!0}),recordLockingDetails:Lyte.attr("object",{default:{}})}},didConnect:function(){var e=this,t=this.getData("module"),a=store.peekRecord(moduleRecordMapping[t].id,e.getData("entity_id")),i=!Crm.SEND_MAIL_BUTTON_HIDE||void 0!==Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+t]&&Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+t];if(e.setData("isSendMailPermisstionAvailable",i),"canvas"===Lyte.Router.getRouteInstance().routeName){"Potentials"===e.getData("module")&&a.Contact_Name&&a.Contact_Name.id?e.setPotentialsRecordEmailDetails(e,a):(e.setData("subvalue_EMAIL",a.Email),e.setData("subvalue_ADDN_EMAIL",a.Secondary_Email));var r=$L("crm-detailview-canvas")[0],o=r?r.getData("recordLockingDetails"):void 0;e.setData("isSendSurveyRestricted",a.$locked_for_me&&o&&o.restricted_communications&&o.restricted_communications.contains("send_survey")&&i),e.setData("reviewStatus",a.$review)}else{if("detail"===Lyte.Router.getRouteInstance().routeName)if(Crm.renderDVLyteFlow(e.getData("module"))){var s=$L("crm-detail-view-locking-details");o=s[0]&&s[0].component?s[0].component.data.recordLockingDetails:void 0;e.setData("isSendSurveyRestricted",o&&o.restricted_communications&&o.restricted_communications.contains("send_survey"))}else e.setData("isSendSurveyRestricted",detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&businessCardJson&&businessCardJson.isSendSurveyLocked);Crm.renderDVLyteFlow(t)&&"Potentials"===t&&a.Contact_Name&&a.Contact_Name.id&&e.setPotentialsRecordEmailDetails(e,e.getData("record")),e.setData("isCanvasView",!1)}var l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zsurveypopup")],ResourceConstants.CRM);Lyte.injectResources(l,void 0,void 0)},recordLockingDetails:function(){var e=this.getData("recordLockingDetails");this.setData("isSendSurveyRestricted",e&&e.restricted_communications&&e.restricted_communications.contains("send_survey"))}.observes("recordLockingDetails"),recordDetails:function(){var e=this.getData("record");"Potentials"===this.getData("module")&&e.Contact_Name&&e.Contact_Name.id&&this.setPotentialsRecordEmailDetails(this,e)}.observes("record"),setPotentialsRecordEmailDetails:function(e,t){e.fetchRelatedModuleRecords("Contacts",t.Contact_Name.id).then((function(t){var a=t[0]?t[0]:t;e.setData("entIdForZMail",a.id);var i="";a.Email&&a.Email.length>0?i=a.Email:a.Secondary_Email&&a.Secondary_Email.length>0&&(i=a.Secondary_Email),e.setData("associatedContEmail",i)}))},actions:{showSurvey:function(e){var t,a=null,i={action:"surveyDetails",from:e,entityId:this.getData("entity_id"),module:this.getData("module")};this.getData("isCanvasView")?t=this.getData("entIdForZMail"):(t=document.getElementById("entIdForZMail"))&&t.getAttribute("value")&&(t=t.getAttribute("value"));t&&(a=t,i.entIdForZMail=a);var r=event.target;r.setAttribute("data-params",JSON.stringify(i)),ZSurvey.showSurveyDetails(r)},showSurveyPopup:function(){this.setData("showSurveyPopup",!0)},sendSurveyValidate:function(e){var t=this;t.setData("from",e);var a={from:e,module:t.getData("module")},i=t.getData("record");let r=t.getData("module");if(Crm.renderDVLyteFlow(r)&&!t.getData("isCanvasView")&&"Potentials"!==r?a.emailDetails={rec_email:i&&i.Email||"",rec_semail:i&&i.Secondary_Email||""}:Crm.renderDVLyteFlow(r)&&!t.getData("isCanvasView")&&"Potentials"===r&&(a.emailDetails={rec_email:t.getData("associatedContEmail")}),!ZSurvey.checkForEmail(JSON.stringify(a)))if("sendsurvey"===e){var o=store.peekRecord(moduleRecordMapping[t.getData("module")].id,t.getData("entity_id"));void 0!==o?t.executeMethod("validate_data_processing_details",o,e,!1):t.executeMethod("validate_and_render_popup",e)}else t.executeMethod("render_popup",e)}},methods:{validate_and_render_popup:function(e){commonUtils.showHideLoadingDiv(!0);var t=this;Lyte.resolvePromises({record:store.triggerAction("survey","gdpr_check","crm/v2.2/"+moduleRecordMapping[t.getData("module")].api_name+"/"+this.getData("entity_id"))}).then((function(a){var i=a.record.data[0];t.executeMethod("validate_data_processing_details",i,e,!0)&&t.executeMethod("render_popup",e)}))},validate_data_processing_details:function(e,t,a){var i=!0;if(void 0!==e.Data_Processing_Basis_Details)var r=e.Data_Processing_Basis_Details;if(e.Email_Opt_Out){if(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.label.emailoptout.alert.message"),ltPropWrapperClass:"zSurveyCruxAlert"}}),i=!1,a)return commonUtils.showHideLoadingDiv(!1),!1}else if(r)if(r.Contact_Through_Email){if(r.Contact_Through_Survey){if(a)return!0}else if(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zsurvey.no.survey.communication",Crm.moduleInfo[this.getData("module")].translatedSingularLabel),ltPropWrapperClass:"zSurveyCruxAlert"}}),i=!1,a)return commonUtils.showHideLoadingDiv(!1),!1}else if(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zsurvey.no.survey.email.communication",Crm.moduleInfo[this.getData("module")].translatedSingularLabel),ltPropWrapperClass:"zSurveyCruxAlert"}}),i=!1,a)return commonUtils.showHideLoadingDiv(!1),!1;return this.getData("isSendSurveyRestricted")?(_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.record.lock.survey",moduleRecordMapping[this.getData("module")].plural_label),ltPropContentAlign:"center"}}),i=!1,!1):!!a||void(i&&this.executeMethod("render_popup",t))},render_popup:function(e){var t,a=this.getData("module");"Potentials"===a&&Crm.renderDVLyteFlow(a)?t=this.getData("entIdForZMail"):"Potentials"===a&&(t=document.getElementById("entIdForZMail"))&&t.getAttribute("value")&&(t=t.getAttribute("value"));var i={entidforzmail:t,module:this.getData("module"),entityId:this.getData("entity_id"),from:e,title:"sendsurvey"===e?"crm.survey.label.sendsurvey":"crm.survey.label.attendsurvey",showsurveypopup:!0,buttonText:"sendsurvey"===e?"Insert":"crm.survey.label.attendsurvey",iscomponentmethod:"sendsurvey"===e,executemethod:"sendsurvey"===e?"sendSurvey":"ZSurvey.attendSurvey"};ZSurvey.showPopupLyte(["crm-zsurvey-survey-popup.js","crm-zsurvey-popup-dropdown.js","crux-form-component.js"],!0,["zsurvey_home-min.js"],i,"body",!1)}}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Component.register("crm-zsurvey-rl-label",{_template:'<template tag-name="crm-zsurvey-rl-label"> <table cellspacing="0" cellpadding="0" class="relCenterBg w100_per {{if(isRlLyteNew,\'rl_Header\',\'dvRLHeader\')}}"> <tbody class="w100_per"> <tr class="flexAlignCenter spaceBetween"> <td> <div class="flexAlignCenter"> <span name="surveypersonality_{{related_list_id}}" id="surveypersonality_{{related_list_id}}" class="relListHead">{{display_label}}</span> <template is="if" value="{{expHandlers(expHandlers(type,\'==\',&quot;CANVAS&quot;),\'&amp;&amp;\',expHandlers(Crm.userDetails.isRLCountSupportedForCanvas,\'===\',true))}}"><template case="true"> <span id="RL_dataCount_{{related_list_id}}" data-zcqa="zSRLCount"></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(type,\'==\',&quot;CANVAS&quot;),\'&amp;&amp;\',expHandlers(expHandlers(rlData,\'&amp;&amp;\',rlData.body),\'&amp;&amp;\',expHandlers(rlData.body.length,\'!=\',0)))}}"><template case="true"> <span class="zSurveyRLCount" data-zcqa="zSRLCount">{{rlCount}}</span> </template></template></template></template> <span class="zSurveyRefresh cP mL8" data-zcqa="zSReload" onclick="{{action(\'reload\')}}"> <span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span> </span> </div> </td> <td is="if" lyte-if="true" value="{{expHandlers(expHandlers(type,\'!=\',\'CANVAS\'),\'&amp;&amp;\',expHandlers(expHandlers(rlData,\'&amp;&amp;\',rlData.body),\'&amp;&amp;\',expHandlers(rlData.body.length,\'!=\',0)))}}"></td> </tr> </tbody> </table> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1,1,1,1]},{type:"text",position:[1,1,1,1,1,1,0]},{type:"attr",position:[1,1,1,1,1,3]},{type:"if",position:[1,1,1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,1,5]},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{},actualTemplate:'<template is="if" value="{{type != \'CANVAS\' &amp;&amp; (rlData &amp;&amp; rlData.body &amp;&amp; rlData.body.length != 0)}}"><template case="true" depth="3"><table><tbody><tr> <td class="alignRight vaM"> <crm-zsurvey-rl-actions entity_id="{{entity_id}}" module="{{module}}" actions="{{lbind(rlData.ACTIONS)}}" related_list_id="{{related_list_id}}" record="{{record}}" record-locking-details="{{recordLockingDetails}}"></crm-zsurvey-rl-actions> </td> </tr></tbody></table></template></template>'}],_observedAttributes:["module","record","recordLockingDetails","entity_id","related_list_id","display_label","type","rlCount","rlData","isRlLyteNew"],data:function(){return{module:Lyte.attr("string"),record:Lyte.attr("object"),recordLockingDetails:Lyte.attr("object",{default:{}}),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),display_label:Lyte.attr("string"),type:Lyte.attr("string"),rlCount:Lyte.attr("string"),rlData:Lyte.attr("object"),isRlLyteNew:Lyte.attr("boolean",{default:Crm.userDetails.isRelatedListLyteEnabled})}},actions:{reload:function(){var e=this,t={action:"getData",pname:"SURVEYPERSONALITY",module:e.getData("module"),id:e.getData("entity_id")};commonUtils.showHideLoadingDiv(!0),store.clearCachedQuery("zsurvey_rl",t),Crm.userDetails.isRelatedListLyteEnabled?app.store.makeRequest("findAll","zsurvey_rl",t,!0,!0,this.getData("related_list_id")).then((function(){var t=document.getElementsByTagName("crm-zsurvey-rl-body")[0].component;commonUtils.showHideLoadingDiv(),t.loadCompData.call(t,e.getData("module"))})):app.store.makeRequest("findAll","zsurvey_rl",t,!0,!0).then((function(){var e=document.getElementsByTagName("crm-zsurvey-rl-body")[0].component;commonUtils.showHideLoadingDiv(),e.loadCompData.call(e)}))}},methods:{}}),Lyte.Component.register("crm-zsurvey-rl",{_template:'<template tag-name="crm-zsurvey-rl"> <crm-zsurvey-rl-label rl-data="{{lbind(rlData)}}" type="{{type}}" entity_id="{{entity_id}}" module="{{module}}" related_list_id="{{related_list_id}}" display_label="{{display_label}}" record="{{record}}" record-locking-details="{{recordLockingDetails}}"></crm-zsurvey-rl-label> <crm-zsurvey-rl-body rl-data="{{lbind(rlData)}}" rendered_from="{{if(fromDetail,\'\',\'non_canvas\')}}" entity_id="{{entity_id}}" module="{{module}}" related_list_id="{{related_list_id}}" record="{{record}}" record-locking-details="{{recordLockingDetails}}" rl-id-vs-count="{{rlIdVsCount}}"></crm-zsurvey-rl-body> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}],_observedAttributes:["module","entity_id","related_list_id","display_label","rlData","type","record","recordLockingDetails","fromDetail","rlIdVsCount"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),display_label:Lyte.attr("string"),rlData:Lyte.attr("object"),type:Lyte.attr("string"),record:Lyte.attr("object"),recordLockingDetails:Lyte.attr("object",{default:{}}),fromDetail:Lyte.attr("boolean",{default:!1}),rlIdVsCount:Lyte.attr("object",{default:{}})}}});
