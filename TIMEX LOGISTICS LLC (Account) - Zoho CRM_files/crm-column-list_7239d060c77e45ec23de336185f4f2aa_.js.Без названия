Lyte.Component.register("crm-column-list",{_template:'<template tag-name="crm-column-list"> <template is="if" value="{{expHandlers(type,\'===\',&quot;modal&quot;)}}"><template case="true"> <lyte-modal lt-prop-wrapper-class="columnListNew cxColumnListOnPopup cxColumnListOnPopupWithHeader" id="newPopup" lt-prop-allow-multiple="true" lt-prop-show-close-button="false" lt-prop-height="auto" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-width="395px" lt-prop-show="{{showModal}}" on-before-show="{{method(\'beforePopoverShow\')}}" on-close="{{method(\'closePopover\')}}" on-before-close="{{method(\'beforePopoverClose\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{getI18n("crm.listview.options.manage")}}</lyte-modal-header> <lyte-modal-content class="manageColumnListContent"> <crux-column-list cx-prop-search-zcqa="manageColumnList" cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-id="addColumnContainer" id="columnListId" class="dB" cx-prop-fields="{{ordered_fields1}}" cx-prop-selected-fields="{{selected_fields1}}" on-search="{{method(&quot;columnResize&quot;)}}" on-drop-item="{{method(&quot;itemDrop&quot;)}}" on-before-unchecked="{{method(&quot;beforeUnchecking&quot;)}}" on-before-checked="{{method(&quot;beforeSelection&quot;)}}" cx-prop-data-bind="lyteFastRender" cx-prop-disable-sort-for-unselected-fields="true" cx-prop-pin-unpin-option="true" cx-prop-property-fields="{{property_fields}}" cx-prop-pin-field-limit="{{pined_fields_limit}}" cx-prop-pin-field-limit-message="{{getI18n(&quot;crm.customview.pin.unpin.maximum.limit.new&quot;,pined_fields_limit)}}" on-pin-option-changed="{{method(&quot;PinOptionChanged&quot;)}}"> </crux-column-list> </lyte-modal-content> <template is="if" value="{{showPopoverfooter}}"><template case="true"> <lyte-modal-footer id="addColPopFoot" class="manageColumnListFoot pT20 pB25 pR30 pL30"> <lyte-button data-zcqa="listViewCancelbtn" lt-prop-class="newgraybtn" lt-prop-tab-index="0" onclick="{{action(\'closePopover\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("crm.button.cancel")}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" id="columnlistPrimaryBtn" lt-prop-tab-index="0" lt-prop-class="primarybtn" data-zcqa="listViewSubmitbtn" onclick="{{action(\'saveCustomView\')}}"> <template is="registerYield" yield-name="text"> <template is="if" value="{{ifEquals(from,&quot;mBuilderBusinessCard&quot;)}}"><template case="true"> {{getI18n("crm.button.done")}} </template><template case="false"> {{getI18n(saveButtonLiteral)}} </template></template> </template> </lyte-button> </lyte-modal-footer> </template></template> </template> </lyte-modal> </template><template case="false"> <lyte-popover id="newPopup" lt-prop-scrollable="true" lt-prop-wrapper-class="cxColumnListOnPopup" lt-prop-allow-multiple="true" lt-prop-duration="{{popoverDuration}}" lt-prop-origin-elem=".lyteExpTableFakeColHeaderWrapper #addColumn" lt-prop-type="box" lt-prop-show-close-button="false" lt-prop-placement="{{if(ifEquals(from,\'detailView\'),\'topRight bottomRight\',\'bottomLeft\')}}" lt-prop-freeze="false" on-close="{{method(\'closePopover\')}}" on-show="{{method(\'onPopoverShow\')}}" on-before-show="{{method(\'beforePopoverShow\')}}" on-before-close="{{method(\'beforePopoverClose\')}}" lt-prop-boundary="{&quot;top&quot;:&quot;180px&quot;,&quot;bottom&quot;:&quot;50px&quot;}" lt-prop-auto-align="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="lytePopContentScroll divBorder rlColumnListCnt"> <crux-column-list cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-maxlength="50" cx-prop-id="addColumnContainer" id="columnListId" class="dB" cx-prop-fields="{{ordered_fields1}}" cx-prop-selected-fields="{{selected_fields1}}" on-search="{{method(&quot;columnResize&quot;)}}" on-drop-item="{{method(&quot;itemDrop&quot;)}}" on-check-box-checked="{{method(&quot;onCheckBoxChanged&quot;)}}" on-check-box-un-checked="{{method(&quot;onCheckBoxChanged&quot;)}}" on-before-unchecked="{{method(&quot;beforeUnchecking&quot;)}}" on-before-checked="{{method(&quot;beforeSelection&quot;)}}" on-before-drop-item="{{method(&quot;onBeforeDropItem&quot;)}}" cx-prop-data-bind="lyteFastRender" cx-prop-disable-sort-for-unselected-fields="true" cx-prop-prevent-sortable-on-mandatory-fields="{{method(&quot;preventSort&quot;)}}" cx-prop-property-fields="{{property_fields}}" on-pin-option-changed="{{method(&quot;PinOptionChanged&quot;)}}"> </crux-column-list> <template is="if" value="{{isActivitySplitComponent(relatedList.personality_name)}}"><template case="true"> <div data-zcqa="customize_error" class="maxFieldAlertMsg crm-base-font-size crmBaseColor pL30 mB0 canvasActCol dN" id="customize_error"> {{getI18n("crm.formrule.actions.fields",5)}} </div> </template></template> </lyte-popover-content> <template is="if" value="{{showPopoverfooter}}"><template case="true"> <lyte-popover-footer id="addColPopFoot" class="paddingFooter pT20 pB25 pR30 pL30"> <lyte-button lt-prop-appearance="primary" id="columnlistPrimaryBtn" lt-prop-tab-index="0" lt-prop-class="primarybtn" data-zcqa="listViewSubmitbtn" onclick="{{action(\'saveCustomView\')}}" class="mR10"> <template is="registerYield" yield-name="text"> <template is="if" value="{{ifEquals(from,&quot;mBuilderBusinessCard&quot;)}}"><template case="true"> {{getI18n("crm.button.done")}} </template><template case="false"> {{getI18n("crm.button.save")}} </template></template> </template> </lyte-button> <lyte-button data-zcqa="listViewCancelbtn" lt-prop-class="newgraybtn mR0" lt-prop-tab-index="0" onclick="{{action(\'closePopover\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("crm.button.cancel")}} </template> </lyte-button> </lyte-popover-footer> </template></template> </template> </lyte-popover> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["cvid","module","module_info","fields","selected_fields","selected_fields1","ordered_fields","ordered_fields1","showNoResult","showPopoverfooter","showModal","displayFieldMap","searchvalue","appointmentHiddenFields","tasksHiddenFields","servicesHiddenFields","popoverDuration","from","type","relatedList","isFromModal","pined_fields_limit","featureName","property_fields","isAccessibilityConfigSupported","persistManageColumns","renderWithoutCustomView","customMethodImplemented","saveButtonLiteral","fromDetailView"],setFieldValues:function(){this.callForArrangement()}.observes("cvid","relatedList").on("init"),data:function(){return{cvid:Lyte.attr("string"),module:Lyte.attr("string"),module_info:Lyte.attr("object"),fields:Lyte.attr("array"),selected_fields:Lyte.attr("array",{default:[]}),selected_fields1:Lyte.attr("array",{default:[]}),ordered_fields:Lyte.attr("array",{default:[]}),ordered_fields1:Lyte.attr("array",{default:[]}),showNoResult:Lyte.attr("boolean",{default:!1}),showPopoverfooter:Lyte.attr("boolean",{default:!1}),showModal:Lyte.attr("boolean",{default:!1}),displayFieldMap:Lyte.attr("object",{default:crmConstants.moduleDisplayField}),searchvalue:Lyte.attr("string",{default:""}),appointmentHiddenFields:Lyte.attr("array",{default:["RESCHEDULEDFROM","REMINDER","ENDTIME","JOBSHEETSECTION","ISJOBSHEETCREATED"]}),tasksHiddenFields:Lyte.attr("array",{default:["REMINDAT","SENDNOTIFICATION"]}),servicesHiddenFields:Lyte.attr("array",{default:["AVAILABLE_DATES","AVAILABLE_DAYS","UNAVAILABLE_TILL","STARTING_DATE","CLOSING_DATE","APPOINTMENTFOR","SEID","APPOINTMENTLOCATION","APPOINTMENTID","APPOINTMENTADDRESS","APPOINTMENTDATEANDTIME","RESCHEDULEDFROM","SERVICEID","RESCHEDULEDTO","RESCHEDULEDREASON","RESCHEDULEDNOTE","CANCELLATIONREASON","CANCELLATIONNOTE","SERVICEAVAILABILITY","AVAILABLE_CUSTOM_TIMING","UNAVAILABLE_FROM","JOBSHEETSECTION"]}),popoverDuration:Lyte.attr("string",{default:void 0}),from:Lyte.attr("string"),type:Lyte.attr("string",{default:"popup"}),relatedList:Lyte.attr("object"),isFromModal:Lyte.attr("boolean",{default:!1}),pined_fields_limit:Lyte.attr("number",{default:Crm.userDetails.customViewPinLimit?Crm.userDetails.customViewPinLimit:1}),featureName:Lyte.attr("string"),property_fields:Lyte.attr("array",{default:[]}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),persistManageColumns:Lyte.attr("boolean",{default:!0}),renderWithoutCustomView:Lyte.attr("boolean",{default:!1}),customMethodImplemented:Lyte.attr("boolean",{default:!1}),saveButtonLiteral:Lyte.attr("string",{default:"crm.button.save"}),fromDetailView:Lyte.attr("boolean",{default:"detail"===Lyte.Router.getRouteInstance().routeName})}},callForArrangement:function(){var e=this.getData("module"),t=moduleRecordMapping[e];t.activity_badge=t.activity_badge?t.activity_badge.toLowerCase():t.activity_badge,t.notes_badge=t.notes_badge?t.notes_badge.toLowerCase():t.notes_badge,"dashboard"===this.getData("featureName")&&(!t.custom_view&&(t.custom_view={fields:{}}),t.custom_view.fields=this.getData("fields"),t.fields=$L("crm-records-view")[0].component.data.fields,t.activity_badge="not_supported");for(var i=t.fields.slice(0),a=this.getData("displayFieldMap"),o=[],s=i.length,n=0,d=!1,l=0;l<s;l++){var r=i[l];if(!(0===r.show_type&&"FULLNAME"!==r.column_name&&"PROCESSINGBASIS"!==r.column_name&&"SE_STATUS"!==r.column_name||"S_MODIFIEDTIME"===r.column_name&&17===r.show_type)&&(("SEID"!==r.column_name||"Entity_Cadences"!==e||"Seid__s"!==r.api_name)&&"EntityCadencesid__s"!==r.api_name&&("Entity_Cadences"!==e||"Cadencesid__s"!==r.api_name&&"End_Date__s"!==r.api_name&&"Member_Status__s"!==r.api_name||(r.mandatory=!0),250!==r.ui_type&&r.visible&&r.available_in_user_layout&&("Cases"!==e&&"Solutions"!==e||"ADDCOMMENT"!==r.column_name)&&("TAGMODULEREFID"!==r.column_name||!d)&&!("Tasks"===e&&this.data.tasksHiddenFields.indexOf(r.column_name)>-1)&&!("Appointments"===e&&this.data.appointmentHiddenFields.indexOf(r.column_name)>-1)&&!("Services"===e&&this.data.servicesHiddenFields.indexOf(r.column_name)>-1)&&(!e.startsWith("Orchestration")||"SMOWNERID"!==r.column_name)&&(!e.startsWith("PathFinder")||"SMOWNERID"!==r.column_name&&"PATH"!==r.column_name&&"TRIGGERID"!==r.column_name&&"ORCHESTRATIONID"!==r.column_name)&&("DealHistory"!==e||"LASTACTIVITYTIME"!==r.column_name)&&(!Crm.isInventoryModule(e)||"DISCOUNT_TYPE"!==r.column_name&&"DISCOUNT_PERCENTAGE"!==r.column_name)))){var m=a[e]?a[e]:[];if(e.indexOf("CustomModule")<0&&e.indexOf("LinkingModule")<0&&1==m.length&&m[0]==r.api_name)r.mandatory=!0;else if(e.indexOf("CustomModule")<0&&e.indexOf("LinkingModule")<0)for(var c=0;c<2;c++)m[c]===r.api_name&&"dashboard"!==this.getData("featureName")&&(r.mandatory=!0);else"Name"==r.api_name&&(r.mandatory=!0);if("TAGMODULEREFID"==r.column_name&&(d=!0),(e.startsWith("Orchestration")||e.startsWith("PathFinder"))&&"id"===r.api_name&&(r.mandatory=!0),"Activities"==e&&"ACTIVITYTYPE"==r.column_name&&(r.mandatory=!0),"DealHistory"!=e||"STAGE"!=r.column_name&&"STAGEDURATION"!=r.column_name||(r.mandatory=!0),"Tasks"!==e&&"Calls"!==e&&"Events"!==e||"SMOWNERID"!==r.column_name&&"CALLSTARTDATETIME"!==r.column_name&&"ENDDATETIME"!==r.column_name&&"ALLDAYEVENT"!==r.column_name&&"DUEDATE"!==r.column_name&&"STARTDATETIME"!==r.column_name||(r.mandatory=!("detailView"!==this.data.from||!Crm.isActivitySplitDone)),"APPOINTMENTDATEANDTIME"!==r.column_name&&"SMOWNERID"!==r.column_name||"Appointments"!==e||"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||(r.mandatory=!("detailView"!==this.data.from||!Crm.isActivitySplitDone)),"Full_Name"!=r.api_name||"Contacts"!=t.module_name&&"Leads"!=t.module_name||(r.field_label=I18n.getMsg("custommodule.crmfield.fl.name",t.singular_label)),!e.startsWith("Orchestration")&&!e.startsWith("PathFinder")&&"id"===r.api_name)continue;if("detailView"===this.data.from&&Crm.userDetails.isRelatedListLyteEnabled&&17===r.show_type)continue;o[n]=r,n++}}this.getMethods("getColumnListFields")&&(o=this.executeMethod("getColumnListFields",o,this.getData("module"),this));var p=this.data.renderWithoutCustomView?$L("crm-custom-outer-box")[0].component.data.listfields:"detailView"===this.data.from?this.data.relatedList.fields:t.custom_view.fields.slice(0);if((this.setData({ordered_fields:o,selected_fields:p,module_info:t}),"COMPLIANCE"!==this.getData("featureName")&&this.setData({property_fields:"not_supported"===t.activity_badge||"detailView"===this.data.from?[]:[{api_name:"activity_badge",selected:"enabled"===t.activity_badge,field_label:I18n.getMsg("crm.customview.activty.badge")}]}),document.getElementsByTagName("crm-list-view")[0])&&$L("crm-list-view")[0].component.getData("showNote")){var u=this.getData("property_fields");this.setData("property_fields",u)}},actions:{saveCustomView:function(){var e,t,i="CHARTVIEWS"===this.getData("featureName"),a=this.getData("module_info"),o=this.data.persistManageColumns,s=$L("crux-column-list")[0].component,n=s.getSelectedFields(),d=s.getSelectedPropertyFields(),l=!1,r=!1,m=[];if("dashboard"===this.getData("featureName"))return this.executeMethod("updateFieldsInDashboardsDD",n),!1;var c=[],p="",u=$L("crm-inner-list")[0],f=document.getElementsByTagName("crm-list-view")[0],h=this,y=new Map,_=f?f.getData("cv_mod_pined_fields"):[],g=u?u.getData("cv_mod_fields"):new Map,v=g.size>0,b=i?store.peekRecord("chart_view",a.chart_id):store.peekRecord("custom_view",this.getData("cvid")),D=new Map,L=Lyte.Router.getRouteInstance();h.pinUpdateFailed=!1;var C=_.length;"list"===h.data.from&&u&&u.getData("isResizeEnabled")&&b&&b.fields&&b.fields.forEach((function(e){e._width&&y.set(e.id,e._width)})),_.forEach((function(e){var t;n.forEach((function(i){void 0===t&&i.id===e&&(t=!0)})),t||_.removeFirstOccurenceOfElement(e)}));var E=0,w=0;n.forEach((function(e){e&&e.selected&&(e.pinned||_.contains(e.id))&&(E+=v?g.has(e.id)?g.get(e.id):e.width?e.width:h.getDefaultWidthForField(e.ui_type):y.has(e.id)?y.get(e.id):h.getDefaultWidthForField(e.ui_type),w++)}));var P=[];n.forEach((function(e){if(e&&e.selected){if("detailView"===h.data.from)var t={api_name:e.api_name,id:e.id};else t={api_name:e.api_name,_pin:void 0!==e.pinned?e.pinned:_.contains(e.id),id:e.id};var i=_.indexOf(e.id);switch(t._pin){case!0:e._pin_order&&(t._pin_order=e._pin_order),(-1===i||e._pin_order&&i+1!==e._pin_order)&&(-1!==i&&_.splice(i,1),_.splice(e._pin_order-1,0,e.id),P.push(t),l=!0),r=!0;break;case!1:-1!==i&&(_.splice(i,1),l=!0)}if("list"===h.data.from&&u&&u.getData("isResizeEnabled")){var a=!1;if(t._pin){var o=v?g.has(e.id)?g.get(e.id):e.width?e.width:h.getDefaultWidthForField(e.ui_type):y.has(e.id)?y.get(e.id):h.getDefaultWidthForField(e.ui_type),s=document.querySelector(".lyteExpTableOrigTableInnerWrap").clientWidth,n=h.calculatefixedColumnWidth();o&&s&&n+E+100>s&&(g.set(e.id,Math.round((s-n-100)/w)),a=!0)}if(!a)if(v){if(!g.has(e.id)){var d=e.width?e.width:h.getDefaultWidthForField(e.ui_type);g.set(e.id,d)}}else y.has(e.id)?g.set(e.id,y.get(e.id)):D.set(e.id,h.getDefaultWidthForField(e.ui_type))}"lookup"==e.data_type&&(c.push(e),p=p.concat(e.field_label+", ")),m.push(t)}})),"list"===h.data.from&&u&&u.getData("isResizeEnabled")&&(D.size>0&&g.size>0&&D.forEach((function(e,t){g.set(t,e)})),g.size>0&&b&&(u.setData("cv_width_updated",!0),u.setData("width_prev_cvid",b.id)));a=moduleRecordMapping[this.getData("module")];var N=d.find((e=>"activity_badge"===e.api_name)),I=f&&f.getData("activity_badge")?f.getData("activity_badge").toLowerCase():void 0,S=d.find((e=>"notes_badge"===e.api_name)),A=f&&f.getData("notes_badge")?f.getData("notes_badge").toLowerCase():void 0;if(f&&void 0===N&&I&&"enabled"===I?e="disabled":f&&void 0!==N&&I&&"disabled"===I&&(e="enabled"),f&&void 0===S&&A&&"enabled"===A?t="disabled":f&&void 0!==S&&A&&"disabled"===A&&(t="enabled"),JSON.stringify(this.data.selected_fields1)===JSON.stringify(m)&&void 0===e&&void 0===t)return this.fieldmodified=!1,void((!Crm.userDetails.isRelatedListLyteEnabled&&"detailView"!==this.data.from||Crm.userDetails.isRelatedListLyteEnabled||this.data.ordered_fields.length===this.data.selected_fields1.length)&&this.hidePopover());var x=!1;if(this.data.selected_fields1.length!==m.length&&(x=!0),!x)for(var M=m.length,T=0;T<M;T++)if(m[T].id!==this.data.selected_fields1[T].id||m[T].api_name!==this.data.selected_fields1[T].api_name){x=!0;break}var R={};e&&(R.activity_badge=e),t&&(R.notes_badge=t),Object.keys(R).length>0&&this.activityBadgeUpdate(a,q,f,R,B);var F=a.api_name,O=Crm.userDetails.isRelatedModuleFilters,q=h.getData("isFromModal"),B=$L("#columnlistPrimaryBtn")[0];if(this.data.customMethodImplemented){var U={fieldArr:m,columnListComponent:this,method:"handleManageColumns"};Lyte.triggerEvent("invokeDrillDownMethodImplementation",U)}else if(c.length>5&&!O)getElemById("lookupCrt").style.display="none",getElemById("lookupSelect").style.display="",getElemById("lookupSelectCol").innerText=p,this.setData("closePopover",!1),showAnimatePopup("lookupErrorMsg"),$(".columnListNew").addClass("popupLookupEnable");else if(this.getMethods("onSaveCustomView"))this.executeMethod("onSaveCustomView",m,this);else{var k={module:F};b.$.set("fields",m);var V={fields:!C&&l?P:b.fields,id:this.getData("cvid")};h=this;if(!x)return l&&this.pinUnpinUpdate(V,k,f,_,h,b,B,u,q,x,r),this.fieldmodified=!1,void("detailView"===this.data.from&&this.data.ordered_fields.length!==this.data.selected_fields1.length||this.hidePopover());b.$.set("sort_order",null),b.$.set("sort_by",{}),this.setData("closePopover",!0),B.setData("ltPropDisabled",!0),this.getData("isFromModal")&&this.getData("featureName")&&this.setFeatureSpecificParams(k,this.getData("featureName")),o?b.$.save(k).then((function(){l?h.pinUnpinUpdate(V,k,f,_,h,b,B,u,q,x,r):f.setData({cv_mod_pined_fields:_,pined_fields_length:_.length}),h.getRecordsDetails(h,b,_,n,r,l,F,a,q,i,L)}),(function(e){403==e.status||401==e.status?renderingUtils.displayPermissionDenied(e):400==e.status?(i?h.handleErrorChartViews(e):_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.field.permission.error")},close:function(){q?this.fetchData({queryParams:L.getQueryParams()},F,{clearCache:!0},!0,!1,this.data.featureName):L.transitionTo({route:L.transition.target,dynamicParams:L.transition.info.dynamicParams,queryParams:L.getQueryParams()}).data={clearCache:!0,reloadAll:!0}}}),h.hidePopover()):(h.hidePopover(),store.findRecord("module",moduleRecordMapping[h.data.module].id).then((function(){h.callForArrangement()}))),b.$.rollBack(),B.setData("ltPropDisabled",!1),commonUtils.showHideLoadingDiv()})):h.getRecordsDetails(h,b,_,n,r,l,F,a,q,i,L)}},closePopover:function(){this.setData("closePopover",!0),this.hidePopover()}},hidePopover:function(){if("modal"===this.data.type?this.setData("showModal",!1):document.getElementById("newPopup").ltProp("show",!1),"list"===this.data.from){var e=document.querySelector("crm-listview-options");e&&(e.setData("columnListOpen",!1),e.setData("showCont",!1))}},validateLimit:function(){var e=$L("crux-column-list")[0].component.getSelectedFields();if(Crm.userDetails.isRelatedListLyteEnabled)var t=this.mandFields[this.getData("relatedList").personality_name]+5;else t=crmRelatedList.mandFields[this.getData("relatedList").personality_name]+5;var i=$("#customize_error");if(e.length>=t){$("crux-column-list lyte-menu-item lyte-checkbox").addClass("disableColumns");var a=$(".cxColListCheckedElem");a.addClass("enableColumns"),a.removeClass("disableColumns"),i.removeClass("dN"),$L(".disableColumns").each((function(e,t){$L(t)[0].ltProp("disabled",!0)})),this.getMethods("onColumnListResize")&&this.executeMethod("onColumnListResize")}else{$L(".disableColumns").each((function(e,t){$L(t)[0].ltProp("disabled",!1)}));var o=$("crux-column-list lyte-menu-item lyte-checkbox");o.removeClass("disableColumns"),o.addClass("enableColumns"),i.addClass("dN")}},restrictMandatorySelect:function(){$L(".mandatory").each((function(e,t){$L(t.parentElement.parentElement.parentElement.parentElement).addClass("actMandColUnSort")}))},methods:{columnResize:function(e){$L.fastdom.measure(function(){e&&e.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1)}.bind(this))},itemDrop:function(){this.callcleasrselectedFields=!0},beforePopoverClose:function(){if($L("#lookupErrorMsg")&&$L("#lookupErrorMsg")[0].classList.contains("zcrm-show"))return!1},onPopoverShow:function(){$L("lyte-expresstable #addColumn").addClass("eventNone"),this.isNotActivitySubPersonality(this.data.relatedList.personality_name,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)||(this.restrictMandatorySelect(),this.validateLimit())},beforePopoverShow:function(){var e="CHARTVIEWS"===this.getData("featureName"),t=this.getData("module_info"),i=e?t&&t.chart_id?store.peekRecord("chart_view",t.chart_id):i:store.peekRecord("custom_view",this.getData("cvid"));this.data.renderWithoutCustomView&&((i=i||{}).fields=$L("crm-custom-outer-box")[0].component.data.listfields,$L("crux-column-list")[0].component.data.cxPropPinUnpinOption=!1),"dashboard"===this.getData("featureName")&&((i={}).fields=this.getData("fields"),$L("crux-column-list")[0].component.data.cxPropPinUnpinOption=!1);var a=[];i.fields.forEach((function(e){var t=Object.assign({},e);a.push(t)})),this.setData({ordered_fields1:this.data.ordered_fields,selected_fields1:this.data.isResizeEnabled&&i.fields?this.getCVFieldsWOWidth(a):a}),this.callcleasrselectedFields&&($L("crux-column-list")[0].component.clearSelectedFields(),this.callcleasrselectedFields=!1),this.data.property_fields.length>0&&"not_supported"!==this.data.module_info.activity_badge&&Lyte.objectUtils(this.data.property_fields[0],"add","selected","enabled"===this.data.module_info.activity_badge),this.data.property_fields.length>1&&Lyte.objectUtils(this.data.property_fields[1],"add","selected","enabled"===this.data.module_info.notes_badge),this._resize()},closePopover:function(){if(this.fieldmodified&&(this.callcleasrselectedFields=!0),this.fieldmodified=!1,"modal"===this.data.type?(this.setData("showModal",!1),$L(".columnListNew").find(".divTopBorder").scrollTop(0)):(document.getElementById("newPopup").ltProp("show",!1),Crm.userDetails.isRelatedListLyteEnabled?($L(".addColumnContainer").find("div").scrollTop(0),this.isNotActivitySubPersonality(this.data.relatedList.personality_name,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)||$L(".actMandColUnSort").each((function(e,t){$L(t).removeClass("actMandColUnSort")}))):$L(".addColumnPopover").find(".divTopBorder").scrollTop(0)),"list"===this.data.from){var e=document.querySelector("crm-listview-options");e&&e.setData("columnListOpen",!1)}document.querySelector("#cruxColumnSearch").setValue(""),CScriptLib&&(Crm.userDetails.isRelatedListLyteEnabled&&"detailView"!==this.data.from||!Crm.userDetails.isRelatedListLyteEnabled)&&"dashboard"===!this.getData("featureName")&&ListViewHandler.addStyle()},beforeUnchecking:function(e){this.fieldmodified=!0;var t=this.getData("module");if("Name"==e.api_name&&e.mandatory)return!1;if(e.pinned)return!1;if("dashboard"===this.getData("featureName")&&e.mandatory)return!1;if(("Leads"==t||"Contacts"==t)&&e.mandatory){if(Crm.userDetails.isRelatedListLyteEnabled){var i=this.leadContactMandCheck(t);if(i.lastName&&i.fullName)return!0}else{var a=moduleRecordMapping[t].fields,o=a.filterBy({api_name:"Last_Name"})[0].id,s=a.filterBy({api_name:"Full_Name"})[0].id,n=this.data.ordered_fields.filter((function(e){return e.id==o}))[0].api_name,d=this.data.ordered_fields.filter((function(e){return e.id==s}))[0].api_name,l=document.getElementById(o+"_"+n).checked,r=document.getElementById(s+"_"+d);if(r=!!r&&r.checked,l&&r)return!0}return!1}return!e.mandatory},PinOptionChanged:function(){this.fieldmodified=!0,this.pinFieldModified=!0},beforeSelection:function(e,t){this.fieldmodified=!0;var i=$L("crux-column-list")[0].component.getSelectedFields().length;return!t.classList.contains("cxColPropField")&&"dashboard"===this.getData("featureName")&&i>=Search.dashboardDrillDown_MAX_COL_CNT?(crmui.showMsgBand("error",I18n.getMsg("crm.alert.max.cvcols.reached",Search.dashboardDrillDown_MAX_COL_CNT),4e3),!1):!t.classList.contains("cxColPropField")&&i>=Search.MAX_COL_CNT&&"dashboard"!==this.getData("featureName")?(crmui.showMsgBand("error",I18n.getMsg("crm.alert.max.cvcols.reached",Search.MAX_COL_CNT),4e3),!1):void 0},onCheckBoxChanged:function(e,t,i,a){if(this.isNotActivitySubPersonality(this.data.relatedList.personality_name,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)||this.validateLimit(),Crm.userDetails.isRelatedListLyteEnabled){var o=this.getData("module");if("detailView"===this.getData("from")&&("Leads"===o||"Contacts"===o)&&i[a].mandatory){var s=this.leadContactMandCheck(o);s.lastName&&s.fullName||i[a].id!==s.lastnameId&&i[a].id!==s.fullnameId?s.lastName&&s.fullName&&($L(s.fullnameEle).closest("lyte-menu-item")[0].classList.remove("cxFieldDisabledCursor"),$L(s.lastnameEle).closest("lyte-menu-item")[0].classList.remove("cxFieldDisabledCursor")):s.lastName?($L(s.lastnameEle).closest("lyte-menu-item")[0].classList.add("cxFieldDisabledCursor"),s.fullnameEle&&$L(s.fullnameEle).closest("lyte-menu-item")[0].classList.remove("cxFieldDisabledCursor")):s.fullName&&($L(s.fullnameEle).closest("lyte-menu-item")[0].classList.add("cxFieldDisabledCursor"),$L(s.lastnameEle).closest("lyte-menu-item")[0].classList.remove("cxFieldDisabledCursor"))}}},onBeforeDropItem:function(e,t,i){return!!(this.isNotActivitySubPersonality(this.data.relatedList.personality_name,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)||!0!==t.mandatory&&!0!==i.mandatory)},preventSort:function(){return!this.isNotActivitySubPersonality(this.data.relatedList.personality_name,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)},updateFieldsInDashboardsDD:function(e){var t=[];e.forEach((e=>{t.push({api_name:e.api_name})})),this.setData("closePopover",!0),this.hidePopover();var i=document.querySelector("crm-records-view").component;i.methods.validateAndAddFields(i,t,"updateFields")}},leadContactMandCheck:function(e){var t=moduleRecordMapping[e].fields,i=t.filterBy({api_name:"Last_Name"})[0].id,a=t.filterBy({api_name:"Full_Name"})[0].id,o=this.data.ordered_fields.filter((function(e){return e.id===i}))[0].api_name,s=this.data.ordered_fields.filter((function(e){return e.id===a}))[0].api_name,n=document.getElementById(i+"_"+o),d=n.checked,l=document.getElementById(a+"_"+s);return{lastName:d,fullName:!!l&&l.checked,lastnameEle:n,fullnameEle:l,lastnameId:i,fullnameId:a}},didConnect:function(){this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize,!0);var e=document.getElementById("newPopup");e.ltProp({headerPadding:"0px 5px 0px 5px",contentPadding:"0",footerPadding:"8px 15px"}),"detailView"!=this.data.from&&e.ltProp("show",!0)},didDestroy:function(){window.removeEventListener("resize",this._resize,!0)},resize:function(){if(this.getMethods("onColumnListResize"))this.executeMethod("onColumnListResize");else{var e=$L("#columnListId"),t=$L("#columnListId lyte-menu-item");if(t&&t.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1),"list"===this.data.from&&"modal"===this.data.type){var i=e.find("lyte-search");if($L("#idForCV").length&&e.length){var a=window.innerHeight-200,o=30*t.length+100,s=$L("#wmstoolbar");a>o&&(a=o),s.outerHeight()&&(a-=s.outerHeight()),a=a-$L("#addColPopFoot").outerHeight()+i.outerHeight()+10}}}},activityBadgeUpdate:function(e,t,i,a,o){var s;e.activity_badge=a.activity_badge?a.activity_badge:e.activity_badge,e.notes_badge=a.notes_badge?a.notes_badge:e.notes_badge;var n=this;t&&(s=e.$.get("custom_view"),e.$.rollBackAttributes("custom_view")),commonUtils.showHideLoadingDiv(!0),e.$.triggerAction("view_preference_configurations",{module:e.api_name},{},"PUT",a).then((function(){a.activity_badge&&i.setData("activity_badge",a.activity_badge),a.notes_badge&&i.setData("notes_badge",a.notes_badge);var t=Object.assign([],i.component.data.customview_records);i.setData({customview_records:t}),n.headerSelection(e),commonUtils.showHideLoadingDiv()}),(function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.customview.activity.badge.update.failure")}}),a.activity_badge&&e.$.rollBackAttributes("activity_badge"),a.notes_badge&&e.$.rollBackAttributes("notes_badge"),o.setData("ltPropDisabled",!1),commonUtils.showHideLoadingDiv()})),t&&e.$.set({custom_view:s})},pinUnpinUpdate:function(e,t,i,a,o,s,n,d,l,r,m){var c=Lyte.Router.getRouteInstance(),p=moduleRecordMapping[this.getData("module")],u=d.getData("persistPinUpdate");commonUtils.showHideLoadingDiv(!0),u?store.triggerAction("custom_view","pin_unpin_fields",e,{module:t.module}).then((function(){o.doPinUnpin(o,p,i,a,s,d,r,m)}),(function(e){var t=-1!==e.responseText.indexOf("Maximum Limit Reached to Pin the Field")?I18n.getMsg("crm.customview.pin.unpin.maximum.limit.new",1):-1!==e.responseText.indexOf("Given Field is not associated with the mentioned Custom View")?I18n.getMsg("crm.customview.pin.unpin.column.error.msg"):I18n.getMsg("crm.customview.pin.unpin.issue");a.length&&m&&(o.pinUpdateFailed=!0),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:t},close:function(){l?this.fetchData({queryParams:c.getQueryParams()},module,{clearCache:!0},!0,!1,o.data.featureName):c.transitionTo({route:c.transition.target,dynamicParams:c.transition.info.dynamicParams,queryParams:c.getQueryParams()}).data={clearCache:!0,reloadAll:!0}}}),o.hidePopover(),s.$.rollBack(),n.setData("ltPropDisabled",!1),commonUtils.showHideLoadingDiv()})):o.doPinUnpin(o,p,i,a,s,d,r,m)},doPinUnpin:function(e,t,i,a,o,s,n,d){if(i.setData({cv_mod_pined_fields:a,pined_fields_length:a.length}),!n){var l=Object.assign([],i.component.data.customview_records);s&&d&&e.pinFieldModified&&(s.setData("doEnablePinnedColAnim",!0),setTimeout((function(){s.setData("doEnablePinnedColAnim",!1)}),2e3)),i.setData({listfields:o.fields,customview_records:l}),CScriptLib&&CScript.Engine.Global.dispatchEvent("onCustomViewLoad",null,{id:t.custom_view.id,name:t.custom_view.display_value}),e.headerSelection(t),commonUtils.showHideLoadingDiv()}},getRecordsDetails:function(e,t,i,a,o,s,n,d,l,r,m){var c=$L("#columnlistPrimaryBtn")[0],p=$L("crm-inner-list")[0],u=document.getElementsByTagName("crm-list-view")[0];s||u.setData({cv_mod_pined_fields:i,pined_fields_length:i.length}),store.unloadAll(d.id);var f={};if(l){var h=$L("#customFilter")[0].component.getFilterCriteria();f=h?h.queryParams:{}}var y=l?f:m.getQueryParams(),_={module:n,page:y&&y.page||d.start_index>1?Math.round(d.start_index/Number(d.per_page))+1:1,per_page:d.per_page};l&&(y||(y={}),e.setFeatureSpecificFilters(y,e.getData("featureName")));var g=!y.search_field||t.fields.find((function(e){if(e.api_name===y.search_field)return!0}));if(e.beforeRecordAPI(y,_,d,e.getData("cvid")),r){var v=a.mapByKey("api_name");_.fields=[...new Set(_.fields.concat(v))]}commonUtils.showHideLoadingDiv(!0);var b=e.fieldmodified;y.sort_by||!g?(y.sort_by&&(y.sort_by=void 0,y.sort_order=void 0),g||(y.search_letter=void 0,y.search_field=void 0),c.setData("ltPropDisabled",!1),e.hidePopover(),m.setQueryParams(y)):store.findAll(d.id,_).then((function(i){c.setData("ltPropDisabled",!1),e.hidePopover(),t.sort_by=null,t.sort_order=null,p&&o&&b&&e.pinFieldModified&&s&&(p.setData("doEnablePinnedColAnim",!0),setTimeout((function(){p.setData("doEnablePinnedColAnim",!1)}),2e3)),e.pinUpdateFailed&&t.fields.forEach((e=>{e._pin=!1})),u.setData({listfields:t.fields,customview_records:i}),e.headerSelection(d),CScriptLib&&CScript.Engine.Global.dispatchEvent("onCustomViewLoad",null,{id:t.id,name:t.display_value}),commonUtils.showHideLoadingDiv()}),(function(t){403==t.status&&renderingUtils.displayPermissionDenied(t);var i=t.response?JSON.parse(t.response):void 0;400===t.status&&"LOOKUP_LIMIT_EXCEEDED"===i.code&&i.details&&Crm.userDetails.isRelatedModuleFilters&&e.handleLimitForCrossFilters(i,d.module_name),r&&e.handleErrorChartViews(t),c.setData("ltPropDisabled",!1),commonUtils.showHideLoadingDiv()})),e.fieldmodified=!1}},{mixins:["crm-view-utils","crm-list-view-modal-util","crm-related-list-utils"]});
