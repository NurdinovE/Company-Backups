Lyte.Router.registerRoute("crm.settings",{queryParams:[{module:{refreshModel:!1}}],didTransitionCalled:!1,getDependencies:function(){return Crm.settingsDependencies(!1)},getResources:function(){var e=[];if(crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),featuresAvailable.NEXTGENUI_ENABLED&&("true"===window.isCrmPlusUser||"true"===window.isZohoOneUser)&&void 0!==Crm.userDetails.PROFILE_POPUP){var t=networkUtils.returnDependencyFiles(["crm-getting-start.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-getting-start.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("onboardingPageRevampProfileMenu"),networkUtils.getI18nJSUrl("onboardingpageSetupPageText")],ResourceConstants.CRM);e=e.concat(t).concat(r).concat(s)}return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-dataprivacy-mixins.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-email-auth-util.js","crm-email-deliverability-handling.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],ResourceConstants.CRM)),featuresAvailable.DUPLICATE_IMAGE_DETECTION&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("DuplicateImageDetectionOther")],ResourceConstants.CRM))),e},model:function(e){if((featuresAvailable.NEXTGENUI_ENABLED&&(!globalSetpJson||globalSetpJson.components.length<=0)||!featuresAvailable.NEXTGENUI_ENABLED)&&(Crm.isSettingPage=!1),!Crm.isSettingPage){Crm.isSettingPage=!0;var t=[];return t[0]=store.findAll("settings_customization"),t[1]=setup,t[2]=this,Lyte.resolvePromises({customizationJson:Lyte.resolvePromises(t),userSettingsPreferenceJson:featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.NEXTGENUI_USER_SETTINGS_PREFERENCE?store.findAll("dummy",{},!1,!1,{url:"/crm/v8/__internal/settings/user_settings_preference",method:"GET"}):void 0})}return{}},afterModel:function(e,t){Crm.isSettingPage=!0;var r=e.customizationJson?e.customizationJson[1]:{};e.customizationJson&&(crmSetup.Permissioned_Setup_Elements=[],this.metaBinding(r)),e.userSettingsPreferenceJson&&(crmSetup.setupPreferenceJSON=e.userSettingsPreferenceJson,crmSetup.freqAccessedIds&&0!==crmSetup.freqAccessedIds.length||(crmSetup.freqAccessedIds=e.userSettingsPreferenceJson.user_settings_preference.frequently_accessed_components)),(!globalSetpJson||globalSetpJson.components.length<=0||!Crm.isDirectAccessPage)&&e.customizationJson&&(globalSetpJson=e.customizationJson[0])},redirect:function(){var e,t,r=this.transition.target;"crm.settings.section.widget"===r&&(t=this.transition.info.dynamicParams[0]),r.includes("crm.settings.section.extensions.zoho-extensions")&&(r="crm.settings.section.extensions.zoho-extensions.zoho-apps"),r.includes("crm.settings.section.assignment-thresholds")&&(r="crm.settings.section.assignment-thresholds");var s=Lyte.Router.getRouteInstance().routeName;"undefined"==typeof Search||!Crm.userDetails.multiSelectFilterOptions||"edit-custom-view"!==s&&"create-custom-view"!==s&&"clone-custom-view"!==s?Search.supportMSPOption=!1:Search.supportMSPOption=!0;var n=!1;if(globalSetpJson&&void 0!==globalSetpJson){for(var i=globalSetpJson.components.length,o=0;o<i;o++)for(var a=globalSetpJson.components[o],l=a.menus.length,c=0;c<l;c++){var u=a.menus[c];if("system.zia"!==u.api_name||"system.general"!==u.group.api_name)for(var d=u.sub_menus.length,m=0;m<d;m++){var p=u.sub_menus[m],g=!p.show||!u.show||!a.show;if("system.customization"!==a.api_name||"system.canvasbuilder"!==u.api_name||"system.detailview"!==p.api_name&&"system.listview"!==p.api_name&&"system.formview"!==p.api_name&&"system.wizardview"!==p.api_name||"crm.settings.section.canvas-builder.canvasrules"!==r||(n=!0,(g=!u.show||!a.show)||(g=0===u.sub_menus.filter((function(e){return e.show})).length)),this.transition.target===p.routeName&&(e=p.api_name),r.indexOf(p.routeName)>-1&&!n&&(n=!0),r.indexOf("crm.settings.section.cadences")>-1&&(n=!0),r.indexOf(p.routeName)>-1&&g&&("true"!==window.isSandboxAcc||"crm.settings.section.zohocpq"!==p.routeName||this.transition.info.dynamicParams[0]===p.dynamicParams[0])){var f=!0,h=!0;"crm.settings.section.widget"===r&&(h=t===p.dynamicParams[0],f=t===p.dynamicParams[0]),"crm.settings.section.kiosk.index-kiosk"!==r&&"crm.settings.section.kiosk.edit-kiosk-builder"!==r||p.routeName===r||(f=!1,h=!1),"system.modules"===p.api_name&&(r.indexOf("crm.settings.section.modules.index-modules")>-1?f=!this.transition.data.fromLayoutPage:r.indexOf("crm.settings.section.modules.module.summary-module")>-1&&g?h=!0:!r.indexOf(p.routeName+"."+p.indexRoute)>-1&&g&&(f=!1,h=!1)),featuresAvailable.NEXTGENUI_ENABLED&&r.includes("crm.settings.section")&&(f=!1),h&&(featuresAvailable.NEXTGENUI_ENABLED||this.replaceWith("crm.settings.index")),f&&setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),10)}}}if(void 0!==Crm.userDetails.available_menu&&(this.replaceWith("crm.settings.index"),-1==Crm.userDetails.available_menu.toString().indexOf(e)))return void _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.setup.editor.invalid.action"),ltPropSecondaryMessage:I18n.getMsg("crm.setup.sandbox.permission.denied"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.setup.editor.refreshButton"),appearance:"failure"}],ltPropButtonPosition:"right",ltPropShowCloseButton:!1,ltPropType:"error"},close:function(){setTimeout((function(){Utils.windowLocationReload()}),1e3)}});featuresAvailable.TEAMSPACE_ENABLED&&"crm.settings.section.tab-groups"===r&&(n=!0),!n&&"crm.settings.section.webform.view-webform.preview-webform"===r&&!Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal||globalSetpJson.components.find((e=>"system.cpq"===e.api_name&&1===e.menus.length&&"system.guidedselling"===e.menus[0].api_name))&&("priceRules"===this.transition.info.dynamicParams[0]||"productConfigurator"===this.transition.info.dynamicParams[0])?featuresAvailable.NEXTGENUI_ENABLED?(this.transition.abort(),renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(()=>{crmHistory.back()}))):(this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied()}),10)):n||void 0===r||!r.includes("crm.settings.section")||"crm.settings.section.webform.view-webform.preview-webform"===r||"crm.settings.section.zia"===r||"crm.settings.section.zia.emailintent.routeerror"===r||"crm.settings.section.zia.emailintent"===r||"crm.settings.section.zia.emailintent.index"===r||"crm.settings.section.zia.emailintent.customintent"===r||"crm.settings.section.zia.emailintent.customintent.create"===r||"crm.settings.section.zia.emailintent.customintent.mailview"===r||"crm.settings.section.zia.emailintent.customintent.view"===r||"crm.settings.section.zia.emailintent.customintent.emails_content"===r||"crm.settings.section.zia.emailintent.customintent.files"===r||"crm.settings.section.zia.emailintent.customintent.edit"===r||r.includes("crm.settings.section.zia.prediction")||r.includes("crm.settings.section.zia.zia-voice")||r.includes("crm.settings.section.email-settings")||r.includes("crm.settings.section.extensions")||r.includes("section-error")||r.includes("settings-wildcard")||"crm.settings.section.import"===r||r.includes("manage-mass-mail")||r.includes("schedule-mass-email")||r.includes("autoresponders")||r.includes("custom-view")||r.includes("webform-builder")||r.includes("api-module-detail")||r.includes("api-table-view")||r.includes("crm.settings.section.widget")||r.includes("macro")||r.includes("manage-tags")||r.includes("competitor-alerts")||r.includes("voice-of-customer")||r.includes("crm.settings.section.calendar-booking")||"crm.settings.index"===r||"crm.settings.editor"===r||this.transition.target.includes("crm.settings.section.extensions.social-extensions")||"crm.settings.section.api-modules"===r||"crm.settings.section.api-paid"===r||(featuresAvailable.NEXTGENUI_ENABLED?(this.transition.abort(),renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(()=>{crmHistory.back()}))):(this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied()}),10))),crmSetup.mySetupArray=[];var y=globalSetpJson.components,C=[];if(featuresAvailable.NEXTGENUI_ENABLED)for(var v=y.length,_=0;_<v;_++){var R=y[_];if("system.marketplace"===R.api_name){for(var w=R.menus,b=w.length,D=0;D<b;D++)for(var M=w[D].sub_menus,L=M.length,k=0;k<L;k++)C.push(M[k].api_name);break}}y.forEach((function(e){e.show&&e.menus.forEach((function(t){var r=objectUtils.cloneObject(t);r.show&&r.sub_menus.forEach((function(t){if(t.show&&!C.contains(t.api_name)){var s=objectUtils.cloneObject(t);s.menu_name=s.menus.display_label,s.parentMenuName=e.display_label,s.parentMenuId=r.id,delete s.menus,crmSetup.mySetupArray.push(s)}}))}))}))}if(featuresAvailable.NEXTGENUI_ENABLED&&!Lyte.registeredMixins["crm-setup-mixin"].doNotRenderSetupLeftMenu(Lyte.Router.getRouteInstance().transition)&&!(Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.extensions")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.modules.index-modules")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.manage-tags")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.custom-view.cvid")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.manage-mass")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")||"crm.settings.section.custom-view.create-custom-view"===Lyte.Router.getRouteInstance().transition.target||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.autoresponders")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.manage-mass-mail")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.import")||"crm.settings.section.section-error"===Lyte.Router.getRouteInstance().transition.target)){var U=document.querySelector("crm-left-menu-setup"),E=document.querySelector("crm-left-menu").component;if(!U)(globalSetpJson?globalSetpJson.components.length:0)<=0?E.methods.bindAndRenderGlobalsetup(E):($L(".ts-lftmnu-modules").empty(),Lyte.Component.render("crm-left-menu-setup",{globalSetpJson:globalSetpJson.components},".ts-lftmnu-modules"),E.methods.selectLastAccessedSetting(E))}if(featuresAvailable.NEXTGENUI_ENABLED&&"crm.settings.index"===this.transition.target&&(this.transition.abort(),E.methods.redirectOrResetpage(!0)),"crm.settings"===this.transition.target||"crm.settings.section"===this.transition.target){var P=!!this.transition.data.fromeditor;if(Crm.isSettingPage=!1,P&&this.transition.data.isChangeMade){var I={refreshTemplate:!0};"true"===window.isSandboxAcc&&store.unloadAll("settings_customization"),this.refresh(I).data={fromeditor:P}}else P&&featuresAvailable.NEXTGENUI_ENABLED?(this.transition.data&&this.transition.data.fromeditor&&this.cancel_layout_action(),$L("#leftMainMenuDiv").removeClass("dNImp"),E.methods.redirectOrResetpage(!0)):featuresAvailable.NEXTGENUI_ENABLED||(this.replaceWith("crm.settings.index").data={fromeditor:P})}featuresAvailable.NEXTGENUI_ENABLED&&("crm.settings.editor"===this.transition.target&&E.actions.showOrHideLeftPane(!0),E&&this.transition.target.includes("crm.settings.section")&&!1===E.methods.checkPermissionviaRoute(this.transition.info.route,this.transition.info.dynamicParams,globalSetpJson.components)&&(this.transition.abort(),renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"),void 0,void 0,function(){Lyte.Router.getRouteInstance().transitionTo(this.getFirstAvailableRouter())}.bind(this))))},afterRender:function(){"undefined"!=typeof FeedbackChat&&FeedbackChat.enableTracking()},actions:{willTransition:function(e){if(featuresAvailable.NEXTGENUI_ENABLED){var t=document.querySelector("crm-left-menu").component;"crm.settings.index"===e.target&&(e.abort(),t.methods.redirectOrResetpage(!0)),(Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.manage-mass-mail")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.manage-tags")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.schedule-mass-email")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.autoresponders")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.custom-view")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.import")||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.import"))&&t.actions.showOrHideLeftPane(!0,!0),!e.target.includes("crm.settings.section.macro")&&Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")&&t.actions.showOrHideLeftPane(!0,!0)}if(e.target.indexOf("crm.settings")<0){if("undefined"!=typeof Customization&&Customization&&Customization.canvasRefresh)for(obj in Customization.canvasRefresh)1==Customization.canvasRefresh[obj]&&(e.pause(),Utils.windowLocationHref(e.url))}else e.target;"undefined"!=typeof CrmPlusImpl&&-1===e.target.indexOf("crm.settings")&&CrmPlusImpl.trigger("setupView.onclose")},didTransition:function(){var e=$(".lyteMenuItems .lyteMenuActive"),t=Lyte.Router.getRouteInstance().transition.info,r=t.route.split(".");if(e&&"crm.settings.section.import"!=t.route&&"crm.settings.import"!=t.route){var s=document.querySelector("crm-tab");s&&s.setData("selected",{})}if(r[3]&&(Crm.trackSpotLightAction("Setup - "+r[3]+" Clicked"),FeedbackChat.pathTracking("setup-"+r[3])),featuresAvailable.NEXTGENUI_ENABLED&&this.isMarketPlaceRouters(t.route)){var n=document.querySelector("crm-left-menu-marketplace");n&&n.component&&n.component.methods.checkAndAddActiveClassForMenu(t.route)}if(featuresAvailable.NEXTGENUI_ENABLED){var i="crm.tab.module.begin"!==app.prevTransition.route&&"crm.settings.index"!==app.prevTransition.route&&"crm.settings"!==app.prevTransition.route;if(featuresAvailable.NEXTGENUI_USER_SETTINGS_PREFERENCE&&"crm.settings.section.kiosk.edit-kiosk-builder"!==t.route&&!this.isMarketPlaceRouters(t.route)&&app.prevTransition.route&&i&&(app.prevTransition.route!==t.route||app.prevTransition.dynamicParams[0]!==t.dynamicParams[0])){var o=this.getMenuIdByTransition(this.transition,!0);this.addFrequentlyAccessedIds(o)}this.setLastAccessedRouter(Lyte.Router.getRouteInstance().transition),setTimeout((function(){var e=$L(".setting-list-td.lyteMenuActive");if(e&&e.length>0){var t=e[0].getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||e[0].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}),200)}},onBeforeLoad:function(){"undefined"!=typeof CrmPlusImpl&&this.isTransitionToSettings(app.prevTransition.route)&&CrmPlusImpl.trigger("setupView.onbeforeload")},onError:function(e){if(200!==e.status&&this.transition.target.includes("editor"))return featuresAvailable.NEXTGENUI_ENABLED?Lyte.Router.transitionTo("crm.settings.section.personal-settings"):Lyte.Router.transitionTo("crm.settings.index").refresh=!0,JSON.parse(e.response)&&JSON.parse(e.response).code&&"NO_PERMISSION"===JSON.parse(e.response).code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3),!1}},afterRender:function(){"undefined"!=typeof CrmPlusImpl&&this.isTransitionToSettings(app.prevTransition.route)&&CrmPlusImpl.trigger("setupView.onafterload")},beforeModel:function(){var e=this.getQueryParams();if(featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&featuresAvailable.TEAM_MODULE_ENABLED&&void 0!==moduleRecordMapping[e.module]&&"team_based"===moduleRecordMapping[e.module].access_type&&moduleRecordMapping[e.module].private_profile&&"Requesters"===moduleRecordMapping[e.module].private_profile.name&&!["crm.settings.section.assignment-rule.view-assignment-rule","crm.settings.section.assignment-rule.create-assignment-rule"].includes(this.transition.target)&&("crm.settings.canvas.create"!==this.transition.target&&"crm.settings.canvas.edit"!==this.transition.target&&"crm.settings.canvas.clone"!==this.transition.target||!Crm.userDetails.permissions["Crm_Implied_Customize_"+moduleRecordMapping[e.module].module_name])){var t=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),r=window.location.pathname.split(t)[1];this.replaceWith("crm.crm-error",r).data={showError:!0,errorMsg:I18n.getMsg("module.not.available")}}else crmTab.emptyCache(),Lyte.registeredMixins["crm-module-mixin"].unloadModuleProperty("actions")},renderTemplate:function(){var e=Lyte.Router.getRouteInstance().transition.target;if(featuresAvailable.NEXTGENUI_ENABLED&&this.isMarketPlaceRouters(e)){var t=document.querySelector("crm-left-menu").component;document.querySelector("crm-left-menu-marketplace")||t.methods.renderMarketplace(!1)}},beforeExit:function(){for(var e in featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.NEXTGENUI_USER_SETTINGS_PREFERENCE&&this.saveUserSettingsPreferenceChanges(!0,!1),moduleRecordMapping)moduleRecordMapping[e].crux_customViewAccessedModules&&this.removeTotalCache(e,moduleRecordMapping[e].cvid);delete customViewObject.filters,store.unloadAll("setup_group")},isTransitionToSettings:function(e){return void 0===e||-1===e.indexOf("crm.settings")||featuresAvailable.NEXTGENUI_ENABLED&&"crm.settings.index"===e}},{mixins:["crm-setup-mixin","crm-module-mixin","crm-view-utils","crm-lightuser-picker-mixin"]}),Lyte.Router.registerRoute("crm.settings.canvas.begin",{queryParams:["module","viewType","feature"],getResources:function(){var e=[],t=[],r=[];e=e.concat(["crm-list-view-canvas-begin.js","crm-detailcanvas-utils.js"]),t=t.concat([networkUtils.getI18nJSUrl("customization")]),r=r.concat(["crm-list-view-canvas-begin.css"]);var s=[];return s=(s=(s=s.concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRM))},beforeModel:function(){this.getQueryParams().viewType&&this.getQueryParams().feature||(Lyte.Router.getRouteInstance().setQueryParams({feature:"ListView",viewType:"CustomizedView"}),this.transition.abort())},model:function(){var e={};return e.module=this.getQueryParams().module,e.viewType=this.getQueryParams().viewType,e.featureName=this.getQueryParams().feature,e},renderTemplate:function(e,t){return{outlet:"#show",component:"crm-list-view-canvas-begin"}},afterRender:function(e,t){}}),Lyte.Router.registerRoute("crm.settings.canvas.clone",{queryParams:["module","feature","layoutId","viewType"],model:function(){if("FormView"!==this.getQueryParams().feature){e=Lyte.Router.getRouteInstance().getDynamicParam();return Lyte.resolvePromises({views:app.store.makeRequest("findRecord","canvasview",e)})}if(Crm.userDetails.isCanvasFormViewEnabled){var e=Lyte.Router.getRouteInstance().getDynamicParam();return Lyte.resolvePromises({views:app.store.makeRequest("findRecord","canvasview",e),layoutId:this.getQueryParams().layoutId})}},afterModel:function(e){if("FormView"===this.getQueryParams().feature){if(Crm.userDetails.isCanvasFormViewEnabled&&(e.views=e.views[0],!e.views||e.views.view_type!==this.getQueryParams().viewType&&"FormView"!==e.views.view_type||e.views.feature!==this.getQueryParams().feature))return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[this.getQueryParams().module]}).data={showError:!0,module:this.getQueryParams().module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()}else if(e.views=e.views[0],!e.views||e.views.view_type!==this.getQueryParams().viewType&&"FormView"!==e.views.view_type||e.views.feature!==this.getQueryParams().feature)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[this.getQueryParams().module]}).data={showError:!0,module:this.getQueryParams().module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()},renderTemplate:function(e,t){if("FormView"!==t.queryParams.feature){s=store.peekRecord("module",e.views.module.id).module_name;return(r=document.querySelector("crm-detailview-oldeditor"))&&r.setData("loading",!0),void this.editPreProcess(e.views,s).then(function(e){var t=Lyte.registeredMixins["crm-canvas-builder-handler-mixin"];$L("#canvasname").val("");var s=e&&e.children;s&&s[0]&&"Canvas Data Table"===s[0].theme&&(r.setData("editorSubMode","table"),t.applyTableSpecificConfigs(),t.initTableSettings({newcreation:!1,onInstall:!0})),this.processgallery(e),r&&r.setData("loading",!1)}.bind(this))}if(Crm.userDetails.isCanvasFormViewEnabled){var r,s=store.peekRecord("module",e.views.module.id).module_name;return(r=document.querySelector("crm-detailview-oldeditor"))&&r.setData("loading",!0),void this.editPreProcess(e.views,s).then(function(e){var t=Lyte.registeredMixins["crm-canvas-builder-handler-mixin"];$L("#canvasname").val("");var s=e&&e.children;s&&s[0]&&"Canvas Data Table"===s[0].theme&&(r.setData("editorSubMode","table"),t.applyTableSpecificConfigs(),t.initTableSettings({newcreation:!1,onInstall:!0}));var n=$("#zcanvas-editor-outer"),i=n.data("zcanvas"),o=document.createDocumentFragment();i.containerfragment=o,this.processgallery(e),n.append(o),delete i.containerfragment,r&&r.setData("loading",!1)}.bind(this))}Customization.cloneView(this.transition.info.dynamicParams[0],this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Clone View Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Clone View Click")},afterRender:function(){"FormView"===Canvas.builderConfig.builderMode&&setTimeout((function(){Lyte.registeredMixins["crm-canvas-core-mixin"].fieldCallSerializer(),$("#zcanvas-editor-outer").click().disableSelection()}),0)}},{mixins:["crm-detailcanvas-utils","crm-canvas-builder-process","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.canvas.create",{queryParams:["module","template","feature","layoutId","viewType","wizard","wizardscreen"],model:function(e){var t=e.queryParams.feature;switch(t){case"FormView":case"WizardView":if(Crm.userDetails.isCanvasFormViewEnabled||Crm.userDetails.isWizardViewEnabled){var r=e.queryParams,s=moduleRecordMapping[r.module].api_name,n=r.viewType,i="FormviewCustomization",o={feature:t,page:1,per_page:1};return Lyte.resolvePromises({canvasview:store.findAll("canvasview",o),features:store.findAll("features",{api_names:i,module:s}),layoutId:r.layoutId}).then((function(e){var r=e.features[0].details.limits.total;return e.features[0].details.used_count.total>=r&&"WizardView"!==t?renderingUtils.showCustomAlert(Lyte.registeredMixins["crm-detailcanvas-utils"].canvasErrorHandlingforLimit(t,n,s)):e}))}break;default:s=(r=e.queryParams).module,n=r.viewType,i="ListviewCustomization";o=Customization.ultimateSpec.includes(Crm.userDetails.LICENSE_TYPE)?n?{feature:t,module:s,view_type:n,page:2,per_page:25}:{feature:t,module:s,page:2,per_page:25}:Customization.moduleSpec.includes(Crm.userDetails.LICENSE_TYPE)?n?{feature:t,module:s,view_type:n,page:1,per_page:25}:{feature:t,module:s,page:1,per_page:25}:n?{feature:t,view_type:n,page:1,per_page:25}:{feature:t,page:1,per_page:25},Lyte.resolvePromises({canvasview:store.findAll("canvasview",o),features:store.findAll("features",{api_names:i})}).then((function(e){var r=e.features[0].details.limits.total,i=e.canvasview.length;if(Customization.ultimateSpec.includes(Crm.userDetails.LICENSE_TYPE)&&(i=e.canvasview.length+25),i>=r)return renderingUtils.showCustomAlert(Lyte.registeredMixins["crm-detailcanvas-utils"].canvasErrorHandlingforLimit(t,n,s))}))}},renderTemplate:function(){var e=this.getQueryParams(),t=document.querySelector("crm-detailview-oldeditor");if(!Canvas||!Canvas.builderConfig||"CustomizedView"!==Canvas.builderConfig.builderMode&&"CardView"!==Canvas.builderConfig.builderMode&&"TableView"!==Canvas.builderConfig.builderMode)if(Crm.userDetails.isCanvasFormViewEnabled&&"FormView"===Canvas.builderConfig.builderMode){if(Crm.userDetails.isCanvasFormViewEnabled&&e.module&&e.template){o=e.template.split("_")[0];t&&t.setData("loading",!0);a="getFormViewGallery";if(e.template.includes("_")){if(o+=e.template.split("_")[1],Crm.userDetails.isCanvasStaticFilesFromCDN)i=this.getMetaDataAndJSONForGalleryEdit("FormView","Gallery",o,e.module);else{u={module:e.module,action:a,type:o};(c={}).url=crmBasePath+"/CanvasGallery.do",c.method="GET",i=store.findAll("dummy",u,!1,!1,c)}i.then(function(e){this.processgallery(e),t&&t.setData("loading",!1)}.bind(this))}else(i=store.findRecord("canvasview",o,{parsed:!1},void 0,void 0,{apiVersion:"v2.2"})).then(function(r){r=r[0]?r[0]:r,store.peekRecord("module",r.module.id).module_name===e.module?this.editPostProcess(r):this.processgallery(r),t&&t.setData("loading",!1)}.bind(this));return}m=(d=window.opener||window.parent.opener)?d.Lyte.Router.getRouteInstance().routeName:void 0;if(!Crm.userDetails.RTL_ENABLED&&"formview"===m){p=this;setTimeout((function(e){var t={};t.recordlist=store.peekAll(moduleRecordMapping[e.getQueryParams().module].id),t.record=t.recordlist[0],Lyte.registeredMixins["crm-canvas-core-gallery"].openCanvasGalleryModal(e.getQueryParams().module,e.getQueryParams().feature,void 0,"canvas_editor",t)}),500,p)}}else{var r=$("#grid3").find(".grid-stack-item");if(r.length){$(r).each((function(e,t){var r=$(t).find(".mapped-field"),s=$(t).find(".cd_field.field_valueHolder");if(0==r.length)$(t).find(".grid-stack-item-content").addClass("basic_edit");else{var n=$L(s).toArray().filter((function(e){return!$(e).hasClass("mapped-field")&&!$(e).parents(".cd_mapping_field").hasClass("mapped-field")}));$(n).addClass("basic_edit")}})),jSortable.galleryDeleteElement();var s={components:jSortable.galleryEachNode(),width:$("#grid3").width()},n=$("#gallerymodule").val();hideAnimatePopup("deletepopup"),Customization.generateView(n,void 0,(function(){null!=s&&(jSortable.cdViewEdit(s,!0,!0),Customization.removeSideBarElements(s.components))}),!0),$("#cvfieldMappingdropdown").remove()}else Customization.generateView(this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Blank Template Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Blank Template Click")}else{if(e.module&&e.template){var i,o=e.template.split("_")[0];t&&t.setData("loading",!0);var a="getListViewGallery";"CardView"===this.getQueryParams().viewType?a="getCardViewGallery":"TableView"===this.getQueryParams().viewType&&(a="getTableViewGallery");var l=Lyte.registeredMixins["crm-canvas-builder-handler-mixin"];if(e.template.includes("_")){if(Crm.userDetails.isCanvasStaticFilesFromCDN)i=this.getMetaDataAndJSONForGalleryEdit("ListView",this.getQueryParams().viewType,void 0,e.module);else{var c,u={module:e.module,action:a,type:o};(c={}).url=crmBasePath+"/CanvasGallery.do",c.method="GET",i=store.findAll("dummy",u,!1,!1,c)}i.then(function(r){var s=r.filter((function(t){return t.canvasId===e.template})),n=(s=s[0])&&s.children;n&&n[0]&&"Canvas Data Table"===n[0].theme&&(t.setData("editorSubMode","table"),l.applyTableSpecificConfigs(),l.initTableSettings({newcreation:!1,onInstall:!0})),this.processgallery(s),t&&t.setData("loading",!1)}.bind(this))}else(i=store.findRecord("canvasview",o,{parsed:!1},void 0,void 0,{apiVersion:"v2.2"})).then(function(r){var s=(r=r[0]?r[0]:r)&&r.children;s&&s[0]&&"Canvas Data Table"===s[0].theme&&(l.applyTableSpecificConfigs(),l.initTableSettings({newcreation:!1,onInstall:!0})),store.peekRecord("module",r.module.id).module_name===e.module?this.editPostProcess(r):this.processgallery(r),t&&t.setData("loading",!1)}.bind(this));return}var d,m=(d=window.opener||window.parent.opener)?d.Lyte.Router.getRouteInstance().routeName:void 0;if(!(Crm.userDetails.RTL_ENABLED||m&&"listview"!==m&&"begin"!==m)){var p=this;setTimeout((function(e){var t={};t.recordlist=store.peekAll(moduleRecordMapping[e.getQueryParams().module].id),t.record=t.recordlist[0],Lyte.registeredMixins["crm-canvas-core-gallery"].openCanvasGalleryModal(e.getQueryParams().module,e.getQueryParams().feature,e.getQueryParams().viewType,"canvas_editor",t)}),500,p)}}},afterRender:function(){var e=this.getQueryParams(),t=e.viewType||e.feature;Canvas&&Canvas.builderConfig&&"FormView"===Canvas.builderConfig.builderMode&&($("#zcanvas-editor-outer").click().disableSelection(),setTimeout((function(){Lyte.registeredMixins["crm-canvas-core-mixin"].fieldCallSerializer()}),0)),setTimeout((function(){if("WizardView"===t){var r=e.wizard,s=e.wizardscreen,n=store.peekRecord("wizard",r).containers[0].screens.find((function(e){return e.id===s})),i=$("#zcanvas_menu").data("zcanvasMenu").config.groups;Lyte.registeredMixins["crm-canvas-form-design-config-mixin"].preloadWizardData(i,n)}}),500)}},{mixins:["crm-detailcanvas-utils","crm-canvas-builder-process","crm-canvas-core-gallery","crm-canvas-common-utils"]}),Lyte.Router.registerRoute("crm.settings.canvas.edit",{queryParams:["module","feature","layoutId","viewType","wizard","wizardscreen"],model:function(){if("FormView"!==this.getQueryParams().feature){e=this.getDynamicParam(),t=this.getQueryParams().module;return app.store.makeRequest("findRecord","canvasview",e,{parsed:!1}).then(function(e){var r={views:e[0],module:t};return Lyte.resolvePromises(r)}.bind(this))}if(Crm.userDetails.isCanvasFormViewEnabled){var e=this.getDynamicParam(),t=this.getQueryParams().module;return app.store.makeRequest("findRecord","canvasview",e,{parsed:!1}).then(function(e){var r={views:e[0],module:t,layout:app.store.makeRequest("findRecord","layout",this.getQueryParams().layoutId,{module:moduleApiMapping[t],include:"portal_user_types"},!1,!0,{apiVersion:"2.2"}),layoutId:this.getQueryParams().layoutId};return Lyte.resolvePromises(r)}.bind(this))}},afterModel:function(e){if("FormView"===this.getQueryParams().feature){if(Crm.userDetails.isCanvasFormViewEnabled&&(!e.views||store.peekRecord("module",e.views.module.id).module_name!==this.getQueryParams().module||e.views.feature!==this.getQueryParams().feature))return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()}else if(!e.views||store.peekRecord("module",e.views.module.id).module_name!==this.getQueryParams().module||e.views.feature!==this.getQueryParams().feature)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()},renderTemplate:function(e,t){switch(this.getQueryParams().feature){case"FormView":case"WizardView":this.transition.data&&this.transition.data.disablePopup||this.renderElements(e.views);break;case"ListView":if(!this.transition.data||!this.transition.data.disablePopup){var r=document.querySelector("crm-detailview-oldeditor");if(r){var s=Lyte.registeredMixins["crm-canvas-builder-handler-mixin"];r.setData("loading",!0),r.setData("viewId",this.getDynamicParam()),e.views.ui.script_info&&(r.setData("editsysidmapping",e.views.ui.script_info.mapping||{}),Customization.sysidmapping=objectUtils.cloneObject(e.views.ui.script_info.mapping||{}),r.setData("lastsavedmapping",objectUtils.cloneObject(e.views.ui.script_info.mapping)||{})),e.views&&e.views.children&&e.views.children[0]&&"Canvas Data Table"===e.views.children[0].theme&&(r.setData("editorSubMode","table"),s.applyTableSpecificConfigs(),s.initTableSettings({newcreation:!1,onInstall:!0})),setTimeout(function(){this.editPreProcess(e.views,e.module).then(function(t){$("#canvasname").val(t.name),this.editPostProcess(t),r&&r.setData("loading",!1);var s=$("#zcanvas-editor-outer");if(s.click().disableSelection(),e.views.ui&&e.views.ui.value&&e.views.ui.value.system_id&&e.views.ui.script_info&&e.views.ui.script_info.mapping&&e.views.ui.script_info.mapping[e.views.ui.value.system_id]&&s.data("zcanvasdata",{systemid:e.views.ui.value.system_id,elementname:e.views.ui.script_info.mapping[e.views.ui.value.system_id].element_name}),e.views.ui&&e.views.related_to)for(var n in e.views.related_to){var i=null;"data_hub_associations"===n&&(i="canvas_datahub"),"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.storeData(i||n,e.views.related_to[n])}"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.updateStatus(!0)}.bind(this))}.bind(this),10)}}}},afterRender:function(){Canvas&&Canvas.builderConfig&&"FormView"===Canvas.builderConfig.builderMode&&setTimeout((function(){Lyte.registeredMixins["crm-canvas-core-mixin"].fieldCallSerializer(),$("#zcanvas-editor-outer").click().disableSelection()}),0)},beforeExit:function(){var e=this.getDynamicParam(),t=Lyte.registeredMixins["crm-detailcanvas-utils"].getCompNamefromId(e);Lyte.Component.registeredComponents[t]&&Lyte.Component.unregisterComponent(t)}},{mixins:["crm-canvas-common-utils","crm-detailcanvas-utils","crm-canvas-core-mixin","crm-create-mixin","crm-canvas-builder-process"]}),Lyte.Router.registerRoute("crm.settings.canvas.import",{queryParams:["module","template","feature","viewType"],model:function(){const e=decodeURIComponent(this.transition.info.queryParams.key);var t={import_token:e},r=this;return Lyte.resolvePromises({views:store.triggerAction("canvasview","import",null,t,"GET").then((function(e){return e.canvas_view[0]&&e.canvas_view[0].ui&&!e.canvas_view[0].ui.theme&&(e.canvas_view[0].ui.theme=canvasTheme.getCanvasThemeJson(r.transition.info.queryParams.feature)),e.canvas_view})).catch((function(t){if(t){var s=e?r.getImportErrorMessage(JSON.parse(t.responseText).code):I18n.getMsg("crm.canvas.import.key.cannot.empty");_cruxUtils.showCustomMessage({params:{ltPropMessage:s,ltPropType:"error",ltPropDuration:"6000"}})}}))})},afterModel:function(e){if(e.views=e.views[0],!e.views)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[this.getQueryParams().module]}).data={showError:!0,module:this.getQueryParams().module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()},renderTemplate:function(e){var t=document.querySelector("crm-detailview-oldeditor");t&&t.setData("loading",!0);var r=e.views,s=r&&r.children;if(s&&s[0]&&"Canvas Data Table"===s[0].theme){var n=Lyte.registeredMixins["crm-canvas-builder-handler-mixin"];t.setData("editorSubMode","table"),n.applyTableSpecificConfigs(),n.initTableSettings({newcreation:!1,onInstall:!0})}this.processgallery(e.views),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.import.template.success"),ltPropType:"success"}}),t&&t.setData("loading",!1),Crm.trackSpotLightAction("Canvas - Import View Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Import View Click")},afterRender:function(){"FormView"===Lyte.Router.getRouteInstance().getQueryParams().feature&&setTimeout((function(){Lyte.registeredMixins["crm-canvas-core-mixin"].fieldCallSerializer()}),0)}},{mixins:["crm-detailcanvas-utils","crm-canvas-builder-process","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.canvas",{queryParams:["module","feature","layoutId","viewType","wizard","wizardscreen"],getDependencies:function(){var e=["crm-canvasrule-model.js","canvasview_model.js","features_model.js","custom_link_model.js","crm-detailcanvas-utils.js"],t=[];return"FormView"===Lyte.Router.getRouteInstance().getQueryParams().feature&&(e=e.concat(["crm-create-mixin.js"])),t=t.concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))},getResources:function(e){var t=e.queryParams.feature,r=["crm-canvas-core-builder.js","crm-canvas-core.js","crm-canvas-listview.js","crm-tag.js","crm-skype-field.js","crm-email-field.js","crm-upcoming-activity.js","crm-create-mixin.js","crux-form-component.js","crm-canvas-rename-popup.js","crm-phone-field.js","crm-create-dependencies.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js"],s=["zlib_phonenumber.js"],n=[],i=[],o=[];return"crm.settings.canvas.begin"!==this.transition.target&&(r=r.concat(["crm-canvas-editor-component.js","crm-canvas-export.js","crm-canvas-import-button.js","crm-canvasview.js","crux-textautocomplete-options.js","crm-canvas-helpers.js","lyte-colorpicker.js","crm-list-helpers.js","lyte-fileupload.js","crux-criteria-component.js","crux-criteria-conditions.js","crm-canvas-criteria.css","crm-uploadfields-mixin.js","crux-image-upload.js","crm-territory-helper.js","crm-assign-territory-detail-view.js","crm-territory-crux-components.js","lyte-tree.js","crm-territory-common-utils.js"]),n=n.concat([networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("scoringRulesChart"),networkUtils.getI18nJSUrl("assignterritory")]),i=i.concat(["canvas-detailview-less.css","crm-upcoming-activity.css","crm-canvas-export.css","crux-image-component.css","crm-image-upload-component.css","crux-file-upload-component.css","crm-file-upload-component.css","crm-assign-territory-detail-view.css","crux-territory.css"]),Crm.userDetails.RTL_ENABLED&&(s=s.concat(["zcanvas-rtl.css"])),"FormView"!==t&&"WizardView"!==t||(r=r.concat(["crm-canvas-view.js","crm-canvasform.js","crm-formview-mixin.js","crm-canvas-common.js","crm-image-upload-create.js","crm-canvas-designer.js","crm-create-fields.js","crm-create-resources.js","crm-create-pricingdetails.js","crm-create-helpers.js","crm-create-dependent-resources.css","crm-create-dependent-resources.js","lyte-scrollTo.js","lyte-screengrab.js","crm-detail-view-utils.js","crm-image-mixin.js","cpq-utils.js","crm-richtext-resources.js","crm-lyte-editor-pannel.js","crm-canvas-rename-popup.css"]),i=i.concat(["canvas-formview-editor.css"]),s=s.concat(["zohocrm_wizard_record_create.js"]),Crm.isCpqRelatedTab(this.getQueryParams().module)&&(r=r.concat(["zohocpq.js","cpq-helpers.js"]))),o=o.concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-canvas-designer.css","crm-stage-history.css","crux-boolean-component.css"],ResourceConstants.CRMClient)}])),"Services"!==this.transition.info.queryParams.module&&"Appointments"!==this.transition.info.queryParams.module||(r=r.concat(["crm-services-appointments.js"])),"Services"===this.transition.info.queryParams.module&&(n=n.concat([networkUtils.getI18nJSUrl("servicesDetailView")])),o=(o=(o=(o=(o=o.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat(networkUtils.returnDependencyFiles(s,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(i,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(n,ResourceConstants.CRM))},beforeModel:function(){var e=this.getQueryParams().module,t=this,r=this.getQueryParams().feature;switch(this.isTeamModulehasAccess(moduleRecordMapping[e])||(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings")})),this.transition.abort()),r){case"FormView":case"WizardView":if(Crm.userDetails.isCanvasFormViewEnabled||Crm.userDetails.isWizardViewEnabled){(Crm.userDetails.RTL_ENABLED||e&&!moduleRecordMapping[e])&&(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings")})),this.transition.abort());var s=["Visits","Activities","Services__s","Appointments__s","Job_Sheets__s","messages__s"],n=(i=store.peekRecord("module",moduleRecordMapping[e].id))?i.api_name:void 0;if(s.indexOf(n)>0)return void(this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e]}).data={showError:!0,module:e,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")});"crm.settings.canvas.create"!==this.transition.target||this.getQueryParams().viewType&&this.getQueryParams().feature||"FormView"===this.getQueryParams().feature||"WizardView"===this.getQueryParams().feature||(Lyte.Router.getRouteInstance().setQueryParams({module:e,feature:"ListView",viewType:"CustomizedView"}),this.transition.abort()),"crm.settings.canvas.gallery.list"===this.transition.target&&(Lyte.Router.transitionTo("crm.settings.section.canvas-builder.listview",{feature:"ListView"}),this.transition.abort())}break;default:e&&!moduleRecordMapping[e]&&(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings")})),this.transition.abort());s=["Visits","Activities","Services__s","Appointments__s","messages__s"];Crm.userDetails.isCanvasActivitySupportEnabled&&Lyte.arrayUtils(s,"removeObjects",["Services__s","Appointments__s"]);var i;n=(i=store.peekRecord("module",moduleRecordMapping[e].id))?i.api_name:void 0;if(s.indexOf(n)>0)return void(this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e]}).data={showError:!0,module:e,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")});if("crm.settings.canvas.create"!==this.transition.target||this.getQueryParams().viewType&&this.getQueryParams().feature||"FormView"===this.getQueryParams().feature||"WizardView"===this.getQueryParams().feature||(Lyte.Router.getRouteInstance().setQueryParams({module:e,feature:"ListView",viewType:"CustomizedView"}),this.transition.abort()),"crm.settings.canvas.gallery.list"===this.transition.target&&(Lyte.Router.transitionTo("crm.settings.section.canvas-builder.listview",{feature:"ListView"}),this.transition.abort()),"crm.settings.canvas.begin"===this.transition.target)return}return app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,void 0,void 0,!0,{getOnlyMeta:!1}).then((function(t){var r=[];return r.push(app.store.makeRequest("findAll","canvas_rule",{module:moduleApiMapping[e]})),r.push(t),Lyte.resolvePromises(r)})).catch((function(e){if("NO_PERMISSION"===JSON.parse(e.responseText).code)return renderingUtils.displayPermissionDenied(),void t.transition.abort();t.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[t.transition.info.dynamicParams[0]]}).data={showError:!0,module:t.transition.info.dynamicParams[0],errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")}}))},model:function(){var e=this.getQueryParams().feature;if("crm.settings.canvas.begin"!==this.transition.target||"ListView"!==e){if(!Crm.userDetails.isCanvasFormViewEnabled&&"FormView"===e)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[this.getQueryParams().module]}).data={showError:!0,module:this.getQueryParams().module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort();var t=this.getQueryParams().module,r=this.getQueryParams().layoutId;t="Deals"===t?"Potentials":t;var s=moduleApiMapping[t],n={feature:e=this.getQueryParams().feature,module:t,layout_id:this.getQueryParams().layoutId};if("FormView"===e)return networkUtils.lyteInitiateRequest("/crm/v2/settings/canvas/views/components","GET",{params:n}).then(function(n){var i={components:[{type:"field"},{type:"button"},{type:"link"}]};n.components.forEach((function(e){i.components.push(e)}));moduleRecordMapping[this.getQueryParams().module].api_name;var o=moduleRecordMapping[t].id,a=store.peekRecord("module",o),l={layoutId:this.getQueryParams().layoutId,moduleapi:a.api_name,moduleName:a.module_name,dataObject:{skipRequest:{auto_enrichment:!0},substituteResponse:{validationRuleResponse:{},layoutRulesResponse:{}}}},c={components:i,moduleFields:Lyte.registeredMixins["crm-create-mixin"].getModulePromise(l),layout:app.store.makeRequest("findRecord","layout",r,{module:s},void 0,void 0,{apiVersion:"2.2"}),iscanvasflexlayoutAvailable:store.findAll("features",{api_names:"canvas_flex_layout"}).then((function(e){return void 0!==e}),(function(){return!1}))};return Crm.userDetails.isCanvasStaticFilesFromCDN&&(c.presetMeta=store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/CanvasGallery.do?action=getFeatureStaticMeta&module="+t+"&feature="+e+"&subfeature=Presets",method:"GET"})),Lyte.resolvePromises(c)}.bind(this));if("WizardView"===e){var i=Lyte.Router.getRouteInstance().transition.info.queryParams,o=i.wizard,a=i.layoutId,l={components:{components:[{type:"field"},{type:"button"},{type:"link"},{type:"relatedlist"}]},layout:app.store.makeRequest("findRecord","layout",r,{module:s}),wizards:app.store.makeRequest("findRecord","wizard",o,{layout_id:a,from_cache:!0}),iscanvasflexlayoutAvailable:store.findAll("features",{api_names:"canvas_flex_layout"}).then((function(e){return void 0!==e}),(function(){return!1}))};return Crm.userDetails.isCanvasStaticFilesFromCDN&&(l.presetMeta=store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/CanvasGallery.do?action=getFeatureStaticMeta&module="+t+"&feature=FormView&subfeature=Presets",method:"GET"})),Lyte.resolvePromises(l)}return Lyte.resolvePromises({link:app.store.makeRequest("findAll","custom_link",{module:s}),button:Lyte.registeredMixins["crm-view-utils"].isCustomButtonSupportedForModule(t)?new Promise((e=>{app.store.makeRequest("findAll","custom_button",{module:s},!0,void 0,{apiVersion:6}).then((t=>e(t))).catch((()=>e([])))})):[],components:{components:[{type:"field"},{type:"button"},{type:"link"}]},features:store.findAll("features",{api_names:"ListviewCanvasRulesLimit,detailview_canvasfiles"}),iscanvasflexlayoutAvailable:store.findAll("features",{api_names:"canvas_flex_layout"}).then((function(e){return void 0!==e}),(function(){return!1}))})}},afterModel:function(e){var t=this.getQueryParams().feature;if("crm.settings.canvas.begin"!==this.transition.target||"ListView"!==t){var r=this.getQueryParams().module;if(e.module=r,e.moduledata=store.peekRecord("module",moduleRecordMapping[r].id),e.layoutId=this.getQueryParams().layoutId,"FormView"===t){e.map_dependency&&(Lyte.registeredMixins["crm-canvas-view-rules"].constructMapDependency(e.map_dependency.map_dependency,this.getQueryParams().layoutId),Lyte.registeredMixins["crm-canvas-view-rules"].canvasDependencyfieldHandling(this.getQueryParams().layoutId,void 0,moduleApiMapping[this.getQueryParams().module]));var s=e.moduledata?e.moduledata.api_name:void 0,n=["Visits","Activities","Tasks","Events","Calls","Services__s","Appointments__s","messages__s"].indexOf(s)>0,i=!1,o=I18n.getMsg("canvas.not.accessible",I18n.getMsg("crm.canvas.title"));if(!e.moduledata.viewable)return renderingUtils.displayPermissionDenied(),void this.transition.abort();if(!e.layout||"object"==typeof e.layout&&0===objectUtils.getLength(e.layout)?(i=!0,o=I18n.getMsg("canvas.not.accessible",I18n.getMsg("crm.lable.layout"))):n&&(i=!0,o=I18n.getMsg("canvas.notsupported.module",[e.moduledata.module_name,I18n.getMsg("crm.lable.layout")])),i)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:o},void this.transition.abort()}else"ListView"===t&&(e.featureName="ListView");if("WizardView"===t){var a=this.getQueryParams().wizardscreen;let t=e.wizards[0],s=!1;if(t&&(s=t.containers[0].screens.find((function(e){return e.id===a}))),!s)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.process.title.attention"),ltPropSecondaryMessage:I18n.getMsg("crm.canvas.wizard.design.screen.notavailable"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.gotit"),appearance:"primary"}],ltPropButtonPosition:"center",ltPropCloseOnEscape:"false"},accept:()=>{window.close()},close:()=>{window.close()}}),void this.transition.abort();"crm.settings.canvas.create"===this.transition.target?e.fields=Lyte.registeredMixins["crm-detailcanvas-utils"].getSortedFieldsInScreen(s):e.fields=Lyte.registeredMixins["crm-detailcanvas-utils"].getFieldsFromScreen(s);var l=s.segments.filter((function(e){return"subforms"===e.type})),c=s.segments.find((function(e){return"buttons"===e.type}));e.components.components.push({display_label:"Segment Title",comp_available:!0,data_zcqa:"title",name:"title",type:"create_page_comp",id:s.id}),l&&l.length&&l.forEach((function(t){var r=t.fields.find((function(e){return"subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type}));e.fields.push(r)}));var u=s.segments.filter((function(e){return"text_label"===e.type})),d=s.segments.filter((function(e){return"widget"===e.type})),m=[];c.buttons.forEach((function(e){var t={position:"wizards",id:e.resource&&e.resource.id||e.id,name:e.display_label};m.push(t)})),e.button=m;var p=[],g=0;u.forEach((function(e){let t=e.display_label.match(/\${(.*?)\}/gm)||[],s="";!e.display_label||t.length?(s=I18n.getMsg("crm.wizard.rule.text_component.label"),g&&(s+=" "+g),g++):s=e.display_label;var n={position:"view",id:e.id,name:s,data_type:"static_rel",details:e,module_name:r,type:"text_label"};p.push(n)})),e.relatedlist=p,d.forEach((function(t){var n={position:"view",id:t.id,data_type:"static_rel",details:t,type:"widget",module_name:r,layoutId:s.container.id};e.relatedlist.push(n)}))}return e.record={},"FormView"!==t&&moduleRecordMapping[r].viewable?app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{per_page:10,approved:"both",formatted_currency:!0}).then((function(t){return e.entityId=t[0]?t[0].id:null,e.record=e.entityId?store.peekRecord(moduleRecordMapping[e.module].id,t[0].id):{},app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{per_page:10,approved:"both",formatted_currency:!0,fields:["$upcoming_activity"]})}),(function(e){return e})):void 0}},renderTemplate:function(e){this.getQueryParams().feature;if("crm.settings.canvas.begin"!==this.transition.target)return Canvas&&Canvas.builderConfig&&this.getQueryParams().viewType&&(Canvas.builderConfig.builderMode=this.getQueryParams().viewType,window.zcanvasGlobalConfig=Canvas.builderConfig.currentConfig=Canvas.builderConfig.configs[this.getQueryParams().viewType]),{component:"crm-detailview-oldeditor",outlet:"#show"}},afterRender:function(e){if("crm.settings.canvas.begin"!==this.transition.target){if(e.relatedlist=e.relatedlist||[],e.moduledata.$properties&&e.moduledata.$properties.contains("$upcoming_activity")&&"WizardView"!==this.getQueryParams().feature&&e.components.components.push({comp_available:!0,display_label:"Upcoming Activity",name:"upcoming_activity",type:"action"}),Canvas&&Canvas.builderConfig&&this.getQueryParams().viewType){var t=$L("crm-detailview-oldeditor")[0];if(t){t.setData("editormode",this.getQueryParams().viewType);var r={name:"crm.settings.canvas.edit",dynamicparam:[],queryparam:{module:e.module,feature:this.getQueryParams().feature,viewType:this.getQueryParams().viewType}},s={name:"crm.settings.section.canvas-builder.listview",queryparam:{feature:this.getQueryParams().feature}};t.setData("builderConfig",{route:r,closeRoute:s});var n=e&&e.features[0]&&e.features[0].details&&e.features[0].details.limits&&e.features[0].details.limits.total?e.features[0].details.limits.total:5,i=e&&e.features[1]&&e.features[1].details&&e.features[1].details.limits&&e.features[1].details.limits.total?e.features[1].details.limits.total:25;t.setData({listviewCanvasRulesLimit:n,canvasImageUploadLimit:i})}Canvas.builderConfig.init.bind(this)(e),Canvas.builderConfig.callbacks.preview=Lyte.registeredMixins["crm-canvas-common-utils"].builderPreviewHandler}this.setTitle(I18n.getMsg("crm.canvas.setup.builder",[Crm.partnerName]))}if("FormView"===this.getQueryParams().feature||"WizardView"===this.getQueryParams().feature){var o=this.getQueryParams(),a=o.viewType||o.feature,l=e.module,c=o.layoutId,u=o.feature;if("FormView"===a||"WizardView"===a){r={route:{name:"crm.settings.canvas.edit",dynamicparam:[],queryparam:{module:e.module,feature:this.getQueryParams().feature,layoutId:this.getQueryParams().layoutId}},closeRoute:{name:"WizardView"===a?"crm.settings.section.canvas-builder.wizardview":"crm.settings.section.canvas-builder.formview",queryparam:{feature:this.getQueryParams().feature}}};"WizardView"===a&&(r.route.queryparam.wizardscreen=o.wizardscreen)}var d={module:l,featureName:u,layoutId:c,builderConfig:r};"WizardView"===a&&(a="FormView",e.editormode="FormView"),this.renderEditor(null,a,null,e,d,{preventRendering:!0})}},beforeExit:function(){"FormView"===this.getQueryParams().feature&&this.removeFromCache(networkUtils.returnDependencyFiles(["canvas-formview-editor.css",ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT]))},actions:{willTransition:function(e){if("crm.crm-error"!==e.info.route){var t=document.querySelector("crm-detailview-oldeditor"),r=t?t.getData():{},s=e.data&&e.data.disablePopup;if(r.changed&&!s){var n=e.pause(),i="stayonPageConfirmBox",o=$("#"+i);renderingUtils.freezeBackground(),mailsetCenter(i),o.find(".leavePage").off("click").click((function(){"undefined"!=typeof autoSaveTimer&&clearTimeout(autoSaveTimer),$("#stayonPageConfirmBox").hide(),Lyte.registeredMixins["crm-canvas-builder-process"]&&Lyte.registeredMixins["crm-canvas-builder-process"].flusheditor();var e=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];n.resume(),e.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled&&(e.routeChange=!1,setTimeout((function(){e.reDirectHandle(e.moduleData)}),100)),renderingUtils.removeFreezeLayer()})),o.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort();var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];t.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled&&(t.routeChange=!1),renderingUtils.removeFreezeLayer()})),o.focus()}else"undefined"!=typeof autoSaveTimer?clearTimeout(autoSaveTimer):r.changed||!e.info.route||e.info.route.indexOf("crm.settings.canvas.edit")>-1||Lyte.registeredMixins["crm-canvas-builder-process"]&&Lyte.registeredMixins["crm-canvas-builder-process"].flusheditor()}}}},{mixins:["crm-detailcanvas-utils","crm-create-mixin","crm-uploadfields-mixin","crm-canvas-core-mixin","crm-canvas-builder-process","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.clone-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customizeHomePage")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-home-customization.js","crm-analytical-component-model.js","crm-analytics-chart-table.js","crm-report-util.js"],ResourceConstants.CRMClient);return(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))).concat(t).concat(r).concat(s)},model:function(){var e={params:{action:"customizeHomePage",operation:"clone",customizationId:this.getDynamicParam()},reject_on_failure:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",e)},renderTemplate:function(e){featuresAvailable.NEXTGENUI_ENABLED&&(document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1),$L(".nextGenUILeftMenu").hide());return CustomHomePage.isComponentEnabledForCustomizeHomepage=e.isComponentEnabledForCustomizeHomepage,e.sharedIdsVsCountMap&&(CustomHomePage.sharedIdsVsCount=e.sharedIdsVsCountMap.sharedIdsVsCountMapObj),CustomHomePage.maxRolesProfilesPerPage=e.maxRolesProfilesPerPage,crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"clone")},actions:{onError:function(e){var t=e.responseText&&e.responseText.includes("noRolesProfilesForHome")?I18n.getMsg("crm.no.roles.and.profiles.for.homepage1"):"noRolesForHome"===e.responseText?I18n.getMsg("crm.no.roles.for.homepage1"):e.responseText,r=e.responseText&&e.responseText.includes("noRolesProfilesForHome")?I18n.getMsg("crm.no.roles.and.profiles.limit.for.homepage2",e.responseText.match(/[0-9]+/g)):"noRolesForHome"===e.responseText?I18n.getMsg("crm.no.roles.for.homepage2"):e.responseText,s=555!==e.status?e.responseText:'<div class="darkMainHead"><span id="warningMsg">'+t+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="crm-small-font-size crm-font-regular"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+r+"</span></span></div>";return renderingUtils.showCustomAlert(s,void 0,!0,(function(){crmHistory.backOneLevel()})),!1}}}),Lyte.Router.registerRoute("crm.settings.create-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","crm-customview-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-home-customization.js","crm-analytical-component-model.js","crm-analytics-chart-table.js","crm-report-util.js","crm-analytics.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customizeHomePage")],ResourceConstants.CRM);e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-strategy.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=e.concat(t).concat(r);var i=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"],ResourceConstants.CRM);return e.concat(i).concat(s).concat(n)},beforeModel:function(){Crm.userDetails.isSandbox&&(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.replaceWith("crm.settings.index")})),this.transition.abort())},model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",{params:{action:"customizeHomePage",operation:"create"},reject_on_failure:!0})},renderTemplate:function(e){return CustomHomePage.sharedData="",e.sharedIdsVsCountMap&&(CustomHomePage.sharedIdsVsCount=e.sharedIdsVsCountMap.sharedIdsVsCountMapObj),CustomHomePage.isComponentEnabledForCustomizeHomepage=e.isComponentEnabledForCustomizeHomepage,CustomHomePage.maxRolesProfilesPerPage=e.maxRolesProfilesPerPage,crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"create")},afterRender:function(){featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide()},actions:{onError:function(e){var t=e.responseText&&e.responseText.includes("noRolesProfilesForHome")?I18n.getMsg("crm.no.roles.and.profiles.for.homepage1"):"noRolesForHome"===e.responseText?I18n.getMsg("crm.no.roles.for.homepage1"):e.responseText,r=e.responseText&&e.responseText.includes("noRolesProfilesForHome")?I18n.getMsg("crm.no.roles.and.profiles.limit.for.homepage2",e.responseText.match(/[0-9]+/g)):"noRolesForHome"===e.responseText?I18n.getMsg("crm.no.roles.for.homepage2"):e.responseText,s=555!==e.status?e.responseText:'<div class="darkMainHead"><span id="warningMsg">'+t+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="crm-small-font-size crm-font-regular"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+r+"</span></span></div>",n=this;return renderingUtils.showCustomAlert(s,void 0,!0,(function(){n.transitionTo("crm.settings.section.home-customization.index-home-customization")})),!1}}}),Lyte.Router.registerRoute("crm.settings.edit-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crux-criteria-component.js","crux-criteria-conditions.js","lyte-dateselect.js","lyte-daterangepicker.js","crm-analytics.js","crm-customview-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-home-customization.js","crm-analytical-component-model.js","crm-analytics-chart-table.js","crm-report-util.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customizeHomePage")],ResourceConstants.CRM);e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-strategy.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css","crm-analytics-component-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=e.concat(t);var i=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"],ResourceConstants.CRM);return e.concat(i).concat(r).concat(s).concat(n)},model:function(){var e={params:{action:"customizeHomePage",operation:"edit",customizationId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",e)},renderTemplate:function(e){featuresAvailable.NEXTGENUI_ENABLED&&(document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1),$L(".nextGenUILeftMenu").hide());CustomHomePage.maxRolesProfilesPerPage=e.maxRolesProfilesPerPage,e.sharedIdsVsCountMap&&(CustomHomePage.sharedIdsVsCount=e.sharedIdsVsCountMap.sharedIdsVsCountMapObj),CustomHomePage.isComponentEnabledForCustomizeHomepage=e.isComponentEnabledForCustomizeHomepage,crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"edit",this.transition.data)},actions:{willTransition:function(e){var t=!1;if($(".customHomePageContainer").is(":visible")){var r="edit"===CustomHomePage.operation&&!$("#saveCustomization").hasClass("inActiveSec");t="edit"!==CustomHomePage.operation&&("true"===$("#layout_Name").attr("data-changed")||$(".dashBrdContent").length>0)||r}if(t){var s=e.pause(),n="stayonPageConfirmBox",i=$("#"+n);renderingUtils.freezeBackground(),mailsetCenter(n),i.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),s.resume(),renderingUtils.removeFreezeLayer(),Events.isPageLayoutModified=!1})),i.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort(),renderingUtils.removeFreezeLayer()})),i.focus()}}}}),Lyte.Router.registerRoute("crm.settings.editor",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-setup-data.js"],ResourceConstants.CRMClient)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-setup-editors.js"],ResourceConstants.CRMClient);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-setup-editor.css","crm-setup-editor-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-setup-editor.css"],ResourceConstants.CRMClient),t.concat(e)},model:function(){return store.unloadAll("setup_group"),store.findAll("settings_customization",null,null,!0,{action:"editor"})},beforeModel:function(){Crm.trackSpotLightAction("Setup - Editor Visited"),commonUtils.showHideLoadingDiv(!0),crmSetup.loaderDots(),$("html, body").css("overflow","hidden")},afterModel:function(e){var t=Lyte.Router.getRouteInstance().transition.target;if(featuresAvailable.NEXTGENUI_ENABLED&&!(t.includes("all-extensions")||t.includes("google-extensions")||t.includes("ms-extensions")||t.includes("zoho-extensions"))){var r=document.querySelector("crm-left-menu").component;r.setData("selectedMenu","settings"),r.actions.showOrHideLeftPane(!1)}this.currentModel={components:e.components}},renderTemplate:function(){return{outlet:"#show",component:"crm-setup-editor"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.setTitle(I18n.getMsg("crm.title.setup.revamp",[Crm.partnerName])),crmSetup.removeLoaderDots(),featuresAvailable.NEXTGENUI_ENABLED||$(".setupEditorTopMenu").css({"background-color":Crm.userDetails.SKIN_INFO.NEWBGCOLOR})},actions:{willTransition:function(e){var t=this;if(t.component&&t.component.getData("changeFlag")&&!0===t.component.getData("changeFlag")){var r=e.pause(),s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){$("#"+s).hide(),e.target.includes("settings.index")&&(e.data={fromeditor:!0}),r.resume(),renderingUtils.removeFreezeLayer()})),n.find(".stayPage").off("click").click((function(){$("#"+s).hide(),e.abort(),renderingUtils.removeFreezeLayer()})),n.focus()}else t.component&&t.component.getData("isChangeMade")&&(e.data.isChangeMade=t.component.getData("isChangeMade"))},onError:function(e){if(crmSetup.removeLoaderDots(),200!=e.status)return Lyte.Router.transitionTo({route:"crm.settings"}).data={fromeditor:!0,isChangeMade:!0},e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"UNCONFIRMED_EMAIL"==JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("workflow.wfDeluge.failures.unConfirmedEmail"),3e3):e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"FEATURE_NOT_SUPPORTED"===JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3):e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"NO_PERMISSION"===JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3):crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3),!1}}},{mixins:["crm-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.import",{queryParams:["module","step","parentModule","id"],getDependencies:function(){return networkUtils.returnDependencyFiles(["data-migration-store.js","migration-util.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["import-user-wrapper.js","crm-dm-notification.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zohocrm_import.css"],ResourceConstants.CRM),s=e.concat(t).concat(r),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles(["data-migration-component-general.js","lyte-step.js","migration-constants.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["data-migration-general.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)o=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],ResourceConstants.CRMClient);var a=networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient);return n.concat(i).concat(o).concat(a).concat(s)},beforeModel:function(){var e=this.getQueryParams().module;Crm.userDetails.isStorageLimitReached&&"Users"!==e&&(Crm.showStorageExceedPopup(),this.transition.abort())},model:function(e){var t=objectUtils.cloneObject(this.transition.data),r=e.queryParams;if(0===Object.keys(t).length&&"1"!==r.step){var s={module:r.module,step:"1"};return r.parentModule&&(s.parentModule=r.parentModule),void Lyte.Router.transitionTo("crm.settings.import",s)}var n={};if("1"===r.step&&void 0!==t&&"cancelImport"!==t.currStep){n={module:r.module,step:r.step,currStep:"sourceType"},r.hasOwnProperty("parentModule")&&(n.parentModule=r.parentModule),void 0!==t&&(n.currStep=t.currStep,void 0===n.currStep&&(n.currStep="1"),t.parentModule&&(n.parentModule=t.parentModule),t.parentId&&(n.parentId=t.parentId),t.itsRelatedModule&&(n.itsRelatedModule=t.itsRelatedModule));var i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",i)}if("fileUpload"===r.step){n={module:r.module,step:r.step,currStep:"sourceType"},void 0!==t&&(n.currStep=t.currStep,n.module=t.module,t.parentModule&&(n.parentModule=t.parentModule),t.parentId&&(n.parentId=t.parentId));i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",i)}if("showOperation"===r.step&&"cancelImport"!==t.currStep){if(n={module:r.module,step:r.step,importId:r.id,currStep:r.step},void 0!==t){if("previousShowOperation"===t.currStep)return;n.currStep=t.currStep,n.importId=t.importId,n.charSet=t.charSet,n.module=t.module,t.parentModule&&(n.parentModule=t.parentModule),t.parentId&&(n.parentId=t.parentId)}i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if("fieldMapping"===r.step){if(void 0!==t){if("previousFieldMapping"===t.currStep)return;n.currStep=t.currStep,n.importId=t.importId,n.operation=t.operation,n.ignoreEmpty=t.ignoreEmpty,n.module=t.module,n.findBy=t.findBy,t.sendUserInvitation&&(n.sendUserInvitation=t.sendUserInvitation),t.parentModule&&(n.parentModule=t.parentModule),t.parentId&&(n.parentId=t.parentId),t.layoutId&&(n.layoutId=t.layoutId)}else n={module:r.module,step:r.step,importId:r.id,currStep:"submitOperation",ignoreEmpty:r.ignoreEmpty};i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if("showOptions"===r.step&&void 0!==t&&"cancelImport"!==t.currStep){if(n={module:r.module,importId:r.id,step:r.step},void 0!==t)for(var o in t)n[o]=t[o];i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if(void 0!==t&&"cancelImport"===t.currStep){if("Users"===r.module)return Lyte.Router.transitionTo({route:"crm.settings.section.users"});i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if(void 0!==t&&"submitImport"===t.currStep){i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if(void 0!==t&&"submitMapping"===t.currStep){i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}if(void 0!==t&&"sourceType"===t.currStep){i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",i)}n={module:r.module,step:"1",toolTip:r.module,dataScope:"myData"},r.hasOwnProperty("parentModule")&&(n.parentModule=r.parentModule),t.parentModule&&(n.parentModule=t.parentModule),t.parentId&&(n.parentId=t.parentId);i={params:n};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",i)},renderTemplate:function(e,t){var r=this.transition.data,s=t.queryParams.module,n=t.queryParams.id;if("string"!=typeof e&&(null===e||"object"!=typeof e||e.hasOwnProperty("ERRORMSG")))return!r||"previousFieldMapping"!==r.currStep&&"previousShowOperation"!==r.currStep?void("object"==typeof e&&e.hasOwnProperty("ERRORMSG")?(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg(e.ERRORMSG),ltPropType:"error",ltPropDuration:"5000",ltPropYield:!0}}),Import.enableAndDisableButton(["mappingPreviousBtn","mappingSubmitBtn"],"enable"),this.transition.abort()):(!r||r&&"cancelImport"!==r.currStep)&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.import.unexpected.error"),ltPropType:"error",ltPropDuration:"5000",ltPropYield:!0}})):void 0;if(r&&"cancelImport"===r.currStep&&"1"===t.queryParams.step){Import.reset();var i=r.module;return r.parentModule&&""!==r.parentModule&&(i=r.parentModule),void("Users"===i?Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.users"}):!r.module||Crm.isActivitySplitDone||"Tasks"!==r.module&&"Events"!==r.module&&"Calls"!==r.module?Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[i]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:["Activities"]}))}if("1"===t.queryParams.step)Import.reset();else{if("fileUpload"===t.queryParams.step||r&&"sourceType"===r.currStep)return void $("#show").html(e);if("showOperation"===t.queryParams.step){var o=Import.parentModule,a=Import.parentId,l=$("#charSetAutoDetect");if(l&&l.length>0&&(Import.charSet=l.val()),"Notes"===s||o&&"PriceBooks"===o&&a)Import.skipShowOperation();else{$("#importContainerDiv").css("overflow","auto"),Import.importNotCompleted=!0;var c=$("#sendUserInvitation");$("#ImportDiv, #fileInput, #importMappingDiv, #advanceOptions").hide(),c.hide(),$("#fileUploadSuccuessDiv").addClass("dN"),Import.enableDisableImportOperation(),$("#importOptions").show(),$("#operationPageFileName").text(Import.shortenFileName),Import.showAndPopulateOperationOptions(e),setTimeout((function(){$("input[name=chooseOperation]")[0].focus()}),100),!Import.operation||"overwrite"!==Import.operation&&"overwriteOnly"!==Import.operation?($("#ignoreEmptyDiv").hide(),"Users"===Import.currModule&&c.css("display","block")):($("#ignoreEmptyDiv").show(),Import.toggleFindBy(Import.operation)),"true"===$("#isZCampaignImport")[0].value&&Import.toggleFindBy("overwrite",document.getElementById("importOptionBoth"))}return}if("fieldMapping"===t.queryParams.step){o=Import.parentModule,a=Import.parentId;var u=$("#findBy").val(),d=$("#operation").val();if(Import.operation=d,Import.findByColumn=u,e.hasOwnProperty("FILEDATA")){Import.importNotCompleted=!1,(t={}).module=s,o&&""!==o&&(t.parentModule=o),a&&""!==a&&(t.parentId=a),t.calleeObj="Import",t.clickId="importbtnRevamp",t.id=n,t.step="fieldMapping",Import.importNotCompleted=!0,Import.currModule=s,$("#ImportDiv, #fileInput, #importOptions, #advanceOptions").hide(),$("#fileUploadSuccuessDiv").addClass("dN"),"Products"===Import.currModule&&null!==Import.parentModule&&$("#mappingSubmitBtn").val(I18n.getMsg("crm.button.import")),$("#importMappingDiv").show(),$("#mappingPagefileName").text(Import.shortenFileName),!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||"L"===Crm.userDetails.LICENSE_TYPE||Import.cfNotAllowedModules.indexOf(Import.currModule)>=0||"Products"===Import.currModule&&Import.parentModule&&"PriceBooks"===Import.parentModule?$("#createFieldButton").hide():$("#createFieldButton").show(),e.hasOwnProperty("LINKING_FIELDS")&&(Import.linkingFieldLabels=e.LINKING_FIELDS),Import.defaultValueSupportedModule.indexOf(Import.currModule)>=0||Import.currModule.startsWith("LinkingModule")||Import.currModule.startsWith("CustomModule")?$("#fieldMappingSectionDiv").show():$("#fieldMappingSectionDiv").hide(),Import.fieldsJson=e.FIELDS,Import.populateFieldMapping(e.FILEDATA),Import.populateCRMFields(e.FIELDS),Import.populateDataFormat(),Import.showFields("All",$("#allFields"));var m,p=$L("#importMappingDiv"),g=$(".ITF-container"),f=p.offset().top+84;p.css("height","calc(100vh - "+f+"px)"),m=renderingUtils.windowHeight-g.offset().top-$(".footerTableCon").height(),g.height(m),Import.FixedHeaderFunct("ITF-container"),$(".ITF-container .itb-body-class").height(m-$(".ITF-container .itb-header-class").outerHeight()),Import.importFieldContainer(),(C=$("#importContainerDiv")).on("keydown",Import.mappingKeyEvent);var h=$(".ITF-container .itb-body-class tbody tr:first-child").find("td:nth-child(2) div.dropDownIcon");if(h.addClass("crmFieldMappingHoverClass"),Import.currentFieldmap=h.find("#fieldChoose"),!Import.fileExtension||"csv"!==Import.fileExtension&&"vcf"!==Import.fileExtension)$(".charsetInfoIcon").hide();else{var y=$("#charSetAutoDetect option[value='"+Import.charSet+"']").text();$("#charSetInMapping").text(y),$(".charsetInfoIcon").show()}Import.fieldAutoMapping(e.FIELDS,e.PREVIOUSMAPPING,!1),Import.setMappedFieldListInDropdown(),C.css("overflow","hidden")}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.import.unexpected.error.file"),ltPropType:"error",ltPropDuration:"5000",ltPropYield:!0}});return void Import.enableAndDisableButton(["operationCancelBtn","operationSubmitBtn"],"enable")}if("showOptions"===t.queryParams.step&&r&&"submitMapping"===r.currStep){var C;(C=$("#importContainerDiv")).css("overflow","auto"),Import.importNotCompleted=!0,$("#ImportDiv, #fileInput, #importOptions, #importMappingDiv").hide(),$("#workflowOptionDiv, #workFlowExecutionDiv, #ownerOptionDiv, #recordOwnerDropDownDiv, #recordUserOptionDiv, #assignmentRuleOptionDiv, #enableApproveOption, #tagConfig").hide();var v=!1;if("overwriteOnly"===Import.operation||"Leads"!==Import.currModule&&"Contacts"!==Import.currModule&&"Cases"!==Import.currModule&&!Import.currModule.startsWith("CustomModule")||(v=!0,$("#enableApproveOption").show()),(e.hasOwnProperty("WORKFLOW")||e.hasOwnProperty("WORKFLOW_RULES")||e.hasOwnProperty("TAGS"))&&(v=!0,Import.showWorkflowAndLeadSourceOption(e)),Import.isConsentMsgShown()&&(v=!0),"overwriteOnly"!==Import.operation)if(e.hasOwnProperty("OWNER")&&Object.keys(e.OWNER).length>1||(e.hasOwnProperty("OWNER")&&Object.keys(e.OWNER).length>1||!e.hasOwnProperty("OWNER"))&&e.hasOwnProperty("LARENTRY")){v=!0,Import.showOwnerAndAssignmentRuleOption(e);var _=$("input[name=recordOwnerOption]:checked").val();!_||"users"!==_&&"assignmentRules"!==_||Import.showHideOptionsInImportLastPage(_)}else $("#ownerOptionDiv").hide();return v?($("#advanceOptionPagefileName").text(Import.shortenFileName),$("#advanceOptions").show()):Import.submitImport(),C.off("keydown",Import.mappingKeyEvent),void Import.enableAndDisableButton(["mappingPreviousBtn","mappingSubmitBtn"],"enable")}if("showOptions"===t.queryParams.step&&r&&"submitImport"===r.currStep){renderingUtils.freezeBackground();var R=Import.currModule;i=Import.currModule;moduleRecordMapping[R]&&(R=moduleRecordMapping[R].plural_label);var w=I18n.getMsg("crm.import.schedule.success.msg",$ESAPI.encoder().encodeForHTML(R)),b=$("#ImportScheduleMessageDiv");b.find("#heading").html(w),b.show(),b.addClass("showPpTop");var D=$("#importSuccessOKBtn");return setTimeout((function(){D.addClass("popupFocusing").focus()}),100),setTimeout((function(){D.trigger("click")}),5e3),r.parentModule&&""!==r.parentModule&&(i=r.parentModule),void("Users"===i?Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.users"}):!Import.currModule||Crm.isActivitySplitDone||"Tasks"!==Import.currModule&&"Events"!==Import.currModule&&"Calls"!==Import.currModule?Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[i]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:["Activities"]}))}}return{outlet:"#show",html:e}},afterRender:function(){$("#fileInput").addClass("helpOverflowHide")},beforeExit:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient));var e=$("#dataTypeDropdown").find("select");e&&e.length>0&&thirdPartyUtils.unbindSelect2(e);var t=$("#polymorphic_modules");t&&t.length>0&&thirdPartyUtils.unbindSelect2(t);var r=$("#polymorpicLookupFieldFindBy");r&&r.length>0&&thirdPartyUtils.unbindSelect2(r),Import.reset()},actions:{didTransition:function(){var e=Lyte.Router.getRouteInstance().transition.info.queryParams.module,t=document.getElementsByTagName("crm-tab");t&&t.length>0&&t[0].setData("selected",moduleRecordMapping[e])},willTransition:function(e){if(e.target.indexOf("crm.settings.import")<0&&Import.importNotCompleted){var t=$("#importContainerDiv");t.off("keydown",Import.mappingKeyEvent),t.off("keydown",Import.customFieldCreationKeyEvent),t.off("keydown",Import.popupKeyEvent)}closeAsapWidget(),$("#fileInput").removeClass("helpOverflowHide")},onBeforeLoad:function(){var e=this.getQueryParams().module;Crm.userDetails.isStorageLimitReached&&"Users"!==e&&(Crm.showStorageExceedPopup(),this.transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["callswf-announcement.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["callswf-announcement.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["plugindeprecation-announcement.js","lyte-draggable.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["plugindeprecation-announcement.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OldApiNotationPluginDepr")],ResourceConstants.CRM),i=e.concat(t).concat(r).concat(s).concat(n);if(("true"===window.isCrmPlusUser||"true"===window.isZohoOneUser)&&void 0!==Crm.userDetails.PROFILE_POPUP){var o=networkUtils.returnDependencyFiles(["crm-getting-start.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-getting-start.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("onboardingpageSetupPageText")],ResourceConstants.CRM),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("smartprompt")],ResourceConstants.CRM);i=i.concat(o).concat(a).concat(l).concat(c)}return i},beforeModel:function(e){Crm.trackSpotLightAction("Setup - Page Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){if(!globalSetpJson){var e=[];return e[0]=store.findAll("settings_customization"),e[1]=setup,e[2]=this,{customizationJson:Lyte.resolvePromises(e)}}return globalSetpJson},lyteConvertionSupported:!0,afterModel:function(e){if(e&&!globalSetpJson){var t=e.customizationJson[1];crmSetup.Permissioned_Setup_Elements=[],this.metaBinding(t)}globalSetpJson||(globalSetpJson=e.customizationJson[0]),this.transition.data&&this.transition.data.fromeditor&&this.cancel_layout_action();for(var r=globalSetpJson.components,s=[],n=[],i=r.length,o=0;o<i;o++)o<4?s.push(r[o]):n.push(r[o]);var a=[];a.push(s),a.push(n);var l={globalSetpJson:a,hignEdDivAvailInSetup:hignEdDivAvailInSetup};this.currentModel=l;var c=Lyte.Router.getRouteInstance().transition.target;if(featuresAvailable.NEXTGENUI_ENABLED&&!Lyte.registeredMixins["crm-setup-mixin"].isMarketPlaceRouters(c)){var u=$L("crm-left-menu")[0];(u=u?u.component:null).setData("selectedMenu","settings"),u.actions.showOrHideLeftPane(!1)}if(this.transition&&void 0!==this.transition.data&&this.transition.data.isReauthorize){let e,t,r,s;e=this,null!==this.transition.data.services.failed_services?(r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PathFinderReauth")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["commandcenter-integ-authentication-pop.js"],ResourceConstants.CRMClient),s=t.concat(r),Lyte.injectResources([s],void 0,void 0).then((function(){var t,r,s,n,i,o,a;(a=$L("crm-setup")[0]).component.setData("isReauthorize",e.transition.data.isReauthorize),n=(r=e.transition.data.services.failed_services).length,t=[],o=!1;for(var l=0;l<n;l++){i=r[l].orgs.length;for(var c=0;c<i;c++)r[l].orgs[c].authenticated_user+""===Crm.userDetails.USER_ID&&(o=!0,t.push(r[l]),void 0===s&&(s=r[l].orgs[c].cc_authenticated_by+""))}if(null!==t&&o){if(a.component.setData("failedservices",t),null!==s){var u=Crm.getUserDetailsMap();null!==u&&s in u&&a.component.setData("cc_authenticated_user_name",u[s].name)}}else e.displayFailureMsg("Current User does not have any apps to authenticate")}))):(_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.no.apps.auth")}}),compVar.component.setData("isReauthorize",!1))}},renderTemplate:function(){return{outlet:"#show",component:"crm-setup"}},afterRender:function(){var e=$("body");if(this.transition.data&&this.transition.data.fromeditor&&($("#mainMenuTabDiv").show(),$("html").css("overflow","")),this.transition.data&&this.transition.data.hasmsg&&crmui.showMsgBand("error",this.transition.data.hasmsg,4e3),$L("html, body")[0].scrollTop=0,commonUtils.showHideLoadingDiv(!1),crmSetup.populateHigherEditionArr(),showHigherEdtnFeatureForUser?crmSetup.initShowFeatures():hignEdDivAvailInSetup&&crmSetup.hideAdvancedFeatures(),document.querySelector("lyte-autocomplete input")&&document.querySelector("lyte-autocomplete input").setAttribute("data-zcqa","setup_search"),this.setTitle(I18n.getMsg("crm.title.setup.revamp",[Crm.partnerName])),showwfcallsannouncement&&$("#wfCallsAnnouncementPop").length<1){var t={brandName:Crm.partnerName,dueDate:wfcallsmigrationdate};Lyte.Component.render("callswf-announcement",t,"body"),$("#wfCallsAnnouncementPop")[0].ltProp({show:!0})}showPluginDeprecationAnnouncement&&$("#setupPageApiDeprBanner").length<1&&Lyte.Component.render("plugindeprecation-announcement",void 0,"#pluginoldapideprnotification"),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_VISIT_SETUP").PF_VISIT_SETUP,RebrandLinkUtil.getProperties("PF_VISIT_SETUP_ID").PF_VISIT_SETUP_ID),e.css("overflow-x","hidden"),$(".setupLayout").css("overflow-x","auto"),featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.methods.hideContentLoader(),"true"!==window.isCrmPlusUser&&"true"!==window.isZohoOneUser||void 0===Crm.userDetails.PROFILE_POPUP||$L("#getStarted").html("<crm-getting-start></crm-getting-start>")},redirect:function(){featuresAvailable.NEXTGENUI_ENABLED&&this.replaceWith(Lyte.registeredMixins["crm-setup-mixin"].getLastAccessedRouter())},beforeExit:function(){$("body, .setupLayout").css("overflow-x","")},actions:{willTransition:function(e){0==e.data&&(renderingUtils.displayPermissionDenied(),e.abort()),void 0!==e.data&&void 0!==e.data.permission&&"false"==e.data.permission&&(renderingUtils.displayPermissionDenied(),e.abort());for(var t=registeredEntity.length,r=0;r<t;r++)store.unloadAll(registeredEntity[r])}}},{mixins:["crm-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.kanban-begin",{queryParams:["module","page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-kanban-begin.js","crux-form-component.js","crm-kanban-dependencies.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-kanban-begin.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kanbanview"),networkUtils.getI18nJSUrl("listview")],ResourceConstants.CRM))},beforeModel:function(){var e={},t=this.getQueryParams().module,r=moduleRecordMapping[t],s=r.api_name;e.kanban_view=store.findAll("kanban_view",{module:s},!1,!0);var n=this;return Lyte.resolvePromises(e).then((function(e){if(0!==e.kanban_view.length){n.transition.abort();var s={},i={page:1};s.route="crm.tab.module.custom-view.kanban",s.dynamicParams=[t,r.cvid],s.queryParams=i,Lyte.Router.transitionTo(s).data={clearCache:!0}}}))},model:function(){var e=this.getQueryParams().module;return this.getModuleData(e,"crm.tab.module.custom-view.kanban")},renderTemplate:function(e){var t={createView:!0};return t.moduleName=this.getQueryParams().module,this.setKanbanSettingsData(e.module,t),{outlet:"#show",component:"crm-kanban-begin"}}},{mixins:["crm-view-utils","crm-kanban-mixin"]}),Lyte.Router.registerRoute("crm.settings.migration.api-login",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-api-login.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-api-login.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){if(this.transition.data.details&&this.transition.data.details)return 3===this.transition.data.details.source_type&&(this.transition.data.details.othercrm_response=store.findAll("dummy",{sourceSystem:this.transition.data.details.source_system},!1,!1,{url:"crm/migration/v1/get/accountsInfo"})),this.transition.data.details},afterModel:function(e){var t,r=e.source_system,s=e.source_type,n={};n.step="abort";var i,o,a,l,c=null,u=null,d=null,m=null;switch(r?r.toLowerCase():void 0){case"hubspot":i="crm.migration.source.hubspot",o="migLogoHub",a="HubSpot",l="https://api.hubapi.com";break;case"pipedrive":i="crm.migration.source.pipedrive",o="migLogoPipe",a="pipeDrive",l="https://api.pipedrive.com";break;case"capsule":i="crm.migration.source.capsule",o="migCapsule",a="Capsule",l="https://api.capsulecrm.com";break;case"insightly":i="crm.migration.source.insightly",o="migLogoInsight",a="Insightly",l="https://api.insight.ly";break;case"zohocontactmanager":case"zcontactmanager":i="crm.migration.source.contactManager",o="migLogoCntManager",a="ZohocontactManager";break;case"highrise":i="crm.migration.source.highrise",o="migLogoHigh",a="Highrise";break;case"zohobigin":i="crm.migration.source.zohobigin",o="migLogoBigin",a="ZohoBigin";break;case"bitrix24":i="crm.migration.source.Bitrix",o="migLogoBitrix",a="Bitrix24"}if(3===s)switch(e.othercrm_response.STATUS_CODE){case"ZS001":u=[];for(var p=JSON.parse(e.othercrm_response.STATUS_MESSAGE),g=Object.keys(p),f=g.length,h=0;h<f;h++){var y={};y.id=g[h],y.name=p[g[h]].portalName,u.push(y)}f>1?(c=I18n.getMsg("crm.migration.api.bigin.selectfromorgs"),t=!1):1===f&&(t=!0,l=m=u[0].id);break;case"ZE001":var C=e.source_system.toLowerCase(),v=e.othercrm_response.STATUS_MESSAGE;d=I18n.getMsg(this.apiErrorPreFix+v,I18n.getMsg(C));break;default:d=I18n.getMsg(this.apiErrorPreFix+"SERVER_NOT_REACHABLE")}this.currentModel={source_system:r,source_type:e.source_type,portal_name:e.portal_name,portal_status:t,abort_step:n,display_name:i,logo_class:o,server_source_const:a,default_instance_url:l,error_message:d,orgArray:u,drop_down_placeholder:c,selectedProp:m}},renderTemplate:function(){return{outlet:"#show",component:"crm-dm-api-login"}}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration.index.complete",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-complete.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-complete.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-complete.css","data-migration-complete-rtl.css"],ResourceConstants.CRMClient);var r=networkUtils.returnDependencyFiles(["lyte-tree.js"],ResourceConstants.CRMClient);return e.concat(t).concat(r)},model:function(){return store.findRecord("migration",Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])},afterModel:function(e){var t;switch(e.completeData=this.setCompleteTreeData(e,!0),e.state){case"COMPLETED":t="migSuccess";break;case"ERROR":t="migFailed";break;case"ABORT":for(var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],s=store.peekAll("migration-module"),n=s.length,i=!1,o=0;o<n;o++){var a=s[o];if(a.data_migration.id===r&&"FAILED"===a.status&&"FAILED"===a.code){i=!0,1===e.source_type&&"corruptedFile"===a.message&&(e.abortMessage=this.getAbortMessage(a.file_details,a.module));break}}i?t="migFailed":(t="migHalt",e.abortModule=e.completeData.abortModule);break;default:t="migRunning"}if(e.flag=t,featuresAvailable.NEXTGENUI_ENABLED){var l=document.querySelector("crm-left-menu").component;l.setData("selectedMenu","settings"),l.actions.showOrHideLeftPane(!1)}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-complete"}},afterRender:function(e){2===e.source_type?this.updateNavigationStep(5,5):this.updateNavigationStep(4,4);var t=$L("crm-dm-wizard-steps")[0].component;"ABORT"!==e.status&&"COMPLETED"!==e.status||t.setData("showEditMigration",!1)},actions:{didTransition:function(){$L("crm-dm-feature-title")[0].component.getData("isMigrationComplete")&&$L(".lstep").find("lyte-step-item").eq(4).removeClass("lyteActive").addClass("lyteCompleted")}}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.extract-data",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-extract-data.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-extract-data.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.peekRecord("migration",e)?store.peekRecord("migration",e):store.findRecord("migration",e)},afterModel:function(e){this.updateNavigationStep(0,999);var t=$("<div/>").html(Crm.userDetails.EMAIL).text(),r=e.notify,s=!1;this.transition.data&&"extract"===this.transition.data.api&&(s=!0),this.currentModel={notify:r,user_mail:t,api:s}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-extract-data"}}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration.index.file-upload",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-file-upload.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-file-upload.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-file-upload.css","data-migration-file-upload-rtl.css"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.peekRecord("migration",e)?store.peekRecord("migration",e):store.findRecord("migration",e)},afterModel:function(e){var t=e.details?e.details:e,r=e.uploadedfiles?e.uploadedfiles:t.uploadedfiles,s=e.source_system?e.source_system:t.source_system,n=e.character_encoding?e.character_encoding:t.character_encoding;this.currentModel={list_of_uploaded_files:r||[],source_system:s.toLowerCase(),charset:n}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-file-upload"}},afterRender:function(e){this.updateNavigationStep(0,0);var t=e.list_of_uploaded_files;t&&t.length>0&&($L("#browse").addClass("dN"),this.updateWizardStepsAfterFileUpload(!0),$L("#migCsetUpBtn").removeClass("dN"));var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],s=Crm.userDetails.USER_ID,n=t?t.length:0;this.bindUploadBtnAndOpts(r,s,n),t.length>0?$("#goSc2")[0].ltProp("disabled",!1):$("#goSc2")[0].ltProp("disabled",!0),this.refreshUploadedFileCnt()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.map-fields",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-map-fields.js","crux-tag.js","crux-color-palette.js","crm-tag-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-map-fields.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-map-fields.css","data-migration-map-fields-rtl.css"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.findRecord("migration",e)},redirect:function(e){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];this.validateMappings($L("crm-dm-wizard-steps")[0].component,e.mapped_modules)||Lyte.Router.replaceWith({route:"crm.settings.migration.index.map-modules",dynamicParams:[t]})},afterModel:function(e){this.transition.data&&(e.transitionData=this.transition.data,e.mapped_modules=this.getMappedModules(e,!0)),e.mapped_modules&&(this.transition.data&&this.transition.data.module?(e.currentModule=this.getFromStore("labelVsApi")[this.transition.data.module],e.currentModuleLabel=this.transition.data.module):(e.currentModule=this.getFromStore("labelVsApi")[e.activeModule],e.currentModuleLabel=e.activeModule))},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-map-fields"}},afterRender:function(){if(this.hideOptionToSwitchTab(),this.updateNavigationStep(2,2),this.setWizardSteps(),this.fieldMapTableHgt(),document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!1,migFieldMapTour:!0}),this.transition.data&&this.transition.data.module){var e=$L("#fieldsModuleList");e.find("li").removeClass("field_map_item_active"),e.find("li[data-modulename='"+this.transition.data.module+"']").addClass("field_map_item_active");var t=$L(".field_map_item_active").position().top;e.scrollTop(t)}else{var r=$L("#fieldsModuleList"),s=r.outerHeight(),n=$L(".field_map_item_active").next("li"),i=41*($(n).index()+1);i>s&&r.scrollTop(i-82)}this.showMigrationBackdrop()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.map-modules",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-map-modules.js","lyte-draggable.js","crux-video.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-map-modules.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-map-modules.css","data-migration-map-modules-rtl.css"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];store.unloadAll("migration-module");var t="crm/bulk/v2/migration/"+e+"/files";return Lyte.resolvePromises({migration:store.findRecord("migration",e),fileInfo:store.findAll("dummy",void 0,!1,!1,{url:t})})},actions:{onError:function(e,t,r,s){if("model"===s){Lyte.registeredMixins["migration-util"].addToStore({properTransition:!0}),t.resume(),this.routeToIndexRoutes("crm.settings.migration.index.file-upload",Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],{step:"error"});var n=$L("crm-dm-wizard-steps")[0].component;n.setData("errorMessage",I18n.getMsg("crm.migration.general.error")),n.setData("showError",!0)}}},afterModel:function(e){var t=e.fileInfo;t.unmapped_files||(t=this.convertToSupportedFormat(e.fileInfo,"files"),this.addToStore({files:t}));var r=this.setTemplateData(e.migration,t);if(r){var s=r.modules,n=0,i=0,o=0;for(var a in s)s[a]&&(s[a].files&&s[a].files.length>0?n+=1:i+=1,o+=1);var l="all";0===this.getFromStore("files").unmapped_files.length&&(l="mapped"),this.currentModel={filesVsModules:r.filesVsModules,modules:r.modules,response:r.response,unmapped_files:t.unmapped_files,mapped_files:t.mapped_files,unsupported_files:t.unsupported_files,show_pop_over:!1,total_modules:o,mapped_modules:n,unmapped_modules:i,filter:l}}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-map-modules"}},afterRender:function(e){this.removeMigrationBackdrop();var t=this.getFromStore("files");this.refreshGraphInModules(t.unmapped_files?t.unmapped_files.length:0,t.unsupported_files?t.unsupported_files.length:0,t.mapped_files?t.mapped_files.length:0,t.empty_files?t.empty_files.length:0),"mapped"===e.filter?this.showActiveModuleFilter($L(".migFieldFilterOuter").find("lyte-tab-title").eq(1)):this.showActiveModuleFilter($L(".migFieldFilterOuter").find("lyte-tab-title").first()),this.updateNavigationStep(1,1),$L("#listUnMapped").find("li").length&&this.dragAndDropModule(),document.querySelector("crm-dm-map-modules").component.methods.checkforNofiles(),0!==parseInt($L("#unMappedCount").text())&&document.querySelector("#migUnmapped").click(),t.unmapped_files&&t.mapped_files&&0===t.unmapped_files.length&&t.unmapped_files.length===t.mapped_files.length&&document.querySelector("crm-dm-folder-list").component.setData("noModuleMapped",!0),document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!0,migFieldMapTour:!1})}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.report-and-review",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-report-and-review.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["data-migration-report-and-review.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t="crm/bulk/v2/migration/"+e+"/files";return Lyte.resolvePromises({migration:store.findRecord("migration",e),fileInfo:store.findAll("dummy",void 0,!1,!1,{url:t})})},afterModel:function(e){var t=e.fileInfo;t.unmapped_files||(t=this.convertToSupportedFormat(e.fileInfo,"files"),this.addToStore({files:t}));var r=this.processReport(e.migration,t.mapped_files);r&&(this.currentModel={mapped_file_count:t.mapped_files.length,unmapped_file_count:t.unmapped_files.length,unsupported_file_count:t.unsupported_files.length,empty_file_count:t.empty_files.length,moduleVsFieldMappingCount:r,migration:e.migration,mapped_modules:this.getMappedModules(e.migration)})},redirect:function(e){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];this.validateMappings($L("crm-dm-wizard-steps")[0].component,e.mapped_modules)||Lyte.Router.replaceWith({route:"crm.settings.migration.index.map-modules",dynamicParams:[t]})},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-report-and-review"}},afterRender:function(e){document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!1,migFieldMapTour:!1}),this.updateNavigationStep(3,3),this.showFieldPies(e.moduleVsFieldMappingCount),this.removeMigrationBackdrop()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index",{getResources:function(){return networkUtils.returnDependencyFiles(["data-migration-component-nav-bars.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t=store.peekRecord("migration",e);if(!t||!t.source_system)return Lyte.resolvePromises({migration:store.findRecord("migration",e).then(function(e){if(!this.getFromStore("sourceModules")){var t={source:e.source_system.toLowerCase()};store.findAll("dummy",t,!1,!1,{url:"crm/bulk/v2/migration/settings/modules"}).then(function(e){return this.addToStore({sourceModules:e.modules})}.bind(this))}}.bind(this))});if(!this.getFromStore("sourceModules")){var r={source:t.source_system.toLowerCase()};store.findAll("dummy",r,!1,!1,{url:"crm/bulk/v2/migration/settings/modules"}).then(function(e){return this.addToStore({sourceModules:e.modules})}.bind(this))}var s=document.querySelector("crm-left-menu");s&&s.component&&((s=s.component).setData("selectedMenu","settings"),s.actions.showOrHideLeftPane(!1))},actions:{onError:function(e,t,r,s){"model"===s&&(t.resume(),Lyte.Router.replaceWith({route:"crm.settings.section.data-migration"}).data={step:"error"})}},afterModel:function(e){var t,r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],s=(e=store.peekRecord("migration",r)).status?e.status:e.state;switch(s){case"UPLOAD":t=0;break;case"FILEPRCS":t=999;break;case"PENDING":if(this&&this.transition.target)switch(this.transition.target.substring(this.transition.target.lastIndexOf("."))){case".map-fields":t=2;break;case".report-and-review":t=3;break;default:t=1}else t=1;break;case"INITIATE":case"ABORT":case"STARTED":case"SETUP":case"DATA_SYNC_COMP":t=4;break;default:return}if(2===e.source_type&&(t=5),this.currentModel={step:t,id:e.id,state:s,source_type:e.source_type,notify:e.notify},featuresAvailable.NEXTGENUI_ENABLED){var n=document.querySelector("crm-left-menu").component;n.setData("selectedMenu","settings"),n.actions.showOrHideLeftPane(!1)}},redirect:function(e){if($L.isEmptyObject(this.transition.data)){if(!e||e&&(!e.migration||!e.state)){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];e=store.peekRecord("migration",t)}this.redirectMigrationBasedOnCurrentStatus(e,this)}},renderTemplate:function(){return{outlet:"#show",component:"crm-dm-nav-bars"}},afterRender:function(){this.migContentHeight()},beforeExit:function(){this.resetFullMigration()}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration",{getDependencies:function(){return networkUtils.returnDependencyFiles(["data-migration-store.js","migration-util.js"],ResourceConstants.CRMClient)},getResources:function(){if("crm.settings.migration"!==this.transition.target){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["data-migration-component-general.js","lyte-step.js","migration-constants.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["data-migration-general.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)r=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],ResourceConstants.CRMClient);var s=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient);return e.concat(t).concat(r).concat(n).concat(s)}},beforeExit:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient))},redirect:function(){if("crm.settings.migration"===this.transition.target||"crm.settings.migration.api-login"===this.transition.target&&$L.isEmptyObject(this.transition.data)){var e={route:"crm.settings.section.data-migration"};Lyte.Router.replaceWith(e).data=objectUtils.cloneObject(this.transition.data)}},getRouteInstruction:function(e,t,r){var s=this.getState(e),n=this.getState(t),i=Lyte.registeredMixins["migration-util"].getFromStore("properTransition");return i||r?(i&&Lyte.registeredMixins["migration-util"].addToStore({properTransition:!1}),"continueWithSameTransition"):"stateA"===n||"Honey!IamYourDaddy"===s||"Honey!IamYourDaddy"===n?"continueWithSameTransition":"stateB"!==s||"stateC"!==n||i?"unknown"===s||s>n?"routeToExit":s<n||s===n||"unknown"===n?"continueWithSameTransition":"routeToExit":"routeToExit"},getState:function(e){return["crm.settings.section.data-migration","crm.settings.section.import","crm.settings.import"].indexOf(e)>=0?"stateA":["crm.settings.migration.index.file-upload","crm.settings.migration.api-login"].indexOf(e)>=0?"stateB":["crm.settings.migration.index.extract-data"].indexOf(e)>=0?"stateC":["crm.settings.migration.index.map-modules","crm.settings.migration.index.map-fields","crm.settings.migration.index.report-and-review"].indexOf(e)>=0?"stateD":["crm.settings.migration.index.complete"].indexOf(e)>=0?"stateE":e.startsWith("crm.settings.migration.index")?"Honey!IamYourDaddy":"unknown"},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance().transition.info.route,r=e.info.route,s=e.data?e.data.status:void 0;if("routeToExit"===this.getRouteInstruction(t,r,s))Lyte.registeredMixins["migration-util"].routeToExit()}}}),Lyte.Router.registerRoute("crm.settings.section.abtesting.create-abtesting",{queryParams:["module","name","base_form","add_suggest_variant"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-selected-fields.js","webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-abtesting-suggestions.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-builder-less.css","crm-abtesting-suggestions-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),e.queryParams.module&&e.queryParams.base_form&&this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim());var t=this;return new Promise((function(r){var s=t.getModuleObjByApiName(e.queryParams.module),n={builder_type:"abtesting",module:s,abtesting:store.createRecord("abtesting",t.getBasicABTesting(e.queryParams.name,s,e.queryParams.base_form)),base_form:store.findRecord("webform",e.queryParams.base_form,{module:s.api_name},void 0,!0,store.peekRecord("webform",e.queryParams.base_form)),isAddVariantSuggestion:!!e.queryParams.add_suggest_variant};Lyte.resolvePromises(n).then((function(e){e.base_form&&e.base_form.id?(e.layout=store.findRecord("layout",e.base_form.layout.id,{module:s.api_name,skip_permission:!0}),e.base_form.suggestion&&e.base_form.suggestion.available&&(e.abtest_suggestion_response=store.triggerAction("webform","suggestions",{id:e.base_form.id},{},"GET")),Lyte.resolvePromises(e).then((function(e){r(e)}))):t.showPermissionDenied(t.transition)}))}))},afterModel:function(e){var t=this.constructFieldsArrayFromResponse(e.layout[0]),r=this.constructWebFormFields(e.base_form.fields,t,e.module.module_name,e.base_form.type);if("portalform"===e.base_form.type){var s=this.getMandateFieldsForPortalForms();t.push(s),t=t.flat()}if(e.activeTab=1,e.allFields=t,e.base_form=e.base_form.$.toJSON(),e.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]},e.base_form.fields=r.selectedFieldsList,e.base_form.fieldsToSelect=r.fieldsToSelect,e.base_form.advancedFieldsToSelect=r.advancedFieldsToSelect,$L.extend(e.abtesting.base_form,e.base_form),e.abtest_suggestion_response&&e.abtest_suggestion_response.webform_suggestions){var n=e.abtest_suggestion_response.webform_suggestions[0].suggestion_details.suggested_variant_info;n.name=e.base_form.name,n.modifications=this.getModificationDiffForSuggestion(e.base_form,n);var i=this.isModificationsAvailable(n.modifications),o=i?n.modifications.modified_fields:null;if(o&&(n.modified_fields=o),n.isSuggestedVariant=!0,e.suggestedVariant=n,e.suggestedVariant.modificationAvailable=i,e.has_abtest_suggestion=!0,e.isAddVariantSuggestion){var a=this.constructWebFormFields(n.fields,t,e.module.module_name);n.fields=a.selectedFieldsList,n.fieldsToSelect=a.fieldsToSelect,n.advancedFieldsToSelect=a.advancedFieldsToSelect;var l=n.modifications;0===Object.keys(l).length?l={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]}:(l.modified_fields||(l.modified_fields=[]),l.added_fields||(l.added_fields=[]),l.removed_fields||(l.removed_fields=[])),this.updateAddedFieldModifications(l,t,e.module),$L.extend(e.abtesting.variant_form[0],JSON.parse(JSON.stringify(e.suggestedVariant))),e.webform=e.abtesting.variant_form[0],e.isSuggestedVariantAdded=!0,e.activeTab=1}else e.webform=e.base_form,e.abtesting.variant_form=[],e.activeTab=0}else e.activeTab=1,$L.extend(e.abtesting.variant_form[0],JSON.parse(JSON.stringify(e.base_form))),e.abtesting.variant_form[0].id="",e.webform=e.abtesting.variant_form[0],e.has_abtest_suggestion=!1},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.edit-abtesting",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","webform-selected-fields.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-abtesting-suggestions.js","autoresponse_mixins.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-builder-less.css","crm-abtesting-suggestions-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),e.queryParams.module&&this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition)},model:function(e){var t=this;return new Promise((function(r,s){var n=t.getModuleObjByApiName(e.queryParams.module),i={builder_type:"abtesting",module:n,abtesting:store.findRecord("abtesting",e.dynamicParam,{module:n.api_name})};Lyte.resolvePromises(i).then((function(e){if("drafted"!==e.abtesting.status&&"scheduled"!==e.abtesting.status)return t.showPermissionDenied(t.transition),s("user does not have sufficient privileges to perform this action");var i=e.abtesting.variant_form.length;e.base_form=store.findRecord("webform",e.abtesting.base_form.id,{module:n.api_name});for(var o=0;o<i;o++){var a=e.abtesting.variant_form[o],l={form1:e.abtesting.base_form.id,form2:a.id};e["variant_"+o+"_modifications"]=store.triggerAction("webform","diff",{},l,"GET")}Lyte.resolvePromises(e).then((function(t){t.layout=store.findRecord("layout",t.base_form.layout.id,{module:n.api_name,skip_permission:!0}),"drafted"===t.abtesting.status&&t.base_form.suggestion&&t.base_form.suggestion.available&&(t.abtest_suggestion_response=e.abtest_suggestion_response=store.triggerAction("webform","suggestions",{id:t.base_form.id},{},"GET")),Lyte.resolvePromises(t).then((function(e){r(e)}))}))}),(function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||setTimeout((function(){t.showPermissionDenied(t.transition)}),0)}))}))},afterModel:function(e){var t=this.constructFieldsArrayFromResponse(e.layout[0]),r=this.constructWebFormFields(e.base_form.fields,t,e.module.module_name);e.base_form.fields=r.selectedFieldsList,e.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]},$L.extend(e.abtesting.base_form,e.base_form.$.toJSON()),e.allFields=t,e.abtesting.base_form.fields=r.selectedFieldsList,e.abtesting.base_form.fieldsToSelect=r.fieldsToSelect,e.abtesting.base_form.advancedFieldsToSelect=r.advancedFieldsToSelect,e.abtesting.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]};for(var s=e.abtesting.variant_form.length,n=0;n<s;n++){var i=e.abtesting.variant_form[n],o=this.constructWebFormFields(i.fields,t,e.module.module_name,e.base_form.type),a=e["variant_"+n+"_modifications"].diff[0];e.abtesting.variant_form[n].module=e.module,e.abtesting.variant_form[n].fields=o.selectedFieldsList,e.abtesting.variant_form[n].fieldsToSelect=o.fieldsToSelect,e.abtesting.variant_form[n].advancedFieldsToSelect=o.advancedFieldsToSelect,0===Object.keys(a).length?a={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]}:(a.modified_fields||(a.modified_fields=[]),a.added_fields||(a.added_fields=[]),a.removed_fields||(a.removed_fields=[])),this.updateAddedFieldModifications(a,t,e.module),e.abtesting.variant_form[n].modifications=a}if(e.abtest_suggestion_response&&e.abtest_suggestion_response.webform_suggestions){let t=e.abtest_suggestion_response.webform_suggestions[0].suggestion_details.suggested_variant_info;t.name=e.base_form.name;let r=!1;for(let n=0;n<s;n++){let s=this.getModificationDiffForSuggestion(e.abtesting.variant_form[n],t);if(!this.isModificationsAvailable(s)){r=!0;break}}if(!r){t.modifications=this.getModificationDiffForSuggestion(e.base_form,t);let r=this.isModificationsAvailable(t.modifications),s=r?t.modifications.modified_fields:null;s&&(t.modified_fields=s),t.isSuggestedVariant=!0,e.suggestedVariant=t,e.suggestedVariant.modificationAvailable=r,e.has_abtest_suggestion=!0}}e.activeTab=1,e.webform=e.abtesting.variant_form[0]},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.index-abtesting",{queryParams:["module","base_form","status"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["abtesting-listview.js","crm-webform-abtesting-create.js","webform-abtesting-demovideo.js","crux-video.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-webform-abtesting-create-less.css","webform-abtesting-demovideo-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t=t.concat(networkUtils.returnDependencyFiles(["abtesting-listview-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["abtesting-listview-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e.concat(t)},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),e.queryParams.module)this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition);else{var t=this.getFeatureSupportedModules("abtesting");t.length?e.queryParams.module=t[0].api_name:this.showPermissionDenied(this.transition)}},model:function(e){var t={module:e.queryParams.module};e.queryParams.base_form&&(t.base_form=e.queryParams.base_form),e.queryParams.status&&(t.status=e.queryParams.status);var r={abtesting:store.findAll("abtesting",t,void 0,!0,{}),visit_details:store.triggerAction("abtesting","visitors",{},{module:t.module},"GET"),supported_modules:this.getFeatureSupportedModules("abtesting")};return Lyte.resolvePromises(r)},afterModel:function(e,t){if(e.module=this.getModuleObjByApiName(t.queryParams.module),e.abtesting){var r=e.abtesting.$.meta.info;e.available_abtesting=r.available_abtesting,r.supported_module&&(e.supported_modules=r.supported_module)}e.visit_details&&e.visit_details.AB_testing&&this.setVisitorDetails(e.visit_details.AB_testing,e.abtesting),this.setCompleteRestartInfo(e.abtesting),e.base_forms=this.getBaseFormsForABTList(e.abtesting,e.module.api_name),t.queryParams.base_form&&(e.base_form=t.queryParams.base_form),e.base_form="all_forms",e.status="all_status";Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||(e.isNewHelp=!0)},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-webform-abtesting-listview"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#selectMod")[0];t&&(t.ltProp("selected",""),t.ltProp("selected",e.module.api_name)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.client_tracking("WF AB Test - A/B Testing Tab")},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less.css","webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)))},actions:{onError:function(e){"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",{queryParams:["module","timeFilter"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-webform-abtesting-analytics_new.js","lyte-daterangepicker.js","crm-webform-analytics-config_new.js"],ResourceConstants.CRMClient),t=["crm-webform-abtesting-analytics_new-less.css","crm-webform-analytics-config_new-less.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-webform-rtl-less.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(r)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.validateModule(e),this.parent.component.setData("selectedTab","analytics")},model:function(e){var t=this.parent.currentModel.abtesting,r={record:t,visit_details:store.triggerAction("abtesting","visitors",{id:t.id},{module:e.queryParams.module},"GET"),module:e.queryParams.module};return this.id!==e.dynamicParam&&(r.webform_analytics_arr=this.getAllWebFormAbtestingDashboardsComponents(e.queryParams.module,this.parent.getDynamicParam(),e.dynamicParam),this.id=e.dynamicParam,r.base_form=store.findRecord("webform",r.record.base_form.id,{module:r.module},!1,!0,{})),Lyte.resolvePromises(r)},afterModel:function(e){e.base_form&&(e.abtesting_webforms=[],e.abtesting_webforms.push(e.base_form),e.record.variant_form.forEach((function(t){e.abtesting_webforms.push(t)})));var t,r,s="YYYY-MM-DD";if(e.timefilter={},e.display_value={},this.getQueryParams().timeFilter){var n=JSON.parse(this.getQueryParams().timeFilter);t=crmCalendar.getDateObjectFromGivenDateString(n.start_date,s),r=crmCalendar.getDateObjectFromGivenDateString(n.end_date,s)}else t=Utils.convertFrom8601DateFormat(e.record.created_time),Utils.convertToUserTimezone(t),r=new Date,Utils.convertToUserTimezone(r);if(e.timefilter.start_date=this.convertDateToISODate(t),e.timefilter.end_date=this.convertDateToISODate(r),e.display_value.start_date=this.convertDateFormat(t),e.display_value.end_date=this.convertDateFormat(r),e.abtesting_status=this.createABTestingStats(e.record),e.id=this.parent.getDynamicParam(),e.abTestRunTimeArray=this.getABTestingRunTimeAsArray(e.record),e.webform_analytics_arr){var i,o=store.peekRecord("abtesting-analytics",this.getDynamicParam());e.webform_analytics=this.renderComponentsBasedOnType(this.getQueryParams().module,o,e.webform_analytics_arr),delete e.webform_analytics_arr,e.day_week_month=this.getDayWeekMonthChartObject("custom",void 0,void 0,t,r),e.day_week_month[0].disabled="",e.day_week_month.forEach((function(e){"true"===e.selected&&(i=e.value)})),e.default_period=i}var a="MM/DD/YYYY";e.datePickerStart=Utils.getDateInGivenPattern(Utils.convertFrom8601DateFormat(e.record.created_time),a.toLowerCase()),e.datePickerEnd=Utils.getDateInGivenPattern(new Date,a.toLowerCase()),e.dateStart=Utils.getDateInGivenPattern(t,a.toLowerCase()),e.dateEnd=Utils.getDateInGivenPattern(r,a.toLowerCase()),e.visit_details&&e.visit_details.AB_testing&&(this.setVisitorDetails(e.visit_details.AB_testing,[e.record]),e.remainingVisitors=e.record.condition.remaining);for(var l=e.abtesting_status.length,c=0,u=!1,d=0;d<l;d++){var m=e.abtesting_status[d];c+=m.visitors,u||0===m.conversion||(u=!0)}e.launchBtnAvailable=u&&0!==c,e.totalVisits=c;var p=Utils.ISO8601toDateObject(e.record.start_time),g=new Date;g.setMonth(g.getMonth()-this.getEditionBasedLimit().month),g.setDate(1),p<g&&(e.hide_analytics=!0)},lyteConvertionSupported:!0,renderTemplate:function(){return this.parent.currentModel.selectedTab="analytics",{outlet:"#abtesting_Preview",component:"crm-abtesting-analytics"}},actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}},afterRender:function(){this.lazyLoadSettings("abT_analytics","abtesting_Preview","crm-abtesting-analytics"),crmLayout.Resize.aBTestingPreviewCal(),commonUtils.showHideLoadingDiv(!1)}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting.preview-abtesting",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["abtesting-preview.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["abtesting-preview-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-abtesting-preview-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e.concat(t)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.parent.component.setData("selectedTab","preview"),this.checkPermission(e.queryParams.module,"abtesting",this.transition)},model:function(e){e.dynamicParam=this.parent.getDynamicParam();var t=this.getModuleObjByApiName(e.queryParams.module),r={abtesting:store.findRecord("abtesting",e.dynamicParam,{module:e.queryParams.module}),abtestingPreview:store.triggerAction("abtesting","preview",{id:e.dynamicParam},{module:e.queryParams.module},"GET"),module:t};return Lyte.resolvePromises(r)},afterModel:function(e){if(!e.abtesting)throw"INVALID_FORM_ID";e.abtesting=e.abtesting.$.toJSON(),$L.extend(e.abtesting.base_form,e.abtestingPreview.AB_testing[0].base_form);for(var t=e.abtesting.variant_form.length,r=[],s=0;s<t;s++)$L.extend(e.abtesting.variant_form[s],e.abtestingPreview.AB_testing[0].variant_form[s]),r.push({divShow:!1,tagShow:!0,modificationAvailable:!1});if(e.abtesting){e.analyticsdata=this.createABTestingStats(e.abtesting);var n=e.analyticsdata.length;for(s=0;s<n;s++){var i=e.analyticsdata[s];i.winner&&(e.winner=i.id),i.leading&&(e.leading=i.id)}}e.modifications=r},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#abtesting_Preview",component:"crm-abtesting-preview"}},afterRender:function(e){var t=renderingUtils.windowWidth-$(".setupleftmenutd").width();this.updateDatePickerScript(e.abtesting.base_form.source_code,"crm-abtesting-preview"),this.transition.data&&this.transition.data.action&&"preview"===this.transition.data.action&&Crm.client_tracking("WF AB Test - Preview Click",{module:e.module.module_name}),$L(".variantPrevListWrap").css("max-width",t),crmLayout.Resize.aBTestingPreviewCal(),commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting",{queryParams:["module","view"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-webform-abtesting-analytics-dependencies_new.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["view-abtesting.js","crm-abtesting-listpage-suggestions.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["view-abtesting-less.css","abtesting-preview-less.css","crm-abtesting-listpage-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-abtesting-preview-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"abtesting",this.transition)},model:function(e){var t=this.getModuleObjByApiName(e.queryParams.module),r={abtesting:store.findRecord("abtesting",e.dynamicParam,{module:e.queryParams.module}),module:t};return this.id!==this.getDynamicParam()&&(r.abtesting_analytics=this.getAllWebFormAbtestingDashboards(e.queryParams.module,this.getDynamicParam()),this.id=this.getDynamicParam()),Lyte.resolvePromises(r)},renderTemplate:function(){return $("#setupInnerLinks .tabClass").hide(),{outlet:"#result",component:"crm-abtesting-view"}},lyteConvertionSupported:!0,afterRender:function(){this.setPageHeaderWidth(".webF_formNameCtn",".webFormName",[".webF_modName",".webF_allFilterHolder"]),this.setTitleforEllipsis(".webFormName")},redirect:function(){if((this.transition.info.abtesting_analytics||this.transition.info.old_abtesting_analytics)&&(this.currentModel.selectedTab="analytics"),this.transition.info.abtesting_analytics)this.transitionTo("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",this.getDynamicParam(),this.currentModel.abtesting_analytics[0].id,this.getQueryParams());else if("crm.settings.section.abtesting.view-abtesting"===this.transition.target){var e=this.getQueryParams();if(e&&e.view&&"analytics"===e.view)delete e.view,this.transitionTo("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",this.getDynamicParam(),this.currentModel.abtesting_analytics[0].id,e);else{var t=Object.assign({},this.transition.info);t.route="crm.settings.section.abtesting.view-abtesting.preview-abtesting",this.replaceWith(t)}}},actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}}},{mixins:["webform","webform-analytics-util","abtesting"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting",{getDependencies:function(){return networkUtils.returnDependencyFiles(["webform-model.js","abtesting-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-modificationlist-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=e.concat(networkUtils.returnDependencyFiles(["abtesting-common-less.css","lyte-ui-multislider.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("webforms")],ResourceConstants.CRM).concat(e);t=(t=t.concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js","webform.js","abtesting.js","webform-modificationlist.js","crm-webform-abtesting-config.js","lyte-multislider.js","lyte-draggable.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_htmleditor1.js"],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM),s={parent:networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),child:[r,networkUtils.returnDependencyFiles(["zohocrm_webformAnalytics_chartRenderer.js"],ResourceConstants.CRM)]};if(Crm.isWebformsActionEnabled){t=t.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","lyte-draggable.js"],ResourceConstants.CRMClient));var n=networkUtils.returnDependencyFiles(["lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);t=t.concat(n)}return Crm.isZohoChartsEnabled?t=t.concat(networkUtils.returnDependencyFiles(["webform-zcharts-handler.js"],ResourceConstants.CRMClient)):(s.parent=s.parent.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),t=t.concat(networkUtils.returnDependencyFiles(["webform-highcharts-handler.js"],ResourceConstants.CRMClient))),t.concat(s)},redirect:function(){if("crm.settings.section.abtesting"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.abtesting.index-abtesting",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("webform"),store.unloadAll("abtesting"),Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less.css","webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"))}}}),Lyte.Router.registerRoute("crm.settings.section.accessibility",{queryParams:["viewType"],lyteConvertionSupported:!0,getDependencies:function(){},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-accessibility.js","lyte-step.js","lyte-video.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-keyboard-shortcuts.js","lyte-shortcut.js","crm-keyboard-shortcutsmixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("keyboardshortcuts"),networkUtils.getI18nJSUrl("accessibility")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-keyboard-shortcuts.css","crm-accessibility-preview.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){},model:function(e){if(Crm.userDetails.isAccessibilityConfigSupported)return e.queryParams.viewType?((t={}).selectedTab=e.queryParams.viewType,void 0===this.globalAccessibilityServices.getVariable("meta")?store.triggerAction("accessibility","fetch",void 0,{include:"accessibility_meta"}).then(function(e){return t.accessibilityData=this.globalAccessibilityServices.getVariable("accessibility"),t.keyboardShortcut=this.globalAccessibilityServices.getVariable("keyboardShortcut"),t.metaData=e.accessibility_meta,t}.bind(this)):(t.accessibilityData=this.globalAccessibilityServices.getVariable("accessibility"),t.keyboardShortcut=this.globalAccessibilityServices.getVariable("keyboardShortcut"),t)):void this.setQueryParams({viewType:"vision"});if(0!==store.peekAll("keyboard_shortcuts").length){var t,r=store.peekAll("keyboard_shortcuts");return(t={}).shortcuts=r,t.isShortcutsEnabled=Crm.userDetails.isKeyboardShortcutsEnabled,t}return Lyte.resolvePromises({shortcuts:store.findAll("keyboard_shortcuts")}).then((function(e){var t={};return t.shortcuts=e.shortcuts,t.isShortcutsEnabled=Crm.userDetails.isKeyboardShortcutsEnabled,t}))},afterModel:function(e){if(Crm.userDetails.isAccessibilityConfigSupported){var t;e.metaData?(this.globalAccessibilityServices.setVariable("meta",e.metaData),t=e.accessibilityData.accessibility_meta):t=this.globalAccessibilityServices.getVariable("meta");var r={};switch(e.accessibilityData.accessibility.vision.motion_control.animation_speed){case"default":r={default:!0,minimum:!1,system_settings:!1};break;case"minimum":r={default:!1,minimum:!0,system_settings:!1};break;case"system_settings":r={default:!1,minimum:!1,system_settings:!0}}this.currentModel.accessibilityMeta=t,this.currentModel.motionControl=r,this.currentModel.accessibilityObject=e.accessibilityData.accessibility,this.currentModel.keyboardShortcutEnable=e.keyboardShortcut,this.currentModel.accessibilityObjectOldValue=Lyte.deepCopyObject(e.accessibilityData.accessibility)}},renderTemplate:function(){return Crm.userDetails.isAccessibilityConfigSupported?{outlet:"#result",component:"crm-accessibility"}:{outlet:"#result",component:"crm-keyboard-shortcuts"}},afterRender:function(){Crm.userDetails.isAccessibilityConfigSupported||$L("#result").addClass("h100_per"),Crm.userDetails.isAccessibilityConfigSupported&&!this.globalAccessibilityServices.getVariable("standardNavigationOrder")&&$L("#accessibilitySearch").focus()},beforeExit:function(){Crm.userDetails.isAccessibilityConfigSupported||$L("#result").removeClass("h100_per")},actions:{willTransition:function(e){if(!Crm.userDetails.isAccessibilityConfigSupported){var t=$L("crm-keyboard-shortcuts")[0];(t?t.getData():{}).isEditMode&&(e.pause(),_cruxUtils.showCustomAlert({params:{ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure"},{type:"reject",text:I18n.getMsg("crm.button.stay.here"),appearance:"default"}],ltPropPrimaryMessage:I18n.getMsg("crm.savechanges.warn"),ltPropSecondaryMessage:I18n.getMsg("crm.event.layout.leavepage.confirm.message1")},accept:function(){e.resume()},reject:function(){e.abort()}}))}}}}),Lyte.Router.registerRoute("crm.settings.section.actions-flow-library",{getResources:function(){const e=networkUtils.returnDependencyFiles(["flow-actionlibrary-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("actionsbyzohoflow")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["flow-actionlibrary-helpers.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["flow-actionlibrary-actions-view.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["flow-actionlibrary-connections-view.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["flow-actionlibrary-credits-view.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["flow-actionlibrary-footer.js","flow-actionlibrary-navigator.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["flow-api-actionlibrary-styles.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient).concat(r).concat(e).concat(o).concat(a).concat(s).concat(n).concat(i).concat(t)},getDependencies:function(){const e=networkUtils.returnDependencyFiles(["flow-actionlibrary-api-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["flow-actionlibrary-custom-actions.js","flow-actionlibrary-connections.js","flow-actionlibrary-actions.js","flow-actionlibrary-applications.js","actionlibrary-credits.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){const{general:e,customActionAPI:t}=this.getAPI(),r={params:{},successCallback:e=>e||[],errorCallback:()=>[],directCallBackRequired:!0};return Lyte.resolvePromises({userProfile:store.findRecord("user",Crm.userDetails.USER_ID),modules:store.findAll("module"),featureModules:e.getFeatureSupportedModule("workflow"),actionConfigurations:t.getAll(r)})},afterModel:function({userProfile:e,modules:t,featureModules:r,actionConfigurations:s}){const n=[],i=r.modules,o=t.map((e=>i.findIndex((t=>t.id===e.id)))).filter((e=>e>=0)).map((e=>i[e]));o.forEach((e=>{const{singular_label:r,plural_label:s}=t.find((t=>t.id===e.id));n.push({id:e.id,api_name:e.api_name,singular_label:r,plural_label:s})})),this.currentModel.componentType="workflow",this.currentModel.userProfile=e[0],this.currentModel.modules=o,this.currentModel.modulesMap=n,this.currentModel.actionConfigurations=s},renderTemplate:function(){return{outlet:"#result",component:"crm-actions-flow-library-navigator"}},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||Crm.userDetails.hasPrivateModuleAdminPermission||(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings")})),this.transition.abort())},lyteConvertionSupported:!0},{mixins:["crm-actions-flow-library-api-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.alerts.create-alert",{lyteConvertionSupported:!0,getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getCreateEditDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getCreateEditResources()},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"email_notifications"})},model:function(){return this.fetchInitialDataForAlertCreate(void 0,void 0,!0)},afterModel:function(e){if(e.isError)this.transition.abort();else{var t=this.processDataForAlertCreate(e);this.currentModel=t,store.unloadAll("territory"),Lyte.registeredMixins["crm-automation-actions"].actionTab="CreateView"}},renderTemplate:function(){return{outlet:"#result",component:"crm-alert-action"}},beforeExit:function(){commonUtils.showHideLoadingDiv(!0),store.clearCachedQuery("module",{feature_name:"email_notifications"}),this.addressDetails={},wfmergefield.clearMergeFieldDetl()}},{mixins:["crm-alert","crm-automation-actions","workflow-actions"]}),Lyte.Router.registerRoute("crm.settings.section.alerts.edit-alert",{lyteConvertionSupported:!0,getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getCreateEditDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getCreateEditResources()},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){var e=this.getDynamicParam();return Lyte.registeredMixins["crm-automation-actions"].actionTab="EditView",this.fetchInitialDataForAlertEdit(e,!0)},afterModel:function(e){e.isError?this.transition.abort():e.actionData&&Object.keys(e.actionData).length>0?(e.isCreate=!1,this.currentModel=e,Lyte.registeredMixins["crm-automation-actions"].actionTab="EditView",store.unloadAll("territory"),commonUtils.showHideLoadingDiv(!1)):(this.transition.abort(),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.workflow.actions.listing.Alert")),ltPropType:"error"}}),Lyte.Router.transitionTo({route:"crm.settings.section.alerts.index-alert"}))},renderTemplate:function(){return{outlet:"#result",component:"crm-alert-action"}},beforeExit:function(){Lyte.registeredMixins["crm-automation-actions"].actionTab=void 0,wfmergefield.clearMergeFieldDetl(),$L("#result")[0].classList.remove("h100_per"),$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["email-notification-utils","crm-alert","crm-automation-actions","workflow-actions","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.alerts.index-alert",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-lazyLoad.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-alert-view-recipients.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"email_notifications"})},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getListiewQueryParams(this.transition.data);return this.fetchInitialDataForAlertListView(e,!0)},afterModel:function(e){var t=this.filterModulesList(e.modulesList,"email_notifications");if(!t||!t.length)return this.transition.abort(),this.handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0);if(e.isError)this.transition.abort();else{wfmergefield.actionName="email_notification";var r={},s=this.transition.data||{};if(r=this.postProcessAlertData(s.module,e,{}),this.transition.data&&(r.showDeleteButton=void 0!==s.showDeleteButton&&s.showDeleteButton,r.selectedActionCount=void 0===s.selectedActionsCount?0:s.selectedActionsCount),r.selectedTab=s.selectedTab,r.featureType=s.feature_type||"actions",s.module&&s.module!==this.allKey){var n=s.module;r.moduleApiName=moduleRecordMapping[n].api_name}r.headers=[{id:"name",displayName:I18n.getMsg("Name"),mappingKey:"name",colWidth:"w25_per"},{id:"recipientCount",displayName:I18n.getMsg("crm.workflow.alert.noOfRecipients"),mappingKey:"recipient_count",onclick:"renderRecpModal",colWidth:"w12_per"},{id:"module",colWidth:"w25_per"},{id:"emailTemplate",displayName:I18n.getMsg("crm.workflow.alert.emailTemplate"),mappingKey:"templateName",onmouseenter:"showFromReplyTo",onclick:"openTemplate",colWidth:"w20_per"},{id:"modifiedOn",displayName:I18n.getMsg("Modified On"),mappingKey:"modified_date_display_value",colWidth:"w20_per"}],Object.assign(r,this.getAlertDefinitionDetails()),r.tabType=s.tabType||"action_listView",this.currentModel=r,Lyte.registeredMixins["crm-automation-actions"].actionTab="ListView"}},actions:{renderRecpModal:function(e){var t,r=e.id,s=this.getAutomationModelName("email_notifications");commonUtils.showHideLoadingDiv(!0),e.related_module&&null!==e.related_module&&(t=this.fetchModuleName(void 0,e.related_module.id)),store.findRecord(s,r).then(function(e){if(!e.id)return this.handleErrorResponses(JSON.stringify({code:"ACTION_NOT_FOUND"}),!0,"email_notifications");wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(store.peekAll("module").filterBy({api_name:e.module.api_name})[0].module_name,t,function(){this.constructModalViewData(e,r)}.bind(this)),commonUtils.showHideLoadingDiv(!1)}.bind(this),function(e){return this.handleErrorResponses(e.response,!0)}.bind(this))},createAction:function(){Lyte.Router.transitionTo({route:"crm.settings.section.alerts.create-alert"})},linkToViewPage:function(e,t){this.linkToViewPage("email_notifications",e,t)}},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#result",component:"list-automationactions",reRender:!0}},afterRender:function(){},beforeExit:function(){this.removeActionsTableObserer(),wfmergefield.clearMergeFieldDetl()}},{mixins:["crm-automation-actions","crm-alert","email-notification-utils"],services:["actionEmail"]}),Lyte.Router.registerRoute("crm.settings.section.alerts.usage-workflow-alert",{queryParams:["action_name","more_info"],getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getActionUsageDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.alerts").getActionUsageResources()},model:function(e){return e.queryParams.more_info?this.fetchPieChartData("email_notifications"):this.fetchUsageLineChartData("crm-alert")},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};e.actionApiName="email_notifications",e.filterType="email_notifications",this.getQueryParams().more_info||(this.usageData=e,t.usageData=e,Object.assign(t,this.getAlertDefinitionDetails()),t.tabType="action_usage",this.currentModel=t)}},renderTemplate:function(){return{outlet:"#result",component:this.getQueryParams().more_info?"crm-actions-usage-chart":"list-automationactions",reRender:!0}}},{mixins:["crm-wfactions-usage-mixin","crm-automation-actions","crm-alert"]}),Lyte.Router.registerRoute("crm.settings.section.alerts.view-alert",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-view-alert.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-view-recipients.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam();return store.findRecord(this.getAutomationModelName("email_notifications"),e).then(function(e){return e.id?(this.setMergeFieldModules(e),Lyte.resolvePromises({actionData:e,mergeFieldInfo:wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(this.automation.mergefieldModule,this.automation.mergefieldRelModule)})):{actionData:{}}}.bind(this),function(e){return this.handleErrorResponses(e.response,!0)}.bind(this))},afterModel:function(e){e.isError?this.transition.abort():e.actionData&&Object.keys(e.actionData).length>0?(Lyte.registeredMixins["crm-automation-actions"].actionTab="DetailView",e.deleteRestrictionMsg=e.editRestrictionMsg=this.isEditDeleteActionPermissionAvail(e.actionData,this.actionType,"edit")?void 0:this.getEditDeleteRestrictionMsg(e.actionData,this.actionType),this.currentModel=e):(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.workflow.actions.listing.Alert")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.alerts.index-alert"})),commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(){return{outlet:"#result",component:"crm-view-alert"}},beforeExit:function(){wfmergefield.clearMergeFieldDetl()}},{mixins:["crm-alert","crm-automation-actions","workflow-actions","email-notification-utils","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.alerts",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["store_alert.js"],ResourceConstants.CRMClient)},getResources:function(){var e=["zohocrm_wflyte_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("workflowalert"),networkUtils.includeChartFiles()[0]],t=networkUtils.returnDependencyFiles(["alert.css","automation-common.css","crm-alert-recipients-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return{parent:t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("workflowalert")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["alert.js","crm-automation-actions.js","action-common-mixin.js","crm-rule-association.js","crm-related-rules.js","automation/common/crm-automation-actions-helper.js","crm-automation-help-link.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-userassociations-datastore.js"],ResourceConstants.CRMClient)),child:networkUtils.returnDependencyFiles(["email_service.js"],ResourceConstants.CRMClient)}},redirect:function(){if("crm.settings.section.alerts"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.alerts.index-alert",this.replaceWith(e)}},actions:{willTransition:function(){closeAsapWidget()}},getCreateEditDependencies:function(){return networkUtils.returnDependencyFiles(["crm-organization-email-model.js"],ResourceConstants.CRMClient)},getCreateEditResources:function(){var e=networkUtils.returnDependencyFiles(["crm-alert-action.js","crux-lazyLoad.js","crm-territory-common-utils.js","crux-combo-box.js","crux-tag.js","crm-combo-box-dropdown.js","crm-email-auth-util.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-combo-box-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getActionUsageDependencies:function(){return networkUtils.returnDependencyFiles(["automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient)},getActionUsageResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("workflowalert"),networkUtils.getI18nJSUrl("ActionsUsage")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["actions-usage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=e.concat(t)},beforeExit:function(){store.unloadAll("email_notification"),this.usageData={},store.clearCachedQuery("module",{feature_name:"email_notifications"}),wfmergefield.clearMergeFieldDetl()}},{mixins:["crm-alert"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-deluge.index-deluge",{queryParams:["module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["store_deluge.js"],ResourceConstants.CRMClient)},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=e.queryParams.module&&"All"!==e.queryParams.module?{module:moduleRecordMapping[e.queryParams.module].api_name}:{};return t.per_page=200,t.page=1,Lyte.registeredMixins["crm-deluge"].clearFunctionMixinData(),this.fetchInitialDataForDelugetListView(t,!0)},afterModel:function(e,t){var r=Lyte.registeredMixins["crm-automation-actions"].filterModulesList(e.modulesList,"functions");if(!r||!r.length)return this.transition.abort(),Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0);if(e.isError)this.transition.abort();else{var s={};s=this.postProcessDelugeData(t.queryParams.module,e,s);var n=this.transition.data||{};if(n.module&&n.module!==this.allKey){var i=n.module;s.moduleApiName=moduleRecordMapping[i].api_name}this.transition.data&&(s.showDeleteButton=void 0!==this.transition.data.showDeleteButton&&this.transition.data.showDeleteButton,s.selectedActionsCount=void 0===this.transition.data.selectedActionsCount?0:this.transition.data.selectedActionsCount),s.headers=[{id:"name",displayName:I18n.getMsg("Name"),mappingKey:"name",colWidth:"w20_per"},{id:"module",colWidth:"w20_per"},{id:"description",displayName:I18n.getMsg("crm.label.description"),mappingKey:"description",colWidth:"w20_per"},{id:"language",displayName:I18n.getMsg("crm.label.consent.language"),mappingKey:"languageLabel",colWidth:"w20_per"},{id:"modifiedOn",displayName:I18n.getMsg("Modified On"),mappingKey:"modified_date_display_value",colWidth:"w20_per"}],Object.assign(s,this.getFunctionDefDetails()),this.currentModel=s,commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return{outlet:"#result",component:"list-automationactions",reRender:!0}},afterRender:function(){if(customFunctionsObj.category=customFunctionsObj.isFrom="automation",customFunctionsObj.updatedActionId){var e="row_"+customFunctionsObj.updatedActionId;this.highlightSavedAction(e),customFunctionsObj.updatedActionId=void 0,setTimeout((function(){$L("#"+e).removeClass("lastActiveRowLyte")}),1e4)}wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("Deluge"),ZohoDRE.resetRequestData(),this.resizeActionsTable()},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),this.removeActionsTableObserer(),store.clearCachedQuery("module",{feature_name:"functions"})},actions:{createAction:function(){Lyte.registeredMixins["crm-automation-actions"].removeActionModal(),this.renderActionComponent({step:"create",renderElementId:"#functions_listView"},{})},linkToViewPage:function(e){Lyte.registeredMixins["crm-automation-actions"].removeActionModal(),this.viewCustomFunction(e)},willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}},{mixins:["crm-automation-actions","crm-deluge"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-deluge.index-function-failure",{getResources:function(){return networkUtils.returnDependencyFiles(["automation/actions/wfaciton-failure-listview.js","automation/actions/convertaction_helper.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient)},model:function(){return Object.keys(Lyte.registeredMixins["crm-deluge"].failureData).length>0?Lyte.registeredMixins["crm-deluge"].failureData:Lyte.resolvePromises({action_failures:store.findAll("dummy",{page:1,per_page:50},!1,!1,{url:"/crm/v8/settings/automation/function_failures",method:"GET"}),modules:store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/automation/"+this.actionType+"/actions/associated_modules",method:"GET"})}).catch(function(e){return Lyte.registeredMixins["crm-automation-actions"].handleActionsError(e,this.actionType),{isError:!0}}.bind(this))},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};Lyte.registeredMixins["crm-deluge"].failureData=e,Object.assign(t,this.getFunctionDefDetails()),t.tabType="action_failures",t.failureData=e,this.currentModel=t}},renderTemplate:function(){return{outlet:"#result",component:"list-automationactions"}},afterRender:function(){"object"==typeof customFunctionsObj&&(customFunctionsObj.category=customFunctionsObj.isFrom="automation"),wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("Deluge"),ZohoDRE.resetRequestData(),this.resizeChart()}},{mixins:["crm-deluge","crm-automation-actions"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-deluge.usage-workflow-function",{queryParams:["action_name","more_info"],getDependencies:function(){return networkUtils.returnDependencyFiles(["automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("ActionsUsage")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["actions-usage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=e.concat(t)},model:function(e){return e.queryParams.more_info?this.fetchPieChartData("functions"):this.fetchUsageLineChartData("crm-deluge")},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};e.actionApiName="functions",e.filterType="functions",this.getQueryParams().more_info||(this.usageData=e,t.usageData=e,Object.assign(t,this.getFunctionDefDetails()),t.tabType="action_usage",this.currentModel=t)}},renderTemplate:function(){return{outlet:"#result",component:this.getQueryParams().more_info?"crm-actions-usage-chart":"list-automationactions"}}},{mixins:["crm-wfactions-usage-mixin","crm-deluge"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-deluge",{queryParams:["module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["store_deluge.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["action-common-mixin.js","crm-automation-actions.js","deluge.js","crm-rule-association.js","crm-related-rules.js","automation/common/crm-automation-actions-helper.js","crm-automation-help-link.js","crux-lazyLoad.js"],ResourceConstants.CRMClient);e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("actionfailures"),networkUtils.getI18nJSUrl("V1Deprecation"),networkUtils.getI18nJSUrl("workflow"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["automation/actions/wfaciton-failure-listview.js","automation/actions/convertaction_helper.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["deluge.css","automation-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["actions-usage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js",networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["zohocrm_wflyte_workflow.js","zohocrm_automationactions_usage.js"],ResourceConstants.CRM),s=fetchAutomationFunctionFiles();return r.concat(s).concat(e).concat(t)},redirect:function(){if("crm.settings.section.workflow-deluge"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-deluge.index-deluge",this.replaceWith(e)}},actions:{willTransition:function(){closeAsapWidget()}},beforeExit:function(){store.unloadAll("functions"),Lyte.registeredMixins["crm-deluge"].usageData={},store.clearCachedQuery("module",{feature_name:"functions"}),wfmergefield.clearMergeFieldDetl()}}),Lyte.Router.registerRoute("crm.settings.section.field-updates.create-field-update",{getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.field-updates").getCreateEditResources()},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"field_updates"})},model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("module",{feature_name:"field_updates"},!0,!1).then(function(e){var t=this.filterActionSupportedModules(e.module.filter((e=>e.visible)))[0].module_name;return store.findAll("layout",{module:moduleRecordMapping[t].api_name},!0,!0,{apiVersion:"2.2",set_available_user_layout:!0}).then(function(){return Lyte.resolvePromises({modulesList:e.module,fields:store.findAll("field",{module:moduleRecordMapping[t].api_name,type:"all",feature_name:"fieldupdate",component:"fieldupdate"},!1,!0,{apiVersion:"2.2"}),layoutRules:this.getLayoutRules(moduleRecordMapping[t].api_name)}).then(function(e){return this.getValidationRules(e,moduleRecordMapping[t].api_name)}.bind(this),function(e){return Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(e.response,!0)}.bind(this))}.bind(this))}.bind(this))},afterModel:function(e){var t={};t.fields=this.checkMandatory(e.fields),t.layoutRules=e.layoutRules,t.step="create",t.validationRules=e.validationRules,t.modulesList=Lyte.registeredMixins["crm-automation-actions"].filterModulesList(e.modulesList,"field_updates"),t.module=t.modulesList[0].module_name,this.currentModel=t,commonUtils.showHideLoadingDiv(!1)},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-fieldupdate-action"}},beforeExit:function(){$L("#result")[0].classList.remove("h100_per"),$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["crm-automation-actions","crm-fieldupdate"]}),Lyte.Router.registerRoute("crm.settings.section.field-updates.edit-field-update",{getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.field-updates").getCreateEditResources()},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam();return Lyte.registeredMixins["crm-automation-actions"].actionTab="EditView",this.getDataForFieldUpdateEdit({id:e,featureType:"fieldupdate"},!0)},afterModel:function(e){e.isError?this.transition.abort():e.actionDetails&&Object.keys(e.actionDetails).length>0?(this.currentModel=this.populateDataOnFieldupdateEdit(e),commonUtils.showHideLoadingDiv(!1)):(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.workflow.rule.update.singular")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.field-updates.index-field-update"}))},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-fieldupdate-action"}},beforeExit:function(){Lyte.registeredMixins["crm-automation-actions"].actionTab=void 0}},{mixins:["crm-automation-actions","crm-fieldupdate"]}),Lyte.Router.registerRoute("crm.settings.section.field-updates.index-field-update",{beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"field_updates"})},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getListiewQueryParams(this.transition.data);return e.include_inner_details="related_module.module_name,related_module.plural_label,related_module.singular_label,display_value,field.field_label,field.enable_colour_code,field.pick_list_values.colour_code,field.data_type",e.page=1,e.per_page=200,Lyte.resolvePromises({modulesList:store.findAll("module",{feature_name:"field_updates"},!0,!1),fieldupdates:store.findAll("field_update",e)}).then(null,function(e){return Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(e.response,!0)}.bind(this))},afterModel:function(e){var t=Lyte.registeredMixins["crm-automation-actions"].filterModulesList(e.modulesList,"field_updates");if(!t||!t.length)return this.transition.abort(),Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0);if(e.isError)this.transition.abort();else{var r={},s="",n=this.transition.data;n.module&&n.module!==this.allKey&&(s=n.module,r.moduleApiName=moduleRecordMapping[s].api_name),r.module=n.module||this.allKey,r.modifiedOnSortOrder=n.sortOrder||"desc",this.listViewFilter.selectedModule=r.module,this.listViewFilter.selectedmodifiedOn=r.modifiedOnSortOrder,r.modulesList=t,this.transition.data&&(r.showDeleteButton=this.transition.data.showDeleteButton||!1,r.selectedActionsCount=this.transition.data.selectedActionsCount||0),this.postProcessGetAllFieldUpdateData(s,e,r),this.setElementDetails(r,this),r.headers=[{id:"name",displayName:I18n.getMsg("Name"),mappingKey:"name",colWidth:"w20_per"},{id:"module",colWidth:"w15_per"},{id:"field",displayName:I18n.getMsg("crm.workflow.field.to.update.name"),mappingKey:"field_label",colWidth:"w25_per"},{id:"fieldValue",displayName:I18n.getMsg("crm.workflow.new.field.value.to.update"),mappingKey:"field_value",colWidth:"w20_per"},{id:"modifiedOn",mappingKey:"modified_date_display_value",colWidth:"w20_per"}],r.actionType="field_updates",r.actionHeading=I18n.getMsg("crm.label.field_updates"),r.description=I18n.getMsg("crm.field.updates.definition"),r.actionNameForCount=I18n.getMsg("crm.label.field_updates.plural"),r.createButton=I18n.getMsg("crm.actions.create.fieldupdate"),this.currentModel=r,commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return{outlet:"#result",component:"list-automationactions",reRender:!0}},afterRender:function(){this.resizeActionsTable()},actions:{createAction:function(){Lyte.Router.transitionTo({route:"crm.settings.section.field-updates.create-field-update"})},linkToViewPage:function(e,t){Lyte.registeredMixins["crm-automation-actions"].linkToViewPage("field_updates",e,t)}},beforeExit:function(){this.removeActionsTableObserer(),store.clearCachedQuery("module",{feature_name:"field_updates"})},lyteConvertionSupported:!0},{mixins:["crm-automation-actions","crm-fieldupdate"]}),Lyte.Router.registerRoute("crm.settings.section.field-updates.view-field-update",{getResources:function(){return networkUtils.returnDependencyFiles(["worklowactionmodal.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam();return this.getDataForFieldUpdateView({id:e,featureType:"fieldupdate"})},afterModel:function(e){if(e.isError)this.transition.abort();else if(e.actionDetails&&Object.keys(e.actionDetails).length>0){var t={};if(t.actionDetails=e.actionDetails,t.step="view",t.fieldDetails=store.peekRecord("field",t.actionDetails.field.id),t.fieldDetails||(t.fieldDetails=store.findRecord("field",t.actionDetails.field.id,{module:t.actionDetails.module.api_name,skip_field_permission:!0})),t.actionDetails.field.data_type=t.fieldDetails.data_type,t.element=this.getElementType(t.fieldDetails),t.module=Utils.inverseKeyValues(moduleApiMapping)[t.actionDetails.module.api_name],"multiuserlookup"!==t.fieldDetails.data_type&&"multiselectpicklist"!==t.fieldDetails.data_type||(t.elementType="multiple"),"number"===t.element&&(t.fieldDetails.separator=!0),"picklist"===t.fieldDetails.data_type&&t.actionDetails.value){var r=this.getPickLists(t.fieldDetails,t.module).find((e=>e.actual_value===t.actionDetails.value));t.actionDetails.value=r?r.display_value:t.actionDetails.value}t.actionDetails.fieldValue=t.actionDetails.value,t.isReadOnlyAction=this.isReadOnlyAction(t.actionDetails,"Fieldupdate"),t.deleteRestrictionMsg=t.editRestrictionMsg=this.isEditDeleteActionPermissionAvail(t.actionDetails,this.actionType,"edit")&&this.isActionEditable(t.actionDetails)?void 0:this.getEditDeleteRestrictionMsg(t.actionDetails,this.actionType),t.lockMsg=I18n.getMsg("crm.workflow.rule.locked",Lyte.Component.registeredHelpers.getI18nActionName("Fieldupdate")),this.constructRelatedFields(t),this.currentModel=t,commonUtils.showHideLoadingDiv(!1)}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.workflow.rule.update.singular")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.field-updates.index-field-update"})},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-view-fieldupdate"}},constructRelatedFields:function(e){var t=[],r=this;8===e.fieldDetails.ui_type&&null!==e.actionDetails.related_records?t.push({key:I18n.getMsg("crm.workflow.Ownerfield.relatedRecords"),value:e.actionDetails.related_records.map((function(e){return store.peekAll("module").filter((t=>t.api_name===e.api_name))[0].plural_label})).join(", ")}):"multiple"===e.elementType?t.push({key:I18n.getMsg("crm.workflow.field.to.update.Action"),value:I18n.getMsg("crm.import.duplicates."+e.actionDetails.update_type)}):null!==e.actionDetails.dependent_fields&&e.actionDetails.dependent_fields.forEach((function(e){t.push(r.getDependencyData(e)),null!==e.dependent_fields&&e.dependent_fields&&e.dependent_fields.forEach((function(e){t.push(r.getDependencyData(e))}))})),e.relatedFields=t},getDependencyData:function(e){var t=store.peekRecord("field",e.field.id),r=t.pick_list_values.find((t=>t.actual_value===e.value));return{key:I18n.getMsg(e.field.api_name),value:r?r.display_value:e.value,picklistValues:r,element:"picklist",enable_colour_code:t.enable_colour_code,fieldDetails:t}}},{mixins:["crm-automation-actions","crm-fieldupdate"]}),Lyte.Router.registerRoute("crm.settings.section.field-updates",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["store_fieldupdate.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["fieldupdate.js","crm-automation-actions.js","crm-wf-dependencyfields.js","crm-relatedrecords-dropdown.js","action-common-mixin.js","crm-rule-association.js","crm-related-rules.js","automation/common/crm-automation-actions-helper.js","crm-automation-help-link.js","crux-lazyLoad.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("Fieldupdate")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["fieldupdate.css","automation-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["zohocrm_wflyte_workflow.js",networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))},redirect:function(){if("crm.settings.section.field-updates"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.field-updates.index-field-update",this.replaceWith(e)}},actions:{willTransition:function(){closeAsapWidget()}},getCreateEditResources:function(){return networkUtils.returnDependencyFiles(["worklowactionmodal.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}}),Lyte.Router.registerRoute("crm.settings.section.tasks.create-task",{queryParams:["module"],beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"tasks"})},model:function(){return this.fetchInitialDataForTaskCreate(void 0,!0)},afterModel:function(e,t){e.isError?this.transition.abort():(this.module=t.queryParams.module,commonUtils.showHideLoadingDiv(!1))},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-task-action"}},beforeExit:function(){commonUtils.showHideLoadingDiv(!0),store.clearCachedQuery("module",{feature_name:"tasks"});var e=$L("#result")[0];e&&e.classList&&e.classList.remove("h100_per"),$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["crm-automation-actions","crm-tasks"]}),Lyte.Router.registerRoute("crm.settings.section.tasks.edit-task",{lyteConvertionSupported:!0,beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){return commonUtils.showHideLoadingDiv(!0),Lyte.registeredMixins["crm-automation-actions"].actionTab="EditView",this.fetchInitialDataForTaskEdit(this.getDynamicParam(),!0)},afterModel:function(e){e.isError?this.transition.abort():e.actionDetails&&Object.keys(e.actionDetails).length>0?(this.currentModel=this.populateDataOnTaskEdit(e),commonUtils.showHideLoadingDiv(!1)):(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("Task")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.tasks.index-task"}))},renderTemplate:function(){return{outlet:"#result",component:"crm-task-action"}},beforeExit:function(){$L("#result")[0].classList.remove("h100_per"),Lyte.registeredMixins["crm-automation-actions"].actionTab=void 0,$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["crm-automation-actions","crm-tasks"]}),Lyte.Router.registerRoute("crm.settings.section.tasks.index-task",{getResources:function(){return networkUtils.returnDependencyFiles(["crux-lazyLoad.js"],ResourceConstants.CRMClient)},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){var e=this.getListiewQueryParams(this.transition.data);return e.page=1,e.per_page=200,this.fetchInitialDataForTaskListView(e,!0)},afterModel:function(e){var t=Lyte.registeredMixins["crm-automation-actions"].filterModulesList(e.modulesList,"tasks");if(!t||!t.length)return this.transition.abort(),Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0);if(e.isError)this.transition.abort();else{"Permission denied"===e.Status&&(e.permissionDenied=!0,crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied());var r=this.transition.data,s={},n=t;if(n=this.addAllmodulestoList(n),s.modulesList=n,r.module&&r.module!==this.allKey){var i=r.module;s.moduleApiName=moduleRecordMapping[i].api_name}s.module=r.module||"All",s.modifiedOnSortOrder=r.sortOrder||"desc",this.postProcessGetAllTaskData(r.module,e,s),this.transition.data&&(s.showDeleteButton=void 0!==this.transition.data.showDeleteButton&&this.transition.data.showDeleteButton,s.selectedActionsCount=void 0===this.transition.data.selectedActionsCount?0:this.transition.data.selectedActionsCount),s.headers=[{id:"name",displayName:I18n.getMsg("crm.tasks.subject"),mappingKey:"name",colWidth:"w20_per"},{id:"module",colWidth:"w20_per"},{id:"dueDate",displayName:I18n.getMsg("crm.tasks.duedate"),mappingKey:"due_date",colWidth:"w15_per"},{id:"priority",displayName:I18n.getMsg("crm.tasks.priority"),mappingKey:"priority",colWidth:"w10_per"},{id:"status",displayName:I18n.getMsg("crm.tasks.status"),mappingKey:"taskStatus",colWidth:"w10_per"},{id:"assignTo",displayName:I18n.getMsg("crm.tasks.assignedto"),mappingKey:"assignToName",colWidth:"w10_per"},{id:"modifiedOn",displayName:I18n.getMsg("Modified On"),mappingKey:"modified_date_display_value",colWidth:"w15_per"}],s.actionType="tasks",s.actionHeading=I18n.getMsg("crm.workflow.label.tasks"),s.description=I18n.getMsg("crm.tasks.definition"),s.actionNameForCount=I18n.getMsg("workflow.actions.tasks"),s.createButton=I18n.getMsg("crm.workflow.create.new.task"),this.currentModel=s}Crm.trackSpotLightAction("Workflow Task - Page Visited")},afterRender:function(){this.resizeActionsTable()},actions:{createAction:function(){Lyte.Router.transitionTo({route:"crm.settings.section.tasks.create-task"})},linkToViewPage:function(e,t){Lyte.registeredMixins["crm-automation-actions"].linkToViewPage("tasks",e,t)}},beforeExit:function(){this.removeActionsTableObserer()},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"list-automationactions",reRender:!0}}},{mixins:["crm-automation-actions","crm-tasks"]}),Lyte.Router.registerRoute("crm.settings.section.tasks.view-task",{getResources:function(){return networkUtils.returnDependencyFiles(["crux-lazyLoad.js"],ResourceConstants.CRMClient)},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){return commonUtils.showHideLoadingDiv(!0),this.fetchInitialDataForTaskEdit(this.getDynamicParam(),!0)},afterModel:function(e){e.isViewOnly=!0,this.currentModel=this.populateDataOnTaskEdit(e),this.transition.data.filterModule&&(this.currentModel.filterParams={module:this.transition.data.filterModule}),commonUtils.showHideLoadingDiv(!1)},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-view-tasks"}}},{mixins:["crm-automation-actions","crm-tasks"]}),Lyte.Router.registerRoute("crm.settings.section.tasks",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["store_task.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userassociations-datastore.js","task.js","crm-automation-actions.js","automation/actions/convertaction_helper.js","action-common-mixin.js","crm-rule-association.js","crm-related-rules.js","automation/common/crm-automation-actions-helper.js","crm-automation-help-link.js","automation/actions/datecomponent.js","automation/actions/recordaction_common.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("workflow")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["task.css","automation-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=e.concat(t);var r=networkUtils.returnDependencyFiles(["zohocrm_wflyte_workflow.js",networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM);return r=r.concat(networkUtils.returnDependencyFiles(["crm-userassociations-datastore.js"],ResourceConstants.CRMClient)),e=e.concat(r)},redirect:function(){if("crm.settings.section.tasks"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.tasks.index-task",this.replaceWith(e)}},afterRender:function(){wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("tasks")},beforeExit:function(){wfmergefield.clearMergeFieldDetl();var e=$L("#taskTable .newSelect").find("select");e.length>0&&(thirdPartyUtils.unbindSelect2(e),thirdPartyUtils.unbindChildPerfectScroll(e))},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.settings.section.webhooks.create-webhook",{lyteConvertionSupported:!0,beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),Crm.userDetails.IS_ADMIN||Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||!this.isReadOnlyTeamModuleAction("webhooks")||(this.handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0),this.transition.abort()),store.clearCachedQuery("module",{feature_name:"webhooks"})},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=e.queryParams.module;return this.fetchInitialDataForWebhookCreate(t,!0)},afterModel:function(e){if(e.isError)this.transition.abort();else{wfmergefield.actionName="webhooks";var t=this.processDataForWebhookCreate(e);t.connectionsList=[],e.connections&&e.connections.crm_connectors&&e.connections.crm_connectors.connection_list&&e.connections.crm_connectors.connection_list.connections&&e.connections.crm_connectors.connection_list.connections.length>0&&(t.connectionsList=e.connections.crm_connectors.connection_list.connections.filter((e=>!e.displayName.includes("internal_")&&e.isConnected))),this.currentModel=t,commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return{outlet:"#result",component:"crm-webhook-action"}},beforeExit:function(){store.clearCachedQuery("module",{feature_name:"webhooks"}),$L("#result")[0].classList.remove("h100_per"),$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["crm-automation-actions","crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks.edit-webhook",{lyteConvertionSupported:!0,beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){return commonUtils.showHideLoadingDiv(!0),Lyte.registeredMixins["crm-automation-actions"].actionTab="EditView",this.fetchInitialDataForWebhookEdit(this.getDynamicParam(),!0)},afterModel:function(e){e.isError?this.transition.abort():e.actionData&&Object.keys(e.actionData).length>0?(wfmergefield.actionName="webhooks",e.isCreate=!1,e.connectionsList=[],e.connections&&e.connections.crm_connectors&&e.connections.crm_connectors.connection_list&&e.connections.crm_connectors.connection_list.connections&&e.connections.crm_connectors.connection_list.connections.length>0&&(e.connectionsList=e.connections.crm_connectors.connection_list.connections.filter((e=>!e.displayName.includes("internal_")&&e.isConnected))),this.currentModel=e,commonUtils.showHideLoadingDiv(!1)):(_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("workflow.label.singular.webHook"))}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.webhooks.index-webhook"}))},renderTemplate:function(){return{outlet:"#result",component:"crm-webhook-action"}},beforeExit:function(){Lyte.registeredMixins["crm-automation-actions"].actionTab=void 0,$L("#result")[0].classList.remove("h100_per"),$L("#setup_new_ContentDiv")[0].classList.remove("oHImp")}},{mixins:["crm-automation-actions","crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks.index-webhook-failure",{getResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-failure-listview.js","automation/actions/convertaction_helper.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("actionfailures")],ResourceConstants.CRM))},model:function(){return Object.keys(Lyte.registeredMixins["crm-webhook"].failureData).length>0?Lyte.registeredMixins["crm-webhook"].failureData:Lyte.resolvePromises({action_failures:store.findAll("dummy",{page:1,per_page:50},!1,!1,{url:"/crm/v8/settings/automation/webhook_failures",method:"GET"}),modules:store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/automation/"+this.actionType+"/actions/associated_modules",method:"GET"})}).catch(function(e){return this.handleActionsError(e,this.actionType),{isError:!0}}.bind(this))},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};Lyte.registeredMixins["crm-webhook"].failureData=e,Object.assign(t,this.getWebhookDefDetails()),t.tabType="action_failures",t.failureData=e,this.currentModel=t}},renderTemplate:function(){return{outlet:"#result",component:"list-automationactions"}},afterRender:function(){this.resizeChart()}},{mixins:["crm-webhook","crm-automation-actions"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks.index-webhook",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js","automation/actions/datecomponent.js","crux-lazyLoad.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("workflow"),networkUtils.getI18nJSUrl("Webhook"),networkUtils.getI18nJSUrl("actionfailures")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["webhook.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["actions-usage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort(),store.clearCachedQuery("module",{feature_name:"webhooks"})},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getListiewQueryParams(this.transition.data);return this.fetchInitialDataForWebhookListView(e,!0)},afterModel:function(e){var t=this.filterModulesList(e.modulesList,"webhooks");if(!t||!t.length)return this.transition.abort(),this.handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!0);if(e.isError)this.transition.abort();else{var r={},s=this.transition.data;if(s.module&&s.module!==this.allKey){var n=s.module;r.moduleApiName=moduleRecordMapping[n].api_name}s.feature_type||(r.featureType="actions"),r=this.postProcessWebhooktData(s.module,e,r),this.transition.data&&(r.showDeleteButton=void 0!==s.showDeleteButton&&s.showDeleteButton,r.selectedActionsCount=void 0===s.selectedActionsCount?0:s.selectedActionsCount),r.selectedTab=this.transition.data.selectedTab,r.headers=[{id:"name",displayName:I18n.getMsg("Name"),mappingKey:"name",colWidth:"w25_per"},{id:"module",colWidth:"w25_per"},{id:"url",displayName:I18n.getMsg("crm.workflow.hook.url"),mappingKey:"display_url",colWidth:"w25_per"},{id:"modifiedOn",displayName:I18n.getMsg("Modified On"),mappingKey:"modified_date_display_value",colWidth:"w25_per"}],Object.assign(r,this.getWebhookDefDetails()),this.currentModel=r,commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return{outlet:"#result",component:"list-automationactions",reRender:!0}},afterRender:function(){this.resizeActionsTable()},actions:{createAction:function(){Lyte.Router.transitionTo({route:"crm.settings.section.webhooks.create-webhook"})},linkToViewPage:function(e,t){this.linkToViewPage("webhooks",e,t)}},beforeExit:function(){this.removeActionsTableObserer()}},{mixins:["crm-automation-actions","crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks.usage-workflow-webhook",{queryParams:["action_name","more_info"],getDependencies:function(){return networkUtils.returnDependencyFiles(["automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["automation/actions/wfaciton-usage-listview.js","automation/actions/crm-wfactions-usage-mixin.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("WebHook"),networkUtils.getI18nJSUrl("ActionsUsage")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["actions-usage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=e.concat(t)},model:function(e){return e.queryParams.more_info?this.fetchPieChartData("webhooks"):this.fetchUsageLineChartData("crm-webhook")},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};e.actionApiName="webhooks",e.filterType="webhooks",this.getQueryParams().more_info||(this.usageData=e,t.usageData=e,Object.assign(t,this.getWebhookDefDetails()),t.tabType="action_usage",this.currentModel=t)}},renderTemplate:function(){return{outlet:"#result",component:this.getQueryParams().more_info?"crm-actions-usage-chart":"list-automationactions"}}},{mixins:["crm-wfactions-usage-mixin","crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks.view-webhook",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["store_webhook.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crux-lazyLoad.js"],ResourceConstants.CRMClient)},beforeModel:function(){this.isFeatureAvailable(!0).isError&&this.transition.abort()},model:function(){return commonUtils.showHideLoadingDiv(!0),this.fetchInitialDataForWebhookView(this.getDynamicParam())},afterModel:function(e){var t={};e.isError?this.transition.abort():(t.actionDetails=Object.assign({},e.actionDetails),t.actionDetails&&Object.keys(t.actionDetails).length?(t.connectionsList=[],e.connections.crm_connectors&&e.connections.crm_connectors.connection_list&&e.connections.crm_connectors.connection_list.connections&&e.connections.crm_connectors.connection_list.connections.length>0&&(t.connectionsList=e.connections.crm_connectors.connection_list.connections.filter((e=>!e.name.includes("internal--zohocrm")))),t.isReadOnlyAction=this.isReadOnlyAction(t.actionDetails,"Webhook")||!this.isEditDeleteActionPermissionAvail(t.actionDetails,this.actionType,"edit"),t.editRestrictionMsg=t.isReadOnlyAction?this.getEditDeleteRestrictionMsg(t.actionDetails,this.actionType):void 0,t.deleteRestrictionMsg=this.isEditDeleteActionPermissionAvail(t.actionDetails,this.actionType,"delete")?void 0:this.getEditDeleteRestrictionMsg(t.actionDetails,this.actionType),t.lockMsg=I18n.getMsg("crm.workflow.rule.locked",Lyte.Component.registeredHelpers.getI18nActionName("Webhook")),t.module=this.fetchModuleName(t.actionDetails.module.api_name),this.automation.mergefieldModule=t.module):(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("workflow.label.singular.webHook")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.webhooks.index-webhook"})),this.currentModel=t,commonUtils.showHideLoadingDiv(!1))},renderTemplate:function(){return{outlet:"#result",component:"crm-view-webhook"}}},{mixins:["crm-automation-actions","crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.webhooks",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["store_webhook.js"],ResourceConstants.CRMClient)},getResources:function(){var e=["zohocrm_wflyte_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours")],t=networkUtils.returnDependencyFiles(e,ResourceConstants.CRM);t=(t=t.concat(fetchWFParamterComponentFiles())).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["webhook.js","crm-automation-actions.js","action-common-mixin.js","crm-rule-association.js","crm-related-rules.js","automation/common/crm-automation-actions-helper.js","crm-automation-help-link.js"],ResourceConstants.CRMClient);return r=(r=r.concat(networkUtils.returnDependencyFiles(["webhook.css","automation-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutomationActions"),networkUtils.getI18nJSUrl("workflow"),networkUtils.getI18nJSUrl("Webhook")],ResourceConstants.CRM)),t=t.concat(r)},redirect:function(){if("crm.settings.section.webhooks"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.webhooks.index-webhooks",this.replaceWith(e)}},afterRender:function(){wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType(this.actionType)},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),store.unloadAll("webhook"),this.usageData={},this.failureData={},store.clearCachedQuery("module",{feature_name:"webhooks"})},actions:{willTransition:function(){closeAsapWidget()}}},{mixins:["crm-webhook"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-notifications",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-message-notifications.js","crm-message-notifications-form.js","crm-wf-recipients.js","crux-combo-box.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-message-notifications.css","crm-message-notifications-form.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},redirect:function(){if(document.getElementById("msgNotifiTab").openTab("notificationsTab"),"crm.settings.section.workflow-message-notifications.message-notifications"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-message-notifications.message-notifications.index-message-notification",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-templates",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-message-templates.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-message-templates.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},redirect:function(){if(document.getElementById("msgNotifiTab").openTab("templatesTab"),"crm.settings.section.workflow-message-notifications.message-templates"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-message-notifications.message-templates.index-message-template",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-notifications.index-message-notification",{model:function(){return Lyte.registeredMixins["crm-message-notification-mixin"].indexMsgNotfModel({per_page:20,page:1,type:"sms"})},afterModel:function(e){e.notificationType="sms",e.notfViewRoute="crm.settings.section.workflow-message-notifications.message-notifications.view-message-notification",e.serviceLabel="crm.workflow.actions.label.SMS"},renderTemplate:function(){return{outlet:"#notificationsTab",component:"crm-message-notifications"}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-notifications.view-message-notification",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-wf-recipients.js"],ResourceConstants.CRMClient)},model:function(){return this.viewMsgNotfModel()},afterModel:function(e){e.type="sms",e.error&&(e.resourceType=this.getNotificationLabelBasedOnType(e.type))},renderTemplate:function(e){return $L("#msgTabHeader").hide(),{outlet:"#notificationsTab",component:e.error?"crm-message-error":"crm-message-notification-detailview"}},didDestroy:function(){_cruxUtils.removeCustomAlert(),$L("#msgTabHeader").show()}},{mixins:["crm-message-notification-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-templates.index-message-template",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_merge_fields.js"],ResourceConstants.CRM)},model:function(){var e=store.findAll("imtemplate",{sort_by:"created_time",sort_order:"desc",per_page:20,type:"sms",page:1});return Promise.all([e]).then((function(e){var t=e[0];return{messageTemplates:t,hasMoreRecords:t&&t.length>0&&t.$.meta.more_records}}))},afterModel:function(e){e.type="sms",e.serviceLabel="crm.workflow.actions.label.SMS",e.viewtempRoute="crm.settings.section.workflow-message-notifications.message-templates.view-message-template"},renderTemplate:function(){return{outlet:"#templatesTab",component:"crm-message-templates"}},actions:{willTransition:function(){"undefined"!=typeof SMS&&SMS&&SMS.UTILS.hideSDKUI()}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications.message-templates.view-message-template",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){return this.viewMsgTempModel()},afterModel:function(e){e.type="sms",e.error&&(e.resourceType=this.getServiceLabelBasedOnType(e.type)+" "+I18n.getMsg("crm.label.template"))},renderTemplate:function(e){return $L("#msgTabHeader").hide(),{outlet:"#templatesTab",component:e.error?"crm-message-error":"crm-message-template-detailview"}},didDestroy:function(){_cruxUtils.removeCustomAlert(),$("#msgTabHeader").show()}},{mixins:["crm-message-template-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-message-notifications",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.js","crm-message-templates-common.js","crm-message-notifications-common.js","crm-imtemplate.js","crm-merge-field-mixin.js","crm-msg-setup-store.js","crm-msg-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.css","crm-message-template-picker.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("messagenotification")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){return{}},afterModel:function(e){e.serviceLabel="crm.workflow.actions.label.SMS",e.notfRoute="crm.settings.section.workflow-message-notifications.message-notifications",e.templateRoute="crm.settings.section.workflow-message-notifications.message-templates"},renderTemplate:function(){return{outlet:"#result",component:"crm-messagenotification-tabview"}},beforeExit:function(){"undefined"!=typeof SMS&&SMS&&SMS.UTILS.removeSDKFrame(),Lyte.registeredMixins["crm-merge-field-mixin"].clearMergeFieldsCache()},actions:{onBeforeLoad:function(){Lyte.registeredMixins["crm-merge-field-mixin"]&&Lyte.registeredMixins["crm-merge-field-mixin"].clearMergeFieldsCache()}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-notifications",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-message-notifications.js","crm-message-notifications-form.js","crm-wf-recipients.js","crux-combo-box.js","crm-message-error.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-message-notifications.css","crm-message-notifications-form.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},lyteConvertionSupported:!0,redirect:function(){if(document.getElementById("msgNotifiTab").openTab("notificationsTab"),"crm.settings.section.workflow-whatsapp-notifications.message-notifications"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-whatsapp-notifications.message-notifications.index-message-notification",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-templates",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_merge_fields.js"],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-message-templates.js","crm-message-error.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-message-templates.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},lyteConvertionSupported:!0,redirect:function(){if(document.getElementById("msgNotifiTab").openTab("templatesTab"),"crm.settings.section.workflow-whatsapp-notifications.message-templates"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-whatsapp-notifications.message-templates.index-message-template",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-notifications.index-message-notification",{beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return Lyte.registeredMixins["crm-message-notification-mixin"].indexMsgNotfModel({per_page:20,page:1,type:"whatsapp"})},afterModel:function(e){e.notificationType="whatsapp",e.serviceLabel="crm.workflow.actions.label.WhatsApp",e.notfViewRoute="crm.settings.section.workflow-whatsapp-notifications.message-notifications.view-message-notification",e.error&&(e.resourceType=Lyte.registeredMixins["crm-message-notification-mixin"].getNotificationLabelBasedOnType(e.notificationType))},lyteConvertionSupported:!0,renderTemplate:function(e){var t=e.error?"crm-message-error":"crm-message-notifications";return{outlet:e.error?".msgNotifi":"#notificationsTab",component:t}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-notifications.view-message-notification",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-wf-recipients.js"],ResourceConstants.CRMClient)},model:function(){return this.viewMsgNotfModel()},afterModel:function(e){e.type="whatsapp",e.error&&(e.resourceType=this.getNotificationLabelBasedOnType(e.type))},lyteConvertionSupported:!0,renderTemplate:function(e){return $L("#msgTabHeader").css("display","none"),{outlet:"#notificationsTab",component:e.error?"crm-message-error":"crm-message-notification-detailview"}},didDestroy:function(){_cruxUtils.removeCustomAlert(),$("#msgTabHeader").css("display","block")}},{mixins:["crm-message-notification-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-templates.index-message-template",{beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){var e=store.findAll("imtemplate",{sort_by:"created_time",sort_order:"desc",per_page:20,type:"whatsapp",page:1});return Promise.all([e]).then((function(e){var t=e[0];return{messageTemplates:t,hasMoreRecords:t&&t.length>0&&t.$.meta.more_records}}))},lyteConvertionSupported:!0,afterModel:function(e){e.type="whatsapp",e.serviceLabel="crm.workflow.actions.label.WhatsApp",e.viewtempRoute="crm.settings.section.workflow-whatsapp-notifications.message-templates.view-message-template"},renderTemplate:function(){return{outlet:"#templatesTab",component:"crm-message-templates"}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications.message-templates.view-message-template",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){return this.viewMsgTempModel()},lyteConvertionSupported:!0,afterModel:function(e){e.type="whatsapp",e.error&&(e.resourceType=this.getServiceLabelBasedOnType(e.type)+" "+I18n.getMsg("crm.label.template"))},renderTemplate:function(e){return $L("#msgTabHeader").css("display","none"),{outlet:"#templatesTab",component:e.error?"crm-message-error":"crm-message-template-detailview"}},didDestroy:function(){_cruxUtils.removeCustomAlert(),$("#msgTabHeader").css("display","block")}},{mixins:["crm-message-template-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-whatsapp-notifications",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.js","crm-message-templates-common.js","crm-message-notifications-common.js","crm-merge-field-mixin.js","crm-msg-setup-store.js","crm-imtemplate.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-messagenotification-tab.css","crm-message-template-picker.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("messagenotification")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return{}},lyteConvertionSupported:!0,afterModel:function(e){e.serviceLabel="crm.workflow.actions.label.WhatsApp",e.notfRoute="crm.settings.section.workflow-whatsapp-notifications.message-notifications",e.templateRoute="crm.settings.section.workflow-whatsapp-notifications.message-templates"},renderTemplate:function(){return{outlet:"#result",component:"crm-messagenotification-tabview"}},beforeExit:function(){Lyte.registeredMixins["crm-merge-field-mixin"].clearMergeFieldsCache()},actions:{onBeforeLoad:function(){Lyte.registeredMixins["crm-merge-field-mixin"]&&Lyte.registeredMixins["crm-merge-field-mixin"].clearMergeFieldsCache()}}}),Lyte.Router.registerRoute("crm.settings.section.activate-users",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.js","crm-userdelete-notification.js","assignment_threshold_model.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["crm-userdelete-confirm.css"],ResourceConstants.CRMClient).concat(e)},model:function(e){var t=null!=this.transition.data.actionType?{params:this.transition.data}:{params:{actionType:"LicenseUsers",fromIndex:0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/License.do","LicenseUsersUpdate"===t.params.actionType?"POST":"GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){setTimeout((function(){var e="",t=$(".activeUserListFixedHead"),r=$("#mainMenuTabDiv").height(),s=$("#setupInnerLinks").height(),n=$(".activeUserList");if(n.is(":visible")){var i=n.offset().top-(r+s),o=$L("#setup_new_ContentDiv");o[0].addEventListener("scroll",(function(){var e=Math.round(o.scrollTop()),t=Math.round(o.height()),r=Math.round($("#result").height()),s=$(".activeUserListFixedHead");o.scrollTop()>=i?s.show():s.hide(),Crm.menu.setupScrollBind=!0;var n=$("#isToTriggerNextRequest").val();if(e+t>=r-48&&"true"===n&&void 0!==getObj("actionType")){var a={actionType:getObj("actionType").value,fromIndex:parseInt($("#fromIndexCnt").val())};networkUtils.makeRequest(Crm.getCrmBasePath()+"/License.do","GET",{params:a,success_callback:function(e){$("#activateUsersTable > tbody").append(e);var t=$("#preUserCount");t.val(parseInt(t.val())+parseInt($("#currentPreUserCnt").val())),$("#tempUserCount").val(parseInt(t.val()));var r=$("#totalUserCount");r.val(parseInt(r.val())+parseInt($("#currentUserObjCnt").val()))}})}else"false"==n&&null!=getObj("actionType")&&($(".showOnEnd").removeClass("dN"),$(".licenseUsersUpdate").removeClass("dN"))}))}var a=n.outerWidth(),l=$ESAPI.encoder();n.find("th").each((function(){var t=$(this),r=Math.round(t.outerWidth()),s=t.text();e=e+'<th style="width:'+l.encodeForHTMLAttribute(r)+'px ">'+l.encodeForHTML(s)+"</th>"})),t.find("tr").html(e),t.css({top:r+s,width:a})}),50)}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-deletiontool",{queryParams:["feature"],getResources:function(){var e=networkUtils.returnDependencyFiles(["deletionAdminTool.js","lyte-daterangepicker.js","lyte-tree.js","webform.js","mailmerge_folders-store.js","crm-report-util.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-report-dependencies.js","model-crm-report.js"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:async function(e){if(e.wfresponse={},"workflow"===e.queryParams.feature){var t=await networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminCenter.do","GET",{params:{action:"getWFmodules"}});e.wfresponse=t}return e.feature=e.queryParams.feature,e},afterModel:function(e){this.currentModel={},Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache&&(this.currentModel=Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache),e.feature&&(this.currentModel.selected=e.feature),e.wfresponse.workflowmodules&&(this.currentModel.moduleresponse=e.wfresponse),this.currentModel.featuresNames=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames},renderTemplate:function(){if(!Lyte.Router.getRouteInstance().parent.currentModel.showPaymentPop)return{outlet:"#result",component:"crm-admindeletiontool"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){var e=$L(".admc_ctn"),t=e.offset().top,r=renderingUtils.windowHeight-(t+45);e.css("height",r),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))},actions:{onError:function(e){return e.status?(405===e.status?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1):(Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1)}}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-history",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-admincenterhistory.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(e){return(e={}).history=store.findAll("admincenter_history",{page:1,per_page:50,include_inner_details:"module.plural_label"},!0),e.count=store.findAll("admincenter_usage"),e},afterModel:function(e){this.currentModel={history:e.history};var t=e.count[0];this.currentModel={history:e.history,totalTools:t.tools_count,totalDeletedItems:t.total_resource_entries_count};for(var r=[{display:I18n.getMsg("admincenter.allfeatures"),apiName:"All"}],s=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames,n=s.length,i=0;i<n;i++)r.push(s[i]);this.currentModel.featuresNames=r},renderTemplate:function(){if(!Lyte.Router.getRouteInstance().parent.currentModel.showPaymentPop)return Crm.client_tracking("Admin Tools - History Page"),{outlet:"#result",component:"crm-admincenterhistory"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){var e=$L(".admc_ctn"),t=e.offset().top,r=renderingUtils.windowHeight-(t+45);e.css("height",r),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.deletion.tools.history"),Crm.partnerName]))},beforeExit:function(){var e=$L("crm-admincenterhistory");if(void 0!==e&&void 0!==e[0]){var t=e[0].component;$L("#admincenterhistory-scroll")[0].removeEventListener("scroll",t.scrollAction)}},actions:{onError:function(e){if(e.responseText){var t=JSON.parse(e.responseText);return"FEATURE_NOT_SUPPORTED"===t.code?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED")}:"NO_PERMISSION"===t.code?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1}return Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1}}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-tools",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-admincentertools.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),e},renderTemplate:function(){return this.currentModel={},Lyte.Router.getRouteInstance().parent.currentModel&&Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache&&(Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache={}),this.currentModel.featuresNames=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames,{outlet:"#result",component:"crm-admincentertools"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.index-admincenter",{getResources:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},renderTemplate:function(){if(Lyte.Router.getRouteInstance().parent.currentModel.showGetStarted)return{outlet:"#result",component:"crm-admincenter"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.admincenter",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-admincenter-const.js"],ResourceConstants.CRMClient);return{parent:networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AdminCenter")],ResourceConstants.CRM),child:e}},getResources:function(){return networkUtils.returnDependencyFiles(["crm-admincenter.js"],ResourceConstants.CRMClient)},model:function(e){e.features={};var t=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminCenter.do","GET",{params:{action:"getInitData"}});return e.features=t,e},afterModel:function(e){this.currentModel={},this.currentModel.showGetStarted=e.features.showGetStarted;for(var t=e.features.supportedFeatures,r=admintools_feature_details.features,s=r.length,n=[],i=0;i<s;i++){var o=r[i].system;t[o]&&t[o].isVisible&&n.push(r[i])}this.currentModel.featuresNames=n},renderTemplate:function(){Crm.client_tracking("Admin Tools Opened"),"crm.settings.section.admincenter"===this.transition.target&&this.replaceWith("crm.settings.section.admincenter.index-admincenter")},beforeExit:function(){store.unloadAll("admincenter_history"),store.clearCachedQuery("admincenter_history"),store.unloadAll("admincenter_usage"),store.clearCachedQuery("admincenter_usage")},actions:{onError:function(e){return e.status?(405===e.status?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1):(Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1)}}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.create-allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],ResourceConstants.CRMClient))),e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.registeredMixins["crm-allowed-ips-mixin"].getDataForCreate()},afterModel:function(e){if(e.permissionDenied&&(e.permissionDeniedPopup=!0),e.isEdit=!1,e.ipDetails={},e.ipInfo={},e.ipDetails=store.createRecord("allowed_ips"),e.configuration.current_ip){e.ipInfo.current_ip=e.configuration.current_ip,e.ipDetails.ipData=[];var t={};t.ip=e.ipInfo.current_ip,t.name="";var r=[],s={name:""};s.ip_address=e.configuration.current_ip,s.type="static",s._add="true",r.push(s),e.ipDetails.$.set("ip_details",r),e.ipDetails.current_ip=e.ipInfo.current_ip}this.transition.data.hasOwnProperty("type")&&(e.ipDetails.type="users"),e.configuration.type?e.ipInfo.type=e.configuration.type:e.ipInfo.type=[],e.ipDetails.$.set("restrict_to",[]),Lyte.registeredMixins["crm-allowed-ips-mixin"].setSourceType(e,"create")},renderTemplate:function(){return{outlet:"#result",component:"crm-configure-ip"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName])),commonUtils.showHideLoadingDiv(!1)}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.edit-allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],ResourceConstants.CRMClient))),e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},queryParams:["filters","addedType"],model:function(){var e=this.getDynamicParam(),t={},r=this.getQueryParams().filters;return t.filters=r,Lyte.registeredMixins["crm-allowed-ips-mixin"].getDataForEdit(e,t)},afterModel:function(e){e.permissionDenied&&(e.permissionDeniedPopup=!0),e.isEdit=!0,e.ipDetails=e.allowed_ips[0],e.ipDetails.type=e.ipDetails.restrict_to?e.ipDetails.restrict_to[0].type:"allusers",void 0===e.ipDetails.type&&(e.ipDetails.type="users"),e.ipInfo={},e.configuration.current_ip&&(e.ipInfo.current_ip=e.configuration.current_ip),e.configuration.type?e.ipInfo.type=e.configuration.type:e.ipInfo.type=[],Lyte.registeredMixins["crm-allowed-ips-mixin"].setSourceType(e);for(var t=e.ipDetails.ip_details.length,r=0;r<t;r++)e.ipDetails.ip_details[r]._delete="false","static"===e.ipDetails.ip_details[r].type&&e.ipDetails.ip_details[r].ip_address===e.configuration.current_ip&&(e.currIpAdded="true");e.currIpAdded||(e.currIpAdded="false"),e.ipDetails.restrict_to||(e.ipDetails.restrict_to=[]);var s=e.ipDetails.restrict_to.length;for(r=0;r<s;r++)e.ipDetails.restrict_to[r]._delete="false";e.disableSave="false",e.assignIpShow="true",e.isIpLimitExceed=t>=10?"true":"false"},renderTemplate:function(){return{outlet:"#result",component:"crm-configure-ip"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName])),document.querySelector("crm-configure-ip").component.setData("disableSave","true"),commonUtils.showHideLoadingDiv(!0)}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.index-allowed-ips",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-view-configure-ip.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-view-configure-ip.css"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={per_page:100,page:1,filters:JSON.stringify({value:"${EMPTY}",comparator:"equal",api_name:"restrict_to.type"})},t={},r={},s={},n={};return t.per_page=100,t.page=1,t.filters=JSON.stringify({value:"users",comparator:"equal",api_name:"restrict_to.type"}),r.per_page=100,r.page=1,r.filters=JSON.stringify({value:"roles",comparator:"equal",api_name:"restrict_to.type"}),s.per_page=100,s.page=1,s.filters=JSON.stringify({value:"groups",comparator:"equal",api_name:"restrict_to.type"}),n.per_page=100,n.page=1,n.filters=JSON.stringify({value:"territories",comparator:"equal",api_name:"restrict_to.type"}),Lyte.resolvePromises([app.store.makeRequest("findAll","allowedip_configuration"),app.store.makeRequest("findAll","allowed_ips",t),app.store.makeRequest("findAll","allowed_ips",r),app.store.makeRequest("findAll","allowed_ips",s),app.store.makeRequest("findAll","allowed_ips",n),app.store.makeRequest("findAll","allowed_ips",e)]).then((function(e){delete window.args;for(var t=1;t<5;t++)e[t]||(e[t]=[]);return{configuration:e[0],allowed_ips:e[5],users_allowed_ips:e[1],roles_allowed_ips:e[2],groups_allowed_ips:e[3],territories_allowed_ips:e[4]}}),(function(){return{configuration:[],allowed_ips:[],users_allowed_ips:[],roles_allowed_ips:[],groups_allowed_ips:[],territories_allowed_ips:[],permissionDenied:!0}}))},afterModel:function(e){if(e.permissionDenied&&(e.permissionDeniedPopup=!0),0===e.allowed_ips.length?e.viewIpConfig=[]:e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.allowed_ips),e.viewIpInfo={},e.configuration.current_ip&&(e.viewIpInfo.current_ip=e.configuration.current_ip),e.configuration.type?e.viewIpInfo.type=e.configuration.type:e.viewIpInfo.type=[],e.hasUsers=e.users_allowed_ips.length>0,e.hasRoles=e.roles_allowed_ips.length>0,e.hasGroups=e.groups_allowed_ips.length>0,e.hasTerritories=e.territories_allowed_ips.length>0,this.transition.data.hasOwnProperty("type"))switch(this.transition.data.type){case"allusers":case"users":e.users_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.users_allowed_ips);break;case"roles":e.roles_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.roles_allowed_ips);break;case"groups":e.groups_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.groups_allowed_ips);break;case"territories":e.territories_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.territories_allowed_ips)}e.hasUsers?(e.viewIpConfig=e.users_allowed_ips,this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.users_allowed_ips))):!e.hasUsers&&e.hasRoles?(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.roles_allowed_ips))):e.hasUsers||e.hasRoles||!e.hasGroups?e.hasUsers||e.hasRoles||e.hasGroups||!e.hasTerritories||(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips).concat(e.groups_allowed_ips).concat(e.territories_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.territories_allowed_ips))):(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips).concat(e.groups_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.groups_allowed_ips))),e.showUserLoading=!1,e.showTypeLoading=!1},renderTemplate:function(){return{outlet:"#result",component:"crm-view-configure-ip"}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName]));var t=document.getElementById("ipConfiguration"),r=e.users_allowed_ips.length,s=e.roles_allowed_ips.length,n=e.groups_allowed_ips.length,i=e.territories_allowed_ips.length,o=document.querySelector("crm-view-configure-ip");null!==o&&(r>0?(o.component.data.usersRecordInfo.page=e.users_allowed_ips.$.meta.page,o.component.data.usersRecordInfo.hasMoreRecords=e.users_allowed_ips.$.meta.more_records):o.component.data.usersRecordInfo.hasMoreRecords=!1,s>0?(o.component.data.rolesRecordInfo.page=e.roles_allowed_ips.$.meta.page,o.component.data.rolesRecordInfo.hasMoreRecords=e.roles_allowed_ips.$.meta.more_records):o.component.data.rolesRecordInfo.hasMoreRecords=!1,n>0?(o.component.data.groupsRecordInfo.page=e.groups_allowed_ips.$.meta.page,o.component.data.groupsRecordInfo.hasMoreRecords=e.groups_allowed_ips.$.meta.more_records):o.component.data.groupsRecordInfo.hasMoreRecords=!1,i>0?(o.component.data.territoriesRecordInfo.page=e.territories_allowed_ips.$.meta.page,o.component.data.territoriesRecordInfo.hasMoreRecords=e.territories_allowed_ips.$.meta.more_records):o.component.data.territoriesRecordInfo.hasMoreRecords=!1),t&&(this.transition.data.hasOwnProperty("type")?t.openTab(this.transition.data.type):r>0?t.openTab("users"):s>0?t.openTab("roles"):n>0?t.openTab("groups"):i>0&&t.openTab("territories")),commonUtils.showHideLoadingDiv(!1)}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips-common.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],ResourceConstants.CRMClient))),e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("allowedips")],ResourceConstants.CRM))},redirect:function(){"crm.settings.section.allowed-ips"===this.transition.target&&this.replaceWith("crm.settings.section.allowed-ips.index-allowed-ips")},beforeExit:function(){store.unloadAll("allowedip_configuration"),store.unloadAll("allowed_ips"),store.unloadAll("added_ips")},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],ResourceConstants.CRMClient)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-view-configure-ip.css"],ResourceConstants.CRMClient))}}),Lyte.Router.registerRoute("crm.settings.section.api-graph-view",{queryParams:["period","from","to","type"],getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-api-dashboard.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"],ResourceConstants.CRM).concat(e)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.js","crux-combo-box.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);t=t.concat(networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.css"],ResourceConstants.CRMClient)),e=e.concat(t);var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("apidashboard_integrationtasks")],ResourceConstants.CRM);return r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom-api-usage-notification")],ResourceConstants.CRM)),e=e.concat(r),networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM).concat(e)},beforeModel:function(e){crmSetup.showRevampedAPIDashboard||this.replaceWith("crm.settings.section.api-settings")},model:function(e){var t={},r=ApiDashboard_DateUtil.getToday();t.from=e.queryParams.from||ApiDashboard_Inputs.from||r,t.to=e.queryParams.to||ApiDashboard_Inputs.to||r,t.version=e.queryParams.type||ApiDashboard_Inputs.version||ApiDashboard_Constants.NEW,t.version=t.version>7?"all":t.version;var s=ApiDashboard_Constants.period[6];ApiDashboard_Inputs.setPeriod(e.queryParams.period||ApiDashboard_Inputs.period||s),t.period=ApiDashboard_Inputs.period,this.ajaxParams=t;return store.findAll("api_dashboard",{from:t.from,to:t.to,version:t.version,period:t.period})},afterModel:function(e){if(e&&403===e.status&&("NO_PERMISSION"===JSON.parse(e.response).code||"INACTIVE_USER"===JSON.parse(e.response).code)||401===e.status||400===e.status&&"INVALID_DATA"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),void this.transition.abort();this.currentModel={api_dashboard:e}},renderTemplate:function(e,t){return networkUtils.initChart(),{outlet:"#result",html:""}},afterRender:function(e,t){ApiDashboard_Inputs.from=this.ajaxParams.from,ApiDashboard_Inputs.to=this.ajaxParams.to,ApiDashboard_Inputs.version=this.ajaxParams.version,"true"===RebrandLinkUtil.getProperty("EARLY_ACCESS_ENABLED")?(TabsAndFieldsApiNames.showBanner=!0,TabsAndFieldsApiNames.early_access_enabled=e.api_dashboard[0].early_access):TabsAndFieldsApiNames.showBanner=!1,TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(void 0,"?action=topUsage"),ApiResponse.validate(e)?(ApiResponse.api_dashboard_response=e,ApiDashboard_Loader.loadAllChartsWithTimer()):(ApiDashboard_Loader.currentPage=ApiDashboard_Constants.TOP_USAGE,ApiError.throwError(ApiDashboard_Constants.API_DASHBOARD)),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName])),$L("#apiContext-helplink").click((function(){var e=document.getElementById("early_accessid"),t=document.getElementById("Eaaccess"),r=t.ltProp("show"),s=null===e||"none"===e.style.display||e.classList.contains("hide");r?t.ltProp("show",!1):s&&"true"===RebrandLinkUtil.getProperty("EARLY_ACCESS_ENABLED")?document.getElementById("early_newid").classList.remove("hide"):document.getElementById("early_newid").classList.add("hide")}))},actions:{onError:function(e,t,r,s){return t.resume(),!1},willTransition:function(e){e.pause();var t=$(".notify_saveBtn");0===t.length||t.hasClass("disable")?e.resume():(document.querySelector("crm-custom-notification-configuration").setData("transition",e),$L(".landing_page_cancel_modal")[0].ltProp("show","true"),e.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.api-module-detail",{queryParams:["step","layoutId"],beforeModel:function(e){if(void 0===Crm.userDetails.permissions.Crm_Implied_Api_Access)return renderingUtils.displayPermissionDenied(),void this.transition.abort();"FieldsList"!=e.queryParams.step&&"RelatedList"!=e.queryParams.step&&this.transition.abort()},model:function(e){var t=Crm.getCrmBasePath()+"/EntityFieldCustomize.do";this.ajaxUrl=t;var r={};r.module=e.dynamicParam,r.isDeveloperSpace=!0,r.isModuleListNeeded=!0,r.isFromModule=!0,"RelatedList"==e.queryParams.step&&(r.isRelatedList=!0),e.queryParams.layoutId&&(r.layoutId=e.queryParams.layoutId);var s={params:r};return networkUtils.lyteInitiateRequest(t,"GET",s)},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,this.ajaxUrl,t.dynamicParam)},actions:{willTransition:function(){var e=this.getDynamicParam();e&&moduleRecordMapping[e]&&(this.unloadProperty("field",store.peekRecord("module",moduleRecordMapping[e].id).fields),store.unloadAll("filter"))}}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.api-modules",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("apidashboard_integrationtasks")],ResourceConstants.CRM);return networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM).concat(e)},beforeModel:function(){if(void 0===Crm.userDetails.permissions.Crm_Implied_Api_Access)return renderingUtils.displayPermissionDenied(),void this.transition.abort()},model:function(e){var t={action:"moduleList",isDeveloperSpace:!0},r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,"?action=moduleList");var r=document.getElementById("early_accessid");null!==r&&r.classList.add("hide"),$L("#apiContext-helplink").click((function(){var e=document.getElementById("early_accessid"),t=document.getElementById("Eaaccess"),r=t.ltProp("show"),s=null===e||"none"===e.style.display||e.classList.contains("hide");r?t.classList.add("vH"):(t.classList.remove("vH"),s&&"true"===RebrandLinkUtil.getProperty("EARLY_ACCESS_ENABLED")?document.getElementById("early_newid").classList.remove("hide"):document.getElementById("early_newid").classList.add("hide"))}))}}),Lyte.Router.registerRoute("crm.settings.section.api-paid",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"],ResourceConstants.CRM),t=[];t.push("crm-api-paid.css"),Crm.userDetails.RTL_ENABLED&&t.push("crm-api-paid-rtl.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-api-credit.js","lyte-dateselect.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("payperapi")],ResourceConstants.CRM);return e.concat(r).concat(s).concat(n)},model:function(){return store.findAll("dummy",null,!1,!1,{url:"crm/v2/settings/api_dashboard/paid_credits"})},actions:{onError:function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return $(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1}},afterModel:function(e){var t=e.paid_credits;if(t.slab_details){var r=t.slab_details.length;$.each(t.slab_details,(function(e,t){var s=I18n.getMsg("Next");0===e?s=I18n.getMsg("First"):e===r-1&&(s=I18n.getMsg("zc.editor.table.rowabove"));var n="",i=e===r-1?250:t.count/1e3;n=i>=1e3?i/1e3+"M":i+"K",t.display_value=s+" "+n}))}t.total_limit=t.api_limit+t.paid_limit,t.enabled&&(t.unused=t.paid_limit-t.last_24_hours);for(var s=t.paid_limit,n=0,i=!0,o=(r=t.slab_details.length,0);o<r&&i;o++){var a=t.slab_details[o],l=a.count;s>l?(n+=a.amount*l/1e3,s-=l):(n+=a.amount*s/1e3,i=!1)}t.currency_symbol=currencyUtils.getCurrencySymbol(t.currencycode),t.billing_date_display=Utils.convertDateToUserPattern(t.billing_date),t.billing_period.from_display=Utils.convertDateToUserPattern(t.billing_period.from),t.billing_period.to_display=Utils.convertDateToUserPattern(t.billing_period.to),t.forecast_amount=n.toFixed(2),t.amount||(t.amount=0),t.last_24_hours||(t.last_24_hours=0),t.amount=t.amount.toFixed(2),t.allowed_paid_limit=t.max_limit-t.api_limit+t.extra_limit,t.allowed_paid_limit=t.allowed_paid_limit>t.max_limit?t.max_limit:t.allowed_paid_limit},renderTemplate:function(e){var t={newDashboard:!0};return t.superAdmin=Crm.userDetails.IS_SUPER_ADMIN&&Crm.userDetails.CANADD_APICREDITS&&Crm.userDetails.ISPAID_USER&&"production"===Crm.userDetails.orgEnvType&&!Crm.userDetails.isTrialEnabled,t.superAdmin?($("#result").html(Handlebars.templates.TabsAndFieldsApiNames(t)),$("#API_pages_container").html(""),$("#accessid").hide(),CRMAPITopUsage.cloneTabClass(),$("#paidapi").addClass("selHead"),$("#tabClassCloneContainer").show(),$("#tabClassCloneContainer .tabClass").show(),this.currentModel=e.paid_credits,{outlet:"#API_pages_container",component:"crm-billing-postpaid"}):($(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1)},afterRender:function(){$L("#apiContext-helplink").click((function(){var e=document.getElementById("early_accessid");null!==e&&e.classList.add("hide");var t=document.getElementById("Eaaccess"),r=t.ltProp("show"),s=null===e||"none"===e.style.display||e.classList.contains("hide");r?t.ltProp("show",!1):s&&"true"===RebrandLinkUtil.getProperty("EARLY_ACCESS_ENABLED")?document.getElementById("early_newid").classList.remove("hide"):document.getElementById("early_newid").classList.add("hide")}))}}),Lyte.Router.registerRoute("crm.settings.section.api-settings",{beforeModel:function(e){crmSetup.showRevampedAPIDashboard&&this.replaceWith("crm.settings.section.api-graph-view")},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAPIKey.do","GET",{params:{action:"developerapi"}})},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,Crm.getCrmBasePath()+"/GenerateAPIKey.do"),document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName])}}),Lyte.Router.registerRoute("crm.settings.section.api-table-view",{queryParams:["period","from","to","type","order"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.js","crux-combo-box.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);t=t.concat(networkUtils.returnDependencyFiles(["crm-custom-notification-configuration.css"],ResourceConstants.CRMClient)),e=(e=e.concat(t)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom-api-usage-notification")],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["crm-api-dashboard-integration-tasks.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-api-dashboard-integration-tasks.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);r.concat(s);var n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("apidashboard_integrationtasks")],ResourceConstants.CRM);return r=(r=r.concat(n)).concat(e)},beforeModel:function(e){crmSetup.showRevampedAPIDashboard||this.replaceWith("crm.settings.section.api-settings"),CRMAPITopUsage.isLoaded=!1},model:function(e){var t={},r=ApiDashboard_DateUtil.getToday();t.from=e.queryParams.from||ApiDashboard_Inputs.from||r,t.to=e.queryParams.to||ApiDashboard_Inputs.to||r,t.version=e.queryParams.type||ApiDashboard_Inputs.version||ApiDashboard_Constants.NEW;var s=ApiDashboard_Constants.period[6];ApiDashboard_Inputs.setPeriod(e.queryParams.period||ApiDashboard_Inputs.period||s),t.period=ApiDashboard_Inputs.period,e.queryParams.order?t.order=e.queryParams.order:ApiDashboard_Inputs.version===ApiDashboard_Constants.OLD?t.order=ApiDashboard_Constants.defaultOldColumnOrder.toString():t.order=ApiDashboard_Constants.defaultNewColumnOrder.toString(),this.ajaxParams=t;var n={params:t};return networkUtils.lyteInitiateRequest("/crm/v2/settings/api_dashboard/statistics","GET",n)},afterModel:function(e){if(e&&403===e.status&&("NO_PERMISSION"===JSON.parse(e.response).code||"INACTIVE_USER"===JSON.parse(e.response).code)||401===e.status||"error"===e.status)return renderingUtils.displayPermissionDenied(),void this.transition.abort();this.currentModel={api_dashboard:e}},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){ApiDashboard_Inputs.from=this.ajaxParams.from,ApiDashboard_Inputs.to=this.ajaxParams.to,ApiDashboard_Inputs.version=this.ajaxParams.version,ApiDashboard_Inputs.version===ApiDashboard_Constants.OLD?(data.oldColumnOrder=this.ajaxParams.order.split(","),data.columnOrder=data.oldColumnOrder):(data.newColumnOrder=this.ajaxParams.order.split(","),data.columnOrder=data.newColumnOrder),TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(null,"?action=statistics"),$("#API_summary_page").empty().hide(),$("#API_calls_filter").show(),ApiDashboard_Loader.loadStatisticsPage(),ApiResponse.validate(e)?("true"===ApiResponse.announcement&&$L("#apiNotifyBar").removeClass("dN").addClass("dB"),ApiResponse.statistics_response=e.api_dashboard,ApiStatistics.loadStatisticsTable()):ApiError.throwError(),document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName]),$L("#apiContext-helplink").click((function(){var e=document.getElementById("early_accessid"),t=document.getElementById("Eaaccess"),r=t.ltProp("show"),s=null===e||"none"===e.style.display||e.classList.contains("hide");r?t.ltProp("show",!1):s&&"true"===RebrandLinkUtil.getProperty("EARLY_ACCESS_ENABLED")?document.getElementById("early_newid").classList.remove("hide"):document.getElementById("early_newid").classList.add("hide")}))},actions:{onError:function(e,t,r,s){return this.currentModel=e.responseJSON,t.resume(),!1},willTransition:function(e){e.pause();var t=$(".notify_saveBtn");0===t.length||t.hasClass("disable")?e.resume():(document.querySelector("crm-custom-notification-configuration").setData("transition",e),$L(".landing_page_cancel_modal")[0].ltProp("show","true"),e.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.create-approval-process",{beforeModel:function(e){commonUtils.showHideLoadingDiv(!0)},model:function(e){return $.ajax({type:"POST",url:Crm.getCrmBasePath()+"/approvalProcess.do?action=newApprovalProcess&module=All",data:"",success:function(e){return $("#result").find(".select2-hidden-accessible").each((function(){$(this).hasClass("select2-hidden-accessible")&&$(this).select2("destroy")})),e}})},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-tree.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-approval-process-configurations.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createapprovalprocess")],ResourceConstants.CRM)))).concat(networkUtils.returnDependencyFiles(["crm-approvalprocess-configuration-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),$(".wf_form_focus").find("tr:eq(0) td:eq(1)").addClass("text"),$(".wf_form_focus").find("tr:eq(0) td:eq(1) input").focus(),$("#subTabBottomDiv").hasClass("setBgClr")&&($("#subTabBottomDiv").removeClass("setBgClr"),$("#setup_new_ContentDiv").removeClass("workflow_rule")),commonUtils.showHideLoadingDiv(),getObj("basic")&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50}),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup&&$("#module").val(this.transition.data.module.module_name).change()},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.index-approval-process",{getDependencies:function(){return networkUtils.returnDependencyFiles(["approvalProcess-min.css"],"")},model:function(e){var t={pageTitle:"crm.label.approval.processes",action:"viewApprovalProcess",isFromBack:!0},r=this.transition.data;if(r){for(var s in r)"highlight"!=s&&"step"!=s&&(t[s]=r[s]);t.toolTip=r.module}var n={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",n)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){$("#setup_new_ContentDiv").addClass("helpOverflowHide");var r=this.transition.data,s=$("#approvaljsonarrayObj"),n=$("#processId");if(s&&0!=s.length){var i=JSON.parse(s.val());if(i.Approval_jsonarrayObj&&0!=i.Approval_jsonarrayObj.length){var o=$("#List_ApprovalProcess").html(),a=Handlebars.compile(o)(i);$("[name=approval_list]").empty(),$("#approvalListDIV").find("tr:last").after(a),$("#modOpt").val("All"),$("#addProcess").show()}else $("#addProcess").hide(),getObj("reOrderBtn").style.display="none",noData()}var l=r&&r.highlight&&null==r.step?r.highlight:null;if(l){applyMasterToolTip(),workflow.highlightSavedRule(l);var c=(n=$("#"+l)).find("a.link").text().trim();c=$ESAPI.encoder().encodeForHTMLAttribute(c),setTimeout((function(){n.removeClass("lastActiveRow")}),1e4),setTimeout((function(){crmui.showMsgBand("success",I18n.getMsg("crm.approval.save.success.message",c),"5000",$("#setupInnerLinks"))}),100)}},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.view-approval-process",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-approval-process-configurations.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("viewapprovalprocess")],ResourceConstants.CRM));return e=e.concat(networkUtils.returnDependencyFiles(["crm-approvalprocess-configuration-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(e){var t={params:{processId:this.getDynamicParam(),isFromBack:!0,action:"editApprovalProcess"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.approval-process",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM)),t=["zohocrm_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours")],r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRM);return(r=r.concat(fetchWFParamterComponentFiles())).concat(e)},beforeModel:function(){},redirect:function(){"crm.settings.section.approval-process"===this.transition.target&&(this.transition.info.route="crm.settings.section.approval-process.index-approval-process",this.replaceWith(this.transition.info))},actions:{willTransition:function(){closeAsapWidget()}},afterRender:function(){wfmergefield.initMergeFieldDetl("Approval")},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.create-assignment-rule",{queryParams:["module","action","entryId"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM)},model:function(e){var t={resource:"assignment_rules"},r=e.queryParams.module,s=store.model.module.data.filterBy({module_name:r})[0],n=s.api_name;t.module=n+",Users";var i={};i.params=t;var o=e.dynamicParam,a=store.peekRecord("assignment_rules",o),l="team_based"===s.access_type;return Lyte.resolvePromises({metaDefinition:networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",i),groupDetails:Crm.userDetails.permissions.Crm_Implied_Manage_Groups?store.findAll("user_group").then((function(e){return e})):[],ruleEntryDetails:null==a?store.findRecord("assignment_rules",o,{module:n}).then((function(e){return e})):a,entries:store.findRecord("assignmentrule_entries",o,{module:n},"","",{call:"openCloneRuleEntry"}),profilesArray:l?store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"}).then((function(e){return e=e.filter((e=>"Requesters"!==e.display_label))})):[]})},lyteConvertionSupported:!0,afterModel:function(e,t){var r=t.dynamicParam,s=t.queryParams.module,n=(t.queryParams.entryId,t.queryParams.action),i={},o=this.transition.data.ruleName,a=this.transition.data.description,l=e.entries,c=e.ruleEntryDetails;null!=c&&null!=c.name||(c=e.ruleEntryDetails[0]),void 0===o&&(o=c&&c.name?c.name:""),void 0===a&&(a=c.description?c.description:""),i.profilesArray=e.profilesArray,i.ruleName=o,i.description=a,i.ruleId=r,i.module=s,i.displayModule=moduleRecordMapping[s].plural_label;var u="team_based"===moduleRecordMapping[s].access_type,d=e.groupDetails;i.isGroupsAvailable=!0,void 0!==d&&0!=d.length||(i.isGroupsAvailable=!1);for(var m=e.metaDefinition.definition,p=m.criteriaFields,g=p.length,f=!1,h=0;h<g;h++){var y=Object.keys(p[h])[0];if(p[h].hasOwnProperty("Users")){for(var C=[],v=p[h].Users.length,_=0;_<v;_++)!u||"userlookup"!==p[h].Users[_].data_type&&"ownerlookup"!==p[h].Users[_].data_type||(p[h].Users[_].cxUserProperties={queryParam:{include_lite_users:!0}}),"SHIFTID"!=p[h].Users[_].column_name&&"NEXTSHIFTID"!=p[h].Users[_].column_name&&"SHIFTEFFECTIVEFROM"!=p[h].Users[_].column_name&&C.push(p[h].Users[_]),"Reporting_To"!==p[h].Users[_].api_name&&"Reporting_To.role"!==p[h].Users[_].api_name||(f=!0);i.userFieldsArray=C}else{var R=p[h][y],w=R.length;for(_=0;_<w;_++)!u||"userlookup"!==R[_].data_type&&"ownerlookup"!==R[_].data_type||(R[_].cxUserProperties={queryParam:{include_lite_users:!0}});i.recordFieldsArray=i.recordFieldsArray?i.recordFieldsArray.concat(p[h][y]):p[h][y]}}if(i.recordFieldsArray=i.recordFieldsArray.filter((e=>"Connected_To__s"!==e.api_name)),!f&&e.entries)for(var b=e.entries.length,D=0;D<b;D++){var M=e.entries[D];if(M.assign_to&&M.assign_to.criteria){var L=M.assign_to.criteria,k=[];this.addCriterias(L,k);var U=k.length;for(h=0;h<U;h++){var E=k[h];if(void 0!==E&&"undeifned"!=typeof E.field&&("Reporting_To"===E.field.api_name||"Reporting_To.role"===E.field.api_name)){var P=E.field.api_name,I={api_name:P="Reporting_To.role"===P?"Reporting_To":P,field_label:"Reporting To",ui_type:20,data_type:"ownerlookup",display_type:-1,visible:!0,lookup:E.field.lookup};i.userFieldsArray.push(I);break}}}}if("editRuleEntry"===n?(i.source="edit",i.ruleEntryDetails=l[0],i.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.edit")):"cloneRuleEntry"===n?(i.source="clone",i.ruleEntryDetails=l[0],i.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.clone")):"createRuleEntry"===n&&(i.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.create"),l&&l.length>0?i.showHeader=!1:i.showHeader=!0),"createRuleEntry"!==n&&this.manipulateRuleEntryDetails(i),void 0!==i.ruleEntryDetails){i.ruleEntryDetails.criteria&&0!==Object.values(i.ruleEntryDetails.criteria).length?i.recordType="recordCriteria":i.recordType="All";var A=i.ruleEntryDetails.assign_to.type;i.ownerType=A,"criteria"===A&&(i.userCriteriaValue=i.ruleEntryDetails.assign_to.criteria)}i.isActionEdited=!1,"createRuleEntry"!==n&&(i.showUserAvailability=!0);var S={fields:[]};(F={})[s]=i.recordFieldsArray,S.fields[0]=F,S.maxCrtCnt=25,S.userTimeFormat=Crm.userDetails.TIME_FORMAT,S.suffix="_c0";var T=Handlebars.templates.criteriaEditor(S);i.criteriaHtml=T;var F;S={fields:[]};(F={})[s]=i.userFieldsArray,S.fields[0]=F,S.maxCrtCnt=25,S.userTimeFormat=Crm.userDetails.TIME_FORMAT,S.suffix="_c1";T=Handlebars.templates.criteriaEditor(S);i.userCriteriaHtml=T,app.arModSpecificDetails||(app.arModSpecificDetails={}),app.arModSpecificDetails[s]?app.arModSpecificDetails[s].isZiaAvailable=m.extraDetails.isZiaAvailable:app.arModSpecificDetails[s]={isZiaAvailable:m.extraDetails.isZiaAvailable},app.assignmentRule||(app.assignmentRule={}),app.assignmentRule.isZiaEnabled=m.extraDetails.isZiaEnabled,app.assignmentRule.isTaskAvailable=m.extraDetails.isTaskAvailable,this.currentModel=i},renderTemplate:function(){return{outlet:"#result",component:"crm-create-assignmentruleentry"}},afterRender:function(){var e=$L("crm-create-assignmentruleentry").e[0].component;if("edit"===e.getData("source")||"clone"===e.getData("source"))e.getData("ruleEntryDetails").criteria;Search.afterRenderCriteria(),wfmergefield.initMergeFieldDetl("Assignment Rules")},manipulateRuleEntryDetails:function(e){var t=e.ruleEntryDetails;e.entryId=t.id,null!==t.criteria?(e.recordType="recordCriteria",e.criteriaValue=t.criteria):e.recordType="All",this.manipulateAssignToDetails(e);var r=""===t.availability?null:t.availability;null!=r&&(r.contains("onlinestatus")&&(e.onlineStatus=!0,e.checkAvailability="yes"),r.contains("shifttiming")&&(e.shiftTiming=!0,e.checkAvailability="yes"));var s=t.followup_task;null!=s&&void 0!==s?(e.selectedTaskId=s.id,e.selectedTaskName=s.name):(e.selectedTaskId="",e.selectedTaskName="")},manipulateAssignToDetails:function(e){var t=e.ruleEntryDetails,r=t.assign_to.type;e.ownerType=r;switch(r){case"criteria":e.userCriteriaValue=t.assign_to.criteria;break;case"category":var s=t.assign_to.category;e.ownerType="category";var n="",i=[];s.forEach((function(t){n=t.type,e.categoryType=n;var r={};switch(n){case"user":r.id=t.id,r.full_name=t.name,i.push(r);break;case"role":e.selectedRoleId=t.id,e.selectedRoleName=t.name,e.roleRoundRobinText=!0;break;case"group":e.selectedGroupId=t.id,e.selectedGroupName=t.name,e.groupRoundRobinText=!0;break;case"profile":e.selectedProfileId=t.id,e.selectedProfileName=t.name,e.profileRoundRobinText=!0}})),"user"===n&&(e.selectedUsers=i,e.userRoundRobinText=!1,i.length>1&&(e.userRoundRobinText=!0));break;case"zia":t.assign_to.assignedToType=I18n.getMsg("crm.intelligence.name"),t.assign_to.assignedToText=I18n.getMsg("crm.assignmentRule.zia.text.msg")}},beforeExit:function(){wfmergefield.clearMergeFieldDetl()},actions:{willTransition:function(e){var t=$L("crm-create-assignmentruleentry")[0];if(t&&t.getData("isActionEdited")&&"crm.settings.section.assignment-rule.view-assignment-rule"!=e.info.route){if(e.data&&e.data.isConfirmExit)return void delete e.data.isConfirmExit;var r={};r.message=I18n.getMsg("crm.label.unsaved.changes.warning.msg"),r.source="RuleEntryExitConfirm",r.routeName=e.info.route,r.dynamicParams=e.info.dynamicParams,r.queryParams=e.info.queryParams;var s=$L("crm-assignment-warningpopup").e;0!==s.length&&s[0].remove(),e.abort(),Lyte.Component.render("crm-assignment-warningpopup",r,"#result"),$L("#deleteWarningPopUp").e.ltProp("show",!0)}},onError:function(e){var t=JSON.parse(e.response),r=!0;return 400!==t.code||"MODULE_NOT_SUPPORTED"!==t.statusObj.code&&"NO_PERMISSION"!==t.statusObj.code||(r=!1,this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),"Permission Denied")),r&&this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),""),$(".dummy_Body").hide(),!1}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.index-assignment-rule",{queryParams:["module"],model:function(e){var t=e.queryParams.module;e={};void 0!==t&&(t=store.model.module.data.filterBy({module_name:t})[0].api_name,e.module=t);var r={resource:"assignment_rules"},s={};s.params=r;return Lyte.resolvePromises({metaDefinition:networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",s),ruleDetails:store.findAll("assignment_rules",e).then((function(e){return e}))})},lyteConvertionSupported:!0,afterModel:function(e,t){var r={},s=t.queryParams.module;t={};r.allowedModules=e.metaDefinition.definition.extraDetails.modulesList;var n=e.metaDefinition.definition.extraDetails.assignmentRulesMaxLimit;void 0===s?(r.module=I18n.getMsg("crm.label.AllModules"),r.selectedModuleName=I18n.getMsg("crm.label.AllModules")):(r.module=moduleRecordMapping[s].module_name,r.selectedModuleName=store.model.module.data.filterBy({module_name:s})[0].plural_label),r.assignmentRulesList=e.ruleDetails,r.assignmentRulesLength=r&&r.assignmentRulesList?r.assignmentRulesList.length:0,r.rulesMaxLimit=n,n*r.allowedModules.length<=r.assignmentRulesLength&&(r.showCreateButton=!1),0==r.assignmentRulesLength&&void 0===s&&(r.isRulesConfigured=!1);var i="",o="",a=this.transition.extraDetails;a&&(a.id&&(i=a.id),a.message&&(o=a.message)),""!=i&&(r.highlightId=i),""!=o&&(r.bandMessage=o),this.currentModel=r},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrules-listview"}},afterRender:function(){if($("#setup_new_ContentDiv").addClass("helpOverflowHide"),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var e=document.querySelector("crm-assignmentrules-listview");e&&e.component&&e.component.actions.showCreateRulePopup();var t=$L("#createModulesDropDown")[0];this.transition.data.module&&this.transition.data.module.api_name&&t&&t.cxProp("selected",this.transition.data.module.api_name)}},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")},onError:function(e){if(null!=e.response){var t={isPermissionDenied:!0},r=$L("crm-assignmentrules-listview");switch(r.length&&r[0].remove(),Lyte.Component.render("crm-assignmentrules-listview",t,"#result"),JSON.parse(e.response).code){case"FEATURE_NOT_SUPPORTED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.zes.mobile.error.feature"),"");break;case"INVALID_MODULE":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.label.module.invalid"),I18n.getMsg("crm.label.invalid.module"));break;case"INTERNAL_ERROR":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.assignment.rule.internal.error"),"");break;default:this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),I18n.getMsg("crm.label.creator.noPermission"))}}else this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),"");return $(".dummy_Body").hide(),!1}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.view-assignment-rule",{queryParams:["module","action","entryId","ruleName"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM)},model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module;return this.fetchViewAssignmentRuleModelData(t,r)},lyteConvertionSupported:!0,afterModel:function(e,t){var r=t.queryParams.module;this.currentModel=this.fetchViewAssignmentRuleAtferModelData(e,r,this.transition.extraDetails)},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrule-entry-listview"}},redirect:function(e){if(e.entriesList&&0===e.entriesList.length){var t=this.transition.data.fromSource;if(void 0!==t&&"ruleEntry"===t)this.transitionTo({route:"crm.settings.section.assignment-rule.index-assignment-rule"});else{var r=this.transition.info;r.queryParams.action="createRuleEntry";var s=Object.assign({},r);s.route="crm.settings.section.assignment-rule.create-assignment-rule",this.replaceWith(s)}}},actions:{onError:function(e){if(null!=e.response){var t={isPermissionDenied:!0},r=$L("crm-assignmentrules-listview");switch(r.length&&r[0].remove(),Lyte.Component.render("crm-assignmentrules-listview",t,"#result"),JSON.parse(e.response).code){case"ID_ALREADY_DELETED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.label.assignment.rule")),"");break;case"FEATURE_NOT_SUPPORTED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.zes.mobile.error.feature"),"");break;case"INVALID_MODULE":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.label.module.invalid"),"Invalid Module");break;case"INTERNAL_ERROR":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.assignment.rule.internal.error"),"");break;default:this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),"Permission Denied")}}else this.getQueryParams().module?this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),""):this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),"Permission Denied");return $(".dummy_Body").hide(),!1},didTransition:function(){var e=$L("crm-assignmentrule-entry-listview")[0];e&&e.component.setData("route",!0)}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["assignmentrules.js","lyte-tree.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["assignment-rules-mixin.js"],ResourceConstants.CRMClient)),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignmentrules"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["assignmentrules.css"],ResourceConstants.CRMClient);return t.concat(s).concat(e).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["assignment-rule-models.js","assignment-rules-model-wrapper.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient)},beforeModel:function(){},redirect:function(){if("crm.settings.section.assignment-rule"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.assignment-rule.index-assignment-rule",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("assignment_rules"),store.unloadAll("assignmentrule_entries")},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.create-assignment-thresholds",{queryParams:["module"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t)})},renderTemplate:function(){return $("#result_layer2").show(),{outlet:"#result_layer2",component:"crm-threshold-detail-view"}},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")},actions:{onError:function(e,t,r){var s=null,n=r?r.queryParams.module:null;if(n){var i=this.getModuleRecord(null,n);s=i?i.plural_label:null}return this.errorResponseAlert(e,s),$(".dummy_Body").hide(),!1},willTransition:function(e){var t=$L("crm-threshold-detail-view");!!(t&&t.length>0)&&!t[0].getData("initialLoad")&&this.outFocusAlert(e)}},isMatchedInArray:function(e,t){return t.some((function(t){return e===t}))},getUsers:function(){for(var e=[],t=store.peekAll("user"),r=t.length,s=0;s<r;s++){var n={name:t[s].full_name,id:t[s].id,zuid:t[s].zuid,type:"users"};e.push(n)}return e}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.edit-assignment-thresholds",{queryParams:["module"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t),restrictionView:this.getRestrictions(e)})},afterModel:function(e,t){if(!e.restrictionView.hasOwnProperty("id")){var r=Lyte.Router.transitionTo({route:"crm.settings.section.assignment-thresholds.index-assignment-thresholds"}),s={type:"error",message:I18n.getMsg("crm.threshold.doesnot.exist")};return r.transData={alert:s},void this.transition.abort()}let n=e.metaDefinition.definition.extraDetails.threshold_limits.users_per_request,i=e.restrictionView.restrict_to.slice(),o=e.restrictionView.total_count;var a=t.dynamicParam,l=t.queryParams.module,c=this.getModuleRecord(null,l);this.setAllocationDatainModel(e);let u=o/n;if(u=Math.ceil(u)-1,u<=0)return i=i.sortDescOrder("default_assignee"),void(e.users=i);var d={module:c.api_name,per_page:n};const m=[];for(let e=0;e<u;e++){d.page=e+2;let t=store.findAll("assignment_threshold_userdetails",d,!0,!1,{getAllUsers:!0,restrictionId:a});m.push(t)}return Promise.all(m).then((function(t){let r=t.length;for(let e=0;e<r;e++)i=t[e]?i.concat(t[e]):i;i=i.sortDescOrder("default_assignee"),e.users=i}))},renderTemplate:function(){return $("#result_layer2").show(),{outlet:"#result_layer2",component:"crm-threshold-detail-view"}},afterRender:function(){var e=document.getElementById("arCriteriaEditor"),t=document.getElementById("arRestrictDetailView");this.setThresholdCriteriaBind(e,t)},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")},actions:{onError:function(e,t,r){var s=null,n=r?r.queryParams.module:null;if(n){var i=this.getModuleRecord(null,n);s=i?i.plural_label:null}return this.errorResponseAlert(e,s),$(".dummy_Body").hide(),!1},willTransition:function(e){var t=$L("crm-threshold-detail-view");!!(t&&t.length>0)&&!t[0].getData("disableSaveButton")&&this.outFocusAlert(e)}},getModuleFields:function(e){var t=e.queryParams.module,r=this.getModuleRecord(null,t);return store.findAll("field",{module:r.api_name})},isMatchedInArray:function(e,t){return t.some((function(t){return e===t}))},setAllocationDatainModel:function(e){var t=e.restrictionView.allocation_process;if(t){if(e.oldReallocation=JSON.parse(JSON.stringify(t)),e.showReallocation=!0,e.realloc_timeinterval_unit=t.reallocation.time_interval.unit,e.unalloc_timeinterval_unit=t.unallocation.time_interval.unit,e.realloc_show_lar="assignment_rule"===t.reallocation.method.type,e.unalloc_show_lar="assignment_rule"===t.unallocation.method.type,e.show_specific_field="specific_field"===t.priority.type,"round_robin"===t.unallocation.method.type){var r=t.unallocation.method.round_robin[0].type;if("user"===r){var s=[],n=t.unallocation.method.round_robin,i=n.length;for(let e=0;e<i;e++){var o={id:n[e].resource.id,zuid:n[e].resource.zuid,full_name:n[e].resource.name};s.push(o)}e.rr_selectedUsers=s}else"role"===r?e.rr_selectedRoleId=t.unallocation.method.round_robin[0].resource.id:e.rr_selectedGroupId=t.unallocation.method.round_robin[0].resource.id;(e.rr_selectedRoleId||e.rr_selectedGroupId)&&(e.showRoundRobinText=!0)}"initial_user"===t.reallocation.method.type&&(t.reallocation.method.assignment_rule={id:void 0,name:void 0}),"assignment_rule"===t.unallocation.method.type?t.unallocation.method.round_robin=[{id:void 0,type:"user"}]:t.unallocation.method.assignment_rule={id:void 0,name:void 0},"fifo"===t.priority.type&&(t.priority.field={id:void 0},t.priority.order="ascending")}},getRestrictions:function(e){var t=e.dynamicParam,r=e.queryParams.module,s=this.getModuleRecord(null,r),n=r?{module:s?s.api_name:r}:{};return store.findRecord("assignment_threshold",t,n).then((function(e){return e}))}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.index-assignment-thresholds",{queryParams:["module","status"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t),restrictionlistView:this.getRestrictions(e)})},afterModel:function(){this.currentModel.restrictionlistView||(this.currentModel.restrictionlistView=[]);let e=this.transition&&this.transition.transData?this.transition.transData.thresholdId:null;e&&(this.currentModel.highlightId=e)},renderTemplate:function(){return $("#result_layer2").hide(),{outlet:"#result",component:"crm-threshold-list"}},afterRender:function(){if($("#setup_new_ContentDiv").addClass("oH"),this.component.component&&this.component.component.methods.resetData(this.component.component),this.currentModel.highlightId){let e=$("#entry_"+this.currentModel.highlightId).position().top-46;$L("#atListTable")[0].scrollTable(0,e)}const e=document.querySelector("#setup_new_ContentDiv");new ResizeObserver((()=>this.listviewResizing())).observe(e);var t=this.transition&&this.transition.transData?this.transition.transData.alert:null;if(t&&t.message&&t.type){var r=document.getElementById("arMsgBox");r||(r=Lyte.Component.render("lyte-messagebox",{"lt-prop-type":t.type,"lt-prop-message":t.message,id:"arMsgBox",ltPropDuration:"3000"},"#result")),r.setData({"lt-prop-type":t.type,"lt-prop-message":t.message}),r.ltProp("show",!0)}},beforeExit:function(){$("#setup_new_ContentDiv").removeClass("oH")},actions:{onError:function(e,t,r){var s=null,n=r?r.queryParams.module:null;if(n){var i=this.getModuleRecord(null,n);s=i?i.plural_label:null}return this.errorResponseAlert(e,s),$(".dummy_Body").hide(),!1}},getRestrictions:function(e){var t=e.queryParams.module,r=e.queryParams.status,s=this.getModuleRecord(null,t),n=t?{module:s?s.api_name:t}:{};return r&&"All"!=r&&(n.status=r.toLowerCase()),store.findAll("assignment_threshold",n,!1,!0,{doUnload:!0}).then((function(e){if(e)return e}))}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["assignment-thresholds.js","assignment_threshold_model.js","crm-msg-utils.js","assignment-rules-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["assignment-rule-models.js","assignment-rules-model-wrapper.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignmentrestrictions")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["assignment-thresholds.css"],ResourceConstants.CRMClient),n=e.concat(t).concat(s).concat(r);return Crm.userDetails.RTL_ENABLED&&n.push(networkUtils.returnDependencyFiles(["assignment-thresholds-rtl.css"],ResourceConstants.CRMClient)),n},redirect:function(){if("crm.settings.section.assignment-thresholds"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.assignment-thresholds.index-assignment-thresholds",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")}}),Lyte.Router.registerRoute("crm.settings.section.attributions",{getDependencies:function(){},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_attributions.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-attribution.js"],ResourceConstants.CRMClient))},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/marketing/Attribution/showsetup","GET",{})},afterModel:function(){$("#overlayHeader,#settingInner").hide(),$("#setupshow,#mainResult").show()},renderTemplate:function(e){return{outlet:"#result",component:"crm-attribution-setup"}},afterRender:function(e){Attribution.refresh_weightagepop=!0,Attribution.showSetupcalback(e);var t=isChatEnabled?28:0,r=$L("#setup_new_ContentDiv"),s=renderingUtils.windowHeight-(r.offset().top+t);r.css({height:s+"px"})},actions:{onError:function(e,t,r,s){if(e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_SUPPORTED"===e.responseJSON.code)return renderingUtils.displayPermissionDenied(),!1},willTransition:function(e){if(Attribution.isPageModified){var t=e.pause(),r="stayonPageConfirmBox",s=$("#"+r);renderingUtils.freezeBackground(),mailsetCenter(r),s.find(".leavePage").off("click").click((function(){$("#"+r).hide(),t.resume(),renderingUtils.removeFreezeLayer(),Attribution.isPageModified=!1,void 0!==Attribution.confdetail&&void 0!==Attribution.confdetail.type||Attribution.emptyRemovePotentialStage()})),s.find(".stayPage").off("click").click((function(){$("#"+r).hide(),e.abort(),renderingUtils.removeFreezeLayer()})),s.focus()}}}}),Lyte.Router.registerRoute("crm.settings.section.auditlog",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_wfAuditLog.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["auditLog-min.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-auditlog-user.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-auditlog-user.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-export-auditlog-error-pop.js"],ResourceConstants.CRMClient),i=r.concat(e).concat(t).concat(s).concat(n);return i=(i=(i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("globalpicklist"),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("ExportAuditlog"),ResourceConstants.CRM))},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/AuditLog.do","GET")},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.audit.log"),Crm.partnerName]))},actions:{willTransition:function(){auditLog&&(auditLog.clearFliter(),auditLog.encryptedToken=null)}}}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["autoresponse_store.js","autoresponse_config.js","crm-alert-addresswrapper.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["auto_response_create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("autoresponserules")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["autoresponse_mixins.js"],ResourceConstants.CRMClient))},beforeModel:function(e){Crm.userDetails.permissions["Crm_Implied_Web_To_"+e.dynamicParam]||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){return{criteriaFields:store.findAll("field",{module:moduleApiMapping[e.dynamicParam],type:"all"},!1,!0,{apiVersion:"2.2"}),addressDetails:store.findAll("dummy",{action:"addressDetails",module:e.dynamicParam},!1,!1,{url:"/crm/autoresprules.do",method:"GET"})}},afterModel:function(e,t){let r=store.peekAll("module").find((e=>e.module_name===t.dynamicParam));e.record=store.createRecord("auto_response_rule",{name:this.transition.extraInfo?this.transition.extraInfo.ruleName:"",module:{id:r.id,api_name:r.api_name},entries:[store.createRecord("auto_response_entry",{sequence_number:1})]}),e.record.entries[0].isEdit=!0,e.disableAddContion=!0,this.transition.extraInfo||(e.showArrNameEdit=!0),this.afterModelAcctionsInRoute(e)},renderTemplate:function(){return this.hideSidePanel(),{outlet:"#result",component:"crm-autoresponse-config"}},beforeExit:function(){store.unloadAll("auto_response_rule"),store.unloadAll("auto_response_entry")},didDestroy:function(){this.showPanel()},actions:{onError:function(e){this.routeErrorHandling(e)},willTransition:function(e){this.routeExitWarningHandlings(e)}}},{mixins:["autoresponse_commons"]}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["autoresponse_store.js","autoresponse_config.js","crm-alert-addresswrapper.js","autoresponse_helpers.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["auto_response_create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("autoresponserules")],ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["autoresponse_mixins.js"],ResourceConstants.CRMClient)},model:function(e){return this.initEditReq(e.dynamicParam)},afterModel:function(e){this.afterModelAcctionsInRoute(e),this.parseAssociatedForms(e),e.record.entries&&0!==e.record.entries.length||(e.noEntriesFound=!0)},renderTemplate:function(){return this.hideSidePanel(),{outlet:"#result",component:"crm-autoresponse-config"}},beforeExit:function(){store.unloadAll("auto_response_rule"),store.unloadAll("auto_response_entry"),store.unloadAll("field")},didDestroy:function(){this.showPanel()},actions:{willTransition:function(e){this.routeExitWarningHandlings(e)}}},{mixins:["autoresponse_commons"]}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.index-auto-response-rules",{queryParams:["module","ruleId","ruleName","action"],beforeModel:function(){if(null==this.getQueryParams().module){var e=[];store.peekAll("module").forEach((function(t){t.webform_supported&&t.presence_sub_menu&&Crm.userDetails.permissions["Crm_Implied_Web_To_"+t.module_name]&&e.push(t.$.toJSON())})),0===e.length?(renderingUtils.displayPermissionDenied(),this.transition&&this.transition.abort()):(e.sort((function(e,t){return e.sequence_number-t.sequence_number})),this.setQueryParams("module",e[0].module_name))}},model:function(){var e={seModule:this.getQueryParams().module,pageTitle:"crm.common.menu.automation.autoresponse",action:"viewAutoRespRules"};"viewAutoRespRuleEntries"==this.getQueryParams().action&&(e.action=this.getQueryParams().action,e.ruleId=this.getQueryParams().ruleId,e.ruleName=this.getQueryParams().ruleName);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/autoresprules.do","POST",t)},renderTemplate:function(e){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.view-rules",{queryParams:["module","active","filter"],getResources:function(){var e=networkUtils.returnDependencyFiles(["autoresponse_listview.js","autoresponse_helpers.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("autoresponserules")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["auto-response-rule-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getDependencies:function(){return networkUtils.returnDependencyFiles(["autoresponse_store.js","autoresponse_mixins.js"],ResourceConstants.CRMClient)},model:function(e){var t={};return e.queryParams&&(e.queryParams.module&&"__all"!==e.queryParams.module&&(t.module=e.queryParams.module),void 0!==e.queryParams.active&&"__all"!==e.queryParams.active&&(t.active=e.queryParams.active),e.queryParams.filter&&(t.filter=e.queryParams.filter)),this.getAllRuleReq(t)},afterModel:function(e,t){e.supportedModules=e.definition.definition.supported_modules,t.queryParams&&(t.queryParams.module&&"__all"!==t.queryParams.module&&(e.filteredModule=t.queryParams.module),void 0!==t.queryParams.active&&"__all"!==t.queryParams.active&&(e.filteredStatus="true"===t.queryParams.active.toString()?"active":"inactive"),t.queryParams.filter&&(e.searchKeyWord=JSON.parse(t.queryParams.filter).value)),this.transition.extraInfo&&this.transition.extraInfo.id&&(e.highlightId=this.transition.extraInfo.id),this.parseAssociationResponse(e.records,e.associatedForms)},renderTemplate:function(){return{outlet:"#result",component:"crm-autoresponse-list",reRender:!0}},afterRender:function(){$L(".arr_table").find(".lyteTableScroll.lyteScrollBar").resetScrollbar();let e=this.transition.data;e&&e.type&&this.showCruxMessage(e.type,e.message)},beforeExit:function(){store.unloadAll("auto_response_rule")},actions:{onError:function(e){return this.routeErrorHandling(e),this.transition.abort(),!1},willTransition:function(){_cruxUtils.removeCustomAlert()}}},{mixins:["autoresponse_commons"]}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["autoresponse_store.js","autoresponse_config.js","crm-alert-addresswrapper.js","autoresponse_helpers.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["auto_response_create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("autoresponserules")],ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["autoresponse_mixins.js"],ResourceConstants.CRMClient)},model:function(e){return this.initEditReq(e.dynamicParam)},afterModel:function(e){e.viewOnly=!0,this.parseAssociatedForms(e)},redirect:function(e){e.record.entries&&0!==e.record.entries.length||this.replaceWith({route:"crm.settings.section.auto-response-rules.edit",dynamicParams:[e.record.id]})},renderTemplate:function(){return this.hideSidePanel(),{outlet:"#result",component:"crm-autoresponse-config"}},beforeExit:function(){store.unloadAll("auto_response_rule"),store.unloadAll("auto_response_entry"),store.unloadAll("field")},didDestroy:function(){this.showPanel()}},{mixins:["autoresponse_commons"]}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules",{forceFetch:!0,getResources:function(){if(isAutoResponseEnabled)return networkUtils.returnDependencyFiles(["autoresponse_mixins.js"],ResourceConstants.CRMClient)},beforeModel:function(){this.transition.preservePopup=!0},redirect:function(){isAutoResponseEnabled&&"auto-response-rules"===this.getRouteInstance().routeName&&this.replaceWith("crm.settings.section.auto-response-rules.view-rules")},actions:{didTransition:function(){if("crm.settings.section.auto-response-rules"===this.transition.target&&!isAutoResponseEnabled){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.auto-response-rules.index-auto-response-rules",this.replaceWith(e)}}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.create-autoresponder",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t)},model:function(e){this.getDynamicParam();var t=e.queryParams.module||"Leads",r={module:t,toolTip:t,step:"create",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.create-folder",{queryParams:["module"],model:function(e){var t=e.queryParams.module||"Leads",r={module:t,toolTip:t,step:"newFolder",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.edit-autoresponder",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t)},model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",s={responderId:t,module:r,toolTip:r,step:"edit",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:s})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.edit-folder",{queryParams:["module"],model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",s={module:r,toolTip:r,step:"editFolder",newModel:!0,folderId:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:s})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.index-autoresponder",{queryParams:["module","step","folderId"],model:function(e){var t=e.queryParams.module||"Leads",r=(e.queryParams.step&&e.queryParams.step,e.queryParams.folderId,{module:t,toolTip:t,step:"show",newModel:!0});return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.view-autoresponder",{queryParams:["module"],model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",s={responderId:t,module:r};return this.transition.info.queryParams.step&&"viewResponder"==this.transition.info.queryParams.step?s.step="viewResponderLyte":(s.step="view",s.toolTip=r,s.newModel=!0),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:s})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders",{queryParams:["module","step"],redirect:function(){if("crm.settings.section.autoresponders"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.autoresponders.index-autoresponder",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.bcc-dropbox",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-bcc-dropbox-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-bcc-dropbox.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-bcc-dropbox.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailBccDropbox"),networkUtils.getI18nJSUrl("EmailAuthentication"),networkUtils.getI18nJSUrl("profilePage")],ResourceConstants.CRM))},model:function(e){return this.transition.data&&this.transition.data.configure?store.findAll("bcc_dropbox",{},!1,!1,"POST").then((function(){return store.findAll("bcc_dropbox").then((function(e){return{bcc_dropbox:e}}))})):store.findAll("bcc_dropbox").then((function(e){return{bcc_dropbox:e}}),function(e){var t=JSON.parse(e.response);if("NOT_ALLOWED"===t.code){if("BCC Dropbox is not activated for this user"===t.message)Lyte.Router.transitionTo({route:"crm.settings.section.bcc-dropbox"}).data={configure:!0};else if("BCC Dropbox feature is temporarily suspended"===t.message)return{bcc_dropbox:t}}else"NO_PERMISSION"!==t.code&&403!==e.status||(renderingUtils.displayPermissionDenied(),this.transition.abort())}.bind(this))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-email-bcc-dropbox"}},afterRender:function(e,t){}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.create-blueprint",{queryParams:["module","fieldId","layoutId","isContinuous"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM);return e=e.concat(fetchWFParamterComponentFiles())},beforeModel:function(e){$(".setup-space").hide()},model:function(e){var t=this.getQueryParams().module,r=this.getQueryParams().fieldId,s=this.getQueryParams().layoutId;null!=t&&null!=r&&null!=s&&null!=this.transition.data||this.transitionTo("crm.settings.section.blueprint.index-blueprint");var n={params:{action:"getPickListDetails",module:t,fieldId:r,layoutId:s}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",n)},afterModel:function(e,t){commonUtils.showHideLoadingDiv(),renderingUtils.removeFreezeLayer();var r=this.transition.data.processData;r.PicklistValues=e,this.currentModel=r,thirdPartyUtils.unbindChildSelect2($("#pb_creteria_conditions")),$("#pb_creteria_conditions").addClass("pp-content p25");var s=$("#pb_creteria_conditions").clone(!0);s=ProcessBuilder.copySelectValues(s,$("#pb_creteria_conditions")),r.CriteriaContentFromCreatePop=s,ProcessBuilder.unSavedChanges=!0,r=ProcessFlow.initProcessBuilder_beforeRender(e),e.store_processData=r},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process})}},afterRender:function(e,t){ProcessBuilder.TransitionIdVsDetails={},ProcessFlow.initProcessBuilder_afterRender(e.store_processData),$("#pb_dragAndDropBox").css("display","block"),ProcessBuilder.hideShowAddState(),ProcessBuilder.hideShowStagelist()},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),ProcessBuilder.resetOnDetailViewExit()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.index-blueprint",{queryParams:["module"],model:function(e){var t={pageTitle:"crm.label.process.automation",allowMultiClick:"true",action:"showAllProcesses",isFromBack:!0},r=e.queryParams.module;r&&(t.module=r);var s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",s)},afterModel:function(e){"Failure"===e.Status&&(renderingUtils.displayPermissionDenied(),this.transition.abort());var t=e;if(ProcessBuilder.ProcessPageCnt=0,ProcessFlow.isAllProcessLoaded=t.IsAllProcessLoaded,t.HELP_LINK=crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl["help.process.automation.manage"],featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse");$L(".ts-fxd-sc").removeClass("primaryLeftPanelBr"),e.removeClass("dNImp")}},renderTemplate:function(e){return{outlet:"#result",html:Handlebars.templates.ProcessListViewHeader(e)}},afterRender:function(e,t){$("#setup_new_ContentDiv").addClass("helpOverflowHide");var r=e;ProcessBuilder.listViewModule=e.selectedModule,e.inactivePortalIds&&(ProcessBuilder.inactivePortalIds=e.inactivePortalIds),r.LicenseLimits&&r.LicenseLimits.EDITION&&(ProcessBuilder.LicenseLimits.EDITION=r.LicenseLimits.EDITION),$(".setupleftmenutd").show(),$("#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow"),ProcessFlow.processCurrentViewResponse=r,r.SUPPORTED_MODULES&&(ProcessFlow.SUPPORTED_MODULES=r.SUPPORTED_MODULES);var s=Handlebars.templates.ProcessListViewData({processes:r.Processes,isReOrder:r.ALLOWREORDER});""!=s.trim()&&($("#processDataContainer").html(s),ProcessBuilder.bindMoreActions()),ProcessBuilder.RegexValidators=r.RegexValidators;var n=$("#reOrderBtn"),i=$("#noProcessMessageDiv"),o=$("#processDataContainer");n.hide(),i.addClass("hide"),$("#saveReOrderBtn, #cancelReOrderBtn").hide();var a=o.find(".processDataRow").length;0===a?i.removeClass("hide"):a>1&&n.show(),"All"==r.selectedModule?(n.addClass("disabledBtn"),void 0!==n[0]&&(n[0].setAttribute("onmouseover","crmui.toolTip_show(this,'left','"+I18n.getMsg("crm.automation.process.reorder.disabled.msg")+"')"),n[0].setAttribute("onmouseout","crmui.toolTip_hide()"))):(n.removeClass("disabledBtn"),n.removeAttr("onmouseover onmouseout")),$("#setup_new_ContentDiv").off("scroll").on("scroll",(function(){ProcessBuilder.ProcessScrollReqSent||ProcessFlow.isAllProcessLoaded||(ProcessBuilder.ProcessScrollReqSent=!0,ProcessFlow.loadProcesses(void 0,void 0,2))})),$("#bluePrintSearchTxt").off("keyup paste").on("keyup paste",(function(){if(!ProcessBuilder.ProcessSearchReqSent){ProcessBuilder.ProcessSearchReqSent=!0;var e=this;setTimeout((function(){var t=$.trim($(e).val());ProcessFlow.loadProcesses(void 0,void 0,1,t),ProcessBuilder.ProcessSearchReqSent=!1}),1e3)}})),ProcessFlow.PROCESS_LIMIT=r.totalProcessLimit,ProcessFlow.isProcessListView=!0,r.isPortalActivated&&(ProcessFlow.isPortalActivated=r.isPortalActivated),r.allPortalsData&&(ProcessFlow.allPortalsData=r.allPortalsData,ProcessFlow.isPortalDataLoaded=!0),ProcessFlow.PROCESS_COUNT=r.totalCnt,ProcessBuilder.LicenseLimits=jQuery.extend(!0,ProcessBuilder.LicenseLimits,r.LicenseLimits),Crm.trackSpotLightAction("Process Automation - Process Automation Click",{Place:"Setup"}),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_BLUEPRINT").PF_ACCESSED_BLUEPRINT,RebrandLinkUtil.getProperties("PF_ACCESSED_BLUEPRINT_ID").PF_ACCESSED_BLUEPRINT_ID),ProcessFlow.hideCreateProcessOnModuleLengthExceed(r),AutomationActionsHelper.loadCustomFunctionFiles();var l=ProcessBuilder.highlightprocess;if(l&&l.highlight&&"save"===l.from){var c="processDataRow_"+l.highlight;ProcessFlow.highlightSavedBlueprint(c),setTimeout((function(){$("#"+c).removeClass("lastActiveRow")}),1e4)}featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup&&ProcessFlow.showCreateProcessPop(this.transition.data.module.module_name)},actions:{didTransition:function(){this.updateInProgress&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert")),this.updateInProgress=!1),ProcessBuilder.doRefresh&&Utils.windowLocationReload()},willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.view-blueprint",{queryParams:["module","step"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM);return e=e.concat(fetchWFParamterComponentFiles())},model:function(e){var t=this.getQueryParams().module,r=this.getQueryParams().step,s={params:{action:"getProcessDetails",module:t,processId:this.getDynamicParam(),step:r,toolTip:t,isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",s)},afterModel:function(e){if("Failure"==e.Status&&e.Error&&"UpdateInProgress"===e.Error&&(this.transition.abort(),Lyte.Router.getRouteInstance("crm.settings.section.blueprint.index-blueprint").updateInProgress=!0,history.back()),featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.addClass("dNImp"),t.addClass("primaryLeftPanelBr")}},renderTemplate:function(e,t){if("string"!=typeof e){var r=document.getElementsByTagName("crm-clone-blueprint");if(null!=r&&r.length>0&&r[0].remove(),ProcessBuilder.isReportPreview=!1,"Failure"!=e.Status||!e.Error||"Deleted"!==e.Error){processData=ProcessFlow.initProcessBuilder_beforeRender(e),"clone"==t.queryParams.step?(processData.isCloneProcess=!0,ProcessBuilder.processClone=!0):(processData.isCloneProcess=!1,ProcessBuilder.processClone=!1),void 0!==processData.transitionVsDeletedFlds&&(ProcessBuilder.Process.CriteriaString=ProcessBuilder.fixDeletedFieldProcessCriteria(ProcessBuilder.Process.CriteriaString)),e.store_processData=processData;var s=Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process});return ProcessBuilder.TransitionIdVsDetails={},{outlet:"#result",html:s}}$("#show").html(Handlebars.templates.ProcessDeleted(e))}else $("body").html(e)},afterRender:function(e,t){"string"!=typeof e&&"Failure"!=e.Status&&(AutomationActionsHelper.loadCustomFunctionFiles(),ProcessFlow.initProcessBuilder_afterRender(e.store_processData))},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),ProcessBuilder.resetProcessCreateRelatedObjects(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess();var e=$("crm-blueprint-export");e.length>0&&e.remove();let t=$L("crm-change-owner")[0];if(void 0!==t&&t.component.closeModal(),featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse");$L(".ts-fxd-sc").removeClass("primaryLeftPanelBr"),e.removeClass("dNImp")}ProcessBuilder.resetOnDetailViewExit()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint-setting",{queryParams:["action"],getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("blueprint"),"zohocrm_zprocess.js",networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.css"],ResourceConstants.CRMClient);return e.concat(networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.js","crm-blueprint-dependents.js","crm-blueprint-helpers.js","crm-alert-recipients.js","crm-alert-addresswrapper.js","crux-combo-box.js"],ResourceConstants.CRMClient),t)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){var t=store.peekAll("module").filter((function(e){return e.isBlueprintSupported&&(e.editable||"team_based"===e.access_type&&e.private_profile&&"Admins"===e.private_profile.name)}));return t.sort((function(e,t){return e.sequence_number>t.sequence_number?1:-1})),{modules:t,action:e.queryParams.action}},renderTemplate:function(){var e=document.querySelector("crm-blueprint-pushinpushout");return e&&e.remove(),{component:"crm-blueprint-pushinpushout",outlet:"#result"}},beforeExit:function(){this.removeFromCache(networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.css"],ResourceConstants.CRMClient))},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),e.status===crmConstants.limitExceedsCode&&Search.displayLookupExceedsMsg(e),!1},willTransition:function(e){if(this.transition.target!=e.target){var t=document.querySelector("crm-blueprint-pushinpushout");t&&t.remove()}}}}),Lyte.Router.registerRoute("crm.settings.section.blueprint-usage",{queryParams:["action","reportId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-client-portal-user-mixin.js","crm-client-portal-mixin.js","crm-client-portal-user-data-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[networkUtils.getI18nJSUrl("blueprint"),"zohocrm_zprocess.js","zcrm_selectUser.js",networkUtils.getI18nJSUrl("businesshours")];Crm.isZohoChartsEnabled?e.push("zohocrm_chart.js"):e.push("highcharts.js");var t=networkUtils.returnDependencyFiles(e,ResourceConstants.CRM);return(t=t.concat(networkUtils.returnDependencyFiles(["crm-blueprint-user-dropdown.js","crm-blueprint-dependents.js","crm-blueprint-helpers.js","user_type.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-blueprint-user-dropdown.css","crm-blueprint-dependents.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM))},model:function(e){var t={};t.action=e.queryParams.action||"showAllUsage",t.reportId=e.queryParams.reportId,"ReportInFlowDiagram"===t.reportId&&(t.ownerId="-1");var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",r)},afterModel:function(e,t){networkUtils.initChart();var r=e;if(ProcessBuilder.isReportPreview=!0,r.HELP_LINK=crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl["help.process.automation.usage"],"getUsageReport"===t.queryParams.action){var s=new Date;r.StartDay=s.getDate(),r.StartMonth=s.getMonth()+1,r.StartYear=s.getFullYear()}},renderTemplate:function(e,t){e&&e.isPortalActivated&&(ProcessFlow.isPortalActivated=e.isPortalActivated),!ProcessFlow.isPortalDataLoaded&&e.allPortalsData&&(ProcessFlow.allPortalsData=e.allPortalsData,ProcessFlow.isPortalDataLoaded=!0);var r=null;if("showAllUsage"===t.queryParams.action||null==t.queryParams.action)r=Handlebars.templates.ProcessUsageList(e),$(".setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow");else if("getUsageReport"===t.queryParams.action){e.isUser=t.queryParams.reportId&&["AvgProcessTime","AvgStateTime","ProcessEntryCount","ProcessExitCount"].indexOf(t.queryParams.reportId)<0,e.isPortalUser=ProcessFlow.isPortalActivated&&!(isSandboxAcc&&"true"===isSandboxAcc)&&e.isUser&&t.queryParams.reportId&&["RecordsBasedDuration","RecordsBasedStatus"].indexOf(t.queryParams.reportId)<0,r=Handlebars.templates.ProcessUsageReport(e)}return{outlet:"#result",html:r}},afterRender:function(e,t){var r=e;if("getUsageReport"===t.queryParams.action)if("RecordsBasedDuration"==t.queryParams.reportId&&($("#customDateRange").removeClass("mL20"),$("#customDateRange").addClass("pT10")),"RecordsBasedStatus"!==t.queryParams.reportId&&"RecordsBasedDuration"!=t.queryParams.reportId||$("#noteDiv").show(),ProcessBuilder.addNoneOptionForSelect(),ProcessBuilder.isProcessFlowDiagram(t.queryParams.reportId),"ReportInFlowDiagram"===t.queryParams.reportId)ProcessBuilder.showReportInFlowDia(r,!0);else{var s="process";"AvgStateTime"===t.queryParams.reportId||"RecordsBasedStatus"===t.queryParams.reportId?s="state":"NoOfTransitionOccured"===t.queryParams.reportId&&(s="transition"),r.Result&&r.Result.length>0?Crm.isZohoChartsEnabled?($(".reportGraph").html(""),CrmChartUtil.renderChart(document.querySelector(".reportGraph"),ProcessBuilder.processJsonForZChart(r),!1)):$(".reportGraph").highcharts(ProcessBuilder.processJsonForChart(r,s)):$(".reportGraph").html("<br><br><br><br><div class='crm-base-font-size aligncenter'>"+I18n.getMsg("crm.data.not.available")+"</div><br><br>")}},beforeExit:function(){var e=$("#processAutomationUsageReport");e.length&&(thirdPartyUtils.unbindChildEvents(e,!0,!0,!0),ProcessBuilder.resetProcessCreateRelatedObjects())}}),Lyte.Router.registerRoute("crm.settings.section.blueprint",{getDependencies:function(){window.module=void 0;var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("blueprint"),"zohocrm_zprocess.js","zcrm_selectUser.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-userassociations-datastore.js"],ResourceConstants.CRMClient);t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-event-picklist.js","lyte-colorpicker.js"],ResourceConstants.CRMClient));var r=networkUtils.returnDependencyFiles(["zohocrm_workflow.js","zohocrm_ProcessFlow.js"],ResourceConstants.CRM);return(e=e.concat(t).concat(r)).concat(fetchWFParamterComponentFiles())},getResources:function(){var e;e=(e=(e=(e=(e=(e=(e=(e=(e=[]).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("globalpicklist"),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("richtext"),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-blueprint-dependents.js","crm-blueprint-helpers.js","crm-tag-bp.js","crm-tag-helpers.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-tag-mixin.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloneblueprint"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)])).concat(networkUtils.returnDependencyFiles(["crm-blueprint-dependents.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-alert-recipients.js","crm-alert-addresswrapper.js","cloneBlueprint.js","crux-combo-box.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient));var t=networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css","cloneBlueprint.css"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css"],ResourceConstants.CRMClient)),e=e.concat(t)},beforeModel:function(){networkUtils.initChart()},beforeExit:function(){var e=$("#createProcessContainer");e.length&&(window.removeEventListener("beforeunload",ProcessBuilder.pageReloadChk),thirdPartyUtils.unbindChildEvents(e,!0,!0,!1),ProcessBuilder.resetProcessCreateRelatedObjects()),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_zprocess.js"],ResourceConstants.CRM)),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.settings.section.booking.clone-booking",{queryParams:["type","module"],model:function(e){var t=e.queryParams,r=networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule/"+this.getDynamicParam(),"GET"),s={module:t.module},n=networkUtils.lyteInitiateRequest("/crm/v4/settings/layouts","GET",{params:s}),i=networkUtils.lyteInitiateRequest("/crm/v4/settings/meeting","GET"),o=store.findAll("user_group"),a=store.findAll("territory");return Lyte.resolvePromises({calendar_Res:r,fieldObj:n.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:i,groups:o,territories:a.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories},t.queryParams.type="team";var r=calendarSchedule.getCalendarScheduleObj(e,t);r.calendar_name=I18n.getMsg("crm.cal.duplicate.calendarname",r.calendar_name).substring(0,50),r.id="null",e.calObj=r,t.queryParams.type=r.schedule_type},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(e.calObj)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(e.calObj)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");if(r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),e.calObj.userDisplayArr){var s=document.getElementById("addedUsers"+t.queryParams.module).querySelector("crux-user-dropdown");s.cxProp("selectedUsers",e.calObj.userDisplayArr),s.cxProp("selected",e.calObj.userIdArr)}t&&t.queryParams&&"team"===t.queryParams.type&&$("#selectedusers"+t.queryParams.module)[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")})),$("#calname").select()}}),Lyte.Router.registerRoute("crm.settings.section.booking.create-booking",{queryParams:["type","module"],getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_preferences")],ResourceConstants.CRM)},model:function(e){var t=e.queryParams,r={type:t.type,module:t.module},s=networkUtils.lyteInitiateRequest("/crm/v4/settings/layouts","GET",{params:r}),n=networkUtils.lyteInitiateRequest("/crm/v4/settings/meeting","GET"),i=store.findAll("user_group"),o=store.findAll("territory");return Lyte.resolvePromises({fields:s.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:n,groups:i,territories:o.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories};var r=t.queryParams.type,s=t.queryParams.module,n={},i=[],o=[],a={id:moduleRecordMapping.Events.id,name:"Events",pluralLabel:moduleRecordMapping.Events.plural_label},l={id:moduleRecordMapping.Calls.id,name:"Calls",pluralLabel:moduleRecordMapping.Calls.plural_label};if("user"===r?(void 0!==Crm.userDetails.permissions.Crm_Implied_Create_Events&&o.push(a),void 0!==Crm.userDetails.permissions.Crm_Implied_Create_Calls&&o.push(l)):"team"===r&&(o.push(a),o.push(l)),n=calendarSchedule.getCreateCalObj(r,s),"Events"===s&&!Crm.userDetails.MEETING_BRIDGE_ENABLED){var c=Crm.userDetails.LICENSE_TYPE,u="SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled,d=e.meetingDetails;Object.keys(d).length>0&&(calendarSchedule.meetingConfZuid=d);var m=Object.keys(d).length>0?JSON.parse(Events.constructMeetingToolSelectBox(d)):void 0;m&&-1!==["R","E","S","X","Y","P","A","C","Z","U","D"].indexOf(c)&&!u&&(n.meeting_preferences=m)}if(n.moduleObj=o,n.durObj=calendarSchedule.durationArr,n.incrdurObj=calendarSchedule.incrdurationArr,n.maxevperslotObj=calendarSchedule.maxevperslotArr,n.maxevperdayObj=calendarSchedule.maxevperdayArr,n.buffertimeObj=calendarSchedule.bufferArr,n.id="null",calendarSchedule.callUser=!1,"team"===r){calendarSchedule.assignArr=[];a={users:[]};calendarSchedule.assignArr.push(a);var p=e.groups,g=e.territories;if(void 0!==p){for(var f=(v=p.user_groups)?v.length:0,h=(a={},[]),y=0;y<f;y++){var C={};C.id=v[y].id,C.name=v[y].name,h.push(C)}if(h.length>0)(a={}).groups=h,calendarSchedule.assignArr.push(a)}if(void 0!==g){f=(v=g.territories)?v.length:0;var v,_=[];for(y=0;y<f;y++){var R={};R.id=v[y].id,R.name=v[y].name,_.push(R)}if(_.length>0){var w={};w.territories=_,calendarSchedule.assignArr.push(w)}}n.assignArr=calendarSchedule.assignArr}var b=["Event_Title","Participants","What_Id","To_Number__s","Subject","Venue","Description","Meeting_Provider__s","Meeting_Venue__s"],D=["What_Id","Subject"];Crm.userDetails.CALLS_PREFERENCE&&(D[0]="To_Number__s");var M,L=[],k=e.fields.fields,U=k.length;for(y=0;y<U;y++){(!1===(A=k[y]).custom_field&&b.contains(A.api_name)||!0===A.custom_field&&133!==A.ui_type&&111!==A.ui_type&&116!==A.ui_type)&&("Events"===s&&"What_Id"!==A.api_name||"Calls"===s&&(D.contains(A.api_name)||2===A.section_id))&&L.push(A),"To_Number__s"===A.api_name&&(M=A)}if("Calls"===s&&Crm.userDetails.CALLS_PREFERENCE&&(!M||!M.visible)){var E="";if(Crm.userDetails.permissions.Crm_Implied_Customize_Calls&&!M){var P='<link-to lt-prop-class="link"  lt-prop-route="crm.settings.section.modules.module.preferences-module" lt-prop-target="_blank" lt-prop-dp=\'["Calls"]\' lt-prop-rel="noopener noreferrer" >'+I18n.getMsg("crm.calls.preferences.fromtonumber",'"'+I18n.getMsg("crm.calls.tonumber")+'"')+"</link-to>";E=I18n.getMsg("crm.calendar.booking.conflict.calls.tonumber",P)}else E=I18n.getMsg("crm.calendar.booking.conflict.calls.tonumber.visible");return _cruxUtils.showCustomAlert({params:{ltPropYield:!0,ltPropContentAlign:"left",ltPropType:"info",ltPropPrimaryMessage:I18n.getMsg("Info"),ltPropSecondaryMessage:E,ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"center"}}),this.replaceWith("crm.settings.section.booking"),void commonUtils.showHideLoadingDiv(!1)}if("Events"===s?(calendarSchedule.eventfields=L,calendarSchedule.tempeventfields=calendarSchedule.eventfields,n.fields=calendarSchedule.eventfields):"Calls"===s&&(calendarSchedule.callfields=L,calendarSchedule.tempcallfields=calendarSchedule.callfields.slice(),n.fields=calendarSchedule.callfields),"Events"===s){n.online_meeting_providers=[],calendarSchedule.online_meeting_providers=[],n.meetingVenue_options=[],n.defaultMeetingVenue="",n.isMvOnline=!1,n.defaultMeetingVenueColorCode="",n.defaultOnlineMeetProvider="",n.is_admin_user=Crm.userDetails.IS_ADMIN,n.crm_base_path=Crm.getCrmBasePath(),n.meetingvenue_colourcode_enabled=!1,n.meeting_bridge_enabled=Crm.userDetails.MEETING_BRIDGE_ENABLED;f=calendarSchedule.eventfields.length;for(y=0;y<f;y++)"Meeting_Provider__s"===calendarSchedule.eventfields[y].api_name?(n.online_meeting_providers=calendarSchedule.eventfields[y].pick_list_values,calendarSchedule.online_meeting_providers=n.online_meeting_providers,n.defaultOnlineMeetProvider=calendarSchedule.online_meeting_providers[0]):"Meeting_Venue__s"===calendarSchedule.eventfields[y].api_name&&(n.meetingVenue_options=calendarSchedule.eventfields[y].pick_list_values,n.defaultMeetingVenue=calendarSchedule.eventfields[y].default_value,n.meetingvenue_colourcode_enabled=calendarSchedule.eventfields[y].enable_colour_code);for(f=n.meetingVenue_options.length,y=0;y<f;y++)if(n.meetingVenue_options[y].display_value===n.defaultMeetingVenue){n.defaultMeetingVenueColorCode=n.meetingVenue_options[y].colour_code;break}}n.defaultMeetingVenue!==I18n.getMsg("Online")&&"Online"!==n.defaultMeetingVenue||(n.isMvOnline=!0);f=L.length;var I=["Event_Title","Participants","What_Id","To_Number__s","Subject"];n.defaultMeetingVenue===I18n.getMsg("Client location")&&I.push("Venue");for(y=0;y<f;y++){var A=L[y];if(I.contains(A.api_name)){a={};"Event_Title"===A.api_name||"Subject"===A.api_name?a.name=I18n.getMsg("crm.calendarbooking.field.name"):"Venue"===A.api_name?a.name=I18n.getMsg("crm.calendarbooking.field.location"):"What_Id"!==A.api_name&&"To_Number__s"!==A.api_name&&"Participants"!==A.api_name||("Events"===s&&"Participants"===A.api_name?a.name=I18n.getMsg("crm.calendarbooking.field.email"):"Calls"===s&&(a.name=I18n.getMsg("crm.calendarbooking.field.phone")));var S={};S.id=A.id,S.field_label=A.field_label,S.api_name=A.api_name,S.required=!0,a.field_detail=S,i.push(a)}}n.question_details=i,this.calendar_schedule=n},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(this.calendar_schedule)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(this.calendar_schedule)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),t&&t.queryParams&&"team"===t.queryParams.type&&"Events"===t.queryParams.module&&$("#selectedusersEvents")[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")}))},didConnect:function(){thirdPartyUtils.bindSelect2("select")}}),Lyte.Router.registerRoute("crm.settings.section.booking.edit-booking",{queryParams:["type","module"],getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_preferences")],ResourceConstants.CRM)},model:function(e){var t=e.queryParams,r=networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule/"+this.getDynamicParam(),"GET"),s={module:t.module},n=networkUtils.lyteInitiateRequest("/crm/v4/settings/layouts","GET",{params:s}),i=networkUtils.lyteInitiateRequest("/crm/v4/settings/meeting","GET"),o=store.findAll("user_group"),a=store.findAll("territory");return Lyte.resolvePromises({calendar_Res:r,fieldObj:n.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:i,groups:o,territories:a.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories},this.calObj=calendarSchedule.getCalendarScheduleObj(e,t),t.queryParams.type=this.calObj.schedule_type},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(this.calObj)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(this.calObj)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");if(r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),e.calendar_Res.calendar_schedule[0].active||$("#calsched_savebtn").attr("disabled",!0),this.calObj.userDisplayArr){var s=document.getElementById("addedUsers"+t.queryParams.module).querySelector("crux-user-dropdown");s.cxProp("selectedUsers",this.calObj.userDisplayArr),s.cxProp("selected",this.calObj.userIdArr)}t&&t.queryParams&&"team"===t.queryParams.type&&$("#selectedusers"+t.queryParams.module)[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")}))}}),Lyte.Router.registerRoute("crm.settings.section.booking.index",{model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule","GET")},renderTemplate:function(e){return e.isPersonalAccount=Crm.userDetails.PERSONAL_ACCOUNT,Handlebars.registerPartial("EmailSignature",Handlebars.templates.EmailSignature),{outlet:"#result",html:Handlebars.templates.ManageCalendarSchedule(e)}}}),Lyte.Router.registerRoute("crm.settings.section.booking",{getResources:function(){if(isnewCalendarBookingEnabled)var e=networkUtils.returnDependencyFiles(["zohocrm_calendarSchedule.js",networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM);else e=networkUtils.returnDependencyFiles(["zohocrm_calendarSchedule.js","i18n/"+Crm.userDetails.jsLocation+"calendarbooking/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.RELEVANT_LOCALE)+".js"],ResourceConstants.CRM);return e},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule","GET")},renderTemplate:function(e){return e.isPersonalAccount=Crm.userDetails.PERSONAL_ACCOUNT,Handlebars.registerPartial("EmailSignature",Handlebars.templates.EmailSignature),calendarSchedule.isBusinessHoursCreated=e.info.business_hours_configured,{outlet:"#result",html:Handlebars.templates.ManageCalendarSchedule(e)}},actions:{onError:function(e,t){return renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort(),!1}},redirect:function(){if("crm.settings.section.booking"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.booking.index"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.business-hours.create-shift-hours",{forceFetch:!1,model:function(){var e=Lyte.registeredMixins["business-hours-utils"];if(!e.unifiedBusinessHourscheck()){var t=store.peekAll("businesshours_timezone"),r=store.peekAll("business_hours")[0];return void 0===t||void 0===r?Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V2.2"})}):{timezone:t,business_hours:r,permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V2.2"})}}CrmPlusLib.businesshours("post",void 0,e.crmPlusCallBack)},afterModel:function(e){e.permissions[0].profile.permissions_details.filter((function(e){return e.name.indexOf("Crm_Implied_Manage_Users")>-1}))[0].enabled||(this.transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo("crm.settings.section.business-hours.index")})));var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck()){if(t.CrmBusinessHours.createRendering=!0,$u.isEmpty(t.CrmBusinessHours.timeZoneMapNew))for(var r=e.timezone.timezone.length,s=e.timezone.timezone,n=0;n<r;n++){var i=s[n],o=Object.keys(i);t.CrmBusinessHours.timeZoneMapNew[o]=i[o]}if(e.business_hours){var a=store.createRecord("shift_hours"),l={shift_hours:{}},c=t.getAllDaysinBH();l.shift_hours.weekdays=c,l.shift_hours.edit=!1,t.constructInitialShiftHoursValue(l.shift_hours,e.business_hours);var u=e.business_hours;"24*7"===u.type?l.shift_hours.business_days=c:l.shift_hours.business_days=$.map(u.business_days,(function(e){return e})),t.CrmBusinessHours.isShiftEdit=!1,l.shift_hours.timeZone=t.CrmBusinessHours.timeZoneMapNew,l.shift_hours.timezone=Crm.userDetails.orgTimeZone,l.shift_hours.is24hrsFmt=t.CrmBusinessHours.is24HrsFrmt,l.shift_hours.from="createShift",t.CrmBusinessHours.nextUsers=[],l.shift_hours.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours.1");var d={from:"createShift",edit:!1,isNewShift:!1,userType:"activeusers",scopeSelector:'{"scope":".searchBody","search":"lyte-td.userName","target":".searchRow"}',noUsers:!0},m=t.showUserView(d,"none");a.$.set(l.shift_hours),l.shift_hours.id=a.id,e.shiftHours=l.shift_hours,e.crmShiftUserView=m;var p=l.shift_hours.shift_days;e.shiftHoursSelectedDays=p,e.firstBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.secBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalShiftSelectDays=JSON.parse(JSON.stringify(p)),e.originalfirstBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalsecBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalHiddenDay=[];for(var g=t.getAllDaysinBH(),f=0;f<7;f++)-1===e.shiftHoursSelectedDays.indexOf(g[f])&&e.originalHiddenDay.push(g[f]);e.hiddenDay=JSON.parse(JSON.stringify(e.originalHiddenDay))}else renderingUtils.displayPermissionDenied()}},renderTemplate:function(){if(!Lyte.registeredMixins["business-hours-utils"].unifiedBusinessHourscheck())return{outlet:"#result",component:"crm-create-shift-hours"}},afterRender:function(){var e=Lyte.registeredMixins["business-hours-utils"];e.unifiedBusinessHourscheck()||(e.CrmBusinessHours.is24HrsFrmt=e.checkUserTimeFormatis24hrs(),e.CrmBusinessHours.createRendering=!1,$("#overlayHeader,#settingInner").hide(),document.querySelector("crm-create-shift-hours").component.executeMethod("enableOrDisableSaveBtn"),$("#shiftname").focus(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours.1"),Crm.partnerName])))},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("businesshours_timezone")},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.business-hours.edit-shift-hours",{model:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck())return store.unloadAll("business_hours"),store.unloadAll("shift_hours"),store.unloadAll("businesshours_timezone"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findRecord("shift_hours",e.dynamicParam),permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V2.2"})});CrmPlusLib.businesshours("put",e.dynamicParam,t.crmPlusCallBack)},afterModel:function(e){e.permissions[0].profile.permissions_details.filter((function(e){return e.name.indexOf("Crm_Implied_Manage_Users")>-1}))[0].enabled||(this.transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo("crm.settings.section.business-hours")})));var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck())if(e.shift_hours[0]){if($u.isEmpty(t.CrmBusinessHours.timeZoneMapNew))for(var r=e.timezone.timezone.length,s=e.timezone.timezone,n=0;n<r;n++){var i=s[n],o=Object.keys(i);t.CrmBusinessHours.timeZoneMapNew[o]=i[o]}t.CrmBusinessHours.createRendering=!0,t.CrmBusinessHours.is24HrsFrmt=t.checkUserTimeFormatis24hrs();var a={};e.shift_hours.hasOwnProperty("id")?(a.shift_hours=[],a.shift_hours.push(e.shift_hours)):a.shift_hours=e.shift_hours,a.shift_hours[0].weekdays=t.getAllDaysinBH(),a.shift_hours[0].timeZone=t.CrmBusinessHours.timeZoneMapNew,a.shift_hours[0].is24hrsFmt=t.CrmBusinessHours.is24HrsFrmt,a.shift_hours[0].edit=!0;var l=a.shift_hours[0].shift_days,c=a.shift_hours[0];c.edit=!0,t.CrmBusinessHours.isShiftEdit=!0;var u={};t.correctServerData(c,e.business_hours);var d,m,p,g=c.break_hours,f=!1,h=!0;if(c.same_as_everyday?d="SAE":(f=!0,h=!1,d="DHE"),g&&g.length>0){for(var y=g.length,C=0;C<y;C++)"-1"===g[C].breakvalue?u[C]="-1":u[C]=g[C].same_as_everyday?"SHE":"DHE";"-1"===g[0].breakvalue&&"-1"===g[1].breakvalue&&(c.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours.1"),c.noBreakHours=!0),"-1"!==g[0].breakvalue&&(c.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours.1")+" 1",c.break_hours[1].label_name=I18n.getMsg("crm.label.break.hours.1")+" 2")}m=c.break_hours[0].break_days?a.shift_hours[0].break_hours[0].break_days:l,p=c.break_hours[1].break_days?a.shift_hours[0].break_hours[1].break_days:l;var v=e.business_hours;"24*7"===v.type?c.business_days=t.getAllDaysinBH():c.business_days=$.map(v.business_days,(function(e){return e})),e.shiftHours=c,e.shiftHoursSelectedDays=l,e.shiftTimePart=f,e.SaeTime=h,e.firstBreakDaysCheckBox=m,e.secBreakDaysCheckBox=p,e.breakIdxVsType=u,e.shiftHoursType=d,e.originalShiftSelectDays=JSON.parse(JSON.stringify(e.shiftHours.shift_days)),e.originalfirstBreakDaysCheckBox=JSON.parse(JSON.stringify(m)),e.originalsecBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalHiddenDay=[];var _=t.getAllDaysinBH();for(C=0;C<7;C++)-1===e.shiftHoursSelectedDays.indexOf(_[C])&&e.originalHiddenDay.push(_[C]);e.hiddenDay=JSON.parse(JSON.stringify(e.originalHiddenDay))}else e.permissionDenied=!0},renderTemplate:function(e){if(e.permissionDenied&&(e.shiftAlertMsg=I18n.getMsg("crm.shift.delete.alert"),e.shiftAlertMsgShow=!0),!Lyte.registeredMixins["business-hours-utils"].unifiedBusinessHourscheck())return{outlet:"#result",component:"crm-create-shift-hours"}},afterRender:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck()&&!e.permissionDenied){var r=document.querySelector("crm-create-shift-hours").component;r.setData("shiftSubmit",!0),$("#createSftForm").change((function(){var e=$("#createSftForm"),t=$("#userDetails").data("changed");e.data("changed")||t||e.data("changed",!0)}));var s=$("#shiftname");s.keypress((function(e){var t=$("#shiftsubmit");$("#shift_errMsg").hide(),13===e.keyCode&&renderingUtils.triggerEvent("click",t)})),t.CrmBusinessHours.is24HrsFrmt=t.checkUserTimeFormatis24hrs(),t.CrmBusinessHours.createRendering=!1,r.executeMethod("enableOrDisableSaveBtn","fromEdit"),s.focus(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours.1"),Crm.partnerName]))}},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("shift_hours");var e={fields:"name,timezone,details,break_hours,holiday,shiftCountDet"};Lyte.registeredMixins["business-hours-utils"].clearCacheQuery("shift_hours",this.getDynamicParam(),e)},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.business-hours.index",{model:function(e){return store.unloadAll("business_hours"),store.unloadAll("shift_hours"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findAll("shift_hours"),features:store.findAll("features",{api_names:"shift_hours"}),permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V2.2"})})},afterModel:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(e.business_hours&&"NO_PERMISSION"===e.business_hours.code)return e.permissionDenied=!0,void renderingUtils.displayPermissionDenied();e.business_hours||(e.business_hours={}),e.timezone.timezone.find((function(e){var r=Object.keys(e);t.CrmBusinessHours.timeZoneMapNew[r]=e[r]})),e=t.renderBusinessHours(e),t.CrmBusinessHours.hasManageUserPermission=e.permissions[0].profile.permissions_details.filter((function(e){return e.name.indexOf("Crm_Implied_Manage_Users")>-1}))[0].enabled,t.CrmBusinessHours.shiftHoursLimit=e.features[0].details.limits.total},renderTemplate:function(e){if(!e.permissionDenied)return{outlet:"#result",component:"crm-business-hours",reRender:!0}},afterRender:function(e){e.permissionDenied||(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours.1"),Crm.partnerName])),Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.is24HrsFrmt=Lyte.registeredMixins["business-hours-utils"].checkUserTimeFormatis24hrs())},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.business-hours.view-shift-hours",{model:function(){return store.unloadAll("business_hours"),store.unloadAll("businesshours_timezone"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findRecord("shift_hours",this.getDynamicParam()),permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V2.2"})})},afterModel:function(e){var t=e.permissions[0].profile.permissions_details.filter((function(e){return e.name.indexOf("Crm_Implied_Manage_Users")>-1}))[0].enabled;if(e.shift_hours[0]){e.timezone.timezone.find((function(e){var t=Object.keys(e);Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.timeZoneMapNew[t]=e[t]}));var r=Lyte.registeredMixins["business-hours-utils"];r.CrmBusinessHours.isShiftEdit=!1;var s=e,n=s.shift_hours[0];r.modificationInShiftHoursRes(n,!1);var i=n.break_hours;if(i&&i.length>0)for(var o=i.length,a=0;a<o;a++)r.modificationInShiftHoursRes(i[a],!0);var l=n,c=r.getAllMonthsList(),u=r.getAllDays(),d=l.holiday.length;for(a=0;a<d;a++)for(var m=l.holiday[a],p=m.details.length,g=0;g<p;g++){var f=m.details[g].date.split("-"),h=Number(f[1]);l.holiday[a].details[g].day=f[2]+" "+c[h-1],l.holiday[a].details[g].days=I18n.getMsg(u[new Date(f[0],f[1]-1,f[2]).getDay()])}l.timezonename=r.CrmBusinessHours.timeZoneMapNew[l.timezone].longname;var y=e.business_hours;"24*7"===y.type?n.business_days=r.getAllDaysinBH():n.business_days=$.map(y.business_days,(function(e){return e})),e.shiftHoursDetailView=JSON.parse(JSON.stringify(n));var C={from:"editShift",edit:!1};C.id=n.id,C.name=n.name,C.userType="activeusers",C.scopeSelector='{"scope":".searchBody","search":"lyte-td.userName","target":".searchRow"}',C.assignMsg=I18n.getMsg("bh.shift.assigned.to.1");var v=e.shift_hours.$.meta;r.CrmBusinessHours.hasManageUserPermission=t;var _=n.users,R=!0;for(o=_.length,a=0;a<o;a++){var w=_[a];if(w.effective_from&&null!=w.effective_from){R=!1;break}}R||(C.isNewShift=!1),v&&v.hasOwnProperty("total_shift_with_user")&&v.total_shift_with_user>1&&v.hasOwnProperty("total_shift")&&v.total_shift>1?C.isNewShift=!1:(C.isNewShift=void 0)&&(C.isNewShift=!0),e.crmShiftUserView=r.showUserView(C),e.crmShiftUserView.hasShiftUser=s.shift_hours[0].users&&s.shift_hours[0].users.length>0,$L("#result").html("")}else e.permissionDenied=!0},renderTemplate:function(e){return e.permissionDenied&&(e.shiftAlertMsg=I18n.getMsg("crm.shift.delete.alert"),e.shiftAlertMsgShow=!0),{outlet:"#result",component:"crm-shift-hours-detail-view",reRender:!0}},afterRender:function(e){if(!e.permissionDenied){for(var t=$L(".BreakHours"),r=t.length,s=0;s<r;s++)t.eq(s).find(".breakBdrRem").last().removeClass("br_bottom_border4");this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours.1"),Crm.partnerName]))}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.business-hours",{getDependencies:function(){return networkUtils.returnDependencyFiles(["features_model.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.orgTimeZone||(this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.company-details"))},getResources:function(){var e=networkUtils.returnDependencyFiles(["businessHoursCommon.js","crm-detail-view-services.js","businessHoursmixin.js","services-businesshours.js","shift_hours_model.js","business_hours-model.js","crmbusinesshourswrapper.js","crux-user-view.js","holidays-model.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-rtl.css","crux-user-view.css"],ResourceConstants.CRMClient))),(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-shift.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper.css","crux-user-view.css"],ResourceConstants.CRMClient))},redirect:function(){if("crm.settings.section.business-hours"===this.transition.target){var e=this.transition.data;this.transition.target="crm.settings.section.business-hours.index",this.replaceWith({route:"crm.settings.section.business-hours.index"}).data=e}},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("shift_hours"),store.unloadAll("businesshours_timezone"),store.unloadAll("features",{api_names:"shift_hours"})}}),Lyte.Router.registerRoute("crm.settings.section.cadences.create-series-config",{renderTemplate:function(){return this.renderForSideMenu(),{outlet:"#result",component:"crm-series-detail"}},afterModel:function(){model.series_data=this.transition.data,setTimeout((()=>{var e=$L("#setup_new_ContentDiv").height();e-=$(".seriesHeader").outerHeight(),$L(".wfSeriesContent").css("height",e+10),$L(".srsSectionCont").css("height",e-40)}),100)},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.cadences.crm-series-showfunnel",{getResources:function(){return networkUtils.returnDependencyFiles(["lyte-connection.js","lyte-connection.elbow.js","series_mixin.js"],ResourceConstants.CRMClient)},queryParams:["action","module","name","id","createdBy"],beforeModel:function(){if(featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.addClass("dNImp"),t.addClass("primaryLeftPanelBr")}},renderTemplate:function(){return this.renderForSideMenu(),{outlet:"#result",component:"crm-series-showfunnel",reRender:!0}},model:function(e){var t=e.dynamicParam;if(""!==t)return this.getFunnelData(t)},afterModel:function(e){var t=$L("crm-series-headerdiv").e[0];if(void 0!==e.module){if(e.module=void 0===e.module?void 0===this.transition.data.module?this.getQueryParams().module:this.transition.data.module:e.module,void 0===moduleApiMapping[e.module]){for(var r=moduleDetailedInfo.modules.length,s=0;s<r;s++)if(moduleDetailedInfo.modules[s].api_name===e.module){e.module=moduleDetailedInfo.modules[s].plural_label;break}}else e.module=moduleRecordMapping[e.module].plural_label;e.name=void 0===e.name?void 0===this.transition.data.name?this.getQueryParams().name:this.transition.data.name:e.name,e.seriesId=void 0===e.seriesId?void 0===this.transition.data.serId?this.getQueryParams().id:this.transition.data.serId:e.seriesId,e.action=this.getQueryParams().action,e.createdBy=void 0===e.createdBy?void 0===this.transition.data.createdBy?this.getQueryParams().createdBy:this.transition.data.createdBy:e.createdBy,e.isListPage=void 0===this.transition.data.isListPage?this.getQueryParams().isListPage:this.transition.data.isListPage}void 0!==t&&(t.component.setData("showFunnelNeeded",!1),t.component.setData("show",!1))},afterRender:function(){var e=$L("crm-series-showfunnel")[0].component;$L(".srsFunnelTab").scroll(),$L(".srsDiv").scroll({preventHorizontal:!0}),$L(".srsWrapDiv").scroll({appendTo:"container"});var t=$("#setup_new_ContentDiv").height()-$(".seriesHeader").outerHeight()-120;$(".srsDiv").css("height",t),e.createPlugin(e),$(".lineConnection").css("width",e.getData("widthSize"));var r=e.getData("seriesFollowUps_arr");1!==Object.keys(r).length&&e.methods.connectLine(e.getData("parentvsrefId"),e,!1),e.refreshLineConection(!1,!0),document.querySelector("#setup_new_ContentDiv").classList.add("oH")},beforeExit:function(){document.querySelector("#setup_new_ContentDiv").classList.remove("oH")},actions:{willTransition:function(e){if(featuresAvailable.NEXTGENUI_ENABLED&&!this.isInternalRouteChange(e)){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.removeClass("dNImp"),t.removeClass("primaryLeftPanelBr")}this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["series_common"]}),Lyte.Router.registerRoute("crm.settings.section.cadences.crm-series-view-reports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-connection.js","lyte-connection.elbow.js","series_mixin.js","series_store.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient))},queryParams:["action","module","name","id","createdBy","previousType","from","to","filterDateType"],renderTemplate:function(){if(this.transition.data&&this.transition.data.isListPage&&this.renderForSideMenu(),featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.addClass("dNImp"),t.addClass("primaryLeftPanelBr")}return{outlet:"#result",component:"crm-series-reports",reRender:!1}},model:function(e){var t=e.dynamicParam,r=e.queryParams.from,s=!1;r&&(s=!0);var n=e.queryParams.to;return this.getReports(t,e.queryParams.action,r,n,s)},afterRender:function(){const e=$L("crm-series-reports");var t=e[0].component.getData("series_rules"),r=t.length;t=this.orderReports(t,r),e[0].component.setData("series_rules",t),document.querySelector("#setup_new_ContentDiv").classList.add("oH")},beforeExit:function(){document.querySelector("#setup_new_ContentDiv").classList.remove("oH")},afterModel:function(e){if(e.module=void 0===e.module?void 0===this.transition.data.module?this.getQueryParams().module:this.transition.data.module:e.module,void 0===moduleApiMapping[e.module]){for(var t=moduleDetailedInfo.modules.length,r=0;r<t;r++)if(moduleDetailedInfo.modules[r].api_name===e.module){e.moduleSysRefName=e.module,e.module=moduleDetailedInfo.modules[r].plural_label;break}}else e.moduleSysRefName=e.module,e.module=moduleRecordMapping[e.module].plural_label;var s=$L("crm-series-headerdiv").e[0];void 0!==s&&s.component.setData("showFunnelNeeded",!0),e.name=void 0===e.name?void 0===this.transition.data.name?this.getQueryParams().name:this.transition.data.name:e.name,e.seriesId=void 0===e.seriesId?void 0===this.transition.data.serId?this.getQueryParams().id:this.transition.data.serId:e.seriesId,e.action=this.getQueryParams().action,e.createdBy=void 0===e.createdBy?void 0===this.transition.data.createdBy?this.getQueryParams().createdBy:this.transition.data.createdBy:e.createdBy,e.isListPage=void 0===this.transition.data.isListPage?this.getQueryParams().isListPage:this.transition.data.isListPage;var n=this.getQueryParams().from,i=this.getQueryParams().to;if(e.isReload&&n&&i){e.selectedDate=this.getQueryParams().filterDateType;var o=$L.moment(n).toDate(),a=$L.moment(i).toDate();Utils.convertToUserTimezone(o),Utils.convertToUserTimezone(a),e.cusStartDate=Utils.convertDateToUserPattern(o,Crm.userDetails.DATE_PATTERN.toUpperCase(),!0),e.cusEndDate=Utils.convertDateToUserPattern(a,Crm.userDetails.DATE_PATTERN.toUpperCase(),!0)}setTimeout((function(){var t=$L("#alertReports"),r=$L("crm-series-headerdiv").e[0];void 0===r?Lyte.Component.render("crm-series-headerdiv",{module:e.module,name:e.name,seriesId:e.seriesId,createdBy:e.createdBy,isListPage:e.isListPage},"#setupshow"):("Call"===e.action?t=$L("#callsReports"):"Task"===e.action&&(t=$L("#taskReports")),r.component.setData("module",e.module),r.component.setData("name",e.name),r.component.setData("seriesId",e.seriesId),r.component.setData("isListPage",e.isListPage));var s=$L("crm-series-reports").e[0];if(void 0!==s){var n=!1;0!==e.series_rules.length&&(n=!0),s.component.setData("isRulesAvailInFilter",n),s=s.component,$L(".srsReports").removeClass("lyteTabActive"),"Task"===s.getData("action")?$L("#taskReports").addClass("lyteTabActive"):"Call"===s.getData("action")?$L("#callsReports").addClass("lyteTabActive"):t.addClass("lyteTabActive")}}),300);var l=e.series_rules,c=l.length,u=$L("crm-series-reports").e[0];u&&c>0&&u.setData("isRulesAvailInFilter",!0),"Task"===e.action&&void 0!==u&&(u.setData("series_rules",l),this.reportsTask(c,u)),"Call"===e.action&&void 0!==u&&(u.setData("series_rules",l),this.reportsCall(c,u)),"Alert"===e.action&&void 0!==u&&(u.setData("series_rules",l),this.reportsAlert(c,u)),"Alert"!==e.action&&"Call"!==e.action&&"Task"!==e.action&&this.redirectToListView({type:"error",msg:I18n.getMsg("crm.series.rule.not.exists")});var d=$L("#seriesReports");void 0!==d&&d.removeClass("lyteTabHide")},actions:{willTransition:function(e){if(this.setFilterDataInCurrRoute(e),featuresAvailable.NEXTGENUI_ENABLED&&!this.isInternalRouteChange(e)){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.removeClass("dNImp"),t.removeClass("primaryLeftPanelBr")}}},lyteConvertionSupported:!0},{mixins:["series_common"]}),Lyte.Router.registerRoute("crm.settings.section.cadences.edit-series-config",{getResources:function(){var e=networkUtils.returnDependencyFiles(["series_details.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-connection.js","lyte-connection.elbow.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["series_mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["series_store.js"],ResourceConstants.CRMClient))},renderTemplate:function(){if(this.renderForSideMenu(),featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.addClass("dNImp"),t.addClass("primaryLeftPanelBr")}return{outlet:"#result",component:"crm-series-detail",reRender:!0}},model:function(e){wfmergefield.initMergeFieldDetl("Series");var t={};return void 0!==this.getRecord?this.getRecord(e):store.findRecord("cadence",e.dynamicParam).then(function(e){return 0===Object.keys(e).length&&(this.redirectToListView({type:"error",msg:I18n.getMsg("crm.series.rule.not.exists")}),this.transition.abort()),t.series_data_arr=e,t.taskFieldMappings=store.findAll("field",{module:"Tasks",type:"all"},!1,!0,{apiVersion:"2.2"}).then((e=>(t.taskFieldMapping=e,t.taskFieldMapping)),(function(){commonUtils.showHideLoadingDiv()})),t.callFieldMappings=store.findAll("field",{module:"Calls",type:"all"},!1,!0,{apiVersion:"2.2"}).then((e=>(t.callFieldMappings=e,t.callFieldMappings)),(function(){commonUtils.showHideLoadingDiv()})),t.mergeFields=new Promise((t=>{let r=Object.keys(moduleRecordMapping).find((t=>moduleRecordMapping[t].api_name===e[0].module.api_name));wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(r,void 0,(()=>t))})),Lyte.resolvePromises(t)}.bind(this),(function(e){return commonUtils.showHideLoadingDiv(),403===e.status&&renderingUtils.displayPermissionDenied(),[]}))},actions:{didTransition:function(){var e=$L("crm-series-headerdiv").e[0];setTimeout((()=>{var e=$("#setup_new_ContentDiv").height();e=e-$(".seriesHeader").outerHeight()-70,$(".srsSectionCont").css("height",e)}),100),void 0!==e&&e.remove()},willTransition:function(e){if(this.setFilterDataInCurrRoute(e),featuresAvailable.NEXTGENUI_ENABLED&&!this.isInternalRouteChange(e)){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.removeClass("dNImp"),t.removeClass("primaryLeftPanelBr")}}},afterRender:function(){document.querySelector("#setup_new_ContentDiv").classList.add("oH");var e=this.transition.extraDetails;e&&e.data&&"{}"!==JSON.stringify(e.data)&&void 0!==e.data.msg&&void 0!==e.data.type&&this.displaySuccessOrErrorMsg(e.data.msg,e.data.type)},beforeExit:function(){document.querySelector("#setup_new_ContentDiv").classList.remove("oH")},lyteConvertionSupported:!0},{mixins:["series_common"]}),Lyte.Router.registerRoute("crm.settings.section.cadences.index-series",{queryParams:["module","active"],getDependencies:function(){return networkUtils.returnDependencyFiles(["series_mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["series_details.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Series")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["series-configs.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["series_store.js","lyte-hovercard.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM))},model:function(e){var t={};return void 0!==e.queryParams&&(void 0!==e.queryParams.module&&(t.module=e.queryParams.module),void 0!==e.queryParams.active&&(t.active=e.queryParams.active)),Lyte.resolvePromises({series_rules:store.findAll("cadence",t),rules_meta:this.initDefAPI()})},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0},afterModel:function(e,t){if(e.historyData={},t.queryParams&&void 0!==t.queryParams.module?(e.filteredModule=t.queryParams.module,e.historyData.module=t.queryParams.module):e.filteredModule="_allModules",t.queryParams&&void 0!==t.queryParams.active){var r=t.queryParams.active+""=="true"?"Active":"Inactive";e.selectedStatus=r,e.historyData.active=t.queryParams.active}else e.selectedStatus="Status";var s=[],n=[{api_name:"_allModules",displayLabel:I18n.getMsg("crm.label.AllModules")}];e.rules_meta.definition.supportedModules.forEach((function(e){s.push({api_name:moduleApiMapping[e],displayLabel:Lyte.Component.registeredHelpers.getDisplayModuleName(e,!1),module_name:e})}));var i={},o={};n=n.concat(objectUtils.cloneObject_new(s)),e.seriesModules=s,e.modFilterArr=n;var a=[],l=[],c=e.series_rules.length;e.isRulesAvailInFilter=c>0;for(var u=0;u<c;u++)o.hasOwnProperty(e.series_rules[u].id)||(o[e.series_rules[u].id]=e.series_rules[u].active,"draft"!==e.series_rules[u].status&&(o[e.series_rules[u].id]=!0)),l.contains(e.series_rules[u].id)||(e.series_rules[u].published||(i[e.series_rules[u].draftId]=e.series_rules[u].id,o[e.series_rules[u].draftId]=!1,l.push(e.series_rules[u].draftId)),a.push(e.series_rules[u]));var d=$L(".lyteStickyTable"),m=d.width();d.css("width",m);var p=$L("crm-series-headerdiv").e[0];$L(".setupleftmenutd").removeClass("hide");var g=$L(".setuprightmenudiv");g.removeClass("srsFunnelTopSpace"),void 0!==p&&(p.remove(),g.removeClass("srsFunnelTopSpace")),e.series_rules=objectUtils.cloneObject_new(a),e.modFilterArr=n,e.draftvsid=i,e.viewReportsNeeded=o;var f=this.transition.extraDetails;f&&f.highlight&&f.ruleId?this.setRecordsCount(e.series_rules,i,0,e,f):this.setRecordsCount(e.series_rules,i,0,e),this.transition.data||(this.transition.data={}),this.transition.data.historyData=e.historyData},renderTemplate:function(){return{outlet:"#result",component:"crm-series-config"}},beforeExit:function(){store.unloadAll("cadence")},afterRender:function(){var e=this.transition.extraDetails;if(e&&e.data&&"{}"!==JSON.stringify(e.data)&&void 0!==e.data.msg&&void 0!==e.data.type&&this.displaySuccessOrErrorMsg(e.data.msg,e.data.type),e&&e.highlight&&e.ruleId&&this.highlightSavedWFRule(e),featuresAvailable.NEXTGENUI_ENABLED){let e=$L(".crm-lftmnu-clpse"),t=$L(".ts-fxd-sc");e.removeClass("dNImp"),t.removeClass("primaryLeftPanelBr")}var t=$L("crm-series-config")[0];t&&t.component.calcTableHeight(t.component.data.series_rules)},actions:{onError:function(e){return this.routeErrorHandling(e,!0),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["series_common"]}),Lyte.Router.registerRoute("crm.settings.section.cadences",{getResources:function(){var e=networkUtils.returnDependencyFiles(["series_config.js","crux-lazyLoad.js","crm-customview-dropdown.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Series"),networkUtils.getI18nJSUrl("workflowalert"),networkUtils.getI18nJSUrl("createrecordaction")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["lyte-connection.js","lyte-connection.elbow.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["series-configs.css","crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM))},redirect:function(){if("crm.settings.section.cadences"===this.transition.target){var e=this.transition.data;this.transition.target="crm.settings.section.cadences.index-series",this.replaceWith({route:"crm.settings.section.cadences.index-series"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking",{lyteConvertionSupported:!0,getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["calendar-bookings-model.js","crm-calendar-booking-dependency.js","business_hours-model.js","org-model.js","features_model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-calendar-booking-mixin.js","crm-calendar-booking-form-mixin.js","crm-calendar-booking-helper.js","crm-calendar-booking-resources.js","crm-services-appointments.js","crux-column-list.js","crux-parent-form-component.js"],ResourceConstants.CRMClient);e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["crm-calendar-booking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles(["crm-list-view-crux.css"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(r=networkUtils.returnDependencyFiles(["crux-column-list-rtl.css"],ResourceConstants.CRMClient)),Crm.userDetails.isPhoneNoNewView&&(e=e.concat(Crm.returnPhoneFieldDependencyFiles())),e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js","crm-headless-components.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["lyte-ui-emoji.css"],ResourceConstants.CRMClient)),[...e,...t,...r]},beforeModel:function(){if(Crm.userDetails.RTL_ENABLED)return renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.index")})),void this.transition.abort();this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName]))},redirect:function(){if("crm.settings.section.calendar-booking"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.calendar-booking.index-calendar-booking"}).data=e}},actions:{onError:function(e,t){renderingUtils.displayPermissionDenied(),t.abort()},willTransition:function(e){var t=document.querySelector("crm-calendar-booking-create"),r=t?t.component:void 0;r&&r.data.doCheckForDiscardChanges&&(e.abort(),commonUtils.showHideLoadingDiv(),Lyte.registeredMixins["crm-calendar-booking-mixin"].showErrorPopup(I18n.getMsg("crm.label.cancel.call",I18n.getMsg("crm.setup.system.calendarbooking")),I18n.getMsg("crm.cb.dc",I18n.getMsg("crm.setup.system.calendarbooking")),[{type:"reject",appearance:"default",text:I18n.getMsg("Cancel"),cxPropZcqa:"Discard Cancel"},{type:"accept",appearance:"primary",text:I18n.getMsg("crm.label.yes"),cxPropZcqa:"Discard Ok"}],"warning",(function(){delete r.data.doCheckForDiscardChanges,Lyte.Router.transitionTo(e.info).data=e.data})))}},didDestroy:function(){delete Crm.calendar_booking}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking.clone-calendar-booking",{lyteConvertionSupported:!0,queryParams:["type","module"],getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["businesshours_timezone.js","currenciesDataStores.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["org-model.js","crm-calendar-booking-dropdowns.js","crm-create-calendar-booking.js","crux-lookupfilter-component.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_calendarbooking.js"],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["lyte-ui-duallistbox.css","crm-calendar-booking-create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].beforeLoadValidate(this.getQueryParams(),this.transition)},model:function(){var e;return e=Lyte.registeredMixins["crm-calendar-booking-mixin"].getReqObj(this.getQueryParams(),this.getDynamicParam(),"clone"),Lyte.resolvePromises(e).then(function(t){return t.calendar_bookingArr[0]?Lyte.registeredMixins["crm-calendar-booking-mixin"].handleService(t,e):{permissionDenied:!0,reason:I18n.getMsg("crm.portals.record.delete.message")}}.bind(this))},afterModel:function(e){e.typeOfView="clone",e.permissionDenied||Lyte.registeredMixins["crm-calendar-booking-mixin"].afterModalValidation(e,this)&&(this.getQueryParams().module===moduleApiMapping.Appointments&&"serviceRelatedList"===this.transition.data.from&&(e.serviceRelatedList=!0),e.cloneId=e.calendar_bookingArr[0].id,e.calendar_bookings=Lyte.registeredMixins["crm-calendar-booking-mixin"].getCloneRecord(e.calendar_bookingArr[0]),Lyte.registeredMixins["crm-calendar-booking-mixin"].createEditCloneAfterModel(e,this),Lyte.registeredMixins["crm-calendar-booking-mixin"].resetCanvasProp(e))},renderTemplate:function(){return{outlet:"#result",component:"crm-calendar-booking-create",reRender:!0}},afterRender:function(){store.clearCachedQuery("calendar_bookings_configuration"),delete document.querySelector("crm-calendar-booking-create").component.data.doCheckForDiscardChanges},actions:{onError:function(e,t){try{if(2===JSON.parse(e.responseText).details.resource_path_index)return renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.portals.record.delete.message"),void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),void t.abort()}catch(e){}renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking.create-calendar-booking",{lyteConvertionSupported:!0,queryParams:["type","module"],getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["businesshours_timezone.js","currenciesDataStores.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["org-model.js","crm-calendar-booking-dropdowns.js","crux-lookupfilter-component.js","crm-create-calendar-booking.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_calendarbooking.js"],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["lyte-ui-duallistbox.css","crm-calendar-booking-create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].beforeLoadValidate(this.getQueryParams(),this.transition)},model:function(){var e={};return(e=Lyte.registeredMixins["crm-calendar-booking-mixin"].getReqObj(this.getQueryParams(),this.getDynamicParam(),"create",this.transition.data)).calendarBookingConfiguration=app.store.makeRequest("findAll","calendar_bookings_configuration",{module:this.getQueryParams().module,required_payment_info:!1}),Lyte.resolvePromises(e).then((function(t){var r=t.calendarBookingConfiguration.service_modules?t.calendarBookingConfiguration.service_modules.mapByKey("api_name"):[];return r[0]?(e.mappedModuleLayouts=app.store.makeRequest("findAll","layout",{module:r.includes(moduleApiMapping.Contacts)?moduleApiMapping.Contacts:r[0]},void 0,void 0,{apiVersion:"2.2"}),Lyte.resolvePromises(e).then((function(e){return e}))):t}))},afterModel:function(e){if(e.typeOfView="create",e.tabModuleApiName=this.getQueryParams().module,!e.permissionDenied&&Lyte.registeredMixins["crm-calendar-booking-mixin"].afterModalValidation(e,this)){Lyte.registeredMixins["crm-calendar-booking-mixin"].createEditCloneAfterModel(e,this);var t=store.createRecord("calendar_bookings");t.$.set("booking_type",this.getQueryParams().type);var r={},s={};this.getQueryParams().module===moduleApiMapping.Events?s={id:moduleRecordMapping.Events.id}:this.getQueryParams().module===moduleApiMapping.Calls?s={id:moduleRecordMapping.Calls.id}:this.getQueryParams().module===moduleApiMapping.Appointments&&(s={id:moduleRecordMapping.Appointments.id},"serviceRelatedList"===this.transition.data.from&&(e.serviceRelatedList=!0)),t.$.set("module",s),r.availability_increment={period:"minutes",unit:30},e.availability_increment="30-minutes",r.minimum_notice={period:"days",unit:4},r.schedulable_range={period:"days",unit:7},r.max_same_slot_bookings="-1",r.max_per_day_bookings="-1",r.max_per_week_bookings="-1",r.buffer_after_booking={unit:"-1"},e.buffer_after_booking="-1",r.buffer_before_booking={unit:"-1"},e.buffer_before_booking="-1",r.allow_customer_choose_member=!1,e.donot_allow_customer_choose_location=!1,r.allow_customer_choose_location=!e.donot_allow_customer_choose_location,r.default_service_location="business_location",r.allow_customer_reschedule=!1,r.minimum_reschedule_notice={period:"days",unit:4},r.allow_customer_cancel=!1,r.minimum_cancel_notice={period:"days",unit:4};var n={};n=(this.getQueryParams().module,moduleApiMapping.Calls,{add_new_record:!1});var i=e.calendarBookingConfiguration.service_modules?e.calendarBookingConfiguration.service_modules.mapByKey("api_name"):[];n.mapped_module={id:!i[0]||i.includes(moduleApiMapping.Contacts)?moduleRecordMapping.Contacts.id:moduleRecordMapping[Utils.inverseKeyValues(moduleApiMapping)[i[0]]].id,name:!i[0]||i.includes(moduleApiMapping.Contacts)?moduleRecordMapping.Contacts.singular_label:moduleRecordMapping[Utils.inverseKeyValues(moduleApiMapping)[i[0]]].singular_label,api_name:!i[0]||i.includes(moduleApiMapping.Contacts)?moduleRecordMapping.Contacts.api_name:moduleRecordMapping[Utils.inverseKeyValues(moduleApiMapping)[i[0]]].api_name},n.add_new_record=!1,t.$.set("submitter_information",n),e.calendar_bookings=t;t.$.set("embed_property",{});t.$.set("canvas_prop",[]);var o=[],a={unit:30,period:"minutes",remind:"before"};if(e.reminder="30-minutes-before",t.$.set("reminder",a),this.getQueryParams().module===moduleApiMapping.Appointments){t.$.set("exclude_member",[]),this.transition.data&&this.transition.data.serviceId?(e.serviceRecord=e.serviceRecord[0],t.$.set("service",{id:e.serviceRecord.id}),e.serviceSelectedRecord={id:e.serviceRecord.id,name:e.serviceRecord.Service_Name},e.serviceMembers=e.serviceMembers?e.serviceMembers.data:[]):t.$.set("service",{}),e.appointmentsServiceNameField=e.tabModuleFields.filter((e=>"Service_Name"===e.api_name))[0];var l=e.unknownFields.filter((e=>"NAME"===e.column_name))[0];o.push({name:I18n.getMsg("Name"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:1,type:"modulemapped"}),l=e.unknownFields.filter((e=>"EMAIL"===e.column_name))[0],o.push({name:I18n.getMsg("Email"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:2,type:"modulemapped"}),l=e.unknownFields.filter((e=>"PHONE"===e.column_name))[0],o.push({name:I18n.getMsg("Phone"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!1,sequence_number:3,type:"modulemapped"})}else{if(t.$.set("assign_to",[]),r.duration={period:"minutes",unit:30},e.duration="30-minutes",e.hasBookingFields=!0,this.getQueryParams().module===moduleApiMapping.Events){l=e.tabModuleFields.find((e=>"Event_Title"===e.api_name));o.push({name:I18n.getMsg("Name"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:1,type:"booking"}),l=e.tabModuleFields.find((e=>"Participants"===e.api_name)),o.push({name:I18n.getMsg("Email"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:2,type:"booking"});l=e.tabModuleFields.find((e=>"Venue"===e.api_name));o.push({name:I18n.getMsg("Location"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:3,type:"booking"})}else if(this.getQueryParams().module===moduleApiMapping.Calls){l=e.tabModuleFields.filter((e=>"Subject"===e.api_name))[0];o.push({name:I18n.getMsg("Name"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:1,type:"booking"}),l=e.tabModuleFields.filter((e=>"What_Id"===e.api_name))[0],o.push({name:I18n.getMsg("Phone"),answer_population_field:Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(l),id:l.id,required:!0,sequence_number:2,type:"booking"})}}this.getQueryParams().module===moduleApiMapping.Events&&Lyte.registeredMixins["crm-calendar-booking-mixin"].processMeetingProvider(e),t.$.set("advanced_settings",r),t.$.set("question_details",o),e.search_field_display_name=I18n.getMsg("Email"),e.serviceRecord&&(e.serviceRecord.Location===e.service_businessandclientaddress?e.disableChoseLocChkbox=!1:e.serviceRecord.Location===e.service_clientaddress?(e.disableChoseLocChkbox=!0,e.donot_allow_customer_choose_location=!0,e.calendar_bookings.advanced_settings.allow_customer_choose_location=!e.donot_allow_customer_choose_location,e.calendar_bookings.advanced_settings.default_service_location="client_location"):(e.disableChoseLocChkbox=!0,e.donot_allow_customer_choose_location=!0,e.calendar_bookings.advanced_settings.allow_customer_choose_location=!e.donot_allow_customer_choose_location,e.calendar_bookings.advanced_settings.default_service_location="business_location"),e.serviceRecord.Tax=e.serviceRecord._$.original.Tax),$L("#setupshow .setupleftmenutd").addClass("hide")}},renderTemplate:function(){return{outlet:"#result",component:"crm-calendar-booking-create",reRender:!0}},afterRender:function(){store.clearCachedQuery("calendar_bookings_configuration"),delete document.querySelector("crm-calendar-booking-create").component.data.doCheckForDiscardChanges},actions:{onError:function(e,t){renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking.edit-calendar-booking",{lyteConvertionSupported:!0,queryParams:["type","module","edit_view"],getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["businesshours_timezone.js","currenciesDataStores.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["org-model.js","crm-calendar-booking-dropdowns.js","crux-lookupfilter-component.js","crm-create-calendar-booking.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_calendarbooking.js"],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["lyte-ui-duallistbox.css","crm-calendar-booking-create.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].beforeLoadValidate(this.getQueryParams(),this.transition)},model:function(){var e;return e=Lyte.registeredMixins["crm-calendar-booking-mixin"].getReqObj(this.getQueryParams(),this.getDynamicParam(),"edit"),Lyte.resolvePromises(e).then(function(t){return t.calendar_bookingArr[0]?Lyte.registeredMixins["crm-calendar-booking-mixin"].handleService(t,e,this.getQueryParams()):{permissionDenied:!0,reason:I18n.getMsg("crm.portals.record.delete.message")}}.bind(this))},afterModel:function(e){e.typeOfView="edit",e.permissionDenied||(e.calendar_bookings=e.calendar_bookingArr[0],e.originalcalendar_bookings=Lyte.registeredMixins["crm-calendar-booking-form-mixin"].getRequiredFieldData(e.calendar_bookings),e.isInCanvasViewFromEdit="canvas"===this.getQueryParams().edit_view,Lyte.registeredMixins["crm-calendar-booking-mixin"].createEditCloneAfterModel(e,this))},renderTemplate:function(){return{outlet:"#result",component:"crm-calendar-booking-create",reRender:!0}},afterRender:function(){store.clearCachedQuery("calendar_bookings_configuration"),delete document.querySelector("crm-calendar-booking-create").component.data.doCheckForDiscardChanges},actions:{onError:function(e,t){try{if(2===JSON.parse(e.responseText).details.resource_path_index)return renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.portals.record.delete.message"),void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),void t.abort()}catch(e){}renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking.index-calendar-booking",{queryParams:["module"],lyteConvertionSupported:!0,beforeModel:function(){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].beforeLoadValidate(this.getQueryParams(),this.transition)},model:function(){commonUtils.showHideLoadingDiv(!0);var e={},t={};return t=Lyte.registeredMixins["crm-calendar-booking-mixin"].getReqObj(this.getQueryParams(),this.getDynamicParam(),"index"),Lyte.registeredMixins["crm-calendar-booking-mixin"].isServiceAndAppointmentEnabled()?(e.module=moduleApiMapping.Appointments,t.calendarBookingConfiguration=app.store.makeRequest("findAll","calendar_bookings_configuration",{module:moduleApiMapping.Appointments}),t.appointmentsModule=app.store.makeRequest("findRecord","module",moduleRecordMapping.Appointments.id),t.checkoutOrg=app.store.makeRequest("findAll","checkout_org"),t.appointmentsInsights=app.store.makeRequest("triggerAction","calendar_bookings","insights",void 0,e)):(t.calendarBookingConfiguration=app.store.makeRequest("findAll","calendar_bookings_configuration"),e.module=moduleApiMapping.Events,t.meetingsInsights=app.store.makeRequest("triggerAction","calendar_bookings","insights",void 0,e)),Lyte.resolvePromises(t)},afterModel:function(e){commonUtils.showHideLoadingDiv(!1),Lyte.registeredMixins["crm-calendar-booking-mixin"].isServiceAndAppointmentEnabled()?(e.appointmentsInsights=e.appointmentsInsights.insights,e.enablePaymentDiv=!!e.checkoutOrg.id&&e.checkoutpaymentsupportwillbeinnextphase):e.meetingsInsights=e.meetingsInsights.insights;var t=this.getQueryParams().module;switch(this.transition.data&&this.transition.data.module&&(t=this.transition.data.module),t){case"Appointments__s":e.activeModule=moduleApiMapping.Appointments;break;case"Events":e.activeModule=moduleApiMapping.Events;break;case"Calls":e.activeModule=moduleApiMapping.Calls}$L("#setupshow .setupleftmenutd").removeClass("hide")},renderTemplate:function(){return{outlet:"#result",component:"crm-calendar-booking-main",reRender:!0}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.calendar.calendarschedule"),Crm.partnerName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].setHeightForTabs()},actions:{onError:function(e,t){renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.calendar-booking.view-calendar-booking",{lyteConvertionSupported:!0,queryParams:["type","module"],getResources:function(){commonUtils.showHideLoadingDiv(!0);var e=networkUtils.returnDependencyFiles(["zohocrm_calendarbooking.js"],ResourceConstants.CRM);e=e.concat(networkUtils.returnDependencyFiles(["crm-view-calendar-booking.js"],ResourceConstants.CRMClient));var t=networkUtils.returnDependencyFiles(["crm-calendar-booking-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.setup.system.calendarbooking"),Crm.appName])),Lyte.registeredMixins["crm-calendar-booking-mixin"].beforeLoadValidate(this.getQueryParams(),this.transition)},model:function(){var e={},t=Lyte.registeredMixins["crm-calendar-booking-mixin"].getReqObj(this.getQueryParams(),this.getDynamicParam(),"view");return e.module=this.getQueryParams().module,t.calendar_bookingArr=app.store.makeRequest("findRecord","calendar_bookings",this.getDynamicParam(),e),e.id=this.getDynamicParam(),t.insights=app.store.makeRequest("triggerAction","calendar_bookings","insights",void 0,e),e.module===moduleApiMapping.Appointments?(t.appointmentsModule=app.store.makeRequest("findRecord","module",moduleRecordMapping.Appointments.id),e.page=1,e.per_page=100,delete e.id,delete e.module,e.calendar_booking_id=this.getDynamicParam(),e.transaction_type="booked,rescheduled,cancelled",t.payments=app.store.makeRequest("findAll","calendar_booking_payments",e),t.calendarBookingConfiguration=app.store.makeRequest("findAll","calendar_bookings_configuration",{module:moduleApiMapping.Appointments}),t.checkoutOrg=app.store.makeRequest("findAll","checkout_org")):t.calendarBookingConfiguration=app.store.makeRequest("findAll","calendar_bookings_configuration"),Lyte.resolvePromises(t).then((function(e){return e.calendar_bookingArr[0]?e:{permissionDenied:!0,reason:I18n.getMsg("crm.portals.record.delete.message")}}))},afterModel:function(e){commonUtils.showHideLoadingDiv(!1),e.permissionDenied||(this.getQueryParams().module===moduleApiMapping.Appointments&&(e.enablePaymentDiv=e.calendar_bookingArr[0].booking_price_configuration.pre_payment_required&&e.checkoutpaymentsupportwillbeinnextphase),e.typeOfView="view",e.calendar_booking=e.calendar_bookingArr[0],e.calendaBookingId=e.calendar_booking.id,e.tabModuleApiName=e.calendar_booking.module.api_name,e.insights=e.insights.insights,e.insightsfilter={date_type:"untilNow",booking_form:{id:e.calendar_booking.id,full_name:e.calendar_booking.name},from_date:"",to_date:""},e.paymentfilter={date_type:"untilNow",booking_form:{id:e.calendar_booking.id,full_name:e.calendar_booking.name},from_date:"",to_date:"",type:"-1",page:1,per_page:200},$L("#setupshow .setupleftmenutd").removeClass("hide"))},renderTemplate:function(){return{outlet:"#result",component:"crm-calendar-booking-view",reRender:!0}},afterRender:function(e){if(!e.permissionDenied){store.clearCachedQuery("calendar_bookings_configuration");var t=$("#bookingdetailView_CB"),r=$L(".online-booking-detail-head"),s=r.offset().top+r.outerHeight();t.height(renderingUtils.windowHeight-s-75)}},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-calendar-booking-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},actions:{onError:function(e,t){try{if(2===JSON.parse(e.responseText).details.resource_path_index)return"serviceRelatedList"===t.data.from?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.portals.record.delete.message"),void 0,void 0,(function(){history.back()})):renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.portals.record.delete.message"),void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),void t.abort()}catch(e){}renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings")})),t.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.canvasrules",{queryParams:["ruleId"],getDependencies:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","zia_call_analytics_config.js"],ResourceConstants.CRMClient))},getResources:function(){var e=[networkUtils.getI18nJSUrl("crossorgs"),networkUtils.getI18nJSUrl("emailsummary"),networkUtils.getI18nJSUrl("crrl"),networkUtils.getI18nJSUrl("salesnavigator"),networkUtils.getI18nJSUrl("emailsForAllModules")],t=[];return t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-manage-canvasrules.js","crux-lookupfilter-component.js","crux-column-list.js","crm-detailview-common-footer.js","crm-canvas-editor-component.js","crux-textautocomplete-options.js","series_entityseries.js","crm-canvasview.js","crm-tag.js","crm-skype-field.js","crm-zexpense-rl.js","crm-subscription-rl.js","crm-feed-follower-datastore.js","crm-follower.js","crm-inventory-detail-view.js","crm-email-field.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","zia/prediction/builder/field-prediction-result.js","zia/prediction/builder/churn-prediction-result.js","zia/scoring_rule/zia-score-result.js","nba-detail-page.js","crm-image-mixin.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","zia-notification-settings.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-macro.js","macro-model.js","crm-column-list.js","crm-attachments.js","crm-activity-rel.js","crm-list-helpers.js","crux-video.js","lyte-colorbox.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-tag-modal.js","crm-tag-mixin.js","delete-popup.js","crm-social-convo-inner-new.js","recommendation-util.js","crm-cloud-picker-mixin.js","zia_reminder_model.js","admin-email-sharing-model.js","email-sharing-alert.js","crm-emailconversation-view.js","crm-emailconversation-view-helpers.js","crm-email-rl-filter.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js","crm-circuits-helper.js","crm-circuits-mixin.js","crm-circuits-rl-label.js","crm-zdesk-rl-label.js","crm-detail-canvas-common-files.js","crm-social-integ-outer-template.js","crm-activity-rel-wrapper.js","crux-note.js","crm-manage-canvasrules.css","crm-canvas-criteria.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js","zohocrm_clientPortalMiscFuncs.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-zia-call-analytics.css","crm-zia-call-transcription.css","zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){var e=this,t=store.peekAll("module").filter((function(e){return"team_based"===e.access_type&&e.private_profile&&"Admins"===e.private_profile.name}))[0];if(Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||t||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort()),this.getQueryParams().ruleId)return store.findRecord("canvas_rule",this.getQueryParams().ruleId).then((function(e){return store.findRecord("module",e[0].module.id,void 0,!1,!0,{getFields:!0})})).catch((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.auditlog.canvasrules","Canvas"))),e.transition.abort()}))},model:function(){var e=this,t=[];if(t.push(app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:100})),this.getQueryParams().ruleId){var r=store.peekRecord("canvas_rule",this.getQueryParams().ruleId).module.id;t.push(store.findRecord("module",r,void 0,!1,!0,{getFields:!0})),t.push(store.findAll("field",{module:store.peekRecord("module",r).api_name,type:"Unused"}))}return Lyte.resolvePromises(t).then((function(e){var t=[];return e[1]&&e[1][0].fields&&e[1][0].fields.length>0&&((t=e[1][0].fields.slice(0)).map((function(e){e.unused&&delete e.unused})),e[2]&&e[2].length>0&&e[2].map((function(e){e.unused=!0,t.push(e)}))),{canvasrules:e[0],fields:t}})).catch((function(){e.transition.abort(),renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.access.denied"))}))},renderTemplate:function(){return{outlet:"#result",component:"crm-manage-canvasrules"}},afterRender:function(e){if(this.getQueryParams().ruleId){$L("crm-manage-canvasrules")[0].component.setData("createcanvasrule",!0);var t=store.peekRecord("canvas_rule",this.getQueryParams().ruleId),r=moduleRecordMapping[objectUtils.getMatchedKey(moduleApiMapping,t.module.api_name)],s=document.getElementById("canvascriteriaeditor");$L("#canvas_criteria_name").val(t.name).attr("data-zcid",t.zcid),$L("#modulesId")[0].component.setData("ltPropSelected",r.module_name),s.setData("cxPropFields",e.fields.slice(0)),s.setData("cxPropSetCriteria",t.criteria),document.querySelector("crm-canvas-criteria").setData("moduleOpen",!0)}Crm.client_tracking("Manage Canvas Rule Click")}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.detailview.views",{queryParams:["feature","layout_id"],beforeModel:function(){var e=store.peekAll("module").filter((function(e){return"team_based"===e.access_type&&e.private_profile&&"Admins"===e.private_profile.name}))[0];Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||e||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort());var t=[];return!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&t.push(this.getAccountConfiguration()),Lyte.resolvePromises(t)},model:function(){var e=this,t=e.transition.info.queryParams,r=!(!t||!t.layoutId),s={include_inner_details:"layout.display_label",feature:""!==t.feature&&t.feature?t.feature:"DetailView"};if(r){var n=e.transition.info.queryParams.module,i=e.transition.info.queryParams.layoutId;s.module=n,s.layout_id=i}return app.store.makeRequest("findAll","canvasview",s).then((function(e){return{views:e}})).catch((function(t){Lyte.registeredMixins["crm-detailcanvas-utils"].errorHandling(t),e.transition.abort()}))},afterModel:function(e){var t=this.transition.info.queryParams;e.feature=t.feature?t.feature:"DetailView";var r="DetailView"===e.feature?"detailview_customization":"mobiledetailview_customization";if(store.findAll("features",{api_names:r},!0,!0).then((function(t){var r=t[0].details.limits.total;e.maxViewLimit=r})),e.views.length<=0)return app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:1}).then((function(t){t.length>0&&(e.canvasRuleAvail=!0)})).catch((function(){}))},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder",reRender:!0}}},{mixins:["crm-abm-utils"]}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.detailview",{queryParams:["feature"],renderTemplate:function(){if(Crm.userDetails.CANVAS_MOBILE_SUPPORT){var e=this.transition.target;return crmSetup.setupObject[e].sub_menus&&(this.currentModel=crmSetup.getChildSubTabData(e)),{outlet:"#inner_result",component:"crm-canvas-builder-subtab"}}},beforeExit:function(){"undefined"!=typeof createStruture&&delete createStruture.doc}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.formview",{queryParams:["feature"],getResources:function(){var e=[];return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-canvasform.js","crm-formview-mixin.js","crm-canvas-common.js","crm-phone-field.js","crm-create-dependent-resources.js","crm-create-fields.js","crm-create-resources.js","crm-create-pricingdetails.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js","crm-canvas-form.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["canvas-formview-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(){var e=this,t=null;if(!(!e.transition.info.queryParams||!e.transition.info.queryParams.layoutId)){var r=e.transition.info.queryParams.module,s=e.transition.info.queryParams.layoutId;t=app.store.makeRequest("findAll","canvasview",{include_inner_details:"layout.display_label",module:r,feature:"FormView",layout_id:s})}else t=app.store.makeRequest("findAll","canvasview",{include_inner_details:"layout.display_label",feature:"FormView"});return t.then((function(e){return{views:e}})).catch(function(){Lyte.Router.transitionTo({route:"crm.settings.index"})}.bind(this))},afterModel:function(e){e.feature="FormView"},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder"}},beforeExit:function(){Lyte.registeredMixins["crm-create-init-mixin"].removeCanvasFormViewResources()}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.listview",{queryParams:["feature"],model:function(){this.getQueryParams();return Lyte.resolvePromises({views:store.findAll("canvasview",{feature:"ListView"})})},afterModel:function(e){if(e.feature="ListView",e.views.length<=0)return app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:1}).then((function(t){t.length>0&&(e.canvasRuleAvail=!0)})).catch((function(){}))},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder"}},afterRender:function(){if(featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var e=document.querySelector("crm-canvas-builder");if(e&&e.component&&(e.component.actions.showCreatePopup(),this.transition.data.module&&this.transition.data.module.module_name)){var t=document.querySelector("crm-create-canvas-popup");t&&t.component&&t.component.methods.onModuleSelected(null,this.transition.data.module.module_name)}}}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.wizardview",{getResources:function(){var e=["crm-canvas-listview.js","crm-canvasform.js","crm-circuits-helper.js","crm-circuits-mixin.js","crm-circuits-rl-all.js","crm-circuits-rl-label.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-canvasview.js","crm-inventory-detail-view.js","crm-skype-field.js","crm-phone-field.js","crm-recommendation-details-newview.js","similarity-details-page.js","nba-detail-page.js","setup/orchestration/crm-orchestration-detailview-pop.js","setup/pathfinder/crm-pathfinder-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-email-field.js","crm-emails-related-list.js","email-emotions.js","zia-notification-settings.js","crm-rl-share-email.js","email-summary.js","social_related_list_store.js","recommendation-detailed-main.js","crm-image-preview.js","crm-related-list-view-header.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","macro-model.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-activity-rel.js","crm-tag.js","crm-tag-modal.js","delete-popup.js","crm-social-convo-inner-new.js","recommendation-util.js","crm-detailview-common-footer.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js","crm-canvas-common.js","user_type.js","crm-folder-sharing.js","crm-canvasview.js","crm-approval-process-menu.js","crm-approval-process-rejectorlistshow.js","crm-approval-process-rejectorlistshow.css","crm-formview-mixin.js","crm-image-mixin.js","crm-tag-mixin.js","crm-cloud-picker-mixin.js","crm-list-helpers.js","crm-tag-helpers.js","crm-wizard-configuration-helpers.js","zia-helpers.js","zia-insights.js","zia/prediction/builder/field-prediction-result.js","zia/prediction/builder/churn-prediction-result.js","crux-criteria-component.js","crux-criteria-conditions.js","crux-tag.js","crux-color-palette.js","crux-video.js","crux-note.js","lyte-colorbox.js","lyte-colorpicker.js"],t=["zohocrm_lookupBusinessCard.js","zohocrm_detailview_canvas.js","zohocrm_emailTrackingStatus.js","zohocrm_detail_canvas_common.js","gdprDetailview.css","zohocrm_customnew.js","zohocrm_fol.js","zohocrm_Sales_Navigator.js","crm_finance_suite.js","zcrm_customization.js"],r=[networkUtils.getI18nJSUrl("zdeskrelatedlist"),networkUtils.getI18nJSUrl("scoringRulesChart"),networkUtils.getI18nJSUrl("circuits"),networkUtils.getI18nJSUrl("salesnavigator"),networkUtils.getI18nJSUrl("detailview"),networkUtils.getI18nJSUrl("AutoEnrichment"),networkUtils.getI18nJSUrl("SimilarityRecommendation"),networkUtils.getI18nJSUrl("NextBestAction"),networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("crossorgs"),networkUtils.getI18nJSUrl("emailsummary"),networkUtils.getI18nJSUrl("emailsRelatedList"),networkUtils.getI18nJSUrl("Recommendation-detail")];t=t.concat(networkUtils.includeChartFiles()),t=Crm.userDetails.detailView_newUI?t.concat(["zcrm_dataprivacy_view_new.js"]):t.concat(["zcrm_dataprivacy_view.js"]),Crm.userDetails.RTL_ENABLED&&(e=e.concat(["crm-circuits-rtl.css"]),t=t.concat(["zcanvas-rtl.css"])),Crm.userDetails.isSegmentationEnabled&&(e=e.concat(["related-list-rfm.js","segmentation-utils.js","related-list-rfm.css"]),r=r.concat([networkUtils.getI18nJSUrl("segmentation")])),CScriptLib&&(e=e.concat(["crm-canvas-cscript-handler.js"]));var s=[];return["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals"),networkUtils.getI18nJSUrl("portalmisc")],""))),s=(s=(s=(s=(s=(s=s.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","crm-list-view-crux.css","crm-phone-field.css","crm-circuits-rl-all.css"],ResourceConstants.CRMClient)}])).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["canvas-detailview-less.css","zia/prediction/builder/field-prediction-result.css","zia/prediction/builder/churn-prediction-result.css","recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(){return Lyte.resolvePromises({views:this.fetchCanvasViewsForWizard(1,this,[]),wizards:store.findAll("wizard")})},afterModel:function(e){if(e.feature="WizardView",e.views.length<=0)return app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:1}).then((function(t){t.length>0&&(e.canvasRuleAvail=!0)})).catch((function(){}))},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder"}},fetchCanvasViewsForWizard:async function(e,t,r){return await store.findAll("canvasview",{feature:"WizardView",page:e}).then((function(s){return s.length&&(1===e?r=s:s.forEach((e=>{r.push(e)})),s.$.meta.more_records)?t.fetchCanvasViewsForWizard(e+1,t,r):r})).catch((function(e){if(e){switch(JSON.parse(e.responseText).code){case"FEATURE_NOT_SUPPORTED":renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.label.cf.error.feature.unsupported"));break;case"FEATURE_NOT_ENABLED":case"NOT_ALLOWED":renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error"))}t.transition.abort()}}))},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["canvasview_model.js","features_model.js","crm-canvasrule-model.js"],ResourceConstants.CRMClient);return!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-abm-configuration.js"],ResourceConstants.CRMClient))),e},getResources:function(){var e=[networkUtils.getI18nJSUrl("customization")],t=[];return t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-canvas-builder.js","crm-canvas-import-button.js","crm-canvas-export.js","crm-canvas-rename-popup.js","crm-canvas-core.js","crm-detailcanvas-utils.js","crm-canvas-helpers.js","crm-detail-view-utils.js","crm-inventory-detail-view.js","crm-canvas-common-utils.js","crm-canvas-builder.css","crm-canvas-rename-popup.css","crm-uploadfields-mixin.js","crux-image-upload.js","canvasSubTab.js","crm-setup-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-canvas-export.css","crux-file-upload-component.css","crm-file-upload-component.css","crux-image-component.css","crm-image-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRM))},afterRender:function(){Customization&&(Customization.dropCache=!0)},beforeExit:function(){Customization&&(Customization.dropCache=!0)}}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule.index-case-escalation-rule",{model:function(e){var t={params:{pageTitle:"crm.pricing.case.escalation.rules",isFromBack:!0,action:"viewEscRules"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CaseEscalation.do","POST",t)},afterModel:function(e,t){},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){},beforeExit:function(){}}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule.view-case-escalation-rule",{queryParams:["entryId"],model:function(e){var t=this.getQueryParams()?this.getQueryParams().entryId:null,r=this.getDynamicParam(),s={};t?(s={action:"viewEscalationsOfEscRuleEntry",ruleId:r,entryId:t,isFromBack:!0},Object.keys(this.transition.data).length&&(s.ruleName=this.transition.data.ruleName)):s={action:"viewEscRuleEntries",ruleId:r,isFromBack:!0};var n={params:s};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CaseEscalation.do","POST",n)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule",{redirect:function(){if("crm.settings.section.case-escalation-rule"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.case-escalation-rule.index-case-escalation-rule",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.circuits",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-circuits.css","crm-circuits-create-edit.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-circuits-preview-display.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-circuits-preview-display.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-circuits-helper.js","crm-circuits.js","lyte-dateselect.js","crm-circuits-mixin.js","lyte-daterangepicker.js","crm-circuit-create-edit.js","crm-createcircuit-pop.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],ResourceConstants.CRMClient))),n.concat(t).concat(e).concat(r).concat(s)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-circuits-common.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){return this.transition.data.refresh=!1,Lyte.resolvePromises({userProfile:store.findRecord("user",Crm.userDetails.USER_ID),integration:store.triggerAction("circuits","integration",{request_type:"GET"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return Lyte.Router.transitionTo("crm.settings.index"),this.methods.errorHandling(t,void 0),this.stop_bubble=!0,this.transition.abort(),!1}this.data.firstTimeAccess=!0},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1},refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)},willTransition:function(e){if(this.data.needToShowStopBanner.default){var t=e.pause(),r=this,s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){$("#"+s).hide(),t.resume(),renderingUtils.removeFreezeLayer(),r.data.needToShowStopBanner.default=!1,r.data.callBackFunc&&r.data.callBackFunc()})),n.find(".stayPage").off("click").click((function(){$("#"+s).hide(),e.abort(),renderingUtils.removeFreezeLayer(),r.data.needToShowStopBanner.default=!1})),n.focus()}}},redirect:function({integration:e,userProfile:t}){if(this.transition.data&&this.transition.data.refresh)this.transition.data.hasOwnProperty("data")?Lyte.Router.getRouteInstance().refresh().data=this.transition.data.data:Lyte.Router.getRouteInstance().refresh();else if(-1===["crm.settings.section.circuits.main.myCircuits","crm.settings.section.circuits.main.executionLog","crm.settings.section.circuits.main"].indexOf(this.transition.target)||e&&Object.keys(e).length)if(-1!==["crm.settings.section.circuits.circuitswelcome"].indexOf(this.transition.target)&&e&&Object.keys(e).length){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.circuits.main").data={userProfile:t[0],integration:e}}else if(-1!==["crm.settings.section.circuits"].indexOf(this.transition.target)){if(e&&Object.keys(e).length)Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.circuits.main").data={userProfile:t[0],integration:e,freshIntegration:!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration,ongngIntegrationProcess:!!this.transition.data.hasOwnProperty("ongngIntegrationProcess")&&this.transition.data.ongngIntegrationProcess};else Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.circuits.circuitswelcome").data={userProfile:t[0],integration:e}}else e&&(this.transition.data.integration=e,this.transition.data.userProfile=t[0],this.transition.data.firstTimeAccess=this.data.firstTimeAccess);else{Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.circuits.circuitswelcome").data={userProfile:t[0],integration:e}}this.data.firstTimeAccess=!1},afterRender:function(){var e=$("html, body");this.transition.data&&this.transition.data.fromeditor&&($("#mainMenuTabDiv").show(),e.css("overflow","")),e[0].scrollTop=0}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.circuits.circuitswelcome",{beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited")},renderTemplate:function(){return{outlet:"#result",component:"crm-circuits-welcome"}}}),Lyte.Router.registerRoute("crm.settings.section.circuits.main.credits",{getResources:function(){const e=networkUtils.returnDependencyFiles(["flow-actionlibrary-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["flow-actionlibrary-credits-view.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("actionsbyzohoflow")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-circuits-credits.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t).concat(r).concat(s)},getDependencies:function(){const e=networkUtils.returnDependencyFiles(["flow-actionlibrary-api-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["actionlibrary-credits.js"],ResourceConstants.CRMClient);return e.concat(t)},beforeModel:function(){Crm.trackSpotLightAction("Circuits Credit Page Visited"),commonUtils.showHideLoadingDiv(!0)},priceCalculator:function(e,t){let r=0,s=0,n=t;return e.forEach((({limit:e,amount:i})=>{if(e=Number(e),i=Number(i),0!==n){if(t>e){let t=e-s;n-=t,r+=t*i}else r+=n*i,n=0;s=e}})),r},model:function(){const e={version:5,integrationServiceName:"zcircuits"},t=Lyte.registeredMixins["crm-actions-flow-library-api-mixin"].getAPI(),{creditsAPI:r}=t,s=r.get({endPointInfo:e}),n=this.priceCalculator.bind(this);return{priceCalculationType:`${I18n.getMsg("pertransition")}`,calculator:n,priceDecimalPlaces:5,apis:t,endPointInfo:e,paid_credits:s}},renderTemplate:function({priceCalculationType:e,priceDecimalPlaces:t,calculator:r,apis:s,endPointInfo:n,paid_credits:i}){return Lyte.triggerEvent("cirMain_openDummyTab",{id:"circuit_credits_panel"}),$L("#setup_new_ContentDiv").scrollTop(0),this.currentModel={priceCalculationType:e,apis:s,endPointInfo:n,priceDecimalPlaces:t,priceCalculator:{calculate:r},paid_credits:i.paid_credits},{outlet:"#circuitsResultDiv2",component:"crm-actionlibrary-credits"}}}),Lyte.Router.registerRoute("crm.settings.section.circuits.main.executionLog",{queryParams:["status","circuit_id"],beforeModel:function(){Crm.trackSpotLightAction("Execution Logs Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){var e,t=!0,r="all";this.transition.data.isCircuitNameChanged&&(t=this.transition.data.isCircuitNameChanged),this.transition.info.queryParams&&(e=this.transition.info.queryParams.circuit_id?this.transition.info.queryParams.circuit_id:void 0,r=this.transition.info.queryParams.status?this.transition.info.queryParams.status:r);var s={request_type:"GET"};e&&(s.payLoad=[{circuit_id:e}]);var n={page:1,per_page:50};return n.status=r,n.type="api",t||!this.transition.data.circuitDtls?Lyte.resolvePromises({logs:store.triggerAction("circuits","execution_summary",s,n),circuitDtls:store.triggerAction("circuits","all_circuit_list",{request_type:"GET"})}):Lyte.resolvePromises({logs:store.triggerAction("circuits","execution_summary",s,n),circuitDtls:this.transition.data.circuitDtls})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.circuits.main.myCircuits"),this.stop_bubble=!0,this.transition.abort(),!1}if(this.transition.info.queryParams.circuit_id&&e.hasOwnProperty("circuitDtls"))for(var r=e.circuitDtls.circuits,s=r.length,n=0;n<s;n++)if(this.transition.info.queryParams.circuit_id===r[n].id){e.selectedCircuitName=r[n].name;break}e.logs||(e.logs={},e.logs.executions=[],e.logs.meta={more_executions:!1,nextPageIndex:-1}),e.logs&&(e.logs_array=e.logs.executions,e.moreContentAvailable=e.logs.meta.more_records,e.nextPageIndex=e.moreContentAvailable?e.logs.meta.page+1:-1),e.circuitDtls&&(e.circuitDtls=e.circuitDtls.circuits),this.transition.info.queryParams.circuit_id&&(e.circuit_id=this.transition.info.queryParams.circuit_id,e.circuitSelectedValue=this.transition.info.queryParams.circuit_id),this.transition.info.queryParams.status&&(e.dropDownPrevSelectedValue=this.transition.info.queryParams.status,e.dropDownSelectedValue=this.transition.info.queryParams.status)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1;Lyte.triggerEvent("createCir_closeCreateCirPop")},willTransition:function(e){var t=e.pause(),r=e.target.split(".");this.data.reRender="executionLog"===r[r.length-1],t.resume()}},renderTemplate:function(){return Lyte.triggerEvent("cirMain_openDummyTab",{id:"circuit_execution_panel"}),$L("#setup_new_ContentDiv").scrollTop(0),$L("#circuitExecutionLogsTable .lyteTableScroll").scrollTop(0),{outlet:"#circuitsResultDiv1",component:"crm-circuits-execution"}},afterRender:function(e){var t=this;if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("reRender")&&t.data.reRender){var r={};r.dropDownSelectedValue=e.dropDownSelectedValue?e.dropDownSelectedValue:"all",r.dropDownPrevSelectedValue=e.dropDownSelectedValue?e.dropDownSelectedValue:"all",r.circuit_id=e.circuit_id?e.circuit_id:void 0,r.circuitSelectedValue=e.circuitSelectedValue?e.circuitSelectedValue:void 0,Lyte.triggerEvent("cirExecLog_set_data",r),Lyte.triggerEvent("cirExecLog_initializeData")}}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.circuits.main",{beforeModel:function(){Lyte.triggerEvent("cirPrev_show_preview_pop",!1)},model:function(){return Lyte.resolvePromises({userProfile:this.transition.data.userProfile,integration:this.transition.data.integration,circuitDtls:store.triggerAction("circuits","all_circuit_list",{request_type:"GET"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.zoho-apps"),this.stop_bubble=!0,this.transition.abort(),!1}!!this.transition.data.hasOwnProperty("ongngIntegrationProcess")&&this.transition.data.ongngIntegrationProcess;e.freshIntegration=!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1},refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)}},redirect:function({userProfile:e,integration:t,circuitDtls:r}){if(this.transition.data&&this.transition.data.refresh)Lyte.Router.getRouteInstance().refresh();else if("crm.settings.section.circuits.main"===this.transition.target){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.circuits.main.myCircuits").data={userProfile:e[0],integration:t,freshIntegration:!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration}}else"crm.settings.section.circuits.main.executionLog"===this.transition.target&&(this.transition.data.integration=t,this.transition.data.userProfile=e[0],this.transition.data.isCircuitNameChanged||(this.transition.data.circuitDtls=r))},renderTemplate:function(){return{outlet:"#result",component:"crm-circuits-main"}}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.circuits.main.myCircuits",{queryParams:["searchKey"],beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){if(this.transition.data)var e=this.transition.data.from_date?this.transition.data.from_date:void 0,t=this.transition.data.to_date?this.transition.data.to_date:void 0;var r={created_service:"ZohoCRM",page:1,per_page:50};this.transition.info.queryParams.searchKey&&(r.criteria="(name:contains:"+searchKeyWord+")");var s=$L.moment().toDate();return Lyte.resolvePromises({circuits:store.findAll("circuits",r),summary:store.triggerAction("circuits","summary",{request_type:"GET"},{from:e||CrmDateUtils.getFormattedDate(s),to:t||CrmDateUtils.getFormattedDate(s),type:"api"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return Lyte.Router.transitionTo("crm.settings.index"),this.methods.errorHandling(t,void 0),this.stop_bubble=!0,this.transition.abort(),!1}e.summary.summary&&(e.summary=e.summary.summary),e.freshIntegration=!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration,e.circuits||(e.circuits=[]),this.transition.info.queryParams.searchKey&&(e.searchQuery=this.transition.info.queryParams.searchKey)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1;Lyte.triggerEvent("createCir_closeCreateCirPop")},willTransition:function(e){var t=e.pause(),r=e.target.split(".");this.data.reRender="myCircuits"===r[r.length-1],t.resume()}},renderTemplate:function(){$L("#circuitsTable .lyteTableScroll").scrollTop(0),Lyte.triggerEvent("cirMain_openDummyTab",{id:"circuit_list_panel"});const e=document.getElementById("circuitsTabs");return e&&(e.openTab("circuit_list_panel"),Lyte.triggerEvent("cirMain_setShowNewCircuitsBtn",!0)),{outlet:"#circuitsResultDiv",component:"crm-circuits-list"}},afterRender:function(e){$L("#setup_new_ContentDiv").scrollTop(0),$("crm-circuits-list")[0].component.resize();var t=this;if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("reRender")&&t.data.reRender){var r={};r.searchKey=e.searchKey?e.searchKey:"",r.freshIntegration=!!e.freshIntegration&&e.freshIntegration,Lyte.triggerEvent("cirList_set_data",r),Lyte.triggerEvent("cirList_initializeData")}},beforeExit:function(){store.unloadAll("circuits")}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.begin-portal",{beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition()},afterModel:function(){var e={};e.companyName=Crm.userDetails.orgName,this.currentModel=e},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-begin"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv()},onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code&&(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error")}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.create-portal",{redirect:function(){this.transition.data.portal_name||this.transitionTo("crm.settings.section.client-portal.begin-portal")},beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition()},afterModel:function(){var e={};e.portal_name=this.transition.data.portal_name,this.currentModel=e},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-basic-info"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv()},onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code&&(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error")}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.create-user-type",{queryParams:["step","name","module"],redirect:function(){if(!this.transition.info||!this.transition.info.queryParams){var e=this.transitionTo("crm.settings.section.client-portal.user-types");e.data={},e.data.refresh=!0}},beforeModel:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal){if(!Lyte.registeredMixins["crm-client-portal-util"].isAtleastOnePersonalityModuleAvailable()){var t=this.transitionTo("crm.settings.section.client-portal.user-types");t.data={},t.data.refresh=!0}"tabs"===e.queryParams.step&&store.findAll("module"),commonUtils.showHideLoadingDiv(!0),"tabs"!==e.queryParams.step||e.queryParams.name||(this.transition.abort(),crmui.showMsgBand("error",I18n.getMsg("portal.user.type.unavailability"),5e3))}else renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo("crm.settings.section.client-portal.user-types")})),this.transition.abort()},model:function(e){switch(e.queryParams.step){case"tabs":return store.findAll("field",{module:e.queryParams.module,type:"all"},!0,!0,{apiVersion:"2.2"}),{metaData:store.findAll("clientPortalMetaData",{module:e.queryParams.module}),wizards:store.findAll("wizard")};case"name":var t={type:"addNewType"};return e.queryParams.name&&(t.name=e.queryParams.name),t}},afterModel:function(e,t){var r=t.queryParams;switch(r.step){case"tabs":var s={};if(!e.metaData[0].related_lists)throw"Meta response received empty.";Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?(s=Lyte.registeredMixins["crm-client-portal-util"].getMetaDataForCreatingNewUserTypeRevamp(e.metaData[0],r.module,r.name,e.wizards)).route=this.getRouteInstance().transition.target:(s.model=Lyte.registeredMixins["crm-client-portal-util"].getMetaDataObjForAddingNewUserType(objectUtils.cloneObject(e.metaData[0]),r.module,r.name),s.model.route=this.getRouteInstance().transition.target),this.currentModel=s;break;case"name":this.currentModel=e}},lyteConvertionSupported:!0,renderTemplate:function(e,t){var r=t.queryParams,s=!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?"#portalsDiv":"#result";switch(!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").hide(),r.step){case"tabs":return Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?{outlet:s,component:"crm-client-portal-tabs-config-revamp"}:{outlet:s,component:"crm-client-portal-tabs-configuration"};case"name":return{outlet:s,component:"crm-client-portal-user-type"}}},actions:{onError:function(e){"string"==typeof e&&"Meta response received empty."===e&&(commonUtils.showHideLoadingDiv(),$L("#nextTab")[0].disabled=!0,crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4))},willTransition:function(e){if("crm.settings.section.client-portal.user-types.create-user-type"===e.target&&"name"===e.info.queryParams.step)for(var t=store.peekAll("user_type"),r=t.length,s=0;s<r;s++){var n=t[s];n.$.isNew&&n.$.deleteRecord()}if("crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal.user-types.index"!==e.target&&"crm.settings.section.client-portal"!==e.target||(!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").css("display","block"),e.data={},e.data.refresh=!0),clientPortal.changesAvailable){var i={};i.routeName=e.info.route,i.transitionData=e.data,i.queryParams=e.info.queryParams,i.dynamicParams=e.info.dynamicParams,e.abort(),Lyte.Component.render("crm-client-portal-changes-available-alert",i,"body"),$L("#changesAvailableAlert").e.ltProp("show",!0)}},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.edit",{queryParams:["step","name","layoutId","module","invitation_pref"],redirect:function(){this.transition.info&&this.transition.info.dynamicParams||this.transitionTo("crm.settings.section.client-portal.user-types")},beforeModel:function(e){clientPortal.changesAvailable=!1;var t=e&&e.queryParams&&e.queryParams.module&&"fields"===e.queryParams.step?e.queryParams.module:void 0,r=moduleApiVsNameMapping&&moduleApiVsNameMapping[t]?moduleApiVsNameMapping[t]:t;if(r&&Crm.moduleInfo[r]&&!Crm.moduleInfo[r].showSubMenu&&(this.transition.abort(),commonUtils.showHideLoadingDiv(!0),renderingUtils.displayPermissionDenied()),commonUtils.showHideLoadingDiv(!0),store.unloadAll("wizard"),"fields"===e.queryParams.step||"name"===e.queryParams.step&&!store.peekRecord("user_type",e.dynamicParam))return store.findRecord("user_type",e.dynamicParam,{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"})},model:function(e){switch(e.queryParams.step){case"tabs":return{userTypeData:store.findRecord("user_type",e.dynamicParam,{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),metaData:store.findAll("clientPortalMetaData",{module:e.queryParams.module}),wizards:store.findAll("wizard"),portalForms:store.findAll("webform",{filters:'{ "group_operator":"and","group":[ { "comparator": "equals", "field": { "api_name": "type" }, "value": "portalform" },{ "comparator": "equals", "field": { "api_name": "user_type.id" }, "value":"'+e.dynamicParam+'"} ] }',include_inner_details:"user_type.active"})};case"fields":var t=store.peekRecord("user_type",e.dynamicParam);t=t&&t.modules&&t.modules[0]&&!Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?t:void 0;var r=store.peekRecord("user_type",e.dynamicParam),s=store.peekRecord("layout",e.queryParams.layoutId);void 0!==s&&("sections"in s||(s=void 0));var n,i=!1,o=r.modules;let d=o.length;for(var a=0;a<d;a++)if(o[a].api_name===e.queryParams.module){var l=o[a].layouts;let t=l.length;for(var c=0;c<t;c++){let t=l[c];if(Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&t.id===e.queryParams.layoutId){"wizard"===t._default_view.type&&(i=!0,n=t._default_view.id);break}if(t.layout_id===e.queryParams.layoutId){"wizard"===t._default_view.type&&(i=!0,n=t._default_view.id);break}}}return{userTypeData:t?[t]:store.findRecord("user_type",e.dynamicParam,{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),layoutRecord:s?[s]:store.findRecord("layout",e.queryParams.layoutId,{module:e.queryParams.module},void 0,void 0,{clientPortalSettings:!0,apiVersion:"2.2"}),wizardData:i?store.findRecord("wizard",n,{layout_id:e.queryParams.layoutId}):void 0};case"name":var u={};return u.id=e.dynamicParam,u.type="rename",u.name=e.queryParams.name,u}},afterModel:function(e,t){var r=t.queryParams;switch(r.step){case"tabs":var s={};if(!e.userTypeData[0].modules)throw"Manage portal permission is not presesnt";if(!e.metaData[0].related_lists)throw"Meta response received empty.";s={};Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?(s=Lyte.registeredMixins["crm-client-portal-util"].getMetaDataForEditUserType(e.userTypeData[0],e.metaData[0],t.queryParams.module,e.wizards)).route=this.getRouteInstance().transition.target:(s.model=Lyte.registeredMixins["crm-client-portal-util"].getUserTypeData(objectUtils.cloneObject(e.userTypeData[0]),objectUtils.cloneObject(e.metaData[0]),Lyte.deepCopyObject(e.wizards),Lyte.deepCopyObject(e.portalForms)),s.model.route=this.getRouteInstance().transition.target),this.currentModel=s;break;case"fields":this.currentModel=Lyte.registeredMixins["crm-client-portal-util"].createFieldPermissionsObj(e.userTypeData[0],objectUtils.cloneObject(e.layoutRecord[0]),r.module,e.wizardData?objectUtils.cloneObject(e.wizardData[0]):void 0),r.invitation_pref&&(this.currentModel.invitation_pref=!0);break;case"name":this.currentModel=e}},lyteConvertionSupported:!0,renderTemplate:function(e,t){var r=!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?"#portalsDiv":"#result";switch(!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").hide(),t.queryParams.step){case"tabs":return store.unloadAll("layout"),Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?{outlet:r,component:"crm-client-portal-tabs-config-revamp"}:{outlet:r,component:"crm-client-portal-tabs-configuration"};case"fields":return{outlet:r,component:"crm-client-portal-field-permissions"};case"name":return{outlet:r,component:"crm-client-portal-user-type"}}},actions:{willTransition:function(e){"crm.settings.section.client-portal.user-types"===e.target||"crm.settings.section.client-portal.user-types.index"===e.target||"crm.settings.section.client-portal"===e.target?(e.data={},e.data.refresh=!0,!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").css("display","block")):"crm.settings.section.client-portal.user-types.create-user-type"===e.target&&"tabs"===e.info.queryParams.step&&(e.abort(),Lyte.Router.transitionTo("crm.settings.section.client-portal.user-types.create-user-type",{step:"name"}));var t=this.getDynamicParam(),r=store.peekRecord("user_type",t);if(r&&r.$.isDirty()||clientPortal.changesAvailable){var s={};s.routeName=e.info.route,s.transitionData=e.data,s.queryParams=e.info.queryParams,s.dynamicParams=e.info.dynamicParams,s.currentModel="user_type",s.currentRecordId=t,e.abort(),Lyte.Component.render("crm-client-portal-changes-available-alert",s,"body"),$L("#changesAvailableAlert").e.ltProp("show",!0)}else{let t=Lyte.Router.getRouteInstance();if(t.getQueryParams().invitation_pref&&"crm.settings.section.client-portal.user-types.edit"===e.target&&"fields"!==e.info.queryParams.step||"crm.settings.section.client-portal.user-types.edit"!==e.target){var n=$L("crm-client-portal-field-permissions")[0];let r=n?n.component:void 0;if(r&&r.getData("invitation_pref")){e.abort();let s=t.getDynamicParam(),n=this,i=t=>{n.setInvitationField(s,t),r.setData("invitation_pref",!1),Lyte.Router.transitionTo(e.info.route,e.info.dynamicParams?e.info.dynamicParams[0]:{},e.info.queryParams)};n.openInvitationPreferencePopUp(s,i)}}}},didTransition:function(e){if(commonUtils.showHideLoadingDiv(),"fields"===e.queryParams.step){for(var t=this.getQueryParams().module,r=store.peekAll("module"),s={},n=r?r.length:0,i=0;i<n;i++){var o=r[i];o.api_name===t&&(s.api_name=t,s.id=o.id,s.display_label=o.plural_label,s.name=o.module_name)}var a="lyte_tab_"+s.id;if(document.querySelector("crm-client-portal-field-permissions .portalTab_lyte").openTab(a),e.queryParams.invitation_pref){$L("crm-client-portal-field-permissions")[0].component.setData("invitation_pref",!0)}}this.transition.data.refresh&&this.refresh(),this.transition.data.changesDone&&(clientPortal.changesAvailable=!0)},onError:function(e){if("string"==typeof e&&"Meta response received empty."===e)commonUtils.showHideLoadingDiv(),crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4);else if("string"==typeof e&&"Manage portal permission is not presesnt"===e)commonUtils.showHideLoadingDiv(),renderingUtils.displayPermissionDenied();else if("object"==typeof e&&e.response){"the module name given seems to be invalid"===JSON.parse(e.response).message&&(this.transition.abort(),commonUtils.showHideLoadingDiv(),crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4))}else this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"}}},{mixins:["crm-client-portal-util","crm-client-portal-invitation-template-util"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.index",{model:function(){var e=[store.peekAll("user_type"),store.peekAll("portal"),store.findAll("module"),store.findAll("domain_mapping",{environment:"portal"}),store.peekAll("org")];return Crm.userDetails.isSamlFeatureEnabled&&e.push(store.findAll("webform",{filters:'{ "group_operator":"and","group":[ { "comparator": "equals", "field": { "api_name": "type" }, "value": "portalform" },{ "comparator": "equals", "field": { "api_name": "isenabled" }, "value":"true"} ] }'})),e},afterModel:function(e){var t={};t.records=e[0];var r={model:{}};r.model=t,r.portalName=CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:e[1][0].name,r.REMAINING_PORTAL_USER_TYPE_LICENSE=Crm.userDetails.TOTAL_PORTAL_USER_TYPE_LICENSE-t.records.length;for(var s=r.model.records.length,n=0;n<s;n++){var i=store.peekRecord("module",r.model.records[n].personality_module.id);i&&i.viewable&&i.visible?r.model.records[n].hasModulePermission=!0:r.model.records[n].hasModulePermission=!1,33===r.model.records[n].invitation_field.ui_type&&(r.isPhoneUTCreated=!0)}if(Crm.userDetails.CLIENTPORTAL_IAM_API_REVAMP){r.model.domainName=e[1][0].login_url;var o=e[3]&&e[3].find((e=>"active"===e.status));r.isCustomDomainUrlActive=!!o}else{var a=e[3];if(a&&a.length>0){var l=a.find((function(e){return"active"===e.status}));r.model.domainName=l?`${l.name}/portal/${r.portalName}/crm/login.sas`:`${RebrandLinkUtil.getProperty("PRODUCTION_WEB_URL")}/portal/${r.portalName}/crm/login.sas`}else r.model.domainName=`${RebrandLinkUtil.getProperty("PRODUCTION_WEB_URL")}/portal/${r.portalName}/crm/login.sas`}var c=0;t.records.forEach((function(e){e.default&&!Crm.userDetails.PORTALS_LICENSE_UNIFICATION_ENABLED||(c+=e.active_user_count)}));var u=e[5];r.isPortalFormActive=void 0!==u&&u.length>0,r.consumedLicenseCount=c,r.purchasedPortalUserCount=e[4][0].license_details.portal_users_license_purchased,this.currentModel=r},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-user-types-list-view"}},afterRender:function(){if(void 0!==this.transition.data&&!0===this.transition.data.portalCreatedNow){var e=store.peekAll("user_type");Lyte.registeredMixins["crm-client-portal-util"].openInviteMessagePopOnUserTypeCreate(e[0])}},beforeExit:function(){_cruxUtils.removeCustomAlert()}},{mixins:["crm-client-portal-util"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.summary.folders.templates",{queryParams:["language"],errorCode:{NO_DATA_FOUND:"NO DATA FOUND",LANGUAGE_MISSMATCH:"LANGUAGE MISSMATCH"},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-translation.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-client-portal-email-template.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_htmleditor1.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Translation")],ResourceConstants.CRM))},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),!store.peekRecord("portal_email_template",e.dynamicParam)){var t=store.peekRecord("portal_template_folder",this.parent.getDynamicParam()),r=store.peekRecord("user_type",t.userTypeId),s={folderId:t.id,module:r.personality_module.api_name};return store.findAll("portal_email_template",s,!1,!0,"filters")}},model:function(e){var t=store.peekRecord("portal_email_template",e.dynamicParam),r="";if(!t)throw{code:this.errorCode.NO_DATA_FOUND};if(t.isDefault){var s=this.parent.getDynamicParam(),n=store.peekAll("portal_email_template");r=e.queryParams.language?e.queryParams.language:Crm.userDetails.LOCALE;var i=n.find((function(e){return s===e.folder.id&&e.language===r&&!e.isDefault}));if(i)if(t=i,e.dynamicParam!==t.id)return o={redirect:{route:"crm.settings.section.client-portal.user-types.summary.folders.templates",dynamicParams:[this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),t.id]}}}if(t){if(e.queryParams.language&&!t.isDefault&&e.queryParams.language!==t.language)throw{code:this.errorCode.LANGUAGE_MISSMATCH};var o={};return 0===$L("crm-client-portal-email-template").length&&(o.emails=store.triggerAction("emails","from_addresses",{},null,"GET"),o.translationDetails=store.findAll("translation"),o.supported_languages=store.triggerAction("translation","supportedlanguages",{},{},"GET"),o.template_preferences=networkUtils.lyteInitiateRequest("/crm/v2.2/settings/email_templates/actions/preferences","GET")),o.email_template=store.findRecord("portal_email_template",t.id,t.isDefault?{content_translation_language:r}:{}),o.portalUrl=store.peekAll("portal")[0].login_url?new URL(store.peekAll("portal")[0].login_url).host:Crm.portalDomain,o}},afterModel:function(e){if(e.redirect)return e;e.showModal=!0,e.module=e.email_template.module.api_name,e.name=e.email_template.folder.name,e.display_name=this.getKeyForTemplateName(e.name),e.selectedLanguage=e.email_template.language;var t=store.peekRecord("portal_template_folder",this.parent.getDynamicParam());(e.userTypeId=t.userTypeId,e.emails)&&(e.email_meta={orgEmailsArr:[]},e.emails.from_addresses.each((function(t){"org_email"===t.type&&e.email_meta.orgEmailsArr.push(t)})),delete e.emails);if(e.translationDetails){var r=[];1===e.translationDetails.$.meta.translation_status&&e.translationDetails.map((e=>{-1===app.cruxCompLocale.indexOf(e.locale)&&2!==e.status&&r.push(e)})),e.languages=this.splitLanguages(e.supported_languages.supported_languages.fully_supported_languages,r)}if(e.template_preferences){var s=e.template_preferences;s.preferences&&s.preferences.font_name&&(e.favFont=s.preferences.font_name),delete e.template_preferences}delete e.user_type},redirect:function(e){e.redirect&&this.replaceWith(e.redirect)},renderTemplate:function(e){var t=$L("crm-client-portal-email-template");return t&&t[0]&&t[0].component.setTemplateDataAndMergeFields(e),{outlet:"#cpT_modal",component:"crm-client-portal-email-template"}},actions:{onError:function(e,t){if(e.response){var r=JSON.parse(e.response);-1!==r.message.indexOf("unable to process")&&"INVALID_REQUEST"===r.code?window.location=Crm.getCrmBasePath()+"/iam-security-error":"NO_PERMISSION"===r.code&&renderingUtils.displayPermissionDenied()}return e.code&&e.code===this.errorCode.NO_DATA_FOUND&&crmui.showMsgBand("error",I18n.getMsg("custmr.prtl.template.err.invld.url"),3e3),e.code&&e.code===this.errorCode.LANGUAGE_MISSMATCH&&crmui.showMsgBand("error",I18n.getMsg("custmr.prtl.template.err.invld.url"),3e3),t.abort(),!1},willTransition:function(e){var t=$L("crm-client-portal-email-template");if(t&&t[0]&&t[0].component.getData("showModal")&&"crm.settings.section.client-portal.user-types.summary.folders.templates"!==e.target){e.abort();var r=t[0].component.getData();history.pushState(null,null,window.location.pathname+"/folders/"+r.email_template.folder.id+"/templates/"+r.email_template.id),t[0].component.executeMethod("closeModal")}}},getKeyForTemplateName(e){var t=[{name:"Accept Invitation",display_name:I18n.getMsg("custmr.prtl.template.accept.invitation"),type:"email_template"},{name:"Reset Password",display_name:I18n.getMsg("custmr.prtl.template.reset.password"),type:"email_template"},{name:"Confirm Email Address",display_name:I18n.getMsg("custmr.prtl.template.confirm.email.address"),type:"email_template"},{name:"Signup Email",display_name:I18n.getMsg("custmr.prtl.template.signup.email"),type:"email_template"}].filter((t=>t.name===e));if(!validationUtils.isEmpty(t))return t[0].display_name}},{mixins:["crm-translation-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.summary.folders",{model:function(e){var t=store.peekRecord("portal_template_folder",e.dynamicParam);return t||(t=store.findRecord("portal_template_folder",e.dynamicParam)),t}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.summary",{queryParams:["invitation_pref"],redirect:function(){this.transition.info&&this.transition.info.dynamicParams||this.transitionTo("crm.settings.section.client-portal.user-types")},getResources:function(){var e=networkUtils.returnDependencyFiles(["webform.js","crm-webforms-list.js","webform-common-files.js","lyte-code-snippet.js","abtesting.js","crm-webform-abtesting-create.js","abtesting-model.js","definition-model.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-webforms-list-less.css","webform-common-files-less.css","crm-webform-abtesting-create-less.css","lyte-ui-code-snippet.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("webforms")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(e){Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal||this.transitionTo("crm.settings.section.client-portal.user-types.users",e.dynamicParam),commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=e.dynamicParam,r=store.peekRecord("user_type",t);return r&&r.modules&&0!==r.modules.length?r:store.findRecord("user_type",t,{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"})},afterModel:function(e,t){var r=objectUtils.cloneObject(store.peekRecord("user_type",t.dynamicParam));Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&(r=this.transformDataForFieldPermissions(r)),(r=this.convertPermissionsJsonObjectToJsonArray(r)).arePublicModulesAvailable=this.arePublicModulesAvailableInUserTypeData(r),r.areWebTabsAvailable=this.areWebTabsAvailable(r),this.currentModel=r;var s=store.peekAll("portal")[0].saml_configuration;s&&s.active&&(Crm.userDetails.IS_SAML_CONFIGURATION_ACTIVE=!0)},lyteConvertionSupported:!0,renderTemplate:function(){return!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?($L("#mainResult").hide(),{outlet:"#portalsDiv",component:"crm-client-portal-user-type-summary"}):{outlet:"#result",component:"crm-client-portal-user-type-summary"}},afterRender:function(e,t){if(!0===CPMF.userTypeCreatedNow&&(Lyte.registeredMixins["crm-client-portal-util"].openInviteMessagePopOnUserTypeCreate(e),delete CPMF.userTypeCreatedNow),Crm.userDetails.CLIENT_PORTAL_INVITATION_FIELD&&(this.showNonApprovedTemplateNote(),"true"===t.queryParams.invitation_pref)){let e=t.dynamicParam,r=function(t){Lyte.registeredMixins["crm-client-portal-util"].setInvitationField(e,t)};Lyte.registeredMixins["crm-client-portal-invitation-template-util"].openInvitationPreferencePopUp(e,r)}},actions:{willTransition:function(e){"crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal.user-types.index"!==e.target&&"crm.settings.section.client-portal"!==e.target||(e.data={},e.data.refresh=!0,!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").css("display","block"));var t=$L("#portalPreview").e;t&&t.remove();var r=$L("#changeUserTypePop").e;r&&r.remove();var s=$L("#sendInvitePopUp").e;s&&s.remove()},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()},onError:function(e,t){if(void 0!==e.message&&-1!==e.message.indexOf("Cannot read property 'constructor' of undefined")&&t.info.dynamicParams[0]&&!store.peekRecord("user_type",t.info.dynamicParams[0])){crmui.showMsgBand("error",I18n.getMsg("portal.user.type.unavailability"),5e3);var r=this.transitionTo("crm.settings.section.client-portal.user-types");return void(data&&data.refresh&&(r.data=data))}this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"}},didDestroy:function(){store.unloadAll("imtemplate");let e=$L("crm-client-portal-sms-template");e&&e.length&&e[0].remove()}},{mixins:["crm-client-portal-util","crm-client-portal-invitation-template-util"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.users",{model:function(e){var t=e.dynamicParam,r={};r.users=store.findAll("client_user",{type:"AllActiveUsers",per_page:200,page:1},!1,!0,{user_type_id:t}),r.canPerformChangeUserType=Lyte.registeredMixins["crm-client-portal-user-util"].canPerformChangeUserType(t),r.user_type_id=t,r.personality_module={};var s=store.peekRecord("user_type",t);r.personality_module.plural_label=s.personality_module.plural_label;var n=store.peekRecord("module",s.personality_module.id);return r.module=n.module_name,r.module_api_name=s.personality_module.api_name,r.user_type_name=s.name,r.moduleRecord=store.findRecord("module",s.personality_module.id),r.isUserTypeActive=!s.active,r.invitationType=33===s.invitation_field.ui_type?"phone":"email",r.invitationField=s.invitation_field,r},afterModel:function(e){var t=this;t.invFieldPermission=!1,e.users||(e.users=[]);var r=e.users.length;if(e.noResultsFound=0===r,0!==r&&(e.totalUsersCount=e.currentUsersCount=e.users.$.meta.total_count),e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible)return Lyte.resolvePromises([store.findAll("field",{module:e.module_api_name},void 0,void 0)]).then((function(r){var s=r[0];if(s)for(var n=s.length,i=0;i<n;i++)if(s[i].api_name===e.invitationField.api_name&&s[i].visible){t.invFieldPermission=!0;break}e.showInviteUsersButton=t.invFieldPermission&&e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible,e.titleForDisableInviteButton=t.invFieldPermission?e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible?"":I18n.getMsg("custmr.prtl.invite.module.permission.missing"):I18n.getMsg("custmr.prtl.inv.field.permission.denied",e.invitationField.display_label)}));e.showInviteUsersButton=!1,e.titleForDisableInviteButton=I18n.getMsg("custmr.prtl.invite.module.permission.missing")},lyteConvertionSupported:!0,renderTemplate:function(){var e=$L("crm-client-portal-user-type-users");return e.length>0&&e[0].remove(),!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?($L("#mainResult").hide(),{outlet:"#portalsDiv",component:"crm-client-portal-user-type-users"}):{outlet:"#result",component:"crm-client-portal-user-type-users"}},afterRender:function(){var e=$L(".cpT_portalNameCtn").width()-($L(".cpT_modName").outerWidth()+$L(".cpT_saveCancel").outerWidth()+80),t=$L("#cpT_navCtn"),r=$L("#portalUsersTable"),s=$L(".cpT_listRow"),n=s.length,i=$L("#portalUsersTable .lyteTableScroll");if(n>0){var o=renderingUtils.windowHeight-(t.offset().top+29+17),a=i[0].scrollHeight,l=renderingUtils.windowHeight-(i.offset().top+29+17);$L(".cpT_portalName").css("max-width",e),t.css("height",o+"px"),r.css("height","auto"),i.scrollTop(0),a>l&&s.length>0&&r.css("height",l+"px")}},actions:{willTransition:function(e){"crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal"!==e.target||(!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&$L("#mainResult").css("display","block"),e.data={},e.data.refresh=!0);var t=$L("#portalPreview").e;t&&t.remove();var r=$L("#changeUserTypePop").e;r&&r.remove();var s=$L("#cpT_reInviteUsersError");s&&s.e&&s.e.remove();var n=$L("#listViewPopup");n&&n[0]&&n[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types",{beforeModel:function(){CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME||Crm.userDetails.CLIENT_PORTAL_NAME||this.transitionTo("crm.settings.section.client-portal.begin-portal"),store.unloadAll("portal"),commonUtils.showHideLoadingDiv(!0)},model:function(){return[store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),store.findAll("portal",void 0,void 0,void 0,{includeName:!0}),store.findAll("org"),store.findAll("dummy",null,!1,!1,{url:"/crm/v4/__features?api_names=portal_users,client_portal_saml_configuration"})]},afterModel:function(e){var t=e[3];Crm.userDetails.defaultPortalUserCount=t.__features[0].details.limits.total;for(var r=t.__features.length,s=0;s<r;s++)"client_portal_saml_configuration"===t.__features[s].api_name&&(Crm.userDetails.isSamlFeatureEnabled="Free"!==Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME)},redirect:function(){"crm.settings.section.client-portal.user-types"!==this.transition.target||this.transition.data.refresh||(this.replaceWith("crm.settings.section.client-portal.user-types.index"),("crm.settings.section.client-portal.user-types"===this.transition.target||"crm.settings.section.client-portal.user-types.index"===this.transition.target||"crm.settings.section.client-portal"===this.transition.target)&&featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!0))},actions:{willTransition:function(e){"crm.settings.section.client-portal"===e.target&&(e.data={},e.data.refresh=!0);var t=$L("#deleteUserTypePop").e;t&&t.remove()},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv(),crmLayout.Resize.Setup()},onError:function(e){try{var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code?(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"):"NO_PERMISSION"===t.code&&(renderingUtils.displayPermissionDenied(),this.transition.abort())}catch(e){return}}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-client-portal-user-mixin.js","crm-client-portal-mixin.js","crm-client-portal-user-data-store.js","email-compose-settings.js","imchannel.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-client-portal.js","clientPortalModulePermissions.js","crm-image-mixin.js","crm-image-upload-create.js","crm-vision-create.js","exif-plugin.js","crm-portals-detail-view-related.js","user_type.js","crm-list-view-modal.js","crm-list-view.js","crm-inner-list.js","crm-alert-addresswrapper.js","crm-imtemplate.js","crm-client-portal-module.js","crm-domainmapping-datastore.js","servapp_preferences_model.js","campaign_status_model.js","webform-model.js","org-model.js","lyte-hovercard.js","lyte-fileupload.js","webform-template-mixin.js"],ResourceConstants.CRMClient);e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-custom-view.js","crm-custom-filter.js","crm-custom-button-wrapper.js","crm-list-helpers.js","crux-smart-filter.js","crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js","crm-tag-modal.js","lyte-step.js","crux-user-view.js","pathfinder_meta_model.js","assignment_threshold_model.js","zia/anomaly/customview_result.js","zia/anomaly/customview_mixin.js","crm-territory-common-utils.js","crm-uploadfields-mixin.js","crm-detail-view-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CVAnomalyResult")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["portal-model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-services.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-client-portal-new-tab.js","crm-client-portal-ut-summary.js"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-client-portal-old-tab.js","crm-client-portal-ut-summary.js"],ResourceConstants.CRMClient));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals"),networkUtils.getI18nJSUrl("EmailInventoryTemplates"),networkUtils.getI18nJSUrl("editorframework"),networkUtils.getI18nJSUrl("listview")],ResourceConstants.CRM),r=[];r=(r=(r=(Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED,r.concat(networkUtils.returnDependencyFiles(["crm-client-portal.css","crm-list-kanban-container.css","crm-portals-detail-view-related.css","crm-image-upload-create.css","crm-client-portal-send-invite.css"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-client-portal-created-success-popup.css","crm-client-portal-user-type-association.css","crm-client-portal-user-types-list-view.css","crm-client-portal-saml-configuration.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)))).concat(networkUtils.returnDependencyFiles(["crm-client-portal-expose-condition.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","custom-view-layer-new.css","custom-view-layer-common.css","crm-inner-list-new.css","crux-user-view.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-client-portal-rtl.css","crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient)));var s=networkUtils.returnDependencyFiles(["zohocrm_clientPortal.js","zohocrm_templatenew.js","zohocrm_template.js"],ResourceConstants.CRM),n=-1!==window.location.href.indexOf("csez.zohocorpin.com")||-1!==window.location.href.indexOf("automation.localzoho.com");if(!n&&Crm.userDetails.PORTAL_USERS_STORE_WIDGET_AVAILABLE)var i=[RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],o=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL")];return n?s.concat(e).concat(r).concat(t):Crm.userDetails.PORTAL_USERS_STORE_WIDGET_AVAILABLE?s.concat(i).concat(o).concat(e).concat(r).concat(t):s.concat(e).concat(r).concat(t)},beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition(),Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&(CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.summary"]=!0,CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.edit"]=!0,CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.create-user-type"]=!0,CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.users"]=!0,CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.summary.folders"]=!0,CrmRouter.hiddenSetupRoutes["crm.settings.section.client-portal.user-types.summary.folders.templates"]=!0),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("custm.prtl"),Crm.partnerName]))},afterRender:function(){cruxAssets&&Crm.userDetails.multiSelectFilterOptions&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!0,cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist="picklist")},lyteConvertionSupported:!0,redirect:function(){if("crm.settings.section.client-portal"===this.transition.target){Crm.trackSpotLightAction("Client Portal - Clicked");var e=Object.assign({},this.transition.info);if(CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME||Crm.userDetails.CLIENT_PORTAL_NAME){var t;this.transition.data&&this.transition.data.refresh&&((t={}).refresh=!0),e.route="crm.settings.section.client-portal.user-types";var r=this.replaceWith(e);t&&t.refresh&&(r.data=t)}else e.route="crm.settings.section.client-portal.begin-portal",this.replaceWith(e)}},actions:{onError:function(e){try{var t=JSON.parse(e.response);-1!==t.message.indexOf("Please check if the URL trying to access is a correct one")&&"INVALID_REQUEST"===t.code?(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"):-1!==t.message.indexOf("No portal exists with the given portal name.")&&"INVALID_DATA"===t.code&&(this.transition.abort(),Utils.windowLocationReload())}catch(e){return}}},beforeExit:function(){store.unloadAll("user_type"),store.unloadAll("clientPortalModulePermissions"),cruxAssets&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!1,delete cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist)},didDestroy:function(){(Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-client-portal-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-client-portal.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-client-portal.css","crm-portals-detail-view-related.css","crm-client-portal-send-invite.css","crm-image-upload-create.css"],ResourceConstants.CRMClient)).forEach((function(e){Lyte.injectResources&&Lyte.injectResources.availableTags&&Lyte.injectResources.availableTags[e]&&(Lyte.injectResources.availableTags[e].tag.remove(),delete Lyte.injectResources.availableTags[e])})),window.drp=null,this.removeFromCache(["crm-client-portal.css","crm-portals-detail-view-related.css","crm-client-portal-send-invite.css","crm-client-portal-rtl.css","crm-image-upload-create.css"])}}),Lyte.Router.registerRoute("crm.tab.commandcenter.commandcenter-re-authorize-services",{model:function(){return Lyte.resolvePromises({services:Crm.userDetails.CC_SERVICE_ENABLED?CommandCenterLoader.getServiceDetails():null})},afterModel:function(e){if(e.isReauthorize=!0,null!==e.services){let t,r,s;if(e.services=JSON.parse(e.services).services,e.has_manage_auto_permission=!0,r=e.services.failed_services,null!==r){t=r.length;for(let n=0;n<t;n++)if(s=r[n].orgs[0].has_manage_auto_permission,void 0!==s&&!s&&Crm.userDetails.USER_ID===r[n].orgs[0].authenticated_user){e.has_manage_auto_permission=s;break}}else e.has_manage_auto_permission=!1}},redirect:function(e){void 0!==e.has_manage_auto_permission&&!0===e.has_manage_auto_permission?this.transitionTo("crm.settings.section.path-finder.index-path-finder").data={isReauthorize:e.isReauthorize,services:e.services}:this.transitionTo("crm.settings.index").data={isReauthorize:e.isReauthorize,services:e.services}}}),Lyte.Router.registerRoute("crm.settings.section.company-details",{getDependencies:function(){return networkUtils.returnDependencyFiles(["org-model.js","definition-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-shortcut.js","crm-user-setup.js","crm-user-edit-popup.js","crm-user-company-details.js","modal-scroll-box-shadow.js","shift_hours_model.js","crm-organization-access-url-change-popup.js","org_domain_availablity.js","crm-organization-create-domainpattern.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-user-company-details.css","crm-organization-create-domainpattern.css"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crm-user-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("companydetails"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM),s=e.concat(t).concat(r);if(Crm.userDetails.RTL_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-user-company-details-rtl.css"],ResourceConstants.CRMClient);s=s.concat(n)}return s},model:function(e){return Lyte.resolvePromises({org:store.findAll("org"),adminUsers:store.findAll("user",{type:"ActiveConfirmedAdmins"})})},afterModel:function(e,t){this.currentModel={companyDetails:e.org?e.org[0]:void 0,userDetails:e.adminUsers}},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-companydetail-page"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.orgDetails"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-create",{getResources:function(){return this.parent.getResourcesForAlertForm()},beforeModel:function(){return store.peekAll("competitor_alert").length>=store.peekAll("competitor_alert_meta")[0].max_alert_limit&&(crmui.showMsgBand("error",I18n.getMsg("crm.competitoralert.error.alert.maximum.limit",store.peekAll("competitor_alert_meta")[0].max_alert_limit),3e3),this.replaceWith("crm.settings.section.competitor-alerts.competitor-alerts-index")),this.checkAndDownloadChatFiles()},model:function(){var e={alertDetails:store.createRecord("competitor_alert",{},!0),configurationOptions:JSON.parse(JSON.stringify(store.peekAll("competitor_alert_meta")[0])),formHeading:I18n.getMsg("crm.competitoralert.alert.create.title"),competitorsCount:store.peekAll("competitor").length};return this.setTeamsForSlack(e),this.getChatSettings(e),e},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.alert.create.title"),Crm.partnerName]))},actions:{willTransition:function(e){this.validateAndPerformTransition(e)}}},{mixins:["crm-competitor-alert-form-utils"]}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record.competitor-alert-edit",{getResources:function(){return this.parent.parent.getResourcesForAlertForm()},beforeModel:function(){return this.checkAndDownloadChatFiles()},model:function(){var e={alertDetails:store.peekRecord("competitor_alert",this.parent.getDynamicParam()),configurationOptions:JSON.parse(JSON.stringify(store.peekAll("competitor_alert_meta")[0])),formHeading:I18n.getMsg("crm.competitoralert.alert.update.title"),competitorsCount:store.peekAll("competitor").length};return e.groupedNotifications=this.getGroupedNotifications(e.alertDetails.notifications),this.setTeamsForSlack(e),this.getChatSettings(e),e.configurationOptions.notification_mediums.forEach((function(t){e.groupedNotifications[t.name]&&(t.showUserLookup=!0)})),e.competitorsCount>=e.configurationOptions.max_competitors_limit&&(e.competitorInputDisabled=!0,e.competitorPlaceHolder=""),e},afterModel:function(e){e.fromList=this.transition.data&&this.transition.data.fromList},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.edit.alert.page.title"),Crm.partnerName]))},actions:{willTransition:function(e){this.validateAndPerformTransition(e)}}},{mixins:["crm-competitor-utils","crm-competitor-alert-form-utils"]}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record.competitor-alert-view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail.css"],ResourceConstants.CRMClient),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail-rtl.css"],ResourceConstants.CRMClient))),r},model:function(){var e=store.peekRecord("competitor_alert",this.parent.getDynamicParam()),t=e.notifications.filter((function(e){return"users"===e.notificant_type&&"sales_signals"!==e.medium&&"cliq"!==e.medium})).map((function(e){return e.notificant.id})),r={alertDetails:e,configurationOptions:store.peekAll("competitor_alert_meta")[0],groupedNotifications:this.getGroupedNotifications(e.notifications)};return t.length>0&&(t=t.filter((function(e,r){return t.indexOf(e)===r})),r.userDetails=store.findAll("user",{ids:t.join(",")},!0)),r},afterModel:function(e){e.userDetails&&(e.userIdVsZuid={},e.userDetails.forEach((function(t){e.userIdVsZuid[t.id]=t.zuid})),this.currentModel=e)},renderTemplate:function(){return{outlet:"#competitorResult",component:"crm-competitor-alerts-detail"}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.view.alert.page.title",e.alertDetails.name),Crm.partnerName]))}},{mixins:["crm-competitor-utils"]}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record",{model:function(e){var t=store.peekRecord("competitor_alert",e.dynamicParam);return t||store.findRecord("competitor_alert",e.dynamicParam)},afterModel:function(e){e||(crmui.showMsgBand("error",I18n.getMsg("crm.competitoralert.error.invalid.alertid"),3e3),this.transition.abort())}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alerts-index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-index.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-index.css"],ResourceConstants.CRMClient),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-index-rtl.css"],ResourceConstants.CRMClient))),r},model:function(){if(this.parent.currentModel.integrationNotEnabled)return{competitorAlerts:[],configurationOptions:{},integrationNotEnabled:!0};var e=Array.from(store.peekAll("competitor_alert"));return store.model.competitor_alert.addEventListener("remove",(function(t){Lyte.arrayUtils(e,"removeObject",t)})),{competitorAlerts:e,configurationOptions:store.peekAll("competitor_alert_meta")[0],activeCompetitorsCount:store.peekAll("competitor").length}},afterModel:function(e){e.competitorAlerts.forEach((function(t){var r=[];t.notifications.forEach((function(e){-1===r.indexOf(e.medium)&&r.push(e.medium)})),t.configuredMediums=[],r.forEach((function(r){t.configuredMediums.push(e.configurationOptions.mediumVsLabel[r])}))}))},renderTemplate:function(){return{outlet:"#competitorResult",component:"crm-competitor-alerts-index",reRender:!0}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("zoho.email.incoming.competitors"),Crm.partnerName])),this.transition&&this.transition.data&&this.transition.data.showErrorAlert&&this.component.setData({showErrorAlert:!0})},actions:{willTransition:function(){store.model.competitor_alert.removeEventListener()}}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts",{getResourcesForAlertForm:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-form.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-confirm-changes-popup.js","crux-combo-box.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-form.css"],ResourceConstants.CRMClient),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-form-rtl.css"],ResourceConstants.CRMClient))),r},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-competitors-data-store.js","crm-competitors-utilities.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper.css"],ResourceConstants.CRMClient),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper-rtl.css"],ResourceConstants.CRMClient))),r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("competitoralerts")],ResourceConstants.CRM))},model:function(){return{configurationOptions:store.findAll("competitor_alert_meta"),competitorAlerts:store.findAll("competitor_alert")}},afterModel:function(){this.integrationNotEnabled&&(this.currentModel={competitorAlerts:[],integrationNotEnabled:!0})},renderTemplate:function(){return{outlet:"#result",component:"crm-competitor-alerts-wrapper"}},afterRender:function(){$L("#setup_new_ContentDiv").addClass("helpOverflowHide")},redirect:function(){if(this.transition.data&&this.transition.data.refreshRoute&&this.refresh(),"crm.settings.section.competitor-alerts"===this.transition.target)this.replaceWith("crm.settings.section.competitor-alerts.competitor-alerts-index");else if(this.integrationNotEnabled&&"crm.settings.section.competitor-alerts.competitor-alerts-index"!==this.transition.target){this.replaceWith({route:"crm.settings.section.competitor-alerts.competitor-alerts-index"}).data={showErrorAlert:!0}}},beforeExit:function(){$L("#setup_new_ContentDiv").removeClass("helpOverflowHide")},actions:{willTransition:function(){"undefined"!=typeof ZohoHCAsap&&void 0!==ZohoHCAsap.Action&&validationUtils.isNotEmpty(ZohoHCAsap)&&(window.isHelpOptionOpened||ZohoHCAsap.Action("close"))},onError:function(e,t){var r=e&&e.response?JSON.parse(e.response):{};if("INTEGRATION_NOT_ENABLED"===r.code)return this.integrationNotEnabled=!0,t.resume(),!1;var s={NO_PERMISSION:"crm.label.insufficient.privileges",FEATURE_NOT_SUPPORTED:"crm.setup.feature.not.supported",FEATURE_NOT_ENABLED:"crm.setup.feature.not.enabled"},n=r.code&&s[r.code]?s[r.code]:"message.code.0";return crmui.showMsgBand("error",I18n.getMsg(n),3e3),t.abort(),Lyte.Router.transitionTo("crm.settings.index"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-dashboard.list-view",{queryParams:["type","status","module","filters","cross_filters","sort_by","sort_order","page","per_page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-view-modal.js","crm-column-list.js","crm-list-view.js","crm-inner-list.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crm-customview-helpers.js","crm-vision-helper.js","crm-list-helpers.js","crux-criteria-conditions.js","crux-column-list.js","pathfinder_meta_model.js","servapp_preferences_model.js","campaign_status_model.js","crm-territory-common-utils.js","zia/anomaly/customview_result.js","zia/anomaly/customview_mixin.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js","zohocrm_crmListViewInPopupTemplate.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-services.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","custom-view-layer-new.css","crm-page-navigator.css","custom-view-layer-common.css","crm-list-view-crux.css","crm-inner-list-new.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("listview"),networkUtils.getI18nJSUrl("CVAnomalyResult")],ResourceConstants.CRM))},beforeModel:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var t;(t=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(t)}}else(t=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(t)},lyteConvertionSupported:!0,model:function(e){var t=this.getQueryParams();if(t.status=t.status?t.status:"Pending",t.type=t.type?t.type:"consent",!t.module){t.module="consent"===t.type?$("#consentModules").val():$("#requestModules").val();var r=Object.assign({},this.transition.info);return r.queryParams=t,void this.replaceWith(r)}void 0===moduleRecordMapping[t.module]&&(renderingUtils.showCustomAlert(I18n.getMsg("module.not.available"),void 0,!1,(function(){Lyte.Router.transitionTo("crm.settings.section.compliance.consent-dashboard").refresh=!0})),Lyte.Router.getRouteInstance().transition.abort()),Crm.trackSpotLightAction("GDPR - View Click",{Module:t.module,Type:t.type,Status:t.status}),this.currentModel={}},renderTemplate:function(e,t){crmListView.getObject().isPrivacyListView=!0;var r={queryParams:{}};if(customViewObject.modalQueryObj)for(var s in customViewObject.modalQueryObj)r.queryParams[s]=customViewObject.modalQueryObj[s];this.loadModal(t.queryParams.module,"COMPLIANCE",r,!0)},afterRender:function(e,t){cruxAssets&&Crm.userDetails.multiSelectFilterOptions&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!0,cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist="picklist")},beforeExit:function(){cruxAssets&&cruxAssets.fieldDataTypeToCruxCompMapping&&(cruxAssets.supportMultiselectFilterOptions=!1,delete cruxAssets.fieldDataTypeToCruxCompMapping.multiselectpicklist)},actions:{onError:function(e,t,r,s){},willTransition:function(e){if("crm.tab.module.entity"!==e.info.route||!e.data||!e.data.cvid){var t=$L("crm-list-view-modal")[0];t&&t.component.executeMethod("closePopUp")}if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?e.abort():Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})),"crm.settings.section.compliance.consent-dashboard"===e.info.route){customViewObject={};var r=void 0!==Events.isPageLayoutModified&&Events.isPageLayoutModified,s=this.transition.info.queryParams;if(s){var n=s.type;if(n){var i="consent"===n?$("#consentModules"):$("#requestModules");s.module&&i.val()!==s.module&&(i.val(s.module),r||i.trigger("change"))}}r&&(CrmPrivacyDashboard.populateConsentDashboard(),CrmPrivacyDashboard.populateRequestDashboard(),Events.isPageLayoutModified=!1)}},didTransition:function(){this.transition.refresh&&this.refresh()}}},{mixins:["crm-view-utils","crm-list-view-modal-util"]}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-dashboard",{getResources:function(){return networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"],ResourceConstants.CRM)},beforeModel:function(e){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.invokeRedirection()},model:function(e){commonUtils.showHideLoadingDiv(!0);return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PrivacyDashboard.do?action=loadDashboards","GET",{params:null})},lyteConvertionSupported:!0,renderTemplate:function(e,t){if(e.modules&&0!=e.modules.length)return CrmPrivacyDashboard.consentPicklist=e.consentPicklist,CrmPrivacyDashboard.requestPicklist=e.requestPicklist,(!e.consentPicklist||e.consentPicklist.length<1||!e.requestPicklist||e.requestPicklist.length<1)&&(murphy.info("Response json: "),murphy.info(e)),{outlet:"#result",html:Handlebars.templates.PrivacyDashboards(e)};var r=I18n.getMsg("crm.privacy.no.module.permission");setTimeout((function(){renderingUtils.showCustomAlert(r,void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})}))}),1)},afterRender:function(e,t){e.modules&&0!=e.modules.length&&($L(".gdpr_contenttabMenu_wrapper").show(),commonUtils.showHideLoadingDiv(),thirdPartyUtils.bindSelect2(".moduleSelect"),CrmPrivacyDashboard.populateConsentDashboard(),CrmPrivacyDashboard.populateRequestDashboard())},actions:{willTransition:function(e){-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.preferenceJson={},privacySettings.configJson={}),"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled||Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})),closeAsapWidget(),$L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH"),$("#privacy_subtabdiv").find("#sub_consentDashboard").parent().removeClass("sel")},didTransition:function(){this.transition.refresh&&this.refresh(),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")}},invokeRedirection:function(){if(Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var e;(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(e)}}else(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(e)}}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-form",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"],ResourceConstants.CRM);return e=(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Translation")],ResourceConstants.CRM)),e=(e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],ResourceConstants.CRMClient)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-translation.js"],ResourceConstants.CRMClient))},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js"],ResourceConstants.CRMClient)},redirect:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var e;(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(e)}}else(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(e)},model:function(){if(Events.isPageLayoutModified=!1,commonUtils.showHideLoadingDiv(!0),Crm.userDetails.isPrivacySettingEnabled)return store.findAll("consent_form",{locale:Crm.userDetails.LOCALE});commonUtils.showHideLoadingDiv(!1)},afterModel:function(e){if(void 0!==e){this.currentModel={},this.currentModel.isTranslationCLEnabled=!!isTranslationCustomLanguageEnabled,this.currentModel.consent_form=e[0],this.currentModel.selectedLanguage=Crm.userDetails.LOCALE,this.currentModel.original_consent_form=Lyte.deepCopyObject(e[0]),this.currentModel.isRevertAvailable=e[0].revertAvailable,this.currentModel.clientPortalKey=e[0].client_portal_key;var t=this.setLanguagesInfo(e);this.currentModel.languages=this.splitLanguages(t.filter((e=>-1!==app.cruxCompLocale.indexOf(e.val))),t.filter((e=>-1===app.cruxCompLocale.indexOf(e.val)))),this.currentModel.communicationPreferences=this.setSectionData("Communication_Preferences",e[0]),this.currentModel.consentStatement=this.setSectionData("Consent_Statment",e[0]),this.currentModel.privacyStatement=this.setSectionData("Privacy_Statment",e[0]),this.currentModel.submitButton=this.setSectionData("Submit_Button",e[0]);for(var r=e[0].sections.length,s=0;s<r;s++){var n=e[0].sections[s];switch(n.api_name){case"Communication_Preferences":this.currentModel.prefsectionShown=n.visible;break;case"Consent_Statment":this.currentModel.consentStatementShown=n.visible;break;case"Privacy_Statment":this.currentModel.privacyStatementShown=n.visible;for(var i=n.fields.length,o=0;o<i;o++){var a=n.fields[o];"Privacy_Policy"===a.api_name&&(this.currentModel.privacyPolicy=a.value.length>0?a.value:"")}}}void 0!==Crm.userDetails.orgName?this.currentModel.companyName=Crm.userDetails.orgName:this.currentModel.companyName=I18n.getMsg("crm.gallery.template.dummy.companyname"),void 0!==Crm.userDetails.org_logo&&(this.currentModel.companyLogo="/crm/viewInLineImage?fileContent="+Crm.userDetails.org_logo)}},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-consent-form"}},afterRender:function(e,t){$L(".gdpr_contenttabMenu_wrapper").show(),commonUtils.showHideLoadingDiv(),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")},actions:{willTransition:function(e){if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),$("#privacy_subtabdiv").find("#sub_consentForm").parent().removeClass("sel"),void 0!==Events.isPageLayoutModified&&Events.isPageLayoutModified){var t=e.pause(),r="stayonPageConfirmBox",s=$("#"+r);renderingUtils.freezeBackground(),mailsetCenter(r),s.find(".leavePage").off("click").click((function(){s.hide(),t.resume(),renderingUtils.removeFreezeLayer(),Events.isPageLayoutModified=!1})),s.find(".stayPage").off("click").click((function(){s.hide(),e.abort(),$("#privacy_subtabdiv").find("#sub_consentForm").parent().addClass("sel"),renderingUtils.removeFreezeLayer()})),s.focus()}else"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.transitionTo({route:"crm.settings.section.compliance.consent-dashboard"}):Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"}));return $L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH"),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.Action||(window.isHelpOptionOpened||ZohoHCAsap.Action("close"),removeViewPortFromAsapWidget()),!0}}},{mixins:["crm-compliance","crm-translation-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.compliance.hipaa",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-hipaa-compliance.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("hipaaCompliance")],ResourceConstants.CRM);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-hipaa-compliance.css"],ResourceConstants.CRMClient))).concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["hipaa-store.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return Lyte.resolvePromises({privacy_preference:Crm.userDetails.isHipaaFeatureEnabled?store.findAll("hipaa_compliance"):[]})},lyteConvertionSupported:!0,afterModel:function(e){this.currentModel={},void 0!==e&&(this.currentModel.privacy_preference=e.privacy_preference)},renderTemplate:function(){return $L(".gdprTopBand").hide(),$L(".gdpr_contenttabMenu_wrapper").hide(),{outlet:"#result",component:"crm-hipaa-compliance"}},afterRender:function(){$("#result").removeClass("freezeprivacySettingsTabContent"),$(".gdpr_tabClass").show(),setTimeout((function(){$(".hipaaSettingActionWrap").show()}),700)},redirect:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings&&Crm.userDetails.hipaaTabAvailable&&Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},actions:{willTransition:function(e){"crm.settings.section.compliance"===e.target&&(e.refresh=!0);var t=$L("#saveSettings");if(null!=t[0]&&0!==t[0].length&&!t[0].ltProp("disabled")){var r=e.pause(),s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){store.peekAll("privacy_preference")[0].preference=store.peekAll("privacy_preference").unChangedPreference,n.hide(),r.resume(),renderingUtils.removeFreezeLayer()})),n.find(".stayPage").off("click").click((function(){n.hide(),e.abort(),renderingUtils.removeFreezeLayer()})),n.focus()}},didTransition:function(){$(".complianceAlter").hide()}}}),Lyte.Router.registerRoute("crm.settings.section.compliance.privacy-preference",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-hovercard.js"],ResourceConstants.CRMClient)),e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],ResourceConstants.CRMClient)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js","lyte-hovercard.js"],ResourceConstants.CRMClient)},beforeModel:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),!Crm.userDetails.isPrivacyPrefTablesCreated){var t=Object.assign({},this.transition.info);t.route="crm.settings.section.compliance",this.replaceWith(t)}Crm.trackSpotLightAction("Privacy Preference Settings - Clicked")},lyteConvertionSupported:!0,model:function(){return commonUtils.showHideLoadingDiv(!0),void 0!==store.peekAll("privacy_preference")[0].config&&store.peekAll("privacy_preference")[0].config.hasOwnProperty("section")?void 0===store.peekAll("privacy_preference")[0].preference||"false"!==store.peekAll("privacy_preference")[0].preference.privacy_setting_status||this.settingsObj.isSettingsEnableDisableCall||"filed_in_use"!==store.peekAll("privacy_preference")[0].error_type?store.peekAll("privacy_preference"):store.findAll("privacy_preference"):void 0!==store.peekAll("privacy_preference")[0]&&store.peekAll("privacy_preference")[0].config.hasOwnProperty("section")?store.peekAll("privacy_preference"):store.findAll("privacy_preference")},afterModel:function(e){this.currentModel={},void 0!==e&&(this.currentModel.privacy_preference=e,this.setPreferenceData(e),this.currentModel.consentModules=this.showConsentModules(),this.currentModel.brandName=Crm.brandName,this.currentModel.privacyModuleLimit=Crm.userDetails.privacyModuleLimit,this.currentModel.awaitingActions=this.showAwaitingActions(),this.currentModel.awaitingPeriod=this.showAwaitingPeriod(),this.currentModel.personalDataRestrictions=this.showDataRestrictions(),this.currentModel.tptRestrictions=this.showRestrictionsTpt(),this.currentModel.oldprivacyPreference=e[0].preference,e.unChangedPreference=Lyte.deepCopyObject(this.currentModel.privacy_preference[0].preference))},renderTemplate:function(){var e=$("crm-setup-innerlink")[0];return null!=e&&e.setData({currentRouteInfo:this.transition.info,currentRoute:this.transition.info.route}),$("#settingsEnableSwitch").show(),{outlet:"#result",component:"crm-privacy-preference"}},afterRender:function(e,t){var r=$L("crm-privacy-preference")[0].component;$L(".gdpr_contenttabMenu_wrapper").show();var s=$L("crm-setup-innerlink")[0];s&&s.setData("currentRoute",this.transition.target),Crm.userDetails.isPrivacySettingEnabled?$("#preferencesSaveCancel").show():$("#preferencesSaveCancel").hide(),$($(".gdprComplianceSetting")[0]).addClass("sel"),commonUtils.showHideLoadingDiv(!1),thirdPartyUtils.bindSelect2($("#result").find(".consentDataProcessOptions, .sensitiveSelection")),r.setHeightForPrefSection()},actions:{willTransition:function(e){void 0!==e.info.route&&-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={});var t=$L("#saveSettings");if($("#privacy_subtabdiv").find("#sub_preference").parent().removeClass("sel"),null!=t[0]&&0!==t[0].length&&!t[0].ltProp("disabled")){var r=e.pause(),s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){store.peekAll("privacy_preference")[0].preference=store.peekAll("privacy_preference").unChangedPreference,n.hide(),$("#privacy_subtabdiv").find("#sub_preference").parent().addClass("sel"),r.resume(),renderingUtils.removeFreezeLayer()})),n.find(".stayPage").off("click").click((function(){$L("#tab_usersPermi_preference").attr("selected",!0),n.hide(),e.abort(),renderingUtils.removeFreezeLayer()})),n.focus()}"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.transitionTo({route:"crm.settings.section.compliance.consent-dashboard"}):(e.abort(),Crm.userDetails.isPrivacyPrefTablesCreated&&$("#result").addClass("freezeprivacySettingsTabContent"))),closeAsapWidget()}}},{mixins:["crm-compliance"]}),Lyte.Router.registerRoute("crm.settings.section.compliance",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gdprDetailview.css"],ResourceConstants.CRM);e=e.concat(networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"],ResourceConstants.CRM)),e=(e=(e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],ResourceConstants.CRMClient)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("massAction")],ResourceConstants.CRM);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js","lyte-hovercard.js"],ResourceConstants.CRMClient)},topBandLoaded:!1,beforeModel:function(e){$("#result").html("")},model:function(){return store.findAll("privacy_preference")},afterModel:function(e){this.currentModel={},this.currentModel.privacy_preference=e},redirect:function(){!Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||canShowCompliance&&"false"==canShowCompliance?(renderingUtils.displayPermissionDenied(),this.transition.abort()):Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings&&"crm.settings.section.compliance"===this.transition.info.route&&(this.topBandLoaded=!0,Crm.userDetails.isPrivacyPrefTablesCreated&&!Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.replaceWith({route:"crm.settings.section.compliance.privacy-preference"}):Crm.userDetails.isPrivacyPrefTablesCreated&&"crm.settings.section.compliance.consent-form"!==this.transition.info.route&&"crm.settings.section.compliance.privacy-preference"!==this.transition.info.route&&"crm.settings.section.compliance.consent-dashboard.list-view"!==this.transition.info.route&&Lyte.Router.replaceWith({route:"crm.settings.section.compliance.consent-dashboard"}))},renderTemplate:function(e,t){if(!Crm.userDetails.isPrivacyPrefTablesCreated)return networkUtils.initChart(),$("#settingsEnableSwitch").hide(),$("#watchComplianceVideo").hide(),{outlet:"#result",component:"crm-start-gdpr"}},afterRender:function(e,t){"China"==RebrandLinkUtil.getProperty("DeploymentLocation")&&$("#watchComplianceVideo").remove(),Crm.showZohoCRMStampedEntity||($("#dataCollection").hide(),$("#dataProcessing").hide(),$("#dataRequest").hide(),$("#watchVideoComplianceID").hide()),$("img.contextHelpIcon").attr("onclick","openHelp('Compliance')"),Crm.userDetails.isPrivacyPrefTablesCreated||$(".gdprTopBand").show(),$("#setup_new_ContentDiv").addClass("helpOverflowHide"),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")},actions:{willTransition:function(e){if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),-1!==e.info.route.indexOf("crm.settings.section.compliance")&&-1===e.info.route.indexOf("hipaa")){var t=e.target.split("."),r="crm.settings.section.compliance."+t[t.length-1];$($($(".gdprComplianceSetting,.complianceSettingTabs")[0]).children()[0]).attr("route-selector",r)}$("#setup_new_ContentDiv").removeClass("helpOverflowHide"),$L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH")},onError:function(e){403!==e.status&&401!==e.status||($("#privacySettingDiv").hide(),this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),2e3))},didTransition:function(){this.transition.refresh&&this.refresh();var e=Lyte.Router.getRouteInstance().transition.target;e.includes("hipaa")||"crm.settings.section.compliance"===e||($(".gdprTopBand").show(),$(".complianceAlter").show(),$($($(".gdprComplianceSetting,.complianceSettingTabs")[0]).children()[0]).attr("route-selector",e))}}},{mixins:["crm-compliance"]}),Lyte.Router.registerRoute("crm.settings.section.connections",{getResources:function(){let e=networkUtils.returnDependencyFiles(["zohocrm_connectors.js"],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles(["connectors-main-view.js"],ResourceConstants.CRMClient)),e},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/connectors","GET")},afterModel:function(e){if(e.crm_connectors.error)switch(CrmConnectorObj.error=!0,Object.freeze(CrmConnectorObj),e.crm_connectors.error){case"unconfirmed_email":crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.error.usermail.notconfirmed"),3e3);break;case"permission_denied":crmui.showMsgBand("error",I18n.getMsg("crm.label.cf.error.authorization"),3e3),Lyte.Router.transitionTo("crm.settings.index");break;default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}},renderTemplate:function(){return document.getElementById("result").innerHTML="",{outlet:"#result",component:"connectors-main-view"}},afterRender:function(e){e.crm_connectors.connection_list&&e.crm_connectors.connection_list.connections&&e.crm_connectors.connection_list.connections.length?(CrmConnectorObj.error=!1,CrmConnectorObj.connectionListLength=e.crm_connectors.connection_list.connections.length,$("#connectors_blankpage").hide(),CrmConnectorObj.initializeConnector(),CrmConnectorObj.setHeightWithTimeOut()):CrmConnectorObj.connectionListLength=0},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.copy-customization-history",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-cc-root.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-cc-component.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-cc-root.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("copycustomization")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){return store.findAll("copy-customization-history",null,null,null,{type:"HISTORY"})},afterModel:function(e){var t=e.$.meta,r=e.length>t.per_page?e.slice(0,10):e,s=t.page,n=t.count,i=(t.page-1)*t.per_page,o=t.more_records?10*t.page+t.count:10*t.page,a=t.more_records;this.currentModel={historyList:r,info:t,page:s,count:n,startRecord:i,endRecord:o,more_records:a}},renderTemplate:function(){return{outlet:"#result",component:"copy-customization-history"}},actions:{onError:function(e){var t=void 0!==e.response&&e.response.constructor===String?JSON.parse(e.response):e.response;void 0!==t&&"NO_PERMISSION"===t.code&&(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.copy-customization-new",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-cc-root.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-cc-component.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-cc-root.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("copycustomization")],ResourceConstants.CRM);return e.concat(t).concat(r)},renderTemplate:function(){return{outlet:"#result",component:"crm-copy-customization-home"}},beforeExit:function(){_cruxUtils.removeCustomMessage()},model:function(){var e=new CrmDate(Crm.userDetails.ORG_CREATED_TIME),t=new CrmDate(Crm.userDetails.ORG_CREATED_TIME+31556952e3),r=CrmDateUtils.convertDateTimetoISOFormat(e.getDateTimeInUserPattern()),s=CrmDateUtils.convertDateTimetoISOFormat(t.getDateTimeInUserPattern());return Lyte.resolvePromises({auditHistory:store.findAll("dummy",{module:"Setup",from:r,to:s},!1,!1,{url:"crm/v2/settings/audit_logs"}),historyList:store.findAll("copy-customization-history",{type:"import",status:"customer_action_pending",per_page:10},null,null,{type:"customer_action_pending"}),sentCCList:store.findAll("copy-customization-history",{type:"export",status:"sender",per_page:10},null,null,{type:"sender"})})},afterModel:function(e){var t,r,s,n,i=new CrmDate(Crm.userDetails.ORG_CREATED_TIME+3e5),o=0;(void 0!==e.auditHistory.meta&&(0===e.auditHistory.meta.count?e.isConfigured=!1:(e.auditHistory.audit_logs.forEach((function(e){"Analytics Dashboard"!==e.resource&&"data"!==e.resource&&"Dashboards"!==e.resource&&"Analytics Component"!==e.resource||!i.leadingTimeInMins(new CrmDate(e.audited_time))||o++})),e.isConfigured=!(o>0&&e.auditHistory.audit_logs.length===o))),void 0!==e.historyList||void 0!==e.sentCCList)&&(void 0!==e.historyList&&(r=(t=e.historyList).length>0),void 0!==e.sentCCList&&(s=(n=e.sentCCList).length>0),this.currentModel={historyList:t,isConfigured:e.isConfigured,hasRequest:r,sentCCList:n,hasSentCC:s,sendErrorMsg:undefined,recieveErrorMsg:undefined})},actions:{onError:function(e){Crm.userDetails.isCopyCustomizationRevamp?"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort()):this.transitionTo("crm.settings.section.copy-customization")}}}),Lyte.Router.registerRoute("crm.settings.section.copy-customization",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ResellerConfig.do","GET",{params:{action:"getResellerLoginInfo"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){$("#setup_new_ContentDiv").addClass("helpOverflowHide")},actions:{onBeforeLoad:function(){Crm.userDetails.isCopyCustomizationRevamp&&this.transitionTo("crm.settings.section.copy-customization-new")},willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close")),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.create-email-parser",{queryParams:["tabId","parserName"],model:function(e){var t={action:"newRule",tabId:this.getQueryParams().tabId,parserName:this.getQueryParams().parserName};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:t})},renderTemplate:function(e){mailparser.createParserRule(null,"fromCreate"),mailparser.newRule(e.mail_parser[0])}}),Lyte.Router.registerRoute("crm.settings.section.crm-cscript",{queryParams:[{tab:{refreshModel:!1,sticky:!1}}],getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){const e=networkUtils.returnDependencyFiles(["cscript/crm-cscript-setup.js","cscript/convert-to-asyncawait.js","cscript/crm-cscript-setup.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cscript")],ResourceConstants.CRM);return e.concat(t)},model:function(){store.unloadAll("cscript");const e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({cscript:store.findAll("cscript",{include_extra_details:!0}),page_uuid:e&&e.page_uuid,snippet_uuid:e&&e.snippet_uuid})},afterModel:function(e,t){if(e.cscript.length){let r;r=!t.queryParams.tab&&1===e.cscript.length&&e.cscript.find((e=>"commands"===e.definition_name))?"Commands":["Module","Commands"].includes(t.queryParams.tab)?t.queryParams.tab:"Module",!t.queryParams.tab&&this.replaceWith("crm.settings.section.crm-cscript",{tab:r}),e.active_tab=r}},renderTemplate:function(){return{outlet:"#result",component:"crm-cscript-setup",reRender:!0}},afterRender:function(){if(Crm.client_tracking("cscript_setup_visited"),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var e=document.querySelector("crm-cscript-setup");e&&e.component&&e.component.actions.openpopup.call(e.component)}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.crm-data-hub-source",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-tree.js","lyte-editor.js","lytecombobox.js","crm-help-link.js","crux-criteria-conditions.js","crux-criteria-component.js","crux-form-component.js","crux-parent-form-component.js","datahub-setup/crm-datahub-form.js","datahub-setup/crm-datahub-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-datahub-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("data-hub")],ResourceConstants.CRM);return e.concat(r).concat(t)},beforeModel:function(){featuresAvailable.QUERY_SOURCES||(this.transition.abort(),history.back(1),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),ltPropType:"error",ltPropTime:5e3}}));var e=this.transition.info.queryParams;e&&e.sourceId&&(Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.crm-data-hub-source").data={sourceId:e.sourceId})},model:function(){store.unloadAll("datahub");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({active_tab:"source",datahub_source:store.findAll("datahub_source"),sourceId:e&&e.sourceId})},renderTemplate:function(){return Crm.trackSpotLightAction("Data Hub - Visited"),{outlet:"#result",component:"crm-datahub-setup",reRender:!0}},didDestroy:function(){store.clearCachedQuery("dummy","dh_conn")}}),Lyte.Router.registerRoute("crm.settings.section.crm-data-hub",{getResources:function(){let e=networkUtils.returnDependencyFiles(["lyte-tree.js","lyte-editor.js","lytecombobox.js","crm-help-link.js","crux-criteria-conditions.js","crux-criteria-component.js","crux-form-component.js","crux-parent-form-component.js","datahub-setup/crm-datahub-form.js","datahub-setup/crm-datahub-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-datahub-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("data-hub")],ResourceConstants.CRM);return e.concat(r).concat(t)},beforeModel:function(){var e=this.transition.info.queryParams;e&&e.queryId&&(Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.crm-data-hub").data={queryId:e.queryId})},model:function(){store.unloadAll("datahub");let e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({active_tab:"query",datahub:store.findAll("datahub"),queryId:e&&e.queryId})},renderTemplate:function(){return Crm.trackSpotLightAction("Data Hub - Visited"),{outlet:"#result",component:"crm-datahub-setup",reRender:!0}}}),Lyte.Router.registerRoute("crm.settings.section.crm-data-model",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-data-model.js","lyte-sticky.js","crm-ui-loaders.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-data-model.css","crm-ui-loaders.css"],ResourceConstants.CRMClient);t=networkUtils.returnDependencyFiles(["crm-data-model.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(t);var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("data-model")],ResourceConstants.CRM);return e.concat(t).concat(r)},lyteConvertionSupported:!0,model:async function(){try{return await store.findAll("dummy",null,!1,!1,{url:"crm/v5/settings/data_model",method:"GET"})}catch(e){return}},afterModel:function(e){void 0===e||0===Object.keys(e).length?this.currentModel={generation_in_progress:!1,is_model_generated:!1}:null===e.url?this.currentModel={generation_in_progress:!0,is_model_generated:!1}:(this.currentModel={generation_in_progress:!1,is_model_generated:!0,url:e.url},null!==localStorage.getItem("datamodel_generated_user_id")&&localStorage.removeItem("datamodel_generated_user_id")),this.currentModel.isModuleBuilderAccessible=!!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM},renderTemplate:function(){return Crm.trackSpotLightAction("Data Model - Visited"),{outlet:"#result",component:"crm-data-model"}}}),Lyte.Router.registerRoute("crm.settings.section.components",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-lux-store.js"],ResourceConstants.CRMClient)},getResources:function(){const e=networkUtils.returnDependencyFiles(["crm-lux-bundle.js","crm-lux-mixins.js","crm-lux-helpers.js","crm-help-link.js","lyte-progressbar.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["lux/crm-lux-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("lux")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){(!featuresAvailable.cscript||CScriptLib&&_cscript._is_preview_frame)&&(this.transition.abort(),history.back(1),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg(_cscript._is_preview_frame?"dxeditorpreview.settings.notsupported":"crm.setup.attribution.FEATURE_NOT_SUPPORTED"),ltPropType:"error",ltPropDuration:5e3,ltPropClass:"dx_message_box"}}))},redirect:function(){"crm.settings.section.components"===this.transition.target&&Lyte.Router.transitionTo("crm.settings.section.components.home")}}),Lyte.Router.registerRoute("crm.settings.section.components.home",{model:function(){let e=objectUtils.cloneObject(this.transition.data),t=store.peekAll("lux");return t.length&&t.length>1?{luxList:t}:Lyte.resolvePromises({luxList:store.findAll("lux"),cur_audit_id:e&&e.cur_audit_id})},renderTemplate:function(e){return e.luxList.sort(((e,t)=>{const r=e.modified_time?$L.moment(e.modified_time).toDate():$L.moment(e.created_time).toDate();return(t.modified_time?$L.moment(e.modified_time).toDate():$L.moment(e.created_time).toDate())-r})),{outlet:"#result",component:e&&e.luxList&&e.luxList.length?"crm-lux-body":"crm-lux-welcome"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.system.components"),Crm.partnerName]))},actions:{onError:function(e,t){this.on_route_error(e,t)}}}),Lyte.Router.registerRoute("crm.settings.section.components.edit",{model:async function(){var e=this.getDynamicParam();try{let t=store.peekRecord("lux",e);if((t&&t.id||e)&&(t=await store.findRecord("lux",e),t=t[0]),!t)throw JSON.stringify({code:"INVALID_DATA",details:{resource_path_index:2}});return{componentRecord:t,mode:"edit"}}catch(e){this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.components.home");let t=e.payLoad?e.payLoad:JSON.parse(e);commonUtils.showHideLoadingDiv(!1),this.showLuxComponentsError(t)}},renderTemplate:function(e){if(e&&e.componentRecord)return{outlet:"#result",component:"crm-lux-form-new"};Lyte.Router.transitionTo("crm.settings.section.components.home")},actions:{onError:function(e,t){this.on_route_error(e,t)}}},{mixins:"crm-lux-utils"}),Lyte.Router.registerRoute("crm.settings.section.components.editor",{getResources:function(){let e=networkUtils.returnDependencyFiles(["IdbUtil.js","lyte-tree.js","dx-editor/dx-editor.js","crm-lux-editor.js","lytecombobox.js","function-model.js"],ResourceConstants.CRMClient);const t=Crm.userDetails.CUSTOMIZE_INFO.cscript_editor&&JSON.parse(Crm.userDetails.CUSTOMIZE_INFO.cscript_editor);t&&"vs"===t.theme&&(t.theme="vs-light",Crm.userDetails.CUSTOMIZE_INFO.cscript_editor=JSON.stringify(t));let r=networkUtils.returnDependencyFiles(["dx-editor/dx-editor-themeing.css"],ResourceConstants.CRMClient,this.getDxStaticPath(t&&t.theme,"lux"))[0],s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dxeditor")],ResourceConstants.CRM)[0],n=networkUtils.returnDependencyFiles(["lux/crm-lux-bundle.css"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-lux-preview.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["lux/crm-lux-preview.css"],ResourceConstants.CRMClient)),o=networkUtils.returnDependencyFiles(["zohocrm_detail_canvas_common.js"],ResourceConstants.CRM);return e.concat(r).concat(s).concat(n).concat(i).concat(o).concat([...networkUtils.returnDependencyFiles(["crm-datahub-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),...networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("data-hub")],ResourceConstants.CRM),...networkUtils.returnDependencyFiles(["lyte-tree.js","lyte-progressbar.js","lyte-resize.js","lyte-editor.js","lyte-code-snippet.js","lyte-scrollspy.js","lytecombobox.js","lyte-ui-code-snippet.css","crm-help-link.js","crux-criteria-conditions.js","crux-criteria-component.js","crux-form-component.js","datahub/crm-datahub-global-mixin.js","datahub/crm-datahub-source.js"],ResourceConstants.CRMClient)])},model:async function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam();try{let t=store.peekRecord("lux",e);if((t&&t.id||e)&&(t=await store.findRecord("lux",e),t=t[0]),!t)throw JSON.stringify({code:"INVALID_DATA",details:{resource_path_index:2}});return{component_record:t,show:!0}}catch(e){this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.components.home");let t=e.payLoad?e.payLoad:JSON.parse(e);commonUtils.showHideLoadingDiv(!1),this.showLuxComponentsError(t)}},renderTemplate:function(){return{outlet:"#result",component:"crm-lux-editor-new"}},actions:{onError:function(e,t){this.on_route_error(e,t)},willTransition:function(){let e=$L("crm-lux-editor-new")[0];e&&e.component&&e.component.getData("show")&&e.component.actions.dx_editor_close.call(e.component)}},getDxStaticPath:function(e,t){return"lux"!==t||e?"vs-light"===e?ResourceConstants.LESSDEFAULT||"default":"vs-blue"===e?ResourceConstants.LESSFEATUREBlUE||"feature-blue":"vs-darkplus"===e?ResourceConstants.LESSFEATUREBLACKPLUS||"feature-black-plus":ResourceConstants.LESSFEATURE||"feature-black":ResourceConstants.LESSDEFAULT}},{mixins:["crm-lux-utils","crm-cscript-global-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.crm-static-resource",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["cscript/convert-to-asyncawait.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource.js","lyte-progressbar.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource.css"],ResourceConstants.CRMClient);!0===Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource-rtl.css"],ResourceConstants.CRMClient)));var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("StaticResources")],ResourceConstants.CRM);return t.concat(r).concat(s).concat(e)},model:function(){store.unloadAll("static_resources");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({static_resources:store.findAll("static_resources",{page:"1",per_page:"200"}),storage_meta:store.triggerAction("static_resources","getUsage",{},{},"GET"),cur_audit_id:e&&e.cur_audit_id})},renderTemplate:function(){return Crm.trackSpotLightAction("CRM Static Resource - Visited"),{outlet:"#result",component:"crm-static-resource",reRender:!0}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.crm-templates",{queryParams:["type","module","folder","step","templateId","templateName","selectedcategory","fromComponent","relatedModule","feature_name","name"],getDependencies:function(){var e=this.getQueryParams().type;if("mail-merge"===e){var t=networkUtils.returnDependencyFiles(["mailmerge.js","mailmerge_folders-store.js","crux-combo-box.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["mailmerge.css"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["mailmerge-rtl.css"],ResourceConstants.CRMClient))),t.concat(r)}var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailinventorytemplates")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("editorframework")],ResourceConstants.CRM);return[s=s.concat(n)]},getResources:function(){var e=this.getQueryParams().type;if("mail-merge"!==e){var t=["zohocrm_template.js","zohocrm_templatenew.js",networkUtils.includeChartFiles()[0]],r=["templateInner.js"],s=template.isLoaded,n=networkUtils.returnDependencyFiles(["crm-templates-common.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient);return n=(n=n.concat(networkUtils.returnDependencyFiles(["crm-templates-common.css","crm-emailtemplate-sendtestmail.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-template-sendmail.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),"email"===e&&(t.push("zohocrm_templatestats.js"),r.push("crmTemplateStats.js"),r.push("templatestatsHB.js"),s=s&&"undefined"!=typeof crmTemplateStats,n=n=(n=n=n.concat(networkUtils.returnDependencyFiles(["email-footer-common-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailFooterCommon")],ResourceConstants.CRM))),this.getQueryParams().feature_name===moduleApiMapping.CalendarBookings&&(n=n.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM))),n.concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRM))}},model:function(e){var t=this.transition.data,r=e.queryParams.type||"email";if("mail-merge"===r){e={type:"mailmerge",page:0};return Lyte.resolvePromises({templates:store.findAll("mailmerge_templates",e).catch((function(e){var t=JSON.parse(e.response);"unauthorized"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.zti.error.notauthendication"),1e4),"not_supported"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.zes.mobile.error.feature"),1e4)})),folders:store.findAll("mailmerge_folders"),modules:store.findAll("mailmerge_modules")})}var s=Crm.getCrmBasePath()+"/Template.do",n="GET",i={},o="email"===r;switch(e.queryParams.step){case"create":i.step=o?"newEmailTemplate":"newInventoryTemplate",i.feature_name=this.getQueryParams().feature_name,Object.keys(t).length>0&&(i.step=t.step,"useGalleryTemplate"===t.step&&(i.inventory=!o,n="POST"),i.fromComponent=t.fromComponent),i.emailTemplateId=e.queryParams.templateId,i.templateName=e.queryParams.templateName,i.selectedcategory=e.queryParams.selectedcategory;break;case"edit":i.step=o?"editEmailTemplate":"editInventoryTemplate",i.feature_name=this.getQueryParams().feature_name,i.name=this.getQueryParams().name,i.emailTemplateId=e.queryParams.templateId;break;case"clone":i.step=o?"cloneEmailTemplate":"cloneInventoryTemplate",i.emailTemplateId=e.queryParams.templateId,i.templateName=e.queryParams.templateName;break;case"showGallery":i.step=o?"showGallery":"showInventoryGallery",i.fromComponent=e.queryParams.fromComponent;break;default:i.step=o?"showAllTemplates":"showInventoryTemplates",i.emailTemplateId=e.queryParams.templateId}i.module=e.queryParams.module&&"undefined"!==e.queryParams.module?e.queryParams.module:void 0,i.folder=e.queryParams.folder&&"undefined"!==e.queryParams.folder?e.queryParams.folder:void 0,i.relatedModule=e.queryParams.relatedModule&&"undefined"!==e.queryParams.relatedModule?e.queryParams.relatedModule:void 0;var a={params:i};return crmHistory.loaded||(a.headers={"is-Page-Load":"true"}),networkUtils.lyteInitiateRequest(s,n,a)},afterModel:function(e,t){if("showGallery"===t.queryParams.step&&template.hideAnimatePopup("createTemplatePop",!0),"mail-merge"===t.queryParams.type){var r=!0;void 0!==e.templates&&e.templates.$.meta.info.more_records&&(r=!0),e.folders=store.peekAll("mailmerge_folders"),e.hasMoreRecords=r,this.currentModel={mailMergeDetails:e}}if(featuresAvailable.NEXTGENUI_ENABLED){var s=document.querySelector("crm-left-menu").component;"showGallery"===t.queryParams.step?s.actions.showOrHideLeftPane(!1):s.actions.showOrHideLeftPane(!0)}},renderTemplate:function(e,t){return"mail-merge"===(t.queryParams.type||"email")?{outlet:"#result",component:"crm-templates-view"}:{outlet:"#result",html:e}},afterRender:function(e,t){if($("#setup_new_ContentDiv").addClass("helpOverflowHide"),$("#setupInnerLinks").hide(),$("#createProcessContainer").is(":visible"))$(".setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow");else{var r=$("#setup_new_leftmenuDiv");r.show(),$(".setupleftmenutd").removeClass("tempAnimated"),r.removeAttr("class")}if("showGallery"===t.queryParams.step&&template.isTemplateEditorEnabled&&(template.showChooseTemplatePage(),thirdPartyUtils.bindSelect2("#selectModule",{minimumResultsForSearch:1/0}),thirdPartyUtils.unbindPerfectScroll("#galleryCtn"),thirdPartyUtils.bindPerfectScroll("#galleryCtn",{wheelSpeed:1,preventOnEnd:!1}),thirdPartyUtils.bindPerfectScrollUpdate("#galleryCtn")),$("#securityError").length&&t.queryParams&&!t.queryParams.step&&template.setCustomTab("email"),this.getQueryParams().feature_name===moduleApiMapping.CalendarBookings){var s=$L("#templateName");"edit"===this.getQueryParams().step&&(this.getQueryParams().name.includes("confirmmail")?s.val(I18n.getMsg("crm.cb.conf.email")):this.getQueryParams().name.includes("reschedulemail")?s.val(I18n.getMsg("crm.cb.resc.email")):this.getQueryParams().name.includes("cancelmail")?s.val(I18n.getMsg("crm.cb.cancl.email")):this.getQueryParams().name.includes("remindermail")&&s.val(I18n.getMsg("crm.cb.rem.email"))),$L("#calendarbookingsystemname").val(this.getQueryParams().name)}},actions:{willTransition:function(){"mail-merge"===this.getQueryParams().type&&store.unloadAll("mailmerge_folders"),closeAsapWidget(),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){$(".tabClass").hide(),$("#setupInnerLinks").show(),$(".setupleftmenutd, #setup_new_leftmenuDiv").add(".leftCtnTemp").css("display","").removeClass("w0Imp").removeClass("tempAnimated"),store.unloadAll("email_footers"),template.email_footers={},template.emailFooterEnabled=!1}}),Lyte.Router.registerRoute("crm.settings.section.crm-triggers",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-triggers.js","function-model.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-triggers.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("triggers")],ResourceConstants.CRM);return e.concat(t).concat(r)},redirect:function(){if("crm.settings.section.crm-triggers"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.crm-triggers.index-crm-triggers",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.crm-trusted-domain",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain.css"],ResourceConstants.CRMClient);!0===Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain-rtl.css"],ResourceConstants.CRMClient)));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("TrustedDomains")],ResourceConstants.CRM);return networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain.js"],ResourceConstants.CRMClient).concat(e).concat(t)},model:function(){store.unloadAll("trusted_domains");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({trusted_domains:store.findAll("trusted_domains",{page:"1",per_page:"200"}),cur_audit_id:e&&e.cur_audit_id})},renderTemplate:function(){return Crm.trackSpotLightAction("CRM Trusted Domain - Visited"),{outlet:"#result",component:"crm-trusted-domain"}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-link",{queryParams:["fromTemplate"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-unsubscribe-link.js","crm-lyte-editor-pannel.js","lyte-resize.js","lyte-colorpicker.js","lyte-draggable.js","lyte-code-snippet.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["lyte-ui-code-snippet.css"],ResourceConstants.CRMClient));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("unsubscription")],ResourceConstants.CRM);t=t.concat(networkUtils.returnDependencyFiles(["lyte-ui-editor-i18n/"+Crm.userDetails.RELEVANT_LOCALE+".js"],ResourceConstants.CRMClient));var r=networkUtils.returnDependencyFiles(["crm-unsubscribe-link.css","lyte-ui-code-snippet.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(r).concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-unsubscribe-link-datastore.js"],ResourceConstants.CRMClient)},model:function(e){return Lyte.resolvePromises({unsubscribe_links:store.findAll("unsubscribe_link"),template:store.triggerAction("unsubscribe_link","associations"),fromTemplate:e.queryParams.fromTemplate})},lyteConvertionSupported:!0,afterModel:function(e){var t=e.template.associations,r=e.unsubscribe_links,s=Object.keys(r).length;if(t){var n=Object.keys(t).length;for(let e=0;e<s;e++){var i=!1,o=!1;for(let s=0;s<n;s++)if(r[e].id===t[s].id){r[e].template=t[s];var a=t[s].associated_places,l=Object.keys(a).length;for(let t=0;t<l;t++)"email_footer"===a[t].type&&(o=!0,r[e].isemailfooter=!0),"email_templates"===a[t].type&&(i=!0,r[e].istemplate=!0);break}i||o||(r[e].template=void 0,r[e].istemplate=!1)}}else for(let e=0;e<s;e++)!0===r[e].istemplate&&(r[e].template=void 0,r[e].istemplate=!1)},renderTemplate:function(){return{component:"crm-unsubscribe-link",outlet:"#result"}},afterRender:function(){Crm.client_tracking("Unsubscribe Link - Tab Click")},actions:{onError:function(e){var t,r="";e.response&&("NO_PERMISSION"===(r=JSON.parse(e.response).code)?renderingUtils.displayPermissionDenied():"INTERNAL_ERROR"===r&&(t='<div class="darkMainHead"><span id="warningMsg">'+I18n.getMsg("error.database.problem")+"</span></div>",_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:t,ltPropYield:!0}})),this.transition&&this.transition.abort())}},didDestroy:function(){_cruxUtils.removeCustomAlert()}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.create-crm-variable",{queryParams:["groupId"],model:function(){return Lyte.resolvePromises({variableGroup:store.findAll("variable_group"),variablesList:store.findAll("variable"),limits:store.findAll("definition",{resource:"CrmVariables"})})},afterModel:function(e){for(var t=[],r=e.variableGroup.length,s=0;s<r;s++){var n=e.variableGroup[s];"crm"===n.source&&t.push(n)}this.currentModel={groupName:t,variablesList:e.variablesList,groupLimit:e.limits.variable_groups_limit,variableLimit:e.limits.variables_limit}},renderTemplate:function(){return{outlet:"#result",component:"crm-variable-create"}}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.edit-crm-variable",{queryParams:["groupId"],model:function(e){this.getDynamicParam();return Lyte.resolvePromises({variableGroup:store.findAll("variable_group"),variables:store.findAll("variable")})},afterModel:function(e){e.constructor===Object&&e.code&&"NO_PERMISSION"===e.code&&cVar.showPermissionDenied(this.transition),this.currentModel={groupName:e.variableGroup,updatingObj:store.peekRecord("variable",this.getDynamicParam()),variablesList:e.variables,isEditPage:!0},void 0===this.currentModel.updatingObj&&(renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo({route:"crm.settings.section.crm-variables.index-crm-variable"})})),this.transition.abort())},renderTemplate:function(){return{outlet:"#result",component:"crm-variable-create"}}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.index-crm-variable",{model:function(){return store.unloadAll("variable"),store.unloadAll("variable_group"),Lyte.resolvePromises({variables:store.findAll("variable"),variableGroup:store.findAll("variable_group")})},afterModel:function(e){this.currentModel={variableList:e.variables,groupList:e.variableGroup}},renderTemplate:function(){return{outlet:"#result",component:"crm-variable-component"}},actions:{onError:function(e){e.response.indexOf("NO_PERMISSION")>-1&&(Lyte.Router.transitionTo("crm.settings.index"),setTimeout((function(){crmui.showMsgBand("error",I18n.getMsg("crm.label.cf.error.authorization"),3e3)}),100))}},afterRender:function(){if(this.transition.data&&this.transition.data.newOneAdded){var e=this.transition.data.newOneAdded,t=$L("#setup_new_ContentDiv"),r=$("#"+e),s=r.offset().top+t.scrollTop()-210;t.animate({scrollTop:s}),r.addClass("highlgtMLookup"),setTimeout((function(){r.removeClass("highlgtMLookup"),e=void 0}),5e3)}}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_variables.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-variable-component.js","modulelist_variable.js","definition-model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-help-link.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["setup/crm-variables/crmvariables.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["zohocrm_variables.css"],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("variables")],ResourceConstants.CRM),o=e.concat(t).concat(s).concat(i).concat(r);return n.concat(o)},redirect:function(e){if("crm.settings.section.crm-variables"===this.transition.target){var t=Object.assign({},this.transition.info);t.route="crm.settings.section.crm-variables.index-crm-variable",this.replaceWith(t)}},actions:{willTransition:function(){$(".crmBodyWin").removeClass("oH")},didTransition:function(){$(".crmBodyWin").addClass("oH")}}}),Lyte.Router.registerRoute("crm.settings.section.crm-widgets",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-widget-data-store.js"],ResourceConstants.CRMClient)},getResources:function(){const e=networkUtils.returnDependencyFiles(["crm-widget-container.js","lyte-fileupload.js","crm-help-link.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("widgets")],ResourceConstants.CRM);return t.concat(r).concat(e)},model:function(e){return store.findAll("widgets",{},!1,!0,"isFromWidget").then((function(e){return{crm_widgets:e}}),function(e){commonUtils.showHideLoadingDiv(!1),this.showWidgetErrorMessage(JSON.parse(e.response),!0,!0,void 0,!0),Lyte.Router.transitionTo("crm.settings.index")}.bind(this))},afterModel:function(e,t){var r=$("#setup_new_ContentDiv"),s=renderingUtils.windowHeight-(r.offset().top+26+16);if(!(this.error_key||e&&e.status&&"error"===e.status)&&e&&e.crm_widgets){var n=this.transition.data;n&&n.isAjax||($("#widgetsTabHeader").css("display","block"),r.height(s),thirdPartyUtils.bindSelect2($(".newSelect").find("select")))}},renderTemplate:function(e,t){if(e&&e.crm_widgets&&0!==e.crm_widgets.length){var r=this.transition.data;return r&&r.isAjax?{outlet:"#result",html:""}:{outlet:"#result",component:"crm-widgets-body"}}return{outlet:"#result",component:"crm-widget-welcome"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.widgets"),Crm.partnerName]))},actions:{onError:function(e,t,r){return this.error_key=!0,this.currentModel=e.responseJSON,t.resume(),!1}}},{mixins:"crm-widget-utils"}),Lyte.Router.registerRoute("crm.settings.section.currencies.currencies-old",{model:function(){return store.triggerAction("dummy","dummyAction",{url:Crm.getCrmBasePath()+"/CurrencyAction.do?action=listview",method:"GET"})},renderTemplate:function(e){return{outlet:"#result",html:e}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.currencies"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.currencies.index",{model:function(){return Lyte.resolvePromises({available_currencies:store.findAll("available_currency"),currencies:store.findAll("currency"),features:store.findAll("features",{api_names:["multicurrency_nf"].join(",")},!1,!0,{version:"v7"}),usersData:store.findAll("user",{type:"ActiveConfirmedUsers"})})},renderTemplate:function(){return{outlet:"#result",component:"crm-currencies-tab",reRender:!0}},afterModel:function(e){for(var t=this.transition.data,r=Lyte.deepCopyObject(e.available_currencies),s={},n={},i=r.length,o=0;o<i;o++){for(var a=r[o].iso_code,l=[],c=r[o].symbol.length,u=0;u<c;u++){var d={};d.symbol=r[o].symbol[u],l.push(d)}s[a]=l;var m=[];m.push(r[o].decimal_places),m.push(" "===r[o].decimal_separator?"s":r[o].decimal_separator),m.push(" "===r[o].thousand_separator?"s":r[o].thousand_separator),m.push(r[o].display_name),m.push("Indian"===r[o].numeral_system?"2":"1"),n[a]=m}var p=e.currencies,g=p.length,f=0,h=Lyte.registeredMixins["currency-utils"],y=h.getUserIdVsZuid(e.usersData),C=p.length>1||1===p.length&&p[0].is_base;if(p.length>0&&""!==Crm.userDetails.BASE_CURRENCY)for(o=0;o<g;o++){p[o].is_active&&!p[o].is_base&&f++,p[o].id===t.currencyId?p[o].isRecordEdited=!0:p[o].isRecordEdited=!1;var v=h.getSeparatorDisplayValue(p[o].format.thousand_separator)+h.getSeparatorDisplayValue(p[o].format.decimal_separator)+h.getSeparatorDisplayValue(p[o].format.numeral_system),_=p[o].format.decimal_places>0?p[o].format.decimal_places-1:p[o].format.decimal_places;p[o].display_format=p[o].symbol+" "+h.getSepDisplayName(v,_,p[o].iso_code),p[o].modified_date_display_value=Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(p[o].modified_time)),p[o].modified_time_display_value=Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(p[o].modified_time),!0);var R=p[o].modified_by?p[o].modified_by.id:p[o].created_by.id;if(p[o].modified_user_image=commonUtils.getPhotoURL(y[R]),p[o].name=I18n.getMsg("crm.label.currency."+p[o].iso_code)+" - "+p[o].iso_code,C)for(u=0;u<i;u++)if(r[u].display_value===p[o].iso_code){Lyte.arrayUtils(r,"removeAt",u,1);break}p[o].is_base&&(h.CrmCurrencies.baseCurrencySymbol=p[o].symbol),i=r.length}h.CrmCurrencies.currenciesDetails=n,h.CrmCurrencies.currenciesSymbol=s,h.CrmCurrencies.availableCurrencies=r,h.CrmCurrencies.currencies=p,h.CrmCurrencies.currenciesLimit=0;for(var w=e.features.length,b=0;b<w;b++)null!==e.features[b].feature_label&&"MULTICURRENCY_NEW_FLOW"===e.features[b].feature_label&&(h.CrmCurrencies.currenciesLimit=e.features[b].details.limits.total);h.CrmCurrencies.activeCurrenciesCount=f,h.CrmCurrencies.selectedFilter=t.selectedFilter?t.selectedFilter:"all",h.CrmCurrencies.searchFilterData=t.searchData?t.searchData:void 0,h.CrmCurrencies.userIdVsZuid=y,h.isFreeEdition(Crm.userDetails.LICENSE_TYPE)&&C&&(h.CrmCurrencies.isFreeEdition=!0)},afterRender:function(){var e=this.transition.data,t=Lyte.registeredMixins["currency-utils"];e.saveAndNew?t.renderAddCurrencyPopUp():e.isEditComingFromViewPage&&store.findAll("currency_log",{resource:"Currencies",record_id:e.currencyId,page:1,per_page:200}).then((function(r){t.showViewCurrencyPopUp(e.currencyId,r)})),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.currencies"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.currencies",{model:function(){return Lyte.resolvePromises({permissions:store.findRecord("user",Crm.userDetails.USER_ID,{include_inner_details:"profile.permissions_details"},!1,!0,{tempApiVersion:"V6"})})},beforeModel:function(){Crm.userDetails.orgName||(this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.company-details"))},afterModel:function(e){if(!e.permissions[0].profile.permissions_details.filter((function(e){return e.name.indexOf("Crm_Implied_Manage_Currencies")>-1}))[0].enabled)return this.transition.abort(),void renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo("crm.settings.section.company-details")}))},getResources:function(){var e=networkUtils.returnDependencyFiles(["currenciesCommon.js","currenciesMixin.js","currenciesDataStores.js","features_model.js","crux-parent-form-component.js","crux-schedular-notification.js"],ResourceConstants.CRMClient);return(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Currencies")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-currencies-tab.css","crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},redirect:function(){if("crm.settings.section.currencies"===this.transition.target||"crm.settings.section.currencies.currencies-old"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.currencies.index"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.create-custom-view",{queryParams:["module"],model:function(e){var t=e.queryParams.module;if(Crm.isActivitySplitDone&&t.Activities&&moduleRecordMapping.Activities.show_as_tab){var r=[t,moduleRecordMapping[t].cvid];return Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:r})}var s={action:"create"};s.module=t;var n={params:s};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomView.do","GET",n)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid.clone-custom-view",{renderTemplate:function(){return{outlet:"#show",html:this.parent.currentModel}},afterRender:function(){$(document.CreateCustomViewForm.cvid).remove(),$("#CloneCustomView,#cvcminfodiv,#cvdelbut,#romsgDv").hide(),$(".cv_noAction,.cv_innerAction,.cv_innerActionEl,.cv_noEditPermission").removeClass("cv_noAction cv_innerAction cv_innerActionEl cv_noEditPermission"),$("#customviewname").removeAttr("disabled"),$("#searchbtn").removeClass("dN");var e=$("#customviewname"),t=e.val();cvNames.push(t.toUpperCase());var r=t.match(/ \( [0-9]+ \)/gi);r&&r[0].length&&t.endsWith(r[0])?(r=parseInt(r[0].match(/[0-9]+/g))+1,t=t.replace(/ \( [0-9]+ \)/gi,"")):r="1",e.val(t+" ( "+r+" )").focus()}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid.edit-custom-view",{model:function(){return store.findAll("role",{name:"fetch"},!0,!0)},renderTemplate:function(){return{outlet:"#show",html:this.parent.currentModel}},afterRender:function(){var e=this.transition.info.dynamicParams[0],t=store.peekRecord("custom_view",e);if(!Lyte.isRecord(t)){var r={api_name:moduleRecordMapping[this.transition.info.queryParams.module].api_name};store.pushPayload("custom_view",{id:e,module:r})}}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid",{queryParams:["module"],model:function(e){var t=e.queryParams.module;if(Crm.isActivitySplitDone&&t.Activities&&moduleRecordMapping.Activities.show_as_tab){var r=[t,moduleRecordMapping[t].cvid];return Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:r})}var s={};s.cvid=e.dynamicParam,s.action="edit",s.module=e.queryParams.module;var n={params:s};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomView.do","GET",n)}}),Lyte.Router.registerRoute("crm.settings.section.custom-view",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("listview")],ResourceConstants.CRM)}}),Lyte.Router.registerRoute("crm.settings.section.data-backup",{getResources:function(){var e=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],t=networkUtils.returnDependencyFiles(["crm-data-backup.js","crm-backup-store.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("databackup")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-data-backup.css"],ResourceConstants.CRMClient);return e.concat(t).concat(s).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-backup-store.js"],ResourceConstants.CRMClient)},actions:{refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)},onError:function(e,t,r,s){if("model"===s&&e&&e.responseText){var n=JSON.parse(e.responseText);if(n.code&&"NO_PERMISSION"===n.code)return renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo({route:"crm.settings.index"})}),null),!1}},willTransition:function(){closeAsapWidget()}},model:function(e){return Lyte.resolvePromises({info:store.findAll("backup",null,!1,!0),links:store.findAll("backup",null,!1,!1,{type:"urls"})})},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},renderTemplate:function(e){return{outlet:"#result",component:"crm-backup-home"}},afterModel:function(e){if("F"!==Crm.userDetails.LICENSE_TYPE_ACTUAL&&"N"!==Crm.userDetails.LICENSE_TYPE_ACTUAL&&"L"!==Crm.userDetails.LICENSE_TYPE_ACTUAL){var t=Crm.userDetails.ULTIMATE_ADDON_COUNT&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0,r="U"===Crm.userDetails.LICENSE_TYPE_ACTUAL||"C"===Crm.userDetails.LICENSE_TYPE_ACTUAL||t?I18n.getMsg("crm.text.4"):"X"===Crm.userDetails.LICENSE_TYPE_ACTUAL?r=I18n.getMsg("crm.text.1"):I18n.getMsg("crm.text.2"),s=I18n.getMsg("crm.databackup.configure.msg")+"<br>"+("X"===Crm.userDetails.LICENSE_TYPE_ACTUAL?I18n.getMsg("crm.databackup.configure.starter.edition.msg1"):I18n.getMsg("crm.databackup.configure.msg1",r))+" "+I18n.getMsg("crm.databackup.configure.msg2",Crm.userDetails.manageSubscriptionUrl);e.descContent=s,e.isPaidEdition=!0}(e.info&&(!e.info||"STOPPED"!==e.info.status&&"COMPLETED"!==e.info.status&&"EMPTY"!==e.info.status)||(e.toShowConfigure=!0,e.showOnlyButton=!0,e.info&&e.info.id&&(e.showOnlyButton=!1)),e.links.urls&&e.info&&e.info.status&&"INPROGRESS"!==e.info.status)&&(e.toShowLink=!0,e.links.urls.expiry_date&&Lyte.registeredMixins["crm-backup-util"].getDayDiff(e.links.urls.expiry_date)<0&&(e.toShowLink=!1))}}),Lyte.Router.registerRoute("crm.settings.section.zia.data-enrichment.edit",{queryParams:["fieldId"],renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{component:"crm-data-enrichment-detail",outlet:"#result"}},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0);const t=store.peekRecord("data_enrichment",e.dynamicParam);t||Lyte.Router.transitionTo({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment"});const r=t?t.module.id:void 0;return{currentModule:this.PopulateModuleFields(r)}},model:function(e){const t=store.peekRecord("data_enrichment",e.dynamicParam);t||Lyte.Router.transitionTo({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment"});const r=t?t.module.id:void 0,s=t?t.type:void 0;return{currentModule:this.PopulateModuleFields(r),config:t.id.length<10?Promise.resolve(t):this.getConfig(t),enrichMeta:this.PopulateMeta(r,s),details:this.getEnrichmentLimits()}},beforeExit:function(){$L("#result").removeClass("h100_per")},afterRender:function(){$L("#result").addClass("h100_per")},afterModel:function(e){return e.details=e.details[0]?e.details[0]:e.details,e.config=e.config[0]?e.config[0]:e.config,"204"===e.config.id&&(this.showErrorMessage("Configuration does not exist"),Lyte.Router.transitionTo({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment"})),e.enrichMeta=e.enrichMeta[0]?e.enrichMeta[0]:e.enrichMeta,e.currentModule=e.currentModule[0]?e.currentModule[0]:e.currentModule,e},actions:{onError:function(e){this.handleError(e,!0)}}},{mixins:["enrichment-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.data-enrichment.history-data-enrichment",{getResources:function(){let e=networkUtils.returnDependencyFiles(["lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-enrichment-history.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0),this.currentModel&&Object.keys(this.currentModel).length&&this.transition.abort()},model:function(){return store.triggerAction("data_enrichment","enrich_history",void 0,{page:1,per_page:200,include_inner_details:"$..field.field_label,$..field.column_name"})},afterModel:function(e){this.currentModel={},e&&e.data_enrichment_history?(this.currentModel.enrichHistory=e.data_enrichment_history,this.currentModel.historyInfo=e.meta?e.meta:{}):this.currentModel.enrichHistory=[]},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{component:"crm-data-enrichment-history",outlet:"#result"}}},{mixins:["enrichment-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.data-enrichment.index-data-enrichment",{queryParams:["moduleId"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return{count:this.getEnrichmentLimits(),configs:this.getAllConfigs(!0),orgModules:this.getOrgModules()}},afterModel:function(e){return e.count=e.count[0]?e.count[0]:e.count,e.configs=e.configs.sort(((e,t)=>new CrmDate(e.created_time?e.created_time:e.modified_time)-new CrmDate(t.created_time?t.created_time:t.modified_time))),e.orgModules=e.orgModules.modules.filter((e=>e.visible)),store.peekRecord("data_enrichment_count","1").$.set("modules",e.orgModules),e.details=e.count,e},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{component:"crm-data-enrichment-list",outlet:"#result"}},actions:{onError:function(e){Lyte.registeredMixins["enrichment-utils"].handleError(e,!1,!0)}}},{mixins:["enrichment-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.data-enrichment.stats-data-enrichment",{getResources:function(){let e=networkUtils.returnDependencyFiles(["crm-report.js","crm-report-error.js","crm-report-view-page.js","crm-report-dependencies.js","crm-report-table.js","crux-parent-form-component.js","campaign_status_model.js","crm-sort-popup.js","crm-new-report-popup.js","crm-report-generator.js","crm-report-data.js","model-crm-report.js","crm-report-util.js","crm-report-helpers.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js","zohocrm_chart.js"],ResourceConstants.CRM));let t=networkUtils.returnDependencyFiles(["crm-report-view-page.css","crm-report.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-enrichment-stats.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment"),networkUtils.getI18nJSUrl("Reports")],ResourceConstants.CRM);return e.concat(t).concat(r).concat(s)},beforeModel:function(){if(commonUtils.showHideLoadingDiv(!0),Crm.userDetails&&Crm.userDetails.permissions&&!Crm.userDetails.permissions.Crm_Implied_View_Data_Enrichment_Analytics){let e=Lyte.Component.render("crux-permission-denied-alert",{},"body");e.setMethods({onAccept:function(){crmHistory.backOneLevel()}}),e.setData("cxPropShow",!0),this.transition.abort()}this.currentModel&&Object.keys(this.currentModel).length&&(this.transition.abort(),commonUtils.showHideLoadingDiv(!1))},model:function(){let e=[];return e.push(store.triggerAction("data_enrichment","enrich_reports",this.getReportObj())),e.push(this.getEnrichmentLimits()),Lyte.resolvePromises(e)},afterModel:function(e){e&&e.length&&(this.currentModel={},commonUtils.showHideLoadingDiv(!1),this.currentModel.reportResponse=e[0],this.currentModel.enrichCountDetails=e[1][0]?e[1][0]:e[1],this.currentModel.reportRequest=this.getReportObj(),this.currentModel.enrichSummary={},this.currentModel.enrichSummary.usageCountIndex=this.getAggregateFieldIndex("Usage_Count__s"),this.currentModel.enrichSummary.monthlyLimitIndex=this.getAggregateFieldIndex("Monthly_Limit__s"))},renderTemplate:function(){return{component:"crm-data-enrichment-stats",outlet:"#result"}},getEnrichStatsField:function(e,t,r){return{api_name:e,label:t,ui_type:r}},getAllStatsFields:function(){var e=[];return e.push(this.getEnrichStatsField("Monthly_Limit__s","Monthly Limit",52)),e.push(this.getEnrichStatsField("Usage_Count__s","Consumed Count",52)),e},getAggregateFunctions:function(){var e=[];return e.push({name:"sum",field:this.getEnrichStatsField("Monthly_Limit__s","Monthly Limit",52)}),e.push({name:"sum",field:this.getEnrichStatsField("Usage_Count__s","Consumed Count",52)}),e},getReportObj:function(){var e={show_detail_rows:!0,show_grand_total:!0,show_sub_totals:!0,show_row_count:!1,preview:!1,type:"matrix",module:{api_name:"Data_Enrichment_Stats__s"}};return e.fields=this.getAllStatsFields(),e.group_by=[],e.group_by.push({type:"row",field:this.getEnrichStatsField("Usage_Date__s","Usage Date",333),sort_order:"desc",date_granularity:"month"}),e.group_by.push({type:"column",field:this.getEnrichStatsField("Module__s","Module",137),sort_order:"desc"}),e.aggregate_functions=this.getAggregateFunctions(),e.filters={comparator:"equal",value:"DATA_ENRICH",field:this.getEnrichStatsField("Feature_Name__s","Feature Name",1)},e.filters.field.data_type="text",e},getAggregateFieldIndex:function(e){var t=-1;return this.getAggregateFunctions().filter((function(r,s){r.field.api_name===e&&(t=s)})),t}},{mixins:["enrichment-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.data-enrichment",{queryParams:["moduleId"],getResources:function(){let e=networkUtils.returnDependencyFiles(["lyte-hovercard.js","zia-data-enrichment-config.js","zia-data-enrichment-util.js","crm-ui-loaders.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zia-data-enrichment-config.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment"),networkUtils.getI18nJSUrl("ZiaCommon")],ResourceConstants.CRM);return e.concat(r).concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-data-enrichment-util-model.js"],ResourceConstants.CRMClient)},model:function(){return{count:store.peekRecord("data_enrichment_count","1")?Promise.resolve(store.peekRecord("data_enrichment_count","1")):store.findAll("data_enrichment_count"),configs:store.peekAll("data_enrichment").some((e=>"204"!==e.id))?Promise.resolve(store.peekAll("data_enrichment")):store.findAll("data_enrichment")}},afterModel:function(e){e.count=e.count[0]?e.count[0]:e.count,e.count&&e.count.status&&e.count.manage||(_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.zianotification.config.update.permission.msg")}}),Lyte.Router.transitionTo({route:"crm.settings.index"}))},beforeExit:function(){setTimeout(function(){store.unloadAll("zia-data-enrichment-meta"),store.peekRecord("data_enrichment_count","1").$.set("modules",[]),this.unloadTempConfigs()}.bind(this),500)},redirect:function(e,t){"crm.settings.section.zia.data-enrichment"===this.transition.target&&(t.moduleId?this.replaceWith({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment",queryParams:{moduleId:t.moduleId}}):this.replaceWith({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment"}))},actions:{onError:function(e){return Lyte.registeredMixins["enrichment-utils"].handleError(e,"crm.settings.section.zia.data-enrichment.history-data-enrichment"===this.transition.target,!0),!1}}},{mixins:["enrichment-utils"]}),Lyte.Router.registerRoute("crm.settings.section.data-migration",{getDependencies:function(){if("crm.settings.migration"!==this.transition.target)return networkUtils.returnDependencyFiles(["data-migration-store.js","migration-util.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["data-migration-component-general.js","lyte-step.js","migration-util.js","migration-constants.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["data-migration-general.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)r=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],ResourceConstants.CRMClient);var s=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient),i=e.concat(t).concat(n).concat(r).concat(s);if(("true"===window.isCrmPlusUser||"true"===window.isZohoOneUser)&&void 0!==Crm.userDetails.PROFILE_POPUP&&!0===Crm.userDetails.isFromFeatureMenuCrmplusorZohoOne){var o=networkUtils.returnDependencyFiles(["crm-getting-start.js","lyte-draggable.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-getting-start.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("onboardingpageSetupPageText")],ResourceConstants.CRM);i=i.concat(o).concat(a).concat(l)}return i},beforeExit:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["lyte-step.css"],ResourceConstants.CRMClient)),$L("#setup_new_ContentDiv").removeClass("helpOverflowHide")},model:function(){if(this.transition.data&&"error"===this.transition.data.step)return store.findAll("migration");var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return e?store.findRecord("migration",e):"crm.settings.migration.api-login"!==this.transition.target?store.findAll("migration"):void 0},actions:{onError:function(e,t,r,s){if("model"===s&&e&&e.responseText){var n=JSON.parse(e.responseText);if(n.code&&"NO_PERMISSION"===n.code)return renderingUtils.displayPermissionDenied(),!1}}},redirect:function(e){this.transition.data&&this.transition.data.step&&"abort"===this.transition.data.step?Lyte.Router.getRouteInstance().refresh():"crm.settings.section.data-migration"!==this.transition.target&&($L.isEmptyObject(this.transition.data)&&"crm.settings.migration.api-login"===this.transition.target?Lyte.Router.replaceWith({route:"crm.settings.section.data-migration"}).data={step:"error"}:$L.isEmptyObject(this.transition.data)&&this.redirectMigrationBasedOnCurrentStatus(e,this))},renderTemplate:function(){return{outlet:"#result",component:"crm-dm-select-crm"}},afterRender:function(){$L("#setup_new_ContentDiv").addClass("helpOverflowHide"),this.transition.data&&"error"===this.transition.data.step&&"new"!==this.transition.data.stage?this.showMessageInSelectCRM(I18n.getMsg("crm.migration.id.notFound"),"error"):this.transition.data&&"unknown"===this.transition.data.step&&this.showMessageInSelectCRM(I18n.getMsg("unknown.problem"),"error"),$L("crm-profile-menu")[0].component.actions.showRightPanelorCrmplusWidget()},didDestroy:function(){$L("crm-getting-start")[0]&&$L("crm-getting-start")[0].component.actions.widgetReRender()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.clone-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("userlist")],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SharingRules")],ResourceConstants.CRM)),Crm.userDetails.isDataSharingLyteEnabled&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["sharing-rules-list.js","crm-data-sharing-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["datasharing-models.js"],ResourceConstants.CRMClient))),e},queryParams:["module"],getDependencies:function(){return[]},beforeModel:function(){Crm.userDetails.isDataSharingLyteEnabled&&Crm.userDetails.permissions.Crm_Implied_Manage_Data_Sharing&&featuresAvailable.Data_Sharing_Rules||(crmHistory.handleAjaxErrorLyte=!0,_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("gs.security.error")}}),this.transition.abort())},model:function(){var e=this.getDynamicParam(),t=Lyte.Component.registeredHelpers.getAPINameByTabName(this.getQueryParams().module),r=Lyte.Router.getRouteInstance().transition.data.filterState,s={};return s.roles=store.findAll("role",{reload:!0},!1),s.groups=store.findAll("user_group",{reload:!0},!1),s.fields=store.findAll("field",{module:t,type:"all"},!0,!0,{apiVersion:"2.2"}),s.currentRule=store.findRecord("sharing_rules",e,{module:t}),{response:Lyte.resolvePromises(s),mode:"clone",ruleId:e,filterState:r,module:t}},renderTemplate:function(e){if(Crm.userDetails.isDataSharingLyteEnabled)return Object.keys(e.response.currentRule).length?{outlet:"#result",component:"crm-sharing-rules-layout"}:{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; "><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:var(--redLightColor); font-size: 26px;" class="mL15">'+I18n.getMsg("com.datasharingrules.error.unavailable")+'</h2><div class="mT5 crm-base-font-size mL15 lh20"></div></div></div>'}},actions:{onError:function(e,t){var r=JSON.parse(e.responseText);r.message&&"the module name given seems to be invalid"===r.message?(_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("crm.sharing.rules.module.unavailable")}}),this.transition.abort()):t.resume()}}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.create-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("userlist")],ResourceConstants.CRM);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SharingRules")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["sharing-rules-list.js","lyte-hovercard.js","features_model.js"],ResourceConstants.CRMClient)),Crm.userDetails.isDataSharingLyteEnabled&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["datasharing-resources.js","crm-data-sharing-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["datasharing-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},getDependencies:function(){return[]},beforeModel:function(){!Crm.userDetails.isDataSharingLyteEnabled||Crm.userDetails.permissions.Crm_Implied_Manage_Data_Sharing&&featuresAvailable.Data_Sharing_Rules||(crmHistory.handleAjaxErrorLyte=!0,_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("gs.security.error")}}),this.transition.abort())},queryParams:["module"],model:function(e){var t=this.getQueryParams().module;if(Crm.userDetails.isDataSharingLyteEnabled){var r=Lyte.Component.registeredHelpers.getAPINameByTabName(t);t&&!r&&(_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("crm.sharing.rules.module.unavailable")}}),this.transition.abort());var s=Lyte.Router.getRouteInstance().transition.data.filterState,n={};return n.roles=store.findAll("role",{reload:!0},!1),n.groups=store.findAll("user_group",{reload:!0},!1),n.modules=store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/data_sharing/rules/actions/summary",method:"GET"}),{response:Lyte.resolvePromises(n),mode:"create",filterState:s,module:r}}return options={params:{action:"newRule",module:t}},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",options)},renderTemplate:function(e,t){return Crm.userDetails.isDataSharingLyteEnabled?{outlet:"#result",component:"crm-sharing-rules-layout"}:{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]));var r=document.getElementById("sharingRuleName");r&&r.focus(),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),200)},afterModel:function(e){"scheduler running"===e.error&&(crmui.showPopup("scheduler_Sharing_Rule"),commonUtils.showHideLoadingDiv(),this.transition.abort()),"module unavailable"===e.error&&(crmui.showPopup("module_Sharing_Rule"),commonUtils.showHideLoadingDiv(),this.transition.abort())}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.index-data-sharing.data-sharing-rule",{renderTemplate:function(){if(Crm.userDetails.isDataSharingLyteEnabled)return{outlet:"#sub_dataSharing_RuleSetting",component:"crm-sharing-rules-list"}},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Data_Sharing&&featuresAvailable.Data_Sharing_Rules||(crmHistory.handleAjaxErrorLyte=!0,_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("gs.security.error")}}),this.transition.abort())},model:function(){var e=[],t=[],r={},s="all_modules";Lyte.Router.getRouteInstance().transition.data.filterState&&(r=Lyte.Router.getRouteInstance().transition.data.filterState,t=Lyte.Router.getRouteInstance().transition.data.filterState.filterCriteria||[],s=Lyte.Router.getRouteInstance().transition.data.filterState.filterModule||"all_modules");var n={},i={};e=[];s&&"all_modules"!==s&&(i.module=n.module=s),e.push(store.findAll("role")),e.push(store.findAll("user_group"));var o=Array.isArray(t)&&t.length>0;if(o){var a=[{group_operator:"and",group:[]}];t.forEach((function(e){a[0].group.push(e)})),i.filters=a,e.push(store.triggerAction("sharing_rules","filter",i,n)),e.push(store.triggerAction("sharing_rules","summary",i,n))}else e.push(store.findAll("sharing_rules",i)),e.push(store.triggerAction("sharing_rules","summary",void 0,n));return(void 0!==s&&"all_modules"!==s||!0===o)&&e.push(store.triggerAction("sharing_rules","summary",void 0,void 0)),0===store.peekAll("organization_permissions").length&&e.push(store.findAll("organization_permissions")),e.push(store.findAll("user")),{data:Lyte.resolvePromises(e),filterState:r,filterModule:s,hasValidFilterCriteria:o}},afterRender:function(){var e=$L("crm-sharing-rules-list")[0].component,t=e.getData("filterState"),r=!1;if(Object.keys(t).length>0&&(t.searchName&&t.filterCriteria.length>1||!t.searchName&&t.filterCriteria.length>0)&&(r=!0),t&&r){var s=$L("#sr_filter");e.openFilterForRules(s)}t.searchName&&1===t.filterCriteria.length&&e.setData({invokeSearch:!1,searchName:t.searchName})},afterModel:function(e){if(void 0!==e.data[2]){var t=[];e.hasValidFilterCriteria?(t=e.data[2].sharing_rules)&&t.length>0&&(e.isMoreRulesAvailable=e.data[2].meta.more_records):(t=e.data[2])&&t.length>0&&(e.isMoreRulesAvailable=e.data[2].$.meta.more_records),e.originalSharingRulesList=t,e.currentIndex=0,e.batchSize=50;var r=this.processRulesResponse(t.slice(e.currentIndex,e.currentIndex+e.batchSize));e.currentIndex+=e.batchSize;var s=[],n=[],i={moduleVal:"all_modules",moduleName:I18n.getMsg("gs.allmodules"),displayValue:I18n.getMsg("gs.allmodules"),info:I18n.getMsg("crm.security.sr.allmodulesview.message")};Lyte.arrayUtils(n,"push",i),void 0!==e.data[3].sharing_rules_summary&&e.data[3].sharing_rules_summary.forEach((function(t){var i={},o=Lyte.Component.registeredHelpers.getSharingDisplayModule(t.module.api_name);void 0!==o&&(Lyte.objectUtils(i,"add",{moduleVal:t.module.api_name,moduleName:o,ruleCount:t.rule_count,displayValue:o+" ("+t.rule_count+")"}),Lyte.objectUtils(t.module,"add","moduleName",o),(t.module.api_name in r||e.filterModule&&"all_modules"!==e.filterModule&&!e.hasValidFilterCriteria)&&s.push(t),Lyte.arrayUtils(n,"push",i))})),e.filterModule&&"all_modules"!==e.filterModule||e.hasValidFilterCriteria?e.modules=this.processModuleSummary(e.data[4].sharing_rules_summary):e.modules=n,e.isRulesLoading=!1,e.sharingRulesList=r,e.sharingRulesSummary=e.data[3].sharing_rules_summary,e.visibleModules=s,t&&void 0!==t.length&&0===t.length&&"all_modules"===e.filterModule&&!e.hasValidFilterCriteria&&(e.showGetStarted=!0),0===store.peekAll("organization_permissions").length&&(e.disableCreateButton=!0,e.showGetStarted=!1)}},beforeExit:function(){var e=$L("crm-sharing-rules-list");e&&e.length>0&&e[0].remove(),_cruxUtils.removeCustomAlert()}},{mixins:["crm-data-sharing-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.index-data-sharing.default-org-permissions",{renderTemplate:function(){if(Crm.userDetails.isDataSharingLyteEnabled)return{outlet:"#sub_usersPermi_SharingSetting",component:"crm-default-organization-permissions"}},model:function(){var e={};return e.organization_permissions=store.findAll("organization_permissions"),Lyte.resolvePromises(e)}},{mixins:["crm-data-sharing-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.edit-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("userlist")],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SharingRules")],ResourceConstants.CRM)),Crm.userDetails.isDataSharingLyteEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["sharing-rules-list.js","crm-data-sharing-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["datasharing-models.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["datasharing-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(){!Crm.userDetails.isDataSharingLyteEnabled||Crm.userDetails.permissions.Crm_Implied_Manage_Data_Sharing&&featuresAvailable.Data_Sharing_Rules||(crmHistory.handleAjaxErrorLyte=!0,_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("gs.security.error")}}),this.transition.abort())},queryParams:["module"],getDependencies:function(){return[]},model:function(e){var t=this.getDynamicParam(),r=this.getQueryParams().module;if(Crm.userDetails.isDataSharingLyteEnabled){var s=Lyte.Router.getRouteInstance().transition.data.filterState,n={};return r=Lyte.Component.registeredHelpers.getAPINameByTabName(r),n.roles=store.findAll("role",{reload:!0},!1),n.groups=store.findAll("user_group",{reload:!0},!1),n.fields=store.findAll("field",{module:r,type:"all"},!0,!0,{apiVersion:"2.2"}),n.currentRule=store.findRecord("sharing_rules",t,{module:r}),{response:Lyte.resolvePromises(n),mode:"edit",ruleId:t,filterState:s,module:r}}var i={params:{action:"editRule",ruleId:t,module:r}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",i)},renderTemplate:function(e,t){return Crm.userDetails.isDataSharingLyteEnabled?Object.keys(e.response.currentRule).length?{outlet:"#result",component:"crm-sharing-rules-layout"}:{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; "><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:var(--redLightColor); font-size: 26px;" class="mL15">'+I18n.getMsg("com.datasharingrules.error.unavailable")+'</h2><div class="mT5 crm-base-font-size mL15 lh20"></div></div></div>'}:{outlet:"#result",html:e}},afterRender:function(e,t){var r=$L("crm-sharing-rules-layout")[0].component;this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]));var s=document.getElementById("sharingRuleName");s&&s.focus(),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),200),r.executeMethod("showSkippedErrorMessage")},afterModel:function(e){e.error&&("scheduler running"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.execution.progress",moduleRecordMapping[this.getQueryParams().module].singular_label)),this.transition.abort()),"module unavailable"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.unavailable")),commonUtils.showHideLoadingDiv(),this.transition.abort()))},actions:{onError:function(e,t){var r=JSON.parse(e.responseText);Crm.userDetails.isDataSharingLyteEnabled&&r.message&&"the module name given seems to be invalid"===r.message?(_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("crm.sharing.rules.module.unavailable")}}),this.transition.abort()):t.resume()}}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.edit-default-data-sharing",{model:function(e){if(!Crm.userDetails.isDataSharingLyteEnabled){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",{params:{action:"editAllDefPer"}})}Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.index-data-sharing.default-org-permissions")},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.index-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlist.css"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-userlist.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("userlist")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["sharing-rules-list.js","lyte-hovercard.js","crux-combo-box.js","crux-schedular-notification.js","crux-combo-box-view.js"],ResourceConstants.CRMClient)),e=Crm.userDetails.isDataSharingLyteEnabled?(e=e.concat([{parent:networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SharingRules")],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["datasharing-resources.js","crm-data-sharing-mixin.js"],ResourceConstants.CRMClient)}])).concat(networkUtils.returnDependencyFiles(["datasharing-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)):e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SharingRules")],ResourceConstants.CRM))},beforeModel:function(){Crm.userDetails.isDataSharingLyteEnabled&&!Crm.userDetails.permissions.Crm_Implied_Manage_Data_Sharing&&(crmHistory.handleAjaxErrorLyte=!0,_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("gs.no.permission"),cxPropReason:I18n.getMsg("gs.security.error")}}),this.transition.abort())},getDependencies:function(){var e=[];return Crm.userDetails.isDataSharingLyteEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["datasharing-models.js"],ResourceConstants.CRMClient))),e},model:function(e){if(Crm.userDetails.isDataSharingLyteEnabled){return Lyte.resolvePromises({})}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",{params:{action:"showAllRules"}})},renderTemplate:function(e,t){return Crm.userDetails.isDataSharingLyteEnabled?("crm.settings.section.data-sharing.index-data-sharing.data-sharing-rule"===Lyte.Router.getRouteInstance().transition.target?this.currentModel.activeTab=1:this.currentModel.activeTab=0,{outlet:"#result",component:"crm-datasharing-settings"}):{outlet:"#result",html:e}},afterModel:function(){if(Crm.userDetails.isDataSharingLyteEnabled){var e=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(e)}},afterRender:function(e,t){$L("#result").addClass("h100_per"),Crm.userDetails.isDataSharingLyteEnabled||this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]))},beforeExit:function(){$L("#result").removeClass("h100_per")},actions:{didTransition:function(){if(Crm.userDetails.isDataSharingLyteEnabled){var e=$L("#sr_tabs")[0];"crm.settings.section.data-sharing.index-data-sharing.default-org-permissions"===this.transition.target&&(this.currentModel.activeTab=0,e.openTab("sub_usersPermi_SharingSetting")),"crm.settings.section.data-sharing.index-data-sharing.data-sharing-rule"===this.transition.target&&(this.currentModel.activeTab=1,e.openTab("sub_dataSharing_RuleSetting"))}}},redirect:function(){Crm.userDetails.isDataSharingLyteEnabled&&"crm.settings.section.data-sharing.index-data-sharing"===this.transition.target&&this.replaceWith("crm.settings.section.data-sharing.index-data-sharing.default-org-permissions")}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing",{redirect:function(){"crm.settings.section.data-sharing"===this.transition.target&&this.replaceWith("crm.settings.section.data-sharing.index-data-sharing")},beforeExit:function(){store.unloadAll("sharing_rules")}}),Lyte.Router.registerRoute("crm.settings.section.domain-mapping",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-domainmapping.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-domainmapping.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-domainmapping-datastore.js","portal-model.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CustomDomain")],ResourceConstants.CRM))},beforeModel:function(){Crm.isDomainMappingAllowed&&"true"!==window.isSandboxAcc||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort())},model:function(){var e={};return e.cd=store.findAll("domain_mapping"),Crm.userDetails.CLIENT_PORTAL_PROFILES&&Crm.userDetails.CLIENT_PORTAL_PROFILES.length>0&&(e.portal=store.findAll("portal",void 0,void 0,void 0,{includeName:!0})),Lyte.resolvePromises(e)},afterModel:function(e){this.currentModel={cachedata:e}},renderTemplate:function(){return{outlet:"#result",component:"crm-domain-mapping-view"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.system.domainmapping"),Crm.partnerName]))},actions:{onError:function(){setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort()}}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.edit-email-parser",{model:function(e){var t={action:"editParser",ruleId:this.getDynamicParam()};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:t})},renderTemplate:function(e){e&&e.new_parser_enabled?(Lyte.Router.transitionTo("crm.settings.section.email-parser.index-email-parser"),e.ruleId&&(mailparser.ruleId=e.ruleId,mailparser.redirectToDetailView=!0)):(mailparser.createParserRule({source:e.mail_parser[0].source},"fromEdit"),mailparser.basicView(),mailparser.viewParserDetails(e.mail_parser[0]))}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.custom-email-fields-preference",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-custom-email-preference-model.js"],ResourceConstants.CRMClient)},beforeModel:function(){if(Crm.userDetails.isSandbox||!Crm.userDetails.IS_ADMIN)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1},model:function(){return store.findAll("custom_email_preference")},afterModel:function(e){this.currentModel.customEmailPreference=e.usage_enabled},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-email-preference.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customEmailPreference")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-custom-email-preference.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeExit:function(){store.unloadAll("custom_email_preference")},renderTemplate:function(){return{outlet:"#result",component:"crm-custom-email-preference"}}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability.email-auth",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-auth.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailAuthentication"),networkUtils.getI18nJSUrl("emailsharing"),networkUtils.getI18nJSUrl("emaildeliverability")],ResourceConstants.CRM);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["email-auth-domains-table.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-email-auth.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["email-auth.css"],ResourceConstants.CRMClient))},model:function(){return Lyte.resolvePromises({domain_auth_det:store.findAll("dummy",void 0,!1,!1,{url:"/crm/email/v2/settings/emails/authentication/actions/domain_auth_status"}),emailauth:store.findAll("email_auth_record"),suggested_domains:store.findAll("email_auth_record",void 0,!1,!1,{action:"suggested_domains"}),user:store.findAll("user",{ids:Crm.userDetails.USER_ID})})},afterModel(e){if(Crm.userDetails.IS_ADMIN){var t=e.emailauth.pop();this.currentModel.limit=t.limit,this.currentModel.auth_records=e.emailauth,this.currentModel.suggested_domains=e.suggested_domains,this.currentModel.isAdmin=e.user[0].profile.name===crmConstants.adminProfileName,this.currentModel.domain_auth_det=e.domain_auth_det}},beforeExit:function(){Lyte.Router.getRouteInstance()&&"email-auth"!==Lyte.Router.getRouteInstance().routeName&&store.unloadAll("email_auth_record");try{$zoho=void 0===$zoho?window.$zoho:$zoho;var e=$zoho.salesiq&&$zoho.salesiq.visitor?$zoho.salesiq.visitor.info():{};e.featureName&&"EmailAuthentication"===e.featureName&&(e.featureName="");var t=$L("crm-email-subtab");t.length>0&&t[0].component.setData("displayEmailAuthHelp",!1)}catch(e){return}},renderTemplate:function(){return this.currentModel.isAdmin?{outlet:"#result",component:"crm-email-auth"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-compose-settings",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-compose-settings.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.getI18nJSUrl("emailcompose"),t=networkUtils.getI18nJSUrl("emaileditor");t=networkUtils.getI18nJSUrl("composesetting");var r,s=networkUtils.returnDependencyFiles(["inlineEmailCompose_min.js","zohocrm_mailClient.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-email-subjectpop.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["lyte-draggable.js"],ResourceConstants.CRMClient)),n=networkUtils.returnDependencyFiles(["inline_ComposeEditor_min.css"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-email-subjectpop.css"],ResourceConstants.CRMClient));r=featuresAvailable.WRITING_ASSISTANT?[e,t,networkUtils.getI18nJSUrl("WritingAssistant")]:[e,t],Lyte.injectResources(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM),void 0,void 0);var i=s.concat(n);return Lyte.injectResources(i,void 0,void 0),Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["email-compose-settings.css","email-compose-settings-rtl.css"],ResourceConstants.CRMClient).concat(i):networkUtils.returnDependencyFiles(["email-compose-settings.css"],ResourceConstants.CRMClient).concat(i)},beforeModel:function(){store.unloadAll("compose"),store.unloadAll("email_signatures")},model:function(){return Lyte.resolvePromises({from_addresses:store.triggerAction("emails","from_addresses",{},null,"GET"),meta:store.findAll("configuration_options"),usersetting:store.findAll("compose")}).then((function(e){for(var t=!1,r=[],s=[],n=[],i=[],o=[],a=Lyte.deepCopyObject(e.from_addresses.from_addresses),l=a.length,c=[],u=0;u<l;u++){for(var d=!1,m=a[u],p=store.peekAll("email_signatures"),g=p.length,f=0;f<g;f++)for(var h=p[f].from,y=h.length,C=0;C<y;C++)h[C].email!==m.email||h[C].user_name===m.user_name||c.contains(m.email)||!h[C].user_name&&!m.user_name||(a.deleteElementAt(u),l--,u--,d=!0,m.user_name?p[f].fromAddArray.push(m.user_name+"<"+h[C].email+">"):p[f].fromAddArray.push(h[C].email));"org_email"===m.type?m.user_name?s.push(m.user_name+"<"+m.email+">"):s.push(m.email):m.user_name?i.push(m.user_name+"<"+m.email+">"):i.push(m.email),!(d=!!c.contains(m.email))&&m.user_name?(r.push(m.user_name+"<"+m.email+">"),c.push(m.email)):d||(r.push(m.email),c.push(m.email)),d||o.push(m.email),n.includes(m.email)||(n.push(m.email),"primary"===m.type&&(t=!0))}t||(r.push(e.meta.primary_from_address.user_name+"<"+e.meta.primary_from_address.email+">"),o.push(e.meta.primary_from_address.email)),e.from_addresses.from=[],e.from_addresses.from.push({"":i}),0!==s.length&&e.from_addresses.from.push({orgemail:s});var v=r.length;for(f=0;f<v;f++)for(u=f+1;u<v;u++)if(r&&r[f]&&r[u]){var _=r[u],R=r[f],w=_.indexOf("<"),b=_.indexOf(">");-1!==w&&-1!==b&&w<b&&(_=_.slice(w+1,b)),w=R.indexOf("<"),b=R.indexOf(">"),-1!==w&&-1!==b&&w<b&&(R=R.slice(w+1,b)),R===_&&(r.deleteElementAt(u),u--,v--)}return store.peekAll("configuration_options")[0].fromAddrArray=r,store.peekAll("configuration_options")[0].fromWithoutName=o,e}),(function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),null}))},renderTemplate:function(e){if(null!==e)return{outlet:"#result",component:"crm-email-compose-settings"}},redirect:function(){this.transition.data.refresh&&(delete this.transition.data.refresh,this.refresh({refreshTemplate:!0}).data=this.transition.data)}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability.email-credibility",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-credibility-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailCredibility")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["email-credibility-component.js"],ResourceConstants.CRMClient)),t=networkUtils.returnDependencyFiles(["email-credibility.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))},model:function(){return Lyte.resolvePromises({credit_score:store.triggerAction("credibility","credit_score",{},null,"GET"),credibility_report:store.triggerAction("credibility","credibility_report",{},{duration:"last_1_month"},"GET"),bounced_report:store.triggerAction("credibility","bounced_report",{},{mail_source:"all",user_id:"all",duration:"last_1_month"},"GET"),metrics:store.triggerAction("credibility","metrics",{},null,"GET"),email_analytics_field:store.findAll("field",{module:"Email_Analytics",type:"all",service:"Reports"},!0,!0,{apiVersion:"2.2"})}).then((function(e){return e}),(function(e){return e}))},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#result",component:"crm-email-credibility"}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence.email-insights",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-insights.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailInsights")],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["email-insights.css"],ResourceConstants.CRMClient))},model:function(){return Lyte.resolvePromises({emailInsights:store.findAll("email_insights_record"),user:store.findAll("user",{ids:Crm.userDetails.USER_ID})})},afterModel:function(e){var t=e.emailInsights.email_insights;this.currentModel.emailWorkFlow=-1!=="P,E,A,U,C,Z".indexOf(Crm.userDetails.LICENSE_TYPE),this.currentModel.isAdmin=Crm.userDetails.IS_ADMIN_ROLE||Crm.userDetails.PROFILE_NAME===crmConstants.adminProfileName,this.currentModel.isStandard="S"===Crm.userDetails.LICENSE_TYPE,this.currentModel.trackable=t.active,this.currentModel.modification=t.active?I18n.getMsg("crm.label.enabled"):I18n.getMsg("Disabled"),this.currentModel.modifiedby=t.modified_by.name;var r=this.getFormattedDate(t.modified_time);this.currentModel.modifiedon=r,this.currentModel.isAdmin=e.user[0].profile.name===crmConstants.adminProfileName},beforeExit:function(){store.unloadAll("email_insights_record")},renderTemplate:function(){return this.currentModel.isAdmin?{outlet:"#result",component:"crm-email-insights"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}},{mixins:["email-insights-util"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-preference",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-footer-model.js"],ResourceConstants.CRMClient)},beforeModel:function(){return Crm.userDetails.isSandbox?(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):Crm.userDetails.IS_ADMIN?void 0:(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailFooter")],ResourceConstants.CRM);return(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EditorFrameWork")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailInventoryTemplates")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["email-footer.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["email-footer.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["zohocrm_htmleditor1.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_template.js","zohocrm_templatenew.js"],ResourceConstants.CRM))},model:function(){return Lyte.resolvePromises({data:store.findAll("email_footers")})},afterModel:function(e){e.data.length>0&&(this.currentModel.footerDetails=e.data[0])},renderTemplate:function(){return{outlet:"#result",component:"crm-email-footer"}},beforeExit:function(){store.unloadAll("email_footers"),template.editorType="",template.sub_mergeDetails={},template.mergefields={},template.isPrivacyEnabled=!1,parent.zee.initobj.isEmailFooterEditor=!1,template.hasOwnProperty("abortFooterTransition")&&(delete template.abortFooterTransition,delete template.footerRouteCount),this.component.component.oldEditorObj&&(editor=this.component.component.oldEditorObj),$("#setup_new_ContentDiv").removeProperty("overflow-y")},afterRender:function(){template.footerRouteIndex=Lyte.Router.history.index,template.footerRouteCount=0,$("#result").addClass("crmEmailConfigDiv oH")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv oH")},actions:{onError:function(e){var t=JSON.parse(e.response);"NO_PERMISSION"!==t.code&&"FEATURE_NOT_ENABLED"!==t.code||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort())},willTransition:function(e){var t=e.pause();if(this.hasOwnProperty("component")&&template.hasOwnProperty("abortFooterTransition"))delete template.abortFooterTransition,template.footerRouteCount=0,t.abort();else if(this.hasOwnProperty("component")&&this.component.component.data.editFooter&&!this.component.component.data.buttonFreeze){var r={type:"confirm"};r.header=I18n.getMsg("crm.admin.email.sharing.preference.back1"),r.message=I18n.getMsg("crm.admin.email.sharing.preference.back"),r.accept_methodName="closeAlertAndRestoreRoute",r.reject_methodName="leaveFooterPage",r.ltProp=[{text:I18n.getMsg("crm.admin.email.sharing.preference.back3"),type:"reject",appearance:"failure"},{text:I18n.getMsg("crm.admin.email.sharing.preference.back2"),appearance:"default",type:"accept"}],template.footerRouteIndex>Lyte.Router.history.index&&template.footerRouteCount++,"crm.settings.section.email-configuration.email-settings"===e.target?Lyte.Component.set(this.component.component.data,{showAlertModal:!0,targetRoute:"crm.settings.section.email-configuration.email-settings.email-index"}):Lyte.Component.set(this.component.component.data,{showAlertModal:!0,targetRoute:e.target,dynamicParam:e.info.dynamicParams,queryParam:e.info.queryParams}),template.footerRouteCount<=1&&Lyte.Component.set(this.component.component.data,"alertData",r),t.abort()}else t.resume(),CrmEmailInitialize.PopulateComposeMailData(),zee.showFavFont=!0,this.component.component.oldEditorObj&&(editor=this.component.component.oldEditorObj)}}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability.email-relay",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["email-relay.js","crux-parent-form-component.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailrelay")],ResourceConstants.CRM).concat(e)},getResources:function(){return Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["email-relay-rtl.css","email-relay.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["email-relay.css"],ResourceConstants.CRMClient)},model:function(){return Lyte.resolvePromises({config:store.findAll("relay-config"),records:store.findAll("relay-record")}).then((function(e){return e}),(function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),null}))},renderTemplate:function(e){if(null!==e)return{outlet:"#result",component:"crm-email-relay"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-create",{beforeModel:function(){void 0!==store.peekAll("email_configuration")&&store.unloadAll("email_configuration"),void 0!==store.peekAll("server_details")&&store.unloadAll("server_details"),void 0!==store.peekAll("folder_detail")&&store.unloadAll("folder_detail")},model:function(){var e=store.createRecord("email_configuration",{user_id:Crm.userDetails.USER_ID});return e.incoming_mail_server=store.createRecord("server_details",{type:"incoming"}),e.outgoing_mail_server=store.createRecord("server_details",{type:"outgoing"}),e},afterModel:function(e){this.currentModel.config=e},renderTemplate:function(){return{outlet:"#result",component:"crm-email-create"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-edit",{model:function(){return store.findAll("email-configuration")},afterModel:function(e){if(e&&e.length){var t=e[0];this.currentModel=t}else this.currentModel=null},renderTemplate:function(){return{outlet:"#result",component:"email-create"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["mailconfig-min.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-email-config-gmail-api.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:async function(){commonUtils.showHideLoadingDiv(!0);const e=Lyte.Router.getRouteInstance().transition.info.isFrom;if(!e){const e=await store.findAll("email_configuration");if(e&&e.length>0)return{email_config:e};return{email_config:await store.findAll("gmail_configuration")}}if("gmail_api:new-flow"===e){return{email_config:await store.findAll("gmail_configuration")}}return"cancelCreate"===e?null:"cancelEdit"===e?Lyte.resolvePromises({email_config:store.findAll("email_configuration")}):void("gmailAPI"===e&&Lyte.Router.replaceWith("crm.settings.section.email-configuration.email-settings",{action:"mailSelect"}))},afterModel:function(e){if(e&&e.email_config.length>0&&e.email_config[0].configuration_type)switch(e.email_config[0].configuration_type){case"gmail_api":this.currentModel.email_config=e.email_config[0];break;case"imap":case"pop":this.currentModel=e.email_config[0];break;default:this.currentModel=null}else this.currentModel=null;return this.currentModel},renderTemplate:function(e){var t;commonUtils.showHideLoadingDiv(!1);var r=Lyte.Router.getRouteInstance().transition.isFrom;if(e){if(e.email_config&&"gmail_api"===e.email_config.configuration_type)return{outlet:"#result",component:"crm-email-gmail-api"};t={outlet:"#result",component:"crm-email-info"}}else t="cancelCreate"===r?{outlet:"#result",component:"crm-email-setup"}:{outlet:"#result",component:"crm-email-index"};return t},afterRender:function(){"oauth"===Lyte.Router.getRouteInstance().transition.isFrom&&crmTab.isMailClientEnabled&&document.getElementsByTagName("crm-email-info")[0].setData("showImportFilter",!0),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_EMAIL_CONFIGURATION").PF_ACCESSED_EMAIL_CONFIGURATION,RebrandLinkUtil.getProperties("PF_ACCESSED_EMAIL_CONFIGURATION_ID").PF_ACCESSED_EMAIL_CONFIGURATION_ID)},actions:{onError:function(e){$L("#inner_result,#setupInnerLinks").html("");var t={val:I18n.getMsg("crm.button.label.back.to.home")},r={val:I18n.getMsg("crm.label.backToModule",["Settings"]),fn:function(){Lyte.Router.replaceWith("crm.settings")}};401===e.status?renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.security.error"),r,t):renderingUtils.showCustomAlert(I18n.getMsg("zb.common.error.PageTitle"))},willTransition:function(e){var t=store.peekRecord("email_configuration",Crm.userDetails.USER_ID),r=store.peekRecord("server_details","incoming"),s=store.peekRecord("server_details","outgoing"),n={val:I18n.getMsg("crm.button.cancel")},i={val:I18n.getMsg("crm.label.proceed"),fn:function(){store.peekRecord("email_configuration",Crm.userDetails.USER_ID).$.rollBack(),store.peekRecord("server_details","incoming").$.rollBack(),store.peekRecord("server_details","outgoing").$.rollBack(),Lyte.Router.getRouteInstance().transitionTo(e.target)}};t&&r&&s&&(t.$.getDirtyAttributes().length>0||r.$.getDirtyAttributes().length>0||s.$.getDirtyAttributes().length>0)&&(e.abort(),renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.email.settings.unsave.title")+" "+I18n.getMsg("crm.email.settings.unsave.msg"),i,n))}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings",{queryParams:["action","service","frmmode","isFromSI"],getResources:function(){var e=(e=networkUtils.returnDependencyFiles(["emailconfiguration.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["zohocrm_mailClient.js"],ResourceConstants.CRM)),t=networkUtils.returnDependencyFiles(["emailconfiguration.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailconfiguration")],ResourceConstants.CRM);const s=e.concat(r).concat(t);if(!Crm.userDetails.RTL_ENABLED)return s;var n=networkUtils.returnDependencyFiles(["emailconfiguration-rtl.css"],ResourceConstants.CRMClient);return s.concat(n)},beforeModel:function(e){"crm.settings.section.email-configuration.email-settings.email-create"===this.transition.target&&this.replaceWith("crm.settings.section.email-configuration.email-settings.email-index"),"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target||["mailSelect","imap","zmail"].contains(this.getQueryParams().action)||this.transition.abort()},model:function(e){if(this.transition.target){var t="GET",r=this.getQueryParams().action,s=this.getQueryParams().frmmode,n=this.getQueryParams().isFromSI,i=Crm.getCrmBasePath()+"/specific/IMAPAction.do",o="showIndex";"imap"===r?o="showConfig":"zmail"===r&&(i=Crm.getCrmBasePath()+"/ZMailConfig.do",o="checkConfiguration");var a={params:{action:o}};s&&"oauth"!==s&&(a.params.frmmode=s),n&&(crmTab.redirectToSalesInbox=n),"LicenseUsersUpdate"===this.transition.data.actionType&&(i=Crm.getCrmBasePath()+"/License.do",a={params:{}},t="POST");var l=objectUtils.cloneObject(this.transition.data);return delete l.permission,delete l.checkPermission,Object.assign(a.params,l),networkUtils.lyteInitiateRequest(i,t,a)}return{}},afterModel:function(e){var t;try{t="object"!=typeof e?JSON.parse(e):e}catch(t){return"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target&&Lyte.Router.replaceWith("crm.settings.section.email-configuration.email-settings",{action:"mailSelect"}),e}if("object"==typeof t&&("crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||t.gmailSetup))if(!0===t.gmailSetup){Lyte.Router.getRouteInstance().transition.info.isFrom="gmailAPI";var r=this.transition.pause();Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_gmailSetup.js","gmailAPI-min.js"],ResourceConstants.CRM),void 0,(function(){r.resume()}))}else"true"!==t.mailappsflow&&"gmail_api"!==t.configuration_type||this.replaceWith("crm.settings.section.email-configuration.email-settings.email-index");return t},renderTemplate:function(e,t){var r;if("gmail_api"===e.configuration_type&&(Lyte.Router.getRouteInstance().transition.info.isFrom="gmail_api:new-flow"),"crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||e.gmailSetup){if(!crmSetup.isChildShowByFeature("crm.settings.section.email-configuration"))return $("#inner_result,#setupInnerLinks").html(""),void renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"));"object"==typeof e&&e.gmailSetup&&(e=Handlebars.templates.gmailSetup(e)),r={outlet:"#result",html:e}}return r},afterRender:function(e,t){("crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||"object"==typeof e&&e.gmailSetup)&&"object"==typeof e&&e.gmailSetup&&GmailAPI.onLoad(e),t.queryParams.frmmode&&"oauth"===t.queryParams.frmmode&&(Lyte.Router.getRouteInstance().transition.isFrom="oauth"),$("#result").addClass("crmEmailConfigDiv"),$L("crm-profile-menu")[0].component.actions.showOnboardingSetupPopupFromHomePage()},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}},{mixins:["crm-email-config-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-sharing.email-sharing-preference",{getDependencies:function(){return networkUtils.returnDependencyFiles(["admin-email-sharing-mixin.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-preference-model.js"],ResourceConstants.CRMClient))},getResources:function(){var e=networkUtils.returnDependencyFiles(["admin-email-sharing-components.js","crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-tree.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-preference.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["email-sharing-preference.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["email-sharing-components.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["email-sharing-preference-rtl.css"],ResourceConstants.CRMClient))),e},beforeModel:function(){if(Crm.userDetails.isSandbox)return renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1;return crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?["F","N","L"].contains(Crm.userDetails.LICENSE_TYPE)?(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):void 0:(this.transition.info.route="crm.settings.section.email-configuration.email-sharing",this.replaceWith(this.transition.info),!1)},model:function(){return Lyte.resolvePromises({roles:store.findAll("role")})},afterModel:function(e){var t=this.createRolesList(e.roles);this.currentModel.rolesList=t,this.currentModel.ceoRoleId=this.getCeoRoleId(e.roles),this.currentModel.isSuperAdmin=Crm.userDetails.IS_ADMIN_ROLE,this.currentModel.currentUserProfile=Crm.userDetails.PROFILE_NAME},renderTemplate:function(){return this.currentModel.isSuperAdmin||this.currentModel.currentUserProfile===crmConstants.adminProfileName?{outlet:"#result",component:"crm-admin-email-sharing-preference"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},beforeExit:function(){store.unloadAll("email_sharing_preference_action")},afterRender:function(){this.emailSharingHeight()},actions:{willTransition:function(e){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable){var t=e.pause();validationUtils.isEmpty(this.component.component.data.preferenceUpdateMap)?t.resume():("crm.settings.section.email-configuration.email-settings"===e.target?Lyte.Component.set(this.component.component.data,{isBack:!0,showAlertModal:!0,targetRoute:"crm.settings.section.email-configuration.email-settings.email-index"}):Lyte.Component.set(this.component.component.data,{isBack:!0,showAlertModal:!0,targetRoute:e.target}),t.abort())}}}},{mixins:["email-sharing-util"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-sharing",{queryParams:["page","per_page","config_type"],getDependencies:function(){return networkUtils.returnDependencyFiles(["admin-email-sharing-mixin.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-model.js"],ResourceConstants.CRMClient))},getResources:function(){var e=networkUtils.returnDependencyFiles(["admin-email-sharing-components.js","crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-tree.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["admin-email-sharing.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["email-sharing.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["email-sharing-components.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["email-sharing-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_adminemailsharing.js"],ResourceConstants.CRM))},beforeModel:function(){return["F","N","L"].contains(Crm.userDetails.LICENSE_TYPE)?(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):Crm.userDetails.isSandbox?(this.transition.info.route="crm.settings.section",this.replaceWith(this.transition.info),!1):void 0},model:function(){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable)return Lyte.resolvePromises({roles:store.findAll("role")});return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminEmailSharing.do","GET",{params:{action:"adminEmailSharing"}})},afterModel:function(e){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable){var t=this.createRolesList(e.roles);this.currentModel.ceoRoleId=this.getCeoRoleId(e.roles);var r=[{display_label:I18n.getMsg("crm.email.sharing.all.roles"),id:"no-filter"}].concat(t);this.currentModel.rolesList=r,this.currentModel.isSuperAdmin=Crm.userDetails.IS_ADMIN_ROLE,this.currentModel.currentAdminId=Crm.userDetails.USER_ID,this.currentModel.currentUserProfile=Crm.userDetails.PROFILE_NAME,this.currentModel.filterConfigType=this.transition.info.queryParams.config_type}},renderTemplate:function(e){return crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?this.currentModel.isSuperAdmin||this.currentModel.currentUserProfile===crmConstants.adminProfileName?{outlet:"#result",component:"crm-admin-email-sharing"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):AdminEmailSharing.constructAdminEmailSharingHeaders(e)},afterRender:function(e){$L("#noDataDiv").hide(),crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?this.emailSharingHeight():($("#result").addClass("crmEmailConfigDiv"),AdminEmailSharing.constructAdminEmailSharingTemplate(e))},beforeExit:function(){const e=crmSetup.setupObject["crm.settings.section.email-configuration"];e&&(e.sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable&&($("#result").removeClass("crmEmailConfigDiv"),store.unloadAll("email_sharing_action")))},actions:{didTransition:function(){this.transition.data.from_preference&&(objectUtils.removeKeyFromGivenObj(this.transition.data,"from_preference"),this.refresh({refreshTemplate:!0}).data=this.transition.data)}}},{mixins:["email-sharing-util"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.organization-emails",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-organization-email-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-organization-email-component.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-organization-email-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OrganizationEmails"),networkUtils.getI18nJSUrl("emaildeliverability"),networkUtils.getI18nJSUrl("EmailAuthentication")],ResourceConstants.CRM))},model:function(){return store.findAll("org_email").then((function(e){return{org_email:e,orgEmailLimit:e.$.meta}}),function(e){"NO_PERMISSION"===JSON.parse(e.response).code&&(renderingUtils.displayPermissionDenied(),this.transition.abort())}.bind(this))},renderTemplate:function(){return{outlet:"#result",component:"crm-org-email"}},afterRender:function(){$L("#setup_new_ContentDiv").css("height","")}}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence.sentiment-model",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.css"],ResourceConstants.CRM);return e.concat(t)},beforeModel:function(){Handlebars.registerPartial("ZiaConfigOverAllChkbox",Handlebars.templates.ZiaConfigOverAllChkbox),Handlebars.registerPartial("ZiaConfigChkbox",Handlebars.templates.ZiaConfigChkbox)},redirect:function(){"crm.settings.section.zia.sentiment-model"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-intelligence.sentiment-model",this.replaceWith(this.transition.info))},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailSentimentModelAction.do","GET",{params:{action:"sentimentModel"}})},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_sentimentmodel.js",networkUtils.getI18nJSUrl("sentimentmodel")],ResourceConstants.CRM)},renderTemplate:function(e,t){var r=e;return"object"==typeof e&&(r=Handlebars.templates.SentimentModelDataHeaders(r)),{outlet:"#result",html:r}},afterRender:function(e,t){"ZIA"===e.CHOOSEN_MODEL?($("#ziaExist").attr("checked",!0),sentimentModel.showInitialModel(2,e)):"ORG"===e.CHOOSEN_MODEL&&($("#ziaownnew").attr("checked",!0),sentimentModel.showInitialModel(1,e)),e.IS_MODEL_DEFINED||($(".sentimentDisableNotification").show(),$(".sentimentModel_header").parent().addClass("disableNotify")),thirdPartyUtils.bindSelect2(".ziaExistingIndustrmodel");var r=$("#result");setTimeout((function(){r.removeClass("pR"),$(".sentimentkrploading").hide()}),200),r.css({height:"100%"}),crmLayout.Resize.Setup(),$(".publisSettingsContainer").css({width:renderingUtils.windowWidth-260,opacity:""}),$(".emailsentimentalcontenteditablediv").css({"max-height":renderingUtils.windowHeight-260})},actions:{onError:function(e,t,r){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],ResourceConstants.CRMClient);if(e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],ResourceConstants.CRMClient)),("true"===window.isCrmPlusUser||"true"===window.isZohoOneUser)&&void 0!==Crm.userDetails.PROFILE_POPUP&&!0===Crm.userDetails.isFromFeatureMenuCrmplusorZohoOne){var t=networkUtils.returnDependencyFiles(["crm-getting-start.js","lyte-draggable.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-getting-start.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("onboardingpageSetupPageText")],ResourceConstants.CRM);e=e.concat(t).concat(r).concat(s)}return e},afterModel:function(){var e=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(e)},renderTemplate:function(){return{outlet:"#inner_result",component:"crm-email-subtab"}},afterRender:function(){$L("crm-profile-menu")[0].component.actions.showRightPanelorCrmplusWidget()},didDestroy:function(){$L("crm-getting-start")[0]&&$L("crm-getting-start")[0].component.actions.widgetReRender()},actions:{didTransition:function(){"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target||"crm.settings.section.email-configuration.email-settings.email-create"===this.transition.target?$L("crm-email-subtab")[0].setData("selected","crm.settings.section.email-configuration.email-settings"):$L("crm-email-subtab")[0].setData("selected",this.transition.target)}}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],ResourceConstants.CRMClient))},beforeModel:function(e){},model:function(e){},afterModel:function(e){var t=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(t)},renderTemplate:function(e,t){return{outlet:"#inner_result",component:"crm-email-subtab"}},redirect:function(){},afterRender:function(e){}}),Lyte.Router.registerRoute("crm.settings.section.email-insights",{redirect:function(){"crm.settings.section.email-insights"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-intelligence.email-insights",this.replaceWith(this.transition.info))}}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],ResourceConstants.CRMClient))},beforeModel:function(e){},model:function(e){},afterModel:function(e){var t=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(t)},renderTemplate:function(e,t){return{outlet:"#inner_result",component:"crm-email-subtab"}},redirect:function(){},afterRender:function(e){}}),Lyte.Router.registerRoute("crm.settings.section.email-parser",{queryParams:["action"],getResources:function(){var e,t=networkUtils.returnDependencyFiles(["zohocrm_workflow.js","zohocrm_automationactions_usage.js"],ResourceConstants.CRM),r=fetchAutomationFunctionFiles(),s=networkUtils.returnDependencyFiles(["emailparser.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["assignmentrules.css"],ResourceConstants.CRMClient).concat(s).concat(t).concat(r);if(Crm.userDetails.RTL_ENABLED){var i=networkUtils.returnDependencyFiles(["emailparser-rtl.css"],ResourceConstants.CRMClient);e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailparser")],ResourceConstants.CRM).concat(n).concat(i)}else e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailparser")],ResourceConstants.CRM).concat(n);var o=networkUtils.returnDependencyFiles(["zohocrm_emailParser.js"],ResourceConstants.CRM),a=networkUtils.returnDependencyFiles(["crm-email-parser.js","assignmentrules.js","assignment-rule-models.js","assignment-rules-model-wrapper.js","crux-video.js","lyte-step.js","crm-create-helpers.js"],ResourceConstants.CRMClient).concat(e).concat(o);return Lyte.injectResources(a),a},redirect:function(){if("crm.settings.section.email-parser"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.email-parser.index-email-parser"}).data=e}},afterRender:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-settings",{queryParams:["action","frmmode"],getResources:function(){networkUtils.returnDependencyFiles(["mailconfig-min.js"],ResourceConstants.CRMClient)},beforeModel:function(e){["mailSelect","imap","zmail"].contains(this.getQueryParams().action)||this.transition.abort()},redirect:function(){if("crm.settings.section.email-settings"===this.transition.target){var e=this.transition.info.queryParams;e.service=(new Date).getTime(),Lyte.Router.getRouteInstance().replaceWith({route:"crm.settings.section.email-configuration.email-settings",dynamicParams:this.transition.info.dynamicParams,queryParams:e}).data=this.transition.data}},afterRender:function(){$("#result").addClass("crmEmailConfigDiv")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-sharing",{redirect:function(){"crm.settings.section.email-sharing"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-configuration.email-sharing",this.replaceWith(this.transition.info))},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.storage.users-list.user-emailstorage.modules-list.emails-list",{queryParams:["user_id","module","folder_id","user_filter","per_page"],model:function(){var e=$L("crm-email-storage-modules-list")[0].component,t=e.getData("userStorageJson"),r=e.getData("mailClientJson"),s=$L("crm-email-storage-user-usage-email")[0];if(s){var n=s.component;n.setData("mailcountLoading",!0),n.setData("emailsLoading",!0)}var i=this.getQueryParams().user_id,o=this.getQueryParams().user_filter,a=this.getQueryParams().folder_id,l=this.getQueryParams().module,c=this.transition.data.moduleOrFolderErr;if(!l&&"errorInCrmEmails"===c||"noMailsInModule"===c||!c&&(!l&&!a)){for(var u=t.module_data,d=u.length,m=0;m<d;m++)if("recyclebin"===u[m].type||u[m].module.visible&&u[m].module.viewable){l="recyclebin"===u[m].type?"recyclebin":u[m].module.api_name;break}}else c&&"errorInMailbox"===c&&(a=r.folders_data[0].folder.id);var p="recyclebin"===l?"recyclebin":"module",g={};a?(g.user_id=i,g.folder_id=a):l&&("module"===p&&(g.module=l),g.type=p,g.user_id=i),g.page=1,g.per_page=this.getQueryParams().per_page?this.getQueryParams().per_page:50;var f,h=store.findAll("emails",g);if(a){if(a){var y;(y={}).user_id=i,y.folder_id=a}}else(y={}).user_id=i,"module"===p&&(y.module=l),y.type=p;return f=store.triggerAction("emails","count",void 0,y,"GET"),Lyte.resolvePromises({emailsJson:h,userId:i,landingPage:!1,userDetails:!1,userEmailList:!0,loadingEmailPage:!1,emailsCount:f,selectedModule:l,show_landing_page:!0,emailsLoading:!1,mailcountLoading:!1,userStorageJson:t,mailClientJson:r,userFilter:o,folderId:a})},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){if(e.response&&(e=JSON.parse(e.response)),"permission denied to access the module"===e.message||e.details&&e.details.param_name&&"folder_id"===e.details.param_name){var t="permission denied to access the module"===e.message,r=I18n.getMsg("crm.security.error");t||(r=I18n.getMsg("email.storage.folder.already.deleted.error")),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:r}}),this.transition.abort();var s=$L("crm-email-storage-modules-list")[0].component.data.userStorageJson.user.id;return this.transitionTo({route:"crm.settings.section.storage.users-list.user-emailstorage.modules-list.emails-list",queryParams:{user_id:s}}).data={isReloadModuleNeeded:!0,moduleOrFolderErr:t?"errorInCrmEmails":"errorInMailbox"},!0}if("NO_PERMISSION"===e.code||"INACTIVE_USER"===e.code)setTimeout((function(){renderingUtils.displayPermissionDenied(),Lyte.Router.transitionTo({route:"crm.settings.section.storage",queryParams:{type:"email"}}).data={errorInEmailStorage:!0}}),0),this.transition&&this.transition.abort();else if("DEPENDENT_SERVICE_ERROR"===e.code){$("crm-email-storage-user-usage-email")[0].component.setData({errorMsg:I18n.getMsg("emails.server.down.message"),emailsList:[],emailsCount:0,mailcountLoading:!1,emailsLoading:!1}),this.transition&&this.transition.abort()}else setTimeout((function(){renderingUtils.displayPermissionDenied(),Lyte.Router.transitionTo({route:"crm.settings.section.storage",queryParams:{type:"email"}}).data={errorInEmailStorage:!0}}),0),this.transition&&this.transition.abort()},didTransition:function(){this.currentModel.gotResponse||location.reload(),this.currentModel.gotResponse=!1}},afterModel:function(){this.currentModel.gotResponse=!0,this.currentModel.emailsCount=this.currentModel.emailsCount.count;var e=$L("crm-email-storage-user-usage-email")[0];e.component&&(0===this.currentModel.emailsCount?e.component.setData("selectAllCheckbox",!1):e.component.setData("selectAllCheckbox",!0)),this.currentModel.pageInfo=this.currentModel.emailsJson.info,this.currentModel.emailsList=this.currentModel.emailsJson.emails,this.currentModel.folderId&&(this.currentModel.selectedModule=void 0);var t=this.currentModel.folderId;if(t){for(var r=this.currentModel.mailClientJson,s=r.folders_data.length,n=0;n<s;n++)if(r.folders_data[n].folder.id===t){i=r.folders_data[n].folder.api_name;break}this.currentModel.hasDeletePerm=!0}else{var i,o,a=this.currentModel.userStorageJson,l=(s=a.module_data.length,this.currentModel.selectedModule);for(n=0;n<s;n++){if("module"===a.module_data[n].type&&a.module_data[n].module.api_name===l){i=(o=a.module_data[n].module).display_label;break}if("recyclebin"===a.module_data[n].type){i="Recycle Bin";break}}if(!i||"recyclebin"!==l&&"Recycle Bin"===i){var c=$L("crm-email-storage-modules-list")[0].component.data.userStorageJson.user.id;return void(this.transitionTo({route:"crm.settings.section.storage.users-list.user-emailstorage.modules-list.emails-list",queryParams:{user_id:c}}).data={isReloadModuleNeeded:!0,moduleOrFolderErr:"noMailsInModule"})}this.currentModel.hasDeletePerm="recyclebin"===l?"Administrator"===Crm.userDetails.PROFILE_NAME:Crm.userDetails.permissions["Crm_Implied_Delete_Mail_"+store.peekRecord("module",o.id).module_name]}this.currentModel.moduleDisplayName=i},renderTemplate:function(){var e=$L("crm-email-storage-modules-list")[0];return e&&!0===e.component.getData("emailsRightLoading")&&e.component.setData("emailsRightLoading",!1),{outlet:"#module-emaildetails",component:"crm-email-storage-user-usage-email"}}}),Lyte.Router.registerRoute("crm.settings.section.export-data",{redirect:function(){if("crm.settings.section.export-data"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.export",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.export.export-data",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-export.js","lyte-daterangepicker.js","lyte-dateselect.js","crux-schedular-notification.js"],ResourceConstants.CRMClient);e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("export"),networkUtils.getI18nJSUrl("cruxnotification")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t=t.concat(networkUtils.returnDependencyFiles(["crm-export-new.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t)},model:function(){return Lyte.resolvePromises({data:store.findAll("export",{page:1,per_page:50},!1,!0),export_modules:store.findAll("module",{feature_name:"export"},!1,!1)}).then((function(e){return e}),(function(){Lyte.Component.render("crm-export-alertpage",null,"#result")}))},afterRender:function(){$("#setup_new_ContentDiv").addClass("helpOverflowHide")},renderTemplate:function(e){return e?{outlet:"#result",component:"crm-export-data"}:{outlet:"#result",component:"crm-export-alertpage"}},afterModel:function(e){if(!e)return e;{e.data&&(e.toShowHistory=!0);var t,r={id:1,display_field_filter:"Competitors",module_name:"Competitors",plural_label:I18n.getMsg("crm.label.competitors"),api_name:"Competitors"};e.export_modules=e.export_modules.module,t=Lyte.registeredMixins["crm-export-util"].getVisibleModuleForExport(e.export_modules).visibleModules,e.export_modules.push(r);var s;e.export_modules.forEach((e=>{e.display_field_filter=Lyte.Component.registeredHelpers.changeNameForHistory(e.id,e.api_name)})),t.length&&0!==t.length?e.export_modules=e.export_modules.sort(((e,t)=>e.display_field_filter>t.display_field_filter?1:t.display_field_filter>e.display_field_filter?-1:0)):e.no_module=!0,s=Crm.userDetails.IS_ADMIN?[{id:"none",display_field_filter:I18n.getMsg("crm.label.AllModules")},{id:"Users",display_field_filter:I18n.getMsg("crm.label.users")}]:[{id:"none",display_field_filter:I18n.getMsg("crm.label.AllModules")}],e.export_modules.forEach((function(e){!Crm.userDetails.IS_ADMIN&&moduleRecordMapping.Forecasts&&e.id===moduleRecordMapping.Forecasts.id||e.parent_module&&"Appointments__s"===e.parent_module.api_name&&!Crm.userDetails.permissions["Crm_Implied_Export"+e.module_name]||s.push(e)}));let n=Object.keys(idModuleMapping).find((e=>"Potentials"===idModuleMapping[e]));e.export_modules=s,e.data&&(e.moreRecords=e.data.$.meta.more_records,e.isScrolled=!!e.data.$.meta.more_records,e.page=e.data.$.meta.page,e.data.forEach((function(e){if("users"!==e.query.module.api_name&&"Competitors"!==e.query.module.api_name){var t,r=moduleRecordMapping[idModuleMapping[e.module.id]];if("Notes"===e.module.api_name){var s=moduleRecordMapping[idModuleMapping[e.query.module.id]];if(s&&"team_based"===s.access_type)return void(Crm.userDetails.permissions["Crm_Implied_Export_"+e.module.api_name+"_"+s.module_name]||(e.isModuleUnavailable=!0))}if(!r||!idModuleMapping[e.module.id]||"Notes"===r.api_name&&!r.visible&&!r.viewable)return void(e.isModuleUnavailable=!0);if(Crm.userDetails.SUBFORM_PERMISSIONS&&r&&("subform"===r.generated_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===r.generated_type)){var i=r&&r.parent_module&&"Activities"!==r.parent_module.api_name?r.parent_module.visible&&r.parent_module.viewable:r.visible&&r.viewable,o=r&&r.visible&&r.viewable;t=!i||!o}else t=r&&r.parent_module&&"Activities"!==r.parent_module.api_name?!r.parent_module.visible||!r.parent_module.viewable:!r.visible||!r.viewable;r&&"Notes"!==r.api_name&&t&&(e.isModuleUnavailable=!0)}if("Competitors"===e.query.module.api_name){var a=moduleRecordMapping[idModuleMapping[n]];e.isModuleUnavailable=a&&(!a.visible||!a.viewable)}})))}},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide"),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"undefined"==typeof ZohoHCAsap||"function"!=typeof ZohoHCAsap||"undefined"!==(ZohoHCAsap.UnInstall,!1)||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())},didTransition:function(){var e=this.transition.export_id;if(e&&""!==e){if($L("#exporthistorypage")[0]){var t=$L("crm-export-history")[0].component;t.getData("toShowFilter")&&(t.getData("toShowUser")||t.getData("moduleId")||t.getData("is_date_selected"))&&t.actions.expFilterOpen(t),setTimeout((()=>{var t="#"+e,r=$L(t.toString())[0],s=r.offsetTop,n=$L("#setup_new_ContentDiv"),i=r.getBoundingClientRect(),o=n[0].offsetHeight+$L("#mainMenuTabDiv")[0].offsetHeight+15,a=i.y+i.height;$L(t).addClass("crmElementFocus"),a>o&&n[0].scrollTo(0,s)}),200)}$L("#cruxSchedularPopup")[0]&&$L("#cruxSchedularPopup")[0].component.setData("cxPropShow",!1)}}}},{mixins:["crm-export-util"]}),Lyte.Router.registerRoute("crm.settings.section.export.export-history",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-export.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("export"),networkUtils.getI18nJSUrl("cruxnotification")],ResourceConstants.CRM)),t=networkUtils.returnDependencyFiles(["crm-export-new.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(e){return Lyte.resolvePromises({export_job:store.findRecord("export",e.dynamicParam)}).then((function(e){return e}),(function(){Lyte.Component.render("crm-export-alertpage",null,"#result")}))},afterModel:function(e){return e},renderTemplate:function(e){if(e&&e.export_job){var t=e&&e.export_job&&"Notes"===e.export_job[0].module.api_name?moduleRecordMapping[idModuleMapping[e.export_job[0].query.module.id]]:null,r=!(!t||"team_based"!==t.access_type),s="true"===r&&!Crm.userDetails.permissions["Crm_Implied_Export_"+e.export_job[0].module.api_name+"_"+t.module_name]||!idModuleMapping[e.export_job[0].module.id];if(!e||e&&!e.export_job||s&&"users"!==e.export_job[0].query.module.api_name&&"Competitors"!==e.export_job[0].query.module.api_name)return{outlet:"#result",component:"crm-export-alertpage"};var n=e.export_job[0].module.id,i=e.export_job[0].module.api_name,o=moduleRecordMapping[idModuleMapping[n]];if("users"!==i&&"Competitors"!==i&&!r){if(!o||"Notes"===o.api_name&&!o.visible&&!o.viewable)return{outlet:"#result",component:"crm-export-alertpage"};var a=o&&o.parent_module&&"Activities"!==o.parent_module.api_name?!o.parent_module.visible||!o.parent_module.viewable:!o.visible||!o.viewable;if(o&&"Notes"!==o.api_name&&a)return{outlet:"#result",component:"crm-export-alertpage"}}return{outlet:"#result",component:"crm-export-job"}}Lyte.Component.render("crm-export-alertpage",null,"#result")},actions:{willTransition:function(){commonUtils.showHideLoadingDiv(!1)}}}),Lyte.Router.registerRoute("crm.settings.section.export",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-export.js","lyte-hovercard.js","features_model.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["crm-export-new.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(e)},redirect:function(){if("crm.settings.section.export"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.export.export-data",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.cisco-teams",{},{mixins:["chat-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.dynamicExtn",{model:function(e){(e=this.transition.info.queryParams).nameSpace=this.getDynamicParam(),delete e.tab,delete e.subTab;var t={params:e};return networkUtils.lyteInitiateRequest("/market/showPlugins.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.meeting-integration",{queryParams:["toolname"],model:function(e){var t={params:{type:"showMeetingPage",toolName:this.getQueryParams().toolname?this.getQueryParams().toolname:"GoToMeeting"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#internalExtensionDetail",html:e}},beforeModel:function(e){var t=e.toolname?e.toolname:"GoToMeeting";Crm.trackSpotLightAction(t+" Integration - Manage Click")},redirect:function(e,t){Crm.userDetails.MEETING_BRIDGE_ENABLED&&(this.transitionTo({route:"crm.settings.section.modules.module.events_preferences",dynamicParams:["Events"]}).data={toolname:t.queryParams.toolname})},afterRender:function(e,t){if(Crm.userDetails.MEETING_BRIDGE_ENABLED){var r=[];r[0]={comparator:"equal",field:{api_name:"Meeting_Provider__s",ui_type:2,label:"Provider"},value:[Events.displayToolName[t.toolname]]},r[1]={comparator:"greater_than",field:{api_name:"Start_DateTime"},value:$L.moment().toDate().toISOString().slice(0,19)+"+00:00"},Events.getMeetingCountBasedOnCriteria(r).then((function(e){var s=0;e.count>0&&(s=e.count);var n=document.querySelector("meeting-disable");null!==n&&n.remove(),$("#enableDisableMeetingButton").attr("onclick","Events.loadSingleProviderDisablePop('undefined','"+t.toolname+"','"+s+"','"+r+"','body')"),Events.loadSingleProviderDisablePop(void 0,t.toolname,s,r,"body"),document.getElementById("yesBtn").setAttribute("onclick",'Events.disableMeetingTool("'+t.toolname+'")')}))}else"GoToMeeting"===t.toolname&&t.from&&"calendarBooking"===t.from&&$("#enableDisableMeetingButton").trigger("click")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.sales-navigator",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_salesnavigator.js",networkUtils.getI18nJSUrl("salesnavigator")],ResourceConstants.CRM)},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/sales_navigator","GET",{skip_load_tab:!0})},afterModel:function(e,t){"object"==typeof e&&(e.brand=RebrandLinkUtil.properties.Brand,e.details.profiles&&(SalesNavigatorSettings.config=e,Handlebars.registerPartial("SalesNavigatorPermissions",Handlebars.templates.SalesNavigatorPermissions),e.partner=Crm.partnerName),this.currentModel=e)},renderTemplate:function(e,t){if("object"==typeof e)return{outlet:"#internalExtensionDetail",html:Handlebars.templates.SalesNavigatorSetup(e)}},beforeExit:function(){var e=$L("sales-navigator");e&&e.length>0&&e[0].remove()}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.slack",{getDependencies:function(){return networkUtils.returnDependencyFiles(["slack-setup-store.js","chat-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chat-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zohocrm_slackHome.js","zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],ResourceConstants.CRM),s=e.concat(t);return s=s.concat(r)},beforeModel:function(){Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort())},model:function(){var e=this.transition;return store.findAll("team",{type:"slack",req_for:"settings"},!1).then((function(e){return{teams:e,type:"slack",active:!0}}),(function(t){var r=JSON.parse(t.response);if(r){if("FEATURE_NOT_ENABLED"===r.code)return{type:"slack",active:!1};"PERMISSION_DENIED"===r.code&&(renderingUtils.displayPermissionDenied(),e.abort())}}))},renderTemplate:function(){return{outlet:"#internalExtensionDetail",component:"crm-chat-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions",{beforeModel:function(e){featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.setData("selectedMenu","marketplace");var t=this,r=t.transition;if(r.info.queryParams.activate&&"crm.settings.section.extensions.all-extensions.sales-navigator"===this.transition.target){$("#linkedinActivateMsg").addClass("dN");var s={success_callback:function(){t.setQueryParams("activate",void 0)}};networkUtils.makeRequest("/crm/v2/settings/sales_navigator","POST",s),r.pause()}},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-common-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["online-meeting.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["online-meeting-market.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MeetingIntegration")],ResourceConstants.CRM);return e.concat(t).concat(r).concat(s)},model:function(e){var t=this.transition.info.queryParams.toolname;e={};if("crm.settings.section.extensions.all-extensions.slack"===this.transition.target&&(e={nameSpace:"slack",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.sales-navigator"===this.transition.target&&(e={nameSpace:"salesnavigator",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.meeting-integration"===this.transition.target&&(t=t||"GoToMeeting",e={nameSpace:t+="",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.cisco-teams"===this.transition.target&&(e={nameSpace:"ciscoteams",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.dynamicExtn"!==this.transition.target){var r={params:e};return networkUtils.lyteInitiateRequest("/market/showPlugins.do","GET",r)}},renderTemplate:function(e,t){var r="#result";return 0===$L("#result").length&&(r="#show"),{outlet:r,html:e}},afterRender:function(){if(featuresAvailable.NEXTGENUI_ENABLED){$L(".tabClass2").hide();var e=$L("#mp_extensions>iframe")[0];if(e){var t=$L("crm-left-menu")[0],r=null;(t=t?t.component:null)&&(r=t.getData("dataMode"));var s=e.src;"dark"===r?e.src=s.includes("theme=dark")?s:"?"===s.charAt(s.length-1)?s+"theme=dark":s+"&theme=dark":(s=(s=(s=s.replace("&theme=dark","")).replace("theme=dark&","")).replace("theme=dark",""),e.src=s)}}if(this.transition.data&&this.transition.data.showInstalled)if(featuresAvailable.NEXTGENUI_ENABLED){var n=document.querySelector("crm-left-menu-marketplace");n&&n.component&&(n=n.component).actions.loadMarketPlaceMenu("myPluginList")}else $("#pluginIPClick").click()},beforeExit:function(){$("#pluginHeaders .pluginMainDiv").remove()}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-apps",{getResources:function(){return networkUtils.returnDependencyFiles(["zcrm_googleapps.js"],ResourceConstants.CRM)},beforeModel:function(e){Object.keys(crmHistory.getGAppsRoutevsAction()).contains(this.getDynamicParam())||this.transition.abort()},model:function(e){var t={params:{mode:crmHistory.getGAppsRoutevsAction()[this.getDynamicParam()]}};return t.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GApps.do","POST",t)},renderTemplate:function(e,t){var r="#result";return 0===$L("#result").length&&(r="#show"),{outlet:r,html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-calendars",{getDependencies:function(){return networkUtils.returnDependencyFiles(["gapps/crm-gcal-models.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcal-main.js","crm-google-utils.js","gapps/crm-invalid-url.js","gapps/crm-gapps.js","crm-create-mixin.js","crm-create-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gapps/crm-gcal-main.css","gapps/crm-invalid-url.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_cal")],ResourceConstants.CRM),s=e;return s=(s=s.concat(t)).concat(r)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=store.peekRecord("user",Crm.userDetails.USER_ID),t=store.findRecord("module",moduleRecordMapping[crmModuleConstants.Events].id),r=store.findRecord("profile",e.profile.id),s=store.findAll("layout",{module:"Events"},!1),n=store.findAll("gcal_sync"),i=store.findAll("unavailable_calendar",{service_type:"google"});return Lyte.resolvePromises({module:t,record:e,profile:r,layout:s,gcal_sync:n,unavailable_calendar:i})},model:function(){var e=this,t=store.peekAll("gcal_sync");if(0!==t.length&&!0===t[0].reauthenticate||0===t.length){var r=void 0!==e.transition.data.authenticated_email&&"null"!==e.transition.data.authenticated_email?{email:e.transition.data.authenticated_email}:null;if(null===r){var s=store.peekAll("unavailable_calendar");(s=s.filter((function(e){return"google"===e.service_type}))).length&&(r={email:s[0].authenticated_email})}return store.findAll("gcal_config",r)}return store.unloadAll("gcal_config"),t},afterModel:function(e){var t=this;if(t.error_key)store.peekAll("gcal_sync")[0]&&Object.keys(store.peekAll("gcal_sync")[0]).length>0&&(this.currentModel={gcal_config:store.peekAll("gcal_config")[0],gcal_sync:store.peekAll("gcal_sync")[0],authenticated_email:r});else{void 0!==e&&Array.isArray(e)&&(e=e[0]);var r=void 0!==t.transition.data.authenticated_email&&"null"!==t.transition.data.authenticated_email?t.transition.data.authenticated_email:"",s=!1,n=store.peekAll("unavailable_calendar"),i=[];if(n.length){s=!0;for(var o=n.length,a=0;a<o;a++)i.push(n[a].folder_id)}this.currentModel={gcal_config:store.peekAll("gcal_config")[0],gcal_sync:store.peekAll("gcal_sync")[0],authenticated_email:r,unavailability_enabled:s,get_unavailable:n,selected_unavailable:i}}},renderTemplate:function(){return{outlet:"#result",component:"crm-gcal-main"}},afterRender:function(){commonUtils.showHideLoadingDiv();var e=store.peekAll("gcal_sync");!Crm.userDetails.isStorageLimitReached||0===e.length||"google_to_crm"!==e[0].sync_option&&"two_way"!==e[0].sync_option||Crm.showStorageExceedPopup("sync_alert")},beforeExit:function(){store.unloadAll("gcal_config"),store.unloadAll("gcal_sync"),store.unloadAll("profile-permissions"),store.unloadAll("unavailable_calendar")},actions:{onError:function(e,t){if(e.response.includes("HIDDEN_MODULE"))Lyte.Component.render("crm-invalid-url",{},"#mainResult"),$("#setupshow").hide(),commonUtils.showHideLoadingDiv(),this.transition&&this.transition.abort();else if(e.response&&(e.response.includes("NO_PERMISSION")||e.response.includes("CANNOT_PERFORM_ACTION")))return this.error_key=!0,this.currentModel={error:!0},t.resume(),!1},willTransition:function(e){"crm.settings.section.extensions.google-extensions.google-calendars"===e.target&&(e.data&&e.data.refreshData||(store.unloadAll("gcal_config"),store.unloadAll("gcal_sync"),this.getRouteInstance().refresh({refreshTemplate:!0}).data={refreshData:!0}))}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-chat",{getDependencies:function(){return networkUtils.returnDependencyFiles(["chat-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"],ResourceConstants.CRM)];return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["google-chat.js","crm-help-link.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["google-chat.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))},model:function(){return store.findAll("chat_setting",{type:"google_chat"},!1).then((e=>e[0]))},renderTemplate:function(e){return e.buttonType=e.active?"failure":"success",e.buttonText=I18n.getMsg(e.active?"crm.button.disable":"crm.button.enable"),e.status=e.active,{outlet:"#result",component:"crm-google-chat"}},afterRender:function(){commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-contacts",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcont-models.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["hipaa-store.js"],ResourceConstants.CRMClient);return e.concat(t)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcont-main.js","crm-google-utils.js","gapps/crm-invalid-url.js","gapps/crm-gapps.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gapps/crm-gcont-main.css","gapps/crm-invalid-url.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_cont")],ResourceConstants.CRM),s=e;return s=(s=s.concat(t)).concat(r)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=store.peekRecord("user",Crm.userDetails.USER_ID),t=store.findRecord("profile",e.profile.id),r=store.findAll("custom_view",{module:"contacts"}),s=store.findAll("field",{module:"Contacts"},!1,!0,{apiVersion:"2.1"}),n=store.findAll("gcont_sync");return Lyte.resolvePromises({record:e,custom_view:r,field:s,gcont_sync:n,profile:t})},model:function(){var e=this,t=store.peekAll("gcont_sync");if(0!==t.length&&!0===t[0].reauthenticate||0===t.length){var r=void 0!==e.transition.data.authenticated_email&&"null"!==e.transition.data.authenticated_email?{email:e.transition.data.authenticated_email}:null;return store.findAll("gcont_config",r)}return store.unloadAll("gcont_config"),t},afterModel:function(e){var t=this;if(t.error_key)this.currentModel=this.dummy;else{void 0!==e&&Array.isArray(e)&&(e=e[0]);var r=void 0!==t.transition.data.authenticated_email&&"null"!==t.transition.data.authenticated_email?t.transition.data.authenticated_email:"";this.currentModel={gcont_config:store.peekAll("gcont_config")[0],gcont_sync:store.peekAll("gcont_sync")[0],authenticated_email:r}}},renderTemplate:function(){return{outlet:"#result",component:"crm-gcont-main"}},afterRender:function(){commonUtils.showHideLoadingDiv();var e=store.peekAll("gcont_sync");!Crm.userDetails.isStorageLimitReached||0===e.length||"two_way"!==store.peekAll("gcont_sync")[0].sync_option&&"google_to_crm"!==store.peekAll("gcont_sync")[0].sync_option?gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_GOOGLE_INTEG").PF_ACCESSED_GOOGLE_INTEG,RebrandLinkUtil.getProperties("PF_ACCESSED_GOOGLE_INTEG_ID").PF_ACCESSED_GOOGLE_INTEG_ID):Crm.showStorageExceedPopup("sync_alert")},beforeExit:function(){store.unloadAll("gcont_config"),store.unloadAll("gcont_sync"),store.unloadAll("custom_view"),store.unloadAll("field"),store.unloadAll("profile-permissions")},actions:{onError:function(e,t){if(e.response&&e.response.includes("HIDDEN_MODULE"))Lyte.Component.render("crm-invalid-url",{},"#mainResult"),$("#setupshow").hide(),commonUtils.showHideLoadingDiv(),this.transition&&this.transition.abort();else if(e.response&&(e.response.includes("NO_PERMISSION")||e.response.includes("CANNOT_PERFORM_ACTION")))return this.error_key=!0,this.dummy={error:!0},t.resume(),!1},willTransition:function(e){"crm.settings.section.extensions.google-extensions.google-contacts"===e.target&&(e.data&&e.data.refreshData||(store.unloadAll("gcont_config"),store.unloadAll("gcont_sync"),this.getRouteInstance().refresh({refreshTemplate:!0}).data={refreshData:!0}))}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-tasks",{getDependencies:function(){return networkUtils.returnDependencyFiles(["gapps/crm-gtask-models.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gtasks.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gapps/crm-invalid-url.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_tasks")],ResourceConstants.CRM),s=e;return s=(s=s.concat(t)).concat(r)},model:function(){return store.findAll("gtasks")},afterModel:function(e){var t={};if(e.isGAppAcc){var r=e.google_tasks.find((({isDefault:e})=>!0===e));t.allTasks=e.google_tasks,t.defTask=r?r.display_label:"select task",t.defId=r?r.id:void 0,t.isGAppAcc=e.isGAppAcc,t.isAdminProfileUser=e.isAdminProfileUser,t.isGAppUserFromOpenID=e.isGAppUserFromOpenID}t.isGAppAcc=e.isGAppAcc,this.currentModel=t},redirect:function(e){e.isGAppAcc||this.transitionTo({route:"crm.settings.section.extensions.google-extensions.google-contacts"})},renderTemplate:function(){return{outlet:"#result",component:"crm-gtasks"}},actions:{onError:function(){this.transitionTo({route:"crm.settings.section.extensions.google-extensions.google-contacts"})}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-users",{getDependencies:function(){return networkUtils.returnDependencyFiles(["gapps/crm-guser-models.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gusers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["gapps/crm-gusers.css","gapps/crm-invalid-url.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_users")],ResourceConstants.CRM),s=e;return s=(s=s.concat(t)).concat(r)},model:function(){return store.findAll("gusers")},afterModel:function(e){var t={};if(e[0].google_users){var r=I18n.getMsg("crm.gapp.import.users.note1",[e[0].userDetails.editionPlan,e[0].userDetails.allowedUserCount,e[0].userDetails.remainingUserCount,Crm.appName,Crm.getCrmBasePath()]);t.img=r,t.gusersData=e[0].google_users,t.isGAppUserFromOpenID=e[0].userDetails.isGAppUserFromOpenID,t.isAdminProfileUser=e[0].userDetails.isAdminProfileUser,t.pageToken=e[0].info.next_page,t.remainingUserCount=e[0].userDetails.remainingUserCount}t.isGAppAcc=e[0].userDetails.isGAppAcc,this.currentModel=t},redirect:function(e){e.isGAppAcc||this.transitionTo({route:"crm.settings.section.extensions.google-extensions.google-contacts"})},renderTemplate:function(){return{outlet:"#result",component:"crm-gusers"}},afterRender:function(e){document.getElementById("dynamicContent").innerHTML=e.img},actions:{onError:function(e){e.responseText&&e.responseText.includes("Not Authorized to access this resource")?_cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:"Only domain admin can access Google Add user tab",ltPropDuration:"2000",ltPropShow:!0}}):e.responseText&&e.responseText.includes("Internal Server Error")&&_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.social.integ.error.internal"),ltPropDuration:"1000",ltPropShow:!0}}),this.transitionTo({route:"crm.settings.section.extensions.google-extensions.google-contacts"})}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions",{redirect:function(){"crm.settings.section.extensions.google-extensions"===this.transition.target&&this.transitionTo({route:globalSetpJson.components[8].menus[2].sub_menus[0].routeName})}}),Lyte.Router.registerRoute("crm.settings.section.extensions.leadchain-extensions.leadchain",{queryParams:["isLeadChainEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(){var e=RebrandLinkUtil.getProperty("LEADCHAIN_IDC_NAMESPACE"),t=e.split(".")[0],r=e.split(".")[1];if(!Crm.isLeadChainEnabled){let e={crmZgid:crmZgid,portalName:t,pluginNamespace:r};store.findAll("dummy",{},!1,!1,{url:"/market/installextension",method:"POST",payLoad:e}).then((function(e){"success"===e.dummy.status?(_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:Lyte.Component.registeredHelpers.getI18n("crm.leadchain.extension.success")}}),location.reload()):_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:Lyte.Component.registeredHelpers.getI18n("crm.leadchain.extension.failed")}})}))}return{portalNameSpace:t,pluginNameSpace:r}},renderTemplate:function(e){if(Crm.isLeadChainEnabled)return'<style>#result{height:100%;}.widget_Frame_settings{height: 100%;width: 100%;}</style><div id="settingWidgetContainer"></div>',{outlet:"#result",html:'<style>#result{height:100%;}.widget_Frame_settings{height: 100%;width: 100%;}</style><div id="settingWidgetContainer"></div>'}},afterRender:function(e){var t=e.portalNameSpace,r=e.pluginNameSpace,s=this.transition.info.queryParams.network;if(Crm.isLeadChainEnabled){var n=this.transition.leadchainData.pluginID;s=encodeURIComponent(s),renderSettingsWidget(r,t,"LeadChain",n,s)}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.leadchain-extensions",{queryParams:["network"],getResources:function(){return[networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("remotetoolkit")],ResourceConstants.CRM),networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Leadchain")],ResourceConstants.CRM),[RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL")],networkUtils.returnDependencyFiles(["integration/leadchain/crm-leadchain-setup.js"],ResourceConstants.CRMClient)]},model:function(){var e=RebrandLinkUtil.getProperty("LEADCHAIN_IDC_NAMESPACE");return{networkName:this.transition.info.queryParams.network,response:store.findAll("dummy",{namespace:e},!1,!1,{url:"/market/api/extension",method:"GET"})}},afterModel:function(e){var t=e.response;Crm.isLeadChainAvailable=!0,t.content.installation_status&&"active"!==t.content.installation_status?(Crm.isLeadChainEnabled=!1,Crm.isLeadChainAvailable=!1):"success"===t.status?Crm.isLeadChainEnabled=!0:"error"===t.status&&(Crm.isLeadChainEnabled=!1)},redirect:function(e){var t=e.response,r=e.networkName.split("_");if(!1===Crm.isLeadChainEnabled&&1===r.length){var s={network:e.networkName};this.transitionTo("crm.settings.section.extensions.leadchain-extensions",{},s).leadchainData={network:e.networkName}}if(Crm.isLeadChainEnabled){s={network:e.networkName};this.transitionTo("crm.settings.section.extensions.leadchain-extensions.leadchain",{},s).leadchainData={network:r[0],pluginID:t.content.id}}},renderTemplate:function(e){void 0===e.networkName&&(e.networkName="Facebook");var t=e.networkName.split("_");if(!1===Crm.isLeadChainEnabled&&1===t.length)return e.networkName=t[0],{outlet:"#result",component:"crm-leadchain-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-office",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["integration/crm-ms-models.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["hipaa-store.js"],ResourceConstants.CRMClient);return e.concat(t)},getResources:function(){var e=networkUtils.returnDependencyFiles(["integration/crm-ms-components.js","crm-create-helpers.js","crm-google-utils.js","crm-create-mixin.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["integration/crm-mstasks-fieldmapping.css"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-microsoft-mapping.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),r=networkUtils.returnDependencyFiles(["zohocrm_msintegration.js",networkUtils.getI18nJSUrl("office365")],ResourceConstants.CRM);return e.concat(r).concat(t)},beforeModel:function(){var e=this;if(commonUtils.showHideLoadingDiv(!0),void 0!==e.transition.product){void 0!==e.transition.authenticated_email&&e.transition.authenticated_email,void 0!==e.transition.accountId&&e.transition.accountId;switch(e.transition.product){case"mscalendar":return store.batch((function(){store.findRecord("module",moduleRecordMapping[crmModuleConstants.Events].id),store.findAll("layout",{module:"Events"},!1),store.findAll("unavailable_calendar",{service_type:"microsoft"})}));case"mscontact":return store.findAll("field",{module:"Contacts"},!1);case"mstask":return store.findAll("field",{module:"Tasks"},!1)}}},model:function(){var e=this;if(void 0!==e.transition.product){if("mscalendar"===e.transition.product){var t={};return void 0!==e.transition.authenticated_email&&"null"!==e.transition.authenticated_email&&(t.authenticated_email=e.transition.authenticated_email),void 0!==e.transition.accountId&&"null"!==e.transition.accountId&&(t.accountId=e.transition.accountId),store.findAll("mscalendar_configuration",t)}return store.findAll(e.transition.product)}},afterModel:function(e){var t=this;if(!t.error_key&&(void 0!==e&&Array.isArray(e)&&(e=e[0]),t.currentModel)){var r=t.currentModel.data;if(void 0===r&&void 0!==t.transition.product){var s=t.transition.product;store.peekAll(s)[1]&&store.deleteRecord(s,"123");var n=void 0!==t.transition.authenticated_email?t.transition.authenticated_email:"",i=void 0!==t.transition.accountId?t.transition.accountId:"";r={product:t.transition.product,authenticated_email:n,error:!1,accountId:i}}this.currentModel={mscalendar:store.peekAll("mscalendar")[0],mscontact:store.peekAll("mscontact")[0],mstask:store.peekAll("mstask")[0],data:r}}},renderTemplate:function(e,t){var r="#result";return 0===$L("#result").length&&(r="#show"),{outlet:r,component:"crm-ms-container"}},afterRender:function(e,t){var r=this;if(commonUtils.showHideLoadingDiv(!0),void 0!==r.transition.product&&"mstask"===r.transition.product)msApps.openTaskFieldMapper(msApps.task_sync_email),store.peekAll("mstask")[0].$.set("accountId",r.transition.accountId);else if(void 0!==r.transition.product&&"mscontact"===r.transition.product)r.openContactsFieldMapper(msApps.contact_sync_email);else if(void 0===r.transition.product||"mscalendar"!==r.transition.product||r.transition.integrated)if(void 0!==r.transition.reauth&&!0===r.transition.reauth){var s=r.transition.reauth_mode;"mscontact"===s?store.findAll("mscontact"):"mscalendar"===s?store.findAll("mscalendar"):store.findAll("mstask")}else void 0!==r.transition.product&&"mscalendar"===r.transition.product&&r.transition.integrated&&store.peekAll("unavailable_calendar")&&store.peekAll("unavailable_calendar").length>0&&$L("crm-ms-common")[0].setData("unavailability_list",store.peekAll("unavailable_calendar"));else r.openCalendarMapper();commonUtils.showHideLoadingDiv()},beforeExit:function(){store.unloadAll("mscalendar"),store.unloadAll("mscalendar_configuration"),store.unloadAll("mscontact"),store.unloadAll("mstask"),store.unloadAll("unavailable_calendar")},methods:{sortCalendarLabel:function(e){return e.sort(((e,t)=>{var r=e.field_label.toLowerCase(),s=t.field_label.toLowerCase();return r<s?-1:r>s?1:0})),e},sortCalendarName:function(e){return e.sort(((e,t)=>{var r=e.folder_name.toLowerCase(),s=t.folder_name.toLowerCase();return r<s?-1:r>s?1:0})),e}},actions:{onError:function(e,t){if(e.response){this.error_key=!0;return void 0!==this.transition.product?this.currentModel={data:{product:this.transition.product,error:!0,message:"crm.livedesk.error.exp.msg"}}:this.currentModel={data:{product:"",error:!0,message:"crm.livedesk.error.exp.msg"}},t.resume(),!1}},willTransition:function(e){"crm.settings.section.extensions.ms-extensions.ms-office"!==e.target||e.accountId||e.data&&e.data.refreshData||(this.getRouteInstance().refresh({refreshTemplate:!0}).data={refreshData:!0})}},openContactsFieldMapper:function(e){var t=document.getElementById("ms_contact_mapping");t&&t.parentNode.removeChild(t);var r=store.peekAll("mscontact")[0];r.$.get("deactivation_progress")?store.findAll("mscontact").then((function(){var e=store.peekAll("mscontact")?store.peekAll("mscontact")[0]:void 0;e&&!1===e.$.get("deactivation_progress")?t.ltProp("show",!0):crmui.showMsgBand("error",I18n.getMsg("crm.mstask.deactivate.progress"),1e3)})):(e&&!0!==e&&r.$.set("authenticated_email",e),r.$.set("accountId",this.transition.accountId),Lyte.Component.render("crm-mscontacts-fieldmapping",{mscontact:r},"#mapper"))},openCalendarMapper:function(){store.unloadAll("mscalendar");var e=this,t=document.getElementById("ms_calendar_mapping");t&&t.parentNode.removeChild(t);var r=store.peekAll("mscalendar")[0],s=store.peekAll("mscalendar_configuration")[0],n=!1,i=e.getUnavailableList(),o=[];if(i.length){n=!0;for(var a=i.length,l=0;l<a;l++)o.push(i[l].folder_id)}commonUtils.showHideLoadingDiv(!0);var c,u,d=0,m=[],p=[],g=[],f=[],h=!0;if(r&&r.ms_calendar){var y=r.id;c=store.peekRecord("mscalendar",y)}else{var C=store.createRecord("mscalendar",{id:"123"});C.ms_calendar=s.ms_calendars[0],C.sync_direction="two_way",h=!1,c=C}if(r&&r.ms_calendar&&null===r.ms_calendar.folder_id&&(h=!1),void 0===s||void 0===s.enable_customer_invitation||s.enable_customer_invitation||(c.enable_customer_invitation=s.enable_customer_invitation,c.invitee_info.status="inactive"),s&&s.ms_calendars){var v=s.ms_calendars.length;for(l=0;l<v;l++)s.ms_calendars[l].configured_in_other_org&&p.push(s.ms_calendars[l].folder_id),s.ms_calendars[l].default_calendar&&(u=s.ms_calendars[l].folder_id);s.ms_calendars=e.methods.sortCalendarName(s.ms_calendars);var _=e.getLayoutRecords(),R=e.getExecFields(),w=e.getUnsupportedUI();if(r&&r.premapped_fields&&r.premapped_fields.forEach((function(e){m.push(e.id)})),c&&c.premapped_fields){var b=c.premapped_fields,D=[];b.forEach((function(e){D.push(e.id)})),D.forEach((function(e){var t=b.findIndex((function(t){return t.id===e}));-1!==t&&Lyte.arrayUtils(b,"removeAt",t,1)}))}g=_.filter((function(e){return e.show_element=!(!m.includes(e.id)||e.required),e.tooltip&&(e.tooltiptype=e.tooltip.name,e.tooltipValue=e.tooltip.value),m.includes(e.id)&&!e.required&&d++,!e.required&&e.visible&&(!e.field_read_only||e.field_read_only&&null!==e.default_value)&&(!e.read_only||e.read_only&&null!==e.default_value)&&e.view_type.create&&!w.includes(e.ui_type)&&!R.includes(e.api_name)&&e.custom_field})),f=_.filter((function(e){return e.tooltip&&(e.tooltiptype=e.tooltip.name,e.tooltipValue=e.tooltip.value),e.required&&e.visible&&(!e.field_read_only||e.field_read_only&&null!==e.default_value)&&(!e.read_only||e.read_only&&null!==e.default_value)&&e.view_type.create&&!w.includes(e.ui_type)&&!R.includes(e.api_name)&&e.custom_field})),g=e.methods.sortCalendarLabel(g)}Lyte.Component.render("crm-mscalendar-fieldmapping",{mscalendar:r,mscalendar_configuration:s,unavailability_enabled:n,get_unavailable:i,lockUpdate:h,selected_unavailable:o,mandatoryFields:f,selectedCustomFields:d,eventFields:g,active:n,syncData:c,already_configured:p,predefFields:m,defaultCalendar:u},"#mapper")}},{mixins:["crm-google-utils"]}),Lyte.Component.registerHelper("calendarsyncoption",(function(e){var t=3;switch(e){case"two_way":t=3;break;case"crm_to_ms":t=2;break;case"ms_to_crm":t=1}return t})),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-outlook",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-outlook-admin.css"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-outlook-admin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MicrosoftOutlookAddin")],ResourceConstants.CRM))},model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OutlookEvaluationAction.do?action=checkoutlook","GET").then((function(e){if(1!=e&&"true"!=e)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OutlookEvaluationAction.do?action=oldoutlook","GET")}))},renderTemplate:function(e){return null==e?{outlet:"#result",component:"crm-outlook-admin"}:{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-teams",{didDestroy:function(){_cruxUtils.removeCustomAlert()}},{mixins:["chat-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-word",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MailMerge.do","GET",{params:{action:"OfficePlugin"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions",{redirect:function(){"crm.settings.section.extensions.ms-extensions"===this.transition.target&&this.transitionTo(JSON.parse(globalSetpJson)[6].Marketplace[0].array[3].array[0].routeName)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.skyeye",{getResources:function(){var e=networkUtils.returnDependencyFiles(["skyeye-integ.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("skyeye")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["skyeye-model.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-skyeye-integ.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["businessinfoservice-min.css"],ResourceConstants.CRM);return e.concat(t).concat(r).concat(s).concat(n)},model:function(e){var t=this.transition.data;return t.skyeyeError=!1,t.skyeyeErrorMsg=I18n.getMsg("crm.skyeye.setup.msg.error"),Lyte.resolvePromises({skyeye:store.findAll("skyeye").catch((function(e){var r=JSON.parse(e.response);"NO_PERMISSION"===r.code?t.skyeyeErrorMsg=I18n.getMsg("crm.zti.error.notauthendication"):"FEATURE_NOT_SUPPORTED"===r.code&&(t.skyeyeErrorMsg=I18n.getMsg("crm.zes.mobile.error.feature")),t.skyeyeError=!0})),skyeye_conf:store.findAll("skyeye_conf").catch((function(e){var r=JSON.parse(e.response);"NO_PERMISSION"===r.code?t.skyeyeErrorMsg=I18n.getMsg("crm.zti.error.notauthendication"):"FEATURE_NOT_SUPPORTED"===r.code&&(t.skyeyeErrorMsg=I18n.getMsg("crm.zes.mobile.error.feature")),t.skyeyeError=!0})),accounts_fields:store.findAll("field",{module:"Accounts"}).catch((function(e){"INVALID_MODULE"===JSON.parse(e.response).code&&(t.skyeyeErrorMsg=I18n.getMsg("crm.label.creator.noPermission")),t.skyeyeError=!0}))})},afterModel:function(){this.transition.data.skyeyeError&&crmui.showMsgBand("error",this.transition.data.skyeyeErrorMsg,1e4)},renderTemplate:function(){if(!this.transition.data.skyeyeError)return{outlet:"#result",component:"skyeye-component",reRender:!0}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-admin-settings.index-permissions",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.js","crm-social-setup-all-brands.js","crm-social-helper.js","crm-social-add-profile.js","crm-social-setup-models.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.css","crm-social-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);if(Crm.userDetails.RTL_ENABLED)var r=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings-rtl.css"],ResourceConstants.CRMClient),s=e.concat(t).concat(r);else s=e.concat(t);return s},model:function(e){store.unloadAll("crm-social-account-user");var t=store.findAll("crm-social-admin-profile"),r=store.findAll("crm-social-account-user");return Lyte.resolvePromises({adminProfiles:t,personalAccounts:r})},afterModel:function(e,t){var r=e.adminProfiles,s={},n=!1,i=!1,o=!1,a={};void 0!==r&&r.length>0&&r.forEach((function(e){void 0!==e.id&&(s[e.id]=e,e.social_integ||e.lite_profile||(n=!0),e.social_tab||(i=!0),e.social_admin||"Standard"===e.name||e.lite_profile||(o=!0))})),$.each(e.adminProfiles.$.meta,(function(e,t){t.permissions&&(a=t.permissions)})),this.currentModel.profiles=s,this.currentModel.more_integ=n,this.currentModel.more_tab=i,this.currentModel.more_admin=o,this.currentModel.permissions=a,delete this.currentModel.adminProfiles,$L("#zso_setupLoading").hide()},renderTemplate:function(){return{outlet:"#kso_adminPermissions",component:"crm-social-admin-perm-inner"}},afterRender:function(e,t,r){thirdPartyUtils.titleForEllipsis(".profPer");var s={},n={};e.personalAccounts.forEach((function(e){void 0!==e.info.id&&(e.info.id&&e.info.current_user_id&&e.info.id===e.info.current_user_id&&(e.personal=!0),n[e.info.id]=e)})),objectUtils.getLength(n)>0&&(s.personal=n),Lyte.Component.render("crm-social-admin-personal-inner",s,"#persHandles")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-admin-settings",{getResources:function(){var e,t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.js","crm-social.js","crm-social-helper.js","crm-social-setup-lead-gen.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);if(Crm.userDetails.RTL_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings-rtl.css"],ResourceConstants.CRMClient);e=r.concat(s).concat(n)}else e=r.concat(s);return e=t.concat(e)},renderTemplate:function(e){return{outlet:"#result",component:"crm-social-admin-outer"}},afterRender:function(e,t){var r=$L("#setupInnerLinks"),s=renderingUtils.windowHeight-(r.offset().top+r.outerHeight()+28);$("#result").removeClass("crmEmailConfigDiv"),$L("#kso_adminSettings").css("height",s)},redirect:function(){"crm.settings.section.extensions.social-extensions.social-admin-settings"===this.transition.target&&this.replaceWith("crm.settings.section.extensions.social-extensions.social-admin-settings.index-permissions")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-brands.index-brands",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-social-setup-all-brands.js","crm-social-helper.js","crm-social-setup-lead-gen.js","assignment-rules-model-wrapper.js","crm-social.js","delete-popup.js","crm-social-setup-models.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-social-setup.css"],ResourceConstants.CRMClient),r=[RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],s=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL")],n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM);if(Crm.userDetails.RTL_ENABLED)var i=networkUtils.returnDependencyFiles(["crm-social-setup-rtl.css"],ResourceConstants.CRMClient),o=e.concat(t).concat(i).concat(s).concat(r);else o=e.concat(t).concat(s).concat(r);return o=n.concat(o)},model:function(e){return store.findAll("crm_social_brand",{isSetup:!0})},afterModel:function(e,t){var r={brands:[]},s=Lyte.registeredMixins["crm-social-setup"];$.each(e,(function(e,t){r.brands.push(t)})),$.each(e.$.meta,(function(e,t){r[e]=t})),s.getAllBrandsRequestCallback(e,t)},actions:{onError:function(e){var t=e.responseJSON?e.responseJSON:e.response?JSON.parse(e.response):e;return"SOCIAL_PERMISSION_DENIED"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.creator.error.access"),3e3),"INTERNAL_ERROR"===t.code&&crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3),!1}}},{mixins:["crm-social-setup"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-brands",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-social-setup-models.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-social-setup-all-brands.js","crm-social-add-profile.js","crm-social.js","crm-social-setup-admin-settings.js","crm-social-add-profile.js","crm-social-helper.js","delete-popup.js","crm-social-setup-models.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-social-setup.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)var s=networkUtils.returnDependencyFiles(["crm-social-setup-rtl.css"],ResourceConstants.CRMClient),n=t.concat(r).concat(s).concat(e);else n=t.concat(r).concat(e);return n},renderTemplate:function(e){return{outlet:"#result",component:"crm-social-setup"}},afterRender:function(e,t){var r=$("#setupInnerLinks"),s=r.outerHeight()<=10?70:r.outerHeight(),n=renderingUtils.windowHeight-(r.offset().top+s+28);$L("#result").removeClass("crmEmailConfigDiv"),$L("#zso_setup").css("height",n)},redirect:function(){"crm.settings.section.extensions.social-extensions.social-brands"===this.transition.target&&this.replaceWith("crm.settings.section.extensions.social-extensions.social-brands.index-brands")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-lead-gen",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen.js","crm-social.js","assignment-rule-models.js","crm-social-helper.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM);if(Crm.userDetails.RTL_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen-rtl.css"],ResourceConstants.CRMClient);e=t.concat(r).concat(n)}else e=t.concat(r);return e=s.concat(e)},beforeModel:function(e){Crm.trackSpotLightAction("CRM Social- Leadgen Clicked")},model:function(e){return store.unloadAll("crm_social_workflow"),store.findAll("crm_social_workflow")},afterModel:function(e){var t=e;if(t.$){var r,s=t.$.meta;r=!1===s.networks.twitter&&!1===s.networks.facebook;var n,i={twitter_more:!0,facebook_more:!0,twitter_active:s.networks.twitter,facebook_active:s.networks.facebook,wf_disable:r},o={};if(t.length>0)for(n in t.forEach((function(e){o[e.network]||(o[e.network]=[],i[e.network]={}),o[e.network].push(e)})),o){i=this.processModel(o[n],i,n),this.getDefaultCriteriaForNetwork(n).length<=objectUtils.getLength(o[n])&&(i[n+"_more"]=!1)}if(i.showdisclaimer=Crm.userDetails.isPrivacySettingEnabled,t.workflow_enabled){crmui.showMsgBand("success",I18n.getMsg("crm.nsocial.leadgen.enable.success","Lead"),3e3)}this.currentModel=i}},renderTemplate:function(e,t){return this.error_key?{outlet:"#result",component:"crm-social-workflow-warning"}:{outlet:"#result",component:"crm-social-workflow"}},afterRender:function(e,t){!0!==Crm.userDetails.isStorageLimitReached?$("#result").removeClass("crmEmailConfigDiv"):Crm.showStorageExceedPopup()},actions:{onError:function(e,t,r){return 403!=e.code&&403!=e.status||(this.error_key=!0,t.resume()),!1}}},{mixins:["crm-soc-workflow"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_zsocialsetup.js"],ResourceConstants.CRM)},beforeModel:function(e){this.allowedDynamicParams=["twitter","facebook","google-plus"],this.allowedDynamicParams.contains(this.getDynamicParam())||this.transition.abort()},model:function(e){var t=this.getDynamicParam(),r={action:"get_settings",network:this.allowedDynamicParams.indexOf(t)+1};this.ajaxParams=jQuery.extend(!0,{},r);var s={params:r};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SocialSettings.do","POST",s)},afterModel:function(e,t){this.currentModel=JSON.parse(e)},renderTemplate:function(e,t){return crmSocialSetup.renderSetupPage(e,this.ajaxParams.network)},afterRender:function(e,t){crmSocialSetup.postRender(e,this.ajaxParams.network)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions",{redirect:function(){"crm.settings.section.extensions.social-extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.social-extensions.social-brands")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.assist",{queryParams:["isZohoAssistEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){if("false"==e.queryParams.isZohoAssistEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"ramya2",nameSpace:"zohoassist1"}});getPluginDetails("zohoassist1","","ramya2","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoAssistEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.backstage",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-backstage-index.js","crm-campaign-integ-error-popup.js","crm-users-thumbnail-view.js","crm-campaign-integ-disable.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-backstage-index.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["crm-campaign-integ-disable.css","crm-users-thumbnail-view.css"],ResourceConstants.CRMClient)),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zbackstagesetup")],ResourceConstants.CRM),s=e.concat(t);return s=s.concat(r)},model:function(){return store.findAll("dummy",{},!1,!1,{url:"/crm/extensions/v4/__internal/backstage/accounts",method:"GET"})},beforeModel:function(){"true"===isSandboxAcc&&(crmui.showMsgBand("error","Backstage Integration is currently not supported in sandbox",4e3),Lyte.Router.replaceWith("crm.settings.index"))},afterModel:function(e){var t={};if(t.integrationEnabled=this.currentModel.integrationEnabled,this.currentModel.integrationEnabled){this.currentModel.isAccountNotEnabled=!1;var r=e.config.crmConfiguration;r&&r.crmModuleConfiguration&&r.crmModuleConfiguration.forEach((function(e){delete e.id,delete e.crmMetaId})),this.currentModel.crmConfiguration=e.config,this.currentModel.portalMembers=e.admins.portalMembers,this.currentModel.userProfiles=e.admins.userProfiles,this.currentModel.selectedPortal=r.portalId,this.currentModel.portalDisplayVal=r.portalName,this.currentModel.getStarted=!1,this.currentModel.isUserHasAccount=!0;var s=e.admins.userProfiles;if(s){for(var n=[],i=s.length,o=0;o<i;o++)n.push(s[o].crm_user_id);this.currentModel.userIds=n}}else this.currentModel.integrationPresent?(this.currentModel.isAccountNotEnabled=!0,t.retainMyData=!0,this.currentModel.enablePage=!0,this.currentModel.selectedPortal=e.portalId):(this.currentModel.isAccountNotEnabled=!0,t.retainMyData=!1,this.currentModel.selectedPortal=e.portalId,this.currentModel.getStarted=!0);Crm.trackSpotLightAction("Backstage Setup visited",t)},renderTemplate:function(){return delete this.component,{outlet:"#result",component:"crm-backstage-index"}},afterRender:function(){if(this.currentModel.enablePage){var e=renderingUtils.windowHeight-($("#setup_new_ContentDiv").offset().top+26);$("#zBSDisablePageOuter").css("height",e+"px")}var t=Handlebars.templates.deleteFieldWarningPopup();($("#result").append(t),this.transition.data&&1==this.transition.data.showDeactivatePopup)&&document.getElementById("zCampIntegDisable").ltProp("show",!0);this.backstageFieldWidthCalculation()},actions:{onError:function(e){return Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),e.responseJSON&&"AUTHORIZATION_FAILED"===e.responseJSON.code?(crmui.showMsgBand("error",I18n.getMsg("crm.backstage.non.portal.user.dynamic",Crm.integrationsAppName.ZOHO_BACKSTAGE),"3000"),!1):e.responseText&&JSON.parse(e.responseText)&&JSON.parse(e.responseText).message?(crmui.showMsgBand("error",JSON.parse(e.responseText).message,"3000"),!1):void 0}}},{mixins:["crm-integration-common-mixin","crm-backstage-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.bookings",{queryParams:["isZohoBookingsEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){var t=RebrandLinkUtil.getProperty("ZOHO_BOOKINGS_IDC_NAMESPACE"),r={portalName:t.split(".")[0],nameSpace:t.split(".")[1]};if("false"==e.queryParams.isZohoBookingsEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:r});getPluginDetails(t.split(".")[1],"",t.split(".")[0],"configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoBookingsEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.campaigns-field-mapping",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-field-mappings.js"],ResourceConstants.CRMClient),t=["crm-campaign-field-mappings.css","crm-campaign-sync-delete.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient);return e.concat(r)},beforeModel:function(){this.campaignIndexUnderLine(this.transition.target),store.unloadAll("layout")},model:function(){for(var e,t=store.peekAll("module"),r=[],s=[],n=t.length,i=["Leads","Contacts"],o=0;o<n;o++)-1!==i.indexOf(t[o].api_name)&&!0===t[o].visible&&t[o].viewable?r.push(t[o]):"custom"===t[o].generated_type&&!0===t[o].visible&&t[o].viewable&&s.push(t[o]);if(r[0])e=r[0].module_name;else{if(!s[0])return{noModules:I18n.getMsg("None"),loading:!1,moduleDropDownDisabled:!0};e=s[0].module_name,this.transition.data.customModuleSelected=!0}this.transition.data.modulesList=r,this.transition.data.customModulesList=s,this.transition.data.selectedModule=e;return Lyte.resolvePromises([store.findAll("layout",{module:this.transition.data.customModuleSelected?this.getAPINameOfModuleName(s,e):e,for_service:"campaign"},!0,!0),networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/mappedfields/"+e,"GET",{})])},afterModel:function(){if(this.transition.data.selectedModule){this.currentModel=this.currentModel[1],this.currentModel.selectedModule=this.transition.data.selectedModule,this.transition.data.modulesList[0]?this.currentModel.customModuleSelected=!1:this.currentModel.customModuleSelected=!0,this.currentModel.modulesList=this.transition.data.modulesList,this.currentModel.customModulesList=this.transition.data.customModulesList;var e=this.currentModel.response.mappedFields;if(this.currentModel.mappedFieldsResponse=e,this.currentModel.response.mappedFields.length){this.currentModel.emptyFieldsResponse=!1,this.currentModel.lastKey=e.length-1,this.currentModel.isEmailField=this.currentModel.response.isEmailField;var t=this.getMappedFieldIds(e);this.currentModel.allMappedCrmFieldsIds=t.allMappedCrmFieldsIds,this.currentModel.allMappedCampFieldsIds=t.allMappedCampFieldsIds,this.checkPersonalFldsAndAddKey(this.currentModel.response.mappedFields)}else this.currentModel.emptyFieldsResponse=!0;this.currentModel.loading=!1,this.currentModel.addNew=!1,this.currentModel.crmFields=null}},renderTemplate:function(){return this.indexHideAndShow("show"),{outlet:"#campaignsResult",component:"crm-campaign-field-mapping"}},actions:{willTransition:function(e){validationUtils.isEmpty(document.querySelector("crm-campaign-edit-field"))||(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.crm-to-campaign-settings",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-to-campaign-settings.js"],ResourceConstants.CRMClient),t=["crm-to-campaign-settings.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient);return e.concat(r)},beforeModel:function(){this.campaignIndexUnderLine(this.transition.target)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/settings","GET",{})},afterModel:function(e){this.currentModel=e.response,this.currentModel.oldData=Object.assign({},e.response)},renderTemplate:function(){return this.indexHideAndShow("show"),{outlet:"#campaignsResult",component:"crm-campaign-to-crm-settings"}},actions:{willTransition:function(e){Lyte.triggerEvent("checkAnyUnsavedChanges"),Lyte.Router.getRouteInstance().transition.data.isUnsavedChanges&&(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.syncs",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-syncs.js","crm-campaign-list-creation-form.js"],ResourceConstants.CRMClient),t=["crm-campaign-syncs.css","crm-campaign-list-creation-form.css","crm-campaign-sync-delete.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient);return e.concat(r)},beforeModel:function(){store.unloadAll("custom_view"),this.campaignIndexUnderLine(this.transition.target)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/syncdetails?page=1","GET",{})},afterModel:function(e){this.currentModel=void 0!==e.response?e.response:e},renderTemplate:function(){return this.currentModel.syncDetail=!1,this.currentModel.newSync=!1,this.currentModel.syncListId=0,this.currentModel.emptySyncList=!1,this.currentModel.totalSyncs=validationUtils.isEmpty(this.currentModel.totalSyncs)?"0":this.currentModel.totalSyncs,{outlet:"#campaignsResult",component:"crm-campaign-sync-lists",reRender:!0}},actions:{willTransition:function(e){Lyte.triggerEvent("checkAnyUnsavedChanges"),Lyte.Router.getRouteInstance().transition.data.isUnsavedChanges&&(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)},didTransition:function(){Lyte.triggerEvent("setBtnDisabledToFalse")}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-campaign-setup-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-index.js","crm-confirm-changes-popup.js","crm-campaign-integ-disable.js"],ResourceConstants.CRMClient),t=["crm-campaign-index.css","crm-setup-campaign-index.css","crm-campaign-integ-disable.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zcampaignsetup")],ResourceConstants.CRM),n=e.concat(r);return n=n.concat(s)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/accounts","GET",{})},beforeModel:function(){"true"===isSandboxAcc&&(crmui.showMsgBand("error","Campaigns Integration is currently not supported in sandbox",4e3),Lyte.Router.replaceWith("crm.settings.index"))},afterModel:function(e){if(this.currentModel=e.response,this.campaignsErrorHandling(e.code)){var t={};t.responseJSON=e,this.actions.onError(t,this),this.transition.abort()}},renderTemplate:function(e){if(e){var t={};return t.consentEnabled=this.currentModel.consentEnabled,t.hourSchedule=this.currentModel.hourSchedule,t.pickListAllowed=this.currentModel.pickListAllowed,t.potentialSync=this.currentModel.potentialSync,t.timeZones=this.deDuplicateTimeZones(this.currentModel.timeZones),t.instantSyncAllowed=this.currentModel.instantSyncAllowed,t.issTicketId=this.currentModel.issTicketId,t.portalname=this.currentModel.portalname,t.version=this.currentModel.version,t.version>0&&(t.integrationId=this.currentModel.integrationId,t.syncCreationAllowed=this.currentModel.syncCreationAllowed),this.metaData=t,{outlet:"#result",component:"crm-campaign-index"}}return{outlet:"#result",component:"crm-campaign-create-account"}},afterRender:function(e,t,r){e?(r.setData("metaData",this.metaData),this.fixIndexBar(),"crm.settings.section.extensions.zoho-extensions.campaigns"===this.transition.target&&Lyte.Router.replaceWith("crm.settings.section.extensions.zoho-extensions.campaigns.syncs")):"crm.settings.section.extensions.zoho-extensions.campaigns.syncs"!==this.transition.target&&"crm.settings.section.extensions.zoho-extensions.campaigns.campaigns-field-mapping"!==this.transition.target&&"crm.settings.section.extensions.zoho-extensions.campaigns.crm-to-campaign-settings"!==this.transition.target||Lyte.Router.replaceWith("crm.settings.section.extensions.zoho-extensions.campaigns");var s=Handlebars.templates.deleteFieldWarningPopup();$("#result").append(s)},beforeExit:function(){$("#setup_new_ContentDiv").css("overflow","")},actions:{onError:function(e,t){return Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),this.apiErrorHandling?this.apiErrorHandling(e):t.apiErrorHandling(e)},willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.extensions.zoho-extensions.campaigns")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"))}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.cliq",{},{mixins:["chat-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.contracts",{queryParams:["isZohoContractsEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){if("false"==e.queryParams.isZohoContractsEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"zohoplugin",nameSpace:"zohocontracts"}});getPluginDetails("zohocontracts","","zohoplugin","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoContractsEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.cpq",{getResources:function(){var e=[];return e=(e=(e=networkUtils.returnDependencyFiles(["crm-cpq-plugin-integration.js","org-model.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-cpq-plugin-integration.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-roles-resources.js","cpq-helpers.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-plugininteg-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},getDependencies:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq"),networkUtils.getI18nJSUrl("cpqextension")],ResourceConstants.CRM))},afterModel:function(){Crm.userDetails.IS_SUPER_ADMIN||Crm.userDetails.permissions.Crm_Implied_Manage_Profiles&&Crm.userDetails.permissions.Crm_Implied_View_Quotes&&Crm.userDetails.permissions.Crm_Implied_Manage_CPQ||(renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.label.insufficient.privileges"),void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps")})),this.transition.abort())},renderTemplate:function(){return{outlet:"#result",component:"crm-cpq-integration-setup"}},afterRender:function(){this.initiateSetUpPageConfiguration()},actions:{onError:function(e){var t=e.responseJSON;if(t||(t=JSON.parse(e.response)),t&&"INTERNAL_ERROR"===t.code&&"Cpq Integration not configured"===t.message&&"crm.settings.section.extensions.zoho-extensions.cpq"===this.transition.target){var r="INTERNAL_ERROR"===t.code?I18n.getMsg("error.database.problem"):I18n.getMsg("crm.label.insufficient.privileges");return renderingUtils.displayPermissionDenied(void 0,void 0,r,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps")})),void this.transition.abort()}},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.creator",{getResources:function(){return networkUtils.returnDependencyFiles(["zcreator_app-min.js"],ResourceConstants.CRM)},model:function(e){var t={params:{mode:"creator",creatorAction:"viewCreatorHome"}},r=objectUtils.cloneObject(this.transition.data);delete r.showDeactivatePopup,delete r.backOneLevel,delete r.showDeactivatePopup,delete r.integrationEnabled,delete r.isLoadedinCrmPlus,Object.assign(t.params,r);var s="createCreatorAccount"===t.params.creatorAction?"POST":"GET";return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ZCreatorAction.do",s,t,!0)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.transition.data&&"createCreatorAccount"===this.transition.data.creatorAction&&CrmCreatorCustomAppObj.removeFreezeLayer(),this.transition.data&&1==this.transition.data.showDeactivatePopup&&CustomRelatedListObj.openWarningMessage("deActivateCreator","")},beforeExit:function(){var e=Crm.getCrmBasePath()+"/ZCreatorAction.do",t=networkUtils.getUrlParamKey(e,{mode:"creator",creatorAction:"viewCreatorHome"});app.reqCache&&delete app.reqCache[t]}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.crossorg",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-crossorg.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-integration-crossorg.css"],ResourceConstants.CRMClient);return e.concat(t).concat(r).concat(s)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-crossorg.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],ResourceConstants.CRMClient).concat(e)},beforeModel:function(e){if(!this.transition.data.service_name)switch(e.dynamicParam){case"projects":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.projects"});break;case"survey":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.survey"});break;case"desk":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.desk"});break;case"finance-suite":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.finance-suite"})}},model:function(){var e=this.transition.data,t={};switch(t.email=e.approver_email,e.updateEmailValue&&(t.textboxValue=e.updateEmailValue),t.show=!0,t.integ_name=e.service_name,t.crossorgtitle=e.crossorgtitle,t.integrationHelpLinkUrl=e.integrationHelpLinkUrl,t.portalName=e.approved_portal_name,t.enterEmailShow=!1,t.refreshtokenstatus=e.approval_status,t.integ_name){case"projects":t.crossorg_name="Zoho Projects";break;case"survey":t.crossorg_name="Zoho Survey";break;case"desk":t.crossorg_name="Zoho Desk";break;case"finance-suite":t.crossorg_name="Zoho FinanceSuite"}switch(e.approval_status){case"pending":case"resent":t.waitingForApprovalShow=!0;break;case"approved":t.approvedShow=!0;break;case"rejected":t.rejectedShow=!0;break;case"enterEmail":t.enterEmailShow=!0}return t},renderTemplate:function(){return{outlet:"#result",component:"crm-integration-crossorg"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.desk",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zdesk-intro.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zdeskSetup_templates.js","zdeskSetup-min.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-zdesk-intro.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("desksetuppage")],ResourceConstants.CRM);return t.concat(e).concat(r).concat(s)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js","crm-integration-common-mixin.js"],ResourceConstants.CRMClient)},model:function(e){var t=this.transition.data,r={params:{action:t&&t.action?t.action:"viewDeskIntegrationHome"}};if(!t||"promotab"!=t.from)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/deskIntegration.do","GET",r);$(".setupleftmenutd").hide()},renderTemplate:function(e,t){if("object"==typeof e)return{outlet:"#result",html:Handlebars.templates.zdeskSetup(e)};var r=this.transition.data;return r&&"promotab"==r.from?{outlet:"#result",component:"crm-zdesk-intro"}:{outlet:"#result",html:e}},afterRender:function(e,t,r){var s=this.transition.data;"object"==typeof e?e.crossOrgApprovalAccepted?desk.showPortalInfo():desk.onload(e):s&&"promotab"==s.from?r.component.bindDeskIntro():this.transition.data&&1==this.transition.data.showDeactivatePopup&&crmui.showPopup("deactivatedeskpop")},beforeExit:function(){$(window).off("keyup.deskpromo")}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.finance-create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zfinance-createpage.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-zfinance-createpage.js","crm-zfinance-createpage.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zoho_books")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){return Lyte.resolvePromises({orgDetails:this.initiateRequest("crm/v7/settings/integrations/finance/configuration")})},initiateRequest:function(e){return store.findAll("dummy",{},!1,!1,{url:e})},redirect:function(){var e=this.currentModel.orgDetails;e&&e.configuration&&e.configuration.organizations&&this.transitionTo("crm.settings.section.extensions.zoho-extensions.finance-setup")},renderTemplate:function(){return{outlet:"#result",component:"crm-zfinance-createpage"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.finance-setup",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zfinance-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-zfinance-setup-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles(["crm-zfinance-util.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zoho_books")],ResourceConstants.CRM);return e.concat(t).concat(s).concat(r)},model:function(){return Lyte.resolvePromises({configuration:this.initiateRequest("crm/v7/settings/integrations/finance"),OrgDetails:this.initiateRequest("crm/v7/settings/integrations/finance/configuration")})},initiateRequest:function(e){return store.findAll("dummy",{},!1,!1,{url:e})},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-zfinance-setup"}},actions:{onError:function(e){Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure");var t=JSON.parse(e.response);if(this.currentModel.showSetupButton=!1,t&&t.finance&&t.finance.code&&"FEATURE_NOT_ENABLED"===t.finance.code){var r=this.transition.pause();this.currentModel.featureNotEnabled=!0,r.resume()}else if(t&&t.finance&&t.finance.code&&"NOT_ALLOWED"===t.finance.code){r=this.transition.pause();this.currentModel.featureNotAllowed=!0,t.finance.details&&t.finance.details.reason?this.currentModel.errorMessage=t.finance.details.reason:this.currentModel.errorMessage=t.finance.message,r.resume()}else this.handleError(e)}}},{mixins:["crm-zfinance-util"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.finance-suite",{getResources:function(){var e=networkUtils.returnDependencyFiles(["segmentation-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-zfinance-util.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){return store.findAll("dummy",{},!1,!1,{url:"crm/v7/settings/integrations/finance"})},redirect:function(e){e.finance&&e.finance.integrated_service_name?this.replaceWith("crm.settings.section.extensions.zoho-extensions.finance-view"):this.replaceWith("crm.settings.section.extensions.zoho-extensions.finance-setup")},afterRender:function(){(this.transition.data&&this.transition.data.showDeactivatePopup&&ZInvoice.deactivateZBIntegration("#Warningdiv","books,expense,subscriptions,inventory"),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"),CrmPlusLib.serviceView.afterLoad(this.transition.data.dKey,this.transition.data.dParams))},actions:{onError:function(e){this.handleError(e)}},onError:function(){Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView&&CrmPlusLib.serviceView.showError(this.transition.data.dKey,this.transition.data.dParams)}},{mixins:["crm-lightuser-picker-mixin","crm-zfinance-util"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.finance-view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zfinance-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-zfinance-viewpage.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-zfinance-viewpage.js","crm-zfinance-viewpage.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zoho_books")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["crm-zfinance-util.js"],ResourceConstants.CRMClient);return e.concat(t).concat(r).concat(s).concat(n)},model:function(){return Lyte.resolvePromises({configuration:this.initiateRequest("crm/v7/settings/integrations/finance"),showFinanceMigrateData:this.initiateRequest("crm/v7/__internal/settings/integrations/finance/migration"),isReEnablingIntegration:this.transition.data.re_enabled})},actions:{onError:function(e){Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),this.handleError(e)}},initiateRequest:function(e){return store.findAll("dummy",{},!1,!1,{url:e})},redirect:function(){var e,t=this.currentModel.configuration;t&&t.finance&&t.finance.integrated_service_name&&(e=t.finance.integrated_service_name),e||this.transitionTo("crm.settings.section.extensions.zoho-extensions.finance-setup")},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-zfinance-viewpage",reRender:"true"}}},{mixins:["crm-zfinance-util"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.forms",{getDependencies:function(){return networkUtils.returnDependencyFiles(["integration/crm-zforms-setup.js"],ResourceConstants.CRMClient)},model:function(){return store.findAll("forms_config")},afterModel:function(e){void 0!==e&&Array.isArray(e)&&(e=e[0]),this.currentModel={forms_config:e}},renderTemplate:function(){return{outlet:"#result",component:"crm-zforms-setup"}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.fsm",{queryParams:["isZohoFSMEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){var t=RebrandLinkUtil.getProperty("ZOHO_FSM_IDC_NAMESPACE"),r={portalName:t.split(".")[0],nameSpace:t.split(".")[1]};if("false"===e.queryParams.isZohoFSMEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:r});getPluginDetails(t.split(".")[1],"",t.split(".")[0],"settingsPage")},renderTemplate:function(e,t){if("false"===t.queryParams.isZohoFSMEnabled)return $L("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.leadchain",{queryParams:["isLeadChainEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){var t=RebrandLinkUtil.getProperty("LEADCHAIN_IDC_NAMESPACE"),r={portalName:t.split(".")[0],nameSpace:t.split(".")[1]};if("false"===e.queryParams.isLeadChainEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:r});getPluginDetails(t.split(".")[1],"",t.split(".")[0],"configure")},renderTemplate:function(e,t){if("false"===t.queryParams.isLeadChainEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.lens",{queryParams:["isZohoLensEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){if("false"==e.queryParams.isZohoLensEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"lens",nameSpace:"lens"}});getPluginDetails("lens","","lens","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoLensEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.meeting",{getResources:function(){var e=networkUtils.returnDependencyFiles(["online-meeting.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["online-meeting-market.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MeetingIntegration")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do","POST",{params:{type:"showMeetingPage",toolName:"ZohoMeeting"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},beforeModel:function(e){this.transition.data.integrationEnabled;"C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE&&store.triggerAction("rso_configuration","get_rso_info",{},{},"GET").then((function(e){if(null!=e.remote_sales_office){var t=e.remote_sales_office.length;1===t?"zoho_meeting"===e.remote_sales_office[0].service:2===t&&("zoho_meeting"===e.remote_sales_office[0].service||"zoho_meeting"===e.remote_sales_office[1].service)}})),Crm.trackSpotLightAction("Zoho Meeting Integration - Manage Click")},afterRender:function(){!Crm.userDetails.MEETING_BRIDGE_ENABLED&&this.transition.data&&!0===this.transition.data.showDeactivatePopup&&crmui.showPopup("disablemeetingpopup")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.motivator",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CRMMotivator.do","POST",{params:{mode:"motivator",action:"showInfo"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.pagesense",{queryParams:["isZohoPageSenseEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){var t=RebrandLinkUtil.getProperty("ZOHO_PAGESENSE_IDC_NAMESPACE"),r={portalName:t.split(".")[0],nameSpace:t.split(".")[1]};if("false"==e.queryParams.isZohoPageSenseEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:r});getPluginDetails(t.split(".")[1],"",t.split(".")[0],"configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoPageSenseEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.projects",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-project-setup.js","crux-column-list.js"],ResourceConstants.CRMClient),t=networkUtils.getI18nJSUrl("ProjectsConfigurationKeys");e.push(networkUtils.returnDependencyFiles([t],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["crm-project-setup.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-project-setup-rtl.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crux-column-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return Crm.userDetails.RTL_ENABLED?e.concat(r).concat(n).concat(s).concat(networkUtils.returnDependencyFiles(["zohocrm_projectSetup.js"],ResourceConstants.CRM)):e.concat(r).concat(n).concat(networkUtils.returnDependencyFiles(["zohocrm_projectSetup.js"],ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js","crm-project-setup-datastore.js","crm-integration-common-mixin.js"],ResourceConstants.CRMClient)},model:function(e){var t,r,s,n=this.crossorgresponse;if(n){var i=n.filter((function(e){return"projects"==e.service_name}))[0],o=i.integration_status;"approvalaccepted"===i.approval_status&&(r=i.approved_portal_name,t=i.approved_portal_id,s=i.approver_email)}return store.findAll("projects_configuration",{include_inner_details:"owner.email"}).then((function(e){if(t&&r){"not_configured"===o&&(e.approval_status="approvalaccepted");var n=[{name:r,id:t}];e.info={email:s,is_related_information_hidden:!0,personal_account:Crm.userDetails.PERSONAL_ACCOUNT},e.portals=n}return e}),(function(){renderingUtils.displayPermissionDenied(),this.transition.abort()}))},afterModel:function(){this.transition&&this.transition.data&&this.transition.data.from_marketing_tab&&(this.currentModel={fromMarketplace:"true"})},renderTemplate:function(){return{outlet:"#result",component:"crm-project-setup",reRender:!0}},afterRender:function(e){e.approval_status&&"approvalaccepted"===e.approval_status&&e.portals&&(ProjectSetup.populatePortals(e),ProjectSetup.changePortal(e)),e&&this.transition&&this.transition.data&&this.transition.data.from_marketing_tab&&Crm.trackSpotLightAction("Projects Marketing- Get Started clicked"),this.transition.data&&1==this.transition.data.showDeactivatePopup&&ProjectSetup.showDeactivatePopup()},beforeExit:function(){_cruxUtils.removeCustomAlert()},actions:{onError:function(e,t,r){return Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),ZProjects.onFailureCallBack(e)}},didDestroy:function(){window.drp=null}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information",{afterModel:function(){var e=document.getElementsByTagName("crm-rso-setup")[0].component;"information"!==e.data.tab&&e.setData("tab","information"),this.currentModel={},this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ},renderTemplate:function(){return{outlet:"#rsoInformationComp",component:"crm-rso-info"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office.users",{queryParams:[{service:{refreshModel:!0}}],model:function(){var e=this.transition.info.queryParams.service||"zoho_cliq",t=document.getElementsByTagName("crm-rso-setup")[0].component.data,r={service_users:[],meta:{more_records:!0,total_count:0,page:0,empty:!0}};switch(e){case"zoho_cliq":return t.cliqIntegrationEnabled?store.triggerAction("rso_configuration","get_users",{},{service:e||e},"GET").then(void 0,(function(){return r})):r;case"zoho_meeting":return store.triggerAction("rso_configuration","get_users",{},{service:e||e},"GET").then(void 0,(function(){return r}))}},afterModel:function(e){var t=document.getElementsByTagName("crm-rso-setup")[0].component,r=t.data;"users"!==r.tab&&t.setData("tab","users"),this.currentModel.cliqIntegrationEnabled=r.cliqIntegrationEnabled,this.currentModel.service=this.transition.info.queryParams.service?this.transition.info.queryParams.service:"zoho_cliq";switch(this.currentModel.enabled=r.enabled,this.currentModel.service){case"zoho_cliq":this.currentModel.zcliq_users=e.service_users,this.currentModel.zcliq_users_data=e.service_users.slice(0,13),this.currentModel.zcliq_users_from=13,this.currentModel.zcliq_users_to=this.currentModel.zcliq_users_from+13,this.currentModel.zcliq_users_hasMore=e.meta.more_records,this.currentModel.zcliq_users_count=e.meta.total_count,this.currentModel.zcliq_users_pageno=e.meta.page+1,e.meta.empty&&(this.currentModel.zcliq_users_from=0,this.currentModel.zcliq_users_to=13);break;case"zoho_meeting":this.currentModel.zmeeting_users=e.service_users,this.currentModel.zmeeting_users_data=e.service_users.slice(0,13),this.currentModel.zmeeting_users_from=13,this.currentModel.zmeeting_users_to=this.currentModel.zmeeting_users_from+13,this.currentModel.zmeeting_users_hasMore=e.meta.more_records,this.currentModel.zmeeting_users_count=e.meta.total_count,this.currentModel.zmeeting_users_pageno=e.meta.page+1,e.meta.empty&&(this.currentModel.zmeeting_users_from=0,this.currentModel.zmeeting_users_to=13)}this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ},renderTemplate:function(){return{outlet:"#userManageComp",component:"crm-rso-users"}},redirect:function(){this.currentModel.enabled||this.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office",{getResources:function(){return[networkUtils.returnDependencyFiles(["crm-rso-setup.js"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-rso-setup.css"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],ResourceConstants.CRM),networkUtils.returnDependencyFiles(["chat-setup-store.js"],ResourceConstants.CRMClient)]},model:function(){var e=this.transition.data;return void 0===e||void 0===e.enabled?store.triggerAction("rso_configuration","get_config",{},{},"GET").then(void 0,(function(){return{error:!0}})):e},afterModel:function(e){if(e.error)this.currentModel.error=!0;else{var t=this.transition.data;if(void 0!==t&&void 0!==t.enabled||(e=e.configuration[0]),this.currentModel.trial_days_left=e.trial_status.days_left,this.currentModel.cliqIntegrationEnabled=e.integrated_service_status[0].enabled,this.currentModel.meetingIntegrationEnabled=e.integrated_service_status[1].enabled,this.currentModel.rso_paid=e.addon_subscription_info.paid,this.currentModel.rso_addon_count=e.addon_subscription_info.addon_purchased_count,this.currentModel.payments_profile_type=e.addon_subscription_info.payments_profile_type,this.currentModel.trial_allowed=e.trial_status.allowed,this.currentModel.trial_enabled=e.trial_status.enabled,void 0!==e.trial_status.trialExpired?this.currentModel.trialExpired=e.trial_status.trialExpired:this.currentModel.trialExpired=!1,this.currentModel.meetingIntegrationEnabled&&(this.currentModel.meetingZgid=e.integrated_service_status[1].zgid),this.currentModel.enabled=e.enabled,this.currentModel.integration_allowed=e.integration_allowed,this.currentModel.reasons_for_denial=null!==e.reasons_for_denial?e.reasons_for_denial:[],this.currentModel.existing_user=e.existing_user,this.currentModel.tab=this.transition.info.route.includes("information")?"information":"users",this.currentModel.service=Lyte.Router.getRouteInstance().transition.info.queryParams.service||"zoho_cliq",this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ,this.currentModel.rso_paid&&(this.currentModel.meetingIntegrationEnabled||store.triggerAction("rso_configuration","enable_trial",{remote_sales_office:[{service:"zoho_meeting"}]},{},"POST").then((function(e){"SUCCESS"===(e=e.remote_sales_office[0]).code&&document.getElementsByTagName("crm-rso-setup")[0].component.setData("meetingIntegrationEnabled",!0)})),this.currentModel.cliqIntegrationEnabled||store.triggerAction("rso_configuration","enable_trial",{remote_sales_office:[{service:"zoho_cliq"}]},{},"POST").then((function(e){"SUCCESS"===(e=e.remote_sales_office[0]).code&&document.getElementsByTagName("crm-rso-setup")[0].component.setData("cliqIntegrationEnabled",!0)}))),0!==this.currentModel.reasons_for_denial.length){var r=this.currentModel.reasons_for_denial.length,s=!1;if(!this.currentModel.enabled)for(var n=0;n<r;n++)switch(this.currentModel.reasons_for_denial[n]){case"cliq_org_conflict":case"meeting_org_conflict":case"cliq_paid_plan":case"meeting_paid_plan":s=!0}this.currentModel.conflicts=s,s||e.integration_allowed||(this.currentModel.integration_allowed=!0)}}},renderTemplate:function(){return{outlet:"#result",component:"crm-rso-setup"}},redirect:function(){this.currentModel.error||"C"===Crm.userDetails.LICENSE_TYPE||"Z"===Crm.userDetails.LICENSE_TYPE||"Y"===Crm.userDetails.LICENSE_TYPE?this.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps"):"crm.settings.section.extensions.zoho-extensions.remote-sales-office"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.reports",{redirect:function(){this.replaceWith("crm.settings.section.extensions.zoho-extensions.zanalytics")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.showtime",{getDependencies:function(){return networkUtils.returnDependencyFiles(["showtime-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-showtime-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("remotetoolkit")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){return store.findAll("showtime",!1).then((function(e){return e}),(function(){renderingUtils.displayPermissionDenied(),transition.abort()}))},renderTemplate:function(){return{outlet:"#result",component:"crm-showtime-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.sign",{queryParams:["isZohoSignEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM)},model:function(e){if("false"==e.queryParams.isZohoSignEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"zohoplugin",nameSpace:"zohosign"}});getPluginDetails("zohosign","","zohoplugin","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoSignEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.survey",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-survey-setup.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-survey-setup.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-survey-setup-rtl.css"],ResourceConstants.CRMClient)));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zsurveysetup")],ResourceConstants.CRM);return e=e.concat(t)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crm-survey-setup.js","survey-configuration.js"],ResourceConstants.CRMClient))},afterModel:function(e){var t=this;if(e.survey){if("inactive"===e.survey.status)this.currentModel.createAccount=!1,this.currentModel.getStarted=!1,this.currentModel.portalCreation=!1,this.currentModel.integrated=!1,this.currentModel.enablePage=!0;else if("active"===e.survey.status)return Lyte.resolvePromises({modules:store.triggerAction("survey","modules",void 0,{feature_name:"zoho_survey"})}).then((function(r){t.currentModel.adminEmail=e.survey.email,t.currentModel.portal=e.survey.portal,t.currentModel.selectedmodules=e.survey.modules,t.currentModel.modules=r.modules.modules,t.currentModel.departmentNames=t.currentModel.portal.departments.map((function(e){return e.name})).join(", "),t.currentModel.createAccount=!0,t.currentModel.getStarted=!1,t.currentModel.portalCreation=!1,t.currentModel.userModule=!0,t.currentModel.beforeSave=!1,t.currentModel.saveSurvey=!1,t.currentModel.integrated=!0,t.currentModel.portalName=e.survey.portal.name,t.currentModel.portalId=e.survey.portal.id,t.currentModel.users=e.survey.users,t.currentModel.createNextDiv=!1,t.currentModel.showIntegComponents=!0,t.currentModel.showConfigAnother=!1,t.currentModel.deactivationPage=!1,t.currentModel.reAuthPage=!1,t.currentModel.invalidToken=!1}))}else e.configuration?(this.currentModel.crossOrgFlow=!0,this.currentModel.adminEmail=e.configuration.email,this.currentModel.portals=e.configuration.portals,this.currentModel.modules=e.configuration.modules,this.currentModel.createAccount=!0,this.currentModel.portalCreation=!1,this.currentModel.beforeSave=!0,this.currentModel.showIntegComponents=!1,this.currentModel.getStarted=!1):(this.currentModel.createAccount=!0,this.currentModel.getStarted=!0,this.currentModel.portalCreation=!1,this.currentModel.integrated=!1)},model:function(e){var t=this.crossorgresponse;if(t){var r=t.filter((function(e){return"survey"==e.service_name}))[0];return"approvalaccepted"===r.approval_status&&"not_configured"===r.integration_status?store.triggerAction("survey","get_config",{}):Lyte.resolvePromises({survey:store.findAll("survey")})}return store.findAll("integration_crossorg",{service:"survey"},!1,!0).then((function(e){var t=e.filter((function(e){return"survey"==e.service_name}))[0];return"approvalaccepted"===t.approval_status&&"not_configured"===t.integration_status?store.triggerAction("survey","get_config",{}):Lyte.resolvePromises({survey:store.findAll("survey")})}))},renderTemplate:function(){return{outlet:"#result",component:"crm-survey-setup"}},afterRender:function(){if(this.currentModel.integrated){for(var e=this.currentModel.selectedmodules,t=e.length,r=0;r<t;r++)$L("#tab_"+e[r].id)[0].ltProp("checked",!0);var s=$L("crm-survey-setup")[0].component;s.setData("saveSurvey",!1),s.setData("showIntegComponents",!0)}var n=$L(".zSurveyFields");if(n.length){var i=[],o=n.find(".zSurveyFieldLabel"),a=n.find(".zSurveyFieldVal");o.each((function(){i.push($L(this).width())}));var l=Math.max.apply(null,i);l+=30,o.css("width",l+"px"),a.css("width","calc(100% - "+l+"px)")}},actions:{onError:function(e){if(Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),e.responseText.indexOf("It appears that you don't have a Zoho Survey account")>-1)return ZSurvey.showAccountDeletedError(),!1;var t=JSON.parse(e.response),r=$(".dummy_body");if("PERMISSION_DENIED"===t.code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"),null,null,(()=>{Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.personal-settings"})})),r.hide(),!1;if("SURVEY_ORG_OAUTHMIGRATION_FAILED"===t.code){commonUtils.showHideLoadingDiv();var s={deactivationPage:!0,reAuthPage:!1,getStarted:!1};return"api_access_denied"!==t.details.error&&"no_portal"!==t.details.error||(s.deactivationPage=!0),t.details.re_auth&&(s.reAuthPage=!0),"invalid_authtoken"===t.details.error&&(s.invalidToken=!0),s.portalCreation=!1,Lyte.Component.render("crm-survey-setup",s,"#setup_new_ContentDiv"),void $("#result").hide()}}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.visit",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_visitsetup.js"],ResourceConstants.CRM)},beforeModel:function(){Crm.userDetails.IS_ADMIN||Crm.userDetails.IS_ADMIN_ROLE||(this.transition.abort(),crmui.showMsgBand("error",I18n.getMsg("crm.livedesk.permission.denied",Crm.integrationsAppName.ZOHO_SALESIQ),2e3))},model:function(e){return VisitRoute.fetchIntegDetails("configured")},afterModel:function(){this.transition.data&&this.transition.data.fromTab&&(VisitsConfig.fromVisitsTab=!0)},renderTemplate:function(e,t){return VisitsConfig.renderSettings(e)},afterRender:function(e,t){VisitsConfig.postRenderSettings(),this.transition.data&&1==this.transition.data.showDeactivatePopup&&VisitsConfig.showPopup("deactivate"),VisitsConfig.isEnabledFromZCRM&&(CrmTracking.userPortalsInfo=e.userPortals,CrmTracking.portalsInfo=e.configured,CrmTracking.populateUserPortalsDD(),delete VisitsConfig.isEnabledFromZCRM)},beforeExit:function(){VisitsConfig.clearVariables()},actions:{willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.extensions.zoho-extensions.visit")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"undefined"==typeof ZohoHCAsap||!ZohoHCAsap.Action||void 0===ZohoHCAsap.Action||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"))}}}),VisitRoute={},VisitRoute.fetchIntegDetails=function(e){var t={params:{type:e}};return networkUtils.lyteInitiateRequest("/crm/v2/Visits/portals","GET",t)},Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.webinar",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-webinar-data-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-webinar-index.js","crm-campaign-integ-error-popup.js","crm-confirm-changes-popup.js","crm-users-thumbnail-view.js","crux-video.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-webinar-common.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-webinar-index.css","crm-users-thumbnail-view.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-webinar-common.css"],ResourceConstants.CRMClient),i=e.concat(t.concat(r.concat(s.concat(n))));return Crm.userDetails.RTL_ENABLED&&(i=i.concat(networkUtils.returnDependencyFiles(["crm-webinar-index-rtl.css"],ResourceConstants.CRMClient))),i},model:function(e){return store.findAll("webinar")},afterModel:function(e,t){e&&e[0]&&(this.currentModel=e={webinar:e[0]},e.webinar.org&&"Free"===e.webinar.org.licence?(e.webinar.popUpfrom="settings",Lyte.Component.render("crm-webinar-trial-expiry-modal",e.webinar,"#show"),Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),this.transition.abort()):e.webinar.access_denied?(Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),crmui.showMsgBand("error",I18n.getMsg("zwebinar.setup.not.authorized",Crm.partnerName),"5000"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),this.transition.abort()):e.webinar.non_member&&(Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),crmui.showMsgBand("error",I18n.getMsg("zwebinar.setup.member.webinar.org.unavailable.error.dynamic",Crm.integrationsAppName.ZOHO_WEBINAR),"5000"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),this.transition.abort()))},renderTemplate:function(e,t){return this.currentModel={webinarData:e.webinar},Crm.trackSpotLightAction("Zoho Webinar - Setup Page Access",{integrationStatus:!e.webinar.integration_disabled}),{outlet:"#result",component:"crm-webinar-setup-config"}},afterRender:function(e,t){this.transition.data&&this.transition.data.enableCallback&&this.component.setData({showVideo:!0}),this.transition.data&&1==this.transition.data.showDeactivatePopup&&(this.component.setData({showDeactivatePopup:!0}),Crm.trackSpotLightAction("Zoho Webinar - Deactivate Click",{fromExtension:!0}))},actions:{onError:function(e,t,r,s){Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure");var n=JSON.parse(e.responseText);return"AUTHORIZATION_FAILED"===n.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"),null,null,(()=>{Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.personal-settings"})})):crmui.showMsgBand("error",n.message,"3000"),!1},willTransition:function(e){var t=this.component;t&&t.getData("settingsModified")&&(t.setData({transitionObject:e,showConfirmChangesPop:!0}),e.pause())}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.workdrive",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zworkdrive-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zworkdrive-setup.css"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/workdrive/setup/config","GET",{})},afterModel:function(e){this.currentModel={workdriveSetupConfig:e.data}},renderTemplate:function(){return{outlet:"#result",component:"crm-workdrive-integration-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.writer",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MailMerge.do","POST",{params:{mode:"writer",action:"writerIntro"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.zanalytics",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zanalytics-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_zreports.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["zanalytics.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zanalyticsintegration")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["zanalytics.js","lyte-tree.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["lyte-tree.js"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED){var i=networkUtils.returnDependencyFiles(["zanalytics-rtl.css"],ResourceConstants.CRMClient);return e.concat(t).concat(i).concat(s).concat(n).concat(r)}return e.concat(t).concat(s).concat(n).concat(r)},model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("zanalytics",{},!1,!1,{configuration:!1})},afterModel:function(e){commonUtils.showHideLoadingDiv(!1),this.currentModel=void 0!==e?{zanalytics:e.zanalytics[0]}:{zanalytics:{}}},renderTemplate:function(){return{outlet:"#result",component:"crm-zanalytics-integ"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.transition.data&&!0===this.transition.data.showDeactivatePopup&&$("crm-zanalytics-integ")[0].component.setData("deactivateAlert",!0)},actions:{onError:function(e){if(200!==e.status){try{const t=JSON.parse(e.response);if(Lyte.triggerEvent("initializeUnifiedIntegrationFrame"),Lyte.triggerEvent("notifyIntegrationSetupFailure"),Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps").refresh=!0,t)switch(t.code){case"UNCONFIRMED_EMAIL":crmui.showMsgBand("error",I18n.getMsg("workflow.wfDeluge.failures.unConfirmedEmail"),3e3);break;case"FEATURE_NOT_AVAILABLE":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3);break;case"NO_PERMISSION":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3);break;case"CONNECTION_LIMIT_EXCEEDED":_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zanalytics.basicplan.integ.restricted"),ltPropSecondaryMessage:I18n.getMsg("crm.zanalytics.basicplan.newinteg.connlimitexceeded",Crm.integrationsAppName.ZOHO_ANALYTICS),ltPropButtons:[{type:"reject",text:I18n.getMsg("Close")}],ltPropButtonPosition:"right",ltPropContentAlign:"left",ltPropShowCloseButton:"false",ltPropWrapperClass:"cxAlignLeft"}});break;default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}else crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}catch(t){return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3),murphy.error(e),!1}return!1}}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.zoho-apps",{model:function(e){return Lyte.resolvePromises([networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowAppsAndAddons.do","GET",{params:{view:"1"}})])},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-common-mixin.js"],ResourceConstants.CRMClient)},renderTemplate:function(e,t){var r="#result";return 0===$L("#result").length&&(r="#show"),{outlet:r,html:e[0]}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.zoho.apps",[Crm.partnerName]),Crm.partnerName])),$L("crm-profile-menu")[0].component.actions.showOnboardingSetupPopupFromHomePage(),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_ZOHO_INTEG").PF_ACCESSED_ZOHO_INTEG,RebrandLinkUtil.getProperties("PF_ACCESSED_ZOHO_INTEG_ID").PF_ACCESSED_ZOHO_INTEG_ID)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions",{getResources:function(){return[networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("remotetoolkit")],ResourceConstants.CRM),networkUtils.returnDependencyFiles(["crm-integration-common-mixin.js"],ResourceConstants.CRMClient),[RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL")]]},redirect:function(){"crm.settings.section.extensions.zoho-extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps")}}),Lyte.Router.registerRoute("crm.settings.section.extensions",{getDependencies:function(){var e=[];return crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient))),featuresAvailable.NEXTGENUI_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"],ResourceConstants.CRM))),e},model:function(){var e=[];return crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&(Crm.userDetails.permissions.Crm_Implied_Manage_ABM?e.push(store.findAll("orchestration_process",{category:"abm"})):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&e.push(store.findAll("orchestration_process"))),Promise.all(this.simulatePromiseAllSettled(e))},redirect:function(){if("crm.settings.section.extensions"===this.transition.target)if(featuresAvailable.NEXTGENUI_ENABLED){var e=document.querySelector("crm-left-menu");e&&e.component&&e.component.methods.renderMarketplace(!0)}else this.transitionTo("crm.settings.section.extensions.all-extensions")},simulatePromiseAllSettled:function(e){return e.map((e=>e.then((e=>({successResponse:e,status:"fulfilled"})),(e=>({errorResponse:e,status:"rejected"})))))}}),Lyte.Router.registerRoute("crm.settings.section.fiscal-year.edit",{lyteConvertionSupported:!0,beforeModel:function(){fiscalCustomPeriodsEnabled&&Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){var e,t=store.peekAll("fiscal_year")[0],r=t.start_date;null!==r?e=$L.moment(r,"YYYY-MM-DD").getDObj().getDate():e=1;return{isCustomFY:"custom"===t.calendar_type,startDate:t.start_date,start_month:null!==t.start_month?t.start_month:"JANUARY",fiscalFormat:null!==t.structure?t.structure:"4-4-5",customSelectedStartDay:e,customSelectedStartMonth:null!==t.start_date?t.start_month:"JANUARY",displayOptionSelected:t.display_based_on,isEndMonthSelected:"end_month"===t.display_based_on,numberByOptionSelected:t.interval_display_option,surplusOption:t.surplus_week}},actions:{willTransition:function(e){var t=$("#fiscalYrOverallSave")[0],r=$L("crm-fiscal-year-manage")[0].component.getData("showSaveConfmPopup");t&&(!t.ltProp("disabled")&&!r&&(e.pause(),e.unSavedChanges=!0,_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.general.save.changes.header"),ltPropSecondaryMessage:I18n.getMsg("crm.general.save.changes.desc"),ltPropWrapperClass:"deletePresetAlert",ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.stay.here")},{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure"}],ltPropButtonPosition:"right"},accept:function(){e.resume()}})))}},renderTemplate:function(){return{outlet:"#result",component:"crm-fiscal-year-manage",reRender:!0}}}),Lyte.Router.registerRoute("crm.settings.section.fiscal-year.index-fiscal",{model:function(){if(fiscalCustomPeriodsEnabled){var e={};if(Crm.userDetails.IS_ADMIN)e={fiscal_history:store.triggerAction("fiscal_year","history")};var t=store.peekAll("fiscal_year")[0];return t||(e.fiscal_year=store.findAll("fiscal_year")),Lyte.resolvePromises(e).then((function(e){t=t||e.fiscal_year;var r=e.fiscal_history;return{isCustomFiscal:"custom"===t.calendar_type,startMonth:t.start_month,startDate:t.start_date,fiscalFormat:t.structure,fiscalBasedOn:t.display_based_on,numberBy:t.interval_display_option,surplusWeek:t.surplus_week,pastSurplusWeeks:t.past_surplus_weeks,fY_History:r?r.fiscal_history:null}}))}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/EditOrgFiscal.do","GET",{params:{action:"showFiscal"}})},renderTemplate:function(e){var t="Fiscal Year - Viewed",r={};return Crm.trackSpotLightAction(t,r),Crm.client_tracking(t,r),fiscalCustomPeriodsEnabled?{outlet:"#result",component:"crm-fiscal-year-view",reRender:!0}:{outlet:"#result",html:e}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.forecast.fiscalyear"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.fiscal-year",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-fiscal-year-modal.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-fiscal-year.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("fiscalYear")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-fiscal-year.js"],ResourceConstants.CRMClient))},beforeModel:function(){if(fiscalCustomPeriodsEnabled){var e=store.findAll("fiscal_year");return Lyte.resolvePromises(e)}},redirect:function(){"crm.settings.section.fiscal-year"===this.transition.target&&(this.transition.target="crm.settings.section.fiscal-year.index-fiscal",this.replaceWith("crm.settings.section.fiscal-year.index-fiscal"))},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.functions",{getResources:function(){var e,t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["function-common.css"],ResourceConstants.CRMClient),t.concat(e)},redirect:function(){"crm.settings.section.functions"===this.transition.target&&Lyte.Router.transitionTo("crm.settings.section.functions.myFunctions")}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionscredits",{getDependencies:function(){return networkUtils.returnDependencyFiles(["function-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[];e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["custom-function-credits-rtl.css"],ResourceConstants.CRMClient)):networkUtils.returnDependencyFiles(["custom-function-credits.css"],ResourceConstants.CRMClient);var t=networkUtils.returnDependencyFiles(["custom-function-credits.js","crm-functions-mixin.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("functions_credits")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){return Lyte.resolvePromises({creditsDetails:store.triggerAction("function","credits",{request_type:"GET"})})},afterModel:function(e){if(this.currentModel=e.creditsDetails,this.error_key)try{var t=e.responseText,r=JSON.parse(t);("NO_PERMISSION"===r.code||this.error_key||e&&e.functions_paid_credits&&e.functions_paid_credits.status&&"error"===e.functions_paid_credits.status)&&(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.functions_paid_credits&&e.functions_paid_credits.status&&"error"===e.functions_paid_credits.status)&&(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(e){var t={newDashboard:!0};t.superAdmin=Crm.userDetails.IS_SUPER_ADMIN&&"production"===Crm.userDetails.orgEnvType&&!Crm.userDetails.isTrialEnabled&&Crm.userDetails.ISPAID_USER&&Crm.userDetails.FUNCTIONS_NEW_CREDITS_AVAILABLE;var r=!!Crm.userDetails.hasOwnProperty("IS_DEVELOPMENT_SETUP")&&Crm.userDetails.IS_DEVELOPMENT_SETUP;return t.superAdmin||r?(this.currentModel=e.functions_paid_credits,{outlet:"#result",component:"crm-functions-credits-home"}):($(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsdashboard",{queryParams:["period"],getDependencies:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["custom-function-dashboard.js","lyte-dateselect.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["custom-function-dashboard.css","function-common.css"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient))),e.concat(r).concat(t)},getResources:function(){return networkUtils.returnDependencyFiles(networkUtils.includeChartFiles().concat("zohocrm_chart.js"),ResourceConstants.CRM)},model:function(e){var t={skip_load_tab:!0},r=e.queryParams.period;return void 0===r&&(r="past_24_hours"),e.queryParams.period=r,t.isFrom="dashboard",Lyte.resolvePromises({dashboard:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/dashboard?period="+r,"GET",t)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):this.error_key||"NOT_CONFIGURED"==e.dashboard.code?(customFunctionsObj.showErrorMessage(e.dashboard,!1,!0,!0,!0),this.stop_bubble=!0,this.transition.abort(),crmHistory.back()):(this.error_key||e&&e.dashboard&&e.dashboard.status&&"error"==e.dashboard.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}else e.displayTimeZone=e.dashboard.info.timezone},renderTemplate:function(e,t){return networkUtils.initChart(),e.period=customFunctionsObj.getDashboardOptions(t.queryParams.period),{outlet:"#result",component:"crm-functions-dashboard",reRender:!0}},afterRender:function(e,t){customFunctionsObj.selectClass("cf_dashboard");var r={};e.dashboard&&"NOT_CONFIGURED"==e.dashboard.code&&(customFunctionsObj.showErrorMessage(customFunctionsObj.errorCode.NOT_CONFIGURED_ORG.code,!0,!0,!0,!0),crmHistory.back(),this.stop_bubble=!0,this.transition.abort()),r.dashboard=e.dashboard.dashboard[0],r.info=e.dashboard.info,r.period=t.queryParams.period,customFunctionsObj.loadDashboardView(r),!0===e.dashboard.info.isAnnouncementNeeded&&$L("#dreLimitNotifyBar").removeClass("dN").addClass("dB");var s=I18n.getMsg(window.location.origin+Crm.getCrmBasePath()+"/settings/api/usage/graph-view"),n=unescape(I18n.getMsg("crm.api.dashboard.includedrelimit.announcement1",s));$L("#dreNotifyContent")[0].innerHTML="<span>"+n+"</span>"},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},beforeExit:function(){delete customFunctionsObj.isSec1Rendered,delete customFunctionsObj.isSec2Rendered,delete customFunctionsObj.isSec3Rendered,customFunctionsObj.chartData={}}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsfailures",{getDependencies:function(){return networkUtils.returnDependencyFiles(["custom-function-failures-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["custom-function-failure.js","crm-function-logs-failure-mixin.js","crm-functions-helper.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["custom-function-failure.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-function-logs-failures.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["lyte-dateselect.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient);return e.concat(r).concat(t).concat(s).concat(n)},model:function(){var e={language:"deluge",start:1,limit:100,componentType:"all"};return Lyte.resolvePromises({categoryList:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/category","GET",{skip_load_tab:!0}),functionFailures:store.findAll("failures",e)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.functionFailures&&e.functionFailures.status&&"error"==e.functionFailures.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.functionFailures&&e.functionFailures.status&&"error"==e.functionFailures.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}else e.displayTimeZone=e.functionFailures.$.meta.info.timezone},renderTemplate:function(e){return customFunctionsObj.constructCFBodyDiv(),e.functionFailures&&e.functionFailures.length>=100?customFunctionsObj.hasNextFailures=!0:customFunctionsObj.hasNextFailures=!1,{outlet:"#result",component:"crm-function-failureslist",reRender:!0}},afterRender:function(){$(".Function_table").height(renderingUtils.windowHeight-310)},didDestroy:function(){store.unloadAll("failures")},beforeExit:function(){store.unloadAll("failures")}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsgallery",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["custom-function-gallery.js"],ResourceConstants.CRMClient);return(Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["custom-function-gallery.css","function-common-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["custom-function-gallery.css","function-common.css"],ResourceConstants.CRMClient)).concat(r).concat(t).concat(e)},model:function(){var e={type:"gallery",start:1,limit:100};return store.unloadAll("function"),Lyte.resolvePromises({gallery:store.findAll("function",e)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(){return customFunctionsObj.constructCFBodyDiv(),{outlet:"#result",component:"crm-function-gallery"}}}),Lyte.Router.registerRoute("crm.settings.section.functions.myFunctions",{queryParams:["type"],getDependencies:function(){return networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js"],ResourceConstants.CRM))},getResources:function(){var e,t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","crm-function-logs-failure-mixin.js","lyte-hovercard.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["custom-function-editor.js","crm-function-components-wrapper.js","crm-functions-mixin.js","crm-functions-helper.js","lyte-resize.js","reviewprocess.js","crm-function-refer-field.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED?(e=networkUtils.returnDependencyFiles(["custom-function-functionlist.css","crm-ui-loaders-rtl.css","function-common-rtl.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css"],ResourceConstants.CRMClient)):(e=networkUtils.returnDependencyFiles(["custom-function-functionlist.css","crm-ui-loaders.css","function-common.css"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["custom-function-editor.css","function-common.css","crm-reviewprocess-customfunction.css"],ResourceConstants.CRMClient));var i=networkUtils.returnDependencyFiles(["custom-function-failure.js","crm-functions-helper.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["custom-function-failure.css"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["custom-function-functionlog.js","crm-function-logsinfo-tab.js","crm-functions-helper.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["function-common.css"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["crm-function-logs.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles(["custom-function-dashboard.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["custom-function-dashboard.css","function-common.css"],ResourceConstants.CRMClient),m=networkUtils.returnDependencyFiles(["custom-function-failures-model.js","crm-function-logs-model.js"],ResourceConstants.CRMClient),p=networkUtils.returnDependencyFiles(["custom-function-dashboard.js","lyte-dateselect.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient),g=networkUtils.returnDependencyFiles(["highcharts.js","zohocrm_chart.js"],ResourceConstants.CRM);return r.concat(e).concat(t).concat(s).concat(n).concat(a).concat(l).concat(c).concat(u).concat(d).concat(i).concat(o).concat(m).concat(p).concat(g)},model:function(e){var t={type:"org",start:1};return t.limit=customFunctionsObj.limit,e.queryParams&&"deprecated"===e.queryParams.type&&(t.type="deprecated"),store.unloadAll("function"),Lyte.resolvePromises({categoryList:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/category","GET",{skip_load_tab:!0}),functionList:store.findAll("function",t)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.category&&e.category.status&&"error"==e.category.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.category&&e.category.status&&"error"==e.category.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(e){return $("body").append('<div id="createfunctionpopdiv" class="clearfix"></div>'),customFunctionsObj.isFrom="functions","error"==e.categoryList.status&&(crmui.showMsgBand(customFunctionsObj.ERROR,customFunctionsObj.errorCode.UNCONFIRMED_EMAIL.message,customFunctionsObj.ERROR_POPUP_DELAY),Lyte.Router.transitionTo("crm.settings.index")),e.functionList&&e.functionList.length>0&&e.functionList.length>=customFunctionsObj.limit?customFunctionsObj.hasNext=!0:customFunctionsObj.hasNext=!1,customFunctionsObj.fromSource="functions",customFunctionsObj.isCleanUpFuncEnabled=e.categoryList.isCleanUpFuncEnabled,{outlet:"#result",component:"crm-function-mainlist"}},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},afterRender:function(e,t){if(Crm.userDetails.CUSTOMIZE_INFO.API_NEWS_LETTER||($("#setup_new_ContentDiv").addClass("pR"),$(".apiBandStripCont").removeClass("dN")),"deprecated"===t.queryParams.type){var r=networkUtils.returnDependencyFiles(["crm-function-junkfunctions.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-function-junkfunctions.css"],ResourceConstants.CRMClient),n=r.concat(s);Lyte.injectResources([n],void 0,(function(){$(".crm-function-mainlist").empty(),customFunctionsObj.language="deluge",customFunctionsObj.callToDreBasedonPage("deprecated")}))}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),store.unloadAll("function")}}),Lyte.Router.registerRoute("crm.settings.section.game-settings",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-motivator-onboarding.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-motivator-onboarding.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamification")],ResourceConstants.CRM))},model:function(){if(objectUtils.cloneObject(this.transition.data)&&crmSetup.setupObject[this.transition.info.route]&&!crmSetup.setupObject[this.transition.info.route].higherEditionTry){if(-1==="E,A,R,P,C,Z,U".indexOf(Crm.userDetails.LICENSE_TYPE))return void renderingUtils.displayPermissionDenied();document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("game.feature.label",Crm.partnerName),Crm.partnerName])}},renderTemplate:function(e){return{outlet:"#result",component:"crm-motivator-onboarding"}},actions:{willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.game-settings")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"undefined"==typeof ZohoHCAsap||void 0===ZohoHCAsap.Action||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"));var t=$L("#result");t.removeClass("helpOverflowHide"),Crm.userDetails.isMotivatorEarlyAccessGiven&&t.css("height","auto")}}}),Lyte.Router.registerRoute("crm.settings.section.globalpicklists",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-globalfield-list.js","crm-picklist-limit-reached-alert-popup.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-globalfield-list.css","crm-picklist-limit-reached-alert-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("actionlistlabel")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("globalpicklist"),ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["globalfield-models.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){commonUtils.showHideLoadingDiv(!0);return Lyte.resolvePromises({globalSetLimit:store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.2/__features/global_picklists",method:"GET"}),globalFieldList:store.findAll("global_picklist",{include:"used_in_modules,associated_fields_count",include_inner_details:"used_in_modules.plural_label"}).then((function(e){return commonUtils.showHideLoadingDiv(!1),e}))})},afterModel:function(e){var t,r=void 0!==e.globalSetLimit.__features?e.globalSetLimit.__features[0].details.limits.total:0,s=void 0!==e.globalSetLimit.__features?e.globalSetLimit.__features[0].components.filter((e=>"used_option_count"===e.api_name))[0].details.limits.total:0,n=void 0!==e.globalSetLimit.__features?e.globalSetLimit.__features[0].components.filter((e=>"unused_option_count"===e.api_name))[0].details.limits.total:0,i=void 0!==e.globalSetLimit.__features?e.globalSetLimit.__features[0].components.filter((e=>"inc_used_option_count"===e.api_name))[0].details:void 0,o=0;if(i&&i.limits.total>s){var a=e.globalSetLimit.__features[0].components.filter((e=>"large_global_set"===e.api_name))[0].details;a&&(o=a.limits.total),s=i.limits.total}var l=0,c=0;void 0!==e.globalFieldList&&(e.globalFieldList=e.globalFieldList.filter((function(e){return!1!==e.customizable})),l=e.globalFieldList.length,c=e.globalFieldList.filter((function(e){return!1===e.presence})),e.globalFieldList=e.globalFieldList.filter((function(e){return!1!==e.presence})));var u=!0;void 0===e.globalFieldList||e.globalFieldList.length<r?t=!0:(t=!1,u=!1),t&&l>=r&&(u=!1),this.currentModel={globalFieldList:e.globalFieldList,globalpickMaxLimit:r,isCreateSlotAvail:u,deleteInProgress:c,showCreateButton:t,globalpickOptionLimit:s,largeGlobalpickLimit:o,unuseOptionLimit:n}},renderTemplate:function(){return{outlet:"#result",component:"crm-globalfield-list"}},beforeExit:function(){store.unloadAll("predefined_picklist")}}),Lyte.Router.registerRoute("crm.settings.section.groups.create-group",{model:function(e){this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.groups.index-groups")},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.new"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.groups.edit-group",{model:function(e){this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.groups.index-groups")},renderTemplate:function(e,t){return-1!==e.indexOf("EmptyGroup")?{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; margin-left:20px;"><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:var(--redLightColor); font-size:2.6rem;" class="mL15">'+I18n.getMsg("crm.label.group.notavailable")+'</h2><div class="mT5 crm-base-font-size mL15 lh20"></div></div></div>'}:{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.edit"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.groups.index-groups",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-groups-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-groups-list.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm_group/crm_group.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("UserGroup")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Groups||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort()),store.unloadAll("user_group")},model:function(e){return this.transition.data&&this.transition.data.data?this.transition.data.data:Lyte.resolvePromises({user_group:store.findAll("user_group",{include:"sources_count",per_page:"200",page:"1"},!1,!0,{apiVersion:"2.2"}),limit:store.findAll("dummy",void 0,!1,!1,{url:"crm/v6/__features/groups",method:"GET"}),user_group_count:store.findAll("user_group",{},!1,!0,{apiVersion:"2",count_ui:!0})})},afterModel:function(e){var t=1===Crm.userDetails.TMENABLED,r={};if(r.tmEnabled=t,r.serachVal="",e&&e.user_group&&(r.user_groups=Lyte.registeredMixins["crm-groups-groupmixin"].grps_fetchGroup(e.user_group,e.user_group,this,t),r.all_groups=r.user_groups,void 0!==e.user_group.$&&(r.grps_more_records=e.user_group.$.meta.more_records)),this.currentModel=r,e.limit&&e.user_group&&e.user_group_count){var s=e.limit.__features[0].details&&e.limit.__features[0].details.limits?e.limit.__features[0].details.limits.total:void 0;r.isgrpcreallowed=s<=e.user_group_count.length}},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-groups-list"}},afterRender:function(e,t){e.user_groups&&e.user_groups.length>0&&this.set_tableListViewHeight(),this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.groups"),Crm.appName]))}},{mixins:["crm-groups-groupmixin"]}),Lyte.Router.registerRoute("crm.settings.section.groups.view-group",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-groups-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-groups-view.js","crux-user-view.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm_group/crm_group.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("UserGroup")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Groups||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort());var e,t=this,r=this.getDynamicParam(),s=1===Crm.userDetails.TMENABLED;return e={sources_count:{id:r}},Lyte.resolvePromises({groupCount:app.store.makeRequest("triggerAction","user_group","sources_count",e)}).then((function(e){if(!1===$L.isEmptyObject(e.groupCount)){t.transition.data.groupCount=e.groupCount;var r=e.groupCount.sources_count[0].users.active+e.groupCount.sources_count[0].users.deleted+e.groupCount.sources_count[0].users.inactive,n=e.groupCount.sources_count[0].roles,i=e.groupCount.sources_count[0].territories,o=e.groupCount.sources_count[0].groups;t.transition.data.landingTab=0===r&&n>0?"roles":0===r&&0===n&&i>0&&s?"territories":0===r&&0===n&&(0===i||!s)&&o>0?"groups":"users"}}),(()=>{Lyte.Router.transitionTo("crm.settings.section.groups.index-groups")}))},model:function(){if(this.transition.data&&this.transition.data.data)return this.transition.data.data;var e=this.getDynamicParam();switch(this.transition.data.landingTab){case"users":var t;return t={get_assigned:{feature:"group_users",related_entity_id:e,page:1,per_page:200,type:"ActiveUsers",fields:["id","full_name","email","image_link","status"],include_lite_users:!0}},Lyte.resolvePromises({groupDetails:app.store.makeRequest("findRecord","user_group",e,{},!1,!0,{apiVersion:"2.2"}),users:app.store.makeRequest("triggerAction","user","get_assigned",t)});case"roles":var r;return r={sources:{id:e,type:"roles"}},Lyte.resolvePromises({groupDetails:app.store.makeRequest("findRecord","user_group",e,{},!1,!0,{apiVersion:"2.2"}),roles:app.store.makeRequest("triggerAction","user_group","sources",r)});case"territories":var s;return s={sources:{id:e,type:"territories"}},Lyte.resolvePromises({groupDetails:app.store.makeRequest("findRecord","user_group",e,{},!1,!0,{apiVersion:"2.2"}),territories:app.store.makeRequest("triggerAction","user_group","sources",s)});case"groups":var n;return n={get_assigned:{feature:"user_groups",related_entity_id:e,page:1,per_page:200}},Lyte.resolvePromises({groupDetails:app.store.makeRequest("findRecord","user_group",e,{},!1,!0,{apiVersion:"2.2"}),groups:store.triggerAction("user_group","get_assigned",{},"","POST",n)})}},afterModel:function(e){void 0===e&&Lyte.Router.transitionTo("crm.settings.section.groups.index-groups");var t=1===Crm.userDetails.TMENABLED,r={};r.allData=e,r.groupdetails=e.groupDetails[0],r.usergroupid=e.groupDetails[0].id,r.groupname=e.groupDetails[0].name,r.description=e.groupDetails[0].description,r.tmEnabled=t,e.users?(r.grpMemberUsers=e.users.get_assigned,e.users.meta&&(r.mem_users_more_records=e.users.meta.more_records,r.mem_users_page=e.users.meta.page)):(r.mem_users_more_records=!1,r.mem_users_page=1),e.roles&&(r.grpMemberRoles=e.roles.sources),e.territories&&(r.grpMemberTerritories=e.territories.sources,r.terrpage=e.territories.meta.page,r.terr_assigned_more_records=e.territories.meta.more_records),e.groups&&e.groups.user_groups&&(r.grpMemberGroups=this.grps_fetchGroup(e.groups.user_groups,e.groups.user_groups,this,t),r.grps_assigned_more_records=e.groups.meta.more_records,r.grps_assigned_page=e.groups.meta.page+1);var s=this.transition.data.groupCount;r.memUsersCnt=s.sources_count[0].users.active+s.sources_count[0].users.deleted+s.sources_count[0].users.inactive,r.memRolesCnt=s.sources_count[0].roles,r.memTerritoriesCnt=s.sources_count[0].territories,r.memGroupsCnt=s.sources_count[0].groups;var n=s.sources_count[0].users;r.memUserActive=n.active,r.memUserInactive=n.inactive,r.memuserDeleted=n.deleted,0===r.memUsersCnt&&r.memRolesCnt>0?(r.isShowUsersNav=!1,r.isShowRolesNav=!0,r.isShowTerritoriesNav=!1,r.isShowGroupsNav=!1,r.selectedFeature="grps_roles"):0===r.memUsersCnt&&0===r.memRolesCnt&&r.memTerritoriesCnt>0&&t?(r.isShowUsersNav=!1,r.isShowRolesNav=!1,r.isShowTerritoriesNav=!0,r.isShowGroupsNav=!1,r.selectedFeature="grps_territories"):0===r.memUsersCnt&&0===r.memRolesCnt&&(0===r.memTerritoriesCnt||!t)&&r.memGroupsCnt>0?(r.isShowUsersNav=!1,r.isShowRolesNav=!1,r.isShowTerritoriesNav=!1,r.isShowGroupsNav=!0,r.selectedFeature="grps_groups"):(r.isShowUsersNav=!0,r.isShowRolesNav=!1,r.isShowTerritoriesNav=!1,r.isShowGroupsNav=!1,r.selectedFeature="grps_users"),this.currentModel=r},renderTemplate:function(e){return{outlet:"#result",component:"crm-groups-view"}},afterRender:function(){this.grps_setTablHeight(),this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.view"),Crm.appName]))}},{mixins:["crm-groups-groupmixin"]}),Lyte.Router.registerRoute("crm.settings.section.groups",{redirect:function(){"crm.settings.section.groups"===this.transition.target&&this.replaceWith("crm.settings.section.groups.index-groups")}}),Lyte.Router.registerRoute("crm.settings.section.hierarchy-preference",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_forecastTemplate.js"],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("hierarchypreference")],ResourceConstants.CRM)),newForecastsEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Forecasts")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-forecast-hierarchy-pop.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-forecast-hierarchy-pop.css","crm-forecast-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},getDependencies:function(){var e=[];return newForecastsEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-config-store.js"],ResourceConstants.CRMClient))),e},beforeModel:function(e){},model:function(e){var t={action:"hierarchyDetails"},r={params:t};if(newForecastsEnabled&&moduleRecordMapping.Forecasts&&moduleRecordMapping.Forecasts.visible&&moduleRecordMapping.Forecasts.profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name}))){var s={getconfig:store.findAll("forecast_configuration"),roleInfo:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Role.do","GET",r)};return Lyte.resolvePromises(s)}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Role.do","GET",r)},afterModel:function(e,t){e.roleInfo&&(e.isApConfig=e.roleInfo.isApConfig),newForecastsEnabled&&moduleRecordMapping.Forecasts&&moduleRecordMapping.Forecasts.visible&&moduleRecordMapping.Forecasts.viewable?(e.getconfig&&e.getconfig.id?(e.roleInfo.forecast=!0,"Territory"===e.getconfig.hierarchy.api_name?e.roleInfo.isTerritoryForecast=!0:e.roleInfo.isTerritoryForecast=!1):(e.roleInfo.forecast=!1,e.roleInfo.isTerritoryForecast=!0),this.currentModel=e.roleInfo):(e.roleInfo&&(e.isApConfig=e.roleInfo.isApConfig),e.forecast=!1,e.isTerritoryForecast=!0,this.currentModel=e)},redirect:function(){},renderTemplate:function(e,t){renderHierarchyPage(e)},afterRender:function(e,t){},actions:{willTransition:function(){},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("crm.settings.section.holidays",{beforeModel:function(){"Administrator"!==Crm.userDetails.PROFILE_NAME&&(this.transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){crmHistory.back()})))},getDependencies:function(){return networkUtils.returnDependencyFiles(["holidays-model.js","shift_hours_model.js","business_hours-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["businessHoursCommon.js","businessHoursmixin.js","crm-detail-view-services.js","services-businesshours.js","crmbusinesshourswrapper.js","holidays-model.js","crux-user-view.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-rtl.css","crux-user-view.css"],ResourceConstants.CRMClient))),(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-shift.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper.css","crux-user-view.css"],ResourceConstants.CRMClient))},model:function(){return store.unloadAll("holidays"),store.unloadAll("shift_hours"),Lyte.resolvePromises({holidays:store.findAll("holidays"),shift_hours:store.findAll("shift_hours"),business_hours:store.findAll("business_hours")})},afterModel:function(e,t){if(e.holidays&&"NO_PERMISSION"===e.holidays.code)return e.permissionDenied=!0,void renderingUtils.displayPermissionDenied();e.holidays&&e.holidays[0]&&e.holidays.hasOwnProperty("$")&&(e.holidaysInfo=e.holidays.$.meta);var r=Lyte.registeredMixins["business-hours-utils"];void 0!==t.dynamicParam?t.dynamicParam.year:t.dynamicParam;if(e.holidays[0])e.holidays;else{var s={};!e.shift_hours||$u.isEmpty(e.shift_hours)?(s.isBusinessHoliday=!0,s.button={show:!0,valueYear:(new Date).getFullYear()}):(s.isBusinessHoliday=!1,s.button={show:!0}),e.holidays=s}if(e.holidaysInfo&&e.holidaysInfo.created_years&&e.holidaysInfo.created_years[0]&&(e.fetchedYears=[e.holidaysInfo.created_years.sort()[0]+""]),e.yearDisplayCount=1,e.alreadyCreatedIds=r.getAlreadyCreatedIds({},e.holidays),e.allCreatedYears=r.getAllCreatedYears(e.alreadyCreatedIds,e.shift_hours),e.holidays=r.showCurrentYear(e.holidays,e.holidaysInfo),e.holidaysInfo&&e.holidaysInfo.created_years){r.setShiftIndex(e.holidays,e.holidaysInfo.created_years.sort()[0]),r.setIsShiftHolidaysFirst(e.holidays),e.holidays.length>25&&(e.tempHolidays={},e.tempHolidays[e.holidays[0].year]=e.holidays.slice(25),e.holidays=e.holidays.slice(0,25));var n=r.getAvailableYear(),i=r.diffTwoArrays(n,e.allCreatedYears);e.disableHolidayCreateButton=!(i.length>0),e.fetchedYears=[e.holidays[0].year+""]}},renderTemplate:function(e){if(!e.permissionDenied)return{outlet:"#result",component:"crm-holidays-tab",reRender:!0}},afterRender:function(e){if(!e.permissionDenied&&(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.holidays"),Crm.partnerName])),Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.is24HrsFrmt=Lyte.registeredMixins["business-hours-utils"].checkUserTimeFormatis24hrs(),e.holidaysInfo&&e.holidaysInfo.created_years)){var t=e.holidaysInfo.created_years;if(e.holidaysInfo.created_years.length>1)try{if(this.transition.info.queryParams&&this.transition.info.queryParams.year){var r=0,s=this.transition.info.queryParams.year;t.contains(s)&&(t.forEach((function(e,t){e+""===s&&(r=t)})),document.getElementById("holidayTabId").openTab("holidaysTab_"+r))}else-1!==t.indexOf(parseInt(this.transition.data.year))?document.getElementById("holidayTabId").openTab("holidaysTab_"+t.indexOf(parseInt(this.transition.data.year))):document.getElementById("holidayTabId").openTab("holidaysTab_0")}catch(e){document.getElementById("holidayTabId").openTab("holidaysTab_0")}else{var n=document.getElementById("holidayTabId");n&&n.openTab("holidaysTab_0")}}},beforeExit:function(){store.unloadAll("holidays"),store.unloadAll("shift_hours")}}),Lyte.Router.registerRoute("crm.settings.section.home-customization.index-home-customization",{getResources:function(){if("undefined"==typeof CustomHomePage){var e=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-home-customization.js","crm-analytical-component-model.js","crm-analytics-chart-table.js","crm-report-util.js","lyte-hovercard.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customizeHomePage")],ResourceConstants.CRM);return e.concat(r).concat(t).concat(n).concat(s)}},model:function(e){if(featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").show(),this.transition.cachedResponse)return this.transition.cachedResponse;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",{params:{action:"customHomePageList"}})},renderTemplate:function(e,t){crmSetup.renderHomepageSetupResponse("customHomePageList",e)},afterRender:function(){$(".setupleftmenutd,#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow")}}),Lyte.Router.registerRoute("crm.settings.section.home-customization",{redirect:function(){"crm.settings.section.home-customization"===this.transition.target&&this.replaceWith("crm.settings.section.home-customization.index-home-customization")},actions:{onError:function(e){var t="noRolesForHome"!==e.responseText?e.responseText:'<div class="darkMainHead"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="crm-small-font-size crm-font-regular"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",r=this;return renderingUtils.showCustomAlert(t,void 0,!0,(function(){r.transitionTo("crm.settings.section.home-customization.index-home-customization")})),!1}}}),Lyte.Router.registerRoute("crm.settings.section.import-history",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["zohocrm_import.css"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["import-view-upload-history.js"],ResourceConstants.CRMClient);return e.concat(t).concat(r)},model:function(e){var t=e.queryParams,r={};return r.params=null==t?{actionName:"showHistory",pageTitle:"crm.import.history",isNew:!0}:{actionName:"showHistory"},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ImportHistory.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.index-email-parser",{queryParams:["action"],model:function(){var e=store.peekAll("email_parser");if(0!==e.length)return e[0];return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:{action:"emailParser"}}).then((function(e){return e})).then((function(e){return e&&e.tour_disabled&&(mailparser.showTour=!1),e&&e.switch_option&&(mailparser.showSwitch=!0),e&&e.parser_rules_limit&&(mailparser.activeRulesLimit=e.active_parser_rules_limit,mailparser.rulesLimit=e.parser_rules_limit,mailparser.approvedEmailsLimit=e.approved_emails_limit),e&&e.new_parser_enabled?(e.ruleId&&(mailparser.ruleId=e.ruleId,mailparser.redirectToDetailView=!0),store.findAll("email_parser",{},!1).then((function(e){return e[0]}),(function(e){if("FEATURE_NOT_ENABLED"===e.code)return e}))):e}))},renderTemplate:function(e){if(!e||1!==e.version)return{outlet:"#result",component:"email-parser"};mailparser.createParserRule(e)},afterRender:function(e,t,r){if($("#result").removeClass("crmEmailConfigDiv"),$L("#ePTemplateTableDiv").css("display","none"),$L("#ePEmailTableDiv").css("display","none"),$L("#ePEmailPopDiv").css("display","none"),$L("#ePEmailTab").css("display","none"),$L("#ePEmailTemplate").css("display","none"),store.unloadAll("received_mail"),commonUtils.showHideLoadingDiv(!0),e&&e.email)if((n=r.component).setData({selectionCount:0,showEmailsList:!1}),e.allowed_emails){commonUtils.showHideLoadingDiv(!0),n.setData("showTabs",!0);var s=t.queryParams.action,n=r.component,i=document.getElementById("ePTabs");if("email"===s){var o=Lyte.Router.getRouteInstance(),a=o.getQueryParams();if(!a||!a.action)return void o.setQueryParams("action","email");commonUtils.showHideLoadingDiv(!0),i.openTab("ePEmailTab"),this.hideAllOpenMenus();var l=$L("#ePEmailTableComponent");0!==l.length&&this.getParserRules().then((function(e){if(e){var t=l.eq(0).get(0).component;0===e.length&&t.setData({popupPageCreate:!0,popup:!0,noRulesFound:!0}),t.updateCreateRuleButtonState(e,!0),t.setData({more_records:!0,partialSelect:!1,selectAll:!1}),store.unloadAll("received_mail"),t.resetEmailTable(!1,void 0,"",!0),n.setData({noRulesFound:0===e.length}),n.methods.setParserRuleNameFilterData(e)}else n.setData({noRulesFound:!0});commonUtils.showHideLoadingDiv(!1)}))}else i.openTab("ePEmailTemplate"),this.hideAllOpenMenus(),commonUtils.showHideLoadingDiv(!0),this.resetTemplateTable();n.setData("emailTabSelected","email"===s),n.removeSortableFromTable()}else n.setData("configureFromAddressPage",!0);$("#ePTabs").addClass("eventNone")},actions:{willTransition:function(e){$L("crm-email-parser-create-rule").length>0&&(e.abort(),$L("#setupshow").show(),$L(".nextGenUILeftMenu").show(),$("#emailparserpopdiv").html(""));var t=$L("#ePEmailChbxAll");t.length>0&&t[0].ltProp("checked",!1);var r=document.getElementById("ePEmailTableComponent").component;r.setData({showStatusMenu:!1,showTemplateNameFilter:!1}),e.info.queryParams.action!==Lyte.Router.getRouteInstance().transition.info.queryParams.action&&r.setData({emailsList:[]}),document.getElementById("ePTemplateTableComponent").component.setData({showStatusMenu:!1,showModuleMenu:!1}),$L("email-parser")[0].component.setData("deleteWarningPopup",!1)}},beforeExit:function(){$("#emailparserpopdiv").html(""),$("#createfunctionpopdiv").html(""),$L("#setupshow").show(),$L(".nextGenUILeftMenu").show()}},{mixins:["crm-email-parser-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.review-usage.index-review-usage",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-reviewprocess-reviewusage.js","crm-reviewprocess-chart.js","Analytics.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);return t=t.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-dashboard.css"],ResourceConstants.CRMClient)),e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("Analytics",{feature_type:"REVIEW_ANALYTICS"})},afterModel:function(e){var t={};t["Rejected reason by record count"]=I18n.getMsg("crm.reviewprocess.rejected.reason.count.history"),t["Review status by record count"]=I18n.getMsg("crm.reviewprocess.history.descrition.status.reviewed"),t["Field status history"]=I18n.getMsg("crm.reviewprocess.field.history.status.count"),t["Average waiting time by review process"]=I18n.getMsg("crm.reviewprocess.status.waitingtime.count.history"),t["Record name by rejection count"]=I18n.getMsg("crm.reviewprocess.status.field.record.count"),t["Waiting time by record name"]=I18n.getMsg("crm.reviewprocess.waitingTime.by.record.descrition");var r={};r["Rejected reason by record count"]=I18n.getMsg("crm.reviewprocess.history.reason.for.rejection"),r["Review status by record count"]=I18n.getMsg("crm.review.status.history.desc"),r["Field status history"]=I18n.getMsg("crm.reviewprocess.field.history"),r["Average waiting time by review process"]=I18n.getMsg("crm.reviewprocess.status.waitingtime.literal"),r["Record name by rejection count"]=I18n.getMsg("crm.reviewprocess.status.field.record.literal"),r["Waiting time by record name"]=I18n.getMsg("crm.reviewprocess.waitingTime.by.record");var s=this;return Lyte.resolvePromises({usageDashboard:e,dashboardDetails:this.getDashBoardComponents(e[0]),rpI18Compnt:r,rpI18Descrition:t}).then((function(e){return s.currentModel=e,s.currentModel}))},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-dashboard"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},getDashBoardComponents:function(e){return store.findRecord("Analytics",e.id).then((function(e){return e[0]}))}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals.index-sales-signals",{model:function(){var e=this;return e.chatConfig={},store.findAll("chat_setting").then((function(t){commonUtils.showHideLoadingDiv(),t.forEach((function(t){"cliq"===t.type&&(e.chatConfig.is_chat_configured=t.active,e.chatConfig.is_chat_authorised=t.authorized,e.chatConfig.is_extension_enabled=t.extension)}))})),store.findAll("extensions")},getResources:function(){var e=networkUtils.returnDependencyFiles(["chat-setup-store.js","chat-integ-store.js"],ResourceConstants.CRMClient);return crmConstants.isGoogle_ChatEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))),e},renderTemplate:function(e){var t={};return t.extensions=e,t.info=e.$.meta,delete t.info.other_platforms.is_chat_configured,t.info.other_platforms.chatConfig=this.chatConfig,crmNTCSettings.otherPlatformsInfo=t.info.other_platforms,Handlebars.registerPartial("topLevelSettings",Handlebars.templates.topLevelSettings),this.currentModel=crmNTCSettings.processSignalsSettingsResponse(t),Handlebars.registerPartial("signalSettingsHeader",Handlebars.templates.signalSettingsHeader),Handlebars.registerPartial("signalSettingsForm",Handlebars.templates.signalSettingsForm),Handlebars.registerPartial("signalSettingsExtRow",Handlebars.templates.signalSettingsExtRow),Handlebars.registerPartial("signalSettingsRow",Handlebars.templates.signalSettingsRow),Handlebars.registerPartial("signalSettingsForChannel",Handlebars.templates.signalSettingsForChannel),Handlebars.registerPartial("signalSettingsHelp",Handlebars.templates.signalSettingsHelp),Handlebars.registerPartial("signalSettingsOtherInfo",Handlebars.templates.signalSettingsOtherInfo),t.info.LOCALE=Crm.userDetails.LOCALE,{outlet:"#result",html:Handlebars.templates.NotificationSettings(t)}},afterRender:function(e){var t=$("#ntcSettingInnerScrollDiv"),r=renderingUtils.windowWidth-t.offset().left-45,s=renderingUtils.windowHeight-t.offset().top-200;crmNTCSettings.displayMainSettings(e),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.ntc.label.settings.notificationTitle"),Crm.partnerName])),Crm.loadChatIntegrationJSForCalAndSS("signals"),4==$("#topbandNotifySettings").find("th").length&&$(".overflowContainer").css({width:r,height:s}),4==$("#topbandNotifySettings").find("th").length&&$(".overflowContainer").css({width:r,height:s}),$("#result").addClass("helpOverflowHide"),crmNTCSettings.existing_enabled_chat_settings=crmNTCSettings.getAllChatEnabledSettings()},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Signal Settings",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME}),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("Sales Signals")},actions:{onError:function(e){e&&e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_AVAILABLE"===e.responseJSON.code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3)},willTransition:function(){closeAsapWidget(),$("#result").removeClass("helpOverflowHide")},onError:function(e){e&&e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_AVAILABLE"===e.responseJSON.code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3)}}}),Lyte.Router.registerRoute("crm.settings.section.inventory-management",{renderTemplate:function(){return{outlet:"#result",html:Handlebars.templates.HigherEditionFeatures(crmSetup.setupObject["crm.settings.section.inventory-management"])}},afterRender:function(){$("#overlayHeader").hide(),$("#settingInner").hide(),$("#setupshow").show(),$("#mainResult").show(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.keyboard-shortcuts",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-keyboard-shortcuts.js","lyte-shortcut.js","crm-keyboard-shortcutsmixin.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("keyboardshortcuts")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-keyboard-shortcuts.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(){if(0!==store.peekAll("keyboard_shortcuts").length){var e=store.peekAll("keyboard_shortcuts"),t={};return t.shortcuts=e,t.isShortcutsEnabled=Crm.userDetails.isKeyboardShortcutsEnabled,t}return Lyte.resolvePromises({shortcuts:store.findAll("keyboard_shortcuts")}).then((function(e){var t={};return t.shortcuts=e.shortcuts,t.isShortcutsEnabled=Crm.userDetails.isKeyboardShortcutsEnabled,t}))},renderTemplate:function(){return{outlet:"#result",component:"crm-keyboard-shortcuts"}},afterRender:function(){$L("#result").addClass("h100_per")},beforeExit:function(){$L("#result").removeClass("h100_per")}}),Lyte.Router.registerRoute("crm.settings.section.kiosk.edit-kiosk-builder",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk"),networkUtils.getI18nJSUrl("actionlistlabel")],ResourceConstants.CRM);e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["kiosk.js","kiosk-builder.js","kiosk-pb-builder-output.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["series_mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zlib_phonenumber.js"],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["crm-data-model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["lyte-connect-child.js","automation/common/crm-mergefield-multilevel.js"],ResourceConstants.CRMClient);return e.push({parent:t,child:r}),e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-data-model.css","automation/common/crm-mergefield-multilevel.css"],ResourceConstants.CRMClient)),e=(e=(e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-pb-builder-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-pb-builder.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["lyte-ui-emoji.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["kiosk-builder.css","kiosk-details.css","kiosk-associate-record-pop.css","kiosk-common.css","kiosk-builder-crm.css","crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(fetchAutomationFunctionFiles())},getDependencies:function(){return networkUtils.returnDependencyFiles(["kiosk-execute.js","features_model.js"],ResourceConstants.CRMClient)},beforeModel:function(e){return!Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&featuresAvailable&&featuresAvailable.KIOSK_NEW_ACTIONS?(renderingUtils.displayPermissionDenied(),void this.transition.abort()):(store.unloadAll("kiosk_meta"),store.unloadAll("kiosk_state"),store.unloadAll("kiosk_getrecord"),store.unloadAll("kiosk_datahub"),store.unloadAll("automation_datahub_module"),e.queryParams.include_inner_details="modified_by.zuid,created_by.zuid,module.display_label,module.name",Lyte.resolvePromises({process:store.findRecord("kiosk",e.dynamicParam,e.queryParams)}))},model:function(e){e.queryParams.include_inner_details="modified_by.zuid,created_by.zuid,module.display_label,module.name";var t=store.peekRecord("kiosk",e.dynamicParam).module.api_name;return Lyte.resolvePromises({kiosk_list:store.findAll("kiosk",e.queryParams),kioskStates:store.findAll("kiosk_state",{include_inner_details:"details.action_type"},void 0,void 0,{processId:e.dynamicParam}),kioskMeta:store.peekAll("kiosk_meta").length?store.peekAll("kiosk_meta"):store.findAll("kiosk_meta",{include_inner_details:"limits_per_kiosk.tour_available"}),process:store.peekRecord("kiosk",e.dynamicParam),kioskModule:store.findAll("module",null,!1,!0,{apiVersion:"7"}),kioskFields:store.findAll("field",{module:t,type:"all"},!1,!1,{apiVersion:"6"}),dataHubDetails:store.findAll("kiosk_datahub",void 0,void 0,void 0,{processId:e.dynamicParam}),dataHubModuleDetails:store.findAll("automation_datahub_module",void 0,void 0,void 0,{processId:e.dynamicParam}),getRecSupportedModules:store.findAll("module",{feature_name:"Kiosk"},!1,!1,{apiVersion:"6"}),getRecordDetails:store.findAll("kiosk_getrecord",void 0,void 0,void 0,{processId:e.dynamicParam})})},afterModel:function(e){e.getRecSupportedModules=e.getRecSupportedModules.module,e.getRecSupportedModules=this.getSupportedModules(e.getRecSupportedModules);var t=this.getGroupedkiosk(e.kiosk_list);e.kioskVersions=t[e.process.group_id],e.kioskFields=e.kioskFields.field},renderTemplate:function(){var e=!1;return $L("crm-kiosk-builder")[0]&&(e=!0),customFunctionsObj.isFrom="automation",$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$L(".new_setupview").addClass("newSetupRightShow"),{outlet:"#result",component:"crm-kiosk-builder",reRender:e}},afterRender:function(){Lyte.injectResources([networkUtils.returnDependencyFiles(["kiosk-builder-config.js","kiosk-pb-dependencies.js","kiosk-create-associate-pop.js","pb-builder-output.js","crm-emailconversation-view-helpers.js","kiosk-associate-record-pop.js","kiosk-file-api.js","lyte-draggable.js","lyte-fileupload.js"],ResourceConstants.CRMClient)],void 0,void 0),wfmergefield.initMergeFieldDetl("Kiosk");var e=this;return automationActions.isBusinessHourAvailable=Crm.userDetails.isBusinessHoursCreated,wfActions.isNewConvertUIEnabled=!0,store.findAll("field",{module:"Leads",type:"all"},!0,!0,{apiVersion:"2.1"}).then((function(t){e.setCurrentRecordToolTipModuleInfo(t),commonUtils.showHideLoadingDiv(!1)}),(function(){e.setCurrentRecordToolTipModuleInfo(),commonUtils.showHideLoadingDiv(!1)})),Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM?Lyte.resolvePromises({predefined_picklist:store.findAll("predefined_picklist"),global_picklist:Crm.isGlobalPickListEnabled?store.findAll("global_picklist",{include:"used_in_modules",include_inner_details:"used_in_modules.plural_label"}):[]}).then((function(){commonUtils.showHideLoadingDiv(!1)}),(function(){commonUtils.showHideLoadingDiv(!1)})):Lyte.resolvePromises({predefined_picklist:store.findAll("predefined_picklist"),global_picklist:[]})},beforeExit:function(){wfmergefield.clearMergeFieldDetl()},actions:{onError:function(e){return this.kioskRouteErrorHandling(e,"kiosks",!0),!1}},lyteConvertionSupported:!0},{mixins:["kiosk","kiosk_execute"]}),Lyte.Router.registerRoute("crm.settings.section.kiosk.index-kiosk",{getResources:function(){var e=networkUtils.returnDependencyFiles(["kiosk-details.js","setup/orchestration/crm-orchestration-common.js","kiosk-create-associate-pop.js","kiosk-associate-record-pop.js","kiosk-pb-builder-output.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk"),networkUtils.getI18nJSUrl("actionlistlabel")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["kiosk-details.css","kiosk-associate-record-pop.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getDependencies:function(){return networkUtils.returnDependencyFiles(["kiosk.js","kiosk-execute.js"],ResourceConstants.CRMClient)},beforeModel:function(){!Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&featuresAvailable&&featuresAvailable.KIOSK_NEW_ACTIONS&&(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("kiosk"),store.unloadAll("kiosk_state"),store.unloadAll("kiosk_getrecord"),store.unloadAll("kiosk_datahub"),store.unloadAll("automation_datahub_module"),store.unloadAll("kiosk_meta")},model:function(){return Lyte.resolvePromises({kiosk:store.findAll("kiosk",{include_inner_details:"modified_by.zuid,created_by.zuid,module.display_label,module.name,current_record_module.name"}),kioskMeta:store.peekAll("kiosk_meta").length?store.peekAll("kiosk_meta"):store.findAll("kiosk_meta"),kioskModules:store.findAll("module",{feature_name:"Kiosk"},!1,!1,{apiVersion:"6"})})},afterModel:function(e){var t=this.getGroupedkiosk(e.kiosk);e.kioskList=this.getDisplayablekiosksList(t),e.kioskModules=e.kioskModules.module,e.kioskList.forEach((function(e){var r=t[e.group_id].length;e.$.set("versionCount",r),e.statusDominatingProcess.$.set("versionList",t[e.group_id])}))},renderTemplate:function(){return Crm.client_tracking("Kiosk -  Accessed"),{outlet:"#result",component:"crm-kiosk-details"}},actions:{didTransition:function(){$L("#mainMenuTabDiv").css("display","block"),$L(".nextGenUILeftMenu").css("display","block"),featuresAvailable.NEXTGENUI_ENABLED||$("#mainMenuTabDiv").find("crm-tab")[0].component.resizeMenu()},onError:function(e){return this.kioskRouteErrorHandling(e),!1}},afterRender:function(){$L("#result").addClass("h100_per"),$L("#setupInnerLinks").hide(),this.transition.data.invalidProcess&&$L("#kiosk_not_exist_alert").e.ltProp("show",!0);var e=$L("crm-kiosk-details")[0];this.transition.data.moduleDisabledWarning&&(e.component.setData("disabledModules",this.transition.data.disabledModulesList),$L("#kiosk_deny_pop")[0].ltProp("show",!0)),e&&e.component&&e.component.resizeKioskListViewTable()},beforeExit:function(){$L("#result").removeClass("h100_per"),"undefined"!=typeof ZohoHCAsap&&validationUtils.isNotEmpty(ZohoHCAsap)&&ZohoHCAsap.Action("close"),Lyte.registeredMixins.kiosk_execute.closeAssociationPopHelper(),$L("crm-kiosk-details")[0].component.removeTableObserer()},lyteConvertionSupported:!0},{mixins:["kiosk","kiosk_execute"]}),Lyte.Router.registerRoute("crm.settings.section.kiosk",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-model-kiosk.js","crm-model-kiosk-process.js","globalfield-models.js","kiosk-file-api.js","child_relationship_model.js"],ResourceConstants.CRMClient)}}),Lyte.Router.registerRoute("crm.settings.section.macro.create",{queryParams:["module"],beforeModel:function(e){this.routePermissionCheck("create",e,this),this.permissionDenied=!1},getDependencies:function(){return networkUtils.returnDependencyFiles(["macro-model.js","crm-organization-email-model.js","emailStorage-model.js","crm-macro-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[];return e.push(networkUtils.returnDependencyFiles(["crm-macro-ce.js","crm-macro-task.js","crm-mass-actions.js","crm-mass-action-mixin.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["crux-combo-box-view.css","crm-macro.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e},model:function(e){var t=objectUtils.getMatchedKey(moduleApiMapping,e.queryParams.module);return Lyte.resolvePromises({module:e.queryParams.module,layout:store.findAll("layout",{module:e.queryParams.module}),updateFieldData:store.findAll("field",{module:e.queryParams.module,type:"all"},!1,!1,{apiVersion:"4.0"}),layoutRules:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",{params:{step:"newMacroRule",module:t,cvid:crmListView.getObject().cvId}}).then((function(e){if("PermissionDenied"===e)return e;var t={};return t.fieldMap=e.fieldElementsMap,t.rulePrimaryFields=e.formRulePrimaryFields,t}))})},afterModel:function(e,t){if("PermissionDenied"===e.layoutRules)return renderingUtils.displayPermissionDenied(),void this.transition.abort();var r=[{name:I18n.getMsg("crm.mailparser.none"),value:"None"}];this.setDataFromRoute(e,t,this,"create",r),this.currentModel.updateFieldPicklist=r;var s=r,n=[];n[0]=s,this.currentModel.updateFieldPicklistRef=n},renderTemplate:function(){return this.permissionDenied?renderingUtils.displayPermissionDenied():{outlet:"#show",component:"crm-macro-ce"}}},{mixins:["crm-macro-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.macro.edit",{queryParams:["module"],beforeModel:function(e){this.routePermissionCheck("edit",e,this),this.error=!1,this.permissionDenied=!1},getDependencies:function(){return networkUtils.returnDependencyFiles(["macro-model.js","crm-organization-email-model.js","emailStorage-model.js","crm-macro-mixin.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[];return e.push(networkUtils.returnDependencyFiles(["crm-macro.css","crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.push(networkUtils.returnDependencyFiles(["crm-macro-ce.js","crm-macro-task.js","crm-macro-deleted.js","crm-mass-actions.js","crm-mass-action-mixin.js"],ResourceConstants.CRMClient)),e},model:function(e){var t=[],r=!1,s=!1,n=objectUtils.getMatchedKey(moduleApiMapping,e.queryParams.module);return Lyte.resolvePromises({functionlayoutRes:store.findAll("layout",{module:e.queryParams.module}),macroRecord:store.findRecord("macro",e.dynamicParam,{module:e.queryParams.module}),updateFieldData:store.findAll("field",{module:e.queryParams.module,type:"all"},!1,!1,{apiVersion:"4.0"}),layoutRules:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",{params:{step:"newMacroRule",module:n,cvid:crmListView.getObject().cvId}}).then((function(e){if("PermissionDenied"===e)return e;var t={};return t.fieldMap=e.fieldElementsMap,t.rulePrimaryFields=e.formRulePrimaryFields,t}))}).then(function(n){var i;if(void 0!==n.macroRecord&&0!==Object.keys(n.macroRecord).length)return n.macroRecord[0].actions.email_notifications&&n.macroRecord[0].actions.email_notifications.length>0&&(r=!0),n.macroRecord[0].actions.tasks&&n.macroRecord[0].actions.tasks.length>0&&n.macroRecord[0].actions.tasks.forEach((function(e){Object.keys(e.assignee).length>0&&t.push(e.assignee.id)})),n.macroRecord[0].actions.field_update&&n.macroRecord[0].actions.field_update.length>0&&n.macroRecord[0].actions.field_update.forEach((function(r){"Owner"===r.field.api_name&&t.push(r.value),"Deals"!==e.queryParams.module&&"Potentials"!==e.queryParams.module||"Pipeline"!==r.field.api_name&&"Layout"!==r.field.api_name||(s=!0)})),n.macroRecord[0].shared_to&&n.macroRecord[0].shared_to.length>0&&n.macroRecord[0].shared_to.forEach((function(e){"users"===e.type&&t.push(e.id)})),Lyte.resolvePromises({macroRecord:n.macroRecord,module:e.queryParams.module,org_email:r?store.triggerAction("emails","from_addresses",{},null,"GET").then((function(e){return e})).catch((function(){})):void 0,updateFieldData:n.updateFieldData,userList:t.length>0?store.findAll("user",{ids:t.join(",")}):void 0,pipeline_Picklist:s?(i=[],n.functionlayoutRes.reduce((function(e,t){return e.then((function(){return store.findAll("pipeline",{layout_id:t.id})})).then((function(e){i=i.concat(e)}))}),Promise.resolve()).then((function(){return i}))):void 0,layoutRules:n.layoutRules,validationRules:n.validationRules,layout:n.functionlayoutRes});this.error=!0}.bind(this))},afterModel:function(e,t){if(void 0!==e&&void 0!==e.macroRecord){if(e.macroRecord[0].created_by.id!==Crm.userDetails.USER_ID||"PermissionDenied"===e.layoutRules)return renderingUtils.displayPermissionDenied(),void this.transition.abort();var r=this,s=[{name:I18n.getMsg("crm.mailparser.none"),value:"None"}];this.setDataFromRoute(e,t,this,"edit",s);var n=e.macroRecord;if(this.currentModel.name=n[0].name,this.currentModel.macroName=n[0].name,this.currentModel.macroId=n[0].id,"description"in n[0]&&null!==n[0].description&&(this.currentModel.description=n[0].description),"tasks"in n[0].actions&&null!==n[0].actions.tasks){this.currentModel.taskDisplay=!0,n[0].actions.tasks.length>=3&&(this.currentModel.taskAddbuttonDisplay=!1);var i=[];n[0].actions.tasks.forEach((function(t){if(null===t.reminder&&(t.reminder={}),Object.keys(t.assignee).length>0){var r=e.userList.find((e=>e.id===t.assignee.id));r&&(t.assignee=r)}i.push(t)})),this.currentModel.taskArray=i}if("email_notifications"in n[0].actions&&null!==n[0].actions.email_notifications){this.currentModel.emailtemplateDisplay=!0,this.currentModel.emailActionId=n[0].actions.email_notifications[0].id,this.currentModel.emailTemplateId=n[0].actions.email_notifications[0].template_id,this.currentModel.emailIdFinal=n[0].actions.email_notifications[0].template_id,this.currentModel.emailTemplateName=n[0].actions.email_notifications[0].name,this.currentModel.emailNameFinal=n[0].actions.email_notifications[0].name;var o=this.emailLookuplist,a=this.decodedEmail,l=n[0].actions.email_notifications[0].from_address;switch(l.type){case"field":if("Owner.email"===l.api_name||"${CURRENTUSER_EMAIL}"===l.api_name)this.currentModel.emailFromFinal=l.api_name;else{var c=o.find((e=>e.id===l.id&&"field"===e.type));this.currentModel.emailFromFinal=c.value}break;case"users":c=o.find((e=>e.id===l.id&&"users"===e.type));this.currentModel.emailFromFinal=c.value;break;case"organization_emails":c=o.find((e=>e.id===l.id&&"organization_emails"===e.type));this.currentModel.emailFromFinal=c?c.value:a}if("reply_to_address"in n[0].actions.email_notifications[0]&&null!==n[0].actions.email_notifications[0].reply_to_address){this.currentModel.emailReplyToDropdown=!0,this.currentModel.emailReplyToLink=!1;var u=n[0].actions.email_notifications[0].reply_to_address;switch(u.type){case"field":if("Owner.email"===u.api_name||"${CURRENTUSER_EMAIL}"===u.api_name)this.currentModel.emailReplyToFinal=u.api_name;else{var d=o.find((e=>e.id===u.id&&"field"===e.type));this.currentModel.emailReplyToFinal=d.value}break;case"users":d=o.find((e=>e.id===u.id&&"users"===e.type));this.currentModel.emailReplyToFinal=d.value;break;case"organization_emails":d=o.find((e=>e.id===u.id&&"organization_emails"===e.type));this.currentModel.emailReplyToFinal=d?d.value:a}}else this.currentModel.emailReplyToFinal=""}if("field_update"in n[0].actions&&null!==n[0].actions.field_update){var m,p=[],g=[],f=[];this.currentModel.updateFieldLength=n[0].actions.field_update.length-1;var h={};function y(e){e.value=e.value.replaceAll(Crm.userDetails.numberSeparators.group,""),e.value=e.value.replaceAll(Crm.userDetails.numberSeparators.decimal,".")}if(n[0].actions.field_update.forEach((function(t,n){var i=e.updateFieldData.field.find((e=>t.field.id===e.id));if(void 0!==i){void 0===s.find((e=>i.api_name===e.value))&&(h[n]={name:i.field_label,value:i.api_name});var o={},a={};if(a.apiName=t.field.api_name,a.id=t.id,f.push(a),o.updateField=i.api_name,g.push(i.api_name),o.updateFieldId=t.id,"Layout"===i.api_name){if(o.updateValueType="layout",o.picklist=r.layoutPicklist,o.updateValue=t.value,t.dependency_fields&&t.dependency_fields.length>0){o.dependencyValue_pipeline=t.dependency_fields[0].value,o.dependencyValue_stage=t.dependency_fields[0].dependency_fields[0].value,o.dependencyValuePicklist_pipeline=r.layoutPicklist_Pipeline[t.value],o.dependencyValuePicklist_stage=r.dependencyPicklists[t.dependency_fields[0].value],r.dependencyPicklists[t.dependency_fields[0].value].find((e=>e.display_value===t.dependency_fields[0].dependency_fields[0].value))||(o.dependencyValue_stage="");var l=e.updateFieldData.field.find((e=>"Stage"===e.api_name));o.colourEnable=!!l&&l.enable_colour_code}}else switch(i.data_type){case"userlookup":o.fieldLabel=i.field_label,o.updateValueType="userlookup",o.updateValue=t.value.value||"${CURRENTUSER}"!==t.value.name?t.value.value:t.value.name,o.updateValue_userObject=t.value.value||"${CURRENTUSER}"!==t.value.name?{id:t.value.value,name:t.value.name}:{name:t.value.name};break;case"ownerlookup":o.fieldLabel=i.field_label,o.updateValueType="ownerlookup",o.updateValue=t.value,o.updateValue_notify=t.notify,o.updateValue_applyRestriction=t.apply_restriction,o.updateValue_relatedModules=t.related_modules,m=n;break;case"email":o.fieldLimit=i.length,o.fieldLabel=i.field_label,o.updateValueType="email",o.updateValue=t.value;break;case"phone":o.fieldLimit=i.length,o.fieldLabel=i.field_label,o.updateValueType="phone",o.updateValue=t.value;break;case"website":o.fieldLimit=i.length,o.fieldLabel=i.field_label,o.updateValueType="website",o.updateValue=t.value;break;case"currency":case"double":o.fieldLimit=i.length,"currency"===i.data_type&&0===i.decimal_place?o.decimalLimit=2:o.decimalLimit=i.decimal_place,o.fieldLabel=i.field_label,o.updateValueType="decimal",y(t),o.updateValue=t.value;break;case"integer":case"bigint":o.fieldLimit=i.length,o.fieldLabel=i.field_label,o.updateValueType="integer",y(t),o.updateValue=t.value;break;case"boolean":o.fieldLabel=i.field_label,o.updateValueType="boolean","1"===t.value?o.updateValue=!0:o.updateValue=!1;break;case"text":case"textarea":o.fieldLimit=i.length,o.fieldLabel=i.field_label,o.updateValueType="text",o.updateValue=t.value;break;case"picklist":if("Pipeline"===t.field.api_name){o.updateValueType="pipeline",o.updateValue=t.value,o.dependencyValue=t.dependency_fields[0].value,o.dependencyValuePicklist=r.dependencyPicklists[t.value],o.picklist=r.pipelinePicklist,r.dependencyPicklists[t.value].find((e=>e.display_value===t.dependency_fields[0].value))||(o.dependencyValue="");l=e.updateFieldData.field.find((e=>"Stage"===e.api_name));o.colourEnable=!!l&&l.enable_colour_code}else{o.fieldLabel=i.field_label,o.updateValueType="picklist",o.updateValue=t.value,o.picklist=i.pick_list_values,o.colourEnable=i.enable_colour_code;var c=i.pick_list_values.find((e=>e.display_value===t.value));!c||c&&c.hasOwnProperty("type")&&"unused"===c.type?(o.updateValue="",o.updateActualValue=""):o.updateActualValue=c?c.actual_value:t.value}break;case"multiselectpicklist":o.fieldLabel=i.field_label,o.updateValueType="multiselectpicklist",o.updateValue=JSON.stringify(t.value),o.picklist=i.pick_list_values,"append"===t.type||"Append"===t.type?o.append=!0:o.append=!1;break;case"date":case"datetime":o.fieldLabel=i.field_label,o.updateValueType=i.data_type,"date"===i.data_type?o.picklist=[{display_value:I18n.getMsg("crm.macro.label.runDate"),actual_value:"${EXECUTION_DAY}+0"},{display_value:I18n.getMsg("crm.macro.label.daysBeforeRunDate"),actual_value:"${EXECUTION_DAY}-"},{display_value:I18n.getMsg("crm.macro.label.daysAfterRunDate"),actual_value:"${EXECUTION_DAY}+"},{display_value:I18n.getMsg("crm.macro.label.chooseDate"),actual_value:"date"}]:"datetime"===i.data_type&&(o.picklist=[{display_value:I18n.getMsg("crm.macro.label.runDate"),actual_value:"${EXECUTION_DAY}+0"},{display_value:I18n.getMsg("crm.macro.label.daysBeforeRunDate"),actual_value:"${EXECUTION_DAY}-"},{display_value:I18n.getMsg("crm.macro.label.hoursBeforeRunDate"),actual_value:"${EXECUTION_TIME}-"},{display_value:I18n.getMsg("crm.macro.label.daysAfterRunDate"),actual_value:"${EXECUTION_DAY}+"},{display_value:I18n.getMsg("crm.macro.label.hoursAfterRunDate"),actual_value:"${EXECUTION_TIME}+"},{display_value:I18n.getMsg("crm.macro.label.chooseDateAndTime"),actual_value:"datetime"}]);var u=t.value,d=/\$\{EXECUTION_(DAY|TIME)\}(\+0{1,3}h?|\-0{1,3}h?)$/.test(u);if(d)o.updateValue="${EXECUTION_DAY}+0",o.dateValue="";else if(u.includes("${EXECUTION_DAY}+")&&!d){o.updateValue="${EXECUTION_DAY}+";var C=u.indexOf("+"),v=u.substring(C+1);o.dateValue=v}else if(u.includes("${EXECUTION_DAY}-")&&!d){o.updateValue="${EXECUTION_DAY}-";C=u.indexOf("-"),v=u.substring(C+1);o.dateValue=v}else if("datetime"===i.data_type&&u.includes("${EXECUTION_TIME}-")){o.updateValue="${EXECUTION_TIME}-";C=u.indexOf("-");var _=u.indexOf("h");v=u.substring(C+1,_);o.dateValue=v}else if("datetime"===i.data_type&&u.includes("${EXECUTION_TIME}+")){o.updateValue="${EXECUTION_TIME}+";C=u.indexOf("+"),_=u.indexOf("h"),v=u.substring(C+1,_);o.dateValue=v}else o.updateValue=i.data_type,o.dateValue=u;break;default:selectedField.updateValueType="text",selectedField.updateValue="",Lyte.arrayUtils(this.getData("updateFieldArray"),"replaceAt",n,selectedField)}if(r.layout_validationRules.hasOwnProperty(o.updateField)){var R=r.layoutValidationRuleWarning(o.updateField,r.layout_validationRules,r.currentModel.moduleName);o.layoutValidationWarning=!0,o.rulewarningMessage=R}else o.layoutValidationWarning=!1,o.rulewarningMessage="";p.push(o)}})),void 0!==m&&"ownerlookup"===p[m].updateValueType&&e.userList){var C="",v=p[m].updateValue,_=e.userList.find((e=>e.id===v)),R=_.full_name,w={id:_.profile.id,name:_.profile.name};if(p[m].updateValue_userProfile=w,p[m].updateValue_userName=R,p[m].updateValue_relatedModules&&p[m].updateValue_relatedModules.length>0){for(var b=p[m].updateValue_relatedModules,D=b.length,M=0;M<D;M+=1)C+=b[M].api_name+",";C=C.replace(/.$/,"")}if(""!==C){var L=I18n.getMsg("crm.change.owner.relatedRecordsText",this.getRelatedRecordsText_ownerfield(C,R));p[m].updateMessage=L}else p[m].updateMessage=""}this.currentModel.updateFieldArray=p,this.currentModel.updateFieldPicklistDisabled=g,this.currentModel.fieldListRef=f,this.currentModel.updateFieldPicklist=s;var k=s.slice();if(p&&1===p.length){(A=[])[0]=k;var U={0:p[0].updateField,1:"",2:""}}else if(2===p.length){var E=[],P=[];E=k.filter((e=>e.value!==p[1].updateField)),P=k.filter((e=>e.value!==p[0].updateField)),(A=[])[0]=E,A[1]=P;U={0:p[0].updateField,1:p[1].updateField,2:""}}else{var I;E=[],P=[];E=k.filter((e=>e.value!==p[1].updateField&&e.value!==p[2].updateField)),P=k.filter((e=>e.value!==p[0].updateField&&e.value!==p[2].updateField)),I=k.filter((e=>e.value!==p[0].updateField&&e.value!==p[1].updateField)),(A=[])[0]=E,A[1]=P,A[2]=I;U={0:p[0].updateField,1:p[1].updateField,2:p[2].updateField}}Object.entries(h).forEach((([e,t])=>{A.hasOwnProperty(e)&&A[e].push(t)})),this.currentModel.updateFieldPicklistRef=A,this.currentModel.updateFieldPicklistSelected=U,this.currentModel.permissionDeniedFields=h}else{var A;E=[];(A=[])[0]=E=s,this.currentModel.updateFieldPicklist=s,this.currentModel.updateFieldPicklistRef=A}if(this.currentModel.access_type=n[0].access_type,"all"===n[0].access_type&&(this.currentModel.shareCheck=!0,this.currentModel.allUsersCheck=!0,this.currentModel.macroShareOptions=!0,this.currentModel.macroShareWarning=!0),"only_to_me"===n[0].access_type&&(this.currentModel.shareCheck=!1,this.currentModel.allUsersCheck=!1,this.currentModel.macroShareOptions=!1),"shared"===n[0].access_type&&"shared_to"in n[0]&&null!==n[0].shared_to&&n[0].shared_to.length>0){var S=[],T=[],F=n[0].shared_to,x=[],j={};e.userList&&e.userList.length>0&&e.userList.forEach((function(e){j[e.full_name]=e.image_link})),F.forEach((function(e){var t={},r={},s={};switch(t.id=e.id,r.image=void 0,r.id=e.id,r.name=e.name,e.type){case"groups":t.type="user_group",r.type="user_group",t.prefix="G",r.prefix="G",s.prefix="G",s.type="Group";var n={};n.id=e.id,n.name=e.name,s.group=n;break;case"roles":t.type="role",r.type="role",t.prefix="R",r.prefix="R",s.prefix="R",s.type="Role";var i={};i.id=e.id,i.name=e.name,s.role=i;break;case"users":t.type="user",r.type="user",t.prefix="U",r.prefix="U",s.prefix="U",s.type="Users";var o={};o.id=e.id,o.name=e.name,j.hasOwnProperty(e.name)?o.image_link=j[e.name]:o.image_link=void 0,s.user=o}S.push(t),T.push(r),x.push(s)})),this.currentModel.cxPropSelectedComboBox=x,this.currentModel.macroSharedData=S,this.currentModel.macroShareDataJSON=T,this.currentModel.macroShareDisplay=!0,this.currentModel.shareCheck=!0,this.currentModel.allUsersCheck=!1,this.currentModel.macroShareOptions=!0,this.currentModel.macroShareWarning=!0,this.currentModel.selectiveUsersCheck=!0}}else this.error=!0},convertDateTime:function(e){return CrmDateUtils.convertDateTimetoISOFormat(e)},getRelatedRecordsText_ownerfield:function(e,t){var r=[],s={Tasks:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Tasks.plural_label),Calls:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Calls.plural_label),Events:I18n.getMsg("crm.right.open.module",Events.getModuleName(!1,!0)),Contacts:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Contacts.plural_label),Potentials:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Deals.plural_label)};for(var n in s)s.hasOwnProperty(n)&&(e=e.replace(n,s[n]));return e=e.replace(/,/g,", "),r[0]=e,r[1]=t,r},renderTemplate:function(){return this.error?{outlet:"#show",component:"crm-macro-deleted"}:this.permissionDenied?renderingUtils.displayPermissionDenied():{outlet:"#show",component:"crm-macro-ce"}}},{mixins:["crm-macro-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.macro.index",{queryParams:["module"],getDependencies:function(){const e=[];return e.push(networkUtils.returnDependencyFiles(["macro-model.js","crm-macro-mixin.js"],ResourceConstants.CRMClient)),featuresAvailable.Macros_Suggest&&e.push(networkUtils.returnDependencyFiles(["macro-suggestion-model.js"],ResourceConstants.CRMClient)),e},getResources:function(){const e=[];return e.push(networkUtils.returnDependencyFiles(["crm-macro.css","crux-text-area-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.push(networkUtils.returnDependencyFiles(["crm-macro-list.js","crux-lazyLoad.js"],ResourceConstants.CRMClient)),featuresAvailable.Macros_Suggest&&e.push(networkUtils.returnDependencyFiles(["macro-suggestion-common.js"],ResourceConstants.CRMClient)),e},beforeModel:function(e){this.routePermissionCheck("index",e,this),this.modulePermission=!0},model:function(e){return{module:e.queryParams.module,macroSuggestion:featuresAvailable.Macros_Suggest?store.findAll("macro_suggestion",{module:e.queryParams.module,macro_already_available:!1,include_inner_details:"module.display_label,field_updates.field.field_label,field_updates.field.ui_type"}):[]}},afterModel:function(e,t){this.currentModel.macroSuggestionLength=e.macroSuggestion.length,this.currentModel.module=t.queryParams.module;var r=moduleRecordMapping.Tasks.creatable;this.currentModel.modulePermission=this.modulePermission,this.currentModel.taskPermission=r},renderTemplate:function(){return{outlet:"#show",component:"crm-macro-list"}}},{mixins:["crm-macro-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.macro.view",{queryParams:["module"],beforeModel:function(e){this.error=!1,this.permissionDenied=!1},getDependencies:function(){return networkUtils.returnDependencyFiles(["macro-model.js","crm-organization-email-model.js","emailStorage-model.js"],ResourceConstants.CRMClient)},getResources:function(){const e=[];return e.push(networkUtils.returnDependencyFiles(["crm-macro.css","crux-combo-box-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.push(networkUtils.returnDependencyFiles(["crm-macro-view.js","crm-macro-deleted.js"],ResourceConstants.CRMClient)),e},model:function(e){var t=[],r=!1,s=[],n=objectUtils.getMatchedKey(moduleApiMapping,e.queryParams.module);return n||(n=e.queryParams.module,e.queryParams.module=moduleApiMapping[e.queryParams.module]),store.findRecord("macro",e.dynamicParam,{module:e.queryParams.module}).then((function(n){if(n&&0!==Object.keys(n).length){if(n[0].actions.field_update&&n[0].actions.field_update.length>0){r=!0;var i=!1,o=!1;n[0].actions.field_update.forEach((function(e){"Owner"===e.field.api_name&&t.push(e.value),s.push(e.field.id),"Stage"===e.field.api_name&&(i=!0),"Layout"!==e.field.api_name&&"Pipeline"!==e.field.api_name||(o=!0)}))}if(n[0].actions.email_notifications&&("field"===n[0].actions.email_notifications[0].from_address.type&&n[0].actions.email_notifications[0].from_address.id&&(r=!0,s.push(n[0].actions.email_notifications[0].from_address.id)),null!==n[0].actions.email_notifications[0].reply_to_address&&"field"===n[0].actions.email_notifications[0].reply_to_address.type&&n[0].actions.email_notifications[0].reply_to_address.id&&(r=!0,s.push(n[0].actions.email_notifications[0].reply_to_address.id))),s.length>0){var a=JSON.stringify({comparator:"in",field:{api_name:"id"},value:s});if(!i&&o&&("Deals"===e.queryParams.module||"Potentials"===e.queryParams.module))a='{"group_operator":"OR","group":['+a+","+JSON.stringify({comparator:"equal",field:{api_name:"api_name"},value:["Stage"]})+"]}"}return n[0].shared_to&&n[0].shared_to.length>0&&n[0].shared_to.forEach((function(e){"users"===e.type&&t.push(e.id)})),Lyte.resolvePromises({macroRecord:n,fieldRecord:r?store.findAll("field",{module:e.queryParams.module,type:"all",filters:a},!1,!1,{apiVersion:"4.0"}):void 0,userList:t.length>0?store.findAll("user",{ids:t.join(",")}):void 0})}this.error=!0}))},afterModel:function(e,t){if(void 0!==e&&void 0!==e.macroRecord){var r=e.macroRecord[0],s=r.created_by.id===Crm.userDetails.USER_ID;this.currentModel.macroOwner=s;var n=objectUtils.getMatchedKey(moduleApiMapping,t.queryParams.module),i=moduleRecordMapping[n].module_name;if(!(Crm.userDetails.permissions.Crm_Implied_Create_Activities&&Crm.userDetails.permissions["Crm_Implied_Mass_Email_"+i]&&Crm.userDetails.permissions["Crm_Implied_Mass_Update_"+i])&&!0===s)return renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort(),!1;var o=moduleRecordMapping.Tasks.creatable;if(this.currentModel.taskPermission=o,("Deals"===t.queryParams.module||"Potentials"===t.queryParams.module)&&e.fieldRecord){var a=e.fieldRecord.field.find((e=>"Stage"===e.api_name));a&&(this.currentModel.stage_picklist=a.pick_list_values)}this.currentModel.module=t.queryParams.module;var l=null===r.actions.email_notifications?0:r.actions.email_notifications.length,c=null===r.actions.field_update?0:r.actions.field_update.length,u=null===r.actions.tasks?0:r.actions.tasks.length;if(this.currentModel.emailLength=l,this.currentModel.taskLength=u,this.currentModel.updatefieldLength=c,!0===s){var d=null===r.shared_to?0:r.shared_to.length;this.currentModel.shareLength=d}if(l>0){if("field"===r.actions.email_notifications[0].from_address.type)switch(r.actions.email_notifications[0].from_address.api_name){case"${CURRENTUSER_EMAIL}":this.currentModel.emailFrom=I18n.getMsg("crm.template.current.user.email");break;case"Owner.email":this.currentModel.emailFrom=I18n.getMsg("crm.template.record.owner.email");break;default:var m=e.fieldRecord.field.find((e=>e.id===r.actions.email_notifications[0].from_address.id));this.currentModel.emailFrom=m?m.field_label+I18n.getMsg("crm.zmail.email"):r.actions.email_notifications[0].from_address.api_name}if("users"===r.actions.email_notifications[0].from_address.type&&(this.currentModel.emailFrom=r.actions.email_notifications[0].from_address.email),"organization_emails"===r.actions.email_notifications[0].from_address.type&&(this.currentModel.emailFrom=r.actions.email_notifications[0].from_address.name),null!==r.actions.email_notifications[0].reply_to_address){if("field"===r.actions.email_notifications[0].reply_to_address.type)switch(r.actions.email_notifications[0].reply_to_address.api_name){case"${CURRENTUSER_EMAIL}":this.currentModel.emailReplyTo=I18n.getMsg("crm.template.current.user.email");break;case"Owner.email":this.currentModel.emailReplyTo=I18n.getMsg("crm.template.record.owner.email");break;default:m=e.fieldRecord.field.find((e=>e.id===r.actions.email_notifications[0].reply_to_address.id));this.currentModel.emailReplyTo=m?m.field_label+I18n.getMsg("crm.zmail.email"):r.actions.email_notifications[0].reply_to_address.api_name}"users"===r.actions.email_notifications[0].reply_to_address.type&&(this.currentModel.emailReplyTo=r.actions.email_notifications[0].reply_to_address.email),"organization_emails"===r.actions.email_notifications[0].reply_to_address.type&&(this.currentModel.emailReplyTo=r.actions.email_notifications[0].reply_to_address.name)}null===r.actions.email_notifications[0].reply_to_address&&(this.currentModel.emailReplyTo=I18n.getMsg("crm.mailparser.none"))}if(d&&d>0){var p=[],g={},f=e.userList;f&&f.length>0&&f.forEach((function(e){g[e.full_name]=e.image_link})),r.shared_to.forEach((function(e){if("users"===e.type){var t={},r={prefix:"U",type:"Users"};t.name=e.name,t.id=e.id,g.hasOwnProperty(e.name)?t.image_link=g[e.name]:t.image_link=void 0,r.user=t,p.push(r)}if("roles"===e.type){r={prefix:"R",type:"Role"};var s={};s.id=e.id,s.name=e.name,r.role=s,p.push(r)}if("groups"===e.type){r={prefix:"G",type:"Group"};var n={};n.id=e.id,n.name=e.name,r.group=n,p.push(r)}})),this.currentModel.cxPropSelectedComboBox=p}if(u>0){var h=r.actions.tasks;h.forEach((function(e){var t;t="months"===e.due_date.period?I18n.getMsg("crm.months"):I18n.getMsg("crm.days"),e.dueDateLiteral=e.due_date.unit+" "+t+" "+I18n.getMsg("crm.macro.task.dueDateSuffix")})),this.currentModel.taskList=h}var y=r.actions.field_update;if(null!==r.actions.field_update){for(var C,v=[],_=y.length,R=0;R<_;R++){y[R].field.api_name=y[R].field.api_name.replace(/_/g," ");var w=e.fieldRecord.field.find((e=>e.id===y[R].field.id));w&&v.push(w),y[R].field.ui_type=v[R].ui_type,y[R].field.data_type=v[R].data_type,y[R].field.field_label=v[R].field_label;var b=y[R];if("date"===b.field.data_type||"datetime"===b.field.data_type)if(-1===b.value.indexOf("${EXECUTION_DAY}")&&-1===b.value.indexOf("${EXECUTION_TIME}")&&"datetime"===b.field.data_type)y[R].value=Lyte.Component.registeredHelpers.dateTimeUserFormatFromISOFormat(b.value);else{if(b.value.indexOf("${EXECUTION_DAY}")>-1)if(b.value.indexOf("+")>-1){var D=b.value.replace("${EXECUTION_DAY}+","");y[R].value="0"===D||"00"===D||"000"===D?I18n.getMsg("crm.macro.label.runDate"):"1"===D?I18n.getMsg("crm.macro.label.daysAfterRunDate.singular"):I18n.getMsg("crm.macro.label.daysAfterRunDate.plural",D)}else{D=b.value.replace("${EXECUTION_DAY}-","");y[R].value="0"===D||"00"===D||"000"===D?I18n.getMsg("crm.macro.label.runDate"):"1"===D?I18n.getMsg("crm.macro.label.daysBeforeRunDate.singular"):I18n.getMsg("crm.macro.label.daysBeforeRunDate.plural",D)}var M=b.value;if(b.value.indexOf("${EXECUTION_TIME}")>-1){if(b.value.indexOf("+")>-1)M="0"===(D=b.value.replace("${EXECUTION_TIME}+","")).replace("h","")||"00"===D.replace("h","")||"000"===D.replace("h","")?I18n.getMsg("crm.macro.label.runDate"):"1"===D?b.value.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursAfterRunDate.singular"):I18n.getMsg("crm.macro.label.daysAfterRunDate.singular"):b.value.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursAfterRunDate.plural",D.replace("h","")):I18n.getMsg("crm.macro.label.daysAfterRunDate.plural",D);else M="0"===(D=b.value.replace("${EXECUTION_TIME}-","")).replace("h","")||"00"===D.replace("h","")||"000"===D.replace("h","")?I18n.getMsg("crm.macro.label.runDate"):"1"===D?b.value.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursBeforeRunDate.singular"):I18n.getMsg("crm.macro.label.daysBeforeRunDate.singular"):b.value.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursBeforeRunDate.plural",D.replace("h","")):I18n.getMsg("crm.macro.label.daysBeforeRunDate.plural",D);y[R].value=M}}"ownerlookup"===b.field.data_type&&(C=R),"userlookup"===b.field.data_type&&(y[R].value="${CURRENTUSER}"===b.value.name?I18n.getMsg("current.logged.in.user"):b.value.name),"picklist"===b.field.data_type&&(y[R].colourEnable=v[R].enable_colour_code,y[R].picklist_values=v[R].pick_list_values),"multiselectpicklist"===b.field.data_type&&Array.isArray(b.value)&&(y[R].value=b.value.join(", "))}if(void 0!==C){var L=y[C].value,k=e.userList.find((e=>e.id===L)).full_name;y[C].userName=k}this.currentModel.fieldupdateList=y}}else this.error=!0},renderTemplate:function(){return this.error?{outlet:"#show",component:"crm-macro-deleted"}:this.permissionDenied?renderingUtils.displayPermissionDenied():{outlet:"#show",component:"crm-macro-view"}}}),Lyte.Router.registerRoute("crm.settings.section.macro",{getResources:function(){if("undefined"==typeof macro||!Macro.isLoaded){var e=networkUtils.returnDependencyFiles(["crm-alert-recipients.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crux-combo-box.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zohocrm_macro_common.js","zohocrm_macro.js"],ResourceConstants.CRM);return t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("macroRevamp")],ResourceConstants.CRM)),e.concat(t)}},beforeModel:function(){store.clearCachedQuery("macro")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.create-mass-mail",{queryParams:["module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"],ResourceConstants.CRM)},beforeModel:function(e){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup("mailAlert"),this.transition.abort()),$("#mainResult").hide()},model:function(e){return MassMailUnificationUtil.redirectURL(e.queryParams,"CreateMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.edit-mass-mail",{queryParams:["massmailStage","module","massmailId","massmailType"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"],ResourceConstants.CRM)},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return t.massmailStage=t.massmailStage.toString(),MassMailUnificationUtil.redirectURL(t,"EditMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.index-mass-mail",{queryParams:["module","stage"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"],ResourceConstants.CRM)},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return t.stage||(t.stage="scheduled"),MassMailManager.isScheduledMassMailAvailable()||(t.stage="sent"),MassMailUnificationUtil.redirectURL(t,"ManageMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.view-mass-mail",{queryParams:["module","massmailId","massmailStage","mailType","massmailType","massmailConfigId","flwuporder"],dynamicParams:["massmailId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"],ResourceConstants.CRM)},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return"primaryEmail"==t.mailType&&(t.massmailId=this.getDynamicParam()),t.massmailStage=t.massmailStage.toString(),MassMailUnificationUtil.redirectURL(t,"ViewMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js","zohocrm_massmailTemplates.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-list-mass-action.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},redirect:function(){"crm.settings.section.manage-mass-mail"==this.transition.target&&(this.transition.info.route="crm.settings.section.manage-mass-mail.index-mass-mail",this.replaceWith(this.transition.info))}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals.manage-sales-signals",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-manage-signals.js","managesignals.js","manage-signals-helpers.js"],ResourceConstants.CRMClient)},model:function(){return{}},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Signal Settings",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME})},afterModel:function(e){this.currentModel.brandName=Crm.brandName,this.currentModel.signals=store.peekAll("signal").filter(crmNTCSettings.filterOutCustomSignals),this.currentModel.extensions=store.peekAll("extensions").filterBy({type:4}),this.currentModel.widgets=store.peekAll("widgets").filterBy({type:"SALES_SIGNALS"}),this.currentModel.functions=store.peekAll("function").filterBy({category:"salessignals"}).filter(crmNTCSettings.filterOutCustomSignalCF),this.currentModel.extensionsList=store.peekAll("extensions").filterBy({type:4}),this.currentModel.filteredCategory="All"},renderTemplate:function(){return this.parent.currentModel.$.meta.manage_signals?{outlet:"#result",component:"crm-manage-signals"}:(crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3),"")},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.ntc.label.settings.notificationTitle"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.manage-tags",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-manage-tag.js","crm-tag-helpers.js","crux-tag.js","crux-color-palette.js","crm-mass-tool-header.js","lyte-colorpicker.js"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED)var t=networkUtils.returnDependencyFiles(["crm-manageTag-rtl.css"],ResourceConstants.CRMClient);else t=networkUtils.returnDependencyFiles(["crm-manageTag.css","crux-tag.css"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crm-mass-tool-header.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var r=e.concat(t);return r.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("tags")],ResourceConstants.CRM)),r.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portalmisc")],ResourceConstants.CRM)),r},model:function(e){var t=e.queryParams.module,r=[];"Activities"===e.queryParams.module&&void 0===Crm.userDetails.permissions.Crm_Implied_Tags_Tasks&&(t=1==Crm.userDetails.permissions.Crm_Implied_Tags_Events?"Events":"Calls");var s=!1;return Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&Crm.userDetails.permissions["Crm_Implied_Edit_"+t]||(s=!0),s||"Activities"!==t?s||Crm.userDetails.permissions["Crm_Implied_Tags_"+t]||(s=!0):Crm.userDetails.permissions.Crm_Implied_Tags_Tasks||Crm.userDetails.permissions.Crm_Implied_Tags_Calls||Crm.userDetails.permissions.Crm_Implied_Tags_Events||(s=!0),s?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort(),!1):(CrmTags.isFromActivityModule="Activities"===t,CrmTags.currentModule="Activities"===t?"Tasks":t,t=moduleRecordMapping[CrmTags.currentModule].api_name,store.findAll("tag",{module:t}).then((function(e){for(var t=e.length,s=[],n=0;n<t;n++)if(e[n].modified_by){var i=e[n].modified_by.id;s.contains(i)||void 0!==store.peekRecord("user",i)||s.push(i)}if(s.length>0){var o=s.length;for(let e=0;e<o;e+=100){var a=s.slice(e,e+100);r.push(store.findAll("user",{ids:a.join(",")}))}}return Lyte.resolvePromises(r).then((function(){return e}))})))},afterModel:function(e,t){this.currentModel={tagCounts:e.$.meta,tagResult:e,moduleName:CrmTags.currentModule,isFromActivityModule:CrmTags.isFromActivityModule,module_info:moduleRecordMapping[t.queryParams.module],apiName:moduleRecordMapping[CrmTags.currentModule].api_name}},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#show",component:"crm-manage-tag"}},beforeExit:function(){store.unloadAll("tag"),this.removeFromCache(networkUtils.returnDependencyFiles(["crm-manageTag.css"],ResourceConstants.CRMClient))},actions:{onError:function(e,t){var r=e.response?JSON.parse(e.response):void 0;if(r&&("NOT_SUPPORTED_FEATURE"===r.code||"NO_PERMISSION"===r.code))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),!1},willTransition:function(){store.unloadAll("tag")}}}),Lyte.Router.registerRoute("crm.settings.section.messages.channels",{getResources:function(){return[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")]},model:function(){var e={credits:store.triggerAction("imservice","credits",{service:"WHATSAPP"},{},"GET")};return Lyte.resolvePromises(e).then((function(e){return e}))},afterModel:function(e){if(e&&e.credits){var t=e.credits.message_services[0];t&&(this.currentModel.subscription=t.subscription,this.currentModel.autorenewalMessage=t.subscription&&t.subscription.auto_renewal_enabled,this.currentModel.pricing=t.pricing)}},renderTemplate:function(){return $("#im_channels_tab").html(""),$L("#im_setup_tabs")[0].openTab("im_channels_tab"),{outlet:"#im_channels_tab",component:"crm-msg-channel"}}}),Lyte.Router.registerRoute("crm.settings.section.messages",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-msg-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-msg-setup.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["lyte-progressbar.js"],ResourceConstants.CRMClient));var r=networkUtils.returnDependencyFiles(["crm-msg-setup.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],ResourceConstants.CRMClient)));var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmmessagessetup")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmwhatsappsetup")],ResourceConstants.CRM);return e.concat(t).concat(r).concat(s).concat(n)},model:function(){var e={imservices:store.findAll("imservice"),imchannels:store.findAll("imchannel")};return Lyte.resolvePromises(e).then((function(e){return e.imchannels=e.imchannels.filter((function(e){return"SMS"!==e.service.name})),e}))},afterModel:function(e){if(this.currentModel={},e.imchannels&&e.imchannels.length>0){var t=e.imchannels[0];switch(t.status){case"new_fb_requested":case"existing_fb_requested":case"existing_fb_rejected":case"fb_approved":case"number_requested":case"number_associated":this.currentModel.showCreate=!0;break;case"manually_created":this.currentModel.showCreate=!1,this.currentModel.manualCreation=!0}this.currentModel.isChannelsAvailable=!0,this.currentModel.selectedService=t.service.name}else this.currentModel.isChannelsAvailable=!1},renderTemplate:function(){return{outlet:"#result",component:"crm-msg-setup"}},afterRender:function(e){!e.showCreate&&e.isChannelsAvailable?this.transitionTo("crm.settings.section.messages.channels"):this.transitionTo("crm.settings.section.messages.services")},actions:{didTransition:function(){"crm.settings.section.messages"===this.transition.target&&this.refresh()}}}),Lyte.Router.registerRoute("crm.settings.section.messages.services",{afterModel:function(){$L("#im_setup_tabs")[0].openTab("im_services_tab")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.clone",{queryParams:["layoutId"],model:function(){var e=this.transition.info.dynamicParams[2];return Lyte.resolvePromises({views:app.store.makeRequest("findRecord","canvasview",e,{parsed:!1},void 0,void 0,{apiVersion:"v2.2"})})},afterModel:function(e){if(e.views=e.views[0],e.module=this.transition.info.dynamicParams[0],!e.views||null===e.views||e.views.$.isError)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort();var t=e.views.module.api_name,r=this.transition.info.queryParams.layoutId;return Lyte.resolvePromises({relatedlist:app.store.makeRequest("findAll","related_list",{module:t,layout_id:r})})},renderTemplate:function(e){var t=e.views.module.api_name,r=Utils.inverseKeyValues(moduleApiMapping)[t],s=document.querySelector("crm-detailview-oldeditor");s&&s.setData("loading",!0),"MobileDetailView"===s.component.data.feature?Crm.client_tracking("Canvas MobileDetailView - Clone View Click",{Module:r}):Crm.client_tracking("Canvas DetailView - Clone View Click",{Module:r}),this.editPreProcess(e.views,r).then(function(e){if($("#canvasname").val(""),this.transition.info.dynamicParams[1]!==this.transition.info.queryParams.layoutId)this.processgallery(e);else if(this.editPostProcess(e),e&&e.related_to)for(var t in e.related_to){var r=null;"data_hub_associations"===t&&(r="canvas_datahub"),"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.storeData(r||t,e.related_to[t])}s&&s.setData("loading",!1),e&&"MobileDetailView"===e.feature&&($("#zcanvas-editor-outer-body").click().disableSelection(),$(".zcfieldsidebar").click()),"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.updateStatus(!0);var n=zcanvasZoomHandler&&zcanvasZoomHandler.options;zutils.getScrollDefaultPage(n&&n.defaultBuilderAlignment)}.bind(this))}},{mixins:["crm-detailcanvas-utils","crm-canvas-common-utils","crm-canvas-builder-process","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.create",{getResources:function(){var e=[],t=[],r=[];if(Crm.isCpqActivated()&&(t=t.concat(["crm-cpq-breadcrumb.js"]),r=r.concat(["crm-cpq-breadcrumb.css"])),Crm.userDetails.isSubformNewComponentEnabled&&(t=t.concat(["crm-canvas-detail-view-subform.js","crux-subform.js"]),r=r.concat(["crux-subform.css"])),Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.userDetails.isPrivacySettingEnabled){let t=[networkUtils.returnDependencyFiles(["lyte-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)];t=t.concat(networkUtils.returnDependencyFiles(["crm-detailview-data-privacy.js","crux-parent-form-component.js","lyte-connection.elbow.js","lyte-connection.js"],ResourceConstants.CRMClient,void 0,void 0)),t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dataPrivacy")],ResourceConstants.CRM)),e=e.concat(t)}return e=(e=e.concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(){var e,t=this.parent.getRouteInstance().transition.info.dynamicParams,r=Lyte.Router.getRouteInstance().transition.info.queryParams,s=r&&r.feature?r.feature:"DetailView";e=Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)?{feature:s,page:1}:{feature:s,module:moduleRecordMapping[t[0]].api_name};var n="DetailView"===s?"detailview_customization":"mobiledetailview_customization";Lyte.resolvePromises({canvasview:store.findAll("canvasview",e),features:store.findAll("features",{api_names:n},!0,!0)}).then((function(e){var r=e.features[0].details.limits.total;if(e.canvasview.length>=r)if(Customization.moduleSpec.includes(Crm.userDetails.LICENSE_TYPE)){var s=moduleRecordMapping[t[0]].plural_label;setTimeout((function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:I18n.getMsg("crm.canvas.module.limit.exceed",["Canvas",s]),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right",ltPropWrapperClass:"crm-canvas-delete-alert"}})}),700)}else renderingUtils.showCustomAlert(I18n.getMsg("crm.canvas.limit.exceed","Canvas"))}))},renderTemplate:function(){var e=Lyte.Router.getRouteInstance().transition.info,t=e.queryParams?e.queryParams.template:void 0,r=e.queryParams&&e.queryParams.feature?e.queryParams.feature:"DetailView";if(t){var s=e.dynamicParams[0],n=document.querySelector("crm-detailview-oldeditor");n&&n.setData("loading",!0),Crm.userDetails.isCanvasStaticFilesFromCDN?this.getMetaDataAndJSONForGalleryEdit(r,"Gallery",t,s).then(function(e){Crm.isCanvasGallery=!0,e.ui.theme||(e.ui.theme=canvasTheme.getCanvasThemeJson(r)),this.processgallery(e),Crm.isCanvasGallery=!1,n&&n.setData("loading",!1)}.bind(this)):networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CanvasGallery.do?action=getCustomisedDetailViewGallery&module="+s+"&type="+t+"&preview=false","GET",void 0).then(function(e){Crm.isCanvasGallery=!0,e.ui.theme||(e.ui.theme=canvasTheme.getCanvasThemeJson(r)),this.processgallery(e),Crm.isCanvasGallery=!1,n&&n.setData("loading",!1)}.bind(this)),Crm.client_tracking("CanvasGallery Edit landing",{template:t,Module:s}),$L(".canvas-page-container").attr("data-canvassrc",t)}else setTimeout((function(){var e=$L("crm-detailview-canvas-gallery")[0],t=document.getElementById("canvas-gallery");t&&t.ltProp("show",e.component.getData("openGallery"))}),500)}},{mixins:["crm-detailcanvas-utils","crm-canvas-common-utils","crm-canvas-builder-process","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.edit",{getResources:function(){var e=[],t=[],r=[];if(Crm.isCpqActivated()&&(t=t.concat(["crm-cpq-breadcrumb.js"]),r=r.concat(["crm-cpq-breadcrumb.css"])),Crm.userDetails.isSubformNewComponentEnabled&&(t=t.concat(["crm-canvas-detail-view-subform.js","crux-subform.js"]),r=r.concat(["crux-subform.css"])),Crm.userDetails.DETAIL_VIEW_LYTE&&Crm.userDetails.isPrivacySettingEnabled){let t=[networkUtils.returnDependencyFiles(["lyte-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)];t=t.concat(networkUtils.returnDependencyFiles(["crm-detailview-data-privacy.js","crux-parent-form-component.js","lyte-connection.elbow.js","lyte-connection.js"],ResourceConstants.CRMClient,void 0,void 0)),t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("dataPrivacy")],ResourceConstants.CRM)),e=e.concat(t)}return e=(e=e.concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},model:function(){var e=this.transition.info.dynamicParams[2],t=this;return app.store.makeRequest("findRecord","canvasview",e,{parsed:!1},void 0,void 0).then((function(e){return Lyte.resolvePromises({views:e})})).catch((function(e){Lyte.registeredMixins["crm-detailcanvas-utils"].errorHandling(e),t.transition.abort()}))},afterModel:function(e){e.views=e.views[0],e.module=this.transition.info.dynamicParams[0];var t=this.transition.info.queryParams?this.transition.info.queryParams:{};return!e.views||null===e.views||e.views.$.isError?(this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()):t.feature&&t.feature!==e.views.feature?(this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("crm.unable.to.process.request")},void this.transition.abort()):store.findAll("canvas_rule",{},null,null,{customizationId:this.transition.info.dynamicParams[2]})},renderTemplate:function(e){if(!this.transition.data||!this.transition.data.disablePopup){$(".dummy_Body").hide();var t=document.querySelector("crm-detailview-oldeditor");t&&t.setData("loading",!0),e.views.ui.script_info&&(t.setData("editsysidmapping",e.views.ui.script_info.mapping||{}),Customization.sysidmapping=objectUtils.cloneObject(e.views.ui.script_info.mapping||{}),t.setData("lastsavedmapping",objectUtils.cloneObject(e.views.ui.script_info.mapping)||{})),setTimeout(function(){this.editPreProcess(e.views,e.module).then(function(r){var s;if($("#canvasname").val(r.name),this.editPostProcess(r),t&&t.setData("loading",!1),r&&"MobileDetailView"===r.feature?(s=$("#zcanvas-editor-outer-body"),$("#zcanvas-editor-outer").css("height",e.views.ui.value.position.height),s.addClass("flexOne")):s=$("#zcanvas-editor-outer"),s.click().disableSelection(),$(".zcfieldsidebar").click(),e.views.ui&&e.views.ui.value&&e.views.ui.value.system_id&&e.views.ui.script_info&&e.views.ui.script_info.mapping&&e.views.ui.script_info.mapping[e.views.ui.value.system_id]&&s.data("zcanvasdata",{systemid:e.views.ui.value.system_id,elementname:e.views.ui.script_info.mapping[e.views.ui.value.system_id].element_name}),e.views&&e.views.related_to)for(var n in e.views.related_to){var i=null;"data_hub_associations"===n&&(i="canvas_datahub"),"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.storeData(i||n,e.views.related_to[n])}"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.updateStatus(!0);var o=zcanvasZoomHandler&&zcanvasZoomHandler.options;zutils.getScrollDefaultPage(o&&o.defaultBuilderAlignment)}.bind(this))}.bind(this),10)}}},{mixins:["crm-detailcanvas-utils","crm-canvas-builder-process"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.import",{model:function(){const e=decodeURIComponent(this.transition.info.queryParams.key);var t={import_token:e},r=this.transition.info.dynamicParams[0],s=moduleApiMapping[r],n=this.transition.info.dynamicParams[1],i=this;return Lyte.resolvePromises({views:store.triggerAction("canvasview","import",null,t,"GET").then((function(e){return e.canvas_view&&e.canvas_view[0]&&e.canvas_view[0].ui&&!e.canvas_view[0].ui.theme&&(e.canvas_view[0].ui.theme=canvasTheme.getCanvasThemeJson(i.transition.info.queryParams.feature)),e.canvas_view})).catch((function(t){if(t){var r=e?i.getImportErrorMessage(JSON.parse(t.responseText).code):I18n.getMsg("crm.canvas.import.key.cannot.empty");_cruxUtils.showCustomMessage({params:{ltPropMessage:r,ltPropType:"error",ltPropDuration:"6000"}})}})),relatedlist:app.store.makeRequest("findAll","related_list",{module:s,layout_id:n})})},renderTemplate:function(e){var t=this.transition.info.dynamicParams[0],r=document.querySelector("crm-detailview-oldeditor");if(r&&r.setData("loading",!0),e.views)this.processgallery(e.views[0]),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.import.template.success"),ltPropType:"success"}});else{var s=this.transition.info.dynamicParams[0],n=moduleApiMapping[s],i=this.transition.info.dynamicParams[1];$L("crm-detailview-oldeditor").length&&(Lyte.Router.transitionTo({route:"crm.settings.section.modules.module.canvas.create",dynamicParams:[n,i]}),setTimeout((function(){location.reload()}),150))}r&&r.setData("loading",!1),"MobileDetailView"===r.component.data.feature?(Crm.client_tracking("Canvas MobileDetailView - Import View",{Module:t}),$("#zcanvas-editor-outer-body").click().disableSelection(),$(".zcfieldsidebar").click()):Crm.client_tracking("Canvas DetailView - Import View",{Module:t})}},{mixins:["crm-detailcanvas-utils","crm-canvas-builder-process","crm-canvas-core-gallery"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas",{getDependencies:function(){Crm.userDetails.RTL_ENABLED&&"DetailView"===this.transition.info.queryParams.feature&&Lyte.Router.transitionTo("crm.settings.section.canvas-builder.listview",[],{feature:"ListView"});var e=["crm-canvasrule-model.js","crm-detailcanvas-utils.js","canvasview_model.js","features_model.js","custom_link_model.js","crm-model-kiosk.js"];e="MobileDetailView"===this.transition.info.queryParams.feature?e.concat(["crm-canvas-mobile-utils.js"]):e.concat(["campaign_status_model.js"]),!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&(e=e.concat(["crm-abm-configuration.js"]));var t=[];return t=t.concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))},getResources:function(){Crm.userDetails.RTL_ENABLED&&"DetailView"===this.transition.info.queryParams.feature&&Lyte.Router.transitionTo("crm.settings.section.canvas-builder.listview",[],{feature:"ListView"});var e=["lyte-colorpicker.js","lyte-fileupload.js","lyte-shortcut.js","lyte-screengrab.js","lyte-colorbox.js","lyte-ui-emoji.css","crm-zdesk-rl-all.js","crm-circuits-rl-all.js","crm-detail-view-utils.js","crm-create-mixin.js","crm-canvas-editor-component.js","crm-canvas-core-builder.js","crm-canvas-core.js","crm-canvas-common-utils.js","calls-button.js","series_entityseries.js","crm-canvasform.js","crm-formview-mixin.js","crm-canvas-common.js","crm-canvasview.js","crm-canvas-helpers.js","crm-canvas-export.js","crm-detailview-canvas-gallery.js","crm-canvas-import-button.js","crm-canvas-designer.js","crm-canvas-rename-popup.js","crm-skype-field.js","crm-image-mixin.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","social_related_list_store.js","crm-image-preview.js","crm-related-list-view-header.js","crm-related-list-action-wrapper.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-macro.js","macro-model.js","crm-column-list.js","crm-activity-rel.js","crm-list-helpers.js","crm-tag.js","crm-tag-modal.js","crm-tag-mixin.js","delete-popup.js","crm-social-convo-inner-new.js","crm-cloud-picker-mixin.js","crm-detailview-common-footer.js","servapp_preferences_model.js","note_model.js","reviewprocess_model.js","crm-email-rl-filter.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js","crm-canvas-profile-image.js","nba-detail-page.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js","crm-detailview-canvas-gallery.css","admin-email-sharing-model.js","email-sharing-alert.js","crm-email-field.js","crm-emailsai-config.js","email-emotions.js","zia-notification-settings.js","zia-insights.js","zia-helpers.js","zia_reminder_model.js","crm-activity-rel-wrapper.js","crux-lookupfilter-component.js","crux-column-list.js","crux-note.js","crux-video.js","crux-tag.js","crm-zexpense-rl.js","crm-subscription-rl.js","crm-custom-rl.js","crm-related-list-checklist.js","crm-zfinance-rl.js","crm-related-list-view-header.js","crm-feed-follower-datastore.js","crm-follower.js","crm-inventory-detail-view.js","crm-zexpense-rl.css","crm-zfinance-rl-all.css","crm-zfinance-stock-info.css","crm-subscription-rl.css","crux-color-palette.js","crux-textautocomplete-options.js","crm-zdesk-rl-label.js","crm-circuits-helper.js","crm-circuits-mixin.js","crm-circuits-rl-label.js","crm-detail-canvas-common-files.js","crm-activity-edit-delete-view-icon-canvas-helpers.js","crm-uploadfields-mixin.js","crux-image-upload.js","crm-emails-related-list.js"],t=["canvas-detailview-less.css","crm-canvas-export.css","crux-image-component.css","crm-image-upload-component.css","crux-file-upload-component.css","crm-file-upload-component.css"],r=["zcrm_customization.js"],s=[networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("chronologicalview"),networkUtils.getI18nJSUrl("emailsForAllModules")];Crm.userDetails.isSubformNewComponentEnabled&&(t=t.concat(["crux-subform.css"]),e=e.concat(["crm-canvas-detail-view-subform.js","crux-subform.js"])),r=Crm.userDetails.detailView_newUI?r.concat(["zcrm_dataprivacy_view_new.js"]):r.concat(["zcrm_dataprivacy_view.js"]),Crm.userDetails.isSegmentationEnabled&&(e=e.concat(["related-list-rfm.js","segmentation-utils.js","related-list-rfm.css"]),s=s.concat([networkUtils.getI18nJSUrl("segmentation")])),Crm.seriesEnabled&&(e=e.concat(["series_store.js"]));var n=[],i=featuresAvailable.DATA_HUB&&"DetailView"===this.transition.info.queryParams.feature;return n=(n=n.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:[{parent:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM),child:i?networkUtils.returnDependencyFiles(["zohocrm_canvas_integrations.js"],ResourceConstants.CRM):[]}]}])).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css","crm-canvas-mobile.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crm-canvas-designer.css","crm-canvas-rename-popup.css","crm-msg-related-list.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-rl-users-list.css","crm-list-view-crux.css"],ResourceConstants.CRMClient)}]),"MobileDetailView"===this.transition.info.queryParams.feature?(e=e.concat(["crm-mobile-component.js","lyte-progressbar.js"]),t=t.concat(["crm-mobile-components.css"]),n=n.concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css","crm-canvas-mobile.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crm-canvas-designer.css","crm-canvas-rename-popup.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-rl-users-list.css","crm-list-view-crux.css"],ResourceConstants.CRMClient)}])):(e=e.concat(["crm-zdesk-rl-label.js","crm-circuits-helper.js","crm-circuits-mixin.js","crm-circuits-rl-label.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia/prediction/builder/field-prediction-result.js","zia/prediction/builder/churn-prediction-result.js","zia/scoring_rule/zia-score-result.js","setup/orchestration/crm-orchestration-detailview-pop.js","setup/pathfinder/crm-pathfinder-detailview-pop.js","crm-rl-share-email.js","recommendation-detailed-main.js","crm-detail-view-data-privacy.js","crm-social-integ-outer-template.js","crm-attachments.js","recommendation-util.js","besttime_zia_new_model.js","crm-territory-helper.js","crm-assign-territory-detail-view.js","crm-territory-crux-components.js","crm-territory-common-utils.js","lyte-tree.js"]),n=n.concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css","crm-canvas-mobile.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crm-canvas-designer.css","crm-canvas-rename-popup.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","crm-list-view-crux.css","crm-circuits-rl-all.css"],ResourceConstants.CRMClient)}]),Crm.userDetails.RTL_ENABLED&&(r=r.concat(["zcanvas-rtl.css"])),s=s.concat([networkUtils.getI18nJSUrl("zdeskrelatedlist"),networkUtils.getI18nJSUrl("circuits"),networkUtils.getI18nJSUrl("crossorgs"),networkUtils.getI18nJSUrl("emailsummary"),networkUtils.getI18nJSUrl("crrl"),networkUtils.getI18nJSUrl("emailsRelatedList"),networkUtils.getI18nJSUrl("salesnavigator"),networkUtils.getI18nJSUrl("richtext"),networkUtils.getI18nJSUrl("Recommendation-detail"),networkUtils.getI18nJSUrl("SimilarityRecommendation"),networkUtils.getI18nJSUrl("assignterritory")]),r=r.concat(["zohocrm_clientPortalMiscFuncs.js","zohocrm_lookupBusinessCard.js","zohocrm_ProcessFlow.js"]),t=t.concat(["crux-note.css","crm-richtext-resources-less.css","crm-zia-call-analytics.css","crm-zia-call-transcription.css","zia/nba/nba-common.css","lyte-ui-editor.css","crm-assign-territory-detail-view.css","crux-territory.css"]),Crm.userDetails.timelineRevamp&&(s=s.concat([networkUtils.getI18nJSUrl("timeline"),networkUtils.getI18nJSUrl("journeys")]),t=t.concat(["crm-timeline.css","crm-notes-timeline.css","crm-journeys.css"])),featuresAvailable.ZIA_RECORD_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_Generate_Zia_Record_Summary&&(s=s.concat([networkUtils.getI18nJSUrl("ZiaSummary")]),e=e.concat(["crm-zia-record-summary.js","crm-zia-feedback.js"]),t=t.concat(["crm-zia-record-summary.css","crm-zia-feedback.css"])),Crm.userDetails.RTL_ENABLED&&(e=e.concat(["crm-circuits-rtl.css"])),Crm.userDetails.EMAIL_THREAD_VIEW&&(e=e.concat(["crm-emailconversation-view.js","crm-emailconversation-view-helpers.js"]),s=s.concat([networkUtils.getI18nJSUrl("emailthreadview")])),"Activities"!==this.transition.info.dynamicParams[0]&&(e=e.concat(["crm-image-upload.js","crm-image-upload-create.js","exif-plugin.js","crm-vision-create.js","crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css","lyte-cropper.js"]),s=s.concat([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("scoringRulesChart")]),Crm.userDetails.RTL_ENABLED&&(e=e.concat(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"]))),"Campaigns"===this.transition.info.dynamicParams[0]&&(e=e.concat(["lyte-step.js","crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js","crm-campaigns-detail-view.css","crm-setup-campaign-index.css"]),r=(r=r.concat(networkUtils.includeChartFiles())).concat(["crm_finance_suite.js"]),s=s.concat([networkUtils.getI18nJSUrl("campaignsdetail"),networkUtils.getI18nJSUrl("zohowebinar")])),Crm.vocEntityModules&&Crm.vocEntityModules.contains(this.transition.info.dynamicParams[0])&&(e=e.concat(["voc-entity-store.js","voc-common-store.js","voc-common-utils.js","voc-entity.js","voc-component-store.js","gamescope-grid.js"])),"Potentials"!==this.transition.info.dynamicParams[0]&&"Deals"!==this.transition.info.dynamicParams[0]||(s=s.concat([networkUtils.getI18nJSUrl("detailview_stage")])),"Tasks"!==this.transition.info.dynamicParams[0]&&"Calls"!==this.transition.info.dynamicParams[0]&&"Events"!==this.transition.info.dynamicParams[0]||(e=e.concat(["crm-detail-view-initial-files.js","crm-msg-utils.js","crm-detailview-helpers.js"])),"Calls"===this.transition.info.dynamicParams[0]&&(e=e.concat(["phone-entity.js","lyte-voicenote.js","lyte-multislider.js","call-transcription-comp.js","calls-button.js"]),s=s.concat([networkUtils.getI18nJSUrl("calls_detailview")]),t=t.concat(["lyte-ui-voicenote.css"])),"Events"!==this.transition.info.dynamicParams[0]&&"Appointments"!==this.transition.info.dynamicParams[0]||(e=e.concat(["crm-events-view-utils.js","crm-detailview-helpers.js"])),"Services"!==this.transition.info.dynamicParams[0]&&"Appointments"!==this.transition.info.dynamicParams[0]||(e=e.concat(["crm-services-appointments.js"])),"Services"===this.transition.info.dynamicParams[0]&&(s=s.concat([networkUtils.getI18nJSUrl("servicesDetailView")]))),moduleRecordMapping.Services&&(e=e.concat(["crm-services-appointments.js"])),n=(n=(n=(n=n.concat(networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(s,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(r,ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){var e=this.transition.info.dynamicParams[0];if("MobileDetailView"===this.transition.info.queryParams.feature&&!Crm.userDetails.CANVAS_MOBILE_SUPPORT)return renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error")),void this.transition.abort();var t=this;return this.isTeamModulehasAccess(moduleRecordMapping[e])?app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,void 0,void 0,!0,{getOnlyMeta:!1,getExternalFields:!0}).then((function(r){var s=[];if(moduleRecordMapping[e].fields.forEach((function(e){if("subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type){var t=e.subform.id;s.push(store.findRecord("module",t))}})),s.push(app.store.makeRequest("findAll","canvas_rule",{module:moduleApiMapping[e]})),t.isGDPREnabledForModule(moduleApiMapping[e])){let e=t.getRequiredConsentFieldsColumnNames(r[0].fields);e.length>0?store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(t){let n=t.length;for(let s=0;s<n;s++)e.includes(t[s].column_name)&&(r[0].fields.push(t[s]),e.splice(s,1));s.push(r)})):s.push(r)}else s.push(r);return!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&s.push(t.getAccountConfiguration()),Lyte.resolvePromises(s).then((function(){var r=store.peekAll("module").find((function(t){return t.module_name===e})).api_name;!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&crmTab.ABMConfiguredModule===r&&t.injectABMWidgetResources()}))})).catch((function(e){if("NO_PERMISSION"===JSON.parse(e.responseText).code)return renderingUtils.displayPermissionDenied(),void t.transition.abort();t.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[t.transition.info.dynamicParams[0]]}).data={showError:!0,module:t.transition.info.dynamicParams[0],errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")}})):(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.transitionTo("crm.settings")})),void this.transition.abort())},lyteConvertionSupported:!0,model:function(){var e=this.transition.info.dynamicParams[0];e="Deals"===e?"Potentials":e;var t=moduleApiMapping[e],r=this.transition.info.dynamicParams[1];0!==Object.keys(this.transition.info.queryParams).length&&""!==this.transition.info.queryParams.feature||(Lyte.Router.getRouteInstance().setQueryParams({feature:"DetailView"}),this.transition.info.queryParams.feature="DetailView");var s={feature:this.transition.info.queryParams.feature,module:e,layout_id:r},n=this,i=networkUtils.lyteInitiateRequest("/crm/v2/settings/canvas/views/components","GET",{params:s}),o={module:t,include:"portal_user_types"};return"Events"===e&&(o.mode="view"),i.then((function(s){var n={link:["Events","Services","Appointments"].indexOf(e)<0?app.store.makeRequest("findAll","custom_link",{module:t}):[],layout:app.store.makeRequest("findRecord","layout",r,o,!1,!0,{apiVersion:"2.2",include_external_fields:!0}),button:Lyte.registeredMixins["crm-view-utils"].isCustomButtonSupportedForModule(e)?app.store.makeRequest("findAll","custom_button",{module:t},!1,!0,{isV6Api:!0}):[],relatedlist:app.store.makeRequest("findAll","related_list",{module:t,layout_id:r}),components:s,iscanvasflexlayoutAvailable:store.findAll("features",{api_names:"canvas_flex_layout"}).then((function(e){return void 0!==e}),(function(){return!1}))};if(Crm.isKioskEnabled&&featuresAvailable&&featuresAvailable.KIOSK_ZIA_CANVAS_ENABLED&&(n.kiosks_list=app.store.makeRequest("findAll","kiosk",{include_inner_details:"kiosk.associated_places,home_page.page"})),Crm.userDetails.isCanvasStaticFilesFromCDN){var i=Lyte.Router.getRouteInstance().transition.info.queryParams.feature;n.presetMeta=store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/CanvasGallery.do?action=getFeatureStaticMeta&module="+e+"&feature="+i+"&subfeature=Presets",method:"GET"})}return Lyte.resolvePromises(n).then((function(e){return e.relatedlist=e.relatedlist.filter((e=>"component"!==e.type)),e}))})).catch((function(e){n.errorHandling(e),n.transition.abort()}))},afterModel:function(e){store.findAll("features",{api_names:"canvas_detailview_rl_scope"});var t=this.transition.info.dynamicParams[0];e.module=t,store.findAll("features-status",{module:moduleRecordMapping[t].api_name,group:"zia",page:1,per_page:20});var r=this.transition.info.queryParams,s=r.feature?r.feature:"DetailView",n=["Visits","Activities","Tasks","Events","Calls","Campaigns","Services__s","Appointments__s","messages__s"];"DetailView"===s&&Crm.userDetails.isCanvasActivitySupportEnabled&&Lyte.arrayUtils(n,"removeObjects",["Tasks","Events","Calls","Services__s","Appointments__s"]),e.moduledata=store.peekRecord("module",moduleRecordMapping[t].id);var i=e.moduledata?e.moduledata.api_name:void 0,o=n.indexOf(i)>0,a=!1,l=I18n.getMsg("canvas.not.accessible",I18n.getMsg("crm.canvas.title"));if(!Crm.userDetails.IS_ADMIN&&!e.moduledata.viewable)return renderingUtils.displayPermissionDenied(),void this.transition.abort();if(!e.layout||"object"==typeof e.layout&&0===objectUtils.getLength(e.layout)?(a=!0,l=I18n.getMsg("canvas.not.accessible",I18n.getMsg("crm.lable.layout"))):o&&(a=!0,l=I18n.getMsg("canvas.notsupported.module",[e.moduledata.module_name,I18n.getMsg("crm.lable.layout")])),a)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:l},void this.transition.abort();e.layoutId=this.transition.info.dynamicParams[1];var c,u=this.transition.info.route.split(".").pop(),d=this.transition.info.queryParams.id;if(e.feature=s,this.transition.info.dynamicParams[2]&&"clone"!==u&&(e.viewId=this.transition.info.dynamicParams[2]),"Deals"!==t&&"Potentials"!==t||(e.stage=app.store.makeRequest("findAll","stage",{module:"Deals",layout_id:e.layoutId})),!moduleRecordMapping[e.module].viewable)return e.entityId=null,void(e.record={});var m=Crm.latestEntId;if(m)c=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,m,{approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"});else if(d)c=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,d,{approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"});else if(e.moduledata.layouts&&1===e.moduledata.layouts.filterBy({status:"active"}).length)c=app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{per_page:1,approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"});else{var p={comparator:"equal",field:{api_name:"Layout"},value:[e.layoutId]};c=app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{filters:JSON.stringify(p),per_page:1,approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"})}return c.then((function(r){e.entityId=r[0]?r[0].id:null;var s,n,i=!1,o=!1,a=!1;if(r[0]){var l=store.peekRecord(moduleRecordMapping[e.module].id,r[0].id);i=!!l&&l.$process_flow,o=!!l&&l.$stop_processing,a=!!l&&(l.$locked_for_me&&!l.$editable)}if(!i||o||a){var c=Lyte.registeredMixins["crm-detailcanvas-utils"];c.blueprintFldId=void 0,c.isBluePrintTrans=!1}else s=networkUtils.lyteInitiateRequest("/crm/v2.2/"+moduleApiMapping[t]+"/"+e.entityId+"/actions/blueprint","GET");return d||m?e.record=e.entityId?store.peekRecord(moduleRecordMapping[e.module].id,r[0].id):{}:e.entityId?(e.anotherReq=!0,n=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,r[0].id,{approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"})):e.record={},Lyte.resolvePromises({record:n,isBluePrintTrans:s}).then((function(e){if(e.isBluePrintTrans){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.blueprintFldId=e.isBluePrintTrans.blueprint.process_info.field_id,t.isBluePrintTrans=!!e.isBluePrintTrans.blueprint.transitions.length,t.showStage="Stage"!==e.isBluePrintTrans.blueprint.process_info.api_name}}))}))},renderTemplate:function(e){var t=Lyte.Router.getRouteInstance().transition,r=t.info.queryParams?t.info.queryParams.feature:"DetailView";return e.anotherReq&&(e.record=store.peekRecord(moduleRecordMapping[e.module].id,e.entityId)),Canvas&&Canvas.builderConfig&&(Canvas.builderConfig.builderMode="DetailView",window.zcanvasGlobalConfig=Canvas.builderConfig.currentConfig=Canvas.builderConfig.configs.DetailView),"MobileDetailView"===r&&(Canvas.builderConfig.builderMode=r),{component:"crm-detailview-oldeditor",outlet:"#canvasEditorDiv"}},afterRender:function(e){var t=Lyte.Router.getRouteInstance(),r=t.transition,s=t.routeName,n=r.info.queryParams?r.info.queryParams.feature:"DetailView";Canvas.builderConfig.builderMode=n,Canvas&&Canvas.builderConfig&&(Canvas.builderConfig.init.bind(this)(e),"create"!==s&&"import"!==s||"undefined"!=typeof zcanvasPluginHandler&&zcanvasPluginHandler.updateStatus(!0))},beforeExit:function(){app.cachedModulePromises={},app.reqCache={}},actions:{willTransition:function(e){if("crm.crm-error"!==e.info.route){var t=document.querySelector("crm-detailview-oldeditor"),r=t?t.getData():{},s=e.data&&e.data.disablePopup;if(r.changed&&!s){var n=e.pause(),i="stayonPageConfirmBox",o=$("#"+i);renderingUtils.freezeBackground(),mailsetCenter(i),o.find(".leavePage").off("click").click((function(){"undefined"!=typeof autoSaveTimer&&clearTimeout(autoSaveTimer),$("#stayonPageConfirmBox").hide(),Lyte.registeredMixins["crm-canvas-builder-process"].flusheditor();var e=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];n.resume(),e.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled&&(e.routeChange=!1,setTimeout((function(){e.reDirectHandle(e.moduleData)}),100)),renderingUtils.removeFreezeLayer()})),o.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort();var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];t.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled&&(t.routeChange=!1),renderingUtils.removeFreezeLayer()})),o.focus()}else"undefined"!=typeof autoSaveTimer?clearTimeout(autoSaveTimer):r.changed||!e.info.route||e.info.route.indexOf("crm.settings.section.modules.module.canvas.edit")>-1||this.flusheditor()}}}},{mixins:["crm-detailcanvas-utils","crm-abm-utils","crm-canvas-builder-process","crm-canvas-common-utils","crm-canvas-core-construct-component","crm-canvas-core-gallery","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.index-modules.create-module",{queryParams:["moduleType"],getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["dataparam-gallery.js","custom-dataparam.js","dataparam-mixin.js","crm-subform-static-mapping-content.js","crm-static-subform-notification.js"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["dataparam-gallery/dataparam-gallery.css","crm-subform-static-mapping-content.css","custom-dataparam/custom-dataparam.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=(e=(e=(e=(e=(e=e.concat(t)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RollupSummary")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("picklistcommonsortorder")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModuleBuilder")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("StaticSubform")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("globalpicklist")],ResourceConstants.CRM)),featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-teamspace-permission.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-teamspace-permission.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM))),this.transition.info.queryParams.moduleType&&"team"===this.transition.info.queryParams.moduleType&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["multilookup-list.js","crux-column-list.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["multilookup-list.css"],ResourceConstants.CRMClient))),e},beforeModel:function(){!0===featuresAvailable.NEXTGENUI_ENABLED&&!0===featuresAvailable.TEAMSPACE_ENABLED&&networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do?action=addPrivateProfiles","POST")},model:function(e){void 0===this.getQueryParams().moduleType&&(this.getQueryParams().moduleType="custom");var t={params:{action:"showModuleBuilder",operation:"create",moduleType:this.getQueryParams().moduleType}};return networkUtils.setCsrfParam(t),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",t)},afterModel:function(e,t){var r=!1,s=Lyte.Component.registeredHelpers.getI18n("crm.not.available.msg");if(0===e.indexOf("ALERT:::")){if((l=e.split("ALERT:::")).length>2)if(void 0!==featuresAvailable.NEXTGENUI_ENABLED&&!0===featuresAvailable.NEXTGENUI_ENABLED){var n=l[1]+" "+l[2],i=$L("crm-modules-list-page")[0].component;if(Crm.userDetails.isCustomModuleNewLimitAccessible){i.setData("customModuleCreationAllowed",!1);var o=Crm.userDetails.TEAM_MODULE_ENABLED?"custom.module.create.limit.alert.with.team.space":"custom.module.create.limit.alert",a=Lyte.Component.registeredHelpers.getI18n(o,Crm.userDetails.CustomModuleCount);_cruxUtils.showCustomMessage({params:{ltPropMessage:a+'<span data-zcqa="learn-helplink" class="crmLinkColor cP" onclick="CML.onHelpClick()"> Learn More</span>',ltPropType:"error",ltPropDuration:5e3,ltPropYield:!0}})}else i.setData("showCustomModuleLimitReachedNoteErrorMessage",!0),i.setData("customModuleLimitReachedNoteErrorMessage",n)}else CML.showModuleDeleteErrorWithTip(l[1],l[2]);else if(void 0!==featuresAvailable.NEXTGENUI_ENABLED&&!0===featuresAvailable.NEXTGENUI_ENABLED){i=$L("crm-modules-list-page")[0].component;if(e===s)i.setData("customModuleLimitReachedNoteErrorMessage",s),i.setData("showCustomModuleLimitReachedNoteErrorMessage",!0);else if(Crm.userDetails.isCustomModuleNewLimitAccessible){o=Crm.userDetails.TEAM_MODULE_ENABLED?"custom.module.create.limit.alert.with.team.space":"custom.module.create.limit.alert",a=Lyte.Component.registeredHelpers.getI18n(o,Crm.userDetails.CustomModuleCount);_cruxUtils.showCustomMessage({params:{ltPropMessage:a+'<span data-zcqa="learn-helplink" class="crmLinkColor cP" onclick="CML.onHelpClick()"> Learn More</span>',ltPropType:"error",ltPropDuration:5e3,ltPropYield:!0}})}else i.setData("customModuleLimitReachedNoteErrorMessage",l[1]),i.setData("showCustomModuleLimitReachedNoteErrorMessage",!0)}else if(Crm.userDetails.isCustomModuleNewLimitAccessible){o=Crm.userDetails.TEAM_MODULE_ENABLED?"custom.module.create.limit.alert.with.team.space":"custom.module.create.limit.alert",a=Lyte.Component.registeredHelpers.getI18n(o,Crm.userDetails.CustomModuleCount);_cruxUtils.showCustomMessage({params:{ltPropMessage:a+'<span data-zcqa="learn-helplink" class="crmLinkColor cP" onclick="CML.onHelpClick()"> Learn More</span>',ltPropType:"error",ltPropDuration:5e3,ltPropYield:!0}})}else CrmModule.notifyUser("alert",l[1],5e3);CrmModule.toggleBusy("primaryBtnLayer",!0),r=!0,this.transition.abort()}else if(0===e.indexOf("ERROR:::")){var l=e.split("ERROR:::");showErrorMessagePopUp(l[1]),r=!0,this.transition.abort()}else if(0===e.indexOf("COUNTEXCEED:::")){l=e.split("COUNTEXCEED:::");showErrorMessagePopUp(l[1]),r=!0,this.transition.abort()}if(r){var c=document.querySelector("crm-left-menu");c&&c.component&&c.component.methods.hideContentLoader(),Lyte.Router.transitionTo({route:"crm.settings.section.modules.index-modules"})}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){featuresAvailable.NEXTGENUI_ENABLED&&(document.querySelector("crm-left-menu").component.methods.hideContentLoader(),$L(".nextGenUILeftMenu").hide());CrmModule.arrangeBuilder(!0),$("#setupshow").hide(),$("#result").html(""),$("#moduleCustomizationDiv").show(),$("#moduleCustomizationDiv").hasClass("createLayout")&&$("#moduleCustomizationDiv").removeClass("createLayout"),$("#moduleCustomizationDiv").addClass("createModule"),$("#moduleCustomizationDiv").find("#actionNavDiv").hide(),$("#moduleCustomizationDiv").find("#innerTabDiv").hide(),$("#customActionDiv").hide(),$(".moduleNameSection").hide(),$("#layout_landing_left").hide(),$("#customizationDiv").removeClass("p30 pT20").show();var r="create",s={params:{action:"getNewFieldButtonDetails",operation:r,moduleType:this.getQueryParams().moduleType}};networkUtils.setCsrfParam(s);var n=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",s),i={params:{action:"getExistedSectionAndFieldDetails",operation:r,moduleType:this.getQueryParams().moduleType}},o={params:{action:"getRelatedListFieldDetails",operation:r}};networkUtils.setCsrfParam(i);var a=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",i);return CrmPageLayout.resetChanges(),CML.builderOperation=r,Lyte.resolvePromises({newFields:n,existedFields:a}).then(function(e){CML.designNewFieldsAndButtons(e.newFields,"create"),CML.designExistingSectionAndFields(e.existedFields,"create"),networkUtils.setCsrfParam(o),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",o).then((function(e){CMB.designExistingRelatedListFieldDetails(e.rLDtls)}))}.bind(this))},showErrorMessagePopUp:function(e){if(featuresAvailable.NEXTGENUI_ENABLED){var t=$L("crm-modules-list-page")[0].component;t.setData("showCustomModuleLimitReachedNoteErrorMessage",!0),t.setData("customModuleLimitReachedNoteErrorMessage",e)}else CrmModule.notifyUser("alert",e,5e3);CrmModule.toggleBusy("primaryBtnLayer",!0)},actions:{willTransition:function(e){if("crm.settings.section.modules"!==e.target&&"crm.settings.section.modules.index-modules"!==e.target||(e.data={refreshNeeded:!0}),Events.isPageLayoutModified){var t=e.pause(),r="stayonPageConfirmBox",s=$("#"+r);renderingUtils.freezeBackground(),mailsetCenter(r),s.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),renderingUtils.removeFreezeLayer(),Events.isPageLayoutModified=!1;var e=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];e.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled?(e.routeChange=!1,e.reDirectHandle(e.moduleData)):t.resume()})),s.find(".stayPage").off("click").click((function(){if($("#stayonPageConfirmBox").hide(),Crm.userDetails.isKeyboardShortcutsEnabled){var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];t.routeChange=!1,t.moduleData={}}e.abort(),renderingUtils.removeFreezeLayer()})),s.focus()}}},beforeExit:function(){var e=$("#moduleCustomizationDiv");$("#setupshow").show(),$("#mainMenuTabDiv").show(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").show(),e.find("#actionNavDiv").show(),e.find("#innerTabDiv").show(),e.hide().removeClass("createModule"),e.removeClass("notNewSetupView"),$L("body").removeClass("builder_page_body")}}),Lyte.Router.registerRoute("crm.settings.section.modules.index-modules",{queryParams:["showOrganizeMod"],refreshNeeded:!1,getResources:function(){var e=[];return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-invalid-formula-popup.js","crm-custom-module-limit-card.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["modules-list-page.js","modulelist_variable.js","modules-list-page-helper.js","modules-list-page-profiles-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-lazyLoad.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_modulesListPageNew.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-invalid-formula-popup.css","crm-custom-module-limit-card.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-modules-list-page.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createrecordaction")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FormulaInvalidBanner"),networkUtils.getI18nJSUrl("EmailParser")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModulesListPage")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CrmPermissionPopup")],ResourceConstants.CRM))},lyteConvertionSupported:!0,model:function(e){if(featuresAvailable.NEXTGENUI_ENABLED)return{};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",{params:{action:"moduleList"}})},renderTemplate:function(e){return featuresAvailable.NEXTGENUI_ENABLED?{outlet:"#result",component:"crm-modules-list-page"}:{outlet:"#result",html:e}},afterRender:function(){"true"===this.getQueryParams().showOrganizeMod&&!0!==featuresAvailable.NEXTGENUI_ENABLED&&(crmSetup.selectSetupTabByRoute(this.transition.target,this.transition.info),setTimeout((function(){CML.showManageModule("show")}),100)),$("#mainMenuTabDiv").show(),$L(".nextGenUILeftMenu").show();var e=document.querySelector("#mainMenuTabDiv");if(e){var t=e.querySelector("crm-tab");t&&t.component&&t.component.resizeMenu()}var r=this.transition.data;if(null!=r&&"true"===r.showLeadStatus){var s=$("#leadLayoutId").val();null!=s&&CMB.showSpecialFieldPopup("LeadStatusMap","true",s,void 0,void 0,"Leads")}if(gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_MODULES").PF_ACCESSED_MODULES,RebrandLinkUtil.getProperties("PF_ACCESSED_MODULES_ID").PF_ACCESSED_MODULES_ID),!0===featuresAvailable.NEXTGENUI_ENABLED&&(window.onbeforeunload=function(e){if(void 0!==store.model.module.dirty&&0!==store.model.module.dirty.length)return(e=e||window.event)&&(e.returnValue="Sure?"),"Sure?"}),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showModulePermissionPopup){var n=document.querySelector("crm-modules-list-page");n&&n.component&&((n=n.component).setData("showModulePermissionPopup",!0),n.setData("moduleMetaForPermissionPopup",this.transition.data.module))}!featuresAvailable.NEXTGENUI_ENABLED&&Crm.userDetails.isCustomModuleNewLimitAccessible&&CML.checkCustomModuleLimit()},validateNextTransition:function(e,t){var r;((!0===e.moduleOrderUpdate||!0===e.statusUpdate||void 0!==store.model.module.dirty&&store.model.module.dirty.length>0)&&!0!==e.getData("isUpdateInProgress")&&e.callStoreUpdate(!1),t.info.dynamicParams.length>0?r=t.info.dynamicParams[0]:t.info.queryParams.hasOwnProperty("module")&&(r=e.getData("apiNameVsModuleNameMap")[t.info.queryParams.module]),void 0===r||void 0!==crmTab.requiredPromoTabs[r]&&Crm.userDetails.SERVICES_PROMO_VISIBILITY||t.info.route.startsWith("crm.tab"))?t.resume():Lyte.resolvePromises({isModuleAccessable:store.triggerAction("dummy","isModuleAccessable",{url:Crm.getCrmBasePath()+"/PageLayout.do?action=isModuleAccessable&returnpage=newList&module="+r,method:"POST"})}).then((function(r){var s;if(void 0!==r.isModuleAccessable)switch(r.isModuleAccessable instanceof String||"string"==typeof r.isModuleAccessable?s=r.isModuleAccessable.trim():r.isModuleAccessable instanceof Object&&(s=(s=Object.keys(r.isModuleAccessable)).length>0?s[0]:""),s){case"module not available":return e.showModuleDeletedActionNotAllowedPopup(),void t.abort();case"module disabled":return e.showModuleHiddenActionNotAllowedPopup(),void t.abort();case"No Permission":return Lyte.Component.registeredHelpers.showPopupToGoBackToSettingsIndexPage(),void t.abort()}t.resume()}))},setTimeOutForModuleUpdateInProgress:function(e,t){var r=this;e.validateWillTransition=setTimeout((function(){!0===e.getData("isUpdateInProgress")?r.setTimeOutForModuleUpdateInProgress(e,t):r.validateNextTransition(e,t)}),1e3)},actions:{didTransition:function(){this.transition.data.refreshNeeded&&this.refresh()},willTransition:function(e){var t=$L("crm-modules-list-page");if(void 0!==t&&0!==t.length&&void 0!==t[0]){var r=t[0].component;void 0!==r&&(e.pause(),!0===r.getData("isUpdateInProgress")?this.setTimeOutForModuleUpdateInProgress(r,e):e.resume())}}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.conversion-mapping",{queryParams:["leadLayoutId","accountLayoutId","contactLayoutId","potentialLayoutId","quoteLayoutId","salesOrderLayoutId","invoiceLayoutId","showLayout"],getResources:function(){this.module=this.parent.getDynamicParam();var e=networkUtils.returnDependencyFiles(["crm-mxn-lead-conversion.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-mxn-lead-conversion.css"],ResourceConstants.CRMClient),r=e.concat(t);r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-conversion-mapping.js","crm-conversion-mapping-helper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("LinkingModuleConvertField")],ResourceConstants.CRM));var s=networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"conversion_mapping/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.RELEVANT_LOCALE)+".js"],ResourceConstants.CRM);return(s=s.concat(networkUtils.returnDependencyFiles(["crm-conversion-mapping.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-conversion-mapping-mixin.js"],ResourceConstants.CRMClient)},beforeModel:function(e){this.transition.data.fromPage&&(this.fromPage=this.transition.data.fromPage,this.transition.data.fromLayout&&(this.fromLayout=this.transition.data.fromLayout))},model:function(e){var t=this.getQueryParams();return t.module=this.module,this.conversionMappingModelData(t)},afterModel:function(e){if(e){var t=this.getQueryParams();return t.module=this.module,this.conversionMappingAfterModelData(e,t)}},renderTemplate:function(e){var t=this.module,r=moduleRecordMapping[t].singular_label;$("#customizationDiv").addClass("p30 pT20"),$("#layout_landing_left").show(),$L(".nextGenUILeftMenu").show(),$(".moduleNameSection").show(),$("#mainMenuTabDiv").show(),$("#innerTabDiv").show();var s=$("#landingModuleLists").find("ul");s.find("li").removeClass("selected"),$("#layout_landing_right").find(".moduleLandingName").find("span").text(r),s.find("li[data-zcqa='MPL_layoutListPage_"+t+"']").addClass("selected");return $("body").removeClass("builder_page_body"),CML.layoutLandingResize(),null==e||void 0===e.inActiveParlayoutId||e.inActiveParlayoutId?{outlet:"#customizationDiv",html:'<div class="h100_per pT60 sb_flexCenter"><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39; font-size:2.2rem;" class="mL10">'+(null===e?I18n.getMsg("crm.map.custom.fields.mapping.deleted",t):void 0===e?I18n.getMsg("crm.map.module.hidden.alert"):e.inActiveParlayoutId?I18n.getMsg("crm.map.custom.fields.mapping.deactivated",t):"")+"</h2></div></div>"}:{outlet:"#customizationDiv",component:"crm-conversion-mapping",reRender:!0}},beforeExit:function(){store.unloadAll("field"),store.unloadAll("layout"),this.fromPage=void 0,this.fromLayout=void 0}},{mixins:["crm-conversion-mapping-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-button.custom-button-create",{queryParams:["position"],getDependencies:function(){return networkUtils.returnDependencyFiles(["user_type.js","crm-client-portal-module.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js","zohocrm_workflow.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-custom-button-actions.js","crm-custom-button-helper.js","crm-custom-button-create.js","crm-custom-button-common.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","custom-function-gallery.js","custom-function-credits.js","custom-function-editor.js","crm-function-components-wrapper.js","reviewprocess.js","crm-functions-helper.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM),o=networkUtils.returnDependencyFiles(["crm-custom-button-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["kiosk-execute.js","kiosk-listview-component.js","crm-model-kiosk.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM);return Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient))),e.concat(t).concat(n).concat(i).concat(r).concat(t).concat(s).concat(a).concat(o).concat(l).concat(c)},showLeavePagePopupBanner:!1,beforeModel:function(){const e=this.checkCustomButtonCreationAllowed;for(const t of Object.keys(e))e[t].beforeDataFetch.call(this)&&e[t].check.call(this)&&(this.showLeavePagePopupBanner=!1,"crm.settings.section.modules.module.custom-button.custom-button-create"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-button.custom-button-index",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()));this.resetData("resetDataFetch")},model:function(){commonUtils.showHideLoadingDiv(!0);const e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),t={moduleName:e,moduleApiName:moduleRecordMapping[e].api_name},r=["layouts","profiles","moduleAssociatedProfiles","customButtonCount","userTypes"],s=this.customButtonModel.getModelData.call(this,r,t),n=function(e){return function(t){return this.customButtonModel.successCallback.call(this,t,e)}}(r);return Lyte.resolvePromises(s).then(n.bind(this)).catch(function(e){this.errorHandling(e,void 0,{showErrorMessage:!1})}.bind(this)).finally(function(){commonUtils.showHideLoadingDiv(!1)}.bind(this))},afterModel:function(){!this.currentModel&&(this.currentModel={});let e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();this.currentModel.moduleName=e,this.currentModel.moduleApiName=moduleRecordMapping[e].api_name,this.currentModel.transitionData=this.getQueryParams().position?{position:this.getQueryParams().position}:{},this.currentModel.profiles=this.filterModuleVisibleProfiles(this.currentModel.profiles,this.currentModel.moduleAssociatedProfiles),this.currentModel.userTypes=this.filterUserTypes(this.currentModel.userTypes,this.currentModel.moduleApiName)},redirect:function(){const e=this.checkCustomButtonCreationAllowed;for(const t of Object.keys(e))!e[t].beforeDataFetch.call(this)&&e[t].check.call(this,this.currentModel)&&(this.showLeavePagePopupBanner=!1,"crm.settings.section.modules.module.custom-button.custom-button-create"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-button.custom-button-index",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()))},renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-custom-button-create"}},actions:{willTransition:function(e){customFunctionsObj.delugeEditor.v2&&customFunctionsObj.isEditorOpen()||customFunctionsObj.ignoreButtonRoute?customFunctionsObj.ignoreButtonRoute=!1:!this.commonData.isRecordUpdated&&this.showLeavePagePopupBanner&&this.showLeavePagePopup(e)},didTransition:function(){this.showLeavePagePopupBanner=!0}}},{mixins:["crm-custom-button-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-button.custom-button-edit",{getDependencies:function(){return networkUtils.returnDependencyFiles(["user_type.js","crm-client-portal-module.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js","zohocrm_workflow.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-custom-button-actions.js","crm-custom-button-helper.js","crm-custom-button-edit.js","crm-custom-button-common.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","custom-function-gallery.js","custom-function-credits.js","custom-function-editor.js","crm-function-components-wrapper.js","reviewprocess.js","crm-functions-helper.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM),o=networkUtils.returnDependencyFiles(["crm-custom-button-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["kiosk-execute.js","kiosk-listview-component.js","crm-model-kiosk.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM),u=networkUtils.returnDependencyFiles(["crm-lux-bundle.js","crm-lux-mixins.js","crm-lux-store.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["lux/crm-lux-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("lux")],ResourceConstants.CRM));return Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient))),e.concat(t).concat(n).concat(i).concat(r).concat(t).concat(s).concat(a).concat(o).concat(l).concat(c).concat(u)},showLeavePagePopupBanner:!1,recordMayDeleted:!1,beforeModel:function(){const e=this.checkCustomButtonEditPageAllowed;for(const t of Object.keys(e))e[t].beforeDataFetch.call(this)&&e[t].check.call(this)&&(this.showLeavePagePopupBanner=!1,"crm.settings.section.modules.module.custom-button.custom-button-edit"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-button.custom-button-index",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()));this.resetData("resetDataFetch")},model:function(){commonUtils.showHideLoadingDiv(!0);const e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),t=["layouts","profiles","moduleAssociatedProfiles","customButtonCount","customButtonRecord","userTypes"],r={moduleName:e,moduleApiName:moduleRecordMapping[e].api_name,buttonId:Lyte.Router.getRouteInstance().getDynamicParam()},s=this.customButtonModel.getModelData.call(this,t,r),n=function(e){return function(t){return this.customButtonModel.successCallback.call(this,t,e)}}(t);return Lyte.resolvePromises(s).then(n.bind(this)).catch(function(e){let t;try{t=e.response?JSON.parse(e.response):JSON.parse(e)}catch(r){t=e.response?e.response:e}"INVALID_DATA"===t.code&&t.details&&2===t.details.resource_path_index&&(this.showLeavePagePopupBanner=!1,this.recordMayDeleted=!0),this.errorHandling(e,void 0,{showErrorMessage:!1})}.bind(this)).finally(function(){commonUtils.showHideLoadingDiv(!1)}.bind(this))},afterModel:function(){const e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),t=moduleRecordMapping[e].api_name;this.recordMayDeleted?this.showButtonListViewPage(t):(this.currentModel.moduleName=e,this.currentModel.moduleApiName=t,this.currentModel.customButton=this.currentModel.customButtonRecord,this.currentModel.buttonId=Lyte.Router.getRouteInstance().getDynamicParam(),this.currentModel.wizardAssocLayouts=this.transition.data.wizardAssocLayouts,this.currentModel.profiles=this.filterModuleVisibleProfiles(this.currentModel.profiles,this.currentModel.moduleAssociatedProfiles),this.currentModel.userTypes=this.filterUserTypes(this.currentModel.userTypes,t))},redirect:function(){const e=this.checkCustomButtonEditPageAllowed;for(const t of Object.keys(e))!e[t].beforeDataFetch.call(this)&&e[t].check.call(this,this.currentModel)&&(this.showLeavePagePopupBanner=!1,"crm.settings.section.modules.module.custom-button.custom-button-edit"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-button.custom-button-index",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()))},renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-custom-button-edit"}},actions:{willTransition:function(e){customFunctionsObj.delugeEditor.v2&&customFunctionsObj.isEditorOpen()||customFunctionsObj.ignoreButtonRoute?customFunctionsObj.ignoreButtonRoute=!1:!this.commonData.isRecordUpdated&&this.showLeavePagePopupBanner&&this.showLeavePagePopup(e)},didTransition:function(){this.showLeavePagePopupBanner=!0}}},{mixins:["crm-custom-button-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-button.custom-button-index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-button.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),t=networkUtils.returnDependencyFiles(["crm-custom-button-listview.js","crm-custom-button-helper.js","lyte-hovercard.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){const e=this.checkCustomButtonListViewPageAllowed;for(const t of Object.keys(e))e[t].check.call(this)&&"crm.settings.section.modules.module.custom-button.custom-button-index"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam());this.resetCustomButtonData()},model:function(){commonUtils.showHideLoadingDiv(!0);const e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),t=moduleApiMapping[e];store.clearCachedQuery("custom_button",{module:t});const r={moduleName:e,moduleApiName:t},s=["customButtons","layouts","moduleAssociatedProfiles","profiles"],n=this.customButtonModel.getModelData.call(this,s,r),i=function(e){return function(t){return this.customButtonModel.successCallback.call(this,t,e)}}(s);return Lyte.resolvePromises(n).then(i.bind(this)).catch((function(t){let r;try{r=t.response?JSON.parse(t.response):JSON.parse(t)}catch(e){r=t.response?t.response:t}"MODULE_NOT_SUPPORTED"===r.code&&Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.modules.module.layouts.index-layouts",e),this.errorHandling(t)})).finally((function(){commonUtils.showHideLoadingDiv(!1)}))},afterModel:function(){const e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();this.currentModel.moduleName=e,this.currentModel.moduleApiName=moduleRecordMapping[e].api_name,this.commonData.currentModule=e,this.currentModel.buttons=this.currentModel.customButtons,this.currentModel.profiles=this.filterModuleVisibleProfiles(this.currentModel.profiles,this.currentModel.moduleAssociatedProfiles)},renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-custom-button-list"}},didDestroy:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),this.resetData("functionMergeFieldData")}},{mixins:["crm-custom-button-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-button",{getDependencies:function(){let e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom_button")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-custom-button.js","features_model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-custom-button-constants.js"],ResourceConstants.CRMClient);return t.concat({parent:e,child:r})},beforeModel:function(){const e=store.findAll("features",{api_names:"custom_button"},!0,!0),t=this.setMaxLimitForCustomButton;this.makeRequest(e,t)},redirect:function(){void 0!==Crm.refWidAssocComp&&Crm.refWidAssocComp.custom_button&&(Crm.refWidAssocComp.custom_button=!1,Lyte.Router.getRouteInstance().routeName.includes("wizard")||Utils.windowLocationReload(!0)),"crm.settings.section.modules.module.custom-button"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-button.custom-button-index",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),Lyte.registeredMixins["crm-custom-button-mixin"]&&this.resetData("reset_filter_data")}},{mixins:["crm-custom-button-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-link.index-custom-link",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crux-merge-field.css","lyte-beta-popover.css","crm-custom-link.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),t=networkUtils.returnDependencyFiles(["crm-custom-link-list-view.js","lyte-hovercard.js","crux-merge-field.js","lyte-caret.js","crux-lazyLoad.js","crux-parent-form-component.js","crm-client-portal-module.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("customLink"),ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("CrmPermissionPopup"),ResourceConstants.CRM);return t.concat(e).concat(r).concat(s)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-custom-link.js"],ResourceConstants.CRMClient)},model:function(){let e=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),t=moduleApiMapping[e],r=moduleDetailedInfo.modules.filter((e=>e.api_name===t)),s=r&&0!==r.length?r[0].id:moduleRecordMapping[e].id;return this.getCustomLinkData(t,s)},lyteConvertionSupported:!0,afterModel:function(e){e&&e.length&&(this.currentModel={},this.currentModel.module=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),this.currentModel.moduleApiName=moduleApiMapping[this.currentModel.module],this.currentModel.outlet="#createFormRulePopup",this.currentModel.custom_link=e[0],this.currentModel.customLinkInfo=e[2].__features[0],this.currentModel.profiles=e[1].profiles)},renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-custom-link-common"}},actions:{willTransition:function(){var e=document.querySelector("crm-custom-link-edit-access")||document.querySelector("crm-custom-link-create");e&&e.component&&e.component.$node.remove(),_cruxUtils.removeCustomAlert()}}},{mixins:["crm-custom-link-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.custom-link",{getDependencies:function(){return networkUtils.returnDependencyFiles(["custom_link_model.js"],ResourceConstants.CRMClient)},redirect:function(){"crm.settings.section.modules.module.custom-link"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.custom-link.index-custom-link",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},lyteConvertionSupported:!0,beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.events_preferences",{getResources:function(){var e=networkUtils.returnDependencyFiles(["online-meeting.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["online-meeting-market.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MeetingIntegration")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-rso-marketplace.js"],ResourceConstants.CRMClient);return e.concat(t).concat(r).concat(s)},beforeModel:function(){this.transition.url.includes("/Events/events_preferences")?Crm.userDetails.MEETING_BRIDGE_ENABLED&&"true"!==isSandboxAcc&&"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE&&Crm.userDetails.IS_ADMIN||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){this.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort()):this.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",this.transition.info.dynamicParams[0])},renderTemplate:function(){return{component:"online-meeting-marketplace",outlet:"#customizationDiv"}},afterRender:function(){var e=this.transition.data.toolname;e&&MeetingBridge.getEnabledProviders().then((t=>{t.providers.filter((t=>e===t.name)).length||this.component.component.actions.loadMBMarketPlaceIframe()}))}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-listing",{queryParams:["layoutId"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-field-list.js","lyte-hovercard.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-field-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("fieldlisting")],ResourceConstants.CRM);return(e=e.concat(r)).concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-field-listing.js"],ResourceConstants.CRMClient)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Lyte.Router.getRouteInstance().parent.getDynamicParam(),r=this;return store.findAll("layout",{module:moduleRecordMapping[t].api_name},void 0,void 0,{moduleSet:!0,subformModuleSet:!0,apiVersion:"2.2"}).then((function(){return r.getFieldsData(t,e,"layout")}))},afterModel:function(e){e.fields.modFields.limitedFields=e.fields.modFields.limitedFields.slice(0);var t=e.fields.modFields.limitedFields;this.currentModel.isFrom="field-listing",this.currentModel.NoRecordObj={modFields:!1},this.currentModel.scrollEvent=!0,this.setLayout(e.moduleLayout),this.getPreventColumnsAndFields(e.module,e.isFrom),this.setFields(e.module,t,!1,"modFields",this.currentModel),this.currentModel.noFields={},this.setSubformFields()},renderTemplate:function(e){return this.currentModel.id="getFields",e.searchPlaceholder=I18n.getMsg("crm.label.search.fields.or.datatype"),{outlet:"#customizationDiv",component:"crm-field-list"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),$L("#fieldListing").addClass("seltab eventNone"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.customize.fields"),Crm.partnerName]))},actions:{onError:function(){Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(),Lyte.Router.transitionTo("crm.settings.section.modules.index-modules").preservePopup=!0}}},{mixins:["crm-field-listing"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-permissions",{queryParams:["profileId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-field-listing.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-field-list.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-field-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("fieldlisting")],ResourceConstants.CRM);return(e=e.concat(r)).concat(t)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Lyte.Router.getRouteInstance().parent.getDynamicParam(),r=this,s=moduleRecordMapping[t].access_type;return Lyte.resolvePromises({fields:store.findAll("field",{module:moduleRecordMapping[t].api_name,include:"allowed_permissions_to_update",include_external_fields:!0},void 0,void 0,{apiVersion:"2.2",include_external_fields:!0}),profile:"team_based"===s?store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"}):store.findAll("profile",{include_lite_profile:!0})}).then((function(s){return r.getFieldsData(t,e,"profile",s.profile)}))},afterModel:function(e,t){e.fields.modFields.limitedFields=e.fields.modFields.limitedFields.slice(0);var r=e.fields.modFields.limitedFields;this.currentModel.isFrom="field-permission",this.currentModel.modules=[e.module],this.currentModel.NoRecordObj={modFields:!1},this.currentModel.scrollEvent=!0,this.getPreventColumnsAndFields(e.module,e.isFrom),this.setFields(e.module,r,!1,"modFields",this.currentModel),this.currentModel.noFields={},this.setSubformFields(e.fields.modFields.limitedFields)},renderTemplate:function(e,t){return this.currentModel.id="getFields",e.searchPlaceholder=I18n.getMsg("webform.field.search"),{outlet:"#customizationDiv",component:"crm-field-list",reRender:!0}},afterRender:function(e,t){commonUtils.showHideLoadingDiv(!1),$("#fieldPerm").addClass("seltab eventNone"),$L("#layout_landing_right").addClass("fieldPermissionPage");Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.customize.fields"),Crm.partnerName]))},actions:{willTransition:function(e){var t=$L("crm-field-list")[0].component;if(t.isLinkModified){e.pause();t.setData("targetRoute",e),t.setData("stayAlert",!0)}$L("#layout_landing_right").removeClass("fieldPermissionPage")}}},{mixins:["crm-field-listing"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-privacy",{queryParams:["layoutId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-field-listing.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-field-list.js","crm-private-field-popup.js","lyte-scrollTo.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-field-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("fieldlisting")],ResourceConstants.CRM);return(e=e.concat(r)).concat(t)},beforeModel:function(){var e=Lyte.Router.getRouteInstance().parent.getDynamicParam();Crm.userDetails.isPrivacySettingEnabled&&-1!==Crm.userDetails.privacyPrefEnabledModules.indexOf(e)||this.replaceWith("crm.settings.section.modules.module.field-listing",e),commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Lyte.Router.getRouteInstance().parent.getDynamicParam(),r=this;return store.findAll("layout",{module:moduleRecordMapping[t].api_name},void 0,void 0,{moduleSet:!0,subformModuleSet:!0}).then((function(){return r.getFieldsData(t,e,"layout")}))},afterModel:function(e,t){Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();this.currentModel.isPrivacyFieldAvailable=!1,this.currentModel.isFrom="privacy-field",this.privacyFields={},this.currentModel.moduleFields={},this.currentModel.modules=[e.module],e.fields.modFields.limitedFields=e.fields.modFields.limitedFields.slice(0),this.currentModel.NoRecordObj={modFields:!1},this.currentModel.scrollEvent=!0,this.getPreventColumnsAndFields(e.module,e.isFrom),this.setLayout(this.currentModel.moduleLayout),this.setFields(e.module,this.currentModel.fields.modFields.limitedFields,!1,"modFields",this.currentModel),this.currentModel.moduleFields.modFields={fields:e.fields.modFields.limitedFields.slice(0),display_label:moduleRecordMapping[this.currentModel.module].plural_label},e.fields.modFields.limitedFields=this.privacyFields.modFields,this.currentModel.noFields={modFields:!this.privacyFields.modFields.length},commonUtils.showHideLoadingDiv(!0),this.currentModel.disablePrivacyFldAddition=!1,this.setSubformFields(),delete CML.integrationSerivceVsFields},renderTemplate:function(e,t){return e.isPrivacyFieldAvailable?e.editButton=I18n.getMsg("crm.mb.field.private.edit"):e.editButton=I18n.getMsg("crm.mb.field.private.set"),this.currentModel.id="getFields",e.searchPlaceholder=I18n.getMsg("crm.api.search.personal.fields"),{outlet:"#customizationDiv",component:"crm-field-list"}},afterRender:function(e,t){$L("#personalField").addClass("seltab eventNone"),$L("#fieldListing").removeClass("seltab eventNone"),commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){delete CML.integrationSerivceVsFields}},{mixins:["crm-field-listing"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.jobsheet-layouts",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",{params:{action:"showLayoutList",module:"Appointments",innerTab:"jobSheetLayouts"}})},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.layouts"),Crm.partnerName]))},actions:{willTransition:function(){var e=this.parent.getDynamicParam();this.resetMetaValues(e)}}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules.index-layout-rules",{model:function(e){var t={params:{action:"showFormRulesList",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"formRules"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FormRule.do","GET",t)},renderTemplate:function(e,t){return validationUtils.isJson(e)?{outlet:"#customizationDiv",html:Handlebars.templates.formRuleListView(e)}:{outlet:"#customizeModuleDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.layout.rule.plural"),Crm.partnerName])),CFRCust.storeDataForListView(e),CFRCust.enableOrDisableCreateButton($("#formRulesListDIV").find("[class^=layoutId]"),Object.keys(CFRCust.layoutIdvsNameObj).length),this.transition.data.fieldName&&this.transition.data.layoutId&&CFRCust.showCreatePopup(this.transition.data.fieldName,this.transition.data.layoutId),$("#conditionalFieldContainer").empty().hide(),Crm.trackSpotLightAction("Layout Rule - Page Visited",{Module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()}),$L("#layout_landing_right").removeScroll(),$("#customizationDiv").addClass("helpOverflowHide"),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup&&setTimeout((function(){CFRCust.showCreatePopup()}),100)},actions:{willTransition:function(){$("#customizationDiv").removeClass("helpOverflowHide"),$("#createForm").hide()}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules.view-layout-rule",{queryParams:["layoutId"],model:function(e){if(this.transition.lrdata)return this.transition.lrdata;var t={params:{action:"editFormRule",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"formRules",operation:"edit",layoutId:this.getQueryParams().layoutId,formRuleId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FormRule.do","GET",t)},renderTemplate:function(e,t){if(!validationUtils.isJson(e))return{outlet:"#customizeModuleDiv",html:e};CFRCust.showFormRule(e,"edit")},actions:{willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module.layouts.layout-rules")<0&&($("#moduleCustomizationDiv").show(),$("#conditionalFieldContainer").hide())}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules",{redirect:function(){"crm.settings.section.modules.module.layout-rules"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layout-rules.index-layout-rules",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},afterRender:function(){},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.clone-layout",{requestMerge:!0,model:function(e){var t=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),r=this.getDynamicParam();if(1==this.requestMerge){var s={params:{action:"showModuleBuilder",module:t,innerTab:"layouts",layoutId:r,operation:"edit",layoutOperation:"clone"}};return"team_based"===moduleRecordMapping[t].access_type?(_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.label.module.customize.layout.clone.restrict.team.module"),ltPropButtons:[{type:"reject",text:"Ok",appearance:"default",cxPropZcqa:"btn_layoutCloneNotAllowed"}]}}),this.transition.abort(),void this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())):networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",s)}return s={params:{action:"cloneNewLayout",module:t,innerTab:"layouts",actionType:"createLayout",layoutId:r}},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",s)},afterModel:function(e){if(validationUtils.isJson(e)){var t=e.status;let r=$("#moduleCustomizationDiv");"Layout_Unavailable"==t&&(this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),CrmPageLayout.showMsgBand(r,"error","Trying to access the unavailable layout",4e3))}else if(null!=e)if(1!=this.requestMerge)this.transition.cachedResponse=e;else{var r=screen.width+"X"+screen.height;if(commonUtils.showHideLoadingDiv(!0),CML.builderOperation="edit",CrmModule.toggleBusy("primaryBtnLayer",!1),$("#innerTabDiv").hide(),0===e.indexOf("ALERT:::"))(s=e.split("ALERT:::")).length>2?CML.showModuleDeleteErrorWithTip(s[1],s[2]):CrmModule.notifyUser("alert",s[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1;else if(0===e.indexOf("ERROR:::")){var s=e.split("ERROR:::");CrmModule.notifyUser("alert",s[1]),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("COUNTEXCEED:::")){s=e.split("COUNTEXCEED:::");CrmModule.notifyUser("alert",s[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else null!=e&&(Crm.trackSpotLightAction("Layout Page - UsersResolution",{Resolution:r,BrowserVersion:$L.userAgent.browser+"-"+$L.userAgent.detailedVersion[1]}),this.transition.cachedResponse=e,$("#fieldSettingsDiv").html(e),$("#moduleCustomizationDiv").removeClass("createModule"),$(".newVersMsg").hide())}},getResources:function(){var e=[];if(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-limit-warning.js","dataparam-gallery.js","custom-dataparam.js","dataparam-mixin.js","lyte-resize.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["dataparam-gallery/dataparam-gallery.css","custom-dataparam/custom-dataparam.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RollupSummary")],ResourceConstants.CRM)),1==this.requestMerge){"undefined"==typeof CML&&(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"],ResourceConstants.CRM)));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("picklistcommonsortorder")],ResourceConstants.CRM);e=e.concat(t);var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModuleBuilder")],ResourceConstants.CRM);return e=(e=(e=e.concat(r)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("globalpicklist")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("StaticSubform")],ResourceConstants.CRM))}return e},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(){var e=$("#customizationDiv");if($("#customActionDiv").hide(),e.show(),0!=e.find("#List_Layouts").length?($("#mainMenuTabDiv").show(),$L(".nextGenUILeftMenu").show(),e.addClass("p30 pT20"),$("#layout_landing_left").show(),$("#moduleCustomizationDiv").removeClass("notNewSetupView"),$(".moduleNameSection").show()):($("#innerTabDiv").hide(),$("#moduleCustomizationDiv").addClass("notNewSetupView"),$("body").addClass("builder_page_body"),$L("#layout_landing_right").removeClass("pL20"),$L("#manageUserDiv").hide(),$("#mainMenuTabDiv").hide(),$L(".nextGenUILeftMenu").hide(),$("#customizationDiv").removeClass("p30 pT20"),$("#layout_landing_left").hide(),$(".moduleNameSection").hide()),1==this.requestMerge){var t=$("#layoutTabId").val(),r=this.getDynamicParam(),s=this.getQueryParams().showspmapping,n={params:{action:"getNewFieldButtonDetails",operation:"edit",tabId:t}};networkUtils.setCsrfParam(n),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",n).then((function(e){CML.designNewFieldsAndButtons(e,"edit")}));var i={params:{action:"getExistedSectionAndFieldDetails",operation:"edit",tabId:t,layoutId:r,layoutOperation:"clone"}},o={params:{action:"getRelatedListFieldDetails",operation:"edit",tabId:t,layoutId:r,layoutOperation:"clone"}};networkUtils.setCsrfParam(i),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",i).then((function(e){CML.designExistingSectionAndFields(e,"edit",t,r,void 0,void 0),$("#permissionComponentPopup").length>0&&(CML.isFPAccess=!0),"true"==s&&$("#stageProbMapping").click(),networkUtils.setCsrfParam(o),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",o).then((function(e){CMB.designExistingRelatedListFieldDetails(e.rLDtls)}))}))}},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();if(Events.isPageLayoutModified){var r=e.pause(),s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),renderingUtils.removeFreezeLayer(),Events.isPageLayoutModified=!1;var e=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];e.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled?(e.routeChange=!1,e.reDirectHandle(e.moduleData)):(r.resume(),"JobSheets"===t&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services"))})),n.find(".stayPage").off("click").click((function(){if($("#stayonPageConfirmBox").hide(),Crm.userDetails.isKeyboardShortcutsEnabled){var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];t.routeChange=!1,t.moduleData={}}e.abort(),renderingUtils.removeFreezeLayer()})),n.focus()}}},beforeExit:function(){$L("body").removeClass("builder_page_body"),_cruxUtils.removeCustomAlert()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.index-layouts",{getResources:function(){this.transition.data={newCode:!0};var e=[],t=networkUtils.returnDependencyFiles(["crux-lazyLoad.js","crm-image-upload.js","crm-layout-list.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-ui-loaders.js","crm-vision-create.js","lyte-hovercard.js","webform-model.js","webform.js","crm-layout-helper.js"],ResourceConstants.CRMClient),r=[];Crm.userDetails.RTL_ENABLED&&(r=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient));var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("layoutlistpage")],ResourceConstants.CRM);return t=t.concat(s),r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-list-view-crux.css","crm-image-preview.css","crm-image-upload-create.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-layout-list.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e=(e=(e=(e=e.concat(t.concat(r))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CrmPermissionPopup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("globalpicklist"),ResourceConstants.CRM))},model:function(e){var t,r=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();return t="Potentials"===r?"has_more_profiles,created_time,created_for,visible,profiles,source,display_label,created_by,actions_allowed,modified_time,name,generated_type,id,total_profiles,status,modified_by,sections":"has_more_profiles,created_time,created_for,visible,profiles,source,display_label,created_by,actions_allowed,modified_time,name,generated_type,id,total_profiles,status,modified_by",Lyte.resolvePromises({module:r,wizards:new Promise((function(e){store.findAll("wizard",{module:moduleRecordMapping[r].api_name}).then((function(t){e(t)}),(function(){e()}))})),layoutLicenseCountResp:new Promise((function(e){store.findAll("dummy",{api_names:"multi_page_layout"},void 0,!1,{url:"crm/v2.1/__features"}).then((function(t){e(t)}),(function(){e()}))})),layouts:store.findAll("layout",{module:moduleRecordMapping[r].api_name,include_inner_details:"profiles.type",include:"total_profiles",fields:t},!1,!0,{apiVersion:"3",initialload:moduleRecordMapping[r].api_name})})},afterModel:function(e){var t=Crm.userDetails.isSandbox;"Campaigns"===e.module&&t&&e.layouts.forEach((function(t,r){"Zoho Survey"===t.name&&e.layouts.splice(r,1)}));for(var r=e.layouts?e.layouts.length:0,s=0;s<r;s++){var n=e.layouts[s].profiles.length;e.layouts[s].profiles=e.layouts[s].profiles.filter((e=>"SupportProfileInternal"!==e.name)),e.layouts[s].total_profiles+=e.layouts[s].profiles.length-n}var i=Lyte.deepCopyObject(e.layouts);this.currentModel.layoutListRecords=i,this.currentModel.module=e.module,e.layoutLicenseCountResp.__features&&(this.currentModel.layoutLicenseLimit=e.layoutLicenseCountResp.__features[0].details.limits.total,this.currentModel.isMPLAvailable=!0)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",component:"crm-layout-list"}},beforeModel:function(){this.transition.info.dynamicParams.length>0&&crmConstants.moduleBuilderSpecialModules.includes(this.transition.info.dynamicParams[0])&&(void 0!==window.location.href&&window.location.href.match(/https?:\/\/(.+(users))/i)&&parent.window.close(),this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error")},afterRender:function(e,t){var r=this,s={params:{action:"showLayoutList",module:e.module,innerTab:"layouts"}};networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",s).then((function(e){var t=document.createElement("div");t.innerHTML=e,document.getElementById("customizationDiv").append(t),r.hideOldJspPages()})),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.layouts"),Crm.partnerName]))},beforeExit:function(){_cruxUtils.removeCustomAlert()},hideOldJspPages:function(){for(var e=document.getElementsByClassName("oldLayoutToLyte"),t=e.length,r=0;r<t;r++)e[r].style.display="none"},actions:{willTransition:function(){$("body").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.view-layout",{queryParams:["showspmapping","page","rlId","sectionId"],cmlInitiate:!1,requestMerge:!0,getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-event-picklist.js","lyte-colorpicker.js","crm-vision-create.js","dataparam-gallery.js","custom-dataparam.js","dataparam-mixin.js","crm-limit-warning.js","crm-uploadfields-mixin.js","crm-detail-view-utils.js","crm-subform-static-mapping-content.js","crm-static-subform-notification.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModuleBuilder"),"zlib_phonenumber.js"],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("StaticSubform")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("picklistcommonsortorder")],ResourceConstants.CRM);t=(t=(t=t.concat(r)).concat(n)).concat(s);var i=[];return Crm.userDetails.RTL_ENABLED&&(i=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css","Subform-rtl.css"],ResourceConstants.CRMClient)),i=(i=(i=(i=i.concat(networkUtils.returnDependencyFiles(["crm-image-preview.css","crm-image-upload.css","crm-image-upload-create.css","crm-picklist-colorpicker.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["dataparam-gallery/dataparam-gallery.css","crux-column-list.css","crux-file-upload-component.css","crm-file-upload-component.css","custom-dataparam/custom-dataparam.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["dataparam-gallery/dataparam-gallery.css","crm-subform-static-mapping-content.css","custom-dataparam/custom-dataparam.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-subform-permission.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),t=(t=t.concat(networkUtils.returnDependencyFiles(["multilookup-list.js","crux-column-list.js","lyte-resize.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["multilookup-list.css"],ResourceConstants.CRMClient)),"Appointments"===this.parent.parent.getDynamicParam()?t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-list-view-crux.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)):"Services"==this.parent.parent.getDynamicParam()?t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)):"Events"===this.parent.parent.getDynamicParam()&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["online-meeting.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["online-meeting-market.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MeetingIntegration")],ResourceConstants.CRM))),e=(e=(e=e.concat(t.concat(i))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sharingrules")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("RollupSummary")],ResourceConstants.CRM)),1==this.requestMerge&&"undefined"==typeof CML&&(this.cmlInitiate=!0,e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"],ResourceConstants.CRM))),isnewCalendarBookingEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-calendar-booking-mixin.js","crm-calendar-booking-form-mixin.js","crm-calendar-booking-modulebuilder.js","crm-calendar-booking-dropdowns.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-calendar-booking-modulebuilder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM))),e=(e=e.concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("globalpicklist"),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zia-call-analytics")],ResourceConstants.CRM))},beforeModel:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("View Layouts")},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;if(this.transition.data.dummyTransition)return null;var t,r=this.parent.parent.getDynamicParam(),s=this.getDynamicParam(),n=this.getQueryParams().showspmapping,i=this.getQueryParams().sectionId;CMB.oCHolder.requiredSectionId=Number(i);var o="custom";return Crm.userDetails.TEAM_MODULE_ENABLED&&"Users"!==r&&(o="team_based"===moduleRecordMapping[r].access_type?"team":"custom"),t=1==this.requestMerge?{params:{action:"showModuleBuilder",module:r,innerTab:"layouts",layoutId:s,showspmapping:n,operation:"edit",layoutOperation:"edit",sectionId:i,moduleType:o}}:{params:{action:"editLayout",module:r,innerTab:"layouts",layoutId:s,showspmapping:n,moduleType:o}},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",t)},afterModel:function(e){if(1==this.requestMerge){commonUtils.showHideLoadingDiv(!0),CML.builderOperation="edit",CrmModule.toggleBusy("primaryBtnLayer",!1);var t=screen.width+"X"+screen.height;if($("#innerTabDiv").hide(),null!=e)if(validationUtils.isJson(e)){var r=e.status;let t=$("#moduleCustomizationDiv");"Layout_Unavailable"==r&&(this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),CrmPageLayout.showMsgBand(t,"error","Trying to access the unavailable layout",4e3))}else if(0===e.indexOf("ALERT:::")){(s=e.split("ALERT:::")).length>2?CML.showModuleDeleteErrorWithTip(s[1],s[2]):CrmModule.notifyUser("alert",s[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("ERROR:::")){var s=e.split("ERROR:::");CrmModule.notifyUser("alert",s[1]),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("COUNTEXCEED:::")){s=e.split("COUNTEXCEED:::");CrmModule.notifyUser("alert",s[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else Crm.trackSpotLightAction("Layout Page - UsersResolution",{Resolution:t,BrowserVersion:$L.userAgent.browser+"-"+$L.userAgent.detailedVersion[1]}),this.transition.cachedResponse=e,$("#fieldSettingsDiv").html(e),$("#moduleCustomizationDiv").removeClass("createModule"),$(".newVersMsg").hide()}else if(null!=e&&validationUtils.isJson(e)){r=e.status;let t=$("#moduleCustomizationDiv");"Layout_Unavailable"==r&&(this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),CrmPageLayout.showMsgBand(t,"error","Trying to access the unavailable layout",4e3))}else null!=e&&(this.transition.cachedResponse=e)},renderTemplate:function(e,t){if(null!=e)return 1==this.requestMerge&&1==this.cmlInitiate&&(CrmModule.init(),CML.init(),CrmPageLayout.scrollPos()),{outlet:"#customizationDiv",html:e}},afterRender:function(){var e=$("#customizationDiv");if($("#customActionDiv").hide(),e.show(),0!=e.find("#List_Layouts").length?($("#mainMenuTabDiv").show(),$L(".nextGenUILeftMenu").show(),e.addClass("p30 pT20"),$("#layout_landing_left").show(),$("#moduleCustomizationDiv").removeClass("notNewSetupView"),$(".moduleNameSection").show()):($("#innerTabDiv").hide(),$("#moduleCustomizationDiv").addClass("notNewSetupView"),$("body").addClass("builder_page_body"),$L("#layout_landing_right").removeClass("pL20"),$L("#manageUserDiv").hide(),$("#mainMenuTabDiv").hide(),$L(".nextGenUILeftMenu").hide(),$("#customizationDiv").removeClass("p30 pT20"),$("#layout_landing_left").hide(),$(".moduleNameSection").hide()),!(1!=this.requestMerge||this.transition.data&&this.transition.data.dummyTransition)){var t=$("#layoutTabId").val(),r="Users"!==this.transition.info.dynamicParams[0]&&moduleRecordMapping[idModuleMapping[t]]&&"team_based"===moduleRecordMapping[idModuleMapping[t]].access_type?"team":"custom",s=this.getDynamicParam(),n=this.getQueryParams().showspmapping,i=this.getQueryParams().sectionId,o={params:{action:"getNewFieldButtonDetails",operation:"edit",tabId:t,moduleType:r}};networkUtils.setCsrfParam(o),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",o).then((function(e){CML.designNewFieldsAndButtons(e,"edit")}));var a={params:{action:"getExistedSectionAndFieldDetails",operation:"edit",tabId:t,layoutId:s,layoutOperation:"edit",sectionId:i,moduleType:r}},l={params:{action:"getRelatedListFieldDetails",operation:"edit",tabId:t,layoutId:s,layoutOperation:"edit",sectionId:i}};networkUtils.setCsrfParam(a);var c=this;networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",a).then((function(e){if(CML.designExistingSectionAndFields(e,"edit",t,s,void 0,void 0),"create"==c.getQueryParams().page)CMB.showCreateBand("create",$L("#mcreate")[0]);else if("quickCreate"==c.getQueryParams().page)CMB.showCreateBand("qcreate",$L("#mqcreate")[0]);else if("detailView"==c.getQueryParams().page){CMB.showCreateBand("detailView",$L("#mdetailView")[0]);const e=c.getQueryParams().rlId;e&&(CMB.hideMPL2Onboarding(),CustomRelatedListObj.doCustomRleatedList(`relatedlistpersonality_${e}`,"edit"))}"true"==n&&$("#stageProbMapping").click(),CMB.availableModules=null,networkUtils.setCsrfParam(l),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",l).then((function(e){CMB.designExistingRelatedListFieldDetails(e.rLDtls)}))}))}},beforeExit:function(){delete CMB.oCHolder.requiredSectionId,delete CML.integrationSerivceVsFields,_cruxUtils.removeCustomAlert(),$L("body").removeClass("builder_page_body")},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.getQueryParams().sectionId;if(Events.isPageLayoutModified){$("#fieldPropertiesPopup").is(":visible")&&CrmModule.hide("fieldPropertiesPopup");var s=e.pause(),n="stayonPageConfirmBox",i=$("#"+n);renderingUtils.freezeBackground(),mailsetCenter(n),i.find(".leavePage").off("click").click((function(){i.hide(),renderingUtils.removeFreezeLayer(),Events.isPageLayoutModified=!1;var n=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];n.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled?(n.routeChange=!1,n.reDirectHandle(n.moduleData)):(s.resume(),"Appointments"===t&&r>3&&"crm.settings.section.modules.module.jobsheet-layouts"!==e.target&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services"))})),i.find(".stayPage").off("click").click((function(){if(i.hide(),Crm.userDetails.isKeyboardShortcutsEnabled){var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];t.routeChange=!1,t.moduleData={}}e.abort(),renderingUtils.removeFreezeLayer()})),i.focus()}else"Appointments"===t&&r>3&&"crm.settings.section.modules.module.jobsheet-layouts"!==e.target&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services");CustomRelatedListObj.fromModuleBuilder=!1,Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"undefined"==typeof ZohoHCAsap||!ZohoHCAsap.Action||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"))}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts",{redirect:function(){"crm.settings.section.modules.module.layouts"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layouts.index-layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeModel:function(){}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.create-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject){var e=networkUtils.returnDependencyFiles(["kiosk-execute.js","kiosk-listview-component.js","crm-model-kiosk.js","zia-insights.js"],ResourceConstants.CRMClient);return(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM))}},model:function(e){var t={params:{innerTab:"cusLink",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),step:"createCustomButton",action:"createNewLink",component:this.getQueryParams().component}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},actions:{willTransition:function(e){if("undefined"!=typeof customFunctionsObj&&(customFunctionsObj.delugeEditor.v2&&customFunctionsObj.isEditorOpen()||customFunctionsObj.ignoreButtonRoute))customFunctionsObj.ignoreButtonRoute=!1;else if(Events.isLinksModified){var t=e.pause(),r="stayonPageConfirmBox",s=$("#"+r);renderingUtils.freezeBackground(),mailsetCenter(r),s.find(".leavePage").off("click").click((function(){crmui.modalZIndex("nonLyte",$L("#stayonPageConfirmBox")[0],"close"),s.hide(),t.resume(),renderingUtils.removeFreezeLayer(),Events.isLinksModified=!1})),s.find(".stayPage").off("click").click((function(){crmui.modalZIndex("nonLyte",$L("#stayonPageConfirmBox")[0],"close"),s.hide(),e.abort(),renderingUtils.removeFreezeLayer()})),s.focus(),crmui.modalZIndex("nonLyte",s[0],"open")}}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.edit-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject){var e=networkUtils.returnDependencyFiles(["kiosk-execute.js","zia-insights.js","kiosk-listview-component.js","crm-model-kiosk.js"],ResourceConstants.CRMClient);return(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM))}},model:function(e){var t={params:{innerTab:"cusLink",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),step:"editCustomButton",action:"editLink",component:this.getQueryParams().component,buttonId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},actions:{willTransition:function(e){if("undefined"!=typeof customFunctionsObj&&(customFunctionsObj.delugeEditor.v2&&customFunctionsObj.isEditorOpen()||customFunctionsObj.ignoreButtonRoute))customFunctionsObj.ignoreButtonRoute=!1;else if(Events.isLinksModified){var t=e.pause(),r="stayonPageConfirmBox",s=$("#"+r);renderingUtils.freezeBackground(),mailsetCenter(r),s.find(".leavePage").off("click").click((function(){crmui.modalZIndex("nonLyte",$L("#stayonPageConfirmBox")[0],"close"),s.hide(),t.resume(),renderingUtils.removeFreezeLayer(),Events.isLinksModified=!1})),s.find(".stayPage").off("click").click((function(){crmui.modalZIndex("nonLyte",$L("#stayonPageConfirmBox")[0],"close"),s.hide(),e.abort(),renderingUtils.removeFreezeLayer()})),s.focus(),crmui.modalZIndex("nonLyte",s[0],"open")}}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject){var e=networkUtils.returnDependencyFiles(["kiosk-execute.js","kiosk-listview-component.js","crm-model-kiosk.js","zia-insights.js"],ResourceConstants.CRMClient);return(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM))}},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.getQueryParams().component,s={params:null!=r?{step:"loadCustomButtonsForModule",module:t,component:r}:{innerTab:"cusLink",module:t,step:"customizeButtons"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",s)},afterModel:function(e){if(0===e.indexOf("ALERT:::")){var t=e.split("ALERT:::");$("#with_link_left_pane").hide(),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),CrmPageLayout.showMsgBand($("#moduleCustomizationDiv"),"alert",t[1],4e3)}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons",{redirect:function(){void 0!==Crm.refWidAssocComp&&Crm.refWidAssocComp.custom_button&&(Crm.refWidAssocComp.custom_button=!1,Lyte.Router.getRouteInstance().routeName.includes("wizard")||Utils.windowLocationReload(!0)),featuresAvailable&&featuresAvailable.CustomLinksNewTab&&this.replaceWith("crm.settings.section.modules.module.custom-link.index-custom-link",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),"crm.settings.section.modules.module.links-and-buttons"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.create-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"new",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()};this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.edit-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"edit",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),uid:this.getDynamicParam()};this.transition.data&&this.transition.data.conId&&(e.conId=this.transition.data.conId,e.depId=this.transition.data.depId,"true"===this.transition.data.subForm&&(e.subLayoutId=this.transition.data.subLayoutId,e.subModule=this.transition.data.subModule)),this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},afterModel:function(e){void 0!==e.fieldDependencyEditNotAllowed&&e.fieldDependencyEditNotAllowed&&(void 0!==e.parentFld&&"false"===e.parentFld&&void 0!==e.childFld&&"false"===e.childFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert1",[e.parentFldLabel,e.childFldLabel,e.layoutName]),3e3):void 0!==e.parentFld&&"false"===e.parentFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert2",[e.parentFldLabel,e.layoutName]),3e3):void 0!==e.childFld&&"false"===e.childFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert3",[e.childFldLabel,e.layoutName]),3e3):crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.not.allowed.msg"),3e3),this.replaceWith("crm.settings.section.modules.module.map-dependency.index-map-dependency",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()))},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.index-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"show",operation:"edit",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()};this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},afterModel:function(e){if(null!=e&&validationUtils.isJson(e)){var t=e.status;let r=$("#moduleCustomizationDiv");"Layout_Unavailable"==t&&(CrmPageLayout.showMsgBand(r,"error","Trying to access the unavailable layout",4e3),this.replaceWith("crm.settings.section.modules.module.layouts.index-layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()))}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){var r=$("#cancelBtn").closest("link-to"),s=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();"layoutsList"===this.parent.fromPage&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.index-layouts"),r.attr("lt-prop-dp",'["'+s+'"]')),"layout"===this.parent.fromPage&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.index-layouts"),r.attr("lt-prop-dp",'["'+s+'"]'),this.parent.fromLayout&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.view-layout"),r.attr("lt-prop-dp",'["'+s+'","'+this.parent.fromLayout+'"]')));var n=moduleRecordMapping[s].plural_label;$("#customizationDiv").addClass("p30 pT20"),$("#layout_landing_left").show(),$L(".nextGenUILeftMenu").show(),$(".moduleNameSection").show(),$("#mainMenuTabDiv").show(),$("#innerTabDiv").show(),$(".landingModuleLists ul li").removeClass("selected"),$("#layout_landing_right").find(".moduleLandingName").find("span").text(n),$(".landingModuleLists ul li[data-zcqa='MPL_layoutListPage_"+s+"']").addClass("selected");$("body").removeClass("builder_page_body"),CML.layoutLandingResize()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency",{beforeModel:function(e){this.transition.data.fromPage&&(this.fromPage=this.transition.data.fromPage,this.transition.data.fromLayout&&(this.fromLayout=this.transition.data.fromLayout))},redirect:function(){"crm.settings.section.modules.module.map-dependency"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.map-dependency.index-map-dependency",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeExit:function(){this.fromPage=void 0,this.fromLayout=void 0}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.preferences-module",{queryParams:["openPopUp"],getDependencies:function(){return networkUtils.returnDependencyFiles(["servapp_preferences_model.js"],ResourceConstants.CRMClient)},getResources:function(){var e;if("Calls"===Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())e=(e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_preferences")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["calls-preferences.js"],ResourceConstants.CRMClient));else{var t=networkUtils.returnDependencyFiles(["selling-preferences.js","crm-createrecord-mixin.js","crm-services-appointments.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["selling-preferences.css"],ResourceConstants.CRMClient);e=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_workflow.js"],ResourceConstants.CRM))).concat(r)}return e},model:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),t=this.getQueryParams();if(e&&("Services"===e||"Appointments"===e||"Calls"===e&&Crm.userDetails.CALLS_PREFERENCE)){var r="Appointments"===e?{include:"deal_record_configuration"}:{};return store.findAll("servapp_preferences",r,!1,!0,{module:e,reloadAll:!0}).then((function(r){if(r&&r.length){var s=objectUtils.cloneObject(r[0]);if(s.params={},s.params.module=e,"Services"===e)s.params.component="crm-service-preference";else{if("Calls"===e)return s.params.component="crm-calls-preferences",store.findAll("layout",{module:"Calls"},!1,!0,{apiVersion:"2.1",moduleSet:!0}).then((function(e){return s.layout=e[0],s}));if(s.params.component="crm-appointment-preference",s.params.openPopUp=t.openPopUp,!s.services)return store.findAll("servapp_preferences",{},!1,!0,{module:"Services",reloadAll:!0}).then((function(e){if(e&&e.length)return s.services=objectUtils.cloneObject(e[0].services),s}))}return s}}),(function(e){var t=JSON.parse(e.response);"NO_PERMISSION"!==t.code&&"INVALID_MODULE"!==t.code||renderingUtils.displayPermissionDenied()}))}},renderTemplate:function(e){var t=e&&e.params&&e.params.component?e.params.component:"";return""!=t&&("Appointments"===e.params.module&&(e.appointments=CrmPageLayout.configureAppointments(e.appointments)),e.disableButton=!0),{outlet:"#customizationDiv",component:t}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.module.info"),Crm.partnerName])),e&&e.params&&e.params.module)if("Services"===e.params.module);else if(e.params.openPopUp&&"create_deal"===e.appointments.when_appointment_completed){$L("crm-appointment-preference").e[0].component.initialize()}},beforeExit:function(){"undefined"!=typeof wfNew&&wfNew.resetWFObjs()},actions:{willTransition:function(e){if(this.currentModel&&this.currentModel.params&&this.currentModel.params.module&&("Appointments"===this.currentModel.params.module||"Services"===this.currentModel.params.module)){var t=$L("#saveButton")[0].ltProp("disabled");if(void 0!==t&&!1===t){var r=e.pause(),s="stayonPageConfirmBox",n=$("#"+s);renderingUtils.freezeBackground(),mailsetCenter(s),n.find(".leavePage").off("click").click((function(){n.hide(),r.resume(),renderingUtils.removeFreezeLayer()})),n.find(".stayPage").off("click").click((function(){n.hide(),e.abort(),renderingUtils.removeFreezeLayer()})),n.focus()}}}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.record-locking.create-record-locking",{getResources:function(){var e=networkUtils.returnDependencyFiles(["module-record-locking.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["module-record-locking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["module-record-locking-mixin.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return Lyte.resolvePromises(this.getRequests(!0))},afterModel:function(e){e.record_configurations=e.record_configurations?e.record_configurations[0]:e.record_configurations,this.currentModel&&this.currentModel.id||($L("#layout_landing_left").addClass("hide"),$L("#layout_landing_right .moduleNameSection").addClass("hide"),$L("#innerTabDiv").addClass("hide"),$L("#customizationDiv").addClass("p30 pT20"))},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.system.reclockingconfiguration"),Crm.partnerName]))},renderTemplate:function(){if(!(this.currentModel&&this.currentModel.record_configurations&&this.currentModel.record_configurations.id))return{outlet:"#customizationDiv",component:"crm-create-record-locking"};this.replaceWith("crm.settings.section.modules.module.record-locking.index-record-locking",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},lyteConvertionSupported:!0,actions:{onError:function(e){this.errorFunction(e)},willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module.layouts.layout-rules")<0&&($L("#moduleCustomizationDiv").show(),$L("#conditionalFieldContainer").hide())}}},{mixins:["crm-lock-rule-criteria"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.record-locking.edit-record-locking",{getResources:function(){var e=networkUtils.returnDependencyFiles(["module-record-locking.js","modal-scroll-box-shadow.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["module-record-locking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["module-record-locking-mixin.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return Lyte.resolvePromises(this.getRequests(!0))},afterModel:function(e){e.record_configurations=e.record_configurations?e.record_configurations[0]:e.record_configurations,this.currentModel&&this.currentModel.record_configurations&&this.currentModel.record_configurations.id&&($L("#layout_landing_left").addClass("hide"),$L("#layout_landing_right .moduleNameSection").addClass("hide"),$L("#innerTabDiv").addClass("hide"),$L("#customizationDiv").addClass("p30 pT20"))},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.system.reclockingconfiguration"),Crm.partnerName]));var e=$L("crm-create-record-locking")[0].component,t=$L(".rlPreferenceContainer");t[0].scrollHeight>t.outerHeight()?e.setData("showFooterShadow",!0):e.setData("showFooterShadow",!1)},lyteConvertionSupported:!0,renderTemplate:function(){if(this.currentModel&&this.currentModel.record_configurations&&this.currentModel.record_configurations.id)return{outlet:"#customizationDiv",component:"crm-create-record-locking"};this.replaceWith("crm.settings.section.modules.module.record-locking.index-record-locking",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},actions:{onError:function(e){this.errorFunction(e)},willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module.layouts.layout-rules")<0&&($L("#moduleCustomizationDiv").show(),$L("#conditionalFieldContainer").hide())}}},{mixins:["crm-lock-rule-criteria"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.record-locking.index-record-locking",{getResources:function(){var e=networkUtils.returnDependencyFiles(["module-record-locking.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["module-record-locking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["module-record-locking-mixin.js"],ResourceConstants.CRMClient)},model:function(){return Lyte.resolvePromises(this.getRequests())},afterModel:function(e){e.record_configurations=e.record_configurations?e.record_configurations[0]:e.record_configurations},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-module-record-locking",reRender:!0}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.system.reclockingconfiguration"),Crm.partnerName]));var e=$L("crm-module-record-locking")[0].component,t=$L("#profilesExceptElem"),r=t.length?t.outerWidth():0,s=t.closest(".rlConfiguredDetialValue").outerWidth();if(t.length){var n=Math.round(s-r);e.setData("allProfileExceptsWidth",n-10)}else e.setData("allProfileExceptsWidth",s-10);var i=$L("#layout_landing_left");i.show(),i.removeClass("hide");var o=$L("#layout_landing_right .moduleNameSection");o.show(),o.removeClass("hide"),$L("#layout_landing_right").removeClass("recordLockingConfigPage"),$L("#customizationDiv").addClass("p30 pT20"),$L("#innerTabDiv").removeClass("hide"),this.transition.data&&this.transition.data.sourceData&&"config_save"===this.transition.data.sourceData.type&&_cruxUtils.showCustomMessage({params:{ltPropMessage:this.transition.data.sourceData.message,ltPropDuration:"4000"}})},actions:{onError:function(e){if(e&&e.response)renderingUtils.displayPermissionDenied(),this.transition.abort();else{var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts.index-layouts",t)}},willTransition:function(){$("#customizationDiv").removeClass("helpOverflowHide")}}},{mixins:["crm-lock-rule-criteria"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.record-locking",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient))},getDependencies:function(){return networkUtils.returnDependencyFiles(["user_type.js","crm-client-portal-module.js","module-record-locking-mixin.js","crm-client-portal-mixin.js"],ResourceConstants.CRMClient)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("custom_button")},model:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();if(moduleRecordMapping[e])return CML.setLockingConfigSupportedModules()},redirect:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();!CML.lockingConfigSupportedModules||CML.lockingConfigSupportedModules.indexOf(e)<0?Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts.index-layouts",e):"crm.settings.section.modules.module.record-locking"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.record-locking.index-record-locking",e)},lyteConvertionSupported:!0,actions:{onError:function(e){this.errorFunction(e)},willTransition:function(){store.unloadAll("user_type"),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.Action||(removeViewPortFromAsapWidget(),window.isHelpOptionOpened||ZohoHCAsap.Action("close"))}}},{mixins:["crm-lock-rule-criteria"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.summary-module",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-summary-page-component.js","assignment-rules-model-wrapper.js","lyte-hovercard.js","custom_link_model.js","crux-parent-form-component.js","series_store.js","modules-list-page-profiles-popup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("summarypage")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["module-summary-page/crm-module-summary-page.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t).concat(r)},beforeModel:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();!0===crmTab.isZBCustomModule(e)&&Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.modules.module.links-and-buttons",e);"Messages"!==e&&"Approvals"!==e&&"CustomModule5009"!==e||(renderingUtils.displayPermissionDenied(),this.transition.abort()),"Visits"!==e||wmsBarInfo.isLiveDeskEnabled||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();return Lyte.resolvePromises({modulePermission:store.triggerAction("dummy","isModuleAccessable",{url:Crm.getCrmBasePath()+"/PageLayout.do?action=isModuleAccessable&module="+e,method:"POST"}),ModuleRecord:store.findRecord("module",moduleRecordMapping[e].id,{include:["layouts","profiles"]},void 0,void 0,{getMeta:!0})})},afterModel:function(e){if(void 0!==e&&(e.modulePermission instanceof String||"string"==typeof e.modulePermission)&&"No Permission"===e.modulePermission.trim())return this.transition.abort(),void Lyte.Component.registeredHelpers.showPopupToGoBackToSettingsIndexPage();var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();this.currentModel={currentModuleDetails:moduleRecordMapping[t],currentModule:t}},renderTemplate:function(){return{outlet:"#customizationDiv",component:"crm-summary-page",reRender:this.transition.data.fromRefresh}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.module.info"),Crm.partnerName]))},actions:{onError:function(e){(e.response.indexOf("You do not have sufficient permissions to perform this operation")>-1||e.response.indexOf("Insufficient Privileges to perform this operation")>-1||e.response.indexOf("the given module is not supported")>-1)&&(renderingUtils.displayPermissionDenied(),this.transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules.index-validation-rules",{model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=moduleRecordMapping[t].api_name,s=this.parent.getQueryParams().layoutId,n={module:r},i={module:r};s&&(n.layout_id=s,i.layout_id=s),i.getFieldObj=!0;var o=this;return Lyte.resolvePromises([store.triggerAction("validation_rule","rule_dependencyData",{},i),store.findAll("validation_rule",n,void 0,void 0,{version:"v2.2"}),store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.2/__features/validation_rules",method:"GET"}),store.findAll("layout",n)]).then((function(e){var r=!(!e[0].validation_rules||"SUCCESS"!==e[0].validation_rules.code)&&e[0].validation_rules.details;if(!r)return{accessible:"false"};var i,a=e[2]&&e[2].__features?e[2].__features[0]:{},l=e[1]&&e[1].validation_rule&&e[1].validation_rule.length?e[1].validation_rule:e[1].length?e[1]:[],c=s||"-1";return r&&1===r.layout_count?c=Object.keys(r.layout_details)[0]:r&&!r.layout_count&&r.master_layout_id&&(c=r.master_layout_id,r.layout_details={},r.layout_details[e[3][0].id]=e[3][0].name),o.transition.data&&o.transition.data.fieldId&&(i=o.transition.data.fieldId,delete o.transition.data.fieldId),{validationDetails:r,validationRules:l,validationInfo:a,selectedLayout:c,validationObj:n,moduleName:t,initField:i,accessible:"true"}}),(function(e){"INVALID_LAYOUT_ID"===(e=e.response&&"string"==typeof e.response?JSON.parse(e.response):e).code?renderingUtils.showCustomAlert(I18n.getMsg("crm.error.invalid.layoutid"),void 0,!0,(function(){crmHistory.backOneLevel()})):"NO_PERMISSION"!==e.code&&400!==e.status||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),o.transition.abort()),Lyte.Router.getRouteInstance().transition.abort()}))},renderTemplate:function(e,t){return $("#customizationDiv").addClass("p30 pT20"),{outlet:"#customizationDiv",component:"crm-validation-list",reRender:!0}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.validation.rules"),Crm.partnerName]));var r=document.querySelector("#validationRuleCustDiv");if(r&&"none"!==r.style.display){r.style.display="none";var s=r.querySelector("crm-validation-create");s&&s.remove(),(r=document.querySelector("#moduleCustomizationDiv"))&&(r.style.display="block")}if(featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var n=document.querySelector("crm-validation-list");n&&n.component&&n.component.actions.openModal()}Crm.trackSpotLightAction("Validation Rule - Page Visited",{Module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()})},beforeExit:function(){var e=document.querySelector("#validationRuleCustDiv");if(e){e.style.display="none";var t=e.querySelector("crm-validation-create");t&&t.remove()}removeViewPortFromAsapWidget(),"undefined"!=typeof ZohoHCAsap&&validationUtils.isNotEmpty(ZohoHCAsap)&&ZohoHCAsap.Action("close")},actions:{willTransition:function(e){Search.isVRCriteria&&(Search.isVRCriteria=!1);var t=document.querySelector("#moduleCustomizationDiv");t&&(e.target.indexOf("crm.settings.section.modules.index-modules")<0?t.style.display="block":t.style.display="none")}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules.view-validation-rule",{queryParams:["layoutId"],getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM)},model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=moduleRecordMapping[Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()].api_name,s=this.getQueryParams().layoutId,n=this.getDynamicParam(),i={module:r,layout_id:s},o={module:r,getFieldObj:!0,layout_id:s},a=this;return Lyte.resolvePromises([store.triggerAction("validation_rule","rule_dependencyData",{},o),store.findAll("validation_rule",i,void 0,void 0,{version:"v2.2"}),store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.2/__features/validation_rules",method:"GET"}),store.findRecord("layout",s,{module:r})]).then((function(e){var r=!(!e[0].validation_rules||"SUCCESS"!==e[0].validation_rules.code)&&e[0].validation_rules.details;if(!r)return{accessible:"false"};var o=e[2]&&e[2].__features?e[2].__features[0]:{},a=store.peekRecord("validation_rule",n);return a&&a.id?store.findRecord("validation_rule",n,i,void 0,void 0,{version:"v2.2"}).then((function(a){var l=a[0];if(!l)return{accessible:"noRule"};var c={},u=r.criteria_field[0][t].filter((function(e){return e.id===l.field.id}))[0],d=o.components,m=r.excess_fields[0][t];if(validationUtils.isEmpty(u)&&(u=m.filter((function(e){return l.field.id===e.id}))[0]),!u)return{accessible:"noRule"};c.id=s,c.name=r.layout_details[s];var p=d.filter((function(e){return"validation_rule_custom_function"===e.api_name}))[0].details,g=p?p.limits.total:0,f=d.filter((function(e){return"validation_rule_branch_condition"===e.api_name}))[0].details,h=f?f.limits.total:0,y=d.filter((function(e){return"validation_rule_primary_condition"===e.api_name}))[0].details,C=y?y.limits.total:0,v=e[3][0],_=v&&v.fields?v.fields:[],R=r.criteria_field[0][t],w=[],b=0;R.forEach((function(e){var t=_.filter((function(t){return t.id===e.id}))[0];t&&(w[b]=t,b+=1)})),m.forEach((function(e){e.api_name=e.api_name.split(".")[1],e.type="unused",w.push(e)}));var D=l.conditions?l.conditions:[],M=l.field_validation?"true":"false";return D&&D.forEach((function(e){null==e.sub_conditions?"stop_saving_records"===e.alert_type?(e.alert_type=!0,"on_primary_field"===e.alert_preference?e.alert_preference=!0:e.alert_preference=!1):(e.alert_type=!1,e.alert_preference=!0):e.sub_conditions.forEach((function(e){"stop_saving_records"===e.alert_type?(e.alert_type=!0,"on_primary_field"===e.alert_preference?e.alert_preference=!0:e.alert_preference=!1):(e.alert_type=!1,e.alert_preference=!0)}))})),{ruleId:n,validationRules:e[1],currentLayout:c,fieldList:w,excessFields:m,selectedField:u,criteriaType:l.validation_type,validationObj:i,executionRule:l.execution_type,fieldValRule:M,criteriaArray:D,functionSelected:l.associated_function?l.associated_function:{},primaryLimit:C,subLimit:h,totalLimit:o.details.limits.total,functionLimit:g,ruleDeactivated:!l.active,notPlugin:"market_place_plugin"!==l.source,accessible:"true"}})):{accessible:"noRule"}}),(function(e){"INVALID_LAYOUT_ID"===(e=e.response&&"string"==typeof e.response?JSON.parse(e.response):e).code?renderingUtils.showCustomAlert(I18n.getMsg("crm.error.invalid.layoutid"),void 0,!0,(function(){crmHistory.backOneLevel()})):"NO_PERMISSION"!==e.code&&400!==e.status||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),a.transition.abort()),Lyte.Router.getRouteInstance().transition.abort()}))},renderTemplate:function(){return{outlet:"#validationRuleCustDiv",component:"crm-validation-create"}},afterRender:function(e){if(e&&e.validation_rules&&e.validation_rules.length);else{var t=$("#validationRuleCustDiv");$("#moduleCustomizationDiv").hide(),t.removeClass("p30").addClass("p0"),t.show();var r=this;setTimeout((function(){r.setHeightForValidationCreate(),r.debounceResizeListener=$L.debounce((function(){r.setHeightForValidationCreate()}),300),window.addEventListener("resize",r.debounceResizeListener,!0)}),1e3)}},beforeExit:function(){window.removeEventListener("resize",this.debounceResizeListener,!0),delete this.debounceResizeListener}},{mixins:["crm-validation-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules",{queryParams:["layoutId"],getResources:function(){var e=moduleRecordMapping[this.transition.info.dynamicParams[0]];if(Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||e&&"team_based"===e.access_type&&e.private_profile&&"Admins"===e.private_profile.name){(t=[]).push(networkUtils.returnDependencyFiles(["crm-validation-resources.js"],ResourceConstants.CRMClient)),t.push(networkUtils.returnDependencyFiles(["setup/validation-rules/crm-validation-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED?t.push(networkUtils.returnDependencyFiles(["setup/validation-rules/crm-validation-resources.css","setup/validation-rules/crm-validation-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)):t.push(networkUtils.returnDependencyFiles(["setup/validation-rules/crm-validation-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t,r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationRules")],ResourceConstants.CRM);return t=t.concat(r)}},redirect:function(){if("crm.settings.section.modules.module.validation-rules"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.modules.module.validation-rules.index-validation-rules",dynamicParams:[Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()],queryParams:this.transition.info.queryParams}).data=e}},afterRender:function(){$("#mainMenuTabDiv").show(),$("body").removeClass("builder_page_body"),$("#layout_landing_right").perfectScrollbar("destroy"),$("#customizationDiv").addClass("helpOverflowHide")},beforeExit:function(){$("#customizationDiv").removeClass("helpOverflowHide")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-services-mb-mixin.js"],ResourceConstants.CRMClient)},redirect:function(){"crm.settings.section.modules.module"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layouts",this.getDynamicParam())},model:function(){return CML.setLockingConfigSupportedModules()},renderTemplate:function(e,t){if(moduleRecordMapping[t.dynamicParam]||crmConstants.moduleBuilderSpecialModules.includes(t.dynamicParam))$("#setupshow").hide(),$("#result").html(""),$("#moduleCustomizationDiv").show(),CrmPageLayout.resetChanges();else{var r=networkUtils.getImageUrl("error_crm.svg",ResourceConstants.CRMClient),s=document.createElement("invalid-module");s.innerHTML='<script>document.getElementById("currentURL").innerHTML = window.location.href; //No I18N<\/script><div class="aligncenter wbBreakWord w600 mAuto invalidURLErrorMsg tlCenter pA"><div class="w180 h350 mAuto"><img src="'+r+'" alt="Invalid URL" /></div><div class="crmHeadingColor crm-heading-font-size crm-font-bold mB10"><crmutil-icon icon-name="notallowed" icon-class="zcicn-notallowed  zcicn_red zcicn24"></crmutil-icon>'+I18n.getMsg("crm.invalidurl.title")+'</div><div class="crm-base-font-size crmLabelColor lh20">'+I18n.getMsg("crm.invalidurl.note",'<strong class="crmBaseColor">'+window.location.href+"</strong>")+'</div><lyte-button lt-prop-yield="true" lt-prop-appearance="default" onclick= "Lyte.Router.transitionTo({route:\'crm.settings.section.modules.index-modules\'});" class="mT18 mR0"><template is="registerYield" yield-name="text">'+I18n.getMsg("crm.invalidurl.goback")+"</template></lyte-button></div>",$("#result").html(s.innerHTML),$("#setup_new_leftmenuDiv").closest("td").hide(),this.transition.abort()}},afterRender:function(){$L("#setup_new_ContentDiv").addClass("pR"),$("#setup_new_leftmenuDiv").closest("td").hide()},beforeExit:function(){$L("#setup_new_ContentDiv").removeClass("pR")},actions:{willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module")<0&&($("#setupshow").show(),$L(".nextGenUILeftMenu").css("display",""),$("#moduleCustomizationDiv").hide())},didTransition:function(){var e=this.getDynamicParam(),t=this.transition.target,r=t.split("crm.settings.section.modules.module.")[1].split(".")[0],s=crmTab.isZBCustomModule(e),n=crmTab.isZSCustomModule(e),i=!CML.lockingConfigSupportedModules||CML.lockingConfigSupportedModules.indexOf(e)<0;!s&&!n||("links-and-buttons"===r||"custom-button"===r||"custom-link"===r)&&moduleRecordMapping[e].viewable||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.custom-button",crmTab.getFirstZBModule(e)),"field-permissions"!==r&&"field-privacy"!==r||(r="field-listing"),"Services"!==e&&"jobsheet-layouts"===r&&(r="layouts",Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e)),"Services"===e||"Appointments"===e||Crm.userDetails.CALLS_PREFERENCE&&"Calls"===e||"preferences-module"!==r||(r="layouts",Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e)),"custom-button"!==r||featuresAvailable.Custom_Button||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e);var o=$("#cusLinkLI"),a=$L("#cusButtonLI"),l=o.children(),c=$("#record-lockingLI");if("crm.settings.section.modules.module.layouts.view-layout"!==t&&"crm.settings.section.modules.module.layouts.clone-layout"!==t){var u=$("#innerTabDiv"),d=$("#moduleListDiv"),m=$("#moduleCustomizationDiv");if($L("#infoLI,#formRulesLI,#layoutsLI,#validationRulesLI,#fieldsLI").css("display",""),i&&c.hide(),"Events"==e)o.hide(),u.find("#formRulesLI").show(),u.show();else if("Tasks"===e||"Calls"===e||"false"===u.find("#cusLinkLI").attr("bothAvailable"))"Tasks"!=e&&(l.html(I18n.getMsg("crm.customlink")),o.show(),a.hide()),"Tasks"===e?a.css("display","block"):"Calls"!==e||isNewCallView?u.find("#formRulesLI").show():u.find("#formRulesLI").hide(),u.show();else if("Users"==e)u.find("#cusLinkLI,#infoLI,#cusButtonLI,#formRulesLI").hide(),d.hide(),m.find("#modListSpan,#modListSpan1").mouseover((function(){CrmModule.newshowtt(I18n.getMsg("crm.back.users"))})).click((function(){parent.window.close()})),m.find("#manageUserDiv").show();else if(s||"CustomModule5009"===e){var p=u.find("#cusLinkLI");p.children().html(I18n.getMsg("crm.customlink")),p.show(),$L("cusButtonLI").css("display","block"),u.find("#infoLI,#formRulesLI,#layoutsLI,#validationRulesLI,#fieldsLI").hide(),u.show()}else{var g=$L("#cusLinkLI");g.children().html(I18n.getMsg("crm.customlink")),g.css("display","block"),u.find("#formRulesLI").show(),u.show(),a.css("display","block")}("SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled)&&a.hide();var f=$("#jobSheetLayoutsLI");"Services"===e?(this.showOrHideJobsheetLayout(),o.hide()):f.hide();var h=$("#preferencesLI");"Appointments"===e||"Services"===e?(h.show(),$("#cusLinkLI").hide(),a.hide()):Crm.userDetails.CALLS_PREFERENCE&&"Calls"===e?h.css("display","block"):h.hide(),u.find("link-to").attr("lt-prop-dp",'["'+e+'"]'),!$('#ModuleListUL option[value="'+e+'"]').length>0&&$("#ModuleListUL").append($("<option>",{value:e,text:Crm.moduleInfo[e].pluralLabel})),$("#moduleCustomizationDiv").find("#actionNavDiv").find("#modListSpan1").closest("link-to").attr("lt-prop-dp",'["'+e+'"]')}$("#customActionDiv").hide(),$("#moduleCustomizationDiv").find("#innerTabDiv").find("li").removeClass("active"),"layout-rules"!==r||("Calls"!==e||isNewCallView)&&"Users"!==e||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e),"custom-link"!==r||"Meetings"!==e&&"Events"!==e||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e);var y="crm.settings.section.modules.module."+r;$("#moduleCustomizationDiv").find("#innerTabDiv").find("link-to[lt-prop-route='"+y+"']").find("li").addClass("active");var C=$("#layoutsLI");if("P"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE||("Campaigns"===e&&CrmPageLayout.nonStandardSystemGivenLayoutCount>=1?C.find(".layoutLandingMPL_link").text(I18n.getMsg("crm.label.customize.layouts")):C.find(".layoutLandingMPL_link").text(I18n.getMsg("crm.lable.layout"))),"validation-rules"===r||"layout-rules"===r||"summary-module"===r||"field-listing"===r||"custom-button"===r||"layouts"===r||"links-and-buttons"===r||"customViewSettings"===r||"preferences-module"===r||"custom-link"===r){if($("#autoLinks").hide(),$("#templateLinks").hide(),i?c.hide():c.show(),"Calls"===e&&!isNewCallView||"Users"===e||"Visits"===e||"CustomModule5009"===e||s){var v=$("#formRulesLI");v.hide();var _=$("#validationRulesLI");_.hide(),(v.hasClass("active")||_.hasClass("active"))&&C[0].click()}var R=$("#eventPreferencesLI");"F"===Crm.userDetails.LICENSE_TYPE||"N"===Crm.userDetails.LICENSE_TYPE||"L"===Crm.userDetails.LICENSE_TYPE||!Crm.userDetails.IS_ADMIN||"Events"!==e&&"Meetings"!==e?R.hide():"Events"===e||"Meetings"===e?Crm.userDetails.MEETING_BRIDGE_ENABLED?R.show():R.hide():$("#innerTabDiv").find("#infoLI,#formRulesLI,#layoutsLI,#validationRulesLI,#fieldsLI").show()}var w=$('#ModuleListUL option[value="'+e+'"]'),b=Crm.moduleInfo[e].pluralLabel,D=$("#customizationDiv"),M=$("#layout_landing_left"),L=$("#layout_landing_right"),k=$(".moduleNameSection"),U=L.find(".moduleLandingName"),E=U.find("span"),P=(o=$("#cusLinkLI"),$L(".nextGenUILeftMenu"));s?E.text(crmTab.getDisplayName("Zoho Finance",!1)+" - "+b):E.text(Crm.moduleInfo[e].translatedPluralLabel),$(".landingModuleLists ul li").removeClass("selected"),$(".landingModuleLists ul li[data-zcqa='MPL_layoutListPage_"+e+"']").addClass("selected");var I=$(".landingModuleLists ul li.selected"),A=$L("#mainMenuTabDiv"),S=document.querySelector("crm-tab");("layout-rules"===r||"preferences-module"===r||"jobsheet-layouts"===r||"events_preferences"===r||"summary-module"==r?(D.addClass("p30 pT20"),M.show(),k.show(),P.show(),CML.layoutLandingResize()):"field-listing"==r?(P.show(),D.addClass("p30 pT20"),"Users"!==e?($("body").removeClass("fromUserManageFields"),M.show(),L.removeClass("w100_per pL20 fullInfoNoteDiv"),L.find("#innerTabDiv").addClass("pL15").removeClass("pL30"),U.removeClass("pR"),$("#modListSpan2").hide()):($("body").addClass("fromUserManageFields"),M.hide(),L.addClass("w100_per pL20 fullInfoNoteDiv"),L.find("#innerTabDiv").removeClass("pL15").addClass("pL30"),U.addClass("pR"),$("#modListSpan2").show()),k.show(),A.length>0&&(A.show(),S&&S.component&&S.component.resizeMenu()),$("body").removeClass("builder_page_body"),CML.layoutLandingResize()):"validation-rules"==r?(M.show(),k.show(),P.show(),CML.layoutLandingResize()):"links-and-buttons"==r?(D.addClass("p30 pT20"),M.css("display","block"),k.css("display","block"),P.css("display","block"),CML.layoutLandingResize()):"custom-link"===r?("Services"!==e&&"Appointments"!==e||(o.removeClass("active"),C[0].click()),D.addClass("p30 pT20"),M.css("display","block"),k.css("display","block"),P.css("display","block"),CML.layoutLandingResize()):"custom-button"===r&&("Services"===e||"Appointments"===e||"Calls"===e?(a.removeClass("active"),C[0].click()):(a.addClass("active"),a.css("display","block")),D.addClass("p30 pT20"),M.css("display","block"),k.css("display","block"),P.show(),CML.layoutLandingResize()),w.prop("selected",!0),thirdPartyUtils.bindSelect2("#ModuleListUL"),"layouts"!=r&&"jobsheet-layouts"!==r||"crm.settings.section.modules.module.layouts.view-layout"===t||"crm.settings.section.modules.module.layouts.clone-layout"===t||(A.length>0&&(A.show(),S&&S.component&&S.component.resizeMenu()),P.show(),k.show(),"Users"!==e?($("body").removeClass("fromUserManageFields"),M.show(),L.removeClass("w100_per pL20 fullInfoNoteDiv"),L.find("#innerTabDiv").addClass("pL15").removeClass("pL30"),U.removeClass("pR"),$("#modListSpan2").hide()):($("body").addClass("fromUserManageFields"),M.hide(),L.addClass("w100_per pL20 fullInfoNoteDiv"),L.find("#innerTabDiv").removeClass("pL15").addClass("pL30"),U.addClass("pR"),$("#modListSpan2").show()),D.addClass("p30 pT20"),E.text(moduleRecordMapping[e]?moduleRecordMapping[e].plural_label:e),CML.layoutLandingResize()),"Tasks"===e&&(l.html(I18n.getMsg("crm.customlink")),o.show(),u&&u.show()),"Events"===e)&&(o.hide(),a.children().html(I18n.getMsg("crm.customize.custombutton.label")),u&&u.show());if("map-dependency"!=r||"crm.settings.section.modules.module.map-dependency.create-map-dependency"!=t&&"crm.settings.section.modules.module.map-dependency.edit-map-dependency"!=t||(D.addClass("p30 pT20"),M.show(),P.show(),CML.layoutLandingResize()),I.length>0&&!renderingUtils.isElementInViewport(I)){var T=I.position().top;$L(".landingModuleLists").scrollTo(T)}("SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled)&&("Events"!==e?l.html(I18n.getMsg("crm.customlink")):("links-and-buttons"===r&&C[0].click(),o.removeClass("active"),o.hide()))}}},{mixins:["crm-services-mb-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.storage.users-list.user-emailstorage.modules-list",{queryParams:["user_id","module","folder_id","user_filter"],getDependencies:function(){return networkUtils.returnDependencyFiles(["emailStorage-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["emailStorage.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["storage/crm-email-user-email-storage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailStorageEmails")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){var e=this.transition.data.isReloadModuleNeeded;if(!$L("crm-email-storage-modules-list")[0]||e){var t,r,s=this.getQueryParams().user_id,n=$L("crm-email-storage-user-usage")[0];if(n&&n.component&&!e)t=n.getData("userStorageJson"),r=n.getData("mailClientJson");else{t=store.findRecord("sent_from_crm",s,{include_inner_details:"module_data.module.display_label,module_data.module.visible,module_data.module.viewable"},void 0,void 0,s),r=store.findRecord("mailbox_storage",s,void 0,void 0,void 0,s)}var i=this.getQueryParams().user_filter,o=this.getQueryParams().module,a=this.getQueryParams().folder_id;return Lyte.resolvePromises({userId:s,landingPage:!1,userDetails:!1,userEmailList:!0,show_landing_page:!0,userStorageJson:t,mailClientJson:r,loadingEmailPage:!1,userFilter:i,folderId:a,selectedModule:o})}},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"===e&&(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}},afterModel:function(){var e=this.transition.data.isReloadModuleNeeded;if(!$L("crm-email-storage-modules-list")[0]||e){this.currentModel.mailClientJson&&this.currentModel.mailClientJson[0]&&(this.currentModel.mailClientJson=this.currentModel.mailClientJson[0]),this.currentModel.userStorageJson&&this.currentModel.userStorageJson[0]&&(this.currentModel.userStorageJson=this.currentModel.userStorageJson[0]);var t=!e&&!this.getQueryParams().module&&!this.getQueryParams().folder_id;if(e||t){var r,s=this.transition.data.moduleOrFolderErr;if("errorInCrmEmails"===s||"noMailsInModule"===s||t){for(var n=this.currentModel.userStorageJson.module_data,i=n.length,o=!1,a=0;a<i;a++)if("recyclebin"===n[a].type||n[a].module.visible&&n[a].module.viewable){o=!0,"recyclebin"===n[a].type?(this.currentModel.selectedModule="recyclebin",r="Recycle Bin"):(this.currentModel.selectedModule=n[a].module.api_name,r=n[a].module.display_label);break}if(0===n.length||!o){var l=this.getQueryParams().user_id;return this.transitionTo({route:"crm.settings.section.storage.users-list.user-emailstorage",queryParams:{id:l},fragment:l}).data={isFromEmailsListRoute:!0},!0}var c=document.querySelector(".em_s-modulesulwrapper");c&&c.firstElementChild.classList.add("sel")}else{var u=this.currentModel.mailClientJson.folders_data[0];this.currentModel.folderId=u.folder.id,r=u.folder.display_label;var d=document.querySelector(".em_s-foldersulwrapper");d&&d.firstElementChild.classList.add("sel")}var m=$L("crm-email-storage-user-usage-email")[0];m&&m.component.setData("moduleDisplayName",r)}}},renderTemplate:function(){var e=this.transition.data.isReloadModuleNeeded;if(!$L("crm-email-storage-modules-list")[0]||e)return{outlet:"#result",component:"crm-setup-storage"}}}),Lyte.Router.registerRoute("crm.settings.section.modules",{getDependencies:function(){var e=[];return crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&e.push(networkUtils.returnDependencyFiles(["crm-model-orchestration-process.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["modules-list-page-helper.js"],ResourceConstants.CRMClient)),e},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js","zohocrm_modulesListPageNew.js"],ResourceConstants.CRM);e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-teammodule-components.js","crm-field-listing.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-teammodule-components.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["gdprDetailview.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-module-delete-denypop.js","crm-automationcomponentDenyPop.js","crm-client-portal-organize-modules.js","crm-moduledenypop.js","crm-event-picklist.js","lyte-colorpicker.js","crm-customization-unaccessible-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_fol.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM));var t=networkUtils.getI18nJSUrl("staticlookupfilter");e.push(networkUtils.returnDependencyFiles([t],ResourceConstants.CRM));var r=networkUtils.getI18nJSUrl("FieldOfLookup");e.push(networkUtils.returnDependencyFiles([r],ResourceConstants.CRM));var s=networkUtils.getI18nJSUrl("FORECASTS");e.push(networkUtils.returnDependencyFiles([s],ResourceConstants.CRM));var n=networkUtils.getI18nJSUrl("servicesetupkeys");e.push(networkUtils.returnDependencyFiles([n],ResourceConstants.CRM));var i=networkUtils.getI18nJSUrl("LineItemSubformMB");e.push(networkUtils.returnDependencyFiles([i],ResourceConstants.CRM));var o=networkUtils.getI18nJSUrl("InventoryModulePerm");e.push(networkUtils.returnDependencyFiles([o],ResourceConstants.CRM));var a=networkUtils.getI18nJSUrl("abmDependency");e.push(networkUtils.returnDependencyFiles([a],ResourceConstants.CRM));var l=networkUtils.getI18nJSUrl("MeetingVenuePref");e.push(networkUtils.returnDependencyFiles([l],ResourceConstants.CRM));var c=networkUtils.getI18nJSUrl("ModuleListPage");return e.push(networkUtils.returnDependencyFiles([c],ResourceConstants.CRM)),Crm.userDetails.isUserAnyTeamModuleAdmin&&(e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ManageUsers")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("profilePage"),networkUtils.getI18nJSUrl("PrivateProfileDifference")],ResourceConstants.CRM))),e},model:function(e){var t,r;if(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.settings.section.modules.module.canvas"))return this.transition.info.dynamicParams&&(t={params:{action:"getCustomizationModulesAndFeatures",module:r}},r=this.transition.info.dynamicParams[0],moduleRecordMapping[r]||crmConstants.moduleBuilderSpecialModules.includes(r)||(t={params:{action:"getCustomizationModulesAndFeatures"}})),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",t)},afterModel:async function(e){if(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.settings.section.modules.module.canvas")){if(void 0!==e&&(e instanceof String||"string"==typeof e)&&"No Permission"===e.trim())return this.transition.abort(),void Lyte.Component.registeredHelpers.showPopupToGoBackToSettingsIndexPage();if(this.transition.info.dynamicParams.length&&"Services"===this.transition.info.dynamicParams[0]&&"crm.settings.section.modules.module.jobsheet-layouts"===this.transition.target&&!e.showJobsheetLayout?(this.transition.abort(),crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()):Crm.moduleInfo.hasOwnProperty("Services")&&e.hasOwnProperty("showJobsheetLayout")&&(Crm.moduleInfo.Services.showJobsheetLayout=e.showJobsheetLayout),crmTab.isABMCCAvailable&&crmTab.isABMConfigured)try{Crm.userDetails.permissions.Crm_Implied_Manage_ABM?await store.findAll("orchestration_process",{category:"abm"}):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&await store.findAll("orchestration_process")}catch(e){murphy.error(e)}if(Crm.userDetails.TEAM_MODULE_ENABLED){store.peekAll("profile").filter((e=>"private_profile"===e.type)).length<=0&&store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"});let e=$L("crm-manage-users")[0],t=$L("crm-manage-profiles")[0];e&&e.component||Lyte.Component.render("crm-manage-users",{},"#manageUsers"),t&&t.component||Lyte.Component.render("crm-manage-profiles",{},"#manageProfiles")}}},redirect:function(){"crm.settings.section.modules"===this.transition.target&&(this.replaceWith("crm.settings.section.modules.index-modules").data=this.transition.data)},renderTemplate:function(e,t){if(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.settings.section.modules.module.canvas"))return{outlet:"#customizeModuleDiv",html:Handlebars.templates.ModuleCustomization(e)}},afterRender:function(){$("body").css("overflow-y","hidden"),$("#jobSheetLayoutsLI").hide()},beforeExit:function(){$("body").css("overflow-y","")}}),Lyte.Router.registerRoute("crm.settings.section.old-territories.old-create-territory",{queryParams:["parentId"],model:function(){var e=this.getQueryParams().parentId,t={params:{action:"createConfig"}};return e&&(t.params.parentId=e),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",t)},renderTemplate:function(e){if(!(e.indexOf("REACHED_MAX_LIMIT")>=0))return{outlet:"#result",html:e};var t=e.split("###")[1],r=I18n.getMsg("crm.territory.alert.add",t);setTimeout((function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:r,ltPropType:"error"}}),Lyte.Router.transitionTo({route:"crm.settings.section.old-territories.old-index-territories"})}),1)}}),Lyte.Router.registerRoute("crm.settings.section.old-territories.old-edit-territory",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM)},model:function(){var e={params:{action:"editTerritory",territoryId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",e)},renderTemplate:function(e){if("cannot edit organization territory"!==e)return{outlet:"#result",html:e};_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.territory.organization.territory.change.access.denied"),ltPropButtons:[{type:"accept",appearance:"primary",text:I18n.getMsg("crm.button.ok")}]},accept:function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.old-territories.old-index-territories")}})}}),Lyte.Router.registerRoute("crm.settings.section.old-territories.old-index-territories",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM)},model:function(){if(this.transition.cachedResponse)return this.transition.cachedResponse;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",{params:{action:"territoryList"}})},renderTemplate:function(e){return{outlet:"#result",html:e}},afterRender:function(){0===Crm.userDetails.TMENABLED?$L(".SI_innerTabsWrapper").addClass("dN"):$L(".SI_innerTabsWrapper").removeClass("dN"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.territory.hierarchy"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.old-territories",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.css"],ResourceConstants.CRMClient);return e.concat(t)},redirect:function(){"crm.settings.section.old-territories"===this.transition.target&&this.replaceWith("crm.settings.section.old-territories.old-index-territories")},beforeExit:function(){app.refetchModulesMeta=!0}}),Lyte.Router.registerRoute("crm.settings.section.old-territory-assign",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM))},model:function(){var e=this.transition.data,t=Object.keys(e).length>0?objectUtils.cloneObject(this.transition.data):{actiontype:"search"},r=Object.keys(e).length>0?"POST":"GET";return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryAssignment.do",r,{params:t})},renderTemplate:function(e){return{outlet:"#result",html:e}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.assign.territories"),Crm.partnerName]))},actions:{onError:function(e){e&&(Lyte.Router.transitionTo({route:"crm.settings.section.old-territories.old-index-territories",queryParams:{action:"territoryList"}}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),ltPropType:"error"}}))}}}),Lyte.Router.registerRoute("crm.settings.section.old-territory-rules",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM)},model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",{params:{action:"territoryRules"}})},renderTemplate:function(e){return{outlet:"#result",html:e}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.view.rules"),Crm.partnerName]))},actions:{onError:function(e){e&&(Lyte.Router.transitionTo({route:"crm.settings.section.old-territories.old-index-territories",queryParams:{action:"territoryList"}}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),ltPropType:"error"}}))}}}),Lyte.Router.registerRoute("crm.settings.section.orchestration.edit-orchestration-old",{}),Lyte.Router.registerRoute("crm.settings.section.orchestration.edit-orchestration",{getDependencies:function(){var e=[];return crmTab.isABMConfigured&&(e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-abm-module.js","setup/orchestration/crm-orchestration-abm-common.js"],ResourceConstants.CRMClient)),e},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=[{parent:networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM),child:[networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-builder.js","setup/orchestration/crm-orchestration-details.js","setup/orchestration/crm-orchestration-abm-module.js","crm-pathfinder-create-wrapper.js","crm-pathfinder-view-touchpoints.js","crm-pathfinder-view-reports.js","orchestration_config.js","orchestration_common.js","automation/common/crm-mergefield-multilevel.js","setup/crm-actions-readmode-model.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crm-tag-helpers.js","crm-tag-mixin.js","crux-combo-box.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient)]}].concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM));e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-builder.css","automation/common/crm-mergefield-multilevel.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient));var t=fetchAutomationFunctionFiles();return e=e.concat(t),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-rtl.css"],ResourceConstants.CRMClient))),e}},beforeModel:function(){Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter?(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort()):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){if(Crm.userDetails.CC_SERVICE_ENABLED)return Lyte.resolvePromises({orchestration_list:CommandCenterLoader.getJourneyList()});return Lyte.resolvePromises({modules:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta")[0].supported_state_modules:store.findAll("orchestration_meta").then((function(){return store.peekAll("orchestration_meta")[0].supported_state_modules})),orchestrationMeta:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta")[0]:store.findAll("orchestration_meta"),orchestration_list:this.getCachedOrchestrationList().length?this.getCachedOrchestrationList():store.findAll("orchestration_process"),process:store.findRecord("orchestration_process",e.dynamicParam),approval_process_list:store.peekAll("approval_process_list").length?store.peekAll("approval_process_list")[0]:store.findAll("approval_process_list"),webform_list:store.peekAll("webform").length?store.peekAll("webform")[0]:store.findAll("webform",{feature_name:"Orchestration"})})},afterModel:function(e,t){if(Crm.userDetails.CC_SERVICE_ENABLED){var r=t.dynamicParam.toString(),s=!0;return""===e.orchestration_list?e.orchestration_list=[]:e.orchestration_list=JSON.parse(e.orchestration_list).journeys,e.orchestration_list.each((function(e){e&&e.id===r&&(s=!1)})),void(s&&this.transitionToOrchestrationIndex())}Lyte.registeredMixins.orchestration.isAbmOrchestration(t.dynamicParam,store.peekAll("orchestration_process"))&&!Crm.userDetails.permissions.Crm_Implied_Manage_ABM_Journeys&&this.transitionToOrchestrationIndex();var n=this.getGroupedOrchestration(e.orchestration_list);e.orchestrationVersions=n[e.process[0].group_id],e.isABMConfigured=crmTab.isABMConfigured;var i=e.process[0];i.$.set("cliqEnabled",e.orchestrationMeta.cliq_integration),i.$.set("googleChatEnabled",e.orchestrationMeta.google_chat_integration),i.$.set("slackEnabled",e.orchestrationMeta.slack_integration),i.$.set("microsoftTeamsEnabled",e.orchestrationMeta.microsoft_teams_integration),i.$.set("whatsappEnabled",e.orchestrationMeta.whatsapp_integration),i.$.set("smsEnabled",e.orchestrationMeta.sms_integration),i.$.set("unsupportedActions",e.orchestrationMeta.unsupported_actions);var o="draft"===i.status||"temp"===i.status;i.$.set("isEditable",o),i.$.set("autoSaveStatusText",""),i.states&&i.states.length?(i.$.set("isFirstStateAdded",!0),i.$.set("showRightPanel",!0)):(i.$.set("isFirstStateAdded",!1),i.$.set("showRightPanel",!1)),Lyte.registeredMixins.salesiq_chat.popoverCloseClicked||(Lyte.registeredMixins.salesiq_chat.popoverCloseClicked=store.peekRecord("orchestration_meta","1").enabled_redis_keys.cc_widget_chat_close_clicked||!1),store.findAll("layout",{module:moduleRecordMapping.Campaigns.api_name},!0),this.currentModel={data:e},crmTab.isABMConfigured&&window.parent.Lyte.Router.getRouteInstance().component&&window.parent.Lyte.Router.getRouteInstance().component.getData("isABM_CC_Page")&&window.parent.Lyte.Router.getRouteInstance().component.getData("from_ABM_Segment_Page")&&(this.currentModel.from_ABM_Segment_Page=!0),crmTab.isABMConfigured&&window.parent.Lyte.Router.getRouteInstance().component&&window.parent.Lyte.Router.getRouteInstance().component.getData("isABM_CC_Page")&&window.parent.Lyte.Router.getRouteInstance().component.getData("from_ABM_Journey_Detail_Page")&&(this.currentModel.from_ABM_Journey_Detail_Page=!0);for(var a=i.transitions,l=a.length,c=this,u=0;u<l;u++){var d=a[u];if(d&&d.triggers&&2===d.triggers.length&&("auto_segment"===d.triggers[0].type||"manual_segment"===d.triggers[0].type)){var m=d.triggers[0].details;return i.$.set("segment_id",m.segment.id),c.currentModel.segment_id=m.segment.id,Lyte.resolvePromises({account_module:store.findAll("abm_module",{account:"include_inner_details=name.display_label"},!0,!0,{module:"account"}),contact_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"contact"}),deal_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"deal"}),product_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"product"}),label_fields:store.findAll("field",{module:"ABM_Account__s",type:"all"},!0,!0,{apiVersion:"4"}),segment:store.findAll("segment")}).then((function(t){var r,s=[],n=[],i=store.peekAll("module");s[0]=t.account_module,s[1]=t.contact_module,s[2]=t.deal_module,s[3]=t.product_module;for(var o=0;o<4;o++)(r={}).plural_label=i.find((e=>e.api_name===s[o].api_name)).plural_label,r.api_name=s[o].api_name,r.id=s[o].id,n.push(r);var a=e.modules;if(a&&a.forEach((function(e){"Tasks"!==e.api_name&&"Calls"!==e.api_name||n.push(e)})),e.modules=n,c.currentModel.modulesForAbm=n,t.label_fields.forEach((function(e){"RFM_Label__s"===e.api_name?c.currentModel.rfm_fields=e.pick_list_values:"Firmographic_Label__s"===e.api_name&&(c.currentModel.firmographic_fields=e.pick_list_values)})),t.segment&&0===t.segment.length&&c.currentModel.segment_id)return Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.orchestration.index-orchestration").data={invalidABMProcess:!0},!1;c.currentModel.segmentArray=t.segment;var l=[];t.segment.forEach((function(e){"dynamic"===e.type&&l.push(e)})),c.currentModel.segmentList=l}))}}},renderTemplate:function(){if($L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$(".new_setupview").addClass("newSetupRightShow"),!Crm.userDetails.CC_SERVICE_ENABLED)return customFunctionsObj.isFrom="automation",{outlet:"#result",component:"crm-orchestration-builder"}},afterRender:function(e,t){if(Crm.userDetails.CC_SERVICE_ENABLED){$("#result").addClass("h100_per oH"),CommandCenterLoader.loadJourneyBuilder(t.dynamicParam.toString(),"result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/journey-builder")}else{var r=isChatEnabled?28:0,s=$L("#setup_new_ContentDiv"),n=renderingUtils.windowHeight-(s.offset().top+r);"true"===this.transition.info.queryParams.isABM_CC_Page&&(n+=28);e.data.process[0];var i=Lyte.registeredMixins.orchestration_config;wfmergefield.initMergeFieldDetl("Orchestration"),e.data.orchestrationMeta.enabled_trial_features.COMMANDCENTER_INTEG_TRIGGERS||(i.limits.triggers.per_transition=1),e.data.orchestrationMeta.enabled_trial_features.SALES_SIGNALS_CUSTOM_MODULE_SUPPORT&&(i.triggers.defaultTriggers[16].regexForSupportedModules=Lyte.registeredMixins.orchestration.constants.supportedModulesRegex.LeadsContactsCustom),automationActions.isBusinessHourAvailable=store.peekAll("orchestration_meta")[0].business_hours_enabled,wfActions.isNewConvertUIEnabled=store.peekAll("orchestration_meta")[0].convert_new_ui_enabled,setTimeout((function(){s.css({height:n+"px"})}),800)}e.data.process[0],i=Lyte.registeredMixins.orchestration_config;wfmergefield.initMergeFieldDetl("Orchestration"),e.data.orchestrationMeta.enabled_trial_features.COMMANDCENTER_INTEG_TRIGGERS||(i.limits.triggers.per_transition=1),e.data.orchestrationMeta.enabled_trial_features.SALES_SIGNALS_CUSTOM_MODULE_SUPPORT&&(i.triggers.defaultTriggers[16].regexForSupportedModules=Lyte.registeredMixins.orchestration.constants.supportedModulesRegex.LeadsContactsCustom),automationActions.isBusinessHourAvailable=store.peekAll("orchestration_meta")[0].business_hours_enabled,wfActions.isNewConvertUIEnabled=store.peekAll("orchestration_meta")[0].convert_new_ui_enabled,setTimeout((function(){s.css({height:n+"px"})}),800)},beforeExit:function(e){if(Crm.userDetails.CC_SERVICE_ENABLED)$("#result").removeClass("h100_per oH");else{var t=Lyte.registeredMixins.orchestration_builder;store.unloadAll("orchestration_state"),store.unloadAll("orchestration_transition"),wfmergefield.clearMergeFieldDetl(),t.resetBuilderInstance(),store.clearCachedQuery("layout",{module:moduleRecordMapping.Campaigns.api_name}),store.unloadAll("orchestration_process")}},actions:{onBeforeLoad:function(e){if(crmTab.isABMConfigured&&window.parent.Lyte.Router.getRouteInstance().component&&window.parent.Lyte.Router.getRouteInstance().component.getData("isABM_CC_Page")&&window.parent.Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]!==e.dynamicParam)return $L("#basic").hide(),window.parent.Lyte.Router.getRouteInstance().transitionTo("abm.orchestrations.journey-builder",e.dynamicParam),this.transition.abort(),!1},onError:function(e){return this.routeErrorHandling(e),!1}}},{mixins:["orchestration"]}),Lyte.Router.registerRoute("crm.settings.section.orchestration.index-orchestration",{queryParams:[],getResources:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-details.js","crm-pathfinder-create-wrapper.js","crm-pathfinder-view-touchpoints.js","crm-pathfinder-view-reports.js","orchestration_common.js"],ResourceConstants.CRMClient);return e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PathFinder")],ResourceConstants.CRM)),e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-details.css"],ResourceConstants.CRMClient))},getDependencies:function(){var e=[];return crmTab.isABMConfigured&&(e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-abm-common.js","setup/orchestration/crm-orchestration-abm-module.js"],ResourceConstants.CRMClient)),e},beforeModel:function(){return Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter&&(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("orchestration_process"),store.findAll("orchestration_meta")},model:function(e){return Lyte.resolvePromises({orchestrations:Crm.userDetails.CC_SERVICE_ENABLED?CommandCenterLoader.getJourneyList():store.findAll("orchestration_process"),orchestrationMeta:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta"):store.findAll("orchestration_meta"),approval_process_list:store.findAll("approval_process_list"),webform_list:store.findAll("webform",{feature_name:"Orchestration"}),module:store.findAll("module")})},afterModel:function(e){if(e.isSandbox=Crm.userDetails.isSandbox,e.cc_enabled=Crm.userDetails.CC_SERVICE_ENABLED,e.orchestrationMeta.new_flow?e.is_newOrg=e.orchestrationMeta.new_flow:e.orchestrationMeta[0].new_flow&&(e.is_newOrg=e.orchestrationMeta[0].new_flow),Crm.userDetails.CC_SERVICE_ENABLED){if(""===e.orchestrations?e.orchestrations=[]:e.orchestrations=JSON.parse(e.orchestrations).journeys,e.orchestrationsAllVersions=e.orchestrations,void 0!==e.orchestrations&&e.orchestrations.length>0){var t=this.getGroupedOrchestration(e.orchestrations);e.orchestrationList=this.getDisplayableOrchestrationsList(t),e.orchestrationList.forEach((function(e){e.created_date_display_value=null!==e.created_time?Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(e.created_time)):null,e.created_time_display_value=null!==e.created_time?Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(e.created_time),!0):null,e.modified_date_display_value=null!==e.modified_time?Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(e.modified_time)):null,e.modified_time_display_value=null!==e.modified_time?Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(e.modified_time),!0):null,e.modified_user_image=null!==e.modified_by?commonUtils.getPhotoURL(e.modified_by.zuid):null,e.versionCount=e.version_details.version_number,e.statusDominatingProcess.versionList=t[e.group_id]}))}else e.orchestrations=[];e.filteredOrchestrationList=e.orchestrationList,e.isABMConfigured=!1,e.maxCountOfCRMProcess=this.getOrchestrationsCountForLicense()}else{e.orchestrationsAllVersions=[];t=this.getGroupedOrchestration(e.orchestrations);if(e.orchestrationList=this.getDisplayableOrchestrationsList(t),e.orchestrationList.forEach((function(e){var r=t[e.group_id].length;e.$.set("versionCount",r),e.statusDominatingProcess.$.set("versionList",t[e.group_id])})),e.filteredOrchestrationList=e.orchestrationList.filter((e=>"crm"===e.category)),e.isABMConfigured=!1,e.maxCountOfCRMProcess=this.getOrchestrationsCountForLicense(),e.isABMConfigured){e.segmentList=store.peekAll("segment"),e.maxCountOfABMProcess=this.getABMOrchestrationsCountForLicense();var r=[];e.segmentList.forEach((function(e){e.journey_id_list||!e.refresh_details||"completed"!==e.refresh_details.status&&"scheduled"!==e.refresh_details.status||r.push(e)})),e.displayableSegmentList=r;var s=0,n=0;e.orchestrationList.forEach((function(e){"crm"===e.category?s++:"abm"===e.category&&n++})),e.crmOrchestrationsCount=s,e.abmOrchestrationsCount=n,e.maxCountOfAllProcess=e.maxCountOfCRMProcess+e.maxCountOfABMProcess}}Lyte.registeredMixins.salesiq_chat.popoverCloseClicked||(Lyte.registeredMixins.salesiq_chat.popoverCloseClicked=store.peekRecord("orchestration_meta","1").enabled_redis_keys.cc_widget_chat_close_clicked||!1)},renderTemplate:function(){return{outlet:"#result",component:"crm-orchestration-details"}},afterRender:function(){var e=RebrandLinkUtil.getProperties("PF_VISITED_COMMANDCENTER_TAB").PF_VISITED_COMMANDCENTER_TAB;Lyte.registeredMixins.pathfinder.trackActionsDoneInPathfinder(e,RebrandLinkUtil.getProperties("PF_VISITED_COMMANDCENTER_TAB_ID").PF_VISITED_COMMANDCENTER_TAB_ID),$L("#result").addClass("h100_per"),this.transition.data.invalidProcess?$L("#processNotExistAlert").e.ltProp("show",!0):this.transition.data.invalidABMProcess&&$L("#abmProcessNotExistAlert").e.ltProp("show",!0)},actions:{onBeforeLoad:function(){var e=this.transition.data;if(crmTab.isABMConfigured&&window.parent.Lyte.Router.getRouteInstance().component&&window.parent.Lyte.Router.getRouteInstance().component.getData("isABM_CC_Page")){$L("#basic").hide();let t=window.parent.Lyte.Router.getRouteInstance();return t.component.getData("from_ABM_Segment_Page")?(t.transitionTo("abm.segments.segment.home",t.component.getData("abmSegmentId")).action=e.action,!1):t.component.getData("from_ABM_Journey_Detail_Page")?(t.transitionTo("abm.orchestrations.detail.insights",t.component.getData("journeyId")).action=e.action,!1):(window.parent.Lyte.Router.getRouteInstance().transitionTo("abm.orchestrations.index").action=e.action,!1)}},didTransition:function(){$L("#mainMenuTabDiv").show(),$L(".nextGenUILeftMenu").show(),featuresAvailable.NEXTGENUI_ENABLED||$("#mainMenuTabDiv crm-tab")[0].component.resizeMenu()},onError:function(e){return this.routeErrorHandling(e),!1}}},{mixins:["orchestration","pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.orchestration.orchestration-reports-old",{}),Lyte.Router.registerRoute("crm.settings.section.orchestration.orchestration-reports",{getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM),t=[{parent:networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM),child:[networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-reports.js","setup/orchestration/crm-orchestration-abm-common.js","orchestration_common.js","crm-analytical-component-model.js"],ResourceConstants.CRMClient)]}].concat(e);return t=t.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-reports.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-rtl.css"],ResourceConstants.CRMClient))),t=t.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))}},model:function(e){if(!Crm.userDetails.CC_SERVICE_ENABLED)return Lyte.resolvePromises({processId:e.dynamicParam,orchestration_list:this.getCachedOrchestrationList().length?this.getCachedOrchestrationList():store.findAll("orchestration_process"),dashboard_details:store.findAll("Analytics",{feature_type:"Orchestration"})})},beforeModel:function(){Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter?(renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort()):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow?commonUtils.showHideLoadingDiv(!0):(renderingUtils.displayPermissionDenied(),this.transition.abort())},afterModel:function(e){if(!Crm.userDetails.CC_SERVICE_ENABLED){var t=this.getGroupedOrchestration(e.orchestration_list),r=store.peekRecord("orchestration_process",e.processId);e.orchestrationVersions=r?t[r.group_id].filter((function(e){return"draft"!==e.status})):[],this.currentModel={data:e},commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED)return networkUtils.initChart(),{outlet:"#result",component:"crm-orchestration-reports"}},afterRender:function(e,t){if(Crm.userDetails.CC_SERVICE_ENABLED){$("#result").addClass("h100_per oH"),CommandCenterLoader.loadJourneyDefaultReports(t.dynamicParam.toString(),"result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/journey-builder"),$L("#mainMenuTabDiv").hide(),$(".new_setupview").addClass("newSetupRightShow");var r=isChatEnabled?28:0,s=$L("#setup_new_ContentDiv"),n=renderingUtils.windowHeight-(s.offset().top+r);s.addClass("oH"),setTimeout((function(){s.css({height:n+"px"})}),800)}else{r=isChatEnabled?28:0,s=$L("#setup_new_ContentDiv"),n=renderingUtils.windowHeight-(s.offset().top+r);$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),s.addClass("oHImp"),setTimeout((function(){s.css({height:n+"px"})}),800)}$L(".setupleftmenutd , #setupInnerLinks").hide()},beforeExit:function(){Crm.userDetails.CC_SERVICE_ENABLED?$("#result").removeClass("h100p oH"):($L("#setup_new_ContentDiv").removeClass("oH"),$(".new_setupview").removeClass("reviewprocessDiv"),store.unloadAll("orchestration_process"),store.unloadAll("orchestration_state"),store.unloadAll("orchestration_transition"))},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),this.routeErrorHandling(e),!1}}},{mixins:["orchestration"]}),Lyte.Router.registerRoute("crm.settings.section.orchestration",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-store.js","crm-model-orchestration-process.js","crm-model-pathfinder-process.js","crm-pathfinder.js","webform-model.js","Analytics.js"],ResourceConstants.CRMClient);return e.push({parent:networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("orchestration")],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["orchestration_config.js"],ResourceConstants.CRMClient)}),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createrecordaction")],ResourceConstants.CRM)),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),e},getResources:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.js","orchestration_common.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient))},beforeExit:function(){Lyte.registeredMixins.orchestration_builder&&Lyte.registeredMixins.orchestration_builder.Orchestration.instance&&(Lyte.registeredMixins.orchestration_builder.Orchestration.instance.reset(),Lyte.registeredMixins.orchestration_builder.Orchestration.instance=null),Lyte.registeredMixins.orchestration_report&&Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance&&(Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance.reset(),Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance=null),window.Jsplumb=null,window.jsPlumb=null,window.Katavorio=null,window.Mottle=null,window.Biltong=null,window.jsPlumbUIComponent=null,window.FaraheyInstance=null,window.jsPlumbInstance=null,window.jsBezier=null,window.jsPlumbUtil=null,window.Farahey=null,store.unloadAll("orchestration_meta"),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM))},afterRender:function(){var e=$L("#setup_new_ContentDiv"),t=renderingUtils.windowHeight-(e.offset().top+28);LyteComponent.replaceWith=function(){var e=Array.from(arguments),t=e.shift();LyteComponent.ignoreDisconnect=!0;for(var r,s=t.parentNode,n=0;r=e[n];n++)s.insertBefore(r,t);t.remove(),LyteComponent.ignoreDisconnect=!1},e.css({height:t+"px"})},redirect:function(){function e(e,t){var r=Object.assign({},t.transition.info);r.route=e,t.replaceWith(r)}"crm.settings.section.orchestration"===this.transition.target?e("crm.settings.section.orchestration.index-orchestration",this):"crm.settings.section.orchestration.edit-orchestration-old"===this.transition.target?e("crm.settings.section.orchestration.edit-orchestration",this):"crm.settings.section.orchestration.orchestration-reports-old"===this.transition.target&&e("crm.settings.section.orchestration.orchestration-reports",this)}}),Lyte.Router.registerRoute("crm.settings.section.organization-emails",{redirect:function(){"crm.settings.section.organization-emails"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-configuration.organization-emails",this.replaceWith(this.transition.info))}}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details.edit-pathfinder",{getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-mixin-pathfinder-common.js","crm-mixin-pathfinder-action.js","lytecombobox.js","webform-model.js"],ResourceConstants.CRMClient)},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=networkUtils.returnDependencyFiles(["crm-pathfinder-view-touchpoints.js","crm-pathfinder-builder-header.js","setup/pathfinder/crm-pathfinder-config.js","crm-pathfinder.js","crm-mixin-pathfinder-config.js","crm-helper-getLookupPlaceholder.js","crm-helper-getDraftVersionLabelForPFDropdown.js","crm-helper-isEditPfButtonVisible.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","setup/automation/crm-automation-multi-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}},beforeModel:function(){Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter?(commonUtils.showHideLoadingDiv(),renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})),this.transition.abort()):Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(commonUtils.showHideLoadingDiv(),renderingUtils.displayPermissionDenied(),this.transition.abort()),Lyte.registeredMixins.pathfinder.currentProcessId=this.parent.getDynamicParam()?this.parent.getDynamicParam():this.getCurrentPfId()},model:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED)return Lyte.resolvePromises({pathfinderMeta:store.peekAll("pathfinder_meta"),webforms:store.peekAll("webform")&&store.peekAll("webform").length?store.peekAll("webform"):store.findAll("webform"),modules:store.peekAll("pathfinder_meta")[0].supported_modules})},renderTemplate:function(){if($L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$(".new_setupview").addClass("newSetupRightShow"),!Crm.userDetails.CC_SERVICE_ENABLED){customFunctionsObj.isFrom="automation",$L("crm-pathfinder-builder-header")[0].setData("isViewMode",!1),Lyte.registeredMixins.pathfinder.currentProcessId=this.parent.getDynamicParam()?this.parent.getDynamicParam():this.getCurrentPfId(),this.currentModel.process=this.getProcessData(),this.setCurrentStateData(this.currentModel.process);var e=$L("#pfVersionDropdown")[0];return e&&(e.ltProp("selected",""),e.ltProp("selected",this.currentModel.process.id)),{outlet:"#touchpointdetailview",component:"crm-pathfinder-createpage"}}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED){$("#result").addClass("h100_per oH"),CommandCenterLoader.loadPathFinderBuilder(Lyte.registeredMixins.pathfinder.currentProcessId,!1,"result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/path-finder");var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);setTimeout((function(){t.css({height:r+"px"})}),800)}else{$L("#result").addClass("h100_per");var s=this.getProcessData().currentState,n=$L(".pfstatelist.active")[0],i=$L("crm-pathfinder-builder-header")[0].component,o=i.getData("pathfinderVersions");if(Lyte.objectUtils(i.data.domElements.isbuilderView,"add","value",!0),o.forEach((function(e){$L("#pfVer_"+e.id).removeClass("eventNone")})),n){var a=n.offsetTop;a>=50?a-=50:a=0,$L("#pfAddStateScroll").scrollTop(a)}s&&s.$.error&&s.$.error.noTouchPoints&&$L("#triggerDropdown")[0].ltProp("show",!0);var l=$L(".pfcreatebuilderscrollscope");l.removeClass("pfcreatebuilderscrollscope").scrollTop(0),l.addClass("pfcreatebuilderscrollscope"),window.onbeforeunload=function(){var e=$L("crm-pathfinder-builder-header")[0].component.data.process;if(e){var t,r=e.currentState;if(r&&(r.triggers.forEach((function(e,r){if(t=$L("crm-pathfinder-create-touchpoints")[r]){Lyte.objectUtils(t.component.data.domElements.showCriteriaError,"add","value",!1);var s=document.querySelector("crux-criteria-editor#criteria_"+e.index);if(s){var n=s.getCriteria();n&&($u.isEqual(e.criteria,n,!1)||Lyte.objectUtils(e,"add","criteria",n))}}})),r.$.isDirty()))return"Sure?"}},commonUtils.showHideLoadingDiv()}},actions:{didTransition:function(){var e=$L("crm-pathfinder-builder-header")[0].component;e.disableCheckforMoreOptions(),e.data.domElements.disableButtonsForEdit.value&&Lyte.objectUtils(e.data.domElements.disableButtonsForEdit,"add","value",!1)},willTransition:function(e){var t=$L("crm-pathfinder-builder-header")[0].component;t.data.isErrorinBuilderView&&"active"!==t.data.process.status&&"inactive"!==t.data.process.status?e.abort():t.data.domElements.isStateCreatePop.show&&(e.pause(),setTimeout((function(){e.resume()}),400))},onError:function(){commonUtils.showHideLoadingDiv()}},beforeExit:function(){if(Crm.userDetails.CC_SERVICE_ENABLED)$("#result").removeClass("h100_per oH");else{var e=$L("crm-pathfinder-view-touchpoints")[0];e&&e.remove()}}},{mixins:["pathfinder","pathfinder_action"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details",{getResources:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["crm-pathfinder-create-wrapper.js","setup/pathfinder/crm-pathfinder-listview.js","crm-pathfinder-builder-header.js","crm-mixin-pathfinder-config.js","crm-mixin-pathfinder-action.js","crm-text-ellipsis.js","crm-helper-getLookupPlaceholder.js","crm-helper-getDraftVersionLabelForPFDropdown.js","crm-helper-isEditPfButtonVisible.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"],ResourceConstants.CRM)).concat(fetchAutomationFunctionFiles())},model:function(e){var t=e.dynamicParam?e.dynamicParam:this.getCurrentPfId();return Lyte.registeredMixins.pathfinder.currentProcessId=t,Crm.userDetails.CC_SERVICE_ENABLED?Lyte.resolvePromises({pathfinder_list:CommandCenterLoader.getPathFinderList()}):Lyte.resolvePromises({pathfinder_list:store.peekAll("pathfinder_process").length?store.peekAll("pathfinder_process"):store.findAll("pathfinder_process"),pathfinder_meta:store.peekAll("pathfinder_meta")[0].supported_modules,process:store.findRecord("pathfinder_process",t,{include_state_details:!0,include_inner_details:"field.label"}),modules:store.findAll("module")})},renderTemplate:function(e){if(Crm.userDetails.CC_SERVICE_ENABLED){var t=!0;return""===e.pathfinder_list?e.pathfinder_list=[]:e.pathfinder_list=JSON.parse(e.pathfinder_list).pathfinders,e.pathfinder_list.each((function(e){e&&e.id===Lyte.registeredMixins.pathfinder.currentProcessId&&(t=!1)})),void(t&&this.transitionToPathFinderIndex())}var r=this,s=r.getProcessData();return void 0===s&&(s=e.process[0],Lyte.registeredMixins.pathfinder.currentProcessId=s.id),s.states&&s.states.forEach((function(e){e.triggers&&e.triggers.forEach((function(e){r.validateIntegrationTriggers(e)}))})),$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),this.currentModel.pathfinderVersions=r.getGroupedPathFinders(e.pathfinder_list)[e.process[0].group_id],this.currentModel.process=s,$(".new_setupview").addClass("newSetupRightShow"),{outlet:"#result",component:"crm-pathfinder-create-wrapper"}},afterRender:function(){Lyte.Router.getRouteInstance().transition.data.isViewMode&&$L("crm-pathfinder-builder-header")[0].setData("isViewMode",!0),wfmergefield.initMergeFieldDetl("PathFinder"),commonUtils.showHideLoadingDiv()},actions:{onError:function(e){commonUtils.showHideLoadingDiv(),this.routeErrorHandling(e)}},beforeExit:function(){store.unloadAll("pathfinder_process")}},{mixins:["pathfinder_action","pathfinder_config","pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details.journey",{getDependencies:function(){return networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-report.js","crm-mixin-pathfinder-common.js","crm-mixin-pathfinder-action.js","crm-text-ellipsis.js","crux-smart-filter.js","webform-model.js"],ResourceConstants.CRMClient)},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){window.cssPath="",window.showContextPath="",window.productName="",window.zohoFontServerDomain="",window.fontServerDomain="localwebfonts.zohostatic.com",GroupShape=void 0;var e=networkUtils.returnDependencyFiles(["crm-pathfinder-view-reports.js","lyte-shapes.js","lyte-screengrab.js","crux-smart-filter-input.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zohocrm_pathfinder.js","zohocrm_reviewprocess.js"],ResourceConstants.CRM)).concat(fetchAutomationFunctionFiles());return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","setup/automation/crm-automation-multi-dropdown.css","lyte-shapes.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM))}},beforeModel:function(){var e=this.getProcessData();this.displayFailurepopforDraftReport(this.transition,e,I18n.getMsg("pf.journey"))},model:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED)return Lyte.resolvePromises({rawJourneyData:store.triggerAction("reports_journey","journey",void 0,void 0)})},renderTemplate:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){this.currentModel.processId=this.currentProcessId;var e=$L("crm-pathfinder-builder-header")[0];e.setData("isViewMode",!0),e.setData("isReportsTab",!0),this.currentModel.selectedTab="Journey";var t=Lyte.registeredMixins.pathfinder_action.getProcessData().states,r=[];t.forEach((function(e){e.end_state&&r.push(e.id)})),this.currentModel.endStates=r;var s=$L("#pfVersionDropdown")[0];return s&&(s.ltProp("selected",""),s.ltProp("selected",this.currentModel.processId)),{outlet:"#touchpointdetailview",component:"crm-pathfinder-view-reports"}}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED){$L("#result").addClass("h100_per oH"),CommandCenterLoader.loadPathFinderReports(Lyte.registeredMixins.pathfinder.currentProcessId,"journey","result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/path-finder"),$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),$L(".new_setupview").addClass("newSetupRightShow");var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);setTimeout((function(){t.css({height:r+"px"})}),800)}else{$L("#tab_3")[0].checked=!0;var s=$L("crm-pathfinder-view-reports")[0].component,n=$L(".pftabsliderheadernav"),i=$L("crm-pathfinder-builder-header")[0].component.getData("pathfinderVersions"),o=n.find("lyte-nav-item.lyteNavActive");let e,t,r,a,l;s.loadInitialData("Journey"),o.length&&(e=o[0].getBoundingClientRect(),t=n.find(".pftabslidernav"),r=Crm.userDetails.RTL_ENABLED?e.left-2:e.left-19,a=e.width-24),$L("#result").addClass("h100_per"),Crm.userDetails.RTL_ENABLED?s.setData("pfJourneyNavPopPlacement","rightBottom"):s.setData("pfJourneyNavPopPlacement","leftBottom"),o.length&&t.css({left:r,width:a}),i.forEach((function(e){$L("#pfVer_"+e.id).removeClass("eventNone")})),l=RebrandLinkUtil.getProperties("PF_JOURNEY_REPORT_CLICK").PF_JOURNEY_REPORT_CLICK,Lyte.registeredMixins.pathfinder.trackActionsDoneInPathfinder(l,RebrandLinkUtil.getProperties("PF_JOURNEY_REPORT_CLICK_ID").PF_JOURNEY_REPORT_CLICK_ID)}},beforeExit:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=$L("crm-pathfinder-view-reports")[0].component;e.setData("isReportRendered",!1),"undefined"!=typeof LyteShape&&LyteShape.container&&LyteShape.destroy(),window.removeEventListener("resize",e.pfJourneyChartResize)}}},{mixins:["pathfinder_action","pathfinder_common","pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details.report",{getDependencies:function(){return networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-report.js","crm-mixin-pathfinder-common.js","crm-mixin-pathfinder-action.js","crm-text-ellipsis.js","crux-smart-filter.js","webform-model.js"],ResourceConstants.CRMClient)},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=networkUtils.returnDependencyFiles(["crm-pathfinder-view-reports.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zohocrm_pathfinder.js","zohocrm_reviewprocess.js"],ResourceConstants.CRM)).concat(fetchAutomationFunctionFiles());return e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","setup/automation/crm-automation-multi-dropdown.css","crux-smart-filter-input.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-builder.css","setup/pathfinder/crm-pathfinder-global-colors.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}},beforeModel:function(){var e=this.getProcessData();this.displayFailurepopforDraftReport(this.transition,e,I18n.getMsg("crm.dashboard.path"))},model:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e={},t=Lyte.registeredMixins.pathfinder.currentProcessId;return e.page=1,e.per_page=100,Lyte.resolvePromises({pathReportData:store.triggerAction("reports_path","paths",void 0,e),pathfinder_process:void 0!==store.peekRecord("pathfinder_process",t)?store.peekRecord("pathfinder_process",t):store.findRecord("pathfinder_process",t,{include_state_details:!0,include_inner_details:"field.label"})})}},renderTemplate:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){this.currentModel.selectedTab="Path";var e=$L("crm-pathfinder-builder-header")[0];if(e.setData("isViewMode",!0),e.setData("isReportsTab",!0),this.currentModel.pathData=void 0,this.currentModel.pathReportData.meta){var t=objectUtils.cloneObject_new(this.currentModel.pathReportData);this.currentModel.scrollPathArray=objectUtils.cloneObject_new(t.pathfinder_paths),this.currentModel.scrollCount=1,t.pathfinder_paths=t.pathfinder_paths.slice(0,15),this.currentModel.pathData=t}this.currentModel.count=1,this.currentModel.isReportRendered=!0;var r=Lyte.registeredMixins.pathfinder_action.getProcessData().states,s=1,n={},i=[],o=[],a=[];a.push("Start"),o.push(a),(a=[]).push("Deleted State"),o.push(a),r.forEach((function(e){n[e.id]="breadCrumbColor"+s,(a=[]).push(e.name),o.push(a),e.end_state&&i.push(e.id),s++})),n[-1]="deletedState",this.currentModel.processId=Lyte.registeredMixins.pathfinder.currentProcessId,this.currentModel.colorBandRanges=o,this.currentModel.stateColorMap=n,this.currentModel.endStates=i;var l=$L("#pfVersionDropdown")[0];return l&&(l.ltProp("selected",""),l.ltProp("selected",this.currentModel.processId)),{outlet:"#touchpointdetailview",component:"crm-pathfinder-view-reports"}}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED){$("#result").addClass("h100_per oH"),CommandCenterLoader.loadPathFinderReports(Lyte.registeredMixins.pathfinder.currentProcessId,"path","result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/path-finder"),$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),$(".new_setupview").addClass("newSetupRightShow");var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);setTimeout((function(){t.css({height:r+"px"})}),800)}else{$L("#tab_1")[0].checked=!0;var s,n=$L("crm-pathfinder-view-reports")[0].component,i=n.getData("pathReportData"),o=$L("crm-pathfinder-builder-header")[0].component.getData("pathfinderVersions"),a=$L(".pftabsliderheadernav"),l=a.find("lyte-nav-item.lyteNavActive");let e,t,r;l.length&&(e=l[0].getBoundingClientRect(),t=a.find(".pftabslidernav"),s=Crm.userDetails.RTL_ENABLED?{left:e.left-2,width:e.width-24}:{left:e.left-19,width:e.width-24}),i&&i.pathfinder_paths&&i.pathfinder_paths.length<=15?$L("#pfReportsTableLazyLoading").addClass("vH"):$L("#pfReportsTableLazyLoading").removeClass("vH"),n.loadInitialData("Path"),$L(".pftabsliderheader.active",".pfDetailviewTabWrap").removeClass("active"),$L(".pftabsliderreport").addClass("active"),o.forEach((function(e){$L("#pfVer_"+e.id).removeClass("eventNone")})),$L("#result").addClass("h100_per"),l.length&&t.css(s),r=RebrandLinkUtil.getProperties("PF_PATH_REPORT_CLICK").PF_PATH_REPORT_CLICK,Lyte.registeredMixins.pathfinder.trackActionsDoneInPathfinder(r,RebrandLinkUtil.getProperties("PF_PATH_REPORT_CLICK_ID").PF_PATH_REPORT_CLICK_ID)}},beforeExit:function(){Crm.userDetails.CC_SERVICE_ENABLED&&$("#result").removeClass("h100_per oH")}},{mixins:["pathfinder_action","pathfinder_common","pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details.sankey",{getDependencies:function(){return networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-report.js","crm-mixin-pathfinder-common.js","crm-mixin-pathfinder-action.js","crm-text-ellipsis.js","crux-smart-filter.js","webform-model.js"],ResourceConstants.CRMClient)},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=networkUtils.returnDependencyFiles(["crm-pathfinder-view-reports.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zohocrm_pathfinder.js","zohocrm_reviewprocess.js"],ResourceConstants.CRM)).concat(fetchAutomationFunctionFiles());return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","setup/automation/crm-automation-multi-dropdown.css","crux-smart-filter-input.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM))}},beforeModel:function(){var e=this.getProcessData();this.displayFailurepopforDraftReport(this.transition,e,I18n.getMsg("crm.pf.sankey"))},model:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED)return Lyte.resolvePromises({rawJourneyData:store.triggerAction("reports_journey","journey",void 0,void 0)})},renderTemplate:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){this.currentModel.selectedTab="Sankey";var e=$L("crm-pathfinder-builder-header")[0];e.setData("isViewMode",!0),e.setData("isReportsTab",!0);var t=store.peekRecord("pathfinder_process",this.currentProcessId).states,r=1,s={},n=[],i=[],o=[],a=[],l=["#c4cdd8","#714A83","#FFB5D6","#2B86C0","#39C682","#D69F6F","#8F4A69","#FF84BB","#36A8F0","#4CA162","#F6A4A4","#B25C83","#CC6A96","#86CBF6","#90A83E","#F06867","#B27F96","#A26ABC","#6DE5FF","#B4D24D","#C05352","#7D756A","#CA85EB","#0BD4FF","#D2E494","#D38786","#665A4B","#D6A9EB","#09AACC","#E2D0A6","#F49695","#5F6873","#AAB8FF","#09CCB7","#FCCE5A","#F8BFBF","#8895A4","#7289FF","#3DEDB9","#CAA548","#E2BC9A","#92816B","#5B6ECC","#80EBCC","#C47631","#F8B478","#B3A798","#52748D","#9FDFB0","#F5933D","#D6A06F"];o.push("Start"),i.push(o),a.push("#c4cdd8"),t.forEach((function(e){s[e.id]="breadCrumbColor"+r,(o=[]).push(e.name),i.push(o),a.push(l[r]),e.end_state&&n.push(e.id),r++})),s[-1]="deletedState",this.currentModel.processId=Lyte.registeredMixins.pathfinder.currentProcessId,this.currentModel.colorBandRanges=i,this.currentModel.selectedColors=a,this.currentModel.stateColorMap=s,this.currentModel.endStates=n;var c=$L("#pfVersionDropdown")[0];return c&&(c.ltProp("selected",""),c.ltProp("selected",this.currentModel.processId)),{outlet:"#touchpointdetailview",component:"crm-pathfinder-view-reports"}}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED){$L("#result").addClass("h100_per oH"),CommandCenterLoader.loadPathFinderReports(Lyte.registeredMixins.pathfinder.currentProcessId,"sankey","result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/path-finder"),$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),$L(".new_setupview").addClass("newSetupRightShow");var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);setTimeout((function(){t.css({height:r+"px"})}),800)}else{$L("#tab_2")[0].checked=!0;var s,n=$L("crm-pathfinder-view-reports")[0].component,i=$L(".pftabsliderheadernav"),o=i.find("lyte-nav-item.lyteNavActive"),a=$L("crm-pathfinder-builder-header")[0].component.getData("pathfinderVersions");let e,t,r;n.loadInitialData("Sankey"),o.length&&(e=o[0].getBoundingClientRect(),t=i.find(".pftabslidernav"),s=Crm.userDetails.RTL_ENABLED?{left:e.left-2,width:e.width-24}:{left:e.left-19,width:e.width-24}),$L("#result").addClass("h100_per"),o.length&&t.css(s),a.forEach((function(e){$L("#pfVer_"+e.id).removeClass("eventNone")})),r=RebrandLinkUtil.getProperties("PF_SANKEY_REPORT_CLICK").PF_SANKEY_REPORT_CLICK,Lyte.registeredMixins.pathfinder.trackActionsDoneInPathfinder(r,RebrandLinkUtil.getProperties("PF_SANKEY_REPORT_CLICK_ID").PF_SANKEY_REPORT_CLICK_ID)}},beforeExit:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=$L("crm-pathfinder-view-reports")[0].component;window.removeEventListener("resize",e.pfSankeyChartResize)}}},{mixins:["pathfinder_action","pathfinder_common","pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.pathfinder-details.view-touchpoints",{getDependencies:function(){return commonUtils.showHideLoadingDiv(!0),networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-mixin-pathfinder-common.js","crm-mixin-pathfinder-action.js","lytecombobox.js","webform-model.js"],ResourceConstants.CRMClient)},getResources:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=networkUtils.returnDependencyFiles(["crm-pathfinder-view-touchpoints.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css","setup/automation/crm-automation-multi-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}},model:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){$L("crm-pathfinder-builder-header")[0].setData("isViewMode",!0);var e=Lyte.registeredMixins.pathfinder.currentProcessId;return Lyte.resolvePromises({webforms:store.peekAll("webform")&&store.peekAll("webform").length?store.peekAll("webform"):store.findAll("webform"),pathfinder_process:store.peekRecord("pathfinder_process",e)?store.peekRecord("pathfinder_process",e):store.findRecord("pathfinder_process",e,{include_state_details:!0,include_inner_details:"field.label"})})}},renderTemplate:function(){if($L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$(".new_setupview").addClass("newSetupRightShow"),!Crm.userDetails.CC_SERVICE_ENABLED){this.currentModel.process=Lyte.registeredMixins.pathfinder_action.getProcessData(),this.currentModel.searchState=I18n.getMsg("pf.view.touchpoints.all.states");var e=$L("crm-pathfinder-builder-header")[0],t=$L(".pfDetailviewTpStickyEle")[0],r=$L("#pfVersionDropdown")[0],s=$L("#pfSearchDropdown")[0];return e.setData("isReportsTab",!1),Lyte.objectUtils(e.component.data.domElements.isbuilderView,"add","value",!1),this.currentModel.process.states.forEach((function(e){e.triggers&&e.triggers.forEach((function(e){Lyte.registeredMixins.pathfinder_config.getProcessedTriggerJson(e)}))})),this.setCurrentStateData(this.currentModel.process),t&&(t.scrollTop=0),this.transition.data.activateInProgress&&(this.currentModel.activateInProgress=!0),r&&(r.ltProp("selected",""),r.ltProp("selected",this.currentModel.process.id)),s&&(s.ltProp("selected",""),s.ltProp("selected",I18n.getMsg("pf.view.touchpoints.all.states"))),{outlet:"#touchpointdetailview",component:"crm-pathfinder-view-touchpoints"}}},afterRender:function(){if(Crm.userDetails.CC_SERVICE_ENABLED){$("#result").addClass("h100_per oH"),CommandCenterLoader.loadPathFinderBuilder(Lyte.registeredMixins.pathfinder.currentProcessId,!0,"result",{iframestyle:"width: 100%;background: transparent;border: none;height: 100%;"},Crm.getCrmBasePath()+"/settings/commandcenter/path-finder");var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);setTimeout((function(){t.css({height:r+"px"})}),800)}else{var s=$L(".pftabsliderheadernav");let e=s.find("lyte-nav-item.lyteNavActive");if(e.length){let t=e[0].getBoundingClientRect(),r=s.find(".pftabslidernav");Crm.userDetails.RTL_ENABLED?r.css({left:t.left-2,width:t.width-24}):r.css({left:t.left-19,width:t.width-24})}$L("crm-pathfinder-builder-header")[0].component.getData("pathfinderVersions").forEach((function(e){$L("#pfVer_"+e.id).removeClass("eventNone")})),$L("#result").addClass("h100_per"),commonUtils.showHideLoadingDiv()}},beforeExit:function(){Crm.userDetails.CC_SERVICE_ENABLED?$("#result").removeClass("h100_per oH"):this.transition.data&&this.transition.data.isPfListView&&(store.unloadRecord("pathfinder_process",this.parent.getDynamicParam()),store.unloadAll("pathfinder_state"),store.unloadAll("trigger_process"),wfmergefield.clearMergeFieldDetl())},actions:{didTransition:function(){if(!Crm.userDetails.CC_SERVICE_ENABLED){var e=$L("crm-pathfinder-builder-header")[0].component;e.disableCheckforMoreOptions(),e.data.domElements.disableButtonsForEdit.value&&Lyte.objectUtils(e.data.domElements.disableButtonsForEdit,"add","value",!1)}},onError:function(){Crm.userDetails.CC_SERVICE_ENABLED||commonUtils.showHideLoadingDiv()}}},{mixins:["pathfinder_action"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder.index-path-finder",{getResources:function(){commonUtils.showHideLoadingDiv(!0);var e=networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-listview.js","crm-pathfinder-create-wrapper.js","crm-mixin-pathfinder-common.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-listview.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){return Crm.userDetails.CC_SERVICE_ENABLED&&!Crm.userDetails.permissions.Crm_Implied_View_Commandcenter&&(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.findAll("pathfinder_meta",{include_inner_details:"supported_modules.module_name,supported_modules.plural_label"})},model:function(){return Lyte.resolvePromises({pathfinders:Crm.userDetails.CC_SERVICE_ENABLED?CommandCenterLoader.getPathFinderList():store.findAll("pathfinder_process"),pathfinderMeta:store.peekAll("pathfinder_meta").length?store.peekAll("pathfinder_meta"):store.findAll("pathfinder_meta",{include_inner_details:"supported_modules.module_name,supported_modules.plural_label"}),services:Crm.userDetails.CC_SERVICE_ENABLED?CommandCenterLoader.getServiceDetails():null})},afterModel:function(e){if(e.cc_enabled=Crm.userDetails.CC_SERVICE_ENABLED,e.pathfinderMeta.new_flow?e.is_newOrg=e.pathfinderMeta.new_flow:e.pathfinderMeta[0].new_flow&&(e.is_newOrg=e.pathfinderMeta[0].new_flow),Crm.userDetails.CC_SERVICE_ENABLED&&(""===e.pathfinders?e.pathfinders=[]:e.pathfinders=JSON.parse(e.pathfinders).pathfinders,e.pathfindersAllVersions=e.pathfinders,this.transition&&void 0!==this.transition.data&&this.transition.data.isReauthorize)){let e,t,r,s;e=this,null!==this.transition.data.services.failed_services?(r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PathFinderReauth")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["commandcenter-integ-authentication-pop.js"],ResourceConstants.CRMClient),s=t.concat(r),Lyte.injectResources([s],void 0,void 0).then((function(){var t,r,s,n,i,o,a;(a=$L("crm-pathfinder-details")[0]).component.setData("isReauthorize",e.transition.data.isReauthorize),n=(r=e.transition.data.services.failed_services).length,t=[],o=!1;for(var l=0;l<n;l++){i=r[l].orgs.length;for(var c=0;c<i;c++)r[l].orgs[c].authenticated_user+""===Crm.userDetails.USER_ID&&(o=!0,t.push(r[l]),void 0===s&&(s=r[l].orgs[c].cc_authenticated_by+""))}if(null!==t&&o){if(a.component.setData("failedservices",t),null!==s){var u=Crm.getUserDetailsMap();null!==u&&s in u&&a.component.setData("cc_authenticated_user_name",u[s].name)}}else _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.reauth.user.no.access")}}),a.component.setData("isReauthorize",!1)}))):(_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.no.apps.auth")}}),compVar.component.setData("isReauthorize",!1))}},renderTemplate:function(e){$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").show(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").show(),$(".new_setupview").removeClass("newSetupRightShow");var t=this.getGroupedPathFinders(e.pathfinders),r=this.getDisplayablePfsList(t);return Crm.userDetails.CC_SERVICE_ENABLED?r.forEach((function(e){e.versionCount=e.version_details.version_number,e.statusDominatingProcess.versionList=t[e.group_id],e.created_date_display_value=null!==e.created_time?Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(e.created_time)):null,e.created_time_display_value=null!==e.created_time?Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(e.created_time),!0):null,e.modified_date_display_value=null!==e.modified_time?Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(e.modified_time)):null,e.modified_time_display_value=null!==e.modified_time?Utils.getTimeInUserFormat(Utils.ISO8601toDateObject(e.modified_time),!0):null,e.modified_user_image=null!==e.modified_by?commonUtils.getPhotoURL(e.modified_by.zuid):null})):r.forEach((function(e){var r=t[e.group_id].length;e.$.set("versionCount",r),e.statusDominatingProcess.$.set("versionList",t[e.group_id])})),this.currentModel.pathfinders=r,{outlet:"#result",component:"crm-pathfinder-details"}},afterRender:function(){var e=RebrandLinkUtil.getProperties("PF_VISITED_PATHFINDER_TAB").PF_VISITED_PATHFINDER_TAB;(Lyte.registeredMixins.pathfinder.trackActionsDoneInPathfinder(e,RebrandLinkUtil.getProperties("PF_VISITED_PATHFINDER_TAB_ID").PF_VISITED_PATHFINDER_TAB_ID),$L("#result").addClass("h100_per"),this.transition.data.invalidProcess)&&($L("crm-pathfinder-details")[0].setData("pfNotExistAlert",I18n.getMsg("pf.version.doesnotexist")),$L("#processNotExistAlert").e.ltProp("show",!0));commonUtils.showHideLoadingDiv()},actions:{onError:function(e){return this.routeErrorHandling(e),!1}}},{mixins:["pathfinder"]}),Lyte.Router.registerRoute("crm.settings.section.path-finder",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-model-pathfinder-process.js","crm-model-orchestration-process.js","setup/pathfinder/crm-pathfinder-store.js","crm-pathfinder.js","pathfinder_meta_model.js"],ResourceConstants.CRMClient);return e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PathFinder")],ResourceConstants.CRM)),e},model:function(){return Lyte.resolvePromises({pathfinderMeta:store.findAll("pathfinder_meta",{include_inner_details:"supported_modules.module_name,supported_modules.plural_label"},!0)})},actions:{onError:function(e){if(e.response){var t=JSON.parse(e.response);t.pathfinders&&(t=t.pathfinders[0]);var r=$(".dummy_Body");switch(t.code){case"INVALID_DATA":this.transitionToPathFinderIndex();break;case"NO_PERMISSION":renderingUtils.displayPermissionDenied(),r.hide();break;case"FEATURE_NOT_SUPPORTED":renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.zes.mobile.error.feature")),r.hide();break;default:crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3),r.hide()}}return!1}},beforeExit:function(){store.unloadAll("pathfinder_meta"),store.clearCachedQuery("pathfinder_meta",{include_inner_details:"supported_modules.module_name,supported_modules.plural_label"})}}),Lyte.Router.registerRoute("crm.settings.section.personal-settings",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-shortcut.js","crm-user-setup.js","crm-user-edit-popup.js","modal-scroll-box-shadow.js","lyte-tree.js","lyte-hovercard.js","org-model.js","crux-user-view.js","crm-uploadfields-mixin.js","crm-detail-view-utils.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-user-setup.css","crux-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles(["crux-user-view.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("UserSetup"),networkUtils.getI18nJSUrl("ReportingToPopup")],ResourceConstants.CRM),n=e.concat(t).concat(Crm.returnPhoneFieldDependencyFiles()).concat(s).concat(r);if(featuresAvailable.TEAMSPACE_ENABLED){var i=networkUtils.returnDependencyFiles(["crm-teamspace-user-details.js"],ResourceConstants.CRMClient);i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM)),n=n.concat(i)}return n},model:function(e){var t={params:{actionName:"viewUser",userId:Crm.userDetails.USER_ID}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowUser.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.userDetails"),Crm.partnerName])),showOrHideUserDetail($("#result")),$(".setuprightmenudiv").addClass("personalSettingsNewView"),renderingUtils.labelWidthFixed("list","userDetailView");var r=store.model.setup_submenu;r&&(r.data.find((e=>"system.accessibility"===e.api_name))&&$L(".setuprightmenudiv").addClass("accessibilityEnabled"))},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Personal Settings Click",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME})},didDestroy:function(){$(".setuprightmenudiv").removeClass("personalSettingsNewView");var e=store.model.setup_submenu;e&&(e.data.find((e=>"system.accessibility"===e.api_name))&&$L(".setuprightmenudiv").removeClass("accessibilityEnabled"))}}),Lyte.Router.registerRoute("crm.settings.section.phonebridge-platform",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PBXRegistration.do","GET",{params:{action:"pbxReg",scope:"",pageTitle:"crm.zti.phonebridge.token.tab.reg"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.phonebridge-token",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAuthToken.do","GET",{params:{action:"genAuthToken",scope:"ZTI"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.pipelines",{getResources:function(){var e=[networkUtils.returnDependencyFiles(["crm-multipipeline-components.js"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-multipipeline-components.css"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("blueprint"),"zohocrm_zprocess.js",networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("staticlookupfilter")],ResourceConstants.CRM)];if(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_multipipelines.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-event-picklist.js","lyte-colorpicker.js"],ResourceConstants.CRMClient)),e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-multipipeline-components-RTL.css","crm-picklist-colorpicker.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-confirm-changes-popup.js"],ResourceConstants.CRMClient)),("true"===window.isCrmPlusUser||"true"===window.isZohoOneUser)&&void 0!==Crm.userDetails.PROFILE_POPUP&&!0===Crm.userDetails.isFromFeatureMenuCrmplusorZohoOne){var t=networkUtils.returnDependencyFiles(["crm-getting-start.js","lyte-draggable.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-getting-start.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("onboardingpageSetupPageText")],ResourceConstants.CRM);e=e.concat(t).concat(r).concat(s)}return e},getDependencies:function(){return[networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("multipipelines")],ResourceConstants.CRM)]},queryParams:["layoutId"],beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&Crm.isMultipipelinesEnabled||(renderingUtils.displayPermissionDenied(),this.transition.abort());var e={dealFields:store.findAll("field",{module:"Deals"},!1,!1,{apiVersion:"2.2"})};return Lyte.resolvePromises(e).then((function(e){var t=e.dealFields.field.find((e=>"PIPELINE"===e.column_name));Crm.userDetails.isMultiPipelineActivated=!!t&&t.id}))},model:function(){if(commonUtils.showHideLoadingDiv(!0),Crm.userDetails.isMultiPipelineActivated){if(store.unloadAll("pick_list_values"),store.unloadAll("pipeline"),this.transition.isAjaxRequest&&this.getQueryParams().layoutId)return(t={pipelines:store.findAll("pipeline",{layout_id:this.getQueryParams().layoutId})}).field=store.findRecord("field",Crm.userDetails.isMultiPipelineActivated,{module:Crm.moduleInfo.Potentials.apiname}),Lyte.resolvePromises(t);store.unloadAll("layout");var e={module:Crm.moduleInfo.Potentials.apiname},t={stages:store.findAll("stage",e),layouts:store.findAll("layout",e),field:store.findRecord("field",Crm.userDetails.isMultiPipelineActivated,e)};return this.getQueryParams().layoutId?(t.pipelines=store.findAll("pipeline",{layout_id:this.getQueryParams().layoutId}),Lyte.resolvePromises(t)):Lyte.resolvePromises(t).then((function(e){return t.pipelines=store.findAll("pipeline",{layout_id:e.layouts[0].id}),Lyte.resolvePromises(t)}))}return null},renderTemplate:function(e){return{outlet:"#result",component:Crm.userDetails.isMultiPipelineActivated&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)?"crm-multipipelines":"crm-pipeline-initial-page"}},afterModel:function(e){commonUtils.showHideLoadingDiv(),e&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)&&(this.currentModel={},this.currentModel.layouts=store.peekAll("layout"),this.currentModel.selectedLayout=this.getQueryParams().layoutId?this.getQueryParams().layoutId:this.getFirstAvailableLayout(this.currentModel.layouts),this.currentModel.limit_reached=this.isPipelineLimitReached(this.currentModel.layouts),this.currentModel.pipelines=e.pipelines&&e.pipelines.length>0?this.processPipelines(e.pipelines[0].pick_list_values.slice(0)):[],this.currentModel.isDeactive=store.peekRecord("layout",this.currentModel.selectedLayout).status<0,this.currentModel.isRestrictedEdition="N"===Crm.userDetails.LICENSE_TYPE||"L"===Crm.userDetails.LICENSE_TYPE||"F"===Crm.userDetails.LICENSE_TYPE||"R"===Crm.userDetails.LICENSE_TYPE||"E"===Crm.userDetails.LICENSE_TYPE)},afterRender:function(e){if(Crm.userDetails.isMultiPipelineActivated&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)){var t=$(".pipelineWraperInner");this.pipelineWraperScroll(t),crmLayout.Resize.pipelineStagesHght(),e.isDeactive||crmui.hideTooltip(),this.transition.isCreateSuccess&&(this.showCreationSuccessMsg("stdCreated"===this.transition.isCreateSuccess),t.animate({scrollLeft:$(".pipelineWraper").outerWidth()+20-t.outerWidth()},800)),this.transition.unSavedChanges&&($L("#addNewPipeBtn").removeClass("warnCreate"),this.transition.showCreatePopup&&document.querySelector("crm-multipipelines").component.executeMethod("showCreatePopup"))}if(featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var r=Crm.userDetails.isMultiPipelineActivated&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated),s=document.querySelector(r?"crm-multipipelines":"crm-pipeline-initial-page");s&&s.component&&s.component.actions.showCreatePopup("forNewPipeline")}Crm.client_tracking("Pipeline - Pipelines Click ",{Place:"Setup"}),$L("crm-profile-menu")[0].component.actions.showRightPanelorCrmplusWidget()},actions:{onError:function(e){if(403===e.status)renderingUtils.displayPermissionDenied();else if(e.response){var t=JSON.parse(e.response);t.message="INVALID_MODULE"===t.code?I18n.getMsg("crm.pipeline.module.hidden.alert",I18n.getMsg(moduleRecordMapping.Deals.plural_label)):t.message;var r=t.message?t.message:I18n.getMsg("crm.skyeye.setup.msg.error");renderingUtils.showCustomAlert(r,void 0,!1,(function(){renderingUtils.ajaxErrorBackForLyte()}))}return commonUtils.showHideLoadingDiv(),!1},willTransition:function(e){$L("#addNewPipeBtn").hasClass("warnCreate")&&!e.ignore&&(e.pause(),e.unSavedChanges=!0,Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e,popupHeader:I18n.getMsg("crm.event.layout.leavepage.confirm.message2"),popupContent:I18n.getMsg("crm.email.wfrule.create.cancel.msg")},"#confirmChanges"),document.querySelector("crm-multipipelines").component.setData("selectedLayout",this.currentModel.selectedLayout))}},isPipelineLimitReached:function(e){var t=0,r=!Crm.userDetails.isTrialEnabled&&Crm.userDetails.ULTIMATE_ADDON_COUNT?crmConstants.Pipelines.max_limit.U:Crm.MultipipelineLimit;if(this.transition.isAjaxRequest&&this.getQueryParams().layoutId)t=store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated).pick_list_values.length;else for(var s=e.length,n=store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated),i=0;i<s;i++)t+=n[e[i].id]?n[e[i].id].pick_list_values.length:0;return t>=r},processPipelines:function(e){for(var t=e.length,r=0;r<t;r++){for(var s=e[r],n=s.maps.length,i=[],o=0;o<n;o++){var a=s.maps[o];i[o]={id:a.id,display_value:a.display_value,fc_category:a.forecast_category.name,fc_probability:store.peekRecord("stage",a.id).probability,forecast_type:a.forecast_type,colour_code:a.colour_code},void 0!==a.colour_code&&Lyte.Component.set(s,"stageColorEnabled",!0)}s.setMinHeight=i.length>4,Lyte.Component.set(s,"stages",i)}return e},showCreationSuccessMsg:function(e){e?$L("#firstTimecreateNewPipelinePop")[0].ltProp("show",!0):crmui.showMsgBand("success",I18n.getMsg("crm.pipeline.create.message"),2e3),$L("crm-profile-menu")[0].component.actions.featureMarkCompletion("deals")},pipelineWraperScroll:function(e){var t=$L(e).scrollLeft(),r=$L(e).outerWidth(),s=$L(".pipelineWraper").width();s>r?(s==r+t-15?($L(e).removeClass("pipelineWraperHasScroll"),$L(".pipeLineScrollArrowRight").css("display","none")):($L(e).addClass("pipelineWraperHasScroll"),$L(".pipeLineScrollArrowRight").css("display","block")),0==t?($L(e).removeClass("pipelineWraperHasLeftScroll"),$L(".pipeLineScrollArrowLeft").css("display","none")):($L(e).addClass("pipelineWraperHasLeftScroll"),$L(".pipeLineScrollArrowLeft").css("display","block"))):($L(".pipeLineScrollArrowLeft, .pipeLineScrollArrowRight").css("display","none"),$L(e).removeClass("pipelineWraperHasLeftScroll"))},getFirstAvailableLayout:function(e){for(var t=e.length,r=0;r<t;r++){var s=e[r];if(-3!==s.status&&13!==s.status)return s.id}},didDestroy:function(){$L("crm-getting-start")[0]&&$L("crm-getting-start")[0].component.actions.widgetReRender()}}),Lyte.Router.registerRoute("crm.settings.section.profiles.index-profiles",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-profile-list.js","crm-profile-action.js"],ResourceConstants.CRMClient);e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-list-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("profiles")],ResourceConstants.CRM));var t=networkUtils.getI18nJSUrl("InventoryModulePerm");return e.push(networkUtils.returnDependencyFiles([t],ResourceConstants.CRM)),e},model:function(e){return{profiles:store.findAll("profile",{page:"1",per_page:"200",include_lite_profile:"true"})}},renderTemplate:function(e,t){return this.currentModel.profileLimit=e.profiles.$.meta.license_limit,{outlet:"#result",component:"crm-profile-list"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.profiles.list"),Crm.appName])),$("#setup_new_ContentDiv").addClass("helpOverflowHide")},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.profiles.view-profile",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-profile-view.js","crm-profile-action.js","crm-permission-dropdown.js","crm-help-link.js","lyte-scrollspy.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("profilepage")],ResourceConstants.CRM)),e=(e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-view.css","crm-permission-dropdown.css","crm-profile-view-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-view.css","crm-permission-dropdown.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("InventoryModulePerm")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Dashboard")],ResourceConstants.CRM)),featuresAvailable.ZIA_SUMMARY&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM))),featuresAvailable.WRITING_ASSISTANT&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("WritingAssistant")],ResourceConstants.CRM))),featuresAvailable.ZIA_RECORD_SUMMARY&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM))),e},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-profile-mixin.js"],ResourceConstants.CRMClient)},beforeModel:function(){this.transition.data.reloadAll&&(this.refresh({refreshTemplate:!0}).data={})},model:function(e){var t=this.getDynamicParam(),r=store.peekRecord("profile",t);return r&&r.permissions_details&&delete r.permissions_details,{profileDetails:store.findRecord("profile",t)}},afterModel:function(e){Object.keys(e.profileDetails).length&&this.setPermission(e)},renderTemplate:function(e){if(e.isSystemDefProfile=!e.profileDetails.custom,"lite_profile"===e.profileDetails.type&&(e.isLightProfile=!0),!Object.keys(e.profileDetails).length||"support_profile"===e.profileDetails.type)return{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; "><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:var(--redLightColor); font-size: 26px;" class="mL15">'+I18n.getMsg("crm.profile.error.unavailable")+'</h2><div class="mT5 crm-base-font-size mL15 lh20"></div></div></div>'};for(var t in e.sections)this.checkFieldEnable(e.sections[t],e.sections);return e.allSection=this.sortOrderPermission(e),{outlet:"#result",component:"crm-profile-view"}},afterRender:function(){this.component&&(this.component.component.checkSetupDevPermission({},void 0,"setupPermissionStatus"),this.component.component.checkSetupDevPermission({},void 0,"devPermissionStatus"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.profile.details"),Crm.partnerName])),this.viewProfileOnLoad(),$(window).on("beforeunload",(function(){var e=$L("crm-profile-view")[0];if(e&&e.getData("profileDetails")&&e.getData("profileDetails").$&&e.getData("profileDetails").$.isDirty())return"show alert"})))},beforeExit:function(){for(var e in moduleRecordMapping)delete moduleRecordMapping[e].actions},actions:{willTransition:function(){_cruxUtils.removeCustomAlert()}},viewProfileOnLoad:function(){var e=$L("#setup_new_ContentDiv"),t=$L(".newTopbar"),r=$L(".profViewTopArea"),s=$L(".setupleftmenutd"),n=$L(".profViewContent"),i=$L(".profViewLeftPane"),o=$L(".leftPaneLyteScrollWrapper"),a=r.outerHeight()+t.outerHeight(),l=renderingUtils.windowHeight-(a+28),c="left",u=Crm.userDetails.RTL_ENABLED;u&&(c="right"),$("#setupInnerLinks").hide(),e.removeClass("oA"),i.css({height:l+"px",top:a+"px"}),u?i.css("right",0):i.css("left",0),r.css(c,"0"),setTimeout((function(){s.hide(),$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),i.removeClass("profViewLeftPaneBeforeAnim").css({top:"",height:""}),u?i.css("right",""):i.css("left",""),r.removeClass("profViewTopPaneBeforeAnim").css(c,""),n.removeClass("profViewContentBeforeAnim"),o.scroll()}),300)},sortOrderPermission:function(e){var t=e.headerOrder,r=e.sections,s=e.sectionOrder,n={module_permissions:0,setup_permissions:1,extension_permission:2,developers_permission:3};for(var i in t){for(var o=[],a=0;t[i][a];a++){var l=t[i][a];r[l].sequence_number=a;for(var c=0;s[l][c];c++){var u=s[l][c];r[l].sub_categories[u].sequence_number=c}o.push(r[l])}e.header[n[i]].categories=o}var d=[];for(a=0;e.header[a];a++)d=d.concat(e.header[a].categories);return d}},{mixins:["crm-profile-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.profiles",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crux-user-view.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["crux-user-view.css"],ResourceConstants.CRMClient))},redirect:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Profiles&&featuresAvailable.Profiles?"crm.settings.section.profiles"===this.transition.target&&this.replaceWith("crm.settings.section.profiles.index-profiles"):(renderingUtils.displayPermissionDenied(),this.transition.abort())},beforeExit:function(){app.refetchModulesMeta=!0}}),Lyte.Router.registerRoute("crm.settings.section.recyclebin",{getDependencies:function(){if(Crm.userDetails.recyclebinLyteMovement)return networkUtils.returnDependencyFiles(["crm-recyclebin-revamp-models.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[];if(Crm.userDetails.recyclebinLyteMovement){var t=networkUtils.returnDependencyFiles(["crm-recyclebin-revamp-views.js","crm-page-navigator.js","crux-lookupfilter-component.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recyclebin")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-recyclebin-revamp.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=(e=e.concat(t.concat(s))).concat(r)}else{t=networkUtils.returnDependencyFiles(["crm-recyclebin.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-recyclebin.css"],ResourceConstants.CRMClient);e=e.concat(t.concat(s))}return e},beforeModel:function(){var e=$L("crm-recyclebin-notification-popup");e.length>0&&e[0].remove()},model:function(){if(Crm.userDetails.recyclebinLyteMovement){var e={},t=10;return Crm.userDetails&&Crm.userDetails.CUSTOMIZE_INFO&&Crm.userDetails.CUSTOMIZE_INFO.recyclebin_range&&(t=Crm.userDetails.CUSTOMIZE_INFO.recyclebin_range),e.recycle_bin=app.store.makeRequest("findAll","recycle_bin",{per_page:t}),Lyte.resolvePromises(e).then((function(e){return e}),(function(){return{}}))}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowRBList.do","GET")},afterModel:function(e){if(!Crm.userDetails.recyclebinLyteMovement)return e;this.currentModel={};var t={startIndex:1,_startIndex:0,endIndex:0,_totalCount:0};e&&e.recycle_bin&&(this.currentModel.recycle_bin=e.recycle_bin,this.currentModel.isDataAvailable=e.recycle_bin.length>0,t.endIndex=e.recycle_bin.length,t._totalCount=t.endIndex),e.recycle_bin.$&&e.recycle_bin.$.meta&&(this.currentModel.hasNext=e.recycle_bin.$.meta.more_records,this.currentModel.hasPrevious=e.recycle_bin.$.meta.page>1,e.recycle_bin.$.meta.more_records&&(t._totalCount=t.endIndex+1,this.currentModel.canDisplaySelectAllRecords=!0));var r=10;Crm.userDetails&&Crm.userDetails.CUSTOMIZE_INFO&&Crm.userDetails.CUSTOMIZE_INFO.recyclebin_range&&(r=Crm.userDetails.CUSTOMIZE_INFO.recyclebin_range),this.currentModel.pageDetails={currentPage:1,perPage:r},this.currentModel.dropdown=r/10,this.currentModel.perPage=r,t.isTotalCountAvailable=!1,this.currentModel.recordCountMessage=t;var s=[],n=0,i={},o={},a={},l=["Leads","Accounts","Contacts","Potentials","Campaigns","Cases","Solutions","Products","PriceBooks","Vendors","Quotes","PurchaseOrders","SalesOrders","Invoices","Events","Tasks","Calls","Notes","Emails","Attachments","Activities","Visits","Appointments","Services"];for(const e in moduleRecordMapping){var c={};if(["linking","custom"].contains(moduleRecordMapping[e].generated_type)||l.contains(e)){if("linking"===moduleRecordMapping[e].generated_type&&!moduleRecordMapping[e].show_as_tab)continue;c.display_value=moduleRecordMapping[e].plural_label,c.actual_value=moduleRecordMapping[e].plural_label,c.id=n,n+=1,s.push(c),i[e]=moduleRecordMapping[e].plural_label,o[moduleRecordMapping[e].plural_label]=e,a[moduleRecordMapping[e].plural_label]=moduleRecordMapping[e].module_name}}var u=I18n.getMsg("crm.label.competitors");s.push({display_value:u,actual_value:u,id:n}),i.Competitors=u,o[u]="Competitors",a[u]="Competitors",this.currentModel.modulePluralLabel=s,this.currentModel.typeVsPluralabel=i,this.currentModel.pluralabelVsType=o,this.currentModel.modulePluralabelVsModuleName=a;var d=[{id:1,field_label:I18n.getMsg("Name"),ui_type:1,api_name:"display_name",cxTypeMapping:1,sortable:!0,cxPropClass:"bin_thName bin_tableHeadingElem",cxPropFilterZcqa:"advSearch_text_1",maxLength:255},{id:2,field_label:I18n.getMsg("Type"),ui_type:2,api_name:"module",cxTypeMapping:2,pick_list_values:s,noOverride:!1,cxPropType:"single",width:"200px",cxPropClass:"bin_tableHeadingElem",cxPropFilterZcqa:"TYPE_COL"},{id:3,field_label:I18n.getMsg("crm.label.deletedby"),ui_type:20,api_name:"deleted_by",cxTypeMapping:20,noOverride:!0,sortable:!0,cxPropClass:"bin_thBy bin_tableHeadingElem",userQueryParams:{include_lite_users:!0},cxPropFilterZcqa:"advSearch_text_3"},{id:4,field_label:I18n.getMsg("crm.label.deletedtime"),ui_type:200,api_name:"deleted_time",cxTypeMapping:200,noOverride:!0,sortable:!0,customWidth:!0,cxPropClass:"bin_thDate bin_tableHeadingElem",cxPropFilterZcqa:"advSearch_text_4"}];this.currentModel.tableHeader=d,this.currentModel.isAdmin=Crm.userDetails.IS_ADMIN;for(var m=Lyte.deepCopyObject(e.recycle_bin),p=m.length,g=0;g<p;g++){var f=m[g];f.module=i[f.module]}this.currentModel.recycle_bin=m,m.length>0?(this.currentModel.isAllSelectCheckboxDisabled=!1,this.currentModel.filterClass="cP"):this.currentModel.isAllSelectCheckboxDisabled=!0},renderTemplate:function(e){return Crm.userDetails.recyclebinLyteMovement?{outlet:"#result",component:"crm-recyclebin-revamp",reRender:!0}:{outlet:"#result",html:e}},afterRender:function(){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.topmenu.recyclebin"),Crm.partnerName])),Crm.userDetails.recyclebinLyteMovement){var e=$L("#bin_cxTbl"),t=$L("#bin_cxTbl .lyteTableScroll"),r=t[0].scrollHeight,s=renderingUtils.windowHeight-e.offset().top-76;t.scrollTop(0),r>Math.round(s)?e.attr("cx-prop-height",`${s}px`):e.attr("cx-prop-height","auto")}else loadRecycleBinTotalRecCount()}}),Lyte.Router.registerRoute("crm.settings.section.remove-sample-data",{queryParams:["migrationId"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],ResourceConstants.CRM)},renderTemplate:function(e,t){var r="$('#rollbackSampData').hide();Crm.trackSpotLightAction('Customer OnBoarding - Delete Sample Data',{'Place':'Setup'});Crm.client_tracking('Customer OnBoarding - Delete Sample Data',{'Place':'Setup'});Lyte.Router.transitionTo('crm.settings.index');Lyte.Router.getRouteInstance('crm.settings.section.remove-sample-data').actions.deleteSampleData('"+this.getQueryParams().migrationId+"');",s=$("<div></div>").attr("data-onclick",r);showDeletePopup(I18n.getMsg("crm.remove.sample.data.message"),I18n.getMsg("crm.yes.proceed"),"","",s[0],"removeSampleData")},afterRender:function(e,t){document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("cob.remove.sampledata"),Crm.partnerName])},actions:{deleteSampleData:function(e){store.findAll("dummy",null,!1,!1,{url:"/crm/bulk/v2/migration/"+e,method:"DELETE"}).then((function(e){if(e&&e.dummy&&"SUCCESS"===e.dummy.code){var t=$L("crm-setup")[0].component;if(t){var r,s=t.getData("globalSetpJson");if(s&&s[1])for(r in s[1])if(void 0!==s[1][r].api_name&&"system.dataadministration"===s[1][r].api_name){for(var n=s[1][r].menus,i=-1,o=n.length,a=0;a<o;a++)if("system.removesampledata"===n[a].api_name){i=a;break}-1!==i&&Lyte.arrayUtils(s[1][r].menus,"removeAt",i,1);break}}crmui.showMsgBand("warning",I18n.getMsg("crm.remove.sample.data.initiated"),5e3)}else crmui.showMsgBand("warning",I18n.getMsg("crm.migration.contactFormError"),5e3)}))}}}),Lyte.Router.registerRoute("crm.settings.section.review-process.create-review-process",{queryParams:["layout_id"],getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess.js","business_hours-model.js"],ResourceConstants.CRMClient);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient),t.concat(e).concat(networkUtils.returnDependencyFiles(["zohocrm_reviewprocess.js"],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["custom-function-model.js","crm-function-components-wrapper.js","crm-functions-helper.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient)).concat(fetchAutomationFunctionFiles())},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],ResourceConstants.CRMClient)},model:function(){var e=this.transition.data;return e&&e.moduleDetails?{}:Lyte.resolvePromises({moduleList:this.getModules()})},afterModel:function(e,t){var r=this.transition.data,s=this,n=e.moduleList?e.moduleList:r.moduleDetails;return Lyte.resolvePromises({moduleList:n,moduleName:t.dynamicParam,layoutId:t.queryParams.layout_id,criteriaFields:s.getCriteriaFields(t.dynamicParam,t.queryParams.layout_id),layoutDetails:r.layoutDetails?r.layoutDetails:this.getLayoutDetails(t.dynamicParam,n),prevListModule:r.prevListModule,prevListLayout:r.prevListLayout}).then((function(e){return e.errorCode=s.currentModel.errorCode,s.currentModel=e,e.layoutDetails&&e.layoutDetails instanceof Record&&(s.currentModel.layoutId=void 0),s.currentModel}))},renderTemplate:function(e,t){var r=store.createRecord("reviewprocess",{});return r.layout={id:e.layoutId},this.currentModel.record=r,$L("#setupInnerLinks").hide(),{outlet:"#result",component:"crm-reviewprocess-create"}},beforeExit:function(e){e.record&&store.unloadRecord("reviewprocess",e.record.id)},getLayoutDetails:function(e,t){if(e){var r=this;return store.findAll("layout",{module:e,skip_permission:!0}).then((function(e){return e=r.returnValidLayouts(e)})).catch((function(e){var r=JSON.parse(e.responseText);if("NO_PERMISSION"===r.code||"PERMISSION_DENIED"===r.code||"INVALID_MODULE"===r.code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),t[0];renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))}return this.getModules(!0)},actions:{onError:function(e,t,r,s){Lyte.Component.render("crm-reviewprocess-create",{moduleName:""},"#setup_new_ContentDiv"),$("#result").hide()}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.review-process.edit-review-process",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess.js","business_hours-model.js"],ResourceConstants.CRMClient);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],ResourceConstants.CRMClient),t.concat(e).concat(networkUtils.returnDependencyFiles(["zohocrm_reviewprocess.js"],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["custom-function-model.js","crm-function-components-wrapper.js","crm-functions-helper.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient)).concat(fetchAutomationFunctionFiles())},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],ResourceConstants.CRMClient)},model:function(e){return commonUtils.showHideLoadingDiv(!0),{processRecord:this.getProcess(e),rpId:e.dynamicParam}},afterModel:function(e,t){var r=this,s=this.transition.data;return Lyte.resolvePromises({rpId:t.dynamicParam,processRecord:e.processRecord,criteriaFields:this.getCriteriaFields(e.processRecord.module.api_name,e.processRecord.layout.id),fieldsData:this.getFieldsData(e.processRecord),prevListModule:s.prevListModule,prevListLayout:s.prevListLayout}).then((function(e){return r.currentModel=e,r.currentModel}))},renderTemplate:function(e,t){for(var r=e.processRecord,s=store.peekAll("module"),n=s.length,i=0;i<n;i++)if(s[i].api_name===r.module.api_name){this.currentModel.moduleLabel=s[i].plural_label,this.currentModel.tabName=s[i].module_name;break}this.currentModel.functionsEnabled=Crm.userDetails.isRpCustomFunctionEnabled;var o=r.actions,a=r.layout.fields;this.currentModel.layoutId=r.layout.id;var l=a.length,c=[],u=[],d={};for(i=0;i<l;i++){var m=a[i];c.push(m.field_label),u.push(m.api_name),d[m.field_label]=m.api_name}var p=[],g=r.reason_for_rejection,f=g.length;for(i=0;i<f;i++)p.push(g[i].value);if(this.currentModel.rejectionReasons=p,this.currentModel.selectedFieldObj=u,o.sla&&o.sla.period&&o.sla.unit){if(this.currentModel.rpSlaAction=!0,o.sla.escalate_to)var h=this.getSelectedReviewers(o.sla.escalate_to);"BusinessDays"!==o.sla.period&&"BusinessHours"!==o.sla.period||(this.currentModel.isBusinessRuleApplicable=!0),this.currentModel.selectedReviewersMain=h||[];var y=this.getRpViewComponents(h);this.currentModel.renderReviewerDtlsMain=y}else r.actions.sla={};this.currentModel.setCriteria=r.criteria,o.notify_on.submission||o.notify_on.approval||o.notify_on.rejection||o.sla.period?(o.notify_on.submission=1==o.notify_on.submission,o.notify_on.approval=1==o.notify_on.approval,o.notify_on.rejection=1==o.notify_on.rejection):this.currentModel.rpNoActions=!0,this.currentModel.selectedFieldsVsApiName=d,this.currentModel.editConfig=!0,this.currentModel.moduleName=r.module.api_name,this.currentModel.layoutName=r.layout.name,this.currentModel.selectedFieldLabels=c,this.currentModel.prevRecrdFlds=c,this.currentModel.rules=r.rules;var C=Crm.userDetails.LICENSE_TYPE;return C="Z"===C&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0?"U":C,this.currentModel.maxFldCnt=this.getLimits().fields[C],{outlet:"#result",component:"crm-reviewprocess-createconfig"}},getProcess:function(e){var t=e.dynamicParam,r=store.peekRecord("reviewprocess",t);if(!r||!r.actions){var s={};r&&(s.module=r.module.api_name),r=store.findRecord("reviewprocess",t,s).then((function(e){return e[0]}))}return r},afterRender:function(){$(".setupleftmenutd , #setupInnerLinks").hide(),$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),$("#setup_new_ContentDiv").addClass("oH"),commonUtils.showHideLoadingDiv(!1),0===Search.criteriaDtls.length&&(Search.criteriaDtls=this.currentModel.criteriaFields)},didDestroy:function(){$("#setup_new_ContentDiv").removeClass("oH")},beforeExit:function(e){},actions:{onError:function(e,t,r,s){Lyte.Component.render("crm-reviewprocess-processdeleted",{showComp:!0},"#setup_new_ContentDiv"),$("#result").hide()}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.review-process.index-review-process",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-view.js"],ResourceConstants.CRMClient)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")],ResourceConstants.CRM))},model:function(){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({countObj:this.getRpRecordCount()})},afterModel:function(e){var t,r,s,n;if(this.transition.data&&Object.keys(this.transition.data).length>0){var i=this.transition.data;t=i.prevListModule?i.prevListModule:i.module,r=i.prevListLayout?i.prevListLayout:i.layout_id,t&&("undefined"==t?t=void 0:"All"!==t&&(s=this.getLayoutDetails(t),n=this.getModules()),r&&"undefined"==r&&(r=void 0))}var o,a=this,l={totalCount:e.countObj.total_count};return o=null!==t&&"All"!==t&&r&&"All"!==r?this.getRpDetails(t,r,l):null!==t&&"All"!==t?this.getRpDetails(t,void 0,l):this.getRpDetails(void 0,void 0,l),Lyte.resolvePromises({modules:n,layoutDetails:s,countObj:e.countObj,rplistView:o,actionCount:e.countObj.active_count,moduleName:t||"All",layoutId:r||"All",maxCountReached:this.isMaxCountReached(e.countObj.active_count)}).then((function(e){return a.currentModel=e,a.currentModel.totalRPs=l.totalCount,a.currentModel}))},renderTemplate:function(){return $(".setupleftmenutd , #setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow reviewprocessDiv"),{outlet:"#result",component:"crm-reviewprocess-listview"}},afterRender:function(e){this.transition.data.visible&&!this.transition.data.visible&&$L(".rpdisable").addClass("disable"),0==e.countObj.total_count?$L("#setupInnerLinks").hide():$("#setupInnerLinks").show(),$L(".setupleftmenutd").css("display","table-cell"),$(".new_setupview").removeClass("newSetupRightShow reviewprocessDiv"),commonUtils.showHideLoadingDiv(!1)},getRpRecordCount:function(){return store.triggerAction("reviewprocess","count",void 0,void 0,"GET",!1).then((function(e){return e.review_process})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},isMaxCountReached:function(e){var t=Crm.userDetails.LICENSE_TYPE;return t="Z"===t&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0?"U":t,e>=this.getLimits().process[t]},getRpDetails:function(e,t,r){store.unloadAll("reviewprocess");var s={};e&&"undefined"!=e&&(s.module=e),t&&"undefined"!=t&&(s.layout_id=t),r.totalCount>50&&(s.page=1,s.per_page=10);var n=this;return store.findAll("reviewprocess",s,!1).then((function(e){return n.setTotalCount(e,r),store.peekAll("reviewprocess")})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},setTotalCount:function(e,t){if(e&&e.length>0){var r=e.$.meta.total_count;r>0&&(t.totalCount=r)}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.review-process",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);return e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-view-rtl.css","crm-reviewprocess-view.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-view.css"],ResourceConstants.CRMClient)),networkUtils.returnDependencyFiles(["crm-reviewprocess-errMsg.js","crux-combo-box.js","reviewprocess.js","reviewprocess_model.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)).concat(e)},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-errormsg"}},afterRender:function(){"P"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE||(this.transition.abort(),$L("#rpNotSupportPop").e.ltProp({width:"500px",show:!0,showCloseButton:!1}))}}),Lyte.Router.registerRoute("crm.settings.section.review-usage",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-errMsg.js","reviewprocess.js","reviewprocess_model.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))},renderTemplate:function(){return CrmAnalytics.initChart(),{outlet:"#result",component:"crm-reviewprocess-errormsg"}},afterRender:function(){"P"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE||(this.transition.abort(),$L("#rpNotSupportPop").e.ltProp({width:"500px",show:!0,showCloseButton:!1}))}}),Lyte.Router.registerRoute("crm.settings.section.roles.create-role",{queryParams:["reportsToId"],model:function(e){var t=this.getQueryParams().reportsToId,r=this;commonUtils.showHideLoadingDiv(!0);var s=[store.findAll("role",{reload:!0},!1),store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.1/__features/roles",method:"GET"})],n=store.peekAll("module");if(moduleRecordMapping.Forecasts){var i=n?n.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!i.length&&(i[0].visible&&i[0].viewable);s[2]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/Role.do?action=getForecastType",method:"GET"})}else s[2]=store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/Role.do?action=getForecastType",method:"GET"});return Lyte.resolvePromises(s).then((function(e){var r=e[0]&&e[0].length?e[0].length:0,s=e[1],n=s.__features[0].details&&s.__features[0].details.limits?s.__features[0].details.limits.total:void 0;if(commonUtils.showHideLoadingDiv(!1),r<n){var i=t?store.peekRecord("role",t):void 0;return{mode:"create",reportsToid:t,roleSelected:i,reportingChanged:i,accessible:t&&!i?"false":"true",currentEdition:Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME_I18N}}return{mode:"create",accessible:"true",maxReached:n,currentEdition:Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME_I18N}}),(function(e){return e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"create",accessible:"false"}}))},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.new.role"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.delete-role",{model:function(e){var t=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var r=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",s=this,n=[store.findRecord("role",t)],i=store.peekAll("module");if(moduleRecordMapping.Forecasts){var o=i?i.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],a=!!o.length&&(o[0].visible&&o[0].viewable);n[1]=newForecastsEnabled&&a?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:r,method:"GET"})}else n[1]=store.findAll("dummy",void 0,!1,!1,{url:r,method:"GET"});return Lyte.resolvePromises(n).then((function(e){if(commonUtils.showHideLoadingDiv(!1),e&&e[0]){var r,s=e[0].length&&e[0][0]?e[0][0]:[];return r=newForecastsEnabled?!(!e[1].hierarchy||"Roles"!==e[1].hierarchy.api_name):!(!e[1]||1===Crm.userDetails.TMENABLED),{mode:"delete",roleId:t,roleObj:s,forecastEnabled:r,sharePeer:!1,roleName:s.display_label,accessible:"true"}}return{mode:"delete",roleId:t,accessible:"false"}}),(function(e){return e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),s.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"delete",roleId:t,accessible:"false"}}))},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.role.delete"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.edit-role",{model:function(){var e=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",r=this,s=[store.findRecord("role",e)],n=store.peekAll("module");if(moduleRecordMapping.Forecasts){var i=n?n.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!i.length&&(i[0].visible&&i[0].viewable);s[1]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"})}else s[1]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"});return Lyte.resolvePromises(s).then((function(t){if(commonUtils.showHideLoadingDiv(!1),t&&t[0]){var r,s=t[0].length&&t[0][0]?t[0][0]:[],n=s.reporting_to?s.reporting_to&&!s.reporting_to.id?s.id:void 0:s.id,i=s.forecast_manager?{id:s.forecast_manager.id,full_name:s.forecast_manager.name}:{};return r=newForecastsEnabled?!(!t[1].hierarchy||"Roles"!==t[1].hierarchy.api_name):!(!t[1]||1===Crm.userDetails.TMENABLED),s.reporting_to&&s.reporting_to.id?store.findRecord("role",s.reporting_to.id).then((function(){return{mode:"edit",roleId:e,roleObj:s,forecastEnabled:r,forecastManager:i,roleSelected:s.reporting_to,reportingChanged:s.reporting_to,ceoId:n,sharePeer:s.share_with_peers,roleName:s.display_label,desc:s.description,accessible:"true"}})):{mode:"edit",roleId:e,roleObj:s,forecastEnabled:r,forecastManager:i,roleSelected:s.reporting_to,reportingChanged:s.reporting_to,ceoId:n,sharePeer:s.share_with_peers,roleName:s.display_label,desc:s.description,accessible:"true"}}return{mode:"edit",roleId:e,accessible:"false"}}),(function(t){return t&&401===t.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"edit",roleId:e,accessible:"false"}}))},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.role.edit"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.index-roles",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles)return networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.css"],ResourceConstants.CRMClient))},model:function(){var e;commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",r=this;store.unloadAll("role");var s=[store.findAll("org"),store.findAll("role",{reload:!0},!1)],n=store.peekAll("module"),i=!0;if(moduleRecordMapping.Forecasts){var o=n?n.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],a=!!o.length&&(o[0].visible&&o[0].viewable);newForecastsEnabled&&a?e=store.findAll("forecast_configuration"):(s[2]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"}),i=!1)}else s[2]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"}),i=!1;return i?e.then((function(e){return Lyte.resolvePromises(s).then((function(t){commonUtils.showHideLoadingDiv(!1);var r=t[0]&&t[0][0]?t[0][0].company_name:"",s=store.peekAll("role").filter((function(e){if(!e.reporting_to)return e}))[0];return{companyName:r,showPopup:!r,forecastEnabled:newForecastsEnabled?!(!e.hierarchy||"Roles"!==e.hierarchy.api_name):!(!t[2]||1===Crm.userDetails.TMENABLED),ceoId:s.id?s.id:"",rolesTree:[{name:r,children:[s]}]}}),(function(e){e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort())}))}),(function(){return Lyte.resolvePromises(s).then((function(e){commonUtils.showHideLoadingDiv(!1);var t=e[0]&&e[0][0]?e[0][0].company_name:"",r=store.peekAll("role").filter((function(e){if(!e.reporting_to)return e}))[0];return{companyName:t,showPopup:!t,forecastEnabled:!1,ceoId:r.id?r.id:"",rolesTree:[{name:t,children:[r]}]}}),(function(e){e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort())}))})):Lyte.resolvePromises(s).then((function(e){commonUtils.showHideLoadingDiv(!1);var t=e[0]&&e[0][0]?e[0][0].company_name:"",r=store.peekAll("role").filter((function(e){if(!e.reporting_to)return e}))[0];return{companyName:t,showPopup:!t,forecastEnabled:newForecastsEnabled?!(!e[2].hierarchy||"Roles"!==e[2].hierarchy.api_name):!(!e[2]||1===Crm.userDetails.TMENABLED),ceoId:r.id?r.id:"",rolesTree:[{name:t,children:[r]}]}}),(function(e){e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort())}))},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-roles-list",reRender:!0}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.roles.list"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.view-role",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlist.css"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"userlist/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.RELEVANT_LOCALE)+".js"],ResourceConstants.CRM))},beforeModel:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.view.role"),Crm.partnerName]))},model:function(){if(this.transition.data.data)return this.transition.data.data;var e=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",r=this,s=[store.findRecord("role",e)],n=store.peekAll("module");if(moduleRecordMapping.Forecasts){var i=n?n.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!i.length&&(i[0].visible&&i[0].viewable);s[1]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"})}else s[1]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"});return Lyte.resolvePromises(s).then((function(t){commonUtils.showHideLoadingDiv(!1);var r=store.peekRecord("role",e);if(r&&r.id){var s,n={0:"crm.security.user.fullName",1:"crm.label.email.address",2:"crm.security.user.status",3:"crm.security.confirm.status"};return Crm.userDetails.isUserHierarchy&&(n[4]="crm.user.hierarchy.reportingto"),s=newForecastsEnabled?!(!t[1].hierarchy||"Roles"!==t[1].hierarchy.api_name):!(!t[1]||1===Crm.userDetails.TMENABLED),r.reporting_to&&r.reporting_to.id?store.findRecord("role",r.reporting_to.id).then((function(){return{roleId:e,forecastEnabled:s,roleObj:r,accessible:"true",isUserHierarchy:Crm.userDetails.isUserHierarchy,tableObj:JSON.stringify(n)}})):{roleId:e,forecastEnabled:s,roleObj:r,accessible:"true",isUserHierarchy:Crm.userDetails.isUserHierarchy,tableObj:JSON.stringify(n)}}return{roleId:e,accessible:"false"}}),(function(t){return t&&401===t.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{roleId:e,accessible:"false"}}))},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-view",reRender:!0}},afterRender:function(e,t){wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.view.role"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles){var e=networkUtils.returnDependencyFiles(["crm-roles-resources.js","lyte-tree.js","org-model.js","crm-userlist.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-roles-resources.css"],ResourceConstants.CRMClient);if(Crm.userDetails.RTL_ENABLED){var r=networkUtils.returnDependencyFiles(["crm-roles-rtl.css"],ResourceConstants.CRMClient);t=t.concat(r)}var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ReportingToPopup"),networkUtils.getI18nJSUrl("Roles")],ResourceConstants.CRM);return e.concat(t).concat(s)}},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){"crm.settings.section.roles"===this.transition.target&&this.replaceWith("crm.settings.section.roles.index-roles")}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-signal-model.js","crm-widget-container.js","custom-function-model.js","function-model.js","lyte-fileupload.js","crm-widget-data-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-signal-panel.js","managesignals.js","manage-signals-helpers.js","crm-help-link.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","custom-function-editor.js","reviewprocess.js","crm-function-components-wrapper.js","crm-functions-helper.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["zohocrm_signalsettings.js",networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],ResourceConstants.CRM);return e=(e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-manage-signals-rtl.css","crm-manage-signals.css","function-common.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-manage-signals.css","function-common.css","custom-function-functionlist.css","custom-function-editor.css","crm-reviewprocess-customfunction.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),t.concat(r).concat(s).concat(e)},model:function(){return store.findAll("extensions")},redirect:function(){if("crm.settings.section.sales-signals"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.sales-signals.index-sales-signals"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-deployment-logs",{model:function(){var e=document.querySelector("crm-sandbox-deploymentlogs");return null!==e&&e.remove(),void 0!==this.transition.data&&!0===this.transition.data.isFromSandboxList?{filterComponent:store.triggerAction("sandbox","supported_components",{apiVersion:"3"},{},"GET"),deployment_logs:store.findAll("sandbox_deployment_log"),sandboxList:store.findAll("sandbox",{include_inner_details:"created_by.image_link"})}:{filterComponent:store.triggerAction("sandbox","supported_components",{apiVersion:"3"},{},"GET"),deployment_logs:store.findAll("sandbox_deployment_log"),sandboxList:void 0}},afterModel:function(e){void 0!==e.sandboxList&&0===e.sandboxList.length&&Lyte.Router.transitionTo("crm.settings.section.sandbox.sandbox-list"),Lyte.registeredMixins["crm-sandbox-util"].processComponentFilter(this.currentModel),this.currentModel={componentVsSingularLabel:e.componentVsSingularLabel,componentVsPluralLabel:e.componentVsPluralLabel,componentFilter:e.componentFilter,deployment_logs:e.deployment_logs,moreRecords:e.deployment_logs.length>0&&e.deployment_logs.$.meta.more_records,showfilter:e.deployment_logs.length>0}},renderTemplate:function(){return{outlet:"#result",component:"crm-sandbox-deploymentlogs"}},afterRender:function(){var e=$L("#sandboxFilterInSandbox")[0];void 0!==e&&(e.component.data.cxPropSelected="All")},actions:{onError:function(e){Lyte.Router.getRouteInstance().transition.abort();var t=JSON.parse(e.responseText);"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")},willTransition:function(e){"crm.settings.section.sandbox.sandbox-list"===e.target&&(e.data={},e.data.isFromDeploymentLogs=!0)}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-detail",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM)},model:function(){var e=this.transition.data?this.transition.data.sandboxInfo:null;if(e&&"Creating"===e.status){e.sandboxId=this.getDynamicParam();var t=store.peekRecord("sandbox",e.sandboxId);return Crm.isMultiSandboxEnabled&&t&&("configuration"===t.type?e.type=I18n.getMsg("custmr.prtl.configuration"):"configuration_and_data"===t.type?e.type=I18n.getMsg("crm.sandbox.singular.type2"):"full_data"===t.type?e.type=I18n.getMsg("crm.sandbox.fulldata"):"uat_sandbox"===t.type&&(e.type=I18n.getMsg("crm.sandbox.uatsandbox")),t.status=e.status,e.sandboxData=t,e.isMultiSandbox=!0),e}var r=void 0!==this.getDynamicParam()?this.getDynamicParam():this.transition.data.sandboxId;return Lyte.resolvePromises({currentSandbox:store.findRecord("sandbox",r)}).then((function(e){if(_.isEmpty(e.currentSandbox)){let e=I18n.getMsg("crm.sandbox.not.found");return sandbox.showSandboxInfoBox("error",e),void Lyte.Router.transitionTo("crm.settings.section.sandbox.sandbox-list")}var t=e.currentSandbox[0],s=t.status;if(store.unloadAll("sandbox_change"),"deactivated"===s||"creating"===s||"Creating"===s||"refreshing"===s)return t;if(void 0!==t&&void 0!==t.org_id)return Lyte.resolvePromises([store.findAll("sandbox_change",{sandboxId:r,include_inner_details:"module.name,resource.display_name"}),store.triggerAction("sandbox","supported_components",{apiVersion:"3"},{},"GET"),"false"===isSandboxAcc?store.findAll("dummy",{},!1,!1,{url:"crm/v2.2/settings/sandbox/actions/summary"}):void 0]).then((function(e){return{changeList:e[0],filterComponent:e[1],countList:e[2],currentSandbox:t}}));var n,i=t.domain_name;return Lyte.resolvePromises({orgs:store.findAll("dummy",{env_type:"sandbox"},!1,!1,{url:"/crm/v2/organizations"}),changeList:store.findAll("sandbox_change",{sandboxId:r,include_inner_details:"module.name,resource.display_name"}),filterComponent:store.triggerAction("sandbox","supported_components",{apiVersion:"3"},{},"GET"),currentSandbox:t}).then((function(e){return e.orgs.organizations.forEach((function(e){e.domain_name===i&&(n=e.id)})),t.$.set("org_id",n),e}))}))},afterModel:function(e){var t=void 0!==e.status?e.status:e.currentSandbox.status;if("deactivated"!==t&&"creating"!==t&&"Creating"!==t&&"refreshing"!==t){this.currentModel={changeList:e.changeList,currentSandbox:e.currentSandbox,filterAPIVsDisplayName:e.filterComponent.supported_components.sortBy("singular_label"),moreRecords:e.changeList.length>0&&e.changeList.$.meta.more_records},void 0!==e.countList&&e.countList.sandbox.forEach((function(e){var t=store.peekRecord("sandbox",e.id);t&&t.$&&t.$.set("changes_count",e.undeployed_changes_count)}));var r=e.currentSandbox.domain_name;sandbox.isSeeDiffTriggered=!1,sandbox.orgInfo.crmSandboxOrParentPortal=r,sandbox.orgInfo.crmSandboxOrParentBasePath="/crm/"+r;var s={},n="/crm/v2.2/settings/module";"false"===isSandboxAcc&&(sandbox.orgInfo.crmSandboxOrParentZgid=e.currentSandbox.org_id,s.isSandboxDiff=!0,s.headers=store.adapter.application.headersForRequest("findAll",void 0,s));var i=Lyte.registeredMixins["crm-sandbox-util"];i.processComponentFilter(this.currentModel);var o=this;return n=store.adapter.application.buildURL("module","findAll",{},void 0,n,void 0,s),s.url=n,Lyte.resolvePromises([store.findAll("dummy",{},!1,!1,s)]).then((function(e){i.processModuleFilter(o.currentModel,e)}),(function(){i.processModuleFilter(o.currentModel,null)}))}this.currentModel={currentSandbox:void 0!==e.sandboxData?e.sandboxData:e}},lyteConvertionSupported:!0,renderTemplate:function(e){var t=void 0!==e.status?e.status:e.currentSandbox.status;return"company"===e.data&&Lyte.Router.transitionTo("crm.settings.section.company-details"),"Creating"===t||"creating"===t?(Crm.userDetails.isSandboxCreated=!1,{outlet:"#result",component:"crm-sandbox-details"}):"new sandbox"!==e.data?(Crm.userDetails.isSandboxCreated=!0,{outlet:"#result",component:"crm-sandbox-details"}):(Crm.userDetails.isSandboxCreated=!1,Lyte.Router.transitionTo({route:"crm.settings.section.sandbox"}),void setTimeout((function(){crmLayout.Resize.Setup()}),300))},didDestroy:function(){store.unloadAll("sandbox_change"),store.unloadAll("sandbox_config_item")},actions:{willTransition:function(e){"crm.settings.section.sandbox.sandbox-list"===e.target||"crm.settings.section.sandbox"===e.target?(e.data={},e.data.refresh=!0):"crm.settings.section.sandbox.sandbox-detail"===e.target&&(Lyte.Router.getRouteInstance().transition.data.refresh=!0),sandbox.removeComponent()},onError:function(e){if(404===e.status){var t=JSON.parse(e.responseText);if(t&&"sandbox not found"===t.data){var r=this.getDynamicParam();null!==store.peekRecord("sandbox",r)&&store.deleteRecord("sandbox",r),Lyte.Router.transitionTo({route:"crm.settings.section.sandbox"}),crmui.showMsgBand("error",I18n.getMsg("crm.sandbox.not.found"),5e3)}}}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-list",{model:function(){if("true"!==window.isSandboxAcc&&sandbox.isMultiSandbox){var e=void 0!==this.transition.data&&!0===this.transition.data.isFromSandbox;return{countList:store.findAll("dummy",{},!1,!1,{url:"crm/v2.2/settings/sandbox/actions/summary"}),sandboxList:e?void 0:store.findAll("sandbox",{include_inner_details:"created_by.image_link"}),organizations:store.findAll("dummy",{env_type:"sandbox"},!1,!1,{url:"/crm/v2/organizations"})}}return Lyte.resolvePromises({countList:store.findAll("dummy",{},!1,!1,{url:"crm/v2.2/settings/sandbox/actions/summary"})}).then((function(e){var t,r,s,n=store.peekAll("sandbox"),i=n.length;for(let e=0;e<i;e++)if((t=n[e]).org_id===crmZgid){r=t.id;break}var o=e.countList.sandbox.length;for(let n=0;n<o;n++)if((s=e.countList.sandbox[n]).id===r){t.$.set("changes_count",s.undeployed_changes_count);break}return{sandboxList:t,countList:s}}))},afterModel:function(e){if("false"===window.isSandboxAcc&&void 0!==e.countList&&e.countList.hasOwnProperty("sandbox")){var t={},r={},s={};e.countList.sandbox.forEach((function(e){var r=store.peekRecord("sandbox",e.id);r&&r.$.set("changes_count",e.undeployed_changes_count),t[e.id]=e})),e.organizations.organizations.forEach((function(e){"sandbox"===e.type&&(r[e.domain_name]=e.web_url+"/")}));var n=void 0!==e.sandboxList?e.sandboxList:store.peekAll("sandbox");n.forEach((function(e){s[e.id]=e.created_by})),this.currentModel={sandboxList:n,sandboxIdVsCountMap:t,nameVsUrl:r,sandboxIdVsCreatedby:s}}},renderTemplate:function(e){if("company"===e.data&&Lyte.Router.transitionTo("crm.settings.section.company-details"),"new sandbox"===e||"new sandbox"===e.data||(void 0===e.sandboxList||0===Object.keys(e.sandboxList).length)&&void 0===e.INFO)Crm.userDetails.isSandboxCreated=!1,sandbox.showStartPage();else{if("true"!==window.isSandboxAcc&&sandbox.isMultiSandbox)return Crm.userDetails.isSandboxCreated=!0,{outlet:"#result",component:"crm-sandbox-list"};Crm.userDetails.isSandboxCreated=!0,Lyte.Router.transitionTo({route:"crm.settings.section.sandbox.sandbox-detail",dynamicParams:[e.sandboxList.id]}).data={sandboxId:e.sandboxList.id}}setTimeout((function(){crmLayout.Resize.Setup()}),300)},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.data.sandbox"),Crm.partnerName]))},actions:{willTransition:function(e){"crm.settings.section.sandbox.sandbox-deployment-logs"===e.target&&(e.data={},e.data.isFromSandboxList=!0),sandbox.removeComponent()},onError:function(e){Lyte.Router.getRouteInstance().transition.abort();var t=JSON.parse(e.responseText);"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")},didTransition:function(){"crm.settings.section.sandbox.sandbox-list"===this.transition.target&&(this.transition.data.refresh=!1),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox",{getDependencies:function(){return networkUtils.returnDependencyFiles(["sandbox.js"],ResourceConstants.CRMClient)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["sandbox-min.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["sandbox-min.css"],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm-sandbox-accessibleto.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["crm-organization-create-domainpattern.js","crm-sandbox-associations-tooltip.js","pipeline-associations.js","crm-sandbox-mixin.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-organization-create-domainpattern.css"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["cscript/cscript-sandbox-mixin.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-sandbox-list.js","lyte-dateselect.js","lyte-daterangepicker.js"],ResourceConstants.CRMClient);e=networkUtils.returnDependencyFiles(["crm-sandbox-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);var l=networkUtils.returnDependencyFiles(["crm-create-sandbox.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=e.concat(l);var c=networkUtils.returnDependencyFiles(["crm-sandbox-accessibleto.js"],ResourceConstants.CRMClient),u=networkUtils.returnDependencyFiles(["crm-sandbox-deploymentlogs.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sandbox")],ResourceConstants.CRM),m=networkUtils.returnDependencyFiles(["crm-sandbox-checkdependency.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),p=networkUtils.returnDependencyFiles(["crm-sandbox-details.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["lyte-lazyRender.js"],ResourceConstants.CRMClient)),g=networkUtils.returnDependencyFiles(["crm-sandbox-details.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),f=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SandboxIntegrationSupport")],ResourceConstants.CRM);return t.concat(n).concat(r).concat(s).concat(i).concat(a).concat(c).concat(u).concat(e).concat(d).concat(m).concat(p).concat(g).concat(o).concat(f)},model:function(){if(Crm.isMultiSandboxEnabled)return store.unloadAll("sandbox"),"false"===window.isSandboxAcc?store.findAll("sandbox",{include_inner_details:"created_by.image_link"}):Lyte.resolvePromises({orgs:store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2/organizations/"+crmZgid})}).then((function(e){return sandbox.orgInfo.crmSandboxOrParentZgid=e.orgs.organizations[0].parent_org.id,sandbox.parOrg=e.orgs.organizations[0].parent_org.id,store.findAll("sandbox",{include_inner_details:"created_by.image_link"})}))},afterModel:function(e){var t=this.transition.target,r=this.transition.data;"crm.settings.section.sandbox.sandbox-deployment-logs"===t&&0===e.length&&(this.replaceWith("crm.settings.section.sandbox.sandbox-list").data=r);"crm.settings.section.sandbox.sandbox-list"!==t&&"crm.settings.section.sandbox"!==t||(r.isFromSandbox=!0)},redirect:function(){if("crm.settings.section.sandbox"===this.transition.target&&!this.transition.data.refresh){var e=this.transition.data;this.replaceWith("crm.settings.section.sandbox.sandbox-list").data=e}},actions:{onError:function(e){Lyte.Router.getRouteInstance().transition.abort();try{var t=JSON.parse(e.responseText)}catch(e){return void crmui.showMsgBand("error",I18n.getMsg("crm.label.Failure"),4e3)}"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.schedule-mass-email",{queryParams:["module"],model:function(e){var t={newModel:!0,step:"showAllSchedules"};t.module=e.queryParams.module;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CreateMassMailScheduler.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.schedules",{queryParams:["id"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zcrm_pushComponent.js"],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("schedules")],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_schedules.js"],ResourceConstants.CRM))},beforeModel:function(){Crm.userDetails.orgName||(this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.company-details"))},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/schedules","GET")},afterModel:function(e,t){crm_schedules&&(this.currentModel=crm_schedules.alterResponse(e))},renderTemplate:function(e,t){return crm_schedules.schedules_count=e.schedules_count,{outlet:"#result",html:Handlebars.templates.SchedulesConfig(e)}},afterRender:function(e,t){crm_schedules.postRender(e),t.queryParams.id&&crm_schedules.edit(t.queryParams.id)},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),"undefined"!=typeof ZohoDRE&&ZohoDRE.resetRequestData()}}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules",{queryParams:["module"],getDependencies:function(){return"undefined"!=typeof scoringRulesSettings||isMultiScoreAvail?isMultiScoreAvail?networkUtils.returnDependencyFiles(["scoringrules_mixin.js"],ResourceConstants.CRMClient):void 0:networkUtils.returnDependencyFiles(["zohocrm_scoringrule.js"],ResourceConstants.CRM)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringrules")],ResourceConstants.CRM);return isMultiScoreAvail&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringrulesnew")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["scoringrules_store.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["scoringrules.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},redirect:function(){isMultiScoreAvail&&"crm.settings.section.scoring-rules"===this.transition.target&&this.replaceWith("crm.settings.section.scoring-rules.index-scoring-rule")},model:function(){if(!isMultiScoreAvail){var e=this.getQueryParams().module;return new Promise((function(t){scoringRulesSettings.initRequest("/crm/v2/settings/modules","GET","",(function(r){for(var s=0,n=[],i=r.modules.length;s<i;){if(r.modules[s].scoring_supported&&r.modules[s].visible){var o="Deals"===r.modules[s].module_name?"Potentials":r.modules[s].module_name;o="Meetings"===r.modules[s].module_name?"Events":o,n.push({module_name:o,plural_label:r.modules[s].plural_label})}s++}if(0!=n.length){scoringRulesSettings.supported_modules=n;var a={params:{module:e=void 0!==e?e:n[0].module_name},success_callback:t};return networkUtils.makeRequest("/crm/v2/settings/scoring_rules","GET",a)}var l='<div class="topdivcontainer p30 pL40 pR40" style="position:relative;"><div class="oH"> <div class="darkMainHead fL mB5">'.concat(I18n.getMsg("crm.label.scoring.rules")).concat("</div> </div>");l=(l=l.concat('<div class="cBoth"> <div class="mT15 content mB30">').concat(I18n.getMsg("crm.label.scoring.rules.records.content"))).concat('</div> <div class="w200"></div></div> <div class="crm-error-page pR pL30"><span class="crm-error-page-icon p0"></span> <h2 style="color:var(--redLightColor);" class="mL15">').concat(I18n.getMsg("crm.label.scoring.rules.module.not.present.content")).concat("</h2></div></div>"),t(l)}))}))}},afterModel:function(e){if(!isMultiScoreAvail){if("NO_PERMISSION"===e.code)return void renderingUtils.displayPermissionDenied();if("PATTERN_NOT_MATCHED"===e.code)return void renderingUtils.displayPermissionDenied();scoringRulesSettings.supported_modules&&0!=scoringRulesSettings.supported_modules.length&&(scoringRulesSettings.processExtensions(e),e.supported_modules=scoringRulesSettings.supported_modules,e.info.module_singularlabel=moduleRecordMapping[e.info.module].singular_label,e.info.module_plurallabel=moduleRecordMapping[e.info.module].plural_label,scoringRulesSettings.isSchedulerRunning=e.info.isSchedulerRunning,scoringRulesSettings.isScoringRulePresent=e.scoring_rules.length>0)}},renderTemplate:function(e){if(!isMultiScoreAvail)return scoringRulesSettings.supported_modules&&0!=scoringRulesSettings.supported_modules.length?{outlet:"#result",html:Handlebars.templates.ScoringRuleSettings(e)}:{outlet:"#result",html:e}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.scoring.rules"),Crm.partnerName])),!isMultiScoreAvail){$("#scoring_module option[value="+e.info.module+"]").prop("selected",!0),thirdPartyUtils.bindSelect2(".newSelect select");var t=renderingUtils.windowOuterHeight-(parseInt(renderingUtils.tabLayerOuterHeight())+28);$("#setup_new_leftmenuDiv").height(t).addClass("oA"),$("#setup_new_ContentDiv").height(t).addClass("oA helpOverflowHide")}},actions:{willTransition:function(){closeAsapWidget(),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.clone-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],ResourceConstants.CRMClient))},beforeModel:function(){store.unloadAll("layout"),store.unloadAll("field"),Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.dynamicParam;return this.initRulesAndLayoutReq(t)},afterModel:function(e){if(this.afterModelRuleChanges(e,!1),e.isViewOnly)return this.redirectToListView({type:"error",msg:I18n.getMsg("readonly.clone.error.msg")}),void this.transition.abort();e.signalIdVsSignalJo={};var t={},r=e.scoring_rules;t.module={api_name:r.module.api_name,id:r.module.id},r.layout&&(t.layout={api_name:r.layout.api_name,id:r.layout.id}),t.active=!0,t.description=r.description,t.name=(I18n.getMsg("crm.label.clone")+" "+I18n.getMsg("crm.wf.audtiLog.view.of")+" "+r.name).substring(0,25);var s=store.createRecord("scoring_rule",t),n=!0;if(r.field_rules.forEach((function(e,t){var r=e.$.toJSON();delete r.id;var i=store.createRecord("scoring_field_rule",r);0===t?s.$.set("field_rules",i):s.field_rules.add(i),n=!1})),r.signal_rules.forEach((function(t,r){var i=t.$.toJSON();delete i.id;var o=store.createRecord("scoring_signal_rule",i);o.isChecked=!0,o.scoreClone=Math.abs(t.score),o.operator=o.score>0?"add":"subtract",0===r?s.$.set("signal_rules",o):s.signal_rules.add(o),o.isNew=!0,e.signalIdVsSignalJo[o.signal.id]=o,n=!1})),this.markDisabledSignals(e),e.scoring_rules=s,e.disableSaveBtn=n,!r.layout&&this.isGDPREnabledForModule(r.module.api_name)){let t=this.getRequiredConsentFieldsColumnNames(e.criteria_fields);if(t.length>0)return store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(r){let s=r.length;for(let n=0;n<s;n++)t.includes(r[n].column_name)&&(e.criteria_fields.push(r[n]),t.splice(n,1));return e}))}return e},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){this.setScoreRuleTitle()},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["scoringrules_common","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.create-scoring-rule",{queryParams:["layout_id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],ResourceConstants.CRMClient))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("layout"),store.unloadAll("field"),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.queryParams.layout_id,r=e.dynamicParam,s=moduleRecordMapping[r];if(s&&s.visible){var n={rules_meta:this.transition.data.rules_meta?this.transition.data.rules_meta:this.initDefAPI(),cf_meta:this.transition.data.cf_meta?this.transition.data.cf_meta:this.getCreateLimitNcfMeta(t,moduleApiMapping[r])};return t?n.layout=store.findAll("layout",{module:moduleApiMapping[r],skip_permission:!0},!1,!0,{apiVersion:"2.2",moduleSet:!0}):n.criteria_fields=store.findAll("field",{module:moduleApiMapping[r]},!1,!0,{apiVersion:"2.2"}),Lyte.resolvePromises(n)}this.redirectToListView()},afterModel:function(e,t){var r={},s=t.queryParams.layout_id;if(s){r.layout={id:s};var n=store.peekRecord("layout",s);this.isValidLayoutRecord(n)?(r.layout.api_name=n.name,e.criteria_fields=n.fields):(this.transition.abort(),this.redirectToListView())}if(r.module={api_name:moduleApiMapping[t.dynamicParam],id:Crm.moduleInfo[t.dynamicParam].Id},r.name=this.transition.data.ruleName,r.description=this.transition.data.description,r.name||(r.name="New Rule"),e.scoring_rules=store.createRecord("scoring_rule",r),this.parseRulesMeta(e.rules_meta,e),s&&!e.meta_extraDetails.isLayoutSupported&&(this.transition.abort(),this.redirectToListView({type:"error",msg:I18n.getMsg("score.rule.active.msg")})),!s&&this.isGDPREnabledForModule(r.module.api_name)){let t=this.getRequiredConsentFieldsColumnNames(e.criteria_fields);if(t.length>0)return store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(r){let s=r.length;for(let n=0;n<s;n++)t.includes(r[n].column_name)&&(e.criteria_fields.push(r[n]),t.splice(n,1));return e}))}return e},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){this.setScoreRuleTitle()},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["scoringrules_common","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.edit-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],ResourceConstants.CRMClient))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0,store.unloadAll("layout"),store.unloadAll("field")},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.dynamicParam;return this.initRulesAndLayoutReq(t)},afterModel:function(e){if(this.afterModelRuleChanges(e,!0),!e.scoring_rules.layout&&this.isGDPREnabledForModule(e.scoring_rules.module.api_name)){let t=this.getRequiredConsentFieldsColumnNames(e.criteria_fields);if(t.length>0)return store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(r){let s=r.length;for(let n=0;n<s;n++)t.includes(r[n].column_name)&&(e.criteria_fields.push(r[n]),t.splice(n,1));return e}))}return e},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){if(this.setScoreRuleTitle(),this.transition.preservePopup=!0,this.transition.data){var e=this.transition.data;e.type&&this.displaySuccessOrErrorMsg(e.msg,e.type)}},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["scoringrules_common","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.index-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_details.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["scoring_details.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_details_rtl.css"],ResourceConstants.CRMClient))),e},model:function(){this.setRouteDataInObj();var e=this.getCurrFilterData(),t=Object.keys(e).length>0;return Lyte.resolvePromises({scoring_rules:store.findAll("scoring_rule",e),rules_meta:this.initDefAPI(),isFromFilter:t,filteredModule:e.module,selectedStatus:e.active})},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-details"}},afterModel:function(e){var t=[],r=[{api_name:"_allModules",displayLabel:I18n.getMsg("crm.label.AllModules")}];e.rules_meta.definition.extraDetails.supportedModules.forEach((function(e){t.push({api_name:moduleApiMapping[e],displayLabel:Lyte.Component.registeredHelpers.getModuleLabel(e),module_name:e})})),r=r.concat(objectUtils.cloneObject_new(t)),e.scoringModules=t,e.modFilterArr=r,e.scoring_rules=objectUtils.cloneObject_new(e.scoring_rules),e.isRulesAvailInFilter=!e.isFromFilter||e.isFromFilter&&e.scoring_rules.length>0,this.parseRulesMeta(e.rules_meta,e,"listView")},afterRender:function(){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.scoring.rules"),Crm.partnerName])),this.transition.preservePopup=!0,this.transition.data){var e=this.transition.data,t=this.transition.data.type,r=!!this.transition.data.cfError;if("schedule_rule"===t){var s={rules:[e.id],module:e.module};this.makeRunRulesReq(s,r)}r?renderingUtils.showCustomAlert(this.transition.data.msg):t&&"schedule_rule"!==t&&this.displaySuccessOrErrorMsg(this.transition.data.msg,t)}},beforeExit:function(){this.isSelfTarget||store.unloadAll("scoring_rule")},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}},lyteConvertionSupported:!0},{mixins:["scoringrules_common"]}),Lyte.Router.registerRoute("crm.settings.section.sdks",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-sdk.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SDK")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-sdk.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(r).concat(t)},lyteConvertionSupported:!0,renderTemplate:function(e,t){return{outlet:"#result",component:"crm-sdk"}},actions:{onError:function(e,t,r){return!1}}}),Lyte.Router.registerRoute("crm.settings.section.section-error",{afterModel:function(e,t){this.currentModel=this.transition.data},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.segmentation.create",{model:function(){commonUtils.showHideLoadingDiv(!0);var e=[store.findAll("segments"),store.findAll("module",{feature_name:"rfm_segmentation"})];return Lyte.resolvePromises(e).then((function(e){return commonUtils.showHideLoadingDiv(!1),{isSuccess:!0,segments:store.peekAll("segments"),supportedSegmentModule:e?e[1]:[]}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t,r=(t=JSON.parse(e.response)).segments;return r&&!r.segments.details.length?t={isSuccess:!0,segments:[]}:t.isSucess=!1,t}))},afterModel:function(e){if(e.isSuccess){var t=e.supportedSegmentModule.filter((function(e){return e.visible}));e={newSegment:store.createRecord("segments"),isSuccess:!0,segmentationModules:t,linkingModules:[],AllFieldsList:[],allModulesArray:[]}}else e.isSuccess=!1;this.currentModel=e},renderTemplate:function(e){if("NOT_SUPPORTED_FEATURE"!==e.code&&"NO_PERMISSION"!==e.code)return{outlet:"#result",component:"crm-segmental-create"};renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},actions:{willTransition:function(e){var t=getElemById("createSegment");(store.peekAll("segments").filter((function(e){return e.$.isNew})).length||t&&t.getData("isSegmentCreated"))&&this.pauseTheTransaction(e)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation.edit",{model:function(){var e=this.getDynamicParam(),t="2"===this.transition.info.queryParams.step;return this.transition.data.isLabelsEdit=t,commonUtils.showHideLoadingDiv(!0),this.getSegmentationDetails(e,t)},afterModel:function(e){this.currentModel=this.populateSegmentationDetails(e,this.transition.data.isLabelsEdit)},renderTemplate:function(){if(this.currentModel){var e=!0;if(!this.currentModel.noPermission)if(this.transition.data.isLabelsEdit){var t=this.currentModel.segment,r=store.peekRecord("module",t.module.id),s=store.peekRecord("module",t.link_module.id);if(r&&s&&r.visible&&s.visible)return e=!1,{outlet:"#result",component:"crm-segment-labels"}}else{r=this.currentModel.segmentModuleDetails,s=this.currentModel.lookUpModuleDetails;if(r&&s&&r.visible&&s.visible)return e=!1,{outlet:"#result",component:"crm-segment-info"}}if(e||this.currentModel.noPermission)return commonUtils.showHideLoadingDiv(!1),{outlet:"#result",component:"segment-info-popup"}}},actions:{willTransition:function(e){var t=this.getDynamicParam(),r=$L("crm-segment-info")[0],s=r&&!r.getData("IsCancelFromEditPage")&&(r.component.getData("isGlobalRuleEdit")||r.component.getData("isConModuleCriEdit")),n=store.peekRecord("segments",t)&&store.peekRecord("segments",t).$.isDirty();(s||n)&&this.pauseTheTransaction(e)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation.index",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("segments").then((function(){var e=store.peekAll("segments"),t=!0,r=!0,s=!1;e&&(e.length&&(t=!1),t?r=!0:(r=!1,s=!0));for(var n=[],i=e.length,o=0,a=0;a<i;a++){var l={};l.segmentalModule=store.peekRecord("module",e[a].module.id);var c=store.peekRecord("module",e[a].link_module.id);if(l.segmentalModule&&c&&l.segmentalModule.visible&&c.visible){l.segmentId=e[a].id,l.segmentName=e[a].name;var u=l.segmentalModule.plural_label,d=c.plural_label;l.segmentAndLookupModule=u,l.linkingModule=c,l.linkingField=e[a].link_field,l.recencyField=e[a].recency_field,l.frequencyField=e[a].frequency_field,"$Count_Of"===l.frequencyField.api_name&&(l.frequencyField={field_label:I18n.getMsg("crm.dashboard.funnel.count.of",[d])}),l.monetaryField=e[a].monetary_field,l.criteriaType="automatic"===e[a].score_type?I18n.getMsg("crm.dumprequest.automatic"):I18n.getMsg("crm.dumprequest.manual"),l.labelsCount=e[a].labels_count,l.status=e[a].status,n.push(l),o++}}var m=!1;return o>=25&&(m=!0),commonUtils.showHideLoadingDiv(!1),{showWelcomePage:r,showUserSegments:s,segmentsListArray:n,isSuccess:!0,disableNewRecord:m}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t,r=(t=JSON.parse(e.response)).segments;return r&&!r.segments.details.length?t={showWelcomePage:!0,showUserSegments:!1,isSuccess:!0}:t.isSucess=!1,t}))},renderTemplate:function(e){if("NOT_SUPPORTED_FEATURE"!==e.code&&"NO_PERMISSION"!==e.code)return e.segmentsListArray.length||(this.currentModel={showWelcomePage:!0,showUserSegments:!1,isSuccess:!0}),{outlet:"#result",component:"segmental-welcome"};renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},afterRender:function(){var e=this.currentModel.showUserSegments,t=$L("#setup_new_ContentDiv");e?t.css("overflow","hidden"):t.css("overflow","auto")},beforeExit:function(){$L("#setup_new_ContentDiv").css("overflow","auto");var e=$L("crm-user-segments");if(e.length){var t=e[0].component;window.removeEventListener("resize",t.applyResizeHeight)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation",{getResources:function(){var e=networkUtils.returnDependencyFiles(["segmentation-utils.js","segmentation.js","segmentation-popup.js","lyte-multislider.js"],ResourceConstants.CRMClient);return store.model.segments||(e=e.concat(networkUtils.returnDependencyFiles(["segmentation-model.js"],ResourceConstants.CRMClient))),e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["segmentation.css","segmentation-rtl.css"],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["segmentation.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")],ResourceConstants.CRM))},redirect:function(){"crm.settings.section.segmentation"===this.transition.target&&this.replaceWith("crm.settings.section.segmentation.index")},beforeExit:function(){this.removeFromCache(["segmentation-rtl.css","segmentation.css"]),store.unloadAll("segments")}}),Lyte.Router.registerRoute("crm.settings.section.settings-wildcard",{renderTemplate:function(){return{outlet:"#result",html:Handlebars.templates.HigherEditionFeatures(crmSetup.setupObject[this.transition.data.route])}},afterRender:function(){$("#overlayHeader").hide(),$("#settingInner").hide(),$("#setupshow").show(),$("#mainResult").show(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.export.start-export",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-export.js","lyte-daterangepicker.js","lyte-dateselect.js","crux-column-list.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("export"),networkUtils.getI18nJSUrl("cruxnotification")],ResourceConstants.CRM)),t=networkUtils.returnDependencyFiles(["crm-export-new.css","crux-column-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},model:function(){var e=this.transition.data.cvid,t=this.transition.data.module;return e&&t?Lyte.resolvePromises({export_modules:store.findAll("module",{feature_name:"export"},!1,!0),custom_views:store.findAll("custom_view",{module:moduleRecordMapping[t].api_name}),selectedCvField:"fieldsfromcustomview",selected_custom_view:store.findRecord("custom_view",e,{module:Crm.moduleInfo[t].apiname}),showCV:!0,privacy_preference:store.findAll("privacy_preference"),hipaa_compliance:Crm.userDetails.isHipaaFeatureEnabled?store.findAll("hipaa_compliance"):[]}).then((function(e){return e}),(function(){renderingUtils.displayPermissionDenied(),this.transition.abort()})):Lyte.resolvePromises({export_modules:store.findAll("module",{feature_name:"export"},!1,!0),privacy_preference:store.findAll("privacy_preference"),hipaa_compliance:Crm.userDetails.isHipaaFeatureEnabled?store.findAll("hipaa_compliance"):[]})},afterModel:function(e){e.export_data=store.createRecord("export");var t=[],r=Lyte.registeredMixins["crm-export-util"].getVisibleModuleForExport(e.export_modules),s=r.isOrgNotesModAvailable,n=r.visibleModules;if(e.export_modules.forEach((function(e){(e.visible||"Notes"===e.api_name||"field_tracker"===e.generated_type)&&e.viewable&&0!==e.visibility&&("team_based"===e.access_type&&Crm.userDetails.permissions["Crm_Implied_Export_Notes_"+e.module_name]&&t.push(e),"Competitors"===e.api_name||moduleRecordMapping.Forecasts&&e.api_name===moduleRecordMapping.Forecasts.api_name||moduleRecordMapping.Visits&&e.api_name===moduleRecordMapping.Visits.api_name||!e.show_as_tab||"team_based"===e.access_type||!s||!Crm.userDetails.permissions["Crm_Implied_View_"+e.module_name]||t.push(e))})),e.export_notes_modules=t,e.export_modules=[],module_permission="Crm_Implied_Export_Users",Crm.userDetails.permissions[module_permission]){var i={id:"users",plural_label:I18n.getMsg("crm.label.users"),display_plural_label:I18n.getMsg("crm.label.users")};e.export_modules.push(i)}if(!n.length||0===n.length)return renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo({route:"crm.settings.section.export.export-data"})}),null),void this.transition.abort();Lyte.arrayUtils(e.export_modules,"push",n.sort(((e,t)=>e.display_plural_label>t.display_plural_label?1:t.display_plural_label>e.display_plural_label?-1:0)));var o={query:{module:{api_name:"users"}}},a=this.transition.data.module;if(void 0!==a){var l=moduleRecordMapping[a];e.module=l.api_name,e.moduleId=l.id,e.module_name=l.plural_label,o.query.module.api_name=e.module,o.query.module.id=e.moduleId}if(void 0!==this.transition.data.cvid){if(!e.selected_custom_view)return e.unavailableCv=!0,crmHistory.fromProgBack=!0,void history.go(-1);var c=e.selected_custom_view.fields,u=c.length;c.sort(((e,t)=>e.field_label>t.field_label?1:t.field_label>e.field_label?-1:0));var d=[];for(let e=0;e<u;e++)d.push(c[e].api_name);o.query.fields=d,e.query=o.query,e.cvid={id:this.transition.data.cvid},o.query.custom_view=e.cvid}e.export_data.$.set(o)},renderTemplate:function(){return{outlet:"#result",component:"crm-export-form"}},afterRender:function(){$L("#exp_dropModuleSel")[0].cxProp("selected")&&$L("#exp_exportBut")[0].ltProp("disabled",!1)},actions:{willTransition:function(e){var t=$(".lyteAlertOpened")[0],r=$L("crm-export-form")[0];r&&((r=r.component).getData("schedule_export")||r.getData("unavailableCv")||(t?t.ltProp("show",!1):(e.pause(),Lyte.registeredMixins["crm-export-util"].showCustomAlert(e))))}}},{mixins:["crm-export-util"]}),Lyte.Router.registerRoute("crm.settings.section.storage",{queryParams:["type"],getDependencies:function(){this.transition.data.errorInEmailStorage&&(this.transition.data.errorInEmailStorage=!1,this.getQueryParams().type&&"email"!==this.getQueryParams().type||location.reload());var e=[];return e.push("datastorage-model.js"),e.push("org-model.js"),e.push("emailStorageSummary-model.js"),e.push("zworkdrive-model.js"),e.push("zworkdrive-conf-model.js"),"Administrator"!==Crm.userDetails.PROFILE_NAME&&e.push("userEmailStorage-model.js"),networkUtils.returnDependencyFiles(e,ResourceConstants.CRMClient)},getResources:function(){var e=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],t=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),r=[],s=[],n=[];r.push("datastorage.js"),s.push("storage/crm-admin-email-storage.css"),n.push(networkUtils.getI18nJSUrl("datastorage")),n.push(networkUtils.getI18nJSUrl("workdrive")),n.push(networkUtils.getI18nJSUrl("EmailStorageEmails")),"Administrator"!==Crm.userDetails.PROFILE_NAME&&(r.push("userEmailStorage.js"),s.push("storage/crm-email-user-storage.css"),n.push(networkUtils.getI18nJSUrl("EmailStorageUserwise")));var i=networkUtils.returnDependencyFiles(r,ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(s,ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles(n,ResourceConstants.CRM),c=t.concat(i).concat(o).concat(a).concat(l).concat(e);if(Crm.userDetails.RTL_ENABLED){var u=networkUtils.returnDependencyFiles(["datastorage-rtl.css"],ResourceConstants.CRMClient);c=c.concat(u)}return c},model:function(e){var t="Administrator"===Crm.userDetails.PROFILE_NAME;switch(this.getQueryParams().type){case"file":var r=store.findAll("storage_analytics"),s=store.triggerAction("storage_analytics","user_details",void 0,void 0,"GET"),n=store.findAll("workdrive-conf",{include:"configured_by,team_name,license_name"}),i=store.findAll("email_storage_summary",void 0,void 0,void 0,"configuration");return Lyte.resolvePromises({landingPage:!1,storage_details:r,show_landing_page:!1,user_details:s,workdrive:n,emailStorageSummary:i});case"email":if(t){i=store.findAll("email_storage_summary");return Lyte.resolvePromises({emailStorageSummary:i,landingPage:!0,show_landing_page:!0})}var o=Crm.userDetails.USER_ID,a=store.findRecord("sent_from_crm",o,{include_inner_details:"module_data.module.display_label,module_data.module.visible,module_data.module.viewable"},void 0,void 0,o),l=store.findRecord("mailbox_storage",o,void 0,void 0,void 0,o);return Lyte.resolvePromises({userDetails:!0,userStorageJson:a,mailClientJson:l,show_landing_page:!0,sentfromcrmLoading:!1});default:if("crm.settings.section.storage"===this.transition.target){if(Crm.userDetails.permissions.Crm_Implied_View_Storage_Usage){i=store.findAll("email_storage_summary",void 0,void 0,void 0,"configuration");var c={landingPage:!1,show_landing_page:!1,data_storage:store.findAll("data_storage"),emailStorageSummary:i};return Lyte.resolvePromises(c).then((function(e){return e}),(function(e){return e}))}o=Crm.userDetails.USER_ID;var u=store.findRecord("sent_from_crm",o,{include_inner_details:"module_data.module.display_label,module_data.module.visible,module_data.module.viewable"},void 0,void 0,o),d=store.findRecord("mailbox_storage",o,void 0,void 0,void 0,o);return Lyte.resolvePromises({userDetails:!0,userStorageJson:u,mailClientJson:d,show_landing_page:!0,sentfromcrmLoading:!1})}}},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code);var t=this;("NO_PERMISSION"===e||"INVALID_MODULE"===e||"INVALID_FORM_ID"===e||"FEATURE_NOT_ENABLED"===e||"INACTIVE_USER"===e||e.code&&("NO_PERMISSION"===e.code||"INACTIVE_USER"===e.code||"FEATURE_NOT_ENABLED"===e.code))&&(renderingUtils.displayPermissionDenied(),setTimeout((function(){e&&"FEATURE_NOT_ENABLED"===e||e.code&&"FEATURE_NOT_ENABLED"===e.code||t.getQueryParams().type&&"email"!==t.getQueryParams().type?Lyte.Router.transitionTo({route:"crm.settings.index"}):location.reload()}),2e3),this.transition&&this.transition.abort())},willTransition:function(){var e=$L("crm-storage-module-cleanup")[0];e&&e.remove();var t=$L("crm-storage-cleanup-warning")[0];t&&t.remove()},didTransition:function(){if("crm.settings.section.storage"===this.transition.target){var e=this.getQueryParams(),t=!e.type||"data"===e.type,r=this.currentModel&&this.currentModel.data_storage,s=$L("crm-email-storage-user-usage")[0],n=this.currentModel&&this.currentModel.response,i=Crm.userDetails.permissions.Crm_Implied_View_Storage_Usage;if(t)if((!i||r)&&(i||s)||n){if(n){var o=JSON.parse(this.currentModel.response);!o.code||"NO_PERMISSION"!==o.code&&"INACTIVE_USER"!==o.code&&"FEATURE_NOT_ENABLED"!==o.code||(renderingUtils.displayPermissionDenied(),setTimeout((function(){Lyte.Router.transitionTo({route:"crm.settings.index"})}),2e3),this.transition&&this.transition.abort())}}else this.refresh()}}},afterModel:function(e,t){"crm.settings.section.storage"===this.transition.target&&"Administrator"!==Crm.userDetails.PROFILE_NAME&&(this.currentModel.mailClientJson&&this.currentModel.mailClientJson[0]&&(this.currentModel.mailClientJson=this.currentModel.mailClientJson[0]),this.currentModel.userStorageJson&&this.currentModel.userStorageJson[0]&&(this.currentModel.userStorageJson=this.currentModel.userStorageJson[0])),"file_new"===t.queryParams.type&&(this.currentModel={file_storage:e})},renderTemplate:function(e,t){var r="true"===RebrandLinkUtil.properties.ENABLE_DATA_STORAGE;return this.transition.target.includes("crm.settings.section.storage.users-list")?{outlet:"#result",html:""}:r?($("#result").html(""),"file"===t.queryParams.type?(!0===store.peekAll("workdrive-conf")[0].available&&(e.newfilestorage=!0),e.user_details=e.user_details.user_details,{outlet:"#result",component:"crm-setup-storage"}):"email"===t.queryParams.type||e.data_storage&&"NO_PERMISSION"!==e.data_storage.code||e.userStorageJson?{outlet:"#result",component:"crm-setup-storage"}:void renderingUtils.displayPermissionDenied()):{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.support-access",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-support-access-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-support-access-section.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-support-access-section.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("supportaccess")],ResourceConstants.CRM))},actions:{onError:function(e,t){Lyte.Router.getRouteInstance().transition.abort();var r=JSON.parse(e.responseText);500===e.status&&(commonUtils.showHideLoadingDiv(!1),_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("error.unknown.problem")}}),t.resume()),"permission denied"!==r.message&&"permission denied"!==r.data||renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){Lyte.Router.transitionTo("crm.settings.index")}))}},model:function(){return store.triggerAction("support_access","support_user_access",void 0,{},"GET").then((function(e){if(null!==e&&void 0!==e.support_user_access.date&&"null"!==e.support_user_access.date){var t=e.support_user_access.date,r=e.support_user_access.enabled_time_zone,s=Crm.userDetails.DATE_PATTERN.replace(/'/g,"").toUpperCase(),n=$L.moment(t,"YYYY-MM-DD").i18N(s);return commonUtils.showHideLoadingDiv(!1),{dateSelected:n,preivousDateSelected:n,timezone:r,showForm:!1,isRevoke:!1,showClose:!0}}}))},renderTemplate:function(){return{outlet:"#result",component:"crm-support-access-section"}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.tab-groups",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomizeTabGroup.do","GET",{params:{action:"tabGroupList"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},redirect:function(){featuresAvailable.TEAMSPACE_ENABLED&&this.replaceWith("crm.settings.section.teamspace")}}),Lyte.Router.registerRoute("crm.settings.section.teamspace.create",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-teamspace-builder.js","crm-teamspace-builder-helper.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-combo-box.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-teamspace-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Teamspace||(Lyte.Router.getRouteInstance().transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){app.prevTransition.route||Lyte.Router.replaceWith("crm.settings.index")})),this.transition.abort())},model:function(){var e=store.findAll("module"),t=store.findAll("team_space",{type:"admin"});return Lyte.resolvePromises({modules:e,adminTeamspace:t})},renderTemplate:function(e){return{outlet:"#result",component:"crm-teamspace-builder",data:e}},actions:{willTransition:function(e){var t=$L("crm-teamspace-builder")[0];if((t=t?t.component:null)&&!t.getData("isTSBuilderSaveOrCancelClicked")&&!0===e.info.route.includes("settings")){var r=e.pause();t.getData("disableSaveButton")?r.resume():_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.template.editor.savebeforeclose.msg.head"),ltPropSecondaryMessage:I18n.getMsg("crm.template.editor.save.msg.warn"),ltPropButtons:[{type:"reject",appearance:"default",text:I18n.getMsg("crm.label.no"),cxPropZcqa:"button_2"},{type:"accept",appearance:"default",text:I18n.getMsg("crm.label.yes"),cxPropZcqa:"button_1",appearance:"primary"}]},accept:function(){r.resume()},reject:function(){_cruxUtils.removeCustomAlert(),r.abort(),commonUtils.showHideLoadingDiv()}})}}}}),Lyte.Router.registerRoute("crm.settings.section.teamspace.edit",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-teamspace-builder.js","crm-teamspace-builder-helper.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-combo-box.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-teamspace-builder.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["gapps/crm-invalid-url.css","gapps/crm-invalid-url.js"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=store.findAll("module",{include:"team_spaces"});return Lyte.resolvePromises({teamspace:store.findRecord("team_space",this.getDynamicParam(),{include:"access_type,accessible_by",include_inner_details:"admin.zuid"}),modules:e})},afterModel:function(e){e.teamspace=e.teamspace[0],!Crm.userDetails.permissions.Crm_Implied_Manage_Teamspace&&e.teamspace&&e.teamspace.admin.id!==Crm.userDetails.USER_ID&&(renderingUtils.displayPermissionDenied(null,null,null,null,null,(function(){app.prevTransition.route||Lyte.Router.replaceWith("crm.settings.index")})),this.transition.abort())},renderTemplate:function(e){return e.teamspace?{outlet:"#result",component:"crm-teamspace-builder",data:e}:($("#leftMainMenuDiv").hide(),{outlet:"#show",component:"crm-invalid-url"})},actions:{willTransition:function(e){var t=$L("crm-teamspace-builder")[0];if((t=t?t.component:null)&&!t.getData("isTSBuilderSaveOrCancelClicked")&&!0===e.info.route.includes("settings")){var r=e.pause();t.getData("disableSaveButton")?r.resume():_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.template.editor.savebeforeclose.msg.head"),ltPropSecondaryMessage:I18n.getMsg("crm.template.editor.save.msg.warn"),ltPropButtons:[{type:"reject",appearance:"default",text:I18n.getMsg("crm.label.no"),cxPropZcqa:"button_2"},{type:"accept",appearance:"default",text:I18n.getMsg("crm.label.yes"),cxPropZcqa:"button_1",appearance:"primary"}]},accept:function(){r.resume()},reject:function(){_cruxUtils.removeCustomAlert(),r.abort(),commonUtils.showHideLoadingDiv()}})}}}}),Lyte.Router.registerRoute("crm.settings.section.teamspace.index",{lyteConvertionSupported:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-teamspace.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-teamspace.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=store.findAll("team_space",{type:"admin",include_inner_details:"created_by.zuid,modified_by.zuid,admin.zuid"}),t=store.triggerAction("team_space","accessible_by_count");return Lyte.resolvePromises({teamspace:e,teamspace_accessible_by_count_res:t})},afterModel:function(e){Crm.userDetails.permissions.Crm_Implied_Manage_Teamspace||0!==e.teamspace.length||(Lyte.Router.getRouteInstance().transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,void 0,void 0,(function(){Lyte.Router.replaceWith("crm.settings.index")})))},renderTemplate:function(){return{outlet:"#result",component:"crm-teamspace"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-teamspace.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))}}),Lyte.Router.registerRoute("crm.settings.section.teamspace",{lyteConvertionSupported:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-teamspace-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-teamspace-helper.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM))},beforeModel:function(){featuresAvailable.TEAMSPACE_ENABLED_FOR_ORG&&featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED||(Lyte.Router.getRouteInstance().transition.abort(),renderingUtils.displayPermissionDenied(null,null,null,void 0,void 0,(function(){Lyte.Router.replaceWith("crm.settings.index")})))},redirect:function(){"crm.settings.section.teamspace"===this.transition.target&&this.replaceWith("crm.settings.section.teamspace.index")},beforeExit:function(){var e=$L("crm-left-menu-teamspace")[0];e&&e.component.methods.refreshTeamspace(!0)},actions:{onError:function(e){Lyte.Router.getRouteInstance().transition.abort(),"NO_PERMISSION"!==JSON.parse(e.responseText).code||renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.settings.section.telephony.configuration",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){if(this.parent.getProviderNameFromURIName(e.dynamicParam)!=t.$.get("providerName")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}}else this.replaceWith("crm.settings.section.telephony.marketplace")},model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={params:{mode:"telephony",ctiname:t.$.get("providerName")}};return networkUtils.lyteInitiateRequest(r,"GET",s)},afterModel:function(e,t){if(e.isZticonfigured)this.currentModel=Handlebars.templates.ctiapi_provider_login_page(e);else if("object"==typeof e&&"providerEnabled"!=e.view&&!e.isZticonfigured){store.peekAll("provider_conf")[0].$.set("isEnabled",!1),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.telephony.marketplace")}},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_provider_detail_page(e):e}},afterRender:function(e){var t=store.peekAll("provider_conf")[0];if("PBX"==t.$.get("phoneViewType")){var r=this.transition.info.queryParams?this.transition.info.queryParams.from:null;ctiApiConfig.showPBXProviderDetails(t.$.get("providerName"),r)}$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()},actions:{changeToDisableView:function(){store.peekAll("provider_conf")[0].$.set("isEnabled",!1),ctiApiConfig.providerListData=null,Crm.isHeadless?CTIAPI.IFrame.backToProviderList():Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.telephony.marketplace")},willTransition:function(e){var t=store.peekAll("provider_conf")[0],r=e.pause();!t.$.get("isEnabled")||"crm.settings.section.telephony.marketplace"!==e.target&&"crm.settings.section.telephony.summary"!==e.target?r.resume():(r.abort(),this.transitionTo("crm.settings.index"))}},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.marketplace",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r)}Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("Telephony")},model:function(){if(Crm.userDetails.ZPBENABLED&&window.PB)return"";var e=ctiApiConfig.providerListData;if(validationUtils.isEmpty(e)){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={params:{mode:"telephony"}};return networkUtils.lyteInitiateRequest(t,"GET",r)}return e},afterModel:function(e,t){if("object"==typeof e)if("providerList"===e.view)ctiApiConfig.setProviderData(e);else if("providerEnabled"===e.view){var r=this.parent.getURINameFromProviderName(e.provider);this.replaceWith("crm.settings.section.telephony.configuration",r)}else"singleProvider"===e.view&&this.replaceWith("crm.settings.section.telephony.summary",e.providerName)},renderTemplate:function(e,t){if(!Crm.userDetails.ZPBENABLED)return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_providers_list(ctiApiConfig.providerListData):e};if(window.PB&&CTIAPI.zpbCallback.isloaded){var r=renderingUtils.windowHeight-$("#setup_new_ContentDiv").offset().top-26;$("#result").empty();var s=PB.loadSetup(r);document.getElementById("result").appendChild(s)}else CTIAPI.zpbCallback.listeners.push((function(){if("crm.settings.section.telephony.marketplace"===Lyte.Router.getRouteInstance().transition.info.route){var e=renderingUtils.windowHeight-$("#setup_new_ContentDiv").offset().top-26;$("#result").empty();var t=PB.loadSetup(e);document.getElementById("result").appendChild(t)}}))},afterRender:function(){$L("#result,#setupSpace").addClass("helpOverflowHide"),commonUtils.showHideLoadingDiv();var e=store.peekAll("provider_conf")[0];if(validationUtils.isNotEmpty(e.$.get("providerName"))){var t=e.$.get("providerName");t=(t=t.replace(".","\\.")).replace(/\s/g,"\\ "),$L("html, body").scrollTop($("#"+t).offset().top)}Crm.trackSpotLightAction("Telephony Clicked")},actions:{willTransition:function(){closeAsapWidget(),$L("#result,#setupSpace").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.createpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/ZTIConfig.do",s={event:"showGroup",pbxtype:t.$.get("providerName")};Crm.isHeadless&&(s.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(s);var n={params:s};return networkUtils.lyteInitiateRequest(r,"POST",n)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.editpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){store.peekAll("provider_conf")[0];var t=Crm.getCrmBasePath()+"/ZTIConfig.do",r={event:"editGroup",groupid:e.dynamicParam};Crm.isHeadless&&(r.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(r);var s={params:r};return networkUtils.lyteInitiateRequest(t,"POST",s)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.viewpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){store.peekAll("provider_conf")[0];var t=Crm.getCrmBasePath()+"/ZTIConfig.do",r={event:"detailView",groupid:e.dynamicParam};Crm.isHeadless&&(r.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(r);var s={params:r};return networkUtils.lyteInitiateRequest(t,"POST",s)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")&&"PBX"!=t.$.get("phoneViewType")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}else if(t.$.get("isEnabled")&&this.parent.getProviderNameFromURIName(e.dynamicParam)!=t.$.get("providerName")){r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.phonebridgegroup",r,e.queryParams)}else{var s=this.parent.getProviderNameFromURIName(e.dynamicParam);t.$.set("providerName",s)}},model:function(){return""},renderTemplate:function(e,t){return{outlet:"#result",html:"<div id='pbxGroup'></div>"}},actions:{changeToEnableView:function(e){var t=store.peekAll("provider_conf")[0];t.$.set("isEnabled",!0),t.$.set("providerName",e);var r=Lyte.Router.getRouteInstance().parent.getURINameFromProviderName(e);Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.telephony.configuration",r,Lyte.Router.getRouteInstance().getQueryParams())}}}),Lyte.Router.registerRoute("crm.settings.section.notificationsms.index-notificationsms",{getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SMSSetup")],ResourceConstants.CRM)},model:function(){return notificationSMS.getChannel()},renderTemplate:function(){window.SMS&&notificationSMS.loadSetup()}}),Lyte.Router.registerRoute("crm.settings.section.notificationsms",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_notificationsms_setup.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-msg-setup-store.js"],ResourceConstants.CRMClient);return e.concat(t)},redirect:function(){if(featuresAvailable.NEXTGENUI_ENABLED&&window.SMS){var e=$L("crm-left-menu")[0];if(e=e?e.component:null){var t=e.getData("dataMode");window.SMS.darkmode="dark"===t}}if("crm.settings.section.notificationsms"===this.transition.target){var r=Object.assign({},this.transition.info);r.route="crm.settings.section.notificationsms.index-notificationsms",this.replaceWith(r)}},beforeExit:function(){"undefined"!=typeof SMS&&SMS&&($("#result").removeClass("helpOverflowHide"),SMS.UTILS.removeSDKFrame(),SMS.UTILS.removeSetupFrame())}}),Lyte.Router.registerRoute("crm.settings.section.telephony.summary",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}else validationUtils.isEmpty(e.dynamicParam)&&this.replaceWith("crm.settings.section.telephony.marketplace")},model:function(e){var t=this.parent.getProviderNameFromURIName(e.dynamicParam);if(store.peekAll("provider_conf")[0].$.set("providerName",t),validationUtils.isEmpty(ctiApiConfig.providerListData)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={params:{mode:"telephony",ctiname:t}};return networkUtils.lyteInitiateRequest(r,"GET",s)}return ctiApiConfig.allProviderInfo[t]},afterModel:function(e,t){"object"==typeof e&&(e.provider=e.providerName,e.detailObj&&(e.detailObj.provider=e.provider,e.detailObj.type=e.type))},renderTemplate:function(e,t){var r="";return"object"!=typeof e?r=e:e.detailObj?r=Handlebars.templates.ctiapi_provider_detail_page(e.detailObj):(Handlebars.registerPartial("twilioDetailView",Handlebars.templates.twilio_detailview),r=Handlebars.templates.ctiapi_provider_login_page(e)),{outlet:"#result",html:r}},afterRender:function(e,t){if("object"==typeof e&&!e.detailObj)switch(e.type){case"type2":ctiApiConfig.showType2ProviderDetails(e.provider,e.displayName);break;case"phonebridge":ctiApiConfig.showPBXProviderDetails(e.provider)}$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv(),$L("html, body").scrollTop(0,0)},actions:{changeToEnableView:function(e){var t=store.peekAll("provider_conf")[0];t.$.set("isEnabled",!0),t.$.set("providerName",e);var r=Lyte.Router.getRouteInstance().parent.getURINameFromProviderName(e);Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.telephony.configuration",r,Lyte.Router.getRouteInstance().getQueryParams())}}}),Lyte.Router.registerRoute("crm.settings.section.telephony",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-provider-conf.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_phonebridge_home.js"],ResourceConstants.CRM)},model:function(){if(store.peekAll("provider_conf").length<=0){var e=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={params:{mode:"telephonyConfigDetails"}};return networkUtils.lyteInitiateRequest(e,"GET",t)}return null},afterModel:function(e){e&&"object"==typeof e&&store.createRecord("provider_conf",e)},beforeExit:function(){store.peekAll("provider_conf")[0].$.deleteRecord(),ctiApiConfig.providerListData=null},redirect:function(e){if(featuresAvailable.NEXTGENUI_ENABLED&&window.PB){var t=$L("crm-left-menu")[0];if(t=t?t.component:null){var r=t.getData("dataMode");window.PB.darkmode="dark"===r}}var s=store.peekAll("provider_conf")[0];"2"==s.$.get("providerType")&&this.replaceWith("crm.settings.section.widget-telephony.marketplace"),this.transition.target.endsWith("telephony")&&(s.$.get("isEnabled")?this.replaceWith("crm.settings.section.telephony.configuration",this.getURINameFromProviderName(s.$.get("providerName"))):e&&"object"==typeof e&&"singleProvider"===e.view?this.replaceWith("crm.settings.section.telephony.summary",e.providerName):this.replaceWith("crm.settings.section.telephony.marketplace"))},getProviderNameFromURIName:function(e){return e=(e=e.replace(/__/g," ")).replace(/_at_/g,"@")},getURINameFromProviderName:function(e){return e=(e=e.replace(/\s/g,"__")).replace(/@/g,"_at_")}}),Lyte.Router.registerRoute("crm.settings.section.territories.create-territory",{queryParams:["parentId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-territory-search-and-config.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createTerritory")],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM)),[networkUtils.returnDependencyFiles(["crm-create-edit-territory.js","lyte-tree.js","lyte-hovercard.js","crm-territories.js","crm-territory-helper.js","crm-territory-utils.js","crm-territory-crux-components.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient)].concat(e)},beforeModel:function(){return Lyte.injectResources(this.loadNeededResourcesForCreatePage()),this.loadBeforeModelPromises()},model:function(e){if(1===Crm.userDetails.TMENABLED)return Lyte.resolvePromises(this.getBasicTerritoryPromises())},afterModel:function(e){if(1===Crm.userDetails.TMENABLED)return this.getBasicTerritoryDatas(e)},renderTemplate:function(e,t){return{outlet:"#result",component:1===Crm.userDetails.TMENABLED?"crm-create-territories":"crm-territories-get-started",reRender:!0}},actions:{onError:function(){Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.access.territory.deleted",I18n.getMsg("crm.territory.access")),ltPropType:"error"}})}}},{mixins:["crm-territory-utils","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.territories.edit-territory",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-territory-search-and-config.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createTerritory")],ResourceConstants.CRM);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM)),[networkUtils.returnDependencyFiles(["crm-create-edit-territory.js","lyte-hovercard.js","lyte-tree.js","crm-territory-helper.js","crm-territories.js","crm-territory-crux-components.js","crm-territory-utils.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient)].concat(e)},beforeModel:function(){return Lyte.injectResources(this.loadNeededResourcesForCreatePage()),this.loadTerritory(this.getDynamicParam())},model:function(e){if(1===Crm.userDetails.TMENABLED)return Lyte.resolvePromises(this.getBasicTerritoryPromises(!0));2===Crm.userDetails.TMENABLED&&(Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),ltPropType:"error"}}))},afterModel:function(e){if(1===Crm.userDetails.TMENABLED){var t=store.peekAll("territory"),r=t.filter((e=>void 0===e.reporting_to||null===e.reporting_to))[0].id,s=this,n=s.getDynamicParam(),i={};if(n){var o=t.filter((e=>n===e.id))[0];o?delete(i=Lyte.deepCopyObject(o)).children:(Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.access.territory.deleted",I18n.getMsg("crm.territory.access")),ltPropType:"error"}}))}if(r===n)return s.currentModel={fromPage:"edit",territories:i,orgTerritoryId:r};var a={fromEditPage:!0,needTerrUsersAPI:!0};return a.editedTerritory=i,s.getBasicTerritoryDatas(e,void 0,!1,a)}},renderTemplate:function(){return{outlet:"#result",component:1===Crm.userDetails.TMENABLED?"crm-create-territories":"crm-territories-get-started",reRender:!0}},actions:{onError:function(e){var t=JSON.parse(e.response);"TERRITORY_DISABLED"===t.code||"FEATURE_NOT_ENABLED"===t.code?this.unloadTerritoriesConfiguration():(Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.access.territory.deleted",I18n.getMsg("crm.territory.access")),ltPropType:"error"}}))}}},{mixins:["crm-territory-utils"]}),Lyte.Router.registerRoute("crm.settings.section.territories.index-territories",{getDependencies:function(){return[networkUtils.returnDependencyFiles(["crm-territories.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)]},getResources:function(){var e=[networkUtils.returnDependencyFiles(["lyte-tree.js","org-model.js","crm-territories.js"],ResourceConstants.CRMClient)];return e=e.concat(networkUtils.returnDependencyFiles(["crux-territory.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){return this.transition.data&&"onError"===this.transition.data.from?"":this.resolveBeforeModelPromises(!1,!0)},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=this,r=this.$lg,s=store.peekAll("territory_configuration"),n=s[0]?s[0].territory_management_enabled:void 0;return 1!==Crm.userDetails.TMENABLED&&n?(Crm.userDetails.TMENABLED=1,this.resolveBeforeModelPromises(!1,!0)):(0!==Crm.userDetails.TMENABLED||void 0!==r.territory_role_migration_status||this.transition.data&&"onError"===this.transition.data.from||store.findAll("territory_configuration",{},{},!0,{version:"v5",method:"GET"}).then((function(){r.territory_role_migration_status=void 0}),(function(e){if("TERRITORY_NOT_ENABLED"===JSON.parse(e.response).code){var s=JSON.parse(e.response).details;s&&"IN_PROGRESS"===s.status&&(r.territory_role_migration_status=s.status,t.getTerritoryMigrationStatus($L("crm-territories-get-started")[0]))}})),"")},afterModel:function(){if(1===Crm.userDetails.TMENABLED){var e=store.peekAll("territory"),t=this.transition.data,r=e.filter((e=>void 0===e.reporting_to||null===e.reporting_to))[0],s="Administrator"===Crm.userDetails.PROFILE_NAME?[].concat(r):this.constructChildrenNodeToOrgTerritory(e),n=this.getCurrentUserManagedTerritories(e,!0);s[0]&&s[0].children&&s[0].children.sort((function(e,t){return e.id>t.id?1:-1})),this.currentModel={orgTerrId:r.id,orgTerrWithChild:s,orgTerrWithChildForDelete:objectUtils.deepClone(s,[],[],!0),fstLvlManagedTerritories:this.getFirstLevelManagedTerritories(s),userParticipatedTerritories:this.getCurrentUseparticipatedTerritories(e),managedTerritories:n,editedTerrName:t?t.editedTerrName:void 0,accRuleChanged:!!t&&t.accRuleChanged,leadRuleChanged:!!t&&t.leadRuleChanged,dealRuleChanged:!!t&&t.dealRuleChanged},this.canAssignTerritory(n)||this.showOrHideTerritoryRulesTab(!1),this.showOrHideTerritoryTab(!0)}},renderTemplate:function(e,t){return{outlet:"#result",component:1===Crm.userDetails.TMENABLED?"crm-territory-hierarchy":"crm-territories-get-started",reRender:!0}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.territory.hierarchy"),Crm.partnerName]))},didDestroy:function(){_cruxUtils.removeCustomAlert()},actions:{onError:function(e){var t=JSON.parse(e.response);"TERRITORY_DISABLED"===t.code||"FEATURE_NOT_ENABLED"===t.code?this.unloadTerritoriesConfiguration():"TERRITORY_NOT_ENABLED"===t.code&&(this.transition.abort(),t.details&&"IN_PROGRESS"===t.details.status&&(this.$lg.territory_role_migration_status=t.details.status),Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}).data={from:"onError"})}}},{mixins:["crm-territory-utils","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.territories",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-territory-search-and-config.js","crm-territory-utils.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-territories.js","crm-userlookup-wrapper-component.js","crm-territory-crux-components.js","crm-territory-utils.js","crm-territory-common-utils.js","crm-territory-helper.js"],ResourceConstants.CRMClient);e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM));var t=networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.css"],ResourceConstants.CRMClient);return e.concat(t)},redirect:function(){"crm.settings.section.territories"===this.transition.target&&this.replaceWith("crm.settings.section.territories.index-territories")},beforeExit:function(){app.refetchModulesMeta=!0,store.model.associated_users_count&&store.unloadAll("associated_users_count")}}),Lyte.Component.registerHelper("getTerritorityValue",(function(e){var t=[];return e?(e.forEach((function(e){t.push(e.Name)})),t.join(", ")):""})),Lyte.Router.registerRoute("crm.settings.section.territory-assign",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-assign-territories.js","crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js","lyte-tree.js","crm-territory-search-and-config.js","crm-territory-utils.js","crm-territory-common-utils.js","crm-territory-crux-components.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM);return r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM)),t=t.concat(networkUtils.returnDependencyFiles(["crux-customview-dropdown.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t).concat(r).concat(networkUtils.returnDependencyFiles(["crm-assign-territories.css","crux-territory.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){if(2!==Crm.userDetails.TMENABLED)return this.resolveBeforeModelPromises();Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),ltPropType:"error"}})},model:function(){if(1===Crm.userDetails.TMENABLED){if(this.checkIsModulesAvailableForAssignPage(store.peekAll("territory_configuration"))||(Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),this.showHideAssignTab(!1),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.permission.denied.territory.module"),ltPropType:"error"}})),this.canAssignTerritory())return Lyte.resolvePromises(this.getBasicTerritoryPromises(this.transition.data?this.transition.data.module:void 0));Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"})}},afterModel:function(e){var t=this.transition.data;return this.getBasicTerritoryDatas(e,t?t.module:void 0,!!t&&t.isFindAndRun)},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-assign-territories",reRender:!0}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.assign.territories"),Crm.partnerName]))},actions:{onError:function(e){var t=e.response?JSON.parse(e.response):void 0;void 0===t||"TERRITORY_DISABLED"!==t.code&&"FEATURE_NOT_ENABLED"!==t.code?void 0!==t&&"NO_PERMISSION"===t.code&&-1!==t.message.indexOf("permission denied")&&(Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.permission.denied.territory.module")+I18n.getMsg("crm.refresh.page"),ltPropType:"error"}})):this.unloadTerritoriesConfiguration()}},didDestroy:function(){_cruxUtils.removeCustomAlert()}},{mixins:["crm-territory-utils","crm-view-utils","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.territory-rules",{getDependencies:function(){return[networkUtils.returnDependencyFiles(["crm-territory-utils.js"],ResourceConstants.CRMClient)]},getResources:function(){var e=[networkUtils.returnDependencyFiles(["crm-territory-rules.js","lyte-tree.js","crm-territory-search-and-config.js","crm-territory-common-utils.js","crm-territory-crux-components.js"],ResourceConstants.CRMClient)];e=e.concat(networkUtils.returnDependencyFiles(["crm-territory-rules.css","crux-territory.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Territory")],ResourceConstants.CRM);return t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM)),e=e.concat(t)},beforeModel:function(){if(commonUtils.showHideLoadingDiv(!0),2!==Crm.userDetails.TMENABLED)return this.resolveBeforeModelPromises(!0);Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),ltPropType:"error"}})},model:function(e){switch(Crm.userDetails.TMENABLED){case 1:if(this.canAssignTerritory())return Lyte.resolvePromises(this.getBasicTerritoryPromises());Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"});break;case 2:Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"}),_cruxUtils.showMsgBox(I18n.getMsg("crm.territory.alert.territorymanagement.disabled"),"error");break;case 0:Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"})}},afterModel:function(e){return this.getBasicTerritoryDatas(e)},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-territory-rules",reRender:!0}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.view.rules"),Crm.partnerName]))},actions:{onError:function(e){var t=JSON.parse(e.response);"TERRITORY_DISABLED"!==t.code&&"FEATURE_NOT_ENABLED"!==t.code||this.unloadTerritoriesConfiguration()}},didDestroy:function(){_cruxUtils.removeCustomAlert()}},{mixins:["crm-territory-utils","crm-territory-common-utils"]}),Lyte.Router.registerRoute("crm.settings.section.translation-history",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-translation.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-translation-history.js","crm-page-navigator.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-page-navigator.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-translation-history.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Translation")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zohocrm_translationbench.js"],ResourceConstants.CRM))},model:function(e){return{translationHistory:store.triggerAction("translation","history",{},{page:1,per_page:200},"GET")}},renderTemplate:function(){return{outlet:"#result",component:"crm-translation-history",reRender:!0}},actions:{onError:function(e,t,r){var s=JSON.parse(e.responseText);return s.code.indexOf("NOT_SUPPORTED_FEATURE")>-1?(Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.validation.rule.edition.not.support"))):s.code.indexOf("NO_PERMISSION")>-1&&(Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))),Lyte.Router.getRouteInstance().replaceWith("crm.settings.index"),!1}},didDestroy:function(){_cruxUtils.removeCustomAlert()}}),Lyte.Router.registerRoute("crm.settings.section.translation-settings",{getResources:function(){return networkUtils.returnDependencyFiles(["lyte-fileupload.js","crm-translation-settings.js","lyte-hovercard.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-translation-settings.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Translation")],ResourceConstants.CRM))},model:function(){return{translationDetails:store.findAll("translation")}},renderTemplate:function(){return{outlet:"#result",component:"crm-translation-settings",reRender:!0}},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-translation.js"],ResourceConstants.CRMClient)},actions:{onError:function(e,t,r){var s=JSON.parse(e.responseText);return s.code.indexOf("NOT_SUPPORTED_FEATURE")>-1?(Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.validation.rule.edition.not.support"))):s.code.indexOf("NO_PERMISSION")>-1&&(Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))),Lyte.Router.getRouteInstance().replaceWith("crm.settings.index"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-form",{beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Unsubscribe_Form||(renderingUtils.displayPermissionDenied(),this.transition&&this.transition.abort())},model:function(){var e={params:{pageTitle:"crm.unsubscription.form",step:"unsubscribe",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Template.do","POST",e)},renderTemplate:function(e){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-link.create-unsubscribe-link",{model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/unsubscribelink.do","POST",{params:{step:"limitCheck",isAjax:!0}})},renderTemplate:function(e){return e.check?{outlet:"#unsubFormDetails",html:Handlebars.templates.UnsubscribeFormDetails()}:{outlet:"#limitWarning",html:I18n.getMsg("crm.unsubscription.limit.warning",[e.maxLimit,e.editionName])}},afterRender:function(e){"block"===$("#unSubscribe_callOut").css("display")?(renderingUtils.freezeBackground(),$("#unSubscribe_callOutHide").attr("onclick","unsubscription.showUnsubscribeFormDetails("+JSON.stringify(e)+");")):unsubscription.showUnsubscribeFormDetails(e),Crm.client_tracking("Unsubscribe Link - New Unsubscribe Link Click")}}),Lyte.Router.registerRoute("crm.settings.section.storage.users-list.user-emailstorage",{queryParams:["id","user_filter"],model:function(){if("crm.settings.section.storage.users-list.user-emailstorage"===this.transition.target){var e=this.getQueryParams().id,t=this.getQueryParams().user_filter,r=store.findRecord("sent_from_crm",e,{include_inner_details:"module_data.module.display_label,module_data.module.visible,module_data.module.viewable"},void 0,void 0,e),s=store.findRecord("mailbox_storage",e,void 0,void 0,void 0,e);return Lyte.resolvePromises({mailClientJson:s,userStorageJson:r,userFilter:t,userId:e,landingPage:!1,userDetails:!0,userEmailList:!1,show_landing_page:!0,sentfromcrmLoading:!1,emailsLoading:!1})}},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){!e||"NO_PERMISSION"!==e.code&&"INACTIVE_USER"!==e.code||(setTimeout((function(){renderingUtils.displayPermissionDenied(),Lyte.Router.transitionTo({route:"crm.settings.section.storage",queryParams:{type:"email"}}).data={errorInEmailStorage:!0}}),0),this.transition&&this.transition.abort())}},afterModel:function(){"crm.settings.section.storage.users-list.user-emailstorage"===this.transition.target&&(this.currentModel.mailClientJson&&this.currentModel.mailClientJson[0]&&(this.currentModel.mailClientJson=this.currentModel.mailClientJson[0]),this.currentModel.userStorageJson&&this.currentModel.userStorageJson[0]&&(this.currentModel.userStorageJson=this.currentModel.userStorageJson[0]))},renderTemplate:function(){if("crm.settings.section.storage.users-list.user-emailstorage"===this.transition.target){if("Administrator"===Crm.userDetails.PROFILE_NAME){var e=$L("crm-email-storage-users-list")[0];return e&&!0===e.component.getData("userUsageRightLoading")&&e.component.setData("userUsageRightLoading",!1),{outlet:"#user-emaildetails",component:"crm-email-storage-user-usage",reRender:"true"}}return{outlet:"#result",component:"crm-setup-storage"}}}}),Lyte.Router.registerRoute("crm.settings.section.users.view",{queryParams:["type"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.js","crm-userdelete-notification.js","assignment_threshold_model.js","crux-user-view.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.css","crux-user-view.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("transferanddeleteuser"),networkUtils.getI18nJSUrl("ImageUpload")],ResourceConstants.CRM),s=t.concat(e).concat(r);if(featuresAvailable.TEAMSPACE_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-teamspace-user-details.js"],ResourceConstants.CRMClient);n=n.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM)),s=s.concat(n)}return s},model:function(e){var t=this.getDynamicParam(),r={params:{actionName:"viewUser",userId:t,frmAllUsersPage:!0}};if(void 0!==t)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Security.do","GET",r)},renderTemplate:function(e,t){return $("#overlayHeader").hide(),$("#viewalluserstd").attr("width","40%"),$("#viewalluserstd").attr("vertical-align","top"),{outlet:"#viewUserFrmAllUsers",html:e}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.userDetails"),Crm.appName]));var t=$("#viewUserFrmAllUsers");$("#viewUserFrmAllUserstd").show(),t.find("#userDetailView").removeClass("user-pers-details").addClass("user-all-details"),showOrHideUserDetail(t),setPerfectScrollBarUserDetails(),$("#tbl_user_data tr").removeClass("selectedRightActivity"),$("table#tbl_user_data tr#row_u_"+this.getDynamicParam()).addClass("selectedRightActivity")}}),Lyte.Router.registerRoute("crm.settings.section.storage.users-list",{queryParams:["id","user_filter"],getDependencies:function(){return networkUtils.returnDependencyFiles(["userEmailStorage-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["userEmailStorage.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["storage/crm-email-user-storage.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailStorageUserwise")],ResourceConstants.CRM);return e.concat(t).concat(r)},model:function(){if("crm.settings.section.storage.users-list.user-emailstorage"===this.transition.target&&!$L("crm-email-storage-users-list")[0]){var e,t=this.getQueryParams().id,r=this.getQueryParams().mailboxType;return"Administrator"===Crm.userDetails.PROFILE_NAME&&(e=this.getQueryParams().user_filter),Lyte.resolvePromises({userId:t,landingPage:!1,userDetails:!0,userEmailList:!1,userFilter:e,show_landing_page:!0,emailsLoading:!1,type:r,usageDetailsloader:!1})}},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),location.reload()}),0),this.transition&&this.transition.abort())}},didDestroy:function(){var e=this.getQueryParams().user_filter;e&&"{}"!==e&&store.unloadAll("userwise_email_storage")},renderTemplate:function(){if("crm.settings.section.storage.users-list.user-emailstorage"===this.transition.target&&!$L("crm-email-storage-users-list")[0])return{outlet:"#result",component:"crm-setup-storage"}}}),Lyte.Router.registerRoute("crm.settings.section.users",{queryParams:["type","reqZUID","requestUID"],beforeModel:function(e){},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-shortcut.js","crm-user-setup.js","crm-user-edit-popup.js","modal-scroll-box-shadow.js","lyte-tree.js","lyte-hovercard.js","org-model.js","crm-users-bcc-dropbox-mixin.js","crm-uploadfields-mixin.js","crm-detail-view-utils.js"],ResourceConstants.CRMClient),t=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],r=networkUtils.returnDependencyFiles(["crm-user-setup.css","crm-users-reinvite.css","crux-file-upload-component.css","crm-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("UserSetup"),networkUtils.getI18nJSUrl("ReportingToPopup")],ResourceConstants.CRM);return e.concat(r).concat(s).concat(Crm.returnPhoneFieldDependencyFiles()).concat(t)},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=e.queryParams;if(null!=t.type){var r={params:{actionName:t.type}};return this.transition.data&&this.transition.data.territoryId&&(r.params.territoryId=this.transition.data.territoryId),(s=this.transition.info.dynamicParams).length>0&&(r.params.requestUID=s[0]),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Security.do","GET",r)}r={params:{actionName:"viewAllUsers"}};var s=this.transition.info.dynamicParams;return this.transition.data&&this.transition.data.territoryId&&(r.params.territoryId=this.transition.data.territoryId),t.reqZUID&&(r.params.reqZUID=t.reqZUID),s.length>0&&(r.params.requestUID=s[0]),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowAllUsers.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.usersList"),Crm.partnerName])),"undefined"!=typeof isNeedChangeUID&&1==isNeedChangeUID){var t=Lyte.Router.getRouteInstance();usersArray.length>0?t.transitionTo({route:"crm.settings.section.users.view",dynamicParams:[usersArray[0].userID],queryParams:{type:t.getQueryParams().type}}):t.transitionTo({route:"crm.settings.section.users.view",queryParams:{type:t.getQueryParams().type}})}setuserlistCV(),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_USERS").PF_ACCESSED_USERS,RebrandLinkUtil.getProperties("PF_ACCESSED_USERS_ID").PF_ACCESSED_USERS_ID)},actions:{willTransition:function(e){closeAsapWidget(),_cruxUtils.removeCustomAlert()},didTransition:function(){if("crm.settings.section.users"==this.transition.target){if(null==this.getQueryParams().type||"ActiveUsers"==this.getQueryParams().type)this.getQueryParams().type?this.replaceWith("crm.settings.section.users.view",Crm.userDetails.USER_ID,{type:this.getQueryParams().type}):this.replaceWith("crm.settings.section.users.view",Crm.userDetails.USER_ID);else if($("#userlistview").find("tr.userlisttd").length>0){var e=$($("#userlistview").find("tr.userlisttd")[0]).attr("id").split("row_u_")[1];this.getQueryParams().type?this.replaceWith("crm.settings.section.users.view",e,{type:this.getQueryParams().type}):this.replaceWith("crm.settings.section.users.view",e)}var t=$L("#importUsers");if(t.length){var r=$L("#UsersMenuListDiv").closest("table").outerWidth()-90-($L("#adduserbutton").outerWidth()+t.outerWidth());r<=230&&$L("#userlistCV").css({"min-width":r-35+"px","max-width":r+"px"})}}}}}),Lyte.Router.registerRoute("crm.settings.section.review-usage.view-review-usage",{queryParams:["component_id","component_name"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-reviewprocess-chart.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);return t=Crm.userDetails.RTL_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-usagecomponent-rtl.css","crm-reviewprocess-usagecomponent.css"],ResourceConstants.CRMClient)):t.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-usagecomponent.css"],ResourceConstants.CRMClient)),e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["Analytics.js"],ResourceConstants.CRMClient)},model:function(e){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({modules:this.getModules(),dashboardid:e.dynamicParam,componentid:e.queryParams.component_id,componentname:e.queryParams.component_name})},afterModel:function(){var e=this;return Lyte.resolvePromises({layoutDetails:e.getLayoutDetails(e.currentModel.modules[0].api_name)}).then((function(t){e.currentModel.layoutDetails=t.layoutDetails}))},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-usagecomponent"}},getLayoutDetails:function(){return this.getModules(!0)}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer.exclusion.excluded-mails",{beforeModel:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].showHideTableLoading(!0)},model:function(){return store.unloadAll("excluded_entity"),store.findAll("excluded_entity",{include_inner_details:"entities.Record_Image",exclusion_type:"excluded",per_page:10,page:1})},afterModel:function(e){this.currentModel={entityArray:e,tab:"vocexcludedTab",lengthLimit:3},this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName]))},renderTemplate:function(){return{outlet:"#vocexcludedTab",component:"crm-voc-exclusion-table"}},afterRender:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].showHideTableLoading(!1)},actions:{willTransition:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].cancelInternalSearch()}}},{mixins:["voc-exclusion-route-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer.exclusion",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocexclusion"),networkUtils.getI18nJSUrl("vocnotification"),networkUtils.getI18nJSUrl("vocsetup")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["voc-exclusion.js","voc-exclusion-store.js","voc-common-utils.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["voc-exclusion.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(r).concat(e)},renderTemplate:function(){return{outlet:"#result",component:"crm-voc-exclusion-view"}},redirect:function(){"crm.settings.section.voice-of-customer.exclusion"===this.transition.info.route&&this.replaceWith("crm.settings.section.voice-of-customer.exclusion.excluded-mails")}}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer.exclusion.suggested-mails",{beforeModel:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].showHideTableLoading(!0)},model:function(){return store.unloadAll("excluded_entity"),store.findAll("excluded_entity",{include_inner_details:"entities.Record_Image",exclusion_type:"suggested",per_page:10,page:1})},afterModel:function(e){this.currentModel={entityArray:e,tab:"vocsuggestedTab",lengthLimit:3},this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName])),Lyte.registeredMixins["voc-exclusion-route-mixin"].showHideTableLoading(!1)},renderTemplate:function(){return{outlet:"#vocsuggestedTab",component:"crm-voc-exclusion-table"}},afterRender:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].showHideTableLoading(!1)},actions:{willTransition:function(){Lyte.registeredMixins["voc-exclusion-route-mixin"].cancelInternalSearch()}}},{mixins:["voc-exclusion-route-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer.voice-of-customer-index",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocsetup"),networkUtils.getI18nJSUrl("voccommon")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["voc-feedback.js","voc-common-utils.js","voc-setup.js","voc-get-started.js","crm-help-link.js","lyte-sticky.js","lyte-scrollspy.js","voc_configuration.js","crux-form-component.js","crux-parent-form-component.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["voc-setup.css","voc-get-started.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(r).concat(e)},afterModel:function(e){e=this.parent.currentModel,this.currentModel={voc:e,showGetStarted:this.parent.error_key,vocSetupInfo:e[0],reEnableFlow:!this.parent.error_key&&!e[0].enabled,fromPromo:this.parent.transition.data.fromPromo,redirectedFrom:this.parent.transition.data.redirectedFrom},delete this.parent.error_key,document.getElementById("setup_new_ContentDiv").classList.add("vocGsSetpBorder"),this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName]))},renderTemplate:function(){return{outlet:"#result",component:"crm-voc-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer",{getDependencies:function(){return networkUtils.returnDependencyFiles(["voc-setup-data-store.js","voc-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocsetup"),networkUtils.getI18nJSUrl("voccommon"),networkUtils.getI18nJSUrl("voc")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["voc-feedback.js","voc-common-utils.js","voc-setup.js","voc-get-started.js","crm-help-link.js","lyte-sticky.js","lyte-scrollspy.js","voc_configuration.js","crux-tag.js","crux-color-palette.js","crux-form-component.js","crux-combo-box.js","crux-parent-form-component.js","portal-model.js","voc-common-store.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["voc-setup.css","crux-combo-box-view.css","voc-get-started.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(r).concat(e)},model:function(){return store.findAll("voc_setup")},redirect:function(){"crm.settings.section.voice-of-customer"===this.transition.target&&(this.replaceWith("crm.settings.section.voice-of-customer.voice-of-customer-index").data=this.transition.data)},beforeExit:function(){var e=document.getElementById("setup_new_ContentDiv");e&&e.classList.remove("vocGsSetpBorder"),store.unloadAll("voc_configuration_module"),store.unloadAll("voc_configurations")},actions:{onError:function(e,t){var r=JSON.parse(e.response);if("FEATURE_NOT_ENABLED"===r.code&&"feature not enabled"===r.message)return this.currentModel=[{enabled:!1}],this.error_key=!0,t.resume(),!1;var s={NOT_ALLOWED:"crm.label.insufficient.privileges",NO_PERMISSION:"crm.label.insufficient.privileges",FEATURE_NOT_SUPPORTED:"crm.setup.feature.not.supported",FEATURE_NOT_ENABLED:"crm.setup.feature.not.enabled",FEATURE_DISABLED:"crm.setup.feature.not.enabled"},n=r.code&&s[r.code]?s[r.code]:"message.code.0";return crmui.showMsgBand("error",I18n.getMsg(n),3e3),t.abort(),Lyte.Router.transitionTo("crm.settings.index"),!1},didTransition:function(){this.transition.data&&this.transition.data.key&&Crm.client_tracking(this.transition.data.key,{page:this.transition.data.page})}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.create-webtabs",{lyteConvertionSupported:!0,getResources:function(){var e=[];return featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-teamspace-permission.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-teamspace-permission.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("teamspace")],ResourceConstants.CRM))),e},renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-create"}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.edit-webtabs",{model:function(){var e=Lyte.Router.getRouteInstance().getDynamicParam();if(idModuleMapping[e]){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("module",e);return store.findAll("module").then((function(e){return e.contains(t)&&("webtab_link"===t.generated_type||"webtab_widget"===t.generated_type||"webtab_lux"===t.generated_type)?{mode:"edit"}:{mode:"invalid"}}),(function(){return{mode:"invalid"}}))}return{mode:"invalid"}},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-create"}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.index-webtabs",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("module").then((function(e){for(var t=e.sort((function(e,t){return e.id-t.id})),r=[],s=t.length-1,n=0;s>=0;s--)"webtab_link"===t[s].generated_type?(r[n]=t[s],r[n].base_url=t[s].web_link.split("##wtab##")[0],n++):"webtab_widget"===t[s].generated_type?(r[n]=t[s],r[n].base_url=t[s].widget.url,r[n].widget_name=t[s].widget.name,r[n].widget_id=t[s].widget.id,n++):"webtab_lux"===t[s].generated_type&&(r[n]=t[s],r[n].base_url=t[s].lux.name,r[n].lux_name=t[s].lux.name,r[n].lux_id=t[s].lux.id,n++);return commonUtils.showHideLoadingDiv(!1),{mode:"list",webTabArray:r}}))},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-list"}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM){var e=[];return e.push(networkUtils.returnDependencyFiles(["crm-webtabs-resources.js","modulelist_variable.js","definition-model.js"],ResourceConstants.CRMClient)),e.push(networkUtils.returnDependencyFiles(["crm-webtabs-resources.css"],ResourceConstants.CRMClient)),e}},beforeModel:function(){var e=Crm.userDetails.LICENSE_TYPE,t=("crm.settings.section.web-tabs.create-webtabs"===this.transition.target||"crm.settings.section.web-tabs.edit-webtabs"===this.transition.target)&&-1===["E","A","C","Z","U","D","P","R"].indexOf(e);Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&!t||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){if("crm.settings.section.web-tabs"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.web-tabs.index-webtabs",this.replaceWith(e)}},beforeExit:function(){featuresAvailable.NEXTGENUI_ENABLED&&featuresAvailable.TEAMSPACE_ENABLED&&$L("crm-left-menu-teamspace")[0].component.methods.refreshTeamspace(!1)}}),Lyte.Router.registerRoute("crm.settings.section.webform.clone-webform",{queryParams:["module","name","layout_id","userTypeId"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","webform-selected-fields.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crux_"+Crm.userDetails.RELEVANT_LOCALE+".js","autoresponse_store.js","autoresponse_mixins.js","assignment-rules-mixin.js","crm-userassociations-datastore.js","webform-template-mixin.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-builder-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim());var t=this,r="dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:Crm.userDetails.CLIENT_PORTAL_NAME;return new Promise((function(s){var n,i=t.getModuleObjByApiName(e.queryParams.module),o=e.dynamicParam,a={builder_type:"webform",module:i,cloneForm:store.findRecord("webform",o,{module:i.api_name},void 0,!0,store.peekRecord("webform",o))};Lyte.resolvePromises(a).then((function(t){delete(n=t.cloneForm.$.toJSON()).id,n.analytics_data&&delete n.analytics_data.analytics_enabled_time,delete n.abtesting,void 0!==r&&store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),n.name=e.queryParams.name,t.webform=store.createRecord("webform",n,!0),t.layouts=store.findAll("layout",{module:i.api_name,skip_permission:!0}),Lyte.resolvePromises(t).then((function(e){s(e)}))}))}))},afterModel:function(e,t){var r=t.queryParams.userTypeId;e.layouts=this.getLayoutsFromLayoutsAPI(e.layouts);for(var s=e.layouts.length,n=e.layouts[0],i=0;i<s;i++)if(t.queryParams.layout_id===e.layouts[i].id){n=e.layouts[i];break}"portalform"===e.webform.type&&void 0!==r&&r!==e.webform.user_type.id&&(e.webform.user_type.id=r);var o=this.constructFieldsArrayFromResponse(n),a=this.constructWebFormFields(e.webform.fields,o,e.module.module_name);e.formName=e.webform.name,e.allFields=o,e.selectedLayout=n.id,e.webform.layout={id:n.id},e.webform.fields=a.selectedFieldsList,e.webform.fieldsToSelect=a.fieldsToSelect,e.webform.advancedFieldsToSelect=a.advancedFieldsToSelect},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){var e=document.querySelector("crm-webform-builder"),t=document.querySelector("crm-webform-embed");if(e&&(!t||t&&!t.component.data.isQRDownload))return""}},lyteConvertionSupported:!0},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.create-webform",{queryParams:["module","name","type","userTypeId"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","webform-selected-fields.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crux_"+Crm.userDetails.RELEVANT_LOCALE+".js","user_type.js","org-model.js","autoresponse_store.js","autoresponse_mixins.js","assignment-rules-mixin.js","crm-userassociations-datastore.js","webform-template-mixin.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-builder-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim()),e.queryParams.type=e.queryParams.type?e.queryParams.type:0,e.queryParams.userTypeId=e.queryParams.userTypeId?e.queryParams.userTypeId:null;var t="dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:Crm.userDetails.CLIENT_PORTAL_NAME,r=this.getModuleObjByApiName(e.queryParams.module),s=e.dynamicParam;s&&void 0!==s||(s=this.getBasicWebform(e.queryParams.name,r,e.queryParams.type,e.queryParams.userTypeId));var n=store.createRecord("webform",s);void 0!==t&&(store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),store.findAll("org"));var i={builder_type:"webform",module:r,webform:n,layouts:store.findAll("layout",{module:r.api_name,skip_permission:!0})};return Lyte.resolvePromises(i)},afterModel:function(e,t){var r=this.getLayoutsFromLayoutsAPI(e.layouts),s=this.getSystemLayout(r),n=null!=s?s:r[0],i=this.constructFieldsArrayFromResponse(n);if("portalform"===t.queryParams.type){var o=this.getMandateFieldsForPortalForms();i.push(o),i=i.flat()}allFieldsLength=i.length,fields=[];for(var a=void 0!==store.peekRecord("user_type",e.webform.user_type.id)?store.peekRecord("user_type",e.webform.user_type.id).invitation_field.id:void 0,l=0;l<allFieldsLength;l++){var c=i[l];(c.required||c.system_mandatory||"portalform"===t.queryParams.type&&c.id===a)&&(c.required=!0,fields.push(c))}var u=this.constructWebFormFields(fields,i,e.module.module_name,e.webform.type);e.formName=e.webform.name,e.layouts=r,e.allFields=i,e.selectedLayout=n.id,e.webform.layout={id:n.id},e.webform.fields=u.selectedFieldsList,e.webform.fieldsToSelect=u.fieldsToSelect,e.webform.advancedFieldsToSelect=u.advancedFieldsToSelect},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){var e=document.querySelector("crm-webform-builder"),t=document.querySelector("crm-webform-embed");if(e&&(!t||t&&!t.component.data.isQRDownload))return""}},lyteConvertionSupported:!0},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.edit-webform",{queryParams:["module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["user_type.js","org-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","webform-selected-fields.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","crux-color-palette.js","lyte-colorpicker.js","crux_"+Crm.userDetails.RELEVANT_LOCALE+".js","autoresponse_store.js","autoresponse_mixins.js","assignment-rules-mixin.js","crm-userassociations-datastore.js","webform-template-mixin.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-builder-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform",this.transition)||this.showPermissionDenied(this.transition)},model:function(e){var t=e.dynamicParam,r=this.getModuleObjByApiName(e.queryParams.module),s={builder_type:"webform",action:"edit",webform:store.findRecord("webform",t,{module:r.api_name,include_inner_details:"user_type.active"},void 0,void 0,store.peekRecord("webform",t)),layouts:store.findAll("layout",{module:r.api_name,skip_permission:!0},void 0,void 0,void 0),module:r};return void 0!==("dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:Crm.userDetails.CLIENT_PORTAL_NAME)&&(store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),store.findAll("org")),Lyte.resolvePromises(s)},afterModel:function(e){if("portalform"!==e.webform.type||Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal){var t=store.peekRecord("layout",e.webform.layout.id),r=this.constructFieldsArrayFromResponse(t),s=this.constructWebFormFields(e.webform.fields,r,e.module.module_name,e.webform.type);e.formName=e.webform.name,e.layouts=this.getLayoutsFromLayoutsAPI(e.layouts),e.selectedLayout=e.webform.layout.id,e.allFields=r,e.webform.fields=s.selectedFieldsList,e.webform.fieldsToSelect=s.fieldsToSelect,e.webform.advancedFieldsToSelect=s.advancedFieldsToSelect}else this.showPermissionDenied(this.transition)},renderTemplate:function(){return{outlet:"#result ",component:"crm-webform-builder"}},afterRender:function(e){var t=null,r=e.webform.abtesting&&e.webform.abtesting.length>0?e.webform.abtesting[0]:null;!r||"drafted"===r.status||"launched"===r.status||this.transition.data&&this.transition.data.editConfirmation||(r.link="<link-to lt-prop-route='crm.settings.section.abtesting.view-abtesting.preview-abtesting' lt-prop-dp='[\""+r.id+'"]\' lt-prop-qp=\'{"module": "'+r.module.api_name+"\"}' lt-prop-target='_blank' lt-prop-rel='noopener noreferrer' class='wwBreakWord'>"+$ESAPI.encoder().encodeForHTML(r.name)+"</link-to>",t={action:"editWarningShow",webform:e.webform,module:e.webform.module,editData:{abtesting:r,place:"webform_builder"}});var s=store.peekRecord("layout",e.webform.layout.id);!s||s.status<0?this.component.setData("commonActionData",{action:"layoutDeactivatedWarning",webform:e.webform,module:this.getModuleObjByApiName(e.webform.module.api_name),layoutsInfo:{layout:e.webform.layout,layouts:e.layouts,place:"webform_builder",callback:"edit",otherInfo:t,component:this.component}}):t&&this.component.setData("commonActionData",t),commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){var e=document.querySelector("crm-webform-builder"),t=document.querySelector("crm-webform-embed");if(e&&(!t||t&&!t.component.data.isQRDownload))return""}},lyteConvertionSupported:!0,actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.index-webform",{queryParams:["module","timeFilter","userTypeId"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-webforms-list.js","crm-webform-abtesting-create.js","abtesting-model.js","crux-video.js","webform-abtesting-demovideo.js","lyte-progressbar.js","user_type.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-webform-abtesting-create-less.css","webform-abtesting-demovideo-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t=t.concat(networkUtils.returnDependencyFiles(["crm-webforms-list-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e.concat(t)},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),e.queryParams.module)this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition);else{var t=this.getFeatureSupportedModules("webform");t.length?e.queryParams.module=t[0].api_name:this.showPermissionDenied(this.transition)}},model:function(){var e=this.getQueryParams(),t={},r={module:e.module,include_inner_details:"user_type.active"},s="dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:Crm.userDetails.CLIENT_PORTAL_NAME;if(Crm.webformAnalyticsEnabled){e.timeFilter||(e.timeFilter=JSON.stringify({filter:"all"})),e.timeFilter=$ESAPI.encoder().decodeFromURL(e.timeFilter),t.parsedJson=JSON.parse(e.timeFilter);var n=this.getWebFormAnalyticsDuration(t.parsedJson.filter,t.parsedJson.subFilter,t.parsedJson.filterValue,t.parsedJson.customStart,t.parsedJson.customEnd);t.filterObj={dateObject:n.timeFilter,displayName:n.selected_value},t.webform_dashboards=this.getAllWebFormAnalyticsDashBoard(),t.timeFilter=n.timeFilter,t.user_input=n.selected_value,t.analytics_data=this.getWebFormAnalyticData(e.module,n.timeFilter)}return t.webforms=store.findAll("webform",r,void 0,!0,{}),t.metaInfo=store.findAll("definition",{resource:"webform_meta",module:e.module}),void 0!==(r=this.getQueryParams()).userTypeId&&void 0!==s&&!0===Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal&&(t.user_types=store.findAll("user_type",{include_inner_details:"invitation_field.ui_type,invitation_field.display_label"}),t.license_data=store.findAll("dummy",null,!1,!1,{url:"/crm/v4/__features?api_names=portals_signup_form,user_type"})),Lyte.resolvePromises(t)},afterModel:function(e,t){var r=e.metaInfo;if(e.webform_available=r.webform_available,e.module=this.getModuleObjByApiName(t.queryParams.module),e.supportedModules=r.supported_module?r.supported_module:this.getFeatureSupportedModules("webform"),e.isChineseUser=Crm.userDetails.RELEVANT_LOCALE.indexOf("zh")>-1,e.isHebrewUser=Crm.userDetails.RELEVANT_LOCALE.indexOf("iw")>-1,e.analyticsEnabled=Crm.webformAnalyticsEnabled,e.isWebformsAvailableForModule=e.webforms.length>0,e.portalsPerm=Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal,e.webformPerm=Crm.userDetails.permissions["Crm_Implied_Web_To_"+e.module.module_name],Crm.webformAnalyticsEnabled){e.webforms||this.showPermissionDenied(this.transition),this.setWebformsAnalyticsData(e.webforms,void 0),e.analytics_data||this.showPermissionDenied(this.transition),e.webform_dashboards.forEach((function(t){null!==t.module||t.custom_module||(e.dashboardid=t.id)}));var s=!1;e.webforms.forEach((function(e){e.analytics_data&&e.analytics_data.analytics_enabled&&(s=!0)})),e.isTrackingEnabled=s,e.showOnBoarding=!1,0===e.webform_available?Crm.webformAnalyticsOnboardingEnabled=!0:e.webform_available>0&&!1===Crm.webformAnalyticsOnboardingEnabled&&(e.showOnBoarding=!0);var n=!!r.url_access_consent_status&&r.url_access_consent_status;e.webform_available>0&&!n&&(e.urlConsentPopupShow=!0)}var i=this.getQueryParams();if(void 0!==i.userTypeId&&i.userTypeId){var o=store.peekRecord("user_type",i.userTypeId);e.webform={},e.webform.id="",e.webform.name="",e.webform.module={},e.webform.module.api_name=e.module.api_name,e.webform.user_type={},e.webform.user_type.id=o.id,e.webform.user_type.name=o.name,e.webform.user_type.active=o.active,e.webform.type="portalform",e.createWebFormPopUp=!0,e.allowedUserTypes=this.getAllowedUserTypes(e.module.api_name),e.portalFormsCount=e.license_data.__features[0].details.limits.total,e.userTypeCount=e.license_data.__features[1].details.limits.total}},lyteConvertionSupported:!0,renderTemplate:function(){return networkUtils.initChart(),{outlet:"#result",component:"crm-webforms-list"}},afterRender:function(e){this.hideAndShowABTestTab(this.component),commonUtils.showHideLoadingDiv(!1);var t=$L("#selectModuleDrop")[0];if(t&&(t.ltProp("selected",""),t.ltProp("selected",e.module.api_name)),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var r=document.querySelector("crm-webforms-list");r&&r.component&&(r=r.component).actions.createForm(this.transition.data.module)}Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)),Crm.userDetails.isStorageLimitReached&&Crm.showStorageExceedPopup()},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less.css","webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)))},actions:{onError:function(){this.alertForInvaliedRequest(I18n.getMsg("crm.security.error"),"crm.settings.index"),this.transition&&this.transition.abort()},didTransition:function(){let e=$L("crm-abtesting-suggestion-popup")[0];e&&e.setData({upcomingState:"",showSuggestVariantChanges:!1,showAbTestSuggestion:!1,showSuggestVariant:!1})}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.module-analytics",{queryParams:["module","timeFilter"],getResources:function(){var e;return e=networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}if(!store.peekRecord("webform-analytics",e.dynamicParam))return this.getAllWebFormAnalyticsDashBoard()},model:function(e){var t={dashboardid:e.dynamicParam,queryparam:e.queryParams,module:e.queryParams.module};return e.dynamicParam!==this.id&&(t.webform_analytics_arr=this.getAllWebFormAnalyticsComponents(e.queryParams.module,void 0,e.dynamicParam),this.id=e.dynamicParam),Lyte.resolvePromises(t)},afterModel:function(e){var t=this.getQueryParams();e.webform_analytics_arr&&(e.webform_analytics_arr=this.renderComponentsBasedOnType(e.module,store.peekRecord("webform-analytics",e.dashboardid),e.webform_analytics_arr));var r=JSON.parse(t.timeFilter),s=this.getWebFormAnalyticsDuration(r.filter,r.subFilter,r.filterValue,r.customStart,r.customEnd);e.timefilter=s.timeFilter,e.user_input=s.selected_value,e.isMoreStatsPage=!0},moreStatsPageSettings:function(){var e=$("#analyticsResult"),t=e.offset().top,r=renderingUtils.windowHeight-t;e.css("height",r-36+"px")},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-analytics"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.lazyLoadSettings("analyticsResult","webF_prvTabHead","crm-webform-analytics"),$L("body").addClass("oH");var e=$L("#webF_regionMapDetails"),t=$L("#webF_regionMapModal").height()-e.position().top;this.moreStatsPageSettings(),e.css("height",t)},lyteConvertionSupported:!0,actions:{onError:function(){this.showPermissionDenied(this.transition)}},beforeExit:function(){$L("body").removeClass("oH")}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform.preview-webform",{queryParams:["module"],beforeModel:function(e){this.parent.component.setData({webform_analytics_page:!1}),this.checkPermission(e.queryParams.module,"webform",this.transition,"preview",this.parent.component.getData("webform").type)},getResources:function(){var e=networkUtils.returnDependencyFiles(["user_type.js"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT):e},model:function(e){e.dynamicParam=this.parent.getDynamicParam();var t=this.getModuleObjByApiName(e.queryParams.module),r={webform:this.parent.component.getData("webform"),webformPreview:store.triggerAction("webform","preview",{id:e.dynamicParam},{module:e.queryParams.module},"GET"),module:t,analyticsEnabled:Crm.webformAnalyticsEnabled,portalsPerm:Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal,webformPerm:Crm.userDetails.permissions["Crm_Implied_Web_To_"+t.module_name]};return Lyte.resolvePromises(r)},afterModel:function(e){if(!e.webform)throw"INVALID_FORM_ID";var t=e.webformPreview.webforms[0],r=t.source_code;if(Crm.webformAnalyticsEnabled&&e.webform.analytics_data&&e.webform.analytics_data.analytics_enabled){var s=r.substring(r.indexOf("<script id='wf_anal'"),r.indexOf("</form>"));r=r.replace(s,"")}e.wf_source_code=r,$L.extend(e.webform,t)},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#webformPreview",component:"crm-webform-preview"}},afterRender:function(e){var t=renderingUtils.getHeightFromTabLayer(),r=t-$("#webformPrevHead").outerHeight(),s=$("#ABTestPreviewPart");this.updateDatePickerScript(e.wf_source_code,"crm-webform-preview"),this.setTitleforEllipsis(".webformName"),Lyte.registeredMixins["webform-analytics-util"].setPageHeaderWidth(".webF_formNameCtn",".webformName",[".wenF_modName"]),$("#webF_Preview").css("height",r),s.css("height",t-36),$("#WebFormPreviewPart").css("height",r-36),commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e&&"FEATURE_NOT_SUPPORTED"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform.webform-analytics",{queryParams:["module","timeFilter","location_url"],getResources:function(){var e;return e=networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),e},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}this.parent.component.setData({webform_analytics_page:!0}),this.setPageHeaderWidth(".webF_formNameCtn",".webF_formName",[".webF_modName",".webF_allFilterHolder"])},model:function(){var e=this.parent.getDynamicParam(),t=this.getDynamicParam(),r=this.getQueryParams(),s=JSON.parse(r.timeFilter),n=this.getWebFormAnalyticsDuration(s.filter,s.subFilter,s.filterValue,s.customStart,s.customEnd);this.parent.component.setData({user_input:n.selected_value});var i,o=this.getDayWeekMonthChartObject(s.filter,s.subFilter,s.filterValue,s.customStart,s.customEnd);o.forEach((function(e){"true"===e.selected&&(i=e.value)}));var a=store.peekRecord("webform-analytics",e);a||(a=this.getWebFormAnalyticData(r.module,n.timeFilter));var l={queryparam:r,default_period:i,timefilter:n.timeFilter,location_url:r.location_url,webformid:e,day_week_month:o,form_analytics_data:a};this.dashboardid!==t&&(l.webform_analytics_arr=this.getAllWebFormAnalyticsComponents(r.module,e,t),l.selected_dashboard_id=t,this.dashboardid=t,l=Object.assign(l,this.parent.component.getData()));var c=this.parent.component.getData("webform");return void 0===store.peekRecord("layout",c.layout.id)&&(l.layoutObj=store.findRecord("layout",c.layout.id,{module:r.module,skip_permission:!0})),this.setPageHeaderWidth(".webF_formNameCtn",".webF_formName",[".webF_modName",".webF_allFilterHolder"]),Lyte.resolvePromises(l)},afterModel:function(e){var t=this.getQueryParams();e.module=t.module,e.webform_analytics_arr&&(e.webform_analytics_arr=this.renderComponentsBasedOnType(t.module,store.peekRecord("webform-analytics",this.getDynamicParam()),e.webform_analytics_arr))},renderTemplate:function(){return{outlet:"#webformPreview",component:"crm-webform-analytics"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1);var e=$L("#analyticsResult");$L("#setup_new_ContentDiv").scrollTop(0),e.scrollTop(0);var t=e.offset().top,r=renderingUtils.windowHeight-(t+15);e.css("height",r-28+"px");var s=renderingUtils.getHeightFromTabLayer()-$("#webformPrevHead").outerHeight();$("#webF_Preview").css("height",s),$("#WebFormPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-36)},lyteConvertionSupported:!0,actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform",{queryParams:["module","timeFilter","location_url"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-preview.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["webform-preview-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}},model:function(e){var t=this.getModuleObjByApiName(e.queryParams.module),r=store.findRecord("webform",this.getDynamicParam(),{module:e.queryParams.module},void 0,void 0,store.peekRecord("webform",this.getDynamicParam())),s=this.getQueryParams(),n={id:this.getDynamicParam(),queryparam:s,formdata:r,webform:r,module:t};return Crm.webformAnalyticsEnabled&&(n.webform_analytics_dashboard_arr=this.getAllWebFormAnalyticsDashBoard(s.module,this.getDynamicParam())),Lyte.resolvePromises(n)},afterModel:function(e){var t=this.transition.info.queryParams;if(t&&t.module||(this.transition.info.queryParams.module=e.module.api_name),e.webform_analytics_dashboard_arr){for(var r=this.getQueryParams(),s=Lyte.Component.registeredHelpers.getModuleNameByApiName(r.module),n=e.webform_analytics_dashboard_arr.length,i=this.CONSTANTS.DASHBOARDS,o=0;o<n;o++){var a=e.webform_analytics_dashboard_arr[o];switch(a.name){case i.WEBFORM_STATS_INDIVIDUAL_FORMS_SUBMISSION:a.item_name="Submission",a.display_item_name=I18n.getMsg("webform.analytics.view.submission"),a.zcqa="submissiontab",a.selected=!0;break;case i.WEBFORM_STATS_INDIVIDUAL_FORMS_REGION:a.item_name="Region",a.display_item_name=I18n.getMsg("webform.analytics.view.region"),a.zcqa="regiontab";break;case i.WEBFORM_STATS_INDIVIDUAL_FORMS_MODULES+s:a.item_name=s,a.display_item_name=Lyte.Component.registeredHelpers.getDisplayModuleName(s),a.zcqa="moduletab"}e.webform_analytics_dashboard_arr[o]=a}e.class_analytics="pL30 pR30"}},redirect:function(e){"crm.settings.section.webform.view-webform"===this.transition.info.route&&!0===this.transition.info.webform_analytics?this.transitionTo("crm.settings.section.webform.view-webform.webform-analytics",e.id,e.webform_analytics_dashboard_arr[0].id,e.queryparam):"crm.settings.section.webform.view-webform"===this.transition.target&&this.transitionTo("crm.settings.section.webform.view-webform.preview-webform",e.id,e.queryparam)},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-view"}},afterRender:function(){this.lazyLoadSettings("analyticsResult","webF_prvTabHead","crm-webform-analytics"),this.setTitleforEllipsis(".webformName")},lyteConvertionSupported:!0,actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e&&"INVALID_DATA"!==e&&"FEATURE_NOT_SUPPORTED"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform",{queryParams:["module"],renderThis:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["definition-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("webforms")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailInventoryTemplates"),networkUtils.getI18nJSUrl("editorframework"),networkUtils.getI18nJSUrl("listview")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["zohocrm_templatenew.js","zohocrm_template.js"],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["emailStorage-model.js"],ResourceConstants.CRMClient);if(e=(e=(e=(e=(e=(e=(e=e.concat(t)).concat(r)).concat(s)).concat(networkUtils.returnDependencyFiles(["webform.js","webform-model.js","abtesting.js","crm-webform-abtesting-config.js","abtesting-model.js","lyte-draggable.js","crux-parent-form-component.js","portal-model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-common-files.js","lyte-multislider.js","lyte-code-snippet.js","lyte-resize.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["webform-common-files-less.css","lyte-ui-multislider.css","lyte-ui-code-snippet.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["zohocrm_htmleditor1.js"],ResourceConstants.CRM)),Crm.isWebformsActionEnabled){var n={parent:networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js"],ResourceConstants.CRMClient)[0],child:networkUtils.returnDependencyFiles(["crm-lyte-editor-simple.js"],ResourceConstants.CRMClient)};e=e.concat(n);var i=networkUtils.returnDependencyFiles(["lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);e=e.concat(i)}if(Crm.webformAnalyticsEnabled){e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient));var o=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM),a={parent:networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),child:[o,networkUtils.returnDependencyFiles(["zohocrm_webformAnalytics_chartRenderer.js"],ResourceConstants.CRM)]};Crm.isZohoChartsEnabled?e=e.concat(networkUtils.returnDependencyFiles(["webform-zcharts-handler.js"],ResourceConstants.CRMClient)):(a.parent=a.parent.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM)),e=e.concat(networkUtils.returnDependencyFiles(["webform-highcharts-handler.js"],ResourceConstants.CRMClient))),e=e.concat(a)}return e=e.concat(networkUtils.returnDependencyFiles(["crm-email-auth-util.js","crm-email-deliverability-handling.js"],ResourceConstants.CRMClient))},redirect:function(){if("crm.settings.section.webform"===this.transition.target){Crm.trackSpotLightAction("Webforms - Page Visited");var e=Object.assign({},this.transition.info);e.route="crm.settings.section.webform.index-webform",this.replaceWith(e)}},didDestroy:function(){store.unloadAll("webform"),store.unloadAll("webform-analytics")},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-alert-addresswrapper.css"],ResourceConstants.CRMClient)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall&&ZohoHCAsap.UnInstall()),_cruxUtils.removeCustomAlert(),closeAsapWidget()}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.configuration",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")?e.dynamicParam!=t.$.get("providerName")&&this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName")):validationUtils.isEmpty(e.dynamicParam)?this.replaceWith("crm.settings.section.widget-telephony.marketplace"):this.replaceWith("crm.settings.section.widget-telephony.summary",e.dynamicParam)},model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={params:{mode:"widget",ctiname:t.$.get("providerName")}};return networkUtils.lyteInitiateRequest(r,"GET",s)},afterModel:function(e,t){"object"!=typeof e||"providerEnabled"==e.view||e.isZticonfigured||(store.peekAll("provider_conf")[0].$.set("isEnabled",!1),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.widget-telephony.summary",t.dynamicParam))},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_provider_detail_page(e):e}},afterRender:function(e){$("#setupInnerLinks").hide()},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.marketplace",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")&&this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName"))},model:function(e){var t=ctiApiConfig.providerListData;if(validationUtils.isEmpty(t)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={params:{mode:"widget"}};return networkUtils.lyteInitiateRequest(r,"GET",s)}return t},afterModel:function(e,t){"object"==typeof e&&"providerList"===e.view?ctiApiConfig.setProviderData(e):"object"==typeof e&&"providerEnabled"===e.view&&this.replaceWith("crm.settings.section.widget-telephony.configuration",e.provider)},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_providers_list(ctiApiConfig.providerListData):e}},afterRender:function(e,t){commonUtils.showHideLoadingDiv();var r=store.peekAll("provider_conf")[0];if(validationUtils.isNotEmpty(r.$.get("providerName"))){var s=r.$.get("providerName");s=(s=s.replace(".","\\.")).replace(/\s/g,"\\ "),$L("html, body").scrollTop($("#"+s).offset().top)}}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.summary",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")?this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName")):validationUtils.isEmpty(e.dynamicParam)&&this.replaceWith("crm.settings.section.widget-telephony.marketplace")},model:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.set("providerName",e.dynamicParam),validationUtils.isEmpty(ctiApiConfig.providerListData)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={params:{mode:"widget",ctiname:e.dynamicParam}};return networkUtils.lyteInitiateRequest(r,"GET",s)}return ctiApiConfig.allProviderInfo[t.$.get("providerName")]},afterModel:function(e,t){"object"==typeof e&&(e.provider=e.providerName,e.detailObj&&(e.detailObj.provider=e.provider,e.detailObj.type=e.type))},renderTemplate:function(e,t){var r="";return"object"!=typeof e?r=e:e.detailObj?r=Handlebars.templates.ctiapi_provider_detail_page(e.detailObj):(Handlebars.registerPartial("twilioDetailView",Handlebars.templates.twilio_detailview),r=Handlebars.templates.ctiapi_provider_login_page(e)),{outlet:"#result",html:r}},afterRender:function(e,t){$("#setupInnerLinks").hide()}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-provider-conf.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_phonebridge_home.js"],ResourceConstants.CRM)},model:function(e){if(store.peekAll("provider_conf").length<=0){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={params:{mode:"telephonyConfigDetails"}};return networkUtils.lyteInitiateRequest(t,"GET",r)}return null},afterModel:function(e,t){e&&"object"==typeof e&&store.createRecord("provider_conf",e);var r=store.peekAll("provider_conf")[0];"1"==r.$.get("providerType")&&this.replaceWith("crm.settings.section.telephony.marketplace"),this.transition.target.endsWith("widget-telephony")&&(r.$.get("isEnabled")?this.replaceWith("crm.settings.section.widget-telephony.configuration",r.$.get("providerName")):this.replaceWith("crm.settings.section.widget-telephony.marketplace"))},beforeExit:function(){ctiApiConfig.providerListData=null}}),Lyte.Router.registerRoute("crm.settings.section.widget",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-setup-widget.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM))},beforeModel:function(){featuresAvailable.Crm_Widgets||(crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.feature.unsupported"),3e3),featuresAvailable.NEXTGENUI_ENABLED)||(Lyte.Router.transitionTo("crm.settings.index").refresh=!0)},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/__internal/settings/customize/"+e.dynamicParam+"/actions/check_permission","POST").then((function(e){return e}),(function(e){var t=e.responseJSON.settings_customization[0];"INVALID_DATA"!==t.code||t.message}))},renderTemplate:function(e){return e&&e.settings_customization&&!e.settings_customization[0].permission&&(featuresAvailable.NEXTGENUI_ENABLED?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"),void 0,void 0,(function(){Lyte.Router.getRouteInstance().transitionTo(Lyte.registeredMixins["crm-setup-mixin"].getFirstAvailableRouter())})):renderingUtils.displayPermissionDenied(),this.transition.abort()),{outlet:"#result",component:"crm-setup-widget"}},afterRender:function(e,t){if(commonUtils.showHideLoadingDiv(!1),!globalSetpJson.components.filterBy({id:t.dynamicParam}).length||(crmui.showMsgBand("error",I18n.getMsg("crm.copy.config.link.expired"),4e3),featuresAvailable.NEXTGENUI_ENABLED))if("undefined"!=typeof WidgetHandler&&WidgetHandler.getWidget("Settings",t.dynamicParam)||(crmui.showMsgBand("error",I18n.getMsg("crm.financesuite.pushnotify.toviewupdate"),1e4),featuresAvailable.NEXTGENUI_ENABLED)){if(WidgetHandler.getWidget("Settings",t.dynamicParam)){var r,s=-1,n=-1;if(-1!==(r=globalSetpJson.components.findIndex((e=>{if(e.menus&&-1!==(s=e.menus.findIndex((e=>{if(e.sub_menus&&-1!==(n=e.sub_menus.findIndex((e=>e.id===t.dynamicParam))))return!0}))))return!0})))&&-1!==s&&-1!==n&&globalSetpJson.components[r].menus[s].sub_menus[n].widget.id!==WidgetHandler.getWidget("Settings",t.dynamicParam).ID&&(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.financesuite.pushnotify.toviewupdate"),ltPropType:"error",ltPropYield:"true"}}),!featuresAvailable.NEXTGENUI_ENABLED))return void(Lyte.Router.transitionTo("crm.settings.index").refresh=!0)}WidgetHandler.SetupWidget.render(void 0,t.dynamicParam)}else Lyte.Router.transitionTo("crm.settings.index").refresh=!0;else Lyte.Router.transitionTo("crm.settings.index").refresh=!0},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1)}}}),Lyte.Router.registerRoute("crm.settings.section.wizard.create-wizard",{getResources:function(e){return Lyte.registeredMixins["crm-create-init-mixin"].getWizardResources(e)},model:function(){let e=this.transition.data,t={};if(e.selectedLayout&&""!==e.selectedLayout&&e.primaryModuleId){if(!store.peekRecord("layout",e.selectedLayout)){let r={};r.module=store.peekRecord("module",e.primaryModuleId).api_name,r.skip_permission=!0,t.layouts=store.findAll("layout",r)}}var r="org_based";return e.primaryModuleId&&(r=store.peekRecord("module",e.primaryModuleId).access_type),t.profiles="team_based"===r?store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"}):store.findAll("profile"),Lyte.resolvePromises(t)},afterModel:function(e){var t=this.transition.data,r=store.createRecord("wizard");if(e.limits=t.limits,r.$.isError||!t.selectedLayout)Lyte.Router.transitionTo("crm.settings.section.wizard.index-wizard");else{e.wizardName=t.wizardName,e.primaryModule=store.peekRecord("module",t.primaryModuleId),e.id="wizBuilder";var s=t.selectedLayout;if(e.layouts=[],e.builderScreenMap={},e.wizardId=r.id,e.moduleType=e.primaryModule.access_type,r.$.set("name",t.wizardName),r.$.set("module",e.primaryModule),s){var n=store.peekRecord("layout",s),i=[];if(t.creationMode===wizardUtil.CREATION_MODE_SCRATCH)(i=store.createRecord("wizard-container")).$.set("layout",n),i.$.set("chart_data",{nodes:[],connections:[]}),e.isMandatoryAutopopulate=!0,e.isAutoGeneratedWizard=!1;else if(t.creationMode===wizardUtil.CREATION_MODE_AUTO_GENERATE){let n=t.selectedSectionsAndFields;i=Lyte.registeredMixins["crm-wizard-generator"].generateWizard(s,n,r),e.isAutoGeneratedWizard=!0,e.isMandatoryAutopopulate=!1}e.builderScreenMap[s]=i,e.layouts.push(n),r.containers.add(i),e.selectedLayoutId=s}}},lyteConvertionSupported:!0,renderTemplate:function(){return $("#tabLayer").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$(".setupleftmenutable .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("body").addClass("isWizard"),{outlet:"#result",component:"crm-wizard-builder"}},beforeExit:function(){var e=$("crm-wizard-builder");e.length&&(e[0].component.getData("layouts").forEach((function(e){delete e.active})),e[0].component.data.primaryModule.fields=void 0,store.unloadAll("field"),store.unloadAll("layout"),e[0].component.data.primaryModule.wizard=void 0,thirdPartyUtils.unbindChildEvents(e,!0,!0,!1),crmFlowUtils.magnetiserInstance=null,store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("wizard-conditional-rule"),store.unloadAll("wizard-conditional-action"),store.unloadAll("transition"),store.unloadAll("wizard-query-component"),store.unloadAll("wizard-query-parameter"),store.unloadAll("wizard-element"),store.unloadAll("wizard-query-action")),$("body").removeClass("isWizard")},actions:{willTransition:function(e){this.checkForUnsavedChanges(e)},onError:function(){this.transitionTo("crm.settings.section.wizard.index-wizard")}}},{mixins:["crm-wizard-util-mixin","crm-wizard-generator"]}),Lyte.Router.registerRoute("crm.settings.section.wizard.index-wizard",{getResources:function(){return networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient)},model:function(){return Lyte.resolvePromises({lastActiveWizard:"crm.settings.section.wizard.view-wizard"===app.prevTransition.route?app.prevTransition.dynamicParams[0]:this.transition.lastActiveWizard,module:store.findAll("module"),wizards:store.findAll("wizard"),profiles:store.findAll("profile")}).catch((function(e){crmHistory.handleAjaxErrorLyte=!0,Lyte.Router.getRouteInstance().transition.abort(),validationUtils.IsJsonString(e.response)&&"FEATURE_NOT_SUPPORTED"===JSON.parse(e.response).code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED")):renderingUtils.displayPermissionDenied()}))},beforeModel:function(){store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("custom_button"),store.unloadAll("field"),store.unloadAll("wizard-query-component"),store.unloadAll("wizard-query-parameter"),store.unloadAll("wizard-element"),store.unloadAll("wizard-query-action"),store.unloadAll("wizard-segment")},afterModel:function(e){e.modules=e.module.filter((e=>(crmConstants.wizardIncludedModules.contains(e.module_name)||"custom"===e.generated_type&&("crm"===e.source||"platform_plugin"===e.source||"marketplace_plugin"===e.source))&&!0===e.presence_sub_menu)),delete e.module,e.wizardLimit=e.wizards.length?e.wizards.$.meta.license_limit:5,e.wizardCount=e.wizards.length?e.wizards.$.meta.wizard_count:0,e.limits=e.wizards.$.meta.limits},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-wizard-list"}},afterRender:function(){var e=Handlebars.templates.deleteFieldWarningPopup();if($("#result").append(e),featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data.showCreatePopup){var t=document.querySelector("crm-wizard-list");if(t&&t.component&&(t.component.actions.showWizardPop(),this.transition.data.module&&this.transition.data.module.id)){var r=document.querySelector("crm-wizard-create-form");r&&r.component&&r.component.methods.moduleSelect(null,this.transition.data.module.id)}}},actions:{didTransition:function(){$("#tabLayer").show(),$("#mainMenuTabDiv").show(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").show(),$(".setupleftmenutable .setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow")}}}),Lyte.Router.registerRoute("crm.settings.section.wizard.view-wizard",{queryParams:["layoutid"],getResources:function(e){return Lyte.registeredMixins["crm-create-init-mixin"].getWizardResources(e)},beforeModel:function(){if(!this.transition.info.dynamicParams[0]||validationUtils.isEmpty(this.transition.info.queryParams.layoutid)){commonUtils.showHideLoadingDiv(!1),this.transition.abort();let e=I18n.getMsg("crm.settings.wizard.not.found.heading"),t=I18n.getMsg("crm.settings.wizard.not.found.desc"),r=Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":t,"lt-prop-primary-message":e,"lt-prop-button-position":"left","data-zcqa":"wizard-error-alert"},"#result");r.setMethods({onClose:function(){Lyte.Router.transitionTo("crm.settings.section.wizard.index-wizard")}}),r.ltProp("buttons",[{type:"reject",text:I18n.getMsg("crm.button.ok"),appearance:"failure"}]),r.ltProp("showCloseButton",!1),r.ltProp("show",!0)}},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this;return Lyte.resolvePromises({profile:store.findAll("profile",{include_lite_profile:!0}),privateProfile:store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"}),wizards:store.peekAll("wizard")&&store.peekAll("wizard")[0]?store.peekAll("wizard"):store.findAll("wizard"),wizard:store.findRecord("wizard",this.transition.info.dynamicParams[0],{layout_id:this.transition.info.queryParams.layoutid},!1),user_type:Crm.userDetails.isSandbox||!(Crm.userDetails.CLIENT_PORTAL_NAME||CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME)||this.transition.data.moduleType&&"team_based"===this.transition.data.moduleType?void 0:store.findAll("user_type",{include:"modules"},!1)}).then((function(t){if(!validationUtils.isEmpty(t.wizard[0]))return store.findAll("field",{module:t.wizard[0].module.api_name},void 0,void 0,{apiVersion:"2.2"}),t;e.handleWizardErrors("NOT_FOUND")})).catch((function(t){let r;e.transition.abort(),t.response.includes("message")&&(r=JSON.parse(t.response));let s=r&&r.message||"";e.handleWizardErrors(s)}))},lyteConvertionSupported:!0,afterModel:function(e){var t={},r=e.wizard[0],s=store.peekRecord("module",r.module.id).access_type;if("team_based"===s?(t.moduleType=s,t.profiles=e.privateProfile):t.profiles=e.profile,!r){commonUtils.showHideLoadingDiv(!1),this.transition.abort();var n=Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":I18n.getMsg("crm.settings.wizard.not.found.desc"),"lt-prop-primary-message":I18n.getMsg("crm.settings.wizard.not.found.heading"),"lt-prop-button-position":"left"},"#result");return n.ltProp("buttons",[{type:"reject",text:I18n.getMsg("crm.button.ok"),appearance:"failure"}]),n.setMethods({onReject:function(){Lyte.Router.transitionTo("crm.settings.section.wizard.index-wizard")}}),n.ltProp("showCloseButton",!1),void n.ltProp("show",!0)}this.sortElements(r),t.limits=e.wizard.$.meta.limits,t.wizardId=this.transition.info.dynamicParams[0],t.wizardName=r.name,t.primaryModule=r.module,t.selectedLayoutId=this.transition.info.queryParams.layoutid,t.id="wizBuilder",t.layouts=[],t.builderScreenMap={};var i={},o=this;r.containers.forEach((function(e,r){var s=e.layout;t.layouts[r]=s,s.id===o.transition.info.queryParams.layoutid&&(t.layouts[r].active=!0,t.selectedLayoutId=s.id),i[s.id]=e})),t.builderScreenMap=i,this.currentModel=t},renderTemplate:function(){return $("#tabLayer").hide(),featuresAvailable.NEXTGENUI_ENABLED&&$L(".nextGenUILeftMenu").hide(),$(".setupleftmenutable .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("body").addClass("isWizard"),{outlet:"#result",component:"crm-wizard-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){var e=$("crm-wizard-builder");if(e.length){e[0].component.getData("layouts").forEach((function(e){delete e.active})),e[0].component.data.primaryModule.fields=void 0,e[0].component.data.primaryModule.wizard=void 0,thirdPartyUtils.unbindChildEvents(e,!0,!0,!1);var t=document.getElementById("wizardNotFoundAlert");t&&t.remove(),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("wizard-conditional-rule"),store.unloadAll("wizard-conditional-action"),store.unloadAll("transition"),store.unloadAll("wizard-query-component"),store.unloadAll("wizard-query-parameter"),store.unloadAll("wizard-element"),store.unloadAll("wizard-query-action"),store.unloadAll("layout"),store.unloadAll("canvasview")}$("body").removeClass("isWizard")},didDestroy:function(){store.unloadAll("field")},actions:{willTransition:function(e){this.checkForUnsavedChanges(e),Lyte.triggerEvent("changingRouteFromOneToAnother",{route:"view-wizard"})}}},{mixins:["crm-wizard-util-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.wizard",{getResources:function(){if(Crm.client_tracking("Wizards - Explore wizards"),store.peekAll("module").filter((e=>!("crm"!==e.source||"team_based"!==e.access_type||!e.private_profile||"Admins"!==e.private_profile.name))).length&&(Crm.userDetails.isAdminForAtleastOneTeamModule=!0),Crm.userDetails.isAdminForAtleastOneTeamModule||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM){window.module=void 0;let t=networkUtils.returnDependencyFiles(["crm-wizards.css","crm-picklist-colorpicker.css"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crm-wizards-feature.css","crm-wizard-create-form.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-wizards-rtl.css"],ResourceConstants.CRMClient)));var e=networkUtils.returnDependencyFiles(["user_type.js","crm-wizards-list.js","crm-wizard-mixin.js","crm-wizard-configuration-helpers.js","crm-wizard-util-mixin.js","crm-wizard-common-helpers.js","lyte-draggable.js","crm-wizard-util-mixin.js","crm-client-portal-mixin.js","crm-client-portal-module.js","crux-criteria-conditions.js"],ResourceConstants.CRMClient);return e=e.concat(t).concat(networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"wizards/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.RELEVANT_LOCALE)+".js","zohocrm_wizard_util.js"],ResourceConstants.CRM))}},beforeExit:function(){store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("transition"),store.unloadAll("custom_button"),store.unloadAll("wizard-query-component"),store.unloadAll("wizard-query-parameter"),store.unloadAll("wizard-element"),store.unloadAll("wizard-query-action"),store.unloadAll("user_type"),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],ResourceConstants.CRM))},beforeModel:function(){!Crm.userDetails.isAdminForAtleastOneTeamModule&&!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||Crm.userDetails.ISROMODE?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()):(store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("transition"),store.unloadAll("field"),store.unloadAll("layout"),store.unloadAll("wizard-query-component"),store.unloadAll("wizard-query-parameter"),store.unloadAll("wizard-element"),store.unloadAll("wizard-query-action"))}}),Lyte.Router.registerRoute("crm.settings.section.workflow-insights",{queryParams:["step","processId","module","isFromUsageTab"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_wfInsights.js"],ResourceConstants.CRM);e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowreports")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-workflow-reports-list-view.js","email-usage.js","crm-automation-help-link.js","automation/common/crm-automation-actions-helper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-list-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-inner-list.js"],ResourceConstants.CRMClient));var t=networkUtils.returnDependencyFiles(["crm-workflow-reports.css"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-workflow-reports-rtl.css"],ResourceConstants.CRMClient))),e=e.concat(t)},model:function(){commonUtils.showHideLoadingDiv(!0);var e={};e.to=$L.moment().local().timezone(Crm.userDetails.USER_TIME_ZONE).format("YYYY-MM-DD"),e.from=$L.moment().local().subtract(7,"date").timezone(Crm.userDetails.USER_TIME_ZONE).format("YYYY-MM-DD"),e.source="workflow_rules";var t="/crm/v8/settings/automation/email_notifications/actions/top_usage";return store.findAll("dummy",e,!1,!1,{url:t}).then(function(r){return r.email_notifications_usage.length?Lyte.resolvePromises({topPerformed:r,pastPermorfance:store.findAll("dummy",{source:"workflow_rules",to:e.from,from:$L.moment().local().subtract(14,"date").timezone(Crm.userDetails.USER_TIME_ZONE).format("YYYY-MM-DD")},!1,!1,{url:t})}):{topPerformed:r,pastPermorfance:r}}.bind(this),function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"unauthorized"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):"FEATURE_NOT_SUPPORTED"===t.code?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED")):_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.workflow.save.error"),ltPropType:"error"}}),this.transition.abort()}.bind(this))},afterModel:function(e){e.topPerformed=e.topPerformed.email_notifications_usage,e.pastPermorfance=e.pastPermorfance.email_notifications_usage,commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(){return{outlet:"#result",component:"crm-emails-usage"}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.clone-workflow-rule",{lyteConvertionSupported:!0,queryParams:["ruleName","migratedRule"],getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageResources()},beforeModel:function(){this.isFeatureAvailable()||this.transition.abort()},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam(),t=this.getQueryParams();return Lyte.resolvePromises({ruleDetails:store.findRecord("workflow_rule",e)}).then(function(e){if(void 0!==e.ruleDetails&&void 0!==e.ruleDetails.id){var r=e.ruleDetails.module.api_name;if(!this.isCloneSupported(e.ruleDetails)||!this.isCreateEditWFAllowedForModule(Lyte.registeredMixins["crm-automation-actions"].fetchModuleName(r,e.ruleDetails.module.id)))return this.handleWFErrors(void 0,{code:"NO_PERMISSION"}),{isError:!0};var s={module:r},n=!1;e.ruleDetails.module.api_name!==e.ruleDetails.execute_when.details.trigger_module.api_name&&(n=!0,s.trigger_module=e.ruleDetails.execute_when.details.trigger_module.api_name);var i={clientConfigDetails:store.findAll("workflow_client_configuration",s,!0,!1),configDetails:store.findAll("workflow_configuration",{module:r},!0,!1),moduleFields:store.findAll("field",{module:r,type:"all"},!1,!0,{apiVersion:"2.2"}),configLimit:store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/automation/workflow_rules/actions/rules_count",method:"GET"}),moduleVsCriteriaFields:this.getCriteriaFieldOnEdit(e.ruleDetails),ruleDetails:e.ruleDetails,isRelatedTrigger:n};if(!0===e.ruleDetails.deprecated){if(!t.migratedRule)return this.handleWFErrors(void 0,{code:"deprecated_rule_clone"}),{isError:!0};i.migratedRules=store.findRecord("workflow_migration_suggestion",e.ruleDetails.id,!0)}return Lyte.resolvePromises(i).then(null,function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))}return e}.bind(this),function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))},afterModel:function(e){if(e.isError)this.transition.abort();else if(e.ruleDetails&&Object.keys(e.ruleDetails).length){var t=this.getQueryParams();if(e.migratedRules){var r=e.migratedRules.find((e=>e.id===t.ruleName));r&&r.suggested_configuration?r=r.suggested_configuration:(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.workflow.save.error"),ltPropType:"error"}}),Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"}),this.transition.abort()),e.ruleDetails=r}var s=this.postProcessWFModelData(e,"clone");let n=t.ruleName||"clone of "+s.workflowDetails.ruleDetails.name;s.workflowDetails.ruleName=n,s.workflowDetails.step="clone",this.currentModel=s,commonUtils.showHideLoadingDiv(!1)}else{if(this.transition.data&&"workflow-listview"===this.transition.data.tab)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.title"),ltPropType:"error"}});else{let e=[{type:"accept",text:I18n.getMsg("crm.button.ok.gotit"),appearance:"failure"}];_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.title"),ltPropSecondaryMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.info"),ltPropButtons:e,ltPropButtonPosition:"right"}})}Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"}),this.transition.abort()}},renderTemplate:function(){return this.renderWorkflowRuleComp()},afterRender:function(){this.workflowCreateEditPageAfterRenderHandlings()},actions:{willTransition:function(e){if("crm.settings.section.workflow"===e.target&&(e.data={reload:!0}),LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,s=0;s<r;s++)t[s].$node.id&&"chat-popup"===t[s].$node.id&&t[s].setData("ltPropBindToBody",!1);!this.isRuleEdited()||e.data&&e.data.from&&"cancel"===e.data.from||e.extraDetails&&e.extraDetails.from&&"save"===e.extraDetails.from||(commonUtils.showHideLoadingDiv(!1),this.pauseTheTransaction(e))}},beforeExit:function(){this.workflowCreateEditPageBeforeExitHandlings()},onBeforeLoad:function(){this.clearMergeFieldsCache&&this.clearMergeFieldsCache()},didDestroy:function(){this.workflowCreateEditPageDidDestroyHandlings()}},{services:["workflow"],mixins:["crm-workflow","workflow","crm-workflow-actions","crm-automation-actions","crm-workflow-triggers","crm-workflow-criteria","crm-merge-field-mixin","workflow-utils"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.create-workflow-rule",{lyteConvertionSupported:!0,queryParams:["module"],getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageDependencies()},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-crux-tag-comp-wrapper.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient))).concat(Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageResources())},beforeModel:function(e){if(this.isFeatureAvailable())if(moduleRecordMapping[e.queryParams.module])"Emails"===moduleRecordMapping[e.queryParams.module].module_name&&Crm.userDetails.isSandbox?(this.handleWFErrors(void 0,{code:"NO_PERMISSION"}),this.transition.abort()):this.isCreateEditWFAllowedForModule(moduleRecordMapping[e.queryParams.module].module_name)||(this.handleWFErrors(void 0,{code:"NO_PERMISSION"}),this.transition.abort());else{var t=I18n.getMsg("crm.teamspace.api.invalid.module");let e=[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"failure"}];_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:t,ltPropSecondaryMessage:I18n.getMsg("crm.restriction.error.module.nolongerexists"),ltPropButtons:e,ltPropButtonPosition:"right"}}),Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"})}else this.transition.abort()},model:function(e){commonUtils.showHideLoadingDiv(!0);let t=moduleRecordMapping[e.queryParams.module].api_name;return Lyte.resolvePromises({clientConfigDetails:store.findAll("workflow_client_configuration",{module:t},!0,!1),configDetails:store.findAll("workflow_configuration",{module:t},!0,!1),moduleFields:store.findAll("field",{module:t,type:"all"},!1,!0,{apiVersion:"2.2"}),configLimit:store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/automation/workflow_rules/actions/rules_count",method:"GET"})}).then(null,function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))},afterModel:function(e,t){if(e.isError)this.transition.abort();else{this.crmWorkflow.step="create";let r={step:"create",ruleName:this.transition.data&&this.transition.data.ruleName?this.transition.data.ruleName:"New Rule",description:this.transition.data?this.transition.data.description:""};this.crmWorkflow.relatedTriggerDetails=e.configDetails.workflow_configurations.related_triggers_details,r.configurationDetails=e.clientConfigDetails.workflow_configurations;let s=this.processConfigurationDetails(JSON.parse(JSON.stringify(e.configDetails.workflow_configurations)),JSON.parse(JSON.stringify(e.clientConfigDetails.workflow_configurations)));s=this.processActionConfigurationDetails(s,JSON.parse(JSON.stringify(e.configDetails.workflow_configurations))),s=this.addPredefinedCriteriaFields(s);let n=moduleRecordMapping[t.queryParams.module];this.crmWorkflow.moduleDetails=r.moduleDetails={name:t.queryParams.module,plural_label:n.plural_label,singular_label:n.singular_label,api_name:n.api_name,id:n.id},r.configurationLimits=e.configLimit.rules_count,r.configurationDetails=s,this.crmWorkflow.configurationDetails[t.queryParams.module]=s,r.triggerSummaryComp="crm-workflow-trigger-summary",r.criteriaSummaryComp="crm-workflow-criteria-summary",this.currentModel={workflowDetails:r},commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return this.renderWorkflowRuleComp()},afterRender:function(){this.workflowCreateEditPageAfterRenderHandlings()},actions:{willTransition:function(e){!this.isRuleEdited()||e.data&&e.data.from&&"cancel"===e.data.from||e.extraDetails&&e.extraDetails.from&&"save"===e.extraDetails.from||(commonUtils.showHideLoadingDiv(!1),this.pauseTheTransaction(e))},onBeforeLoad:function(){this.clearMergeFieldsCache&&this.clearMergeFieldsCache()}},beforeExit:function(){this.workflowCreateEditPageBeforeExitHandlings()},didDestroy:function(){this.workflowCreateEditPageDidDestroyHandlings()}},{mixins:["crm-merge-field-mixin","crm-workflow","workflow","crm-workflow-actions","crm-automation-actions","crm-workflow-triggers","crm-workflow-criteria","workflow-utils"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.index-workflow-rule",{lyteConvertionSupported:!0,getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getListViewDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getListViewResources()},beforeModel:function(){this.isFeatureAvailable()||this.transition.abort()},model:function(){return this.wfModel()},afterModel:function(e){e.isError?this.transition.abort():(this.crmWorkflow.step=e.step="listView",this.currentModel=this.wfAfterModel(e),this.setWhiteBG(),this.showSideSetupmenu())},renderTemplate:function(){return{outlet:"#result",component:"workflow-rule"}},afterRender:function(){Crm.trackSpotLightAction("Workflow Rules - Page Visited"),this.addWorkflowEventListener("crm-list-wf-event-listeners");var e=this.transition.extraDetails;e&&e.highlight&&e.ruleId&&this.highlightSavedWFRule(e),this.renderWorkflowSuggestion(),this.renderWorkflowCallsBanner(),gS.trackOnboardUsingPF(RebrandLinkUtil.getProperties("PF_ACCESSED_WORKFLOW").PF_ACCESSED_WORKFLOW);const t=document.querySelector("#setup_new_ContentDiv");this.resizeObserver=new ResizeObserver((()=>this.resizeWFTable())),this.resizeObserver.observe(t),this.checkAndShowCreatePopup()},beforeExit:function(){var e=$L("#wfRulesTable")[0];ResizeObserver.length&&this.resizeObserver&&e&&(this.resizeObserver.unobserve(e),this.resizeObserver.disconnect())},didDestroy:function(){this.removeWorkflowEvents()},checkAndShowCreatePopup:function(){if(featuresAvailable.NEXTGENUI_ENABLED&&this.transition.data&&this.transition.data.showCreatePopup){var e={modulesList:this.crmWorkflow.modulesList};this.transition.data.module&&(e.module=this.transition.data.module),this.openWFCreatePopup(e)}}},{mixins:["crm-workflow-triggers","crm-workflow-actions","crm-workflow-rules","workflow","workflow-utils","crm-workflow-criteria","workflow-config-details","automation","crm-workflow"],services:["workflow"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.summary-workflow-rules",{lyteConvertionSupported:!0,queryParams:["module"],getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getListViewDependencies()},getResources:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getListViewResources()},model:function(e){return this.transition.data.list_view=!1,void 0===e.queryParams.module||this.transition.data.module?this.transition.data.module||Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"}):this.transition.data.module=this.fetchModuleDetails(e.queryParams.module).api_name,this.wfModel()},afterModel:function(e){e.isError?this.transition.abort():(this.crmWorkflow.step=e.step="summaryView",this.currentModel=this.wfAfterModel(e))},renderTemplate:function(){return{outlet:"#result",component:"workflow-rule",reRender:!0}},afterRender:function(){Crm.trackSpotLightAction("Workflow Rules - Page Visited"),this.addWorkflowEventListener("crm-list-wf-event-listeners"),this.renderWorkflowCallsBanner()},beforeExit:function(){wfNew.resetWFObjs(),store.unloadAll("workflow_rules")},didDestroy:function(){this.removeWorkflowEvents()}},{mixins:["crm-workflow-triggers","crm-workflow-actions","crm-workflow-rules","workflow","crm-workflow-criteria","workflow-config-details","automation","workflow-criteria","workflow-triggers","crm-workflow"],services:["workflow"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.view-usage",{queryParams:["tab"],getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-workflow-reports-usage.js","automation/workflow/crm-workflows.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["scoringrules_store.js"],ResourceConstants.CRMClient))},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-workflow-view-usage.js","crm-workflow-rules.js","crm-workflow-migration-suggestion.js","lyte-daterangepicker.js","lyte-dateselect.js"],ResourceConstants.CRMClient);return e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["scoringrules_store.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-automation-help-link.js","automation/common/crm-automation-actions-helper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowrule"),networkUtils.getI18nJSUrl("workflowreports"),networkUtils.getI18nJSUrl("actionlistlabel")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["automation-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},beforeModel:function(){featuresAvailable.WORKFLOW_REPORT||(this.handleWFErrors(void 0,{code:"NO_PERMISSION"}),this.transition.abort())},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=this.getQueryParamValues(),r=e.dynamicParam,s=this.isruleDetailsPresent(r);return Lyte.resolvePromises({usage:store.findRecord("workflow_usage",r,t),ruleDetails:s?store.peekRecord("workflow_rule",r):store.findRecord("workflow_rule",r)}).then(function(e){if(void 0!==e.ruleDetails&&Object.keys(e.ruleDetails).length>0){var t={},r={module:e.ruleDetails.module.api_name},s=e.ruleDetails.execute_when;return null!==s.details.trigger_module&&s.details.trigger_module&&s.details.trigger_module.api_name!==r.module&&(r.trigger_module=s.details.trigger_module.api_name),e.ruleDetails.deprecated&&(r.deprecated=!0,t.migrationSuggestions=store.findRecord("workflow_migration_suggestion",e.ruleDetails.id,!0)),"platform_plugin"!==e.ruleDetails.source&&"marketplace_plugin"!==e.ruleDetails.source||(t.pluginDetails=store.findAll("dummy",{id:e.ruleDetails.id,resource:"plugin_details"},!0,!1,{url:"/crm/v2/definition"})),t.usage=e.usage,t.ruleDetails=e.ruleDetails,t.confDetails=store.findAll("workflow_client_configuration",r,!0,!1),Lyte.resolvePromises(t).then(null,function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))}return e}.bind(this),function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))},afterModel:function(e,t){if(e.isError)this.transition.abort();else{this.crmWorkflow.step="usage";var r=this.getQueryParamValues();if(this.currentModel.parentTab=t.queryParams.tab||"workflow",!e.ruleDetails||0===Object.keys(e.ruleDetails).length||!e.usage||0===Object.keys(e.usage).length){let e="crm.settings.section.workflow-rules.index-workflow-rule";if("workflow-listview"===this.currentModel.parentTab)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.title"),ltPropType:"error"}});else{e="workflow"===this.currentModel.parentTab?e:"crm.settings.section.workflow-insights";let t=[{type:"accept",text:I18n.getMsg("crm.button.ok.gotit"),appearance:"failure"}];_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.title"),ltPropSecondaryMessage:I18n.getMsg("crm.workflow.rule.deleted.msg.info"),ltPropButtons:t,ltPropButtonPosition:"right"}}),Lyte.Router.transitionTo({route:e})}Lyte.Router.transitionTo({route:e}),this.transition.abort()}this.currentModel.usage=Array.isArray(e.usage)?e.usage[0]:e.usage,this.currentModel.executedFrom=r.executed_from,this.currentModel.executedTill=r.executed_till,"workflow"===this.currentModel.parentTab&&(this.hideSideSetupmenu(),$L("#setupshow").addClass("setupShowWorkflowReports")),commonUtils.showHideLoadingDiv(!1)}},renderTemplate:function(){return this.setWhiteBG(),{outlet:"#result",component:"crm-workflow-view-usage"}},afterRender:function(e){this.renderCallsMigrationBanner(e.ruleDetails,e.migrationSuggestions,e.pluginDetails)},getQueryParamValues:function(){var e=this.transition.data,t=e.executed_from,r=e.executed_till,s=$L.moment($L.moment().local().timezone(Crm.userDetails.orgTimeZone).format("YYYY-MM-DD")).local().timezone(Crm.userDetails.orgTimeZone).toDate().getTime(),n=s-6048e5+864e5;return{executed_from:t=t||Utils.convertDateToUserPattern($L.moment(n).toDate(),"YYYY-MM-DD",!0),executed_till:r=r||Utils.convertDateToUserPattern($L.moment(s).toDate(),"YYYY-MM-DD",!0)}},isruleDetailsPresent:function(e){var t=store.peekRecord("workflow_rule",e);return t&&t.conditions},beforeExit:function(){var e;switch(this.getQueryParams().tab){case"workflow-listview":this.crmWorkflow.fieldsPromiseCache={},this.crmWorkflow.criteriaFields={},e="listView";break;case"workflow":e="edit";break;default:e="usage",this.crmWorkflow.fieldsPromiseCache={},this.crmWorkflow.criteriaFields={}}this.crmWorkflow.step=e},didDestroy:function(){$L("#setupshow").removeClass("setupShowWorkflowReports"),$L("#result")[0].classList.remove("h100_per"),store.unloadAll("workflow_usage")}},{mixins:["crm-workflow","crm-workflow-criteria","crm-automation-actions","crm-workflow-triggers","workflow-utils"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.view-workflow-rule",{lyteConvertionSupported:!0,getDependencies:function(){return Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageDependencies()},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-crux-tag-comp-wrapper.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient))).concat(Lyte.Router.getRouteInstance("crm.settings.section.workflow-rules").getCreateEditPageResources())},beforeModel:function(){this.isFeatureAvailable()||this.transition.abort()},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getDynamicParam(),t={};return store.findRecord("workflow_rule",e,!1,!1,{}).then(function(r){if(t.ruleDetails=JSON.parse(JSON.stringify(r)),Object.keys(r).length){var s=r.module.api_name,n=Lyte.registeredMixins["crm-automation-actions"].fetchModuleName(s,r.module.id);if(!this.isCreateEditWFAllowedForModule(n))return this.handleWFErrors(void 0,{code:"NO_PERMISSION"}),{isError:!0};var i={module:s};return r.deprecated&&(i.deprecated=!0),r.module.api_name!==r.execute_when.details.trigger_module.api_name&&(t.isRelatedTrigger=!0,i.trigger_module=r.execute_when.details.trigger_module.api_name),t.clientConfigDetails=store.findAll("workflow_client_configuration",i,!0,!1),t.configDetails=store.findAll("workflow_configuration",{module:s},!0,!1),t.moduleFields=store.findAll("field",{module:s,type:"all"},!1,!0,{apiVersion:"2.2"}),t.configLimit=store.findAll("dummy",{},!1,!1,{url:"/crm/v8/settings/automation/workflow_rules/actions/rules_count",method:"GET"}),t.moduleVsCriteriaFields=this.getCriteriaFieldOnEdit(r),r.deprecated&&(t.migrationSuggestions=store.findRecord("workflow_migration_suggestion",r.id,!0)),"platform_plugin"!==r.source&&"marketplace_plugin"!==r.source||(t.pluginDetails=store.findAll("dummy",{id:e,resource:"plugin_details"},!0,!1,{url:"/crm/v2/definition"})),Lyte.resolvePromises(t).then(null,function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))}return t}.bind(this),function(e){return this.handleWFErrors(void 0,JSON.parse(e.responseText)),{isError:!0}}.bind(this))},afterModel:function(e){if(e.isError)this.transition.abort();else{var t={};if(Object.keys(e.ruleDetails).length)(t=this.postProcessWFModelData(e,"edit")).migrationSuggestions=e.migrationSuggestions,t.workflowDetails.step="edit",t.pluginDetails=e.pluginDetails,commonUtils.showHideLoadingDiv(!1);else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.workflow.rule")),ltPropType:"error"}}),this.transition.abort(),Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"});this.currentModel=t}},renderTemplate:function(){return this.renderWorkflowRuleComp()},actions:{willTransition:function(e){if("crm.settings.section.workflow"==e.target&&(e.data={reload:!0}),LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,s=0;s<r;s++)t[s].$node.id&&"chat-popup"==t[s].$node.id&&t[s].setData("ltPropBindToBody",!1);!this.isRuleEdited()||e.data&&e.data.from&&"cancel"===e.data.from||e.extraDetails&&e.extraDetails.from&&("save"===e.extraDetails.from||"clone"===e.extraDetails.from||"delete"===e.extraDetails.from)||(commonUtils.showHideLoadingDiv(!1),this.pauseTheTransaction(e))}},afterRender:function(e){this.renderCallsMigrationBanner(e.workflowDetails.ruleDetails,e.migrationSuggestions,e.pluginDetails),this.workflowCreateEditPageAfterRenderHandlings()},onBeforeLoad:function(){this.clearMergeFieldsCache&&this.clearMergeFieldsCache()},beforeExit:function(){(this.workflowCreateEditPageBeforeExitHandlings(),featuresAvailable.NEXTGENUI_ENABLED)&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!0)},didDestroy:function(){this.workflowCreateEditPageDidDestroyHandlings()}},{services:["workflow"],mixins:["crm-merge-field-mixin","workflow","crm-workflow","crm-automation-actions","crm-workflow-actions","crm-workflow-triggers","crm-workflow-criteria","workflow-utils"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules",{lyteConvertionSupported:!0,getDependencies:function(){var e=getworkflowjsfiles(!0),t=networkUtils.returnDependencyFiles(e,ResourceConstants.CRM);return t=t.concat(networkUtils.returnDependencyFiles(["store_workflow_rules.js"],ResourceConstants.CRMClient))},getResources:function(){return networkUtils.returnDependencyFiles(["crm-workflow-rule-common.js","crm-workflow-fieldupdate-trigger.js","crm-sectionupdate-component.js","crm-automation-actions.js","crm-userassociations-datastore.js"],ResourceConstants.CRMClient)},redirect:function(){if(wfmergefield.initMergeFieldDetl("workflow"),"crm.settings.section.workflow-rules"==this.transition.target)(e=Object.assign({},this.transition.info)).route="crm.settings.section.workflow-rules.index-workflow-rule",this.replaceWith(e);else if("crm.settings.section.workflow-rules.view-workflow-rule"==this.transition.target){var e;if(this.transition.url.includes("/show-summary"))(e=Object.assign({},this.transition.info)).route="crm.settings.section.workflow-rules.index-workflow-rule",this.replaceWith(e)}else"crm.settings.section.workflow-rules.index-workflow-rule"===this.transition.target&&store.clearCachedQuery("workflow_rule")},beforeExit:function(){store.clearCachedQuery("module",{feature_name:"workflow"}),"object"==typeof wfmergefield&&wfmergefield.clearMergeFieldDetl(),Crm.isWorkflowSuggestionEnabled&&store.unloadAll("workflow_suggestion"),$.ui.ddmanager.current=null,store.unloadAll("workflow_rule")},getListViewDependencies:function(){return networkUtils.returnDependencyFiles(["automation/workflow/workflow_mixins.js","list_workflow.js","automation/workflow/crm-workflows.js","crm-workflow-rules.js"],ResourceConstants.CRMClient)},getListViewResources:function(){var e=networkUtils.returnDependencyFiles(["workflow_rules.js","crm-automation-help-link.js","crm-workflow.js","crm-automation-common-mixin.js","crm-workflow-migration-suggestion.js","workflow-suggestion-components.js","workflow-recommendation.js","scoringrules_store.js","crm-wf-score-info.js","crux-lazyLoad.js"],ResourceConstants.CRMClient),t=Crm.nextGenInfo&&"dark"===Crm.nextGenInfo.mode?"workflow-dark-theme.css":"workflow-light-theme.css";return{parent:e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["list_workflow_rules_library-rtl.css","common_workflow-rtl.css",t],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["list_workflow_rules_library.css","common_workflow.css",t],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowrule"),networkUtils.getI18nJSUrl("workflow"),networkUtils.getI18nJSUrl("datebasedworkflow"),networkUtils.getI18nJSUrl("actionlistlabel"),networkUtils.getI18nJSUrl("WFTriggerSummary")],ResourceConstants.CRM)),child:networkUtils.returnDependencyFiles(["crm-workflow-theme.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}},getCreateEditPageDependencies:function(){return networkUtils.returnDependencyFiles(["automation/workflow/crm-workflows.js","automation/workflow/workflow_mixins.js","workflow_library.js"],ResourceConstants.CRMClient)},getCreateEditPageResources:function(){var e=networkUtils.returnDependencyFiles(["crm-track-spotlight.js","crm-workflow.js","crm-automation-common-mixin.js","crm-workflow-migration-suggestion.js","scoringrules_store.js","crm-wf-score-info.js"],ResourceConstants.CRMClient),t=Crm.nextGenInfo&&"dark"===Crm.nextGenInfo.mode?"workflow-dark-theme.css":"workflow-light-theme.css";return e=(e=(e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["workflow_library-rtl.css","common_workflow-rtl.css",t],ResourceConstants.CRMClient)):e.concat(networkUtils.returnDependencyFiles(["workflow_library.css","common_workflow.css",t],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("WFTriggerSummary"),networkUtils.getI18nJSUrl("workflowactions")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-crux-tag-comp-wrapper.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowrule"),networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),{parent:e=isnewCalendarBookingEnabled?e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM)):e,child:networkUtils.returnDependencyFiles(["crm-workflow-theme.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}},actions:{willTransition:function(){closeAsapWidget()}}}),Lyte.Router.registerRoute("crm.settings.section.zia.besttime.analytics",{model:function(){var e={};e.analytics_summary=store.findAll("analytics_summary",{filter_by_period:"last_week"},!0);return e.duration=store.findAll("dummy",{key:"BEST_TIME_ANALYTICS_ENABLED_DURATION"},!1,!1,{url:"/crm/v4/__internal/crm_nc_key_values"}),Lyte.resolvePromises(e)},afterModel:function(e){var t=this.getBestTimeAnalyticsEnabledDays(e.duration.crm_nc_key_values.value),r=e.analytics_summary;return t<7?this.currentModel={analyticsSummaryObj:r.analytics_summary,analytics_summary:r,days_since_analytics_enabled:t}:r.length>0?this.currentModel={analyticsSummaryObj:this.constructAnalyticsObj(r),analytics_summary:r,days_since_analytics_enabled:t}:this.currentModel={analyticsSummaryObj:r,analytics_summary:r,days_since_analytics_enabled:t}},renderTemplate:function(){var e=this.currentModel.days_since_analytics_enabled;return this.currentModel.analytics_summary.length>0&&e>=7?{component:"crm-besttime-analytics",outlet:"#result"}:{component:"crm-besttime-analytics-empty",outlet:"#result"}},beforeExit:function(){this.unbindAnalyticsDataFromComponents()},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}},{mixins:["crm-besttime-analytics-helper"]}),Lyte.Router.registerRoute("crm.settings.section.zia.besttime",{getResources:function(){return networkUtils.returnDependencyFiles(["besttime-analytics-mixin.js","besttime-analytics.js","zia-helpers.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-besttime-analytics.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("besttimeanalytics"),networkUtils.getI18nJSUrl("ZiaSegmentation")],ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["besttime-analytics-model.js","business_hours-model.js"],ResourceConstants.CRMClient))},beforeExit:function(){this.unbindAnalyticsDataFromComponents()}},{mixins:["crm-besttime-analytics-helper"]}),Lyte.Router.registerRoute("crm.settings.section.zia.custom-ai",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-zia-custom-ai-solutions.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-zia-custom-ai-solutions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CustomAI")],ResourceConstants.CRM))},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}},lyteConvertionSupported:!0,renderTemplate:function(){return Crm.client_tracking("Zia Custom AI solution",{subfeature:"Visited"}),{outlet:"#result",component:"crm-zia-custom-ai"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.anomaly",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js","crm-analytical-component-model.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zia/anomaly/customview_model.js"],ResourceConstants.CRMClient))},getResources:function(){var e=networkUtils.returnDependencyFiles(["zia-notification.js","crm-zianotification-mixin.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification"),networkUtils.getI18nJSUrl("CVAnomalyConfig")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zia/anomaly/customview_config.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zia/anomaly/customview_config.js"],ResourceConstants.CRMClient));return crmConstants.isGoogle_ChatEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))),e},model:function(){var e={};if(newDashbordsEnabled){e.custom_configs=store.findAll("analytics_component",{filters:{comparator:"equal",field:{api_name:"type"},value:"trends"}},void 0,!0,{apiVersion:"2.2"})}else e.custom_configs=networkUtils.lyteInitiateRequest("/crm/v2/Analytics/components","GET",{params:{filters:'[{"comparator":"equal","field":"component_type","value":"trends"}]'}}).then((function(e){return e}),(function(){return[]}));e.anomalyNotificationInfo=networkUtils.lyteInitiateRequest("/crm/v2/__internal/Analytics/actions/new_anomaly_notification","GET").then((function(e){return e}),(function(){return[]})),e.all_configs=store.findAll("zia_notification_setup",{type:"anomaly"}),e.common_config=store.findAll("zia_notification_common_config",{type:"anomaly"}),e.cv_anomaly_avl=!1,e.cv_anomaly={};var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};window.clientPortalName&&(t["X-CRMPORTAL"]=window.clientPortalName);var r={payLoad:void 0};r.header=t;var s={};return e.cv_anomaly=store.triggerAction("cv_anomaly","getConfig",r,{},"GET").then((function(t){return e.cv_anomaly_avl=!0,t&&t.custom_view_anomaly&&(s.config=t.custom_view_anomaly),s}),(function(){return e.cv_anomaly_avl=!1,new Promise((function(e){e(s)}))})),Lyte.resolvePromises(e)},afterModel:function(e){if(void 0!==e.custom_configs&&!e.custom_configs.components){for(var t=e.custom_configs,r=[],s=t.length,n=0;n<s;n++)r.push(t[n]);delete e.custom_configs,e.custom_configs={Analytics_Components:r}}var i=!1;e.anomalyNotificationInfo&&e.anomalyNotificationInfo.new_anomaly_notification&&(i=e.anomalyNotificationInfo.new_anomaly_notification.enabled);var o=[];e.all_configs.configurations.each((function(e){e.notify_for&&"system"===e.notify_for.type&&o.push(e)}));var a,l=e.common_config;if(a=void 0!==l?l.mediums:[],e.custom_configs){var c=this.convertComponentsToConfigObj(newDashbordsEnabled?e.custom_configs.Analytics_Components:e.custom_configs.components,e.all_configs.configurations,i),u=c.configs.length;for(n=0;n<u;n++)c.configs[n].mediums=a;return this.currentModel={type:"anomaly",anomalyconfigs:o,custAnomalyconfigs:c.configs,isNewAnomalyNotificationEnabled:i,isCommonConfigEnabled:!0,cv_anomaly_avl:e.cv_anomaly_avl,cv_anomaly:e.cv_anomaly,isAdmin:Crm.userDetails.IS_ADMIN}}return this.currentModel={type:"anomaly",anomalyconfigs:o,custAnomalyconfigs:null,isCommonConfigEnabled:!0,cv_anomaly_avl:e.cv_anomaly_avl,cv_anomaly:e.cv_anomaly,isAdmin:Crm.userDetails.IS_ADMIN}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result"}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}},{mixins:["crm-zianotification-helper"]}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.index",{}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.presentation",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification"),networkUtils.getI18nJSUrl("PresentationNotification")],ResourceConstants.CRM);return networkUtils.returnDependencyFiles(["zia-notification.js"],ResourceConstants.CRMClient).concat(e)},model:function(){return Crm.client_tracking("ZiaPresentation-Setup Click"),Lyte.resolvePromises({wfconfigs:store.findAll("zia_notification_setup",{type:"presentation"})})},afterModel:function(e){return this.currentModel={type:"presentation",wfconfigs:e.wfconfigs.configurations}},renderTemplate:function(){Lyte.Router.transitionTo({route:"crm.settings.section.zia.presentations.index"})},actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},beforeExit:function(){store.unloadAll("zia_notification_settings"),store.unloadAll("zia_notification_setup")}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.workflow",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zia-notification.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["chat-integ-store.js"],ResourceConstants.CRMClient));return crmConstants.isGoogle_ChatEnabled&&(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))),e},model:function(){var e=store.findAll("zia_notification_setup",{type:"workflow"}),t=store.findAll("zia_notification_common_config",{type:"workflow"});return Lyte.resolvePromises({zia_notification_setup:e,zia_notification_common_config:t})},afterModel:function(e){var t=e.zia_notification_setup.configurations,r=e.zia_notification_common_config,s=!1;return void 0!==r&&(s=r.enabled),this.currentModel={type:"wf",wfconfigs:t,isCommonConfigEnabled:s}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result",reRender:!0}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.ziaforemail",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["zia-notification.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"],ResourceConstants.CRM))},model:function(){var e=store.findAll("zia_notification_setup",{type:"zia_for_emails"}),t=store.findAll("zia_notification_common_config",{type:"zia_for_emails"});return Lyte.resolvePromises({zia_notification_setup:e,zia_notification_common_config:t})},afterModel:function(e){var t=e.zia_notification_setup.configurations,r=e.zia_notification_common_config,s=!1;return void 0!==r&&(s=r.enabled),this.currentModel={type:"ZE",ziaforemailconfigs:t,isCommonConfigEnabled:s}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result",reRender:!0}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.analytics.view",{renderTemplate:function(){return{component:"crm-prediction-analytics",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}},beforeExit:function(){$(".predictionanalyticsviewcontainer").off("scroll"),$L("#setup_new_ContentDiv").removeClass("predictionanalyticsviewcontainer")}},{mixins:["crm-prediction-analytics-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.analytics",{getDependencies:function(){if(commonUtils.showHideLoadingDiv(!0),!store.modelFor("org"))return networkUtils.returnDependencyFiles(["org-model.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["zia/prediction/analytics/prediction-analytics.js","zia/prediction/analytics/prediction-analytics-mixins.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(Crm.userDetails.RTL_ENABLED?["zia/prediction/analytics/prediction-analytics.css","zia/prediction/analytics/prediction-analytics-rtl.css"]:["zia/prediction/analytics/prediction-analytics.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zia/prediction/analytics/prediction-analytics.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PredictionAnalytics")],ResourceConstants.CRM))},beforeModel:function(){this.start=$L.moment("").toDate()},model:function(){var e=store.peekAll("field_prediction");if(e.length>0){commonUtils.showHideLoadingDiv(!0);var t=this.transition.data,r=t.predictionId?t.predictionId:e[0].id,s=store.peekRecord("field_prediction",r),n=store.peekAll("org"),i=this;return Lyte.resolvePromises({predictions:e,prediction:void 0===s.field_contributors?store.findRecord("field_prediction",r):s,org:n.length>0?n:store.findAll("org"),models:store.findRecord("dummy",r,{},void 0,!1,{url:"crm/v2.2/settings/zia/predictions/"+r+"/models"}),fields:store.findAll("field",{module:s.module.api_name,type:"all"},void 0,!0,{apiVersion:"2.2"})}).then((function(e){var r=i.preProcess(Array.isArray(e.prediction)?e.prediction[0]:e.prediction,e.models,e.fields);return{predictions:e.predictions,prediction:Array.isArray(e.prediction)?e.prediction[0]:e.prediction,org:e.org,models:e.models,isModelAvailable:r.isModelAvailable,isPredictionAvailable:r.isPredictionAvailable,activeRecords:r.activeRecords,isClassification:r.isClassification,isSingle:r.isSingle,filterValue:t.predictionId?"all":"last_week",module:r.module,fields:r.fields,isDateOrTime:r.isDateOrTime,delayedRecordsHeaders:r.delayedRecordsHeaders,isClosedWon:r.isClosedWon,isClosedLost:r.isClosedLost,segmentsHeaders:r.segmentsHeaders,winLossHeaders:r.winLossHeaders}}))}return{predictions:[]}},renderTemplate:function(){return{component:"crm-prediction-analytics",outlet:"#result"}},beforeExit:function(){$(".predictionanalyticsviewcontainer").off("scroll"),$L("#setup_new_ContentDiv").removeClass("predictionanalyticsviewcontainer");var e=$L.moment("").toDate()-this.start,t=parseInt(e/6e4%60),r=0;r=t>=0&&t<=1?"< 1 min":t>1&&t<=5?"1 to 5 min":t>5&&t<=10?"5 to 10 min":">10 min",Crm.client_tracking("Time spent in prediction analytics page",{Time:r})}},{mixins:["crm-prediction-analytics-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.churn.create",{model:function(){return Crm.client_tracking("New Churn Prediction Click"),commonUtils.showHideLoadingDiv(!0),Crm.churnCount<Crm.churnLimit?{churn_prediction:store.createRecord("churn_prediction")}:void 0},renderTemplate:function(){return{component:"crm-churn-prediction-create",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{willTransition:function(e){this.checkIsDirty(e,"churn_prediction")}}},{mixins:["crm-prediction-utils","crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.churn.edit",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getPredictionConfigById(this.getDynamicParam(),"churn_prediction","payment_date")},model:function(){return this.error?void 0:this.getConfigDependenciesById("churn_prediction",this.getDynamicParam(),!1)},afterModel:function(){this.error||(this.currentModel={churn_prediction:store.peekRecord("churn_prediction",this.getDynamicParam()),isEditView:!0})},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-churn-prediction-create",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{willTransition:function(e){this.checkIsDirty(e,"churn_prediction")}}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.churn.list",{model:function(){return{churn_prediction:store.peekAll("churn_prediction"),configuredModules:this.getConfiguredModulesByFeature("churn_prediction","customer_module"),isPredictionAvailable:Crm.churnCount<Crm.churnLimit}},renderTemplate:function(){return{component:"crm-churn-prediction-list",outlet:"#result"}}},{mixins:["crm-prediction-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.churn.view",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getPredictionConfigById(this.getDynamicParam(),"churn_prediction","payment_date")},model:function(){return this.error?void 0:this.getConfigDependenciesById("churn_prediction",this.getDynamicParam(),!0)},afterModel:function(){var e=this;return e.error?void 0:e.processPredictionMeta(store.peekRecord("churn_prediction",e.getDynamicParam()),e.currentModel,"churn").then((function(t){return e.currentModel=t}))},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-churn-prediction-view",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.churn",{getResources:function(){return networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ChurnPrediction")],ResourceConstants.CRM))}}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.field.create",{model:function(){return commonUtils.showHideLoadingDiv(!0),Crm.predictionCount<Crm.predictionLimit?{prediction:store.createRecord("field_prediction",{follow_up:!0}),from:this.transition.data.from?this.transition.data.from:"create",notificationBatch:this.transition.data.notificationBatch?this.transition.data.notificationBatch:void 0}:void 0},renderTemplate:function(){return{component:"crm-field-prediction-create",outlet:"#result",reRender:!0}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{willTransition:function(e){this.checkIsDirty(e,"field_prediction")}}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.field.edit",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getPredictionConfigById(this.getDynamicParam(),"field_prediction","field_contributors")},model:function(){return this.error?void 0:this.getConfigDependenciesById("field_prediction",this.getDynamicParam(),!1)},afterModel:function(){if(!this.error){var e=store.peekRecord("field_prediction",this.getDynamicParam()),t=e.predict_field.ui_type===CrmField.UITYPES.PICK_LIST||e.predict_field.ui_type===CrmField.UITYPES.STAGE;if(this.currentModel.consent_module&&this.currentModel.consent_module.length>0){let t=e.module.fields.slice(0),r=this.getRequiredConsentFieldsColumnNames(t);if(r.length>0){let s=this.currentModel.consent_module[0].fields,n=s.length;for(let e=0;e<n;e++)r.includes(s[e].column_name)&&(t.push(s[e]),r.splice(e,1));e.module.fields=t}}this.currentModel={prediction:e,isEditView:!0,mandatory:t?"":"newmandatory"}}},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-field-prediction-create",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{willTransition:function(e){this.checkIsDirty(e,"field_prediction")}}},{mixins:["crm-prediction-route-utils","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.field.list",{model:function(){return this.currentModel={prediction:store.peekAll("field_prediction"),configuredModules:this.getConfiguredModulesByFeature("field_prediction","module"),isPredictionAvailable:Crm.predictionCount<Crm.predictionLimit,isChurnAvailable:Crm.isChurnAvailable}},renderTemplate:function(){return{component:"crm-field-prediction-list",outlet:"#result"}}},{mixins:["crm-prediction-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.field.view",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getPredictionConfigById(this.getDynamicParam(),"field_prediction","field_contributors")},model:function(){return this.error?void 0:this.getConfigDependenciesById("field_prediction",this.getDynamicParam(),!0)},afterModel:function(){var e=this;return e.error?void 0:e.processPredictionMeta(store.peekRecord("field_prediction",e.getDynamicParam()),e.currentModel,"field").then((function(t){return e.currentModel=t}))},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-field-prediction-view",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},beforeExit:function(){$("#setup_new_ContentDiv").off("scroll")}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder.field",{getResources:function(){return networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FieldPrediction")],ResourceConstants.CRM))}}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.builder",{getResources:function(){return networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-mixins.js","zia-commons.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Prediction")],ResourceConstants.CRM))},model:function(){return store.peekAll("field_prediction")},redirect:function(){"crm.settings.section.zia.prediction.builder"===this.transition.target&&Lyte.Router.transitionTo({route:"crm.settings.section.zia.prediction.builder.field.list"})}}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction",{getResources:function(){return networkUtils.returnDependencyFiles(["zia-error.js","crux-parent-form-component.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-zia-error.css"],ResourceConstants.CRMClient))},beforeModel:function(){store.unloadAll("field_prediction"),store.unloadAll("churn_prediction")},model:function(){return Crm.client_tracking("Prediction Tab Click"),Lyte.resolvePromises({field_prediction:store.findAll("field_prediction"),count:store.findAll("dummy",{},void 0,!1,{url:"crm/v2.2/__features/prediction"})}).then((function(e){return Crm.predictionLimit=e.count.__features[0].details.limits.total,Crm.predictionCount=e.count.__features[0].details.used_count.total,Crm.client_tracking("Field Prediction Tab Click"),Crm.client_tracking("Zia Prediction Builder Configuration",{"Sub features":"Visited"}),Lyte.resolvePromises({churn_prediction:store.findAll("churn_prediction"),count:store.findAll("dummy",{},void 0,!1,{url:"crm/v4/__features/churn_prediction"})}).then((function(e){Crm.churnLimit=e.count.__features[0].details.limits.total,Crm.churnCount=e.count.__features[0].details.used_count.total,Crm.isChurnAvailable=!0}),(function(){Crm.isChurnAvailable=!1}))}))},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}},beforeExit:function(){Crm.isChurnAvailable=!1,Crm.predictionLimit=Crm.predictionCount=Crm.churnLimit=Crm.churnCount=0}}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations.create",{model:function(){commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return{component:"crm-presentation-create",outlet:"#result",reRender:!1}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},lyteConvertionSupported:!0,actions:{willTransition:function(e){window.drp=void 0,this.component&&"crm.settings.section.zia.presentations.create"!==e.target&&!1===this.component.component.data.disableSaveBtn&&Lyte.registeredMixins["presentation-mixins"].routeChangeConfirm(e)}}},{mixins:["crm-presentation-mixins"]}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations.edit",{model:function(){var e=!0;void 0!==this.transition.data.fromList&&(e=this.transition.data.fromList);var t=Lyte.Router.getRouteInstance().getDynamicParam();return Lyte.resolvePromises({fromList:e,record:store.findRecord("presentations",t)})},afterModel:function(e){var t={isEdit:!0};t.fromList=e.fromList;var r=e.record[0];if(void 0!==r)return t.id=r.id,t.name=r.name,t.all_users=r.all_users,t.data_based_on=r.data_based_on,t.modules_preference=r.modules_preference,t.create_presentation_for=r.create_presentation_for,t.module_ids=r.module_ids,t.shared_to=r.shared_to,t.frequency=r.frequency,t.selectedModules=r.selectedModules,t.wmsEnabled=r.wmsEnabled,t.cliqEnabled=r.cliqEnabled,t.enabled=r.enabled,this.currentModel=t,this.currentModel;this.error=!0},renderTemplate:function(){return Crm.client_tracking("ZiaPresentation EditClick"),this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-presentation-create",outlet:"#result"}},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1},willTransition:function(e){window.drp=void 0,this.component&&"crm.settings.section.zia.presentations.create"!==e.target&&!1===this.component.component.data.disableSaveBtn&&Lyte.registeredMixins["presentation-mixins"].routeChangeConfirm(e)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations.index",{model:function(){return Lyte.resolvePromises({presentations:store.findAll("presentations")})},afterModel:function(){var e=store.peekAll("presentations"),t=Lyte.registeredMixins["presentation-mixins"];return this.currentModel={presentations:e,statusArray:t.getStatusArray(),configModules:t.getPresentationConfiguresTabs(e)}},renderTemplate:function(){return{component:"crm-presentation-list",outlet:"#result",reRender:!0}},actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},lyteConvertionSupported:!0},{mixins:["crm-presentation-mixins"]}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations.list",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js","crm-presentation-mixins.js"],ResourceConstants.CRMClient)},model:function(){return Lyte.resolvePromises({presentations:store.findAll("presentations")})},afterModel:function(e){var t=e.presentations,r=Lyte.registeredMixins["presentation-mixins"];return this.currentModel={configs:t,statusArray:r.getStatusArray(),configModules:r.getPresentationConfiguresTabs(t)}},renderTemplate:function(){return{component:"crm-presentation-list",outlet:"#result",reRender:!0}},actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations.view",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=this.getDynamicParam(),t=store.findRecord("presentations",e),r=store.findRecord("presentation_history",e);return Lyte.resolvePromises({configuration:t,history:r})},afterModel:function(e){var t=Lyte.registeredMixins["presentation-mixins"],r={};return void 0!==e.configuration[0]&&((r=e.configuration[0]).repeatInfoStr=t.getFrequencyI18NValue(e.configuration[0])),r.history=e.history,this.currentModel=r},renderTemplate:function(){return void 0===this.currentModel.repeatInfoStr&&(this.error=!0),this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-presentation-view",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}},{mixins:["crm-presentation-mixins"]}),Lyte.Router.registerRoute("crm.settings.section.zia.presentations",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-presentation-mixins.js","crm-presentation-config.js","crux-form-component.js","crux-parent-form-component.js","zia-error.js","crm-zia-context-help.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-presentation-config.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification"),networkUtils.getI18nJSUrl("PresentationConfiguration")],ResourceConstants.CRM))},actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},redirect:function(){"crm.settings.section.zia.presentations"===this.transition.info.route&&this.replaceWith("crm.settings.section.zia.presentations.index")}},{mixins:["crm-presentation-mixins"]}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#result",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics.view",{renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-analytics-detailedview"}},model:function(e){return Lyte.resolvePromises({recommendationAnalyticRecord:"noData"===e.dynamicParam?void 0:store.peekRecord("recommendation_analytics_meta",e.dynamicParam)})},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation-analytics.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}},willTransition:function(e){if("crm.settings.section.zia.recommendation-analytics.view"!==e.target){[".pieChartPlace",".pieChartPlace1",".recenttrendchart",".barchartanalyticsnew"].forEach((function(e){var t=$L(e);thirdPartyUtils.unbindHighcharts(t),thirdPartyUtils.unbindZohoCharts(t)})),window.drp=void 0}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.autosuggestion",{getDependencies:function(){return networkUtils.returnDependencyFiles(["autosuggestion-model.js","zia-notification-settings.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation_autosuggestion")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaEmail")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaNba")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaScore")],ResourceConstants.CRM);featuresAvailable.WRITING_ASSISTANT&&(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("WritingAssistant")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-zia-writing-assistant-mixin.js"],ResourceConstants.CRMClient)));var n=networkUtils.returnDependencyFiles(["zia/autosuggestion/crm-recommendation-autosuggestion.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),i=networkUtils.returnDependencyFiles(["zia/nbx/crm-nba-mixins.js"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["crm-recommendation-autosuggestion.js","crm-system-recommendation.js","zia/prediction/builder/prediction-mixins.js"],ResourceConstants.CRMClient).concat(t).concat(r).concat(s).concat(n).concat(e).concat(i)},beforeModel:function(){store.unloadAll("zia_notification_setup")},model:function(){var e,t,r=this;return Crm.userDetails.permissions.Crm_Implied_Manage_Writing_Assistant&&(e=store.findAll("zia_notification_setup",{type:"writing_assistant"}).then((function(e){return e}),(function(){return Object.assign({})}))),t=Crm.userDetails.ZIA_CONFIG_API_DEPRECATED?store.findAll("zia_notification_setup",{type:"autosuggestion"}).then((function(e){return e.configurations}),(function(){return Object.assign([])})):store.findAll("autosuggestion",{isOrgConfig:!0,isRecommendation:!0}).then((function(e){return e}),(function(){return Object.assign([])})),Lyte.resolvePromises({configs:t,ziaConfigs:e}).then((function(e){return Crm.userDetails.ZIA_CONFIG_API_DEPRECATED?e.nbxAvl=r.isNbxConfigAvailable(e.configs):e.nbxAvl=r.isNbxAvl(e.configs),Lyte.resolvePromises({configs:e.configs,nbxAvl:e.nbxAvl,ziaConfigs:e.ziaConfigs,rules:store.findAll("zia_score")}).then((function(e){return e}),(function(){return e}))}))},afterModel:function(e){e&&e.rules&&e.rules[0]&&Crm.client_tracking("Zia Score Sys Recommendation Click");var t=document.domain.indexOf("csez.zohocorpin.com")>-1?"csez":document.domain.indexOf("localzoho.com")>-1?"lz":"idc";return this.currentModel={isOrgConfig:!1,isRecommendation:!0,configs:e.configs,rules:e.rules,current_domain:t,ziaConfigs:[e.ziaConfigs],nbxAvl:e.nbxAvl}},renderTemplate:function(e){return{outlet:"#result",component:Crm.userDetails.ZIA_CONFIG_API_DEPRECATED?"crm-system-recommendation":"crm-recommendation-autosuggestion"}},actions:{onError:function(){crmui.showMsgBand("error",I18n.getMsg("crm.zia.config.not.saved"),1500)}}},{mixins:["crm-nba-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-create.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["recommendation-create.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),{whatModuleList:Lyte.registeredMixins["recommendation-util"].getWhatModuleList()}},afterModel:function(e){return commonUtils.showHideLoadingDiv(!1),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-creation-section"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.index",{},null)},willTransition:function(e){if("crm.settings.section.zia.recommendation.view"!==e.target){var t=this.component.getData("name"),r=this.component.getData("whatId");if(t||r||this.component.getData("editView")){var s=e;s.pause();var n=$L("#deletePredictionModal")[0];void 0!==n&&(n.ltProp("trans",s),n.ltProp("show",!0))}}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-create.css"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["recommendation-create.js"],ResourceConstants.CRMClient).concat(e)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("recommendations",e.dynamicParam);if(void 0!==t)return Lyte.registeredMixins["recommendation-util"].loadRecommendationModuleForEditAndView(this,t,!0)},model:function(e){return Lyte.registeredMixins["recommendation-util"].loadUnUseFieldForViewAndEdit(e.dynamicParam,!0)},afterModel:function(e){return Lyte.registeredMixins["recommendation-util"].modelLoaderForEdit(e)},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-creation-section"}},afterRender:function(e){$L(".link_btn").addClass("link_btn_edit").removeClass("link_btn"),commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.index",{},null)},willTransition:function(e){if("crm.settings.section.zia.recommendation.view"!==e.target){var t=$L("#deletePredictionModal")[0],r=$L("#saverecommendation")[0];if(void 0!==t&&void 0!==r&&!1===r.ltProp("disabled")){var s=e;s.pause(),t.ltProp("trans",s),t.ltProp("show",!0)}}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.gallery",{model:function(){var e=store.peekAll("recommendations").map((function(e){return e.whom_module.id})),t=store.peekAll("recommendation_gallery"),r=[],s=[];if(void 0!==(t=t.filter((function(t){return!e.contains(t.whom_module.id)})))){var n={};t.map((function(e){n[e.what_module.api_name]=e.what_module.id})),Object.values(n).map((function(e){r.push(store.peekRecord("module",e))})),n={},t.map((function(e){n[e.whom_module.api_name]=e.whom_module.id})),Object.values(n).map((function(e){s.push(store.peekRecord("module",e))}))}return commonUtils.showHideLoadingDiv(!0),t=t.sort((function(e,t){return e.based_module.plural_label<=t.based_module.plural_label?-1:1})).sort((function(e,t){return e.whom_module.plural_label<=t.whom_module.plural_label?-1:1})).sort((function(e,t){return e.what_module.plural_label<=t.what_module.plural_label?-1:1})),r=r.sort((function(e,t){return e.plural_label<=t.plural_label?-1:1})),s=s.sort((function(e,t){return e.plural_label<=t.plural_label?-1:1})),{recommendationGallery:t,recommendationGalleryOrgArray:t,apiNameList:r,apiNameListWhom:s}},afterModel:function(e){return commonUtils.showHideLoadingDiv(!1),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-gallery-comp"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.index",{queryParams:[{type:{refreshModel:!1,sticky:!1}}],getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-list.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["recommendation-list.css"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){var e=store.peekAll("recommendations"),t=e.sort((function(e,t){return new Date(e.created_time)-new Date(t.created_time)}));return{recommendationModuleArray:e,recommendationModuleArrayBySort:t,recommendationModuleArrayLen:e.length,profilename:Crm.userDetails.PROFILE_NAME,isManageProfile:void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Recommendation}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-list"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.recommendation",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-notification-setup.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["recommendation-notification-setup.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],ResourceConstants.CRM);return t.concat(e).concat(r)},model:function(){commonUtils.showHideLoadingDiv(!0);var e={url:"/crm/v6/settings/zia/recommendations/actions/configure_notification"};return store.triggerAction("recommendations","configure_notification",e,null,"GET")},afterModel:function(){commonUtils.showHideLoadingDiv(!1),Crm.client_tracking("Zia Recommendation NotificationSetup pageView")},renderTemplate:function(){return{component:"crm-recommendation-notification-setup",outlet:"#result"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-detailed.css"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["recommendation-detailed.js","orchestration_config.js","zia-helpers.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient);return t.concat(e).concat(r)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("recommendations",e.dynamicParam);if(void 0!==t)return Lyte.registeredMixins["recommendation-util"].loadRecommendationModuleForEditAndView(this,t,!1)},model:function(e){return Lyte.registeredMixins["recommendation-util"].loadUnUseFieldForViewAndEdit(e.dynamicParam,!1)},afterModel:function(e){var t=e.recommendationJson;return e.what_fields=t.what_module.fields,e.whom_fields=t.whom_module.fields,e.based_fields=t.based_module.fields,e.profilename=Crm.userDetails.PROFILE_NAME,commonUtils.showHideLoadingDiv(!1),e.consents_module&&e.consents_module.length>0&&(e.what_fields=Lyte.registeredMixins["recommendation-util"].checkAndAddConsentFields(t.what_module.api_name,t.what_module.fields,e.consents_module),e.whom_fields=Lyte.registeredMixins["recommendation-util"].checkAndAddConsentFields(t.whom_module.api_name,t.whom_module.fields,e.consents_module),e.based_fields=Lyte.registeredMixins["recommendation-util"].checkAndAddConsentFields(t.based_module.api_name,t.based_module.fields,e.consents_module)),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-detailedview"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}}}},{mixins:["crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["recommendations_analytics.js"],ResourceConstants.CRMClient);return commonUtils.showHideLoadingDiv(!0),store.modelFor("org")||(e=e.concat(networkUtils.returnDependencyFiles(["org-model.js"],ResourceConstants.CRMClient))),e},getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-analytics.js","recommendation-util.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["recommendation-analytics.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-zia-error.css"],ResourceConstants.CRMClient));return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation"),networkUtils.getI18nJSUrl("ZiaSegmentation")],ResourceConstants.CRM).concat(e)},model:function(){return Lyte.resolvePromises({recommendationAnalyticsLists:store.findAll("recommendation_analytics_meta",{include_inner_details:"recommendation.what_to,recommendation.whom_to,recommendation.based_on,recommendation.done_by,recommendation.active"})})},redirect:function(e){commonUtils.showHideLoadingDiv(!1),"crm.settings.section.zia.recommendation-analytics"===this.transition.target&&this.replaceWith("crm.settings.section.zia.recommendation-analytics.view",e.recommendationAnalyticsLists.$&&e.recommendationAnalyticsLists.$.meta&&e.recommendationAnalyticsLists.$.meta.last_visited_recommendation&&e.recommendationAnalyticsLists.$.meta.last_visited_recommendation.id?e.recommendationAnalyticsLists.$.meta.last_visited_recommendation.id:"noData")},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation-analytics.error",null)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation",{getDependencies:function(){return networkUtils.returnDependencyFiles(["recommendation-gallery.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation.js","recommendation-welcome-comp.js","zia-helpers.js","recommendation-util.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["recommendation.css","recommendation-welcome-comp.css"],ResourceConstants.CRMClient));return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],ResourceConstants.CRM).concat(e)},redirect:function(){"crm.settings.section.zia.recommendation"!==this.transition.target||(this.replaceWith("crm.settings.section.zia.recommendation.index",this.getDynamicParam()),Crm.userDetails.isZiaSetupMigRan)},model:function(e){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({recommendationModuleArray:0!==store.peekAll("recommendations").length?Promise.resolve(store.peekAll("recommendations")):store.findAll("recommendations"),recommendationGallery:void 0!==store.peekAll("recommendation_gallery")&&0===store.peekAll("recommendation_gallery").length?store.findAll("recommendation_gallery",{page:1,per_page:1500}):Promise.resolve(store.peekAll("recommendation_gallery"))}).then((function(){return commonUtils.showHideLoadingDiv(!1),e.displayPermissionDenied=!1,e}),(function(t){if(403===t.status)return e.displayPermissionDenied=!0,e;commonUtils.showHideLoadingDiv(!1)}))},renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-welcome-comp"}},didDestroy:function(){"crm.settings.section.zia.recommendation.index"===this.transition.target&&(store.unloadAll("recommendations"),store.unloadAll("recommendation_gallery"))}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-fileupload.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-email-intent.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-email-intent-create-view.js"],ResourceConstants.CRMClient);return e.concat(t).concat(s).concat(r)},model:function(){var e=store.findAll("dummy",{group_by:"with_training_data"},!1,!1,{url:"crm/v4/settings/zia/custom_email_intents/actions/grouped_counts",method:"GET"});return Lyte.resolvePromises(e).then((function(e){if(e.grouped_counts[1].count+e.grouped_counts[0].count>=10){var t={code:"LIMIT_EXCEEDS",details:{}};t.details.type="",Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}return e})).catch((function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}))},afterModel:function(e){this.currentModel={with_training_count:e.grouped_counts[0].count,without_training_count:e.grouped_counts[1].count}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-create-view"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-fileupload.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient),r=e.concat(t),s=networkUtils.returnDependencyFiles(["crm-email-intent-create-view.js"],ResourceConstants.CRMClient);return r.concat(s)},model:function(){var e=Lyte.Router.getRouteInstance().transition.data;if(e&&e.current_stage)return e;var t=this.getDynamicParam();return store.findRecord("custom_email_intents",t)},afterModel:function(e){if(e){var t=Lyte.Router.getRouteInstance().transition.data;return t&&t.isFromDetailsViewPage?this.currentModel={config:e,is_edit:!0,isFromEditPage:!0,isFromDetailsViewPage:t.isFromDetailsViewPage}:this.currentModel={config:e,is_edit:!0,isFromEditPage:!0}}_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.zia.CI.record.deleted"),ltPropType:"error",ltPropDuration:"6000"}}),Lyte.Router.transitionTo("crm.settings.section.zia.emailintent.customintent")},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-create-view"}},actions:{onError:function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent.emails_content",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-email-intent-mail-view.js"],ResourceConstants.CRMClient)},model:function(){var e=Lyte.Router.getRouteInstance().getDynamicParam(),t=store.triggerAction("custom_email_intents","emails_content",e,void 0,"GET");return Lyte.resolvePromises(t).then((function(e){return e}))},afterModel:function(e){if(e.id=Lyte.Router.getRouteInstance().getDynamicParam(),e.name)e.name=this.transition.data.name;else{var t=store.peekRecord("custom_email_intents",e.id);e.name=t.name}return this.currentModel={config:e,view:"emails_content"}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-mail-view"}},actions:{onError:function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent.files",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-email-intent-mail-view.js"],ResourceConstants.CRMClient)},model:function(){var e=Lyte.Router.getRouteInstance().getDynamicParam(),t=store.triggerAction("custom_email_intents","files_content",e,void 0,"GET");return Lyte.resolvePromises(t).then((function(e){return e}))},afterModel:function(e){if(e.id=Lyte.Router.getRouteInstance().getDynamicParam(),e.name)e.name=this.transition.data.name;else{var t=store.peekRecord("custom_email_intents",e.id);e.name=t.name}return this.currentModel={config:e,view:"files"}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-mail-view"}},actions:{onError:function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-email-intent-list-view.js"],ResourceConstants.CRMClient);return e.concat(r).concat(t)},model:function(){return store.findAll("custom_email_intents")},afterModel:function(e){return this.currentModel={CIList:e,showListView:!0}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-list-view",reRender:!0}},redirect:function(){this.transition.data.refresh&&(this.refresh().data=this.transition.data)},actions:{willTransition:function(e){"crm.settings.section.zia.emailintent.customintent"===e.target&&(e.data?e.data.refresh?delete e.data.refresh:e.data.refresh=!0:(e.data={},e.data.refresh=!0))},refreshRoute:function(){this.refresh()},onError:function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.customintent.view",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailintent")],ResourceConstants.CRM);return networkUtils.returnDependencyFiles(["crm-email-intent-detail-view.js"],ResourceConstants.CRMClient).concat(e)},model:function(){var e=this.getDynamicParam(),t=store.triggerAction("custom_email_intents","summary",e,void 0,"GET");return Lyte.resolvePromises(t).then((function(e){return e}))},afterModel:function(e){if(e){var t=Lyte.Router.getRouteInstance().transition.data;return this.currentModel={config:e.custom_email_intents[0],isFromCreateView:t.isFromCreateView}}return this.currentModel={nocontent:!0}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-detail-view"}},actions:{onError:function(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.routeerror",{afterModel:function(){var e=Lyte.Router.getRouteInstance().transition.data;if(e)return this.currentModel={isEmailIntelligenceDisabled:e.isEmailIntelligenceDisabled}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-email-intent.js"],ResourceConstants.CRMClient),t=e.concat(networkUtils.returnDependencyFiles(["crm-email-intent-helper.js"],ResourceConstants.CRMClient));e=e.concat(t);var r=networkUtils.returnDependencyFiles(["crm-email-intent-index.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-email-intent-list-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailintent")],ResourceConstants.CRM);return e.concat(r).concat(s).concat(n)},renderTemplate:function(){return{outlet:"#result",component:"crm-email-intent-index",reRender:!0}}}),Lyte.Router.registerRoute("crm.settings.section.zia.emailintent.index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-email-intent-list-view.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){var e={isOrgConfig:!0,isCommunication:!0},t=store.findAll("system_email_intents"),r=store.findAll("dummy",e,!1,!1,{url:"/crm/v2/setup/zia/config"});return Lyte.resolvePromises({sys_config:t,intelligence_config:r})},afterModel:function(e){var t=!1;return e.intelligence_config.configs[0].configs[2].status||(t=!0),this.currentModel={SIList:e.sys_config,showListView:!1,showActivateView:t,isEmailIntelligenceDisabled:!e.intelligence_config.configs[0].configs[0].status,intentConfigId:e.intelligence_config.configs[0].configs[0].config_id}},renderTemplate:function(){return{outlet:"#emailintent_results",component:"crm-email-intent-list-view"}},actions:{onError:function(e){if(e){var t=JSON.parse(e.responseText);Lyte.registeredMixins["crm-email-intent-mixin"].errorHandling(t)}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.inemailnew",{getResources:function(){var e=networkUtils.returnDependencyFiles(["ziainemail.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-email-intelligence.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["email-emotions.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["zia-notification-settings.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-emailsai-config.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-email-intelligence.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),o=t.concat(i).concat(n).concat(s).concat(r),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaemail")],ResourceConstants.CRM);return e.concat(a).concat(o)},model:function(){return Lyte.resolvePromises({zia_config:store.findAll("zia_notification_setup",{type:"email_intelligence"})}).then((function(e){return e.zia_config}))},renderTemplate:function(e){if(1===e.configs.length){var t=ZiaConfig.updateIsAllEnabled(e.configs);return{outlet:"#result",html:Handlebars.templates.ZiaConfigList({data:t,isCommunication:!0})}}return{outlet:"#result",component:"crm-email-intelligence",configs:e.configs,reRender:!0}},afterModel:function(e){var t=e.configurations.length;1!==t&&(this.currentModel={configs:e.configurations,no_of_configs:t})},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-create.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),{modules:Lyte.registeredMixins["similarity-utils"].getSupportedModules()}},afterModel:function(e){e.modules=e.modules.module.filter((function(e){return!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type})),e.similarities=store.peekAll("similarity"),commonUtils.showHideLoadingDiv(!1)},redirect:function(){const e={A:1,C:10,Z:1,U:10};let t=void 0!==e[Crm.userDetails.LICENSE_TYPE]?e[Crm.userDetails.LICENSE_TYPE]:0;"Z"===Crm.userDetails.LICENSE_TYPE&&void 0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&(t=10),this.currentModel.similarities.length>=t&&this.replaceWith("crm.settings.section.zia.similarity.list")},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-configure"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}},willTransition:function(e){window.drp=void 0,!this.component||"crm.settings.section.zia.similarity.create"===e.target||"save"===this.component.component.data.currentButtonClick&&"crm.settings.section.zia.similarity.view"===e.target||!0===this.component.component.data.isConfigModified&&Lyte.registeredMixins["similarity-utils"].routeChangeConfirm(e,this)}}},{mixins:["similarity-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-create.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=Lyte.registeredMixins["similarity-utils"],r=t.lazyFindRecordWithProperty("similarity",e.dynamicParam,"selected_views"),s=void 0!==r&&"function"==typeof r.then?r.then((function(e){return store.peekRecord("module",e[0].module.id).fields?store.peekRecord("module",e[0].module.id):store.findRecord("module",e[0].module.id)})):store.peekRecord("module",r.module.id).fields?store.peekRecord("module",r.module.id):store.findRecord("module",r.module.id);return{similarity:r,isEdit:!0,modules:t.getSupportedModules(),whomModule:s,similarities:store.peekAll("similarity")}},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),Array.isArray(e.similarity)&&(e.similarity=e.similarity[0]),e.whomModule=e.whomModule[0]?e.whomModule[0]:e.whomModule,e.modules=e.modules.module.filter((function(e){return!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type})),this.isGDPREnabledForModule(e.whomModule.api_name)){let t=e.whomModule.fields,r=this.getRequiredConsentFieldsColumnNames(t);if(r.length>0)return store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(s){let n=s.length;for(let e=0;e<n;e++)r.includes(s[e].column_name)&&(t.push(s[e]),r.splice(e,1));return e.whomModule.fields=t,e}))}return e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-configure"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}},willTransition:function(e){window.drp=void 0,"crm.settings.section.zia.similarity.edit"===e.target||"update"===this.component.component.data.currentButtonClick&&"crm.settings.section.zia.similarity.view"===e.target||!0===this.component.component.data.isConfigModified&&Lyte.registeredMixins["similarity-utils"].routeChangeConfirm(e,this)}}},{mixins:["similarity-utils","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.list",{queryParams:[{type:{refreshModel:!1,sticky:!1}}],getResources:function(){return networkUtils.returnDependencyFiles(["recommendation-similarity-list.js"],ResourceConstants.CRMClient)},model:function(){const e={A:1,C:10,Z:1,U:10};let t=void 0!==e[Crm.userDetails.LICENSE_TYPE]?e[Crm.userDetails.LICENSE_TYPE]:0;return"Z"===Crm.userDetails.LICENSE_TYPE&&void 0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&(t=10),{featureLimit:t,isManageProfile:!0===Crm.userDetails.permissions.Crm_Implied_Manage_Similarity}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-list"}},actions:{onError:function(e,t){"NO_PERMISSION"===JSON.parse(e.response).code&&(t.resume(),renderingUtils.displayPermissionDenied())}}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-detailed.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient);return e.concat(t)},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.findRecord("similarity",e.dynamicParam);return{similarity:t,module:t.then((function(e){return store.findRecord("module",e[0].module.id)}))}},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),e.similarity=e.similarity[0],e.module=e.module[0],this.isGDPREnabledForModule(e.module.api_name)){let t=e.module.fields,r=this.getRequiredConsentFieldsColumnNames(t);if(r.length>0)return store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(s){let n=s.length;for(let e=0;e<n;e++)r.includes(s[e].column_name)&&(t.push(s[e]),r.splice(e,1));return e.module.fields=t,e}))}return e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-detailedview"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}}}},{mixins:["crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity",{getDependencies:function(){return networkUtils.returnDependencyFiles(["similarity-utils.js","similarity-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-welcome-comp.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles(["recommendation-welcome-comp.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM);return e.concat(r).concat(t).concat(s)},redirect:function(){"crm.settings.section.zia.similarity"===this.transition.target&&this.replaceWith("crm.settings.section.zia.similarity.list")},model:function(){return{similarities:Lyte.registeredMixins["similarity-utils"].lazyFindAll("similarity")}},renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-welcome-comp"}},didDestroy:function(){"crm.settings.section.zia.similarity.list"===this.transition.target&&store.unloadAll("similarity")}},{mixins:["similarity-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.smart-prompt",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-zia-smart-prompt-model.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-zia-smart-prompt-setup.js","crm-zia-smart-prompt.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SmartPrompt")],ResourceConstants.CRM)))},model:function(){return{configs:store.findAll("smart_prompt_setup")}},afterModel:function(e){var t={active:!1,token_key:void 0,ai_vendor:"openai"},r={active:!1,token_key:void 0,ai_vendor:"zia"};e.configs=e.configs?e.configs:[];var s=e.configs.filter((e=>"openai"===e.ai_vendor)),n=e.configs.filter((e=>"zia"===e.ai_vendor));0!==s.length?e.openAiConfig=JSON.parse(JSON.stringify(s[0])):e.openAiConfig=t,0!==n.length?e.ziaConfig=JSON.parse(JSON.stringify(n[0])):e.ziaConfig=r,e.enableZiaLLM=featuresAvailable.SMART_PROMPT_ZIA_LLM,this.currentModel=e,Crm.client_tracking("Zia Smart Prompt",{"Sub features":"Visited"})},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}},lyteConvertionSupported:!0,renderTemplate:function(){return{outlet:"#result",component:"crm-zia-smart-prompt-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.duplicate-image-detection",{getResources:function(){return networkUtils.returnDependencyFiles(["duplicate-image-detection-setup.js","crm-zia-context-help.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["zia/zia-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("DuplicateImageDetectionOther"),networkUtils.getI18nJSUrl("DuplicateImageDetection")],ResourceConstants.CRM))},getDependencies:function(){return networkUtils.returnDependencyFiles(["duplicate-image-detection-model.js","features_model.js"],ResourceConstants.CRMClient)},model:function(){var e={};return e.features=store.findAll("features",{api_names:["duplicate_image_detection,duplicate_image_detection_special_access"].join(",")},void 0,void 0,{version:"v7"}),Lyte.resolvePromises(e).then((function(e){e.config_limit=0;var t=e.features;if(t&&0!==t.length)for(const r of t){if("duplicate_image_detection_special_access"===r.api_name){e.config_limit=r.details.limits.total,e.feature_key="duplicate_image_detection_special_access";break}"duplicate_image_detection"===r.api_name&&(e.config_limit=r.details.limits.total,e.feature_key="duplicate_image_detection")}return e}))},afterModel:function(e){var t=this,r={};return r.module=store.findAll("module",{feature_name:e.feature_key},!1,!1),r.config_list=store.findAll("duplicate_image_detection"),Lyte.resolvePromises(r).then((function(r){r.config_limit=e.config_limit,r.feature_key=e.feature_key;var s=[];if(r.config_list=r.config_list.filter((e=>void 0!==e)),r.module&&r.config_list){var n=new Set(r.config_list.map((e=>e.module.id)));s=r.module.module.filter((e=>!n.has(e.id)&&!0===e.visible)).map((e=>({name:e.plural_label,value:e.id}))),r.modules=s}r.module||(r.modules=[]),r.config_list||(r.config_list=[]),t.currentModel=r}))},beforeExit:function(){store.unloadAll("duplicate_image_detection")},renderTemplate:function(){return{outlet:"#result",component:"duplicate-image-detection-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation.create",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-vision-create.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js","crm-vision-validation.js","crm-vision-match-utils.js","crm-vision-detect-utils.js"],ResourceConstants.CRMClient)},model:function(e){commonUtils.showHideLoadingDiv(!0),e.visionsArr=store.peekAll("visions"),e.availableNames=this.getAvailableNames(),e.maxLimit=this.parent.currentModel.maxLimit,e.editClass="";var t=[];e.visions=store.peekRecord("visions",this.transition.data[0]);var r=[];e.saveDisable=!1,void 0===e.visions?(e.visions=store.createRecord("visions",{}),e.visions.desired_set=[],e.visions.undesired_set=[],r=this.getModules(!0,!1),e.criteriaShowClass="op8 eventNone"):void 0!==e.visions.vision_module?(e.cruxModuleId=e.visions.vision_module.id,r=this.getModules(!0,!1,e.cruxModuleId),e.selectedField=e.visions.vision_fields.id,(t=[]).push(e.visions.vision_fields),e.criteriaShowClass=""):(r=this.getModules(!0,!1),e.criteriaShowClass="op8 eventNone"),e.visions.undesired_set||(e.visions.undesired_set=[]),e.visions.desired_set||(e.visions.desired_set=[]),e.galTagUsed=!1,e.is_gallery_selected=!1,e.is_desktop_selected=!1,e.fields=t,e.module="",e.existing_fields=t,e.isView=!0,e.is_edit_page=!1,e.desiredFilesObjGal=[],e.type="",e.do_not_create_selected_default=!0,e.deploymentLocation=RebrandLinkUtil.getProperty("DeploymentLocation");var s=this.getValidModules(r);return e.modules=s,e.modules=r,e.validation_type_arr=this.getValidationTypes(e.deploymentLocation),e},beforeExit:function(e){var t=store.peekRecord("visions",e.visions.id);t&&(delete t.training_details,delete t.undesired_set,delete t.desired_set)},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavision-creationpage"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#vision_creation_page")[0];void 0!==e.visions.action&&(t.setData(e.visions.action.key+"_class","visionFailActItm_slctd"),$L(".visionFailActItm_slctd").trigger("click"));var r=this;if(!validationUtils.isEmpty(e.visions.criteria)){t.setData("criteriaShowClass",""),$L("#criteriaCheckButton").trigger("click");var s=$("#visionCruxCriteriaEditor");s.hide();var n=store.peekRecord("module",e.visions.vision_module.id).fields;function i(n){s.children().remove(),Lyte.Component.render("crux-criteria-editor",{id:"visionCruxCriteriaEditorComp",cxPropModule:e.visions.vision_module.module_name,cxPropFields:n,cxPropApiFormat:"new","cx-prop-appearance":"flat"},"#visionCruxCriteriaEditor");var i=document.querySelector("#visionCruxCriteriaEditorComp");i.component.setCriteria(e.visions.criteria),r.setCriteriaMethods(i,t),s.show(),void 0!==i.setWidth&&i.setWidth()}n?i(JSON.parse(JSON.stringify(n.map((e=>e.$.toJSON()))))):this.getAllFields(e.visions.vision_module.id,e.visions.vision_module.api_name,i)}t.setData("saveDisable",!1),void 0!==e.visions.vision_fields&&(document.querySelector("#fieldDropdown").ltProp("disabled",!1),this.component.component.data.isView=!0),this.setToolTipValues(e.deploymentLocation,t)},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)},willTransition:function(e){this.nextTransitionCheck(e,this.currentModel.visions.id,!1)}}},{mixins:["crm-vision-create"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation.edit",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-vision-create.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["crm-vision-match-utils.js","crm-vision-detect-utils.js","crm-vision-validation.js","crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=this,t={};return store.findRecord("visions",this.getDynamicParam()).then((function(r){if(r&&r[0]){t.visions=r[0];if(t.visions.training_details&&e.addCriteriaIndex(t.visions.training_details.pattern_criteria,1),0==t.visions.model_score&&($L("crm-ziavision-viewpage")[0].component.setData("visionRuleName",t.visions.name),$L("#editVisionModal")[0].ltProp("show",!0),commonUtils.showHideLoadingDiv(!1),e.transition.abort()),t.deploymentLocation=RebrandLinkUtil.getProperty("DeploymentLocation"),t.visions.undesired_set){var s=t.visions.undesired_set;if(s&&s.labels)i(s.labels)}else t.visions.undesired_set={};if(t.visions.desired_set){var n=t.visions.desired_set;if(n&&n.labels)i(n.labels)}else t.visions.desired_set={};function i(e){for(var r=e.length,s=0;s<r;s++){var n=e[s].model_details;if(n.length>0){"gallery"===n[s].type?(t.is_gallery_selected=!0,t.is_desktop_selected=!1,t.galTagUsed=!0):(t.is_gallery_selected=!1,t.is_desktop_selected=!0);break}}}t.saveDisable=!0,(e.transition.data.approval_count>0||t.visions.approval_count>0)&&(t.editClass="creationPage_withEdit"),e.transition.data.approval_count>=0?t.fromSummary=!1:t.fromSummary=!0;var o=[],a=t.visions.desired_set;if(a&&a.labels)if((w=(d=a.labels).length)>0)for(var l=0;l<w;l++)for(var c=(g=(D=d[l]).model_details).length,u=0;u<c;u++)o.push(g[u]);Lyte.Component.set(t.visions,"existingDesired_set",o);var d,m=[],p=t.visions.undesired_set;if(p&&p.labels)if((w=(d=p.labels).length)>0)for(l=0;l<w;l++){var g;for(c=(g=(D=d[l]).model_details).length,u=0;u<c;u++)m.push(g[u])}Lyte.Component.set(t.visions,"existingUnDesired_set",m);var f=store.peekRecord("module",t.visions.vision_module.id),h=[];t.cruxModuleId=t.visions.vision_module.id,t.layouts=t.visions.layout;var y=[];if(t.visions.layout&&(t.selectedLayout=t.visions.layout.id,y.push(t.visions.layout),t.layouts=y),!t.visions.layout){var C={id:"1"};C.name=I18n.getMsg("crm.zia.vision.layout.AllLayouts"),t.visions.layout=C,t.selectedLayout=C.id,y.push(C),t.layouts=y}if(h.push(t.visions.vision_fields),t.s_id=t.visions.id,t.availableNames=e.getAvailableNames(t.visions.id),t.is_edit_page=!0,t.disableValidationType=!0,t.learn_type=t.visions.learn_type,t.validation_type_arr=e.getValidationTypes(t.deploymentLocation),t.visions.validation_type){var v=e;if("object_detection"!==t.visions.validation_type&&"match_detect"!==t.visions.validation_type||(t.objDetection=!0,t.imgValidation=!1,t.visions.label_details_obj=[],t.visions.label_details_obj=v.get_training_label_details(t.visions.training_details.pattern_criteria,t.visions.training_details.labels),t.show_non_editable_pattern_criteria=e.patternCriToTextPattern("edit",t.visions.training_details.pattern_criteria,t.visions.training_details.labels,!0),t.visions.is_gallery_selected_detect=v.has_gallery_selected(t.visions.training_details.labels),t.visions.show_learn_section=!t.visions.is_gallery_selected_detect),"image_validation"===t.visions.validation_type||"match_detect"===t.visions.validation_type){t.objDetection=!1,t.imgValidation=!0;var _=[],R=!0;if(t.visions.desired_set.labels&&t.visions.desired_set.labels.length>0?_=t.visions.desired_set.labels:t.visions.undesired_set.labels&&t.visions.undesired_set.labels.length>0&&(_=t.visions.undesired_set.labels,R=!1),t.match_criteria_pattern_text_array=e.labelsToTextPatternMatchForEdit(_,R),_&&_.length>0){t.visions.label_details=[];var w=_.length;for(l=0;l<w;l++){var b={},D=_[l];b.labelName=D.name,b.apiName=D.api_name,b.labelId=D.id,b.tags=D.model_details,b.model_details=D.model_details,b.show_tags=!!(b.model_details&&b.model_details.length>0),Lyte.arrayUtils(t.visions.label_details,"push",b)}t.visions.is_gallery_selected=v.has_gallery_selected(_),t.visions.show_learn_section||(t.visions.show_learn_section=!t.visions.is_gallery_selected)}}"match_detect"===t.visions.validation_type&&(t.objDetection=!0,t.imgValidation=!0)}validationUtils.isEmpty(t.visions.criteria)||(t.criteriaSelected=!0),t.criteriaShowClass="";var M=e.getModules(!0,!1,t.cruxModuleId);return t.modules=M,t.fields=h,t.module=f.module_name,t.selectedField=t.visions.vision_fields.id,t.isView="false",t}}),(function(){this.hasError=!0}))},beforeExit:function(e){if(e){var t=store.peekRecord("visions",e.visions.id);delete t.training_details,delete t.undesired_set,delete t.desired_set}},afterModel:function(e){if(e&&e.visions)return e.allVisions=store.peekAll("visions"),e.visions&&void 0===e.visions.approval_count?store.triggerAction("visions","approval_count",{id:e.visions.id}).then((function(t){var r=t.vision_count;return r&&(Lyte.Component.set(e.visions,"approval_count",r[0].count),e.editClass="creationPage_withEdit"),e.visionId="",e})):void 0;this.hasError=!0},renderTemplate:function(){return this.hasError?{component:"crm-zia-error",outlet:"#result"}:{outlet:"#result",component:"crm-ziavision-creationpage"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#vision_creation_page")[0],r=!1;if(e&&e.visions){var s=e.visions.$.getDirtyAttributes().length;if(e.visions.$.isModified&&(1===s&&"vision_fields"!=e.visions.$.getDirtyAttributes()[0]||s>1)&&(r=!0,t.setData("saveDisable",!1)),e.visions){var n=$L("#fieldDropdown")[0],i=$L("#moduleDropdown")[0],o=$L("#layoutDropdown")[0];n&&n.ltProp("disabled",!0),i&&i.ltProp("disabled",!0),o&&o.ltProp("disabled",!0)}if(this.component.component.data.isView=!0,e.visions&&!validationUtils.isEmpty(e.visions.criteria)){var a=this;var l=e.visions.vision_module.id;this.getAllFields(l,e.visions.vision_module.api_name,(function(s){$L("#criteriaCheckButton").trigger("click"),t.getData("saveDisable")||r||t.setData("saveDisable",!0);var n=$("#visionCruxCriteriaEditor");if(n.hide(),n.children().remove(),a.isGDPREnabledForModule(e.visions.vision_module.module_name)){let r=a.getRequiredConsentFieldsColumnNames(s);r.length>0?store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(i){let o=i.length;for(let e=0;e<o;e++)r.includes(i[e].column_name)&&(s.push(i[e]),r.splice(e,1));a.renderVisionCriteriaComponent(e,s,a,t,n)})):a.renderVisionCriteriaComponent(e,s,a,t,n)}else a.renderVisionCriteriaComponent(e,s,a,t,n)}))}if(e.visions.validation_type){this.setToolTipValues(e.deploymentLocation,t);var c=$L("crm-ziavision-trainingdetails-criteria")[0];if(c.setData("is_edit_page",e.is_edit_page),"match_detect"===e.visions.validation_type&&(c.setData("is_image_validation_type",!0),c.setData("is_object_detection_type",!0),t.setData("is_image_validation_type",!0),t.setData("is_object_detection_type",!0)),"image_validation"===e.visions.validation_type||"match_detect"===e.visions.validation_type){"match_detect"!==e.visions.validation_type&&(c.setData("is_image_validation_type",!0),c.setData("is_object_detection_type",!1),t.setData("is_image_validation_type",!0),t.setData("is_object_detection_type",!1)),e.visions.desired_set.labels&&e.visions.desired_set.labels.length>0?(c.setData("is_desired_selected_in_ui",!0),c.setData("is_desired_selected_on_pageload",!0),c.setData("is_undesired_selected_in_ui",!1)):e.visions.undesired_set.labels&&e.visions.undesired_set.labels.length>0&&(c.setData("is_desired_selected_in_ui",!1),c.setData("is_undesired_selected_on_pageload",!0),c.setData("is_undesired_selected_in_ui",!0));var u=this.deepCopyOfAnObject(e.visions.label_details);c.setData("image_validation_label_details",[]),Lyte.arrayUtils(c.getData("image_validation_label_details"),"push",u);for(var d=$L(".vision_training_criteria_header_img"),m=u.length,p=0;p<m;p++){for(var g=d[p].component,f=0,h=u[p].tags?u[p].tags.length:void 0,y=0;y<h;y++)f+=u[p].tags[y].count;var C=[];(_={}).comparator=g.data.comparator,_.labelName=g.data.label_name,_.type=g.data.is_detect_selected?"matched":"not matched",_.criteriaIndex=p+1,C.push(_),Lyte.arrayUtils(c.getData("match_pattern_holder_array"),"push",C),g.setData("upload_total_count",f)}c.setData("match_criteria_pattern_text_array",e.match_criteria_pattern_text_array)}if("object_detection"===e.visions.validation_type||"match_detect"===e.visions.validation_type){"match_detect"!==e.visions.validation_type&&(c.setData("is_image_validation_type",!1),c.setData("is_object_detection_type",!0),t.setData("is_image_validation_type",!1),t.setData("is_object_detection_type",!0));var v=this.deepCopyOfAnObject(e.visions.label_details_obj);c.setData("obj_detection_label_details",[]),v=function(e){for(var t=e.length,r=0;r<t;r++)e[r].fileArrCount=e[r].tags.length;return e}(v),Lyte.arrayUtils(c.getData("obj_detection_label_details"),"push",v);for(d=$L(".vision_training_criteria_header_obj"),m=v.length,p=0;p<m;p++){for(g=d[p].component,f=0,h=v[p].tags.length,y=0;y<h;y++)f+=v[p].tags[y].count;var _;C=[];(_={}).comparator=g.data.comparator,_.labelName=g.data.label_name,_.type=g.data.is_detect_selected?"detected":"not detected",_.criteriaIndex=p+1,C.push(_),Lyte.arrayUtils(c.getData("detect_pattern_holder_array"),"push",C),g.setData("upload_total_count",f)}c.setData("is_gallery_selected_detect",e.visions.is_gallery_selected_detect)}var R=0,w=c.getData("obj_detection_label_details"),b=c.getData("image_validation_label_details");function D(e){e&&e.forEach((e=>{e.tags.forEach((e=>{e.count&&(R+=e.count)}))}))}w.length>0&&D(w),b.length>0&&D(b),c.setData("total_image_uploaded_in_config",R),t.setData("total_image_uploaded_in_config",R),t.setData("show_learn_section",e.visions.show_learn_section),e.visions.label_details&&c.setData("labels_count_in_match_section",e.visions.label_details.length),e.visions.label_details_obj&&c.setData("labels_count_in_detect_section",e.visions.label_details_obj.length),c.setData("is_gallery_selected",e.visions.is_gallery_selected),c.setData("detect_criteria_pattern_text_array",e.show_non_editable_pattern_criteria)}}},renderVisionCriteriaComponent:function(e,t,r,s,n){n.children().remove(),Lyte.Component.render("crux-criteria-editor",{id:"visionCruxCriteriaEditorComp",cxPropModule:e.visions.vision_module.module_name,cxPropFields:t,cxPropApiFormat:"new"},"#visionCruxCriteriaEditor");var i=document.querySelector("#visionCruxCriteriaEditorComp");i.component.setCriteria(e.visions.criteria),s.setData("selectedRecordsCriteria",i.component.getCriteria()),r.setCriteriaMethods(i,s),n.css("display","block"),void 0!==i.setWidth&&i.setWidth()},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)},willTransition:function(e){this.currentModel&&this.currentModel.visions&&this.nextTransitionCheck(e,this.currentModel.visions.id,!0)}}},{mixins:["crm-vision-create","crm-vision-match-utils","crm-vision-detect-utils","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation.index",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-vision-create.js"],ResourceConstants.CRMClient)},model:function(){return commonUtils.showHideLoadingDiv(!0),{visions:store.peekAll("visions")}},afterModel:function(e){var t=store.peekAll("visions");if(e.visions=t,e.visionLen=e.visions.length,e.visionLen<this.parent.currentModel.maxLimit?e.limitExceeded=!1:e.limitExceeded=!0,e.maxLimit=this.parent.currentModel.maxLimit,e.visionLen>0){e.showListview=!0;var r=[],s={id:"All"};s.plural_label=I18n.getMsg("crm.zia.vision.all"),r.push(s);for(var n=[],i=t.length,o=[],a=0;a<i;a++){var l=t[a].vision_module.module_name,c={};if(c.active=t[a].active,o[t[a].id]=c,-1===n.indexOf(l)){var u={};u.module_name=l,n.push(l),u.id=t[a].vision_module.id,u.api_name=t[a].vision_module.api_name,u.plural_label=t[a].vision_module.plural_label,r.push(u)}}e.modules=r,e.moduleFilterSel="All"}else e.showListview=!1;return e.status=[{plural_label:I18n.getMsg("crm.zia.vision.all.status"),id:"All"},{plural_label:I18n.getMsg("crm.zia.vision.active.status"),id:"active"},{plural_label:I18n.getMsg("crm.zia.vision.inactive.status"),id:"inactive"}],e.statusFilterSel="All",e.visionVsStatus=o,e},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavision-viewpage"}},afterRender:function(e){if($L("crm-ziavision-viewpage")[0].component.setData("visionVsStatus",e.visionVsStatus),commonUtils.showHideLoadingDiv(!1),e.visionLen>0)return store.triggerAction("visions","approval_counts").then((function(t){for(var r=t.vision_count,s=e.visions,n=void 0!==r?r.length:0,i=void 0!==s?s.length:0,o=0;o<n;o++)for(var a=0;a<i;a++)r[o].id===s[a].id?Lyte.Component.set(s[a],"approval_count",r[o].count):s[a].approval_count||Lyte.Component.set(s[a],"approval_count",null);return e.visions=s,e.visionId="",e}))},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)}}},{mixins:["crm-vision-create"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation.training-data",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-ziavision-training.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["lyte-daterangepicker.js","lyte-dateselect.js","crm-image-mixin.js","crm-vision-create.js","crm-vision-match-utils.js","crm-ui-loaders.js"],ResourceConstants.CRMClient))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e=this;return store.findRecord("visions",this.getDynamicParam()).then((function(t){if(t&&t[0]){var r=e.getDynamicParam(),s={};s.vision_id=r;var n=$L.moment($L.moment().subtract(30,"day").startOf("day").get("time")).i18N(),i=$L.moment($L.moment().get("time")).i18N();return Lyte.resolvePromises({visionImages:e.getVisionImages(r,["trained"],void 0,[n,i],["upload","suggestion"]),modelInformation:store.triggerAction("visions","model_information",{id:r})}).then((function(e){return s.images=e.visionImages,s.model_information=e.modelInformation,s}))}}),(function(){this.hasError=!0}))},afterModel:function(e){if(e&&e.images){var t=e.vision_id,r=store.peekRecord("visions",t);0!==r.model_score||r.active||Lyte.Router.transitionTo({route:"crm.settings.section.zia.vision.image-validation.view",dynamicParams:[r.id]});var s="image_validation"===r.validation_type?I18n.getMsg("crm.zia.vision.match"):"object_detection"===r.validation_type?I18n.getMsg("crm.zia.vision.detect"):I18n.getMsg("crm.zia.vision.create.match.detect"),n={};e.images&&Object.keys(e.images).length>0?n=e.images:n.images=[];var i=n||(n.images=[]),o=this.processTrainingDataResponse(i.images),a=Lyte.deepCopyObject(o),l=this.trainingDataPagination(a.images,"trained",-1,0);return e.trainedImages=l.images,e.trainedCount=0,e.feedbackCount=0,e.approvedCount=0,e.has_zip_images=!1,e.model_information.model_information.image_count_details.total_image_count>0&&(e.has_zip_images=!0),e.model_information.model_information.image_count_details.image_types.forEach((t=>{switch(t.type){case"upload":e.trainedCount=t.count;break;case"suggestion":e.feedbackCount=t.count;break;case"learning":e.approvedCount=t.count}})),e.auto_training_limit=Math.round(.4*e.trainedCount),e.trainedImages=l.images,e.curr_section_index=l.curr_section_index,e.curr_image_index=l.curr_image_index,e.labels=this.getLabelNameVsModTypeArr(r),e.groupedLablesForTrained=this.getGroupedLabelsWithHeaders(r,e.labels),e.labelsForApproved=this.getLabelsForApproved(r,e.labels),e.visionPurpose=s,e.totalResponse=o.images,e.visionDetails=r,e}this.hasError=!0},renderTemplate:function(){return this.hasError?{component:"crm-zia-error",outlet:"#result"}:{outlet:"#result",component:"crm-vision-training-page"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){return 403===e.status?(renderingUtils.displayPermissionDenied(),t.abort(),!1):void _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zia.vision.oops")}})}}},{mixins:["crm-image-mixin","crm-vision-create","crm-vision-image-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation.view",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-vision-create.js","crm-vision-match-utils.js"],ResourceConstants.CRMClient)},getResources:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","lyte-progressbar.js","lyte-dateselect.js","lyte-selector.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient))),e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-ziavision-training.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM))},model:function(){var e=this,t={};return store.findRecord("visions",this.getDynamicParam()).then((function(r){if(r&&r[0]){t.viewVisions=r[0],validationUtils.isEmpty(t.viewVisions.criteria)&&(t.viewVisions.criteria=null),t.summarydisplayMessage=I18n.getMsg("crm.zia.vision.model.fail.msg"),t.viewVisions.modified_on_date=Utils.getDateTimeInUserFormat(new Date(t.viewVisions.modified_time));var s={};if(s.id=Crm.userDetails.USER_ID,s.name=Crm.userDetails.DISPLAY_NAME,t.viewVisions.created_by||(t.viewVisions.created_by=s),t.viewVisions.modified_by||(t.viewVisions.modified_by=s),!t.viewVisions.layout){var n={id:"1"};n.name=I18n.getMsg("crm.zia.vision.layout.AllLayouts"),t.viewVisions.layout=n}var i=[],o="Match and Detect";if("object_detection"===t.viewVisions.validation_type?o="Detect only":"image_validation"===t.viewVisions.validation_type&&(o="Match only"),t.viewVisions.type_of_validation=o,"object_detection"===t.viewVisions.validation_type||"match_detect"===t.viewVisions.validation_type){var a=t.viewVisions.training_details;i=a.labels;if(a.pattern_criteria&&i&&i.length>0){t.criteriaText=e.getTrainingLabelDetails(a.pattern_criteria,i);var l=e.patternCriToTextPattern("summary",a.pattern_criteria,i);t.detect_criteria_pattern_text_array=l,t.criteria_text_pattern_for_detect=l.toString().replaceAll(","," ");var c=e.getDetectedAndNotDetectedLabels(t.criteriaText);t.detected_labels=c.detected_labels,t.notdetected_labels=c.notdetected_labels}t.viewVisions.visionDisplayType="Detect";i.length}if("image_validation"===t.viewVisions.validation_type||"match_detect"===t.viewVisions.validation_type){var u=t.viewVisions.desired_set,d=t.viewVisions.undesired_set,m=!0;u&&u.labels&&u.labels.length>0&&(i=u.labels),d&&d.labels&&d.labels.length>0&&(i=d.labels,m=!1);i.length;var p=e.labelsToTextPatternMatch(i,m);t.match_criteria_pattern_text_array=p,t.criteria_text_pattern_for_match=p.toString().replaceAll(","," "),t.viewVisions.visionDisplayType="Match"}t.imgValModelTags=[],t.viewVisions.isGalleryUpload=!1,t.viewVisions.failure_action.map((function(e){e.key===t.viewVisions.action.key&&(t.viewVisions.action.type=e.type)})),t.viewVisions.s_id=t.viewVisions.id;var g=store.peekRecord("module",t.viewVisions.vision_module.id).fields;if(!g){return store.findAll("field",{module:t.viewVisions.vision_module.api_name},void 0,void 0,{apiVersion:"2.2"}),e.getAllFields(t.viewVisions.vision_module.id,t.viewVisions.vision_module.api_name,(function(r){return t.viewVisions.fieldsArr=r,t.viewVisions.model_score>0?e.getModelInformation(t.viewVisions.id,f):t}))}function f(r){if(r&&r.model_information&&r.model_information.model_information&&r.model_information.model_information&&r.model_information.model_information.model_revisions&&r.model_information.model_information.model_revisions.length>0){var s=e.getModelAndTrainingData(r.model_information.model_information),n=s.training_accuracy,i=s.success_rate,o=s.image_count_details;t.training_accuracy=n,t.success_rate=i,t.image_count_details=o}return t}return t.viewVisions.fieldsArr=JSON.parse(JSON.stringify(g.map((e=>e.$.toJSON())))),t.viewVisions.$.set("vision_fields",t.viewVisions.vision_fields.id),t.viewVisions.model_score>0?e.getModelInformation(t.viewVisions.id,f):t}}),(function(){this.hasError=!0}))},afterModel:function(e){if(e&&e.viewVisions){if(e.viewVisions.model_score>0){var t=e.training_accuracy,r=e.success_rate,s=this.getCountFromAPIResponse(e.viewVisions,e.image_count_details),n=[];s.uploaded&&s.uploaded.count>0?(s.uploaded.match.desired_set&&s.uploaded.match.desired_set.forEach((e=>{n.push({name:e.label_name,id:e.label_id})})),s.uploaded.match.undesired_set&&s.uploaded.match.undesired_set.forEach((e=>{n.push({name:e.label_name,id:e.label_id})}))):(s.gallery.match.desired_set&&s.gallery.match.desired_set.forEach((e=>{n.push({name:e.label_name,id:e.label_id})})),s.gallery.match.undesired_set&&s.gallery.match.undesired_set.forEach((e=>{n.push({name:e.label_name,id:e.label_id})})));var i=e.viewVisions.training_details,o=e.viewVisions.desired_set&&e.viewVisions.desired_set.labels&&e.viewVisions.desired_set.labels.length>0?e.viewVisions.desired_set:e.viewVisions.undesired_set&&e.viewVisions.undesired_set.labels&&e.viewVisions.undesired_set.labels.length>0?e.viewVisions.undesired_set:void 0;i&&(s.uploaded.detect.criteriaText=this.recursiveCriteria(i.pattern_criteria,i.labels)),t.model_revision.sort((function(e,t){return $L.moment(t.startTime).toDate()-$L.moment(e.startTime).toDate()})),r.model_revision.sort((function(e,t){return $L.moment(t.startTime).toDate()-$L.moment(e.startTime).toDate()}));var a=[];t.model_revision[0].label_accuracy.forEach((e=>{var t={};if(t.id=e.label_id,i)for(var r=(l=i.labels).length,s=0;s<r;s++)l[s].id===e.label_id&&(t.name=l[s].name);if(o)for(r=(l=o.labels).length,s=0;s<r;s++)l[s].id===e.label_id&&(t.name=l[s].name);if(n&&n.length>0){var l;for(r=(l=n).length,s=0;s<r;s++)l[s].id===e.label_id&&(t.name=l[s].name)}t.score=e.accuracy,a.push(t)})),e.labelArr=a;var l=[],c={};c.name=I18n.getMsg("crm.zia.vision.modelscore.overall"),c.id=t.model_revision[0].overall_accuracy,l.push(c),a.forEach((e=>{l.push(e)})),e.labelArrWithOverAll=l,e.training_accuracy=t,e.success_rate=r,e.snapshot=s}return e.viewVisions&&void 0===e.viewVisions.approval_count?store.triggerAction("visions","approval_count",{id:e.viewVisions.id}).then((function(t){var r=t.vision_count;return r&&Lyte.Component.set(e.viewVisions,"approval_count",r[0].count),e})):void 0}this.hasError=!0},renderTemplate:function(){return this.hasError?{component:"crm-zia-error",outlet:"#result"}:{outlet:"#result",component:"crm-ziavision-summarypage"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},getTrainingLabelDetails:function(e,t){var r=this.getTrainingDetails(e);return this.updateLabelName(r,t)},getTrainingDetails:function(e,t,r){if(void 0!==e){t||(t=[]);var s=e.group_operator;if(!s&&e.label)t.push(this.constructGroupObj(e,r));else{var n=e.group;n&&(this.getTrainingDetails(n[0],t,s),this.getTrainingDetails(n[1],t,s))}}return t},constructGroupObj:function(e,t){var r={};return r.comparator=t&&t.length>0?t.toLowerCase():"",r.labelId=e.label.id,r.type="${DETECTED}"===e.value?"detected":"not detected",r},updateLabelName:function(e,t){for(var r=e.length,s=t.length,n=0;n<r;n++)for(var i=0;i<s;i++)e[n].labelId!==t[i].id&&e[n].labelId!==t[i].reference_id||(r>=2&&n<r-1&&(e[n].comparator=e[n+1].comparator),e[n].model_tags=t[i].model_tags,e[n].labelName=t[i].name);return this.addParenthesisToCriteria(e)},getModelAndTrainingData:function(e){var t=e.image_count_details,r=e.model_revisions,s={},n=[],i={},o=[],a=!1,l=!1;return r&&r.forEach(((e,t)=>{var r={},s={};e.success_rate_details&&(0===t&&0===e.success_rate_details.validation_success_count&&0===e.success_rate_details.validation_failure_count?a=!0:(r.score=e.success_rate_details.success_rate,r.success_count=e.success_rate_details.validation_success_count,r.failure_count=e.success_rate_details.validation_failure_count,r.end_time=e.end_datetime,n.push(r),l=!0)),e.training_accuracy&&(s.overall_accuracy=e.training_accuracy.overall_accuracy,s.success_count=e.image_detail.image_added,s.failure_count=e.image_detail.image_removed,s.end_time=e.end_datetime,s.start_time=e.start_datetime,s.label_accuracy=e.training_accuracy.label_accuracy,s.added=e.image_detail.images_added,s.removed=e.image_detail.images_removed,s.added_via=e.image_detail.added_via,o.push(s))})),s.is_no_score_successrate=a,s.model_revision=n,i.model_revision=o,s.is_history_available=l,{success_rate:s,training_accuracy:i,image_count_details:t}},recursiveCriteria:function(e,t){var r;if(void 0!==e.group)r="("+this.recursiveCriteria(e.group[0],t)+" "+e.group_operator.toLowerCase()+" "+this.recursiveCriteria(e.group[1],t)+")";else{var s="${DETECTED}"===e.value?"detected":"not detected";r=t.find((t=>t.api_name===e.label.api_name)).name+" is "+s}return r}},{mixins:["crm-vision-create","crm-vision-match-utils","crm-vision-image-utils","crm-vision-detect-utils","crm-dataprivacy-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validation",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-ziavision.js","crm-vision-image-utils.js","crm-vision-helper.js","crm-adminTool-helper.js","lyte-fileupload.js","zia-error.js","lyte-progressbar.js","zia-commons.js","lyte-selector.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")],ResourceConstants.CRM);e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css","crm-ziavision-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css"],ResourceConstants.CRMClient);var s=networkUtils.returnDependencyFiles(["crm-vision-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(e).concat(s).concat(r)},model:function(){return Crm.userDetails.permissions.Crm_Implied_Manage_Vision?(store.unloadAll("visions"),{visions:store.findAll("visions")}):(renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort(),!1)},redirect:function(){"crm.settings.section.zia.vision.image-validation"===this.transition.target&&Lyte.Router.transitionTo({route:"crm.settings.section.zia.vision.image-validation.index"})},afterModel:function(){var e={A:"1",C:"20",Z:"1",U:"20"};this.currentModel.maxLimit=void 0!==e[Crm.userDetails.LICENSE_TYPE]?e[Crm.userDetails.LICENSE_TYPE]:0,"Z"===Crm.userDetails.LICENSE_TYPE&&void 0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&(this.currentModel.maxLimit=e.U)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.zia.vision",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-ziavision.js","crm-vision-image-utils.js","crm-vision-helper.js","crm-adminTool-helper.js","lyte-fileupload.js","zia-error.js","lyte-progressbar.js","zia-commons.js","lyte-selector.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")],ResourceConstants.CRM);e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css","crm-ziavision-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css"],ResourceConstants.CRMClient);var s=networkUtils.returnDependencyFiles(["crm-vision-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return t.concat(e).concat(s).concat(r)},model:function(){},redirect:function(){"crm.settings.section.zia.vision"===this.transition.info.route&&this.replaceWith("crm.settings.section.zia.vision.image-validation.index",{},null)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.zia.callanalytics",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia_call_analytics_config.js","zia-call-analytics-helpers.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["call-analytics-setup.js","zia-helpers.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-zia-call-analytics-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zia-call-analytics")],ResourceConstants.CRM))},model:function(){return Lyte.resolvePromises({ziaCallAnalyticsConfigs:0!==store.peekAll("zia_call_analytics_config").length?Promise.resolve(store.peekAll("zia_call_analytics_config")):store.findAll("zia_call_analytics_config",{type:"call_analytics",category:2}),featureDetails:store.findAll("dummy",{},!1,!1,{url:"/crm/v4/__features?api_names=zia_call_analytics",method:"GET"})})},lyteConvertionSupported:!0,afterModel:function(e){e.featureDetails&&e.featureDetails.__features&&e.featureDetails.__features[0]&&(e.featureDetails=e.featureDetails.__features[0]),e.ziaCallAnalyticsConfigs&&e.ziaCallAnalyticsConfigs.length&&(e.ziaCallAnalyticsConfig=store.peekAll("zia_call_analytics_config").filterBy({type:"call_analytics"})[0])},renderTemplate:function(){return{outlet:"#result",component:"crm-zia-call-analytics-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.calltranscription",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia_call_transcription_config.js","zia-call-analytics-helpers.js"],ResourceConstants.CRMClient)},getResources:function(){return networkUtils.returnDependencyFiles(["call-transcription-setup.js","zia-helpers.js","crux-combo-box.js","crm-territory-common-utils.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-zia-call-transcription-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zia-call-analytics")],ResourceConstants.CRM))},model:function(){return{supportedModules:store.findAll("module",{feature_name:"call_transcription"},!1,!1),featureDetails:store.findAll("dummy",{},!1,!1,{url:"/crm/v4/__features?api_names=call_transcription",method:"GET"}),callTranscriptionConfig:store.findAll("zia_call_transcription_config")}},lyteConvertionSupported:!0,afterModel:function(e){return e.featureDetails&&e.featureDetails.__features&&e.featureDetails.__features[0]&&(e.featureDetails=e.featureDetails.__features[0]),e.supportedModules&&e.supportedModules.module&&(e.supportedModules=e.supportedModules.module.filter((e=>moduleRecordMapping.Calls&&e.id!==moduleRecordMapping.Calls.id))),e.callTranscriptionConfig&&(e.isGetStartClick=!0),e},renderTemplate:function(){return{outlet:"#result",component:"crm-zia-call-transcription-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification",{}),Lyte.Router.registerRoute("crm.settings.section.zia.reminder",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["reminder-settings-model.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["reminder-setup-model.js","zia-notification-settings.js"],ResourceConstants.CRMClient);return e.concat(t)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-communication-reminder-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Reminder")],ResourceConstants.CRM);t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("BestMode")],ResourceConstants.CRM));var r=networkUtils.returnDependencyFiles(["crm-communication-reminder-setup.js","zia-helpers.js"],ResourceConstants.CRMClient);return e.concat(t).concat(r)},model:function(){return Lyte.resolvePromises({configs:store.findAll("reminder_setup"),reminders:store.findAll("reminder_settings"),best_mode_to_contact:store.findAll("zia_notification_setup",{type:"best_mode_to_contact"})})},renderTemplate:function(e){var t=e.reminders;if(void 0===t.didMigrationRun||!t.didMigrationRun)return{outlet:"#result",component:"crm-communication-reminder-setup"};location.reload()}}),Lyte.Router.registerRoute("crm.settings.section.zia.sentiment-model",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_sentimentmodel.js",networkUtils.getI18nJSUrl("sentimentmodel")],ResourceConstants.CRM)},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailSentimentModelAction.do","GET",{params:{action:"sentimentModel"}})},renderTemplate:function(e,t){var r=e;return"object"==typeof e&&(r=Handlebars.templates.SentimentModelDataHeaders(r)),{outlet:"#result",html:r}},afterRender:function(e,t){"ZIA"===e.CHOOSEN_MODEL?($("#ziaExist").attr("checked",!0),sentimentModel.showInitialModel(2,e)):"ORG"===e.CHOOSEN_MODEL&&($("#ziaownnew").attr("checked",!0),sentimentModel.showInitialModel(1,e)),e.IS_MODEL_DEFINED||($(".sentimentDisableNotification").show(),$(".sentimentModel_header").parent().addClass("disableNotify")),thirdPartyUtils.bindSelect2(".ziaExistingIndustrmodel");var r=$("#result");setTimeout((function(){r.removeClass("pR"),$(".sentimentkrploading").hide()}),200),r.css({height:"100%"}),crmLayout.Resize.Setup();var s=$(".publisSettingsContainer");s.css({width:renderingUtils.windowWidth-260}),s.css("opacity",""),$(".emailsentimentalcontenteditablediv").css({"max-height":renderingUtils.windowHeight-260})},actions:{onError:function(e,t,r){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.create",{model:function(){return{configList:store.findAll("chatbot-config",{type:"all"})}},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-config-create"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.edit",{model:function(){return{configList:0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config",{type:"all"}):Promise.resolve(store.peekAll("chatbot-config"))}},afterModel:function(e){var t=this.getDynamicParam(),r=store.peekRecord("chatbot-config",t);if(void 0===r)throw new Exception("configId is invalid");e.configData=r,(void 0!==e.configData.filters&&e.configData.filters!==[]||void 0!==e.configData.cross_filters&&e.configData.cross_filters!==[])&&(e.smartFilterCheckbox=!0),void 0!==e.configData.criteria&&e.configData.criteria!==[]&&(e.isCriteriaEditorChecked=!0),void 0!==e.configData.push_info&&e.configData.push_info!==[]&&(e.pushComponentCheckbox=!0),e.isEdit=!0;var s=r.$.get("module"),n=this.getModuleNameFromApiName(s),i=moduleRecordMapping[n].$.get("id");return new Promise((function(e,t){Lyte.resolvePromises([store.findRecord("module",i,void 0,void 0,void 0,{getFields:!0})]).then((function(){e()}),(function(){t()}))}))},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-config-create"}},actions:{onError:function(){commonUtils.showHideLoadingDiv(!1),$L("#result").html("");var e={errorMsg:I18n.getMsg("crm.chatbot.invlid.config.id")};return Lyte.Component.render("crm-zia-error",e,"#result"),$("body > div.dummy_Body").addClass("hide"),!1}}},{mixins:["crm-chatbot-config-util"]}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.index",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.unloadAll("chatbot-config"),{configs:0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config",{type:"all"}):Promise.resolve(store.peekAll("chatbot-config"))}},afterModel:function(e){return e.configs&&0!==Object.keys(e.configs).length||(e.no_data=!0),e.configs.sort((function(e,t){var r=e.$.get("createdtime"),s=$L.moment(r).toDate().getTime(),n=t.$.get("createdtime");return $L.moment(n).toDate().getTime()-s})),e.req_type="All",e},renderTemplate:function(e){return 0===e.configs.length?{component:"crm-chatbot-config-welcome-comp",outlet:"#ziavoice_outlet"}:{component:"crm-chatbot-config-list-view",outlet:"#ziavoice_outlet",reRender:!0}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)}},{mixins:["crm-chatbot-config-util"]}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.view",{beforeModel:function(){return 0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config"):null},model:function(){var e=this.getDynamicParam();return{skillDetails:store.peekRecord("chatbot-config",e)}},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-skill-view"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chatbot-config.js","zia-error.js","lytecombobox.js","crux-smart-filter-input.js","crux-smart-filter.js","crux-criteria-conditions.js","crux-combo-box.js","lyte-multislider.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatbot")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-chatbot-config.css"],ResourceConstants.CRMClient);return r=r.concat(networkUtils.returnDependencyFiles(["crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),e.concat(t).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["chatbotConfig.js"],ResourceConstants.CRMClient)},beforeExit:function(){store.unloadAll("chatbot-config")},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavoice-index"}},actions:{refreshRoute:function(){this.refresh()},onError:function(e){if("NOT_ALLOWED"===(t=JSON.parse(e.response)).code)return this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),500),!1;var t=JSON.parse(e.response);commonUtils.showHideLoadingDiv(!1),$L("#result").html("");var r={heading:I18n.getMsg("crm.chatbot.disable.title"),message:I18n.getMsg("crm.chatbot.disable.content",Crm.appName)},s={heading:I18n.getMsg("crm.skyeye.setup.msg.error")},n=["NOT_ALLOWED","NO_PERMISSION","AUTHENTICATION_FAILURE"].contains(t.code)?r:s;return Lyte.Component.render("crm-ziavoice-error-component",n,"#result"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.zia-reasoning",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["lar-zia-reasoning.js","lyte-dateselect.js","crm-list-helpers.js","crm-inner-list.js","crux-combo-box.js","crm-create-helpers.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaReasoning")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["lar-zia-reasoning.css","crm-list-view-new.css","crm-listview-relatedfields-popover.css","crm-inner-list-new.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-rtl.css"],ResourceConstants.CRMClient)));var s=e.concat(r).concat(t),n=networkUtils.returnDependencyFiles(["lar-zia-reasoning.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return s=s.concat(n)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["assignment-rules-mixin.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-models.js"],ResourceConstants.CRMClient))},model:function(e){var t=e.queryParams.module,r=store.peekRecord("zia_reasoning","assignment_rules");if(void 0!==r)return this.fetchDataForZiaReasoningTab(r,t);var s={resource:"assignment_rules"},n=this;return store.findRecord("zia_reasoning","assignment_rules",s).then((function(e){return n.fetchDataForZiaReasoningTab(e,t)}),(function(e){this.processError(e)}))},beforeModel:function(){this.transition.preservePopup=!0},afterModel:function(e){var t=Lyte.registeredMixins["crm-zia-reasoning-mixin"].constructModelDataForZiaResoningTab(e);this.currentModel=t;var r=$L("crm-assignmentrules-zia-reasoning")[0];void 0!==r&&r.remove()},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrules-zia-reasoning"}},beforeExit:function(){store.unloadAll("zia_reasoning")}},{mixins:["crm-zia-reasoning-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zia-context-help.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-zia-context-help.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return e.concat(t)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.js","zohocrm_chart.js","highcharts.js"],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.css","crm_analytics.css"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaCommon")],ResourceConstants.CRM);return e.concat(t).concat(r)},beforeModel:function(){Handlebars.registerPartial("ZiaConfigOverAllChkbox",Handlebars.templates.ZiaConfigOverAllChkbox),Handlebars.registerPartial("ZiaConfigChkbox",Handlebars.templates.ZiaConfigChkbox)},renderTemplate:function(){networkUtils.initChart()}}),Lyte.Router.registerRoute("crm.settings.section.zmail-users",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-zoho-mail-addon-users-model.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zohomail-addon-component.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-mailaddon-users.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZohoMailAddonUsers")],ResourceConstants.CRM))},model:function(){return store.findAll("mail_addon_user",{include_inner_details:"user.profile,user.role,user.status",per_page:100}).then((function(e){return{mail_addon_users:e,mailMetaInfo:e.length?e.$.meta:{}}}))},renderTemplate:function(){return{outlet:"#result",component:"crm-mail-addon-users"}}}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.configurator-create",{getResources:function(){return this.parent.getRulesResources(this.parent.getDynamicParam())},afterModel:function(){if("productConfigurator"===this.parent.currentModel.configuratorInfo.dynamicParam||"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam||"guidedSelling"===this.parent.currentModel.configuratorInfo.dynamicParam)if(this.currentModel={},Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data),Lyte.objectUtils(this.currentModel,"add","mode","create"),Lyte.objectUtils(this.currentModel,"add","configuratorInfo",this.parent.currentModel.configuratorInfo),"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam){var e=!0;(t=this.transition.data).pricerulename&&""!==t.pricerulename&&t.priceruleactiontype&&""!==t.priceruleactiontype&&t.productHeaderFields&&t.productRecords||(e=!1),e||(Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","priceRules").data={redirect:!0,isCreatePRHook:!0})}else if("guidedSelling"===this.parent.currentModel.configuratorInfo.dynamicParam){var t;e=!0;(t=this.transition.data).gsName&&""!==t.gsName||(e=!1),e||(Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","guidedSelling").data={redirect:!0,isCreateGS:!0})}else Crm.userDetails.permissions.Crm_Implied_Create_CPQ_Product_Configurator&&this.transition.data.selectedLayoutData&&this.transition.data.headers||(Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","productConfigurator").data={redirect:!0,isCreatePCHook:!0})},beforeExit:function(){var e=$L("crm-cpq-warningpopup");e&&e[0]&&e[0].remove(),store.clearCachedQuery("field"),$L("#setup_new_ContentDiv").removeClass("hAuto")},didDestroy:function(){let e=$L("#setupshow");void 0!==e&&void 0!==e[0]&&e.addClass("new_setupview")},renderTemplate:function(){this.hideSetupMenu();let e=$L("#setupshow");var t=null;return"productConfigurator"===this.parent.currentModel.configuratorInfo.dynamicParam?(void 0!==e&&void 0!==e[0]&&e.removeClass("new_setupview"),t="crm-productconfigurator-main"):"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam?(void 0!==e&&void 0!==e[0]&&e.removeClass("new_setupview"),t="crm-cpqpricerulecontainer"):"guidedSelling"===this.parent.currentModel.configuratorInfo.dynamicParam&&(void 0!==e&&void 0!==e[0]&&e.addClass("new_setupview"),t="crm-cpq-gscreate"),{outlet:"#result",component:t}},afterRender:function(e){if(e&&e.configuratorInfo&&e.configuratorInfo.configName){var t=I18n.getMsg("crm.title.general.revamped",[e.configuratorInfo.configName,Crm.partnerName]);this.setTitle(t)}$L("#setup_new_ContentDiv").addClass("hAuto")},actions:{willTransition:function(e){if("crm.settings.section.zohocpq.index-zohocpq"!==e.target&&"crm.settings.section.zohocpq.configurator-create"!==e.target){if(featuresAvailable.NEXTGENUI_ENABLED)document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);"priceRules"===this.parent.getDynamicParam()?this.checkChangesForCPQfeatures(e,"create","priceRules"):"productConfigurator"===this.parent.getDynamicParam()?this.checkChangesForCPQfeatures(e,"create","productConfigurator"):"guidedSelling"===this.parent.getDynamicParam()&&this.checkChangesForCPQfeatures(e,"create","guidedSelling")}},onError:function(e){(401===e.status||e.response&&"NO_PERMISSION"===JSON.parse(e.response).code)&&renderingUtils.displayPermissionDenied(),this.transition.abort()}},lyteConvertionSupported:!0},{mixins:["crm-cpq-utils","cpq-rules-util"]}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.configurator-edit",{getResources:function(){return this.parent.getRulesResources(this.parent.getDynamicParam())},beforeModel:function(){if("guidedSelling"===this.parent.getDynamicParam()){var e={include:"question_pages.input_options.field.field_label"};return[store.findRecord("guided_selling",this.getDynamicParam(),e),store.findAll("module",!0)]}},model:function(){if("productConfigurator"===this.parent.getDynamicParam()){var e={include_inner_details:"criteria.group.field.data_type,criteria.group.field.crypt,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.rollup_summary,criteria.group.field.decimal_place,criteria.group.field.separator,actions.field_update.value,actions.field_update.field_label,criteria_field_metadata"};return Lyte.resolvePromises([store.findAll("dummy",e,!1,!1,{url:"/crm/v2.2/settings/cpq/product_configurators/"+this.getDynamicParam(),method:"GET"}),store.findAll("dummy",{},!1,!1,{url:"/crm/v2.1/__features?api_names=product_configurator,criteria_entities_product_configurator,action_entities_product_configurator,action_field_update_product_configurator",method:"GET"}).then(function(e){return this.transition.data.isRespSuccess=!!e,e}.bind(this),function(){return{}}.bind(this))])}if("priceRules"===this.parent.getDynamicParam()){e={include_inner_details:"criteria.group.field.data_type,criteria.group.field.crypt,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.rollup_summary,criteria.group.field.decimal_place,criteria_field_metadata,criteria.group.field.separator,record.Product_Code,record.Unit_Price"};return Lyte.resolvePromises([store.findAll("dummy",e,!1,!1,{url:"/crm/v2.2/settings/cpq/pricing_rules/"+this.getDynamicParam(),method:"GET"}),store.findAll("dummy",{},!1,!1,{url:"/crm/v2.1/__features?api_names=price_rule,price_rule_volume,price_rule_direct,price_rule_range",method:"GET"})]).then(function(e){return e&&e[0].pricing_rules&&e[1]?(this.transition.data.isRespSuccess=!0,this.transition.data.limits=e[1],e=e[0]):this.transition.data.isRespSuccess=!1,e}.bind(this),function(){return this.transition.data.isRespSuccess=!1,{}}.bind(this))}if("guidedSelling"===this.parent.getDynamicParam()){var t=store.peekRecord("guided_selling",this.getDynamicParam());if(t){var r=store.peekAll("module"),s=this.getModulesForFieldsGS(t,r),n=[],i={};i.count=s.length,i.modulesArr=s,n.push(i);var o=s.length;if(o>0)for(var a=0;a<o;a++)n.push(store.findAll("field",{module:s[a],type:"all"},!1,void 0,{apiVersion:"2.2"}));return n.push(t),n.push(store.findAll("dummy",{},!1,!1,{url:"/crm/v2.1/__features?api_names=guided_selling,question_pages_gs,input_options_gs",method:"GET"})),n.push(r),Lyte.resolvePromises(n)}}},afterModel:function(e){if("productConfigurator"===this.parent.getDynamicParam()&&this.transition.data.isRespSuccess){if(this.currentModel={},this.transition.data.criteria_entity_limit)Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data);else{var t=e[1],r={};r=this.checkPCLimits(t),Lyte.objectUtils(this.currentModel,"add","transitionData",r)}void 0===e[0].product_configurators?this.transition.data.isRespSuccess=!1:(Lyte.objectUtils(this.currentModel,"add","pc_obj",e[0].product_configurators[0]),Lyte.objectUtils(this.currentModel,"add","pc_id",this.getDynamicParam()),Lyte.objectUtils(this.currentModel,"add","mode","edit"),Lyte.objectUtils(this.currentModel,"add","configuratorInfo",this.parent.currentModel.configuratorInfo))}else if("priceRules"===this.parent.getDynamicParam()&&this.transition.data.isRespSuccess)this.currentModel={},Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data),Lyte.objectUtils(this.currentModel,"add","pr_id",this.getDynamicParam()),Lyte.objectUtils(this.currentModel,"add","mode","edit"),Lyte.objectUtils(this.currentModel,"add","pr_obj",e),Lyte.objectUtils(this.currentModel,"add","configuratorInfo",this.parent.currentModel.configuratorInfo);else if("guidedSelling"===this.parent.getDynamicParam())if(this.currentModel={},e){var s=e[0].count,n=this.setModuleIDVsFieldsForGs(e[0].modulesArr,e),i=n.moduleIdVsFields;t=e[s+2],r={};r=this.checkPCLimits(t),Lyte.objectUtils(this.currentModel,"add","transitionData",e[s+1]),Lyte.objectUtils(this.currentModel,"add","gsLimits",t),Lyte.objectUtils(this.currentModel,"add","modules",e[s+3]),Lyte.objectUtils(this.currentModel,"add","gs_id",this.getDynamicParam()),Lyte.objectUtils(this.currentModel,"add","gs_mode","edit"),Lyte.objectUtils(this.currentModel,"add","moduleIdVsFields",i),Lyte.objectUtils(this.currentModel,"add","modulesLoaded",n.modulesLoadedArr),Lyte.objectUtils(this.currentModel,"add","configuratorInfo",this.parent.currentModel.configuratorInfo)}else this.transition.data.isRespSuccess=!1;!1===this.transition.data.isRespSuccess&&(this.currentModel={},Lyte.objectUtils(this.currentModel,"add","isRuleUnAvailable",!0))},beforeExit:function(){var e=$L("crm-cpq-warningpopup")[0];e&&e.remove(),store.clearCachedQuery("field"),$L("#setup_new_ContentDiv").removeClass("hAuto")},didDestroy:function(){let e=$L("#setupshow");void 0!==e&&void 0!==e[0]&&e.addClass("new_setupview")},renderTemplate:function(){this.hideSetupMenu();let e=$L("#setupshow");var t=null;return!1!==this.transition.data.isRespSuccess?"productConfigurator"===this.parent.getDynamicParam()?(void 0!==e&&void 0!==e[0]&&e.removeClass("new_setupview"),t="crm-productconfigurator-main"):"priceRules"===this.parent.getDynamicParam()?(void 0!==e&&void 0!==e[0]&&e.removeClass("new_setupview"),t="crm-cpqpricerulecontainer"):"guidedSelling"===this.parent.getDynamicParam()&&(void 0!==e&&void 0!==e[0]&&e.addClass("new_setupview"),t="crm-cpq-gscreate"):Lyte.Router.getRouteInstance().parent.currentModel.showGetStarted||(t="crm-cpq-custom-alert"),{outlet:"#result",component:t}},afterRender:function(e){if(e&&e.configuratorInfo&&e.configuratorInfo.configName){var t=I18n.getMsg("crm.title.general.revamped",[e.configuratorInfo.configName,Crm.partnerName]);this.setTitle(t)}$L("#setup_new_ContentDiv").addClass("hAuto")},actions:{willTransition:function(e){featuresAvailable.NEXTGENUI_ENABLED&&"crm.settings.section.zohocpq.index-zohocpq"!==e.target&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);"crm.settings.section.zohocpq.index-zohocpq"!==e.target&&"crm.settings.section.zohocpq.configurator-create"!==e.target&&("priceRules"===this.parent.getDynamicParam()?this.checkChangesForCPQfeatures(e,"edit","priceRules"):"productConfigurator"===this.parent.getDynamicParam()?this.checkChangesForCPQfeatures(e,"edit","productConfigurator"):"guidedSelling"===this.parent.getDynamicParam()&&this.checkChangesForCPQfeatures(e,"edit","guidedSelling"))},onError:function(e){401===e.status?renderingUtils.displayPermissionDenied():400!==e.status||"INVALID_REQUEST_METHOD"!==JSON.parse(e.response).code&&"PATTERN_NOT_MATCHED"!==JSON.parse(e.response).code||(this.hideSetupMenu(),Lyte.Component.render("crm-cpq-custom-alert",{isRuleUnAvailableWarning:!0},"#result")),this.transition.abort()}},lyteConvertionSupported:!0},{mixins:["crm-cpq-utils","cpq-rules-util"]}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.index-zohocpq",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocpq.js","crm-cpq-gsinlineitems.js","lytecombobox.js","lyte-hovercard.js"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["cpq-helpers.js","cpq-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],ResourceConstants.CRMClient))),e},model:function(){var e;if(this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"error"!==e){if("productConfigurator"===this.parent.getDynamicParam())return[networkUtils.lyteInitiateRequest("/crm/v2.1/__features?api_names=product_configurator,criteria_entities_product_configurator,action_entities_product_configurator,action_field_update_product_configurator","GET").then((function(e){return e}),(function(){return{}}))];if("priceRules"===this.parent.getDynamicParam())return[networkUtils.lyteInitiateRequest("/crm/v2.1/__features?api_names=price_rule,price_rule_range,price_rule_volume,price_rule_direct","GET").then((function(e){return e}),(function(){return{}}))];if("guidedSelling"===this.parent.getDynamicParam()){var t=networkUtils.lyteInitiateRequest("/crm/v2.1/__features?api_names=guided_selling,question_pages_gs,input_options_gs","GET"),r=store.findAll("guided_selling",{include_inner_details:"modified_by.zuid"});store.findAll("guided_selling");var s=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/settings/modules",method:"GET"});return Lyte.resolvePromises({featureLimits:t,gsListView:r,modules:s})}}},afterModel:function(e){var t;this.transition&&this.transition.data&&this.transition.data.type&&(t=this.transition.data.type),"error"!==t&&(this.currentModel={configuratorInfo:this.parent.currentModel.configuratorInfo,dp:this.parent.currentModel.dp,cpqTabs:this.parent.currentModel.cpqTabs},this.parent.currentModel.configuratorInfo&&"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam&&this.transition.data.actionTypeFromTransition&&Lyte.objectUtils(this.currentModel,"add","actionTypeFromTransition",this.transition.data.actionTypeFromTransition),"productConfigurator"===this.parent.getDynamicParam()?(Lyte.objectUtils(this.currentModel,"add","Limits",e[0]),this.parent.transition&&this.parent.transition.data&&this.parent.transition.data.isCreatePCHook&&Lyte.objectUtils(this.currentModel,"add","isCreatePCHook",!0)):"priceRules"===this.parent.getDynamicParam()?(Lyte.objectUtils(this.currentModel,"add","Limits",e[0]),this.parent.transition&&this.parent.transition.data&&this.parent.transition.data.isCreatePRHook&&Lyte.objectUtils(this.currentModel,"add","isCreatePRHook",!0)):"guidedSelling"===this.parent.getDynamicParam()&&(Lyte.objectUtils(this.currentModel,"add","Limits",e.featureLimits),Lyte.objectUtils(this.currentModel,"add","gsListViewRcrds",e.gsListView),Lyte.objectUtils(this.currentModel,"add","modules",e.modules),this.parent.transition&&this.parent.transition.data&&this.parent.transition.data.isCreateGS&&Lyte.objectUtils(this.currentModel,"add","isCreateGS",!0)))},renderTemplate:function(){var e=$L(".setupleftmenutd"),t=$L("#setupshow");void 0!==e&&void 0!==e[0]&&void 0!==t&&void 0!==t[0]&&(e[0].className.includes("hide")&&e.removeClass("hide"),t[0].className.includes("new_setupview")||t.addClass("new_setupview"));var r,s="crm-cpqconfiguratorlistview";(this.transition&&this.transition.data&&this.transition.data.type&&(r=this.transition.data.type),"error"===r)?s="crm-permission-denied-pop-up":"guidedSelling"===this.currentModel.dp[0]&&("permission_denied"===r&&renderingUtils.displayPermissionDenied(),s="crm-cpq-gslistview");return $L(s)[0]&&$L(s)[0].remove(),{outlet:"#result",component:s}},afterRender:function(e){if(e&&e.configuratorInfo&&e.configuratorInfo.configName){var t=I18n.getMsg("crm.title.general.revamped",[e.configuratorInfo.configName,Crm.partnerName]);this.setTitle(t)}$L("#result").addClass("h100_per")},beforeExit:function(e){e&&e.target&&"crm.settings.section.zohocpq.index-zohocpq"!==e.target&&"crm.settings.section.zohocpq.configurator-create"!==e.target&&"guidedSelling"===this.parent.getDynamicParam()&&store.unloadAll("guided_selling"),$L("#result").removeClass("h100_per")},lyteConvertionSupported:!0}),Lyte.Router.registerRoute("crm.settings.section.zohocpq",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["cpq-utils.js"],ResourceConstants.CRMClient);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],ResourceConstants.CRM))},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocpq.js","crm-cpq-gsinlineitems.js","lytecombobox.js","lyte-hovercard.js","zohocpq-tab.js","cpq-helpers.js"],ResourceConstants.CRMClient);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocpq.css","zohocpq-tab.css","custom-view-layer-new.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-cpq-guided-selling.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crmsetup.css","crm-enrichment.css"],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],ResourceConstants.CRMClient))),e},afterModel:function(){var e,t={},r=this.transition.info.dynamicParams,s=r[0];if(t.dynamicParam=s,Lyte.registeredMixins["crm-cpq-utils"].checkModulePermissions(s)){if(this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"error"!==e)switch(s){case"productConfigurator":t.configName=I18n.getMsg("crm.auditlog.productconfigurator"),t.configDesc=I18n.getMsg("cpq.pc.brief.desc"),t.configCreateButton=I18n.getMsg("crm.module.create",[I18n.getMsg("crm.auditlog.productconfigurator")]);break;case"priceRules":t.configName=I18n.getMsg("crm.auditlog.pricerules"),t.configDesc=I18n.getMsg("cpq.pr.description"),t.configCreateButton=I18n.getMsg("crm.module.create",[I18n.getMsg("crm.auditlog.pricerule")]);break;case"CpqSettings":t.configName=I18n.getMsg("crm.cpq.settings.featurename");break;case"manageSubscriptions":t.configName="Manage Subscriptions",t.configDesc="Install/Deactivate CPQ and payment information",t.configCreateButton="CPQ Installed";break;case"guidedSelling":t.configName=I18n.getMsg("cpq.gs.guidedselling")}this.currentModel={configuratorInfo:t,dp:r}}else crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()},redirect:function(){var e;this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"crm.settings.section.zohocpq"===this.transition.target&&("error"===e?this.replaceWith("crm.settings.section.zohocpq.index-zohocpq",this.transition.info.dynamicParams[0]).data={type:"error"}:this.replaceWith("crm.settings.section.zohocpq.index-zohocpq",this.transition.info.dynamicParams[0]))},afterRender:function(e){if(e&&e.configuratorInfo&&e.configuratorInfo.configName){var t=I18n.getMsg("crm.title.general.revamped",[e.configuratorInfo.configName,Crm.partnerName]);this.setTitle(t)}},beforeExit:function(){this.transition.info.dynamicParams&&"guided_selling"===this.transition.info.dynamicParams[0]&&moduleRecordMapping.Products&&store.modelFor(moduleRecordMapping.Products.id)&&store.unloadAll(moduleRecordMapping.Products.id),store.modelFor("product_configurator")&&store.unloadAll("product_configurator")},getRulesResources:function(e){var t=networkUtils.returnDependencyFiles(["crm-cpq-general.js"],ResourceConstants.CRMClient);return t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-cpq-general.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-smart-filter-input.js","crm-custom-filter.js","crux-smart-filter.js","crux-column-list.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["custom-view-layer-new.css","multilookup-list.css","crm-list-view-new.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-column-list.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),t="productConfigurator"===e?(t=(t=t.concat(networkUtils.returnDependencyFiles(["cpq-productconfigurator.js","cpq-helpers.js","cpq-utils.js","crm-automation-userswrapper.js","crm-superadmin-dd-wrapper.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_zprocess.js","zohocrm_workflow.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["cpq-productconfigurator.css","crm-automation-userswrapper.css"],ResourceConstants.CRMClient)):(t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocpq.css","zohocpq-tab.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocpq.js","zohocpq-tab.js","lytecombobox.js","lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],ResourceConstants.CRM)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))),t}}),Lyte.Router.registerRoute("crm.settings.section.zsc-key",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAPIKey.do","GET",{params:{action:"serviceKey"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section",{getResources:function(){return Crm.sectionsDependencies()},beforeModel:function(){store.clearCachedQuery("layout")},afterModel:function(){(this.currentModel={globalSetpJson:globalSetpJson,mySetupArray:crmSetup.mySetupArray,sidemenuclass:Crm.isHeadless?"dN":""},!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED&&"crm.settings.section.custom-view.create-custom-view"!==this.transition.target&&"crm.settings.section.macro.create"!==this.transition.target&&!Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")&&"crm.settings.section.custom-view.cvid.edit-custom-view"!==this.transition.target&&"crm.settings.section.blueprint-setting"!==this.transition.target&&"crm.settings.section.autoresponders.index-autoresponder"!==this.transition.target&&"crm.settings.section.manage-mass-mail.index-mass-mail"!==this.transition.target&&"crm.settings.section.manage-tags"!==this.transition.target&&"crm.settings.section.extensions"!==this.transition.target&&"crm.settings.section.modules.index-modules.create-module"!==this.transition.target&&this.transition.target.includes("crm.settings.section"))&&document.querySelector("crm-left-menu").component.actions.openSelectedMenu("settings",!1,!0,!1)},renderTemplate:function(e,t){if(!(this.transition.target.includes("crm.settings.section.manage-mass-mail")||"crm.settings.section.custom-view.cvid.edit-custom-view"===this.transition.target||"crm.settings.section.custom-view.create-custom-view"===this.transition.target||this.transition.target.includes("crm.settings.section.manage-tags")||this.transition.target.includes("crm.settings.section.macro")||this.transition.target.includes("crm.settings.section.autoresponders")||"crm.settings.section.custom-view"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.section.import"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.import"===Lyte.Router.getRouteInstance().transition.target)){if(this.showOrHideNewUILeftMenu(),!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED){var r=document.querySelector("crm-left-menu-setup");return(globalSetpJson?globalSetpJson.components.length:0)>0&&!r?($L(".ts-lftmnu-modules").empty(),Lyte.Component.render("crm-left-menu-setup",{globalSetpJson:globalSetpJson.components},".ts-lftmnu-modules"),{outlet:"#show",component:"crm-setupright-display"}):(this.showOrHideNewUILeftMenu(),{outlet:"#show",component:"crm-setupright-display"})}return{outlet:"#show",component:"crm-setupsidemenu"}}},afterRender:function(e,t){if($("#setup_new_leftmenuDiv").css({height:$(window).height()-($("#setup_new_leftmenuDiv").offset().top+isChatEnabled?26:0)+"px"}),-1==this.transition.target.indexOf("crm.settings.section.manage-tags")&&-1==this.transition.target.indexOf("crm.settings.section.schedule-mass-email")&&-1==this.transition.target.indexOf("crm.settings.section.macro")&&-1==this.transition.target.indexOf("crm.settings.section.autoresponders")&&-1==this.transition.target.indexOf("crm.settings.section.custom-view")&&"crm.settings.section.import"!==this.transition.target&&"crm.settings.import"!==this.transition.target&&(crmSetup.selectLeftMenu(),$("#setupshow").show(),crmSetup.decideOldOrNewAPIDashboard()),Crm.isDirectAccessPage=!0,Crm.isSettingPage=!0,featuresAvailable.NEXTGENUI_ENABLED){var r=this.getFirstAvailableRouter();r&&r.info&&r.info.route&&(Crm.firstAvailableRouterObj=r.info.route)}var s=store.model.setup_submenu;s&&(void 0!==s.data.find((e=>"system.accessibility"===e.api_name))&&$L(".setuprightmenudiv").addClass("accessibilityEnabled"))},beforeExit:function(){Crm.isDirectAccessPage=!1;var e=store.model.setup_submenu;e&&(e.data.find((e=>"system.accessibility"===e.api_name))&&$L(".setuprightmenudiv").removeClass("accessibilityEnabled"))},redirect:function(){if("crm.settings.section.settings-wildcard"!==this.transition.target&&"crm.settings.section"!==this.transition.target&&"true"==this.transition.info.queryParams.fromHigherEdition){void 0===crmSetup.setupObject[this.transition.info.route]&&crmSetup.constructSetupObj();for(var e=this.transition.target.split("."),t=(e.splice(0,3),"crm.settings.section"),r=0;r<e.length;r++)if(t=t+"."+e[r],crmSetup.setupObject[t]&&crmSetup.setupObject[t].higherEditionTry){var s=document.location.href,n=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings");s=s.substr(s.indexOf(n)+n.length+1),this.replaceWith("crm.settings.section.settings-wildcard",s).data={route:t}}}else if("crm.settings.section.canvas-builder.detailview.views"===this.transition.target)return;crmSetup.hasChildRoute(this.transition.info.route)&&crmSetup.redirectFirstChild(this.transition.info.route)},actions:{didTransition:function(){var e=this.transition.target;if(!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED&&Lyte.registeredMixins["crm-setup-mixin"].setLastAccessedRouter(Lyte.Router.getRouteInstance().transition),e.includes("crm.settings.section.storage.users-list")&&void 0!==store.peekAll("email_storage_summary")[0])return;var t=$("#setupInnerLinks");if(!CrmRouter.hiddenSetupRoutes.hasOwnProperty(this.transition.target)){if(!("crm.settings.section.extensions.zoho-extensions.desk"==this.transition.target&&this.transition.data&&"promotab"==this.transition.data.from||this.transition.target.startsWith("crm.settings.section.review-process"))){t.show();var r=$(".setupleftmenutd");if(this.transition.target.startsWith("crm.settings.section.cadences.edit-series-config")||this.transition.target.startsWith("crm.settings.section.cadences.create-series-config")||this.transition.target.startsWith("crm.settings.section.cadences.crm-series-showfunnel")||(r.css("display",""),$(".new_setupview").removeClass("newSetupRightShow")),this.transition.target.startsWith("crm.settings.section.cadences.crm-series-view-reports"))$(".setuprightmenudiv").addClass("srsFunnelTopSpace"),r.addClass("hide")}$("#setup_new_ContentDiv").removeClass("workflow_rule")}let s;if(crmSetup.SetHeight_setup_inner_content(),e.includes("crm.settings.section.modules.module")?(s=$L("#moduleCustomizationDiv.new_setupviewHidden"),s[0]&&s.removeClass("new_setupviewHidden")):(s=$L("#setupshow.new_setupviewHidden"),s[0]&&s.removeClass("new_setupviewHidden")),"crm.settings.section.data-sharing.index-data-sharing"===this.transition.target){var n=this.transition.data.ruleId;if(n&&!Crm.userDetails.isDataSharingLyteEnabled){var i=$("#sharedRuleRow_"+n);if(0===i.length)crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.module.permission"),4e3);else{var o="#viewLimitExceed_"+n,a=$(o),l="crm.sharing.rules.limit.support.contact";if(document.getElementById("sharedRuleRow_"+n).scrollIntoViewIfNeeded(),i.addClass("highlightRow"),setTimeout((function(){i.removeClass("highlightRow")}),2900),this.transition.data.isSkipped){if(this.transition.data.isDeleted&&(l="crm.sharing.rules.limit.support.contact.delete",0===a.length)){(a=document.createElement("span")).setAttribute("id","viewLimitExceed_"+n),a.setAttribute("class","svgIcons ico-warning-small-filled dIB vaM mB8 mR7 mT4 cP"),a.setAttribute("onmouseenter","crmui.showTooltip({content:'"+I18n.getMsg(l)+"',position: 'center'})"),a.setAttribute("onmouseleave","crmui.hideTooltip()");var c=document.getElementById("criteriaRuleInfo_"+n);c.insertBefore(a,c.childNodes[0]),a=$(o)}void 0!==a&&(setTimeout(function(){crmui.showTooltip({content:I18n.getMsg(l),position:"center",target:o})}.bind(l,o),1),setTimeout((function(){crmui.toolTip_hide()}),5e3))}}}}(this.transition.data&&this.transition.data.reload&&(this.transition.data.reload=!1,Lyte.Router.getRouteInstance(e).refresh()),"crm.settings.section.settings-wildcard"===e||"crm.settings.section.currencies.currencies-old"===e?crmSetup.selectSetupTabByRoute(this.transition.data.route,this.transition.info):crmSetup.selectSetupTabByRoute(e,this.transition.info),"crm.settings.section.sandbox.sandbox-list"===e&&!1===Crm.userDetails.isSandboxCreated&&t.hide(),(-1!==this.transition.target.indexOf("crm.settings.section.manage-tags")||this.transition.target.includes("crm.settings.section.modules.index-modules.create-module")||this.transition.target.includes("crm.settings.section.manage-mass-mail")||-1!==this.transition.target.indexOf("crm.settings.section.manage-mass-mail.index-mass-mail")||-1!==this.transition.target.indexOf("crm.settings.section.schedule-mass-email")||-1!==this.transition.target.indexOf("crm.settings.section.macro")||-1!==this.transition.target.indexOf("crm.settings.section.autoresponders")||-1!==this.transition.target.indexOf("crm.settings.section.custom-view")||"crm.settings.section.import"===this.transition.target||"crm.settings.import"===this.transition.target)&&"crm.settings.section.section-error"!==e||this.showOrHideNewUILeftMenu(),!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED&&(this.transition.target.includes("crm.settings.section.manage-mass-mail")||this.transition.target.includes("create-workflow-rule")||this.transition.target.includes("view-workflow-rule")||this.transition.target.includes("crm.settings.section.client-portal.user-types.summary")||this.transition.target.includes("crm.settings.section.client-portal.user-types.users")||this.transition.target.includes("crm.settings.section.client-portal.user-types.edit")||this.transition.target.includes("crm.settings.section.client-portal.user-types.create-user-type")||"crm.settings.section.custom-view.cvid.edit-custom-view"===this.transition.target||Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")||"crm.settings.section.custom-view.create-custom-view"===this.transition.target||this.transition.target.includes("crm.settings.section.macro")||this.transition.target.includes("crm.settings.section.autoresponders")||"crm.settings.section.custom-view"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.section.import"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.import"===Lyte.Router.getRouteInstance().transition.target))&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED&&(this.transition.target.includes("crm.settings.section.client-portal.user-types.summary")||this.transition.target.includes("crm.settings.section.client-portal.user-types.users")||this.transition.target.includes("crm.settings.section.client-portal.user-types.edit")||this.transition.target.includes("crm.settings.section.client-portal.user-types.create-user-type"))&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);if(!Lyte.Router.getRouteInstance().title){var u=this.transition.info.route;if(crmSetup.hasChildRoute(u)){var d=crmSetup.getChildFirstRoute(u);if(null!=(h=crmSetup.setupObject[u].sub_menus)){var m=crmSetup.setupObject[u].sub_menus.filter((function(e){return e.routeName===d.routeName}));this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(m[0].params.pageTitle),Crm.partnerName]))}}else if(void 0!==crmSetup.setupObject[u]&&"custom"==crmSetup.setupObject[u].generated_type){if(void 0!==(h=crmSetup.setupObject[u].menus)){var p=this.transition.info.dynamicParams[0];m=crmSetup.setupObject[u].menus.filter((function(e){return e.dynamicParams[0]===p}));this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(m[0].display_label),Crm.partnerName]))}}else if(void 0!==crmSetup.setupObject[u]&&"crm.settings.section.crm-templates"===crmSetup.setupObject[u].routeName){if(void 0!==(h=crmSetup.setupObject[u].menus.sub_menus)){var g=void 0!==this.transition.info.queryParams.type?this.transition.info.queryParams.type:h[0].queryParams.type;m=crmSetup.setupObject[u].menus.sub_menus.filter((function(e){return e.queryParams.type===g}));this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(m[0].params.pageTitle),Crm.partnerName]))}}else if(void 0!==crmSetup.setupObject[u]&&"crm.settings.section.actions-flow-library"===crmSetup.setupObject[u].routeName){const e=crmSetup.setupObject[u].params.pageTitle,t=I18n.getMsg(e,Crm.partnerName);this.setTitle(I18n.getMsg("crm.title.general.revamped",[t,Crm.partnerName]))}else if(Crm.userDetails.isDataSharingLyteEnabled&&"crm.settings.section.data-sharing.index-data-sharing.default-org-permissions"===this.transition.target){var f=Lyte.Router.getRouteInstance().parent.__lp.objPath;const e=crmSetup.setupObject[f].sub_menus[0].params.pageTitle,t=I18n.getMsg(e,Crm.partnerName);this.setTitle(I18n.getMsg("crm.title.general.revamped",[t,Crm.partnerName]))}else{if((f=Lyte.Router.getRouteInstance().parent.__lp.objPath)!==u&&void 0===crmSetup.setupObject[u]){if(this.transition.target.includes("storage.users-list")&&this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.pricing.storage"),Crm.partnerName])),void 0===crmSetup.setupObject[f])return void crmLayout.Resize.Setup();var h;if(void 0!==(h=crmSetup.setupObject[f].sub_menus)){m=crmSetup.setupObject[f].sub_menus.filter((function(e){return e.routeName===u}));this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(m[0].params.pageTitle),Crm.partnerName]))}else void 0===crmSetup.setupObject[f]||void 0===crmSetup.setupObject[f].params||void 0===crmSetup.setupObject[f].params.pageTitle?(murphy.error(new Error(f)),murphy.error(new Error(crmSetup.setupObject[f]))):this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(crmSetup.setupObject[f].params.pageTitle),Crm.partnerName]))}else void 0===crmSetup.setupObject[e]||void 0===crmSetup.setupObject[e].params||void 0===crmSetup.setupObject[e].params.pageTitle?murphy.error(new Error(e)):this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(crmSetup.setupObject[e].params.pageTitle),Crm.partnerName]))}}0!==Crm.userDetails.TMENABLED&&2!==Crm.userDetails.TMENABLED||"crm.settings.section.territories.index-territories"!==this.transition.target||this.showOrHideTerritoryTab(!1),crmLayout.Resize.Setup()},onError:function(e,t,r){if($("html").addClass("page_initial_loading_hide"),$(".dummy_Body").hide(),e.status===crmConstants.errorStatusCode)return t.abort(),!1;if("string"==typeof e.responseText&&"crm.settings.section"!==t.target){var s=window.location.pathname.split(networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/"))[1];return this.replaceWith("crm.settings.section.section-error",s).data=e.responseText,!1}}},showOrHideNewUILeftMenu:function(){var e=Lyte.Router.getRouteInstance(),t=e.transition.target;if("crm.settings.section.section-error"===t&&(t=app.prevTransition?app.prevTransition.route:""),!Crm.isHeadless&&featuresAvailable.NEXTGENUI_ENABLED){var r=document.querySelector("crm-left-menu").component;if("crm.settings.section.extensions.zoho-extensions.visit"!==t&&"crm.settings.section.sales-signals.index-sales-signals"!==t&&("crm.settings.section.extensions"===t||t.includes("all-extensions")||t.includes("google-extensions")||t.includes("ms-extensions")||t.includes("zoho-extensions")||t.includes("leadchain-extensions"))){if(document.querySelector("crm-left-menu-marketplace")){var s=$L(".lftmnu-back-btn-sc");(!s||0===s.length||s.length>0&&s[0].classList.contains("disable-back-bt"))&&(r.actions.openSelectedMenu("marketplace",!1,!1),r.actions.showOrHideLeftPane(!0))}else r.actions.openSelectedMenu("marketplace",!1,!1),r.methods.renderMarketplace(!1);$L(".setupleftmenutd").hide()}else if(-1===this.transition.target.indexOf("crm.settings.section.manage-mass-mail.index-mass-mail")&&"crm.settings.section.custom-view.create-custom-view"!==this.transition.target&&-1===Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")&&-1===this.transition.target.indexOf("crm.settings.section.autoresponders.index-autoresponder")&&-1===this.transition.target.indexOf("crm.settings.section.manage-tags")&&-1===this.transition.target.indexOf("crm.settings.section.schedule-mass-email")&&-1===this.transition.target.indexOf("crm.settings.section.macro")&&-1===this.transition.target.indexOf("crm.settings.section.autoresponders")&&-1===this.transition.target.indexOf("crm.settings.section.custom-view")&&"crm.settings.section.import"!==this.transition.target&&"crm.settings.import"!==this.transition.target&&-1===this.transition.target.indexOf("crm.settings.section"))r.setData("selectedMenu","settings"),r.actions.showOrHideLeftPane(!1);else if(t.includes("workflow-rules.view-usage")&&"workflow"===e.getQueryParams().tab||t.includes("workflow-rules.create-workflow-rule")||t.includes("workflow-rules.view-workflow-rule")||t.includes("workflow-rules.clone-workflow-rule"))r.actions.showOrHideLeftPane(!1);else if(t.includes("crm.settings.section")&&!t.includes("crm.settings.section.modules.index-modules.create-module")&&"crm.settings.section.custom-view.cvid.edit-custom-view"!==this.transition.target&&"crm.settings.section.macro.create"!==this.transition.target&&!Lyte.Router.getRouteInstance().transition.target.includes("crm.settings.section.macro")){t.includes("crm.settings.section.crm-templates")||"crm.settings.section.custom-view.cvid.edit-custom-view"===this.transition.target||t.includes("crm.settings.section.modules.index-modules")||"crm.settings.section.blueprint-setting"===this.transition.target||r.actions.openSelectedMenu("settings",!1,!0,!1);let e=$L(".crm-lftmnu-clpse");var n;$L("#leftMainMenuDiv").removeClass("dNImp"),((n=!e.hasClass("menu-hide"))&&!(t.includes("crm.settings.section.blueprint.view-blueprint")||t.includes("crm.settings.section.modules.module")||t.includes("crm.settings.section.crm-templates")||t.includes("crm.settings.section.workflow-rules.view-workflow-rule"))||"crm.settings.section.modules.index-modules"===t)&&r.actions.showOrHideLeftPane(!0),(t.includes("crm.settings.section.modules.module")||t.includes("crm.settings.section.profiles.view-profile")||t.includes("crm.settings.section.review-process.edit-review-process")||t.includes("crm.settings.section.attributions")||t.includes("crm.settings.section.zohocpq.configurator-create")||t.includes("crm.settings.section.zohocpq.configurator-edit")||t.includes("crm.settings.section.workflow-rules.create-workflow-rule")||Lyte.registeredMixins["crm-setup-mixin"].doNotRenderSetupLeftMenu(this.transition))&&r.actions.showOrHideLeftPane(!1),"crm.settings.section.modules.index-modules"!==t&&"crm.settings.section.webform.index-webform"!==t||r.actions.showOrHideLeftPane(!0),t.includes("workflow-rules.index-workflow-rule")&&r.actions.showOrHideLeftPane(!0),!n&&t.includes("crm.settings.section.zohocpq.index-zohocpq")&&r.actions.showOrHideLeftPane(!0),app.nextTransition.info.dynamicParams.length>0||void 0!==app.nextTransition.info.queryParams.action?r.executeMethod("transitionMenuActive",t,app.nextTransition.info.dynamicParams[0],app.nextTransition.info.queryParams):r.executeMethod("transitionMenuActive",t)}}}},{mixins:["crm-territory-utils","crm-setup-mixin"]});
