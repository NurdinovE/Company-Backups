Lyte.Mixin.register("crm-create-mixin2",{fetchCustomGlobalData:function(e){e.type||this.transition&&this.transition.target&&(e.type="create",this.transition.data.isWizard&&(e.type="wizards"));var t={formType:e.type,moduleName:e.moduleName,formState:e.formState,featureInfo:e.featureInfo},i=this.constructExtraGlobalData(t,e);return t=Object.assign(t,i)},constructExtraGlobalData:function(e,t){var i={};return"quickCreate"===e.formType&&(i.isThroughQuickCreate=!0,t.extraInfo&&t.extraInfo.quickEntityData&&(i.quickEntityData=t.extraInfo.quickEntityData)),t.extraInfo?i.isThroughQc=!!t.extraInfo.isThroughQc&&t.extraInfo.isThroughQc:i.isThroughQc=!1,i.isThroughQc&&(i.qcExtraData=t.extraInfo.qcExtraData),t.overWritesInfo?(t.overWritesInfo.fields||(t.overWritesInfo.fields={}),t.overWritesInfo.module||(t.overWritesInfo.module={}),t.overWritesInfo.section||(t.overWritesInfo.section={}),i.overWritesInfo=t.overWritesInfo):i.overWritesInfo={fields:{},module:{},section:{}},i},constructCloneOnEditRecord:function(e,t,i,r){var o=t.$.toJSON();o.id=o.id+"_cloneOnEdit";var n=store.modelFor(e.id).fieldList;if(i)for(var a in i)if(n[a])if(n[a].cusRelationFldType&&"subform"!==!n[a].cusRelationFldType){if(n[a].cusRelationFldType&&"subform"===n[a].cusRelationFldType)for(var d=t[a].length,s=0;s<d;s++){var l=this.constructCloneOnEditRecordSubform(t[a][s],n[a].relatedTo);o[a][s]=l}}else o[a]=i[a];if(r)for(a in r)delete o[a];return store.pushPayload(e.id,o),o.id},constructCloneOnEditRecordSubform:function(e,t){var i=e.$.toJSON();return i.id=i.id+"_cloneOnEdit",store.pushPayload(t,i),i.id},getTheFirstFieldId:function(e,t,i,r,o,n){var a,d=t.length,s=$L("."+e),l=!1,c=0,f=!1,u=!1;if(s&&s[0]){for(var m=0;m<d;m++){if((i?t[m].sectionRecord:t[m])[this.data.currentInstObjKey].isvalidSection&&++c===o&&(f=!0),f){for(var v=i?t[m].sectionCustomDetails.fields:t[m].fields,h=v.length,g=0;g<h;g++){var p=i?v[g].fieldRecord:v[g];if(p.visible&&p.view_type[r]){a=p,u=!0,l=!0;break}}if(l)break}}return u?{foundField:!0,fieldId:"crm-create-fields#"+(n+"_fldRow_"+a.column_name),wrapperEle:s,fieldMeta:a}:void 0}},setFieldDataToInst:function(e){var t=e.sections,i=e.selectedLayoutid,r=e.instancekey,o=e.extraKeysToExtract,n=["required","read_only","view_type","tab_index","length","visible","decimal_place"];o&&o.length&&n.concat(o);for(var a=0,d=t.length;a<d;a++)if(t[a][r].type&&"used"===t[a][r].type)for(var s=t[a].fields,l=0,c=s.length;l<c;l++){s[l][i]&&Object.assign(s[l][r],s[l][i]);for(var f=0,u=n.length;f<u;f++)if(s[l].hasOwnProperty(n[f])){var m={};m[n[f]]=s[l][n[f]],Object.assign(s[l][r],m)}}},focusTheFirstField:function(e,t,i,r,o){this.preventCalenderOpening=!1;var n=this.getTheFirstFieldId(e,t,i,r,1,o);if(n){var a=n.fieldId+" lyte-input",d=$L(a,n.wrapperEle[0]);if(d&&d[0]){var s=n.fieldMeta.ui_type;[200,14,30,24,81,202,333].includes(s)&&(this.preventCalenderOpening=!0),window.requestAnimationFrame((()=>{var e=d.children().eq(-1).children("input")[0];e&&(e.selectionStart=e.value.length)})),d[0].focus()}}},isEmailFieldModifiedForCustomSharingAlert:function(e){try{if(e.component.data.initialCreatebject&&e.component.data.modifiedCreatebject){let[t,i]=[e.component.data.modifiedCreatebject.Email,e.component.data.initialCreatebject.Email];if(void 0!==t&&t!==i)return validationUtils.isValidEmail(t);let[r,o]=[e.component.data.modifiedCreatebject.Secondary_Email,e.component.data.initialCreatebject.Secondary_Email];if(void 0!==r&&r!==o)return validationUtils.isValidEmail(r)}}catch(e){murphy.error(e)}return!1},isRecordModified:function(){let e=$L("crm-create-layout")[0];if(!e)return!1;if(e=e.component,e.data.isWizardView)return Lyte.registeredMixins["crm-formview-mixin"].checkRecordModificationStatus();let t=!1;const i=e.getData("initialCreatebject");let r=e.data.oldRecordFromCanvas?e.getData("dataBind"):e.getData("modifiedCreatebject");const o=e.getData("currsubformApinames");(e=>{if(!e)return;const t=["$wizard_connection_path","Wizard"];Object.keys(e).forEach((i=>{t.includes(i)&&delete e[i]}))})(r);const n=(e,i,r,o)=>{const n=store.modelFor(o).fieldList,a=objectUtils.getKeys(i),d=a.length;for(let o=0;o<d;o++)if(!r.contains(a[o])){const r=n[a[o]];if(r&&r.fieldID&&"formula"!==r.fieldType){let n="object"==typeof e[a[o]]?JSON.stringify(e[a[o]]):e[a[o]],d="object"==typeof i[a[o]]?JSON.stringify(i[a[o]]):i[a[o]];if("picklist"===r.fieldType&&(n="-None-"===n?"":n,d="-None-"===d?"":d),(n||d)&&n!==d){t=!0;break}}}};n(i,r,o,e.getData("moduleId")),e.validateLayoutswitchingForSubForm(o),r=e.getData("modifiedCreatebject");let a=o.length;for(let i=0;i<a;i++){const a=e.getData("initialCreatebject")[o[i]],d=a&&a.length;if(d!==(r[o[i]]&&r[o[i]].length?r[o[i]].length:0)){t=!0;break}for(let s=0;s<d;s++){if(n(a[s],r[o[i]][s],o,e.getData("dataBind")[o[i]][0].$.model._name),t)break}if(t)break}return t},displayUnsavedChangesAlert(){commonUtils.showHideLoadingDiv();const e=document.querySelector("#layoutSwitch");e.ltProp("transition",{animation:"slideFromTop",duration:"0"}),e.ltProp("showCloseButton",!1),e.ltProp("show",!0)},onBeforeWizardExecutionRouteExit:function(){const e=document.getElementById("lt_wizard_button_acknowledgement");e&&e.ltProp("show")&&e.ltProp("show",!1)},createPageUnloadListener:function(e){if(!(e&&e.target&&e.target.activeElement&&e.target.activeElement.classList.contains("cxFileDownloadButton")))return Lyte.registeredMixins["crm-create-mixin2"].isRecordModified()?(e.preventDefault(),e.returnValue=!0,""):void 0},removeBeforeUnloadEvent:function(){window.removeEventListener("beforeunload",this.createPageUnloadListener)},onDidDestroyWizardExecutionRoute:function(){Lyte.registeredMixins["crm-wizard-execution"].isWizardCanvasView&&Lyte.registeredMixins["crm-create-init-mixin"].removeCanvasFormViewResources()}});
