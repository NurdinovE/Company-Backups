var ringCentral={directNumbers:{},browserids:{}},outbound="outgoing";ringCentral.pollStatus=function(e){var n=e;localStorage.setItem("isRingOut","true");var r=setInterval((function(){try{if(n.RINGOUTID){var e={actionUrl:"https://platform.ringcentral.com/restapi/v1.0/account/~/extension/~/ringout/"+n.RINGOUTID+"?reqTime="+ +new Date,headers:{Authorization:"bearer "+n.ACCESSTOKEN,"Content-Type":"application/json"},params:{},type:"GET",authentication:"cookies"};COMMON_UTILS.fetchRequest(e).then((function(e){if("Success"===e.status.callStatus&&"Success"===e.status.callerStatus){callrefid=Zoho.PhoneBridge.UTILS.callInfo({orgid:PhoneBridgeUtil.getCurrentOrg(),callstate:"customerdialed"},"callrefid");var n={actionUrl:"/phonebridge/answeredAPI",params:{callRefID:callrefid,callState:"answered",providerID:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerId,phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr")},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(n),localStorage.removeItem("isRingOut")}if("InProgress"!==e.status.callStatus&&(clearInterval(r),callrefid=Zoho.PhoneBridge.UTILS.callInfo({orgid:PhoneBridgeUtil.getCurrentOrg(),callstate:"customerdialed"},"callrefid"),"CannotReach"===e.status.callStatus||"Error"===e.status.callStatus)){n={actionUrl:"/phonebridge/clicktodial/rcerror",params:{errorMessage:JSON.stringify(e.status),phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),callRefID:callrefid},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(n)}}))}}catch(e){return}}),5e3)},ringCentral.pollCallOutStatus=function(e){var n=e;localStorage.setItem("isRingOut","true");var r=setInterval((function(){try{n.CALLOUTID?$.ajax({type:"GET",headers:{Authorization:"bearer "+n.ACCESSTOKEN,"Content-Type":"application/json"},url:"https://platform.ringcentral.com/restapi/v1.0/account/~/telephony/sessions/"+n.CALLOUTID,success:function(e){if(e.parties){var n=e.parties;for(i=0;i<n.length;i++){var t=n[i];if("Inbound"==t.direction&&"Answered"==t.status.code){clearInterval(r),callrefid=Zoho.PhoneBridge.UTILS.callInfo({orgid:PhoneBridgeUtil.getCurrentOrg(),callstate:"customerdialed"},"callrefid");var o={actionUrl:"/phonebridge/answeredAPI",params:{callRefID:callrefid,callState:"answered",providerID:PhoneBridgeUtil.providerId,phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr")},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(o),localStorage.removeItem("isRingOut")}else if("Inbound"==t.direction&&"Disconnected"==t.status.code&&(clearInterval(r),callrefid=Zoho.PhoneBridge.UTILS.callInfo({orgid:PhoneBridgeUtil.getCurrentOrg(),callstate:"customerdialed"},"callrefid"),callrefid=callrefid||"clicktodial",t.status.reason)){o={actionUrl:"/phonebridge/clicktodial/rcerror",params:{errorMessage:JSON.stringify({CallOutError:t.status.reason}),phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),callRefID:callrefid},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(o)}}}else clearInterval(r)},error:function(e){clearInterval(r)}}):clearInterval(r)}catch(e){return void clearInterval(r)}}),5e3)},ringCentral.loadDirectnumbers=function(){return new Promise((function(e,n){var r={};"RingOut"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType?r.defaultOptionRefName=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber:"customphone"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType&&(r.defaultOptionRefName=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType),ringCentral.directNumbers.options&&Object.keys(ringCentral.directNumbers.options).length>0?(r.options=ringCentral.directNumbers.options,e(r)):ringCentral.getNumbers().then((function(){r.options=ringCentral.directNumbers.options,e(r)}))}))},ringCentral.loadCallerids=function(){return new Promise((function(e,n){var r={};"browser"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType&&(r.defaultOptionRefName=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber),ringCentral.browserids.options&&Object.keys(ringCentral.browserids.options).length>0?(r.options=ringCentral.browserids.options,e(r)):ringCentral.getNumbers().then((function(){r.options=ringCentral.browserids.options,e(r)}))}))},ringCentral.getNumbers=async function(){var e={},n={},r={actionUrl:"/phonebridge/phonenumberpreference",params:{providerID:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerId},type:"GET",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg()}};return await COMMON_UTILS.fetchRequest(r).then((async function(r){if(r.execScript&&r.execScript.ARGUMENTS.DEVICE_API){args=r.execScript.ARGUMENTS;var t=JSON.parse(args.DIRECTNUMBER_API),i=JSON.parse(args.SIP_API),o=JSON.parse(args.DEVICE_API),l=[],a=[],g=t.records,s=i.sipFlags;if(s&&!0===s.voipFeatureEnabled&&!0===s.outboundCallsEnabled)for(var c=0;c<g.length;c++){var d=g[c];d.features&&-1!==d.features.toString().indexOf("CallerId")&&a.push({optionRefName:d.phoneNumber,optionLabel:d.phoneNumber})}const u=async function(){for(let n=2;t.paging.totalPages&&n<=t.paging.totalPages;n++){var e={actionUrl:"https://platform.ringcentral.com/restapi/v1.0/account/~/extension/~/phone-number",headers:{Authorization:"bearer "+args.ACCESSTOKEN,"Content-Type":"application/json"},params:{page:n},type:"GET"};await COMMON_UTILS.fetchRequest(e).then((e=>{var n=e.records,r=n.length;if(r&&s&&!0===s.voipFeatureEnabled&&!0===s.outboundCallsEnabled)for(var t=0;t<r;t++){var i=n[t];i.features&&-1!==i.features.toString().indexOf("CallerId")&&a.push({optionRefName:i.phoneNumber,optionLabel:i.phoneNumber})}}))}}();await u.then((()=>{for(var r=o.records,t=0;t<r.length;t++){var i=r[t];"SoftPhone"===i.type?l.push({optionRefName:i.id,optionLabelArray:[i.name,I18n.getMsg("phonebridge.preferences.pcname")+i.computerName,I18n.getMsg("phonebridge.preferences.status")+i.status]}):l.push({optionRefName:i.id,optionLabelArray:[i.name,I18n.getMsg("phonebridge.preferences.status")+i.status]})}l.push({optionRefName:"customphone",optionLabel:I18n.getMsg("phonebridge.preferences.customphone")}),n={options:a},e={options:l},ringCentral.directNumbers=e,COMMON_UTILS.browserDetect().includes("Mozilla Firefox")||(ringCentral.browserids=n)}))}else{ringCentral.directNumbers={options:[]},ringCentral.browserids={options:[]};var u=r.execScript;COMMON_UTILS.executeFunctionByName(u.FUNCTIONNAME,window,u.ARGUMENTS)}}))},ringCentral.openPref=async function(e){COMMON_UTILS.print("REST"+response);for(var n=JSON.parse(e.DIRECTNUMBER_API),r=JSON.parse(e.SIP_API),t=[],i=!1,o=[],l=n.records,a=l.length,g=0;a&&g<a;g++){var s=l[g];-1!==s.features.toString().indexOf("CallerId")&&(o.push(s.phoneNumber),"DirectNumber"===s.usageType&&t.push(s.phoneNumber))}const c=async function(){for(let i=2;n.paging.totalPages&&i<=n.paging.totalPages;i++){var r={actionUrl:"https://platform.ringcentral.com/restapi/v1.0/account/~/extension/~/phone-number",headers:{Authorization:"bearer "+e.ACCESSTOKEN,"Content-Type":"application/json"},params:{page:i},type:"GET"};await COMMON_UTILS.fetchRequest(r).then((e=>{var n=e.records,r=n.length;if(r)for(var i=0;i<r;i++){var l=n[i];l.features&&-1!==l.features.toString().indexOf("CallerId")&&(o.push(l.phoneNumber),"DirectNumber"===l.usageType&&t.push(l.phoneNumber))}}))}}();await c.then((()=>{var e=r.sipFlags;e&&!0===e.voipFeatureEnabled&&!0===e.outboundCallsEnabled&&(i=!0),PhoneBridgeUtil.uiPref(t,i,o)}))},ringCentral.getPrefSavedValue=function(){var e={};return PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType&&(e.PhonePreference=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType,"customphone"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType?(e.PhonePreference="RingOut",e.RingOutNumber="Custom Phone",e.CustomPhoneNumber=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber):"RingOut"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType?e.RingOutNumber=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber:"browser"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType&&(e.OutBoundCallerId=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber)),e},ringCentral.savePref=function(e){var n=$L("login-form")[0].component.getAllVisibleInputValue();if(document.getElementById("userPreferencePopup").ltProp("show",!1),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType=n.PhonePreference,PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber=n.OutBoundCallerId||n.RingOutNumber||n.PhonePreference,"customphone"===n.RingOutNumber){if(!/^[0-9a-zA-Z\*\+\.\(\)\-\;\s]+$/.test(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber))return PhoneBridgeUtil.showTopErrorMsg(I18n.getMsg("phonebridge.error.phonenumber")),void(n.CustomPhoneNumber="");PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType="customphone",PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber=n.CustomPhoneNumber}else if("browser"===n.PhonePreference){var r=COMMON_UTILS.browserDetect();return PhoneBridgeUtil.supportedBrowsers.indexOf(r)>=0&&"Mozilla Firefox"!=r?(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType="BROWSER",void PhoneBridgeUtil.initWebRTC(PhoneBridgeUtil.getCurrentOrg())):void PhoneBridgeUtil.showTopErrorMsg(I18n.getMsg("phonebridge.error.outgoing.browser.version",COMMON_UTILS.browserDetect())+I18n.getMsg("phonebridge.error.outgoing.choose.another"))}ringCentral.savePreference()},ringCentral.savePreference=function(){var e={actionUrl:"/phonebridge/phonenumberpreference/save",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),providerId:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerId,phoneNumberType:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType,phoneNumber:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumber},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(e).then((function(e){"success"==e&&(PhoneBridgeUtil.closepopup(),PhoneBridgeUtil.showSuccessMessage(I18n.getMsg("phonebridge.preference.success")))}))},ringCentral.login=function(){PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"});var e={actionUrl:"/phonebridge/providerlogin",params:{providerId:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerId},type:"GET",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg()}};COMMON_UTILS.fetchRequest(e).then((function(e){window.open(e,"windowname1","width=800, height=600")}))};var ringcentralCallLog={webRTCLogArray:[],initCallLogArray:function(){this.webRTCLogArray=[]},sendCallLogArray:function(e){try{"iceConnectionFailed"===e&&localStorage.setItem("webRTCFailureCount",Number(localStorage.getItem("webRTCFailureCount"))+1),ringcentralCallLog.webRTCLogArray.length>0&&COMMON_UTILS.print("WEBRTC ERROR"+ringcentralCallLog.webRTCLogArray)}catch(e){return}}},sipInfo=null,webPhone=null,ringCentralWebRTC={},callarr={};ringCentralWebRTC.register=function(e){var n=document.createElement("script"),r=PBClient.getFingerprintAndCSForFileName("sip-0.13.5.min.js");n.src=r.cdnurl,n.type="text/javascript",PBClient.isIntegrityEnabled&&(n.integrity=r.integrity),n.crossOrigin="anonymous",n.onload=function(){var n=document.createElement("script"),r=PBClient.getFingerprintAndCSForFileName("ringcentral-web-phone.js");n.src=r.cdnurl,PBClient.isIntegrityEnabled&&(n.integrity=r.integrity),n.crossOrigin="anonymous",n.onload=function(){ringCentralWebRTC.registerafterload(e)},document.head.appendChild(n)},document.head.appendChild(n),pbTabManager.send({key:"Msg",functionname:"ringCentralWebRTC.destroyConnection",arguments:{}})},ringCentralWebRTC.registerafterload=function(e){var n=null;n="string"==typeof e.SIP_API?JSON.parse(e.SIP_API):e.SIP_API,sipInfo=n.sipInfo[0]||n.sipInfo;var r=document.getElementById("remoteVideo"),t=document.getElementById("localVideo"),i={appKey:e.appKey,audioHelper:{enabled:!0},logLevel:3,media:{remote:r,local:t}};return COMMON_UTILS.browserDetect().includes("Mozilla Firefox")&&(i.enableMidLinesInSDP=!0),(webPhone=new RingCentral.WebPhone(n,i)).userAgent.audioHelper.loadAudio({incoming:"https://cdn.rawgit.com/ringcentral/ringcentral-web-phone/master/demo/audio/incoming.ogg",outgoing:"https://cdn.rawgit.com/ringcentral/ringcentral-web-phone/master/demo/audio/outgoing.ogg"}),webPhone.userAgent.on("invite",ringCentralWebRTC.onInvite),webPhone.userAgent.on("connecting",(function(){COMMON_UTILS.print("WebRTC UA Connecting")})),webPhone.userAgent.on("connected",(function(){COMMON_UTILS.print("WebRTC UA Connected")})),webPhone.userAgent.on("disconnected",(function(){COMMON_UTILS.print("WebRTC UA Disconnected")})),webPhone.userAgent.on("registered",(function(){if(COMMON_UTILS.print("WebRTC UA Registered"),PhoneBridgeUtil.getCurrentOrg()&&"browser"!==PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType&&"BROWSER"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType){PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType="browser";var e=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].phoneNumberType.toUpperCase();PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].answerAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("answer"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].endAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("end"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].declineAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("decline"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].muteAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("mute"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].holdAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("hold"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].keypressAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("keypress"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].transferAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("transfer"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].parallelcallAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("parallelcall"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].mergeandleaveAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].mergeAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("merge"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].leaveAllowed=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].callControlFeature[e].includes("leave"),ringCentral.browserids.options&&Object.keys(ringCentral.browserids.options).length>0?ringCentral.savePreference():PhoneBridgeUtil.savePreference()}})),webPhone.userAgent.on("unregistered",(function(){COMMON_UTILS.print("WebRTC UA Unregistered")})),webPhone.userAgent.on("registrationFailed",(function(){COMMON_UTILS.print("WebRTC UA RegistrationFailed")})),webPhone.userAgent.on("message",(function(){COMMON_UTILS.print("WebRTC UA Message")})),webPhone},ringCentralWebRTC.onInvite=function(e){COMMON_UTILS.print("Phonebridge incoming call : Invite"),COMMON_UTILS.isNotEmpty(Zoho.PhoneBridge.CallsArray)&&Zoho.PhoneBridge.CallsArray.length>0&&e.ua.audioHelper.playIncoming(!1),COMMON_UTILS.isNotEmpty(ringCentralWebRTC.session)||(ringCentralWebRTC.session=e);var n=e.request.headers["P-Rc-Api-Ids"][0].raw,r=n.substring(n.indexOf("s-"),n.length);callarr[r]=e},ringCentralWebRTC.answercall=function(e){if(ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0){var n="P-Rc-Api-Ids",r=ringCentralWebRTC.session.request.headers[n]?ringCentralWebRTC.session.request.headers[n][0].raw:ringCentralWebRTC.session.request.callId,t=-1!==r.indexOf("s-")?r.substring(r.indexOf("s-"),r.length):r,i=-1!==r.indexOf("s-")?"sessionid":"callId",o={};e.sessionid!==t?(o[i]=t,PhoneBridgeUtil.holdCurrentCall(),ringCentralWebRTC.holdcall(o),ringCentralWebRTC.session=callarr[e.sessionid],COMMON_UTILS.print("Phonebridge incoming call : answering"),ringCentralWebRTC.session.accept().then((function(){ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)})).catch((function(e){COMMON_UTILS.print("Accept failed",e)}))):e.sessionid===t&&(COMMON_UTILS.print("Phonebridge incoming call : answering"),ringCentralWebRTC.session.accept().then((function(){ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)})).catch((function(e){COMMON_UTILS.print("Accept failed",e)})))}},ringCentralWebRTC.sessionsanswercall=function(e){if(ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0){var n="P-Rc-Api-Ids",r=ringCentralWebRTC.session.request.headers[n]?ringCentralWebRTC.session.request.headers[n][0].raw:outbound,t=-1!==r.indexOf("s-")?r.substring(r.indexOf("s-"),r.length):r,i=-1!==r.indexOf("s-")?"sessionid":outbound,o={};e.sessionid!==t&&COMMON_UTILS.isNotEmpty(t)?(o[i]=t,PhoneBridgeUtil.holdCurrentCall(),ringCentralWebRTC.holdcall(o),ringCentralWebRTC.session=callarr[e.sessionid],COMMON_UTILS.print("Phonebridge incoming call : answering"),ringCentralWebRTC.session.accept().then((function(){ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)})).catch((function(e){COMMON_UTILS.print("Accept failed",e)}))):e.sessionid===t?(COMMON_UTILS.print("Phonebridge incoming call : answering"),ringCentralWebRTC.session.accept().then((function(){ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)})).catch((function(e){COMMON_UTILS.print("Accept failed",e)}))):COMMON_UTILS.print("Accept failed - Empty session ID",e)}},ringCentralWebRTC.endcall=function(e){var n;ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],delete callarr[e.sessionid],COMMON_UTILS.print("Phonebridge incoming call : disconnecting"),ringCentralWebRTC.session.terminate()):callarr[e.callId]&&(n=ringCentralWebRTC.session.request.callId,ringCentralWebRTC.session=callarr[e.callId],delete callarr[n],COMMON_UTILS.print("Phonebridge outgoing call : disconnecting"),ringCentralWebRTC.session.terminate()))},ringCentralWebRTC.sessionsendcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],delete callarr[e.sessionid],COMMON_UTILS.print("Phonebridge incoming call : disconnecting"),ringCentralWebRTC.session.terminate()):callarr[outbound]&&(ringCentralWebRTC.session=callarr[outbound],delete callarr[outbound],COMMON_UTILS.print("Phonebridge outgoing call : disconnecting"),ringCentralWebRTC.session.terminate()))},ringCentralWebRTC.mutecall=function(){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&ringCentralWebRTC.session.mute()},ringCentralWebRTC.unmutecall=function(){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&ringCentralWebRTC.session.unmute()},ringCentralWebRTC.holdcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],ringCentralWebRTC.session.hold().then((function(){COMMON_UTILS.print("Phonebridge incoming call : holding")})).catch((function(e){COMMON_UTILS.print("Holding failed",e.stack||e)}))):callarr[e.callId]&&(ringCentralWebRTC.session=callarr[e.callId],ringCentralWebRTC.session.hold().then((function(){COMMON_UTILS.print("Phonebridge outgoing call : holding")})).catch((function(e){COMMON_UTILS.print("Holding failed",e.stack||e)}))))},ringCentralWebRTC.sessionsholdcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],ringCentralWebRTC.session.hold().then((function(){COMMON_UTILS.print("Phonebridge incoming call : holding")})).catch((function(e){COMMON_UTILS.print("Holding failed",e.stack||e)}))):callarr[outbound]&&(ringCentralWebRTC.session=callarr[outbound],ringCentralWebRTC.session.hold().then((function(){COMMON_UTILS.print("Phonebridge outgoing call : holding")})).catch((function(e){COMMON_UTILS.print("Holding failed",e.stack||e)}))))},ringCentralWebRTC.unholdcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],ringCentralWebRTC.session.unhold().then((function(){COMMON_UTILS.print("Phonebridge incoming call : unholding")})).catch((function(e){COMMON_UTILS.print("UnHolding failed",e.stack||e)}))):callarr[e.callId]&&(ringCentralWebRTC.session=callarr[e.callId],ringCentralWebRTC.session.unhold().then((function(){COMMON_UTILS.print("Phonebridge outgoing call : unholding")})).catch((function(e){COMMON_UTILS.print("UnHolding failed",e.stack||e)}))))},ringCentralWebRTC.sessionsunholdcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&(callarr[e.sessionid]?(ringCentralWebRTC.session=callarr[e.sessionid],ringCentralWebRTC.session.unhold().then((function(){COMMON_UTILS.print("Phonebridge incoming call : unholding")})).catch((function(e){COMMON_UTILS.print("UnHolding failed",e.stack||e)}))):callarr[outbound]&&(ringCentralWebRTC.session=callarr[outbound],ringCentralWebRTC.session.unhold().then((function(){COMMON_UTILS.print("Phonebridge outgoing call : unholding")})).catch((function(e){COMMON_UTILS.print("UnHolding failed",e.stack||e)}))))},ringCentralWebRTC.dtmfcall=function(e){ringCentralWebRTC.session&&PhoneBridgeUtil.madecall>0&&ringCentralWebRTC.session.dtmf(e.DIGIT)},ringCentralWebRTC.makeCall=function(e){if(COMMON_UTILS.browserDetect().includes("Google Chrome or Chromium")||(Zoho.PhoneBridge.UI.closeCall(),PhoneBridgeUtil.openPrefPopup()),COMMON_UTILS.isNotEmpty(webPhone)&&PhoneBridgeUtil.madecall>0&&pbTabManager.ismaster){var n=e.TONUMBER;n=COMMON_UTILS.removeSpecialChars(n),ringCentralWebRTC.session=webPhone.userAgent.invite(n,{fromNumber:PhoneBridgeUtil.multiOrgData[e.orgId].phoneNumber});var r=ringCentralWebRTC.session.request.callId;callarr[r]=ringCentralWebRTC.session,COMMON_UTILS.print("Phonebridge outgoing call : connected"),ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)}else COMMON_UTILS.isNotEmpty(webPhone)&&ringCentralWebRTC.destroyConnection()},ringCentralWebRTC.sessionsmakeCall=function(e){if(COMMON_UTILS.browserDetect().includes("Google Chrome or Chromium")||(Zoho.PhoneBridge.UI.closeCall(),PhoneBridgeUtil.openPrefPopup()),COMMON_UTILS.isNotEmpty(webPhone)&&PhoneBridgeUtil.madecall>0&&pbTabManager.ismaster&&!callarr[outbound]){var n=e.TONUMBER;n=COMMON_UTILS.removeSpecialChars(n),ringCentralWebRTC.session=webPhone.userAgent.invite(n,{fromNumber:PhoneBridgeUtil.multiOrgData[e.orgId].phoneNumber}),callarr[outbound]=ringCentralWebRTC.session,COMMON_UTILS.print("Phonebridge outgoing call : connected"),ringCentralWebRTC.onAccepted(ringCentralWebRTC.session)}else COMMON_UTILS.isNotEmpty(webPhone)?ringCentralWebRTC.destroyConnection():COMMON_UTILS.print("Phonebridge outgoing call : Rejected")},ringCentralWebRTC.init=function(e){"browser"===PhoneBridgeUtil.multiOrgData[e.orgId].phoneNumberType&&(COMMON_UTILS.browserDetect().includes("Mozilla Firefox")?PhoneBridgeUtil.openPrefPopup(e.orgId):PhoneBridgeUtil.webRTCcheck(e.orgId))},ringCentralWebRTC.destroyConnection=function(){!pbTabManager.ismaster&&COMMON_UTILS.isNotEmpty(webPhone)&&(ringCentralWebRTC.session=null,webPhone.userAgent.unregister(),webPhone=null)},ringCentralWebRTC.clearConnection=function(){var e="P-Rc-Api-Ids",n=null;if(ringCentralWebRTC.session.request.headers[e]){var r=ringCentralWebRTC.session.request.headers[e][0].raw;n=r.substring(r.indexOf("s-"),r.length)}else n=outbound;delete callarr[n],ringCentralWebRTC.session=null},ringCentralWebRTC.onAccepted=function(e){e.on("accepted",(function(){COMMON_UTILS.print("WebRTC Event: Accepted")})),e.on("progress",(function(){COMMON_UTILS.print("WebRTC Event: Progress")})),e.on("rejected",(function(){COMMON_UTILS.print("WebRTC Event: Rejected")})),e.on("failed",(function(){COMMON_UTILS.print("WebRTC Event: Failed")})),e.on("terminated",(function(){COMMON_UTILS.print("WebRTC Event: Terminated"),PhoneBridgeUtil.madecall--,0!=PhoneBridgeUtil.madecall||(callarr={}),ringCentralWebRTC.clearConnection()})),e.on("cancel",(function(){COMMON_UTILS.print("WebRTC Event: Cancel")})),e.on("refer",(function(){COMMON_UTILS.print("WebRTC Event: Refer")})),e.on("replaced",(function(n){COMMON_UTILS.print("WebRTC Event: Replaced: old session",e,"has been replaced with",n),ringCentralWebRTC.onAccepted(n)})),e.on("dtmf",(function(){COMMON_UTILS.print("WebRTC Event: DTMF")})),e.on("muted",(function(){COMMON_UTILS.print("WebRTC Event: Muted")})),e.on("unmuted",(function(){COMMON_UTILS.print("WebRTC Event: Unmuted")})),e.on("connecting",(function(){COMMON_UTILS.print("WebRTC Event: Connecting")})),e.on("bye",(function(){COMMON_UTILS.print("WebRTC Event: Bye")}))};