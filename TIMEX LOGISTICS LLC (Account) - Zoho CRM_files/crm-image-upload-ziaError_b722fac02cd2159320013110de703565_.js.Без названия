Lyte.Component.register("crm-zia-vision-error-popup",{_template:'<template tag-name="crm-zia-vision-error-popup" id="vision-error-popup"> <template is="if" value="{{expHandlers(isSaveAndNew,\'!\')}}"><template case="true"> <div id="detailPopUpModal"></div> <lyte-modal data-zcqa="helpZiaPopupModal" id="zv_confirmModal" on-before-close="{{method(\'offClickEvents\')}}" on-close="{{method(\'closeHelpZiaPopupModal\',isFromEntityEditPage)}}" lt-prop-freeze="true" lt-prop="{&quot;width&quot; : &quot;600px&quot;, &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-dimmer="{&quot;color&quot;:&quot;var(--modalFreezeLayerBg)&quot;,&quot;opacity&quot;:&quot;0.2&quot;}" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <template is="if" value="{{isFromEntityEditPage}}"><template case="true"> {{getI18n(\'crm.zia.vision.successrate.edit.error.popup\')}} </template><template case="false"> {{getI18n(\'crm.image.remove.confirm\')}} </template></template> </lyte-modal-header> <lyte-modal-content> <div class="lH21 mB30 vision_helpCheckBox"> <lyte-checkbox data-zcqa="ziaErrorChkBoxChecked" lt-prop-id="visionErrorChk" lt-prop-value="1" lt-prop-yield="true" lt-prop-label="check me" lt-prop-tabindex="0" lt-prop-checked="false" lt-prop-type="default" lt-prop-label-class="crmParagraphColor" class="dIB vaM"> <template is="registerYield" yield-name="yield"> <template is="if" value="{{isFromEntityEditPage}}"><template case="true"> {{unescape(getI18n(\'crm.zia.vision.successrate.entity.edit.popup.checkbox\',encodeHTML(deletedFieldLabels)))}} </template><template case="false"> {{getI18n(\'crm.zia.vision.successrate.ajax.edit.popup.checkbox\')}} </template></template> </template> </lyte-checkbox> </div> <div class="dIB zv_remove_note">{{getI18n(\'crm.zia.vision.successrate.error.popup.note\')}}</div> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button data-zcqa="PupHome_cancelbtn" lt-prop-id="visionErrCancelBtn" onclick="{{action(\'hide\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.functions.cancel\')}} </template> </lyte-button> <template is="if" value="{{expHandlers(ziaErrorField,\'===\',&quot;Entity_image&quot;)}}"><template case="true"> <lyte-button data-zcqa="PupHome_button_deletebtn" id="visionErrProceedBtn" lt-prop-appearance="failure" onclick="{{action(\'callAlertDeleteEntityImage\',entityId,moduleName,contentLiterals)}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.workflow.rule.tag.remove.popup.confirm.button\')}} </template> </lyte-button> </template><template case="false"><template is="if" value="{{isFromEntityEditPage}}"><template case="true"> <lyte-button data-zcqa="PupHome_button_deletebtn" id="visionErrProceedBtn" lt-prop-appearance="failure"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.yes.proceed\')}} </template> </lyte-button> </template><template case="false"> <lyte-button data-zcqa="PupHome_button_deletebtn" id="visionErrProceedBtn" lt-prop-appearance="failure"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.workflow.rule.tag.remove.popup.confirm.button\')}} </template> </lyte-button> </template></template></template></template> </lyte-modal-footer> </template> </lyte-modal> <lyte-modal data-zcqa="visionErrorModal" id="visionModal" lt-prop-show-close-button="{{closeButton}}" lt-prop-close-on-escape="true" lt-prop-show="false" lt-prop-freeze="true" lt-prop-wrapper-class="crmBoxModal" lt-prop="{&quot;width&quot; : &quot;auto&quot; , &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-max-height="720px" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <template is="if" value="{{expHandlers(action,\'===\',&quot;image_processing&quot;)}}"><template case="true"> <span class="crm-heading-font-size crm-font-bold">{{getI18n("crm.zia.vision.under.validation")}}</span> </template><template case="false"> <span class="crm-heading-font-size crm-font-bold">{{getI18n("crm.zia.vision.failure.message")}}</span> </template></template> </lyte-modal-header> <lyte-modal-content class="visionErrorModalContent"> <template is="if" value="{{expHandlers(action,\'!==\',&quot;image_processing&quot;)}}"><template case="true"> <div class="visionApprovalItm p20 pR br5"> <template is="if" value="{{expHandlers(isAdmin,\'!\')}}"><template case="true"> <div class="br5 boxBB dIF jcCenter aiCenter pR visionApprovalImgSec {{if(createImgSrc,\'visionApprovalImgSec_withImg pointerEventsNone\',\'\')}} "> <div class="visionApprovalImg dIB vaM {{if(createImgSrc,\'\',\'visionApprovalImg_detailPage\')}} "> </div> </div> <div class="crmParagraphColor lh20 minW430 mB10 mL10">{{displayMessage}}</div> </template></template> <template is="if" value="{{expHandlers(approval.image,\'&amp;&amp;\',isAdmin)}}"><template case="true"> <div class="br5 boxBB dIF jcCenter aiCenter pR visionApprovalImgSec"> <div class="visionApprovalImg dIB vaM"></div> </div> <div class="visionApprovalDetSec dIB vaM mL15 crmParagraphColor crm-small-font-size"> <div class="lh20">{{displayMessage}}</div> <span class="dIB vaM crmLinkColor cP ">{{getI18n(\'crm.zia.vision.training.images\')}}</span> </div> </template></template> </div> </template><template case="false"> <div class="crmParagraphColor lh20 minW430 mB10">{{displayMessage}}</div> </template></template> </lyte-modal-content> <lyte-modal-footer class="right"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(isAjaxEdit,\'||\',isDetailPage),\'||\',expHandlers(action,\'===\',&quot;image_processing&quot;)),\'&amp;&amp;\',expHandlers(is_edit_page,\'!\'))}}"><template case="true"> <lyte-button data-zcqa="visionDetailClose" onclick="{{action(\'closeInfo\')}}" lt-prop-appearance="primary"> <template is="registerYield" yield-name="text"> {{getI18n("crm.zia.vision.failure.okay")}} </template> </lyte-button> </template></template> </lyte-modal-footer> </template> </lyte-modal> <lyte-modal id="visionSamplesModal" lt-prop-freeze="true" lt-prop-wrapper-class="crmBoxModal" lt-prop="{&quot;width&quot; : &quot;auto&quot;, &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-max-height="720px" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <span class="dIB vaM ">{{getI18n(\'crm.zia.vision.image.samples\')}}</span></lyte-modal-header> <lyte-modal-content> <div class="w993"> <template is="for" items="{{validationImages}}" item="key" index="index"> <div class="visionApprovalSampleImg fL" style="background-image: url({{key.image_url}});"></div> </template> <div class="cBoth"></div> </div> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button lt-prop-appearance="primary" data-zcqa="visionImageSampleOkay" onclick="{{action(\'closeSamplePopUp\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("crm.zia.vision.failure.okay")}} </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template><template case="false"> <lyte-messagebox data-zcqa="visionApproval_messageBox" lt-prop-duration="8000" id="visionApproval_messageBox" lt-prop-type="info" lt-prop-message="{{displayMessage}}"> </lyte-messagebox> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[3,1,1]},{type:"text",position:[3,3,0]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"if",position:[5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[3,0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[3,1,0]},{type:"text",position:[3,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[5]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"for",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background-image: url('","key.image_url","');'"]}}}}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[7]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["is_edit_page","action","moduleName","entityId","createImgSrc","attachmentId","isDetailPage","isOnClick","fieldName","visionId","isSaveAndNew","image_category","approvalId","records","nonAdminClass","recImageSysRefName","displayMessage","isAjaxEdit","adminClass","readOnly","closeButton","showActions","editAllowed","isAdmin","disableAllButtons","approval","validation_type","ziaErrorField","contentLiterals","isFromEntityEditPage","isZiaFeedbackPopupShown","deletedFieldLabels"],data:function(){return{is_edit_page:Lyte.attr("boolean",{default:!1}),action:Lyte.attr("string"),moduleName:Lyte.attr("string"),entityId:Lyte.attr("string"),createImgSrc:Lyte.attr("string",{default:""}),attachmentId:Lyte.attr("string",{default:""}),isDetailPage:Lyte.attr("boolean",{default:!1}),isOnClick:Lyte.attr("boolean",{default:!1}),fieldName:Lyte.attr("string"),visionId:Lyte.attr("string"),isSaveAndNew:Lyte.attr("boolean",{default:!1}),image_category:Lyte.attr("string",{default:"desired"}),approvalId:Lyte.attr("string"),records:Lyte.attr("array"),nonAdminClass:Lyte.attr("string",{default:""}),recImageSysRefName:Lyte.attr("string",{default:"Record_Image"}),displayMessage:Lyte.attr("string"),isAjaxEdit:Lyte.attr("boolean",{default:!1}),adminClass:Lyte.attr("string",{default:""}),readOnly:Lyte.attr("boolean",{default:!1}),closeButton:Lyte.attr("boolean",{default:!0}),showActions:Lyte.attr("boolean",{default:!0}),editAllowed:Lyte.attr("boolean",{default:!0}),isAdmin:Lyte.attr("boolean",{default:!1}),disableAllButtons:Lyte.attr("boolean",{default:!1}),approval:Lyte.attr("object"),validation_type:Lyte.attr("string"),ziaErrorField:Lyte.attr("string"),contentLiterals:Lyte.attr("string"),isFromEntityEditPage:Lyte.attr("boolean",{default:!1}),isZiaFeedbackPopupShown:Lyte.attr("boolean",{default:!1}),deletedFieldLabels:Lyte.attr("string")}},init:function(){if(Crm.userDetails.permissions.Crm_Implied_Approve_Actions?this.setData("showActions",Crm.userDetails.permissions.Crm_Implied_Approve_Actions):this.setData("showActions",!1),this.getData("attachmentId")&&this.getData("fieldName")){if(this.getData("isDetailPage"))if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route)this.setData("visionApprovals",Lyte.Router.getRouteInstance().currentModel.entityDetails.image_vision_approvals);else{var t=this.getData("fieldName");if(Crm.renderDVLyteFlow(this.getData("moduleName"))){var e={};e[t]=this.attachmentApprovalsFromInsights(t),this.setData("visionApprovals",e)}else this.setData("visionApprovals",detailView.changedBCJson.hidden.vision_approvals)}this.getData("is_edit_page")&&this.setData("visionApprovals",Lyte.Router.getRouteInstance().currentModel.vision_approvals)}var a,i=this;"image_processing"===i.getData("action")&&i.getData("isSaveAndNew")?i.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.processing",this.getData("moduleName"))):i.getDisplayMessage(i),i.getData("visionId")?this.getVision(i.getData("visionId")).then((function(t){a=t}),(function(){})):a=store.peekRecord("visions",i.getData("visionId")),a&&(i.setData("image_category",null!==a.desired_set&&a.desired_set&&a.desired_set.labels.length>0?"desired":"undesired"),i.setData("validation_type",a.validation_type)),"image_processing"!==i.getData("action")&&i.getData("isOnClick")&&function(){if(i.getData("attachmentId")&&i.getData("fieldName")){for(var t=i.getData("visionApprovals")[i.getData("fieldName")],e=t.length,a=0;a<e;a++)t[a].attachment_id===i.getData("attachmentId")&&(i.setData("visionId",t[a].vision_id),i.setData("approvalId",t[a].visionApproval_id),i.setData("action",t[a].failure_action));var o=store.peekRecord("visions",i.getData("visionId"));o&&(i.setData("image_category",null!==o.desired_set&&o.desired_set&&o.desired_set.labels.length>0?"desired":"undesired"),i.setData("validation_type",o.validation_type))}if(!i.getData("isSaveAndNew")&&(Crm.userDetails.permissions.Crm_Implied_Approve_Actions?(i.setData("isAdmin",!0),i.setData("closeButton",!0),i.setData("adminClass","fL")):i.setData("nonAdminClass","ziaVisionWarningImgSec_nonAdmin"),returnJson.entityMapJson&&returnJson.entityMapJson.PHOTO_FILEID&&i.setData("readOnly",returnJson.entityMapJson.PHOTO_FILEID.readonly),detailView.changedBCJson&&detailView.changedBCJson.hidden&&i.setData("editAllowed",detailView.changedBCJson.hidden.RECORD_FIELDS_EDIT_ALLOWED),!i.getData("approval")&&i.getData("isOnClick"))){if("image_processing"!==i.getData("action")&&window.clientPortalName)return void renderingUtils.displayPermissionDenied();if(!Crm.userDetails.permissions.Crm_Implied_Approve_Actions)return void(window.clientPortalName&&renderingUtils.displayPermissionDenied());var s={};s.record_id=i.getData("entityId"),s.page="1",s.per_page="10",s.fields="object_details",store.triggerAction("visions","record_approvals",{},s).then((function(t){commonUtils.showHideLoadingDiv(!1),t.vision_approvals&&t.vision_approvals[0]?i.approvalsCallbackAndImageFetch(s,t,!1):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.message.fail.validated"),I18n.getMsg("crm.zia.vision.action.performed"),!0)}),(function(t){i.approvalsErrorHandler(t)}))}}()},actions:{closeSamplePopUp:function(){$L("#visionSamplesModal")[0].ltProp("show",!1)},changeImage:function(){$L("#visionModal")[0].ltProp("show",!1),this.getData("is_edit_page")?showUploadPhoto(this.getData("moduleName"),this.getData("entityId"),"edit"):showUploadPhoto(this.getData("moduleName"),this.getData("entityId"))},removeImage:function(){this.getMethods("onDelete")&&(this.executeMethod("onDelete",this.getData("attachmentId")),$("#visionModal")[0].ltProp("show",!1));var t=[],e={image_status:"reject"};e.id=this.getData("approvalId"),t.push(e),this.setData("selectedAppObj",t),commonUtils.showHideLoadingDiv(!0);var a={};a.id=this.getData("entityId"),a.module=moduleRecordMapping[this.getData("moduleName")],this.setData("selectedRecord",a),this.triggerBulkReviews(this,(function(t){t.vision_image_approvals&&"success"===t.vision_image_approvals[0].status&&Lyte.Router.getRouteInstance().refresh(),commonUtils.showHideLoadingDiv(!1),scopeThis.setData("disaleAllButns",!1)}))},closeInfo:function(){$("#visionModal")[0].ltProp("show",!1)},hide:function(){$L("#zv_confirmModal")[0].ltProp("show",!1)},callAlertDeleteEntityImage:function(t,e,a){alertDeleteEntityImage(t,e,a)}},methods:{closeHelpZiaPopupModal:function(t){if($L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!1),$L("#zv_confirmModal")[0].ltProp("show",!1),t){var e=$L("crm-create-buttons");e[0]&&e[0].component.setData("disableFormbuttons",!1)}},offClickEvents:function(){$L("#visionErrProceedBtn").off("click")}}},{mixins:["crm-vision-create","crm-vision-validation","crm-vision-match-utils","crm-vision-image-utils"]});
