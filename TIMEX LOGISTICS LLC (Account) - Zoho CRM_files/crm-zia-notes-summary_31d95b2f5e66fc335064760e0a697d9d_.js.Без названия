Lyte.Component.register("crm-zia-notes-summary",{_template:'<template tag-name="crm-zia-notes-summary"> <template is="if" value="{{expHandlers(fromCanvas,\'!\')}}"><template case="true"> <span id="summarizeNotes" class="cP crmLinkColor {{if(fromCanvas,\'mR12\',\'mR17\')}}" onclick="{{action(\'showNotesSummaryModalAction\')}}" data-zcqa="summarize_notes"> {{getI18n(\'crm.zia.summary.summarize\')}}</span> </template></template> <lyte-modal id="zia_notes_summary_modal" lt-prop-close-on-escape="false" lt-prop-allow-multiple="true" on-before-close="{{method(\'closeSummaryModal\')}}" lt-prop-show="{{show}}" lt-prop-prevent-focus="true" lt-prop-width="650px" lt-prop-max-height="95%" lt-prop-height="auto" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromTop&quot;,&quot;duration&quot;:&quot;0.5&quot;}" lt-prop-offset="{&quot;top&quot;:0,&quot;left&quot;:&quot;center&quot;}" lt-prop-show-close-button="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> {{getI18n(\'crm.zia.summary.summarybyzia\')}} </lyte-modal-header> <lyte-modal-content> <div data-zcqa="notes_summary" class="br_border2 lh24 p25 br10 wbBreakWord"> <template is="if" value="{{last_note_summary}}"><template case="true"> <div data-zcqa="last_note_summary_heading" class="crm-font-bold crm-subheading-font-size"> {{getI18n(\'crm.zia.summary.lastnote\')}} </div> </template></template> <div data-zcqa="last_note_summary_content" class="{{if(isOverallPresent,\'mT8\',\'\')}}"> {{last_note_summary}} </div> <template is="if" value="{{isOverallPresent}}"><template case="true"> <div data-zcqa="overall_summary_heading" class="crm-font-bold crm-subheading-font-size mT15"> {{getI18n(\'crm.zia.summary.overall\')}} ({{date}}) </div> <div data-zcqa="overall_summary_content" class="mT8"> {{overall_summary}} </div> </template></template> </div> </lyte-modal-content> <lyte-modal-footer> <crm-zia-feedback enable-like="{{lbind(enableLike)}}" enable-dis-like="{{lbind(enableDisLike)}}" feature="NotesSummary" feature-feedback-event="Zia Notes Summary" feedback-primary-question="How helpful were these results?" feedback-secondary-question="Help make Zia better" module="{{module}}" feedback-options="{{feedbackOptions}}"></crm-zia-feedback> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"if",position:[3,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"text",position:[3,1,3,1]},{type:"attr",position:[3,1,5]},{type:"if",position:[3,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3]},{type:"text",position:[3,1]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"componentDynamic",position:[5,1]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["fromCanvas","recordId","show","overall_summary","last_note_summary","date","notesCount","filter","isOverallPresent","enableLike","enableDisLike","feedbackOptions"],data:function(){return{fromCanvas:Lyte.attr("boolean",{default:!1}),recordId:Lyte.attr("string"),show:Lyte.attr("boolean",{default:!1}),overall_summary:Lyte.attr("string",{default:""}),last_note_summary:Lyte.attr("string",{default:""}),date:Lyte.attr("string"),notesCount:Lyte.attr("number",{default:0}),filter:Lyte.attr("string"),isOverallPresent:Lyte.attr("boolean",{default:!1}),enableLike:Lyte.attr("boolean",{default:!1}),enableDisLike:Lyte.attr("boolean",{default:!1}),feedbackOptions:Lyte.attr("array",{default:[{display_value:"crm.zia.notes.summary.feedback.reason_one",system_value:"Summary lacks key information or crucial points"},{display_value:"crm.zia.notes.summary.feedback.reason_two",system_value:"Contains factual inaccuracies or misinterpretations"},{display_value:"crm.zia.notes.summary.feedback.reason_three",system_value:"Length of summary is either too long or too brief"},{display_value:"crm.zia.notes.summary.feedback.reason_four",system_value:"Grammar or spelling errors present in the summary"},{display_value:"crm.zia.notes.summary.feedback.reason_five",system_value:"Summary is unclear or confusing to comprehend"}]})}},actions:{showNotesSummaryModalAction:function(){this.executeMethod("showNotesSummaryModal")}},methods:{closeSummaryModal:function(){this.setData({show:!1,enableLike:!1,enableDisLike:!1})},showNotesSummaryModal:function(){commonUtils.showHideLoadingDiv(!0);var e=this,t=this.getData("module"),a=this.getData("recordId"),o=this.getData("filter");this.getData("fromCanvas")&&(t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],a=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],o=$L("crux-note")[0].component.data.cxPropSelectedFilter);var s=null;!o||"Contacts"!==t||"accountsNotesonly"!==o&&"Contacts"!==o?!o||"Accounts"!==t||"accountsNotesonly"!==o&&"Accounts"!==o?!o||"Accounts"!==t||"projectNotesOnly"!==o&&"Projects"!==o||(s=e.getFilter("Projects_Only")):s=e.getFilter("Accounts_Only"):s=e.getFilter("Contacts_Only");var r="",i="";Crm.client_tracking("Zia Notes Summary",{module:t}),Lyte.injectResources([networkUtils.returnDependencyFiles(["note_model.js"],ResourceConstants.CRMClient)],void 0,(function(){store.triggerAction("note","zia_summary",{module:moduleApiMapping[t],entityId:a,action:"zia_summary",filters:encodeURIComponent(s)}).then((function(t){if(0===Object.keys(t).length)return _cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"error",ltPropMessage:"The action you are trying to perform could not be completed. Please refresh the page and try again."}}),void commonUtils.showHideLoadingDiv(!1);e.setData("isOverallPresent",!1);for(let l=0;l<2;l++)if("overall"===t.zia_summary[l].type){if(null!==(r=t.zia_summary[l].message)){var a=t.zia_summary[0].details.from_date.split("T")[0],o=$L.moment($L.moment(a).toDate()).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()),s=t.zia_summary[0].details.to_date.split("T")[0],n=$L.moment($L.moment(s).toDate()).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase());o===n?e.setData("date",o):e.setData("date",o+" - "+n),e.setData("isOverallPresent",!0)}}else"recent_record"===t.zia_summary[l].type&&(i=t.zia_summary[l].message);e.setData("overall_summary",r),e.setData("last_note_summary",i),commonUtils.showHideLoadingDiv(!1),e.setData("show",!0)})).catch((function(e){if(""!==e.response){var t=JSON.parse(e.response);"NOT_SUPPORTED"===t.code&&"only english language is supported"===t.message||"INVALID_DATA"===t.code&&"Insufficient length for processing"===t.message?_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"error",ltPropMessage:"Available notes lack sufficient English language content to generate a summary."}}):"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code||"INVALID_DATA"===t.code&&t.details&&t.details.resource_path_index&&2===t.details.resource_path_index?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):"FEATURE_NOT_SUPPORTED"===t.code?_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"error",ltPropMessage:"Some changes have been made to the user count/subscription. Please refresh to see the updates."}}):_cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"error",ltPropMessage:"We are facing some technical failure please try again later sometime"}})}else _cruxUtils.showCustomMessage({params:{ltPropDuration:"3000",ltPropType:"error",ltPropMessage:"We are facing some technical failure please try again later sometime"}});commonUtils.showHideLoadingDiv(!1)}))}))}},getFilter:function(e){const t={comparator:"not_equal"},a={};switch(e){case"Accounts_Only":a.api_name="Parent_Id->Accounts.id";break;case"Contacts_Only":a.api_name="Parent_Id->Contacts.id";break;case"Projects_Only":a.api_name="Parent_Id->Projects.id"}return t.field=a,t.value="${EMPTY}",JSON.stringify(t)}});
