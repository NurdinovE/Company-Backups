var taskKanbanViewCache="",mySetupArray=[],permissionDenied=!1,CScriptLib="undefined"!=typeof CScript,CScriptComp=!1,isLyteViewPortEnabled=!0,Crm={subformVsNewRowIds:{},subformVsCachedRowIds:{},subformVsRemovedRowIds:{},productIdVsDetails:{},smartPromptSupportedModules:["Leads","Contacts","Accounts","Potentials","Tasks","Events","Calls","Services","Quotes","Products","SalesOrders","Campaigns","Vendors","PriceBooks","Cases","Solutions","Appointments"],ziaSummarySupportedModules:["Leads","Contacts","Accounts","Potentials","Campaigns","Tasks","Cases","Events","Calls","Solutions","Products","Vendors","PriceBooks","Quotes","SalesOrders","PurchaseOrders","Invoices"],lyteHeaderNotSupportedModules:[],lyteDVNotSupportedModules:["Visits","CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005","CustomModule5006","CustomModule5007","CustomModule5008","CustomModule5009","CustomModule5010","Messages"],crmSupportedLocales:["bg_BG","cs_CZ","da_DK","de_DE","en_GB","en_US","es_ES","fr_FR","he_IL","hi_IN","hr_HR","hu_HU","it_IT","iw_IL","ja_JP","ko_KR","nl_NL","pl_PL","pt_BR","pt_PT","ru_RU","sv_SE","tr_TR","vi_VN","zh_CN","zh_TW","ar_EG","th_TH","in_ID"],getCrmBasePath:function(){return"undefined"!=typeof crmBasePath&&crmBasePath?crmBasePath:"/crm"},isWorkdriveNotConfigured:!1,isWorkflowSuggestionEnabled:!0,isRestrictionEnabled:!0,threshold:{configCount:{}},csrfcookiename:"crmcsr",newHistoryArr:[],moduleName:"",moreFldNameVsValue:{},currentPageData:{},isRecordModified:!1,isFieldsJSLoaded:!1,isModulesJSLoaded:!1,isVertical:!1,Vertical:{appName:"",appDomain:"",zaid:""},formCounter:0,jsonDepValues:{},jsonSelectValues:{},jsonDepValues_Quick:{},jsonSelectValues_Quick:{},lookupFilterObj:{},latestEntId:void 0,LOG:{},CURRENT_REQUEST:{},trackSpotLightAction:async function(e,t,r){try{if(e&&"Lookup Click"===e&&featuresAvailable.PUBLIC_FIELD){let e=event.srcElement.getAttribute("data-params"),a=null===e?t&&t.id?t.id:void 0:JSON.parse(e).id,i=null===e?t&&t.Module?t.Module:void 0:JSON.parse(e).module;try{if(null===e&&(e=event.currentTarget.getAttribute("data-params"),a=JSON.parse(e).id,i=JSON.parse(e).module),!a||!i){let e=event.srcElement.closest("link-to");e&&"LINK-TO"===e.tagName&&e.getAttribute("lt-prop-route").includes("entity")&&(a=e.getAttribute("lt-prop-dp")[1],i=e.getAttribute("lt-prop-dp")[0])}return!a||!await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(i,a,event)}catch(e){return r&&r(),!0}}else r&&r();return}catch(e){murphy.error(e)}},moduleInfo:void 0,selectedModule:void 0,userDetails:void 0,isNewEditor:!0,fieldDependency:[],isPageLoad:!1,REQUEST_QUEUE:{},userDetails:{},userBusinessCard:{},requestParam:{},fieldsObj:{},currencyFields:{},origin:"",editReqFrom:"listView",approvalActions:{},canvasTab:{},predictionLimit:0,predictionCount:0,churnLimit:0,churnCount:0,isChurnAvailable:!1,defaultObj:["Crm","crmTab","crmSetup","crmReports","CrmDashboard","crmListView","crmTemplate","crmEmailStats","CML","CMB","Macro","crmRelatedList","migrate","CVRCust"],clickEventIdVsMethodMapping:{refreshRoute:"Crm.refreshRoute",deleteEntity:"Crm.deleteEntity",backOneLevel:"crmHistory.backOneLevel",backToListView:"crmHistory.backToListView",back:"crmHistory.back",GlobalSearch:"ajaxGSearch",editbtn:"Crm.editEntity",clonebtn:"Crm.cloneEntity",detailView:"Crm.lyteTransition",NavPrevious:"crmNavig.navigateRecord",NavNext:"crmNavig.navigateRecord",tkvshowmore:"Crm.taskKanbanViewShowMore",kanbanviewentity:"Crm.lyteTransition",apprDetailView:"Crm.lyteTransition",ReportRelCV:"CrmDashboard.getMoreReportsRecords",slackshare:"Crm.loadChatIntegrations",cliqshare:"Crm.loadChatIntegrations",googlechatshare:"Crm.loadChatIntegrations",ciscoteamsshare:"Crm.loadChatIntegrations",microsoftteamsshare:"Crm.loadChatIntegrations"},initApprovalActions:function(){Crm.approvalActions={WebToContactApproval:Crm.getCrmBasePath()+"/WebContactApproval.do?mod=true",WebToCaseApproval:Crm.getCrmBasePath()+"/WebCaseApproval.do?mod=true",WebToLeadApproval:Crm.getCrmBasePath()+"/WebLeadApproval.do?mod=true&actionName=0&showDuplicates=0",WebRecordApproval:Crm.getCrmBasePath()+"/WebRecordApproval.do?mod=true&actionName=0&showDuplicates=0"}},taskKanbanViewShowMore:function(e,t){var r={};t&&(r=JSON.parse($(t).attr("data-params")));var a=$("#"+r.kvmodule+"_startindex").val();r.startindex=a,r.columntype=r.kvmodule,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/ShowDetails.do",data:r,success:function(e){Lyte.injectResources(networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","calls-kanbancard.js","crux-lookupfilter-component.js","crux-column-list.js","businesscard_model.js"],ResourceConstants.CRMClient),void 0,(function(){crmListView.kanbanView(e),init(r,"kanbanview")}))}})},goToKanbanViewEntity:function(e,t,r,a){if(document,getElemById("cvEditSave")&&document,"none"===getElemById("cvEditSave").style.display||iskvFollowupTask){t&&(params=JSON.parse($(t).attr("data-params")));var i=$(t).attr("id");if(!r&&TaskKanbanView.kvrecordid===i)return;"Tasks"===$("#module").val()&&showHideLockIcon(params.id,a),loadActivityDetails(e,t,params,params.id),TaskKanbanView.kvrecordid=i,iskvFollowupTask=!1}else showConfirmBox(t)},activityGrp:{Tasks:"Activities",Events:"Activities",Calls:"Activities",Activities:"Activities"},deleteEntity:function(e,t,r){var a=r||JSON.parse($(t).attr("data-params"));"Contacts"!==a.module&&"Accounts"!==a.module||!(null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.isZBCustomModuleEnabled:zbCustomModuleObjForAccountContactDeletion.isZBCustomModuleEnabled)?Crm.deleteEntity_new(e,t,a):ZInvoice.getAlertContentOnContactDelete(e,t,a)},deleteEntity_new:function(e,t,r){renderingUtils.stopEvent(e);r=r||JSON.parse($(t).attr("data-params"));if($(t).hasClass("fromDeletePopup"))if("true"!==$("#iskanbanview").val()||"Tasks"==r.module){if(commonUtils.showHideLoadingDiv(!0),r){var a=0;if("calendar"!==r.from)if(Crm.renderDVLyteFlow("Campaigns")&&"Campaigns"===r.module)a=$L("crm-detail-view")[0].component.data.transitionData.recordNum;else a=parseInt(document.getElementById("recordNum").value);var i=Crm.getCrmBasePath()+"/MassDelete.do?module="+r.module+"&id="+r.id;r[csrfParamName]=csrfToken,paramcsrf=csrfParamName+"="+encodeURIComponent(csrfToken);var n=paramcsrf+"&recordNum="+a+"&isajax=true";"Events"!==r.module&&"Tasks"!==r.module||(n+="&delOpt="+r.delOpt+"&from="+r.from);var o=crmHistory.getState(),s=o.data?o.data.pfrom:"",l=r.id,d=r.module,c=r.delOpt,m=r.dateval,u="Activities"!==Crm.activityGrp[d]||Crm.isActivitySplitDone?d:"Activities",p=void 0;(new crmRequestPool).initiate({type:"POST",url:i,data:n,success:function(e){commonUtils.showHideLoadingDiv(),hideAnimatePopup("deletepopup"),"undefined"!=typeof EmailComposeUtil&&EmailComposeUtil&&$("#etComposePanel").length>0&&EmailComposeUtil.closeTabAtDeleteRecords([l]);var t=e.orchestration_used;if(t)Crm.showOrchUsedDenyPopUp(t);else{$("#rItemDataDiv").find("#recentItemImg_"+l).remove(),0===$("#rItemDataSubDiv").find("a").length&&$("#rItemDataSubDiv").find("td").append('<div id="recentitems_empty_msg">'+I18n.getMsg("crm.msg.recentitems.empty")+"</div>");var r=$("#ajax_"+d);if(r.find("#"+d+"_"+l).remove(),r.find("[id^="+d+"_]").length||r.remove(),renderingUtils.removeDummyBackground(),"calendar"===e.from){if(_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.label.deleted.successfully"),ltPropDuration:"4000",ltPropShow:!0}}),calView.isMultiUserView)"dayview"===calView.currCalView?"Tasks"===d?calView.needRefresh=!0:Events.handleEvtDelinMulUserDayView(l):"weekview"===calView.currCalView?Events.handleEvtDelinMulUserWeekView(l):Events.handleEvtDelinMulUserMonthView(l),"upcomingEv"==c&&(calView.needRefresh=!0);else{if(calView.needRefresh=!0,"upcomingEv"===c)$("#moreEventsAllDiv").is(":visible")||(calView.needRefresh=!0);else{if("monthview"===calView.currCalView)Events.eventsCntDatewise[m]>5&&!$("#moreEventsAllDiv").is(":visible")&&(calView.needRefresh=!0);calView.needRefresh=!0}if($("#moreEventsAllDiv").is(":visible"))$("#moreEvent_"+l).remove(),PopSetCenter("moreEventsAllDiv"),$("#moreEventsAllDiv").find(".moreEvInner p").length<=0&&Events.closeMoreEventDiv()}return calView.needRefresh&&calView.refresh(),Events.closeQuickView(),!0}if(crmTab.deleteFromCache(u),"object"==typeof e&&(p=e),p&&p.CannotDelete){var i='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg(p.CannotDelete[0])+'</h2></div><div class="mT10">'+I18n.getMsg(p.CannotDelete[1])+'</div></div><br class="cBoth"><div  class="alignRight mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(i)}else{if("upcomingEv"!==c&&crmNavig[crmNavig.customViewKey]&&"rel"!==s&&a){"Activities"===Crm.activityGrp[u]&&updateRecordNumParam(l),crmNavig[crmNavig.customViewKey].recordId[a]&&$("#detailView_"+crmNavig[crmNavig.customViewKey].recordId[a].id).remove(),crmNavig[crmNavig.customViewKey].recordId.splice(a,1);var n=$("#detailCView").children().length;if(n>0&&n<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var o=parseInt(getObj("cvFromIndex").value);$("#from_To").text(o+" - "+(o+n-1))}var v=history.state.data;v.fromDel="true",v.clickId="NavNext",v.module=d;var g=$("#cvToIndex");if("Activities"===Crm.activityGrp[u]&&g.length){var f=parseInt(g.val())-1;g.val(f),$("input[name=toIndex]").val(f)}crmNavig.navigateRecord(void 0,void 0,v)}else"rel"==s?$(".selectedRightActivity").next()[0]?$(".selectedRightActivity").next().children()[0].click?$(".selectedRightActivity").next().children()[0].click():$(".selectedRightActivity").next().children().trigger("click"):$(".selectedRightActivity").prev()[0]?$(".selectedRightActivity").prev().children()[0].click?$(".selectedRightActivity").prev().children()[0].click():$(".selectedRightActivity").prev().children().trigger("click"):crmHistory.backOneLevel():crmHistory.backOneLevel();var C=store.peekAll("user").filter((function(e){return"Client Portal User"===e.type__s}));void 0!==C&&store.unloadAll("user",C)}}},error:function(e){var t='<div onclick=/"sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()])+'</div></div><br class="cBoth"><div  class="alignRight mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";e&&401!=e.status&&(renderingUtils.popUpWithFreeze(t),commonUtils.showHideLoadingDiv()),hideAnimatePopup("deletepopup")}})}}else TaskKanbanView.deleteEntity(r.module,r.id);else{var v=[],g="Events"===r.module?$("#entityNameInBCView").text():$("#entityName").val();if(!g&&r.entityName&&(g=r.entityName),r&&"calendar"===r.from&&"Tasks"===r.module&&(g=r.taskName,t.setAttribute("data-params",JSON.stringify(r)),t.setAttribute("data-cid","deleteEntity")),"Calls"===r.module&&isNewCallView){var f=$("#callsdp_subject").val();if(!f){var C=store.peekRecord(Crm.moduleInfo[r.module].Id,r.id);f=C?C.Subject:f}g=f||g}g=g&&g.length>45?g.substring(0,35)+"...":g,v.push(g);var h=I18n.getMsg("crm.warning.delete.record",v),y=isRelatedRecordsModule(r.module)?I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(r.module)):"";"Events"===r.module?Events.valDeleteEvent(r.id,"detailView"===r.from,r.delopt,h,t):"Tasks"===r.module?crmTasks.confirmDeleteTask(r.id,"detailView"===r.from,r.delopt,h,t,r):showDeletePopup(h,"crm.button.delete","",y,t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,r)}},clickHandler:function(e,t,r){var a=r;if(this.clickEventIdVsMethodMapping[a]){var i=$(t).attr("data-params");return i||(i={}),"string"==typeof i&&(i=JSON.parse(i)),i.calleeObj=i.calleeObj||"Crm",i.clickId=a,$(t).attr("data-params",JSON.stringify(i)),Lyte.registeredMixins["crm-utilities"].executeFunctionByName(this.clickEventIdVsMethodMapping[a],window,e,t),!1}return!0},addRecentItems:function(e,t){var r=$("#entityName"),a=$("#entityNameInBCView");if((r.length>0||a.length>0)&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame){var i="Events"===t?a.text().trim():r.val(),n=Crm.getCrmBasePath(),o={Type:"RecentItems",DisplayName:i,ClickAction:(n=n.replace("/",""))+"/EntityInfo.do?module="+t+"&id="+e,Module:moduleRecordMapping[t].singular_label};CrmPlusLib.addRecord(o)}},showAlertMsg:function(e,t){if($("#crmEmailOuterContainerDiv").is(":visible")||$("#ewfAdminWF").is(":visible")){var r=$("#emailAlertMsgContainer");r.find(".infoCont").text(e),r.find(".confirm").click((function(){Crm.hideAlertMsg((function(){t&&$(t).focus()}))})),r.show(),r.find(".confirm").focus(),mailsetCenter(r.attr("id")),r.css("top","200px")}else alert(e),t&&$(t).focus()},hideAlertMsg:function(e){$("#emailAlertMsgContainer").hide(),e&&e()},showOrchUsedDenyPopUp:function(e,t){commonUtils.showHideLoadingDiv();var r=$("#customConfirmationPop");r.html(Handlebars.templates.deleteFieldWarningPopup()),r.css("visibility","visible"),renderAutomationDenyPopComp(e,void 0,void 0,"#automationdiv"),t?($("#delfldhd").html(I18n.getMsg("crm.automation.cannot.deactivate.delete.text")),$("#deleteInfo1").html(I18n.getMsg("crm.ap.journey.deactivate.delete.info")),$L("#btnskip").hide()):($("#delfldhd").html(I18n.getMsg("crm.automation.cannot.delete.text",[I18n.getMsg("Campaign")])),$("#deleteInfo1").html(I18n.getMsg("pf.cc.pf.err.delete.info",[I18n.getMsg("Campaign")])),setTimeout((function(){var e=$("#PathFinder_State");e[0]&&e.html(I18n.getMsg("crm.setup.system.pathfinder")+" > "+I18n.getMsg("pf.touchpoints"))}),200)),crmui.showPopup("deletefield")},showOrchUsedBUlkDenyPopUp:function(e,t){var r;commonUtils.showHideLoadingDiv(),hideAnimatePopup("deletepopup");var a=[],i=[],n={Transition:[]};if(t){var o=$("#massResult");if(!((r=document.TransferWizardForm.chk)instanceof NodeList)){var s=[];s.push(r),r=s}}if(e.Orchestration){for(var l in e.Orchestration)n.Transition=n.Transition.concat(e.Orchestration[l].Transition),delete e.Orchestration[l],t?r.forEach((function(e){e.value==l&&(a.push(o.find("#"+l+" :nth-child(2)")[1].innerText),i.push(l))})):crmListView.getObject().body.forEach((function(e){e.id==l&&(a.push(e.Campaign_Name),i.push(l))}));e.Orchestration.transitions=n}if(e.PathFinder){var d={State:[]};for(var l in e.PathFinder){if(d.State=d.State.concat(e.PathFinder[l].State),delete e.PathFinder[l],t)r.forEach((function(e){e.value===l&&(a.push(o.find("#"+l+" :nth-child(2)")[1].innerText),i.push(l))}));else crmListView.getObject().body.forEach((function(e){e.id===l&&(a.includes(e.Campaign_Name)||a.push(e.Campaign_Name),i.push(l))}))}e.PathFinder.states=d}renderingUtils.popUpWithFreeze(Handlebars.templates.deleteFieldWarningPopup()),renderAutomationDenyPopComp(e,void 0,void 0,"#automationdiv"),$("#delfldhd").html(I18n.getMsg("crm.automation.cannot.delete.text",[I18n.getMsg("crm.campaign.few")])),$("#deleteInfo1").html(I18n.getMsg("pf.campaign.delete.bulk",$ESAPI.encoder().encodeForHTML(a.join(", ")))),$("#deleteInfo2").html(I18n.getMsg("pf.bulk.delete.denypop")),$("#popupnew").css("position","fixed"),t||(crmListView.getObject().selectedIds=crmListView.getObject().selectedIds.filter((function(e){return!i.includes(e)})));var c=$("#btnclos");if(t&&r.length!=i.length||!t&&crmListView.getObject().selectedIds.length>0){c.hide();var m=$("#btnskip"),u=$("#btncancel");u.show(),m.show(),u.click((function(){t?Crm.clearMassDelSelection():clearSelection()})),m.click((function(){Crm.skipAndProceed(i,t)}))}else c.click((function(){t?Crm.clearMassDelSelection():clearSelection()}));crmui.showPopup("deletefield")},clearMassDelSelection:function(e){try{document.TransferWizardForm.chk.forEach((function(t){e?e.includes(t.value)&&(t.checked=!1):t.checked=!1}))}catch(e){document.TransferWizardForm.chk.checked=!1,document.TransferWizardForm.allcheck.checked=!1}document.TransferWizardForm.allcheck.checked=!1},skipAndProceed:function(e,t){crmui.hidePopup("deletefield"),t?(Crm.clearMassDelSelection(e),massActionWizard("massdelete","MassDelete","&target=MassRecords")):massActionDelete("massdelete","MassDelete",""),commonUtils.showHideLoadingDiv()},scrollPage:function(){if(Crm.scrollToElem){"tasks"!=Crm.scrollToElem&&"events"!=Crm.scrollToElem&&"calls"!=Crm.scrollToElem||(Crm.scrollToElem="activity");var e=$("[id^='"+Crm.scrollToElem+"']")[0];showDrillDownPtr($(e).attr("name"))}Crm.scrollToElem=void 0},loadDefaultConstants:function(){crmConstants.fullDaysArray=[{html:I18n.getMsg("Sunday"),value:"1"},{html:I18n.getMsg("Monday"),value:"2"},{html:I18n.getMsg("Tuesday"),value:"3"},{html:I18n.getMsg("Wednesday"),value:"4"},{html:I18n.getMsg("Thursday"),value:"5"},{html:I18n.getMsg("Friday"),value:"6"},{html:I18n.getMsg("Saturday"),value:"7"}]},sameModuleExlude:{convert:!0,editbtn:!0,createbtn:!0,clonebtn:!0,showMacro:!0,macrobtn:!0},toolTipObj:{usersPermi_assignTerritory:"crm.territory.title.assign.territories",GlobalSearch:"crm.label.search.result",GlobalSearch1:"crm.label.search.result",massTransfer:"crm.permission.mass.transfer.CustomModule",WebToLeadApproval:"crm.title.web.lead.approval",WebToContactApproval:"crm.title.web.lead.approval",WebToCaseApproval:"crm.title.web.lead.approval",massDelete:"crm.permission.mass.delete.CustomModule",massEmail:"crm.permission.mass.email.leads",massUpdate:"crm.permission.mass.update.CustomModule"},errorMsgArray:{default:{mandate:"crm.field.empty.check",maxLen:"crm.field.length.check",maxLimit:"crm.field.limit.check",mxncloneproceed:"",type:{integer:"crm.field.valid.check",String:"Only String allowed",decimal:"crm.field.valid.decimal.check2"}}},logDetails:"",pushForStats:function(e,t){0===this.logDetails.length&&(this.timerInterval=setTimeout((function(){0!==Crm.logDetails.length&&($.ajax({url:Crm.getCrmBasePath()+"/BlankRequest.do",type:"POST",data:{data:Crm.logDetails},success:function(){}}),Crm.logDetails="")}),3e3)),this.logDetails+=e+":"+t+","},init:function(e,t,r,a,i){commonUtils.registerAjaxSendForOrgHeader(),moduleApiMapping={},moduleApiVsNameMapping={},idModuleMapping={},moduleRecordMapping={},registeredEntity=[],store.pushPayload("module",moduleDetailedInfo.modules,!0),app.newSubVersion=crmConstants.subVersion,app.historyLength=1,location.hrefURL=window.formRedirectionUrl?window.formRedirectionUrl:document.location.href;var n=new URL(document.location.hrefURL),o=n.searchParams.get("redirectionId");o&&(FingerPrint.tabId=o,n.searchParams.delete("redirectionId"));var s=crmHistory.getNewURL(n.toString());history.replaceState(history.state,document.title,s),50==history.length&&(history.length=1),e.RTL_ENABLED&&(crmConstants.lessStaticPathForLyte="/crm/CRMClient/css/compiled-css/default/rtl/"),networkUtils.checkscriptSource(),Crm.initialHistoryIndex=window.history.length,Lyte.Router.init(),Lyte.injectResources(networkUtils.returnDependencyFiles(["zcrm_predictive_prefetch.js"],ResourceConstants.CRM)),(cookieUtils.getCookie("crmtrialEnabed")||cookieUtils.getCookie("crmtrialEnabedFrmSetup"))&&setTimeout((function(){if(cookieUtils.getCookie("crmtrialEnabedFrmSetup")){var e=Handlebars.templates.TrialSuccessThroSetup();$("#HigherEdnTrialSuccessDiv").html(e),mailsetCenter("HigherEdnTrialSuccessDiv"),renderingUtils.freezeBackground(),cookieUtils.deleteCookie("crmtrialEnabedFrmSetup","/")}else{var t=I18n.getMsg("crm.trial.success.display.message",I18n.getMsg(Crm.userDetails.TRAIL_TYPE));crmui.showMsgBand("success",t,5e3),cookieUtils.deleteCookie("crmtrialEnabed","/")}}),500),cookieUtils.getCookie("crmtrialCancelled")&&setTimeout((function(){var e=I18n.getMsg("crm.trial.cancelled.display.message",I18n.getMsg(Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME));crmui.showMsgBand("success",e,5e3),cookieUtils.deleteCookie("crmtrialCancelled","/")}),500),RebrandLinkUtil.setProperties(i),this.registerPartials();try{networkUtils.loadFeatureScripts(["zohocrm_crmExportWMSMsg.js"],(function(){crmExportWMSMsg.init&&"function"==typeof crmExportWMSMsg.init&&(crmExportWMSMsg.export=crmExportWMSMsg.export+"_"+e.USER_ID,crmExportWMSMsg.init())}),!0),networkUtils.loadFeatureScripts(["zohocrm_wmsbar.js"],void 0,!0)}catch(e){}"Mozilla"!==$L.userAgent.browser&&"Firefox"!==$L.userAgent.browser||(document.addEventListener("keydown",(function(e){window.event=e}),!0),document.addEventListener("click",(function(e){window.event=e}),!0),document.addEventListener("mouseenter",(function(e){window.event=e}),!0),Events.reminderNotificationImgUrl=networkUtils.getImageUrl("event_reminder_feed_firefox.png",ResourceConstants.CRM)),$(document).on("dialogopen",(function(e,t){$(".ui-widget-overlay").css("position","fixed")})),$.ajaxPrefilter((function(e,t,r){"script"!=e.dataType&&"script"!=t.dataType||(e.cache=!0),r.always((function(e,t,r){"abort"!==t&&delete Crm.REQUEST_QUEUE[this.url+"---"+this.data]}))}));var l,d={};if($(document).keyup((function(e){"keyup"===e.type&&setTimeout((function(){delete d[e.key]}),200);var t=e.target?e.target:e.srcElement,r=$(t).attr("data-kpid");if(r){var a=$(t).attr("data-params");a&&(a=JSON.parse(a)),"true"==a.multiSel&&"countryAutoSuggest"==r?$(t).autocomplete({minLength:2,source:function(e,t){var r=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term.extractLast()),"i");t($.grep(I18n.properties.COUNTRY_LIST2,(function(e){return r.test(e)})))},search:function(e,t){$(this).data("ui-autocomplete").menu.bindings=$()},focus:function(){return!1},select:function(e,t){var r=split(this.value);return r.pop(),r.push(t.item.value),r.push(""),this.value=r.join(", "),!1}}):$(t).autocomplete({minLength:2,source:function(e,t){var r=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term.extractLast()),"i");t($.grep(I18n.properties.COUNTRY_LIST2,(function(e){return r.test(e)})))},search:function(e,t){$(this).data("ui-autocomplete").menu.bindings=$()}})}var i=void 0;if($("#deletepopup:visible").hasClass("zcrm-show"))var n=(i=$("#deletepopup")).find("#deleteButton:visible");else if($("#WarningdivWebForm:visible").hasClass("zcrm-show"))n=(i=$("#WarningdivWebForm")).find("#webform_del_button:visible");else if($("#statusWarningdiv:visible").hasClass("zcrm-show"))n=(i=$("#statusWarningdiv")).find("#deactiveBtnId:visible").length?i.find("#deactiveBtnId:visible"):i.find("#activeBtnId:visible");else if($("#custom_alert_popup:visible").hasClass("zcrm-show"))n=(i=$("#custom_alert_popup")).find("#custom_alert_button:visible");if(i){var o=e.keyCode;27==o?hideAnimatePopup(i.attr("id")):13==o&&n.length&&n[0].click()}if("Contacts"===Crm.moduleName&&"Crm_Contacts_ACCOUNTID"===e.target.id&&"ACCOUNTID"===e.target.dataset.colname){var s=$("#Crm_Contacts_ACCOUNTID"),l=$("#Contacts_fldRow_REPORTINGTOCONTACTID"),c=$("#Crm_Contacts_REPORTINGTOCONTACTID"),m=void 0!==Crm.moduleInfo.Accounts?Crm.moduleInfo.Accounts.translatedSingularLabel:"Account",u=I18n.getMsg("crm.contact.hierarchy.Specify_account_name",[I18n.getMsg(m)]);s.val().length>0?(c.prop("disabled",!1),c.autocomplete("enable"),l.removeClass("noclick"),l.unbind("mouseover"),l.unbind("mouseout"),l.removeAttr("onmouseenter onmouseleave")):0==s.val().length&&(c.val(""),c.prop("disabled",!0),c.autocomplete("disable"),l.attr({class:"REPORTINGTOCONTACTID tabDivCreate noclick"},{onmouseenter:"renderingUtils.zctt.showtt('"+u+"');"},{onmouseleave:"renderingUtils.zctt.hidett();"}))}onkeydown=function(e){if(!e.metaKey){window.location;e=e||event;var t=document.querySelector("crm-p2p-referral");t&&!1===t.component.data.showReferralPanel&&$("body").click()}},27==e.keyCode&&$(".commonDrop").addClass("hide")})),$(document).keydown((function(e){if("keydown"===e.type){d[e.key]?d[e.key]=d[e.key]+1:d[e.key]=1;var t=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"],r=document.activeElement,a=r.tagName;!t||t.freezeLayerCheck()||r.hasAttribute("contenteditable")||"true"===r.getAttribute("contenteditable")||"SELECT"===a||"TEXTAREA"===a||"INPUT"===a||setTimeout((function(){1!==d["/"]||1!==Object.keys(d).length||t.routeHandling()||(Crm.client_tracking("Keyboard Shortcuts",{Category:"General",Action:"Open Record Search"}),"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame||(featuresAvailable.NEXTGENUI_ENABLED?document.getElementById("leftPaneSearch").click():document.getElementById("topbandSearchIcon").click(),delete d["/"]))}),100)}})),$(document).mousedown((function(e){0!=window.getSelection().isCollapsed||e.shiftKey||3==e.which||(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges?window.getSelection().removeAllRanges():document.selection&&document.selection.empty())})),commonUtils.bindDocumentEvents(),$(window).resize((function(e){clearTimeout(l),l=setTimeout((function(){app.windowRect.innerWidth=window.innerWidth,app.windowRect.innerHeight=window.innerHeight,app.windowRect.outerWidth=window.outerWidth,app.windowRect.outerHeight=window.outerHeight,$("body, html").css("overflow","hidden"),$("body, html").css("overflow",""),crmLayout.Resize.All(),Lyte.triggerEvent("windowResize",{id:"WINDOWRESIZE",event:e})}),200)})),$(document).ajaxSend((function(e,t,r){var a,i;if(t.requestUrl=r.url,a=r.url,(i=document.createElement("a")).href=a,i.hostname==location.hostname&&r.data&&("string"==typeof r.data?r.data=function(e){for(var t=csrfParamName+"=",r=e.split("&"),a=r.length,i=0;i<a;i++)if(0==r[i].indexOf(t)){r[i]=csrfParamName+"="+csrfToken;for(var n="",o=0;o<a;o++)n+=r[o],o!=a-1&&(n+="&");return n}return e}(r.data):"object"==typeof r.data&&csrfParamName in r.data&&(r.data[csrfParamName]=csrfToken)),"object"!=typeof r.data&&!r.url.endsWith(Crm.client_tracking_endpoint))if(Crm.REQUEST_QUEUE[r.url+"---"+r.data]){if(Crm.REQUEST_QUEUE[r.url+"---"+r.data]++,void 0!==r.data&&(-1!==r.data.indexOf("mode=click2call")||-1!==r.data.indexOf("event=makeCall"))){var n=CTIAPI.CTI.ctiname;n=""===n||void 0===n?"phonebridge":n,Crm.pushForStats("CTIAPI_BLOCKED_REQUEST_"+n,r.data)}t.abort(),void 0!==window.console&&window.console.log(r.url+" is already being processed!!!!!! No of tries for the same url : "+Crm.REQUEST_QUEUE[r.url+"---"+r.data])}else Crm.REQUEST_QUEUE[r.url+"---"+r.data]=1})),$(document).ajaxComplete((function(e,t,r){var a=networkUtils.returnDependencyFiles(["zohocrm_EditionExpiry_SandboxDeactivate.js"],ResourceConstants.CRM);Lyte.injectResources(a,void 0,(function(){var e=window.location.href,a=(t.getResponseHeader("clientVersion"),t.getResponseHeader("clientsubVersion"));if(Crm.env.isDevelopment&&"undefined"!=typeof Instrumentdata){if(void 0===Instrumentdata.flag&&(Instrumentdata.flag="true"),t.requestUrl==Crm.getCrmBasePath()+"/Instrument.do"){Instrumentdata.instrumentresp=[];var i=t.responseText;Instrumentdata.flag="false",void 0!==i&&(Instrumentdata.instrumentresp.length>30&&Instrumentdata.instrumentresp.shift(),null!=i&&""==!i&&Instrumentdata.instrumentresp.push("object"==typeof i?i:JSON.parse(i)))}"true"==Instrumentdata.flag&&(Instrumentdata.flag="false")}if(a&&crmConstants.subVersion&&(-1!==e.indexOf("extensions")||-1!==r.url.indexOf("/market/")&&!Crm.isPlatform||(app.newSubVersion=a)),t.getResponseHeader("tiralExpired")&&!$("#trialExpiryDiv").length){Crm.trackSpotLightAction("Trial expiry alert shown");var n=t.getResponseHeader("editionEvaluated"),o=t.getResponseHeader("showExtendTrail"),s={showModal:!0,profileName:Crm.userDetails.PROFILE_NAME,title:I18n.getMsg("crm.trial.expiry.notification.title",I18n.getMsg(n)),message:I18n.getMsg("crm.trial.expiry.notification.message"),option1:I18n.getMsg("crm.store.upgrade.to",I18n.getMsg(n)),option2:I18n.getMsg("crm.trial.expiry.notification.option.move",I18n.getMsg(Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME)),deployment:Crm.userDetails.DEPLOYMENT,contactAdmin:I18n.getMsg("crm.trial.contact.adminstrator"),option3:I18n.getMsg("crm.extend.your.trail"),editionEvaluated:n,showExtendTrail:o};Lyte.Component.render("crm-trial-expiry-popup",s,"body")}if($("#trialExpiryDiv").length&&renderingUtils.showFreezeLayer(),"true"!==t.getResponseHeader("isDeveloperUser")){var l=t.getResponseHeader("statusCode");if("3"!==l&&"6"!==l&&"8"!==l){if("true"===t.getResponseHeader("isAccessRestricted"))if($("#SubscriptionExpiryDiv").length)$("#basic").addClass("bodyBlur"),renderingUtils.freezeBackground();else{var d=(E=Handlebars.templates.EditionExpiryAlert)({action:"subscription",isOnlineStoreAvailable:"true"===t.getResponseHeader("isOnlineStoreAvailable"),profileName:Crm.userDetails.PROFILE_NAME,title:I18n.getMsg("crm.subscription.expired.title"),message:I18n.getMsg("crm.subscription.expired.alert.admin",[Crm.userDetails.PARTNERBRAND,I18n.getMsg(Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME),Crm.userDetails.SUBSCRIPTION_EXPIRED_DATE]),question:I18n.getMsg("crm.trial.expiry.notification.message"),option1:I18n.getMsg("crm.subscription.renew"),option2:I18n.getMsg("crm.subscription.choose.other.edition"),option3:I18n.getMsg("crm.move.to.free"),or:I18n.getMsg("crm.books.configure.or.label"),contactAdmin:I18n.getMsg("crm.subscription.contact.admin.msg")});renderingUtils.freezeBackground(),$("#basic").addClass("bodyBlur"),$("body").append(d)}else if("Administrator"===Crm.userDetails.PROFILE_NAME&&"true"===Crm.userDetails.SHOW_RENEWAL_BANNER&&Crm.userDetails.SUBSCRIPTION_EXPIRED_DATE&&!$(".downgrateMssBand").length){var c=I18n.getMsg("crm.subscription.contact.admin.msg");if("Administrator"===Crm.userDetails.PROFILE_NAME){var m=Crm.userDetails.REMAINING_GRACE_DAYS;c=I18n.getMsg("crm.subscription.renew.days",[m,Crm.userDetails.manageSubscriptionUrl]),Crm.userDetails.REMAINING_GRACE_DAYS<=1&&(c=I18n.getMsg("crm.subscription.renew.today",[Crm.userDetails.manageSubscriptionUrl]))}var u="<div class='downgrateMssBand crm-base-font-size fs crmBaseColor aligncenter dN p7' id='subscriptionExpiryMsgband'>"+I18n.getMsg("crm.subscription.expired.alert.admin",[Crm.userDetails.PARTNERBRAND,I18n.getMsg(Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME),Crm.userDetails.SUBSCRIPTION_EXPIRED_DATE])+"&nbsp;"+c;$("#tabLayer").prepend(u),$(".downgrateMssBand > a").click((function(){Crm.trackSpotLightAction("Renew Subscription - Banner")}));var p=$("#annoncement"),v=$(".downgrateMssBand");0===p.length?v.show():v.hide()}else if($(".downgrateMssBand").length&&!Crm.userDetails.SUBSCRIPTION_EXPIRED_DATE)$(".downgrateMssBand").remove();else if(Crm.userDetails.SHOW_AUTHTOKEN_DEPRECATION_BANNER){$("#basic").addClass("bodyBlur");var g=RebrandLinkUtil.getProperty("MAIL_FEEDBACK_TO"),f={name:"div",attr:{class:"attentionWrapper mAuto"},child:[{name:"div",attr:{class:"attentionParent"},child:[{name:"div",attr:{class:"warnLogo mAuto"}},{name:"div",attr:{class:"attentionContent dIB aligncenter"},child:[{name:"div",attr:{class:"attentionHead pT10"},child:[{name:"text",html:I18n.getMsg("crm.api.deperation.attention")}]},{name:"div",attr:{class:"sunsetDate mAuto crm-small-font-size"},html:I18n.getMsg("It seems that your organization is still using the "),child:[{name:"span",attr:{class:"fwBold"},html:I18n.getMsg("Deprecated AuthToken which will SUNSET on "),child:[{name:"span",attr:{class:"ss_date"},html:"May 31, 2021."}]}]},{name:"div",attr:{class:"moreDetialArea mAuto crm-base-font-size"},html:"A ",child:[{name:"a",attr:{class:"normallinkcol",href:"https://help.zoho.com/portal/en/community/topic/zoho-crm-authtoken-deprecation-6-4-2021"},html:I18n.getMsg("forum post")},{name:"span",attr:{class:"crm-small-font-size"},html:" "+I18n.getMsg("crm.function.authtoken.mail.forum")}]},{name:"div",attr:{class:"pinkContent mAuto crm-base-font-size"},child:[{name:"div",attr:{class:"pinkAreaContent mAuto"},html:I18n.getMsg("crm.function.authtoken.mail.forward"),child:[{name:"span",attr:{class:"fwBold"},html:I18n.getMsg("crm.function.authtoken.mail.data.loss")}]}]},{name:"div",attr:{class:"highLightWords mAuto crm-base-font-size fwBold"},html:I18n.getMsg("crm.function.authtoken.recommend")},{name:"div",attr:{class:"confirmBut cP dIB",onclick:"Crm.authtoken_banner_success()"},child:[{name:"text",content:I18n.getMsg("crm.api.deperation.consent")}]},{name:"div",attr:{class:"contectArea mAuto crm-small-font-size"},html:I18n.getMsg("crm.api.deperation.info",g)}]}]}]};renderingUtils.popUpWithFreeze(renderingUtils.createHTML(f)),$("#FreezeLayer").addClass("freezelayer_zindex"),$("#popupnew").addClass("popupnew_zindex")}else if(Crm.userDetails.SHOW_OLD_OAUTH_SANDBOX_API_DEPR_BANNER){var C=networkUtils.returnDependencyFiles(["crm-old-oauth-depr-banner-sandbox.js"],ResourceConstants.CRMClient),h=h=networkUtils.returnDependencyFiles(["crm-old-oauth-depr-banner-sandbox.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OldOAuthSandboxDepr")],ResourceConstants.CRM);Lyte.injectResources(C.concat(h).concat(y)).then((function(){var e=document.querySelector("crm-old-oauth-depr-banner-sandbox");e||(e=Lyte.Component.render("crm-old-oauth-depr-banner-sandbox","{}","body")).component.executeMethod("showBanner")}))}if(Crm.userDetails.TELEPHONY_BANNER){C=networkUtils.returnDependencyFiles(["crm-old-telephony-depr-banner.js"],ResourceConstants.CRMClient),h=h=networkUtils.returnDependencyFiles(["crm-old-telephony-depr-banner.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OldTelephonyDepr")],ResourceConstants.CRM);Lyte.injectResources(C.concat(h).concat(y)).then((function(){var e=document.querySelector("crm-old-telephony-depr-banner");if(!e){var t=crmCalendar.months[Crm.userDetails.TELEPHONY_BANNER.month+""],r=I18n.getMsg(t)+" "+Crm.userDetails.TELEPHONY_BANNER.date+", "+Crm.userDetails.TELEPHONY_BANNER.year;(e=Lyte.Component.render("crm-old-telephony-depr-banner",{ctiname:Crm.userDetails.TELEPHONY_BANNER.provider,lastdate:"<span class='nowrap'>"+r+"</span>",helpLink:Crm.userDetails.TELEPHONY_BANNER.helplink},"body")).component.executeMethod("showBanner")}}))}if(location.href.indexOf(networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/search"))<0&&$("#gsearchparentdiv").hide(),!0===Crm.isPageLoad&&(Crm.isPageLoad=!1),Crm.userDetails.SHOW_DOT_NOTATION_API_DEPRECATION_BANNER&&"#showDeprecated"!==window.location.hash){C=networkUtils.returnDependencyFiles(["plugin-old-api-notation-depr-banner.js"],ResourceConstants.CRMClient),h=h=networkUtils.returnDependencyFiles(["plugin-old-api-notation-depr-banner.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OldApiNotationPluginDepr")],ResourceConstants.CRM);Lyte.injectResources(C.concat(h).concat(y)).then((function(){var e=document.querySelector("plugin-old-api-notation-depr-banner");e||(e=Lyte.Component.render("plugin-old-api-notation-depr-banner","{}","body")).component.executeMethod("showBanner")}))}0!==t.status&&0!=t.readyState&&delete Crm.REQUEST_QUEUE[r.url+"---"+r.data]}else if($("html,body").addClass("eventNone"),$("#wmstoolbar").addClass("eventNone_remove"),!$("#deactivatedWindow").length){$("#sandboxCssLink").length||Lyte.injectResources(networkUtils.returnDependencyFiles(["sandbox-min.css"],ResourceConstants.CRM));_={deactivate:"true"};"3"===l?(_.headContent="crm.sandbox.deactivated.subject",_.bodyContent="crm.sandbox.deactivated.content"):"6"===l?_.headContent="crm.sandbox.rebuild.description":"8"===l&&(_.headContent="crm.sandbox.data.population.inprogress");var E=Handlebars.templates.sandboxDeactivatedPage(_);$("body").append(E)}}else if($("html,body").addClass("eventNone"),$("#wmstoolbar").addClass("eventNone_remove"),renderingUtils.showFreezeLayer(),$("#freezeBackGround").css("opacity","0"),!$("#deactivatedWindow").length){$("#sandboxCssLink").length||Lyte.injectResources(networkUtils.returnDependencyFiles(["sandbox-min.css"],ResourceConstants.CRM));var _={headContent:"crm.sandbox.devuser.blocked.subject",bodyContent:"crm.sandbox.devuser.blocked.content"},E=Handlebars.templates.sandboxDeactivatedPage(_);$("body").append(E)}}))})),$(document).ajaxError((function(e,t,r){var a;if(t.status===crmConstants.errorStatusCode&&r&&r.headers&&!r.headers["X-ZOHO-SERVICE"]&&(!r.url||-1===r.url.indexOf("Analytics"))&&!r.url.includes("shift_hours")&&!Crm.ignoreAjaxError)return Crm.isHeadless&&"undefined"!=typeof WindowsCommunicator&&(a=function(){WindowsCommunicator.notifyParent("cancel-operation")}),renderingUtils.displayPermissionDenied(t,void 0,void 0,void 0,a,(function(){let e=Lyte.Router.getRouteInstance();var t="undefined"!=typeof ProcessBuilder&&ProcessBuilder&&ProcessBuilder.Process&&ProcessBuilder.Process.ProcessStatus&&"Draft"===ProcessBuilder.Process.ProcessStatus;!featuresAvailable||!featuresAvailable.NEXTGENUI_ENABLED||"crm.settings.section.workflow-rules.view-workflow-rule"===e.transition.info.route||"crm.settings.section.workflow-rules.create-workflow-rule"===e.transition.info.route||"crm.settings.section.blueprint.view-blueprint"===e.transition.info.route||"crm.settings.section.blueprint.index-blueprint"===e.transition.info.route&&t||e.transitionTo(Lyte.registeredMixins["crm-setup-mixin"].getLastAccessedRouter())})),$("input[name=save]").prop("disabled",!1),$("input[name=saveAndNew]").prop("disabled",!1),void $("input[name=cancel]").prop("disabled",!1);delete Crm.ignoreAjaxError})),this.userDetails=e,"705161756"==Crm.userDetails.ZUID||"675350355"==Crm.userDetails.ZUID||"689349620"==Crm.userDetails.ZUID){var c=Lyte.Router.registerRoute;Lyte.Router.registerRoute=function(e){if(Lyte.Router.__lp.getDefinition(e)){var t=new Error(e+" route overwritten");murphy.error(t)}else c.apply(Lyte.Router,arguments)}}app.crossOriginEnabled=document.domain.indexOf("localzoho.com")>-1||"undefined"!=typeof FingerPrint&&FingerPrint.isCdnEnabled||void 0!==Crm&&Crm.userDetails&&Crm.userDetails.JS_CORS_ENABLED,Crm.userDetails.jsLocation="China"===Crm.userDetails.DEPLOYMENT?"china/":"";var m="object"!=typeof e.MODULE_LIST?JSON.parse(e.MODULE_LIST):e.MODULE_LIST;if(this.moduleInfo=m,this.userDetails.MODULE_LIST=moduleRecordMapping,"Mozilla"!==$L.userAgent.browser&&"Firefox"!==$L.userAgent.browser||(document.addEventListener("keydown",(function(e){window.event=e}),!0),document.addEventListener("click",(function(e){window.event=e}),!0)),crmConstants.init(),org.owasp.esapi.ESAPI.initialize(),this.loadDefaultConstants(),this.calPreferences=t,!Crm.isHeadless){this.menu.init(),Search.rowcnt||Search.init();var u=networkUtils.returnDependencyFiles(["zohocrm_SAReminder.js"],ResourceConstants.CRM);Lyte.injectResources(u,void 0,(function(){Activities.init()}));try{Territory.init(),crmListView.initStageTemplates()}catch(e){}try{crmEmailStats.init()}catch(e){}}if(crmCalendar.init(),crmCalendar.calDefColor=r,Events.init(),Crm.isHeadless&&"msteams"!==networkUtils.parseUrl(location.href).params.from||CrmDashboard.init(),Crm.isWorkdriveNotConfigured){var p=networkUtils.returnDependencyFiles(["zworkdrive-conf-model.js","crm-related-list-wd-attachments.js"],ResourceConstants.CRMClient);Lyte.injectResources(p,void 0,(function(){gS.loadWDOnboard()}))}for(var v in moduleRecordMapping){!!moduleRecordMapping[v].web_link||this.getModuleObj(v)}1==Crm.userDetails.ISPAID_USER&&(crmConstants.maxSelectCount=500),(Crm.userDetails.JS_CORS_ENABLED||document.domain.indexOf("localzoho.com")>-1)&&commonUtils.enableErrorLogging(),$(document).keyup((function(e){if(27==e.keyCode){var t=$("#fieldPropertiesPopup").is(":visible"),r=$(".dynFormPopup").is(":visible"),a=$("#fieldtyperesult").is(":visible"),i=$("crm-dynamic-layout-unused-popup").is(":visible");$("#listviewHeaderRow #addColumn").removeClass("addColumnActive"),$("#toolsId, #columnList").slideUp(100),$("#importDiv, #importRevampDiv, #columnList").slideUp(100),"block"==$("#alphaRefTable #alphaTable").css("display")&&1==$("#alphaSearch").hasClass("alphaSearchActive")&&($("#alphaSearch").removeClass("alphaSearchActive"),$("#alphaTable").slideUp(100));var n=$("#subSecondaryPopup"),o=$("#formRuleMandatoryFields");if(o.is(":visible")){let e=o.find("#cancel");e.hasClass("vr_cancelTrigger")?e.removeClass("vr_cancelTrigger"):e.trigger("click")}else if(n.is(":visible")){var s=n.find("#cancel");s.hasClass("vr_cancelTrigger")?s.removeClass("vr_cancelTrigger"):s.trigger("click")}else{if(t&&r)return;if(a&&i)return;var l=$(document.activeElement).closest(".zcrm-modal:visible:not(.newProductStyleEle)").attr("id");l&&("topBandPopup"==l?hideAnimatePopup(l,!0):hideAnimatePopup(l),$("#searchCreatePopup").is(":visible")&&"lookupPopup"==l&&($("#freezeBackGround").removeClass("zindex250").css("z-index","30"),renderingUtils.showFreezeLayer()))}}}));var g=$(window);Crm.userDetails.viewPort={height:g.height(),width:g.width()},Crm.userDetails.screen={height:window.screen.height,width:window.screen.width},Crm.userDetails.lastRefresh=(new Date).toString(),"true"==RebrandLinkUtil.getProperty("enablePerfLogger")&&(PerfLogger.prototype.constructLandingUrlData=function(){var e={};return e.automation_id=cookieUtils.getCookie("ZCRM_QA_AUTOMATION_ID"),e.automation_case_id=cookieUtils.getCookie("ZCRM_QA_AUTOMATION_CASE_ID"),e.type=this.types.LANDING_PAGE,e.landing_url=window.location.href,e},navigator.sendBeacon(PERF_LOGGER.url,JSON.stringify(PERF_LOGGER.constructLandingUrlData())));var f=RebrandLinkUtil.getProperty("responseTrackingUrl");Crm.userDetails.isResponseTrackingEnabled&&f&&window.addEventListener("unload",(function(){navigator.sendBeacon(f,JSON.stringify(responsetimeTracker)),responsetimeTracker=[]})),(Crm.env.isDevelopment||0==crmConstants.compression)&&renderingUtils.RemoveFromCache(),setTimeout((function(){var e,t=networkUtils.returnDependencyFiles(["crm-browser-version.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("browserupgradeversion")],ResourceConstants.CRM),a=networkUtils.returnDependencyFiles(["crm-browser-version.css"],ResourceConstants.CRMClient),i=t.concat(a).concat(r);Crm.userDetails.RTL_ENABLED&&(e=networkUtils.returnDependencyFiles(["crm-browser-version-rtl.css"],ResourceConstants.CRMClient),i=i.concat(e));var n,o=!0,s=$L.userAgent,l=!1;if((document.domain.includes(".com.cn")||"zh_CN"===Crm.userDetails.RELEVANT_LOCALE||document.domain.includes("crmcn.localzoho.com"))&&(l=!0),"ja_JP"===Crm.userDetails.RELEVANT_LOCALE&&$L("html").addClass("unservedFont"),"Chrome"===s.browser||"CriOS"===s.browser)s.version<73&&(l&&s.version>=55?(o=!0,!0):o=!1),n=!0;else if("Firefox"===s.browser||"FxiOS"===s.browser)s.version<68&&(l&&s.version>=54?(o=!0,!0):o=!1),n=!0;else if("Safari"===s.browser)s.version<13&&(l&&s.version>=11?(o=!0,!0):o=!1),n=!0;else if("Edge"===s.browser||"EdgiOS"===s.browser)s.version<79&&(o=!1),n=!0;else if("OPR"===s.browser)s.version<60&&(l&&s.version>=42?(o=!0,!0):o=!1),n=!0;else if("IE"===s.browser)o=!1,n=!0;else{o=function(){try{return Function("() => {};"),!0}catch(e){return!1}}(),n=!1}o||Lyte.injectResources(i,void 0,(function(e,t){0===t.length&&(n?Lyte.Component.render("crm-browser-version-check",{},"#oldBrowserAlertWrapper"):n||($L.moment().fromNow($L.moment("31/12/2020","DD/MM/YYYY")).past?Lyte.Component.render("crm-unsupported-browser-blocking",{},"#oldBrowserAlertWrapper"):Lyte.Component.render("crm-browser-version-check",{},"#oldBrowserAlertWrapper")))}))}),0)},client_tracking_endpoint:"__internal/client_tracking",client_tracking:function(e,t){var r={};for(var a in r.feature_name=e,t)r[a]=t[a];var i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};window.clientPortalName&&(i["X-CRMPORTAL"]=window.clientPortalName),$.ajax({type:"POST",url:"/crm/v2/"+Crm.client_tracking_endpoint,data:r,headers:i})},registerPartials:function(){Crm.isHeadless||(Handlebars.registerPartial("notificationGroups",Handlebars.templates.notificationGroups),Handlebars.registerPartial("notificationGroup",Handlebars.templates.notificationGroup),Handlebars.registerPartial("cvNotificationShowMore",Handlebars.templates.cvNotificationShowMore),Handlebars.registerPartial("centralNotificationMenu",Handlebars.templates.centralNotificationMenu),Handlebars.registerPartial("signalBusinessCard",Handlebars.templates.signalBusinessCard),Handlebars.registerPartial("signalBusinessCardContent",Handlebars.templates.signalBusinessCardContent),Handlebars.registerPartial("signalDetailViewTemplate",Handlebars.templates.signalDetailViewTemplate),Handlebars.registerPartial("uiTypeTemplate",Handlebars.templates.uiTypeTemplate),Handlebars.registerPartial("uiTypeTemplatePrint",Handlebars.templates.uiTypeTemplatePrint),Handlebars.registerPartial("uiTypeLabelTemplate",Handlebars.templates.uiTypeLabelTemplate),Handlebars.registerPartial("uiTypeInputTemplate",Handlebars.templates.uiTypeInputTemplate),Handlebars.registerPartial("CriteriaEditor",Handlebars.templates.CriteriaEditor),Handlebars.registerPartial("CustomViewList",Handlebars.templates.CustomViewList),Handlebars.registerPartial("InnerCV",Handlebars.templates.InnerCV),Handlebars.registerPartial("TaskKanbanView",Handlebars.templates.TaskKanbanView),Handlebars.registerPartial("body",Handlebars.templates.body),Handlebars.registerPartial("customViewFilters",Handlebars.templates.customViewFilters),Handlebars.registerPartial("canvasViewsList",Handlebars.templates.canvasViewsList),Handlebars.registerPartial("customViewFiltersPart",Handlebars.templates.customViewFiltersPart),Handlebars.registerPartial("leadPrediction",Handlebars.templates.leadPrediction),Handlebars.registerPartial("cvError",Handlebars.templates.cvError),Handlebars.registerPartial("heading",Handlebars.templates.heading),Handlebars.registerPartial("macroBtn",Handlebars.templates.macroBtn),Handlebars.registerPartial("customizedviewmenu",Handlebars.templates.customizedviewmenu),Handlebars.registerPartial("navigateByRecords",Handlebars.templates.navigateByRecords),Handlebars.registerPartial("noRecordsFound",Handlebars.templates.noRecordsFound),Handlebars.registerPartial("VisitEmbedCode",Handlebars.templates.VisitEmbedCode),Handlebars.registerPartial("fixedColumnlistview",Handlebars.templates.fixedColumnlistview))},lyteHeaderNeeded:function(e){return!0===Crm.userDetails.DETAIL_VIEW_HEADER_LYTE&&(!(Crm.lyteHeaderNotSupportedModules.indexOf(e)>-1)&&(!("Calls"===e&&!isNewCallView)&&!("Events"===e&&!Crm.renderDVLyteFlow(e))))},renderDVLyteFlow:function(e,t){if(!0===Crm.userDetails.isSubformNewComponentEnabled&&!0===Crm.userDetails.DETAIL_VIEW_LYTE&&!0===Crm.userDetails.timelineRevamp){var r=Lyte.Router.getRouteInstance();return!(!t&&r&&r.transition&&"crm.tab.module.entity.canvas"===r.transition.target)&&(!(Crm.lyteDVNotSupportedModules.indexOf(e)>-1)&&!("Calls"===e&&!isNewCallView))}return!1},authtoken_banner_success:function(){var e=new crmRequestPool,t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};$(".attentionParent, .attentionWrapper").remove(),$(".freezelayer_zindex").removeClass("freezelayer_zindex"),$(".popupnew_zindex").removeClass("popupnew_zindex"),renderingUtils.removeFreezeLayer(),$("#basic").removeClass("bodyBlur"),Crm.userDetails.SHOW_AUTHTOKEN_DEPRECATION_BANNER=!1,e.initiate({action:"/crm/v2/__internal/authtoken_deprecation_banner",type:"POST",headers:t})},editEntity:function(e,t,r,a){var i=(r=r||JSON.parse($(t).attr("data-params"))).module;if(!crmConstants.lyteCreateInitialModules.contains("Appointments")||"Appointments"!==i||"appointmentCompletePopup"===Crm.isAppAction){if("Appointments"===i&&!a){s=(s=(s=(s=[]).concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-vision-create.js","crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient));var n=[];return Crm.userDetails.RTL_ENABLED&&(n=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient)),n=n.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-upload-create.css","crm-image-preview.css"],ResourceConstants.CRMClient)),s=(s=s.concat(n)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)),void Lyte.injectResources(s,void 0,(function(){Crm.editEntity(e,t,r,!0)}))}if("Calls"===i&&!a){var o=networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js"],ResourceConstants.CRMClient));return o=(o=o.concat(networkUtils.returnDependencyFiles(["zcrm_callsnew1.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_detailview")],ResourceConstants.CRM)),Crm.userDetails.isPhoneNoNewView&&Crm.userDetails.CALLS_PREFERENCE&&(o=o.concat(Crm.returnPhoneFieldDependencyFiles())),void Lyte.injectResources(o,void 0,(function(){Crm.editEntity(e,t,r,!0)}))}var s,l=networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js"],ResourceConstants.CRMClient);l=(l=l.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),s=(s=networkUtils.returnDependencyFiles(["zohocrm_changeOwner.js"],ResourceConstants.CRM)).concat(l),"Events"===i&&(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailEditor")],ResourceConstants.CRM))),Lyte.injectResources(s),Lyte.injectResources(networkUtils.returnDependencyFiles(["businessHoursmixin.js"],ResourceConstants.CRMClient),void 0,(function(){null!==Lyte.registeredMixins["business-hours-utils"]&&Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadRecourceFile(),void 0)})),Crm.requestParam={},0!=$(".relListMenuDiv").length&&$(".relListMenuDiv").is(":visible")&&$(".relListMenuDiv").css({visibility:"hidden"}),commonUtils.showHideLoadingDiv(!0),$("body").css("overflow","");var d=r.id,c=(r.callee,r.clickId,r.layoutId),m=r.layoutName;if(Crm.editReqFrom=r.reqFrom?r.reqFrom:r.returnAnchor||r.goTo?"":"listView",Crm.scrollToElem=r.goTo?r.goTo:r.returnAnchor,"Events"===i&&"skyDesk"===Crm.brandName){var u=$(window).height();$("#eventCreatePopup").attr("style","width:95%;height:"+90*u/100+"px;display:none;"),$("#eventCreateContainerDiv").attr("style","width:100%;height:"+90*u/100*90/100+"px;"),$("#eventCreationDiv").attr("style","width:95%;height:"+90*u/100*90/100+"px;"),$("#eventCreationInnerDiv").attr("style","width:100%;height:"+90*u/100*80/100+"px;Overflow:hidden;")}if(r.fromKv||crmTab.isZBCustomModule(i)||crmTab.isZSCustomModule(i)||"Forecasts"==i){var p=Crm.isPageLoad,v=(h=networkUtils.constructUrl(Crm.getCrmBasePath()+"/Edit.do",r),"true"===$("#iskanbanview").val()),g=networkUtils.parseUrl(h).params;cachedmodule=g.module;var f="show";if(v?(PAGE_CACHE[cachedmodule]&&PAGE_CACHE[cachedmodule].New&&delete PAGE_CACHE[cachedmodule].New,taskKanbanViewCache=objectUtils.cloneObject(document.getElementById("kventitydetailspage")),document.getElementById("mapValues")&&document.getElementById("mapValues").parentNode.removeChild(document.getElementById("mapValues")),ActivityMoreInfoContent=$("#entitypopup").html(),f="cvEditSave"):$("#taskDetailsPart").length&&(f="taskDetailsPart",taskKanbanViewCache={},ActivityMoreInfoContent=$("#taskDetailsPart").html()),"kvlistview"===r.from&&0===TaskKanbanView.kvrecordid){taskKanbanViewCache="false";var C=$(t).closest(".kvtlistbgheader").attr("id");$("#kvType").val(C),taskDetailsview.listAnimation("open")}ajaxNew(h,void 0,(function(e){"show"===f&&(p||(Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[i,d]}).data=r),crmTab.updateTabContent(r.module)),$("#cvEditSave").show()}),f)}else{var h=Crm.getCrmBasePath()+"/Edit.do";this.fieldsObj[i]=[],Crm.resetSubformFields(i),this.currencyFields[i]=[];var y=this.getModuleObj(i);y.setStatus("edit");var E={id:d,module:i,format:"json",layoutId:c,layoutName:m};"gsearch"===r.pfrom&&(crmNavig.removeFeaturCacheObj("gsearch"),E.pfrom="gsearch"),E.tstamp=(new Date).getTime(),r.EditSeries&&(E.EditSeries="true",E.recAct=r.recAct,E.cvid=$("#cvid").val());var _=new crmRequestPool;_.followOrder=!0,_.initiate({action:h,type:"GET",data:E,dataType:"json",success:function(t){if(t.responseText)return $("#show").html(t.responseText),void commonUtils.showHideLoadingDiv();if(t.meetingConfZuid)Events.meetingConfZuid=t.meetingConfZuid,Events.meetingSiteUrl=t.meetingSiteUrl;else{if("Calls"===i&&t.STATUS&&"FAILURE"===t.STATUS&&t.INFO&&t.INFO.MSG)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("Info"),ltPropSecondaryMessage:I18n.getMsg("crm.activities.call.error.nonowner.edit",[I18n.getMsg("crm.activities.call.label.fromto"),I18n.getMsg("crm.relatedTo")]),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right"}}),void commonUtils.showHideLoadingDiv();if(t.STATUS&&"FAILURE"===t.STATUS&&t.INFO&&t.INFO.MSG)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:t.INFO.DESC,ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg").style="color:#E20000"}}),void commonUtils.showHideLoadingDiv()}(commonUtils.showHideLoadingDiv(),"Appointments"===i&&(Events.createSource=r.from,Events.currentStatus="edit"),y.edit(d,t,r),"Events"!==i||Crm.userDetails.MEETING_BRIDGE_ENABLED)||($("#meetingInclude").prop("checked")&&Events.onlineMeetingVenue(),Events.isRecurringEditAvail&&$("#CrmEventMeetingInteg").hide());"Events"===i||"Appointments"===i||"Calls"==i&&isNewCallView||"true"===$("#iskanbanview").val()||(!Crm.isPageLoad&&r.clickId&&("Activities"!=Crm.activityGrp[i]||Crm.isActivitySplitDone?Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[i,d]}).data=r:Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:["Activities",d],queryParams:{sub_module:i}}).data=r),r.validationRequest&&"true"==r.validationRequest&&($("#saveAndNew"+r.module+"Btn").hide(),$("#save"+r.module+"Btn").val(I18n.getMsg("crm.validation.rule.approve.and.save.entity")).data("fromValidation",!0),$("#saveAndNew"+r.module+"Btn_Bottom").hide(),$("#save"+r.module+"Btn_Bottom").val(I18n.getMsg("crm.validation.rule.approve.and.save.entity")).data("fromValidation",!0)),crmTab.updateTabContent(r.module)),!isGlobalSearch(e)||"Events"==i||"Appointments"==i||"Calls"===i&&isNewCallView||adSearchClose()},error:function(e){if(-1===e.responseText.indexOf("INSUFFICIENT_PRIVILEGES")){var t='<div onclick=/"sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()])+'</div></div><br class="cBoth"><div  class="alignRight mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(t),commonUtils.showHideLoadingDiv()}}}),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(E.module))&&(E.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},_.addUp({type:"GET",action:h,data:E,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,r.module,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(E.module))&&Crm.downloadValidationRules(h+"?format=json&module="+i+"&id="+E.id+(E.layoutId?"&layoutId="+E.layoutId:""),i)}return!1}var I=Lyte.registeredMixins["crm-appointments-mixin"];I&&I.checkAppointmentRecordPermission(i,"Edit")&&!I.isAppointmentPopup&&(I.isAppointmentPopup=!0,I.showAppointmentSectionPopup(r.id,"Appointment Information",r.from,r.serviceId,"edit",{}))},getModuleObj:function(e){return this.fieldsObj[e]=[],Crm.resetSubformFields(e),this.currencyFields[e]=[],window[e]||(window[e]=Object.create(crmCommonModule),window[e].moduleName=e),window[e]},cloneEntity:function(e,t,r){if(Crm.requestParam={},commonUtils.showHideLoadingDiv(!0),Lyte.injectResources(networkUtils.returnDependencyFiles(["businessHoursmixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadRecourceFile(),void 0)})),t)r=r||JSON.parse($(t).attr("data-params"));var a=r.invitees;if(crmConstants.lyteCreateInitialModules.contains("Appointments")&&"Appointments"===r.module)Lyte.resolvePromises({filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-services-appointments.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)))}).then((function(){Lyte.registeredMixins["crm-appointments-mixin"].showAppointmentSectionPopup(r.id,"Appointment Information","detailView",void 0,"clone",{})}));else{"calendar"===r.from&&($("#saveEventsBtn").attr("onclick","Events.validateEntity(event,undefined,undefined,'calendar')"),Events.createSource=r.from);var i=r.module,n=r.id,o=(r.callee,Crm.getCrmBasePath()+"/Clone.do"),s=this.getModuleObj(i);window[i].setStatus("clone"),this.fieldsObj[i]=[],Crm.resetSubformFields(i),this.currencyFields[i]=[];r={id:n,module:i,format:"json"};var l=new crmRequestPool;l.followOrder=!0,l.initiate({action:o,type:"GET",data:r,dataType:"json",success:function(e){commonUtils.showHideLoadingDiv(),"Appointments"!==s.moduleName&&Events.formatInvDetailsToFinalIdsJson(e),e.responseText&&e.responseText.includes("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEED")?$("#show").html(e.responseText):s.clone(n,e,a)},error:function(e){commonUtils.showHideLoadingDiv()}}),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(r.module))&&(r.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},l.addUp({type:"GET",action:o,data:r,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,r.module,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(r.module))&&Crm.downloadValidationRules(o+"?format=json&module="+i+"&id="+r.id+(r.layoutId?"&layoutId="+r.layoutId:""),i)}},layoutRuleJSONData:{},downloadLayoutRules:function(e,t,r,a){t.getLayoutRuleJSON=!0,(new crmRequestPool).initiate({type:"GET",action:e,data:t,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,t.module,r),a&&a.call(window))},error:function(){commonUtils.showHideLoadingDiv()}})},evalAfterLRDownload:function(e,t,r){(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(t))&&Crm.downloadLayoutRules(e,{module:t,id:r,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)}))},validationRuleJSONData:{},downloadValidationRules:function(e,t,r){if(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(t)){var a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM);Lyte.injectResources(a,void 0,(function(){})),Crm.validationRuleJSONData||(Crm.validationRuleJSONData={}),e+="&getValidationRuleJSON=true",networkUtils.lyteInitiateRequest(e,"GET").then((function(e){e&&(Crm.validationRuleJSONData[t]=JSON.parse(e),r&&r())}),(function(){commonUtils.showHideLoadingDiv(),r&&r()}))}else r&&r()},downloadLRRules:function(e,t,r,a){if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e)){var i={},n={};n.module=e,n.format="json",t&&(n.layoutId=t),n.getLayoutRuleJSON=!0,i.params=n,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Create.do","GET",i).then((function(t){t&&(CFRExec.init(t,e,CFRExec.OPERATIONCONSTANT.QUICK_CREATE,a),CFRExec.addListenerForQCMode(e,a.qcObject.containerDiv),CFRExec.evalRulesForQCMode(e,r.fields,!0))}),(function(){commonUtils.showHideLoadingDiv()}))}},executeLayoutRule:function(e,t,r){if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(t.module)){t.getLayoutRuleJSON=!0;var a=t.module;if(Crm.layoutRuleJSONData={},"view"===r){delete t.module,e+="&getLayoutRuleJSON=true";var i=Lyte.resolvePromises([store.findAll("dummy",void 0,!1,!1,{url:e,method:"GET"},null)]);CFRExec.ruleDownloadPromise=i,i.then((function(e){e&&e[0]&&(CFRExec.init(e[0],a,r),CFRExec.promptIfMandatory=!1,CFRExec.evalRules(r,!0),CFRExec.ruleExecutedinDetailViewPage=!0,CFRExec.ruleDownloadPromise=void 0)}),(function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}))}else{(new crmRequestPool).initiate({type:"GET",action:e,data:t,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,a,r),CFRExec.promptIfMandatory=!1,CFRExec.evalRules(r,!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})}}},evalAfterLRDownload:function(e,t,r){(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(t))&&Crm.downloadLayoutRules(e,{module:t,id:r,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)}))},showSubformErrorMsg:function(e,t,r){var a=$L("#errorMsg_"+t);a.length>0&&a[0].remove();var i=document.createElement("span");$(i).html(e).css({clear:"both","padding-bottom":"10px",color:"#F63648","font-size":"11px",display:"block"}).attr({class:"errMsg errorMsgDesc",id:"errorMsg_"+t}),$(i).css("position","relative"),r.closest(".secContent").parent().find("td.contHeadInfo").append(i)},showExistingEmailQuickInfo:function(e,t,r,a,i,n,o,s){var l=$(n),d=($(n).closest("div").prev().text(),r?"https://"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+r+"&fs=thumb":networkUtils.getImageUrl("sprite_avatar.svg",ResourceConstants.CRM)),c=$(n).closest("div").find("input")[0]?$(n).closest("div").find("input")[0].id:$(n).closest("div")[0].id;o&&!c&&(c=$L(n).closest("crm-create-fields")[0]?$L(n).closest("crm-create-fields")[0].getAttribute("fld-id"):$L(n).closest("crm-create-subformsection")[0]?$(n).closest("span")[0].getAttribute("id"):s.api_name),""===c&&(c=l.attr("id")),$L("crm-existing-email-quickinfo").length?$L("crm-existing-email-quickinfo")[0].setData({id:"viewExistingRecordQuickInfo"+i,lead_name:e,lead_owner:t,image_url:d,owner_label:I18n.getMsg("Lead Owner",a),lead_label:I18n.getMsg("Lead Name",a)}):Lyte.Component.render("crm-existing-email-quickinfo",{id:"viewExistingRecordQuickInfo"+i,lead_name:e,lead_owner:t,image_url:d,owner_label:I18n.getMsg("Lead Owner",a),lead_label:I18n.getMsg("Lead Name",a)},"#"+c),$L("#crmExistingEmailQuickInfoPopover")[0].ltProp({show:!0})},dontHideQuickInfoPop:function(e){$L("#crmExistingEmailQuickInfoPopover")[0].ltProp("bindToBody",!1),$L("crm-existing-email-quickinfo").hide()},isCpqActivated:function(){return Crm.userDetails.isCPQActivated},isCpqGsActivated:function(){return Crm.userDetails.isCPQGsActivated},isCpqRelatedTab:function(e){return!(!Crm.isCpqActivated()||!(crmTab.isZCpqTab(e)||crmTab.isZCpqSubTab(e)||moduleRecordMapping.ZohoCPQ&&moduleRecordMapping.ZohoCPQ.module_name===e))},isModuleAvailable:function(e){return moduleRecordMapping&&moduleRecordMapping[e]},getErrorKey:function(){for(var e,t,r=this.errorMsgArray[arguments[0]],a=this.errorMsgArray.default,i=1;i<arguments.length;i++)t=e=arguments[i],r&&(r=r[e]),a&&1!=i&&(a=a[t]);var n=r&&"object"!=typeof r?r:a;return n},validateEntityAndShowErrorMsg:function(e,t,r,a,i,n,o,s,l){var d,c;Crm.requestParamWithColname={},Crm.requestSubformBitMap={};var m=$("#VRAjaxEdit").is(":visible"),u=$("#createEditCallDiv"),p=$("#multipleFieldsEditPop"),v=$("#formRuleMandatoryFields"),g=v.is(":visible");$("#addLinesBtnLwr").offset();$(".mandatory").removeClass("mandatory");var f,C=!0,h=!0,y=!0,E=crmTab.tabVsSubTabs[t],_={},I=void 0!==E?E.length:0;if(E&&I>0)for(var T=0;T<I;T++){Crm.requestSubformBitMap[E[T]]="";var D=$("#subform_"+E[T]);if(D.closest(".subformParentSection").is(":visible")||n&&n.isFrmBP){var R=$L("#errorMsg_"+D.data().dataSubformid);R.length>0&&R[0].remove();for(var b=!1,A=0,w=[],M=Crm.fieldsObj[t+"_"+E[T]],L=D.find("tbody tr"),S=L.length,U=L.closest("table").data("data-columnname"),O=!0,N=0;N<S;N++){var k=$(L[N]).data("data-linkingmodule_id"),P={};k&&(P.LINKINGMODULE_ID=k);for(var F="_"+$(L[N]).data("data-rowid"),x=!1,j=!1,V=0,B=0,H=[],Y=!1,G=0;G<M.length;G++){if((Ie=$("#"+M[G]+F)).length){var z=Ie.data();if("Campaigns"!==t&&n&&n.length&&0!==n.length&&!n.contains(z.colname))continue;if(116===z.uitype||117===z.uitype)continue;if(n&&n.isFrmBP&&!0===z.mandate&&V++,Ie.length&&(-1==M[G].indexOf("_SERIAL_NUMBER")||-1!=M[G].indexOf("_SERIAL_NUMBER")&&n&&n.isFrmBP)){var q=(z=Ie.data()).name,J=z.displaylabel;if(!0===(we=this.validateEntity(Ie,t,r,n)).mandateFailed&&n&&n.isFrmBP){B++,delete Crm.requestParamWithColname[z.colname];continue}if(we.paramvalues){for(var W in we.paramvalues){$("#errorMsg_"+Ie.attr("id")).remove();var K=W.replace("property(","").replace(")",""),Q=we.paramvalues[W],X={};if(void 0!==we.paramvalues.fileUploadObject&&(X=JSON.parse(we.paramvalues.fileUploadObject)),(""!==Q&&void 0===X.removedAttachmentIds||void 0!==X.uploadedFileObject)&&(x=!0,j=!0),n&&n.isFrmBP&&(133===z.uitype||221===z.uitype))z.id?P[z.colname]=z.id+"":P[z.colname]="";else{if(333===z.uitype){P[z.colname]=Crm.requestParamWithColname[z.colname];break}n&&n.isFrmBP&&z&&z.uitype&&301===z.uitype&&we&&"on"===we.paramvalues[W]?P[K]="true":P[K]=we.paramvalues[W]}}n&&n.isFrmBP&&delete Crm.requestParamWithColname[z.colname]}if(Crm.userDetails.isMandatorySubFormEnabled&&we.mandateFailed){var Z={};Z.elem=Ie,Z.label=q,Z.displayLabel=J,Z.data=z,Z.resultObj=we,c||Y||(Z.isNeedToFocusFirst=!0,Y=!0),H.push(Z)}else!(h=we.result?h:we.result)&&!c&&Ie&&Ie[0]&&(c=Ie),this.showErrorMessage(we,Ie,t,q,J,z,!0)}}}var ee=H.length;if(x){if(w.push(P),Crm.userDetails.isMandatorySubFormEnabled&&(b=!0,A++,j))for(var te=0;te<ee;te++){var re=H[te];re.isNeedToFocusFirst&&(c=re.elem),this.showErrorMessage(re.resultObj,re.elem,re.module,re.label,re.displayLabel,re.data,!0),C=!1}}else if(Crm.userDetails.isMandatorySubFormEnabled&&(0!==A||N<S-1)){L.eq(N).remove(),D.closest(".subFrmLayout").find(".subFrmTablSerlNoOverlay tbody").html(""),crmTemplate.updateSubFormSerialNumber(t,D.data("dataSubformid"))}if(Crm.requestSubformBitMap[E[T]]=x?Crm.requestSubformBitMap[E[T]]+"1":Crm.requestSubformBitMap[E[T]]+"0",_[E[T]]=b,n&&n.isFrmBP){O=O&&!(0!==V&&0===B||0===V&&x);var ae=D.closest(".subformParentSection").find(".errorFieldP");ae.length>0&&$("#errorMsg_"+ae.attr("id")).remove()}}if(Crm.userDetails.isMandatorySubFormEnabled&&0===S&&(U=D.data().dataColumnname,_[E[T]]=!1),Crm.requestParam["property("+U+")"]=JSON.stringify(w),n&&n.isFrmBP&&(n[E[T]]={},n[E[T]].resultObj={},n[E[T]].resultObj.mandateFailed=O,n[E[T]].resultObj.maxRowlimitFailed=S>D.data("dataMax_rows"),n[E[T]].resultObj.maxRowlimitFailed&&(C=!1)),Crm.userDetails.isMandatorySubFormEnabled&&!b&&"true"===D[0].getAttribute("subform-mandatory")){var ie=D.data().dataSubformsectionlabel;if(!c)for(var ne=D.find("tbody tr td"),oe=ne.length,se=!0,le=0;le<oe;le++){var de=ne.eq(le).find("input");if(0===de.length&&(de=ne.eq(le).find("select")),0===de.length&&(de=ne.eq(le).find("textarea")),void 0!==de&&0!==de.length&&!de.data("readonly")&&"SERIAL_NUMBER"!==de.data().colname&&116!==de.data().uitype){c=555===de.data().uitype?ne.eq(le).find(".fileUploadLabel"):de.eq(0),se=!1;break}}se?C=!0:(this.showSubformErrorMsg(I18n.getMsg(this.getErrorKey(t,ie,"mandate"),$ESAPI.encoder().encodeForHTML(ie)),E[T],D),C=!1)}}}p.is(":visible")?(u=p,f=!0):g?u=v:1==e.length?u=$("#fullInfoDiv"):m&&(u=$(".bodycontainer"));var ce=u.find("#secDiv_Reason_For_Incoming_Call").find("#Crm_Calls_DESCRIPTION"),me=u.find("#secDiv_Outcome_Of_Outgoing_Call").find("#Crm_Calls_DESCRIPTION"),ue=$(".businesscall.editModeEnable");"Campaigns"===t&&((n=null!=n?n:{}).zohoCampaignValidateProperties={Native__Campaigns__Extn__Campaign_Subject:{maxLength:125,negativeRegex:/^\s*()(Re:|Re:-|R e:|Re :-|Re :|fwd:|fwd:-| f w d :-|fwd :)/i,regexErrorKey:"crm.zcampaign.subject.regex.failure"},Native__Campaigns__Extn__Sender_Name:{maxLength:100,negativeRegex:/^([\w.]+)@([\w.]+)|[`~#^*[\]{}\\";$%<>+=?]/,regexErrorKey:"crm.mb.field.common.splc"},Native__Backstage__Extn__Event_Name:{maxLength:255,negativeRegex:/[<>"]/,regexErrorKey:"crm.mb.field.common.splc"}},detailView.isZohoCampaign()&&(n.zohoCampaignValidateProperties.Campaign_Name={maxLength:125,negativeRegex:/[`~#^*[\]{}\\";&<>%/]/,regexErrorKey:"crm.mb.field.common.splc"}));var pe=$("#bulkTaskNewPopup");if(pe.length>0){var ve=JSON.parse(pe.val());Crm.requestParam["property(bulkIds)"]=ve.idList;for(var ge=ve.idList.split(";"),fe="",Ce=Lyte.Router.getRouteInstance().parent.currentModel.module_name,he={Leads:"Full_Name",Activities:"Subject",Accounts:"Account_Name",Contacts:"Full_Name",Potentials:"Potential_Name",Campaigns:"Campaign_Name",Cases:"Subject",Solution:"Solution_Title",Products:"Products_Name",Vendors:"Vendor_Name",PriceBooks:"Book_Name",Quotes:"Subject",SalesOrders:"Subject",PurchaseOrders:"Subject",Invoices:"Subject"}[Ce],ye=0,Ee=ge.length;ye<Ee;ye++){var _e=store.peekRecord(moduleRecordMapping[Ce].id,ge[ye]);fe+=(_e[he]?_e[he]:_e.Full_Name)+"&&##"}Crm.requestParam["property(bulkNames)"]=fe}for(ye=0,Ee=e.length;ye<Ee;ye++){var Ie=$("#"+e[ye]);validationUtils.isEmpty(e[ye])||(Ie=$("#"+e[ye]+":not(.quickinput)"));var Te=$("#VRAjaxEdit");if(m){var De=Te.find("#"+e[ye]);De&&De.length>0&&(Ie=De)}if("Calls"==t&&isNewCallView)if("Crm_Calls_DESCRIPTION"!==e[ye]||f)if(1===e.length&&!f&&ue.is(":visible")){var Re=(Ie=ue.find("#"+e[ye])).is(":visible");Ie=Re?Ie:u.find("#"+e[ye])}else Ie=u.find("#"+e[ye]);else Ie=ce.is(":visible")?ce:me;var be=Ie.is(":visible");if(Ie.length){z=Ie.data();var Ae="Tasks"===t&&n&&n.length&&0!==n.length&&n.contains("REMINDAT")&&("remTime"===z.colname||z.colname.includes("RemindAt"));if("Campaigns"!==t&&8!==z.uitype&&n&&n.length&&0!==n.length&&!n.contains(z.colname)&&!Ae)continue;if("Events"===t&&2===crmTemplate.isApproved&&"edit"===z.currentstatus&&z.readonly&&333===z.uitype&&void 0!==Crm.requestParamWithColname.ALLDAYEVENT&&(z.readonly=!1),(62===z.uitype||"Events"===t&&("ALLDAYEVENT"===z.colname&&301===z.uitype||333===z.uitype||"SUBJECT"===z.colname||"MEETING_VENUE"===z.colname))&&3===crmTemplate.isApproved&&z.readonly&&"edit"===z.currentstatus&&(z.readonly=!1),444!==z.uitype||!Crm.userDetails.isMultiSelectionPopupSupported||Crm.isFromSalesInbox||"Services"===t&&"MXNDUMMYCOLUMN_SERVICE"===z.colname||(Ie=$L("#"+e[ye])),116===z.uitype||117===z.uitype||"RECURRING_WEEKLY_REPEAT"===Ie.colname||"duration_radio1"===z.colname||"duration_radio2"===z.colname)continue;if("555"==z.uitype&&parseInt($("#attachSize_"+z.fieldid).val())>20971520)return commonUtils.showErrorMsg(I18n.getMsg("crm.FileuploadField.size.limitstmt",$ESAPI.encoder().encodeForHTML(z.displaylabel)),Ie,t),!1;if("555"==z.uitype&&parseInt($("#attachCount_"+z.fieldid).val())>z.maxlength)return commonUtils.showErrorMsg(I18n.getMsg("crm.file.upload.maxlength.exceeds",$ESAPI.encoder().encodeForHTML(z.displaylabel)),Ie,t),!1;if(39===z.uitype&&!Crm.userDetails.CURRENCY_DETAILS[z.oldValue].isActive)return commonUtils.showErrorMsg(I18n.getMsg("crm.currency.active.check"),Ie,t),!1;if((!Crm.userDetails.CLIENT_ACCOUNT||!f)&&(void 0===z.restricted||void 0!==z.restricted&&!z.restricted)&&z.readonly&&(39!==z.uitype||"39"!==z.uitype)&&("DISCOUNT"!==z.colname||!Crm.isInventoryModule(t)))continue;if("Calls"===t&&isNewCallView&&("CALLTYPE"!==z.colname&&!be||!0===z.skipWhileSubmit)&&!p.is(":visible"))continue;q=z.name,J=z.displaylabel;$("#errorMsg_"+Ie.attr("id")).remove(),Ie.closest(".tabDiv,.tabDivCreate").removeClass("errorFieldP"),250===z.uitype&&Ie[0].component&&Ie[0].component.setData("cxPropMaxErrorMsg",""),"786"===z.uitype&&$("#"+e[ye]+"_TimeOption").closest(".tabDiv,.tabDivCreate").removeClass("errorFieldP");var we=this.validateEntity(Ie,t,r,n);if("Calls"===t&&isNewCallView&&"CALLDURATION"===z.colname&&""===z.oldValue){var Me=$("#Crm_Calls_CALLTYPE").val(),Le=$("#Crm_Calls_CALLDURATION_Secs").val(),Se=$("#Crm_Calls_CALLDURATION_Mins").val();"Inbound"===Me&&0===parseInt(Le)&&0===parseInt(Se)&&(we.result=!1,we.inboundCondition=!0)}if(z.uitype==CrmField.UITYPES.SERVICE_TIMING)if(0==we&&d&&Lyte.registeredMixins["crm-services-mixin"].focus)delete Lyte.registeredMixins["crm-services-mixin"].focus;else{if(0!=we&&we.paramvalues["property(Available Time)"]!=I18n.getMsg("crm.service.servicetiming.business")){Crm.requestParam["property(Available Time)"]=JSON.stringify(we.paramvalues["property(Available Time)"]);continue}if(0!=we){Crm.requestParam["property(Available Time)"]="";continue}}if(z.uitype==CrmField.UITYPES.MULTI_DATE_SELECT&&0!=we){Crm.requestParam["property(Available_Dates)"]=JSON.stringify(we.paramvalues["property(Available_Dates)"]);continue}if(we.mandateFailed&&i){n&&n.isFrmBP&&z.subFormTabId&&(n[z.subFormTabId].aggFldObj||(n[z.subFormTabId].aggFldObj={}),n[z.subFormTabId].resultObj.mandateFailed=!0,n[z.subFormTabId].aggFldObj[z.colname]=Crm.requestParamWithColname[z.colname],Crm.isInventoryModule(t)&&"TAX"===z.colname&&(n[z.subFormTabId].aggFldObj.$line_tax=Crm.requestParam["property(recordTaxDet)"])),delete Crm.requestParamWithColname[z.colname];continue}for(var W in we.paramvalues)Crm.requestParam[W]=we.paramvalues[W];if(Crm.userDetails.isMandatorySubFormEnabled&&void 0!==z.subFormTabId&&void 0!==_[z.subFormTabId]&&!0===z.defMandate&&!1===_[z.subFormTabId])continue;if(!(y=we.result?y:we.result)&&!d&&Ie&&Ie[0])if(z.uitype==CrmField.UITYPES.SERVICE_TIMING){var Ue=$("#timechange1_0"),Oe=$("#timechange1_1");Lyte.registeredMixins["crm-services-mixin"].focus?(d=Lyte.registeredMixins["crm-services-mixin"].focus,delete Lyte.registeredMixins["crm-services-mixin"].focus):d=Ue[0]?Ue:Oe[0]?Oe:Ie}else d=Ie;if("444"!==z.uitype&&"445"!==z.uitype||!z.clonedfrom||"CALLMXNCLONESCHEDULER"!==z.selectedid||$("#temp_"+Ie.attr("id")).css("margin-top","0px"),this.showErrorMessage(we,Ie,t,q,J,z),n&&n.isFrmBP&&z.subFormTabId){n[z.subFormTabId].aggFldObj||(n[z.subFormTabId].aggFldObj={}),n[z.subFormTabId].aggFldObj[z.colname]=Crm.requestParamWithColname[z.colname],Crm.isInventoryModule(t)&&"TAX"===z.colname&&(n[z.subFormTabId].aggFldObj.$line_tax=Crm.requestParam["property(recordTaxDet)"]),delete Crm.requestParamWithColname[z.colname];continue}}}if(Crm.requestParam.UserDatePattern=Crm.userDetails.DATE_PATTERN,C=!(!h||!y)&&C,d||c){var Ne=$(c).closest(".secContent").data("data-secsequence"),ke=$(d).closest(".secContent").data("data-secsequence");d=Ne&&!ke||ke&&ke>Ne?c:d,r&&("SELECT"===d[0].nodeName?(d.focus(),d.select2("open"),$("html").css({overflow:""}),setTimeout((function(){$("html").css({overflow:"hidden"})}),1)):d.hasClass("imageUploadHead")?$L(window).scrollTo(d.offset().top-$("#createFixedButtonDiv").height()-10,{duration:500}):d.focus())}if("PriceBooks"==t){var Pe=$(".hrow1").length+1;for(ye=1;ye<Pe;ye++){var $e=parseFloat($("#Crm_PriceBooks_txtFromRange"+ye).val()),Fe=parseFloat($("#Crm_PriceBooks_txtToRange"+ye).val());Fe<$e&&(commonUtils.showErrorMsg(I18n.getMsg("crm.alert.selected.rangevalue"),$("#Crm_PriceBooks_txtToRange"+ye),t),C=!1);for(G=1;G<Pe;G++)if(ye!=G){var xe=parseFloat($("#Crm_PriceBooks_txtFromRange"+G).val()),je=parseFloat($("#Crm_PriceBooks_txtToRange"+G).val());($e>=xe&&$e<=je||Fe>=xe&&Fe<=je&&G>ye)&&(commonUtils.showErrorMsg(I18n.getMsg("crm.alert.selected.rangevalue"),$("#Crm_PriceBooks_txtFromRange"+G),t),C=!1)}}}if("Events"===t&&!$("#eventRecurringDiv").is(":visible")&&$("#eventCreatePopup").is(":visible")){var Ve=$("#saveEventsBtn");if($("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")){var Be=$("#provNotEnabledAlert"),He=$("#provNotAuthorisedAlert");if($("#Events_fldRow_ALLDAYEVENT").is(":visible")||$("#Crm_Events_ALLDAYEVENT").prop("checked",!1),0!==Be.length||0!==He.length)return $("#eventCreationInnerDiv").scrollTop(0),(0!==Be.length?Be:He).addClass("meetingVenueHiRed"),Ve.prop("disabled",!1),!1;if($L.moment($("#Crm_Events_STARTDATETIME").data("dateObj")).toDate()<$L.moment().toDate())return"false"!==isSandboxAcc||Crm.userDetails.LITE.IS_LITE_USER||crmui.showMsgBand("info",$ESAPI.encoder().encodeForHTML(I18n.getMsg("crm.event.meeting.time.invalid.error")),3e3),Ve.prop("disabled",!0),!1}else $("#provNotEnabledAlert").remove(),$("#provNotAuthorisedAlert").remove();var Ye=$("#Crm_Events_REPEATTYPE").val();if(Ye&&"none"!=Ye)if("monthly"==$("#Crm_Events_RECURRING_FREQUENCY").val()&&"2"==$("input:radio[name='monthlyhidden']:checked").val()){var Ge=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val(),ze=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val();"5"!=Ge||"0"!=ze&&"-1"!=ze||(Crm.requestParam.monthlyhidden="1",Crm.requestParam.monthly1select=ze)}return C&&!l?(Events.checkDuplicateEvent(void 0,!0,(function(e){var t=trimBoth($("#Crm_Events_SUBJECT").val()),r=$("#Crm_Events_STATUS").data("oldValue"),i=$("#Crm_Events_STATUS").val(),n={title:t,start:$("#Crm_Events_STARTDATETIME").data("dateObj"),oldStatus:r,status:i};if(0===r&&1===$("#Crm_Events_STATUS").val()&&Events.isRecEvent&&!confirm(I18n.getMsg("crm.event.rec.all.confirm.msg",[Events.getModuleName(!0,!1)])))return!1;if("edit"===Events.currentStatus){var o=(new Date).getTime(),s=new Date(Events.modifyingEvent.start),l=$("#Crm_Events_STARTDATETIME").data("dateObj");"edit"===Events.currentStatus&&s.getTime()<o&&l.getTime()>o?(C=!1,Events.showConfirmForModify(!1,Events.modifyingEvent,void 0,void 0,Event.isRecurringEditAvail?Events.editRecurringAlert:void 0)):"edit"===Events.currentStatus&&o<s.getTime()&&o>l.getTime()?(C=!1,Events.showConfirmForModify(!0,Events.modifyingEvent,void 0,void 0,Event.isRecurringEditAvail?Events.editRecurringAlert:void 0)):Events.isRecurringEditAvail&&(C=!1,Events.editRecurringAlert(!1,Events.modifyingEvent,void 0,a,n))}C&&(C=Events.showSendMailAlert(n)),C&&(void 0===a?Events.saveEntity(void 0,!0,!0):Events.saveEntity(a,!0,!0))})),!1):C}if("Tasks"===t){var qe=$("#Crm_Tasks_RECURRING"),Je=$("#Crm_Tasks_REMINDAT");if(Je.is(":checked")&&!Je.is(":disabled")&&!qe.is(":checked")&&$("#Crm_Tasks_STATUS").val()!=crmTasks.compDispVal){if($("#Crm_Tasks_REMINDAT").hasClass("errorFieldAdded"))return!1;var We,Ke,Qe=null,Xe=null,Ze=null,et=$("#Tasks_fldRow_RemindAt_Start_Date1 #Crm_Tasks_RemindAt_Start_Date1").data("dateObj");Ze=new Date(et);Qe=" ";if($("#Crm_Tasks_RemindAt_remTime_Radio").prop("checked")){Qe=Crm.requestParam.remTime;var tt=$("#Crm_Tasks_DUEDATE");Ze=new Date(tt.data("dateObj"))}if(We=Crm.requestParam["property(Remind Athour)"]+"",Ke=Crm.requestParam["property(Remind Atminute)"]+"","HH:mm"!==Crm.userDetails.TIME_FORMAT&&(Xe=Crm.requestParam["property(Remind Atampm)"]),""==Ze||""==We||""==Ke)return!1;var rt={date:Ze,hour:We,minute:Ke,ampm:Xe,eventBefore:Qe};Activities.checkForTaskReminderDate(rt,(function(e){var t="crm.task.rem.validation1";if($("#Crm_Tasks_RemindAt_Start_Date1_Radio").prop("checked")&&""!=Crm.requestParam["property(Due Date)"]){var r=crmCalendar.getDateObjectFromGivenDateString($("#Crm_Tasks_DUEDATE").val());Utils.compareDate(crmCalendar.getDateObjectFromGivenDateString($("#Crm_Tasks_RemindAt_Start_Date1").val()),r)||(e="true",t="crm.task.rem.validation2")}if("true"==e){$("#Tasks_fldRow_REMINDAT").addClass("errorFieldP");var a='<span class="errMsg errorMsgDesc" style="clear: both; color: rgb(221, 0, 0); font-size:1.1rem; display: block;">'+I18n.getMsg(t)+"</span>";$("#Tasks_fldRow_REMINDAT > .labelValCreate").append(a),C=!1}}))}}var at=document.getElementById("createEditCallDiv");if("Calls"===t&&"block"===at.style.display){var it=crmCallsNew.getCallStartCrmDate().primitiveDateObject,nt={start:it,end:it,activityType:"Calls",isAllday:!1};nt.ownerId=$("#"+crmCallsNew.fields.Call_Owner.dataElement).data().id,nt.oldOwnerId=nt.ownerId;var ot=$("#Crm_Calls_OUTBOUNDCALLSTATUS"),st=ot.data(),lt=ot.val();for(Ee=st.picklistmap.length,ye=0;ye<Ee;ye++)if(st.picklistmap[ye].uservalue===lt)var dt=st.picklistmap[ye].systemvalue;if(C&&"Scheduled"===dt&&"edit"!=Calls.currentStatus)return Events.checkDuplicateEvent(nt,r,(function(){void 0===a?Calls.saveEntity(void 0,!0):Calls.saveEntity(a,!0)})),!1}return C},showErrorMessage:function(e,t,r,a,n,o,s){if(556!==parseInt(o.uitype))if(e.mandateFailed)(444!==o.uitype||"Services"===r&&"MXNDUMMYCOLUMN_SERVICE"===o.colname||"Bundles"===r&&"MXNDUMMYCOLUMNBUNDLE"===o.colname)&&445!==o.uitype||$L("#multipleFieldsEditPop").is(":visible")?(commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"mandate"),$ESAPI.encoder().encodeForHTML(n)),t,r,void 0,void 0,void 0,s),"786"===o.uitype&&$("#"+fieldsArray[i]+"_TimeOption").addClass("errorHighlight")):($("#temp_"+t.attr("id")).css("margin-top","1px"),commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"mxncloneproceed"),$ESAPI.encoder().encodeForHTML(n)),t,r));else if(e.maxlengthFailed)commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"maxLen"),[$ESAPI.encoder().encodeForHTML(n),o.maxlength]),t,r);else if(e.maxlimitFailed)commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"maxLimit"),[$ESAPI.encoder().encodeForHTML(n),o.maxlimit]),t,r);else if(e.maxRowlimitFailed)commonUtils.showErrorMsg(I18n.getMsg("crm.subform.record.create.maxrow.limit",[o.dataMax_rows,$ESAPI.encoder().encodeForHTML(n)]),t,r);else if(e.decimalLengthCheckFailed)commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"type","decimal"),[$ESAPI.encoder().encodeForHTML(n),o.decimalLength]),t,r);else if(e.surveyInvalidName)commonUtils.showErrorMsg(I18n.getMsg("crm.zsurvey.invalid.name.msg"),t);else if(e.surveyNameLenExceed)commonUtils.showErrorMsg(I18n.getMsg("crm.zsurvey.name.len.exceed.msg",[n]),t);else if(e.fieldValueInvalid)commonUtils.showErrorMsg(I18n.getMsg(e.invalidFieldMessageKey),t);else if(e.maxLenExceed)commonUtils.showErrorMsg(I18n.getMsg("crm.criteria.editor.no.of.characters.exceed",[n,e.maxAllowedLen]),t);else if(e&&e.bundleMinValueError)commonUtils.showErrorMsg(I18n.getMsg("bundles.minimum.product.relatedlist.check",["2",moduleRecordMapping.Products.plural_label]),t);else if(e&&e.bundleCodeError)commonUtils.showErrorMsg(I18n.getMsg("bundles.field.space.alert",[n]),t);else if(e.checkFailed){if(""===n||!n){var l=t.data("contentType");"date"===l||"Date"===l?n=I18n.getMsg("Date"):"decimal"===l&&(n=I18n.getMsg("Decimal"))}commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[$ESAPI.encoder().encodeForHTML(n)]),t,r)}else if(e.integerFailed)""===n&&(n=I18n.getMsg("Integer")),commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(r,a,"type","integer"),[$ESAPI.encoder().encodeForHTML(n),"integer"]),t,r);else if(e.comparisonFailed){var d={ENDDATE:"mouseArea__STARTDATE",SALES_END_DATE:"mouseArea__SALES_START_DATE",SUPPORT_EXPIRY_DATE:"mouseArea__SUPPORT_START_DATE"},c={Native__Backstage__Extn__Event_End_Date:"Native__Backstage__Extn__Event_Start_Date"},m=(v={ENDDATETIME:"Crm_Events_STARTDATETIME",Recurring_End_Date1:"Crm_Tasks_Recurring_Start_Date1",ENDDATE:"Crm_Campaigns_STARTDATE",SALES_END_DATE:"Crm_Products_SUPPORT_START_DATE",SUPPORT_EXPIRY_DATE:"Crm_Products_SUPPORT_START_DATE",APPOINTMENTENDTIME:"Crm_JobSheets_APPOINTMENTSTARTTIME"})[o.colname]?$("#"+v[o.colname]):$('[data-sysrefname="'+c[o.sysrefname]+'"]'),u=m.data("displaylabel");m.length<1&&(m=$("#"+d[o.colname]))[0]&&(u=m.data("params").displaylabel),u||(u=I18n.getMsg("current Time")),"Events"===r&&"ENDDATETIME"===o.colname?commonUtils.showErrorMsg(I18n.getMsg("crm.field.greater.check",['"'+$ESAPI.encoder().encodeForHTML(n)+'"','"'+u+'"']),t,r):commonUtils.showErrorMsg(I18n.getMsg("crm.field.comparision.check",['"'+$ESAPI.encoder().encodeForHTML(n)+'"','"'+u+'"']),t,r);var p=m.attr("id");0!==$("#errorMsg_"+p).length&&($("#errorMsg_"+p).remove(),m.closest(".tabDiv,.tabDivCreate").removeClass("errorFieldP"))}else if(e.lessThan){d={STARTDATE:"mouseArea__ENDDATE",SALES_START_DATE:"mouseArea__SALES_END_DATE",SUPPORT_START_DATE:"mouseArea__SUPPORT_EXPIRY_DATE"},c={Native__Backstage__Extn__Event_Start_Date:"Native__Backstage__Extn__Event_End_Date"};var v,g=(v={STARTDATETIME:"Crm_Events_ENDDATETIME",Recurring_Start_Date1:"Crm_Tasks_Recurring_End_Date1",STARTDATE:"Crm_Campaigns_ENDDATE",SALES_START_DATE:"Crm_Products_SALES_END_DATE",SUPPORT_START_DATE:"Crm_Products_SUPPORT_EXPIRY_DATE"})[o.colname]?$("#"+v[o.colname]):$('[data-sysrefname="'+c[o.sysrefname]+'"]'),f=g.data("displaylabel");g.length<1&&(g=$("#"+d[o.colname]))[0]&&(f=g.data("params").displaylabel),f||(f=I18n.getMsg("current Time")),"Events"===r&&"STARTDATETIME"==o.colname?commonUtils.showErrorMsg(I18n.getMsg("crm.custom.field.less.than",['"'+$ESAPI.encoder().encodeForHTML(n)+'"','"'+f+'"']),t,r):commonUtils.showErrorMsg(I18n.getMsg("crm.custom.field.less.than.equalto",['"'+$ESAPI.encoder().encodeForHTML(n)+'"','"'+f+'"']),t,r);var C=g.attr("id");0!==$("#errorMsg_"+C).length&&($("#errorMsg_"+C).remove(),g.closest(".tabDiv,.tabDivCreate").removeClass("errorFieldP"))}else e.filterNotMatched?commonUtils.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",moduleRecordMapping[r].singular_label),t,r):e.startDatePast?commonUtils.showErrorMsg(I18n.getMsg("crm.past.date.check",[$ESAPI.encoder().encodeForHTML(n)]),t):e.customTimeLess1?(t=$("#timechange1_0"),commonUtils.showErrorMsg(I18n.getMsg("crm.service.servicetiming.alert"),t,r)):e.customTimeLess2?(t=$("#timechange1_1"),commonUtils.showErrorMsg(I18n.getMsg("crm.service.servicetiming.alert"),t,r)):e.inboundCondition&&commonUtils.showErrorMsg(I18n.getMsg("crm.activities.call.error.create.inbound.duration"),t,r)},confirmInvoiceCreationWithLowStock:function(){for(var e,t=$(".lineItemSubFrmRow").length,r=0;r<t;r++){var a=$(".lineItemSubFrmRow").eq(r).attr("id").split("_")[1],i=parseFloat($(productDetails.sfFldIdSuffix+"QUANTITY_"+a).val()),n=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+a).attr("prdDetails"),o=n?JSON.parse(n).LAYOUTID:void 0;if(!(!(o=o?o.id?o.id:o:void 0)&&0===Crm.userDetails.QuantityInStockAvailableLayoutIds.length||o&&!Crm.userDetails.QuantityInStockAvailableLayoutIds.contains(o)))if(i>(n?JSON.parse(n).Qty_in_Stock:0)){e=!0;break}}return!e||window.confirm(I18n.getMsg("crm.invoice.stock.notavailable"))},checkIfLookUpAndLookUpValue:function(e,t){var r=Lyte.Router.getRouteInstance();if(null!=r)r.parent.getQueryParams().sub_module;else;var a=e.data();(a.lookupModule||a.permissionDeniedLookup)&&(t||(t=a.uitype))},validateEntity:function(e,t,r,a){var i=!0,n={result:!0},o=a&&a.fieldsArr?a.fieldsArr:void 0,s=void 0!==a?a.isFrmBP:void 0;if(e.length){var l,d=e.data(),c=d.name,m=d.contentType,u=d.uitype+"",p=d.displaylabel,v=d.sysrefname,g=$("#multipleFieldsEditPop").is(":visible");if("Lookup"===m){this.checkIfLookUpAndLookUpValue(e,u);var f=window[t].createEditJson;if(Crm.userDetails.isLookupFilterEnabled&&void 0!==f&&f.filterNotSatisfied&&f.fillupFieldColumn===d.colname&&f.entityid===d.id&&(n.filterNotMatched=!0,i=!1),!(e.is(":visible")&&d&&d.id&&d.hasOwnProperty("selectedlookupvalue")&&""!=e.attr("data-selectedlookupvalue"))||""===e.val()&&void 0===e[0].value||e.attr("data-old-value")==e.val()||e.val()==e[0].value&&e.attr("data-old-value")!=e.val()&&e.val()==e.attr("data-selectedlookupvalue")||(d.id=null,$("#"+e[0].id).data("id",null),e.data("id",null)),e.is(":visible")&&!d.id&&e.val()&&e.val().trim()&&d.lookupModule&&(!moduleRecordMapping.Unknown||d.lookupModule!==moduleRecordMapping.Unknown.module_name)){var C=moduleRecordMapping[d.lookupModule].singular_label,h=$ESAPI.encoder().encodeForHTMLAttribute(C),y=I18n.getMsg("crm.label.lookup.norecord",h)+" ";if("Quotes"!==d.lookupModule&&"Invoices"!==d.lookupModule&&"SalesOrders"!==d.lookupModule&&"PurchaseOrders"!==d.lookupModule&&"Services"!==d.lookupModule&&Lyte.Component.registeredHelpers.showAddRecord(d.lookupModule)){var E=$("<a class='cP autoRecordCreateAlert'>");E.attr({id:"lookupFieldAlertDiv","data-zcqa":"createNewRecord",onclick:"crmLookupAutoComplete.openSearchCreatePopUp('"+e[0].id+"','createPageLookup','"+d.lookupModule+"')"}).text(I18n.getMsg("crm.label.create.new")+" "+C),y+=E.get(0).outerHTML}return commonUtils.showErrorMsg(y,e,t),!1}}if("100"==u&&"Crm_Tasks_RECURRING_WEEKLY_DAYS"===e.attr("id")){for(var _=[],I=$("#Crm_Tasks_RECURRING_WEEKLY_DAYS").find(".circleInput:checked"),T=0;T<I.length;T++)_[T]=$(I[T]).val();l=_}else l=u==CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY&&"Crm_Appointments_SEID"===e.attr("id")&&e.find("option").eq(0).attr("data-modulename-disabled")?e.find("option").eq(0).attr("data-modulename-disabled"):"3"!==u&&"110"!==u||"CRUX-TEXT-AREA-COMPONENT"!==e[0].tagName?"250"===u?e[0].component.getValue():commonUtils.getValue(e):e[0].component.getValue();if(24==u&&"CLOSING_DATE"==d.colname&&"Services"===t&&!CFRExec.isLayoutRuleHiddenElem(d.colname)){var D=Crm.requestParam["property(Starts From)"];if(D&&l&&new Date(CrmDateUtils.convertdateToDBformat(l))-new Date(CrmDateUtils.convertdateToDBformat(D))<864e5)return new Date(CrmDateUtils.convertdateToDBformat(l)).getTime()==new Date(CrmDateUtils.convertdateToDBformat(D)).getTime()?(commonUtils.showErrorMsg(I18n.getMsg("crm.service.availfromto.samevaluealert"),e,t),!1):(commonUtils.showErrorMsg(I18n.getMsg("crm.service.availfromto.fromtoalert"),e,t),!1);var R=6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE);(new Date).getTime()}if(u==CrmField.UITYPES.LAYOUT_LOOKUP&&(l=e.data().id),"BASEPRICE"===d.colname&&commonUtils.getValue(e)<0)return commonUtils.showErrorMsg(I18n.getMsg("crm.service.price.field.greater.than.equalto"),e,t),!1;if(u==CrmField.UITYPES.MULTI_DATE_SELECT)if(CFRExec.isLayoutRuleHiddenElem(d.colname))l=null;else{if($("#errorMsg_Crm_Services_AVAILABLE_DATES").remove(),0==(l=Lyte.registeredMixins["crm-services-mixin"].getServiceModuleAvailDates(l,e,t)))return!1;var b=renderingUtils.getPickListDisplayValuebyDomAndSysValue("Crm_Services_SERVICEAVAILABILITY","Specific Date(s)");if(null==l&&Crm.requestParam["property(Availability_Type)"]==b)return commonUtils.showErrorMsg(I18n.getMsg("crm.field.empty.check",[p]),e,t),!1}if($("#errorMsg_serviceDurationDiv").remove(),u==CrmField.UITYPES.SERVICE_DURATION&&l&&("none"==l||""==l.trim()))return commonUtils.showErrorMsg(I18n.getMsg(this.getErrorKey(t,c,"mandate"),$ESAPI.encoder().encodeForHTML(p)),e,t),!1;if(u==CrmField.UITYPES.SERVICE_TIMING&&l==I18n.getMsg("crm.service.servicetiming.custom")){if($("#CustomTiming0").removeClass("errorFieldP form_err_fld"),0==(l=yte.registeredMixins["crm-services-appointments-old-mixin"].getServiceTimingOldFlow(t)))return!1}else if(u==CrmField.UITYPES.SERVICE_TIMING&&l==I18n.getMsg("crm.service.servicetiming.business")&&"custom"===Crm.businessJSON.type){if(Lyte.registeredMixins["crm-services-mixin"].checkServiceTimingandDurationWithBusinessHour()){var A=$("#serviceDurationDiv");return Lyte.registeredMixins["crm-services-mixin"].focus=A,commonUtils.showErrorMsg(I18n.getMsg("crm.service.dur.less.avail",moduleRecordMapping.Services.singular_label),A,t),!1}}if(parseInt(u)===CrmField.UITYPES.MULTISELECT_LOOK_UP&&"MXNDUMMYCOLUMNBUNDLE"===d.colname){var w=$L(e).data();if(w.parentModuleId&&w.entityId)store.peekRecord(w.parentModuleId,w.entityId).Unique_Item_Count-(w.selectedid.split("-")[1]?0===w.selectedid.split("-")[1].split(",").first()?0:w.selectedid.split("-")[1].split(",").length:0)+(w.selectedid.split("-")[0]?0===w.selectedid.split("-")[0].split(",").first()?0:w.selectedid.split("-")[0].split(",").length:0)<2&&(n.bundleMinValueError=!0,i=!1)}if("Bundles"===t&&"BUNDLECODE"===d.colname)(l=(l=commonUtils.getValue(e))?l.trim():"")&&l.includes(" ")&&(n.bundleCodeError=!0,i=!1);if("PROBABILITY"===d.colname)if(l)d.oldValue==l&&"clone"!=window[t].currentStatus||l>=0&&l<=100||(n.integerFailed=!0,i=!1);else{var M=commonUtils.getValue($("#Crm_Potentials_STAGE"));l=M.substring(0,M.indexOf(":"))}if("1234"==u&&("Events"===t&&"REMINDAT"===d.colname?l=Events.getMultipleRemindersAsJson():"Appointments"==t&&(l=Lyte.registeredMixins["crm-services-appointments-old-mixin"].getAppointmentRemindersAsJson()),this.requestParamWithColname[d.colname]=l),"Events"===t&&104==u){if("REMINDINVITEESAT"===d.colname){var L=$("#Crm_Events_REMINDINVITEESAT").attr("data-value");l="none"===L?null:Events.getReminderforParticipants(L)}this.requestParamWithColname[d.colname]=l}if(445===u||"445"===u){(l=d.selectedid+"")&&"-"!==l||(l="");var S=l.split("-")[0];S&&S.length>0&&S.split(",").length>d.maxlength/2&&(n.maxlimitFailed=!0,d.maxlimit=d.maxlength/2,i=!1)}l="string"==typeof l?l.trim():l;var U=d.colname,O=d.oldValue,N=d.mandate+"",k=e.parent();k.parent().find(".labelTabCreate.newmandatory.csx").length>0&&(N="true"),556===parseInt(d.uitype)&&void 0===d.mandate&&$(".DetailViewInnerPage").is(":visible")&&!$("#formRuleMandatoryFields").is(":visible")&&(N=$("#mouseArea__"+d.colname).data("params").mandate+"");var P=CFRExec.isLayoutRuleHiddenElem(U);if("SALUTATION"===U&&(P=CFRExec.isLayoutRuleHiddenElem("FIRSTNAME")),!Crm.isHeadless&&CFRExec&&P&&!g&&(N="false"),"Events"==t&&"LOCATION"===U&&l.length>255&&(n.maxlengthFailed=!0,i=!1),"Events"!=t||"true"!==N||"SEID"!==U&&"CONTACTID"!==U)if("Campaigns"===t&&"true"===N&&"SURVEYSELECT"===U){var F=$("#Crm_Campaigns_SURVEYSELECT .zohoSurveyNone").text();l=F,""!==F&&void 0!==F&&"-None-"!==F||(n.mandateFailed=!0,i=!1)}else if("Campaigns"===t&&"true"===N&&"SURVEYTEXTFIELD"===U){var x=$("#Crm_Campaigns_SURVEYTEXTFIELD").val();l="string"==typeof x?x.trim():x;var j=new RegExp("^[a-zA-Z0-9()&._?\\s\\u00A1-\\uFFFF-]*$");""===l||void 0===l?(n.mandateFailed=!0,i=!1):j.test(l)?l.length>100&&(n.surveyNameLenExceed=!0,i=!1):(n.surveyInvalidName=!0,i=!1)}else if("true"==N&&"LOCATION"==U&&""==l)$("#meetingInclude").prop("checked")||(n.mandateFailed=!0,i=!1);else if("true"===N&&"ADDCOMMENT"===U&&validationUtils.isEmptyString(l)&&!/create|clone/.test(window[t].currentStatus))n.mandateFailed=!0,i=!1;else if("true"!=N||"HANDLER"!==U&&"221"!=u||e.data("id"))if("true"==N&&"RECURRING_WEEKLY_DAYS"==U)0==l.length&&(n.mandateFailed=!0,i=!1);else if("true"!==N||"444"!==u&&"445"!==u||""!==l&&"CALLMXNCLONESCHEDULER"!==d.selectedid)if("true"!==N||"3"!==u&&"110"!==u)if("true"===N&&"250"===u&&(validationUtils.isEmptyString(l)||validationUtils.isEmptyString((new DOMParser).parseFromString(l,"text/html").documentElement.textContent)))n.mandateFailed=!0,i=!1;else if("556"===u){var V;if($(".DetailViewInnerPage").is(":visible")&&!$L("#formRuleMandatoryFields").is(":visible")){var B=e.find("crm-image-upload-detail");void 0!==B[0]&&(V=B[0].component)}else{var H=e.find(".imageUploadHead[data-name="+d.colname+"] crm-image-upload-create");0===H.length&&(H=e.find("crm-image-upload-create")),void 0!==H[0]&&(V=H[0].component)}var Y=$("#closedWon");if(Y.is(":visible")&&(0===(H=Y.find(".imageUploadHead[data-name="+d.colname+"] crm-image-upload-create")).length&&(H=e.find("crm-image-upload-create")),void 0!==H[0]&&(V=H[0].component)),void 0!==V)if("true"===N&&0===V.data.imageData.length){n.mandateFailed=!0,i=!1;var G=I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(d.displaylabel));V.constructErrorDiv(G)}else V.removeErrorDiv()}else"true"!==N||("duration"===U||"durationUnit"===U)&&$("#Crm_Consents_duration_radio1").prop("checked")||u==CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY&&"Crm_Appointments_SEID"===e.attr("id")||!validationUtils.isFieldEmpty(e)||"HANDLER"===U||"221"===u||"SMOWNERID"===U||"ADDCOMMENT"===U?"Calls"===t&&"CONTACTID"===U&&!validationUtils.isEmptyString(d.oldid)&&validationUtils.isEmptyString(l)&&(n.mandateFailed=!0,i=!1):(n.mandateFailed=!0,i=!1);else validationUtils.isEmptyString(l)&&(n.mandateFailed=!0,i=!1);else n.mandateFailed=!0,i=!1;else n.mandateFailed=!0,i=!1;else"Others"===$("#Crm_"+t+"_CONTACTID_select").val()?validationUtils.isFieldEmpty($("#Crm_"+t+"_SEID"))&&validationUtils.isFieldEmpty($("#Crm_"+t+"_CONTACID"))&&(n.mandateFailed=!0,i=!1):validationUtils.isFieldEmpty($("#Crm_"+t+"_CONTACTID"))&&"CONTACTID"===U&&(n.mandateFailed=!0,i=!1);if(a&&a.hasOwnProperty("zohoCampaignValidateProperties")&&a.zohoCampaignValidateProperties.hasOwnProperty(v)){var z=a.zohoCampaignValidateProperties;z.hasOwnProperty("Native__Campaigns__Extn__Campaign_Subject")&&!z.hasOwnProperty("Campaign_Name")&&(z.Campaign_Name={maxLength:125,negativeRegex:/[`~#^*[\]{}\\";&<>%/]/,regexErrorKey:"crm.mb.field.common.splc"});var q=$("#Crm_Campaigns_"+U).val();l="string"==typeof q?q.trim():q;var J=z[v];j=J.negativeRegex;validationUtils.isEmptyString(l)?"true"==N&&(n.mandateFailed=!0,i=!1):j.test(l)?(n.fieldValueInvalid=!0,n.invalidFieldMessageKey=J.regexErrorKey,i=!1):l.length>J.maxLength&&(n.maxLenExceed=!0,n.maxAllowedLen=J.maxLength,i=!1)}if(26==u&&l&&!e.data().readonly){var W=l.split(":");W.length<=2&&!W[1]&&(n.mandateFailed=!0,i=!1)}var K=this.getSaveParamName(e,r,t,a),Q=e.data();u+="";var X={};if(i||""!=l){switch(u){case"27":"SALUTATION"===U&&"-None-"===l&&(l="");break;case"555":var Z,ee;fileupload.createObj={},fileupload.removedAttachmentIds.length>0&&(fileupload.createObj.removedAttachmentIds=fileupload.removedAttachmentIds),fileupload.uploadedFileObject.length>0&&(fileupload.createObj.uploadedFileObject=fileupload.uploadedFileObject),l=JSON.stringify(fileupload.createObj);for(var te=[],re=[],ae={},ie={},ne=e[0].id.substring(e[0].id.lastIndexOf("_")+1),oe="true"===e.attr("uploadedfileavilable"),se=e.data("fieldid")+"",le=fileupload.uploadedFileObject.length,de=0;de<le;de++)fileupload.uploadedFileObject[de].isSubformField?fileupload.uploadedFileObject[de].rowNum===ne&&fileupload.uploadedFileObject[de].fieldId===se&&te.push(fileupload.uploadedFileObject[de]):re.push(fileupload.uploadedFileObject[de]);if(te.length>0?(ae.uploadedFileObject=te,Z=JSON.stringify(ae),X.fileUploadObject=Z):oe&&(X.uploadedfileavailable=oe),fileupload.subformRemovedAttachmentIds.length>0){var ce=fileupload.subformRemovedAttachmentRowNumber.indexOf(parseInt(ne)),me=fileupload.subformRemovedAttachmentFieldIds[ce];if(ce>=0&&fileupload.subformRemovedAttachmentRowNumber[ce]===parseInt(ne)&&me===se){var ue=[];ue.push(fileupload.subformRemovedAttachmentIds[ce]),ae.removedAttachmentIds=ue,Z=JSON.stringify(ae),X.fileUploadObject=Z}}ie.uploadedFileObject=re,fileupload.removedAttachmentIds.length>0&&(ie.removedAttachmentIds=fileupload.removedAttachmentIds),ee=JSON.stringify(ie),void 0===this.requestParam["property(fileUploadObject)"]&&(re.length>0||fileupload.removedAttachmentIds.length>0)&&(this.requestParam["property(fileUploadObject)"]=ee);break;case"33":case"35":validationUtils.isValidPhoneNo(e,e.val())?l=commonUtils.getValue(e):(n.checkFailed=!0,i=!1),(pe=d.maxlength)<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0);break;case"34":case"38":case"143":case"144":case"145":case"36":var pe=d.maxlength,ve=d.decimalLength,ge=pe-ve;if(["TAX","DISCOUNT"].indexOf(U)>-1&&Crm.isInventoryModule(t)){if("DISCOUNT"===U&&!Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted&&!s){var fe,Ce,he=e.attr("disctype"),ye=e.attr("percentage");"dirPrice"===he||"percent"===he?(fe="Percentage",Ce=ye):"fromPb"===he&&(fe="Price Book",Ce="0"),this.requestParamWithColname.DISCOUNT_TYPE=fe,X["property(Discount Type Input)"]=fe,this.requestParamWithColname.DISCOUNT_PERCENTAGE=Ce,X["property(Discount Percentage Input)"]=Ce}break}if(CFRExec.isLayoutRuleHiddenElem(Q.colname))break;if(validationUtils.isValidDecimal(l,ge,ve,n))validationUtils.decimalLengthCheck(l,ve)||(n.decimalLengthCheckFailed=!0,i=!1);else n.checkFailed=!0,i=!1;break;case"32":case"52":""===l||validationUtils.isValidInteger(l)||(n.integerFailed=!0,i=!1),(pe=d.maxlength)<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0);break;case"11":case"110":(pe=d.maxlength)<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0);break;case"1":case"2":if("-None-"===l&&(l=""),"CALLDURATION"===U&&(""===l||validationUtils.isValidInteger(l)?(l=parseInt(l,10),/^\d{1}$/.test(l)&&(l="0"+l),"Calls"===t&&l>1439&&(n.maxlimitFailed=!0,i=!1)):g&&"--"===l?l="":(n.integerFailed=!0,i=!1)),"Users"!=t||0!=e.data().customfield||"Crm_Users_ALIAS"!=e[0].id&&"Crm_Users_STREET"!=e[0].id&&"Crm_Users_COUNTRY"!=e[0].id&&"Crm_Users_CITY"!=e[0].id&&"Crm_Users_STATE"!=e[0].id&&"Crm_Users_ZIPCODE"!=e[0].id||l.indexOf("|")>-1&&(n.checkFailed=!0,i=!1),"1"===u)(pe=d.maxlength)<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0);if("2"===u&&e.data("isLocalized")){var Ee=e.data("picklistmap"),_e=Ee.length;for(T=0;T<_e;T++){var Ie=Ee[T];if(Ie.uservalue===l){l=Ie.oldvalue;break}}}break;case"100":case"96":if(l||(l=""),l)if("Crm_Tasks_RECURRING_WEEKLY_DAYS"==e.attr("id")){for(var Te=0;Te<l.length;Te++)X["day"+parseInt(l[Te])]="on";l=void 0}else l=l.join(";");break;case"17":l=commonUtils.getRadioValue(c);break;case"42":if("Custom_Recurring_period"===d.colname&&"Tasks"===t)if("daily"===l)X.dailyhidden=2,X.daily111=$("#Crm_Tasks_RECURRING_DAILY_REPEAT_COUNT").val(),X.exceptholiday=$("#Crm_Tasks_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked");else if("monthly"==l){var De=$("#Crm_Tasks_RECURRING_MONTHLY_REPEAT_COUNT").val();X.noMonths1=De,X.noMonths2=De,X.nextbusin_holiday=$("#Crm_Tasks_NEXT_BUSINESS_HOLIDAY_MONTH_0").is(":checked")}else"yearly"===l&&(X.nextbusin_holiday=$("#Crm_Tasks_NEXT_BUSINESS_HOLIDAY_YEAR_0").is(":checked"));else if("Tasks"===t&&"Recurring_period"===d.colname){var Re=$("#Crm_Tasks_Recurring_period").find("option:selected").val(),be=new Date($("#Crm_Tasks_DUEDATE").data("dateObj"));"custom"!=Re&&"none"!=Re&&(X.repeatEveryCnt=1,"daily"==Re?(X.dailyhidden=1,X.exceptholiday=$("#Crm_Tasks_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked")):"weekly"==Re?X.selectedWeekDays=be.getDay()+1:"monthly"==Re?(X.noMonths1=1,X.monthlyhidden=1,X.monthly1select=be.getDate(),X.nextbusin_holiday=$("#Crm_Tasks_NEXT_BUSINESS_HOLIDAY_MONTH_0").is(":checked")):"yearly"==Re&&(X.yearlyhidden=1,X.yearmonths=be.getMonth(),X.yearlydays1select=be.getDate(),X.nextbusin_holiday=$("#Crm_Tasks_NEXT_BUSINESS_HOLIDAY_YEAR_0").is(":checked")))}break;case"18":$("."+d.colname).each((function(){this.checked&&(X[this.name]="on")}));break;case"21":var Ae=e.val()?e.val().trim():e.val();validationUtils.isValidWebUrl(Ae)||(n.checkFailed=!0,i=!1),(pe=d.maxlength)<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0);break;case"22":var we=e.val();we&&(we=we.trim()),validationUtils.isValidTwitter(we)||(n.checkFailed=!0,i=!1);break;case"25":Ae=e.val()?e.val().trim():e.val();validationUtils.isValidEmail(Ae)||(n.checkFailed=!0,i=!1);break;case"123":if("Events"==t&&(l=void 0),"RECURRING"===d.colname&&"Tasks"===t&&(l=e.is(":checked")&&!e.is(":disabled")?"on":void 0,l=CFRExec&&CFRExec.isLayoutRuleHiddenElem(U)?void 0:l,"custom"==$("#Crm_Tasks_Recurring_period").val())){var Me=$("#Crm_Tasks_Custom_Recurring_period").val();"daily"==Me?(crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customWeeklyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customMonthlyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customYearlyFields)):"weekly"==Me?(crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customDailyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customMonthlyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customYearlyFields)):"monthly"==Me?(crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customDailyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customWeeklyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customYearlyFields)):"yearly"==Me&&(crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customDailyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customWeeklyFields),crmTasks.removeArrayElements(Crm.fieldsObj[t],crmTasks.customMonthlyFields))}e.data().recdata&&("Tasks"===t&&"clone"===window[t].currentStatus?X.recAct="":X.recAct=e.data().recdata,X.oldEntityId=crmHistory.getCurrentStateData().id,X.userId=Crm.userDetails.USER_ID),e.is(":checked")||(delete X["property(Recurring Activity)"],delete this.requestParam["property(Recurring Activity)"]);break;case"301":case"300":l="RECURRING_INVITATIONMAIL"===d.colname?e.is(":checked")?"1":"0":"OTHERSERVICE"===d.colname?"true"===l?"on":"":e.is(":checked")?"on":"";break;case"24":case"202":case"14":case"786":case"30":case"333":if("checkbox"==e.attr("type")&&"Tasks"==t){if(e.is(":checked")){var Le=$("#Crm_Tasks_RECURRING").is(":checked");if(X.remCheckTask="on",Le){crmTasks.updateAllUpcomingRem&&(X.remOnAllUpcomingTasks=!0);var Se=$("#Crm_Tasks_remTime_TimeOption");He=(Be=Se.val().split(" ")[0]).split(":");X["property(Remind Athour)"]=He[0],X["property(Remind Atminute)"]=He[1];var Ue=Utils.getMeridiem(Se.timeEntry("getTime")).toUpperCase();X["property(Remind Atampm)"]=Ue,X["Remind AtdateTime"]=Se.val(),(_=$("#Crm_Tasks_remTime").val())&&"none"!=_&&("Events"==t?Crm.calPreferences.TURNOFFEMAILREMINDER?X.alertRadio=X.alertType="email":X.alertRadio=X.alertType="popup":X.alertRadio=this.requestParam.alertType=$("#Crm_Tasks_RemindAt_Notify").val(),X.remTime=_+" "+$("#Crm_Tasks_remTime_Period").val())}else{var Oe="Crm_Tasks_RemindAt_Start_Date1",Ne=$("#"+Oe).val(),ke=$("#Crm_Tasks_RemindAt_remTime_Radio").prop("checked"),Pe=ke?$("#Crm_Tasks_remTime_TimeOption"):$("#Crm_Tasks_RemindAt_Start_Date1_TimeOption"),$e=(He=(Be=Pe.val().split(" ")[0]).split(":"))[0],Fe=He[1],xe=Utils.getMeridiem(Pe.timeEntry("getTime")).toUpperCase();e,X["property(Remind Athour)"]=$e,X["property(Remind Atminute)"]=Fe,X["property(Remind Atampm)"]=xe.toUpperCase(),X["property(Start Date1)"]=Ne,X["Remind AtdateTime"]=$("#"+Oe+"_TimeOption").val(),X.remTime=0,X.remTime=ke?$("#Crm_Tasks_remTime").val()+" "+$("#Crm_Tasks_remTime_Period").val():0,l=Ne,X.alertRadio=X.alertType=$("#Crm_Tasks_RemindAt_Notify").val()}X.remTaskRepeat=$("#Crm_Tasks_RemindAt_period").val()}else crmTasks.remOffAll&&(X.remOffAllUpcomingTasks=!0),delete this.requestParam.remCheckTask,delete X.remCheckTask;break}"Tasks"===t&&"DUEDATE"===d.colname&&$("#Crm_Tasks_RECURRING").is(":checked")&&(l=$("#Crm_Tasks_Recurring_Start_Date1").lenght?$("#Crm_Tasks_Recurring_Start_Date1").val():l),l=l.replace(Crm.userDetails.DATE_PATTERN,"");var je=$("#createEditCallDiv"),Ve="Calls"==t&&isNewCallView&&je.is(":visible")?je.find("#"+e.attr("id")+"_TimeOption"):$("#"+e.attr("id")+"_TimeOption");if("24"!=u&&"202"!=u)var Be=Ve.val().split(" ")[0];if(d.mandate+""=="true"&&"24"!=u&&"202"!=u&&""==Be&&(i=!1,n.mandateFailed=!0),""==l||Utils.isValidDate(Crm.userDetails.DATE_PATTERN,l)||(n.checkFailed=!0,i=!1),""!==l&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN,l))$L("#changeOwnerPopUp").is(":visible")&&new Date(CrmDateUtils.convertdateToDBformat(l)).getFullYear()<1e3&&(n.checkFailed=!0,i=!1);if(("786"==u||"30"==u||"14"==u||"333"==u)&&""!=l){var He=Be.split(":"),Ye=(Ue=""!=Be?Utils.getMeridiem(Ve.timeEntry("getTime")).toUpperCase():"AM",""!=Be?He[0]:"00"),Ge=""!=Be?He[1]:"00";Utils.isValidTime(Ye,Ge)||(n.checkFailed=!0,i=!1),Ye&&(X[K.substring(0,K.indexOf(")"))+"hour)"]=Ye),Ge&&(X[K.substring(0,K.indexOf(")"))+"minute)"]=Ge),Ue&&(X[K.substring(0,K.indexOf(")"))+"ampm)"]=Ue),"HH:mm"!==Crm.userDetails.TIME_FORMAT?this.requestParamWithColname[U]=l+" "+Ye+":"+Ge+" "+Ue:this.requestParamWithColname[U]=l+" "+Ye+":"+Ge}if("ENDDATETIME"==d.colname||"Recurring_End_Date1"==d.colname||"ENDDATE"==d.colname||"SALES_END_DATE"==d.colname||"SUPPORT_EXPIRY_DATE"==d.colname||"Native__Backstage__Extn__Event_End_Date"==d.sysrefname){var ze=e,qe=d.dateObj,Je={ENDDATE:"mouseArea__STARTDATE",SALES_END_DATE:"mouseArea__SALES_START_DATE",SUPPORT_EXPIRY_DATE:"mouseArea__SUPPORT_START_DATE"},We={Native__Backstage__Extn__Event_End_Date:"Native__Backstage__Extn__Event_Start_Date"},Ke=(rt=(tt={ENDDATETIME:"Crm_Events_STARTDATETIME",Recurring_End_Date1:"Crm_Tasks_Recurring_Start_Date1",ENDDATE:"Crm_Campaigns_STARTDATE",SALES_END_DATE:"Crm_Products_SALES_START_DATE",SUPPORT_EXPIRY_DATE:"Crm_Products_SUPPORT_START_DATE",APPOINTMENTENDTIME:"Crm_JobSheets_APPOINTMENTSTARTTIME"})[d.colname]?$("#"+tt[d.colname]):$('[data-sysrefname="'+We[d.sysrefname]+'"]')).data("dateObj"),Qe=validationUtils.isFieldEmpty(ze),Xe=validationUtils.isFieldEmpty(rt);if(validationUtils.isFieldEmpty(rt)&&validationUtils.isFieldEmpty(ze))break;if(rt.length<1){var Ze=$("#"+Je[d.colname]);if(Ze.length>0){Ke=new Date(Ze.data("params").defaultvalue);var et=$("#subvalue_"+Ze.data("params").colname);Xe=!1,et.length>0&&et.text().trim().length<1&&(Xe=!0)}}if(Xe||Qe)break;Ke&&(Utils.compareDate(Ke,qe)&&("ENDDATETIME"!=d.colname||Utils.compareDateandTime(Ke,qe))||(n.comparisonFailed=!0,i=!1))}if("STARTDATETIME"==d.colname||"Recurring_Start_Date1"==d.colname||"STARTDATE"==d.colname||"SALES_START_DATE"==d.colname||"SUPPORT_START_DATE"==d.colname||"Native__Backstage__Extn__Event_Start_Date"==d.sysrefname){var tt,rt=e;Ke=d.dateObj,Je={STARTDATE:"mouseArea__ENDDATE",SALES_START_DATE:"mouseArea__SALES_END_DATE",SUPPORT_START_DATE:"mouseArea__SUPPORT_EXPIRY_DATE"},We={Native__Backstage__Extn__Event_Start_Date:"Native__Backstage__Extn__Event_End_Date"},qe=(ze=(tt={STARTDATETIME:"Crm_Events_ENDDATETIME",Recurring_Start_Date1:"Crm_Tasks_Recurring_End_Date1",STARTDATE:"Crm_Campaigns_ENDDATE",SALES_START_DATE:"Crm_Products_SALES_END_DATE",SUPPORT_START_DATE:"Crm_Products_SUPPORT_EXPIRY_DATE"})[d.colname]?$("#"+tt[d.colname]):$('[data-sysrefname="'+We[d.sysrefname]+'"]')).data("dateObj"),Qe=validationUtils.isFieldEmpty(ze),Xe=validationUtils.isFieldEmpty(rt);if(validationUtils.isFieldEmpty(rt)&&validationUtils.isFieldEmpty(ze))break;if(ze.length<1){var at=$("#"+Je[d.colname]);if(at.length>0){qe=new Date(at.data("params").defaultvalue);var it=$("#subvalue_"+at.data("params").colname);Qe=!1,it.length>0&&it.text().trim().length<1&&(Qe=!0)}}if(Xe||Qe)break;if(We[d.sysrefname])if((Ke=new Date($("#Crm_"+t+"_"+d.colname).data("dateObj")))<new Date){n.startDatePast=!0,i=!1;break}qe&&(("STARTDATETIME"==d.colname||Utils.compareDate(Ke,qe))&&("STARTDATETIME"!=d.colname||Utils.compareDateandTime(Ke,qe))||(n.lessThan=!0,i=!1))}if("Calls"==t&&"CALLSTARTDATETIME"===d.colname&&!isNewCallView){var nt=commonUtils.getRadioValue("whichCall");Ke=e.data("dateObj");"ScheduleCall"===nt?Ke&&!Utils.compareDateandTime(new Date,Ke)&&(n.comparisonFailed=!0,i=!1):"CompletedCall"===nt&&"edit"!=window[t].currentStatus&&Ke&&!Utils.compareDateandTime(Ke,new Date)&&"edit"!=window[t].currentStatus&&(n.lessThan=!0,i=!1),X.whichCall=nt}break;case"Time":Utils.isValidTime(e.val())||(i=!1);break;case"41":l=JSON.stringify(Events.invJsonCreate),"edit"==Events.currentStatus&&(Events.invRemoveJson.e=Events.removeInvEmailsList,Events.invAddJson.e=Events.addInvEmailsList,X.invRemoveJson=JSON.stringify(Events.invRemoveJson),X.invAddJson=JSON.stringify(Events.invAddJson),l=void 0);break;case"221":l=e.data().id;break;case"8":if(l=e.val(),"Appointments"==t)if(!(l=document.getElementById("Crm_Appointments_SMOWNERID").component.getData("dataId"))){i=!1,n.mandateFailed=!0;break}if(!l&&!e.data().id){i=!1,n.mandateFailed=!0;break}X["property(ownerId)"]=e.data().id,X["property(ownerName)"]=$("#ownerNameLookupSpan").text(),this.requestParamWithColname[U]=e.data().id;break;case"208":X["property(Layout)"]=e.val();break;case"55":l=e.val(),X["property(ownerName:Handler)"]=e.data().id,this.requestParamWithColname[U]=e.data().id;break;case"4":case"5":case"6":case"7":case"9":case"10":case"12":case"13":case"15":case"133":case"135":if((l=e.data("id"))&&"null"!=l?l+="":l="","Events"===t)var ot=$("#Crm_"+t+"_CONTACTID_select").val();else if("Tasks"===t||"Calls"===t)ot=$("#Crm_"+t+"_CONTACTID_WhoId_select").val();if(/Calls|Tasks/.test(t)&&!ot&&(X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))),/Events|Calls|Tasks/.test(t)&&"CONTACTID"==U&&ot&&"None"!=ot)"Leads"==ot||"Contacts"==ot?(X["property(leContModId)"]=l,X["property(leContModSel)"]=ot,X["property(leContModName)"]=$("#Crm_"+t+"_CONTACTID").val(),X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))):"Others"==ot?(X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))):"PhoneNumbers"==ot&&(X["property(Customer Number)"]=$("#Crm_"+t+"_CONTACTID").val(),X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))),"Tasks"===t&&s||(l=void 0);else if("SEID"===U&&u!==CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY.toString())l=void 0;else{var st=Q.subformdisplaylabel,lt="true"==Q.customfield?Q.colname:Q.name;if(s&&st&&!1===Q.customfield&&Crm.isLineItemSubFormModule(st)&&(lt=Q.colname),Crm.isLineItemSubFormModule(st)&&"PRODUCTID"===d.colname){var dt=e.attr("prdDetails");if(""===(Ae=e.val())||void 0===dt&&Ae.length>0||void 0!==dt&&Ae!==function(e,t){var r=JSON.parse(e),a=r.Product_Name.replace(/(\r\n|\n|\r)/gm," ");return t&&r.Product_Code&&""!==r.Product_Code&&(a=a+" ("+r.Product_Code+")"),a}(dt,Q.lineitemprodcode)){var ct=e.val(),mt=e.closest("div"),ut=mt.find(".prdError");if(ct.length>0&&0===ut.length){var pt=document.createElement("span");pt.setAttribute("class","prdError errMsg errorMsgDesc"),pt.innerText=I18n.getMsg("crm.subform.lineitem.product.name.error"),mt.append(pt)}i=!1}}t&&moduleRecordMapping[t]&&"linking"===moduleRecordMapping[t].generated_type&&Q.colname.indexOf("LINKINGMXN")>-1&&(lt=Q.sysrefname),X["property("+lt+")"]=e.val()}if("Calls"===t&&isNewCallView&&"CONTACTID"===U&&validationUtils.isEmpty(X["property(leContModId)"])&&(!k||"headertextarea_CONTACTID"!==k[0].id))if("ScheduledCall"==crmCallsNew.getCallStartTimeWithInfo().whichCall){var vt=I18n.getMsg("crm.call.callto.empty.check.qcreate");renderingUtils.showCustomAlert(vt),i=!1}break;case"132":"Lookup"===Q.contentType&&(l=e.data("id")),l&&"null"!=l?l+="":l="";lt="true"===Q.customfield||"Lookup"===Q.contentType?Q.colname:Q.name;if(t&&moduleRecordMapping[t]&&"linking"===moduleRecordMapping[t].generated_type&&Q.colname.indexOf("LINKINGMXN")>-1&&(lt=Q.sysrefname),"Appointments"===t&&"SEID"===U&&"krp"===Events.createSource){var gt=$L("#Crm_Appointments_SEID_RELATEDTO");X["property(modsel)"]=gt.data("lookup-module"),X["property(modid)"]=gt.data("id")}X["property("+lt+")"]=e.val();break;case"444":case"445":var ft="";(l=e.data("id"))&&"null"!=l||(l=e.data("selectedid"))&&"null"!=l||(l="");var Ct=e.data("clonedfrom");if(Ct&&(X.cloneEntityId=Ct),"Users"!=e.data("lookupModule")&&(e.data("unselectedid")&&(ft=e.data("unselectedid")),l=l+"-"+ft),"Events"===t)ot=$("#Crm_"+t+"_CONTACTID_select").val();else if("Tasks"===t||"Calls"===t)ot=$("#Crm_"+t+"_CONTACTID_WhoId_select").val();if(/Calls|Tasks/.test(t)&&!ot&&(X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))),/Events|Calls|Tasks/.test(t)&&"CONTACTID"==U&&ot&&"None"!=ot)"Leads"==ot||"Contacts"==ot?(X["property(leContModId)"]=l,X["property(leContModSel)"]=ot,X["property(leContModName)"]=$("#Crm_"+t+"_CONTACTID").val(),X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))):"Others"==ot&&(X["property(modsel)"]=$("#Crm_"+t+"_SEID_label_select").val()||$("#Crm_"+t+"_SEID_select").val(),X["property(modname)"]=$("#Crm_"+t+"_SEID").val(),""!=trimBoth($("#Crm_"+t+"_SEID").val())&&(X["property(modid)"]=$("#Crm_"+t+"_SEID").data("id"))),l=void 0;else if("SEID"==U)l=void 0;else if(-1!=U.indexOf("MXNDUMMYCOLUMN")){lt="true"===Q.customfield?Q.colname:Q.name;"Services"==t&&"MXNDUMMYCOLUMN_SERVICE"==Q.colname||(X["property("+lt+")"]=l),g&&(445===u||"445"===u)&&l&&validationUtils.isEmpty(l.toString().split("-")[0])&&(n.mandateFailed=!0,i=!1)}else{lt="true"==Q.customfield?Q.colname:Q.name;t&&moduleRecordMapping[t]&&"linking"===moduleRecordMapping[t].generated_type&&Q.colname.indexOf("LINKINGMXN")>-1&&(lt=Q.sysrefname),X["property("+lt+")"]=e.val()}if("Calls"===t&&isNewCallView&&"CONTACTID"===U&&validationUtils.isEmpty(X["property(leContModId)"]))if("ScheduledCall"==crmCallsNew.getCallStartTimeWithInfo().whichCall){vt=I18n.getMsg("crm.call.callto.empty.check.qcreate");renderingUtils.showCustomAlert(vt),i=!1}break;case"1234":_=$("#Crm_"+t+"_REMINDAT").val();if("Events"===t){var ht=Events.maxReminderValue;for(T=1;T<=ht;T++)if("none"!=$("#Crm_Events_REMINDAT"+T).attr("data-value")&&null!=$("#Crm_Events_REMINDAT"+T).attr("data-value")){_=$("#Crm_Events_REMINDAT"+T).attr("data-value");break}}("Events"===t||_&&"none"!=_&&"0"!=_)&&(X.remCheckTask="on","Events"===t&&(Crm.calPreferences.TURNOFFEMAILREMINDER?X.alertType="email":X.alertType="popup"),X.remTime=_,X.remTaskRepeat="none")}if("text"===e.attr("type")&&"Lookup"!==Q.contentType)(pe=e.attr("data-cscript-maxlength"))&&pe<l.length&&(n.checkFailed=!0,i=!1,n.maxlengthFailed=!0)}if(!Crm.isHeadless&&CFRExec&&!0===n.checkFailed&&CFRExec.isLayoutRuleHiddenElem(U)&&(n.checkFailed=!1,i=!0,l=void 0),void 0!==l&&"555"!==u&&"556"!==u){if("Tasks"==t&&"property(Remind At)"==K&&($("#Crm_Tasks_RECURRING").prop("checked")||$("#Crm_Tasks_RemindAt_remTime_Radio").prop("checked"))){var yt=$("#Crm_Tasks_DUEDATE");1==yt.length?X[K]=yt.val():X[K]=null}else!l||1!=u&&11!=u&&27!=u&&127!=u&&62!=u||(l=renderingUtils.removeMultiSpacestoSingleSpace(l)),X[K]=l;this.requestParamWithColname[U]||("300"!==u&&"301"!==u||(l="on"===l),(void 0===o||o&&o.indexOf(e.attr("id"))>-1)&&(this.requestParamWithColname[U]=l))}if("Events"===t){if(Events.appendEventParams(U),"edit"!==Events.currentStatus){X["property(notified_all)"]=!1}var Et="property(Who Id)";delete Crm.requestParam[Et],delete X[Et]}if("Calls"===t&&($("#Crm_Calls_CALLDURATION_Mins").is(":visible")||!Crm.isHeadless)){var _t=Crm.requestParam["property(DurationInMinute)"],It=Crm.requestParam["property(DurationInSecond)"];_t=_t||X["property(DurationInSecond)"],It=!It||X["property(DurationInSecond)"]?X["property(DurationInSecond)"]:It,X["property(Call Duration)"]=_t||It?(_t||"00")+":"+(It||"00"):"","CALLDURATION"==U&&g&&(""===X["property(Call Duration)"]?delete this.requestParamWithColname[U]:this.requestParamWithColname[U]=$("#Crm_Calls_CALLDURATION_Mins").val()+":"+$("#Crm_Calls_CALLDURATION_Secs").val())}l!==O&&(Crm.isRecordModified=!0)}return n.paramvalues=X,n.result=i,n},getSaveParamName:function(e,t,r,a){var i=e.data(),n=i.colname,o=i.subformdisplaylabel,s=void 0!==a?a.isFrmBP:void 0,l="true"===i.customfield||!0===i.customfield||i.uitype==CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY&&"Lookup"===i.contentType?i.colname:i.name;if(s&&o&&!1===i.customfield&&Crm.isLineItemSubFormModule(o)&&(l=n),r&&moduleRecordMapping[r]&&"linking"===moduleRecordMapping[r].generated_type&&i.colname.indexOf("LINKINGMXN")>-1&&(l=i.sysrefname),1!=i.customfield&&"Users"===this.moduleName)return l=UserModule.getSaveParam(i.label);if(i.lookupModule&&"MultiModuleLookup"!==i.contentType){var d=i.lookupModule;l=commonUtils.getLookupIdName(d)+":"+l}else{if(/RECURRING_DAILY_EVERYDAY|Recurring_period|RECURRING_MONTHLY_DAYS_NO|RECURRING_MONTHLY_MONTH_NO|RECURRING_MONTHLY_WEEKSEQUENCE_TYPE|RECURRING_MONTHLY_WEEKSEQUENCE_DAY|RECURRING_MONTHLY_WEEKSEQUENCE_MONTH_NO|RECURRING_YEARLY_DAYS_OF_MONTH|RECURRING_YEARLY_DAYS_NO|RECURRING_YEARLY_WEEKSEQUENCE_TYPE|RECURRING_YEARLY_WEEKSEQUENCE_NO|RECURRING_YEARLY_WEEKSEQUENCE_MONTH_NAME/.test(i.colname))return l;if(/RECURRING_WEEKLY_REPEAT_COUNT/.test(i.colname))return"weeklyhidden";if(/RECURRING_MONTHLY_DAYS/.test(i.colname))return"monthlyhidden";if(/RECURRING_YEARLY_DAYS/.test(i.colname))return"yearlyhidden";if(/RECURRING_INVITATIONMAIL/.test(i.colname))return"property(RecInvMailType)";if(/hdnproductName[1-9]+|hdnNetTotal[0-9]+|hdnTax[0-9]+|hdnTotalAfterDiscount[0-9]+|hdnDiscount[0-9]+|hdnproductName[0-9]+|hdnQtyStock[0-9]+|txtQty[0-9]+|hdnUnitPrice[0-9]+|txtListPrice[1-9]+|hdnTotal[1-9]+/.test(l))return l;if(-1!=Events.recurringElemIds.indexOf("Crm_Events_"+n)){if("STARTDATETIME"!=n&&"ENDDATETIME"!=n)return i.name;t||(l=l.replace("Time","")+"1")}}return"RemindAt_Notify"===n&&(l="alertType"),"Crm_Calls_CALLDURATION_Mins"===e.attr("id")&&(l="DurationInMinute"),"Crm_Calls_CALLDURATION_Secs"===e.attr("id")&&(l="DurationInSecond"),133===i.uitype&&this.moduleName.startsWith("LinkingModule")||(-1!=l.indexOf(".")&&(l=i.sysrefname),-1!=l.indexOf("(")&&(l=i.sysrefname),-1!=l.indexOf(")")&&(l=i.sysrefname)),"property("+l+")"},getCanvasId:function(e,t,r){if(e&&t&&!Crm.userDetails.RTL_ENABLED){if(["Tasks","Events","Calls","Services","Appointments"].indexOf(idModuleMapping[e])>=0&&!Crm.userDetails.isCanvasActivitySupportEnabled)return;if(!r)r=store.peekRecord(e,t)&&store.peekRecord(e,t).Layout?store.peekRecord(e,t).Layout.id:store.peekRecord("module",e).layouts?store.peekRecord("module",e).layouts[0].id:void 0;var a=store.peekRecord("layout",r),i=Crm.userDetails.PROFILE_ID;if("team_based"===store.peekRecord("module",e).access_type){if(!store.peekRecord("module",e).private_profile)return;i=store.peekRecord("module",e).private_profile.id}if(a&&"downgraded"===a.status&&(a=store.peekRecord("layout",store.peekRecord("module",e).layouts.filter((function(e){return"system"===e.generated_type}))[0].id)),a&&a.profiles)for(var n=a.profiles,o=n.length,s=0;s<o;s++)if(n[s].id===i&&"canvas"===n[s]._default_assignment_view.type)return n[s]._default_assignment_view.id}},getCurrentI18NLocale:function(){var e=Crm.userDetails.LOCALE,t="en_US",r=Crm.userDetails.RELEVANT_LOCALE;return-1!==app.cruxCompLocale.indexOf(e)?t=e:-1!==app.cruxCompLocale.indexOf(r)&&(t=r),t},getModuleDisplayName:function(e,t,r){var a="",i=Crm.moduleInfo?Crm.moduleInfo.Events:void 0;return i||(i="string"==typeof Crm.userDetails.MODULE_LIST?JSON.parse(Crm.userDetails.MODULE_LIST).Events:Crm.userDetails.MODULE_LIST.Events),a=i.pluralLabel?i.translatedPluralLabel:i.plural_label,e&&(a=i.singularLabel?i.translatedSingularLabel:i.singular_label),t||(a=a.toLowerCase()),r?I18n.getMsg(a):a},ncEvalRules:function(e,t){return!!t||CVRExec.evalRules("edit",e)},saveEntity:function(e,t,r,a,i,n,o,s,l,d,c){commonUtils.setErrVerifyContHeightToParent(!1,!1,!1);var m=!("Events"!==t&&"Appointments"!==t&&"Calls"!==t||!a)||Crm.validateEntityAndShowErrorMsg(this.fieldsObj[t],t,!0,n,void 0,d,c);if(m&&$("#bulkTaskNewPopup").length>0){var u=Lyte.Router.getRouteInstance().parent.currentModel.module_name;"Leads"==u||"Contacts"==u?(Crm.requestParam["property(leContModSel)"]=u,delete Crm.requestParam["property(modsel)"]):(delete Crm.requestParam["property(leContModSel)"],Crm.requestParam["property(modsel)"]=u)}if(!m)return!1;new Promise((function(e){CVRExec.isNC=!0,CVRExec.isNew=i,e(Crm.ncEvalRules(t,d))})).then((function(d){if(!("Invoices"!=t||d&&Crm.confirmInvoiceCreationWithLowStock()))return!1;if(CVRExec.isNC=!1,!d)return!1;if(window.ctiApiNotifier&&ctiApiNotifier.eventCreate)return ctiApiNotifier.addEvent(d),!1;if("Potentials"===t&&"view"!==window[t].currentStatus&&!Crm.userDetails.ReasonForLoss){var m=$("#Crm_Potentials_STAGE"),u=m.val();if(u&&"Closed Lost"===m.find("option:selected").attr("data-fctype")&&!$("#closedWon").is(":visible")&&(u!==m.data("old-value")||"clone"===window[t].currentStatus))return void closePotentialFromDV($("#Crm_Potentials_STAGE").val(),"edit")}var p;if(e&&"Appointments"!==t&&$(e.target).prop("disabled",!0).siblings("input[type=button]").prop("disabled",!0),"Events"!==t&&"Appointments"!==t){p=["save"];var v=Crm.userDetails.permissions["Crm_Implied_Create_"+t];"Calls"===t&&v?p.push("saveAndTask"):v&&p.push("saveAndNew"),"Tasks"===t&&Crm.userDetails.ISGAPPS_USER&&p.push("saveAndExportToGoogleTask"),p.push("cancel");for(var g=p.length,f=0;f<g;f++)$('input[id="'+p[f]+t+'Btn"],input[id="'+p[f]+t+'Btn_Bottom"]').prop("disabled",!0)}if(Lyte.Router.getRouteInstance()&&"detail"===Lyte.Router.getRouteInstance().routeName&&"edit"===window[t].currentStatus&&"undefined"!=typeof businessCardJson&&"2"===businessCardJson.isApproved&&0!==businessCardJson.hidden.EditFieldsType)return openRejectorComp(businessCardJson.hidden.APPROVALBUTTONS[0],null,!1,Crm.requestParam,void 0,void 0,void 0,businessCardJson.hidden.APPROVALBUTTONS),null;commonUtils.showHideLoadingDiv(!0);var C=Crm.requestParam;c&&(C["property($validation_rule_action)"]=c);$L("#saveAppointmentsBtn");if("Appointments"===t&&Crm.requestApp&&!Crm.requestParam["property(Appointment Name)"]&&(C=Crm.requestApp),"Accounts"===t&&("create"===window[t].currentStatus||"edit"===window[t].currentStatus||"clone"===window[t].currentStatus)){var h=$("#externalCompanyId").val();null!=h&&""!=h&&(C.externalSource=null!=$("#externalCompanyId").attr("externalsource")?$("#externalCompanyId").attr("externalSource"):"",C.externalSourceId=h)}var y=s||Crm.getCrmBasePath()+"/CreateCommonModule.do";if("edit"===window[t].currentStatus&&(y=Crm.getCrmBasePath()+"/EditCommonModule.do"),"Tasks"==t&&(C["property(Send Notification Email)"]=document.getElementById("Crm_Tasks_SENDNOTIFICATION").checked?"on":"",C.updateAllRecTasks=!!crmTasks.updateAllRec&&crmTasks.updateAllRec),getElemById("homeTable")&&"Events"==t&&(C.createSource=Events.createSource),C.operation=window[t].currentStatus,"edit"==window[t].currentStatus){var E=window[t].entityId;"Events"!==t||E||(E=window[t].createEditJson.entityId),C["property(id)"]=E,C.ActionType="Edit","Consents"!=t&&"undefined"!=typeof changeOwner&&(C.relatedRecords=changeOwner.relatedRecords[E],C.notify=changeOwner.notifyOwner[E])}C.Product&&(C.Product=JSON.stringify(C.Product)),C.newModel=!0,C.module=t;var _=$("#layoutDetails").val(),I=$("#zCampIntegLayout");if(I.length>0){var T=I.val();"zCampIntegLayoutOffline"!==T&&(_=T)}C.layoutId=null==_||"Calls"==t?$("#Crm_"+t+"_LAYOUTID").val():"Appointments"===t?void 0:_;var D=$("input[name='uploadId']");D.length>0&&void 0!==D.val()?C.uploadId=D.val():delete C.uploadId;var R=$("input[name='deleteEntityImage']");if(R.length>0&&void 0!==R.val()&&(C.deleteEntityImage=R.val()),"clone"===window[t].currentStatus){var b=$("#photoID").val();null!=b&&null!=b&&"null"!=b&&""!=b&&(C.uploadId=b)}if(C["property(module)"]=t,"PriceBooks"===t){var A=$("#Crm_PriceBooks_PRICINGMODEL").val();""!==A&&null!=A&&"-None-"!==A&&(C["property(totalPriceCount)"]=$("#secDiv_Pricing_Details").find(".hrow1").length)}if(Crm.isInventoryModule(t)&&"setup"!==this.currentStatus&&(C["property(txtQty0)"]=-1,C["property(txtListPrice0)"]=-1),C[csrfParamName]=csrfToken,$("#save"+C.module+"Btn").data("fromValidation")&&(C.validationApproval=!0),window[t].currentStatus&&"clone"==window[t].currentStatus&&crmCommonModule.createEditJson.entityMapJson){var w=crmCommonModule.createEditJson.entityMapJson.TAGMODULEREFID;if(null!=w&&null!=w){var M=w.defaultvalue.split("||"),L="",S=M.length;for(f=0;f<S;f++)""!=M[f]&&(L+=f<S-1?M[f]+",":M[f]);C.tagValue=L}}if("Events"===t){var U="property(EventStatus)";C.fromQuickCreate="true",C[U]=Events.status,C["property(Provider)"]="";var O=$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),N=$("#Crm_Events_ENDDATETIME").data("dateObj").getTime(),k=(new Date).getTime();if(k<O){if(C[x="property(meetingToolAdded)"]=$("#meetingInclude").prop("checked"),Crm.userDetails.MEETING_BRIDGE_ENABLED){var P="property(Provider)",F=$("#Crm_Events_MEETING_VENUE").val();if(C["property(Meeting Venue)"]=F,F===I18n.getMsg("Online")){C[P]=$("#Crm_Events_MEETING_PROVIDER").val();if(C["property(Venue)"]="","relatedlist_meetnow"==Events.createSource)C["mnDuration"]=$("#Crm_Events_DURATION").val()}else F!==I18n.getMsg("Client location")&&F!==I18n.getMsg("In-office")||(C[P]="")}else if(C[x]){if("relatedlist_meetnow"==Events.createSource)C["mnDuration"]=$("#Crm_Events_DURATION").val();C["property(meetingToolName)"]=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")}}else if("edit"===Events.currentStatus&&k>O){var x;C[x="property(meetingToolAdded)"]=!1}if("clone"==Events.currentStatus&&N>k&&O<k)C[U="property(EventStatus)"]=1}else"Tasks"===t?(C.remBefore="",$("#Crm_Tasks_RECURRING").is(":checked")&&(C.remBefore=Crm.requestParam.remTime,C.exceptholiday=$("#Crm_Tasks_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked")),crmTasks.updateAllUpcomingRem&&(C.remOnAllUpcomingTasks=!0)):"Calls"===t&&isNewCallView&&"krp"==Calls.source&&(C.callCreateFrom=Calls.source);return"Consents"==t&&"edit"===window[t].currentStatus&&(C["property(parentId)"]=detailView.entityId,C["property(parent Module)"]=detailView.currentModule),"Potentials"==t&&C.hasOwnProperty("relmodule")&&"Products"==C.relmodule&&(C["property(productId)"]=C.entityid),$(".outlookqCreate").length&&(C.isfromOutlookRightPanel=!0),"Calls"!==t&&"Events"!==t&&"Tasks"!==t&&"Appointments"!==t||!Crm.isFromSalesInbox||(C.isFromSalesInbox=!0),o&&(C.skipBlockListValidation=!0),Crm.isHeadless||Crm.renderDVLyteFlow(t)||(detailView.isWFExecInKafka=!1,detailView.refreshInWms=!1),(new crmRequestPool).initiate({url:y,type:"POST",data:C,success:function(o){if("object"==typeof o&&"error"===o.status&&"converted_lead"===o.type)return commonUtils.showHideLoadingDiv(),void renderingUtils.showCustomAlert(o.errorMsg,o.title);if("object"==typeof o&&"LOOKUPFILTER_CRITERIA_NOTMATCHED"===o.STATUS){let e=$L("#Crm_"+t+"_"+o.INFO[0].COLUMNNAME),r="Users"===o.INFO[0].MODULE?I18n.getMsg("crm.field.label.user.lookup"):moduleRecordMapping[o.INFO[0].MODULE].singular_label;commonUtils.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",r),e,t),$L(window).scrollTo(e.height-$L("#createFixedButtonDiv").height()-100,{duration:500}),commonUtils.showHideLoadingDiv()}if("object"==typeof o&&void 0!==o.INFO&&"string"==typeof o.INFO&&o.INFO.startsWith("unauthorized resonse for fileupload field in cloudpicker")){var d=o.INFO.split("#");commonUtils.showErrorMsg(I18n.getMsg("crm.setup.attribution.NO_PERMISSION",$ESAPI.encoder().encodeForHTML(d[2])),$("#Crm_"+t+"_"+d[1]),t)}if("object"==typeof o&&(o.account_create_permission_failed||o.lookup_invalid_records_present||"INVALID_USER"===o.status||o.isSubordinateListingError||o.isLiteUserError)){var c=!1,m="#saveCallBtn",u="#closeCallBtn";if("INVALID_USER"===o.status)return Crm.enableButtons(t),void renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg(o.msg_key));if(o.isSubordinateListingError||o.isLiteUserError){if("Events"===t)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg(o.msg),ltPropType:"error"}});else{var v=o.fieldLabel,g="#cruxcomponent_Crm_"+t+"_"+v;commonUtils.showErrorMsg(I18n.getMsg(o.msg),$L(g),t)}"Calls"===t&&($L(m).prop("disabled",!1),$L(u).prop("disabled",!1)),c=!0}if(o.account_create_permission_failed&&(commonUtils.showErrorMsg(I18n.getMsg("crm.crud.account.create.no.permission",$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Accounts.plural_label)),$("#Crm_"+t+"_ACCOUNTID"),t),c=!0),o.lookup_invalid_records_present){if(null==o.subforms){if(o.columns)for(var f=o.columns.length,h=0;h<f;h++)commonUtils.showErrorMsg(I18n.getMsg("crm.crud.lookup.inaccessible.record"),$("#Crm_"+t+"_"+o.columns[h]),t);if(o.lookupModColumns)for(f=o.lookupModColumns.length,h=0;h<f;h++)commonUtils.showErrorMsg(I18n.getMsg("crm.crud.lookup.module.inaccessible"),$("#Crm_"+t+"_"+o.lookupModColumns[h]),t)}else for(tabId in o.subforms)for(var _=o.subforms[tabId],I=_.length,T=0;T<I;T++){var D=_[T];if(D.columns)for(f=D.columns.length,h=0;h<f;h++)commonUtils.showErrorMsg(I18n.getMsg("crm.crud.lookup.inaccessible.record"),$("#Crm_"+t+"_"+tabId+"_"+D.columns[h]+"_"+D.SNO),t);if(D.lookupModColumns)for(f=D.lookupModColumns.length,h=0;h<f;h++)commonUtils.showErrorMsg(I18n.getMsg("crm.crud.lookup.module.inaccessible"),$("#Crm_"+t+"_"+tabId+"_"+D.lookupModColumns[h]+"_"+D.SNO),t)}c=!0}if(c)return"Calls"===t&&($L(m).prop("disabled",!1),$L(u).prop("disabled",!1)),void Crm.enableButtons(t)}if("object"==typeof o&&"error"===o.status&&"invalid_twitter_user"===o.type)return commonUtils.showHideLoadingDiv(),commonUtils.showErrorMsg(I18n.getMsg("crm.tw.err.twHandleName.patterenCheck"),$("#Crm_"+t+"_TWITTER"),t),void Crm.enableButtons(t);if(Crm.appId&&"object"==typeof o&&!o.entityId){renderingUtils.showFreezeLayer();var R="/crm/v2/Appointments__s/"+Crm.appId;delete Crm.appId,delete Crm.calJSON,store.findAll("dummy",{},!1,!1,{url:R,method:"DELETE"})}Crm.requestApp2&&"object"==typeof o&&!o.entityId&&Lyte.registeredMixins["crm-services-appointments-old-mixin"].cancelJobSheetBTN(),"Appointments"===o.module&&$L("#jobsheetCreateDiv")&&Crm.resolveJobSheets&&$L("#saveAppointmentsBtn").attr("value")===I18n.getMsg("crm.appointments.add.job.sheet")&&o.entityId&&Crm.resolveJobSheets(o),commonUtils.showHideLoadingDiv();var b,A=$("#newRelatedListPopUpDiv");if("Tasks"===t&&Crm.userDetails.TaskPopup&&A&&""!==A.html()&&A.find("#rwb").length>0&&!(b=commonUtils.checkErrorMsg(o,void 0,y,void 0,t))){if($("#bulkTaskNewPopup").length>0&&(Lyte.Router.getRouteInstance().refresh().data={reloadAll:!0}),null!=Lyte.Router.getRouteInstance())if(void 0===Lyte.Router.getRouteInstance().parent.currentModel||"Activities"!==Lyte.Router.getRouteInstance().parent.currentModel.module_name&&"Tasks"!==Lyte.Router.getRouteInstance().parent.currentModel.module_name){if("kanban"===Lyte.Router.getRouteInstance().routeName||"list"===Lyte.Router.getRouteInstance().routeName)Lyte.Router.getRouteInstance().refresh().data={reloadAll:!0};else if("detail"===Lyte.Router.getRouteInstance().routeName){if("Activities"===Lyte.Router.getRouteInstance().parent.parent.currentModel.module_name||"Tasks"===Lyte.Router.getRouteInstance().parent.parent.currentModel.module_name){if($$rightPanel.detailRightPanel(!0,"info",!0),$("#followUpTask").length>0)$("#followup").html('<span class="green">'+I18n.getMsg("crm.add.task.success.mesg")+"</span>").css("background-color","var(--greenLightBg)").show()}else if(Crm.userDetails.isRelatedListLyteEnabled){var w,M=null;w=Crm.isActivitySplitDone?"Tasks":"Activities",store.peekAll("related_list").filter((e=>e.href&&e.href.includes(Lyte.Router.getRouteInstance().parent.parent.getDynamicParam())&&"TASKSPERSONALITY"===e.personality_name)).length>0&&"Tasks"===o.module&&Lyte.registeredMixins["crm-detailview-common-utils"]&&Lyte.registeredMixins["crm-detailview-common-utils"].loadRelatedRecords(Lyte.registeredMixins["crm-detailview-common-utils"],Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance().parent.getDynamicParam(),"Tasks",!0),Lyte.triggerEvent("relatedList",{module:w,refresh:!0})}else{M=null;M=Crm.isActivitySplitDone?Crm.getCrmBasePath()+"/NewRelatedList.do?pname=TASKSPERSONALITY;TASKSHISTORYPERSONALITY&action=getData&module="+detailView.currentModule+"&id="+detailView.entityId:Crm.getCrmBasePath()+"/NewRelatedList.do?pname=ACTIVITYPERSONALITY;ACTIVITYHISTORYPERSONALITY&action=getData&module="+detailView.currentModule+"&id="+detailView.entityId,(new crmRequestPool).initiate({url:M,type:"GET",success:function(e){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e,void 0,void 0,{action:"refresh"})},error:function(){commonUtils.showHideLoadingDiv(),renderingUtils.showCustomAlert(I18n.getMsg("crm.assignment.rule.internal.error"))}})}}}else Lyte.Router.getRouteInstance().refresh().data={reloadAll:!0};$(".commonRightPanel").length&&$$rightPanel.detailRightPanel(!0,"info",!0),A.empty(),crmui.hidePopup("newRelatedListPopUpDiv");var L="";o.entityId&&(L="<link-to lt-prop-target='_blank' lt-prop-route='crm.tab.module.entity' lt-prop-dp='[\""+o.module+'","'+o.entityId+"\"]'> "+I18n.getMsg("crm.invitation.view.details.label")+" </link-to>");var S=I18n.getMsg("crm.taskPopup.create.success.msg")+L;return crmui.showMsgBand("success",S,4e3),Crm.requestParam={},void($("#calendarCont").length>0&&calView&&calView.refresh())}if("undefined"!=typeof EmailComposeUtil&&EmailComposeUtil&&EmailComposeUtil.removeDraftDOMElement(),"Edit"===C.ActionType&&C.relatedRecords){changeOwner.relatedRecords[E]&&delete changeOwner.relatedRecords[E];var U={};U.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),crmSchedulerNotification.addOrUpdateStatus(U,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}if("emailFoundInBlockList"==o){var O=p?p.length:0;for(h=0;h<O;h++)$('input[id="'+p[h]+t+'Btn"],input[id="'+p[h]+t+'Btn_Bottom"]').prop("disabled",!1);r&&$("#ajax_load_tab").is(":visible")&&r(o,b);var N=Handlebars.templates.blockListWarning();return $(N).appendTo("body"),crmui.showPopup("blockListWarning"),void $("#blockListWarning .redbtn").on("click",(function(){crmui.hidePopup("blockListWarning"),$(N).remove(),Crm.saveEntity(e,t,r,a,i,n,!0)}))}if(moduleRecordMapping[t].total_count=void 0,commonUtils.showHideLoadingDiv(),!Crm.isHeadless&&multiLookupsView&&(multiLookupsView.multiLookups={},multiLookupsView.currentMultiLookup=null),s==Crm.getCrmBasePath()+"/ShowPopupInAllTabs.do"&&networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){ctiApiNotifier.ctiApiNotification(o)})),Crm.isRecordModified=!1,b=commonUtils.checkErrorMsg(o,void 0,y,void 0,t)){for(O=p?p.length:0,h=0;h<O;h++)$('input[id="'+p[h]+t+'Btn"],input[id="'+p[h]+t+'Btn_Bottom"]').prop("disabled",!1);(r&&"Calls"==t&&isNewCallView||r&&$("#ajax_load_tab").is(":visible"))&&r(o,b)}else{if(o||"Events"!==t||(o={}),o&&"Events"===t&&"object"!=typeof o){if(-1!=o.indexOf("}{"))o=o.replace("}{",",");else if(-1!=o.indexOf("crm.limit.reached"))return void crmui.showMsgBand("error",I18n.getMsg("crm.limit.reached"),4e3);o=JSON.parse(o)}if("Events"===t&&o.errMsg&&"NOT_AUTHORIZED"===o.errMsg){if(Crm.userDetails.MEETING_BRIDGE_ENABLED&&o.hostUserId&&o.hostUserId===Crm.userDetails.USER_ID){var k=$("#Events_fldRow_MEETING_PROVIDER"),P=$("#Crm_Events_MEETING_PROVIDER").val();k.after('<div id="provNotAuthorisedAlert" class="crm-small-font-size pT6 pB6 p10" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meetingprovider.authorise.alert1")+'<a href="javascript:void(0);" onclick="Events.callAuthorization(\''+Events.actualToolName[P]+"', 'text')\">"+I18n.getMsg("crm.meetingprovider.authorise.alert2")+"</a></span></div>")}else _cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[o.hostUserName,o.toolName,Crm.appName])}});return}if(Crm.isHeadless||Crm.renderDVLyteFlow(t)||!isWFKafkaUser()||(detailView.isWFExecInKafka=o.isWFExecInKafka,detailView.refreshInWms=o.callWMS,detailView.prevModule=o.module),window[t].entityId=void 0,"Consents"===t)return crmui.showMsgBand("success",I18n.getMsg("crm.updated"),2e3),DataPrivacy.refreshDataPrivacyView(),detailView.isDataPrivacyModified=!0,null!=detailView&&null!=detailView.currentModule&&crmTab.deleteFromCache(detailView.currentModule),void("canvas"===Lyte.Router.getRouteInstance().routeName&&Lyte.Router.getRouteInstance().refresh());var F="Activities"===Crm.activityGrp[t];if(F&&-1!=Activities.reminderList.indexOf(o.entityId)){var x=$("#notificationCount").text();$("#reminder_notification").text(x).show(),$(".remainder-notifi").slideUp(),$(".timericon").removeClass("footIconActive timericonAct"),$("#reminderContent").html(""),Activities.notifyCountToCrmPlusFrame(x),Activities.reminderCount=0,Activities.reminderList=""}var j=!("Events"===t&&"clone"!==window[t].currentStatus||"Calls"===t&&isNewCallView||"Appointments"===t&&"clone"!==window[t].currentStatus||Crm.requestApp2);if("calendar"==Events.createSource&&"on"==C["property(Recurring Activity)"]&&"edit"!==window[t].currentStatus&&(j=!0),F&&"edit"===window[t].currentStatus&&updateLeftPanel(C["property(id)"],t),r&&r(o,b),Crm.requestParam={},!i&&F&&"edit"===window[t].currentStatus){if(ActivityMoreInfoContent="",l)return void ZProjects.showProjectTaskSyncModel(!0);if("true"===$("#iskanbanview").val()&&$("#entitypopup").length)return window[t].currentStatus=void 0,loadActivityDetails(void 0,$("#recordid_"+o.entityId),{module:t},o.entityId,!0),void crmHistory.backOneLevel();if($("#rightPanel").length&&$("#detailCView").length)return(Y=Crm.newHistoryArr[crmHistory.getState().data.backOneLevel.historyIndex]).data.fromActivityListView&&delete Y.data.fromActivityListView,Y.data.fromSave=!0,Y.data.fromDetailView=!0,window[detailView.currentModule].currentStatus=void 0,void(Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:["Activities",o.entityId],queryParams:{sub_module:o.module}}).data=Y.data)}if(i)o.displayName&&$("#rItemDataSubDiv").find("#recentItemImg_"+o.entityId).find("div").text(o.displayName),C={},"Calls"===t&&(t="Tasks",C.entityid=o.entityId,C.relmodule="Calls",C.iskanbanview="true"),C.module=t,o.returnAnchor&&(C.entityid=o.entityid,C.entityname=o.entityname,C.fillUpModule=o.fillUpModule,C.listRelationId=o.listRelationId,C.fillUpFieldId=o.entityid,C.primid=o.primid,C.primmodule=o.primmodule,C.relmodule=o.relmodule,C.returnAnchor=o.returnAnchor.substring(1)),"create"==Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().refresh().data=C:"Tasks"==C.module?Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Activities"],queryParams:{sub_module:C.module}}).data=C:Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[o.module]}).data=C;else if(l)ZProjects.showProjectTaskSyncModel(!0);else if(-1!==y.indexOf("EditCommonModule")&&j)if("listView"==Crm.editReqFrom&&"Appointments"!==o.module){var V=$("#pfrom").length?$("#pfrom").val():"cv",B="";if("Tasks"!=o.module&&"Calls"!=o.module&&"Events"!=o.module||Crm.isActivitySplitDone)if("Tasks"!=o.module&&"Calls"!=o.module&&"Events"!=o.module||!Crm.isActivitySplitDone){(null!=store.peekRecord(moduleRecordMapping[o.module].id,o.entityId)?Promise.resolve(store.peekRecord(moduleRecordMapping[o.module].id,o.entityId)):store.findRecord(moduleRecordMapping[o.module].id,o.entityId,{approved:"both"})).then((function(e){e=null!=e.id?e:e[0],B=e&&Crm.getCanvasId(moduleRecordMapping[o.module].id,o.entityId)?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[o.module,o.entityId,Crm.getCanvasId(moduleRecordMapping[o.module].id,o.entityId)]}):Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[o.module,o.entityId]})}))}else{var H=Lyte.Router.getRouteInstance();B="edit"===H.routeName&&H.parent&&"Activities"===H.parent.parent.currentModel.module_name?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Activities",o.entityId],queryParams:{sub_module:o.module}}):Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[o.module,o.entityId]})}else B=Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Activities",o.entityId],queryParams:{sub_module:o.module}});(Y=Crm.newHistoryArr[crmHistory.getState().data.backOneLevel.historyIndex]).data&&(B.data={recordNum:Y.data.recordNum,pfrom:V,lookback:!0,step:"2"})}else crmHistory.backOneLevel();else if(C.returnAnchor){if("Campaigns"==o.module&&(o.newSurveyBuilder&&!0===o.newSurveyBuilder&&o.newSurveyBuilderUrl&&networkUtils.openUrl(o.newSurveyBuilderUrl,"blank"),o.hierarchy_create))return void Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:["Campaigns",o.child_campaign_id]});C.returnAnchor;C.returnAnchor&&(Crm.scrollToElem=C.returnAnchor),crmHistory.backOneLevel()}else if("homePage"===Crm.editReqFrom)renderingUtils.triggerEvent("click",$("#tab_Home"));else if("Events"==o.module&&j||"Tasks"==o.module||"Calls"==o.module&&(j||!isNewCallView)){store.modelFor(moduleRecordMapping.Activities.id)||store.registerModel(moduleRecordMapping.Activities.id,{},{extends:"entity"});var Y=0!==Object.keys(crmHistory.getState().data).length&&crmHistory.getState().data.hasOwnProperty("backOneLevel")?Crm.newHistoryArr[crmHistory.getState().data.backOneLevel.historyIndex]:void 0;if(!Crm.isActivitySplitDone||Y&&Y.dynamicParams.contains("Activities")?store.findRecord(moduleRecordMapping.Activities.id,o.entityId):store.findRecord(moduleRecordMapping[o.module].id,o.entityId),"calendar"==Events.createSource)calView.refresh();else{if(!Crm.isActivitySplitDone||Y&&Y.dynamicParams.contains("Activities"))B=Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:["Activities",o.entityId],queryParams:{sub_module:o.module}});else B=Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:[o.module,o.entityId]});B.data={pfrom:"cv"},Crm.trackSpotLightAction(o.module+" - Added")}}else if(j){"Campaigns"==o.module&&o.newSurveyBuilder&&!0===o.newSurveyBuilder&&o.newSurveyBuilderUrl&&networkUtils.openUrl(o.newSurveyBuilderUrl,"blank");B=Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:[t,o.entityId]});"Leads"!=o.module&&"Contacts"!=o.module&&"Potentials"!=o.module||Crm.trackSpotLightAction(o.module+" - Added")}if(o&&o.isInReview&&7==o.isInReview){var G=$L("crm-reviewprocess-reviewpop").e;0!=G.length&&G[0].remove(),Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:moduleRecordMapping&&moduleRecordMapping[t]?moduleRecordMapping[t].plural_label:t},"#tabLayer"),$L("#rpRecordInReview")[0].ltProp("show",!0)}if(o&&o.isInImageValidation&&13===o.isInImageValidation){var z=Crm.getVisionMyJobsDependency();Lyte.injectResources(z,void 0,(function(){!function(){var e=$("crm-zia-vision-error-popup");0!=e.length&&e.remove();Crm.client_tracking("Zia Vision Entity Validation Failure",{type:"image_processing"}),Lyte.Component.render("crm-zia-vision-error-popup",{moduleName:moduleRecordMapping&&moduleRecordMapping[t]?moduleRecordMapping[t].plural_label:t,action:"image_processing",isSaveAndNew:!0},"#tabLayer"),$L("#visionApproval_messageBox")[0].ltProp("show",!0)}()}))}crmTab.deleteFromCache(t),fileupload.removedAttachmentIds.length=0,fileupload.uploadedFileObject.length=0,fileupload.subformRemovedAttachmentIds.length=0,fileupload.subformRemovedAttachmentRowNumber.length=0;try{if("nba"===Calls.source&&"Calls"===o.module){var q=document.querySelector("crm-nba-detail-page");q&&q.component.updateSuggestionFollowUp()}}catch(e){murphy.error(e)}}},error:function(e){commonUtils.showHideLoadingDiv(),fileupload.removedAttachmentIds.length=0,fileupload.uploadedFileObject.length=0}}),!0}))},saveAndNewEntity:function(e,t){this.saveEntity(e,t,void 0,!1,!0)},enableButtons:function(e){commonUtils.showHideLoadingDiv(),$("[id='cancel"+e+"Btn']").prop("disabled",!1),$("[id='save"+e+"Btn']").prop("disabled",!1),$("[id='saveAndNew"+e+"Btn']").prop("disabled",!1)},getModuleRenderingValue:function(){for(var e=objectUtils.cloneObject(crmConstants.uiRenderingDetails.default),t=objectUtils.cloneObject(crmConstants.uiRenderingDetails[arguments[0]]),r=1;r<arguments.length;r++){if("*"==arguments[r]){for(var a in t)""==t[a]?delete e[a]:e[a]=t[a];return e}t=t&&t[arguments[r]]?t[arguments[r]]:void 0,e=e&&e[arguments[r]]?e[arguments[r]]:void 0}return t||e},openHelpUrl:function(e){var t=e.target,r=$(t).data("helpurl");window.open(r,"help","toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,resizeable=yes,menubar=no,width=1040,height=600")},copyField:function(e,t,r,a){for(var i=["STREET","CITY","STATE","CODE","COUNTRY","ZIP"],n=!1,o=0;o<i.length;o++){if((s=$("#Crm_"+t+"_"+r+i[o])).length>0)if(l=s.val().trim()){n=!0;break}}if(n)for(o=0;o<i.length;o++){var s;if((s=$("#Crm_"+t+"_"+r+i[o])).length>0){var l=s.val(),d=$("#Crm_"+t+"_"+a+i[o]);l&&d.length>0&&(d.val(l),renderingUtils.triggerEvent("change",d))}}},toggleReportingTo:function(e){var t=e.data,r=void 0!==Crm.moduleInfo.Accounts?Crm.moduleInfo.Accounts.translatedSingularLabel:"Account",a=I18n.getMsg("crm.contact.hierarchy.Specify_account_name",[I18n.getMsg(r)]),i=$("#Crm_Contacts_REPORTINGTOCONTACTID"),n=$("#Contacts_fldRow_REPORTINGTOCONTACTID"),o=$("#Crm_Contacts_REPORTINGTOCONTACTID"),s=$("#Crm_Contacts_ACCOUNTID").val();1!=o.prop("readOnly")&&("edit"==window.Contacts.currentStatus?s?(t&&t!=s&&i.val(""),n.attr("class","REPORTINGTOCONTACTID tabDivCreate"),o.prop("disabled",!1),o.autocomplete("enable"),n.removeAttr("onmouseenter"),n.removeAttr("onmouseleave")):(i.val(""),n.attr("class","REPORTINGTOCONTACTID tabDivCreate noclick"),o.prop("disabled",!0),o.autocomplete("disable"),n.attr("onmouseenter","renderingUtils.zctt.showtt('"+a+"');"),n.attr("onmouseleave","renderingUtils.zctt.hidett();")):s?(n.attr("class","REPORTINGTOCONTACTID tabDivCreate"),o.prop("disabled",!1),o.autocomplete("enable"),n.unbind("mouseover"),n.unbind("mouseout"),n.removeAttr("onmouseenter"),n.removeAttr("onmouseleave")):(i.val(""),n.attr("class","REPORTINGTOCONTACTID tabDivCreate noclick"),o.prop("disabled",!0),o.autocomplete("disable"),n.attr("onmouseenter","renderingUtils.zctt.showtt('"+a+"');"),n.attr("onmouseleave","renderingUtils.zctt.hidett();"))),$("[data-lookup-module='Accounts']").each((function(){$(this).val()&&n.attr("class","REPORTINGTOCONTACTID tabDivCreate")}))},calculateExpectedRevenue:function(e){void 0===e&&(e="");var t=0;s=0;var r,a=!1,i=$("#Crm_Potentials_"+e+"AMOUNT")[0],n=$("#Crm_Potentials_"+e+"EXPECTEDREVENUE")[0],o=$("#Crm_Potentials_"+e+"PROBABILITY")[0];if("view"==window.Potentials.currentStatus&&(n=$("#value_EXPECTEDREVENUE"),r=$("#headervalue_EXPECTEDREVENUE"),o=$("#value_PROBABILITY"),i=$("#value_AMOUNT"),a=!0),a){t="";i&&(t=i.data("value")?i.data("value")+"":""),""!==t&&(t=parseFloat(t));var s=""==o.text().trim()?"0":o.text().trim();s=parseFloat(s);var l=Crm.userDetails,d=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:l.BASE_CURRENCY?l.BASE_CURRENCY:l.defaultCurrencyISOCode,c=l.CURRENCY_DETAILS[d]?l.CURRENCY_DETAILS[d].symbol:l.defaultOrgCurrency;if(c=c||"",!isNaN(t)||isNaN(s)){v=0;i&&""===i.data("value")||""==o.text().trim()?(v="",n.text(""),r.text("")):0!=t&&0!=s?(v=roundValue((t*(s/100)).toString()),d?(v=currencyUtils.returnValueInDefaultCurrency(d,v),n.text(v),r.text(v)):(n.text(c+" "+v),r.text(c+" "+v))):(n.text(c+" 0"),r.text(c+" 0"))}}else{i&&!isNaN(i.value)&&(t=parseFloat(i.value)),i&&""!=i.value||(t="");var m=$("#Crm_Potentials_"+e+"STAGE")[0],u=m.options[m.options.selectedIndex].value;if(m&&""!=u&&"none"!==u){var p=m.options[m.options.selectedIndex].value;p.indexOf(":")>-1&&(p=p.split(":")[0]),s=parseFloat(p)}if(o&&""!=o.value&&(s=parseFloat(o.value)),n){var v=0;""===t?v="":0!=t&&0!=s&&(v=roundValue((t*(s/100)).toString())),n.value=v}}},setDependent:function(e,t,r,a,i){if(e&&!r&&(r=renderingUtils.getTargetElem(e)),!(r.getAttribute("data-subformsectionlabel")&&e&&null!==e.data&&e.data.isFormulaChange)){var n=$(document);if("Calls"==t&&isNewCallView){var o=$(r.closest("#preHTMLContainer_Calls"));if(o.length>0)n=o;else{var s=$(r.closest("#preHTMLContainer"));s.length>0&&(n=s)}}var l=$(r),d=l.data(),c=commonUtils.getValue(l),m=d.colname;"STAGE"===m&&(c=c.split(":")[1]);var u=$("#multipleFieldsEditPop"),p=u.is(":visible");if(l.attr("data-picklist-color")?l.attr("data-picklist-color"):l.data("colorcode_enabled"))if(t===crmModuleConstants.Events){var v=l.children("option:selected")[0],g=$(v).attr("data-colorcode"),f=$("#selectColorComponent"),C="edit"===Events.currentStatus||"create"===Events.currentStatus||"clone"===Events.currentStatus,h=$("#formRuleMandatoryFields").is(":visible");if(p)var y=u.find("#Events_fldRow_STARTDATETIME");var E=$(".activitesColor_dv");if(p?f=u.find("#selectColorComponent"):C&&(f=$("#preHTMLContainer_Events").find("#selectColorComponent")),g){f.remove(),C||p||E.remove();var _=$ESAPI.encoder().encodeForHTMLAttribute(g),I=$('<span class="dIB activitesColor" data-zcqa="selectColorComponent"  id="selectColorComponent" style="background:'+_+'"></span>');p?(I=$('<span class="dIB activitesColor" data-zcqa="selectColorComponent" id="selectColorComponent" style="background:'+_+';left:2px;top:14px;"></span>'),y.length>0&&(I=$('<span class="dIB activitesColor" data-zcqa="selectColorComponent" id="selectColorComponent" style="background:'+_+';left:-10px;top:10px;"></span>'))):h&&(I=$('<span class="dIB activitesColor" data-zcqa="selectColorComponent"  id="selectColorComponent" style="background:'+_+';left:-8px;top:6px;"></span>')),I.insertBefore(l);var T=l.parent().parent().parent();T.addClass("colorEnabledPicklist"),v.value&&"-None-"!==v.value?T.removeClass("colorEnabledPKNone"):T.addClass("colorEnabledPKNone")}else g||a||!f||(f.remove(),C||p||E.remove())}else updateColorCodeForSelObj(l);if("view"==a){if(!(m=d.parentcolname)){if(returnJson&&returnJson[t]&&returnJson[t].fieldDependency&&returnJson[t].fieldDependency.length)var D=JSON.parse(returnJson[t].fieldDependency);if(D&&D[d.colname])for(var R=Object.keys(D),b=R.length,A=0;A<b;A++){var w=Object.keys(D[R[A]]);if(w&&w.includes(d.colname)){m=R[A];break}}}if(!m)return;if(CFRExec&&CFRExec.setDependentCall&&CFRExec.relatedEntityMap[m])c=CFRExec.relatedEntityMap[m].defaultvalue;else if(i&&null!=i&&"STAGE"===m)c=Crm.getDealsStageValue($("#closedWon #Crm_Potentials_STAGE").val());else{var M=$("#mouseArea__"+m);if(!(M.length>0))return;c=M.data("params").defaultvalue}}if(t===crmModuleConstants.Cases&&"CASEORIGIN"===m){for(var L,S=d.picklistmap.length,U=0;U<S;U++)d.picklistmap[U].uservalue===c&&(L=d.picklistmap[U].systemvalue);var O=n.find("#Crm_"+t+"_EMAIL");O.data("mandate");"Email"===L?O.data("mandate","true"):O.data("defMandate")||O.data("mandate","false")}var N="PIPELINE"===r.getAttribute("data-colname")&&"Tasks"!=t&&"Calls"!=t&&"Events"!=t&&r.getAttribute("data-suffixindex")?t+"_"+r.getAttribute("data-suffixindex"):t;Crm.setDependentValuesByParentNameValue(N,m,c,n,a,r)}},setDependentValuesByParentNameValue:function(e,t,r,a,i,n){var o=Crm.fieldDependency[e];if(Crm.userDetails.isMapDepencySubFormSupported&&n&&n.getAttribute("data-subformsectionlabel")){var s=n.getAttribute("data-subformdisplaylabel");o=Crm.fieldDependency[s];var l=n.id.split("_").last()}var d,c=$("#multipleFieldsEditPop").is(":visible"),m=c?e.split("_")[0]:e,u=$("#saveCancelSpan").is(":visible");null==o&&c&&ProcessFlow.fieldDependency&&ProcessFlow.fieldDependency.forEach((function(e){void 0!==e[m]&&(o=e[m])})),null!=o&&0!=o.length||void 0!==Crm.jsonDepValues[e]&&(o=Crm.jsonDepValues[e]);var p=o&&"STAGE"==t&&o.Stage;if(p&&(t="Stage"),o&&o[t])for(var v=objectUtils.getKeys(o[t]),g=function(e){return-1!==k.indexOf(e.uservalue)},f=0;f<v.length;f++)if(d=v[f],o[t][d]){if(""==r&&(r="-None-"),"CALLTYPE"===d){b=o[t][d][r],a.find("input[name='Call Type'][value='"+b+"']").prop("checked",!0);continue}var C=a.find("#Crm_"+e+"_"+d);if(window[e]&&"setup"===window[e].currentStatus&&(C=$("#Crm_"+e+"_setup_"+d)),"SALUTATION"===d&&(C=a.find("#Crm_"+e+"_FIRSTNAME_"+d)),c&&0===C.length&&n&&void 0!==$L(n).data("entitymodule")&&(C=a.find("#Crm_"+$L(n).data("module")+"_"+$L(n).data("suffixindex")+"_"+d)),d.includes("LINKINGCF")&&Crm.userDetails.isMapDepencySubFormSupported&&s){var h=n.getAttribute("id").split("_")[2];h&&(C=$("#Crm_"+n.getAttribute("data-module")+"_"+h+"_"+d+"_"+l))}if(0===C.length)continue;if("true"==C.data("readonly"))continue;if(C.data("readonly")+""=="true"&&(C.data("uitype")+""=="2"||C.data("uitype")+""=="26")&&"FORECASTCATEGORY"!==d&&"FORECAST_CATEGORY"!==d){var y=C.val();""==y&&(y="-None-");var E=$(document.createElement("option"));E.attr({value:y,selected:"selected"});var _=C.data("uitype")+""===CrmField.UITYPES.STAGE.toString()&&y.indexOf(":")>-1?y.substr(y.indexOf(":")+1):y;E.text(_),$(C[0]).empty(),C.prepend(E),renderingUtils.triggerEvent("change",C);continue}var I=$([]),T=$(C[0]).val(),D=T.length;if(0!=i&&"create"!=i&&100===C.data("uitype")&&o[t][d][r])for(var R=0;R<D;R++)o[t][d][r].contains(T[R])||o[t][d][r].push(T[R]);"STAGE"===d&&T.indexOf(":")>-1&&(T=T.substring(T.indexOf(":")+1));var b,A=$(document.createElement("option"));$(C[0]).empty();var w="Potentials"==C.data("module")&&"STAGE"==C.data("colname")&&"none"==T,M={};("STAGE"===t||p&&"Stage"==t)&&r.indexOf(":")>-1&&(r=r.substring(r.indexOf(":")+1));for(var L=null,S=!1,U=null!=C.data().picklistmap?C.data().picklistmap.length:0,O=0;O<U;O++)if(C.data().picklistmap[O].uservalue===T){S=!0;break}"create"!=window[m].currentStatus&&(null==C.data("orphanValue")?null!=o[t][d][r]&&0!=i?o[t][d][r].contains(T)?C.data("isOrphanValue",!1):(L=T,C.data("orphanValue",T),C.data("isOrphanValue",!0)):C.data("isOrphanValue",!1):(L=C.data("orphanValue"),S&&C.data("isOrphanValue",!1)),(0!=C.data("isOrphanValueToAppend")||0==C.data("isOrphanValueToAppend")&&1==C.data("isOrphanValue")&&L==T)&&C.data("isOrphanValueToAppend",!0)),o[t][d][r]?(_=(b=o[t][d][r])[0],M="STAGE"===d?Crm.getStageVsDetails(C.data("values")):{}):_=(b=C.data("values"))[0];for(var N=C.data("oldValue")?(""+C.data("oldValue")).split(";"):[],k=[],P=!1,F=0;F<b.length;F++){var x=b[F],j=b[F];"object"==typeof x&&(j=x=void 0!==x.content&&""!==x.content?x.content:x.html),k[F]=M[x]?M[x]:x}var V=C.data().values.length,B=o[t][d][r];if(B&&C.data("isOrphanValueToAppend")&&""!=T&&!w&&"create"!=window[m].currentStatus){for(var H=B.length,Y=0;Y<H;Y++){if(T==B[Y]){P=!0;break}}if(!P)for(var G=1==C.data("isOrphanValueToAppend")&&1==C.data("isOrphanValue"),z=0;z<V;z++){var q=C.data().values[z];"object"==typeof q&&"default"in q&&q.default&&!G&&T==q.content&&(P=!0)}if(!(P||c&&"STAGE"===d&&"PIPELINE"===t)&&(k[F]=M[T]?M[T]:T,"STAGE"===d&&M[T])){var J=M[T].value.indexOf(":"),W=J>-1?M[T].value.substr(J+1):M[T].value;b.push(W)}}C.data("isOrphanValueToAppend")&&C.data("isOrphanValueToAppend",!1);A=$(document.createElement("option"));if(C.data("mapval",k),Crm.isStdOptionsField(d))for(var K=C.data("picklistmap").filter(g),Q=K.length,X=0;X<Q;X++){var Z=A.clone().attr("value",K[X].uservalue).attr("data-actual-value",K[X].systemvalue).prop("text",K[X].uservalue);N&&-1!==N.indexOf(K[X].uservalue)&&Z.prop("selected","selected"),I=I.add(Z)}else{C.removeClass("dataPopulated");for(X=0;X<N.length;X++)N[X]&&(N[X]=N[X].trim());var ee=!0;for(X=0;X<D;X++)if(!N.includes(T[X])){ee=!1;break}if(N&&(100!=C.data("uitype")&&T!==N[0]||100===C.data("uitype")&&!ee)&&(N=""),N){var te=N.length;for(X=0;X<te;X++){var re="STAGE"===d&&T&&u,ae=re?T:N[X];if("STAGE"===d&&(b.contains(ae)||ae.indexOf(":")>-1&&b.contains(ae.substring(ae.indexOf(":")+1)))){var ie=!re&&ae.indexOf(":")>-1?ae.substring(ae.indexOf(":")+1):ae,ne=M[ie]?M[ie].value:ae,oe=M[ie]?M[ie].html:ie,se=M[ie]?M[ie].fcCategory:void 0,le=k.length;for(O=0;O<le;O++)if(k[O].html===T){ne=k[O].value,oe=k[O].html,se=k[O].fcCategory;break}I=I.add(A.clone().attr("value",ne).prop("text",oe).attr({"data-fccategory":se,"data-fctype":M[ie].fctype}).prop("selected","selected"))}else if(2===C.data("uitype")&&k===T)N[X]="";else if(k.contains(N[X])){var de;if(C.data("colorcode_enabled")){var ce=C.data("picklistmap");de=getPickListColorCode(N[X],ce,ue)}I=de?I.add(A.clone().attr({value:N[X],"data-colorcode":de}).prop("text",N[X]).prop("selected","selected")):I.add(A.clone().attr("value",N[X]).prop("text",N[X]).prop("selected","selected"))}else N[X]=""}}if(""==N){var me=!1,ue="STAGE"===d&&k[0].html&&M[k[0].html],pe=(ne=ue?k[0].value:k[0],j=ue?k[0].html:k[0],[]);if(2===C.data("uitype")?pe.push(T):pe=T,ue){le=k.length;for(X=0;X<le;X++)if(k[X].html===T){if(ne=k[X].value,j=k[X].html,me=!0,C.data("colorcode_enabled")){void 0===(ce=C.data("picklistmap"))&&(ce=C.data("values"));ge=getPickListColorCode(j,ce,ue);A.attr("data-colorcode",ge)}I=I.add(A.clone().attr("value",ne).prop("text",j).prop("selected","selected").attr({"data-fccategory":ue?k[X].fcCategory:void 0,"data-fctype":k[X].fctype}));break}}else{var ve=pe.length;for(X=0;X<ve;X++)if(k.contains(pe[X])){if(ne=pe[X],j=pe[X],C.data("colorcode_enabled")){void 0===(ce=C.data("picklistmap"))&&(ce=C.data("values"));var ge=getPickListColorCode(j,ce,ue);A.attr("data-colorcode",ge)}I=1==C.data("readonly")&&100===C.data("uitype")?I.add(A.clone().attr("value",ne).prop("text",pe[X]).attr({"data-fccategory":ue?pe[X].fcCategory:void 0,"data-fctype":pe[X].fctype})):I.add(A.clone().attr("value",ne).prop("text",pe[X]).prop("selected","selected").attr({"data-fccategory":ue?pe[X].fcCategory:void 0,"data-fctype":pe[X].fctype})),me=!0}}if(!me){if(C.data("colorcode_enabled")){void 0===(ce=C.data("picklistmap"))&&(ce=C.data("values"));ge=getPickListColorCode(j,ce,ue);A.attr("data-colorcode",ge)}I=I.add(A.clone().attr("value",ne).prop("text",j).attr({"data-fccategory":ue?k[0].fcCategory:void 0,"data-fctype":k[0].fctype}))}}}if(C.append(I),C.removeClass("dataPopulated"),"create"===i){C.eq(0).trigger("change",i);continue}"undefined"!=typeof CFRExec&&!1!==CFRExec.setDependentCall||"edit"===i||renderingUtils.triggerEvent("change",C,"mapFieldDep")}},setContactValues:function(e,t,r,a,n,o,s){var l=document.querySelector(".fromLyteFields"),d=!1;if(l&&l.component){l.component.invAutoFill=!0,l.component.setData({newLookupcreated:!0,selectedSingleId:t});var c=l.querySelector("lyte-input");c&&(c.classList.add("yellowLyteInput"),d=!0,setTimeout((function(){c.classList.remove("yellowLyteInput")}),5e3)),l.classList.remove("fromLyteFields")}var m=$("#searchCreatePopup:visible").length,u=decodeURIComponent(r);jsonObj=JSON.parse(u),r=jsonObj.accountName+"",accId=jsonObj.accountId+"";var p,v,g=jsonObj.cntPhone+"",f=jsonObj.cntEmail+"",C=Crm.moduleName,h=$("#"+o);o?(p=h.find('input[name="fldName"]').val(),v=h.find('input[name="fldId"]').val()):(p=getObj("fldName").value,v=getObj("fldId").value),a&&(p=void 0===p?$('[name="fldName"]').val():p,v=void 0===v?$('[name="fldId"]').val():v);var y,E,_=$("[id='"+v+"']"),I=a?$(window.opener.$.find("[id='"+v+"']")).data().colname:$("[id='"+v+"']").data()?$("[id='"+v+"']").data().colname:void 0,T=v.replace(I,"ACCOUNTID"),D=getObj(T);if(D||(D=getObj(v.replace(I,"SEID"))),"Events"==C){var R=$("#addpartCheckbox"),b=$("#Events_fldRow_PARTICIPANTID").length>0;"null"!=f&&b?($("#addpartCheck").show(),$("#addpartCheckboxTitle").text(I18n.getMsg("crm.event.add.contact",[e])),R.attr("recId",t),R.attr("module","Contacts"),R.attr("onclick","Events.addRelatedParticipant($(this),'"+t+"','Contact')")):$("#addpartCheck").hide(),""==Events.relAccId&&(Events.relAccId=accId,Events.relAccName=r,Events.relAccMod=!0)}a?(y=window.opener.$("#"+p).length>0?window.opener.$("#"+p):window.opener.$('[name="'+p+'"]').val(),E=window.opener.$("#"+getObj("fldId").value).length>0?(window.opener.$("#"+getObj("fldId").value),window.opener.$("#"+getObj("fldId").value)):(window.opener.$('[id="'+getObj("fldId").value+'"]'),window.opener.$('[id="'+getObj("fldId").value+'"]')),y.val(e),y&&y.data()&&y.attr({"data-selectedlookupvalue":e,"data-selectedid":y.data().id})):(y=getObj(p),void 0!==(E=getObj(getObj("fldId").value))&&(E.value=t),$(y).val(e),$(y)&&$(y).data()&&$(y).attr({"data-selectedlookupvalue":e,"data-selectedid":$(y).data().id}));var A=Lyte.Router.getRouteInstance("crm.tab.module")?Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam():void 0;if(!!Lyte.Router.getRouteInstance("crm.settings.migration.index.map-fields")){for(var w=_.length,M=_.eq(0).data(),L=1;L<w;L++)Object.assign(_.eq(L).data(),M);var S,U=M.fieldMappingInfo.split("_"),O=parseInt(U[1]),N=U[2],k=$L("crm-dm-field-mapping")[O],P=11;k?(P=(S=(k=k.component).getData("fieldRows")[N]).getFileIndex(),e.toString().length?$L(".fieldListForModule:visible").find("lyte-tr")[N].className="migFieldReplaceAdded":$L(".fieldListForModule:visible").find("lyte-tr")[N].className=""):S=(k=$L("crm-dm-assign-default")[0]).getData("defaultRows")[N],S.setDefault({name:e,id:t}),k.setData("dirtyIndex",Object.assign({},{index:P}))}if(!$("#VRAjaxEdit").is(":visible")&&A)if("view"!==window[A].currentStatus||$("#multipleFieldsEditPop:visible").length>0)Crm.setRefFieldValues(y,t,n);else{var F=$(y);if(F.data()){var x=F.data().fieldid;n=n||JSON.parse($("#refFieldsInfo_"+t).val()),fieldOfLookup.getReferFromFieldIdVsColumnName(n,x,t)}}$("#social_create").length>0&&$(E).css("width","87%"),$(y).addClass("wsNowrap tOE"),$(y).attr("title",e);$(y).data("uitype");var j=$("#multipleFieldsEditPop").is(":visible"),V=$(y).data("dependfield");if(j&&V){var B=$(y).data("fieldid");ProcessFlow.getDuringTransitionDependentFields(t,B)}if(j&&crmTab.isLinkingModule(C)&&$(E).data("colname").startsWith("LINKINGMXN")&&ProcessFlow.checkDuplicateAssociation(E,t,$(E).attr("id").split("_")[2],C),$(E).data("id",t),$(y).data("id",t),"Crm_Events_CONTACTID"==v&&$("#addressOf_"+t).val()){var H=JSON.parse($("#addressOf_"+t).val());0!=Object.keys(H).length&&Events.setAddressInfo(H,"Contacts")}"Tasks"===C&&"Crm_Tasks_CONTACTID"===p&&crmBstTime.showSuggestionForCreateTask();try{var Y=$(".projectsTaskSyncBtn"),G=Lyte.Router.getRouteInstance(),z=G.parent.parent.getDynamicParam();if("Tasks"===C&&null!==z&&"Activities"===z){var q=G.parent.getDynamicParam();if(void 0!==q){var J=crmModuleConstants.Contacts,W=store.peekRecord("crm-project-sync-task",q);if(W)if("Potentials"!==W.module){var K="TASK_NOT_SYNCED"!==W.code;store.findAll("crm-project-sync-task",{task_id:q,entity_id:t,module:J,isTaskSync:K},!1).then((function(e){"TASK_NOT_SYNCED"===e.code&&null!==e.firstSelectedProject?Y.show():Y.hide(),detailView.setProjectTaskSyncResponse(q,e)}),(function(){Y.hide()}))}}}}catch(e){murphy.error(e)}if("Calls"===C&&"Crm_Calls_CONTACTID"===p&&crmBstTime.showSuggestionForCreateCall(),0==p.indexOf("CID")){var Q=getObj("accNameInConRoleAdd_"+r);Q&&(void 0!==r&&"null"!=r?($(Q).empty(),Q.innerHTML=r):$(Q).empty())}try{CRMLookupCallBack()}catch(e){}if(D&&crmTab.tabList.contains("Accounts")){var X=getObj(T+"_label_select");if(X&&"Accounts"===$(X).val())"null"===r&&(r="",accId=""),""===$(D).val()&&$(D).val(unescape(r)).data("id",accId);else if(null!=accId&&"null"!=accId&&""===$(D).val()){var Z=$(D).attr("id"),ee=$("#"+Z+"_label_select");ee[0]||(ee=$("#"+Z+"_select")),ee.val("Accounts").trigger("change.select2"),$(D).val(unescape(r)).data("id",accId),j&&$(D).data("dependfield")&&ProcessFlow.getDuringTransitionDependentFields(accId,$(D).data("fieldid"))}D&&$(D).data()&&$(D).attr({"data-selectedlookupvalue":$(D).val(),"data-selectedid":$(D).data().id})}if("Cases"===C&&"WHOID"===I&&("null"!==g&&$("#Crm_Cases_PHONE").length>0&&""===$("#Crm_Cases_PHONE").val()&&$("#Crm_Cases_PHONE").val(g),"null"!==f&&$("#Crm_Cases_EMAIL").length>0&&""===$("#Crm_Cases_EMAIL").val()&&$("#Crm_Cases_EMAIL").val(f)),"SalesOrders"==C||"Quotes"==C||"Invoices"==C||"PurchaseOrders"==C){var te=$("#"+v);if(null!=te){var re=te.data().colname;if(null!=re&&re.indexOf("CF")<0&&getObj("addressOf_"+t)){for(i in{BILLINGCOUNTRY:"MAILINGCOUNTRY",BILLINGCODE:"MAILINGZIP",BILLINGSTATE:"MAILINGSTATE",BILLINGCITY:"MAILINGCITY",BILLINGSTREET:"MAILINGSTREET",SHIPPINGCOUNTRY:"OTHERCOUNTRY",SHIPPINGSTREET:"OTHERSTREET",SHIPPINGSTATE:"OTHERSTATE",SHIPPINGCITY:"OTHERCITY",SHIPPINGCODE:"OTHERZIP"}){var ae="Crm_"+C+"_"+i;document.getElementById(ae)&&(document.getElementById(ae).value="")}var ie=getObj("addressOf_"+t).value;for(var ne in ie=JSON.parse(ie)){var oe=$("#Crm_"+C+"_"+ne)[0],se=$(oe);if(oe)if(null!=ie[ne])if("CURRENCYISOCODE"==ne){var le=se.val();if(null!=le){var de=ie[ne];Crm.updateCurrencyFields(C,de,le),se.data("oldValue",de);var ce=crmTemplate.getElemIdByColname(C,"EXCHANGERATE"),me=Crm.userDetails.CURRENCY_DETAILS[de].er;$("#"+ce).html(me)}if(se.hasClass("dataPopulated"))se.val(ie[ne]).trigger("change.select2");else{var ue=$([]);ue=$(document.createElement("option")).clone().attr("value",ie[ne]).prop("text",ie[ne]),se.html("").append(ue[0]),se.trigger("change.select2")}}else oe.value=ie[ne];else oe.value=""}}}}if("Appointments"===C&&"Crm_Appointments_SEID_RELATEDTO"===y.id){var pe=getObj("addressOf_"+t);ie=null;pe&&(ie=JSON.parse(pe.value)),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAddressValueForAppointment(ie)}$("#topBandPopup").is(":visible")&&hideAnimatePopup("topBandPopup"),$("#lookupPopup").is(":visible")&&(hideAnimatePopup("lookupPopup",!0),m&&($("#freezeBackGround").css("z-index","30"),renderingUtils.showFreezeLayer())),a||(d||$(y).effect("highlight",{},1e3),$(y).trigger("create_edit_clone_DomChange",this),$(y).focus()),a&&y&&y.data()?y.attr({"data-selectedlookupvalue":e,"data-selectedid":y.data().id}):$(y)&&$(y).data()&&$(y).attr({"data-selectedlookupvalue":e,"data-selectedid":$(y).data().id}),s&&document.querySelector("crm-appointment-preference").component.executeMethod("closeEntityLookup",void 0,e,t)},setRefFieldValues:function(e,t,r,a,i){var n=!(!e||void 0===e.data||void 0===e.data.dataUitype)&&"221"===e.data.dataUitype,o=!!$(e).data("subformsectionlabel");if(o||!0===Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE)try{r=r||JSON.parse($("#refFieldsInfo_"+t).val());var s=n?e.$node.dataset.subformdisplaylabel:$(e).data("subformdisplaylabel"),l=$("#createEntityForm");if(r){var d;if(a)d=void 0===(d=l.find(e).attr("data-fieldid"))?e:d;else d=void 0===(d=$(e).attr("data-fieldid"))?e.data&&e.data.fieldIdFol:d;if(d){var c,m=o&&n?$(e.$node).closest("tr"):$(e).closest("tr"),u=m.data("data-rowid");if($(productDetails)&&$(productDetails.sfFldIdSuffix)){var p=$(productDetails.sfFldIdSuffix+"LINETAX_"+u),v=p.data("refered_from_fieldid");c=v?v.substr(v.lastIndexOf("_")+1):void 0}var g=Object.keys(r),f=new Map,C=[];Crm.isLineItemSubFormModule(s)&&g&&c&&g.indexOf(c)<0&&(r[c]="",g.push(c));for(var h=g.length,y=0;y<h;y++)if(!o){var E,_=g[y],I="[data-refered_from_fieldid=lookup_"+d+"_"+_+"]";if((E=l.length?e.form&&"createEntityNewForm"===e.form.name?$(I):l.find(I):$(I)).length>0&&221==(E.data("uitype")||E.data("datauitype"))){var T=r[_];if(T&&T.ID)store.peekRecord("user",T.ID)||(C.push(T.ID),f.set(_,E.eq(0)))}}f.size>0?store.findAll("user",{ids:C.join(",")},!0).then((function(){Crm.fieldOfLookuppopulate(e,r,i,o,l,d,m,u,g,p,t)})):Crm.fieldOfLookuppopulate(e,r,i,o,l,d,m,u,g,p,t)}}"PRODUCTID"===$(e).data("colname")&&Crm.isLineItemSubFormModule(s)&&$(e).closest("div").find(".prdError").remove()}catch(e){murphy.error(e)}},fieldOfLookuppopulate:function(e,t,r,a,i,n,o,s,l,d,c){for(var m=l.length,u=new Map,p="",v=0;v<m;v++){var g,f=l[v],C="[data-refered_from_fieldid=lookup_"+n+"_"+f+"]";if((g=a?o.find(C):i.length?e.form&&"createEntityNewForm"===e.form.name?$(C):i.find(C):$(C)).length>0){var h=g.eq(0);if(!Crm.userDetails.FIELD_OF_LOOKUP_IN_SUBFORM&&!(["LISTPRICE","ITEMDESCRIPTION","LINETAX"].indexOf(h.data("colname"))>-1&&Crm.isLineItemSubFormModule(h.data("subformdisplaylabel")))&&h.data("readonly")&&!0===h.data("readonly")&&a)continue;if(a||14!==h.data("uitype")&&24!==h.data("uitype")&&202!==h.data("uitype"))if(333===h.data("uitype")||786===h.data("uitype"))if(a&&333===h.data("uitype")){var y=t[f],E=y.indexOf(":"),_=y.substring(0,E-3),I=y.substring(E-2,y.length);$(g[1]).val(I),renderingUtils.triggerEvent("change",$(h).val(_))}else if(""!=t[f]){ie="lookuppopup"===r?(ie=(ie=t[f]).split(":"))[0].slice(0,ie[0].lastIndexOf(" ")):(ie=Utils.getDateInUserDatePattern(new Date(t[f])))||Utils.getDateInUserDatePattern(CrmDateUtils.getDateObjectFromString(t[f]));var T,D=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(D=!0),""!=t[f]&&(T=isNaN(new Date(t[f]).valueOf())?CrmDateUtils.getDateObjectFromString(t[f]):new Date(t[f]));var R="";if(D){var b=Utils.formatTimeVal(T.getHours()),A=Utils.formatTimeVal(T.getMinutes());R=b+":"+A}else t[f]=Utils.convertTo12HoursFormatTimeObj(T),R=t[f].hrs+":"+t[f].mins+" "+I18n.getMsg(t[f].meridiem.toUpperCase());if(i.length){var w=g.eq(0).attr("id").match(/\(([^)]+)\)/)[1];if(D)$('input[name="property('+w+'hour)"]').val(b),$('input[name="property('+w+'minute)"]').val(A),g.eq(1).val(b+":"+A);else{$('input[name="property('+w+'hour)"]').val(t[f].hrs),$('input[name="property('+w+'minute)"]').val(t[f].mins),$('input[name="property('+w+'ampm)"]').val(t[f].meridiem.toUpperCase());var M=$('span[id="'+w+'_ampmSpan"]');M.attr("ampm",t[f].meridiem.toUpperCase()),M.text(I18n.getMsg(t[f].meridiem.toUpperCase())),g.eq(1).val(t[f].hrs+":"+t[f].mins)}g.eq(1).attr("time",R),renderingUtils.triggerEvent("change",g.eq(1))}else g.eq(1).val(R);renderingUtils.triggerEvent("change",h.val(ie))}else renderingUtils.triggerEvent("change",h.val(""));else for(var L=0;L<g.length;L++){if((h=g.eq(L)).is("input:checkbox")){"true"==t[f]||1==t[f]?h.prop("checked",!0):h.prop("checked",!1),renderingUtils.triggerEvent("change",h)}else{var S=h.data("uitype")||h.data("datauitype"),U=t[f];if(221==S&&U&&U.ID){var O=store.peekRecord("user",U.ID);O&&"deleted"===O.status&&(U={})}if(2==S||26==S||39==S){var N=h.data("values");N&&!N.contains(U)&&N.push(U),h.find('[value="'+U+'"]').length<1&&h.append('<option selected="selected" value="'+U+'">'+U+"</option>")}else if(100==S)for(var k=(U=U.split(";")).length,P=0;P<k;P++){h.find('[value="'+U[P]+'"]').length<1&&h.append('<option selected="selected" value="'+U[P]+'">'+U[P]+"</option>")}else if(52===S&&U)U=Search.reverseFormatNumber(U);else if(3==S){var F=h.data().maxlength;U=U.substring(0,F)}else if(250===S)p+=f+",",u.set(f,h);else if("object"==typeof U)if(4==S||5==S||6==S||7==S||9==S||10==S||12==S||13==S||15==S||133==S||221==S){var x=U.ID;if(U.ID||(x=""),h.data("id",x),$("#createEntityForm").length>0){h.parent().find("input[type=hidden]").attr("value",x)}U=U.Name}else U=U.Name;else if(36==S||38==S||34==S||32==S||143==S||144==S||145==S){var j=h.data().decimalLength,V=String(U);36==S&&-1!=V.indexOf(",")&&(U=V.replace(/,/g,"")),null==j&&(j=9),38!=S&&32!=S||(V=Search.reverseFormatNumber(V)),U=V.replace(/,/g,""),U=parseFloat(parseFloat(U).toFixed(j)),isNaN(U)&&(U="")}if(47===S){var B=JSON.parse($(e).attr("prdDetails"));if(B&&B.Taxable&&(productDetails.autoPopulateTax||!Crm.userDetails.TAX_MIGRATION_COMPLETED)){var H=$(productDetails.sfFldIdSuffix+"TAX_"+s),Y=parseFloat($(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+s).val());Y=isNaN(Y)?0:Y;for(var G=B.Tax?B.Tax.split(";"):[],z="",q=0,J=0,W=G.length,K=0;K<W;K++){var Q=G[K],X=productDetails.taxIdVsName[Q],Z=void 0!==X&&X.length>0?X[1]:Q,ee=JSON.parse(productDetails.newAllTaxes)[Z],te=parseFloat(ee[1]),re=Y*te/100;q+=re,J+=te,z+=Z+"==="+te+":::"+re+";;;"}U=z,H.attr("percentage",J),H.val(q)}else{d.val(""),(H=$(productDetails.sfFldIdSuffix+"TAX_"+s)).attr("percentage",0)}}}if(!h.is("input:checkbox"))if(3!==S&&110!==S||"CRUX-TEXT-AREA-COMPONENT"!==h[0].tagName)if(221===S){var ae={};ae.id=x,ae.full_name=U,h[0].component.setData("userName",U),h[0].component.setData("dataId",x),h[0].component.setData("userRecord",ae)}else 250!==S&&renderingUtils.triggerEvent("change",h.val(U));else h[0].component.setData("cxPropValue",U);33==S&&Crm.userDetails.isPhoneNoNewView&&h[0].dispatchEvent(new Event("paste"))}else if(""!=t[f]){var ie="lookuppopup"===r?t[f]:Utils.getDateInUserDatePattern(new Date(t[f]));renderingUtils.triggerEvent("change",h.val(ie))}else renderingUtils.triggerEvent("change",h.val(""))}}if(u.size>0){commonUtils.showHideLoadingDiv(!0);var ne=$(e).attr("data-lookup-module");store.findAll("field",{module:moduleApiMapping[ne]}).then((function(e){for(var t=(p=p.slice(0,-1)).split(","),r=t.length,a=0;a<r;a++){var i=e.filter((e=>e.id===t[a]))[0].api_name;p=p.replace(t[a],i),u.set(i,u.get(t[a])),u.delete(t[a])}store.findAll("dummy",null,!1,!1,{url:"crm/v6/"+moduleApiMapping[ne]+"/"+c+"/actions/fetch_full_data?fields="+p}).then((function(e){for(var[t,r]of u.entries())r[0].component.setData("cxPropValue",e.data[0][t]),renderingUtils.triggerEvent("change",r.val(e.data[0][t]));commonUtils.showHideLoadingDiv(!1)}))}))}},setValue:function(e,t,r,a,i,n,o,s,l,d,c,m,u,p,v,g){var f=document.querySelector(".fromLyteFields"),C=!1;if(f&&f.component){f.component.invAutoFill=!0,f.component.setData({newLookupcreated:!0,selectedSingleId:r});var h=f.querySelector("lyte-input");h&&(h.classList.add("yellowLyteInput"),C=!0,setTimeout((function(){h.classList.remove("yellowLyteInput")}),5e3)),f.classList.remove("fromLyteFields")}var y=document.querySelector(".frominvSubPBLyteFields");y&&y.component&&y.component.getMethods("onInventoryPriceBookSel")&&(y.component.executeMethod("onInventoryPriceBookSel",{priceBookRecid:r,priceBookName:n,pricingDetails:v,listPriceVal:t}),C=!0);var E,_,I,T,D,R=!1,b=$("#searchCreatePopup:visible").length;s?(E=window.opener.Crm.moduleName,_=window.opener[E].currentStatus):Crm.moduleName?(E=Crm.moduleName,_=window[E]?window[E].currentStatus:void 0):(E=e,_=window[E]?window[E].currentStatus:void 0);var A=$("#"+m);"Services"===e&&r&&networkUtils.lyteInitiateRequest("/crm/v2.1/Services__s/"+r,"GET").then((function(e){e&&e.data&&e.data.length&&(crmCommonModule.serviceModuleLooked=!0,Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentRelatedDataOldFlow(e.data[0]),new Promise((function(t){if(e.data[0].$has_more.Members){store.model[moduleRecordMapping.Services.id]||store.registerModel(moduleRecordMapping.Services.id,{},{extends:"entity"});var a=Lyte.registeredMixins["crm-services-mixin"].getRelationIdofMembersField(),i={};i.relatedId=r,i.relationId=a,store.findAll(moduleRecordMapping.Services.id,i,void 0,!1).then((function(e){t(e[moduleRecordMapping.Services.id])}))}else t()})).then((function(e){Lyte.registeredMixins["crm-services-appointments-old-mixin"].setMemberDataForAppointment(e),setTimeout((function(){var e=document.getElementById("Crm_Appointments_SMOWNERID");if(e&&e.hasChildNodes()){e.component.setData("dataId",""),e.component.setData("userRecord",{});var t=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");Lyte.registeredMixins["crm-appointments-mixin"].checkServiceAvailability(t)}}),200)})))})),m?(I=A.find('input[name="searchModule"]').val(),T=A.find('input[name="fldName"]').val(),D=A.find('input[name="fldId"]').val()):(I=getObj("searchModule").value,T=getObj("fldName").value,D=getObj("fldId").value);var w=$("[id='"+D+"']"),M=!!(w[0]&&w.data("colname")&&w.data("colname").indexOf("CF")>0);if(!!Lyte.Router.getRouteInstance("crm.settings.migration.index.map-fields")){for(var L=w.length,S=w.eq(0).data(),U=1;U<L;U++)Object.assign(w.eq(U).data(),S);var O,N=S.fieldMappingInfo.split("_"),k=parseInt(N[1]),P=N[2],F=$L("crm-dm-field-mapping")[k],x=11;F?(x=(O=(F=F.component).getData("fieldRows")[P]).getFileIndex(),T.toString().length?$L(".fieldListForModule:visible").find("lyte-tr")[P].className="migFieldReplaceAdded":$L(".fieldListForModule:visible").find("lyte-tr")[P].className=""):O=(F=$L("crm-dm-assign-default")[0]).getData("defaultRows")[P],O.setDefault({name:t,id:r}),F.setData("dirtyIndex",Object.assign({},{index:x}))}if($("#multipleFieldsEditPop").is(":visible")&&crmTab.isLinkingModule(E)&&w.data("colname").startsWith("LINKINGMXN")&&ProcessFlow.checkDuplicateAssociation(w[0],r,fldId.split("_")[2],E),("SalesOrders"==E&&"Quotes"==I&&!M||"Invoices"==E&&"SalesOrders"==I&&!M||"Invoices"==E&&"Quotes"==I&&!M)&&"view"!=_)Crm.fillFormObject(encodeURIComponent(t),r,I,null,E,void 0,$("#layoutDetails").val());else{if(s){var j=window.opener.$("#"+fldName).length>0?window.opener.$("#"+fldName):window.opener.$('[name="'+fldName+'"]').val(),V=window.opener.$("#"+D).length>0?(window.opener.$("#"+D),window.opener.$("#"+D)):(window.opener.$('[id="'+D+'"]'),window.opener.$('[id="'+D+'"]'));j.val(t).change(),T=$(j).val(),j&&j.data()&&j.attr({"data-selectedlookupvalue":t,"data-selectedid":j.data().id})}else j=getObj(T),V=getObj(D),$(j).val(t),$(j)&&$(j).data()&&$(j).attr({"data-selectedlookupvalue":t,"data-selectedid":$(j).data().id});var B=T===D,H=$(j);H.addClass("wsNowrap tOE");var Y=$(j).data("subformdisplaylabel"),G=Crm.isLineItemSubFormModule(Y),z=$(V),q=z.data("dependfield"),J=null;q&&(J=z.data("id")),z.data("id",r),B||z.val(r),G&&"PRODUCTID"===$(j).data("colname")&&void 0!==p&&(H.removeClass("wsNowrap tOE"),$(j).attr("prdDetails",JSON.stringify(p)),p.Product_Code&&""!==p.Product_Code&&$(j).data("lineitemprodcode")?$(j).val(t.replace(/(\r\n|\n|\r)/gm," ")+" ("+p.Product_Code+")"):$(j).val(t.replace(/(\r\n|\n|\r)/gm," ")),H.css({height:"18px"}),H.css({height:H[0].scrollHeight}));var W=Lyte.Router.getRouteInstance("crm.tab.module")?Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam():void 0;if(!$("#VRAjaxEdit").is(":visible")||!W||"view"!==window[W].currentStatus||$("#multipleFieldsEditPop:visible").length>0||Crm.VR){if(!$("#VRAjaxEdit").is(":visible")&&W)if("view"!==window[W].currentStatus||$("#multipleFieldsEditPop:visible").length>0)Crm.setRefFieldValues(j,r,c);else if(H.data()){var K=H.data().fieldid;c=c||JSON.parse($("#refFieldsInfo_"+r).val()),fieldOfLookup.getReferFromFieldIdVsColumnName(c,K,r)}}else Crm.VR={},Crm.VR.ajaxEditFieldLabel=CFRExec.ajaxEditHaltedFieldColName,Crm.VR.entityDetails={},Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson,Crm.VR.entityID=r;T.indexOf("txtListPrice")>-1&&$(V).val(r);try{CRMLookupCallBack()}catch(e){}if("events"==l){"Accounts"==e&&($(j).attr("recId",r),Events.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.invRemoveJson=Events.invJsonCreate,$("#Crm_Events_PARTICIPANTID").text("None"),Events.selInviteesCnt=0,Events.relAccId!=r&&(Events.relAccMod=!0,Events.relAccName=t),Events.relAccId=r);var Q=JSON.parse($("#addressOf_"+r).val());0!=Object.keys(Q).length&&Events.setAddressInfo(Q,I)}if("Events"==E&&"Leads"===I){var X=$("#Events_fldRow_PARTICIPANTID").length>0;if(d&&"null"!=d&&X){var Z=$("#addpartCheckbox");$("#addpartCheck").show(),$("#addpartCheckboxTitle").text(I18n.getMsg("crm.event.add.contact",[t])),Z.attr("recId",r),Z.attr("module",I),Z.attr("onclick","Events.addRelatedParticipant($(this),'"+r+"','Lead')")}else $("#addpartCheck").hide()}if("Appointments"===E&&"Crm_Appointments_SEID_RELATEDTO"===j.id){var ee=getObj("addressOf_"+r),te=null;ee&&(te=JSON.parse(ee.value)),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAddressValueForAppointment(te)}if("Potentials"===I&&"rLEmail"===$('[name="source"]').val()&&("Contacts"===E&&"canvas"!=Lyte.Router.getRouteInstance().routeName&&(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("Deals"):reloadPersonality("potentialspersonality")),EntityEmail.changeDealForEmail("associateDeal",D,r,t)),"Tasks"!==E||"Leads"!==I&&"Contacts"!==I||"Crm_Tasks_CONTACTID"!==T||crmBstTime.showSuggestionForCreateTask(),"Calls"!==E||"Leads"!==I&&"Contacts"!==I||"Crm_Calls_CONTACTID"!==T||crmBstTime.showSuggestionForCreateCall(),"Products"===I&&T.indexOf("CF")<0&&!f){if(Crm.isInventoryModule(E))if(G)Crm.handleProductLineItemUpdate($(j));else{var re=(ae=/(.*?)(\d+)/g).exec(T)[2];Crm.userDetails.isLookupAdvancedSearchEnabled?("null"!=i&&(getObj("hdnQtyStock"+re).value=i),getObj("hdnUnitPrice"+re).value=a,getObj("txtListPrice"+re).value=a):("null"!=i&&(getObj("Crm_"+E+"_hdnQtyStock"+re).value=i),getObj("Crm_"+E+"_hdnUnitPrice"+re).value=a,getObj("Crm_"+E+"_txtListPrice"+re).value=a),$("#hdnUnitPrice"+re).val(a),$("#txtListPrice"+re).val(a)}else if(Crm.userDetails.isLookupAdvancedSearchEnabled){var ae;(re=(ae=/(.*?)(\d+)/g).exec(T)?ae.exec(T)[2]:"")&&("null"!=i&&$("#hdnQtyStock"+re).val(i),$("#hdnUnitPrice"+re).val(a),$("#txtListPrice"+re).val(a))}}else if("PriceBooks"==I)if("null"!=t&&null!=t&&T.indexOf("txtListPrice")>-1){j.value=parseFloat(t).toFixed(productDetails.roundOff);var ie=$(j).attr("id");ie=ie.split("txtListPrice")[1],productDetails.discStatus="fromPb",$("#txtQty"+ie).trigger("blur"),$("#hdnPriceBookName"+ie).val(n),$("#hdnPriceBookIdClone"+ie).val(r);var ne=$("#frmBook").find(".crm-font-regular"),oe=ne.text();oe.indexOf("-")>0&&(oe=oe.substring(0,oe.lastIndexOf("-"))),ne.text(oe),ne.append(" - "+n)}else if("null"!==t&&null!==t&&G&&T.indexOf("_BOOKID_")>-1){var se=$(j).closest("tr").data("data-rowid"),le=$(productDetails.sfFldIdSuffix+"LISTPRICE_"+se);$(j).val(n),le.val(productDetails.getRoundOff(le,parseFloat(t))).trigger("change"),productDetails.discStatus="fromPb",R=!0,window[productDetails.module].formulaObj.handlePriceBookLineItemUpdate(se,v,!0)}else j.value=n;else if("Accounts"==I){var de;if((de=s?$(window.opener.$.find("#"+D)):$("#"+D)).length&&"PARENTACCOUNTID"!==de.data().colname&&!de.data().customfield&&!f){var ce=de.data().colname;if(null!=ce&&ce.indexOf("CF")<0&&getObj("addressOf_"+r)){te=getObj("addressOf_"+r).value;Crm.fillAddressinfo(E,te)}else null!=o&&Crm.fillAddressinfo(E,o)}try{if("Tasks"==E&&"Crm_Tasks_SEID"==T&&getObj("id")&&"Contacts"!==I){var me=void 0!==detailView.entityId?detailView.entityId:window.Tasks.entityId;Crm.isHeadless||void 0===me||isProjectAvailable(void 0,I,r,encodeURIComponent(t),me)}}catch(e){murphy.error(e)}try{var ue=$(".projectsTaskSyncBtn"),pe=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();if("Tasks"===E&&null!==pe&&"Activities"===pe){var ve=Lyte.Router.getRouteInstance().parent.getDynamicParam();if(void 0!==ve){var ge=I,fe=r,Ce=store.peekRecord("crm-project-sync-task",ve);if(Ce.module!==crmModuleConstants.Potentials){var he="TASK_NOT_SYNCED"!==Ce.code,ye=$("#Crm_Tasks_CONTACTID").val();$("#Crm_Tasks_CONTACTID_WhoId_select option:selected").val()===crmModuleConstants.Contacts&&""===ye&&store.findAll("crm-project-sync-task",{task_id:ve,entity_id:fe,module:ge,isTaskSync:he},!1).then((function(e){"TASK_NOT_SYNCED"===e.code&&null!==e.firstSelectedProject?ue.show():ue.hide(),detailView.setProjectTaskSyncResponse(ve,e)}),(function(){ue.hide()}))}}}}catch(e){murphy.error(e)}}if("Campaigns"==e&&u){var Ee=document.querySelector("crm-add-to-campaign-popup");if(Ee){u=parseInt(u);var _e=Ee.getData("showPopup"),Ie=$("#AddToCampaign_CampaignType");if(_e&&Ie&&Ie.length>0){var Te={campaignType:u,selectedCampaign:r,buttonLabel:I18n.getMsg("crm.button.save")};5===u?Te.buttonLabel=I18n.getMsg("crm.survey.label.sendsurvey"):4===u&&(Te.buttonLabel=I18n.getMsg("crm.label.next")),Ee.setData(Te)}}}if("Campaigns"===e&&crmTemplate.fromAddToCampaignTool&&(Lyte.Router.transitionTo({route:"crm.tab.module.actions.add-to-campaigns",dynamicParams:[crmListView.getObject().module],queryParams:{"entity-id":r}}),delete crmTemplate.fromAddToCampaignTool),q&&J!=r){var De=z.data("fieldid");ProcessFlow.getDuringTransitionDependentFields(r,De)}if($("#topBandPopup").is(":visible")){hideAnimatePopup("topBandPopup",!0);var Re=$("#sIlookupFieldAddNew");1==Re.is(":visible")&&(Re.hide(),$(".clearAccountName").remove())}$("#lookupPopup").is(":visible")&&(hideAnimatePopup("lookupPopup",!0),b&&($("#freezeBackGround").css("z-index","30"),renderingUtils.showFreezeLayer())),s||R||(C||$(j).effect("highlight",{},1e3),!B&&H&&H.data("id",r))}s&&j&&j.data()?j.attr({"data-selectedlookupvalue":j.val(),"data-selectedid":j.data().id}):$(j)&&$(j).data()&&$(j).attr({"data-selectedlookupvalue":$(j).val(),"data-selectedid":$(j).data().id}),g&&document.querySelector("crm-appointment-preference").component.executeMethod("closeEntityLookup",e,j.value,r),s||$(j).trigger("create_edit_clone_DomChange",this),$(j).focus()},fillAddressinfo:function(e,t){e=e||(crmCommonModule.createEditJson?crmCommonModule.createEditJson.module:"");var r={BILLINGCOUNTRY:"MAILINGCOUNTRY",BILLINGCODE:"MAILINGZIP",BILLINGSTATE:"MAILINGSTATE",BILLINGCITY:"MAILINGCITY",BILLINGSTREET:"MAILINGSTREET"},a={SHIPPINGCOUNTRY:"OTHERCOUNTRY",SHIPPINGSTREET:"OTHERSTREET",SHIPPINGSTATE:"OTHERSTATE",SHIPPINGCITY:"OTHERCITY",SHIPPINGCODE:"OTHERZIP"},n=!1,o=!1;for(i in r){if((p=$("#Crm_"+e+"_"+i)[0])||(p=$("#Crm_"+e+"_"+r[i])[0]),p&&p.value.trim().length>0){n=!0;break}}for(i in a){if((p=$("#Crm_"+e+"_"+i)[0])||(p=$("#Crm_"+e+"_"+a[i])[0]),p&&p.value.trim().length>0){o=!0;break}}var s=window[e]?window[e].currentStatus:void 0;if(e&&t){if(Crm.isInventoryModule(e))for(i in{BILLINGCOUNTRY:"MAILINGCOUNTRY",BILLINGCODE:"MAILINGZIP",BILLINGSTATE:"MAILINGSTATE",BILLINGCITY:"MAILINGCITY",BILLINGSTREET:"MAILINGSTREET",SHIPPINGCOUNTRY:"OTHERCOUNTRY",SHIPPINGSTREET:"OTHERSTREET",SHIPPINGSTATE:"OTHERSTATE",SHIPPINGCITY:"OTHERCITY",SHIPPINGCODE:"OTHERZIP"}){var l="Crm_"+e+"_"+i;document.getElementById(l)&&(document.getElementById(l).value="")}for(var d in"string"==typeof t&&(t=JSON.parse(t)),t)if("Contacts"!=e&&null!=d&&null!=t[d]){if("CURRENCYISOCODE"==d&&"edit"!=s){var c=$("#Crm_"+e+"_"+d),m=c.val();if(null!=m){var u=t[d];window.Crm.updateCurrencyFields(e,u,m),c.data("oldValue",u)}}var p=getObj("Crm_"+e+"_"+d),v=$(p);if(p)if("CURRENCYISOCODE"==d){if("edit"!=s){if(v.hasClass("dataPopulated"))v.val(t[d]).trigger("change.select2");else{v.empty();var g=$([]);g=$(document.createElement("option")).clone().attr("value",t[d]).prop("text",t[d]),v.append(g[0]),v.trigger("change.select2")}var f=crmTemplate.getElemIdByColname(e,"EXCHANGERATE"),C=Crm.userDetails.CURRENCY_DETAILS[t[d]].er;$("#"+f).html(C)}}else v.val(t[d]),renderingUtils.triggerEvent("change",v)}else{if(!n&&d in r)(p=$("Crm_"+e+"_"+d)[0])||(p=$("#Crm_"+e+"_"+r[d])[0]),p&&($(p).val(t[d]),renderingUtils.triggerEvent("change",$(p)));if(!o&&d in a)(p=$("Crm_"+e+"_"+d)[0])||(p=$("#Crm_"+e+"_"+a[d])[0]),p&&($(p).val(t[d]),renderingUtils.triggerEvent("change",$(p)))}}},fillFormObject:function(e,t,r,a,i,n,o,s){if("view"!=window[i].currentStatus){var l=Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule="+encodeURIComponent(r)+"&operation="+encodeURIComponent(window[i].currentStatus)+"&module="+encodeURIComponent(i)+"&entityname="+encodeURIComponent(e)+"&entityid="+encodeURIComponent(t)+"&isajax=true";null!=o&&(l=l+"&layoutid="+encodeURIComponent(o)),l=networkUtils.getPortalURL(l),Crm.fillInfo(l,r,a,e,t,n,s)}},fillInfo:function(e,t,r,a,i,n,o){var s=getHTTPObject();s.open("POST",e,!0),s.onreadystatechange=function(){if(4==s.readyState){var e=s.responseText,t=JSON.parse(e),r="";if(Crm.userDetails.isLookupAdvancedSearchEnabled&&!o&&(r=$("crm-entity-lookup")[0].component.getData("reqData").labelName),Crm.getModuleObj(Crm.moduleName).createTemplate(t,void 0,void 0,!0),Crm.userDetails.isLookupAdvancedSearchEnabled||o||$("#linesTbody").children().remove(),Crm.userDetails.isLookupAdvancedSearchEnabled&&!o){var l=$("[id='"+r+"']");0==(d=$("#"+r)).length&&(d=l),c=d,d.val(decodeURIComponent(a)),d.addClass("wsNowrap tOE"),c.data("id",i+""),$("#topBandPopup").is(":visible")&&hideAnimatePopup("topBandPopup",!0),$("#lookupPopup").is(":visible")&&hideAnimatePopup("lookupPopup",!0),$(d).effect("highlight",{},1e3)}else{if(void 0!==n)r=n,l=n;else r=getObj("fldName").value,l=getObj("fldId").value;var d=getObj(r),c=getObj(l);d.value=decodeURIComponent(a),$(c).data("id",i+""),Crm.setRefFieldValues(d,i),hideAnimatePopup("topBandPopup",!0)}!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(Crm.moduleName)&&(CFRExec.init(CFRExec.oldResJson,Crm.moduleName,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))}},s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),s.send(csrfParamName+"="+encodeURIComponent(csrfToken))},updateCurrencyFields:function(e,t,r,a,i){var n=Crm.userDetails.CURRENCY_DETAILS,o=n[t].symbol,s="qCreate"!==a?Crm.currencyFields[e]:i,l=Crm.isInventoryModule(e),d=!1;l&&"qCreate"!==a&&(productDetails.currencySymbol=o,productDetails.roundOff=n[t].decimals,productDetails.roundOffPrecision=Math.pow(10,n[t].decimals));var c=function(e){($(e).data("subformsectionlabel")||$(e).data("subFormTabId"))&&($(e).trigger("change"),$(e).off("keypress keyup blur").on("keypress keyup blur",(function(e){crmTemplate.calculatorOperation(this,e)})))},m=s.length,u=parseInt($("#totalProductCount").val());if(null!=s){if(l&&"qCreate"!==a){for(var p=1;p<=u;)s.push("hdnUnitPrice"+p),s.push("txtListPrice"+p),++p;s.push("txtAdjustment")}for(p=0;p<s.length;p++){var v=document.getElementById("currencySymbol_"+s[p]);if(v&&($(v).empty(),$(v).hasClass("sfHeaderCurrency")?v.innerHTML="("+o+")":v.innerHTML=o+"&nbsp;"),""!=s[p]){var g=getObj(s[p]);if(null!=g&&("EXPECTEDREVENUE"!==g.getAttribute("data-colname")||1!=d)){var f=g.value,C=$(g).data("uitype");if(116!=C&&117!=C&&null!=r&&""!=r&&""!=f){var h=parseFloat(n[r].er),y=n[t].er;"edit"==Lyte.Router.getRouteInstance().currentModel.currentStatus&&0!=crmTemplate.recordCurrencyER&&(window[e].defaultCurrency==r&&(h=crmTemplate.recordCurrencyER),window[e].defaultCurrency==t&&(y=crmTemplate.recordCurrencyER));var E=f/h,_=parseFloat(y),I=parseInt(Crm.userDetails.CURRENCY_DETAILS[t].decimals);g.value=commonUtils.roundNumber(E*_,I),c(g),renderingUtils.triggerEvent("change",$(g)),"EXPECTEDREVENUE"!=g.getAttribute("data-colname")&&(!0!==$(g).data("readonly")&&$(g).trigger("keypress").trigger("keyup").trigger("blur"),"AMOUNT"==g.getAttribute("data-colname")&&(d=!0))}}}}}for(p=s.length;p>m;)s.pop(),p--},clearLookup:function(e){var t=e.data("dependfield"),r=$("#multipleFieldsEditPop").is(":visible");if(t){var a=e.data().fieldid;ProcessFlow.getDuringTransitionDependentFields(void 0,a)}if(r&&e.data("isMXNDuplicate")&&e.data("isMXNDuplicate",!1),"Services"===e.data().lookupModule){setTimeout((function(){var e=document.getElementById("Crm_Appointments_SMOWNERID");e&&e.hasChildNodes()>0&&(e.component.setData("dataId",""),e.component.setData("userRecord",{}))}),400);var i=$("#serviceDurationAndPrice"),n=$("#checkDuplicateEvent");n&&n.remove(),i.length&&i.hide(100,(function(){i.remove()}))}if(e.data("id",""),e.val(""),e.focus(),"Contacts"===Crm.moduleName&&"ACCOUNTID"===e[0].dataset.colname){var o=void 0!==Crm.moduleInfo.Accounts?Crm.moduleInfo.Accounts.translatedSingularLabel:"Account",s=$("#Contacts_fldRow_REPORTINGTOCONTACTID"),l=$("#Crm_Contacts_REPORTINGTOCONTACTID"),d=I18n.getMsg("crm.contact.hierarchy.Specify_account_name",[I18n.getMsg(o)]);l.val(""),l.prop("disabled",!0),l.autocomplete("disable"),s.attr({class:"REPORTINGTOCONTACTID tabDivCreate noclick"},{onmouseenter:"renderingUtils.zctt.showtt('"+d+"');"},{onmouseleave:"renderingUtils.zctt.hidett();"})}e.trigger("create_edit_clone_DomChange",this)},showLookUp:function(e,t,r,a,i,n,o,s,l,d,c,m,u,p,v,g,f,C,h,y,E,_){var I=$("#multipleFieldsEditPop").is(":visible"),T=$("#VRAjaxEdit").is(":visible"),D=$("[id='"+t+"']").eq(0).data("fieldid");if("ownername"!==i||!Crm.userDetails||!Crm.userDetails.PERSONAL_ACCOUNT){this.moduleName=e;var R="",b="",A=$("#socAddToCrmPop").is(":visible");null!=s&&(void 0!==y&&Crm.isLineItemSubFormModule(y)?(R+="&isSubFormField=true",b=s):"vendorName"===s||"property(vendorName:Vendor Name)"===s?b=getObj("property(vendorName:Vendor Name)")?getObj("property(vendorName:Vendor Name)").value:"":getObj(s)?(b=getObj(s).value,"property(actName:Account Name)"==s&&""==getObj("property(Account Name)").value&&(b=null)):b=null,R+="&productId="+b),null==g&&(g="");var w=$("#Crm_"+e+"_CURRENCYISOCODE").val();null==w&&(w="");var M=null,L="",S="",U="",O=getObj(r);if(v){if(!(M=$(O).data("id"))&&(M=$(O).data("selectedid"))){if((M+="").indexOf("CALLMXNCLONESCHEDULER")>-1)return!1;if(M.indexOf("-")>-1){var N=M.split("-");M=N[0],L=N.length>1?N[1]:""}multiLookupsView.multiLookups[t]&&(multiLookupsView.multiLookups[t].variedLookupValues.confirmselectedid=M,multiLookupsView.multiLookups[t].variedLookupValues.confirmunselectedid=L)}if(i===e){var k,P=t.length-1;if(k="X"===t[P]?t.substring(0,t.length-1):t+"X",multiLookupsView.multiLookups[k])if((S=$("#"+k).data("selectedid"))&&""!==S&&"-"!==S&&S.indexOf("-")>-1){var F=S.split("-");S=F[0],U=F[1]}}}var x=$("#"+r),j=0;if(x){var V=x.data();V&&V.uitype&&(j=V.uitype)}if("Users"!=i){var B=r;if(r&&r.indexOf("property(")>-1)try{B=r.match(/property\([a-z]+\:(.*[^)])+/i)[1].replace(/[^a-z]/gi,"")}catch(e){B=(new Date).getTime()}if("ownername"==i){if($("#ownerNameLookup")[0]){var H=document.getElementById(t),Y=$(H).offset(),G=$(H).height();Y.top+=G;var z=$L("#ownerNameLookup"),q=z.find(".on");q.length&&z.scrollTo[0](q),$("#hostSrchBox")&&($("#hostListCont").find("li").each((function(){$(this).show()})),$("#hostSrchBox").val("")),z.css("display","block"),renderingUtils.stopEvent(window.event)}else{var J=Crm.getCrmBasePath()+"/Search.do?searchmodule="+i+"&fldName="+t+"&fldId="+r+"&fldLabel="+a+"&fldValue="+g+R+"&itsfromLAR="+c+"&condition="+u+"&newModel=true&fromSearchCreate="+C+"&filtercriteria="+_;(new crmRequestPool).initiate({action:J,type:"POST",success:function(r){var a=document.getElementById(t),i=$(a).data("id"),n=r.length,o=($(a).data(),$(a).offset()),s=$(a).outerWidth()-3;o.top+=G;var l={name:"div",css:{"z-index":"31","background-color":"#fff",border:"1px solid #d4d4d4",overflow:"auto",position:"absolute",top:o.top+5+"px",left:o.left-22+"px"},attr:{id:"ownerNameLookup",name:"ownerNameLookup",class:"pR dd_boxSh"},child:[]},d={name:"ul",attr:{id:"hostListCont",class:"cusDropDown"},css:{width:s+23+"px",border:0,"max-height":"180px",overflow:"auto"},child:[]},c=[{name:"click",args:[t],fn:function(t,r,a){r=$(r),$(".on").removeClass("on"),r.addClass("on");var i=$("#"+a);i.attr("title",r.attr("title")),i.data("id",r.data("id")),i.html(r.html()),"Events"!==e&&"Calls"!==e||Events.checkDuplicateEvent(void 0,!1),$("#ownerNameLookup").hide(),$("#emptyLayer").remove(),renderingUtils.removeDummyBackground()}}];if(n>10){var m={name:"input",attr:{id:"hostSrchBox",type:"text","data-zcqa":"txt_SearchUser",class:"hostSearch",placeholder:"Search Users...",maxlength:"10"}},u=[{name:"keyup",args:[m],fn:function(e,t){showMacroSuggest(t,e,"hostListCont","li",void 0,void 0,void 0,void 0,void 0,"userName")}}];m.events=u;var p={name:"div",child:[m]};l.child.push(p)}for(var v=0;v<n;v++){var g=r[v].label,f=g,C=commonUtils.calculateAcceptableCharCount(a,f);g.length>C&&(g=g.substr(0,C-1)+"...");p={name:"li",html:revertSplChrs(g),attr:{title:f,userName:f},data:{id:r[v].USERID}};if(r[v].USERID===i){p.attr.class="on"}p.events=c,d.child.push(p)}l.child.push(d);var h=renderingUtils.createHTML(l);thirdPartyUtils.bindPerfectScroll("#hostListCont"),document.body.appendChild(h);var y=$L("#ownerNameLookup"),E=y.find(".on");E.length&&y.scrollTo[0](E)}})}renderingUtils.dummyBackground(!0),$("#emptyLayer").css("z-index","30")}else{if("Contacts"===i)if(/Calls|Tasks|Events/.test(e)){"Accounts"===($("#Crm_"+e+"_SEID_label_select").val()||$("#Crm_"+e+"_SEID_select").val())&&(b=$("#Crm_"+e+"_SEID").data("id"))&&(R="&productId="+b)}else{var W={accounts:[]},K=0,Q=[];if((ie=$("#Crm_"+e+"_ACCOUNTID"))[0]?(b=ie.data("id"))&&(null!=b&&"null"!=b&&""!=b&&(Q[K]=b,W.accounts[K]={},W.accounts[K].id=b,W.accounts[K].name=ie.val(),K+=1),R="&productId="+b):null==ie[0]&&(ie=$("#subvalue_ACCOUNTID"))[0]&&(b=ie.data("params")?ie.data("params").id:null,"detailView"==ie.data("cid")&&b&&(Q[K]=b,W.accounts[K]={},W.accounts[K].id=b,W.accounts[K].name=ie.text(),K+=1)),"Crm_Contacts_REPORTINGTOCONTACTID"!==r){var X=(oe=e.substring(0,e.length-1)).toUpperCase()+"CF";if(0==oe.indexOf("CustomModule")){var Z=e.split("CustomModule");X=Z[1]<=50?"COBJ"+Z[1]+"CF":"COBJCF"}var ee,te="input[id^='Crm_"+e+"_"+X+"']";(se=$(te)).length<2&&(te="a[id^='subvalue_"+X+"']",ee=(se=$(te)).length>0);for(Se=0;Se<se.length;Se++){var re=$(se[Se]);if(ee){if("Accounts"===(re.data("params")?re.data("params").module:null)){var ae=re.data("params").id,ie=re.text();ae&&ie&&(Q.contains(ae)||(Q[K]=ae,W.accounts[K]={},W.accounts[K].id=ae,W.accounts[K].name=ie,K+=1))}}else if("Accounts"===re.data("lookupModule")){ae=re.data("id"),ie=re.val();ae&&ie&&(Q.contains(ae)||(Q[K]=ae,W.accounts[K]={},W.accounts[K].id=ae,W.accounts[K].name=ie,K+=1))}}}else if("Crm_Contacts_REPORTINGTOCONTACTID"===r&&"view"===window[e].currentStatus){(ie=$("#subvalue_ACCOUNTID"))[0]&&(null!=(b=JSON.parse(ie[0].dataset.params).id)&&"null"!=b&&""!=b&&(Q[K]=b,W.accounts[K]={},W.accounts[K].id=b,W.accounts[K].name=ie[0].text,K+=1),R="&productId="+b)}Q.length>0&&(R="&productId="+(b=Q[0])+"&accDetails="+encodeURIComponent(JSON.stringify(W))+"&accountid="+b+"&accountname="+encodeURIComponent(W.accounts[0].name))}else if("Campaigns"===i||"Potentials"===i||"Quotes"===i||"SalesOrders"===i){W={accounts:[]},K=0,Q=[];if("Cases"===e)ie=$("#Crm_"+e+"_WHOID");else if("Calls"===e){var ne=-1!=r.indexOf("_PBCalls_")?"PBCalls":"Calls";ie=$("#Crm_"+ne+"_CONTACTID")}else ie=$("#Crm_"+e+"_CONTACTID");ie[0]&&(b=ie.data("id"))&&(null!=b&&"null"!=b&&""!=b&&(Q[K]=b,W.accounts[K]={},W.accounts[K].id=b,W.accounts[K].name=ie.val(),K+=1),R="&productId="+b);X=(oe=e.substring(0,e.length-1)).toUpperCase()+"CF",te="input[id^='Crm_"+e+"_"+X+"']";var oe,se=$(te);if(Q.length>0&&(R="&productId="+(b=Q[0])+"&accDetails="+encodeURIComponent(JSON.stringify(W))),"Potentials"===i||"Quotes"===i||"SalesOrders"===i)(ie=$("#Crm_"+e+"_ACCOUNTID"))[0]&&ie.data("id")&&(R=R+"&accountId="+ie.data("id"))}if("Potentials"===i&&"rLEmail"===n){var le=null,de=$("#module");if("Contacts"===e&&"Accounts"!=de.val())le=$("#id").val();else if("Potentials"===e){le=$L("#cntId").val(),"canvas"==Lyte.Router.getRouteInstance().routeName&&(le=$L("crm-emailsrl-canvas-view").attr("associated-cont-id"));var ce=$L("dealOnlyDropDown");if(ce&&ce.length>0){var me=ce[0].component.data.ltPropSelected;me&&"dealsOnly"!==me&&(le=me)}}else if("Accounts"==e||"Contacts"===e&&"Accounts"==de.val()){var ue=$("#contactSelDropdownInAcc");le=$("crm-emails-related-list").length>0?"ALL"==ue.attr("lt-prop-selected")?$("#"+t).parents(".rLEmailSub").data("contactid"):ue.attr("lt-prop-selected"):"ALL"==ue.val()?$("#"+t).closest(".mailcontDiv").data("contactid"):ue.val()}let o=$L("#etmmModal"),s=$L("#edvModalConversation");o.length&&o[0].ltProp("show")&&s.length&&s[0].ltProp("show")&&(le=$L("crm-emailconversation-view")[0].getData("moduleInfo.moduleId"));var pe=Crm.getCrmBasePath()+"/Search.do?searchmodule="+i+"&fldName="+t+"&fldId="+r+"&fldLabel="+a+"&fldValue="+g+R+"&condition="+u+"&contactId="+le+"&source="+n+"&currencyISOCode="+w+"&newModel=true"}else if(""!=p&&null!=p&&"-1"!=p)pe=Crm.getCrmBasePath()+"/Search.do?searchmodule="+i+"&fldName="+t+"&fldId="+r+"&fldLabel="+a+"&fldValue="+g+R+"&condition="+u+"&potentialId="+p+"&currencyISOCode="+w+"&newModel=true";else if("Services"===i&&"Appointments"===e)pe=Crm.getCrmBasePath()+"/Search.do?searchmodule="+i+"&fldName="+t+"&fldId="+r+"&fldLabel="+a+"&fldValue="+g+R+"&condition="+u+"&currencyISOCode="+w+"&newModel=true&parentModule="+e;else{var ve="";i!==crmModuleConstants.Accounts||e!==crmModuleConstants.Accounts||A||"edit"!==window[e].currentStatus&&"view"!==window[e].currentStatus||(ve="&seId="+window[e].entityId);pe=Crm.getCrmBasePath()+"/Search.do?searchmodule="+i+"&fldName="+t+"&fldId="+r+"&fldLabel="+a+"&fldValue="+g+R+"&condition="+u+"&currencyISOCode="+w+ve+"&newModel=true&notInMultiModLookup="+h}if(pe=networkUtils.getPortalURL(pe),v){if(Crm.userDetails.isMultiSelectionPopupSupported&&!Crm.isFromSalesInbox){var ge,fe=!0===C;ge=fe?"#subSecondaryPopup":"#topBandPopup",$L(ge).empty();var Ce=t.split("_")[2];return void 0===moduleRecordMapping[e].fields?void store.findAll("field",{module:moduleApiMapping[e]},!1,!0,{apiVersion:"2.2"}).then((function(){Crm.callMultiSelectionPopup(e,fe,I,r,v,i,Ce,ge)})):void Crm.callMultiSelectionPopup(e,fe,I,r,v,i,Ce,ge)}if(("all"===L||"all"===U)&&("view"===window[e].currentStatus||window[e].isFormEdit||"Edit"===$(heading_title).text().trim().substring(0,$(heading_title).text().trim().indexOf(" "))))return void("all"===U?multiLookupsView.permissionIssueWarningShow("",e,i,16,v):"all"===L&&multiLookupsView.permissionIssueWarningShow("",e,i,12,v));if(Crm.trackSpotLightAction("Multi Select Lookup - Record Edit",{Module:e}),pe+="&linkingmodule="+v+"&selectedid="+M+"&unselectedid="+L+"&selectedidx="+S+"&unselectedidx="+U+"&select=true",window[e]&&("edit"==window[e].currentStatus||I&&!C||"view"==window[e].currentStatus&&!C))if(window[e].entityId)pe+="&entityId="+window[e].entityId;else{var he=$("#multipleFieldEditEntityId");he.length>0&&(pe+="&entityId="+he.val())}else{var ye=document.querySelector("crm-blueprint-exec-popup");pe+=null!==ye?"&entityId="+ye.getData("entityId"):"&entityId="+B.value}}if(f&&(validationUtils.isInteger(f)&&(pe+="&campaignId="+f),pe+="&hideQuickCreate=true"),(crmTemplate.fromAddToCampaignTool||f)&&(pe+="&addToCampaign=true"),C&&(pe+="&fromSearchCreate="+C),E&&(pe+="&fromAutDealCreate="+E),"Crm_Contacts_REPORTINGTOCONTACTID"!==r||"edit"!==window[e].currentStatus&&"view"!==window[e].currentStatus||(pe+="&entityId="+window[e].entityId),e&&window[e]&&window[e].createEditJson)window[e].createEditJson.layout_jsonarrayObj?Ee=window[e].createEditJson.layout_jsonarrayObj.sysLayoutId:returnJson.layout_jsonarrayObj&&(Ee=returnJson.layout_jsonarrayObj.sysLayoutId),"view"==window[e].currentStatus&&returnJson.layout_jsonarrayObj&&(Ee=returnJson.layout_jsonarrayObj.sysLayoutId);else var Ee=$("#layoutdetails").val();if(Ee&&"null"!=Ee&&"undefined"!=Ee&&(pe+="&layoutId="+Ee),D&&"null"!=D&&"undefined"!=D&&(pe+="&lookupFieldId="+D),T&&(pe+="&hideQuickCreate=true"),_&&(!v||window[e]&&"create"==window[e].currentStatus)&&(pe+="&filtercriteria="+_),$(".outlookInfoCont").is(":visible")){$("#topBandPopup");pe+="&isfromOutlookRightPanel=true",$$rightPanel.openNewWindowFromOutlook(pe,500,1100)}else commonUtils.openCustomLookup(pe,void 0,"topBandPopup",renderingUtils.windowWidth-300)}}else if(444==j){var _e=document.getElementById("ServiceMultiUserComponent"),Ie=[],Te=[];M&&M.length>0&&(Ie=M.split(","));for(var De=Crm.userDetails.MODULE_LIST.Services.id,Re=store.peekRecord("module",De).profiles,be=Re.length,Ae=[],we="(profile:in:",Me=[],Le=[],Se=0;Se<be;Se++)Me.push(Re[Se].id),Re[Se].name&&Le.push(Re[Se].name.replace(/,/g,"\\,"));var Ue={comparator:"in",field:"profile.id"};Ue.value=Me,Ae.push(Ue);var Oe=Le.join().replace(/\(/g,"\\(");we=we+(Oe=Oe.replace(/\)/g,"\\)"))+")",void 0!==_e&&$(_e).length>0&&_e.remove(),Te=null==$(O).data("userIdList")?"create"==window[e].currentStatus||"clone"==window[e].currentStatus?[]:Ie:$(O).data("userIdList"),Lyte.Component.render("crm-service-user-lookup",{id:"ServiceMultiUserComponent",excludeIds:{},selectedIds:Ie,userCriteria:JSON.stringify(Ae),userSearchCriteria:we,userIdList:Te},"#Services_fldRow_MXNDUMMYCOLUMN_SERVICE"),(_e=document.getElementById("serviceUserLookup")).cxProp("show",!0)}else{if(Search.InfoForPartialLoad){var Ne=$(Search.createShowLookup(t));if(M&&M.length>0){var ke=M.split(",");$.each(ke,(function(e,r){Ne.find("#"+t+"_"+r).addClass("result-selected-no-display")}))}renderingUtils.stopEvent(window.event)}else if(0===$("#ownerNameLookup_"+t).length){Ne=$(Search.createShowLookup(t));if(M&&M.length>0){ke=M.split(",");$.each(ke,(function(e,r){t.indexOf("MXNDUMMYCOLUMN_USER")>-1||Ne.find("#"+t+"_"+r).addClass("result-selected-no-display")}))}renderingUtils.stopEvent(window.event)}else-1!=t.indexOf("MXNDUMMYCOLUMN")&&Search.showCreatedUserPopup(t,"yes",!0);$("#ownerNameLookup_"+B).closest("#critEditorDIV").length&&Search.setHeightOwnerLookupScoring($("#ownerNameLookup_"+B)),renderingUtils.scrollPrevent($("#ownerNameLookup_"+t)),$("input#hostSearch_"+B).attr("onclick","sE(event)").focus()}}},callMultiSelectionPopup:function(e,t,r,a,i,n,o,s){var l;moduleRecordMapping[e].fields.forEach((function(e){e.column_name!==o||(l=e)}));for(var d=Object.keys(moduleApiMapping),c=d.length,m=0;m<c;m++){if(moduleApiMapping[d[m]]===l.multiselectlookup.linking_module.api_name){i=d[m];break}}var u="detail"===Lyte.Router.getRouteInstance().routeName&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&detailView.changedBCJson.recordLockingDetails.fieldIds.length&&detailView.changedBCJson.recordLockingDetails.fieldIds.contains(l.id);Lyte.Component.render("crm-multi-selection-popup",{entityId:t||window[e]&&window[e].currentStatus&&"clone"===window[e].currentStatus?null:window[e].entityId,isDirectField:!0,isRelatedList:!1,isFromBlueprint:r,isQuickCreate:t,mxnDomId:a,linkingModule:i,module:n,fieldId:l.id,parentModule:e,relatedListId:l.multiselectlookup.id,fieldApiName:l.api_name,isMxnLockExculdedField:u},s)},validateFormFields:function(e){for(var t=!0,r=0;r<e.length;r++){var a=$("#"+e[r]),i=a.data(),n=(i.displaylabel,i.contenttype),o=i.displaylabel,s=commonUtils.getValue(a),l=(i.fieldtype,i.i18fieldtype),d=i.datepattern;switch(s="string"==typeof s?s.trim():s,"true"===i.mandate+""&&validationUtils.isFieldEmpty(a)&&(commonUtils.showErrorMsg(I18n.getMsg("crm.field.empty.check",[o]),a),t=!1),i.maxlength&&!Crm.checkMaxLength(a,i.maxlength)&&(commonUtils.showErrorMsg(I18n.getMsg("crm.field.length.check",[l]),a),t=!1),n){case"Email":var c=a.val()?a.val().trim():a.val();validationUtils.isValidEmail(s)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);break;case"Date":case"DateTime":if(""==(s=(s=s.replace(Crm.userDetails.DATE_PATTERN,"")).replace(crmConstants.executionDayFormula,""))||Utils.isValidDate(Crm.userDetails.DATE_PATTERN,s,d)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1),"DateTime"===n){var m=$("#"+a.attr("id")+"_TimeOption").val().split(" ")[0];if(""!=m){""==$("#"+a.attr("id")).val()&&(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);var u=m.split(":"),p=(Utils.getMeridiem($("#"+a.attr("id")+"_TimeOption").timeEntry("getTime")).toUpperCase(),u[0]),v=u[1];Utils.isValidTime(p,v)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1)}}break;case"URL":c=a.val()?a.val().trim():a.val();validationUtils.isValidWebUrl(c)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);break;case"Currency":var g=i.maxlength-(f=i.decimalLength);currencyUtils.isValidCurrency(s,g,f)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);break;case"Percent":case"Number":case"LongInteger":""===s||validationUtils.isValidInteger(s)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);break;case"Phone":validationUtils.isValidPhoneNo(a,a.val())||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);break;case"Decimal":var f;g=i.maxlength-(f=i.decimalLength);if(validationUtils.isValidDecimal(s,g,f))validationUtils.decimalLengthCheck(s,f)||(commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1);else commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[l]),a),t=!1;break;default:if(i.regex)new RegExp(i.regex,"g").test(s)||(t=!1,commonUtils.showErrorMsg(I18n.getMsg("Please provide a valid data.."),a))}}return t},getFieldTypeStr:function(e){return{1:"Text",11:"Text",32:"Text",27:"Text",127:"Text",2:"Pick List",26:"Pick List",3:"Textarea",21:"URL",24:"Date",202:"Date",30:"Date/Time",25:"Email",32:"Number",33:"Phone",34:"Percent",38:"Decimal",36:"Currency",37:"Text",39:"Pick List",98:"Pick List",40:"Number",300:"Boolean",301:"Boolean",100:"Multiselect",786:"DateTime",14:"DateTime",333:"DateTime",111:"AutoNumber",4:"Lookup",5:"Lookup",6:"Lookup",7:"Lookup",8:"Lookup",9:"Lookup",10:"Lookup",12:"Lookup",13:"Lookup",15:"Lookup",55:"Lookup",132:"Lookup",133:"Lookup",135:"Lookup",136:"Lookup",143:"Currency(Round Off)",144:"Currency(Round Down)",145:"Currency(Round Up)",116:"Formula",52:"Long Integer",46:"Lookup",221:"Lookup"}[e]},handleDontShowTaskClosePopup:function(){localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0)},refreshRoute:function(e,t){Lyte.Router.getRouteInstance().transition.info.route.indexOf("crm.tab.module")>-1&&crmTab.deleteFromCache(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]);var r={};t.getAttribute("data-params")&&(r=JSON.parse(t.getAttribute("data-params")));var a=Lyte.Router.getRouteInstance(),i=!0,n=a.getQueryParams();"refreshRoute"==r.clickId&&n&&null!=n.page&&(r.currentOption=a.transition.info.queryParams.per_page,r.toIndex=a.transition.info.queryParams.per_page,a.setQueryParams({page:void 0}).data=r,i=!1),i&&(a.refresh().data=r)},checkIfSameRoute:function(e,t){if(t.queryParams=t.queryParams?t.queryParams:{},e.route!==t.route)return!1;for(var r=e.dynamicParams.length,a=0;a<r;a++)if(e.dynamicParams[a]!==t.dynamicParams[a])return!1;if(Object.keys(e.queryParams).length!==Object.keys(t.queryParams).length)return!1;for(var i in e.queryParams)if(e.queryParams[i]!==t.queryParams[i])return!1;return!0},lyteTransition:function(e,t,r){for(var a,i=!0,n=e.target||e.srcElement;n!==t;){if("LINK-TO"===n.tagName)return;n=n.parentElement}t?(a=$(t).data("cid"),r=$(t).data("params")):(a=r.clickId,delete r.clickId);var o={detailView:{route:"crm.tab.module.entity",dynamicParams:[r.module,r.id]},kanbanviewentity:{route:"crm.tab.module.entity",dynamicParams:[r.module,r.id]},showMacro:{route:"crm.settings.section.macro.index",queryParams:{module:r.module}},showDashboard:{route:"crm.tab.dashboards.view",dynamicParams:[r.dbId]},newReport:{route:"crm.tab.reports.create"},customizeReport:{route:"crm.tab.reports.view",dynamicParams:[r.reportId],queryParams:{folderId:r.folderId}},apprDetailView:{route:"crm.tab.approvals.view",queryParams:{recModule:r.recModule,entityId:r.entityId}}};if(t&&$(t).data("redirect")&&(o.detailView={route:"crm.tab.module.entity.detail",dynamicParams:[r.module,r.id]},o.kanbanviewentity={route:"crm.tab.module.entity.detail",dynamicParams:[r.module,r.id]}),"kanbanviewentity"==a){var s=o[a].dynamicParams[0];"Activities"==Crm.activityGrp[s]&&(o[a].route="crm.tab.module.entity.detail")}if("showMacro"==a)1!=r.type&&2!=r.type||(o.showMacro.route="crm.settings.section.macro."+(2==r.type?"view":"edit")),o.showMacro.dynamicParams=[r.ruleId];else if("navigate_next"==a||"navigate_previous"==a||"changeOption"==a){if(window.location.href.indexOf("approvals")>-1){var l=r.fromIndex;r={actionName:$("#groupUserView option:selected").val()};$("#showDuplicatesOpt").val()&&(r.showDuplicates=$("#showDuplicatesOpt").val());var d=$("#currentOption").val();r.fromIndex="navigate_next"==a?parseInt(l)+parseInt(d):"navigate_previous"==a?parseInt(l)-parseInt(d):l,r.toIndex=parseInt(r.fromIndex)+parseInt(d)-1,o[a]={route:"crm.tab.module.actions.approvals",dynamicParams:[getObj("module").value],queryParams:r}}}else if("detailView"==a||"kanbanviewentity"==a){s=o[a].dynamicParams[0];(r.fromActivityListView||"Activities"==Crm.activityGrp[s]&&(!Crm.isActivitySplitDone||Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().parent&&Lyte.Router.getRouteInstance().parent.parent&&"Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()))&&(o[a].dynamicParams[0]="Activities",o[a].queryParams={sub_module:s});var c=Lyte.Router.getRouteInstance().transition;200!=c.state&&308!=c.state&&(i=!1)}i&&(Lyte.Router.transitionTo(o[a]).data=r)},isValidJSON:function(e){try{JSON.parse(e)}catch(t){return Crm.isValidJSONArray(e)}return!0},isValidJSONArray:function(e){return Array.isArray(e)},routeOnBoarding:function(e,t){Lyte.Router.transitionTo({route:e})},getStageVsDetails:function(e){for(var t=e.length,r={},a=0;a<t;a++)if("none"!==e.value){var i=e[a];r[e[a].html]=i}return r},isStdOptionsField:function(e){return-1!==crmConstants.stdOptionFields.indexOf(e)},updatePermission:function(e){var t=["Crm_Implied_View_","Crm_Implied_Import_","Crm_Implied_Create_","Crm_Implied_Approve_Web_","Crm_Implied_Edit_","Crm_Implied_Export_","Crm_Implied_Mass_Delete_","Crm_Implied_Mass_Email_","Crm_Implied_Mass_Transfer_","Crm_Implied_Mass_Update_","Crm_Implied_Web_To_","Crm_Implied_Webform_Abtesting_","Crm_Implied_Delete_","Crm_Implied_Tags_","Crm_Implied_ZohoSheet_View_","Crm_Implied_Delete_Mail_","Crm_Implied_Import_My_","Crm_Implied_Import_MyOrg_","Crm_Implied_MailMerge_Mail_","Crm_Implied_Mass_Convert_","Crm_Implied_Print_View_","Crm_Implied_Send_Mail_","Crm_Implied_Share_","Crm_Implied_Merge_","Crm_Implied_Change_Owner_","Crm_Implied_Customize_","Crm_Implied_Manage_CustomViews_","Crm_Implied_Manage_Workflow_","Crm_Implied_View_Notes_","Crm_Implied_Edit_Notes_","Crm_Implied_Create_Notes_","Crm_Implied_Delete_Notes_","Crm_Implied_Export_Notes_","Crm_Implied_Create_Attachments_","Crm_Implied_Delete_Attachments_"];moduleRecordMapping.LockingInformation&&t.push("Crm_Implied_Lock_");for(var r=t.length,a=0;a<r;a++)Crm.userDetails.permissions[t[a]+e.modName]=!0},get_params_for_getRecord:function(){return{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}},openOrganizationsPageInNewTab:function(e){Crm.client_tracking("Multiple Organization - Org manage clicked"),window.name="zcrmmainwindow";var t="";t="true"==window.isSandboxAcc?"https://"+RebrandLinkUtil.getProperty("SANDBOXURL"):RebrandLinkUtil.getProperty("CRMURL_HTTPS"),window.open(t+"/organizations?ref="+e)},returnPhoneFieldDependencyFiles:function(){var e=networkUtils.returnDependencyFiles(["crm-phone-field.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-phone-field.css"],ResourceConstants.CRMClient);return networkUtils.returnDependencyFiles(["zlib_phonenumber.js"],ResourceConstants.CRM).concat(e,t)},loadPhoneFieldComponentJSFiles:function(){"undefined"==typeof ZlibPhoneNumber&&Lyte.injectResources(Crm.returnPhoneFieldDependencyFiles())},loadRichTextFieldComponentResources:async function(){var e=networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js","lyte-ui-emoji.css"],ResourceConstants.CRMClient);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM)),await Lyte.injectResources(e)},showOrHideScoreDetails:function(e,t){var r=$L("#"+e);t?(r.addClass("dN"),$L("#showspan_"+e).removeClass("dN"),$L("#hidespan_"+e).addClass("dN"),$L("#srTimeline_"+e).removeClass("bg_crmBg2").addClass("pL0")):(r.removeClass("dN"),$L("#srTimeline_"+e).addClass("bg_crmBg2").removeClass("pL0"),$L("#showspan_"+e).addClass("dN"),$L("#hidespan_"+e).removeClass("dN"))},showStorageExceedPopup:function(e,t,r){var a=Crm.userDetails.CLIENT_ACCOUNT?"new_record_client":"new_record";e=e||a;var i=Crm.userDetails.data_storage,n=!!i&&"count"===i.calculation_type;t=t||"#showAlertPopUp";var o=i.percentage>100?100:i.percentage;i.total_used_space>i.total_allowed_space&&(i.total_used_space=i.total_allowed_space);var s={errorType:e,rem_storage:i.total_remaining_space.toString(),allowed_storage:i.total_allowed_space,isCount:n,HomePage:r,used_storage_in_percent:o},l=networkUtils.returnDependencyFiles(["datastorage.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")],ResourceConstants.CRM),m=l.concat(d).concat(c);Lyte.injectResources(m,void 0,(function(){t&&!$L("crm-data-storage-error-msg")[0]?Lyte.Component.render("crm-data-storage-error-msg",s,t):($L("crm-data-storage-error-msg")[0].setData(s),$L("#dS_errorMsgLandRecPage")[0].ltProp("show","true"))}))},notifySearchCloseCRMPlus:function(){"global-search"===Lyte.Router.getRouteInstance().routeName&&isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("searchView.onclose")},updateModifiedByAndDate:function(e){var t=e.Modified_By.name,r=e.Modified_By.id,a=e.Modified_Time;a=$L.moment(a,Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replaceAll("a","A")).toDate(),a=Utils.convertDateToGivenPattern("D, d M yy",a)+" "+Utils.getTimeInUserFormat(a,!0);var i="<span purpose='showUserBC' data-params='{\"userId\":\""+r+"\"}' >"+$ESAPI.encoder().encodeForHTML(t)+"</span><br><span class='crm-small-font-size fontSmooth crmNotFoundColor crm-font-regular'>"+a+"</span>";null!==getElemById("value_MODIFIEDBY")&&($("#value_MODIFIEDBY,#headervalue_MODIFIEDBY").html(i),Crm.bindEventForUserBCView())},updateAggregateNumFieldsInBCView:function(e,t,r,a){var i=featuresAvailable.MultiCurrency,n=Crm.userDetails,o=returnJson.entityMapJson,s=returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:n.BASE_CURRENCY?n.BASE_CURRENCY:void 0;return t.forEach((function(t){var n=t.column_name;a||(r+="#header_"+n+",");var l=e[t.api_name];if(void 0!==(l=null===l?"":l)){if(l&&"currency"===t.data_type)if(i&&void 0!==Crm.userDetails.CURRENCY_DETAILS[s]){if((l=returnJson.entityMapJson.EXCHANGERATE&&returnJson.entityMapJson.EXCHANGERATE.defaultvalue?currencyUtils.returnValueInDefaultCurrency(s,l,Crm.userDetails.CURRENCY_DETAILS[s].decimals,parseFloat(returnJson.entityMapJson.EXCHANGERATE.defaultvalue)):currencyUtils.returnValueInDefaultCurrency(s,l,Crm.userDetails.CURRENCY_DETAILS[s].decimals))&&a){var d=l.split(" ");l=l.split(" ")[d.length-1]}}else l=currencyUtils.returnValueInDefaultCurrency(s,l);else l&&t.separator&&(l=Lyte.Component.registeredHelpers.formatNumber(l.toString()));var c=$("span#subvalue_"+n);c.length>0&&c.html(l)}a&&o&&o[n]&&(o[n].defaultvalue=l||"",CFRExec.relatedEntityMap&&CFRExec.relatedEntityMap[n]&&(CFRExec.relatedEntityMap[n].defaultvalue=o[n].defaultvalue))})),r}};function simpleEmail(){}function territoryListHide(){$("#containerDIV").is(":visible")&&$("#containerDIV").hide(),$(".shiftHoursDD").is(":visible")&&$(".shiftHoursDD").hide()}function isConfiguredUser(e){var t=$("#telephonyconfigured").val(),r=CTIAPI.CTI.ctiname;return"true"===t&&r===e}function appendTimeToImgSrc(e){var t=/nocache=[0-9]+/,r=(new Date).getTime();return t.test(e)?e=e.replace(t,"nocache="+r):e+="&nocache="+r,e}function updateRecordNumParam(e){if($("#cvlist_"+e).length)for(var t=$("#detailView_"+e).nextAll("li").children('div[data-cid="detailView"]'),r=t.length,a=0;a<r;a++){var i=t.eq(a),n=JSON.parse(i.attr("data-params"));n.recordNum=parseInt(n.recordNum)-1,i.attr("data-recordnum",n.recordNum).attr("data-params",JSON.stringify(n))}}Crm.Field={},Crm.Field.UITYPES={OWNER:8,USERLOOKUP:221,PRODUCT_HANDLER:55,SINGLE_LINE:1,DATE:24,DATE_LONG:202,DATETIME:786,MULTI_LINE_CF:110,NUMERIC_FIELD:32,PHONE:33,PERCENT:34,LONG_INTEGER:52,WEBSITE:21,EMAIL:25,CURRENCY:36,DECIMAL:38,MULTI_PICK_LIST:100,PICK_LIST:2,SKYPE_FIELD:37,TEXT_FIELD:11,TWITTER:22,FIRST_NAME:27,LAST_NAME:127,TASK_SUBJECT:62,TEXT_AREA:3,DATE_TIME1:30,CREATED_TIME:200,CREATED_BY:20,AGGREGATE_FIELD:117,BIG_DECIMAL:40,STAGE:26,RECORD_CURRENCY:39,ACCOUNT_NAME_LOOKUP:4,CAMPAIGN_NAME_LOOKUP:5,PRODUCT_NAME_LOOKUP:6,CONTACT_LOOKUP:7,VENDOR_NAME_LOOKUP:9,POTENTIAL_ID:10,SALESORDER_ID:12,CONTACT_ID:13,QUOTE_ID:15,ROLE_NAME:16,LOOK_UP_ENTITY:133,MULTI_MODULE_LOOK_UP_ENTITY:132,MULTISELECT_LOOK_UP:444,LAYOUT_LOOKUP:136,BOOLEAN_DEF:300,BOOLEAN_DEF_NOT:301,LAYOUT:208,AUTONUMBER:111},simpleEmail.SendMail=function(){if(Crm.trackSpotLightAction("Sticky Notes - Send Mail Click"),simpleEmail.CheckContents()){var e,t=getObj("toAddress").value,r=getObj("fromAddress").value,a=getObj("subject").value,i=getObj("description").value,n=getObj("editorMode").value;if(void 0!==getObj("invType"))var o=getObj("invType").value.trim(),s=getObj("invRecId").value.trim();e="plaintext"==n?"action=simpleMail&toAddress="+encodeURIComponent(t)+"&fromAddress="+encodeURIComponent(r)+"&subject="+encodeURIComponent(a)+"&mailDescription=&mailDescriptionInPlainText="+encodeURIComponent(i)+"&editorMode="+encodeURIComponent(n)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken):"action=simpleMail&toAddress="+encodeURIComponent(t)+"&fromAddress="+encodeURIComponent(r)+"&subject="+encodeURIComponent(a)+"&mailDescription="+encodeURIComponent(i)+"&mailDescriptionInPlainText=&editorMode="+encodeURIComponent(n)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),o&&s&&(e=(e=e+"&invType="+encodeURIComponent(o))+"&invRecId="+encodeURIComponent(s)),"Events"==$("#module").val()&&$("#messageId").data("messageId")&&null!=$("#messageId").data("messageId")&&""!=$("#messageId").data("messageId")&&(e=e+"&messageId="+$("#messageId").data("messageId")),$.ajax({url:Crm.getCrmBasePath()+"/mailer/EntReply.do",data:e,type:"POST",success:function(e){-1!=e.indexOf("success")?(crmui.showMsgBand("success",I18n.getMsg(e),4e3),simpleEmail.ClosePopup()):-1!=e.indexOf("dayLimitReached")?crmui.showMsgBand("error",I18n.getMsg(e),4e3):-1!=e.indexOf("from Address")?crmui.showMsgBand("error",I18n.getMsg("crm.mail.from.invalid"),4e3):-1!=e.indexOf("To Address contains Blocked Email")?crmui.showMsgBand("error",I18n.getMsg("crm.unsubscription.event.sendmail.blocked"),4e3):-1!=e.indexOf("Maximum_Limit_Exceeded")?(crmui.showMsgBand("error",I18n.getMsg("workflow.webHook.failures.dayLimitReached"),4e3),$(".simpleEmail_submit").find(".primarybtn").addClass("disable")):crmui.showMsgBand("error",I18n.getMsg("crm.unable.to.process.request"),4e3),Crm.trackSpotLightAction("Sticky Notes - Mail Sent Successfully")}})}},simpleEmail.CheckContents=function(){var e=editor.getContent();if(e.length>32e3)return alert(I18n.getMsg("crm.template.email.content","32,000")),!1;var t=getObj("toAddress");if(t.value=t.value.replace(/\s+/g,""),getObj("toAddress").value=t.value,0==t.value.length){var r=I18n.getMsg("crm.label.to.email");return alert(I18n.getMsg("crm.field.empty.check",r)),t.setAttribute("autocomplete","off"),t.focus(),!1}for(var a=t.value.split(","),i=a.length,n=0;n<a.length;n++){var o=a[n];if(""!=o&&!validationUtils.isValidEmail(o)){r=I18n.getMsg("crm.label.to.email");return alert(I18n.getMsg("crm.field.valid.check",r)),t.setAttribute("autocomplete","off"),t.focus(),!1}""==o&&(i-=1)}if(i>10)return alert(I18n.getMsg("crm.email.to.check")),!1;var s=getObj("subject");if(0==s.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var l=I18n.getMsg("crm.label.subject");return alert(I18n.getMsg("crm.field.empty.check",l)),s.setAttribute("autocomplete","off"),s.focus(),!1}if(s&&s.value.length>250){var d=s.value;s.value=d.substring(0,250)}return"Script tags found"!=e&&(getObj("editorMode").value=editor.mode,getObj("description").value=e,!0)},simpleEmail.SendMailPopup=function(e,t,r,a,i,n){if(t)var o="action=emailPopup&toAddress="+encodeURIComponent(e)+"&subject="+encodeURIComponent(t)+"&module="+a;else o="action=emailPopup&toAddress="+encodeURIComponent(e)+"&module="+a;null!=r&&(o=o+"&inviteeId="+encodeURIComponent(r),i&&(o=(o=o+"&invType="+encodeURIComponent(i))+"&invRecId="+encodeURIComponent(n))),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/mailer/EntReply.do",data:o,type:"POST",success:function(e){commonUtils.showHideLoadingDiv();var t=$("#emailInviteesPop");0==t.length?(t=$('<div id="emailInviteesPop" class="newpopup maxW600 zi30 p25 invstatus" style="display:none;overflow:hidden"></div>'),$("body").append(t)):$(t).empty(),t[0].innerHTML=e,t.show(),EvalInnerScript(t[0]),setTimeout((function(){editor.setContent($("#bodyContent").data("mailBody")),editor.focusAtStart()}),500)},error:function(){commonUtils.showHideLoadingDiv()}})},simpleEmail.ClosePopup=function(){$("#emailInviteesPop").hide(),$("#viewInviteesPop").is(":visible")||$("#stNotes").is(":visible")||renderingUtils.removeFreezeLayer()},simpleEmail.InitMail=function(){editor=ZE.create({id:"emailEditor",editorheight:200}),$(".ze_area").css("height",200),renderingUtils.freezeBackground(),mailsetCenter("emailInviteesPop")},Crm.sharedworker={},Crm.sharedworker.cache={},Crm.sharedworker.makeRequest=function(e,t,r,a){"undefined"!=typeof Crmworker?Crmworker.port.postMessage({action:e,Key:t,KeyValue:r,params:a}):"Put"===e&&(Crm.sharedworker.cache[t]=r)},Crm.getUserDetailsMap=function(e,t){if(Crm.userDetailsMap?t&&t(Crm.userDetailsMap):void 0===InfoForDisplay?loadDataForDisplayAndMentions(!1,!0,!1,e,(function(){Crm.constructUserDetailsMap(),t&&t(Crm.userDetailsMap)})):(Crm.constructUserDetailsMap(),t&&t(Crm.userDetailsMap)),!e)return Crm.userDetailsMap},Crm.constructUserDetailsMap=function(){if(Crm.userDetailsMap={},InfoForDisplay)for(var e=JSON.parse(InfoForDisplay),t=Crm.userDetails.NAME_FORMAT,r=t.indexOf("First")<t.indexOf("Last"),a=e.length,i=0;i<a;i++){var n=e[i],o={};if(r)var s=(n.firstName&&0!=n.firstName.length?n.firstName+" ":"")+n.lastName;else s=(n.lastName&&0!=n.lastName.length?n.lastName+" ":"")+n.firstName;o.name=s,o.avatar=n.avatar,Crm.userDetailsMap[n.id]=o}},Crm.bindEventForUserBCView=function(){var e=$("[purpose=showUserBC]");e.off("mouseover").mouseover(showUserBusinessCard),e.off("mouseout").mouseout(hideUserBusinessCard)},Crm.getUserBusinessCard=function(e,t){var r=document.getElementById("popoverTooltip");r||((r=document.createElement("crux-user-tooltip")).setAttribute("id","popoverTooltip"),r.style.display="none",t.append(r)),r.setData({userId:e}),r.component.show(t)},Crm.resetSubformFields=function(e){if(crmTab.tabVsSubTabs&&crmTab.tabVsSubTabs[e]){var t=crmTab.tabVsSubTabs[e];if(t&&t.length>0)for(var r=0;r<t.length;r++)this.fieldsObj[e+"_"+t[r]]=[]}},Crm.loadChatIntegrations=function(e,t,r,a,i){if(i&&"workflow"===r){var n=i.details?i.details.edit_allowed:void 0;i=Lyte.registeredMixins["crm-automation-actions"].getDataParamForWFChat(i)}if(i&&("orchestration"===r||"CommandCenterService"===r)){n=i.edit_allowed;i=Lyte.registeredMixins["crm-automation-actions"].getDataParamForWFChat(i)}if(!i&&t&&(i=JSON.parse($(t).attr("data-params"))),a=!a&&i?i.chatType:a,"workflow"===(r=r||i.reqFrom)||"orchestration"===r||"CommandCenterService"===r)"Cliq"===a||"cliq_notifications"===a?a="cliq":"Slack"===a||"slack_notifications"===a?a="slack":"CiscoTeams"===a||"cisco_notifications"===a?a="cisco":"GoogleChat"===a||"google_chat_notifications"===a?a="google_chat":"MicrosoftTeams"!==a&&"microsoft_teams"!==a&&"microsoft_teams_notifications"!==a||(a="microsoft_teams");else if(["0","1","2","3","4"].contains(a)){var o={0:"cliq",1:"slack",2:"cisco",4:"microsoft_teams",3:"google_chat"};a=o[a.toString()]}if("cisco"!=a||"false"!=cisco.isCiscoTeamsAuthorised){if("microsoft_teams"!==a||"SupportProfileInternal"!==Crm.userDetails.PROFILE_NAME&&!Crm.userDetails.isSupportAccessExitSessionEnabled){if(arguments[5])var s=arguments[5];if(crmConstants.isAnyChatNotificationAvailable){var l=!0,d=this,c=networkUtils.returnDependencyFiles(["chat-integ-store.js","slack-setup-store.js","chat-setup-store.js","google-chat.js","crm-chat-popup.js","chat-bc-store.js","chat-mixin.js","crm-chat-view.js"],ResourceConstants.CRMClient);c=(c=(c=c.concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations"),networkUtils.getI18nJSUrl("ChatIntegrationAuthError")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("GoogleChat")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MicrosoftTeams")],ResourceConstants.CRM));var m=networkUtils.returnDependencyFiles(["crm-chat-popup.css"],ResourceConstants.CRMClient);Lyte.injectResources(c.concat(m),void 0,(function(){var e=function(){var e=document.getElementsByTagName("crm-chat-popup")[0],t={source:r,type:a,isWorkFlowOrOrch:"workflow"===r||"orchestration"===r||"CommandCenterService"===r},o=function(){Crm.renderChatPopup(e,t)};if("microsoft_teams"!==a||"false"!==microsoft_teams.isMicrosoftTeamsAuthorised){if("analytics"===r){if(i.isHome){t.chartId=i.dbItemId,t.layoutId=i.layoutid;var c=document.getElementById(t.layoutId);t.dashboardId=JSON.parse(c.getAttribute("data-params")).dashboardId}else{t.dashboardId=i.dbId,t.chartId=i.id,t.layoutId=void 0;c=document.getElementById(t.chartId)}if(t.chartName=i.name?i.name:c.querySelector(".widgetHeading").innerText.trim(),"cliq"===t.type&!CrmAnalytics.isCliqAuthorized){l=!1;var m={successFn:[o],failureFn:void 0,context:d};Lyte.registeredMixins["crm-chat-mixin"].linkChatAccount(!1,m)}"google_chat"===t.type&&(l=!1,store.findAll("gchat_config").then((function(e){e.authenticated?(l=!0,o()):openPopUp("authGoogle","",e.authorization_url,"GoogleAuth",600,500,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")})))}else if("voc"===r){if(t.dashboardId=i.dbId,t.chartId=i.id,t.chartName=i.name,t.chartData=i.chartData,"cliq"===t.type&!i.isCliqAuthorized){l=!1;m={successFn:[o],failureFn:void 0,context:d};Lyte.registeredMixins["crm-chat-mixin"].linkChatAccount(!1,m)}"google_chat"===t.type&&(l=!1,store.findAll("gchat_config").then((function(e){e.authenticated?(l=!0,o()):openPopUp("authGoogle","",e.authorization_url,"GoogleAuth",600,500,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")})))}else if("reports"===r){if(t.chartName=i.chartName,t.chartId=i.reportId,"cliq"===t.type&!CrmAnalytics.isCliqAuthorized){l=!1;m={successFn:[o],failureFn:void 0,context:d};Lyte.registeredMixins["crm-chat-mixin"].linkChatAccount(!1,m)}}else if("record"===r){t.module=i.module,t.id=i.id;var u={type:a,module:i.module,id:i.id},p=function(e){var r=function(e){var r=networkUtils.returnDependencyFiles(["crm-chat-bc.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles(["crm-chat-bc.css"],ResourceConstants.CRMClient)),Lyte.injectResources(r,void 0,(function(){t.bcDetails=e,Crm.renderChatPopup(document.getElementsByTagName("crm-chat-popup")[0],t)}))};"google_chat"===u.type?store.findAll("gchat_config").then((function(t){t.authenticated?r(e):openPopUp("authGoogle","",t.authorization_url,"GoogleAuth",600,500,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")})):r(e)},v=function(){store.findAll("chat_bc",u,!1).then(p,g)},g=function(e){var t=JSON.parse(e.response);if(t=t.chats?t.chats[0]:t,e.type=u.type,"APPACCOUNT_NOT_LINK"===t.code){var r={successFn:[v],failureFn:void 0,context:this};Lyte.registeredMixins["crm-chat-mixin"].linkChatAccount(!1,r)}else chatIntegration.handleErrorResponse(e)};store.findAll("chat_bc",u,!1).then(p,g),l=!1}else if(("workflow"==r||"orchestration"===r||"CommandCenterService"===r)&&i){var f=Object.keys(i).length>1;if(t.inputData=i.inputData,f||"orchestration"===r){if(n||(l=!1),i.teamid&&(t.teamid=i.teamid,t.slackUserId=i.suserid,t.teamName=i.teamname),i.notifyType="space"===i.notifyType?"channel":i.notifyType,t.notifyType={channel:"chat_channel",user:"chat_user",fields:"fields"}[i.notifyType.toString()],"fields"===t.notifyType){t.notifyModuleId=i.notify_fields.module_id,t.notifyLookupId=i.notify_fields.lookup_field,t.channelOrUser=t.notifyModuleId;var C=i.notify_fields.s_fields,h=i.notify_fields.fields;t.selectedFieldIds=C?C.concat(h):h}else t.userChannelId=i.notifyIds,t.userChannelName=i.name,t.channelOrUser={channel:"chat_channel",user:"chat_user"}[i.notifyType.toString()];t.message=wfmergefield.convertInfoToLabel(i.message,!0),t.editAction=!0}}s&&(t.wfActionModule=s),t.wfStyleModal="workflow"===r||"orchestration"===r||"CommandCenterService"===r;var y=function(){"cliq"!==a||void 0===n||n?l&&Crm.renderChatPopup(e,t):Crm.renderChatViewPopup(t)};"cliq"!==a||"workflow"!==r&&"orchestration"!==r&&"CommandCenterService"!==r?!l||"google_chat"!==t.type||"workflow"!==r&&"orchestration"!==r&&"CommandCenterService"!==r?y():store.findAll("gchat_config").then((function(e){e.authenticated?y():openPopUp("authGoogle","",e.authorization_url,"GoogleAuth",600,500,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")})):(commonUtils.showHideLoadingDiv(!0),store.findAll("chat_setting",!0).then((function(e){commonUtils.showHideLoadingDiv(),e.forEach((function(e){if("cliq"===e.type)if(e.authorized)y();else{var t={successFn:[y],failureFn:void 0,context:d};Lyte.registeredMixins["crm-chat-mixin"].linkChatAccount(!1,t)}}))})))}else chatIntegration.authorise(chatIntegration.MICROSOFT_TEAMS,r)};"slack"==a?networkUtils.loadFeatureScripts(["zohocrm_slackHome.js","zohocrm_chatIntegration.js"],e):e()}))}}}else networkUtils.loadFeatureScripts(["zohocrm_chatIntegration.js"],(function(){cisco.callback=Crm.loadChatIntegrations,cisco.callbackParams=[e,t,r,a,i],chatIntegration.authorise(chatIntegration.CISCO,r)}),"object"==typeof chatIntegration)},Crm.getVisionMyJobsDependency=function(){var e,t=networkUtils.returnDependencyFiles(["crm-ziavision-myjobs.js","crm-image-mixin.js","crm-image-preview.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js","crm-vision-validation.js","crm-vision-create.js","crm-vision-match-utils.js","crm-image-upload-ziaError.js","crm-vision-image-utils.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")],ResourceConstants.CRM);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-ziavision-myjobs.css","crm-image-upload-ziaError.css","crm-ziavision-myjobs-rtl.css","crm-image-preview.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-ziavision-myjobs.css","crm-image-preview.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient),t.concat(e).concat(r)},Crm.renderChatPopup=function(e,t){e?e=e.component.setData(t):Lyte.Component.render("crm-chat-popup",t,"#basic"),document.getElementById("chat-popup").ltProp("show",!0)},Crm.renderChatViewPopup=function(e){var t=document.getElementsByTagName("crm-chat-view");0==t.length?Lyte.Component.render("crm-chat-view",e,"#basic"):t[0].component.setData(e),document.getElementById("chat-view-popup").ltProp("show",!0)},Crm.loadChatIntegrationJSForCalAndSS=function(e,t){crmConstants.isAnyChatNotificationAvailable&&("calendar"!=e&&"workflow"!=e&&"signals"!=e&&"orchestration"!=e||Crm.loadAllChatJS(t))},Crm.loadAllChatJS=function(e){var t=["zohocrm_chatIntegration.js"];crmConstants.isSlackAvailable&&"undefined"==typeof slackNotificationHome&&t.push("zohocrm_slackHome.js"),networkUtils.loadFeatureScripts(t,(function(){e&&e()}))},Urls={},Urls.Salesinbox=Crm.getCrmBasePath()+"/salesinbox/View.do",Crm.showURLChangeAlert=function(e,t){if(crmNewPortal){var r={val:I18n.getMsg("Refresh",[90]),fn:function(){var e=location.href,r=e.indexOf("/crm/"),a=e.substring(0,r+5),i="";i=t||(i=e.substring(r+6)).substring(i.indexOf("/")),location.href=a+crmNewPortal+i}},a="<span class='crm-font-bold crm-heading-font-size'>"+crmNewPortal+"</span>",i=$("#customConfirmationPop");i.find(".aligncenter").removeClass("p60").addClass("p30"),i.find("br").remove(),i.find(".pT30.aligncenter").removeClass("pT30").addClass("pT15");var n={val:I18n.getMsg("Skip")};renderingUtils.showCustomConfirmMessageNewModel("<p class='crm-font-regular crm-heading-font-size crmBaseColor'>"+I18n.getMsg("crm.multiportal.changed1",a)+"</p><p class='crm-font-regular crm-base-font-size crmBaseColor'>"+I18n.getMsg("crm.multiportal.changed2")+"</p>",r,n)}},Crm.isWMSNotifictionForCurrentOrg=function(e){var t="production"===Crm.userDetails.orgEnvType;return"string"==typeof e&&(e=JSON.parse(e)),void 0===e||void 0===e.zgid||"null"===e.zgid||""===e.zgid?t:e.zgid==Crm.userDetails.ZGID+""},Crm.linkToClick=async function(){if(event.preventDefault(),"crm.tab.module.entity.convert"===arguments[0]){if(!featuresAvailable.TEAMSPACE_ENABLED&&!moduleRecordMapping.Contacts.visible){var e=[];return e.push(moduleRecordMapping.Leads.plural_label),e.push(moduleRecordMapping.Contacts.plural_label),crmui.showMsgBand("error",I18n.getMsg("crm.lead.no.conversion",e),1e3),!1}!!arguments[3].showPortalChange&&arguments[3].showPortalChange}if("crm.tab.module.entity"===arguments[0]||"crm.tab.module.entity.detail"===arguments[0]||"crm.tab.requesters.module.index-module.entity.detail"===arguments[0]&&featuresAvailable.PUBLIC_FIELD){var t=event.currentTarget.getAttribute("lt-prop-dp");if(t){var r=JSON.parse(dataParamStr)[1],a=JSON.parse(dataParamStr)[0];if(r&&a&&await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(a,r,event))return!1}}var i=event.currentTarget.getAttribute("lt-prop-target");if(i){var n=$(event.currentTarget).find("a");networkUtils.openUrl(n.attr("href"),i)}else{event.preventDefault();var o=Lyte.Router.transitionTo.apply(Lyte.Router,arguments),s=event.currentTarget.getAttribute("lt-prop-td");s&&(o.data=JSON.parse(s)),"crm.tab.module.entity.clone"===arguments[0]&&Crm.renderDVLyteFlow(arguments[1])&&arguments[3].reqFrom&&(o.data=o.data?o.data:{},o.data.reqFrom=arguments[3].reqFrom)}},Crm.domainUrlProcess={getDomainSuggestion:function(e,t){var r=$("#orgDomainUrl"),a=$("#domainValidatingInfo"),i=$("#domainAvailableInfo"),n=$("#errorMsg_orgDomainUrl"),o=r.data("domainProcessData");if("orgDomainUrl"==t||!o.isDomainUrlManuallyEdited){e=e.toLocaleLowerCase();this.validDomainReq(t,o)&&(o.isDomainSuggReqPending=!0,a.add(i).addClass("dN"),n.remove(),a.removeClass("dN"),this.callValidateDomainAPI(e,"correct_domain").then((function(n){if(n.organizations&&n.organizations[0]){var s,l=n.organizations[0];if("orgName"===t||"Crm_Sandbox_name"===t)s=l.domain_available?e:l.corrected_domain_name,o.isDomainUrlValid=!0,o.domainUrlValiationFailed=!1,o.isSystemReservedDomainName=!1,o.isDuplicateDomainUrl=!1,r.val(s),o.orgDomainUrl_old=s,i.removeClass("dN");else"orgDomainUrl"===t&&(l.domain_available?(o.isDomainUrlValid=!0,o.domainUrlValiationFailed=!1,o.isSystemReservedDomainName=!1,o.isDuplicateDomainUrl=!1,i.removeClass("dN"),$("#errorMsg_orgDomainUrl").remove()):(o.isDomainUrlValid=!1,l.invalid_domain?(o.domainUrlValiationFailed=!0,o.isSystemReservedDomainName=l.system_reserved,o.isDuplicateDomainUrl=!1,commonUtils.showErrorMsg(I18n.getMsg("crm.org.create.access.url.invalid"),r)):(o.domainUrlValiationFailed=!1,o.isSystemReservedDomainName=!1,o.isDuplicateDomainUrl=!0,commonUtils.showErrorMsg(I18n.getMsg("crm.org.create.access.url.dup"),r))));o[t+"_old"]=e,a.addClass("dN"),o.isDomainSuggReqPending=!1}}),(function(){o.isDomainSuggReqPending=!1,a.addClass("dN")})).catch((function(){o.isDomainSuggReqPending=!1,a.addClass("dN")})))}}},Crm.handleProductLineItemUpdate=function(e){var t=$(e).closest("tr"),r=t.data("data-rowid"),a=$(productDetails.sfFldIdSuffix+"BOOKID_"+r),i=t.find("[data-label='"+a.attr("id")+"']");if(e.val().length>0){a.attr("type","text").val("").data("id",""),i.attr("style",""),$(productDetails.sfFldIdSuffix+"QUANTITY_"+r).val(1).trigger("change");var n=$(productDetails.sfFldIdSuffix+"DISCOUNT_"+r);Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted||n.attr({percentage:"0",discType:"percent"}),n.val(0).trigger("change")}else a.attr("type","hidden").val("").data("id",""),i.attr("style","visibility:hidden")},Crm.getPrdTaxDetails=function(e,t){var r="";if(void 0!==e&&e.length>0&&"null"!==e){var a=productDetails.taxIdVsName;if(t)r=e;else for(var i=JSON.parse(e),n=JSON.parse(productDetails.allTaxes),o=JSON.parse(productDetails.newAllTaxes),s=productDetails.taxNameVsId,l=Object.keys(i),d=l.length,c=0;c<d;c++){var m=l[c],u=i[m][0],p=i[m][1],v=s[m];n[m]=p,o[m]&&(o[m][0]=u,o[m][1]=p),a[v]&&(a[v][0]=u,a[v][1]=m),r.length<1?r+=m:r+=";"+m}}return r},Crm.getFldsFromCriteria=function(e,t,r){if(t&&e&&Object.keys(e).length>0)if(e.group)r=this.getFldsFromCriteria(e.group[0],t,r),r=this.getFldsFromCriteria(e.group[1],t,r);else{var a=e.field.api_name;"lookup"!==e.field.data_type&&void 0!==CMB.nCHolder.sFdtls[t].apiLabelVsFldDetailsMap[a]||(a=a.slice(0,a.lastIndexOf("."))),CMB.nCHolder.sFdtls[t].apiLabelVsFldDetailsMap[a]&&r.push(CMB.nCHolder.sFdtls[t].apiLabelVsFldDetailsMap[a].field_label)}return r},Crm.changeBundlesApiVersion=function(e,t){var r=t||"v2.2";return e.includes("v2")?e.includes("v2.1")?e=e.replace("v2.1",r):e.includes("v2.2")?e=e.replace("v2.2",r):e.includes("v2")&&(e=e.replace("v2",r)):e.includes("v3")?e=e.replace("v3",r):e.includes("v4")&&(e.includes("v4.1")?e=e.replace("v4.1",r):e.includes("v4")&&(e=e.replace("v4",r))),e},Crm.isLineItemSubFormModule=function(e){return"QuotedItems"===e||"OrderedItems"===e||"PurchaseItems"===e||"InvoicedItems"===e},Crm.isInventoryModule=function(e){return"Quotes"===e||"Invoices"===e||"SalesOrders"===e||"PurchaseOrders"===e},Crm.isSubformSupportedModule=function(e){return!(!e||-1!==["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005","CustomModule5006","CustomModule5007","CustomModule5008","CustomModule5009","CustomModule5010"].indexOf(e)||-1===Crm.userDetails.SUBFORM_SUPPORTED_MODULES.indexOf(e)&&!e.startsWith("CustomModule"))},Crm.getDealsStageValue=function(e){if(e&&e.split(":").length>1){var t=e.indexOf(":");e=e.substring(t+1)}return e},Crm.initApprovalActions(),Object.defineProperty(window,"csrfToken",{get:function(){for(var e=Crm.csrfcookiename+"=",t=document.cookie.split(";"),r=t.length,a=0;a<r;a++){for(var i=t[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}},configurable:!0}),Crm.checkMaxLength=function(e,t){var r=e.prop("type");return"text"===r?e.val().length<=t:"Integer"!==r&&"Long"!==r||e.val().replace(/,/g,"").length<=t},Crm.fetchCallDetails=function(e,t,r){var a=isNewCallView?"zcrm_callsnew.js":"zcrm_callsold.js",i=networkUtils.returnDependencyFiles([a],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js"],ResourceConstants.CRMClient)),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("manualcalllist")],ResourceConstants.CRM),o=i.concat(n);Lyte.injectResources(o,void 0,(function(){Calls.fetchCallDetails(e,t,r)}))},Crm.globalCreate=function(e,t,r,a,i,n,o,s){e&&"emailsAI"==t&&(event=e);var l=s?$(e.target):$(event.target);r&&r.getAttribute&&"#manualCallListPopover"===r.getAttribute("lyte-sub-menu")&&(l=$(r));var d=networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js"],ResourceConstants.CRMClient));renderingUtils.stopEvent(event||e),Lyte.injectResources(d,void 0,(function(){Calls.globalCreate(e,t,r,a,i,n,l,o)}))},Crm.scheduledCallMoreOption=function(e,t,r,a){var i=isNewCallView?"zcrm_callsnew.js":"zcrm_callsold.js",n=networkUtils.returnDependencyFiles([i],ResourceConstants.CRM);Lyte.injectResources(n,void 0,(function(){a&&(Calls.callLayoutId=a),Calls.scheduledCallMoreOption(e,t,r)}))},Crm.showLockedRecordCountPopup=function(e,t){var r=networkUtils.returnDependencyFiles(["crm-record-locking-count.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM));Lyte.injectResources(r,void 0,(function(){var r=$L("crm-record-locking-count");r.length&&r[0].remove();var a={show:!0,msg:I18n.getMsg("crm.record.lock.listview.popup",[e,t])};Lyte.Component.render("crm-record-locking-count",a,"#cvpadding")}))},Crm.settingsDependencies=function(e){var t=networkUtils.returnDependencyFiles(["crm-setup.js","crm-setup-mixin.js","crm-setup-data.js","custom_button_model.js","pipeline_picklist_model.js","automation_datahub_module.js","kiosk-execute.js","zia-insights.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["setupjson_clientside.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.js","crm-superadmin-dd-wrapper.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-wf-dependencyfields.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-wf-dependencyfields.css"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["crm-setup.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.css"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["zohocrm_setup.js","zohocrm_auth_domain.js","zohocrm_module_settings_common.js","crm_finance_suite.js","zohocrm_macro_common.js","zohocrm_customView.js","zohocrm_reports.js","zohocrm_dragdropdatareq_Template.js","zohocrm_clientPortalUserLocaleListTemplate.js","zohocrm_integration_home.js"],ResourceConstants.CRM),d=networkUtils.returnDependencyFiles(["crmsetup.css"],ResourceConstants.CRM),c=networkUtils.returnDependencyFiles(["crm-ui-loaders.js"],ResourceConstants.CRMClient),m=networkUtils.returnDependencyFiles(["crm-ui-loaders.css"],ResourceConstants.CRMClient),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("settings")],ResourceConstants.CRM);u=u.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portalmisc")],ResourceConstants.CRM));var p=(l=(l=l.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("smartprompt")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient))).concat(o).concat(c).concat(m).concat(r).concat(u).concat(s).concat(n).concat(d).concat(t).concat(a).concat(i);return e&&(p=[p,...Crm.sectionsDependencies()]),featuresAvailable.NEXTGENUI_ENABLED&&(p=[p,...networkUtils.returnDependencyFiles(["crm-nextgenui-components.js","crm-nextgen-setup-components.js"],ResourceConstants.CRMClient)]),p},Crm.sectionsDependencies=function(){var e=networkUtils.returnDependencyFiles(["crm-setupsidemenu.js","crm-setup-mixin.js","crm-help-link.js","lyte-nav.js","crux-criteria-component.js","crux-criteria-conditions.js","crux-form-component.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-setupsidemenu.css"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crm-modules-list-page.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var r=e.concat(t);return r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_tabsAndFieldsApiNames.js","zohocrm_changeOwner.js"],ResourceConstants.CRM))},Crm.callGoogleValidator=function(e,t,r){if("account_already_configured_With_another_User"===t||"account_already_configured_With_this_User"===t)return crmui.showMsgBand("error",I18n.getMsg("crm.googlechat.authentication.failed",I18n.getMsg("crm.zoho")),5e3),void commonUtils.showHideLoadingDiv();"requested_scopes_not_granted"===t?_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.googlechat.reauthorize.headmsg"),ltPropSecondaryMessage:I18n.getMsg("crm.googlechat.reauthorize.message","CRM"),ltPropButtons:[{type:"accept",appearance:"success",text:I18n.getMsg("crm.nsocial.reauth")},{type:"reject",appearance:"default",text:I18n.getMsg("crm.livedesk.pot.later")}]},accept:function(){return store.findAll("gchat_config").then((function(e){e.authenticated||openPopUp("authGoogle","",e.authorization_url,"GoogleAuth",600,500,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")})),!0},reject:function(){return!1}}):r.callGAppsURL(e,void 0,!0)},Crm.isSupportedModuleForZiaSummary=function(e){return!(!Crm.userDetails.permissions.Crm_Implied_View_Zia_Notes_Summary||!e||!e.startsWith("CustomModule")&&!Crm.ziaSummarySupportedModules.includes(e))},$.fn.outerHTML=function(){var e=$(this);if("outerHTML"in e[0])return e[0].outerHTML;var t=e.wrap("<div></div>").parent().html();return e.unwrap(),t},detailview_log={xhrTiming:[],resourceTime:[],getRes:[]},window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),$.fn.setPopupClass=function(e){$("#"+e+"Popup").removeClass(),$("#"+e+"Popup").addClass("zcrm-content"),$("#"+e+"Header").removeClass(),$("#"+e+"Header").addClass("popup-model-header crm-heading-font-size crm-font-bold crmHeadingColor"),$("#"+e+"Content").removeClass(),$("#"+e+"Content").addClass("popup-model-content"),$("#"+e+"Footer").length>0&&($("#"+e+"Footer").removeClass(),$("#"+e+"Footer").addClass("popup-model-footer")),showAnimatePopup("topBandPopup")};try{["forEach","map","filter","every"].forEach((function(e){[NodeList,HTMLCollection,DOMTokenList,StyleSheetList,CSSRuleList].forEach((function(t){t.prototype[e]||(t.prototype[e]=function(){return Array.prototype[e].apply(this,arguments)})}))}))}catch(e){}var CJS={execScript:function(e,t,r,a,i){if(e.includes(FingerPrint.basePathUrl)&&FingerPrint.isEnabled&&!a){var n=e.split("javascript/")[1].split("?")[0],o=FingerPrint.basePathUrl+ResourceConstants.JAVASCRIPT+"/";if(FingerPrint.isCdnEnabled){networkUtils.cdnUrl=FingerPrint.primaryCdnUrl,crmConstants.isCNCDN&&(networkUtils.cdnUrl=FingerPrint.dynamicCdnUrl);var s=commonUtils.getfingerPrintProperties(n);e=networkUtils.cdnUrl+o+s}else e=o+n}if(r)t();else{var l=document.createElement("script");if(l.onload=l.onreadystatechange=function(){this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onload=this.onreadystatechange=null,t())},e.includes("/crm/")&&(document.domain.indexOf("localzoho.com")>-1||FingerPrint.isCdnEnabled||void 0!==Crm&&Crm.userDetails&&Crm.userDetails.JS_CORS_ENABLED)?(l.src=e+FingerPrint.corsParams,l.setAttribute("crossorigin","anonymous")):l.src=e,i)l.defer=!0,document.getElementsByTagName("body")[0].appendChild(l);else{var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(l,d)}}}},Utils={detachObjects:[],sectionNamesArrayForSearch:[],getMonthEnd:function(e,t){var r=[31,28,31,30,31,30,31,31,30,31,30,31];return 1==e&&(r[1]=t%400==0||t%4==0&&t%100!=0?29:28),r[e]},isValidTime:function(e,t){for(var r=arguments.length,a=/\d*/g,i=0;i<r;i++){if(!a.test(arguments[i]))return!1;if(0==i&&(""===arguments[i]||arguments[i]>23))return!1;if(1==i&&(""===arguments[i]||arguments[i]>59))return!1}return!0},formatTimeVal:function(e){return e=e<10?"0"+e:e},convertTimeTo24HoursFormat:function(e,t){return"am"==(t=t.toLowerCase())?0==e?12:12==e?0:e:"pm"==t?12==e?e:e+12:t==I18n.getMsg("AM").toLowerCase()||I18n.getMsg("am").toLowerCase()==t?0==e?12:12==e?0:e:t==I18n.getMsg("PM").toLowerCase()||I18n.getMsg("pm").toLowerCase()==t?12==e?e:e+12:t==I18n.getMsg("crm.label.morning").toLowerCase()?0==e?12:12==e?0:e:t==I18n.getMsg("crm.label.afternoon").toLowerCase()?12==e?e:e+12:void 0},convertTimeTo12HoursFormat:function(e,t){return"pm"==(t=t.toLowerCase())?e<=12?e:e-12:"am"==t?0==e?12:e:void 0},getDateObject:function(e,t){var r=crmCalendar.getDateObjectFromGivenDateString(e,!0===Crm.isCalendarSchedule?"mm/dd/yyyy":void 0);return t.hrs&&r.setHours(t.hrs),t.mins&&r.setMinutes(t.mins),t.sec&&r.setSeconds(t.sec),r},getTimeDiff:function(e,t){var r=(t.getTime()-e.getTime())/1e3;return{hours:r/3600,minutes:r%3600/60,seconds:r%60}},getTimeArrayWithGivenIntervalNew:function(e,t){var r,a,i,n=new CrmDate;"future"===t?(n.userDisplayMinute<=30?(a=n.userHourIn24hrFmt,i=30):(a=n.userHourIn24hrFmt+1,i=0),r=CrmDateUtils.getCrmDateFromUserTime(n.userDisplayMonth,n.userDisplayDate,n.userDisplayYear,a,i,0)):r=CrmDateUtils.getCrmDateFromUserTime(n.userDisplayMonth,n.userDisplayDate,n.userDisplayYear,0,0,0);var o=r,s=[],l=e;do{var d=o.getTimeInUserPattern(),c=o.userHourIn24hrFmt>11?"PM":"AM",m=[{name:"span",html:d,attr:{diff:0,hrs:d.split(":")[0],mins:o.userDisplayMinute,meridiem:c}}];s.push(m),o=CrmDateUtils.getAfterMinsByCrmdate(l,o)}while("past"===t?!o.isFutureTime():o.isToday());return s},getTimeArrayWithGivenInterval:function(e,t,r,a,i){if(e)r=new Date;else if(!r)r=new Date(2e3,0,1,0,0,0);t=t||30;for(var n=new Date(r),o=new Date(r),s=new Date(n.setDate(n.getDate()+1)).getTime(),l="",d=[];r.getTime()<s;){var c=r.getMinutes(),m=r.getHours(),u="HH:mm"===Crm.userDetails.TIME_FORMAT?m:this.convertTimeTo12HoursFormat(m,Utils.getMeridiem(r)),p=0,v=m>11?"PM":"AM";if("meridiem"==a&&"HH:mm"!==Crm.userDetails.TIME_FORMAT)l=m>11?I18n.getMsg("PM"):I18n.getMsg("AM");else if("timeDiff"==a){var g=this.getTimeDiff(o,r);g.hours>1?(l=g.hours+" "+I18n.getMsg("crm.workflow.scheduler.hours"),p=60*g.hours):1==g.hours?(p=60*g.hours,l=g.hours+" "+I18n.getMsg("crm.workflow.scheduler.hour")):(l=g.minutes+" "+I18n.getMsg("crm.workflow.scheduler.mins"),p=g.minutes)}var f=[{name:"span",html:Utils.formatTimeVal(u)+":"+Utils.formatTimeVal(c)+" ",attr:{diff:p,hrs:"HH:mm"===Crm.userDetails.TIME_FORMAT?m:u,mins:Utils.formatTimeVal(c),meridiem:v}}];if(l&&f.push({name:"span",html:l,attr:{class:"crmNotFoundColor crm-small-font-size pL5"}}),d.push(f),!validationUtils.isEmpty(i)){var C=i.optionHour,h=i.optionMin,y=i.optionName,E="HH:mm"===Crm.userDetails.TIME_FORMAT?C:this.convertTimeTo12HoursFormat(C,C>12?"pm":"am"),_=[{name:"span",html:y,attr:{diff:0,hrs:"HH:mm"===Crm.userDetails.TIME_FORMAT?C:E,mins:Utils.formatTimeVal(h),meridiem:v}}];C==m&&h>=c&&h-c<t&&d.push(_)}r=new Date(r.getTime()+6e4*t)}return d},compareDate:function(e,t,r){var a=new Date(e.getTime());a.setHours(0,0,0,0);var i=new Date(t.getTime());return i.setHours(0,0,0,0),r?i.getTime()-a.getTime()>0:i.getTime()-a.getTime()>=0},compareDateandTime:function(e,t){var r=new Date(e).getTime();return new Date(t).getTime()-r>=1e3},isValidDate:function(e,t,r,a=!1){if(!t)return!1;e=(e=null!=r?r:e).toUpperCase();try{return a?$L.moment(t,e,{i18n:!0}).validate():$L.moment(t,e).validate()}catch(e){return!1}},getTimeStringWithAmPm:function(e){e||(e=new Date);var t=e.getHours(),r=e.getMinutes(),a="";return"HH:mm"===Crm.userDetails.TIME_FORMAT||(a=Utils.getMeridiem(e),t=Utils.convertTimeTo12HoursFormat(t,a)),t<10&&(t="0"+t),r<10&&(r="0"+r),{hrs:t,mins:r,meridiem:a}},getMeridiem:function(e,t){var r=t?"AM":"am";return e.getHours()>=12&&(r=t?"PM":"pm"),r},getDateObjFromDateStr:function(e,t,r=!1){if(!e)return"";if(t||(t=Crm.userDetails.DATE_PATTERN.toUpperCase()),!e.getMonth){var a=new Date;try{a=r?$L.moment(e,t,{i18n:!0}).getDObj():$L.moment(e,t).getDObj()}catch(e){murphy.error(e)}return a||(a=new Date),a}return e},convertDateToUserPattern:function(e,t,r=!1){return t||(t=Crm.userDetails.DATE_PATTERN.toUpperCase()),r?$L.moment(new Date(e)).i18N(t):$L.moment(new Date(e)).format(t)},getDateInUsrViewFormat:function(e,t=!1){e=this.convertUsrtoDefaultDatePattern(e);var r="MMM D, YYYY";return"en_GB"==Crm.userDetails.COUNTRY_LOCALE&&(r="D MMM, YYYY"),this.convertDateToUserPattern(e,r,t)},getCurrentCrmTimeInUserFormat:function(){var e=new Date;return Utils.convertToUserTimezone(e),Utils.getTimeInUserFormat(e)},getDateInUsrLocaleFormat:function(e,t=!1){var r="MMM D, YYYY";new Date(e).getFullYear()===(new Date).getFullYear()&&(r=r.split(",")[0]);var a=this.convertDateToUserPattern(new Date(e),r,t),i=a.slice(0,3);return a.replace(i,I18n.getMsg(i))},getDateInUserDatePattern:function(e,t=!1){return this.convertDateToUserPattern(e,void 0,t)},getDateInGivenPattern:function(e,t){if(!(e&&e instanceof Date))e=new Date;var r=e.getDate()+" "+e.getMonth()+" "+e.getFullYear();return crmCalendar.convertToUserDatePattern(r,t)},getDateInLocaleDefaultFormat:function(e){if(!(e&&e instanceof Date))e=new Date;return crmCalendar.monthNameWithThreeLetter[e.getMonth()].html+" "+e.getDate()+", "+e.getFullYear()},getDateTimeInUsrFmtWithoutLbl:function(e,t){var r=Utils.getDateInUserDatePattern(e);return r+=" "+Utils.getTimeInUserFormat(e,t,!0)},getDateTimeInUserFormat:function(e,t,r,a){var i=Utils.getDateInUserDatePattern(e);return i+=" "+Utils.getTimeInUserFormat(e,t,a)},getUserDateTimeFormatFromServerFormat:function(e){if(e&&"string"==typeof e&&e.match("T")){(e=e.replace(/[+-]\d{2}:\d{2}/,"")).split("-");var t=$L.moment(e.split("T")[0],"YYYY-MM-DD").toDate(),r=(e=e.split("T"))[1]?e[1].split(":"):"";r&&(t.setHours(r[0]),t.setMinutes(r[1]));var a=Utils.getDateTimeInUserFormat(t,!0),i=a.slice(0,3);return a.replace(i,I18n.getMsg(i))}return e},getDateTimeInUserFormatWithI18N:function(e){if(!(e&&e instanceof Date))e=new Date;var t=Utils.getDateInLocaleDefaultFormat(e);return t+=" "+Utils.getTimeInUserFormat(e,!0)},getTimeInUserFormat:function(e,t,r){if("HH:mm"==Crm.userDetails.TIME_FORMAT&&e instanceof Date)return(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());var a=Utils.convertTo12HoursFormatTimeObj(e,t);return r?a.hrs+":"+a.mins+" "+a.meridiem:a.hrs+":"+a.mins+" "+I18n.getMsg(a.meridiem)},convertTo12HoursFormatTimeObj:function(e,t){e||(e=new Date);var r=e.getHours(),a=this.getMeridiem(e,t),i=e.getMinutes();return(r=Utils.convertTimeTo12HoursFormat(r,Utils.getMeridiem(e)))<10&&(r="0"+r),i<10&&(i="0"+i),{hrs:r,mins:i,meridiem:a}},convertUsrtoDefaultDatePattern:function(e,t){if(!e)return"";if(!e.getMonth){var r=Crm.userDetails.DATE_PATTERN.toUpperCase();try{e=$L.moment(e,r,{i18n:!0}).getDObj()}catch(e){murphy.error(e)}}return e},getTimeStrForAllDayReminder:function(){var e=Crm.calPreferences.DAYSTARTSAT.split(":"),t=new Date;t.setHours(parseInt(e[0])-1);var r="";if("HH:mm"===Crm.userDetails.TIME_FORMAT){var a=t.getHours();r=(a<10?"0"+a:a)+":00"}else{var i=Utils.convertTo12HoursFormatTimeObj(t);parseInt(i.hrs)<10&&(i.hrs=i.hrs.substr(1)),r=i.hrs+" "+I18n.getMsg(i.meridiem.toUpperCase())}return r},isToday:function(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},getDayDiff:function(e,t){$.datepicker.formatDate("yy-mm-dd",e);var r=Math.abs(e.getTime()-t.getTime());return Math.ceil(r/864e5)},getMillisecondsToBasicDateProperties:function(e,t){var r=parseInt(e/864e5),a=t?parseInt(e%864e5/36e5):parseInt(e/36e5),i=parseInt(e%36e5/6e4);secs=Math.floor(e%6e4/1e3);var n={};return n.days=r,n.hours=a,n.mins=i,n.secs=secs,n},getProperI18nTimeUnit:function(e,t){return 1!=e&&(t+="s"),e+" "+(t=I18n.getMsg(t))+" "},convertTimeInDoubleToReadableForm:function(e,t){if(!validationUtils.isValidDecimal(e))return e;if(0==(e=parseFloat(e)))return 0;var r=60*e*1e3,a=Utils.getMillisecondsToBasicDateProperties(r,!0),i="";return a.days&&(i+=Utils.getProperI18nTimeUnit(a.days,"day"),delete a.mins,delete a.secs),a.hours&&(i+=t?Utils.getProperI18nTimeUnit(a.hours,t):Utils.getProperI18nTimeUnit(a.hours,"hour"),delete a.secs),a.mins&&(i+=Utils.getProperI18nTimeUnit(a.mins,"min")),a.secs&&(i+=Utils.getProperI18nTimeUnit(a.secs,"sec")),i.trim()},sortDate:function(e,t){return new Date(e)-new Date(t)},sortDateDecending:function(e,t){return new Date(t)-new Date(e)},dateEquals:function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}};function attachDocsIntegCallBackFn(e){var t=e.docObj,r="",a="",i="",n="",o="",s="";$(t).each((function(e,t){"true"==t.isDocumentSharedToMe?(n="upload"==t.service?""==n?t.encryptedId:n+","+t.encryptedId:""==n?t.docId:n+","+t.docId,o=""==o?t.docName:o+","+t.docName,s=""==s?t.service:s+","+t.service):(t.docName=commonUtils.HandleCommaInFileName(t.docName),r=""==r?t.docId:r+","+t.docId,a=""==a?t.docName:a+","+t.docName,i=""==i?t.service:i+","+t.service)}));var l=Crm.getCrmBasePath()+"/Status.do",d=$("#entId"),c=$("#id"),m=d.length?d.val():c.length?c.val():null,u="docIds="+r+"&docNames="+encodeURIComponent(a)+"&services="+i+"&id="+m+"&sharedDocIds="+n+"&sharedDocNames="+o+"&sharedServices="+s;fileupload.fromFileUploadField&&(u=u+"&fromFileUploadField=true&fieldId="+fileupload.fieldID),fileupload.fromFileUploadField=!1,$.ajax({type:"POST",url:l,data:u,success:function(e){var t=document.createElement("DIV");t.style.display="none",document.body.appendChild(t),t.innerHTML=e,JSEvalScript(t)}})}jQuery.fn.clonewithvalues=function(){var e=jQuery.fn.clone;return function(){for(var t=e.apply(this,arguments),r=this.find("textarea").add(this.filter("textarea")),a=t.find("textarea").add(t.filter("textarea")),i=this.find("select").add(this.filter("select")),n=t.find("select").add(t.filter("select")),o=0,s=r.length;o<s;++o)$(a[o]).val($(r[o]).val());for(o=0,s=i.length;o<s;++o)n[o].selectedIndex=i[o].selectedIndex;return t}}(),Utils.updateDateTimeUI=function(e,t){var r=$("#"+e);t||(t=r.data("dateObj")?r.data("dateObj"):new Date),r.val(Utils.getDateInUserDatePattern(t)),r.data("dateObj",t),Utils.updateTimeUI(e+"_TimeOption")},Utils.updateTimeUI=function(e){var t="HH:mm"===Crm.userDetails.TIME_FORMAT,r=$("#"+e.substr(0,e.indexOf("_TimeOption"))).data("dateObj")||new Date,a=t?Utils.getTimeStringWithAmPm(r):Utils.convertTo12HoursFormatTimeObj(r);$("#"+e).val(a.hrs+":"+a.mins+" "+I18n.getMsg(a.meridiem.toUpperCase()))},Utils.getTimeDiffInFormats=function(e,t){var r=Math.abs(t-e)/1e3,a={},i={month:2592e3,day:86400,hours:3600,minutes:60,seconds:1};return Object.keys(i).forEach((function(e){a[e]=Math.floor(r/i[e]),r-=a[e]*i[e]})),a},Utils.convertToUserTimezone=function(e){var t=e.getTimezoneOffset(),r=Utils.getTimezoneOffset();if(r!==t){var a=t-r;e.setMinutes(e.getMinutes()+a)}},Utils.convertToOrgTimezone=function(e){var t=e.getTimezoneOffset(),r=Utils.getTimezoneOffset(Crm.userDetails.ORGTIME_ZONE);if(r!==t){var a=t-r;e.setMinutes(e.getMinutes()+a)}},Utils.getTimezoneOffset=function(e){var t=e||Crm.userDetails.TIME_ZONE,r=!1;t.indexOf("+")>-1&&(r=!0),t=t.replace("+","").replace("-","");var a=60*parseInt(t),i=t.split(".")[1],n=a+(i=parseInt(i));return r&&(n*=-1),n},function(e){var t=e.fn.html;e.fn.html=function(){return arguments.length>=1&&e(this).empty(),t.apply(this,arguments)}}(jQuery),function(e){var t=e.fn.position;e.fn.position=function(r){if(r&&r.of)return t.apply(this,arguments);if(this[0]){var a,i,n=this[0],o={top:0,left:0};if("fixed"===jQuery.css(n,"position"))i=n.getBoundingClientRect();else{a=this.offsetParent(),i=this.offset(),jQuery.nodeName(a[0],"html")||(o=a.offset());var s=e(a).eq(0).css(["borderTopWidth","borderLeftWidth"]),l=parseFloat(s.borderTopWidth);l=isFinite(l)?l||0:s.borderTopWidth;var d=parseFloat(s.borderLeftWidth);d=isFinite(d)?d||0:s.borderLeftWidth,o={top:o.top+l,left:o.left+d}}var c=e(n).css(["marginTop","marginLeft"]),m=parseFloat(c.marginTop);m=isFinite(m)?m||0:c.marginTop;var u=parseFloat(c.marginLeft);return u=isFinite(u)?u||0:c.marginLeft,{top:i.top-o.top-m,left:i.left-o.left-u}}}}(jQuery),function(e){var t=e.fn.empty;e.fn.empty=function(){return thirdPartyUtils.unbindChildEvents(this),t.apply(this,arguments)}}(jQuery),function(e){var t=e.fn.remove;e.fn.remove=function(){return thirdPartyUtils.unbindChildEvents(this),t.apply(this,arguments)}}(jQuery),function(e){e.fn.filterByData=function(t,r){return void 0===r?this.filter((function(){return void 0!==e(this).data(t)})):this.filter((function(){return e(this).data(t)==r}))}}(jQuery),Utils.getTimestamp=function(){return window.performance?performance.now():+new Date},Utils.getUtcDateObj=function(e){var t=new Date(e),r=t.getTime(),a=6e4*t.getTimezoneOffset();return new Date(r+a)},Utils.getDisplayDateTime=function(e,t){var r=new Date;if(r.getFullYear()-e.getFullYear()==0&&r.getMonth()-e.getMonth()==0)switch(r.getDate()-e.getDate()){case 0:if(t){var a=r.getTime()-e.getTime(),i=a/36e5;if(i<1){var n=a/6e4;return n<1?"Now":Math.floor(n)+" mins ago"}return Math.floor(i)+" hrs ago"}return"Today";case 1:return"Yesterday"}var o="d M";return e.getFullYear()!=r.getFullYear()&&(o="d M yy"),$.datepicker.formatDate(o,e)},Utils.getDateTimeForEntity=function(e){var t,r=new Date(e),a=Utils.getUtcDateObj(r.getTime()),i=Utils.getUtcDateObj((new Date).getTime());Crm.userDetails.TIME_FORMAT;return a.getDate()===i.getDate()?Utils.getTimeInUserFormat(r,!0):(t=a.getFullYear()===i.getFullYear()?"d M":"d M yy",$.datepicker.formatDate(t,r))},Utils.getDateTimeForEntityHover=function(e){var t=new Date(e),r=(Crm.userDetails.TIME_FORMAT,Crm.userDetails.LOCALE.split("_")[0]);return("ja"!==r&&"zh"!==r?$.datepicker.formatDate("D d M yy",t):crmCalendar.convertToUserDatePattern(e))+" "+Utils.getTimeInUserFormat(t,!0)},Utils.convertDateToGivenPattern=function(e,t){return $.datepicker.formatDate(e,new Date(t))},Utils.getMonth=function(e){switch(e+1){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December"}},Utils.convertFrom8601DateFormat=function(e){var t=new Date(e),r=Utils.getTimezoneOffset();return t.setMinutes(t.getMinutes()+r),t},Utils.ISO8601toDateObject=function(e){var t,r,a=e,i=null,n=null;return n=a.substring(a.length-6),r=a.substring(0,a.length-6),i=n.split(":"),newHr=parseInt(i[0].substring(1)),sign=i[0].substring(0,1),i[1]=parseInt(i[1]),t=new Date(r).getTime(),new Date(t)},Utils.convertTimeStrToRequiredFormat=function(e){var t=Crm.userDetails.TIME_FORMAT,r="00",a="01",i="AM",n=null,o=null;if("HH:mm"!=t){if(r=(o=(n=e.split(" "))[0].split(":"))[1],a=o[0],!(i=n[1])){r=(o=e.split(":"))[1];var s=parseInt(o[0]);if(s>=12)a=""+(s>12?s-12:s),i="PM";else a=s+"",i="AM"}"0"==a&&"AM"==i&&(a="12")}else a=(o=e.split(":"))[0],r=o[1];"HH:mm"==t&&(r.indexOf("PM")>0||r.indexOf("AM")>0)&&(r.indexOf("PM")>0&&12!=parseInt(a)&&(a=""+(12+parseInt(a))),r=r.substring(0,r.indexOf(" ")),"12"==a&&e.indexOf("AM")>0&&(a="00")),1==a.length&&(a="0"+a);var l=a+":"+r;return l+="HH:mm"==t?"":" "+i};var tempJQr=$.Event.prototype.stopPropagation;$.Event.prototype.stopPropagation=function(e){var t=Lyte.registeredMixins["crm-browser-version-check"].getBrowserDetails();null==this.currentTarget&&null==this.currentTarget||null==this.currentTarget.attributes&&null==this.currentTarget.attributes||null!=this.currentTarget.attributes.isOpenerNotNeeded&&0!=this.currentTarget.attributes.isOpenerNotNeeded||null==this.currentTarget.attributes.href||null!=this.currentTarget.attributes.rel&&""!=this.currentTarget.attributes.rel||null==this.currentTarget.attributes.target||"_blank"!=this.currentTarget.attributes.target||("Chrome"===t.name&&t.version>=49||"Firefox"===t.name&&t.version>=52||"Safari"===t.name&&t.version>=10||"OPR"===t.name&&t.version>=36)&&(this.currentTarget.attributes.rel="noopener"),tempJQr.call(this)};var tempNativ=Event.prototype.stopPropagation;Event.prototype.stopPropagation=function(e){var t=Lyte.registeredMixins["crm-browser-version-check"].getBrowserDetails();null==this.currentTarget&&null==this.currentTarget||null==this.currentTarget.attributes&&null==this.currentTarget.attributes||null!=this.currentTarget.attributes.isOpenerNotNeeded&&0!=this.currentTarget.attributes.isOpenerNotNeeded||null==this.currentTarget.attributes.href||null!=this.currentTarget.attributes.rel&&""!=this.currentTarget.attributes.rel||null==this.currentTarget.attributes.target||"_blank"!=this.currentTarget.attributes.target||("Chrome"===t.name&&t.version>=49||"Firefox"===t.name&&t.version>=52||"Safari"===t.name&&t.version>=10||"OPR"===t.name&&t.version>=36)&&(this.currentTarget.attributes.rel="noopener"),tempNativ.call(this)},Utils.getCurrentDomain=function(){return window.location.protocol+"//"+window.location.host},Utils.getCustomisedSingularLabel=function(e){var t=Crm.moduleInfo,r="Deals"===e?"Potentials":e;return t[r]?t[r].translatedSingularLabel:e},Utils.getQueryParamsFromUrl=function(e){var t={};if(e){var r=e.split("?")[1];"string"==typeof r&&(t=Utils.convertStrQueryparamsToJSON(r))}return t},Utils.convertStrQueryparamsToJSON=function(e){var t={};try{e.split("&").forEach((function(e){2===(e=e.split("=")).length&&(t[e[0]]=e[1])}))}catch(e){}return t},Utils.getMatchedRow=function(e,t,r){if(Array.isArray(e))for(var a=e.length,i=0;i<a;i++)if(e[i][t]==r)return e[i]},Utils.inverseKeyValues=function(e){var t={};for(var r in e)t[e[r]]=r;return t},Utils.removeDuplicates=function(e){var t={};return e.forEach((function(e){t[e]=!0})),Object.keys(t)},Utils.updateObject=function(e,t,r){t.forEach((function(t){e[t]=r}))},Utils.removeKeysFromGivenObj=function(e,t){t.forEach((function(t){e.hasOwnProperty(t)&&delete e[t]}))},Utils.convertTimeValueTo24HourFormat=function(e){var t=e.split(":"),r=t[0].trim(),a=t[1].split(" "),i=a[0].trim();return null==a[1]||a[1].toUpperCase()!=I18n.getMsg("AM").toUpperCase()&&"AM"!=a[1].toUpperCase()||"12"!=r||(r="0"),null!=a[1]&&(a[1].toUpperCase()==I18n.getMsg("PM").toUpperCase()||"PM"==a[1].toUpperCase())&&Number(r)<12&&(r=Number(r)+12),Number(r)<10&&r.toString().length<2&&(r="0"+r),r+":"+i},Utils.getTimefromMillisecs=function(e,t){if(null!=e){var r=Utils.getMillisecondsToBasicDateProperties(e,!0),a="";return r.days&&(a+=i(r.days,"day")),r.hours&&(a+=i(r.hours,"hour")),(r.days||r.hours)&&0==r.mins||(t?(r.mins&&(a+=i(r.mins,"minute")),a+=i(r.secs,"second")):a+=i(r.mins,"minute")),a.trim();function i(e,t){return e+" "+(t=I18n.getMsg(e>1?t+"s":t))+" "}}},Utils.windowLocationReload=function(e){var t=window.location.href;if(-1===t.indexOf("frameorigin")){var r=Utils.getUpdatedFrameOriginURL(t);r!==t&&history.replaceState(history.state,"",r)}window.location.reload(e)},Utils.windowLocationHref=function(e){window.location.href=Utils.getUpdatedFrameOriginURL(e)},Utils.getUpdatedFrameOriginURL=function(e){if(-1===e.indexOf("frameorigin")&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL){var t=CrmPlusLib.getFrameOriginForURL();t&&(e+=-1===e.indexOf("?")?"?":"&",e+="frameorigin="+t)}return e};var objectUtils={getKeys:function(e){var t=[];if(!e)return t;if(Object.keys)t=Object.keys(e);else for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t},findKey:function(e,t){return Object.keys(e).filter((function(r){return e[r]===t}))[0]},parseURLParamString:function(e){var t,r,a,i,n={};for(a=0,i=(t=e.split("&")).length;a<i;a++)r=t[a].split("="),n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return n},URL:function(e){var t={},r=[],a=(r=e.split("?")[1])?r.split("&"):[];return{getParams:function(){for(var e in a)if(a.hasOwnProperty(e)){var r=a[e].split("=");t[r[0]]=decodeURIComponent((r[1]||"").replace(/\+/g," "))}return t}}},cloneObject:function(e){var t={};for(var r in e){var a=e[r];if(jQuery.isPlainObject(a))a=this.cloneObject(a);else if(jQuery.isArray(a)){for(var i=[],n=a.length,o=0;o<n;o++)jQuery.isPlainObject(a[o])?i.push(this.cloneObject(a[o])):i.push(a[o]);a=i}t[r]=a}return t},cloneObject_new:function(e){return e&&"function"==typeof e.clone?e.clone():objectUtils.deepClone(e,[],[],!0)},removeKeyFromGivenObj:function(e,t){return e.hasOwnProperty(t)&&delete e[t],e},addKeyToGivenObj:function(e,t,r){return e.hasOwnProperty(t)||(e[t]=r),e},getLength:function(e){return objectUtils.getKeys(e).length},convertArrayToMap:function(e){var t={};return e.forEach((function(e){t[e]=!0})),t},convertKeys:function(e,t){for(var r in t){var a=t[r],i=e[r];r!=a&&void 0!==i&&(e[a]=i,delete e[r])}},getValueFromObj:function(e,t){if(e){if(Array.isArray(t)){for(var r=t.length,a=0;a<r;a++){if(!e)return;e=e[t[a]]}return e}return e[t]}},jsonToQueryParam:function(e){return"object"==typeof e?Object.keys(e).map((function(t){return t+"="+e[t]})).join("&"):""},getMatchedObject:function(e,t,r){var a;return e.every((function(e){return e[t]!==r||(a=e,!1)})),a},getMatchedKey:function(e,t){for(var r in e)if(e[r]===t)return r},deepClone:function(e,t,r,a){if(e&&"function"==typeof e.clone)return e.clone();var i=objectUtils.typeOf(e),n=function(n){for(var o=t.length,s=0;s<o;){if(e===t[s])return r[s];s+=1}if(t[s+1]=e,r[s+1]=n,"Array"===i)e.forEach((function(e){n.push(a?objectUtils.deepClone(e,t,r,!0):e)}));else for(var l in e)n[l]=a?objectUtils.deepClone(e[l],t,r,!0):e[l];return n};return"Object"===i?n({}):"Array"===i?n([]):"Date"===i?new Date(e.valueOf()):"RegExp"===i?objectUtils.cloneRegExp(e):/^HTML.*Element$/.test(i)?e.cloneNode():e},cloneRegExp:function(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))},typeOf:function(e){return null==e?"Null":null==e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}};Array.prototype.contains&&!window.Encryptionenabled||(Array.prototype.contains=function(e){for(var t=this.length,r=0;r<t;r++)if(this[r]==e)return!0;return!1}),Array.prototype.pushUniqValues||(Array.prototype.pushUniqValues=function(e){return-1===this.lastIndexOf(e)&&(this.push(e),!0)}),Array.prototype.removeLastOccurenceOfElement||(Array.prototype.removeLastOccurenceOfElement=function(e){var t=this.lastIndexOf(e);return-1!==t&&(this.splice(t,1),!0)}),Array.prototype.removeFirstOccurenceOfElement||(Array.prototype.removeFirstOccurenceOfElement=function(e){for(var t=this.length,r=0;r<t;r++)if(this[r]===e){this.splice(r,1);break}}),Array.prototype.removeArrayElements||(Array.prototype.removeArrayElements=function(e){for(var t=e.length,r=0;r<t;r++)this.removeLastOccurenceOfElement(e[r]);return this}),Array.prototype.deleteElementAt||(Array.prototype.deleteElementAt=function(e){-1!==e&&this.splice(e,1)}),Array.prototype.filterWithLimit||(Array.prototype.filterWithLimit=function(e,t){for(var r=this,a=[],i=r.length,n=0,o=0;o<i&&(e(r[o],o)&&(a.push(r[o]),n++),!(t&&n>=t));o++);return a}),Array.prototype.sortBy||(Array.prototype.sortBy=function(e){return $u.sortBy(this,e)}),Array.prototype.sortDescOrder||(Array.prototype.sortDescOrder=function(e){return $u.sortBy(this,e).reverse()}),Array.prototype.first||(Array.prototype.first=function(e){return e?this.slice(0,e):this[0]}),Array.prototype.last||(Array.prototype.last=function(e){return e?this.slice(Math.max(this.length-e,0)):this[this.length-1]}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,a=arguments[1],i=a>>0,n=i<0?Math.max(r+i,0):Math.min(i,r),o=arguments[2],s=void 0===o?r:o>>0,l=s<0?Math.max(r+s,0):Math.min(s,r);n<l;)t[n]=e,n++;return t}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),a=r.length>>>0;if(0===a)return!1;var i,n,o=0|t,s=Math.max(o>=0?o:a-Math.abs(o),0);for(;s<a;){if((i=r[s])===(n=e)||"number"==typeof i&&"number"==typeof n&&isNaN(i)&&isNaN(n))return!0;s++}return!1}}),Array.prototype.removeAll||(Array.prototype.removeAll=function(e){for(var t=this,r=e.length,a=0;a<r;a++)t.contains(e[a])&&t.splice(t.indexOf(e[a]),1);return t}),Array.prototype.diff||(Array.prototype.diff=function(e){return this.filter((function(t){return e.indexOf(t)<0}))}),Array.prototype.unique||(Array.prototype.unique=function(){var e=this;return e.filter((function(t,r){return e.indexOf(t)===r}))}),Array.prototype.intersection||(Array.prototype.intersection=function(e){return this.filter((function(t){return e.indexOf(t)>-1}))}),Array.prototype.mapByKey||(Array.prototype.mapByKey=function(e){for(var t=[],r=this.length,a=0;a<r;++a){var i=this[a];i.hasOwnProperty(e)&&t.push(i[e])}return t}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.length>=e.length&&this.substr(this.length-e.length)==e}),String.prototype.removeSpecialChars||(String.prototype.removeSpecialChars=function(){return this.replace(/[^a-zA-Z0-9]+/g,"")}),String.prototype.extractLast||(String.prototype.extractLast=function(){return this.split(/,\s*/).pop()}),String.prototype.getOnlyNO||(String.prototype.getOnlyNO=function(){return this.replace(/[^\d]/g,"")}),String.prototype.firstLetterCap||(String.prototype.firstLetterCap=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),String.prototype.replaceAtIndex||(String.prototype.replaceAtIndex=function(e,t){this.split("")[e]=t}),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)}),String.prototype.replaceBetween||(String.prototype.replaceBetween=function(e,t,r){return this.substring(0,e)+r+this.substring(t)}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});