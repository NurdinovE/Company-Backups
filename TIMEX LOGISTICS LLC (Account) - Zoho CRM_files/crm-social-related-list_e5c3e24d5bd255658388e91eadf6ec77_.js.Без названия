Lyte.Mixin.register("crm-social-integration",{getAllAccountsByCriteria:function(e,t,o,s){var i=store.peekAll("social_related_list")[0].accounts,a=[];return $.each(i,(function(i,n){void 0!==e&&e!==n.network||void 0!==t&&t!==n.type||!(void 0===o||o>=n.perm_type)||void 0!==s&&s!==n.status||a.push(n)})),a},saveProfile:function(e,t,o,s,i){var a=$L("#module").val(),n="Crm_Implied_Edit_"+a;if(s||Crm.userDetails.permissions[n]){if(void 0!==i){var r=$L("#zso_AssociateProfile_"+t+"_search");r.addClass("eventNone"),r.find(".socBtnLoadText").css("visibility","hidden"),r.find(".socBtnLoading").removeClass("dN").addClass("dIB")}var c,l,d=this.getFirstAccountIdByNetwork(e),p={network:e,profiles:{id:t},id:d,automate:s},m={network:e,profiles:{id:t},automate:s},u=$L("crm-social-integ-outer-template");u&&u.length>0&&(l=u[0].component.data),c=l&&"canvas"===l.source?l.record_id:$L("#entityID").val();var f=this;if(o)m.id=t,store.create("social-profile",{},{module:a,entityId:c,saveProfile:!0,id:d,network:e,profiles:{id:t},automate:s}).then((function(e){e.data=e["social-profile"],delete e["social-profile"],f.processSaveProfile(p,e)}));else{var g=store.peekRecord("social-profile",d);g&&g.$.deleteRecord(),m.id=d,m.module=a,m.entityId=c,m.saveProfile=!0,commonUtils.showHideLoadingDiv(!0),store.triggerAction("social-profile","deleteProfile",m,void 0,"DELETE",m).then((function(e){commonUtils.showHideLoadingDiv(!1),crmui.hideTooltip(),f.processDeleteProfile(p,e)}))}}else _cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropDuration:5e3,ltPropMessage:I18n.getMsg("crm.zti.error.notauthendication")}})},getFirstAccountIdByNetwork:function(e,t,o){var s=store.peekAll("social_related_list")[0],i=null;return 1===t||void 0===t?s.brandParent&&void 0!==s.brandParent[e]&&(i=s.brandParent[e],void 0!==o&&s.accIdVsPerm[i]>o&&(i=null)):2!==t&&void 0!==t||void 0===s.personalAcc[e]||(i=s.personalAcc[e]),i},processSaveProfile:function(e,t){if(void 0!==t.data&&t.data.length>0){var o=t.data[0],s=o.details;if(s.profile_id=e.profiles.id,e.profile_id=e.profiles.id,e.account_id=e.id,"SUCCESS"===o.code)this.processProfileInfo(e,{profiles:[o.details.profiles]}),this.changeAfterSaveProfile(e.network,e.profiles.id,s.profiles.screen_name),o.record_image_status&&this.handleErrorCase(o,void 0,void 0);else if("DUPLICATE_DATA"===o.code)if(e.automate){document.getElementsByTagName("crm-social-integ-outer-template")[0].component;0}else{"twitter"===e.network&&this.addRemoveTwitterHandle(void 0,!1),crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.profile.save.error1",Crm.getCrmBasePath()+"/EntityInfo.do?id="+o.details.entityid+"&module="+o.details.module),1e4);var i=$L("#zso_AssociateProfile_"+s.profile_id+"_search");i.removeClass("eventNone"),i.find(".socBtnLoadText").css("visibility",""),i.find(".socBtnLoading").addClass("dN").removeClass("dIB"),button.text(I18n.getMsg("crm.social.integ.profile.associate")).removeClass("outlineprimary newbutton").addClass("primarybtn"),this.socContainMsgBandTop()}else"error"===o.status&&this.handleErrorCase(o,void 0,void 0)}},processProfileInfo:function(e,t){if(void 0!==t&&0!==Object.keys(t).length){t.info=t.profiles[0],$L("#"+e.network+"_integ_filter").show(),$L(".socNwSuggList").css({display:"none"}),$L(".socIntMessage").css({display:"block"}),t.account_id=e.account_id,"twitter"===e.network&&void 0===e.profile_id?(t.profile_id=t.info.id,this.saveProfile("twitter",t.profile_id,!0,!0)):t.profile_id=e.profile_id;var o=this.getAllAccountsByCriteria(e.network,void 0,3,1);objectUtils.getLength(o)>1&&(t.moreAccounts=!0);var s=store.peekAll("social_related_list")[0];$.each(s.accounts,(function(e,o){o.id===t.account_id&&(t.brid=o.brid,t.perm=o.perm_type)})),t.info&&(t.following=t.info.follow_request_sent?t.info.follow_request_sent:t.info.following),$L("#"+e.network+"_leftpanel").empty(),t.marking_id=e.marking_id?e.marking_id:t.info.marking_id,Lyte.Component.render("crm-social-profile-info",t,"#"+e.network+"_leftpanel"),thirdPartyUtils.titleForEllipsis(".socNwName"),"twitter"===e.network?$L("#socStreamTw").removeClass("dN").addClass("dIB").find("span:nth-child(1)").text("@"+t.info.screen_name):"facebook"===e.network&&$L("#socStreamFb").removeClass("dN").addClass("dIB").find("span:nth-child(1)").text(t.info.name)}else{var i=document.getElementsByTagName("crm-social-integ-outer-template")[0].component;i.getSearchInfo("twitter",i.getEntityName(),!0)}},changeAfterSaveProfile:function(e,t,o){switch($L("#"+e+"_integ_filter").show(),e){case"twitter":$L("#twProfile").val(t),$L(".socAssoTwList").removeClass("socialActiveInfo").addClass("dN"),this.addRemoveTwitterHandle(o,!0),$L("#socStreamTw").removeClass("dN").addClass("dIB").find("span:nth-child(2)").text(o);var s=this.getAllAccountsByCriteria("twitter",void 0,3,1),i=this.getTwitterIds(s);i.length>0&&(this.showDMSection(i,t),this.showTweetSection());break;case"facebook":$L("#fbProfile").val(t),$L("#socStreamFb").removeClass("dN").addClass("dIB").find("span:eq(1)").text($("#facebook_name").text())}$L("#social_streams_button").show();var a=document.getElementsByTagName("crm-social-integ-outer-template")[0].component;a.updateSocialObj();var n=a.data.SOCIALPROFILES;void 0===n&&(n={}),n[e]=t,a.setData("SOCIALPROFILES",n),a.fetchSocialInteractions("all")},addRemoveTwitterHandle:function(e,t){var o=$L("#subvalue_TWITTER");if(Crm.userDetails.DETAIL_VIEW_LYTE&&o.length>0)t?o[0].setAttribute("cx-prop-value",e):(o[0].setAttribute("cx-prop-value",""),o[0].classList.add("zcicn-cssIcons"),o[0].classList.add("zcicn_grey_mask"),o[0].classList.add("dv_noDataSign"));else if(o.length>0){var s=$L("#value_TWITTER");if(t){o.html(e),o.attr("href",RebrandLinkUtil.getProperty("TW_URL")+"/"+e);var i=JSON.parse(s.parent().attr("data-params"));delete i.dataObj,i.defaultvalue=e,$("#mouseArea__TWITTER").attr("data-params",JSON.stringify(i)),returnJson.entMetaData.TWHandle=e}else{o.html(""),o.attr("href","");var a=JSON.parse(s.parent().attr("data-params"));delete a.dataObj,a.defaultvalue="",$L("#mouseArea__TWITTER").attr("data-params",JSON.stringify(a)),returnJson.entMetaData.TWHandle=""}}},showDMSection:function(e,t,o,s){var i=this.getAllAccountsByCriteria("twitter",void 0,2,1),a=[];if($.each(i,(function(e,t){a.push(t.id)})),a.length>0){var n,r,c,l=$L("crm-social-integ-outer-template");if(l&&l[0]&&(c=l[0].component.data),c&&"canvas"===c.source)n=c.record_id,r=c.module,t=c.SOCIALPROFILES.twitter?c.SOCIALPROFILES.twitter:t;else{var d=store.peekAll("social_related_list")[0];n=d.record_id,r=d.module,t=d.SOCIALPROFILES.twitter,t=$L("#twProfile").val()}var p={first:!0,accounts:e,entity_id:n,profileId:t},m={module:r,entityId:n};o||(o={ids:a.toString(),per_page:1});var u=this;store.findAll("relation",o,void 0,void 0,m).then((function(e){"processFollowInformation"===s?u.processFollowInformation(p,e):(u.processDMSection(p,e),$L("#socialInteractionNew").length>=1&&crmInteraction.addLyteTabInteraction(document.querySelector("#socialInteractionNew")))}))}},showSendDm:function(e){var t=this.getAllAccountsByCriteria("twitter",void 0,2,1),o=[];if($.each(t,(function(e,t){o.push(t.id)})),o.length>0){var s,i;s=$L("#entityID").val(),i=$L("#module").val();var a={first:!0,accounts:e,entity_id:s,profileId:$L("#twProfile").val()},n={module:i,entityId:s},r={ids:o.toString(),per_page:1};store.findAll("relation",r,void 0,void 0,n).then((function(e){Lyte.registeredMixins["crm-social-integration"].checkForDMSection(a,e)}))}},checkForDMSection:function(e,t){var o=[],s=[],i={},a=null,n=store.peekAll("social_related_list")[0],r=n.TWFollowInfo?n.TWFollowInfo:{},c=n.TWDMInfo?n.TWDMInfo:{};$.each(t,(function(t,l){void 0===l.code&&(l.account_id=l.id,$.each(n.accounts,(function(e,t){t.id===l.account_id&&(l.info=t.info,l.info.perm_type=t.perm_type)})),void 0===r[e.profileId]&&(r[e.profileId]={}),r[e.profileId][l.account_id]=l,l.source&&l.source.can_dm?(o.push(l.account_id),l.info.perm_type<3&&(a=l.account_id,i[l.account_id]=l,void 0===c[e.profileId]&&(c[e.profileId]={}),c[e.profileId][l.account_id]=l)):l.account_id?s.push(l.account_id):l.details&&l.details.account_id&&s.push(l.details.account_id))})),o.length>0&&a&&null!==a&&this.sendDm(a,e.profileId)},processDMSection:function(e,t){commonUtils.showHideLoadingDiv(!1);var o,s=[],i=[],a={},n=null,r=store.peekAll("social_related_list")[0],c=r.TWFollowInfo?r.TWFollowInfo:{},l=r.TWDMInfo?r.TWDMInfo:{};$.each(t,(function(t,o){void 0===o.code&&(o.account_id=o.id,$.each(r.accounts,(function(e,t){t.id===o.account_id&&(o.info=t.info,o.info.perm_type=t.perm_type)})),void 0===c[e.profileId]&&(c[e.profileId]={}),c[e.profileId][o.account_id]=o,o.source&&o.source.can_dm?(s.push(o.account_id),o.info.perm_type<3&&(n=o.account_id,a[o.account_id]=o,void 0===l[e.profileId]&&(l[e.profileId]={}),l[e.profileId][o.account_id]=o)):o.account_id?i.push(o.account_id):o.details&&o.details.account_id&&i.push(o.details.account_id))})),r.$.set("TWFollowInfo",c),r.$.set("TWDMInfo",l);var d=$L("crm-social-integ-outer-template");if(d&&d.length>0&&(o=d[0].component.data),!0===e.first&&!o||"canvas"!==o.source){if(s.length>0&&null!==n){var p=$L("crm-detailview-actions");p&&p.length>0&&p[0].setData("showDm",!0);var m=$L("#social_dmm_popup");if(m.empty(),Crm.userDetails.isRelatedListLyteEnabled)var u=$L('<span id="social_sendDM" name="SendDM"  data-zcqa="sendDM" onclick="crmSocialInteg.sendDm(\''+n+"','"+e.profileId+'\');"  class="newbutton mT5   mR0 w100_per dIB mB5 social_sendDMlistitem readOnlyMode alignLeft">'+I18n.getMsg("crm.social.integ.send.dm")+"</span>");else u=$L('<span id="social_sendDM" name="SendDM"  data-zcqa="sendDM" onclick="crmRelatedList.sendDm(\''+n+"','"+e.profileId+'\');"  class="newbutton mT5   mR0 w100_per dIB mB5 social_sendDMlistitem readOnlyMode alignLeft">'+I18n.getMsg("crm.social.integ.send.dm")+"</span>");m[0].append(u[0]),$L("#social_dmm_group input[type=button]").length>0?(m.addClass("socDMPopDD"),$L(".sendmaildropdown").css("display","inline-block"),$L(".sendmailgroupbtn").addClass("sendDMadded")):$L(".sendmailgroupbtn").css("border-right","none")}}else s.length>0&&$L("#twitterDmDrop").show()},showTweetSection:function(){var e=this.getAllAccountsByCriteria("twitter",void 0,1,1);if(objectUtils.getLength(e)>0){$L("#social_sendTweet").empty();var t={name:"input",attr:{id:"social_sendTweet",name:"SendTweet",type:"button","data-zcqa":"SendTweet",onclick:"crmSocialInteg.addPostDiv('twitter');",value:I18n.getMsg("crm.social.integ.send.tweet"),class:"dN newbutton outlinegreenlight readOnlyMode"}};$L("#fixedBtn").append(renderingUtils.createHTML(t))}},processDeleteProfile:function(e,t){var o;if(void 0!==t.data&&t.data.length>0&&"SUCCESS"===t.data[0].code){var s=$L("crm-social-integ-outer-template")[0].component.data.entity_name;if("undefined"!=typeof returnJson&&void 0!==returnJson.entMetaData&&(o=returnJson.entMetaData.saltName),o&&(s=s.replace(o,"")),!s){var i=$L("crm-detailview-section"),a=$L("crm-detailview-header");s=i.length>0?i[0].component.data.Full_name?i[0].component.data.Full_name:"":a.length>0&&a[0].component.data.entityName?a[0].component.data.entityName:""}s=s.trim(),"facebook"===e.network&&$L(".socAssociatedFb").removeClass();var n=document.getElementsByTagName("crm-social-integ-outer-template")[0].component;this.changeAfterDeleteProfile(e.network),n.getSearchInfo(e.network,s)}},changeAfterDeleteProfile:function(e){$L("#"+e+"_integ_filter").hide();var t=document.getElementsByTagName("crm-social-integ-outer-template")[0].component;switch(e){case"twitter":$L("#twProfile").val("null"),this.addRemoveTwitterHandle(void 0,!1),$L("#socStreamTw").removeClass("dN").addClass("dIB").find("span:nth-child(2)").text(""),$L(".socStreamTwFeeds").html(""),$L("#social_sendDM").empty(),$L(".sendmailgroupbtn").removeClass("sendDMadded"),$L(".sendmaildropdown").css("display","none"),$L("#social_sendTweet").empty(),$("#social_streams_button").hide();break;case"facebook":$L("#fbProfile").val("null"),$L(".socStreamFbFeeds").html(""),$L(".socAssociatedFb").removeClass(),t.setData("fbAssociated",!1)}var o=t.updateSocialObj();0===objectUtils.getLength(o)&&$(".socialBackToInter").addClass("dN").removeClass("dIB"),t.setData("dontHighlightSearch",!1),t.setData("interaction",!1);var s=t.data.SOCIALPROFILES;delete s[e],t.setData("SOCIALPROFILES",s),t.fetchSocialInteractions("all")},preventDefaultChar:function(e){$L("#folwSuggestOuter").is(":visible")&&13===e.which&&e.preventDefault()},preventCursor:function(e){$L("#folwSuggestOuter").is(":visible")&&(38!==e.which&&40!==e.which||e.preventDefault())},processTextPaste:function(e,t){var o=this;window.setTimeout((function(){o.processText(e,t)}),1)},processText:function(e,t,o){sE(event);var s=$L('[button_id="'+e+'"]'),i=$L('[limit_id="'+e+'"]'),a=$L('[text_id="'+e+'"]'),n=a.val();""===n&&((n=o)||(n=a.find("#resp_box").val()));var r=/(ht+tp:\/\/www.|ht+tps:\/\/www.|www.|ht+tp:\/\/|ht+tps:\/\/)?[\w]+(\.[a-zA-Z0-9-:;?_#!]+)+(\/[\w-;\-*._?,'/\\+&amp;%$#:=~@!]*)*/gim,c=0,l=0,d=$L(".socNewTweetPopInput").find("textarea");for(d.length&&d.outerHeight(40).outerHeight(d[0].scrollHeight);;){var p=r.exec(n);if(null===p)break;c++,l+=p[0].length}var m=280;c>0?m=m-23*c-(n.length-l):n&&(m-=n.length);i.html(0===m?"0":m);var u=a.length?a:s,f=u.closest(".socAttachInModal"),g=u.closest(".postResponse"),v=f&&f.length>0?f.find(".socReplyAttImg"):g.find(".socReplyAttImg");return m<0&&!0===t?(s.removeClass("cP").prop("disabled",!0).css("opacity","0.5").css("pointer-events","none"),i.attr("style","color: #D42A1C")):280===m&&(0===v.length||v.length&&v.hasClass("dN"))?(s.removeClass("cP").prop("disabled",!0).css("opacity","0.5").css("pointer-events","none"),i.attr("style","color: #000")):(s.removeClass("eventNone op5").addClass("cP").prop("disabled",!1),s.addClass("cP").prop("disabled",!1).css("opacity","1").css("pointer-events",""),i.attr("style","color: #000")),!0},processTwitterSuggestion:function(e,t,o,s){"undefined"!=typeof crmSocial&&crmSocial.processTwitterSuggestion(e,t,o,s)},removeImage:function(e,t,o,s){var i=$L(e),a=i.parents(".socialCommonPreviewDiv"),n=i.closest(".socAttachInModal");a.addClass("dN"),a.find("img").removeAttr("src").removeAttr("title"),n&&n.length>0?n.find(".socialCommonAttach").val(""):i.closest(".postResponse").find(".socialCommonAttach").val(""),this.processText(t,o,s)},onImageSelected:function(e,t,o,s,i){var a=(e=e||window.event).target.files[0],n=$L(t),r=[];if(s)r[s]=!0;else for(var c=s||$L(".socPopPostImg").find(".networkActive"),l=c.length,d=0;d<l;d++){r[s=c[d].getAttribute("network")]=!0}if(a.size>5242880&&r.twitter||a.size>26214400&&r.facebook||!r.twitter&&!r.facebook)return n.val(""),renderingUtils.showCustomAlert(I18n.getMsg("crm.nsocial.tab.image.maximum"),void 0,!0),!1;var p=this.changeFileName(a),m=n.closest(".socAttachInModal"),u=n.closest(".postResponse"),f=m&&m.length>0?m.find(".socReplyAttImg"):u.find(".socReplyAttImg"),g=m&&m.length>0?m.find(".socialCommonPreview"):u.find(".socialCommonPreview");f.removeClass("dN"),g.attr("title",a.name);var v=new FileReader;v.onload=function(e){g.attr("src",e.target.result)},v.readAsDataURL(p);var y=!1;return r.twitter&&(y=!0),"twitter"===s&&(y=!0),this.processText(o,y,i),p},changeFileName:function(e){var t=e.name.split(".");t=t[t.length-1];var o=e.slice(0,e.size,e.type);return new File([o],"name."+t,{type:e.type})},makeApiCallForFile:function(e,t,o,s,i){var a=Lyte.registeredMixins["crm-social-integration"],n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};jQuery.ajax({type:e,headers:n,url:t,data:o,processData:!1,contentType:!1,dataType:"json",success:function(e){a[s].apply(window,[i,e])},error:function(o){Lyte.registeredMixins["crm-social-integration"].handleErrorCase(e,t,o.responseJSON)}})},handleErrorCase:function(e,t,o){if(commonUtils.showHideLoadingDiv(!1),e)if(e.record_image_status)crmui.showMsgBand("error",I18n.getMsg("crm.social.ziavision.error"),3e3);else{var s=e.responseJSON?e.responseJSON:e.response?JSON.parse(e.response):e,i=void 0!==s.code?s.code:s.status,a={USER_NOT_FOUND:I18n.getMsg("crm.social.integ.error.user.notfound1"),USER_SUSPENDED:I18n.getMsg("crm.social.integ.error.user.suspend1"),USER_TOKEN_SUSPENDED:I18n.getMsg("crm.social.integ.reauth.error1"),RATE_LIMIT_REACHED:I18n.getMsg("crm.social.integ.error.internal"),NEED_REAUTH:I18n.getMsg("crm.social.integ.reauth.error1"),TWITTER_OVER_CAPACITY:I18n.getMsg("crm.social.integ.error.internal"),UNKNOWN_ERROR:I18n.getMsg("crm.social.integ.error.internal"),BLOCKED_BY_USER:I18n.getMsg("crm.social.integ.error.user.blocked1.view"),ID_NOT_FOUND:I18n.getMsg("crm.social.integ.error.tweet.notfound1"),DM_FAILED:I18n.getMsg("crm.social.integ.error.dm.failed1"),LIMIT_TO_FOLLOW:I18n.getMsg("crm.social.integ.error.follow.limit1"),BLOCKED_TO_FOLLOW:I18n.getMsg("crm.social.integ.error.user.blocked1"),TWEET_PROTECTED:I18n.getMsg("crm.social.integ.error.tweet.protected"),TWEET_LIMIT_REACHED:I18n.getMsg("crm.social.integ.error.tweet.limit"),DUPLICATE_STATUS:I18n.getMsg("crm.social.integ.error.tweet.dublicate1"),ACCOUNT_LOCKED:I18n.getMsg("crm.social.integ.error.unlock"),MESSAGE_SIZE_EXCEEDS:I18n.getMsg("crm.social.integ.error.message.limit"),DELETED_TWEET:I18n.getMsg("crm.social.integ.error.tweet.deleted1"),ATTACHMENT_LIMIT_EXCEEDS:I18n.getMsg("crm.social.integ.error.attachment.limit1"),NO_PERMISSION:I18n.getMsg("crm.nsocial.contact.admin"),SENT_OUTSIDE_ALLOWED_WINDOW:I18n.getMsg("crm.social.error.directmessage"),DUPLICATE_FAVOURITE:I18n.getMsg("crm.social.error.duplicatelike"),INSUFFICIENT_STORAGE:I18n.getMsg("crm.newfree.limit.exceed"),INVALID_DATA:I18n.getMsg("crm.social.noperm.or.delete"),LIMIT_EXCEEDED:I18n.getMsg("crm.social.social.limit"),INVALID_PARAM:"Facebook Error Occured"};if(a[i]){if("INVALID_PARAM"===i&&-1!==o.indexOf("facebook")){var n=$L("#facebook_leftpanel");return n.find(".socFbLeftLoadDiv").addClass("dN").removeClass("clearFix"),void n.find(".socFbApiInfoOuter").removeClass("dN")}if(crmui.showMsgBand("error",a[i],3e3),"NEED_REAUTH"===i)-1!==(o=o.split("?")[0]).indexOf("twitter")?this.showReauth("twitter",1,"socAssoTwOp5Icon"):-1!==o.indexOf("facebook")&&this.showReauth("facebook",2,"socAssoFbOp5Icon");else if("USER_SUSPENDED"===i){var r=$L("crm-social-integ-outer-template")[0].component.data,c=r.entity_info.twitter,l=r.SOCIALPROFILES.twitter;c=void 0!==c?"@"+c:"",$L("#twitter_leftpanel").html('<div><span class="socAsssNwIcon socAssoTwIcon dIB vaM"></span><a onclick="sE(event);"><span class="socNwName dIB vaM crmBaseColor cP ellipsistext pL10" id="twitter_name">'+$ESAPI.encoder().encodeForHTMLAttribute(c)+'</span></a><span data-zcqa="social_profile_dissociate" class="socProfDisassociate cP fR mT10 readOnlyMode" onmouseenter="crmui.showTooltip({content:\''+I18n.getMsg("crm.social.button.deassociate","Twitter")+"',isHTML: false,position: 'center'});\" onmouseleave=\"crmui.hideTooltip();\" onclick=\"sE(event);crmSocialInteg.saveProfile('twitter','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(l))+'\',false);" style="top:12px;" ></span></div>'),$L(".socStreamTwFeeds").html(Handlebars.templates.TwitterPosts({showEmpty:!0})),thirdPartyUtils.titleForEllipsis(".socStreamName")}else"TWEET_PROTECTED"!==i&&"BLOCKED_BY_USER"!==i||($L(".socStreamTwFeeds").html(Handlebars.templates.TwitterPosts({showEmpty:!0})),thirdPartyUtils.titleForEllipsis(".socStreamName"))}else crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.error.internal"),3e3)}else crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.error.internal"),3e3)},socContainMsgBandTop:function(){var e=$L(".SOCIALPERSONALITY");if(e.length){var t=e.offset().top-$L("#crm-msg").outerHeight()-30;$L(".socContainMsgBand").css("transform","translate(-50%, "+t+"px)")}},showReauth:function(e,t,o){var s={name:"span",attr:{class:"dB cP readOnlyMode","data-zcqa":e+"_add"},child:[{name:"span",attr:{class:"socialImg socAsssNwIcon "+o+" dIB"}},{name:"span",attr:{class:"dIB vaM crm-base-font-size crmNotFoundColor fs dB mL8"},child:[{name:"text",content:I18n.getMsg("crm.social.button.associate")+" "+e.charAt(0).toUpperCase()+e.slice(1)}]}]};$L("#"+e+"_leftpanel").html(renderingUtils.createHTML(s))},processPost:function(e,t){var o=Lyte.registeredMixins["crm-social-integration"];(t=t.crm_social_comment)[0].id&&(crmui.showMsgBand("success",I18n.getMsg("crm.tw.tweet.success"),3e3),o.socContainMsgBandTop())},processTwitterEntities:function(e){if(void 0!==e.retweeted_status){var t=e.user.name;(e=e.retweeted_status).retweetname=t}return e=this.processTwitter(e)},profileChange:function(e,t){e=$L(e);$L("#socProfileChange").empty();var o=$L("crm-social-change-account");o&&o[0]&&o[0].remove();var s=document.createElement("crm-social-change-account");t.renderAccounts=!0,s.setData(t),"popup"===e.attr("data-attr")?e.closest(".postResponse")[0].after(s):e.closest(".socialCommonImage").append(s)},showTwitterProfiles:function(e,t,o,s){var i=this.getAllAccountsByCriteria("twitter",void 0,t,1),a=$L("#"+s),n=a.closest(".postResponse"),r={accounts:i};r.callbackfn=o,r.param1=s,r.currAccount=n&&n.length?n.attr("account_id"):a.find(".postResponse").attr("account_id"),this.profileChange(e,r),event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation())},postTweet:function(e,t,o,s,i){var a={},n={},r={content:t};n.content=JSON.stringify({posts:[r]}),a.content=JSON.stringify({posts:[r]}),a.accountId=e,a.network="twitter",o&&(a.file=o,a.fileName=o.fileName),a.newTweet=!0;var c=this;store.create("crm_social_comment",n,a).then((function(e){c.processPost(void 0,e);var t=$L("crm-twitter-post-create");t&&t.length>0&&(t[0].component.setData("renderTweetPost",!1),t[0].remove())}),(function(e){store.unloadAll("crm_social_comment"),Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e)}))},toggleResponse:function(e){var t=$L(e),o=$L("crm-twitter-posts")[0].component;if(o.data.currentElem!==e){o.data.currentElem=e,t.closest(".feeds_li").addClass("socRepBg");var s=t.closest(".parentPost"),i=s.find("#response");i.toggle();var a=s.attr("id"),n=o.data.replyText;this.removeImage(s.find(".socRepImgClose"),a,n);var r=i.find(".socStreamReplyInput"),c=i.find("#resp_box"),l=void 0!==r.attr("reply")?r.attr("reply"):"";c.val(l+" ").focus(),void 0!==c[0]&&c[0].setSelectionRange(c.val().length,c.val().length),this.processText(a,void 0,c.val())}o.data.currentElem===e&&(o.data.currentElem=void 0,t.closest(".feeds_li").removeClass("socRepBg"))},processReply:function(e,t){var o=Lyte.registeredMixins["crm-social-integration"];if(t=t.comments?t.comments[0]:t.crm_social_comment?t.crm_social_comment[0]:void 0){var s=document.createElement("crm-twitter-reply-list");s.setData(o.processTwitterEntities(t)),$L("#"+e+"_replies").append(s),o.toggleResponse($L("#"+e).find(".postResponse"));var i=$L("[text_id="+e+"]"),a=i.closest(".postResponse").find(".socRepImgClose");i.val(""),o.removeImage(a,e)}},menuAnimate:function(e){var t=(e=$(e)).outerWidth(),o=e.position().left;e.siblings().removeClass("sel"),e.addClass("sel"),e.siblings(".tabborder").css({width:t,left:o})},showVideoInFrame:function(e,t,o){event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation();var s=$L(e),i=s.closest(".kso_sharedlink");0===i.length&&(i=s.closest(".socIntFbSmallLinkVideo").parent()),i.find(".socFbSmallLinkVideo, .socIntFbSmallLinkVideo, #imagesvg, #videoimage").hide(),i.find("#videoframe").attr("src",t).show(),"commentDetail"===o&&i.css({width:"315px",padding:"10px"})},getTwitterIds:function(e){var t=[];return $.each(e,(function(e,o){1===o.status&&t.push(o.id)})),t},processFollowInformation:function(e,t){commonUtils.showHideLoadingDiv(!1);var o=store.peekAll("social_related_list")[0];void 0!==t&&this.processDMSection(e,t);var s=$L("crm-follow-list");s&&s.length>0&&s[0].remove(),Lyte.Component.render("crm-follow-list",{data:o.TWFollowInfo[e.profileId]},"#follow_"+e.profileId)},processPersonalAccounts:function(e,t,o,s){t.allAccounts=t.allAccounts?t.allAccounts:[];var i=$L("crm-social-integ-outer-template");i&&i[0]?((i=i[0].component).brandParent=[],i.personalAcc=[],i.brandPages=[],i.personalReauthAcc=[],i.perm=[]):((i=document.createElement("crm-social-integ-outer-template").component).setData(t),i.brandParent={},i.personalAcc={},i.brandPages={},i.personalReauthAcc={},i.perm={}),$.each(t.accounts,(function(e,o){var s=null;0===o.status&&(o.status=1),"Brand_Parent"===o.type&&(o.type="brand"),"Personal"===o.type?s=1===o.status?i.personalAcc:i.personalReauthAcc:"brand"===o.type&&void 0===o.parent_id&&1===o.status?(s=i.brandParent,"twitter"===o.network&&(t.pingsEnabled=!0)):1===o.status&&(s=i.brandPages,t.pingsEnabled=!0),null!==s&&(void 0===s[o.network]&&(s[o.network]=[]),s[o.network].push(o.id),1===o.status&&void 0===o.parent_id&&(t[o.network]=!0)),t.allAccounts[o.id]=o,o.info.id_str=o.info.id,o.info.displayName=o.info.name}));var a=-1!==t.info.permissions.indexOf("Crm_Implied_Social_Integration"),n=-1!==t.info.permissions.indexOf("Crm_Implied_Social_Admin");if(t.integPermission=a,t.socialAdmin=n,t.new_social&&(t.recordtwitterAssociated=t.SOCIALPROFILES?t.SOCIALPROFILES.twitter:void 0,"canvas"===s&&(store.unloadAll("social_related_list"),store.pushPayload("social_related_list",Object.assign({},t))),!o)){t.SOCIALPROFILES&&void 0!==t.SOCIALPROFILES.facebook&&(t.fbAssociated=!0),t.SOCIALPROFILES&&void 0!==t.SOCIALPROFILES.twitter&&(t.twAssociated=!0);var r,c=networkUtils.returnDependencyFiles(["crm-social-related-list.js","crm-social-models.js","crm-social-posts.js","crm-social-post-detail-outer.js","crm-social-helper.js","crm-social-common-models.js","crm-social-common.js","crm-social-tab-rl-common.js","crm-social-post-detail.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["crm-social-common.css"],ResourceConstants.CRMClient)),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM);if(Crm.userDetails.RTL_ENABLED){var p=networkUtils.returnDependencyFiles(["crm-social-common-rtl.css","crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);r=c.concat(l).concat(p).concat(d)}else r=c.concat(l).concat(d);Lyte.injectResources(r,void 0,(function(){i.renderPersonalAccounts(t,s)}))}o&&(store.unloadAll("social_related_list"),store.pushPayload("social_related_list",t))},getConfiguredAccounts:function(){var e=store.peekAll("social_related_list");void 0===e||0===e.length?this.getPersonalAccounts():this.processPersonalAccounts(void 0,e[0])},getPersonalAccounts:function(){var e={type:"personal"},t=this;store.findAll("social_related_list",e).then((function(o){t.processPersonalAccounts(e,o)}))},fetchSocialRelatedList:function(e){var t=!0;if(!($L("crm-social-integ-outer-template").length>0)){!1===e&&(t=!1);var o=$L("[name='listrelation']").val();void 0!==o&&(t||this.getConfiguredAccounts(o))}},sendDm:function(e,t){void 0===t&&(t=$L("#twProfile").val());var o=$L("crm-social-direct-message-new");""===t&&(t=o[0].component.data.id);var s=store.peekAll("social_related_list")[0];if(void 0!==s.TWDMInfo[t]){var i=s.record_id?s.record_id:s.id;this.getAllAccountDmStatus(t,void 0,void 0,i),$("#directMessage").remove();var a=s.TWDMInfo[t][e];if(a.thread_id=a.target.id_str+"_"+a.source.id_str,a.type="global",a.id=t,s.new_social)a.place_type="rightpanel_popup",a.renderSendDM=!0,(n=o)&&n[0]&&n[0].remove(),Lyte.Component.render("crm-social-direct-message-new",a,"#showSignalPop");$L("#directMessage").find("input").eq(0).focus();var n,r=s.allAccounts[e];if(2===r.type||"Personal"===r.type)return(n=$L("crm-social-convo-inner"))&&n[0]&&n[0].remove(),void Lyte.Component.render("crm-social-convo-inner-new",{message:!0,personal:!0},".socMsgDetailView");if(s.new_social){var c=s.allAccounts[e].brand.id;return void this.getMessageDetail(void 0,c,"twitter",a.target.id_str+"_"+a.source.id_str+"_twitter",void 0,a.target.id_str,"rightpanel_popup")}}},getAllAccountDmStatus:function(e,t,o,s){var i=this.getAllAccountsByCriteria("twitter",void 0,2,1),a=[];$.each(i,(function(e,t){a.push(t.id)}));var n=store.peekAll("social_related_list")[0];if(a.length>0&&void 0!==n.allAccounts){var r=[];if($.each(a,(function(t,o){(void 0===n.TWDMInfo[e]||void 0===n.TWDMInfo[e][o]||n.TWFollowInfo&&(void 0===n.TWFollowInfo[e]||void 0===n.TWFollowInfo[e][o]))&&r.push(o)})),r.length>0){o=$L("#module").val();var c=$L("#entityID").val();void 0!==s&&(c=s);var l={accounts:r,entity_id:c,profileId:e},d={},p={ids:r.toString(),per_page:1};d.module=o,d.entityId=c;var m=this;store.findAll("relation",p,void 0,void 0,d).then((function(e){void 0!==t?m.callbackfn(l,e):m.processDMSection(l,e)}))}}},getMessageDetail:function(e,t,o,s,i,a,n,r){if("sales_signals"===n){var c=store.peekAll("Social");if(!c||0===c.length){var l=store.findAll("Social",void 0,void 0,void 0,"get_social"),d=store.findAll("crm_social_brand"),p=store.triggerAction("Social","popup_status"),m=Lyte.resolvePromises({deskDetails:l,brandDetails:d,bannerInfo:p}),u={};if(void 0!==m){var f=m.brandDetails.$.meta;if(void 0!==m.brandDetails){m.brands=m.brandDetails,delete m.brandDetails;var g=[],v=[];$.each(m.brands,(function(e,t){$.each(t.accounts,(function(e,t){v.push(t)}))})),m.accounts=v,$.each(m.brands,(function(e,t){$.each(m.accounts,(function(e,o){if(o.brand&&o.brand.id===t.id)return g.push(t),!1}))}));var y=g;o={};if(y.length>0){$.each(m.accounts,(function(e,t){t.brand&&t.brand.id===y[0].id&&(o[t.network]=t.id)}));var h=[{value:"Leads",name:moduleRecordMapping.Leads.singular_label},{value:"Contacts",name:moduleRecordMapping.Contacts.singular_label},{value:"Potentials",name:moduleRecordMapping.Potentials.singular_label},{value:"Customers",name:I18n.getMsg("crm.nsocial.customers")},{value:"Accounts",name:moduleRecordMapping.Accounts.singular_label},{name:I18n.getMsg("crm.social.lead.opp"),value:"Unknown"}];u={brands:y,accounts:m.accounts,filter:h,network:o,social_admin:f.social_admin,configered_desk_detials:m.deskDetails[0].configered_desk_detials,render:m.bannerInfo}}else u={start_page:!0,social_admin:f.social_admin}}}store.unloadAll("Social"),store.pushPayload("Social",u)}}if(this.checkReauthStatus(t,o))"sales_signals"===n&&store.unloadAll("Social");else{if(void 0!==e)(e=$(e)).html(renderingUtils.createHTML({name:"img",attr:{src:networkUtils.getImageUrl("loading.gif",ResourceConstants.CRM)}}));var _={brand_id:t,thread_id:s,network:o,cursor:i,place_type:n,entity_id:a,social_brand_id:r},w=this,I={};I.brand_id=t,I.network=o,I.thread_id=s,store.findAll("crm_social_message",void 0,void 0,void 0,I).then((function(e){w.renderMessageDetail(_,e)}))}},renderMessageDetail:function(e,t){(t=this.processMessageDataForRender(t.messages?t.messages:t.data=t)).network=e.network,t.thread_id=e.thread_id,t.place_type=e.place_type,t.brand={id:e.brand_id},t.social_brand_id=e.social_brand_id;var o=document.createElement("crm-social-convo-inner-new"),s=$L("crm-social-convo-outer-new"),i=$L("crm-social-convo-inner-new");if("rightpanel_popup"!==e.place_type&&"related_list"!==e.place_type&&s&&s.length>0&&s[0].remove(),"rightpanel_popup"!==e.place_type&&"related_list"!==e.place_type&&i&&i.length>0&&i[0].remove(),e.cursor){var a=$L(".socViewMsgParent"),n=a[0].scrollHeight+42,r=$L(".message_"+e.entity_id+"_"+e.place_type);r.find(".showMoreNew").remove(),t.next_page=!0,o.setData(t),r.prepend(o),a.scrollTop(a[0].scrollHeight-n)}else{switch(t.place_type){case"rightpanel_popup":Lyte.Component.render("crm-social-convo-inner-new",t,".message_"+e.entity_id+"_"+e.place_type);var c=document.getElementById("socDirMsgModalContent").scrollHeight;$L("#socDirMsgModalContent").scrollTop(c);break;case"related_list":var l=$L("#socIntDetView");t.related_list=!0,Lyte.Component.render("crm-social-convo-outer-new",t,"#socIntDetView"),l.addClass("socOuterContainer"),$(".socialBackToColumn").removeClass("dN");break;case"sales_signals":t.sales_signal=!0,Lyte.Component.render("crm-social-convo-outer-new",t,"#signalPopupInnerDiv"),$L("#signalPopupViewContent").find("#loadMsg").addClass("dN"),$(".socViewConvoClose").hide(),$("#signalPopupViewContent").find(".popup-model-content").attr("style","overflow: auto");break;default:t.renderMessageDetail=!0,Lyte.Component.render("crm-social-convo-outer-new",t,"#socialDashboard");var d=e.entity_id?e.entity_id:t.entity?t.entity.id:void 0;Lyte.Component.render("crm-social-convo-inner-new",t,".message_"+d+"_"+e.place_type),commonUtils.showHideLoadingDiv(!1)}var p="rightpanel_popup"===t.place_type?"socMsgDetailView":"socViewMsgParent",m=$("."+p),u=m.find("crm-social-convo-inner-new").find("> div");if(0===u.length&&(u=m.find("div").last()),u.length>0){var f=u.position().top+u.outerHeight();m.scrollTop(f)}this.processTwitterTags(),thirdPartyUtils.titleForEllipsis(".socViewMsgName")}},processMessageDetail:function(e){var t;if(e){t={data:[],cursor:e.$&&e.$.meta?e.$.meta.c_cursor:e.cursor};for(var o=(e=e.crm_social_message?e.crm_social_message:e).length-1;o>=0;o--){var s=e[o];s.account&&s.sender.id!==s.account.info.id?s.showRight=!1:s.showRight=!0,Lyte.registeredMixins["crm-social-tab"].processTags(s),t.data.push(s)}}return t},processMessageDataForRender:function(e){var t;if(e){t={data:[],cursor:e.$&&e.$.meta?e.$.meta.c_cursor:e.cursor};for(var o=(e=e.crm_social_message?e.crm_social_message:e).length,s=0;s<o;s++){var i=e[s];void 0===t.account&&(t.account=i.account,t.perm=i.perm,i.showRight?t.entity=i.recipient[0]:t.entity=i.sender),!t.conversation_id&&i.conversation_id&&(t.conversation_id=i.conversation_id),t.data.push(i)}}return t},checkReauthStatus:function(e,t){var o=store.peekAll("Social");o=void 0===o||0===o.length?store.peekAll("social_related_list")[0]:o[0];var s=!1;return $.each(o.accounts,(function(o,i){if(i.brand&&i.brand.id===e&&i.network===t)return i.reauth&&(s=i.reauth),!1})),s&&(crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.reauth.error"),3e3),commonUtils.showHideLoadingDiv(!1)),s},postMessage:function(e,t,o,s,i,a,n,r){if(t||(t=$L(".selectedBrand").attr("value")),!this.checkReauthStatus(t,o)){r&&void 0===n&&(n="");var c={receiver_id:i,message:n},l={brand_id:t,network:o,id:s},d={network:o,id:s,place_type:a,profile_id:i,brand_id:t},p=this;r&&(c.file=r,c.fileName=r.name),l.fData=c,store.create("crm_social_message",c,l).then((function(t){p.renderPostMessage(d,t,e)}),(function(e){store.unloadAll("crm_social_message"),Lyte.registeredMixins["crm-social-tab"].handleErrorCase(JSON.parse(e.response?e.response:e))}))}},renderPostMessage:function(e,t,o){if(t.code)this.handleErrorCase(t,"POST","message");else{(t=this.processMessageDataForRender(t)).network=e.network,t.place_type=e.place_type,t.brand={id:e.brand_id},Lyte.Component.render("crm-social-convo-inner-new",t,".message_"+e.profile_id+"_"+e.place_type);var s=$L("#socDirMsgContent");if(s&&s.length>0){(i=s[0].scrollHeight)&&s.scrollTop(i)}else{var i=document.getElementById("socDirMsgModalContent").scrollHeight;$L("#socDirMsgModalContent").scrollTop(i)}var a=$L(".socAttachInModal");if(a.length>0)a.find(".socReplyAttImg").addClass("dN");var n=$L("#socConvoMessageModal");n.length>0&&n[0].calculateOffset(),$L("#socInContain").length>0&&$L(o).closest(".socViewMsgReply").find(".socialCommonPreviewDiv").addClass("dN"),$L("#socDirMsg").val(""),$L("#socDetailViewMsg").val(""),$L("#dmNoContent").addClass("dN"),this.processText(e.profile_id+"_"+e.place_type,!1,t.data[0].message)}},getAllDmAccounts:function(e){var t=[],o=store.peekAll("social_related_list")[0];return void 0!==o.TWDMInfo[e]&&$.each(o.TWDMInfo[e],(function(e,s){t.push(o.allAccounts[s.account_id])})),t},processReplyToconvo:function(e,t){"object"==typeof t&&(t=t.crm_social_message[0],t=JSON.stringify(t));var o=JSON.parse(t),s=!1;if((o.data&&!o.data.errors||o.dataObj&&!o.dataObj.errors||o.post&&!o.post.erros)&&(s=!0),s){var i=o.data;i.brid=o.brid,i.type||(i.type="message"),i.network||(i.network=e.network),o.data=new Array(i),o.data[0]&&(!o.data[0].message&&o.data[0].text&&(o.data[0].message=o.data[0].text),!o.data[0].created_at&&o.data[0].formatted_time&&(o.data[0].created_at=o.data[0].formatted_time),o.data[0].showRight=!0),$L("#socDirMsg").val("");var a=document.createElement("crm-social-convo-inner-new");a.setData(o),$L("#"+e.uniqueId).append(a),$L("#zso_sendDM").prop("disabled",!1).css("opacity","1").css("pointer-events",""),void 0!==o.data[0]&&(void 0!==o.data[0].id_str||o.data[0].id);var n=document.getElementById("socDirMsgModalContent").scrollHeight;$L("#socDirMsgModalContent").scrollTop(n),$L("#dmNoContent").hide()}},processTwitter:function(e){e.text=e.full_text?e.full_text:e.text;var t=e.type;if(null===e.text.match(/(&#x60;)+|(&#x21;)+|(&#x40;)+|(&#x23;)+|(&#x24;)+|(&#x25;)+|(&#x5e;)+|(&amp;)+|(&#x2a;)+|(&#x28;)+|(&#x29;)+|(&#x2b;)+|(&#x7b;)+|(&#x7d;)+|(&#x3a;)+|(&quot;)+|(&lt;)+|(&gt;)+|(&#x3f;)+|(&#x2f;)+|(&#x3b;)+|(&#x27;)+|(&#x5b;)+|(&#x5d;)+|(&#x3d;)+/gim)&&(e.text=$ESAPI.encoder().encodeForHTML(e.text)),"message"===t)e.convo=!0;else{if((e=this.processRetweets(e)).create){var o=e.watching_profile_id,s=e.user.id_str;e.retweet_allowed=s!==o}e.self&&(e=this.processTweetReplies(e))}return e=this.processTwitterEntitiesData(e)},processRetweets:function(e){var t=e.watching_profile_id;if(e.retweeted_status){var o=[],s=e.retweeted_status;o.push($ESAPI.encoder().encodeForHTML(e.user.name)),e.action=I18n.getMsg("crm.nsocial.tab.retweeted.by",o),e.user=s.user,e.text=$ESAPI.encoder().encodeForHTML(s.text),e.entities=s.entities,e.retweet_id=s.id_str,e.favorited=s.favorited,e.retweeted=s.retweeted,e.favorite_count=s.favorite_count,e.retweet_count=s.retweet_count}return e.retweeted||(e.retweet_id=e.id_str),e.user.id_str!==t?e.retweet_allowed=!0:e.retweet_allowed=!1,e},processTweetReplies:function(e){if(e.replies&&e.replies.data){for(var t=e.replies.data,o=t.length,s=0;s<o;s++){var i=t[s];i.text=$ESAPI.encoder().encodeForHTML(i.text),i=this.processTwitterEntitiesData(i),i=this.processTime(i),e.detail_view&&(i.detail_view=e.detail_view),t[s]=i}if(t.cursor){var a=[];a.push(i.id_str,30,t.cursor),e.replyDiv=I18n.getMsg("crm.nsocial.view.more.replies",a)}e.replies.data=t}return e},processTwitterEntitiesData:function(e){var t=e.text;e.entities=e.extended_tweet?e.extended_tweet.entities:e.entities;var o=t.match(/(&#x60;)+|(&#x21;)+|(&#x40;)+|(&#x23;)+|(&#x24;)+|(&#x25;)+|(&#x5e;)+|(&amp;)+|(&#x2a;)+|(&#x28;)+|(&#x29;)+|(&#x2b;)+|(&#x7b;)+|(&#x7d;)+|(&#x3a;)+|(&quot;)+|(&lt;)+|(&gt;)+|(&#x3f;)+|(&#x2f;)+|(&#x3b;)+|(&#x27;)+|(&#x5b;)+|(&#x5d;)+|(&#x3d;)+/gim);if(t.indexOf("<a onclick='sE(event);' href='")<0){var s=e.entities;if(void 0===s)return e;var i=0;if(s.media){var a=s.media;for(i=a.length-1;i>=0;i--){var n=a[i];if(!e.convo){var r=n.url,c=$ESAPI.encoder().encodeForHTML(r),l='<a onclick="sE(event);" href="'+$ESAPI.encoder().encodeForHTMLAttribute(r)+'" target="_blank">'+$ESAPI.encoder().encodeForHTML(n.display_url)+"</a>";t=null!==o?t.replace(c,l):t.replace(r,l)}"photo"===n.type&&(e.isPic=!0,e.picture=n.media_url_https)}e.text=t}if(s.urls){var d=s.urls;for(i=d.length-1;i>=0;i--){var p=d[i];r=p.url,c=$ESAPI.encoder().encodeForHTML(r),l='<a onclick="sE(event);" href="'+$ESAPI.encoder().encodeForHTMLAttribute(r)+'" target="_blank">'+$ESAPI.encoder().encodeForHTML(p.display_url)+"</a>";t=null!==o?t.replace(c,l):t.replace(r,l)}e.text=t}if(e.convo||void 0===e.user||(e.replytext="@"+e.user.screen_name),s.user_mentions){var m=s.user_mentions;for(i=m.length-1;i>=0;i--){var u=m[i],f=u.screen_name,g="@"+f,v=$ESAPI.encoder().encodeForHTML(g),y=$ESAPI.encoder().encodeForHTMLAttribute(f),h='<a onclick="sE(event);" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/"+y+'" target="_blank">'+v+"</a>";null!==o?(v=new RegExp(v,"i"),t=t.replace(v,h)):(g=new RegExp(g,"i"),t=t.replace(g,h)),e.convo||void 0===e.user||u.screen_name===e.user.screen_name||(e.replytext=e.replytext+" @"+u.screen_name)}e.text=t}if(s.hashtags){var _=s.hashtags;for(i=_.length-1;i>=0;i--){var w="#"+_[i].text,I=$ESAPI.encoder().encodeForHTML(w),L=$ESAPI.encoder().encodeForHTMLAttribute(w),b='<a onclick="sE(event);" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/search?q="+L+'&src=hash" target="_blank">'+I+"</a>";t=null!==o?t.replace(I,b):t.replace(w,b)}e.text=t}if(s.symbols){var C=s.symbols;for(i=C.length-1;i>=0;i--){var k="$"+C[i].text,T=$ESAPI.encoder().encodeForHTML(k),M=$ESAPI.encoder().encodeForHTMLAttribute(k),P='<a onclick="sE(event);" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/search?q="+M+'&src=ctag" target="_blank">'+T+"</a>";t=null!==o?t.replace(T,P):t.replace(k,P)}e.text=t}}return e},processTime:function(e,t){var o=null;if(void 0===(o=t&&e.activity_time?e.activity_time:e.formatted_time))return e;var s=[],i="title_time";return t&&(i="act_"+i),e[i]=o.disp_time,o.key&&o.diff?(s.push(o.diff),e.disp_time=I18n.getMsg(o.key,s)):o.diff?o.key||(e.disp_time=o.diff):e.disp_time=I18n.getMsg(o.key),e},showSocialProfilePanel:function(e,t,o,s){var i=$L(".selectedBrand").attr("value"),a=$L(e).attr("entity_profile_id"),n=$L(e).attr("network"),r=$L(e).attr("isload_partially"),c="rightpanel_popup";$L("#socProfileRightPanelOuter").length<1&&$L("#show").append(renderingUtils.createHTML({name:"div",attr:{id:"socProfileRightPanelOuter",class:"socProfileRightPanelOuter dN"},child:[{name:"div",attr:{id:"socProfileRightPanel",class:"socProfileDetPopup pA"}}]}));var l={};"twitter"===n?l={twitter:a,time:Date.now()}:"facebook"===n&&(l={facebook:a,time:Date.now()}),i||(i=o);var d=[];d.type=t,d.brand_id=i,d.profile_id=a,d.network=n,d.searchQuery="",d.display_name="",d.cursor="",d.place_type=c,d.tab=s;var p=document.createElement("crm-social-interaction-loading");if(void 0!==r&&"true"===r){$L(".socProfPopupDetTab").removeClass("socProfTabActive"),$L(e).addClass("socProfTabActive"),p.setData({index:[1,2,3]});var m=$L("#socProfPopupUsers");m[0].innerHTML="",m.append(p),this.getFilterFeedsCommon(void 0,"",t,n,"",a,"","",c,void 0,s)}else{var u=this;commonUtils.showHideLoadingDiv(!0),store.findAll("crm_social_info",l,void 0,void 0,{brand_id:i}).then((function(e){commonUtils.showHideLoadingDiv(!1),u.showSocialProfilePanelcalback(d,e)}))}},showSocialProfilePanelcalback:function(e,t){var o=Lyte.registeredMixins["crm-social-tab"];if(t&&(t=o.processPostsForRender(t)),t.brand={id:e.brand_id},t.network=e.network,t.place_type=e.place_type,t.type=e.type,t.search=e.search,t.profile_id=e.profile_id,t.id=e.id,t.filter=!0,t.display_name=e.display_name,t&&t.data){var s=t&&t.data.length?t.data[0]:t;s.tabaction=e.type;var i=$L("crm-social-right-panel");i&&i[0]&&i[0].remove(),Lyte.Component.render("crm-social-right-panel",{info:s},"#socProfileRightPanel").setData("renderRightPanelPopup",!0);var a=$L("crm-social-interaction-loading");a&&a.length>0&&a[0].remove();var n="#socProfPopupUsers";0===$L(n).length&&(n="#socProfPopupUserDet"),Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3]},n),o.getFilterFeedsCommon(void 0,e.filter_id,e.type,e.network,e.searchQuery,e.profile_id,e.display_name,e.cursor,e.place_type,e.brand_id,e.tab)}},sendDmInCanvasView:function(e,t,o,s,i){var a=this;store.findAll("social_related_list",void 0,void 0,void 0,{source:"canvas",module:s,entityId:i}).then((function(n){$.each(n.accounts,(function(s,i){i.id===e&&(o[t][e].info=i.info)})),n.TWDMInfo=o;var r={};$.each(n,(function(e,t){r[e]=t})),r.id||(r.id=n.id?n.id:Math.floor(1e5*Math.random()+1)),store.unloadAll("social_related_list"),store.pushPayload("social_related_list",r);var c=store.peekAll("social_related_list");if(c&&c[0]){var l=c[0];if(void 0!==l.TWDMInfo[t]){a.getAllAccountDmStatus(t,void 0,s,i);var d=$L("#directMessage");d&&d.length>0&&d[0].remove();var p=l.TWDMInfo[t][e];if(p.thread_id=p.target.id_str+"_"+p.source.id_str,p.type="global",p.id=t,p.account_id=e,l.new_social){p.place_type="rightpanel_popup",p.renderSendDM=!0;var m=$L("crm-social-direct-message-new");m&&m[0]&&m[0].remove(),Lyte.Component.render("crm-social-direct-message-new",p,"#showSignalPop")}l.allAccounts=l.allAccounts?l.allAccounts:[],$.each(l.accounts,(function(e,t){l.allAccounts[t.id]=t})),$L("#directMessage").find("input").eq(0).focus();var u=l.allAccounts[e];if(2===u.type||"Personal"===u.type)return void Lyte.Component.render("crm-social-convo-inner-new",{message:!0,personal:!0},".socMsgDetailView");if(l.new_social){var f=l.allAccounts[e].brand.id;return void a.getMessageDetail(void 0,f,"twitter",p.target.id_str+"_"+p.source.id_str+"_twitter",void 0,p.target.id_str,"rightpanel_popup")}}}}))},processTwitterTags:function(){var e=this;$L(document).on("click",".socMsgHandleElement",(function(t){e.stopEvent(t);var o=t.currentTarget;o.lyteState||(e.processTwitterTagOnclick(o),t.stopPropagation())})),$L(document).on("click",".socFbMulLink",(function(t){e.stopEvent(t);var o=t.currentTarget;if(!o.lyteState){var s=o.getAttribute("link");networkUtils.openUrl(s,"_blank"),t.stopPropagation()}}))},processSearchTypeColumn:function(e,t,o,s){var i=null,a=$L(e);if("user_search"===t||"page_search"===t||"list"===t)i={profile_id:a.attr("profile_id"),name:a.attr("display_name")};else if("keyword_search"===t){var n=a.attr("search_query");n||(n=s),i={keyword:n.trim()}}var r=$L(".selectedBrand").attr("value");this.addFilterColumn(r,t,o,i)},addFilterColumn:function(e,t,o,s){if(!this.checkReauthStatus(e,o)){var i={network:o,type:t,brand:{id:e}};s&&(i.details=s);var a=this;commonUtils.showHideLoadingDiv(!0),store.create("monitor_column",i).then((function(e){commonUtils.showHideLoadingDiv(!1),a.renderCreateFilter(i,e)}),(function(e){a.handleErrorCase(e,"POST","monitor_column")}))}},renderCreateFilter:function(e,t){var o=Lyte.registeredMixins["crm-social-tab"],s=this,i=$L("#socMonitorContentInner"),a=$L("#socMonitorContent"),n=document.createElement("crm-social-filter-column"),r=[];$.each(t.monitor_column,(function(e,t){if("SUCCESS"===t.code){var a=t.details,r=void 0!==a.info.name?a.info.name:void 0!==a.info.keyword?a.info.keyword:s.getDisplayNameByType(a.type);a.display_name=r;var c=a.info.name||a.info.keyword?s.getDisplayNameByType(a.type):null;a.title=c;var l=document.createElement("crm-social-filter-head");l.setData(a),i.append(l),o.setMonitorContentWidth(),n.component.addColumnClose("close")}else o.handleErrorCase(t,void 0,"POST","monitor_column")})),$.each(t.monitor_column,(function(e,t){if("SUCCESS"===t.code){var i=t.details,n=void 0!==i.info.name?i.info.name:void 0!==i.info.keyword?i.info.keyword:s.getDisplayNameByType(i.type);i.display_name=n;var c=i.info.name||i.info.keyword?s.getDisplayNameByType(i.type):null;i.title=c;var l=a.scrollLeft(),d=$L("#"+i.id+"_column").offset().left;r.push({height:l+d,jsonId:i.id}),o.getFilterFeeds(i,i.brand.id)}}));for(var c=r.length,l=0;l<c;l++)a.scrollLeft(r[l].height),$L("#"+r[l].jsonId+"_column").addClass("socAddedColumHighlight"),d(l);function d(e){setTimeout((function(){$L("#"+r[e].jsonId+"_column").removeClass("socAddedColumHighlight")}),2e3)}},getDisplayNameByType:function(e){switch(e){case"mention":return I18n.getMsg("crm.social.mentions");case"timeline":return I18n.getMsg("crm.social.timeline");case"like":return I18n.getMsg("crm.social.likes");case"keyword_search":return I18n.getMsg("crm.social.keyword.search");case"user_search":return I18n.getMsg("crm.social.user.search");case"page_search":return I18n.getMsg("crm.social.page.search");case"list":return I18n.getMsg("crm.social.lists")}},stopEvent:function(e){Lyte.registeredMixins["crm-stop-event"].actions.stopEvent(e)},processTwitterTagOnclick:function(e){var t,o=Lyte.registeredMixins["crm-social-tab"],s=e.getAttribute("type"),i=e.getAttribute("replace_text"),a=e.getAttribute("network"),n=$L("crm-social-convo-outer-new");if(e=$L(e),n&&n.length>0&&(t=$L("crm-social-convo-inner-new")[0].component.data.brand.id),!t){var r,c=$L(".socFilterBrandsRadio");c.length>0&&c.each((function(e){(r=this).ltProp("checked")&&(t=r.ltProp("value"))})),commonUtils.showHideLoadingDiv(!0),"Mentions"===s?this.showSocialProfilePanel(e,"user_search",t,"monitor"):"hashtags"===s&&i&&o.getFilterFeedsCommon(void 0,void 0,"keyword_search",a,i,void 0,void 0,void 0,"rightpanel_popup",t,"monitor")}},reloadTwitter:function(e){var t=document.createElement("crm-social-integ-outer-template").component;if(e.includes("#")||""===e){var o=$("#twProfile").val();this.addRemoveTwitterHandle("",!1),""!==o?t.getProfileInfo("twitter",o,void 0):t.getSearchInfo("twitter")}else this.addRemoveTwitterHandle(e,!0),t.getProfileInfo("twitter",void 0,e)},updateModalHeightAfterImageUpload:function(e){$L("#"+e)[0].calculateOffset()},twitterCountVisibility:function(e,t,o){var s=$L(o).closest(".postResponse").find(".socReplyCount");"focus"===e?s.removeClass("vH"):s.addClass("vH")},addIdInDropArrow:function(e){$L(e).find(".dmdropArrow").attr("id","twitterDmDrop")}},{mixins:["crm-social-tab"]}),Lyte.Mixin.register("crm-social-tab",{appendDepartment:function(e){var t=$("#socDeskDepartment");t.html(""),null!==e.desk_department&&e.desk_department&&e.desk_department.length>0&&(t.append('<option value="">'+I18n.getMsg("crm.social.desk.choosedepartment")+"</option>"),$.each(e.desk_department,(function(e,o){t.append('<option value="'+o.id+'">'+o.name+"</option>")})))},getFeeds:function(e,t,o,s,i,a){if($L("#socMessageContent").addClass("dN"),e)this.showMoreLoading(e);else{var n=$L("#socAllConvo");if($L("#socConvoContent").removeClass("dN"),n.removeClass("dN"),n&&n.length>0)return;var r=$L("crm-social-interaction-loading");r&&r.length>0&&r[0].remove(),Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},"#socConvoContent")}var c={brand_id:t,cursor:o,entity_type:s,place_type:a,network:i,currentEle:e},l={};o&&(l.cursor=o),s&&(l.entity_type=s),i&&(l.network=i),this.appendDeskEnabledQuery()&&(l.desk_enabled_user=this.appendDeskEnabledQuery());var d=this;store.findAll("crm_social_feed",l,void 0,void 0,{brand_id:t}).then((function(e){d.renderFeeds(c,e)}))},getReports:function(){var e=this;store.findAll("crm_social_report").then((function(t){e.renderReports(void 0,t)}))},renderReports:function(e,t){if(t){var o=$L("crm-social-reports")[0];o&&o.remove();var s={Contacts:[],Leads:[],Accounts:[]};$.each(t,(function(e,t){"Contacts"===t.module.api_name?s.Contacts.push(t):"Leads"===t.module.api_name?s.Leads.push(t):s.Accounts.push(t)}));var i=[];$.each(s,(function(e,t){var o={module:moduleRecordMapping[e].singular_label};if(t.length>1){var s=t[0],a=t[1];s.from!==a.to&&(s=t[1],a=t[0]),o.increase=s.count>a.count,o.equal=s.count===a.count,o.current=s.count,o.previous=a.count,0!==a.count&&(o.percentage=parseFloat((s.count-a.count)/a.count*100).toFixed(1))}else o.count=t[0].count,o.create_count=!0;i.push(o)})),Lyte.Component.render("crm-social-reports",{report:i},"#socDashLeadsDetails")}},getNetworkJsonByBrandId:function(e,t,o){var s={},i=store.peekAll("Social")[0];return i&&$.each(i.accounts,(function(i,a){var n=!0;if(t&&a.perm_type>t&&(n=!1),o&&a.reauth&&(n=!1),n&&a.brand&&a.brand.id===e){var r=a.network;s[r]=a}})),s},checkReauthStatus:function(e,t,o){var s=store.peekAll("Social")&&store.peekAll("Social").length>0?store.peekAll("Social")[0]:!!(store.peekAll("social_related_list")&&store.peekAll("social_related_list").length>0)&&store.peekAll("social_related_list")[0];if(s){var i=!1;if($.each(s.accounts,(function(o,s){if(s.brand&&s.brand.id===e&&s.network===t)return s.reauth&&(i=s.reauth),!1})),i){var a=$L("crm-social-account-reauth");a&&0===a.length&&crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.reauth.error"),3e3)}return i}},getAccountByBrandIdAndNetwork:function(e,t){var o=null,s=store.peekAll("Social")[0];return $.each(s.accounts,(function(s,i){i.brand&&i.brand.id===e&&t===i.network&&(o=i.id)})),o},appendDeskEnabledQuery:function(){var e=store.peekAll("Social");if(e&&e.length>0)return!!e[0].configered_desk_detials.is_desk_supported_org},processTags:function(e){if(e.message){"twitter"!==e.network&&(e.message=$ESAPI.encoder().encodeForHTML(e.message));var t=e.user&&e.user.screen_name?"@"+e.user.screen_name+" ":"";e.message_tags&&$.each(e.message_tags,(function(o,s){var i;"twitter"!==e.network?s.text=$ESAPI.encoder().encodeForHTML(s.text):"symbols"===s.type?s.text="\\"+s.text:"Mentions"===s.type&&e.account&&"@"+e.account.screen_name!==s.text&&(t=t+s.text+" "),s.replace_text="twitter"!==e.network?$ESAPI.encoder().encodeForHTML(s.show_text):s.show_text,i="Mentions"===s.type||"hashtags"===s.type?'<a class="socMsgHandleElement" href="javascript:;" network="'+e.network+'" entity_profile_id="'+s.profile_id+'"type="'+s.type+'"replace_text="'+s.replace_text+'">'+s.replace_text+"</a>":"twitter"!==e.network?s.replace_text:'<a class="socFbMulLink" link="'+s.link+'" + href="'+s.link+'" target="_blank" rel="noopener noreferrer">'+s.replace_text+"</a>",i="photo"===s.type?"":i,e.message=(" "+e.message).replaceAll(" "+s.text,i).trim(),e.message=e.message.replaceAll("\n"+s.text,"\n"+i)})),e.reply_text=t}if(e.story&&("twitter"!==e.network&&(e.story=$ESAPI.encoder().encodeForHTML(e.story)),e.story_tags&&$.each(e.story_tags,(function(t,o){var s;"twitter"!==e.network?o.text=$ESAPI.encoder().encodeForHTML(o.text):"symbols"===o.type&&(o.text="\\"+o.text),o.replace_text="twitter"!==e.network?$ESAPI.encoder().encodeForHTML(o.show_text):o.show_text,s="Mentions"===o.type||"hashtags"===o.type?'<a class="socMsgHandleElement" href="javascript:;" network="'+e.network+'" entity_profile_id="'+o.profile_id+'"type="'+o.type+'"replace_text="'+o.replace_text+'">'+o.replace_text+"</a>":"facebook"!==e.network?o.replace_text:'<a class="socFbMulLink" link="'+o.link+'" + href="'+o.link+'" target="_blank" rel="noopener noreferrer">'+o.replace_text+"</a>",e.story=" "+e.story,e.story=e.story.replaceAll(" "+o.text,s).trim(),e.story=e.story.replaceAll("\n"+o.text,"\n"+s)}))),e.permissions)switch(e.permissions){case"Creators":e.perm=1;break;case"Responders":e.perm=2;break;case"Listeners":e.perm=3}(Crm.userDetails.permissions.Crm_Implied_Create_Leads||Crm.userDetails.permissions.Crm_Implied_Create_Contacts||Crm.userDetails.permissions.Crm_Implied_Create_Accounts)&&(e.add_to_crm=!0),Lyte.registeredMixins["crm-social-integration"].processTwitterTags()},processPosts:function(e){var t={data:[],cursor:e&&e.$?e.$.meta:void 0},o=this;return e=e&&e.data?e.data:e,$.each(e,(function(e,s){if(s){if(void 0!==s.retweeted_status&&(s.retweet_screen_name=s.retweeted_status.user.screen_name,o.processTags(s.retweeted_status)),void 0!==s.quoted_status&&(s.quote_screen_name=s.quoted_status.user.screen_name,o.processTags(s.quoted_status)),s.comments&&(s.comments=o.processComments(s.comments)),s.id){var i=$L(".socPostId_"+s.id).find(".socModuleName");if(i&&i.length>0){var a=i[0].tagName;a&&"SPAN"===a&&i[0].remove()}}o.processTags(s),t.data.push(s)}})),t},processPostsForRender:function(e){var t={data:[],cursor:e.$?e.$.meta:void 0};return e=e.data?e.data:e,$.each(e,(function(e,o){o&&t.data.push(o)})),t},processComments:function(e,t){var o=this,s=JSON.parse(JSON.stringify(e));return s.data=[],s.cursor=e.cursor,t&&e.data&&(e.data=e.data.reverse()),e.data?$.each(e.data,(function(e,i){i.comments&&(i.comments=o.processComments(i.comments,t),s.data.push(i)),"googleplus"!==i.network&&o.processTags(i)})):$.each(e,(function(e,i){i.comments&&(i.comments=o.processComments(i.comments,t),s.data.push(i)),"googleplus"!==i.network&&o.processTags(i)})),s},getFilterFeeds:function(e){if(void 0!==e.type){var t=null,o=null;switch(e.type){case"mention":case"timeline":case"like":break;case"keyword_search":t=e.info?e.info.keyword:e.details&&e.details.info?e.details.info.keyword:void 0;break;case"user_search":case"page_search":case"list":o=e.info.profile_id;break;default:return}this.getFilterFeedsCommon(void 0,e.id,e.type,e.network,t,o,e.display_name,void 0,e.id,void 0,"monitor")}},getFilterFeedsCommon:function(e,t,o,s,i,a,n,r,c,l,d){var p=$L(".selectedBrand").attr("value"),m=null,u=$L("#"+t+"_column");if("social_tab_preview"===c)m=$L(".socialFilterPreview");else if("social_tab_user_preview"===c)m=$L(".socUserSearchDetList");else if("rightpanel_popup"!==c||"keyword_search"!==o||r)m=u.find(".socColumnLists"),u.attr("loaded",!0);else{var f=$L("crm-zso-entity-create");f&&f.length>0&&f[0].component.resetEntityForm(),$L(".socViewConvoClose").hide();var g="#socialDashboard";0===$L(g).length&&(g="body");var v=$L("crm-social-right-panel-search");v&&v.length>0&&v[0].remove(),Lyte.Component.render("crm-social-right-panel-search",{search_query:i,display_name:i},g).setData("renderRightPanelSearch",!0),Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},"#socRightPanelSearchRes"),$L("#socRightPanelSearchKey").text(i),$L("#rightPanelAddcolumn").attr({search_query:i,display_name:i})}var y=$L(".socPeoResults");if(y&&y.length>0&&y.addClass("dN"),this.checkReauthStatus(p,s)){var h=renderingUtils.createHTML({name:"div",attr:{class:"pA socAccReauth aligncenter"},child:[{name:"span",attr:{class:"dIB svgIcons socAccWarningIcon"}},{name:"span",attr:{class:"dB crmNotFoundColor"},child:[{name:"text",content:I18n.getMsg("crm.social.integ.reauth.error")}]}]});return m.empty(),null!==m&&m.append(h),void m.closest(".socCustomColumn").find(".socRefresh").removeClass("socRefreshRotate")}if(("social_tab_preview"===c||"social_tab_user_preview"===c)&&!r){var _="social_tab_user_preview"===c?".socUserSearchDetList":"#socKeyPeoSearch";Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},_)}p||(p=l);var w={id:t,brand_id:p,type:o,network:s,search:i,profile_id:a,cursor:r,place_type:c,display_name:n,tab:d,ele:e},I={};I.type=o,i&&(I.keyword=i),a&&(I.profile_id=a),r&&(I.cursor=JSON.stringify({after:decodeURIComponent(r)}),this.showMoreLoading(e)),I.time=Date.now();var L=this.appendDeskEnabledQuery();I.desk_enabled_user=L||!1;var b=this;store.findAll("crm_social_post",I,void 0,void 0,{brand_id:p,network:s}).then((function(e){commonUtils.showHideLoadingDiv(!1),b.renderFilterFeeds(w,e)}),(function(e){var t=Lyte.registeredMixins["crm-social-tab"];if(t.handleErrorCase(e.response?JSON.parse(e.response):e),t.checkReauthStatus(p,s)){var o=renderingUtils.createHTML({name:"div",attr:{class:"pA socAccReauth aligncenter"},child:[{name:"span",attr:{class:"dIB svgIcons socAccWarningIcon"}},{name:"span",attr:{class:"dB crmNotFoundColor"},child:[{name:"text",content:I18n.getMsg("crm.social.integ.reauth.error")}]}]});return m.empty(),null!==m&&m.append(o),void m.closest(".socCustomColumn").find(".socRefresh").removeClass("socRefreshRotate")}}))},renderFilterFeeds:function(e,t){if((o=$L("crm-social-interaction-loading"))&&o.length>0&&("social_tab_preview"===e.place_type||"rightpanel_popup"===e.place_type)){var o,s=$L("#socRightPanelSearchRes");if(s&&s.length>0)(o=s.find("crm-social-interaction-loading"))&&o.length>0&&o[0].remove();else o[0].remove()}if(t.code)this.handleErrorCase(t,"posts","GET");else{t&&(t=this.processPostsForRender(t)),"monitor"!==e.tab&&this.showMoreRemove(e.ele),t.brand={id:e.brand_id},t.network=e.network,t.place_type=e.place_type,t.type=e.type,t.search=e.search,t.profile_id=e.profile_id,t.id=e.id,t.filter=!0,t.display_name=e.display_name;var i=null;switch(e.place_type){case"social_tab_preview":i=document.querySelector(".socialFilterPreview"),t.preview=!0;break;case"rightpanel_popup":if("keyword_search"===e.type)return(r=document.createElement("crm-social-my-posts")).setData(t),void(null!==(i=document.getElementById("socRightPanelSearchRes"))&&$L(i).append(r));if("following"===t.type||"followers"===t.type){t.users=this.processSearchResult(e,t.users?t.users:t.data?t.data:t),t.users.brand={id:e.brand_id},t.users.network=e.network,t.users.place_type=e.place_type,t.users.type=e.type,t.users.search=e.search,t.users.profile_id=e.profile_id,t.users.id=e.id,t.users.filter=!0,t.users.display_name=e.display_name;var a=document.createElement("crm-social-search-people-filter");a.setData(t);var n=$L("#socProfPopupUsers");""===e.cursor&&n.empty(),n.append(a)}else{n=$L("#socProfPopupUsers");(r=document.createElement("crm-social-my-posts")).setData(t),""===e.cursor&&n.empty(),n.append(r)}return;case"social_tab_user_preview":null===(i=document.querySelector(".socUserSearchDetList"))&&(i=document.querySelector(".socProfPopupUsers")),t.preview=!0;break;default:null!==(i=document.getElementById(e.id))&&(i=i.querySelector(".socColumnLists"))}$L("#"+t.id+"_column").find(".socRefresh").removeClass("socRefreshRotate");var r=document.createElement("crm-social-my-posts");if(e.cursor?r.setData(t):(t.show_empty=!0,r.setData(t),null!==i&&$L(i).empty()),null!==i){var c,l,d=$L(i).closest(".socColumnContent");c=d||$L(i).closest("lyte-modal-content"),$L(i).append(r),l=c.scrollTop()+100,void 0!==e.cursor&&crmui.animateScrollTop(c[0],l,300,"")}}},setMonitorContentWidth:function(){var e=$L(".socColumnHeading"),t=$L("#socMonitorContentInner"),o=renderingUtils.windowWidth,s=$L("#socMonitorContentInner .socCustomColumn"),i=(s.outerWidth()+12)*s.length,a=e.outerHeight();$L(".socCustomColumn .socColumnContent").css("height","calc(100% - "+a+"px)"),i>o?t.css("width",i):t.css("width",""),s.length>0?($L("#socMonitorEmpty").addClass("dN"),this.monitorApplySortable()):$L("#socMonitorEmpty").removeClass("dN")},getStarted:function(){networkUtils.openUrl(networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/extensions/social/brands"))},renderReauthAccounts:function(e,t){var o=[];t=store.peekAll("Social")[0];$.each(t.accounts,(function(e,t){t.reauth&&"brand"===t.type&&o.push(t)})),o.length>0?($L(".socSettingIconOuter").find(".reauthDot").addClass("follow_dot"),Lyte.Component.render("crm-social-account-reauth",{accounts:o},"#socialDashboard"),$L("crm-social-account-reauth")[0].component.setData("showReauthPop",!0)):e||this.getStarted()},renderFeeds:function(e,t){t||(t={}),t.data=this.processFeedsForRender(t),$("#social").hide();var o=null,s=null;if(e.message){if(!e.cursor){var i=$L("#socMessageContent");i[0]&&(i[0].innerHTML=""),i.append(renderingUtils.createHTML([{name:"div",attr:{id:"socAllMessages"}},{name:"div",attr:{id:"socMessageDetail",class:"socMessageDetail bg_white p20 pA dN"}}])),i.removeClass("dN")}o=$L("#socAllMessages"),s=document.createElement("crm-social-messages-list")}else{if(!e.cursor){var a=$L("#socConvoContent");a[0]&&(a[0].innerHTML=""),a.append(renderingUtils.createHTML([{name:"div",attr:{id:"socAllConvo"}},{name:"div",attr:{id:"socConvoDetail",class:"socConvoDetail bg_white p20 pA dN"}}])),a.removeClass("dN")}o=$L("#socAllConvo"),s=document.createElement("crm-social-posts-new")}if(t.brand={id:e.brand_id},t.entity_type=e.entity_type,t.message=e.message,t.place_type=e.place_type,t.network=e.network,t.entity_type=e.entity_type,t.cursor=t.$&&t.$.meta?t.$.meta.cursor:void 0,void 0===e.cursor){var n=$L("crm-social-notification-new");t.data&&!t.data[0]&&0===n.length&&(t.show_empty=!0),s.setData(t),o.empty()}else{this.showMoreRemove(e.currentEle),s.setData(t);var r=$L(o.parent()),c=r.scrollTop()}o.append(s),void 0!==e.cursor&&crmui.animateScrollTop(r[0],c,300,"")},getMyPosts:function(e,t,o,s,i){var a=null;switch(s){case"twitter":a=$L(".socTwPosts").find(".socColumnLists");break;case"facebook":a=$L(".socFbPosts").find(".socColumnLists")}if(this.checkReauthStatus(t,s)){var n=renderingUtils.createHTML({name:"div",attr:{class:"pA socAccReauth aligncenter"},child:[{name:"span",attr:{class:"dIB svgIcons socAccWarningIcon"}},{name:"span",attr:{class:"dB crmNotFoundColor"},child:[{name:"text",content:I18n.getMsg("crm.social.integ.reauth.error")}]}]});return a.empty(),void(null!==a&&a.append(n))}var r={brand_id:t,cursor:o,network:s,place_type:i,currentEle:e},c={type:"user_posts"};void 0!==o&&(c.cursor=o),this.appendDeskEnabledQuery()&&(c.desk_enabled_user=!0);var l=this;store.findAll("crm_social_post",c,void 0,void 0,{brand_id:t,network:s}).then((function(e){l.renderPosts(r,e)}),(function(e){l.handleErrorCase(e.response?JSON.parse(e.response):e)}))},renderPosts:function(e,t){if(t.code)this.handleErrorCase(t);else{if(t[0]&&t[0].$.isError){var o=t[0].$.error&&t[0].$.error.id?t[0].$.error.id.data:void 0;if(o&&o.network)return void this.handleReauth(o,o.network)}t=this.processPostsForRender(t);var s=null;switch(e.network){case"twitter":s=$L(".socTwPosts").find(".socColumnLists");break;case"facebook":s=$L(".socFbPosts").find(".socColumnLists");break;case"googleplus":s=$L(".socGpPosts").find(".socColumnLists")}s.removeClass("h100_per pR"),t.brand={id:e.brand_id},t.network=e.network,t.place_type=e.place_type;var i=document.createElement("crm-social-my-posts");if(i.setData(t),void 0===e.cursor)s.empty();else{var a=e.currentEle;this.showMoreRemove(a);var n=s.parent(),r=n.scrollTop()+100}s.append(i),void 0!==e.cursor&&crmui.animateScrollTop(n[0],r,300,"")}},getInteractions:function(e,t,o,s,i,a,n){var r=$L("crm-social-interaction-loading");r&&r.length>0&&r[0].remove(),e?this.showMoreLoading(e):"message"===o?Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},".socMessagesDetAll"):Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},".socInteractionDetAll");var c={brand_id:t,cursor:s,profile_ids:i,place_type:a,element:n,type:o,currentEle:e},l={profile_ids:i};o&&(l.interaction_type=o),s&&(l.cursor=s),this.appendDeskEnabledQuery&&(l.desk_enabled_user="true");var d=this;store.findAll("crm_social_interaction",l,void 0,void 0,{brand_id:t}).then((function(e){d.renderInteractions(c,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(JSON.parse(e.response))}))},renderInteractions:function(e,t){t||(t={}),t.data=this.processFeedsForRender(t),$L("#social").hide(),t.brand={id:e.brand_id},t.profile_ids=e.profile_ids,t.social_interactions=!0,t.place_type=e.place_type,t.cursor=t.$&&t.$.meta?t.$.meta.cursor:void 0;var o=null,s=null;"message"===e.type?(e.profile_ids&&(t.profile_detail=!0),o=$L(".socMessagesDetAll").removeClass("dN"),s=document.createElement("crm-social-messages-list")):(t.profile_detail=!0,o=$L(".socInteractionDetAll").removeClass("dN"),s=document.createElement("crm-social-posts-new"));o=e.element?$L("."+e.element):o;t.element=e.element,e.cursor?(this.showMoreRemove(e.currentEle?e.currentEle:o),s.setData(t)):(t.show_empty=!0,s.setData(t),o.empty()),o.append(s)},getMessagesByProfile:function(e,t,o,s,i){var a={brand_id:t,cursor:o,profile_ids:s,place_type:i,type:"message"},n={interaction_type:"message",profile_ids:s};o&&(n.cursor=o);var r=this;store.findAll("crm_social_interaction",n,void 0,void 0,{brand_id:t}).then((function(e){r.renderInteractions(a,e)}),(function(e){r.handleErrorCase(JSON.parse(e.response))}))},processFeeds:function(e){var t=[],o=this;return $.each(e,(function(e,s){var i=s;if(s.permissions)switch(s.permissions){case"Creators":s.perm="1";break;case"Responders":s.perm="2";break;case"Listeners":s.perm="3"}i.interaction_info?("googleplus"!==(i=i.interaction_info).network&&"reply"!==i.history_type?o.processTags(i):(Crm.userDetails.permissions.Crm_Implied_Create_Leads||Crm.userDetails.permissions.Crm_Implied_Create_Contacts||Crm.userDetails.permissions.Crm_Implied_Create_Accounts)&&(i.add_to_crm=!0),delete s.interaction_info,Object.assign(s,i)):i.recipient&&o.processTags(i),t.push(s)})),t},processFeedsForRender:function(e){var t=[];return $.each(e,(function(e,o){t.push(o)})),t},setHeightForConvoPopup:function(e){var t=null;t=$L("#signalPopupViewContent").is(":visible")?$L("#signalPopupViewContent .popup-model-content").outerHeight()-($L(".socView"+e+"Header").outerHeight()+$L(".socView"+e+"Reply").outerHeight()):renderingUtils.windowHeight-(renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+70+$L(".socView"+e+"Header").outerHeight()+$L(".socViewConvoInner").find(".socView"+e+"Reply").outerHeight()),$L(".socView"+e+"Parent").css("max-height",t)},processUserPageSearch:function(e,t){var o=store.peekAll("monitor_column");return $.each(t,(function(e,t){t.exist&&(t.exist=!1)})),$.each(t,(function(e,t){$.each(o,(function(e,o){o.info?(t.id===o.info.profile_id||t.id_str&&t.id_str===o.info.profile_id)&&(t.exist=!0,t.filter_id=o.id):o.details.info&&t.id===o.details.info.profile_id&&(t.exist=!0,t.filter_id=o.id)}))})),t},processSearchResult:function(e,t){var o=store.peekAll("monitor_column");return t.exist&&(t.exist=!1),$.each(t,(function(e,t){$.each(o,(function(e,o){(o.info&&(t.id===o.info.profile_id||t.id&&t.id===o.info.profile_id)||o.details&&o.details.info&&t.id===o.details.info.profile_id)&&(t.exist=!0,t.filter_id=o.id)}))})),t},processEntityDetail:function(e,t,o){var s=$L(e).attr("type");o||(o=$L(".profileIds").attr("ids"));var i=$L(".selectedBrand").attr("value");if(t||(t="detail_popup"),"interactions"===s)$L(".socMessagesDetAll").addClass("dN"),0===$L(".socInteractionDetAll").removeClass("dN").children().length&&this.getInteractions(null,i,null,null,o,t,null);else if("messages"===s){var a=$L(".socMessagesDetAll").removeClass("dN");$L(".socInteractionDetAll").addClass("dN"),0===a.children().length&&this.getMessagesByProfile(null,i,null,o,t)}},getProfileInfo:function(e){e=$L(e);$L(".socAddToCRM").removeAttr("id"),e.attr("id","socAddToCrmBtn");var t=$L(".socAddToCrmActive");t.find(".socAddLabel").removeClass("dN"),t.find(".socAddLoadingOuter").addClass("dN").removeClass("dIB"),t.removeClass("socAddToCrmActive"),e.find(".socAddLabel").addClass("dN"),e.find(".socAddLoadingOuter").removeClass("dN").addClass("dIB"),e.addClass("socAddToCrmActive"),$L("#socAddToCrmPop").html("");var o=$L(".selectedBrand").attr("value"),s=e.closest(".parentPost"),i=s.attr("network"),a=s.attr("profile_id"),n={brand_id:o},r={};"twitter"===i?r.twitter=a:"facebook"===i&&(r.facebook=a);var c=this;store.findAll("crm_social_info",r,void 0,void 0,n).then((function(e){c.renderCreateEntityProfile(e)}))},renderCreateEntityProfile:function(e){var t=$L(".socAddToCrmActive"),o=$L("#kso_rightPanel_Card");if(e&&!e.error){if(!e.network)(e=e[0])[e.network]=!0,e.profile_id=e.id;e[e.network]=!0,e.profile_id=e.id}if(void 0!==e.module&&void 0!==e.entityid)return 0===t.length?void o.html('<div class="pA socWarningMessageRightPanel aligncenter w100_per"><span class="svgIconsImg socWarningMsgIcon dIB"></span><span class="dB crmNotFoundColor fs crm-base-font-size mT5 mB5" style="width:325px">'+I18n.getMsg("crm.social.integ.profile.save.error1",Crm.getCrmBasePath()+"/EntityInfo.do?id="+e.entityid+"&module="+e.module)+"</span></div>"):(t.remove(),void crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.profile.save.error1",Crm.getCrmBasePath()+"/EntityInfo.do?id="+e.entityid+"&module="+e.module),1e4));t.removeClass("kso_addto_span_hover"),Crm.userDetails.permissions.Crm_Implied_Create_Leads&&Crm.userDetails.MODULE_LIST.Leads.visible&&(e.show_lead=moduleRecordMapping.Leads.singular_label),Crm.userDetails.permissions.Crm_Implied_Create_Contacts&&Crm.userDetails.MODULE_LIST.Contacts.visible&&(e.show_contact=moduleRecordMapping.Contacts.singular_label),Crm.userDetails.permissions.Crm_Implied_Create_Accounts&&Crm.userDetails.MODULE_LIST.Accounts.visible&&(e.show_account=moduleRecordMapping.Accounts.singular_label),e.renderEntityCreation=!0;var s=$L("crm-zso-entity-create");if(s&&s[0]&&s[0].remove(),e[0]&&e[0].error)_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropDuration:5e3,ltPropMessage:I18n.getMsg("X handle is not found or no longer active")}}),t.length>0&&t[0].classList.remove("socAddToCrmActive");else var i=Lyte.Component.render("crm-zso-entity-create",e,"body");t.length>0?(t.find(".socAddLabel").removeClass("dN"),t.find(".socAddLoadingOuter").addClass("dN").removeClass("dIB"),$L("#socConvoContent").css("overflow","hidden")):(e.fromDetailView="detailView",i.setData(e),o[0]&&(o[0].innerHTML=""),o.append(i).show()),thirdPartyUtils.titleForEllipsis(".socTwEntName, .socFbEntName, .socGpEntName");var a=e.id,n=e.network;this.fetchAssociation(a,n)},setTopValueForAddToCrmPopup:function(){var e=$L("#socAddToCrmPop"),t=$L(".socAddToCrmActive"),o=$L("#tabLayer"),s=renderingUtils.windowWidth,i=renderingUtils.windowHeight,a=o.offset().top+o.outerHeight(),n=crmui.getOffset(t),r=n.top-80,c=t.outerWidth(!0),l=t.outerHeight(!0),d=e.outerHeight(),p=e.outerWidth(),m=n.top-d+l,u=n.top-d+100,f=n.left+c,g=n.left-p-8,v=i-(n.top+l),y=s-n.left;$L(".socConvoContent").css("overflow","hidden"),v>d?e.css("top",r):u<=a?e.css("top",a):v-28<=100?e.css("top",m):e.css("top",u),Crm.userDetails.RTL_ENABLED?s-y>p+20?e.css({left:g}).removeClass("dN").addClass("socAddToCrmPopOnLeft"):e.css({left:f}).removeClass("dN"):s-f>p+20?e.css({left:f}).removeClass("dN"):e.css({left:g}).removeClass("dN").addClass("socAddToCrmPopOnLeft");var h=e.offset().top;$L(".socAddToCrmBefore").css("top",n.top-h+2)},openDeskTicket:function(e){event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation());var t=store.peekAll("Social")[0];if(t.configered_desk_detials.desk_supported_user){var o=$L(e).attr("web_link");networkUtils.openUrl(o,"_blank")}else if(t.configered_desk_detials.is_user_in_desk_enabled_profile){var s=(o=$L(e).attr("web_link")).split("dv/")[1];deskInteg.showDeskPopupForWidgets(s)}else crmui.showMsgBand("error",I18n.getMsg("message.code.5004"),3e3)},openCreateDeskTicket:function(e){event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation());e=$L(e);var t=$L("#socDeskDepartmentDiv"),o=e.offset().top,s=e.offset().left,i=e.outerWidth(),a=e.closest(".parentPost"),n=a.attr("post_id"),r=a.attr("network");thirdPartyUtils.bindSelect2("#socDeskDepartment"),e.closest("div").hasClass("fR")?(s=s+i+7,$L(".socDeskDeptArrow").attr("style","")):(s=e.offset().left,s-=t.outerWidth()+i-5,$L(".socDeskDeptArrow").css({transform:"rotate(180deg)",left:"calc(100% - 1px)"})),"facebook"===r&&""!==a.attr("parent_post_id")&&(n=a.attr("parent_post_id"));var c=a.attr("brand_id");$L(".socDeskIconRotate").removeClass("socDeskIconRotate"),e.addClass("socDeskIconRotate");var l=store.peekAll("Social")[0].configered_desk_detials;if(l.desk_department&&l.desk_department.length>1)e.removeClass("socDeskIconRotate"),$L("#socConvoContent").css("overflow","hidden"),t.removeClass("dN").css({top:o-20,left:s}),this.unbind("createTktBTN"),$L("#createTktBTN").click((function(){var t=e;this.createDeskTicket($L("#socDeskDepartment").val(),n,r,c,t)}));else{var d=e;this.createDeskTicket(l.desk_department[0]?l.desk_department[0].id:void 0,n,r,c,d)}},unbind:function(e){$L("#"+e).unbind("click")},createDeskTicket:function(e,t,o,s,i){if(e&&""!==e){commonUtils.showHideLoadingDiv(!0);var a={};a.post_id=t,a.departmentid=e,a.network=o,a.ele=i,a.createTicket=!0,a.brandId=s;var n={department_id:e},r=this;store.create("crm_social_post",void 0,a,n).then((function(e){r.createDeskTicketcalback(a,e)}))}else crmui.showMsgBand("error",I18n.getMsg("crm.permission.social.choosedepartment"),3e3)},createDeskTicketcalback:function(e,t){commonUtils.showHideLoadingDiv(!1);var o=t.data,s=$L(e.ele),i=e.post_id,a=e.network;if(o&&o.length>0){var n=o[0].ticketNumber;s.text("# "+n).attr({web_link:o[0].webUrl}).removeClass("socDeskIconRotate").removeClass("socialImgsvg socDeskCTkIcon mR8 dIB vaM").addClass("socSupTktCount mR8 socSupTktCountOpen dIB vaM"),$L("#socDeskDepartmentDiv").addClass("dN"),$L("#socConvoContent").removeAttr("style");var r=$L(".parentPost");r.each((function(e){var t=r[e],s=$L(t),c=s.attr("post_id");("facebook"===a&&""!==s.attr("parent_post_id")&&(c=s.attr("parent_post_id")),c===i)&&s.find("#ticketCreate").text("# "+n).attr({web_link:o[0].webUrl}).removeClass("socDeskIconRotate").removeClass("socialImgsvg socDeskCTkIcon mR8 dIB vaM").addClass("socSupTktCount mR8 socSupTktCountOpen dIB vaM")}))}},handleErrorCase:function(e,t,o,s){commonUtils.showHideLoadingDiv(!1);var i=e.responseJSON?e.responseJSON:e.response?JSON.parse(e.response):e,a=void 0!==i.code?i.code:i.status,n=$L(".showmoreNew"),r={USER_NOT_FOUND:I18n.getMsg("crm.social.integ.error.user.notfound1"),USER_SUSPENDED:I18n.getMsg("crm.social.integ.error.user.suspend1"),USER_TOKEN_SUSPENDED:I18n.getMsg("crm.social.integ.reauth.error1"),RATE_LIMIT_REACHED:I18n.getMsg("crm.social.integ.error.internal"),NEED_REAUTH:I18n.getMsg("crm.social.integ.reauth.error1"),TWITTER_OVER_CAPACITY:I18n.getMsg("crm.social.integ.error.internal"),UNKNOWN_ERROR:I18n.getMsg("crm.social.integ.error.internal"),BLOCKED_BY_USER:I18n.getMsg("crm.social.integ.error.user.blocked1.view"),ID_NOT_FOUND:I18n.getMsg("crm.social.integ.error.tweet.notfound1"),DM_FAILED:I18n.getMsg("crm.social.integ.error.dm.failed1"),LIMIT_TO_FOLLOW:I18n.getMsg("crm.social.integ.error.follow.limit1"),BLOCKED_TO_FOLLOW:I18n.getMsg("crm.social.integ.error.user.blocked1"),TWEET_PROTECTED:I18n.getMsg("crm.social.integ.error.tweet.protected"),TWEET_LIMIT_REACHED:I18n.getMsg("crm.social.integ.error.tweet.limit"),DUPLICATE_STATUS:I18n.getMsg("crm.social.integ.error.tweet.dublicate1"),ACCOUNT_LOCKED:I18n.getMsg("crm.social.integ.error.unlock"),MESSAGE_SIZE_EXCEEDS:I18n.getMsg("crm.social.integ.error.message.limit"),DELETED_TWEET:I18n.getMsg("crm.social.integ.error.tweet.deleted1"),ATTACHMENT_LIMIT_EXCEEDS:I18n.getMsg("crm.social.integ.error.attachment.limit1"),NO_PERMISSION:I18n.getMsg("crm.nsocial.contact.admin"),SENT_OUTSIDE_ALLOWED_WINDOW:I18n.getMsg("crm.social.error.directmessage"),DUPLICATE_FAVOURITE:I18n.getMsg("crm.social.error.duplicatelike"),INSUFFICIENT_STORAGE:I18n.getMsg("crm.newfree.limit.exceed"),INVALID_DATA:I18n.getMsg("crm.social.noperm.or.delete"),LIMIT_EXCEEDED:I18n.getMsg("crm.social.social.limit"),USER_BLOCKED:I18n.getMsg("crm.social.integ.error.blocked")};r[a]?"NEED_REAUTH"===a&&i.details?(crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.reauth.error"),3e3),this.updateReAuthStatus(i.details.brand_id,i.details.network)):"NO_PERMISSION"===a?renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",r[a],3e3):"monitor_column"===s&&"POST"===o?"LIMIT_EXCEEDED"===a?crmui.showMsgBand("error",I18n.getMsg("crm.social.social.limit"),3e3):"DUPLICATE_DATA"===a&&crmui.showMsgBand("error",I18n.getMsg("crm.social.filter.exist"),3e3):"GET"!==o||"INVALID_DATA"!==a||"renderMessageDetail"!==t&&"renderParentPostDetail"!==t?"processProfileInfo"===t?this.processProfileInfo(void 0,void 0):crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.error.internal"),3e3):(crmNTCDetailView.hideDetailViewPopup(),crmui.showMsgBand("error",I18n.getMsg("crm.social.noperm.or.delete"),3e3)),n&&n.length>0&&(n.find(".showmoreNewLink").removeClass("dN"),n.find(".showmoreLoadingImg").addClass("dN"))},updateReAuthStatus:function(e,t){var o=this.getAccountByBrandIdAndNetwork(e,t),s=store.peekAll("Social")&&store.peekAll("Social").length>0?store.peekAll("Social")[0]:store.peekAll("social_related_list")[0],i=$L(".socSettingIconOuter").find(".reauthDot");$.each(s.accounts,(function(e,t){t.id===o&&(t.reauth=!0,i.addClass("follow_dot"))})),crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.reauth.error"),3e3)},getNetworkBrandJson:function(e){var t=[],o=store.peekAll("Social")[0].accounts;return $.each(o,(function(o,s){if(s.brand&&s.brand.id===e&&"brand"===s.type){var i=s;switch(i.network){case"twitter":i.parentClass="socTwPosts",i.childClass="socAssoTwIcon";break;case"facebook":i.parentClass="socFbPosts",i.childClass="socAssoFbIcon"}t.push(i)}})),t},processAccount:function(e){$.each(e,(function(e,t){"brand"===t.type&&($.each(t.permissions,(function(e,o){$.each(o.profiles,(function(e,s){s.id===zsoTab.profileId&&(t.perm_type=zsoTab.getPermType(o.type))})),-1!==o.profiles.indexOf(zsoTab.profileId)&&(t.perm_type=o.perm_type)})),zsoTab.accounts[t.id]=t,zsoTab.brandsWithAccounts[t.brand.id]=!0,void 0===zsoTab.brandVsNetwork[t.brand.id]&&(zsoTab.brandVsNetwork[t.brand.id]={}),zsoTab.brandVsNetwork[t.brand.id][t.info.network]=t.id)}))},processAuditLogTime:function(e){if(void 0===e)return json;if(e.title_time=e.disp_time,e.key&&e.diff){var t=[];t.push(e.diff),e.disp_time=I18n.getMsg(e.key,t)}else e.diff?e.key||(e.disp_time=e.diff):e.disp_time=I18n.getMsg(e.key);return e},saveWidgetOrder:function(){var e={};e.csrfParamName=csrfParamName,e.csrfToken=csrfToken;var t=[];$.each($L(".socCustomColumn"),(function(e,o){var s=$L(o).attr("filter_id");s&&t.push(s)})),t.length>1&&(e.order=t.toString(),store.triggerAction("monitor_column","save_order",e).then((function(){})))},applyShadow:function(e,t){$L(e).scrollTop()>50?$L("."+t).addClass("socScrollShadow"):$L("."+t).removeClass("socScrollShadow")},monitorApplySortable:function(){var e=this,t=$L("#socMonitorContentInner");t&&t.length>0&&t.sortable({containment:"#socMonitorContent",tolerance:"pointer",orientation:"horizontal",onDrop:function(){e.saveWidgetOrder()}}),$L("#socMonitorEmpty").removeClass("sortable-element sortable-element-h1")},monitorDestroySortable:function(){var e=$L("#socMonitorContentInner");e&&e.length>0&&e.sortable("destroy")},showMoreLoading:function(e){var t=$L(e).closest(".showmoreNew");t.find(".showmoreNewLink").addClass("dN"),t.find(".showmoreLoadingImg").removeClass("dN")},showMoreRemove:function(e){var t=$L(".showmoreNew");if(e){var o=$L(e).closest(".showmoreNew");o&&o.length>0&&(t=o)}t&&t.length>0&&t[0].remove()},showMessageBox:function(e,t){var o=$L("crm-social-tab-new");o&&o.length>0&&o[0].component.setData({socMsgBandShow:!0,socMsgBandType:e,socMsgBandMessage:t})},setColumnTypeModalHeight:function(e){$L("#"+e)[0].calculateOffset();var t=$L("."+e),o=renderingUtils.windowHeight-30,s=t.find("lyte-modal-header"),i=t.find("lyte-modal-content"),a=t.find("lyte-modal-footer"),n=0;"socColumnTypeModal"===e?n=0===a.length||a.hasClass("dN")?0:a.outerHeight():a.length&&(n=a.outerHeight());var r=o-(s.outerHeight()+n);i.css({"max-height":r+"px",height:r+"px"})},columnTypeHeaderCalc:function(e){$L("#socColumnTypeModal")[0].calculateOffset();var t,o=$L(".socColumnTypeModal"),s=o.find("lyte-modal-header"),i=o.find("lyte-modal-content"),a=o.find("lyte-modal-footer"),n=s.outerHeight(),r=a.outerHeight();"hidden"===e&&(n=0),"show"===e&&(r=0),t=o.find(".lyteModal").outerHeight()-(n+r),i.css({"max-height":t+"px",height:t+"px"})},processAuditLog:function(e){if(e){var t,o=[],s={},i=0,a=0;e&&e.cursor&&(t=e.cursor);for(var n=(e=e.data?e.data:e).length,r=0;r<n;r++){var c=e[r],l=c.auditedtime;if(0===i)i=l.month,a=l.year,(d={date_separator:!0}).month=Utils.getMonth(i),d.year=a,d.auditlogid=Math.floor(1e5*Math.random()+1),o.push(d);else if(l.month!==i){var d;(d={date_separator:!0}).month=Utils.getMonth(i),d.year=a,d.auditlogid=Math.floor(1e5*Math.random()+1),i=l.month,a=l.year,o.push(d)}c.auditedtime=this.processAuditLogTime(c.auditedtime),o.push(c)}s.data=o,s.cursor=t}return s},beforeExitTab:function(){var e=$L("crm-social-right-panel");e&&e.length>0&&e[0].remove();var t=$L("crm-social-post-detail-outer");t&&t.length>0&&t[0].remove();var o=$L("crm-social-quote-tweet-new");o&&o.length>0&&o[0].remove();var s=$L("crm-social-convo-outer-new");s&&s.length>0&&s[0].remove();var i=$L("crm-social-compose-post-new");i&&i.length>0&&i[0].remove();var a=$L("crm-social-right-panel-search");a&&a.length>0&&a[0].remove();var n=$L("crm-zso-entity-create");n&&n.length>0&&n[0].remove()},handleReauth:function(e,t){if("twitter"===t&&void 0!==e){var o=$L("#"+e.network+"_my_col_posts"),s=renderingUtils.createHTML({name:"div",attr:{class:"pA socAccReauth aligncenter"},child:[{name:"span",attr:{class:"dIB svgIcons socAccWarningIcon"}},{name:"span",attr:{class:"dB crmNotFoundColor"},child:[{name:"text",content:I18n.getMsg("crm.social.integ.reauth.error")}]}]});o.empty(),null!==o&&o.append(s),o.closest(".socCustomColumn").find(".socRefresh").removeClass("socRefreshRotate"),this.updateReAuthStatus(e.brand.id,e.network)}},getDetailPage:function(e,t){sE(event);var o=event.target;if(o&&o.className&&"socMsgHandleElement"===o.className)this.processTwitterTagOnclick(o);else{var s=$L(e),i=$L("#socViewConvPopup"),a=s.attr("account_id"),n=s.attr("network"),r=s.attr("parent_post_id"),c=s.attr("brand_id");if("related_list"===t){var l=$L("#socIntDetView");$L("#socIntMsgDiv").fadeOut(),l.fadeIn()}else this.appendPostDetailDiv(),s.parents("#ziaChatbotDiv").length&&i.css("z-index","35");this.getParentPost(c,r,void 0,n,a,void 0,!1,t)}},processFilters:function(e,t){var o={monitor_column:[]},s=this;return $.each(e,(function(e,i){if(void 0!==i.type)switch(i.type){case"mention":i.display_name=I18n.getMsg("crm.social.mentions");break;case"timeline":i.display_name=I18n.getMsg("crm.social.timeline");break;case"like":i.display_name=I18n.getMsg("crm.social.likes");break;case"keyword_search":i.display_name=i.info.keyword,i.title=I18n.getMsg("crm.social.keyword.search");break;case"user_search":i.title=I18n.getMsg("crm.social.user.search"),i.display_name=i.info.name;break;case"page_search":i.title=I18n.getMsg("crm.social.page.search"),i.display_name=i.info.name;break;case"list":i.title=I18n.getMsg("crm.social.lists"),i.display_name=i.info.name;break;default:return}s.getAccountByBrandIdAndNetwork(t,i.network)&&o.monitor_column.push(i)})),o}},{mixins:["crm-social-entity","crm-social-integration"]}),Lyte.Mixin.register("crm-social-tab_actions",{appendPostDetailDiv:function(){commonUtils.showHideLoadingDiv(!0)},getParentPost:function(e,t,o,s,i,a,n,r){var c=Lyte.registeredMixins["crm-social-tab"];if(e||(e=$L(".selectedBrand").attr("value")),!c.checkReauthStatus(e,s,r)){c=this;var l={brand_id:e,network:s,post_id:t,parent_post_id:o,account_id:i,column_id:a,childPost:n,place_type:r};store.findRecord("crm_social_post",t,void 0,void 0,void 0,{brand_id:e,network:s}).then((function(e){commonUtils.showHideLoadingDiv(!1),c.renderParentPostDetail(l,e)}),(function(e){var t=$L("#socViewConvPopup");t&&t[0]&&t[0].remove(),Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e)}))}},renderParentPostDetail:function(e,t){var o=renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight();if(t&&void 0===t.code){var s=t[0].parent_author_name,i=t[0].reply_text,a="@"+s;i.includes(a)&&(t[0].reply_text=i.replace(a,""));var n=t[0]?t[0]:t.crm_social_post?t.crm_social_post[0]:t,r=n.parent_post_id;n.parent_post_id=null,n.place_type="post_detail";var c=$L(".socViewConvoInner"),l=$L("crm-social-tab-new");if("googleplus"!==e.network&&(n.image=!0),e.childPost){var d=document.createElement("crm-social-my-posts");if(d.setData({data:[n],place_type:n.place_type,child_post:!0,preview:!0}),"related_list"===e.place_type)$L("#socIntDetView").find(".socViewConvChild").append(d);else if(l.length>0){$L(".socViewConvoParent").find(".socViewConvChild")[0].prepend(d)}else{$L("#signalPopupInnerDiv").find(".socViewConvChild").append(d),$L(".socViewConvoClose").hide()}thirdPartyUtils.titleForEllipsis(".socIntName")}else{"twitter"===e.network?n.success_text="REPLY":n.success_text="COMMENT";var p=$L("crm-social-post-detail-outer");p&&p.length>0&&p[0].remove();var m=$L("crm-social-quote-tweet-new");m&&m.length>0&&m[0].remove();var u=document.createElement("crm-social-post-detail-outer");if(u.setData(n),"related_list"===e.place_type){u.setData({related_list:!0});var f=$L("#socIntDetView");f.append(u),f.addClass("socOuterContainer"),$L(".socialBackToColumn").removeClass("dN")}else{if(u.setData("renderPostDetails",!0),l.length>0)l.append(u);else{$L("#loadMsg").hide();var g=$L("#showSignalPop");g.append(u),g.addClass("socOuterContainer"),this.setHeightForConvoPopup("Convo"),$L(".socViewConvoClose").hide()}c.css("top",o),this.setHeightForConvoPopup("Convo")}thirdPartyUtils.titleForEllipsis(".socViewConvoHName, .socViewConvoName")}r&&this.getParentPost(e.brand_id,r,r,e.network,e.account_id,e.column_id,!0,e.place_type)}else{var v=$L("#socViewConvPopup");v&&v[0]&&v[0].remove(),Lyte.registeredMixins["crm-social-integration"].handleErrorCase(t,"GET","posts")}},setHeightForConvoPopup:function(e){var t=$L("#tabLayer"),o=null;o=$L("#signalPopupViewContent").is(":visible")?$L("#signalPopupViewContent .popup-model-content").outerHeight()-($L(".socView"+e+"Header").outerHeight()+$L(".socView"+e+"Reply").outerHeight()):renderingUtils.windowHeight-(t.offset().top+t.outerHeight()+70+$L(".socView"+e+"Header").outerHeight()+$L(".socViewConvoInner").find(".socView"+e+"Reply").outerHeight()),$L(".socView"+e+"Parent").css("max-height",o)},viewConvoClose:function(){var e=$L("crm-social-post-detail-outer");e&&e.length>0&&e[0].component.setData("renderPostDetails",!1)},backToMessages:function(){$L("#socAllMessages").removeClass("dN"),$L("#socMessageDetail").addClass("dN").html(""),$L(".socConvMsgTitle").removeClass("dN"),$L(".socBackToMsgs").addClass("dN"),$L("#socIntDetView").hide().html(""),$L("#socIntMsgDiv").show()},postComment:function(e,t,o,s,i,a,n,r,c){if(!this.checkReauthStatus(s,i,r)){t&&(e=e||"");var l={};l.brand_id=s,l.network=i,l.post_id=o,l.postComments=!0;var d={};if(l.message=e,t)l.file=t,l.fileName=t.name;else if(!e)return;l.fdata=d;var p={brand_id:s,place_type:a,post_id:o,network:i,reply_to_comment:n,account_id:c},m=this;store.unloadAll("crm_social_posts_comment"),store.create("crm_social_posts_comment",d,l,void 0).then((function(e){m.processPostComment(p,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e)}))}},processPostComment:function(e,t){var o=Lyte.registeredMixins["crm-social-tab"],s=Lyte.registeredMixins["crm-social-tab_actions"],i=Lyte.registeredMixins["crm-social-integration"];if((t=t.crm_social_posts_comment)&&t[0]){if(t=o.processComments(t),"twitter"===e.network&&(t.data[0]=t[0]),-1===e.place_type.indexOf("detail"))s.removeAddedTemplate(),t[0].parent_post_id=null,t[0].perm=4,t.className="",t.no_action=!0;else{var a=$L('[text_id="'+e.place_type+'"]');a[0].ltProp("value",""),this.processText(e.post_id+"_"+e.place_type,e.network);var n=a.parent().find(".socReplyAttImgs");n.length>0&&s.removeImage(n,e.place_type)}t[0].inline_comment=e.reply_to_comment,"facebook"!==e.network&&"googleplus"!==e.network||s.handleComment(e,!0);var r=$L("#comments_"+e.place_type);if("twitter"===e.network){t[0].child_post=!0;var c=document.createElement("crm-social-my-posts");c.setData("data",t),r.append(c),thirdPartyUtils.titleForEllipsis(".socIntName"),i.processTwitterTags()}else{var l={comments:{data:[t[0]]},place_type:e.place_type,inline_comment:e.reply_to_comment,id:e.post_id};Lyte.Component.render("crm-social-comments-outer",l,"#comments_"+e.place_type)}r.removeClass("dN")}else o.handleErrorCase(t,"POST","comments")},handleComment:function(e,t){var o=e.post_id,s=$L('[id="'+o+'_comment_btn"][account_id="'+e.account_id+'"]');$.each(s,(function(e,o){var s=$L(o),i=s.find(".socialImgsvg");0===i.length&&(i=s.find(".socialImg"));var a=i.next("span"),n=a.html();t?n?a.html(parseInt(n)+1):a.html("1"):"1"===n?a.html(""):a.html(parseInt(n)-1)}))},appendReplyTemplate:function(e,t,o,s,i,a,n){var r={},c=$L(".socDetailModal").find("lyte-modal-content");"related_list"===s?(s=o+"_"+s,r=store.peekAll("social_related_list")[0]):"dashboard_feeds"===s?(s=o+"_"+s,r=store.peekAll("Social")[0]):r=store.peekAll("social_related_list")&&store.peekAll("social_related_list").length>0?store.peekAll("social_related_list")[0]:store.peekAll("Social")[0];var l={};$.each(r.accounts,(function(e,o){if(o.id===t)return l.account=o,o.reauth&&crmui.showMsgBand("error",I18n.getMsg("crm.social.integ.reauth.error"),3e3),!1}));var d=$L(e).closest(".SocContentSections"),p=$L(e).closest("crm-social-comments-detail");p&&p.length>0&&(p[0].component.data.inline_comment&&(d=p.closest(".parentComment").find(".SocContentSections")));if(d.hasClass("templateAdded"))this.removeAddedTemplate();else{this.removeAddedTemplate(),l.place_type=s,l.template_name=a,"twitter"===i?(l.image=!0,l.twitter=!0,l.success_text="REPLY",l.reply_text=n,n=void 0):n?l.success_text="REPLY":("googleplus"!==i&&(l.image=!0),l.success_text="COMMENT"),l.id=o,l.reply_to_comment=n,l.network=i,(e=document.createElement("crm-social-reply-template-new")).setData(l);var m=d.closest(".infoDiv");if(m.append(e),d.addClass("templateAdded"),$L(".templateAdded").closest(".socDetailModal").length){var u=c.scrollTop();u+=82,c.scrollTop(u)}var f=m.find("textarea").focus();f.length>0&&f[0].setSelectionRange(f.val().length,f.val().length)}},removeAddedTemplate:function(){var e=$L(".templateAdded"),t=e.closest(".SocContentSections").parent().parent().find("lyte-input");t&&t[0]&&(t=t.closest(".postResponse"))[0].remove(),e.removeClass("templateAdded")},like:function(e,t,o){var s=$L(e).closest(".infoDiv"),i=s.attr("post_id"),a=s.attr("network"),n=s.attr("brand_id");n||(n=$L(".selectedBrand").attr("value"));var r=s.attr("account_id");this.postLike(n,i,a,!t,r,o)},postLike:function(e,t,o,s,i,a){if(!this.checkReauthStatus(e,o,a)){var n=this,r={brand_id:e,account_id:i,network:o,like:s,post_id:t},c=Lyte.registeredMixins["crm-social-tab"];s?store.triggerAction("crm_social_post","like",{brand_id:e,network:o,post_id:t,method:"POST"}).then((function(e){n.renderPostLike(r,e)}),(function(e){c.handleErrorCase(e.response?JSON.parse(e.response):e)})):store.triggerAction("crm_social_post","like",{brand_id:e,network:o,post_id:t,method:"DELETE"}).then((function(e){n.renderPostLike(r,e)}),(function(e){c.handleErrorCase(e.response?JSON.parse(e.response):e)}))}},renderPostLike:function(e,t){if(t.code)this.handleErrorCase(t,"POST","like");else{var o=e.post_id,s=$L('[id="'+o+'_like_btn"][account_id="'+e.account_id+'"]');this.handleCounts(s,e.like);for(var i="twitter"===e.network?"socFavIconActive":"socFbLikeIconActive",a=s.length,n=0;n<a;n++){var r=s.eq(n),c=r.find(".socialImgsvg");0===c.length&&(c=r.find(".socialImg"));var l=r.closest(".socialActions").find(".socIconsActive").find("."+i);e.like?(c.addClass(i),l.addClass("socialImgsvg")):(c.removeClass(i),l.removeClass("socialImgsvg"))}var d=s.closest("crm-social-comments-detail");d&&d.length>0&&(e.like?d[0].component.data.likes.has_liked=!0:d[0].component.data.likes.has_liked=!1);var p=["crm_social_feed","crm_social_post","crm_social_interaction","crm_social_posts_comment","posts"],m=p.length;for(n=0;n<m;n++){var u=p[n],f=store.peekRecord(u,o);f&&(e.like?f.likes?f.likes.has_liked=!0:f.interaction_info&&f.interaction_info.likes?f.interaction_info.likes.has_liked=!0:f.post_info&&f.post_info.likes?f.post_info.likes.has_liked=!0:f.favorited=!0:f.likes?f.likes.has_liked=!1:f.interaction_info&&f.interaction_info.likes?f.interaction_info.likes.has_liked=!1:f.post_info&&f.post_info.likes?f.post_info.likes.has_liked=!1:f.favorited=!1)}}},retweetTweet:function(e,t,o){var s=$L(e).closest(".infoDiv"),i=s.attr("post_id"),a=s.attr("account_id"),n=s.attr("brand_id");n||(n=$L(".selectedBrand").attr("value")),t?this.retweet(n,i,!1,a,o):this.getPostInfoForRetweet(n,i,o)},getPostInfoForRetweet:function(e,t,o){if(!this.checkReauthStatus(e,"twitter",o)){var s=this,i={brand_id:e,network:"twitter",post_id:t},a=store.peekRecord("crm_social_post",t);a?s.renderPostDetailForRetweet(i,a):store.findRecord("crm_social_post",t,void 0,void 0,void 0,{brand_id:e,network:"twitter"}).then((function(e){s.renderPostDetailForRetweet(i,e)}),(function(e){s.handleErrorCase(e)}))}},renderPostDetailForRetweet:function(e,t){if(commonUtils.showHideLoadingDiv(!1),t.code)this.handleErrorCase(t);else{var o=t[0]?t[0]:t.crm_social_post?t.crm_social_post[0]:t,s=$L("crm-social-quote-tweet-new");s&&s.length>0&&s[0].remove();var i=$L("crm-social-right-panel");i&&i.length>0&&$L(".socProfileDetPopup").is(":visible")&&i[0].component.setData("renderRightPanelPopup",!1);var a=$L("crm-social-convo-outer-new");if(a&&a.length>0)a[0].component.data.related_list||a[0].remove();var n=$L("crm-social-direct-message-new");n&&n.length>0&&n[0].remove(),Lyte.Component.render("crm-social-quote-tweet-new",o,"body").setData("renderQouteTweet",!0)}},retweet:function(e,t,o,s,i){if(!this.checkReauthStatus(e,"twitter",i)){var a=this,n={brand_id:e,network:"twitter",post_id:t,account_id:s,retweet:o},r=o?"POST":"DELETE",c=Lyte.registeredMixins["crm-social-tab"];store.triggerAction("crm_social_post","retweet",{brand_id:e,network:"twitter",post_id:t,method:r}).then((function(e){a.renderRetweet(n,e)}),(function(e){c.handleErrorCase(e.response?JSON.parse(e.response):e,"retweet","POST")}))}},renderRetweet:function(e,t){if(commonUtils.showHideLoadingDiv(!1),t.code)zsoTab.handleErrorCase(t,"POST","retweet");else{var o=e.post_id,s=$L('[id="'+o+'_retweet_btn"][account_id="'+e.account_id+'"]');this.handleCounts(s,e.retweet);for(var i=s.length,a=0;a<i;a++){var n=s.eq(a),r=n.find(".socialImgsvg");0===r.length&&(r=n.find(".socialImg"));var c=n.closest(".socialActions").find(".socIconsActive").find(".socRetweetIcon");e.retweet?(r.addClass("socReTwtIconActive"),c.addClass("socialImgsvg")):(r.removeClass("socReTwtIconActive"),c.removeClass("socialImgsvg"))}var l=["crm_social_feed","crm_social_post","crm_social_interaction","crm_social_posts_comment"],d=l.length;for(a=0;a<d;a++){var p=l[a],m=store.peekRecord(p,o);m&&(e.retweet?m.retweets?m.retweets.has_retweeted=!0:m.interaction_info&&m.interaction_info.retweets?m.interaction_info.retweets.has_retweeted=!0:m.post_info&&m.post_info.retweets?m.post_info.retweets.has_retweeted=!0:m.retweeted=!0:m.retweets?m.retweets.has_retweeted=!1:m.interaction_info&&m.interaction_info.retweets?m.interaction_info.retweets.has_retweeted=!1:m.post_info&&m.post_info.retweets?m.post_info.retweets.has_retweeted=!1:m.retweeted=!1)}if(e.retweet){var u=$L("crm-social-quote-tweet-new");u&&u.length>0&&(u[0].component.setData("renderQouteTweet",!1),u[0].remove());var f=$L("crm-social-streams-outer");f&&f.length>0&&f[0].component.setData("renderSocialStreams",!0);var g=$L("crm-social-right-panel");g&&g.length>0&&g[0].component.setData("renderRightPanelPopup",!0)}}},handleCounts:function(e,t){$.each(e,(function(e,o){var s=$L(o),i=s.find(".socialImgsvg");0===i.length&&(i=s.find(".socialImg"));var a=i.next("span"),n=a.html();t?"0"===n||""===n?a.html("1"):a.html(parseInt(n)+1):"1"===n||"0"===n?a.html(""):a.html(parseInt(n)-1)}))},submitRetweet:function(e,t,o,s,i){var a=$L(e).closest(".infoDiv"),n=a.attr("brand_id");if(n||(n=$L(".selectedBrand").attr("value")),n||(n=i),commonUtils.showHideLoadingDiv(!0),s){if(this.checkReauthStatus(n,"twitter"))return;var r=a.attr("screen_name"),c=this,l={brand_id:n,network:"twitter",post_id:t,method:"POST",retweet:!0,account_id:o};store.triggerAction("crm_social_post","retweet",l,{screen_name:r,message:s}).then((function(e){c.renderRetweet(l,e)}),(function(e){c.handleErrorCase(e)}))}else this.retweet(n,t,!0,o)},getProfileDetailPage:function(e){$L(".socTabBody").addClass("dN");var t=$L(e).closest(".infoDiv"),o=t.attr("brand_id"),s=t.attr("profile_id"),i=t.attr("network"),a=$L("#socDashboardDetailView"),n=$L("#socialTabNew").find(".socTabBody").outerHeight(),r=$L("crm-social-detail-outer");r&&r[0]&&r[0].remove(),Lyte.Component.render("crm-social-detail-outer",{},"#socDashboardDetailView"),a.removeClass("dN"),a.css("height",n+"px"),this.getEntityDetails(s,o,i)},getEntityDetails:function(e,t,o){var s={network:o,profile_id:e,brand_id:t},i=this;store.findAll("crm_social_info",void 0,void 0,void 0,{network:o,profile_id:e}).then((function(e){i.renderEntityDetails(s,e)}))},renderEntityDetails:function(e,t){if(t){var o=null,s={},i=t,a=e.brand_id;if(i.twitter&&this.getAccountByBrandIdAndNetwork(a,"twitter")&&(o=i.twitter,s.twitter=i.twitter),i.facebook&&this.getAccountByBrandIdAndNetwork(a,"facebook")&&(o=null===o?i.facebook:o+","+i.facebook,s.facebook=i.facebook),i.googleplus&&this.getAccountByBrandIdAndNetwork(a,"googleplus")&&(o=null===o?i.googleplus:o+","+i.googleplus,s.googleplus=i.googleplus),o)$L(".profileIds").attr("ids",o),this.getInteractions(void 0,e.brand_id,null,void 0,o,"interaction_page"),this.getProfileInfos(s,i),this.getRightPanelInfo(i);else{$L(".profileIds").attr("ids",e.profile_id);var n=e.network;i={network:e.profile_id},this.getInteractions(void 0,e.brand_id,null,void 0,e.profile_id,"interaction_page"),this.getProfileInfos(n+"="+e.profile_id,i)}}},getRightPanelInfo:function(e){delete $$rightPanel.rpCachedList,$$rightPanel.rpCachedList=new Array,delete $$rightPanel.rpTabOrder,"Accounts"===e.module?$$rightPanel.rpTabOrder=["info","timeline"]:$$rightPanel.rpTabOrder=["conversation","info","timeline"],$$rightPanel.currentModule=e.module,$$rightPanel.entityId=e.id,$$rightPanel.newSocial=!0,$$rightPanel.loadSocial=!1,$$rightPanel.caller="Feeds",$$rightPanel.rpParentContainer="social_parent",$$rightPanel.detailRightPanel("krp_tab1",$$rightPanel.rpTabOrder[0],!0)},getProfileInfos:function(e){var t=$L(".selectedBrand").attr("value"),o=this;store.findAll("crm_social_info",e,void 0,void 0,{brand_id:t}).then((function(t){o.renderProfileInfos(e,t)}))},renderProfileInfos:function(e,t){if(t&&t[0]){var o=$L(".socProfileGp");$.each(t,(function(e,t){if(t.network){var s=null;switch(t.network){case"twitter":s=".socProfileTw";break;case"facebook":s=".socProfileFb";break;case"googleplus":s=o}Lyte.Component.render("crm-social-entity-profile-info",{info:t},s),$L(s).removeClass("dN")}}))}},removeImage:function(e){var t=$L(e),o=t.parents(".socialCommonPreviewDiv");(o.addClass("dN"),t.closest(".socIntDetView").length)?$L(".socIntDetView .socViewConvoParent").css("bottom",""):Lyte.registeredMixins["crm-social-tab"].setHeightForConvoPopup("Convo");o.find("img").removeAttr("src").removeAttr("title"),t.parents(".postResponse").find(".socialCommonAttach").val("")},getMoreLikes:function(e,t,o){var s=$L(e),i=s.closest(".infoDiv"),a=i.attr("post_id"),n=i.attr("network"),r=s.attr("place_type"),c=i.attr("brand_id");c||(c=$L(".selectedBrand").attr("value")),this.getLikes(c,a,n,r,t,o)},getLikes:function(e,t,o,s,i,a){if(!this.checkReauthStatus(e,o)){var n={};i&&(n.cursor=i);var r={brand_id:e,place_type:s,post_id:t,network:o,cursor:i,like_count:a},c=this;app.store.makeRequest("findRecord","crm_social_post",t,n,void 0,void 0,{brand_id:e,network:o,like:"/like"}).then((function(e){c.renderGetLikes(r,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e)}))}},renderGetLikes:function(e,t){if(t&&(e.users=t,e.users.length>20&&(e.paging=t.posts.paging)),e.cursor){$L(".socLikeCountUl").find(".showmoreNew").empty();var o=document.createDocumentFragment();$.each(e.users,(function(e,t){o.append(renderingUtils.createHTML({name:"li",child:[{name:"div",child:[{name:"img",attr:{src:t.image,class:"dIB vaM"}},{name:"span",attr:{class:"dIB vaM mL5 crmNotFoundColor"},child:[{name:"text",content:t.name}]}]}]}))})),e.paging&&o.append(renderingUtils.createHTML({name:"div",attr:{class:"showmoreNew p20 aligncenter"},child:[{name:"a",child:[{name:"text",content:I18n.getMsg("crm.nsocial.tab.show.more")}],attr:{class:"cP","data-zcqa":"cursor",onclick:"sE(event);zsoTab.getMoreLikes(this,'"+JSON.stringify(e.paging)+"')"}}]})),$L("#socLikeCountPopup").find(".socLikeCountUl").append(o)}else{$L("#socLikeCountPopup").empty();var s=document.createElement("crm-social-like-count-popup");s.setData(e),$L("#showSignalPop").after(s)}},dropDownClose:function(){var e=$(".socEntityDropDown");e.is(":visible")&&e.addClass("dN");var t=$(".socEntityInput div[name=ownerNameLookup]");t.is(":visible")&&t.hide()},confirmDelComment:function(e,t,o,s){e=$L(e),$L(".socDeleteIcon").removeAttr("id"),e.attr("id","socDeletePostElement");var i=[],a=e.closest(".parentPost").attr("brand_id");i.push({value:a}),i.push({value:o});var n=null,r=null;s&&""!==s&&o!==s&&"twitter"!==t?(n=I18n.getMsg("crm.nsocial.tab.fb.delete.comment"),i.push({value:s}),r="deleteComment"):(n=I18n.getMsg("crm.nsocial.tab.fb.delete.post"),i.push({value:o}),r="deletePost"),i.push({value:t});var c={message:n,successFn:r,successparams:i},l=document.createElement("crm-social-delete-warning-popup");l.setData(c),$L("#socialDashboard")[0].after(l)},processTextPaste:function(e,t){var o=this;window.setTimeout((function(){o.processText(e,t)}),1)},setModalContentHeight:function(e){Lyte.registeredMixins["crm-social-tab"].setColumnTypeModalHeight(e)}},{mixins:["crm-social-tab","crm-social-integration"]}),Lyte.Component.register("crm-social-interaction-loading",{_template:'<template tag-name="crm-social-interaction-loading"> <template is="for" items="{{index}}" item="item" index="indx"> <div class="socDataLoading flexAlignCenter"> <span class="socCirImgLoad"></span> <div class="socTxtLd mL8"> <div class="socImgTextLoading mB10"></div> <div class="socImgTextLoading mB10"></div> <div class="socImgTextLoading"></div> </div> </div> </template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[]}],_observedAttributes:["index"],data:function(){return{index:Lyte.attr("array")}}}),Lyte.Component.register("crm-social-my-posts",{_template:'<template tag-name="crm-social-my-posts"> <template is="if" value="{{data[0]}}"><template case="true"> <template is="for" items="{{data}}" item="item" index="index"> <div id="{{item.id}}_{{place_type}}" data-zcqa="social_tab_post_detail" class="{{if(item.className,item.className,\'socPostsLists socialPosts\')}} parentPost infoDiv {{if(ifEquals(item.network,\'twitter\'),\'socPostsTw\',\'\')}} {{if(ifAllMatch(,),\'socPostListDelete\',\'\')}} socProfileId_{{item.user.id}} socPostId_{{item.id}}" post_id="{{item.id}}" parent_post_id="{{item.parent_post_id}}" account_id="{{item.account.id}}" network="{{item.network}}" profile_id="{{item.user.id}}" brand_id="{{brand.id}}" onclick="{{action(\'getTweetConversation\',preview,this,item.id,item.parent_post_id,item.network,item.account.id)}}"> <template is="if" value="{{item.retweet_screen_name}}"><template case="true"> <div class="socRetweetSpan mB10"> <span class="socialImg socRetweetedIcon dIB vaM"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{getI18n("crm.nsocial.tab.retweeted.by",item.retweet_screen_name)}}</span> </div> </template></template> <div class="socInteractionPhoto soc{{item.network}}SmallIcon pR dIB vaM cP" onclick="{{action(\'openUrl\',item.network,item.user.link)}}"> <img src="{{item.user.image}}" class="socInteractPhotoImg" alt="Image"> </div> <div class="socInteractionDet dIB vaM"> <template is="if" value="{{ifEquals(item.network,\'facebook\')}}"><template case="true"> <template is="if" value="{{item.entity_info.id}}"><template case="true"> <div class="socIntName crm-small-font-size crm-font-bold cP dIB vaM maxW50per ellipsistext socEntityProfileId_{{item.user.id}}" data-zcqa="social_tab_profile_detail" network="{{item.network}}" entity_profile_id="{{item.user.id}}" onclick="{{action(\'getProfileDetailPage\',item.user.id,this,item.entity_info.id)}}">{{item.user.name}}</div> </template><template case="false"> <div class="socIntName crm-small-font-size crm-font-bold cP dIB vaM maxW50per ellipsistext socEntityProfileId_{{item.user.id}}" data-zcqa="social_tab_profile_detail" network="{{item.network}}" entity_profile_id="{{item.user.id}}" onclick="{{action(\'stopEvent\',event)}}">{{item.user.name}}</div> </template></template> </template><template case="false"> <div class="socIntName crm-small-font-size crm-font-bold cP dIB vaM maxW50per ellipsistext socEntityProfileId_{{item.user.id}}" data-zcqa="social_tab_profile_detail" network="{{item.network}}" entity_profile_id="{{item.user.id}}" onclick="{{action(\'getProfileDetailPage\',item.user.id,this,item.entity_info.id,\'user_search\')}}">{{item.user.name}}</div> </template></template> <template is="if" value="{{expHandlers(preview,\'!\')}}"><template case="true"> <template is="if" value="{{item.entity_info}}"><template case="true"> <template is="if" value="{{item.entity_info.module}}"><template case="true"> <lyte-text class="socModuleName socModNameWidth dIB vaM mL5" lt-prop-value="{{processSocialEntityType(item.entity_info.module)}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-tooltip-class="socTooltip"></lyte-text> </template></template> </template><template case="false"> <template is="if" value="{{ifNotEquals(item.account.info.id,item.user.id)}}"><template case="true"> <template is="if" value="{{item.add_to_crm}}"><template case="true"> <span class="socAddToCRM dIB mL7 cP" data-zcqa="social_tab_add_to_crm" onclick="{{action(\'addToCrm\',this,item.user.id)}}"> <span class="socAddLabel">+ {{getI18n("crm.social.add.crm")}}</span> <span class="socAddLoadingOuter dN"> <span class="socAddLoading"> <span class="socAddLoadCircle"></span><span class="socAddLoadCircle"></span><span class="socAddLoadCircle"></span> </span> </span> </span> </template></template> </template></template> </template></template> </template></template> <div class="fR h20 oH"> <template is="if" value="{{isDeskEnabledinSocial()}}"><template case="true"> <template is="if" value="{{ifNotEquals(item.account.info.id,item.user.id)}}"><template case="true"> <template is="if" value="{{ifEquals(item.account.info.id,item.user.id)}}"><template case="true"> <template is="if" value="{{checkComparison(item.perm,2,\'<\')}}"><template case="true"> <span class="zcrm_svgIcons socDeleteIcon socFbDeletePost fR cP mL5" onclick="{{action(\'deleteComment\',this,item.network,item.id,item.parent_post_id)}}"></span> </template></template> </template></template> <template is="if" value="{{item.desk_details.ticketNumber}}"><template case="true"> <span data-zcqa="social_tickets_{{item.user.id}}" id="ticketNumber" web_link="{{item.desk_details.webUrl}}" class="socSupTktCount crm-small-font-size mR5 {{if(ifEquals(item.desk_details.status,\'Closed\'),\'socSupTktCountClosed\',\' socSupTktCountOpen\')}} cP dIB vaM" onclick="{{action(\'openDeskTicket\',this)}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-title="{{getI18n(\'crm.social.view.ticket\')}}" lt-prop-tooltip-class="socTooltip"># {{item.desk_details.ticketNumber}}</span> </template><template case="false"> <template is="if" value="{{ifNotEquals(item.network,\'googleplus\')}}"><template case="true"> <span data-zcqa="social_ticket_creation_{{item.user.id}}" id="ticketCreate" class="socialImg socDeskCTkIcon mR5 dIB vaM" onclick="{{action(\'openCreateDeskTicket\',this)}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-title="{{getI18n(\'crm.social.convert.ticket\')}}" lt-prop-tooltip-class="socTooltip"></span> </template></template> </template></template> </template></template> </template></template> <div class="crmNotFoundColor crm-small-font-size socConTime h20 dIB vaM">{{parseDate(item.created_at)}}</div> </div> </div> <div class="{{if(item.className,mL50,\'\')}} SocContentSections"> <div class="socListContent socListContentTrim crmBaseColor mT10 pR"> <template is="if" value="{{item.message}}"><template case="true"> <pre class="socPreTag">{{unescape(item.message)}}</pre> </template></template> </div> <crm-social-tab-attachment-process type="{{if(item.type, item.type, item.attachments.0.type)}}" attachments="{{item.attachments}}" link="{{item.link}}"></crm-social-tab-attachment-process> <template is="if" value="{{expHandlers(item.no_action,\'!\')}}"><template case="true"> <template is="if" value="{{ifEquals(item.network,\'twitter\')}}"><template case="true"> <div class="mT15 socialActions"> <div class="socPostsActions actionSection"> <template is="if" value="{{checkComparison(item.perm,3,\'<\')}}"><template case="true"> <span class="socialImg socReplyIcon dIB vaM mR15 cP" data-zcqa="social_tab_reply_post" onclick="{{action(\'reply\',this,item.account.id,item.id,place_type,item.network,\'myposts\',item.reply_text)}}"></span> <span id="{{item.id}}_retweet_btn" account_id="{{item.account.id}}" data-zcqa="social_tab_retweet" class="socRetweetSpan dIB mR15 cP" onclick="{{action(\'retweet\',this,item.retweets.has_retweeted)}}" retweeted="{{if(item.retweets.has_retweeted,\'true\',\'false\')}}"> <span class="socialImg socRetweetIcon dIB vaM {{if(item.retweets.has_retweeted,\'socReTwtIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.retweets.total_count}}</span> </span> <span id="{{item.id}}_like_btn" account_id="{{item.account.id}}" data-zcqa="social_tab_like" class="socFavSpan dIB mR15 cP" onclick="{{action(\'like\',this,item.likes.has_liked)}}" liked="{{if(item.likes.has_liked,\'true\',\'false\')}}"> <span class="socialImg socFavIcon dIB vaM {{if(item.likes.has_liked,\'socFavIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.likes.total_count}}</span> </span> </template><template case="false"> <span id="{{item.id}}_retweet_btn" account_id="{{item.account.id}}" class="socRetweetSpan dIB mR15" onclick="{{action(\'stopEvent\',event)}}" retweeted="{{if(item.retweets.has_retweeted,\'true\',\'false\')}}"> <span class="socialImg eventNone socRetweetIcon dIB vaM {{if(item.retweets.has_retweeted,\'socReTwtIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.retweets.total_count}}</span> </span> <span id="{{item.id}}_like_btn" account_id="{{item.account.id}}" class="socFavSpan dIB mR15" onclick="{{action(\'stopEvent\',event)}}" liked="{{if(item.likes.has_liked,\'true\',\'false\')}}"> <span class="socialImg eventNone socFavIcon dIB vaM {{if(item.likes.has_liked,\'socFavIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.likes.total_count}}</span> </span> </template></template> <template is="if" value="{{item.parent_post_id}}"><template case="true"> <template is="if" value="{{expHandlers(item.child_post,\'!\')}}"><template case="true"> <span class="socViewConv fR crm-extra-small-font-size crmLabelColor mT2 cP" onclick="{{action(\'getTweetConversation\',preview,this,item.id,item.parent_post_id,item.network,item.account.id)}}">{{getI18n("crm.nsocial.tab.view.conversation")}}</span> </template></template> </template></template> <div class="cBoth"></div> </div> </div> </template></template> <template is="if" value="{{ifEquals(item.network,\'facebook\')}}"><template case="true"> <div class="socPostsActions mT15 actionSection" onclick="{{action(\'stopEvent\',event)}}"> <template is="if" value="{{checkComparison(item.perm,3,\'<\')}}"><template case="true"> <span id="{{item.id}}_like_btn" account_id="{{item.account.id}}" data-zcqa="social_tab_like" class="dIB vaM mR15 cP" onclick="{{action(\'like\',this,if(item.likes.has_liked,true,false))}}"> <span class="socialImg socFbLikeIcon dIB vaM {{if(item.likes.has_liked,\'socFbLikeIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.likes.total_count}}</span> </span> <span id="{{item.id}}_comment_btn" account_id="{{item.account.id}}" class="dIB vaM cP" data-zcqa="social_tab_reply_post" onclick="{{action(\'reply\',this,item.account.id,item.id,place_type,item.network,\'myposts\')}}"> <span class="socialImgsvg socFbCommentIcon dIB vaM pR"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.comments.total_count}}</span> </span> </template><template case="false"> <span id="{{item.id}}_like_btn" account_id="{{item.account.id}}" class="dIB vaM mR15" onclick="{{action(\'stopEvent\',event)}}"> <span class="socialImg eventNone socFbLikeIcon dIB vaM {{if(item.likes.has_liked,\'socFbLikeIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.likes.total_count}}</span> </span> <span id="{{item.id}}_comment_btn" account_id="{{item.account.id}}" class="dIB vaM cP" onclick="{{action(\'stopEvent\',event)}}"> <span class="socialImgsvg eventNone socFbCommentIcon dIB vaM pR"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{item.comments.total_count}}</span> </span> </template></template> </div> </template></template> </template></template> <div id="comments_{{item.id}}_{{place_type}}" class="childPosts dN"></div> </div> </div> </template> <div id="comments_{{item.id}}_{{place_type}}" class="childPosts dN"></div> </template><template case="false"> <template is="if" value="{{show_empty}}"><template case="true"> <div class="pA socNoResAlign"> <span class="socialIllustration socEmptyColumn dIB"></span> <div class="aligncenter crmNotFoundColor crm-small-font-size mT15">{{getI18n("crm.social.no.posts")}}</div> </div> </template></template> </template></template> <template is="if" value="{{expHandlers(filter,\'!\')}}"><template case="true"> <template is="if" value="{{cursor.cursor}}"><template case="true"> <div class="showmoreNew p20 aligncenter"> <span onclick="{{action(\'getMyPosts\',this,brand.id,cursor.cursor,network,place_type)}}" class="showmoreNewLink crmLinkColor cP" data-zcqa="cursor">{{getI18n("crm.nsocial.tab.show.more")}}</span> <img src="{{getCrmClientImageUrl(\'loading.gif\')}}" alt="loading" class="showmoreLoadingImg dN"> </div> </template></template> </template><template case="false"> <template is="if" value="{{cursor.cursor}}"><template case="true"> <div class="showmoreNew p20 aligncenter"> <template is="if" value="{{ifEquals(network,\'twitter\')}}"><template case="true"> <span onclick="{{action(\'showMore\',this,id,type,network,search,profile_id,display_name,cursor.cursor,place_type)}}" class="showmoreNewLink cP crmLinkColor" data-zcqa="cursor"> {{getI18n("crm.nsocial.tab.show.more")}} </span> <img src="{{getCrmClientImageUrl(\'loading.gif\')}}" alt="loading" class="showmoreLoadingImg dN"> </template><template case="false"> <span onclick="{{action(\'showMore\',this,id,type,network,search,profile_id,display_name,cursor.cursor,place_type)}}" class="showmoreNewLink crmLinkColor cP" data-zcqa="cursor"> {{getI18n("crm.nsocial.tab.show.more")}} </span> <img src="{{getCrmClientImageUrl(\'loading.gif\')}}" alt="loading" class="showmoreLoadingImg dN"> </template></template> </div> </template></template> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,5,3]},{type:"if",position:[1,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,5,5,1]},{type:"if",position:[1,5,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"text",position:[1,5,5,3,0]},{type:"attr",position:[1,7]},{type:"attr",position:[1,7,1,1]},{type:"if",position:[1,7,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,7,3]},{type:"componentDynamic",position:[1,7,3]},{type:"attr",position:[1,7,5]},{type:"if",position:[1,7,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"text",position:[3,3,0]},{type:"attr",position:[5]},{type:"attr",position:[5,1]},{type:"text",position:[5,3,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"text",position:[3,3,0]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3]},{type:"text",position:[3,3,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3]},{type:"text",position:[3,3,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,7,7]}]},{type:"attr",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,3,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"attr",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"attr",position:[3]}]}},default:{}}]}},default:{}}]}},default:{}}],_observedAttributes:["data","filter","cursor","brand","network","show_empty","display_name","profile_id","id","search"],data:function(){return{data:Lyte.attr("array"),filter:Lyte.attr("boolean",{default:!1}),cursor:Lyte.attr("object"),brand:Lyte.attr("object"),network:Lyte.attr("string"),show_empty:Lyte.attr("boolean",{default:!1}),display_name:Lyte.attr("string"),profile_id:Lyte.attr("string"),id:Lyte.attr("string"),search:Lyte.attr("string")}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{getTweetConversation:function(e,t,o,s,i,a){this.stopEvent(event);var n=event.target,r=n?n.parentElement:void 0;if(n&&n.className&&"socMsgHandleElement"===n.className)this.processTwitterTagOnclick(n);else if((n=n&&r&&"socFbMulLink"===r.className?r:"socTabLink"===n.className?r.parentElement:n)&&n.className&&"socFbMulLink"===n.className){var c=n.getAttribute("link");networkUtils.openUrl(c,"_blank")}else{var l=$L(".selectedBrand").attr("value");this.appendPostDetailDiv(),this.getParentPost(l,o,s,i,a,void 0)}},openUrl:function(e,t){this.stopEvent(event),"twitter"===e&&networkUtils.openUrl(t,"_blank")},getProfileDetailPage:function(e,t,o,s){this.stopEvent(event),o||"user_search"!==s?(this.getProfileDetailPage(t),this.closeRightPanel()):this.showSocialProfilePanel(t,"user_search")},getProfileInfo:function(e){this.getProfileInfo(e)},addToCrm:function(e,t){this.stopEvent(event),this.getProfileInfo(e,t)},reply:function(e,t,o,s,i,a,n){this.stopEvent(event),"rightpanel_popup"!==s&&"social_post_tab"!==s&&"myposts"!==a||(s=o+"_"+s),this.appendReplyTemplate(e,t,o,s,i,a,n),this.monitorDestroySortable()},like:function(e,t){this.stopEvent(event),this.like(e,t)},retweet:function(e,t){commonUtils.showHideLoadingDiv(!0),this.stopEvent(event),this.retweetTweet(e,t)},deleteComment:function(e,t,o,s){this.stopEvent(event),this.confirmDelComment(e,t,o,s)},getMyPosts:function(e,t,o,s,i){(o=JSON.stringify(o))&&this.showMoreLoading(e),this.getMyPosts(e,t,o,s,i)},showMore:function(e,t,o,s,i,a,n,r,c){this.showMoreLoading(e),this.getFilterFeedsCommon(e,t,o,s,i,a,n,r,c)},openDeskTicket:function(e){this.stopEvent(event),this.openDeskTicket(e)},openCreateDeskTicket:function(e){this.stopEvent(event),this.openCreateDeskTicket(e)}},closeRightPanel:function(){var e=$L("crm-social-right-panel");e&&e.length>0&&(e[0].component.setData("renderRightPanelPopup",!1),e[0].remove())},setMonitorContentWidth:function(){var e=$("#socMonitorContentInner"),t=renderingUtils.windowWidth,o=$L("#socMonitorContentInner .socCustomColumn"),s=(o.outerWidth()+12)*o.length;s>t?e.css("width",s):e.css("width",""),o.length>0?$L("#socMonitorEmpty").addClass("dN"):$L("#socMonitorEmpty").removeClass("dN")},stopEvent:function(e){Lyte.registeredMixins["crm-stop-event"].actions.stopEvent(e)}},{mixins:["crm-social-tab","crm-social-tab_actions","crm-social-entity","crm-stop-event","crm-social-integration"]}),Lyte.Component.register("crm-social-profile-info",{_template:'<template tag-name="crm-social-profile-info"> <div class="readOnlyMode"> <template is="if" value="{{ifEquals(info.network,\'twitter\')}}"><template case="true"> <div class="mB15"> <div class="socAssociatedImg pR dIB vaM mR5"><img src="{{info.image}}" onclick="{{action(\'saveSocialImage\',\'twitter\',brid,account_id,marking_id)}}" title="{{getI18n(\'crm.ln.saveImage.title\',\'Zoho\')}}" alt="Image" class="cP"></div> <a href="{{info.link}}" target="_blank" rel="noopener noreferrer"><span class="socNwName dIB vaM crmBaseColor cP ellipsistext" id="{{info.network}}_name">{{info.name}}</span></a> <template is="if" value="{{info.screen_name}}"><template case="true"><span class="dIB vaM cP crm-small-font-size crmNotFoundColor mL5" id="{{info.network}}_screen_name">@{{info.screen_name}}</span></template></template> <template is="if" value="{{info.description}}"><template case="true"><span class="zcrm_svgIcons socAssoDescIcon dIB vaM mL3 op3" lt-prop-title="{{info.description}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottomright&quot;}" lt-prop-tooltip-class="socDetailTooltip"></span></template></template> </div> <div id="follow_{{info.id}}" class="clearFix pR mB15"> <div class="{{if(info.following,\' socTwFollowing \',\' socTwFollow \')}} dIB pR vaM crm-base-font-size crm-font-medium"> <template is="if" value="{{info.follow_request_sent}}"><template case="true"> <span id="{{info.id}}_follow_btn" data-zcqa="social_twitter_follow_status" account_id="{{account_id}}" onclick="{{action(\'follow\',info.id,account_id,following)}}" class="socTwFollowText cP" onmouseenter="{{action(\'showText\',this,getI18n(\'crm.nsocial.cancel\'))}}" onmouseleave="{{action(\'showText\',this,getI18n(\'crm.tw.label.following\'))}}" bind="true">{{getI18n("crm.tw.label.pending")}}</span> </template><template case="false"> <template is="if" value="{{info.following}}"><template case="true"> <span id="{{info.id}}_follow_btn" data-zcqa="social_twitter_follow_status" account_id="{{account_id}}" onclick="{{action(\'follow\',info.id,account_id,following)}}" class="socTwFollowText cP" onmouseover="{{action(\'showText\',this,getI18n(\'crm.tw.label.unfollow\'))}}" onmouseout="{{action(\'showText\',this,getI18n(\'crm.tw.label.following\'))}}" bind="true">{{getI18n("crm.tw.label.following")}}</span> </template><template case="false"> <span id="{{info.id}}_follow_btn" data-zcqa="social_twitter_follow_status" account_id="{{account_id}}" onclick="{{action(\'follow\',info.id,account_id,following)}}" class="socTwFollowText cP" bind="true">{{getI18n("crm.tw.label.follow")}}</span> </template></template> </template></template> <template is="if" value="{{moreAccounts}}"><template case="true"> <span class="socTwFolArrow dIB cP pR mL5" onmouseover="{{action(\'hoverFromArrow\',this,\'hover\')}}" onmouseout="{{action(\'hoverFromArrow\',this,\'hoverout\')}}" onclick="{{action(\'getFollowInformation\',this,info.id,\'pf_follow\')}}" data-zcqa="follow_toggle"><span class="zcrm_svgIcons followArrow dIB vaM mL7"></span></span> </template></template> </div> <lyte-button class="socTweetText vaM mL5" onclick="{{action(\'addPostDiv\',\'twitter\',info.screen_name)}}"> <template is="registerYield" yield-name="text"> <span class="socialImg socTweetIcon dIB vaM mR5"></span><span class="vaM">{{getI18n("crm.tw.button.label.tweet")}}</span> </template> </lyte-button> <span data-zcqa="social_profile_dissociate" class="zcrm_svgIcons socProfDisassociate cP mT7 fR readOnlyMode" lt-prop-title="{{getI18n(\'crm.social.button.deassociate\')}} {{firstLetterCap(info.network)}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-tooltip-class="socDetailTooltip" onclick="{{action(\'saveProfile\',info.network,info.id,false)}}"></span> </div> </template><template case="false"> <div> <div class="socAssociatedImg pR dIB vaM mR5"><img src="{{info.image}}" onclick="{{action(\'saveSocialImage\',info.network,brid,account_id,marking_id)}}" title="{{getI18n(\'crm.ln.saveImage.title\',)}}" alt="Image" class="cP"></div> <span class="socNwName dIB vaM crmBaseColor cP ellipsistext" id="{{info.network}}_name">{{info.name}}</span> <span data-zcqa="social_profile_dissociate" class="zcrm_svgIcons socProfDisassociate cP fR mT10 readOnlyMode top12" lt-prop-title="{{getI18n(\'crm.social.button.deassociate\')}} {{firstLetterCap(info.network)}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-tooltip-class="socDetailTooltip" onclick="{{action(\'saveProfile\',info.network,info.id,false)}}"></span> </div> </template></template> <template is="if" value="{{ifEquals(info.network,\'twitter\')}}"><template case="true"> <div class="count_datails clearFix"> <span class="crmParagraphColor fL"> <span class="dB crm-small-font-size mB4">{{getI18n("crm.tw.label.tweets")}}</span> <span class="dIB crm-base-font-size">{{changeNum(info.statuses_count)}}</span> </span> <span class="crmParagraphColor fL"> <span class="dB crm-small-font-size mB4">{{getI18n("crm.tw.label.following")}}</span> <span class="dIB crm-base-font-size">{{changeNum(info.friends_count)}}</span> </span> <span class="crmParagraphColor fL"> <span class="dB crm-small-font-size mB4">{{getI18n("crm.tw.label.followers")}}</span> <span class="dIB crm-base-font-size">{{changeNum(info.followers_count)}}</span> </span> </div> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,0]},{type:"text",position:[1,3,0,0]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1]}]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[0]}]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"attr",position:[3,1,1]},{type:"if",position:[3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[2,0]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,3,0]},{type:"text",position:[1,3,1,0]},{type:"text",position:[1,3,3,0]},{type:"text",position:[1,5,1,0]},{type:"text",position:[1,5,3,0]}]}},default:{}}],_observedAttributes:["info","following","profile_id","marking_id"],data:function(){return{info:Lyte.attr("object"),following:Lyte.attr("boolean"),profile_id:Lyte.attr("string"),marking_id:Lyte.attr("string")}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{saveSocialImage:function(e,t,o,s){var i="Crm_Implied_Edit_"+$L("#module").val();if(!Crm.userDetails.permissions[i]||"undefined"!=typeof businessCardJson&&(businessCardJson.sharedType&&"Read Only"===businessCardJson.sharedType||businessCardJson.isProfileImageReadOnly||!businessCardJson.isProfileImageAccessible))return crmui.showMsgBand("error",I18n.getMsg("crm.recordImage.socialInteg.warning"),5e3),void this.socContainMsgBandTop();var a=document.createElement("crm-social-save-image-confirm");a.setData({network:e,brid:t,account_id:o,marking_id:s}),$L("#showSignalPop")[0].after(a),$L("crm-social-save-image-confirm")[0].component.setData("addImageConfirm",!0)},follow:function(e,t,o){this.stopEvent(event);var s={profileId:e,account_id:t,follow:!0},i=this;o?this.unfollow(e,t):app.store.makeRequest("triggerAction","social-profile","follow",s).then((function(e){i.processFollow(s,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e.response?JSON.parse(e.response):e)}))},getFollowInformation:function(e,t){sE(event),commonUtils.showHideLoadingDiv(!0);var o=store.peekAll("social_related_list")[0],s=this.getAllAccountsByCriteria("twitter",void 0,3,1),i=this.getTwitterIds(s);if(o&&void 0!==o.TWFollowInfo[t])if(objectUtils.getLength(o.TWFollowInfo[t])!==objectUtils.getLength(i))this.getAllAccountDmStatus(t,"processFollowInformation",i);else{var a={profileId:t};this.processFollowInformation(a)}else this.getAllAccountDmStatus(t,"processFollowInformation",i)},addPostDiv:function(e,t){if(this.stopEvent(event),"twitter"===e){var o=this.getAllAccountsByCriteria("twitter",void 0,1,1);if(o.length>0){var s=o[0];if(o.length>0&&(s.moreaccount=!0),t){var i=$L("#twitter_screen_name");t=i.length>0?i.html().replace("@","").trim():""}s.replyText=t,s.place_type="post_twitter_integ",s.renderTweetPost=!0;var a=$L("crm-twitter-post-create");a&&a.length>0&&a[0].remove(),Lyte.Component.render("crm-twitter-post-create",s,"body").setData("content","@"+t);var n=$L("#resp_box").find("textarea").eq(0);n.focus(),void 0!==n[0]&&n[0].setSelectionRange(n.val().length,n.val().length)}}},saveProfile:function(e,t,o){this.stopEvent(event),this.saveProfile(e,t,o)},showText:function(e,t){$L(e).html(t)},hoverFromArrow:function(e,t){e=$L(e).parent("div");"hover"===t&&e.hasClass("socTwFollowing")?e.addClass("socNoHoverBg"):e.removeClass("socNoHoverBg")},onMouseEnter:function(e){var t=this.getData("info");"encode"===e?crmui.showTooltip({content:t.description,isHTML:!1,position:"left"}):crmui.showTooltip({content:I18n.getMsg("crm.social.button.deassociate")+" "+t.network.charAt(0).toUpperCase()+t.network.slice(1),isHTML:!1,position:"center"})}},socContainMsgBandTop:function(){var e=$L("[ddname=SOCIALPERSONALITY]").offset().top-$L("#crm-msg").outerHeight()-30;$L(".socContainMsgBand").css("transform","translate(-50%, "+e+"px)")},processFollow:function(e,t){if(t.profiles[0].id){var o=e.follow?"follow":"unfollow",s=store.peekAll("social_related_list")[0];if(s&&this.data.profile_id){var i=s.TWFollowInfo[this.data.profile_id][e.account_id];e.follow?i.source.following=!0:i.source.following=!1}this.followBtnEventBinding(e.profileId,e.account_id,o)}},followBtnEventBinding:function(e,t,o){for(var s=$L('[id="'+e+'_follow_btn"][account_id="'+t+'"][bind="true"]'),i=$L('[id="'+e+'_follow_btn"][account_id="'+t+'"][bind="false"]'),a=s.length,n=$L("crm-social-profile-info"),r=0;r<a;r++){var c=s.eq(r),l=null,d=null;if("follow"===o)l=I18n.getMsg("crm.tw.label.following"),d=I18n.getMsg("crm.tw.label.unfollow"),c.closest(".socTwFollow").addClass("socTwFollowing").removeClass("socTwFollow"),n[0].setData({following:!0});else{if("unfollow"!==o)return;d=l=I18n.getMsg("crm.tw.label.follow"),c.closest(".socTwFollowing").addClass("socTwFollow").removeClass("socTwFollowing"),n[0].setData({following:!1})}c.html(l),i.html(l),this.htmlOverChange(c,d),this.htmlOutChange(c,l)}},htmlOverChange:function(e,t){e.mouseover((function(){e.html(t)}))},htmlOutChange:function(e,t){e.mouseout((function(){e.html(t)}))},unfollow:function(e,t){this.stopEvent(event);var o={profileId:e,account_id:t,follow:!1},s=this;app.store.makeRequest("triggerAction","social-profile","follow",o).then((function(e){s.processFollow(o,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e.response?JSON.parse(e.response):e)}))},getAllAccountDmStatus:function(e,t,o){var s=store.peekAll("social_related_list")[0];if(o.length>0&&void 0!==s.allAccounts){var i=[];if($.each(o,(function(t,o){void 0!==s.TWFollowInfo[e]&&void 0!==s.TWFollowInfo[e][o]||i.push(o)})),i.length>0){var a={ids:i.toString()};this.showDMSection(o,a,t)}}}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-social-network-suggest-left",{_template:'<template tag-name="crm-social-network-suggest-left"> <template is="if" value="{{ifNotEquals(network,\'facebook\')}}"><template case="true"> <div class="m0" data-zcqa="social_integ_left_panel"> <span class="socialImg socAsssNwIcon {{icon}} dIB"></span> <span class="dIB vaM mL10"> <span class="crm-base-font-size crmBaseColor fwBold dB pB5">{{getI18n("crm.social.button.associate")}} X</span> <span class="crm-small-font-size crmNotFoundColor"> <template is="if" value="{{checkComparison(count,19,\'>\')}}"><template case="true"> {{getI18n("crm.social.integ.more.suggest",count)}} </template><template case="false"> {{getI18n("crm.social.integ.suggest",count)}} </template></template> </span> </span> </div> </template></template> <template is="if" value="{{ifNotEquals(network,\'facebook\')}}"><template case="true"> <template is="if" value="{{rlLyteNew}}"><template case="true"><lyte-button lt-prop-appearance="primary" lt-prop-class="outlineprimary mT15" onclick="{{action(\'changeLeftPanel\',this,network)}}"><template is="registerYield" yield-name="text">{{getI18n("crm.social.add.and.associate")}}</template></lyte-button></template><template case="false"><button type="button" class="outlinegreenlight newbutton mR0 mT15" onclick="{{action(\'changeLeftPanel\',this,network)}}">{{getI18n("crm.social.add.and.associate")}}</button></template></template> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"attr",position:[1,3,3,1]},{type:"if",position:[1,3,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"registerYield",position:[0,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,0]}]}},default:{}}]}},default:{}}],_observedAttributes:["count","display_network","icon","network","rlLyteNew"],data:function(){return{count:Lyte.attr("string"),display_network:Lyte.attr("string"),icon:Lyte.attr("string"),network:Lyte.attr("string"),rlLyteNew:Lyte.attr("boolean",{default:Crm.userDetails.isRelatedListLyteEnabled})}},actions:{changeLeftPanel:function(e,t){var o=$L("#"+t+"_searchbox").val();o&&$L("crm-social-integ-outer-template")[0].component.getSearchInfo(t,o)}}}),Lyte.Component.register("crm-follow-list",{_template:'<template tag-name="crm-follow-list"> <template is="if" value="{{data}}"><template case="true"> <div id="folwHandle" class="followHandle pA bg_white pT8 pB8 br_border1" onmouseover="{{action(\'onMouseOver\')}}" data-close="true"> <template is="forIn" object="{{data}}" value="value" key="key"> <template is="if" value="{{value.info}}"><template case="true"> <div class="crm-small-font-size flexAlignCenter"> <img src="{{value.info.image}}" alt="Image"> <span class="mL5">{{value.source.screen_name}}</span> <template is="if" value="{{value.source.following}}"><template case="true"> <span id="{{value.target.id_str}}_follow_btn" account_id="{{key}}" data-zcqa="twitter_follow" class="profileFollow fR w75 alignRight" onmouseover="{{action(\'showText\',this,getI18n(\'crm.tw.label.unfollow\'))}}" onmouseout="{{action(\'showText\',this,getI18n(\'crm.tw.label.following\'))}}" onclick="{{action(\'follow\',value.target.id_str,key,value.source.following)}}" bind="true"> {{getI18n("crm.tw.label.following")}} </span> </template><template case="false"> <span id="{{value.target.id_str}}_follow_btn" account_id="{{key}}" data-zcqa="twitter_unfollow" class="profileFollow fR w75 alignRight" onclick="{{action(\'follow\',value.target.id_str,key,value.source.following)}}" bind="true"> {{getI18n("crm.tw.label.follow")}} </span> </template></template> </div> </template></template> </template> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}}]}},default:{}}]}]}},default:{}}],_observedAttributes:["data"],data:function(){return{data:Lyte.attr("object")}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{follow:function(e,t,o){var s={profileId:e,account_id:t,follow:!o},i=$L("crm-social-profile-info")[0].component;o?this.unfollow(e,t):app.store.makeRequest("triggerAction","social-profile","follow",s).then((function(e){i.processFollow(s,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e.response?JSON.parse(e.response):e)})),this.stopEvent(event)},showText:function(e,t){$L(e).html(t)},onMouseOver:function(e){$(e).show()}},unfollow:function(e,t){this.stopEvent(event);var o={profileId:e,account_id:t,follow:!1},s=$L("crm-social-profile-info")[0].component;app.store.makeRequest("triggerAction","social-profile","follow",o).then((function(e){s.processFollow(o,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e.response?JSON.parse(e.response):e)}))}}),Lyte.Component.register("crm-social-search-info",{_template:'<template tag-name="crm-social-search-info"> <template is="if" value="{{profiles[0]}}"><template case="true"> <template is="for" items="{{profiles}}" item="profile" index="index"> <div class="socProfileSugg" id="{{profile.id}}_searchResp"> <div class="socProfilePhoto dIB vaM mR8 pR"> <img src="{{profile.image}}" class="dIB {{if(ifEquals(network,\'twitter\'),\'vaT\',\'vaM\')}}" alt="Image"> </div> <div class="dIB vaM w60_per"> <template is="if" value="{{ifEquals(network,\'twitter\')}}"><template case="true"> <div class="mB3"> <a href="{{profile.link}}" target="_blank" rel="noopener noreferrer"> <span class="socSearchName dIB vaM crmBaseColor crm-base-font-size fwBold cP ellipsistext">{{profile.name}}</span> </a> <template is="if" value="{{profile.verified}}"><template case="true"> <span class="socialImg socVerifiedIcon dIB vaM"></span> </template></template> <template is="if" value="{{profile.screen_name}}"><template case="true"> <a href="{{profile.link}}" target="_blank" rel="noopener noreferrer"> <span class="vaM crmNotFoundColor crm-base-font-size cP">@{{profile.screen_name}}</span> </a> </template></template> </div> <template is="if" value="{{profile.description}}"><template case="true"> <span class="dB crmNotFoundColor crm-small-font-size wordBreak">{{profile.description}}</span> </template></template> </template><template case="false"> <a href="{{profile.link}}" target="_blank" rel="noopener noreferrer"><span class="socSearchName dIB vaM ellipsistext crmBaseColor crm-base-font-size fwBold cP">{{profile.name}}</span></a> <template is="if" value="{{profile.verified}}"><template case="true"><span class="socialImg socVerifiedIcon dIB vaM"></span></template></template> </template></template> </div> <lyte-button id="zso_AssociateProfile_{{profile.id}}_search" class="mR0 fR mT5" lt-prop-class="outlineprimary" data-zcqa="social_profile_associate" onclick="{{action(\'saveProfile\',network,profile.id,true,false,this)}}"> <template is="registerYield" yield-name="text"> <span id="zso_add_account_label_fb" class="socBtnLoadText">{{getI18n("crm.social.integ.profile.associate")}}</span> <div class="socBtnLoading socOutlineBtn dN"> <span class="socBtnLoadCircle mR3"></span><span class="socBtnLoadCircle mR3"></span><span class="socBtnLoadCircle"></span> </div> </template> </lyte-button> <span class="cBoth"></span> </div> </template> <template is="if" value="{{offset}}"><template case="true"> <div class="aligncenter pR show_more" id="{{network}}_search_more"> <div class="showmoreIcn cP dB pT5 pB5" data-zcqa="social_search_profile_more" onclick="{{action(\'getSearchInfo\',network,type,offset)}}"> <span class="showmoreIcon crm-small-font-size crmNotFoundColor"></span> <span class="showmoreLoadIcon vaM dN"><img src="{{getCrmImageUrl(\'social_loading.gif\')}}" alt="Loading"></span> </div> </div> </template></template> </template><template case="false"> <template is="if" value="{{showEmpty}}"><template case="true"> <div class="hInherit"> <div class="socNoResAlign pA"> <div class="aligncenter socialIllustration {{if(ifEquals(network,\'twitter\'),\'socNoResTw\',\'\')}}{{if(ifEquals(network,\'facebook\'),\'socNoSearchFb\',\'\')}} {{if(ifEquals(network,\'googleplus\'),\'socNoSearchGp\',\'\')}} mAuto"></div> <template is="if" value="{{ifNotEquals(network,\'facebook\')}}"><template case="true"> <span class="aligncenter dB mT10 crm-heading-font-size">{{getI18n("crm.social.integ.no.result")}}</span> </template><template case="false"> <span class="aligncenter dB mT10 crm-base-font-size fs crmLabelColor">You cannot search a profile in {{displayNetwork}}. This has to be associated from the Social Tab</span> </template></template> </div> </div> </template></template> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,5]},{type:"registerYield",position:[1,5,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1,5]}]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}}],_observedAttributes:["profiles"],data:function(){return{profiles:Lyte.attr("array")}},actions:{saveProfile:function(e,t,o,s,i){this.saveProfile(e,t,o,s,i)},getSearchInfo:function(e,t,o){$L("crm-social-integ-outer-template")[0].component.getSearchInfo(e,void 0,t,o)}}},{mixins:["crm-social-integration","crm-stop-event"]}),Lyte.Component.register("crm-twitter-post-create",{_template:'<template tag-name="crm-twitter-post-create"> <lyte-modal id="socNewTweetModal" lt-prop-wrapper-class="socNewTweetModal" lt-prop-width="600px" lt-prop-height="auto" lt-prop-show="{{lbind(renderTweetPost)}}" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-close-on-escape="false" lt-prop-show-close-button="false" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> {{getI18n("crm.social.integ.new.tweet")}} </lyte-modal-header> <lyte-modal-content class="pB30"> <div id="socPostPopup" class="twitter_reply_box postResponse socPostId_{{id}}" account_id="{{id}}" screen_name="{{user.screen_name}}" post_id="{{id}}"> <div screenname="{{user.screen_name}}" class="socIntReplyBox mB15"> <span id="twt_img" class="socIntReplyImg socReplyTw pR dIB socialCommonImage cP" data-attr="popup" onclick="{{action(\'showTwitterProfiles\',this,1,\'changeReplyId\',\'socPostPopup\')}}"> <img src="{{info.image}}" class="dIB vaT" title="{{info.screen_name}}" alt="Image"> <template is="if" value="{{moreaccount}}"><template case="true"> <span class="dmdropArrow socialImgsvg cP pA"></span> </template></template> </span> <div class="socIntRepTxtBox dIB vaT bg_white p10 pR"> <lyte-input class="socReplyTemplateInput socNewTweetPopInput w100_per socialCommonText" lt-prop-class="socReplyTemplateInputText" id="resp_box" lt-prop-autofocus="true" text_id="{{place_type}}_{{id}}" lt-prop-type="textarea" lt-prop-text-area-resize="{&quot;vertical&quot;:false,&quot;horizontal&quot;:false}" lt-prop-direction="horizontal" lt-prop-appearance="flat" lt-prop-id="resp_box" data-zcqa="twitter_post_create" on-value-change="{{method(\'processTwitterSuggestion\',place_type,id,true,this,event,\'popup\')}}" lt-prop-maxlength="10000" lt-prop-value="{{lbind(content)}}" u_name="{{screen_name}}" reply="@{{replyText}}"></lyte-input> <div class="socReplyAttImg mT10 pR dN socialCommonPreviewDiv"> <div class="socReplyAttImgs fL"> <img id="soc_comment_img" src="{{getCrmImageUrl(\'spacer.gif\')}}" class="socialCommonPreview w100 h100" alt="Image"> </div> <div class="cBoth"></div> <span data-zcqa="twitter_post_remove_image" class="zcrm_svgIcons socRepImgClose pA cP" onclick="{{action(\'removeImage\',this,place_type,id)}}"></span> </div> </div> </div> <div class="fL mL50"> <span class="socialImg socAttachIcon mR5 vaM" onclick="{{action(\'stopEvent\')}}"> <input data-zcqa="twitter_post_image" type="file" id="commentimage" class="socialCommonAttach pA" accept="image/*" onclick="{{action(\'stopEvent\')}}" onchange="{{action(\'onImageSelected\',event,this,place_type,id,\'twitter\')}}"> </span> <span id="twitter_limit" limit_id="{{place_type}}_{{id}}" class="socReplyCount crmBaseColor op5 crm-extra-small-font-size dIB vaM">{{process(replyText)}}</span> </div> <div class="fR"> <span data-zcqa="twitter_post_cancel" class="socReplyCancel crmBaseColor mR10 ttUppercase crm-small-font-size op5 cP" onclick="{{action(\'socRemovePopup\',\'socPostPopup\',place_type,id)}}">{{getI18n("crm.nsocial.cancel")}}</span> <span data-zcqa="twitter_post_success" id="resp_button" button_id="{{place_type}}_{{id}}" class="socReplyBtn crmLinkColor ttUppercase crm-small-font-size cP eventNone op5 socialButtons" onclick="{{action(\'submitPostTweet\',this,place_type,id)}}">{{getI18n("crm.button.post")}}</span> </div> <div class="cBoth"></div> </div> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"attr",position:[3,1,1]},{type:"attr",position:[3,1,1,1]},{type:"attr",position:[3,1,1,1,1]},{type:"attr",position:[3,1,1,1,3]},{type:"if",position:[3,1,1,1,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[3,1,1,3,1]},{type:"componentDynamic",position:[3,1,1,3,1]},{type:"attr",position:[3,1,1,3,3,1,1]},{type:"attr",position:[3,1,1,3,3,5]},{type:"attr",position:[3,1,3,1]},{type:"attr",position:[3,1,3,1,1]},{type:"attr",position:[3,1,3,3]},{type:"text",position:[3,1,3,3,0]},{type:"attr",position:[3,1,5,1]},{type:"text",position:[3,1,5,1,0]},{type:"attr",position:[3,1,5,3]},{type:"text",position:[3,1,5,3,0]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["id","info","moreaccount","user","replyText","content","renderTweetPost"],data:function(){return{id:Lyte.attr("string"),info:Lyte.attr("object"),moreaccount:Lyte.attr("boolean"),user:Lyte.attr("object"),replyText:Lyte.attr("string"),content:Lyte.attr("string"),renderTweetPost:Lyte.attr("boolean",{default:!1})}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{showTwitterProfiles:function(e,t,o,s){this.addIdInDropArrow(e),this.showTwitterProfiles(e,t,o,s),this.stopEvent(event)},stopEvent:function(e){this.stopEvent(e)},removeImage:function(e,t,o){this.stopEvent(event),t=t+"_"+o,delete this.data.file,this.removeImage(e,t,!0)},onImageSelected:function(e,t,o,s,i){o=o+"_"+s;var a=this.onImageSelected(e,t,o,i);this.setData({file:a})},socRemovePopup:function(e,t,o){this.setData("renderTweetPost",!1)},submitPostTweet:function(e,t,o){this.stopEvent(event),t=t+"_"+o,this.submitPostTweet(e,t)},preventCursor:function(e){this.preventCursor(e)},preventDefaultChar:function(e){this.preventDefaultChar(e)}},methods:{processTwitterSuggestion:function(e,t,o,s,i,a){e=e+"_"+t;var n=this.data.content;this.processText(e,o,n)}},socRemovePopup:function(e,t){crmui.hidePopup(e);var o=$("#"+e);delete this.data.file,this.removeImage(o.find(".socRepImgClose"),t),o.remove()},submitPostTweet:function(e,t){$L(e).prop("disabled",!0).css("opacity","0.5").css("pointer-events","none");var o=$L(e).closest(".postResponse").attr("account_id"),s=this.data.content,i=this.getData("file");""===s&&void 0===i||this.postTweet(o,s,i,void 0,t)}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-social-change-account",{_template:'<template tag-name="crm-social-change-account"> <lyte-popover class="socProfileChangePop" lt-prop-origin-elem="#twitterDmDrop" lt-prop-duration="100" lt-prop-width="185px" lt-prop-content-padding="7px 0" lt-prop-show="{{lbind(renderAccounts)}}" lt-prop-freeze="true" lt-prop-type="callout" lt-prop-placement="bottom top" lt-prop-close-on-escape="false" lt-prop-close-on-body-click="true" lt-prop-show-close-button="false" lt-prop-dimmer="{&quot;color&quot;:&quot;var(--modalFreezeLayerBg)&quot;, &quot;opacity&quot;:&quot;.3&quot;}" lt-prop-wrapper-class="socProfileChangePop" on-before-close="{{method(&quot;removeDropID&quot;)}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div id="socProfileChange" class="socProfileChanges"> <template is="for" items="{{accounts}}" item="account" index="index"> <div class="socProfileChangeDiv pL15 pR15 pT5 pB5 cP alignLeft {{if(ifEquals(currAccount,account.id),\'crmLinkColor\',\'\')}}" data_zcqa="social_change_account" onclick="{{action(\'changeReplyId\',currAccount,account.id,callbackfn,param1)}}"> <div class="socProfSwitch pR dIB vaM mR5"> <img src="{{account.info.image}}" alt="Image"> </div> <lyte-text class="socProfName crm-small-font-size vaM" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;}" lt-prop-tooltip-class="socDetailTooltip" lt-prop-value="{{account.info.name}}"></lyte-text> </div> </template> </div> </lyte-popover-content> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["accounts","currAccount","callbackfn","param1","account","renderAccounts"],data:function(){return{accounts:Lyte.attr("array"),currAccount:Lyte.attr("string"),callbackfn:Lyte.attr("string"),param1:Lyte.attr("string"),account:Lyte.attr("object"),renderAccounts:Lyte.attr("boolean",{default:!1})}},actions:{changeReplyId:function(e,t,o,s){e===t?this.changeReplyId("socProfileChange"):this.changeReplyId(s,t)}},methods:{removeDropID:function(){$L(".dmdropArrow").attr("id","")}},changeReplyId:function(e,t){var o=$L("#"+e),s=o.closest(".postResponse"),i=s&&s.length?s:o.find(".postResponse"),a=store.peekAll("social_related_list")[0].allAccounts[t];void 0!==a&&(this.setData("currAccount",t),i.attr({account_id:t,screen_name:a.info.screen_name}),i.find(".socialCommonImage").find("img").eq(0).attr({src:a.info.image,title:a.info.screen_name})),this.setData("renderAccounts",!1),"directMessage"===e&&this.sendDirectMessage(t,void 0)},sendDirectMessage:function(e,t){this.sendDm(e,t)}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-social-streams-outer",{_template:'<template tag-name="crm-social-streams-outer"> <lyte-modal id="socStreamsMod" lt-prop-wrapper-class="socModalFromRight socStreamsModal" lt-prop-show="{{lbind(renderSocialStreams)}}" lt-prop-width="600px" lt-prop-height="100%" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromRight&quot;}" lt-prop-offset="{&quot;right&quot;:&quot;0px&quot;,&quot;top&quot;:&quot;0px&quot;,&quot;bottom&quot;:&quot;28px&quot;}" lt-prop-close-on-escape="false" lt-prop-show-close-button="false" lt-prop-allow-multiple="true" lt-prop-prevent-focus="true" on-resize="{{method(\'alignPopover\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="socStreamHeader pR p0"> <div class="socStreamTitle br_bottom_border3 boxBB"> <div class="socStreamTitleName w90_per ellipsistext crm-heading-font-size crmBaseColor pB5">{{entityName}}</div> <div class="crmNotFoundColor crm-font-regular crm-base-font-size">{{getI18n("crm.nsocial.stream")}}</div> </div> <div class="socStreamFilter br_bottom_border3 boxBB"> <div id="socStreamTw" data-zcqa="twitter_streams" class="crm-font-regular crm-base-font-size mR15 dIB cP" onclick="{{action(\'reloadPosts\',this,\'twitter\')}}"><span class="socialImg socAsssNwIcon socAssoTwIcon dIB mR8"></span><span class="socStreamFilterName ellipsistext dIB vaM">{{twitter_name}}</span></div> </div> <span class="zcrm_svgIcons socStreamClose op5 pA right25 cP" onclick="{{action(\'cancelStreams\')}}"></span> </lyte-modal-header> <lyte-modal-content class="socStreamContent" onscroll="{{action(\'scrollShadow\',this,\'socStreamHeader\')}}"> <div class="socStreamFeeds"> <div class="socStreamTwFeeds dN" data-attr="Tw"></div> <div class="socStreamFbFeeds dN" data-attr="Fb"></div> </div> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,3,0]},{type:"attr",position:[1,3,1]},{type:"text",position:[1,3,1,1,0]},{type:"attr",position:[1,5]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["entityName","twitter","facebook","googleplus","twitter_name","facebook_name","googleplus_name","renderSocialStreams"],data:function(){return{entityName:Lyte.attr("string"),twitter:Lyte.attr("boolean"),facebook:Lyte.attr("boolean"),googleplus:Lyte.attr("boolean"),twitter_name:Lyte.attr("string"),facebook_name:Lyte.attr("string"),googleplus_name:Lyte.attr("string"),renderSocialStreams:Lyte.attr("boolean",{default:!1})}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{reloadPosts:function(e,t){this.stopEvent(event);var o=$L("crm-social-integ-outer-template")[0].component;this.menuAnimate(e),o.getNetworkStreams(t)},scrollShadow:function(e,t){this.data.new_social&&this.applyShadow(e,t)},cancelStreams:function(){this.setData("renderSocialStreams",!1);var e=$L("crm-social-streams-outer");e&&e.length>0&&e[0].remove()}},methods:{alignPopover:function(){$L(".socProfileChangePop").find(".lytePopover").hasClass("lytePopoverVisible")&&document.querySelector(".socProfileChangePop").alignPopover()}}},{mixins:["crm-social-integration","crm-social-tab","crm-social-tab_actions"]}),Lyte.Component.register("crm-social-post-loading",{_template:'<template tag-name="crm-social-post-loading"> <template is="for" items="{{index}}" item="item" index="ind"> <div class="flexAlignCenter {{if(post,\' mT30 mB30 \',\'\')}}"> <span class="socCirImgLoad"></span> <div class="socTxtLd mL8"> <div class="socImgTextLoading mB10"></div> <div class="socImgTextLoading w65_per"></div> </div> </div> </template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]}]}],_observedAttributes:["index","post"],data:function(){return{index:Lyte.attr("array"),post:Lyte.attr("boolean")}}}),Lyte.Component.register("crm-twitter-posts",{_template:'<template tag-name="crm-twitter-posts"> <template is="if" value="{{data[0]}}"><template case="true"> <template is="for" items="{{data}}" item="post" index="index"> <div id="{{place_type}}_{{post.id}}" class="socStreamList socStreamTwList parentPost socPostId_{{post.id}}" data-attr="Tw" post_id="{{post.id}}" account_id="{{account_id}}"> <div class="socIntPhoto dIB vaT mR10 pR"> <img src="{{post.user.image}}" onclick="{{action(\'openURL\',post.user.screen_name)}}"> </div> <template is="if" value="{{retweetname}}"><template case="true"> <div class="pR top2 socialImgsvg crm-font-regular crm-small-font-size kso_retweet twitter_rtwitted_icn fL pL0"></div><div class="crm-small-font-size pB10 crmGreenColor fL">{{retweetname}} {{getI18n("crm.nsocial.retweeted")}}</div> </template></template> <div class="socStreamList w90_per dIB vaT"> <div class="mB5"> <a onclick="{{action(\'stopEvent\')}}" href="{{getRebrandKey(\'TW_URL\')}}/{{post.user.screen_name}}" target="_blank" class="ellipsistext socStreamName crmBaseColor crm-base-font-size fwBold fL">{{post.user.screen_name}}</a> <a onclick="{{action(\'stopEvent\')}}" href="{{getRebrandKey(\'TW_URL\')}}/{{post.user.screen_name}}/status/{{post.id}}" target="_blank" class="crmNotFoundColor crm-extra-small-font-size mB5 fR" title="{{post.created_at.disp_time}}">{{parseDate(post.created_at)}}</a> <div class="cBoth"></div> </div> <p class="crmNotFoundColor crm-small-font-size wwBreakWord">{{unescape(post.text)}}</p> <template is="if" value="{{post.extended_entities.media}}"><template case="true"> <crm-social-image-template media="{{post.extended_entities.media}}"></crm-social-image-template> </template></template> <div id="action" account_id="{{account_id}}" class="socRRFSec mT10 postActions"> <template is="if" value="{{if_lt_len(info.perm_type,3)}}"><template case="true"> <span class="socialImg socReplyIcon dIB vaM mR15 cP" onclick="{{action(\'toggleResponse\',this)}}"></span> </template></template> <span id="{{post.id}}_retweet_btn" account_id="{{account_id}}" class="dIB mR15 cP" retweetid="{{if(post.retweeted,post.current_user_retweet.id,\'\')}}" onclick="{{action(\'showQuoteTweet\',info.perm_type,post.id,account_id)}}"> <span class="socialImg socRetweetIcon dIB vaM {{if(post.retweeted,\'socReTwtIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{notEqualsZero(post.retweet_count)}}</span> </span> <span id="{{post.id}}_like_btn" account_id="{{account_id}}" class="dIB mR15 cP" favorite="{{post.favorited}}" onclick="{{action(\'undoFavorite\',info.perm_type,post.favorited,post.id,account_id)}}"> <span class="socialImg socFavIcon dIB vaM {{if(post.favorited,\'socFavIconActive\',\'\')}}"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{notEqualsZero(post.favorite_count)}}</span> </span> </div> <div id="feed_detail_convo" class="mT10"> <div id="{{place_type}}_{{post.id}}_replies"> </div> </div> <div class="cBoth"></div> </div> <template is="if" value="{{if_lt_len(info.perm_type,3)}}"><template case="true"> <div id="response" class="w100_per fL twitter_reply_box dN postResponse spcPostId_{{post.id}}" reply_id="{{place_type}}_{{post.id}}" account_id="{{account_id}}" screen_name="{{post.user.screen_name}}" post_id="{{post.id}}"> <div screenname="{{post.user.screen_name}}" class="socIntReplyBox mT10 mL15"> <span id="twt_img" class="socIntReplyImg pR dIB socialCommonImage socReplyTw" onclick="{{action(\'showTwitterProfiles\',this,1,\'changeReplyId\',place_type,post.id)}}"> <img src="{{info.info.image}}" class="dIB vaT mR10" title="{{info.info.screen_name}}"> <template is="if" value="{{moreTw}}"><template case="true"> <span class="dmdropArrow socialImgsvg cP pA"></span> <div class="twDrop pA dB cP"></div> </template></template> </span> <div class="socIntRepTxtBox dIB vaT bg_white p10 pR"> <lyte-input class="socStreamReplyInput w85_per socialCommonText" lt-prop-class="socStreamReplyTextarea" lt-prop-placeholder="{{getI18n(\'crm.nsocial.write.comment\')}}" lt-prop-id="resp_box" u_name="{{screen_name}}" lt-prop-type="textarea" lt-prop-text-area-resize="{&quot;vertical&quot;:false,&quot;horizontal&quot;:false}" lt-prop-direction="horizontal" lt-prop-appearance="flat" data-zcqa="twitter_reply_inputbox" on-value-change="{{method(\'processText\',post.id,true,this,event,\'kanban\')}}" onblur="{{action(\'showTwitterLimit\',\'blur\')}}" lt-prop-maxlength="10000" lt-prop-value="{{lbind(replyText)}}" text_id="{{place_type}}_{{post.id}}" reply="{{post.replytext}}"> </lyte-input> <div class="fR"> <span class="socialImgsvg socAttachIcon mL5 mR5 vaM" onclick="{{action(\'stopEvent\')}}"> <input type="file" id="commentimage" class="socialCommonAttach pA" accept="image/*" onclick="{{action(\'stopEvent\')}}" onchange="{{action(\'onImageSelected\',event,this,place_type,post.id,\'twitter\')}}" data-zcqa="tw_attach_image"> </span> <span id="twitter_limit" limit_id="{{place_type}}_{{post.id}}" class="socReplyCount crmBaseColor op5 crm-extra-small-font-size vaM">{{process(post.replytext)}}</span> </div> <div class="cBoth"></div> <div class="socReplyAttImg mT10 pR dN socialCommonPreviewDiv"> <div class="socReplyAttImgs fL"> <img id="soc_comment_img" src="{{getCrmClientImageUrl(\'nophoto.png\')}}" class="socialCommonPreview w100 h100" alt="Image"> </div> <div class="cBoth"></div> <span data-zcqa="twitter_reply_post_remove_image" class="zcrm_svgIcons socRepImgClose pA cP" onclick="{{action(\'removeImage\',this,place_type,post.id)}}"></span> </div> </div> </div> <div class="socReplyBtns fR mT7"> <span class="socReplyCancel crmBaseColor mR5 ttUppercase crm-small-font-size op5 cP" onclick="{{action(\'socTwReplyCancel\',this,place_type,post.id)}}">{{getI18n("crm.nsocial.cancel")}}</span> <span data-zcqa="twitter_reply_post_button" id="resp_button" button_id="{{place_type}}_{{post.id}}" class="socReplyBtn crmLinkColor ttUppercase crm-small-font-size cP eventNone op5" onclick="{{action(\'socTwReplyBtn\',this,place_type,post.id)}}">{{getI18n("crm.nsocial.reply")}}</span> </div> </div> <div class="cBoth"></div> </template></template> </div> </template> <template is="if" value="{{posts.offset}}"><template case="true"> <div id="twitterposts_cursor" data-zcqa="twitter_more_posts" class="showmoreNew p20 aligncenter"> <span onclick="{{action(\'getPosts\',this,\'twitter\',profileId,increment(posts.offset,\'-200\'),account_id,place_type)}}" class="showmoreNewLink crmLinkColor cP" data-zcqa="cursor">{{getI18n("crm.nsocial.tab.show.more")}}</span> <img src="{{getCrmClientImageUrl(\'loading.gif\')}}" alt="loading" class="showmoreLoadingImg dN"> </div> </template></template> </template><template case="false"> <template is="if" value="{{showEmpty}}"><template case="true"> <div class="socNoResAlign pA"> <div class="aligncenter socialIllustration {{if(ifEquals(network,\'twitter\'),\'socNoResTw\',\'\')}}{{if(ifEquals(network,\'facebook\'),\'socNoResFb\',\'\')}} {{if(ifEquals(network,\'googleplus\'),\'socNoResGp\',\'\')}} mAuto"></div> <span class="aligncenter dB mT10 crmNotFoundColor">{{getI18n \'crm.social.integ.no.result\'}}</span> </div> </template></template> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[2,0]},{type:"text",position:[2,2]}]}},default:{}},{type:"attr",position:[1,5,1,1]},{type:"text",position:[1,5,1,1,0]},{type:"attr",position:[1,5,1,3]},{type:"text",position:[1,5,1,3,0]},{type:"text",position:[1,5,3,0]},{type:"attr",position:[1,5,5]},{type:"if",position:[1,5,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5,7]},{type:"attr",position:[1,5,7,1]},{type:"if",position:[1,5,7,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,5,7,3]},{type:"attr",position:[1,5,7,3,1]},{type:"text",position:[1,5,7,3,3,0]},{type:"attr",position:[1,5,7,5]},{type:"attr",position:[1,5,7,5,1]},{type:"text",position:[1,5,7,5,3,0]},{type:"attr",position:[1,5,9,1]},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,1,3,1]},{type:"componentDynamic",position:[1,1,3,1]},{type:"attr",position:[1,1,3,3,1]},{type:"attr",position:[1,1,3,3,1,1]},{type:"attr",position:[1,1,3,3,3]},{type:"text",position:[1,1,3,3,3,0]},{type:"attr",position:[1,1,3,7,1,1]},{type:"attr",position:[1,1,3,7,5]},{type:"attr",position:[1,3,1]},{type:"text",position:[1,3,1,0]},{type:"attr",position:[1,3,3]},{type:"text",position:[1,3,3,0]}]}},default:{}}]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]}]}},default:{}}]}},default:{}}],_observedAttributes:["posts","data","account_id","info","retweetname","profileId","showEmpty","moreTw","currentElem","replyText"],data:function(){return{posts:Lyte.attr("object"),data:Lyte.attr("array"),account_id:Lyte.attr("string"),info:Lyte.attr("object"),retweetname:Lyte.attr("object"),profileId:Lyte.attr("string"),showEmpty:Lyte.attr("boolean"),moreTw:Lyte.attr("boolean"),currentElem:Lyte.attr("object"),replyText:Lyte.attr("string")}},stopEvent:function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},actions:{stopEvent:function(e){this.stopEvent(e)},showQuoteTweet:function(e,t,o){e<2&&(this.stopEvent(event),this.showQuoteTweet(t,o,"integ"))},toggleResponse:function(e){this.stopEvent(event),this.toggleResponse(e)},openUrl:function(e){sE(event),networkUtils.openUrl(rebrandProperty("TW_URL")+"/"+e,"_blank")},undoFavorite:function(e,t,o,s){var i=store.peekRecord("crm_social_post",o),a=$L(".selectedBrand").attr("value");e<3&&(this.stopEvent(event),i&&i.favorited?this.postLike(a,o,"twitter",!1,s):this.postLike(a,o,"twitter",!0,s))},showTwitterProfiles:function(e,t,o,s,i){this.getData("moreTw")&&(this.addIdInDropArrow(e),s=s+"_"+i,this.showTwitterProfiles(e,t,o,s))},preventCursor:function(e){this.preventCursor(e)},preventDefaultChar:function(e){this.preventDefaultChar(e)},processTextPaste:function(e,t){e="streams_"+e,this.processTextPaste(e,t)},removeImage:function(e,t,o){this.stopEvent(event),t=t+"_"+o,delete this.data.file,this.removeImage(e,t,!0)},onImageSelected:function(e,t,o,s,i){o=o+"_"+s;var a=this.onImageSelected(e,t,o,i);this.setData({file:a})},socTwReplyCancel:function(e,t,o){this.stopEvent(event),o=t+"_"+o;var s=(e=$L(e)).closest(".postResponse"),i=s.find(".socialCommonText");i.val(i.attr("reply")),this.removeImage(s.find(".socRepImgClose"),o),s.toggle()},socTwReplyBtn:function(e,t,o){this.stopEvent(event),o=t+"_"+o,$L(e).prop("disabled",!0).css("opacity","0.5").css("pointer-events","none");var s=$L(e).closest(".postResponse"),i=s.attr("account_id"),a=s.attr("post_id"),n=s.attr("screen_name"),r=this.data.replyText;this.replyTweet(i,a,n,r,o)},getPosts:function(e,t,o,s,i,a){$L("crm-social-integ-outer-template")[0].component.getPosts(e,t,o,s,i,a)},openURL:function(e){var t=RebrandLinkUtil.getProperty("TW_URL")+"/"+e;networkUtils.openUrl(t)}},methods:{processText:function(e,t,o,s,i){sE(s),e="streams_"+e;var a=this.data.replyText;this.processText(e,t,a),this.processTwitterSuggestion(o,s,a,i)}},showQuoteTweet:function(e,t){var o=store.peekRecord("crm_social_post",e),s=$L(".selectedBrand").attr("value");this.stopEvent(event),o&&o.retweeted?this.retweet(s,e,!1,t):this.getTweetInfo(e,t,"renderQuoteTweet")},getTweetInfo:function(e,t,o){var s={network:"twitter",accountId:t,streams:!0},i={account_id:t,tweetId:e};void 0===o&&(o="processTweetInfo");var a=this,n=store.peekRecord("crm_social_post",e);n?(n.account={id:i.account_id},a[o].apply(window,[i,n])):app.store.makeRequest("findRecord","crm_social_post",e,void 0,void 0,void 0,s).then((function(e){e.account={id:i.account_id},a[o].apply(window,[i,e])}))},renderQuoteTweet:function(e,t){var o=Lyte.registeredMixins["crm-social-integration"],s=store.peekAll("social_related_list")[0];(t=t[0]?t[0]:t).network="twitter",t.account_id=e.account_id,t.brid=s.allAccounts[e.account_id].brid,t.account_info=s.allAccounts[e.account_id],t.message=t.text;var i=o.getAllAccountsByCriteria("twitter",void 0,2,1);objectUtils.getLength(i)>1&&(t.moreTw=!0),(t=o.processTwitterEntities(t)).renderQouteTweet=!0,Lyte.Component.render("crm-social-quote-tweet-new",t,"#socInContain"),$L("crm-social-streams-outer")[0].component.setData("renderSocialStreams",!1)},addQuoteDiv:function(){if(!$L("#socRetweetPopup").length){var e={name:"div",attr:{id:"socRetweetPopup",class:"w500 p0 dN",onclick:"sE(event);"},child:[{name:"h2",attr:{class:"pp-header fwBold"},child:[{name:"text",content:I18n.getMsg("crm.social.integ.retweet.this")}]}]};$L("#showSignalPop")[0].after(renderingUtils.createHTML(e))}},replyTweet:function(e,t,o,s,i){var a={screen_name:o,content:s},n={},r={};r.content=JSON.stringify({comments:[a]}),n.content=JSON.stringify({comments:[a]}),n.accountId=e,n.postId=t,n.network="twitter",this.data.file&&(n.file=this.data.file),n.postComments=!0;var c=this;store.create("crm_social_comment",r,n).then((function(e){c.processReply(i,e)}),(function(e){store.unloadAll("crm_social_comment"),c.handleErrorCase(e)}))}},{mixins:["crm-social-integration","crm-social-tab_actions","crm-stop-event","crm-social-tab"]}),Lyte.Component.register("crm-twitter-reply-list",{_template:'<template tag-name="crm-twitter-reply-list"> <div id="{{place_type}}_{{id}}" class="socAfterReplyDiv socPostId_{{id_str}}" data-attr="Tw" post_id="{{id_str}}" account_id="{{account_id}}"> <div class="socIntPhoto dIB vaT mR10 pR"> <img src="{{user.image}}" onclick="{{action(\'onClick\',event,\'1\')}}"> </div> <div class="socStreamList w90_per dIB vaT"> <div class="mB5"> <a onclick="{{action(\'stopEvent\')}}" href="{{getRebrandKey(\'TW_URL\')}}/{{user.screen_name}}" target="_blank" class="crmBaseColor crm-base-font-size fwBold fL">{{user.screen_name}}</a> <a onclick="{{action(\'stopEvent\')}}" href="{{getRebrandKey(\'TW_URL\')}}/{{user.screen_name}}/status/{{id}}" target="_blank" class="crmNotFoundColor crm-extra-small-font-size mB5 fR dIB" title="{{title_time}}">{{disp_time}}</a> <div class="cBoth"></div> </div> <p class="crmNotFoundColor fs crm-small-font-size wwBreakWord">{{unescape(text)}}</p> <template is="if" value="{{extended_entities.media}}"><template case="true"> <crm-social-image-template media="{{extended_entities.media}}"></crm-social-image-template> </template></template> </div> <div class="cBoth"></div> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3,1,1]},{type:"text",position:[1,3,1,1,0]},{type:"attr",position:[1,3,1,3]},{type:"text",position:[1,3,1,3,0]},{type:"text",position:[1,3,3,0]},{type:"attr",position:[1,3,5]},{type:"if",position:[1,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],data:function(){return{}},actions:{stopEvent:function(e){this.stopEvent(e)},openUrl:function(){sE(event),networkUtils.openUrl(rebrandProperty("TW_URL")+"/"+screen_name,"_blank")},onClick:function(e,t){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()),"1"===t&&networkUtils.openUrl(RebrandLinkUtil.getProperty("TW_URL")+"/"+this.getData("user").screen_name,"_blank")}}},{mixins:["crm-stop-event"]}),Lyte.Component.register("crm-social-integ-quote-tweet",{_template:'<template tag-name="crm-social-integ-quote-tweet"> <lyte-modal lt-prop-offset="{&quot;top&quot;:&quot;0&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-width="550px" lt-prop-max-height="75%" lt-prop-show="{{lbind(renderQouteTweet)}}" on-close="{{action(\'cancelRetweet\')}}" lt-prop-show-close-button="false" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <h2 class="pp-header fwBold">{{getI18n("crm.social.integ.retweet.this")}}</h2> </lyte-modal-header> <lyte-modal-content class="p0"> <div class="p20 bgf5faff boxBB"> <lyte-input class="w100_per" lt-prop-type="textarea" lt-prop-appearance="box" lt-prop-rows="6" lt-prop-cols="80" lt-prop-direction="horizontal" lt-prop-maxlength="10000" lt-prop-text-area-resize="{&quot;vertical&quot;:false,&quot;horizontal&quot;:false}" lt-prop-id="text_quote_tweet" data-zcqa="social_tab_quote_tweet" on-value-change="{{method(\'processText\',\'quote_tweet\',true)}}" lt-prop-value="{{lbind(retweetText)}}" lt-prop-placeholder="{{getI18n(\'crm.nsocial.write.comment\')}}"></lyte-input> </div> <div class="p30"> <div class="socRetweetPhoto dIB vaT mR10 pR"> <img class="socRetweetPhotoImg" src="{{user.image}}" alt="Image"> </div> <div class="socRetweetMsg dIB vaT w85_per"> <div class="mB5"> <span class="crm-small-font-size dIB crmLinkColor fwBold">{{user.name}}</span> <span class="crmNotFoundColor crm-extra-small-font-size mT2 fR dIB">{{parseDate(created_at)}}</span> <div class="cBoth"></div> </div> <pre class="socPreTag crmNotFoundColor crm-small-font-size">{{unescape(message)}}</pre> </div> </div> </lyte-modal-content> <lyte-modal-footer> <span id="limit_quote_tweet" limit_id="quote_tweet" class="socReplyCount crmBaseColor op5 crm-extra-small-font-size fL mT9">280</span> <div class="fR"> <lyte-button id="zso_cancelDelete" data-zcqa="social_cancelbtn" onclick="{{action(\'cancelRetweet\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("Cancel")}}</template> </lyte-button> <lyte-button data-zcqa="social_button_addconfirmbtn" lt-prop-appearance="primary" onclick="{{action(\'submitRetweet\',this)}}" lt-prop-id="button_quote_tweet"> <template is="registerYield" yield-name="text">{{getI18n("crm.nsocial.retweet")}}</template> </lyte-button> <div class="socIntPhoto dIB vaT mL10 pR fR socialCommonImage"> <img src="{{account_info.info.image}}" alt="Image"> <template is="if" value="{{moreTw}}"><template case="true"> <div class="twDrop pA cP" data-zcqa="social_twitter_show_more" onclick="{{action(\'showTwitterProfiles\',this,1,\'changeQuoteTweetId\',id,account_id)}}"><span class="dmdropArrow socialImgsvg cP"></span></div> </template></template> </div> <span class="mL10 fR mT8 crmNotFoundColor">via</span> </div> <div class="cBoth"></div> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"componentDynamic",position:[3,1,1]},{type:"attr",position:[3,3,1,1]},{type:"text",position:[3,3,3,1,1,0]},{type:"text",position:[3,3,3,1,3,0]},{type:"text",position:[3,3,3,3,0]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,3,1]},{type:"registerYield",position:[5,3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,3,1]},{type:"attr",position:[5,3,3]},{type:"registerYield",position:[5,3,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3,3]},{type:"attr",position:[5,3,5,1]},{type:"attr",position:[5,3,5,3]},{type:"if",position:[5,3,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["id","account_id","retweeted","user","created_at","text","account_info","moreTw","content"],data:function(){return{id:Lyte.attr("string"),account_id:Lyte.attr("string"),retweeted:Lyte.attr("boolean"),user:Lyte.attr("object"),created_at:Lyte.attr("object"),text:Lyte.attr("string"),account_info:Lyte.attr("object"),moreTw:Lyte.attr("boolean"),content:Lyte.attr("string")}},actions:{submitQuoteTweet:function(e,t,o,s){e?this.submitQuoteTweet(t,o,s,!1):this.submitQuoteTweet(t,o,s,!0)},processTextPaste:function(e,t,o){e=e+"_"+t,this.processTextPaste(e,o)},processText:function(e,t,o,s,i,a){var n=this.data.content;e=e+"_"+t,this.processText(e,o,n),this.processTwitterSuggestion(s,i,n,a)},showTwitterProfiles:function(e,t,o,s,i){this.addIdInDropArrow(e),s=s+"_"+i+"_quote",this.showTwitterProfiles(e,t,o,s),event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation())},socRetweetCancel:function(){this.socRetweetCancel()}},submitQuoteTweet:function(e,t,o,s){var i=$L(e).closest(".parentPost");if(s){var a=i.find("#tweet_div").attr("screen-name"),n=i.find(".socialCommonText").val().trim();if(n){var r="https://twitter.com/"+a+"/status/"+t;this.postTweet(o,n,void 0,r)}else this.retweet(t,o)}else{var c=i.find("#tweet_div").attr("tweet-id");c&&(c=t),this.undoRetweet(c,o,t)}this.socRetweetCancel()},socRetweetCancel:function(){crmui.hidePopup("socRetweetPopup",!0),$L("#socRetweetPopup")[0].remove();var e=$L("#socStreams");Crm.userDetails.RTL_ENABLED?e.css({left:"0px"}):e.css({right:"0px"}),e.is(":visible")||renderingUtils.removeFreezeLayer(),0===$L("#socIntMsgDiv").length&&renderingUtils.removeFreezeLayer()},retweet:function(e,t){var o={tweetId:e,account_id:t,retweet:!0},s={network:"twitter",accountId:t,streams:!0,tweetId:e,method:"POST"},i=this;app.store.makeRequest("triggerAction","crm_social_post","retweet",s).then((function(){i.processRetweet(o)}))},undoRetweet:function(e,t,o){var s={tweetId:o,account_id:t,retweet:!1,postId:e},i={network:"twitter",accountId:t,streams:!0,tweetId:e,method:"DELETE"},a=this;app.store.makeRequest("triggerAction","crm_social_post","retweet",i).then((function(){a.processRetweet(s)}))},processRetweet:function(e){this.handleRetweets(e.tweetId,e.account_id,e.place_type,e.retweet,e.postId)},handleRetweets:function(e,t,o,s,i){var a=$L("#"+e+"_ret_btn");$.each(a,(function(e,t){var o=$L(t).find(".socialImgsvg").next("span"),i=o.html();s?i?o.html("1"):o.html(parseInt(i)+1):"1"===i?o.html(""):o.html(parseInt(i)-1)}));for(var n=a.length,r=0;r<n;r++){var c=a.eq(r).find(".socialImgsvg");s?c.addClass("socReTwtIconActive"):c.removeClass("socReTwtIconActive")}s||$L("[post_id="+i+"]").remove()}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-facebook-posts",{_template:'<template tag-name="crm-facebook-posts"> <template is="if" value="{{posts.data[0]}}"><template case="true"> <template is="for" items="{{posts.data}}" item="post" index="index"> <div class="socStreamList socStreamFbList" data-attr="Fb"> <div class="socIntPhoto dIB vaT mR10 pR"> <img src="{{post.user.image}}" alt="Image"> </div> <div class="socStreamList w90_per dIB vaT"> <div class="mB5"> <template is="if" value="{{post.story}}"><template case="true"> <span class="socStreamName ellipsistext crmNotFoundColor crm-base-font-size fwBold fL wwBreakWord">{{unescape(post.story)}}</span> </template><template case="false"> <a href="{{getRebrandKey(\'FB_URL\')}}/{{post.user.id}}" target="_blank" class="socStreamName ellipsistext fL crmLinkColor fwBold" rel="noopener noreferrer">{{post.user.name}}</a> <template is="if" value="{{post.to}}"><template case="true"> <template is="for" items="{{post.to.data}}" item="subItem" index="subIndex"> <a href="{{getRebrandKey(\'FB_URL\')}}/{{id}}" target="_blank" class="crmLinkColor fwBold socStreamName ellipsistext fL" rel="noopener noreferrer">{{subItem.name}}</a> </template> </template></template> </template></template> <a class="crmNotFoundColor crm-extra-small-font-size mB5 fR" href="{{getRebrandKey(\'FB_URL\')}}/{{id}}" target="_blank" rel="noopener noreferrer">{{parseDate(post.created_at)}}</a> <div class="cBoth"></div> </div> <crm-facebook-contents-render attachments="{{post.attachments}}" message="{{post.message}}" type="{{post.type}}" picture="{{post.picture}}"> </crm-facebook-contents-render> <div class="socFbLCSec mT10"> <span class="dIB vaM mR15 op5"> <span class="socialImg socFbLikeIcon dIB vaM"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{likes.summary.total_count}}</span> </span> <span class="dIB vaM op5" data-zcqa="facebook_posts_comments" onclick="{{action(\'showComments\',id,place_type)}}"> <span class="socialImg socFbCommentIcon dIB vaM pR"></span> <span class="dIB vaM crm-extra-small-font-size crmNotFoundColor">{{comments.total_count}}</span> </span> </div> <div id="comments_{{id}}_{{place_type}}" class="dN mT15"> <template is="if" value="{{comments.data}}"><template case="true"> {{setValue(\'account_id\',account_id)}} {{setValue(\'post_id\',id)}} {{setValue(\'place_type\',place_type)}} <crm-facebook-comments comments="{{comments}}"></crm-facebook-comments> </template></template> </div> </div> </div> </template> <template is="if" value="{{posts.offset}}"><template case="true"> <div id="facebookposts_cursor" data-zcqa="facebook_more_posts" class="showmoreNew p20 aligncenter"> <span class="cP" onclick="{{action(\'getPosts\',this,\'facebook\',profileId,posts.offset,account_id,place_type)}}">{{getI18n("crm.wf.summary.label.ShowInstantActions")}}</span> </div> </template></template> </template><template case="false"> <template is="if" value="{{showEmpty}}"><template case="true"> <div class="socNoResAlign pA"> <div class="aligncenter socialIllustration {{if(ifEquals(network,\'twitter\'),\'socNoResTw\',\'\')}}{{if(ifEquals(network,\'facebook\'),\'socNoResF\',\'\')}} {{if(ifEquals(network,\'googleplus\'),\'socNoResGp\',\'\')}} mAuto"></div> <span class="aligncenter dB mT10 fs crmNotFoundColor">{{getI18n("crm.social.integ.no.result")}}</span> </div> </template></template> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3,1,1]},{type:"if",position:[1,3,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1,3]},{type:"text",position:[1,3,1,3,0]},{type:"attr",position:[1,3,3]},{type:"componentDynamic",position:[1,3,3]},{type:"text",position:[1,3,5,1,3,0]},{type:"attr",position:[1,3,5,3]},{type:"text",position:[1,3,5,3,3,0]},{type:"attr",position:[1,3,7]},{type:"attr",position:[1,3,7,1]},{type:"if",position:[1,3,7,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]},{type:"text",position:[5]},{type:"attr",position:[7]},{type:"componentDynamic",position:[7]}]}},default:{}}]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,3,0]}]}},default:{}}]}},default:{}}],_observedAttributes:["account_id","info","moreTw","profileId","showEmpty","posts"],data:function(){return{account_id:Lyte.attr("string"),info:Lyte.attr("object"),moreTw:Lyte.attr("boolean"),profileId:Lyte.attr("string"),showEmpty:Lyte.attr("boolean"),posts:Lyte.attr("object")}},actions:{showComments:function(e,t){e="comments_"+e+"_"+t,$("#"+e).show()},getPosts:function(e,t,o,s,i,a){event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation()),$L("crm-social-integ-outer-template")[0].component.getPosts(e,t,o,s,i,a)}}}),Lyte.Component.register("crm-social-save-image-confirm",{_template:'<template tag-name="crm-social-save-image-confirm"> <lyte-modal id="socialConfirm" lt-prop-show="{{lbind(addImageConfirm)}}" lt-prop-width="500px" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-show-close-button="false" lt-prop-overlay-close="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{getI18n("ze.editor.addimage")}}</lyte-modal-header> <lyte-modal-content>{{getI18n("crm.fb.saveImage.warningMsg")}}</lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button onclick="{{action(\'cancelConfirm\',\'socialConfirm\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Cancel\')}}</template> </lyte-button> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'saveImage\',this,network,brid,account_id,marking_id)}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Save\')}}</template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,0]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["network","brid","account_id","addImageConfirm"],data:function(){return{network:Lyte.attr("string"),brid:Lyte.attr("string"),account_id:Lyte.attr("string"),addImageConfirm:Lyte.attr("boolean",{default:!1})}},actions:{cancelConfirm:function(){this.setData("addImageConfirm",!1)},saveImage:function(e,t,o,s,i){var a={},n=this,r=$L("crm-social-integ-outer-template")[0].component.data;switch(a.entityId=r.record_id,a.module=$L("#module").val(),t){case"facebook":a.profileId=r.SOCIALPROFILES.facebook;break;case"twitter":a.profileId=r.SOCIALPROFILES.twitter}a.brid=o,a.account_id=s,a.networkType=t,$L(e).removeClass("cP").prop("disabled",!0).css("opacity","0.5").css("pointer-events","none");var c={relations:{brid:o,account_id:s,profileId:a.profileId,module:a.module,entityId:a.entityId,network:t,saveImage:!0,marking_id:i,csrfParam:csrfParamName,token:csrfToken}};store.triggerAction("relation","save_image",c).then((function(e){n.setData("addImageConfirm",!1);var t=e.save_image;if(t)if("SUCCESS"===t.code){var o=t.details.file_id,s=$L("#"+a.module+"_"+a.entityId+"_photo");0===s.length&&(s=$L("#img_"+a.entityId)).length>0&&s[0].setAttribute("data-fileid",o);var i=$L("#imgContainer");s.length>0?($.each(s,(function(e,t){$L(t).attr("src",Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+a.module+"&entityId="+a.entityId+"&actionName=readImage&fileId="+o).addClass("mT5")})),$L("#detailViewButtonLayerMainTableRow").find("#"+a.module+"_"+a.entityId+"_photo").attr("src",Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+a.module+"&entityId="+a.entityId+"&actionName=readImage&fileId="+o)):1===i.length&&i.html('<img src="'+Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+IAMEncoder.encodeURL(a.module)+"&entityId="+IAMEncoder.encodeURL(a.entityId)+"&actionName=readImage&fileId="+IAMEncoder.encodeURL(o)+'">'),$L("#photoID").val(o),$L("#isNewUpload").val("false"),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropDuration:5e3,ltPropMessage:I18n.getMsg("crm.socialinteg.save.image")}})}else _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropDuration:5e3,ltPropMessage:I18n.getMsg("crm.label.saveimage.error")}})}))}}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-social-image-template",{_template:'<template tag-name="crm-social-image-template"> <template is="if" value="{{if_gt_len(media,2)}}"><template case="true"> <div class="socFbMultipleImg mT15 w100_per"> <div class="socImgFirstCol fL mR5" onclick="{{action(\'socMorePhotos\',this,0, media.0.type)}}"> <template is="if" value="{{media[0].media}}"><template case="true"> <img src="{{media.0.media.image.src}}" alt="Image" class="socFirstColImg"> </template><template case="false"> <template is="if" value="{{media[0].image.url}}"><template case="true"> <img src="{{media.0.image.url}}" alt="Image" class="socFirstColImg"> </template><template case="false"> <template is="if" value="{{media[0].media_url_https}}"><template case="true"> <img src="{{media.0.media_url_https}}" alt="Image" class="socFirstColImg"> </template></template> </template></template> </template></template> </div> <div class="socImgFirstCol fL"> <template is="for" items="{{media}}" item="item" index="index"> <template is="if" value="{{ifEquals(index,1)}}"><template case="true"> <div class="socImgSecCol mB4" onclick="{{action(\'socMorePhotos\',this,1,item.type)}}"><img src="{{if(item.media,item.media.image.src,\'\')}}{{if(item.image.url,item.image.url,\'\')}}{{if(item.media_url_https,item.media_url_https,\'\')}}" alt="Image" class="socSecColImg"></div> </template><template case="false"> <template is="if" value="{{ifEquals(index,2)}}"><template case="true"> <div class="socImgSecCol pR" onclick="{{action(\'socMorePhotos\',this,index,item.type)}}"> <img src="{{if(item.media,item.media.image.src,\'\')}}{{if(item.image.url,item.image.url,\'\')}}{{if(item.media_url_https,item.media_url_https,\'\')}}" alt="Image" class="socSecColImg"> <template is="if" value="{{if_gt_len(media,3)}}"><template case="true"> <div class="socImgOverlay pA cP"> <span class="crm-heading-font-size pA crmWhiteColor transformCenter">+{{decrement(media.length,3)}}</span> </div> </template></template> </div> </template></template> </template></template> </template> </div> <div class="cBoth"></div> </div> </template><template case="false"> <template is="if" value="{{if_gt_len(media,1)}}"><template case="true"> <div class="socFbMultipleImg mT15 w100_per"> <template is="for" items="{{media}}" item="item" index="index"> <div class="socFbTwoImg dIB {{if(ifEquals(index,1),\'mR5\',\'\')}}" onclick="{{action(\'socMorePhotos\',this,1,item.type)}}"> <img src="{{if(item.media,item.media.image.src,\'\')}}{{if(item.image.url,item.image.url,\'\')}}{{if(item.media_url_https,item.media_url_https,\'\')}}" alt="Image" class="socImgFbTwo"> </div> </template> <div class="cBoth"></div> </div> </template><template case="false"> <template is="if" value="{{ifEquals(media[0].type,\'video\')}}"><template case="true"> <template is="if" value="{{media[0].video_info.variants}}"><template case="true"> <div class="socIntFbSmallLinkVideo pR mT15 mR15 w100_per hAuto"> <span id="imagesvg" class="socialImg socFbVideoIcon pA cP" onclick="{{action(\'showVideoInFrame\', this, media.0.video_info.variants.0.url)}}" data-zcqa="show_video"></span> <img id="videoimage" class="w100_per h350" src="{{media.0.media_url_https}}" onclick="{{action(\'showVideoInFrame\',this, media.0.video_info.variants.0.url)}}" data-zcqa="video_image" alt="Image"> </div> <iframe id="videoframe" frameborder="0" class="social_fb_iframe w100_per h100_per dN"></iframe> </template></template> </template><template case="false"> <div class="socFbSingleImg mT15"> <img src="{{if(media.0.media_url_https,media.0.media_url_https,picture,\'\')}}" class="contentimage socIntegImage" alt="Image"> </div> </template></template> </template></template> </template></template> <template is="if" value="{{if_gt_len(media,1)}}"><template case="true"> <div class="socMultipleImgSlide mT15 pR oH dN"> <span class="svgIcons socSlideImgClose pA" onclick="{{action(\'socImgSlideClose\',this)}}"></span> <span class="zcrm_svgIcons socLeftArrowWhite pA" onclick="{{action(\'socImgArrow\',this,false)}}"></span> <span class="zcrm_svgIcons socRightArrowWhite pA" onclick="{{action(\'socImgArrow\',this,true)}}"></span> <div class="socMulImgSlideCnt"> <div class="socMulImgSlideCntInner"> <template is="for" items="{{media}}" item="item" index="index"> <div class="socSlideImgs pR dN"> <template is="if" value="{{ifEquals(item.type,\'video\')}}"><template case="true"> <iframe id="videoframe" width="100%" height="100%" url="{{item.video_source}}" frameborder="0" class="social_fb_iframe"></iframe> </template><template case="false"> <img src="{{if(item.media,item.media.image.src,\'\')}}{{if(item.image.url,item.image.url,\'\')}}{{if(item.media_url_https,item.media_url_https,\'\')}}" alt="Image" class="socMulSlideCntImg"> </template></template> </div> </template> </div> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1]}]}},default:{}}]}},default:{}}]}},default:{}}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3]},{type:"attr",position:[1,5]},{type:"attr",position:[1,7,1,1]},{type:"for",position:[1,7,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}]}},default:{}}],_observedAttributes:["media"],data:function(){return{media:Lyte.attr("array")}},actions:{socMorePhotos:function(e,t,o){(e=$L(e)).closest(".socFbMultipleImg").addClass("dN");var s=e.closest(".socStreamList").find(".socMultipleImgSlide");if(s.removeClass("dN"),"video"===o){var i=s.find(".socSlideImgs").eq(t).addClass("socSlideImgActive").show().find("iframe");i.attr("src",i.attr("url"))}else s.find(".socSlideImgs").eq(t).addClass("socSlideImgActive").show()},showVideoInFrame:function(e,t,o){this.showVideoInFrame(e,t,o)},socImgSlideClose:function(e){var t=(e=$L(e)).closest(".socMultipleImgSlide");t.find(".socSlideImgActive").removeClass("socSlideImgActive"),t.find(".socSlideImgs").hide(),t.addClass("dN"),e.closest(".socStreamList").find(".socFbMultipleImg").removeClass("dN"),e.parent().find("iframe").attr("src","")},socImgArrow:function(e,t){var o=(e=$L(e)).closest(".socMultipleImgSlide"),s=o.find(".socSlideImgActive"),i=s.find("iframe");i.length>0&&(r=i).attr("src","");s.removeClass("socSlideImgActive").addClass("socSlideImgOldActive");var a=!1,n=o.find(".socSlideImgOldActive");a=t?n.is(":last-child"):n.is(":first-child");var r,c,l,d=o.find(".socSlideImgs");a?(l=(c=t?d.first():d.last()).find("iframe")).length>0&&(r=l).attr("src",r.attr("url")):(l=(c=t?n.next():n.prev()).find("iframe")).length>0&&r.attr("src",r.attr("url"));c.addClass("socSlideImgActive"),n.removeClass("socSlideImgOldActive"),d.hide(),s.show()}}},{mixins:["crm-social-integration"]}),Lyte.Component.register("crm-social-tab-new",{_template:'<template tag-name="crm-social-tab-new"> <div id="socialDashboard" class="socialDashboard"> <template is="if" value="{{start_page}}"><template case="true"> <div id="socDashInitPage" class="socDashInitPage pA"> <div class="socNoResAlign pA"> <span class="socialIllustration socEmptyDashboard dIB"></span> <template is="if" value="{{limit_warning}}"><template case="true"> <template is="if" value="{{social_admin}}"><template case="true"> <p class="crmBaseColor crm-heading-font-size mT20 mB20">{{getI18n("crm.social.brand.limit.warning")}}</p> <lyte-button id="getStarted" lt-prop-class="newnormalgreenbtn" data-zcqa="social_tab_get_start" onclick="{{action(\'getStarted\')}}"> <template is="registerYield" yield-name="text">{{getI18n("crm.social.go.to.settings")}}</template> </lyte-button> </template><template case="false"> <p class="crmBaseColor crm-heading-font-size mT20">{{getI18n("crm.social.warning.contact.admin")}}</p> </template></template> </template><template case="false"> <template is="if" value="{{social_admin}}"><template case="true"> <p class="crmBaseColor crm-heading-font-size mT20 mB20">{{getI18n("crm.social.connect.social")}}</p> <lyte-button id="getStarted" lt-prop-class="newnormalgreenbtn" data-zcqa="social_tab_get_start" onclick="{{action(\'getStarted\')}}"> <template is="registerYield" yield-name="text">{{getI18n("crm.social.lets.started")}}</template> </lyte-button> </template><template case="false"> <p class="crmBaseColor crm-heading-font-size mT20">{{getI18n("crm.nsocial.startup.contact.admin")}}</p> </template></template> </template></template> </div> </div> </template><template case="false"> <lyte-tabs id="socialTabNew" class="socTabs" lt-prop-hover="socTabHover" lt-prop-active-class="socTabActive" lt-prop-height="100%" lt-prop-width="100%" after-render="{{method(\'tabHeight\')}}"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="socTabHead bg_white pR"> <lyte-tab-title lt-prop-id="dashboard" class="socTabTitle mR15" onclick="{{action(\'switchTab\',\'dashboard\')}}">{{getI18n("crm.social.dashboard")}}</lyte-tab-title> <lyte-tab-title lt-prop-id="monitor" class="socTabTitle mR15" onclick="{{action(\'switchTab\',\'monitor\')}}">{{getI18n("crm.social.monitor")}}</lyte-tab-title> <lyte-tab-title lt-prop-id="posts" class="socTabTitle mR15" onclick="{{action(\'switchTab\',\'posts\')}}">{{getI18n("crm.social.post.tab")}}</lyte-tab-title> <template is="if" value="{{social_admin}}"><template case="true"> <lyte-tab-title lt-prop-id="log" class="socTabTitle mR15" onclick="{{action(\'switchTab\',\'log\')}}">{{getI18n("crm.social.activity.log")}}</lyte-tab-title> </template></template> <div class="socTopTitleRightElement"> <template is="if" value="{{social_admin}}"><template case="true"> <span class="socSettingIconOuter pR mR10 cP" data-zcqa="social_tab_render_reauth" onclick="{{action(\'renderReauthAccounts\',false)}}"> <span class="reauthDot"></span> <span class="socialImg socSettingIcon dIB vaM mL5 mR5"></span> </span> </template></template> <template is="if" value="{{if_gt_len(brands,1)}}"><template case="true"> <span class="socChooseBrand cP zso_brandSelector boxBB" data-zcqa="social_tab_filters" onclick="{{action(\'filterByBrands\',this,\'open\')}}"> <span class="crmBaseColor socDropDownArrow pR cP selectedBrand" value="{{brands[0].id}}">{{brands[0].name}}</span> </span> </template><template case="false"> <span class="socChooseBrand cP selectedBrand zso_brandSelector boxBB" value="{{brands[0].id}}"> {{brands[0].name}} </span> </template></template> </div> </lyte-tab-head> <lyte-tab-body class="socTabBody borderNone oH"> <lyte-tab-content id="dashboard" class="socTabContent hInherit oH p0"> <div id="socDashboardContent" class="flexAlignStart hInherit"> <div class="socDashFilter bg_white hInherit boxBB"> <div class="crmNotFoundColor crm-small-font-size ttUppercase mT10 mB10">{{getI18n("crm.social.filter.inter")}}</div> <lyte-radiobutton class="socRadioBtn socFilterAllRadio socFilterRadio pT7 pB7 mR0 dB" lt-prop-type="primary" lt-prop-name="socFilterInteractionBy" lt-prop-label="{{getI18n(\'crm.label.all\')}}" lt-prop-value="All" lt-prop-checked="true" on-changed="{{method(\'changeFilterInteraction\',\'\',\'\')}}" data-zcqa="social_tab_change_filter"></lyte-radiobutton> <template is="for" items="{{filter}}" item="item" index="index"> <lyte-radiobutton class="socRadioBtn socFilterRadio pT7 pB7 mR0 dB" lt-prop-type="primary" lt-prop-name="socFilterInteractionBy" lt-prop-label="{{item.name}}" lt-prop-value="{{item.value}}" on-changed="{{method(\'changeFilterInteraction\',item.value)}}" data-zcqa="social_tab_change_filter"></lyte-radiobutton> </template> </div> <div class="socDashInteractions hInherit boxBB"> <lyte-tabs id="socInnerTab" class="socInnerTab" lt-prop-hover="socInnerHover" lt-prop-active-class="socInnerActive" lt-prop-height="100%" lt-prop-width="100%" after-render="{{method(\'innerTabHeight\')}}" on-open="{{method(\'conversationMessages\',this)}}"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="socInnerTabHead mB15 pR"> <lyte-tab-title class="socInnerTabTitle mR20" type="Convo" lt-prop-id="socConvTab">{{getI18n("crm.social.conversations")}}</lyte-tab-title> <lyte-tab-title class="socInnerTabTitle" type="Message" lt-prop-id="socMessageTab">{{getI18n("crm.social.messages")}}</lyte-tab-title> <div class="pA top0 right0"> <span id="socChooseNw" class="socChooseNw dIB crmNotFoundColor socDropDownArrow pR cP" data-zcqa="social_tab_account_filter" onclick="{{action(\'filterByAccounts\',this,\'open\')}}">{{getI18n("View")}}: <span class="socAllIcon crmBaseColor mL5">{{getI18n("crm.label.all")}}</span><span class="socialImg socAsssNwIcon soctwitterIcon mL5 dN"></span><span class="socialImg socAsssNwIcon socfacebookIcon mL5 dN"></span><span class="socialImg socAsssNwIcon socgoogleplusIcon mL5 dN"></span></span> </div> <span id="socNewConversation" class="socNewConvoMsgSpan socNewConversation pA crm-small-font-size dN" data-zcqa="social_tab_new_convers" onclick="{{action(\'newConversations\')}}"><span class="socialImgsvg socNewCMUpIcon mR5"></span>{{getI18n("crm.social.new.convo")}}</span> <span id="socNewMessages" class="socNewConvoMsgSpan socNewMessages pA crm-small-font-size dN" data-zcqa="social_tab_new_message" onclick="{{action(\'newMessages\')}}"><span class="socialImgsvg socNewCMUpIcon mR5"></span>{{getI18n("crm.social.new.messages")}}</span> </lyte-tab-head> <lyte-tab-body class="socInnerTabBody borderNone oH"> <lyte-tab-content id="socConvTab" class="socInnerTabContent hInherit p0" onscroll="{{action(\'scrollTabHeadShadow\',this,\'.socInnerTabHead\')}}"> <div id="socConvoContent" class="hInherit oA"></div> </lyte-tab-content> <lyte-tab-content id="socMessageTab" class="socInnerTabContent hInherit p0" onscroll="{{action(\'scrollTabHeadShadow\',this,\'.socInnerTabHead\')}}"> <div id="socMessageContent" class="socMessageContent hInherit oA"></div> </lyte-tab-content> </lyte-tab-body> </template> </lyte-tabs> </div> <div id="socDashLeadsDetails" class="socDashLeadsDetails bg_white hInherit boxBB"> <div class="crmNotFoundColor crm-small-font-size ttUppercase mT10 mB20">{{getI18n("crm.social.lead.social")}}</div> </div> <div id="social_sidebar"></div> </div> </lyte-tab-content> <lyte-tab-content id="monitor" class="socTabContent hInherit oH p0"> <div id="socMonitorContent" class="socMonitorContent w100_per" onscroll="{{action(\'loadCustomFeeds\')}}"></div> </lyte-tab-content> <lyte-tab-content id="posts" class="socTabContent hInherit oH p0"> <div id="socPostContent" class="socPostContent hInherit"></div> </lyte-tab-content> <template is="if" value="{{social_admin}}"><template case="true"> <lyte-tab-content id="log" class="socTabContent hInherit oH p0"> <div id="zso_acitvityLogContainer" class="zsoActivityContaienr"></div> </lyte-tab-content> </template></template> </lyte-tab-body> <div id="socDashboardDetailView" class="socDashboardDetailView dN"></div> </template> </lyte-tabs> </template></template> </div> <lyte-popover lt-prop-origin-elem=".socTopTitleRightElement" lt-prop-height="auto" lt-prop-width="190px" lt-prop-max-height="280px" lt-prop-duration="100" lt-prop-show="{{lbind(renderFilterBrands)}}" lt-prop-content-padding="10px 15px" lt-prop-show-close-button="false" lt-prop-freeze="false" lt-prop-type="box" lt-prop-placement="bottom" lt-prop-prevent-focus="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div id="socFilterByBrands"> <template is="for" items="{{brands}}" item="brand" index="index"> <lyte-radiobutton title="{{brand.name}}" class="socRadioBtn socAddLead socAddAs dB pT5 pB5 mR0 socFilterBrandsRadio" lt-prop-type="primary" lt-prop-name="socFilterBrands" lt-prop-label="{{brand.name}}" lt-prop-value="{{brand.id}}" onclick="{{action(\'brandChange\',brand.id)}}" data-zcqa="social_tab_brand_change" lt-prop-checked="{{if(ifEquals(index,0),\'true\',\'false\')}}"></lyte-radiobutton> </template> </div> </lyte-popover-content> </template> </lyte-popover> <crm-social-network-filter network="{{network}}"></crm-social-network-filter> <div id="socAddToCrmPop" class="socAddToCrmPop pA dN" onclick="{{action(\'dropDownClose\')}}"></div> <div id="socDeskDepartmentDiv" class="socDeskDepartmentDiv pA dN" onclick="{{action(\'stopEvent\',event)}}"> <span class="zcrm_svgIcons socDeskDeptArrow pA"></span> <div class="newSelect"> <select id="socDeskDepartment"> <option class="desk_dept">-Choose Department-</option> </select> </div> <div class="mT20"> <button class="primarybtn mR0" id="createTktBTN" data-zcqa="social_ticket_create">Create</button> <lyte-button lyte-prop-class="newgraybtn" data-zcqa="social_ticket_cancel" onclick="{{action(\'doCancel\')}}"> <template is="registerYield" yield-name="text">{{getI18n("Cancel")}}</template> </lyte-button> <lyte-button id="createTktBTN" data-zcqa="social_ticket_create" lt-prop-appearance="primary"> <template is="registerYield" yield-name="text"> <span class="socBtnLoadText" id="zso_del_add_account">Create</span> <span class="socBtnLoading dN"> <span class="socBtnLoadCircle mR3"></span><span class="socBtnLoadCircle mR3"></span><span class="socBtnLoadCircle"></span> </span> </template> </lyte-button> </div> </div> <div id="WarningDiv" class="newpopup w500 is-scroll ppTop p0 dN" onclick="{{action(\'stopEvent\',event)}}"></div> <lyte-menu id="socMonitorMore" lt-prop-wrapper-class="socMonitorMoreWrapper" lt-prop-scope=".socCustomColumn" lt-prop-yield="true" lt-prop-event="click" lt-prop-query=".socMoreIcnTit" lt-prop-width="auto" lt-prop-height="auto" lt-prop-position="down" lt-prop-callout="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <lyte-menu-item class="socMonitorMoreItem mT5 mB5 cP" onclick="{{action(\'deleteMonitorColumn\')}}"> <lyte-menu-label class="crmNegativeColor">{{getI18n("crm.label.del")}}</lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <div id="reauth_alert"></div> <lyte-modal id="socDeleteMonitorColumn" lt-prop-show="{{lbind(deleteMonitorColumn)}}" lt-prop-width="550px" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{getI18n("crm.social.delete.column")}}</lyte-modal-header> <lyte-modal-content> {{unescape(getI18n("crm.social.delete.column.confirm",deleteColumnTitle))}} </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button id="zso_cancelDelete" data-zcqa="social_cancelbtn" onclick="{{action(\'cancelDeleteMonitorColumn\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("Cancel")}}</template> </lyte-button> <lyte-button data-zcqa="social_button_addconfirmbtn" lt-prop-appearance="failure" lt-prop-class="fromDeletePopup pR" onclick="{{action(\'deleteFilterColumn\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("crm.label.del")}}</template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> <div id="socDashboardLoading" class="socDashboardLoading dN"> <span class="socPopUpCircleLoad pA"></span> </div> <lyte-messagebox id="socTabMessageBox" lt-prop-show="{{lbind(socMsgBandShow)}}" lt-prop-type="{{socMsgBandType}}" lt-prop-message="{{socMsgBandMessage}}" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromTop&quot;}" lt-prop-offset="{&quot;top&quot;:&quot;40px&quot;}"></lyte-messagebox> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5]},{type:"text",position:[1,5,0]},{type:"componentDynamic",position:[1,5]},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,9,1]},{type:"if",position:[1,9,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,9,3]},{type:"if",position:[1,9,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"text",position:[3,1,1,1,1,0]},{type:"attr",position:[3,1,1,1,3]},{type:"componentDynamic",position:[3,1,1,1,3]},{type:"attr",position:[3,1,1,1,5]},{type:"for",position:[3,1,1,1,5],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[3,1,1,3,1]},{type:"registerYield",position:[3,1,1,3,1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"text",position:[1,5,1,0]},{type:"text",position:[1,5,1,2,0]},{type:"attr",position:[1,7]},{type:"text",position:[1,7,1]},{type:"attr",position:[1,9]},{type:"text",position:[1,9,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3,1,1,3,1]},{type:"text",position:[3,1,1,5,1,0]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3,1]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3,5]},{type:"attr",position:[3,7]},{type:"if",position:[3,7],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"attr",position:[9]},{type:"attr",position:[9,5,3]},{type:"registerYield",position:[9,5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[9,5,3]},{type:"registerYield",position:[9,5,5,1],dynamicNodes:[]},{type:"componentDynamic",position:[9,5,5]},{type:"attr",position:[11]},{type:"registerYield",position:[13,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[13]},{type:"attr",position:[17]},{type:"registerYield",position:[17,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,1]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[17]},{type:"attr",position:[21]},{type:"componentDynamic",position:[21]}],_observedAttributes:["brands","filter","network","social_admin","start_page","limit_warning","route","deskDetails","renderFilterBrands","deleteMonitorColumn","socMsgBandShow","socMsgBandType","socMsgBandMessage","selectedNetwork","deleteColumnTitle","module"],data:function(){return{brands:Lyte.attr("array"),filter:Lyte.attr("array"),network:Lyte.attr("object"),social_admin:Lyte.attr("boolean"),start_page:Lyte.attr("boolean"),limit_warning:Lyte.attr("boolean"),route:Lyte.attr("string"),deskDetails:Lyte.attr("object"),renderFilterBrands:Lyte.attr("boolean",{default:!1}),deleteMonitorColumn:Lyte.attr("boolean",{default:!1}),socMsgBandShow:Lyte.attr("boolean",{default:!1}),socMsgBandType:Lyte.attr("string"),socMsgBandMessage:Lyte.attr("string"),selectedNetwork:Lyte.attr("string",{default:"All"}),deleteColumnTitle:Lyte.attr("string"),module:Lyte.attr("string",{default:"All"})}},didConnect:function(){var e=renderingUtils.tabLayerTop()+renderingUtils.tabLayerOuterHeight()+28;$L("#socialDashboard").css("height","calc(100vh - "+e+"px)"),$L("body").addClass("socialTabOpened"),window.addEventListener("resize",this.windowResize)},didDestroy:function(){$L("body").removeClass("socialTabOpened"),window.removeEventListener("resize",this.windowResize)},windowResize:function(){var e,t=$L("crm-social-tab-new"),o=$L("crm-social-detail-outer"),s=$L("#socialTabNew");t.length&&(s.length&&t[0].component.methods.tabHeight("#socialTabNew"),$L("#socInnerTab").length&&t[0].component.methods.innerTabHeight("#socInnerTab"),o.length&&(e=s.find(".socTabBody").outerHeight(),$L("#socDashboardDetailView").css("height",e+"px"),o[0].component.methods.innerTabHeight("#socialInteractionNew")))},actions:{scrollTabHeadShadow:function(e,t){var o=$L(e);t=$L(t);o.scrollTop()>30?t.addClass("socScrollShadow"):t.removeClass("socScrollShadow")},doCancel:function(){$L("#socDeskDepartmentDiv").addClass("dN"),$L("#socConvoContent").removeAttr("style")},deleteFilterColumn:function(){var e=$L("#socMonitorMore"),t=e.attr("brand_id"),o=e.attr("filter_id");this.deleteFilter(t,o)},deleteMonitorColumn:function(){var e=$L(".socMoreIcnTit.lyteMenuSelected").closest(".socColTitle").text();document.querySelector("#socMonitorMore").ltProp("show",!1),this.setData({deleteColumnTitle:$.trim(e),deleteMonitorColumn:!0})},cancelDeleteMonitorColumn:function(){this.setData("deleteMonitorColumn",!1)},dashboardOptions:function(e,t){if(e)e=$L(e);var o=$L(".selectedBrand").attr("value");if($L("#socPostContent").empty(),$L("#socMonitorContent").empty(),$L("#zso_acitvityLogContainer").empty(),"Dashboard"===t){$L(".socChooseBrand").removeClass("mT8");var s=$L(".socConvMsgs").find(".sel").attr("type");"Convo"===s?this.getFeeds(void 0,o,void 0,void 0,void 0,"dashboard_feeds"):"Message"===s&&this.getMessages(void 0,o,void 0,void 0,void 0,"dashboard_feeds")}else $L(".socChooseBrand").addClass("mT8");if("Monitor"===t?this.getFilters(o):$L("#soc"+t+"Content").removeClass("dN"),"Post"===t){var i={},a=this.getNetworkBrandJson(o),n=this.getNetworkJsonByBrandId(o,1,1);if(objectUtils.getLength(n)&&(i.can_post=!0),i.networks=a,Lyte.Component.render("crm-social-my-posts-outer",i,".socPostContent"),$.each(a,(function(e,t){var o=document.createElement("crm-social-interaction-loading");o.setData({index:[1,2,3,4,5]}),$L("#"+t.info.network+"_my_posts").find(".socColumnLists").html(o)})),1===a.length)$L(".socNwPostsLists").addClass("socNwPostsListsSingle");else if(2===a.length)$L(".socNwPostsLists").addClass("w49_per");else{var r=Math.round(Utils.windowOuterWidth/a.length-20);$L(".socNwPostsLists").css("width",r)}var c=this;$.each(a,(function(e,t){c.getMyPosts(void 0,o,void 0,t.info.network,"social_post_tab")}))}"Log"===t?($L(".zso_brandSelector").hide(),this.getActivityLog()):$L(".zso_brandSelector").css("display","block")},getStarted:function(){this.getStarted()},scrollShadow:function(e,t){this.applyShadow(e,t)},dropDownClose:function(){this.dropDownClose()},newConversations:function(){$L(".socNewConvo").removeClass("dN"),$L(".socInnerTabContent").scrollTop(0),$L("#socNewConversation").hide()},newMessages:function(){$L(".socNewMsgs").removeClass("dN"),$L(".socInnerTabContent").scrollTop(0),$L("#socNewMessages").hide()},loadCustomFeeds:_.debounce((function(){var e=renderingUtils.windowOuterWidth,t=$L("crm-social-filter-head")[0].component;$L(".socCustomColumn.new-socialbox").each((function(o,s){var i=(s=$L(s)).position().left;if(i>0&&i<e&&"true"!==s.attr("loaded")){s.attr("loaded","true");var a=s.attr("brand_id"),n=s.attr("filter_id");t.reloadFilters(a,n)}}))}),300),filterByBrands:function(){this.setData("renderFilterBrands",!0)},renderReauthAccounts:function(e){sE(event),this.renderReauthAccounts(e)},filterByAccounts:function(){sE(event);var e=$L("crm-social-network-filter");e&&e[0]&&((e=e[0].component).setData("renderFilterNetworks",!1),e.setData("renderFilterNetworks",!0))},switchTab:function(e){$L(".socTabBody").hasClass("dN")&&$L("crm-social-detail-outer")[0].component.actions.backToDashboard(),Lyte.Router.transitionTo("crm.tab.social."+e)},brandChange:function(e){var t;this.appendDepartment(this.data.configered_desk_detials);var o=store.peekAll("Social")[0];$.each(o.brands,(function(o,s){s.id===e&&(t=s.name)})),this.networkFilterChange(e);var s=$L(".selectedBrand"),i=$L("#socDashboardDetailView").is(":visible");s.attr("value",e),s.html($ESAPI.encoder().encodeForHTML(t));var a=$L(".socTabActive")[0].getAttribute("lt-prop-id"),n=$L("#socMessageContent"),r=$L("#socPostContent");switch($L("#socMonitorContent").empty(),r.empty(),$L("#socConvoContent").empty(),n.empty(),$L(".socMessagesDetAll").empty(),$L(".socInteractionDetAll").empty(),$L(".socFilterRadio input:checked").removeProp("checked"),$L(".socFilterAllRadio").find("input").first().prop("checked",!0),$L(".socChooseNw > span").addClass("dN").removeClass("dIB"),$L(".socChooseNw").find(".socAllIcon").removeClass("dN").addClass("dIB"),$L("#socFilterByNetworks").find("span").removeClass("op5"),a){case"dashboard":if(i){var c=$L(".socInterMsgs").find(".sel").attr("type"),l=$L(".profileIds").attr("ids"),d="detail_popup";"interactions"===c?this.getInteractions(void 0,e,void 0,void 0,l,d,void 0):"messages"===c&&this.getMessagesByProfile(null,e,null,l,d)}else{"Convo"===(c=$L(".socInnerActive")[0].getAttribute("type"))?this.getFeeds(void 0,e,void 0,void 0,void 0,"dashboard_feeds"):"Message"===c&&this.getMessages(void 0,e,void 0,void 0,void 0,"dashboard_message")}break;case"monitor":this.getFilters(e);break;case"posts":var p={},m=this.getNetworkBrandJson(e),u=this.getNetworkJsonByBrandId(e,1,1);objectUtils.getLength(u)&&(p.can_post=!0),p.networks=m;var f=document.createElement("crm-social-my-posts-outer");if(f.setData(p),r[0]&&(r[0].innerHTML=""),r.append(f),$.each(m,(function(e,t){var o=document.createElement("crm-social-interaction-loading");o.setData({index:[1,2,3,4,5]});var s=$L("#"+t.info.network+"_my_posts").find(".socColumnLists");s[0]&&(s[0].innerHTML=""),s.append(o)})),1===m.length)$L(".socNwPostsLists").addClass("socNwPostsListsSingle");else if(2===m.length)$L(".socNwPostsLists").addClass("w49_per");else{var g=Math.round(Utils.windowOuterWidth/m.length-20);$L(".socNwPostsLists").css("width",g)}var v=this;$.each(m,(function(t,o){v.getMyPosts(void 0,e,void 0,o.info.network,"social_post_tab")}));var y=$L(".socNwPostsLists"),h=y.find(".socColumnHeading").outerHeight();y.length&&y.find(".socColumnContent").css("height","calc(100% - "+h+"px)")}this.setData("renderFilterBrands",!1),this.beforeExitTab()}},methods:{tabHeight:function(e){var t=$L(e),o=parseInt($L("#socialDashboard").css("height")),s=o-t.find(".socTabHead").outerHeight();t.css("height",o),t.find(".socTabBody").css("height",s)},innerTabHeight:function(e){var t=$L(e),o=renderingUtils.windowHeight-(t.offset().top+38),s=o-(t.find(".socInnerTabHead").outerHeight()+15);t.css("height",o+"px"),t.find(".socInnerTabBody").css("height",s)},changeFilterInteraction:function(e){this.changeFilters(void 0,void 0,e)},changeFilters:function(e,t){this.changeFilters(e,t)},conversationMessages:function(e,t){var o,s=Lyte.registeredMixins["crm-social-tab"];t="socConvTab"===t.id?"Convo":"Message";e=$L(e);$L(".socScrollShadow").removeClass("socScrollShadow"),$L("#socConvoContent, #socMessageContent").addClass("dN").scrollTop(0);var i=$L("#soc"+t+"Content");if(i.children().length>0)i.removeClass("dN"),$L(".socNoResAlign").removeClass("dN");else{var a=$L(".selectedBrand").attr("value");$L(".socFilterRadio").each((function(){this.ltProp("checked")&&(o=this.ltProp("value"))}));var n=$L("#socFilterByNetworks").find(".selectedNetwork").attr("network");o="All"===o?void 0:o,n="All"===n?void 0:n,"Convo"===t?s.getFeeds(void 0,a,void 0,o,n,"dashboard_feeds"):"Message"===t&&this.getMessages(void 0,a,void 0,o,n,"dashboard_message")}}},getActivityLog:function(e,t){var o,s={},i=this;i.showMoreLoading(e);var a=networkUtils.returnDependencyFiles(["crm-social-activity.js","crm-social-activityLog.js"],ResourceConstants.CRMClient);Lyte.injectResources(a,void 0,(function(){void 0!==t?(s.cursor=t,o=store.findAll("social_activityLog",void 0,void 0,void 0,{cursor:t})):o=store.findAll("social_activityLog"),o.then((function(e){i.showMoreRemove(),i.renderActivityLog(s,e)}))}))},renderActivityLog:function(e,t){if(t){var o,s=t;t.$&&t.$.meta&&(o=t.$.meta.cursor),t.data=s,t.cursor=o}var i=$L("#zso_acitvityLogContainer"),a=document.createElement("crm-social-activity-list");a.setData(t),i.append(a)},getFilters:function(e){var t=this,o=networkUtils.returnDependencyFiles(["crm-social-tab-monitor-column.js"],ResourceConstants.CRMClient);Lyte.injectResources(o,void 0,(function(){if(e){var o={brand_id:e};commonUtils.showHideLoadingDiv(!0),store.findAll("monitor_column",o).then((function(e){commonUtils.showHideLoadingDiv(!1),t.renderFilters(o,e)}))}}))},renderFilters:function(e,t){t=Lyte.registeredMixins["crm-social-tab"].processFilters(t,e.brand_id);var o=document.createElement("crm-social-tab-filter-inner");o.setData(t);var s=this,i=$L("#socMonitorContent");i&&i.empty(),i[0].appendChild(o);var a=0;$.each(t.monitor_column,(function(t,o){null!==s.getAccountByBrandIdAndNetwork(e.brand_id,o.network)&&++a<5&&s.getFilterFeeds(o,e.brand_id)})),t.monitor_column.length&&this.setMonitorContentWidth()},getMessages:function(e,t,o,s,i,a){if($L("#socConvoContent").addClass("dN"),e)this.showMoreLoading(e);else{var n=$L("#socAllMessages");if($L("#socMessageContent").removeClass("dN"),n.removeClass("dN"),n&&n.length>0)return;var r=$L("crm-social-interaction-loading");r&&r.length>0&&r[0].remove(),Lyte.Component.render("crm-social-interaction-loading",{index:[1,2,3,4,5]},"#socMessageContent")}var c={brand_id:t,cursor:o,entity_type:s,message:!0,place_type:a,network:i,currentEle:e},l={history_type:"message"};o&&(l.cursor=o),s&&(l.entity_type=s),i&&(l.network=i),l.desk_enabled_user=this.appendDeskEnabledQuery();var d=this;store.findAll("crm_social_feed",l,void 0,void 0,{brand_id:t}).then((function(e){d.renderFeeds(c,e)}),(function(e){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(e)}))},networkFilterChange:function(e){var t=this.getNetworkJsonByBrandId(e),o=$L("crm-social-network-filter")[0];o&&o.remove();var s=document.createElement("crm-social-network-filter");s.setData({network:t}),document.querySelector("#socialDashboard").after(s)},deleteFilter:function(e,t){var o={brand_id:e,filter_id:t},s=this;store.peekRecord("monitor_column",t).$.destroyRecord().then((function(e){s.renderDeleteFilter(o,e)}))},renderDeleteFilter:function(e,t){"SUCCESS"===t.code&&($L("#"+e.filter_id)[0].remove(),this.setData("deleteMonitorColumn",!1),document.querySelector("#socMonitorMore").ltProp("show",!1),$L(".socMoreIconActive").removeClass("socMoreIconActive"),0===$L("crm-social-filter-head").length?$L("#socMonitorEmpty").removeClass("dN"):this.setMonitorContentWidth())},changeFilters:function(e,t,o){var s=$L(".selectedNetwork");if(t||(t=s.attr("network")),e){var i=e=$L(e);s.removeClass("selectedNetwork"),i.addClass("selectedNetwork"),$L(".socChooseNw > span").addClass("dN").removeClass("dIB"),$L(".socChooseNw").find(".soc"+t+"Icon").removeClass("dN").addClass("dIB");var a=$L("#socFilterByNetworks").find("span");a.addClass("op5"),"All"===i.attr("network")?a.removeClass("op5"):i.removeClass("op5")}o||(o=$L(".socDashFilter input:checked").val());var n=$L("#socMessageContent"),r=$L("#socPostContent");$L("#socMonitorContent").html(""),r.html(""),$L("#socConvoContent").html(""),n.html("");var c,l=$L(".selectedBrand").attr("value");o="All"===o?void 0:o,t="All"===t?void 0:t,this.setData("module",o),"Convo"===(c=$L("#socMessageTab").attr("class").match("lyteTabHide")?"Convo":"Message")?this.getFeeds(void 0,l,void 0,o,t,"dashboard_feeds"):"Message"===c&&this.getMessages(void 0,l,void 0,o,t,"dashboard_message");var d=$L("crm-social-network-filter");d&&d[0]&&(d=d[0].component).setData("renderFilterNetworks",!1),this.beforeExitTab()}},{mixins:["crm-social-tab","crm-social-tab_actions","crm-stop-event"]}),store.registerModel("relation",{},{actions:{save_image:{}}}),store.registerAdapter("relation",{namespace:"crm/v2/module/entityId/Social/twitter/",buildURL:function(e,t,o,s,i,a,n){return n&&n.relations&&n.relations.saveImage?(n=n.relations,i=(i=i.replace("module",n.module).replace("entityId",n.entityId).replace(e,""+n.network)).replace("/twitter","")):n&&n.module&&n.entityId&&(i=i.replace("module",n.module).replace("entityId",n.entityId).replace(e,"relations")),n&&"facebook"===n.network&&(i=i.replace("twitter","facebook")),i}}),store.registerSerializer("relation",{payloadKey:function(){return"relations"},serialize:function(e,t,o,s){if(s&&s.relations&&s.relations.saveImage){var i=new FormData;return s=s.relations,i.append(s.csrfParam,s.token),i}return t}}),store.registerModel("account",{},{actions:{addAccountPermission:{},removeAccountPerm:{},getProfileInfo:{}}}),store.registerAdapter("account",{namespace:"crm/v2/settings/social/",buildURL:function(e,t,o,s,i,a,n){return n&&("pages"===n?i+="/pages":n.addPage&&(i=i+"/"+n.id)),"addAccountPermission"===a?i=i.replace("actions/addAccountPermission","")+n.accountId+"/permissions":"removeAccountPerm"===a?i=i.replace("actions/removeAccountPerm","")+n.accountId+"/permissions":"getProfileInfo"===a&&(i=i.replace("settings/social","Social").replace("account/actions/getProfileInfo",n.network+"/"+n.accountId+"/profiles"),void 0!==n.profileId?i=i+"/"+n.profileId:void 0!==n.screenName?i=i+"/"+n.screenName:n.search&&(i=i+"/"+n.search)),i=i.replace("account","accounts")},methodForRequest:function(e,t,o,s,i){return"addAccountPermission"===i?"POST":"removeAccountPerm"===i?"DELETE":"getProfileInfo"===i?"GET":e}}),store.registerSerializer("account",{payloadKey:function(){return"accounts"},normalizeResponse:function(e,t,o,s){return s&&(o.accounts={id:s,data:o.data},delete o.data),o},extractMeta:function(e){if(e.summary)return e.meta={summary:e.summary,hasnext:e.hasnext},delete e.summary,delete e.hasnext,e.meta},serialize:function(e,t,o,s){return s&&(s.addAccountPerm?t=s.params:s.addPage&&(t=o[0])),t}}),store.registerModel("interactions",{}),store.registerAdapter("interactions",{namespace:"crm/v2/Social/brands/brand_id/",buildURL:function(e,t,o,s,i,a,n){return n&&n.brand_id&&(i=i.replace("brand_id",n.brand_id)),i}}),store.registerSerializer("interactions",{payloadKey:function(){return"interactions"},normalizeResponse:function(e,t,o){var s=o;return s&&($.each(s.data,(function(e,t){t.id||("twitter"===t.network?t.id=t.obj_id:"facebook"===t.network&&t.interaction_info&&(t.id=t.interaction_info.id))})),o={interactions:s.data,meta:s.cursor}),o},extractMeta:function(e){if(e.meta)return e.meta}}),store.registerModel("crm_social_comment",{comments:Lyte.attr("array"),offset:Lyte.attr("object")}),store.registerAdapter("crm_social_comment",{namespace:"crm/v2/Social/network/accountId/posts/postId",buildURL:function(e,t,o,s,i,a,n){return i=(i=i.replace("network",n.network).replace("accountId",n.accountId)).replace(e,""),n&&n.postComments?i=(i+="comments").replace("postId",n.postId):n&&n.newTweet&&(i=i.replace("/postId/","")),i}}),store.registerSerializer("crm_social_comment",{payloadKey:function(){return"comments"},serialize:function(e,t,o,s){if(s.postComments||s.newTweet){var i=new FormData;return i.append("content",s.content),s.file&&i.append("file",s.file),i}},normalizeResponse:function(e,t,o){var s=o.comments||o.posts;return(o=Array.isArray(s)?{comments:s,meta:o.offset}:{comments:s.data,meta:s.cursor}).id||(o.id=Math.floor(1e6*Math.random()+1),o.comments.id||(o.comments.id=Math.floor(1e6*Math.random()+1),o.comments[0].id||(o.comments[0].id=Math.floor(1e6*Math.random()+1)))),o},extractMeta:function(e){if(e.meta)return e.meta}});
