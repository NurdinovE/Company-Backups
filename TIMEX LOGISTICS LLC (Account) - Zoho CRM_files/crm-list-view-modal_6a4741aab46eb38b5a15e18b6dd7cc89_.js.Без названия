Lyte.Component.register("crm-list-view-modal",{_template:'<template tag-name="crm-list-view-modal"> <lyte-modal id="listViewPopup" lt-prop-wrapper-class="crmLVModalWrapper {{if(expHandlers(featureName,\'===\',\'CHARTVIEWS\'),\'\',\'crmListOneModule\')}} {{if(expHandlers(featureName,\'===\',\'PORTALS\'),\'portalLVModal\',\'\')}}" lt-prop-allow-multiple="true" lt-prop-show-close-button="{{show_close_btn}}" lt-prop-prevent-focus="true" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;right&quot;:&quot;0px&quot;}" lt-prop-height="{{modalHeight}}" lt-prop-width="90%" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromRight&quot;,&quot;duration&quot;:&quot;0.5&quot;}" lt-prop-freeze="{{expHandlers(freeezeLayerShown,\'!\')}}" lt-prop-show="{{show_modal}}" on-before-close="{{method(\'beforePopupClose\')}}" on-close="{{method(\'closePopUp\')}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{expHandlers(expHandlers(featureName,\'==\',&quot;CHARTVIEWS&quot;),\'&amp;&amp;\',activityBadgeUpgrade)}}"><template case="true"> <span class="lyteModalClose" data-zcqa="chartDrilldown_closePop" onclick="{{action(\'cancelpop\',\'CHARTVIEWS\')}}"></span> </template></template> <crm-custom-outer-box manage_columns_visible="{{manage_columns_visible}}" custom-method-implemented="{{customMethodImplemented}}" is-pin-unpin-supported="{{isPinUnpinSupported}}" actions="{{actions}}" fetch-count-values="{{fetchCountValues}}" show_count_loading="{{show_count_loading}}" module_per_page="{{module_per_page}}" warning-note="{{warningNote}}" render-without-custom-view="{{renderWithoutCustomView}}" save-button-literal="{{saveButtonLiteral}}" manage-column-disable-literal="{{manageColumnDisableLiteral}}" related_lists="{{related_lists}}" show-last-added-note="{{showLastAddedNote}}" hide-activity-badge="{{hideActivityBadge}}" show-activity-quick-create="{{showActivityQuickCreate}}" show-filter-by="{{showFilterBy}}" show-note="{{showNote}}" module_name="{{module_name}}" custom-message="{{customMessage}}" cvid="{{cvid}}" selected-ids="{{selectedIds}}" prev-selected-id="{{prevSelectedId}}" module_info="{{module_info}}" view-type="{{viewType}}" error-on-model="{{errorOnModel}}" list_cv_btn="{{list_cv_btn}}" begin_page="{{begin_page}}" portal-name="{{portalName}}" client-account="{{clientAccount}}" show-custom-filter="{{showCustomFilter}}" is-blocked-reason="{{isBlockedReason}}" page="{{page}}" listfields="{{listfields}}" reset_scroll="{{reset_scroll}}" no_record_message="{{no_record_message}}" customview_records="{{customview_records}}" more_records="{{more_records}}" start_index="{{startIndex}}" start-index="{{startIndex}}" total_count="{{total_count}}" sorted_column="{{sorted_column}}" applied_filters="{{applied_filters}}" saved_filters="{{saved_filters}}" filter-query-params="{{filterQueryParams}}" cv_name="{{cv_name}}" layer-btn="{{layerBtn}}" search_letter="{{search_letter}}" is-from-modal="{{isFromModal}}" feature-name="{{featureName}}" cv_sys_name="{{cv_sys_name}}" query-params="{{lbind(queryParams)}}" is-resize-enabled="{{isResizeEnabled}}" is-clip-wrap-enabled="{{isClipWrapEnabled}}" show-manage-column="{{showManageColumn}}" clip_mode="{{lbind(clip_mode)}}" feature-object="{{featureObject}}" persist-pin-update="{{persistPinUpdate}}" persist-width-update="{{persistWidthUpdate}}" persist-wrap-update="{{persistWrapUpdate}}" persist-manage-columns="{{persistManageColumns}}"></crm-custom-outer-box> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["module_name","cvid","selectedIds","prevSelectedId","module_info","viewType","manage_columns_visible","errorOnModel","list_cv_btn","begin_page","portalName","clientAccount","showCustomFilter","isBlockedReason","page","listfields","reset_scroll","no_record_message","customview_records","list_cv_btn","related_lists","more_records","start_index","total_count","saved_filters","filterQueryParams","cv_name","layerBtn","sorted_column","applied_filters","search_letter","isFromModal","featureName","queryParams","modalHeight","featureObject","isClipWrapEnabled","isResizeEnabled","showManageColumn","freeezeLayerShown","customMessage","show_modal","persistPinUpdate","persistWrapUpdate","persistWidthUpdate","show_close_btn","persistManageColumns","renderWithoutCustomView","saveButtonLiteral","manageColumnDisableLiteral","warningNote","isPinUnpinSupported","fetchCountValues","show_count_loading","module_per_page","customMethodImplemented"],data:function(){return{module_name:Lyte.attr("string"),cvid:Lyte.attr("string"),selectedIds:Lyte.attr("array",{default:[]}),prevSelectedId:Lyte.attr("string"),module_info:Lyte.attr("object"),viewType:Lyte.attr("string"),manage_columns_visible:Lyte.attr("boolean",{default:!0}),errorOnModel:Lyte.attr("boolean"),list_cv_btn:Lyte.attr("array"),begin_page:Lyte.attr("boolean",{default:!1}),portalName:Lyte.attr("string"),clientAccount:Lyte.attr("boolean"),showCustomFilter:Lyte.attr("boolean",{default:!0}),isBlockedReason:Lyte.attr("boolean",{default:!1}),page:Lyte.attr("number"),listfields:Lyte.attr("array",{default:[]}),reset_scroll:Lyte.attr("boolean"),no_record_message:Lyte.attr("string",{default:""}),customview_records:Lyte.attr("array",{default:[]}),list_cv_btn:Lyte.attr("array",{default:[]}),related_lists:Lyte.attr("array",{default:[]}),more_records:Lyte.attr("boolean"),start_index:Lyte.attr("number"),total_count:Lyte.attr("number"),saved_filters:Lyte.attr("array",{default:[]}),filterQueryParams:Lyte.attr("object",{default:{}}),cv_name:Lyte.attr("string"),layerBtn:Lyte.attr("array",{default:[]}),sorted_column:Lyte.attr("string"),applied_filters:Lyte.attr("string"),search_letter:Lyte.attr("string",{default:""}),isFromModal:Lyte.attr("boolean",{default:!0}),featureName:Lyte.attr("string"),queryParams:Lyte.attr("object",{default:{}}),modalHeight:Lyte.attr("string",{default:"98%"}),featureObject:Lyte.attr("object",{default:{}}),isClipWrapEnabled:Lyte.attr("boolean",{default:!1}),isResizeEnabled:Lyte.attr("boolean",{default:!1}),showManageColumn:Lyte.attr("boolean",{default:!0}),freeezeLayerShown:Lyte.attr("boolean",{default:!1}),customMessage:Lyte.attr("string",{default:""}),show_modal:Lyte.attr("boolean",{default:!0}),persistPinUpdate:Lyte.attr("boolean",{default:!0}),persistWrapUpdate:Lyte.attr("boolean",{default:!0}),persistWidthUpdate:Lyte.attr("boolean",{default:!0}),show_close_btn:Lyte.attr("boolean",{default:!1}),persistManageColumns:Lyte.attr("boolean",{default:!0}),renderWithoutCustomView:Lyte.attr("boolean",{default:!1}),saveButtonLiteral:Lyte.attr("string"),manageColumnDisableLiteral:Lyte.attr("string",{default:"crm.listview.customview.locked"}),warningNote:Lyte.attr("string"),isPinUnpinSupported:Lyte.attr("boolean",{default:!0}),fetchCountValues:Lyte.attr("boolean",{default:Crm.userDetails.fetchCountValues}),show_count_loading:Lyte.attr("boolean"),module_per_page:Lyte.attr("number"),customMethodImplemented:Lyte.attr("boolean",{default:!1})}},init:function(){"CAMPAIGNMEMBERLISTVIEW"===this.data.featureName&&this.setData("show_close_btn",!0),this.setData({activityBadgeUpgrade:Crm.userDetails.activityBadgeUpgradeEnabled,modalHeight:"100%"})},actions:{cancelpop:function(){$L("#listViewPopup")[0].ltProp("show",!1)}},methods:{closePopUp:function(){var e=this.data.module_name;if(this.data.customMethodImplemented)return this.data.freeezeLayerShown&&this.showHideModalFreezeLayer(),void Lyte.triggerEvent("hideDrillDownView",e);var t=$L("crm-inner-list")[0];if(t&&t.component._propsSave(),"PORTALS"===this.data.featureName)if("crm.settings.section.client-portal.user-types.users"===Lyte.Router.getRouteInstance().transition.target){var a=$L("#inviteUsers");a.length>0&&a[0]?a[0].setData("ltPropDisabled",!1):$L("#noUsersFoundInviteUsers")[0].setData("ltPropDisabled",!1)}else delete CPMF.userTypeId;else if("COMPLIANCE"===this.data.featureName)-1==["crm.settings.section.compliance.consent-dashboard","crm.tab.module.entity","crm.tab.module.entity.detail"].indexOf(Lyte.Router.getRouteInstance().transition.target)&&Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.compliance.consent-dashboard"});else if("CHARTVIEWS"===this.data.featureName&&$L("crm-chart-view").length){$L("crm-chart-view")[0].component.closeDrillDownPopup()}"CHARTVIEWS"!==this.data.featureName&&this.changeDefaultCustomViewForModule(e),this.data.freeezeLayerShown&&this.showHideModalFreezeLayer(),this.$node.remove(),crmTab.getFromCache(e)&&"CHARTVIEWS"!==this.data.featureName&&crmTab.deleteFromCache(e)},beforePopupClose:function(){var e=this.data.featureName;if(("COMPLIANCE"===e||"CHARTVIEWS"===e)&&($L("#updateConsenttype:visible").length||$L("#deletepopup:visible").length||$L("#massMailstatsPop:visible").length))return!1;if("CHARTVIEWS"===e){if($L("#qCreate")[0]&&$L(".qcontainer").is(":visible"))return!1;if($L("#popupnew:visible").length||$L("#showMassMail:visible").length||$L("#searchCreateDiv:visible").length||$L("#custom_alert_popup:visible").length||$L("#loadingDiv:visible").length||$L("#mailMergeDoc:visible").length||$L("#etComposePanel:visible").length&&!$L(".etMinimize:visible").length||$L("#topBandPopup:visible").length||$L("#emailalert:visible").length)return!1}return!0}},reloadCurrentListView:function(){var e={page:this.getData("page"),per_page:this.getData("per_page")},t=this.getData("queryParams");if((customViewObject.totalCount%customViewObject.currentOption===customViewObject.selectedIds.length||customViewObject.selectedIds.length===customViewObject.currentOption)&&customViewObject.totalCount>customViewObject.currentOption){var a=customViewObject.totalCount-customViewObject.selectedIds.length,s=Math.round(a/customViewObject.currentOption);0===Math.round(a%customViewObject.currentOption)&&this.getData("page")===s+1&&(e.page=s)}t&&t.filter_id?(e.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,e.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters):t&&(t.filters||t.cross_filters)&&(e.filters=t.filters,e.cross_filters=t.cross_filters),this.setData("selectedIds",[]),customViewObject.selectedIds=[],this.fetchData({queryParams:e},this.getData("module_name"),{clearCache:!0},!0,!1,this.getData("featureName"))}},{mixins:["crm-view-utils","crm-list-view-modal-util"]}),Lyte.Mixin.register("crm-list-view-modal-util",{fetchData:function(e,t,a,s,r,i,o,l){var n,c=this;if("PORTALS"!==i&&"COMPLIANCE"!==i&&"CHARTVIEWS"!==i&&"CAMPAIGNMEMBERLISTVIEW"!==i&&"string"!=typeof(n=c.getCVID(t))&&(n=c.getCVID(t,n)),o)for(var u in moduleApiMapping)moduleApiMapping.hasOwnProperty(u)&&moduleApiMapping[u]===t&&(t=u);if(!l&&!1!==l){var d=$L("crm-list-view-modal")[0];l=!!d&&d.component.data.freeezeLayerShown}if("PORTALS"===i){for(var p=(h=store.peekAll("custom_view"))?h.length:0,m=0;m<p;m++){var f=h[m];if("ALLVIEWS"===f.system_name&&f.module.api_name===moduleApiMapping[t]){n=f.id,y=f;break}}var _=moduleRecordMapping[t];n?(_.$.set("custom_view",y),_.$.set("cvid",y.id),c.loadModuleData(c,e,t,n,a,s,r,i,l)):store.findAll("custom_view",{module:moduleApiMapping[t]}).then((function(o){for(var l,u=o.length,d=0;d<u;d++)if("ALLVIEWS"===o[d].system_name){n=o[d].id,l=o[d];break}var p=moduleRecordMapping[t];p.$.set("custom_view",l),p.$.set("cvid",l.id),c.loadModuleData(c,e,t,n,a,s,r,i)}),(function(e){if(e.response){var t=JSON.parse(e.response);if("NO_PERMISSION"===t.code||"permission denied"===t.message){commonUtils.showHideLoadingDiv(!1),crmui.showMsgBand("error",I18n.getMsg("custmr.prtl.invite.module.permission.missing"),5e3);var a=$("#inviteUsers")[0];if(a)a.setAttribute("lt-prop-title",I18n.getMsg("custmr.prtl.invite.module.permission.missing"));else{var s=$L("#noUsersFoundInviteUsers");s.length>0&&s[0]&&(s[0].setData("ltPropDisabled",!0),s[0].setData("ltPropTitle",I18n.getMsg("custmr.prtl.invite.module.permission.missing")))}}}}))}else if("COMPLIANCE"===i){var g=Lyte.Router.getRouteInstance().getQueryParams();e.queryParams.type=g.type,e.queryParams.status=g.status;var h,y,v=this.setFiltersForCompliance("CUSTOM_VIEWS").filters;(h=store.peekAll("custom_view")).forEach((function(e){e.name.indexOf(v.value)>-1&&e.module.api_name===moduleApiMapping[t]&&(n=e.id,y=e)}));_=moduleRecordMapping[t];if(n)_.$.set("custom_view",y),_.$.set("cvid",y.id),c.loadModuleData(c,e,t,n,a,s,r,i,l);else(b={}).module=_.api_name,b.filters=JSON.stringify(v),this.setFeatureSpecificParams(b,i),store.findAll("custom_view",b).then((function(o){n=o[0].id,_.$.set("custom_view",o[0]),_.$.set("cvid",o[0].id),c.loadModuleData(c,e,t,n,a,s,r,i,l)}),(function(e){c.handleErrorForModal(e,i,l)}))}else if("CAMPAIGNMEMBERLISTVIEW"===i){g=Lyte.Router.getRouteInstance().getQueryParams();e.queryParams.type=g.type,e.queryParams.status=g.status;var b;_=moduleRecordMapping[t];(b={}).module=_.api_name,b.filters=JSON.stringify(v),store.findAll("custom_view",b).then((function(o){var u=o.find((e=>"ALLVIEWS"===e.system_name));n=u.id,_.$.set("custom_view",o[0]),_.$.set("cvid",o[0].id),c.loadModuleData(c,e,t,n,a,s,r,i,l)}),(function(e){c.handleErrorForModal(e,i,l)}))}else if("CHARTVIEWS"===i){_=moduleRecordMapping[t];n=_.cvid;var L=$L("crm-customview-layer"),w=L.length;_.total_count=w?L[w-1].getData("total_count"):_.total_count,c.loadModuleData(c,e,t,n,a,s,r,i,l)}else c.loadModuleData(c,e,t,n,a,s,r,i,l)},loadModuleData:function(e,t,a,s,r,i,o,l,n){var c;"COMPLIANCE"!==l&&"PORTALS"!==l&&"CHARTVIEWS"!==l&&"CAMPAIGNMEMBERLISTVIEW"!==l||(moduleRecordMapping[a].comp_AccessedModules?c={module:moduleRecordMapping[a]}:moduleRecordMapping[a].crux_customViewAccessedModules&&(moduleRecordMapping[a].crux_customViewAccessedModules=!1)),(c=c||e.getModuleData(a,Lyte.Router.getRouteInstance().transition.target)).module?e.processModuleData(e,t,a,s,r,i,o,l,n):c.then((function(c){var u;"COMPLIANCE"!==l&&"PORTALS"!==l&&"CAMPAIGNMEMBERLISTVIEW"!==l||((u=moduleRecordMapping[a]).comp_AccessedModules=!0,u.$.set("filter_status",!0),u.$.set("per_page",10),u.$.set("start_index",0),u.$.set("relatedModules",c.relatedModules));"CHARTVIEWS"===l&&((u=moduleRecordMapping[a]).comp_AccessedModules=!0,u.$.set("per_page",Crm.userDetails.maxRange),u.$.set("chart_view",!0));e.processModuleData(e,t,a,s,r,i,o,l,n)}),(function(t){e.handleErrorForModal(t,l,n)}))},processModuleData:function(e,t,a,s,r,i,o,l,n){e.postModuleDataFetch(a),l&&this.setFeatureSpecificFilters(t.queryParams,l),e.preFetch(t.queryParams,a,s,r,"modal",l).then((function(){commonUtils.showHideLoadingDiv(!0),e.fetch(t,a,s,r,!0).then((function(c){var u=e.postFetch(c,t.queryParams,a);e.removeFeatureSpecificFilters(t.queryParams,l),u.freeezeLayerShown=n,e.renderHTMLTemplate(u,t,a,s,r,i,o,!0,l),e.postRender(u,t,s),"CHARTVIEWS"!==l||e.checkForStickyTable()||setTimeout((function(){$L("#listViewTable")[0].setColumnWidth()}),60)}),(function(t){e.handleErrorForModal(t,l,n)}))}),(function(t){e.handleErrorForModal(t,l,n)}))},getCVID:function(e,t){var a=store.peekRecord("module",moduleRecordMapping[e].id);return a&&a.custom_view?a.custom_view.id:t?void t.then((function(e){return e[0].custom_view.id})):store.findRecord("module",moduleRecordMapping[e].id)},loadModal:function(e,t,a,s,r){var i=a||{queryParams:{}};if(r&&r.length){var o={fields:r};i.list_props=o}s&&this.showHideModalFreezeLayer(!0),this.fetchData(i,e,{clearCache:!0},!1,!1,t,!1,s)},getRecordsForModal:function(e,t,a,s,r){var i=this.getData("queryParams"),o={page:t,per_page:e};return i&&i.filter_id?(o.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,o.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters):i&&(i.filters||i.cross_filters)&&(o.filters=i.filters,o.cross_filters=i.cross_filters),this.fetchCount=!1,this.fromNavigator=!0,this.fromPerpage=a,this.data.queryParams=objectUtils.cloneObject(o),this.fetchData({queryParams:o},s,{},!1,!0,r),commonUtils.showHideLoadingDiv(!0),!1},sortRecordsForModal:function(e,t,a,s,r){this.fetchCount=!1;var i=this.getData("queryParams"),o={sort_by:e,sort_order:t,page:1,per_page:a};return i&&i.filter_id?(o.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,o.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters):i&&(i.filters||i.cross_filters)&&(o.filters=i.filters,o.cross_filters=i.cross_filters),this.fetchData({queryParams:o},s,{clearCache:!0},!0,!1,r),!1},handleErrorForModal:function(e,t,a){switch(t){case"COMPLIANCE":case"CAMPAIGNMEMBERLISTVIEW":this.handleErrorComp(e);break;case"CHARTVIEWS":this.handleErrorChartViews(e);case"PORTALS":this.handleErrorPortalCase(e);break;default:a&&this.showHideModalFreezeLayer()}},handleErrorPortalCase:function(e){commonUtils.showHideLoadingDiv();try{var t=JSON.parse(e.response);void 0!==t&&"NO_PERMISSION"===t.code&&this.showErrorMsg({message:"custmr.prtl.invite.module.permission.missing"})}catch(e){_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("please.contact.support"),ltPropDuration:5e3}})}},handleErrorComp:function(e){var t,a=JSON.parse(e.response),s=this;if(commonUtils.showHideLoadingDiv(),a&&"NO_PERMISSION"===a.code||403===e.status)t=I18n.getMsg("crm.privacy.list.view.no.module.permission");else if(400===e.status&&a&&"INVALID_MODULE"===a.code)t=I18n.getMsg("module.not.available");else{if(400===e.status){return void this.filterErrorMsg(void 0,void 0,a,!0,(function(){customViewObject.selectedIds=[];var e=$L("#customFilter")[0];e&&e.resetFields(),s.fetchData({queryParams:{}},Lyte.Router.getRouteInstance().getQueryParams().module,{clearCache:!0},!0,!1,"COMPLIANCE")}))}t=I18n.getMsg("crm.errorpage.note1")+" "+I18n.getMsg("crm.errorpage.note2")}renderingUtils.showCustomAlert(t,void 0,!1,(function(){Lyte.Router.transitionTo("crm.settings.section.compliance.consent-dashboard").refresh=!0,s.showHideModalFreezeLayer()}))},setFeatureSpecificFilters:function(e,t){var a={};switch(t){case"PORTALS":e.on_demand_properties="$client_portal_invited",e.client_portal_invited=!1;var s=store.peekRecord("user_type",CPMF.userTypeId?CPMF.userTypeId:Lyte.Router.getRouteInstance().getDynamicParam()).invitation_field.api_name;a.filters={comparator:"equal",field:{api_name:s},value:"${NOTEMPTY}"};break;case"COMPLIANCE":a=this.setFiltersForCompliance("RECORDS");break;case"CAMPAIGNMEMBERLISTVIEW":a=this.setFiltersForCampaignListView();break;case"CHARTVIEWS":if(e){var r=$L("crm-list-view-modal"),i=r.length?r[0].component.data.queryParams:e;e.filters=i.filters,e.cross_filters=i.cross_filters}break;default:return}if(a.filters)if(e.filters){var o;"string"==typeof(o=e.filters)&&(o=JSON.parse(o));var l=objectUtils.cloneObject(o);(o={}).group=[],o.group.push(l),o.group_operator="AND",o.group.push(a.filters),e.filters=JSON.stringify(o)}else e.filters=JSON.stringify(a.filters);a.cross_filters&&(e.cross_filters?("string"==typeof(o=e.cross_filters)&&(o=JSON.parse(o)),Array.prototype.push.apply(o,a.cross_filters),e.cross_filters=JSON.stringify(o)):e.cross_filters=JSON.stringify(a.cross_filters))},setFeatureSpecificParams:function(e,t){if("COMPLIANCE"===t)e.feature="compliance_settings"},setFiltersForCampaignListView:function(){var e={},t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],a=moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].api_name;return Crm.userDetails.isRelatedModuleFilters&&(a+="__r"),e.cross_filters=[{include_objects:!1,relation:{api_name:a},criteria:{comparator:"equal",field:{api_name:"Campaign_Name"},value:[{id:t}]}}],e},setFiltersForCompliance:function(e){var t=Lyte.Router.getRouteInstance().getQueryParams(),a={};switch(e){case"CUSTOM_VIEWS":switch(a.filters={field:{api_name:"Display_Name"},comparator:"starts_with"},t.type){case"request":a.filters.value="Request Type";break;case"consent":a.filters.value="Consent Status"}break;case"RECORDS":switch(t.type){case"request":a.cross_filters=[{include_objects:!0,relation:{api_name:"Data_Subject_Requests"},criteria:{comparator:"equal",field:{api_name:"Request_Type"}}}];var s=t.status;if(Crm.userDetails.isRelatedModuleFilters)switch(a.cross_filters[0].relation.api_name="Data_Subject_Requests__r",t.status){case"Access":s="Request to access data";break;case"Rectify":s="Request to rectify data";break;case"Export":s="Request to export data";break;case"Stop Processing":s="Request to stop processing data";break;case"Delete":s="Request to delete data"}a.cross_filters[0].criteria.value=s;break;case"consent":var r=this.findObjectFromArray(moduleRecordMapping[t.module].fields,"Data_Processing_Basis","api_name")[0],i=r&&r.pick_list_values?r.pick_list_values:[],o=Crm.userDetails.isRelatedModuleFilters;switch(a.filters={field:{api_name:o?"Data_Processing_Basis":"Data_Processing_Basis_Details.Data_Processing_Basis"},comparator:"equal"},a.filters.value=[],t.status){case"Pending":case"Obtained":case"Awaiting":case"Not Responded":case"Not Applicable":var l=this.findObjectFromArray(i,t.status,"actual_value")[0];a.filters.value=[l.display_value];break;case"Required":var n=this;["Pending","Obtained","Awaiting","Not Responded"].forEach((function(e){a.filters.value.push(n.findObjectFromArray(i,e,"actual_value")[0].display_value)}));break;case"Not Required":n=this;["Legitimate Interests","Public Interests","Vital Interests","Legal Obligation","Contract"].forEach((function(e){a.filters.value.push(n.findObjectFromArray(i,e,"actual_value")[0].display_value)}))}}}return a},removeFeatureSpecificFilters:function(e,t){switch(t){case"PORTALS":this.removeClientPortalFilter(e);break;case"COMPLIANCE":this.removeComplianceFilter(e);break;case"CAMPAIGNMEMBERLISTVIEW":this.removesetFiltersForCampaignListViewFilter(e)}},removeClientPortalFilter:function(e){var t=e.filters?JSON.parse(e.filters):e.filters,a=store.peekRecord("user_type",CPMF.userTypeId?CPMF.userTypeId:Lyte.Router.getRouteInstance().getDynamicParam()).invitation_field.api_name;if(t.group||"equal"!==t.comparator||t.field.api_name!==a||"${NOTEMPTY}"!==t.value){for(var s=t.group_operator,r=(t=t.group).length-1;r>=0;r--)"equal"===t[r].comparator&&t[r].field.api_name===a&&"${NOTEMPTY}"===t[r].value&&t.splice(r,1);if(1===t.length)e.filters=JSON.stringify(t[0]);else if(0===t.length)e.filters=void 0;else{var i={};i.group_operator=s,i.group=t,e.filters=JSON.stringify(i)}}else e.filters=void 0},removeComplianceFilter:function(e){var t=Crm.userDetails.isRelatedModuleFilters?"Data_Processing_Basis":"Data_Processing_Basis_Details.Data_Processing_Basis";if(e.filters&&-1!==e.filters.indexOf(t)){var a=JSON.parse(e.filters);if(a.group){for(var s=(a=a.group).length-1;s>=0;s--)if(a[s].field.api_name===t){a.splice(s,1);break}0===a.length?e.filters=void 0:e.filters=JSON.stringify(a[0])}else a.field.api_name===t&&(e.filters=void 0)}if(e.cross_filters&&e.cross_filters.indexOf("Data_Subject_Requests")){for(var r=JSON.parse(e.cross_filters),i=r.length-1;i>=0;i--)if(r[i].relation&&"Data_Subject_Requests"===r[i].relation.api_name){r.pop(i);break}0===r.length?e.cross_filters=void 0:e.cross_filters=JSON.stringify(r)}},removesetFiltersForCampaignListViewFilter(e){if(e.cross_filters){var t=JSON.parse(e.cross_filters),a=t.length,s=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],r=moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].api_name;Crm.userDetails.isRelatedModuleFilters&&(r+="__r");for(var i=a-1;i>=0;i--)if(t[i].relation&&t[i].relation.api_name===r&&t[i].criteria.value[0].id===s){t.pop(i);break}0===t.length?e.cross_filters=void 0:e.cross_filters=JSON.stringify(t)}},getBtnListForPrivacyDashBoard:function(e,t){var a=[],s={name:"crm.privacy.consent.send.mail",action:"sendConsentMail"},r={name:"crm.privacy.consent.resend.mail",action:"resendConsentMail"},i={name:"crm.button.mass.delete",action:"delete"},o={name:"crm.consent.consenttype.header",action:"updateConsenttype"};switch(e.status){case"Pending":a.push(s),a.push(o),a.push(i);break;case"Obtained":case"Awaiting":a.push(i);break;case"Not Applicable":case"Required":case"Not Required":a.push(o),a.push(i);break;case"Not Responded":a.push(r),a.push(i)}t.privacyBtnList=a},changeDefaultCustomViewForModule:function(e){var t=moduleRecordMapping[e];delete t.crux_customViewAccessedModules,delete t.comp_AccessedModules,t.$.isDirty()&&t.$.rollBack(),t.$.set("cvid",t.custom_view.id)},showHideModalFreezeLayer:function(e){var t=$L("#modalFreezePop");if(e)if(t.length)t.show();else{var a=document.createElement("div");a.id="modalFreezePop",document.querySelector("#show").appendChild(a)}else t.hide()},handleErrorChartViews:function(e){var t=$L("crm-chart-view")[0];t&&(t.component.drilldownOpened=!1,t.component.handleErrorForChartView(e,t.component,!0))}});
