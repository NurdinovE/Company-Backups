Lyte.Mixin.register("crm-territory-common-utils",{constructTerritoryName:function(e,r,n){for(var i="",a=[],t=e,o=e.length,s=e[0].name,l=0;l<o;l++)i="",a.filter((function(e){return e.id==t[l].id}))[0]||((t[l].reporting_to||t[l].parent_id)&&(i=t[l].name,a.push({display_name:i,flag:!!t[l].children,name:i,id:t[l].id}),i+=" >"),n?r.constructTerrNameToTreeForm(t[l],i,i,a):r.recursive(t[l],i,i,a,s));return a},recursive:function(e,r,n,i,a){var t,o,s=e.children;if(s){var l,m=s.length;for(l=0;l<m;l++){e.reporting_to||(r=""),o=n+s[l].name,t=r+s[l].name;var c=s[l].children;c&&c.length?(i.push({display_name:s[l].name,toolTipMsg:a+" > "+o,flag:!0,name:s[l].name,id:s[l].id}),this.recursive(s[l],t,o+" > ",i,a)):(i.push({display_name:s[l].name,toolTipMsg:a+" > "+o,flag:!1,name:s[l].name,id:s[l].id}),this.recursive(s[l],r,n,i,a))}}},constructTerrNameToTreeForm:function(e,r,n,i){var a,t,o=e.children,s=!1,l=!1;if(o){var m,c=o.length;for(m=0;m<c;m++){if(e.reporting_to||(r=""),t=n+o[m].name,(a=r+o[m].name).length>20){var d=r.indexOf(">.. >");if(d>=0&&d<r.length)p=r.substr(d,r.length-1),a=r.replace(p,">.. > "),a+=o[m].name,l=!0;else{var p,g=r.indexOf(">");(p=a.split(">")).length>2?(a=p[0]+">.. > "+p[p.length-1],s=!0):-1!==g&&(p=r.substr(g,r.length-1),a=(a=r.replace(p,">"))+" "+o[m].name,s=!0)}}var u=o[m].children;u&&u.length?(i.push({display_name:a,toolTipMsg:t,flag:!0,name:o[m].name,id:o[m].id}),s?a+=".. > ":l||(a+=" > "),this.constructTerrNameToTreeForm(o[m],a,t+" > ",i)):(i.push({display_name:a,toolTipMsg:t,flag:!1,name:o[m].name,id:o[m].id}),this.constructTerrNameToTreeForm(o[m],r,n,i))}}},getTerritoryProm:function(e,r,n){var i={};return e&&(i.include=e),n&&(i.include_inner_details=n),r&&(i.filters=r),store.findAll("territory",i,{},!0,{makeRequest:!0,version:"v8"})},fetchTerritories:function(e,r,n,i,a){var t=!!n&&{field:{api_name:"name"},value:i,comparator:"contains"};return new Promise((function(i){(!0===n?store.findAll(e.cxPropModuleName,{page:r.page,per_page:r.per_page,filters:t},!1,void 0,{version:"v7"}):store.findAll(e.cxPropModuleName,{page:r.page,per_page:r.per_page},!1,void 0,{version:"v7"})).then((function(e){a&&(a.page=a.page+1,a.hasMoreTerritory?a.hasMoreTerritory=e.$.meta.more_records:a.hasMoreTerrForGivenSearchWord=e.$.meta.more_records),i(e)}))}))}});
