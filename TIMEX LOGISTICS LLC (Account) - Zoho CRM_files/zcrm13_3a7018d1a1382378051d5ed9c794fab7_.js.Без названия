function viewUserinAjax(e,t){if(commonUtils.showHideLoadingDiv(!0),http){var a="";a=null!=t?t+"&ajaxload=true":"ajaxload=true",http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(http.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(http);var e=http.responseText;$("#result").empty();var t=document.getElementById("result");t.innerHTML=e;var a=document.getElementById("userCountryLocale");a&&(a.value=getObj("userCntLocTxt").value),commonUtils.showHideLoadingDiv(),JSEvalScript(t)}},http.send(a)}}function userValidate(e,t,a,i,l){(i=i?$(i):$(document.addUserForm)).find(".form_err_msg").remove(),i.find(".form_err_fld").removeClass("form_err_fld");var s=i.attr("name"),n=!0;if("true"==e.value&&"upgrade2Org"==t.value&&!commonUtils.emptyCheck("j_organization","Company Name",void 0,"addUserForm","inline"))return!1;0!=$("#fN").find(".wf_requiredMark").length&&(commonUtils.emptyCheck("firstName","First Name",void 0,s,"inline")||(n=!1)),0!=$("#lN").find(".wf_requiredMark").length&&(commonUtils.emptyCheck("lastName","Last Name",void 0,s,"inline")||(n=!1)),old_splCharArray=splCharArray,splCharArray=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","$");var r=getObjFromPopup("lastName",i);r&&!splCharCheck(r.value)&&(n=!1,renderingUtils.displayErrorDiv("lastName","Last Name","crm.alert.label.special.characters",r));var o=getObjFromPopup("firstName",i);o&&!splCharCheck(o.value)&&(n=!1,renderingUtils.displayErrorDiv("firstName","First Name","crm.alert.label.special.characters",o)),splCharArray=old_splCharArray,"addUserForm"===s&&(getObjFromPopup("roleName",i)&&!commonUtils.emptyCheck("roleName","Role Name",void 0,s,"inline")&&(n=!1),getObjFromPopup("roleName_Add",i)&&!commonUtils.emptyCheck("roleName_Add","Role Name",void 0,s,"inline")&&(n=!1),"Edit"==a.value||commonUtils.emptyCheck("j_username","crm.label.email.address",void 0,"addUserForm","inline")&&validationUtils.emailValidate("j_username","crm.label.email.address",void 0,"addUserForm","inline")||(n=!1));isContainsPipeSymbol({alias:"Alias",phone:"Phone",mobile:"Mobile",fax:"Fax",street:"Street",city:"City",state:"State",zip:"Zip",country:"Country"},void 0,"inline")&&(n=!1);var d=document.getElementById("submitbutton"),c=$("#submitbutton");return d&&(c.empty(),d.innerHTML="<img src='"+networkUtils.getImageUrl("zoho-busy.gif",ResourceConstants.CRM)+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>"),!!n}function newUserForm(e){return e=e||document.addUserForm,userValidate(getObj("ispersonal"),getObjFromPopup("actionName",$(e)),getObjFromPopup("screenMode",$(e)),e,getObj("struts_action"))}function cancelEditing(e,t){var a="";a="viewAllUsers"==e?Crm.getCrmBasePath()+"/Security.do?actionName=viewAllUsers&loadfullpage=true":Crm.getCrmBasePath()+"/Security.do?actionName=viewUser&userId="+t,loadUrl("result",a)}function setDataFetchDate(e,t){var a=Crm.userDetails.LOCALE,i=new Date;null!=t&&i.setTime(t);var l=i.getYear();l<1e3&&(l+=1900);var s=i.getDay(),n=i.getMonth(),r=i.getDate();r<10&&(r="0"+r);var o=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),d=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),c=o[s]+", "+r+" "+d[n]+", "+l,m=i.getHours(),u=i.getMinutes(),p=i.getSeconds(),g=document.getElementById("datafetchdate"),v="",h=$("#datafetchdate");if("HH:mm"!==Crm.userDetails.TIME_FORMAT?(0==m&&(m=12),v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p+" "+(m>=12?"PM":"AM")):v=m+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p,g||getObj("showHome")||getObj("dashboardItems"))if(-1!=a.indexOf("ja")||-1!=a.indexOf("zh")){if((n+=1)<10&&(n="0"+n),c=-1!=a.indexOf("ja")?l+"/"+n+"/"+r:n+"/"+r+"/"+l,"HH:mm"!==Crm.userDetails.TIME_FORMAT){var f=I18n.getMsg("AM"),C=I18n.getMsg("PM");v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p+" "+(m>=12?C:f)}else v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p;if(e&&(getObj("showHome")||getObj("dashboardItems")))e.setAttribute("lt-prop-title",I18n.getMsg("crm.cv.datafetch.message")+" : "+c+", "+v);else if(h.empty(),g.innerHTML=c+" "+v,getObj("fetch_msg"))y=(y=getObj("fetch_msg").innerHTML).replace("&nbsp;"," "),getObj("fetchdate_title").title=y+c+" "+v}else{var y;if(e&&(getObj("showHome")||getObj("dashboardItems")))e.setAttribute("onmouseover","newshowtt('"+I18n.getMsg("crm.cv.datafetch.message")+" : "+c+", "+v+"',true)"),e.setAttribute("onmouseout","newhidett()");else if(h.empty(),g.innerHTML=c+", "+v,getObj("fetch_msg"))y=(y=getObj("fetch_msg").innerHTML).replace("&nbsp;"," "),getObj("fetchdate_title").title=y+c+", "+v}}function RefreshDetailsAction(e,t){parseInt($("input[name=fromIndex]").val()),$("input[name=searchletter]").val(),crmHistory.getState(),moduleRecordMapping[e].cvid;$("#cvid").length>0&&"null"!==$("#cvid")[0].value&&$("#cvid")[0].value,crmTab.deleteFromCache(e);var a=Lyte.Router.getRouteInstance().transition.info.route.split(".")[2];"Forecasts"===a.charAt(0).toUpperCase()+a.slice(1)&&1!=Crm.userDetails.TMENABLED&&Crm.userDetails.isUserHierarchy?$("input[type=checkbox]").each((function(){$(this).prop("checked",!1)})):Lyte.Router.getRouteInstance().refresh()}function decideGetHtml(e){var t=getActionTypeFromUrl(e),a=objectUtils.URL(e).getParams().module;return-1==e.indexOf("/ShowEntityInfo.do")&&-1==e.indexOf("/Edit.do")&&-1==e.indexOf("/Create.do")&&-1==e.indexOf("/Clone.do")||PAGE_CACHE[a]&&PAGE_CACHE[a][t]&&(e=e+"&html=false&pcVersion="+PAGE_CACHE[a][t].PC_VERSION),e}function checkForGTaskList(e,t,a){renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(!0);var i=$("#lookupdiv"),l=Crm.getCrmBasePath()+"/GApps.do?mode=CheckGTask&"+csrfParamName+"="+encodeURIComponent(csrfToken);return mR(l,(function(e){if(commonUtils.showHideLoadingDiv(),"true"==e)renderingUtils.removeFreezeLayer(),Crm.requestParam.ActionType="AddToZG",Crm.saveEntity(a,t,(function(e,t){t&&$("#ajax_load_tab").is(":visible")&&$("#show").html(e)}));else{document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;i.css({display:"block","z-index":"30",width:"650px",position:"absolute"}),i.html(e),mailsetCenter("lookupdiv")}})),!1}function validateGTasks(){var e=getObj("gTaskList").value.trim(),t=getObj("errorMsg").value.trim(),a=$("#lookupdiv");if(!e||e.length<=0)return alert(t),!1;var i=Crm.getCrmBasePath()+"/GApps.do?mode=saveDefaultGTask&gTaskList="+e,l=csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){renderingUtils.removeFreezeLayer(),getObj("isListView")?addCrmTaskIdsToGTask(taskArr):viewEntityInfo("Create&AddToZG","Tasks"),a.html(""),a.hide()}),l)}function cancelfun(e){var t=void 0===e?getObj("module").value:e;if(getObj("oldEntityId")){var a=Crm.getCrmBasePath()+"/ShowEntityInfo.do?module="+t+"&id="+getObj("oldEntityId").value+"&cvid="+getObj("cvid").value+"&recordNum="+getObj("recordNum").value;return ajaxNew(a),!1}getObj("pfrom")&&"gsearch"==getObj("pfrom").value?backToSearchResult():window.history.back()}function settotalnoofrows(){getObj("rowCount")&&(rowCnt=getObj("rowCount").value);var e=getObj("module").value;Crm.isInventoryModule(e)&&(getObj("totalProductCount").value=rowCnt)}function setProbability(e,t){var a=$(t);if(t)var i=a.closest("form")[0].name;else i=$("[name^=createEntityForm]")[0].name;selectedText=e.substring(e.indexOf(":")+1,e.length),e.indexOf(":")>-1&&(e=e.substring(0,e.indexOf(":")));var l=document[i].elements["property(Probability)"];if(null!=l&&(l.value=e,$(l).trigger("change")),a.data()&&a.data("colorcode_enabled")){var s="selectColorComponent-"+a.data("fieldid"),n=a.children("option:selected").eq(0),r=n.attr("data-colorcode")?n.attr("data-colorcode"):"",o=a.parent().parent();if(o.addClass("colorEnabledPicklist"),$("#"+s).remove(),"-None-"===n.val()||""===n.val())o.addClass("colorEnabledPKNone");else o.removeClass("colorEnabledPKNone"),$('<span class="dIB activitesColor" data-zcqa="validationaction_colorcode_'+a.data("fieldid")+'" id="'+s+'" style="background:'+$ESAPI.encoder().encodeForHTMLAttribute(r)+'"></span>').insertBefore(a)}}function lookUp(e,t,a,i){if(i)var l=i.target,s=$(l).closest("form")[0].name;else s=void 0;var n=getElm(s,"modsel"),r=n.options[n.options.selectedIndex].value;if(Crm.userDetails.isLookupAdvancedSearchEnabled&&"ownername"!=r){var o=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);o=o.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM));var d=[];Crm.userDetails.RTL_ENABLED&&(d=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));var c=o.concat(d);Lyte.injectResources(c,void 0,(function(){var e={};e.lookupModule=r,e.module=r,e.labelName="modname",e.searchModule=r,e.linkingmodule=void 0,e.parentModule="Calls",e.fieldid=$("#_modSel").data("fieldid").split("_")[1];var t=document.getElementById("lookupListPopup"),a=$("#modname");if(a.data("module",e.module),!t){var i=a.closest("div.labelValCreate"),l=document.createElement("crm-entity-lookup");l.component.setData("reqData",{}),i.append(l),t=document.getElementById("lookupListPopup")}var s=$("crm-entity-lookup")[0].component;s.layersAnalystAgent(s,!1,e,!1,!0)}))}else newShowLookUp("modname","modid",r,r,e,a,"leContModId",void 0,void 0,void 0,void 0,void 0,void 0,void 0,i)}function leContModLookUp(e,t,a,i){$("#quick_module").val(),$("#ctinotifier.taskpop").is(":visible");if(i)var l=i.target,s=$(l).closest("form")[0].name;else s=$("[name^=createEntityForm]")[0].name;var n=$("input[id*='leContModSel']"),r=document.getElementById("iskanbanview");if(r&&"true"===r.value){if(void 0===(o=n[0]))var o=$("[name='"+s+"'] [id='leContModSel']")[0]}else o=$("[name='"+s+"'] [id='leContModSel']")[0];var d,c="";if(getElm(s,"property(modsel)")&&"Accounts"==getElm(s,"property(modsel)").value&&null!=getElm(s,"property(modid)")&&(c="modid"),r&&"true"===r.value&&"hidden"===o.type&&(d=o.value),"select-one"==o.type?d=o.options[o.options.selectedIndex].value:"radio"==o.type&&(r&&"true"===r.value?void 0===(o=n)&&(o=document[s].elements["property(leContModSel)"]):o=document[s].elements["property(leContModSel)"],d=o[0].checked?o[0].value:o[1].value),Crm.userDetails.isLookupAdvancedSearchEnabled&&"ownername"!=d){var m=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);m=m.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM));var u=[];Crm.userDetails.RTL_ENABLED&&(u=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));var p=m.concat(u),g={};c&&(g.productFldId=c),g.lookupModule=d,g.labelName="leContModName",g.labelId="leContModId",g.linkingmodule=void 0,g.parentModule="Calls",g.fieldid=$("#_modSel").data("fieldid").split("_")[1],Lyte.injectResources(p,void 0,(function(){"Leads"===d?(g.module="Leads",g.searchModule="Leads"):"Contacts"==d&&(g.module="Contacts",g.searchModule="Contacts");var e=$("#leContModName");e.data("module",g.module);var t=document.getElementById("lookupListPopup");if(!t){var a=e.closest("div.labelValCreate"),i=document.createElement("crm-entity-lookup");i.component.setData("reqData",{}),a.append(i),t=document.getElementById("lookupListPopup")}var l=$("crm-entity-lookup")[0].component;$("#qCreate").is(":visible"),Crm.isFromSalesInbox;l.layersAnalystAgent(l,!1,g,!1,!0)}))}else newShowLookUp("leContModName","leContModId",d,d,"",a,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i),document[s].elements["property(module)"]&&(document[s].elements["property(module)"].value=d)}function showTaskType(e,t,a,i,l,s){if(Crm.userDetails.isLookupAdvancedSearchEnabled){var n=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crm-picklist-lookup.js","crux-lookupfilter-component.js","crux-column-list.js"],ResourceConstants.CRMClient);n=n.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],ResourceConstants.CRM));var r=[];Crm.userDetails.RTL_ENABLED&&(r=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],ResourceConstants.CRMClient));var o=n.concat(r);Lyte.injectResources(o,void 0,(function(){var a={};a.lookupModule=t,a.module=$('input[name="searchModule"]').val(),a.labelName=e,a.searchModule=t,a.linkingmodule=void 0,a.parentModule="Tasks";var i=$("#task_subject");a.fieldid=i.data("fieldid").split("_")[1];var l=document.getElementById("lookupListPopup");if(!l){var s=$("#leContModName"),n=s.length>0?s.closest("div.labelValCreate"):i.closest("div.labelValCreate"),r=document.createElement("crm-entity-lookup");r.component.setData("reqData",{}),n.append(r),l=document.getElementById("lookupListPopup")}var o=$("crm-entity-lookup")[0].component;o.layersAnalystAgent(o,!1,a,!1,!0)}))}else{var d=s.target,c=$(d).closest("form")[0].name,m=(getObj(e),Crm.getCrmBasePath()+"/Search.do?targetForm="+c+"&searchmodule="+t+"&fldName="+e+"&openInAdvSearch=false");commonUtils.openCustomLookup(m,void 0,"topBandPopup",renderingUtils.windowWidth-300)}}function populatePicklist(e,t,a){var i=$(e).data("module");"setup"===window[i].currentStatus&&crmTemplate.setDependentFields(i,"setup");var l=$(e).data("mapval");if(l){if($(e).data("colorcode_enabled")){var s=[],n=$(e).data("picklistmap");void 0===n&&(n=$(e).data("mapval"));for(var r=l.length,o=0;o<r;o++){var d=getPickListColorCode(l[o],n);void 0!==l[o].html?(l[o].colorCode||(l[o].colorCode=d),s.push(l[o])):s.push({content:l[o],colorCode:d})}l=s}}else(l=$(e).data("picklistmap"))&&Crm.isValidJSON(l)||(l=$(e).data("values"));"STAGE"==$(e).data("colname")&&"Potentials"==$(e).data("module")&&$(e).data("currentstatus")&&"ajaxEdit"==$(e).data("currentstatus")&&(l=detailView.getStageValues($(e).data("values")));var c=l;if(t){var m=$(e).data("colorcode_enabled")&&l&&"Array"===l.constructor.name;"Object"===c[0].constructor.name?c=$(e).data("values"):m=!1;var u=[];const a=26===$(e).data("uitype");t=t.filter((function(e){if(a)return c.find((t=>e.value===t.value));var t=c.indexOf(e);return m&&-1!==t&&l.filter((function(t){return(t.uservalue===e||t.content===e||t.value===e)&&(u.push(t),!0)})),-1!==t})),l=t,u.length>0&&(l=u)}if($(e).hasClass("dataPopulated"))return;for(var p=[],g=0;g<$(e)[0].options.length;g++)$(e)[0].options[g].selected&&(p[g]=$(e)[0].options[g].value);$(e).empty();const v=$(e).attr("cscript_criteria");var h;v&&(h=CriteriaHandler.generic_filter(l.map((e=>({id:e.oldvalue||e.optionId||e}))),v,new Set(["id"])).map((e=>e.id)));var f=$("<option></option>");for(o=0;o<l.length;o++)if(void 0!==l[o]&&!(h&&l[o].optionId&&-1===h.indexOf(l[o].optionId)||h&&l[o].oldvalue&&-1===h.indexOf(l[o].oldvalue))){var C=f.clone(),y="";l[o].uservalue&&"-None-"!==l[o].uservalue?y=l[o].uservalue:!l[o].value&&0!=l[o].value||"-None-"===l[o].value?l[o].content&&"-None-"!=l[o].content?y=l[o].content:l[o].html&&"-None-"!=l[o].html?y=l[o].html:"-None-"!=l[o]&&"object"!=typeof l[o]&&(y=l[o]):y=l[o].value,C.attr({value:y,"data-colorcode":l[o].colorCode,"data-fcCategory":l[o].fcCategory,"data-fctype":l[o].fctype});var b=$(e).attr("cscript-tag");b&&l[o].oldvalue&&C.attr("cscript-tag",b+"_"+l[o].oldvalue);var w="";"object"!=typeof(w=l[o].html?l[o].html:l[o].content?l[o].content:l[o].uservalue?l[o].uservalue:l[o])&&(e[0]&&"Crm_Potentials_STAGE"===e[0].id&&C.attr("id","Crm_Stage"+w),C.text(w),$(e).append(C))}for(var I=0;I<p.length;I++)$(e).find('option[value="'+$.escapeSelector(p[I])+'"]').prop("selected",!0),e[0]&&"Crm_Potentials_STAGE"===e[0].id&&p[I]&&e.find('option[id="Crm_Stage'+$.escapeSelector(Crm.getDealsStageValue(p[I]))+'"]').prop("selected",!0);thirdPartyUtils.bindSelect2($(e),{show:!0}),a||t||($(e).addClass("dataPopulated"),setTimeout((function(){e.select2("open")}),1))}function handleButton(e,t,a,i){if(13==t.keyCode){if(void 0===i||"true"!==i)if("undefined"!=typeof customViewObject&&customViewObject.doMassActioninScheduler);else document.activeElement.blur(),getObj(e).click();return!0}if(27==t.keyCode&&globaltextareapanid){if(e.includes("IMAGEATTACHMENT")&&$L("#"+globaltextareapanid+"_cancel").closest(".labelValTwo").find("crux-image-component lyte-modal").hasClass("lyteModalOpened"))return!0;$("#"+globaltextareapanid+"_cancel")[0].click()}return!0}function loadTimeBasedActions(e,t,a,i){if(i=i||"upcmng_actn",!TBALoading){var l=new getHTTPObject;l.open("GET",Crm.getCrmBasePath()+"/TimeTrigger.do?step=getTimeBasedActions&id="+t+"&pageNum="+e+"&module="+a,!0),l.onreadystatechange=function(){if(4==l.readyState){if(l.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(l);var t=getElemById("mrTBADIV");t&&($(t).empty(),t.parentNode.removeChild(t)),TBAPageNum=e;var a=l.responseText.trim();if(null!=typeof e&&1==e){var s=getElemById(i);null!=s&&($(s).empty(),s.innerHTML=a)}else{var n=getElemById("TBADIV").innerHTML+a;$("#TBADIV").empty(),getElemById("TBADIV").innerHTML=n,getElemById(i).style.display="block"}var r=$("#noupcomingaction").length>0,o=$(".upcomingActionsDivEle");if(r){if(noMoreTBActions=!0,o.addClass("noDataFountDetail"),Crm.userDetails.isRelatedListLyteEnabled&&o.removeClass("mT15"),!isTimeBasedActionSupported(Crm.userDetails.LICENSE_TYPE)){var d=$("#upcomingActionsDiv");d.hide(),d.prev().hide()}}else o.removeClass("noDataFountDetail"),Crm.userDetails.isRelatedListLyteEnabled&&o.addClass("mT15");getElemById("plstact_d").style.display="none",getElemById("mrlalnk_d").style.display="none",TBALoading=!1}},TBALoading=!0,l.send(null)}}function moreAction(e,t){hideMenu(t);var a="actionMenu";"moreAct1"==e.id?a="actionMenu1":"moreActForScheduler"==e.id&&(a="actionMenuForScheduler",$("#actionMenuForScheduler").css({display:"",visibility:"visible"})),Crm.menu.createMenu(t,a),$("#"+a).on("onBeforeShow",(function(t,a){var i=renderingUtils.getTargetElem(a);selectfieldtoupdate=I18n.getMsg("crm.module.mass.update"),i.parentNode.className="clickDropDown";if("moreAct"===e.id&&""!==getObj("listviewButtonLayerDiv").style.position){document.getElementById("show").offsetLeft;$L(window).scrollTop()}else;this.style.left="0px",this.style.top=$(e).outerHeight()+"px"})).on("onBeforeClose",(function(e,t){$(this).off("onBeforeClose").off("onBeforeShow");var a=this;do{a=a.previousSibling}while(a&&1!==a.nodeType);a.className="normalDropDown"})),$(e).hasClass("showAct")&&$(e).addClass("borAct")}function showAll(){document.getElementById("advSearchEnable")&&(advSearchEnableVal=document.getElementById("advSearchEnable").value),document.showcvdetails.rangeValue.value=getObj("rangeValue").value,document.showcvdetails.searchletter.value="";var e=commonUtils.formData2QueryString(document.showcvdetails),t=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?module="+getObj("module").value+"&isload=false";ajaxNew(t,e)}function alphaSearch(e,t){if(document.getElementById("advSearchEnable")&&(advSearchEnableVal=document.getElementById("advSearchEnable").value),"recordHistory"==t){document.showcvdetails.searchletter.value=e;var a=commonUtils.formData2QueryString(document.showcvdetails);a="module="+getObj("module").value+"&isload=false&"+a,""==e&&(e="all"),putInHistory("alphaSearch_"+e,"ShowSelectedCustomView|?"+a)}else{document.showcvdetails.searchletter.value=e;a=commonUtils.formData2QueryString(document.showcvdetails);var i=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?module="+getObj("module").value+"&isload=false";ajaxNew(i,a)}}function selectAll(e){if(null==e&&getObj("fixedSelectAll")&&(document.showcvdetails.fixedSelectAll.checked=document.showcvdetails.allcheck.checked),null!=document.showcvdetails.chk){noofentries=document.showcvdetails.chk.length,checkstatus=document.showcvdetails.allcheck.checked;var t="",a="",l="",s="";for(null==noofentries&&(document.showcvdetails.chk.checked=checkstatus,t=document.showcvdetails.chk,l=$(t).parent().parent().children("td"),s=t.parentNode.parentNode,checkstatus?(s.style.backgroundColor="#FFFBE2",l.addClass("rowSelTd")):(s.style.backgroundColor="",l.removeClass("rowSelTd"))),i=0;i<noofentries;i++)t=document.showcvdetails.chk[i],a="true"==$(t).closest("tr").attr("lockedrecord"),t.disabled||(t.checked=checkstatus,checkstatus?(s.style.backgroundColor="#FFFBE2",l.addClass("rowSelTd")):(s.style.backgroundColor="",l.removeClass("rowSelTd"))),a&&(s.style.backgroundColor="#FFFBE2",l.addClass("rowSelTd"));editObj=document.getElementById("cvEdit"),editObj&&(1==noofentries&&(editObj.disabled=!1),noofentries>1&&(editObj.disabled=!0))}showHideListViewBtnFn()}function deSelectAll(){if(null!=document.showcvdetails&&null!=document.showcvdetails.chk)for(noofentries=document.showcvdetails.chk.length,null==noofentries&&(document.showcvdetails.chk.checked=!1),i=0;i<noofentries;i++)document.showcvdetails.chk[i].checked=!1}function toggleCheckBox(e){(chkedLen=0,state=e.checked,noofentries=document.showcvdetails.chk.length,null==noofentries)&&(null!=document.showcvdetails.chk&&(document.showcvdetails.allcheck.checked=!0));var t=e.parentNode.parentNode;if(state?t.style.backgroundColor="#FFFBE2":t.style.backgroundColor="",locked_record="true"==$(e).closest("tr").attr("lockedrecord"),locked_record&&(t.style.backgroundColor="#FFFBE2"),0==state)document.showcvdetails.allcheck.checked=!1;else if(null!=noofentries){var a=!1;for(i=0;i<noofentries;i++)if(0==document.showcvdetails.chk[i].checked){document.showcvdetails.allcheck.checked=!1,a=!0;break}0==a&&(document.showcvdetails.allcheck.checked=!0)}for(var l=0;l<noofentries;l++)document.showcvdetails.chk[l].checked&&chkedLen++;editObj=document.getElementById("cvEdit"),editObj&&(1==chkedLen&&(editObj.disabled=!1),chkedLen>1&&(editObj.disabled=!0)),getObj("fixedSelectAll")&&(document.showcvdetails.fixedSelectAll.checked=document.showcvdetails.allcheck.checked)}function deleteEntity(e,t,a){deleteActivity()&&deleteAction(Crm.getCrmBasePath()+"/MassDelete.do?module="+e+"&id="+t+"&customviewname="+a)}function deleteActivity(){var e=I18n.getMsg("confirmmsg");return!!window.confirm(e)}function tabAction(e,t,a){hideEditionTrialPopup();var i="tab_"+t;if(a)document.location.href=e;else if(-1!=$.inArray(t,["Reports","Documents","Dashboards","Emails","Chat","Pulse","Google Adwords","Social"])||!getObj("show")||getObj("setupshow")||getObj("externalIframe"))if("Emails"==t&&-1==jQuery.inArray("mail",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){document.location.href=Crm.getCrmBasePath()+"/tab/Emails?quickcreate=true"}),"mail")}else document.location.href=e;else{if(e+="&isload=false",showCacheObj.hasOwnProperty(i)||Crm.CURRENT_REQUEST.module!=t){var l={module:t,url:e};Crm.CURRENT_REQUEST=l;var s=function(e){Crm.CURRENT_REQUEST={}};getObj("san")||getObj("otherCVblankScreen")||-1==$.inArray(t,["Leads","Contacts","Accounts","Potentials"])?ajaxNew(e,"",s):showCacheAjaxNew(e,t,s)}$L(window).scrollTo(0,0),getObj("menu").style.display="none",currCVMod=t,currCVId=""}return!1}function isRelatedRecordsModule(e){return"Attachments"!==e&&"Notes"!=e&&"Solutions"!==e&&"PriceBooks"!==e&&"Tasks"!==e&&"Events"!==e&&"Calls"!==e&&"Activities"!==e&&"Emails"!==e&&"Competitors"!==e&&"CheckIns"!==e&&"Visits"!==e&&"Appointments"!==e}function getRelatedChildModules(e){switch(e){case"Leads":case"Contacts":return["Activities","Visits"];case"Accounts":return["Activities","Contacts","Potentials","Quotes","SalesOrders","Invoices","Cases"];case"Potentials":return["Cases","Activities"];case"Campaigns":case"Cases":case"Vendors":case"Quotes":case"SalesOrders":case"PurchaseOrders":case"Invoices":return["Activities"];case"Products":return["Activities","Solutions","Cases"];case"Services":return moduleRecordMapping.CalendarBookings&&moduleRecordMapping.CalendarBookings.module_name?["Appointments",moduleRecordMapping.CalendarBookings.module_name]:["Appointments"];default:if(e.includes("CustomModule")||e.includes("LinkingModule"))return["Activities"]}}function getAllRelatedChildModulesPluralLabel(e){var t=getRelatedChildModules(e),a="";if(void 0!==t&&(t=getNewRelatedChildModules(e,t)),t)for(var i=t.length,l=0;l<i;l++){var s=t[l];moduleRecordMapping[s]&&(a=0!=a.length?a.concat(", ").concat(moduleRecordMapping[s].plural_label):a.concat(moduleRecordMapping[s].plural_label))}return a="crm.email.label.emaildrafts"===I18n.getMsg("crm.email.label.emaildrafts")?a.concat(", ").concat(I18n.getMsg("crm.label.drafts")):a.concat(", ").concat(I18n.getMsg("crm.email.label.emaildrafts"))}function getNewRelatedChildModules(e,t){return new RegExp("Contacts|CustomModule[0-9]{1,3}$").test(e)&&moduleRecordMapping.Appointments&&"default"===moduleRecordMapping[e].generated_type&&(t=t.concat(["Appointments"])),t}function submitForm(e,t,a){var i=getObj("module")?getObj("module").value:"",l=!0;getObj("ajaxRequest")&&(l=!1),e.OnSelect.value="true";var s,n=getObj("currentOption").value;if(getObj("rangeValue").value=n,a&&"currentOption"===a.id&&"viewPipeline"===$(e).find('input[name="actiontype"]').val()&&n&&!isNaN(parseInt(n))&&localStorage.setItem("rangeValueForPipeline",n),cntElem=getObj("navCount"),navCount=1,null!=cntElem&&(navCount=parseInt(cntElem.value)),void 0===t&&clearShowCacheObj("tab_"+i),""!=i&&l){var r=commonUtils.formData2QueryString(e),o=Crm.getCrmBasePath()+"/NavigateByRecords.do";return"next"==t?r+="&next.x=true":"previous"==t&&(r+="&previous.x=true"),"AssignmentRuleForm"==e.name?(Territory.doUpdateForm("result",r,"","",o),!1):"TransferWizardForm"==e.name?(getObj("massResult")?Territory.doUpdateForm("massResult",r,"","",o):Territory.doUpdateForm("show",r,"","",o),!1):(ajaxNew(o,r),!1)}"next"==t?(navCount+=1,getObj("navCount")&&(getObj("navCount").value=navCount),s=Crm.getCrmBasePath()+"/NavigateByRecords.do?next.x=true"):s="previous"==t?Crm.getCrmBasePath()+"/NavigateByRecords.do?previous.x=true":Crm.getCrmBasePath()+"/NavigateByRecords.do",mR(s,(function(e){e.indexOf("No tasks are assigned to you")>-1?alert(I18n.getMsg("crm.new.label.no.records")):replaceTaskDiv(e)}),$("[name=showhome]").serializeArray())}function findMap(e,t,a){var i;i=null==Crm.baiduAvailable||"true"!=Crm.baiduAvailable||null==Crm.baiduUrl||"China"!=RebrandLinkUtil.getProperty("DeploymentLocation")&&"skyDesk"!=Crm.brandName&&"Baidu"!=t?httpprotocol+"maps.google.com/maps?q="+e:"location"==a?Crm.baiduUrl+"?location="+e+"&coord_type=wgs84&output=html":Crm.baiduUrl+"?address="+e+"&output=html",window.open(i)}function enableSkype(){}function showSheet(e,t){if(commonUtils.showHideLoadingDiv(!0),"undefined"!=typeof usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("sheet",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){showSheet(e)}),"sheet")}else if(http){var a=$L("#previous_sort_column")[0];a&&(e=e+"&sortColumnString="+encodeURIComponent(a.value)+"&sortOrderString="+a.value),commonUtils.showHideLoadingDiv(!0),http.open("POST",e,!1),http.setRequestHeader("X-ZCSRF-TOKEN",csrfParamName+"="+csrfToken),http.onreadystatechange=function(){if(4==http.readyState){var t=http.responseText;if(commonUtils.showHideLoadingDiv(),http.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(http);if(t.indexOf("Error")>-1)return void openSheetError(t.split("Error::")[1]);if(t.indexOf("||")<0)return void openSheetError(I18n.getMsg("crm.alert.generalError"));var a=t.split("||")[1];openSheet(e,a)}commonUtils.showHideLoadingDiv()},http.send(t)}}function openSheetError(e){var t=document.getElementById("sheetTips");t.style.display="block",t.style.zIndex=30,$("#sheetTips").empty(),crmui.showPopup("sheetTips");var a=document.createElement("div");a.setAttribute("class","crm-subheading-font-size"),a.setAttribute("id","sheetErrorDiv"),t.appendChild(a);var i=document.getElementById("sheetErrorDiv");$("#sheetErrorDiv").empty(),i.innerHTML=e;var l=document.createElement("input");l.setAttribute("type","button"),l.setAttribute("value","Close"),l.setAttribute("name","sheetcancel"),l.setAttribute("id","sheetcancel"),l.setAttribute("class","newwhitebtn");var s=document.createElement("div");s.setAttribute("class","mT15"),i.appendChild(s),i.appendChild(s),i.appendChild(l),document.getElementById("sheetcancel").onclick=function(){crmui.hidePopup("sheetTips")}}function openSheet(e,t){getObj("isSheetOpen")&&getObj("isSheetOpen").checked&&cookieUtils.setCookie("isSheetOpen","true"),closeDashletDiv("sheetTips");var a=document.getElementById("FreezeLayer");a&&document.body.removeChild(a),null!=t&&(winObj=window.open(t))}function showHideGTask(){var e=getObj("viewdiv")&&"crm-subheading-font-size dN"==getObj("viewdiv").className?"crm-subheading-font-size":"crm-subheading-font-size dN";getObj("viewdiv").className=e;var t=getObj("viewtab")&&"bdrT_Dash mT5 dN"==getObj("viewtab").className?"bdrT_Dash mT5":"bdrT_Dash mT5 dN";getObj("viewtab").className=t;var a=getObj("editdiv")&&"crm-subheading-font-size dN"==getObj("editdiv").className?"crm-subheading-font-size":"crm-subheading-font-size dN";getObj("editdiv").className=a;var i=getObj("edittab")&&"bdrT_Dash mT5 dN"==getObj("edittab").className?"bdrT_Dash mT5":"bdrT_Dash mT5 dN";getObj("edittab").className=i}function selectAllGAppUsers(){if(document.gappUsersForm.userChk){var e=document.gappUsersForm.userChk.length,t=document.gappUsersForm.allcheck.checked;if(null==e)document.gappUsersForm.userChk.checked=t;else for(var a=0;a<e;a++)document.gappUsersForm.userChk[a].checked=t}}function importGAppUsers(e){var t=Crm.getCrmBasePath()+"/GApps.do?mode=importGUsers",a=document.gappUsersForm.userChk.length,i="";if(null==a)document.gappUsersForm.userChk.checked&&(i=document.gappUsersForm.userChk.value);else for(var l=0;l<a;l++)document.gappUsersForm.userChk[l].checked&&(i=""==i?document.gappUsersForm.userChk[l].value:i+","+document.gappUsersForm.userChk[l].value);if(""==i)alert(e);else{document.gappUsersForm.selUsers.value=i;var s=commonUtils.formData2QueryString(document.gappUsersForm)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(!0),mR(t,(function(e){commonUtils.showHideLoadingDiv();var t=document.getElementById("nextStepDiv");t.style.display="block",t.style.zIndex=600,t.style.position="absolute",mailsetCenter("nextStepDiv")}),s)}}function closeGadgets(){getObj("mainGadgetsDiv").style.display="none",renderingUtils.removeFreezeLayer()}function showGadgetsMenu(e,t,a,i,l,s){var n=document.getElementById("gadgetsMenu"),r=getObj(a).offsetHeight,o=$("#"+a).offset().top,d="<a href=\"javascript:openCRMGadGets('"+e+"','"+t+'\');"><img border="0" src="/images/webpageIcon.gif"> &nbsp;'+i+"</a><a href=\"javascript:openEGadgets('google','"+e+'\')"><img border="0" src="/images/igBigIcon.gif"> &nbsp;'+l+"</a><a href=\"javascript:openEGadgets('orkut','"+e+'\')"><img border="0" src="/images/orkutBigIcon.gif"> &nbsp;'+s+"</a>";n.style.display="block",$("#gadgetsMenu").empty(),n.innerHTML=d,n.style.left=renderingUtils.findPosX(getObj(a))+"px",n.style.top=o+r+"px"}function opensocialPopup(e,t){var a=document.getElementById("opensocial"),i=document.getElementById("lookupdiv");if("block"==i.style.display)i.style.display="none";else{renderingUtils.freezeBackground(),$("#lookupdiv").empty(),i.style.display="block",i.style.zIndex="21",i.style.left="0px",i.style.top="0px",i.style.width="690px",i.style.height="530px";var l="<p>"+t+':</p> <input type="text" size="80" value="'+"http://hosting.gmodules.com/ig/gadgets/file/112646789256826398286/ZohoCRM"+e+'.xml"/>';$("#openSocialBlock").empty(),document.getElementById("openSocialBlock").innerHTML=l;var s="<a href='javascript:;'>http://hosting.gmodules.com/ig/gadgets/file/112646789256826398286/ZohoCRM"+e+".xml</a><br>";s=s+'<img width="580" src="/images/Gadgets'+e+'.gif"/></td>',$("#gadgetsModule").empty(),document.getElementById("gadgetsModule").innerHTML=s,i.innerHTML=a.innerHTML,mailsetCenter("lookupdiv")}}function showTotalCount(e,t,a,i){I18n.getMsg("loading");customViewObject.doMassActioninScheduler||null!=a||$(e).find("span").html('<img src="'+networkUtils.getImageUrl("moreloading1_lightmode.gif",ResourceConstants.CRM)+'" border="0" class="mL10 w16 h16" data-image-mode="true">');var l=crmListView.getObject()?crmListView.getObject().cvId:getObj("cvid").value,s=crmListView.getObject()?crmListView.getObject().module:getObj("module").value;customViewObject.isPrivacyListView&&(s=s.replace("privacy_",""));var n=customViewObject.singularModName;if(!a||l&&s&&"null"!==l&&"undefined"!==l&&"null"!==s&&"undefined"!==s){var r=Crm.getCrmBasePath()+"/RecordsCount.do?step=step2&cvId="+l+"&module="+s;if($("#territoryDropDown")[0]){var o=moduleRecordMapping[s].territory;r+=o?"&territoryId="+o.id+"&includechild="+(o.subordinates?1:0):""}if((customViewObject.isStageView&&1==customViewObject.isStageView||customViewObject.isPredictView&&1==customViewObject.isPredictView)&&customViewObject.layoutId&&"0"!=customViewObject.layoutId&&(r+="&layoutId="+customViewObject.layoutId),"Visits"==s){var d=crmListView.getObject().screenName,c=crmListView.getObject().portalName;r+="All Portals"!=d?"&portalName="+c+"&allPortals=false":"&allPortals=true"}if(customViewObject.selectAllInCurrentView&&customViewObject.doMassActioninScheduler&&(r+="&isMassJob="+customViewObject.doMassActioninScheduler),null!=a){r+="&fetchAllFilterCount="+(a=!1);var m=crmListView.getObject().filterId;m&&(r+="&filterId="+m)}var u={};customViewObject.isPrivacyListView&&(u.isPrivacyListView=!0,u.privacyDetails=JSON.stringify(customViewObject.privacyDetails)),customViewObject.isCampaignAddMemberListView&&(u.isCampaignAddMemberListView=!0,u.campaignId=detailView.entityId),u[csrfParamName]=encodeURIComponent(csrfToken),$("#dataRange").val()&&(u.dataRange=$("#dataRange").val()),customViewObject.isPredictView&&(u.predictionView=!0);var p=Lyte.Router.getRouteInstance();if("kanban"==p.routeName||"canvas"==p.routeName||"zia"==p.routeName){var g=crmTab.getFromCache(s);if((g.filters||g.cross_filters)&&(u.isNewFilter=!0,u.filters=g.filters?JSON.stringify(g.filters):void 0,u.cross_filters=g.cross_filters?JSON.stringify(g.cross_filters):void 0),g.filter_id){var v=store.peekRecord("filter",g.filter_id);(v.criteria||v.cross_filters)&&(u.isNewFilter=!0,u.filters=v.criteria?JSON.stringify(v.criteria):void 0,u.cross_filters=v.cross_filters?JSON.stringify(v.cross_filters):void 0)}customViewObject.searchletter&&"All"!=customViewObject.searchletter&&(u.searchletter=customViewObject.searchletter)}else crmListView.getAdvSearchCrtFromCVObject(u);"canvas"==p.routeName&&u.filters&&!u.isNewFilter&&(u.isNewFilter=!0),(new crmRequestPool).initiate({action:r,type:"POST",data:u,success:function(t){if("canvas"==p.routeName||"kanban"==p.routeName||"zia"==p.routeName){var l=$("crm-custom-filter")[0];if(p.getQueryParams().filter_id||l&&l.component.data.appliedFilterId&&!l.getData("isSaveFilter")&&l.getData("savedFilters").length){var r,o=(l=l.component).getData("savedFilters"),d=o.length,c=p.getQueryParams().filter_id?p.getQueryParams().filter_id:l.filter_id;for(r=0;r<d;r++)o[r].id==c&&(Lyte.objectUtils(customViewObject,"add","totalCount",t.TotalCount),Lyte.objectUtils(o[r],"add","count",t.TotalCount))}}if(null!=a){if(null==crmTab.countCache[s])customViewObject.isPrivacyListView||!crmTab.getFromCache(s)||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).isTotalcountCached=!0),crmListView.getObject().isTotalcountCached=!0,crmTab.countCache[s]=t;else{if(!i&&crmListView.getObject().fetchCountOnMismatch)return void crmListView.compareAndFetchCount(t,s);if(t.hasOwnProperty(customViewObject.filterId))return void crmListView.renderFilterCount(t,e,s);$.extend(crmTab.countCache[s],t)}crmListView.renderFilterCount(crmTab.countCache[s],e,s)}else{if(customViewObject.doMassActioninScheduler||($(e).find("span").html("<b>"+t+"</b>&nbsp;"),$(e).children().unwrap()),customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(customViewObject.totalCount=crmTab.getFromCache(s).totalCount=t),crmListView.getObject().totalCount=t,customViewObject.selectAllInCurrentView&&customViewObject.doMassActioninScheduler&&t>Crm.massOperationTotalLimit){customViewObject.doMassActioninScheduler=!1,customViewObject.showSelectAll=!1,$("#selectAllRecords").hide(),$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"});var m="<span id='maxLimitAlertMassOperation'>"+I18n.getMsg("crm.listview.maximum.records.alert",[Crm.massOperationTotalLimit])+"</span>";$("#selectAllRecords").parent().append(m)}customViewObject.doMassActioninScheduler&&t<=Crm.massOperationTotalLimit&&(t>1&&(n=customViewObject.pluralModName),$(".selCountNum").html(I18n.getMsg("crm.mass.actions.all.selected",[t,n])),showMassOperationsForScheduler(),overLayForSelectAllClick(!0)),customViewObject.doMassActioninScheduler||customViewObject.selectAllInCurrentView||$("html, body").animate({scrollTop:$(document).height()},50)}},error:function(e){a?$("#lv_saved_filters").find(".listTxtCount").hide():alert("Unable to process request")}})}}function handlePrivateEvent(e){if(getObj("userId")&&getObj("property(Private)")&&getObj("property(ownerId)")){var t=getObj("userId").value,a=getObj("property(ownerId)").value;getObj("property(Private)").disabled=t!=a,e&&(getObj("property(Private)").checked=!1)}}function EntSendMail(e,t,a,i,l,s,n,r,o,d,c,m,u){EmailSendingUtil.callbackFn=m,EmailSendingUtil.view=a;var p=$("email-summary"),g=$("#scheduledMails"),v=$("#draftMails");if(p.hasClass("hide")||hideEmailSummaryDiv(),Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup("mailAlert");else{if("true"===s){if(null!=$("#surveyLinkQuery").val()&&""==$("#surveyLinkQuery").val())return alert(I18n.getMsg("crm.zsurvey.alert.mesg")),!1;ZSurvey.cancelPopup("lookupdiv")}var h=e,f=t;if(e=null==e?$("#module").val():e,i=null==i?moduleRecordMapping[e].singular_label:i,EmailSendingUtil.entityId=t,"Potentials"==e&&getObj("contId")&&"null"!=getObj("contId").value)$("#zmailEmail").length>0?$("#zmailEmail").val():"";else if("Accounts"==e){var C=$("#contactSelDropdownInAcc :selected"),y=$L("crm-email-rl-filter"),b=y.length>0;if(0===C.length&&"listview"!==a&&!EmailComposeUtil.sendMailButtonCalled&&b&&Crm.userDetails.isEmailsForModuleEnabled){var w=y.length>0?y[0].component.data:void 0;if("ACCOUNTS_ALL"===(L=v.hasClass("selectTab")?$("#accountsDrafts").attr("lt-prop-selected"):g.hasClass("selectTab")?$("#accountsScheduled").attr("lt-prop-selected"):$("#contactSelDropdownInAcc").attr("lt-prop-selected")))h=e,f=t;else h="Contacts",f=void 0!==(I=document.querySelector(`lyte-drop-item[data-value="${L}"]`))?I.getAttribute("data-value"):I,void 0===(void 0!==I?I.getAttribute("data-email"):I)&&w&&w.contactPrimaryEmails[f]&&w.contactPrimaryEmails[f]}else if(Crm.userDetails.isEmailsForModuleEnabled)Crm.userDetails.isEmailsForModuleEnabled&&"listview"===a&&(h=e,f=t);else if(h="Contacts",0==C.length){var I,L=v.hasClass("selectTab")?$("#accountsDrafts").attr("lt-prop-selected"):g.hasClass("selectTab")?$("#accountsScheduled").attr("lt-prop-selected"):$("#contactSelDropdownInAcc").attr("lt-prop-selected");f=null!=(I=$(document.querySelector('lyte-drop-item[data-value="'+L+'"]')))?I.data().value:I,null!=I?I.data().email:I}else f=C.attr("value"),C.attr("email")}var A=Crm.getCrmBasePath()+"/mailer/EntReply.do",E="action=openComposeWindow&entType="+h+"&entityId="+f;if(void 0===a||"consentView"!==a&&"Export"!==a&&"Rectify"!==a&&"Access"!==a)s&&"Cases"===h&&!Crm.userDetails.isEmailsForCasesModuleEnabled&&(E+="&from=sendsurvey"),EmailSendingUtil.isConsentEmail=!1,EmailSendingUtil.dataReqObj=void 0;else if(E=E+"&from="+a,"consentView"!==a&&Crm.userDetails.isNewEditor){EmailLaunchUtil.privacyPolicyDetails={};var S={};S.type=a.toLowerCase(),S.id=r,EmailLaunchUtil.privacyPolicyDetails.dataReqObj=S,EmailLaunchUtil.privacyPolicyDetails.isConsentEmail=!1}else Crm.userDetails.isNewEditor?(EmailLaunchUtil.privacyPolicyDetails={},EmailLaunchUtil.privacyPolicyDetails.isConsentEmail=!0):EmailSendingUtil.isConsentEmail=!0;EmailSendingUtil.optOutModule=h,EmailSendingUtil.contactId=f;var R="";commonUtils.showHideLoadingDiv(!0),jQuery.ajax({type:"POST",url:A,data:E,success:function(m){commonUtils.showHideLoadingDiv(),R=m,EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.entityId=t},EmailSendingUtil.entDetails=u,launchEmailWindow(R,e,t,a,i,l,s,n,r,o,d,c),delete EmailSendingUtil.entDetails},error:function(){commonUtils.showHideLoadingDiv(),alert("Error Occurred! Please Try again.")}})}}function customAlertForMail(e,t){e?_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"cgsPhoneAlertWrapper",ltPropPrimaryMessage:t},close:function(){EmailCompose.hideGSearch()}}):renderingUtils.showCustomAlert(t)}function launchEmailWindow(e,t,a,i,l,s,n,r,o,d,c){var m=t,u=a,p=a,g=$("#isFromNewAPI"),v="",h="",f="",C=$("#scheduledMails"),y=$("#draftMails"),b=y.hasClass("selectTab")?$("#accountsDrafts").attr("lt-prop-selected"):C.hasClass("selectTab")?$("#accountsScheduled").attr("lt-prop-selected"):$("#contactSelDropdownInAcc").attr("lt-prop-selected"),w=void 0!==EmailSendingUtil.callbackFn;if("Accounts"===t)if($("crm-rl-users-list").length>0)p=y.hasClass("selectTab")?$("#accountsDrafts").attr("lt-prop-selected"):C.hasClass("selectTab")?$("#accountsScheduled").attr("lt-prop-selected"):$("#contactSelDropdownInAcc").attr("lt-prop-selected"),f=e;else{var I=$("#contactSelDropdownInAcc :selected");p=I.attr("value"),f=I.attr("email")}if(g.length>0){var L=$(".rLESelectAction");L.length>0&&"block"==L.css("display")&&$L(".ernLyteBody .ecnChkBoxtd lyte-checkbox").attr("lt-prop-checked",!1)}if(null!=store.peekRecord("emails_rl_user","shared_users_"+a)&&store.deleteRecord("emails_rl_user","emails_"+a),"1101"==e)return customAlertForMail(w,I18n.getMsg("crm.security.error")),!1;if("8011"==e)return customAlertForMail(w,I18n.getMsg("crm.priv.email.consent")),!1;if(e.indexOf("UNCONFIRMED_USER")>-1)return e=e.substring(16,e.length),$("#shownotes").addClass("newPopup p30"),$("#shownotes").html(e),getObj("shownotes").style.zIndex=21,getObj("shownotes").style.width="600px",getObj("shownotes").style.position="absolute",$("#shownotes input[type=button]").click((function(){renderingUtils.removeFreezeLayer(),$("#shownotes").html(""),$("#shownotes").hide()})),renderingUtils.freezeBackground(),$("#shownotes").show(),mailsetCenter("shownotes"),!1;if(e.indexOf("TRANSMAIL_BLOCKED_ERROR")>-1&&"Potentials"!==t){e=e.substring(23,e.length);var A="<div class='aligncenter crm-font-bold crm-heading-font-size' text-align:auto;'>";A+=I18n.getMsg("crm.bouncemail.heading"),A+="</div>",$("#emailalert").hide(),e="<div class='massMailstatscloseIcon cP' style='top:20px;right:20px' onclick=closealertMail('emailalert')></div><div class='aligncenter crm-font-regular crm-base-font-size mT20'>"+e+"</div> </div></div>",$("#emailalert").empty(),document.getElementById("emailalert").innerHTML=A+e;var E=parseInt($(".emailalert").css("margin-top"))-$("#wmstoolbar").outerHeight()-12;return $(".emailalert").css("margin-top",E),$("html,body").css("overflow","hidden"),mailsetCenter("emailalert"),$(".emailalert").css("max-height",$(window).height()-110),mailsetCenter("emailalert"),renderingUtils.freezeBackground(),$("#FreezeLayer").css("z-index","35"),!1}if("1003"===e&&"Potentials"!==t&&"Quotes"!==t&&"Cases"!==t&&"SalesOrders"!==t&&"PurchaseOrders"!==t&&"Invoices"!==t)return customAlertForMail(w,I18n.getMsg("crm.label.emailoptout.alert.message")),!1;if("2310"==e){var S=a,R="";if(Crm.userDetails.isNewEditor){if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),5e3),EmailSendingUtil.entityId=u,EmailSendingUtil.singularMod=l,EmailLaunchUtil.SendMailEvent(m,u,"listview")}else openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(R)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}else if("2309"==e&&"Potentials"!==t)w?_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.error.email.notfound"),ltPropPrimaryMessage:I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),ltPropContentAlign:"center"},close:function(){EmailCompose.hideGSearch()}}):renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),I18n.getMsg("crm.error.email.notfound"));else{if("8013"===e)return b&&"ACCOUNTS_ALL"!==b&&(t="Contacts"),_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.record.lock.mail",moduleRecordMapping[t].plural_label),ltPropContentAlign:"center"},close:function(){EmailCompose.hideGSearch()}}),!1;S=a;var T=document.getElementById("subvalue_EMAIL"),_=document.getElementById("subvalue_ADDN_EMAIL");EmailSendingUtil.entDetails&&!T&&EmailSendingUtil.entDetails.email&&(T=EmailSendingUtil.entDetails.email);var k=document.getElementById("iskanbanview");if("permissionAllowed"===e||EmailSendingUtil.switchedToOldWin||"salessignals"===i||"fromMap"===i||"listview"===i||"BestTimeMail"===i||null!==T&&""!==T.innerHTML||null!==_&&""!==_.innerHTML||!("Leads"===t||"Contacts"===t||t.length>11&&"CustomModule"===t.substring(0,12)||"LinkingModule"===t.substring(0,13))||k&&"true"===k.value){var M="";if(v=getObj("subvalue_EMAIL"),h=getObj("subvalue_ADDN_EMAIL"),EmailSendingUtil.entDetails)EmailSendingUtil.entDetails.email&&(M=EmailSendingUtil.entDetails.email.replace(/\s/g,""));else if("Accounts"!=t&&(v&&""!=v.innerHTML||h&&""!=h.innerHTML)){var O=v&&(v.classList&&v.classList.contains("cscriptMasked")?v.attributes.cscriptActualValue.value:v.innerText),P=h&&(h.classList&&h.classList.contains("cscriptMasked")?h.attributes.cscriptActualValue.value:h.innerText);if(v&&""!==v.innerHTML&&validationUtils.isValidEmail(O.replace(/\s/g,""))?(M=O.replace(/\s/g,""),h&&""!==h.innerHTML&&validationUtils.isValidEmail(P.replace(/\s/g,""))&&(M=M+","+P.replace(/\s/g,""))):h&&""!==h.innerHTML&&validationUtils.isValidEmail(P.replace(/\s/g,""))&&(M=P.replace(/\s/g,"")),!(""!=M&&null!=M||"Leads"!=t&&"Contacts"!=t))return void customAlertForMail(w,I18n.getMsg("crm.primary.secondary.no.valid.email",I18n.getMsg(l)));if("Potentials"==t&&!isEmailValidInAssocCont(getObj("associatedContName"),getObj("associatedContEmail")))return}else if("Accounts"===t&&"listview"!==i&&!EmailComposeUtil.sendMailButtonCalled){if(b&&"ACCOUNTS_ALL"!==b){t="Contacts";var D={module:"Accounts",id:S,name:"For_Accounts"};EmailComposeUtil.linkedModuleFromAccounts=D,M=f,S=p,u=p}m=t}if(EmailComposeUtil.sendMailButtonCalled=!1,"8013"===e)return b&&"ACCOUNTS_ALL"!==b&&(t="Contacts"),_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.record.lock.mail",moduleRecordMapping[t].plural_label),ltPropContentAlign:"center"},close:function(){EmailCompose.hideGSearch()}}),!1;if("listview"==i){var U=e;if(EmailComposeUtil.isContactEmailOptOut&&(U="permissionAllowed"),null!=U&&""!=U){R=null;if(U.indexOf(",")>-1)R=U.split(",")[0];else R=U;if("permissionAllowed"!==R&&!validationUtils.isValidEmail(R)&&"Potentials"!==t&&Crm.userDetails.isEmailsForModuleEnabled)return customAlertForMail(w,I18n.getMsg("crm.primary.no.valid.email")),!1;if(Crm.userDetails.isNewEditor){if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),5e3);EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.entityId=u,EmailSendingUtil.view=i,EmailSendingUtil.singularMod=l},!$("#addNewSign")[0]&&EmailComposeUtil.TEMP_TAB&&(EmailComposeUtil.CURRENT_TAB=EmailComposeUtil.TEMP_TAB),EmailLaunchUtil.SendMailEvent(m,u,i)}else{var F="/send-mail?action=compose";"Potentials"===t&&linkedContactId&&(F=F+"&linkedContactId="+linkedContactId),"true"===n?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+F+"&entEmail="+encodeURIComponent(U)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+F+"&entEmail="+encodeURIComponent(U)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),entreplyWin||customAlertForMail(w,I18n.getMsg("crm.label.popup.blocker",I18n.getMsg(t.substring(0,t.length-1))))}}else null==l&&(l=t),w?_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),ltPropPrimaryMessage:I18n.getMsg("crm.error.email.notfound"),ltPropContentAlign:"center"},close:function(){EmailCompose.hideGSearch()}}):renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),I18n.getMsg("crm.error.email.notfound"))}else if("fromMap"==i){R=null;null!=r&&validationUtils.isValidEmail(r.replace(/\s/g,""))?(R=r.replace(/\s/g,""),Crm.userDetails.isNewEditor?EmailLaunchUtil.SendMailEvent(m,u,i):openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(R)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")):customAlertForMail(w,I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel))}else if(getObj("unabletosendmail"))alert(I18n.getMsg("crm.zmail.passwordchange.alt",""));else if(getObj("currentUserTicketUnavailable"))renderingUtils.freezeBackground(),document.getElementById("alertDiv").style.zIndex="30",mailsetCenter("alertDiv");else if(Crm.userDetails.isNewEditor){var B;if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),5e3),"true"===n&&(B=EmailLaunchUtil.launchComposeMailWithSurvey),EmailLaunchUtil.SendMailEvent(m,u,i,B)}else{F="/send-mail?action=compose";document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value?"true"===s?"true"===n?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&isSendMail=true&entEmail="+encodeURIComponent(M)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&isSendMail=true&entEmail="+encodeURIComponent(M)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"true"===n?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(M)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):validationUtils.isNotEmpty(d)?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(M)+"&parentModule="+d),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(M)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):("true"===n?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"consentView"===i?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)+"&from=consentView"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"Export"===i||"Rectify"===i||"Access"===i?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)+"&from="+i+"&requestId="+o),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):validationUtils.isNotEmpty(d)?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)+"&parentModule="+d),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):c?openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)+"&bestTime="+c),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+S+"/send-mail?action=compose&entEmail="+encodeURIComponent(M)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),entreplyWin||alert(I18n.getMsg("crm.label.popup.blocker",I18n.getMsg(t.substring(0,t.length-1)))))}}else w?_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.email.compose.unableto.sendmailmsg"),ltPropPrimaryMessage:I18n.getMsg("crm.email.compose.unableto.sendmailheader"),ltPropContentAlign:"center"},close:function(){EmailCompose.hideGSearch()}}):renderingUtils.showCustomAlert(I18n.getMsg("crm.email.compose.unableto.sendmailmsg"),I18n.getMsg("crm.email.compose.unableto.sendmailheader"))}1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected($("#sendEntityMailLink"))}function closealertMail(e){hide(e),$(".freezelayer").hide(),renderingUtils.removeFreezeLayer(),$("html,body").css("overflow","auto"),EmailUtil.removeCustomFreezeLayer()}function searchDelAction(e,t){var a=csrfParamName+"="+encodeURIComponent(csrfToken);networkUtils.parseUrl(e).params;mR(e,(function(e){$(e).filter("#securityError").length?renderingUtils.displayPermissionDenied():($("#ajax_"+t).html(e),searchResultObj.searchResponse=getObj("show").innerHTML)}),a),hideAnimatePopup("deletepopup")}function showConvertQuoteMenu(e,t){t?$("#dropDownMenuCnt").css({left:"0px",display:"block",top:"32px",position:"absolute"}):$("#dropDownMenuCnt").css({left:renderingUtils.findPosX(e)+"px",display:"block",top:renderingUtils.findPosY(e)+e.offsetHeight+"px",position:"fixed"})}function cfAjax(e){commonUtils.showHideLoadingDiv(!0);var t=$(e).attr("action"),a=$(e).serialize();return $.ajax({type:"POST",url:t,data:a,success:function(e){if(commonUtils.showHideLoadingDiv(),$("#isFrom").length&&"pagelayout"==$("#isFrom").val()){"Events"==$("#modlist").val()?addnewFieldInEventLayout(e):createNewSortableField(e)}else{if(getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50});document.getElementById("FreezeLayer")&&renderingUtils.newcloseFreez("FreezeLayer"),$("#result").empty(),$("#result")[0].innerHTML=e,EvalInnerScript(getObj("result"))}return!1}}),!1}function createNewSortableField(e){try{var t="object"==typeof e?e:JSON.parse(e),a=t.fieldId,i=t.fieldLabel,l=t.sectionId,s=t.SCH_FOR_AUTONUM,n=$("#sectionId_"+l).attr("columncount"),r=$("<div  sysdefmandatory='false' class='detBlk'><span class='dotLine fL dIB vaM' alt=''></span><span class='fL'>Form Field</span></div>");if(r.attr("id","fieldId_"+a),r.find("span").html(i),1==n)$("#mainMatrix #sectionId_"+l+" .wid3h").append(r);else if(2==n){$("#mainMatrix #sectionId_"+l+" #odd").find("div").length<=$("#mainMatrix #sectionId_"+l+" #even").find("div").length?$("#mainMatrix #sectionId_"+l+" #odd").append(r):$("#mainMatrix #sectionId_"+l+" #even").append(r)}if(getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50});if(document.getElementById("FreezeLayer")&&renderingUtils.newcloseFreez("FreezeLayer"),cancelCF(),createsortables(),null!=s&&getObj("loadingDiv")){var o=getObj("loadingDiv");o.style.position="absolute",$("#loadingDiv").empty(),o.innerHTML=s,o.style.width="auto",o.className="successMsg",mailsetCenter("loadingDiv"),$("#loadingDiv").fadeIn().delay(3e3).fadeOut("slow")}}catch(t){$("#lookupdiv").html(e)}}function viewMailForSignal(e,t,a,i,l,s,n,r,o,d,c,m){if((null===d||d)&&Crm.userDetails.EMAIL_THREAD_VIEW)return c=c?"zia":"signals",void emailThreadViewForSignal(e,t,a,i,l,s,n,r,d,void 0,c,m);Crm.trackSpotLightAction("CRM Signals - View EMail Popup");var u="";u+=void 0===o?Crm.getCrmBasePath()+"/mailer/EntReply.do?action=viewMail&msgid="+e+"&user_id="+t+"&module="+a+"&entId="+i+"&mailType="+encodeURIComponent(l)+"&sentOrReceived="+s+"&entEmailId="+encodeURIComponent(n)+"&flag="+r:Crm.getCrmBasePath()+"/mailer/EntReply.do?action=viewMail&msgid="+e+"&user_id="+t+"&module="+a+"&entId="+i+"&mailType="+encodeURIComponent(l)+"&sentOrReceived="+s+"&entEmailId="+encodeURIComponent(n)+"&flag="+r+"&secondaryEmailId="+o,d&&(u+="&notificationId="+d),c&&(u+="&isZiaNotificationsView=true"),commonUtils.showHideLoadingDiv(!0);var p=csrfParamName+"="+encodeURIComponent(csrfToken);mR(u,(function(e){var t=$("#lookupdiv");commonUtils.showHideLoadingDiv(),$("#lookupdiv").addClass("p20");var a=$(document.createElement("iframe"));t.removeAttr("style"),a.attr({id:"emailDetailIframeContent",style:"opacity:1; width:100%; height:100%;clear: both; border: medium none",src:"/crm/html/content1.html"}),$(document.getElementById("lookupdiv")).append(a),$("#emailDetailIframeContent").on("load",(function(){setTimeout((function(){document.getElementById("emailDetailIframeContent").contentWindow.document.write(e),$("#emailDetailIframeContent").contents().find(".ceMailContentOuter").find(".dN")}),0),$("#lookupdiv").removeClass("p20").addClass("mB20"),$("#emailDetailIframeContent").contents().find("body").css("overflow","hidden"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),setTimeout((function(){$("#emailDetailIframeContent").contents().find("body").css("margin","0");var e=$("#emailDetailIframeContent").contents().find(".ecMailDp").hasClass("emptyImgContainer")?"/nophoto.png":$("#emailDetailIframeContent").contents().find(".ecMailDp").attr("src");if($("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter .getFirstEmailContent").height()>545&&$("#emailDetailIframeContent").contents().find("#mailClientPopupCss").addClass("headerFixCssAfter"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),"nophoto.png"==e.substr(e.lastIndexOf("/")+1))$("#emailDetailIframeContent").contents().find(".ecMailDp").addClass("emptyImgContainer"),createAvatar();else{var t='<img src="'+e+'" alt="" style=" border:1px solid var(--br_fff);border-radius:50%;" height="48" width="48">';$("#emailDetailIframeContent").contents().find(".ecMailDp").parent().append(t),$("#emailDetailIframeContent").contents().find(".ecMailDp").remove()}}),100)})),t.css({position:"absolute",width:"1000px",height:"600px",zIndex:33,opacity:"1"}).show(),setPopCenter(t),t.addClass("topAlignEmailDetail"),renderingUtils.freezeBackground(),c?($L("#FreezeLayer").addClass("zIncSpCase"),t.addClass("zIncSpCase")):$("#FreezeLayer").css({"z-index":"32"}),crmui.modalZIndex("nonLyte",t[0],"open"),EvalInnerScript(t.get(0))}),p)}$(window).on("popstate",(function(){"undefined"!=typeof EmailUtil&&closealertMail("emailalert")}));var validation={};function closeUnneccessaryPopup(){var e=$("#lookupdiv");e.html(""),e.css({display:"none"});var t=$L("crm-ziaforemails")[0];t&&t.component.executeMethod("close");renderingUtils.removeFreezeLayer(),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),$("#diNotificationDetails").css({right:"-900px",display:"none"}),$("#diNotificationDetailsContent").empty()}function getOnclickAttr(e){e.response.type;return{messageId:e.response.messageId,entityId:e.response.entityId,module:e.response.module,name:e.response.name,isActivityCreated:e.response.isActivityCreated,skipMap:e.response.skipMap}}function viewMail(e,t,a,i,l,s,n,r,o,d,c,m,u,p,g,v,h,f){var C=null,y=$("#krp_mail_conversation");if(p){C="action=viewMail&msgid="+e+"&user_id="+o.response.userId+"&module="+o.response.module+"&entId="+r+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(o.response.emailId)+"&flag="+n+"&isZiaNotificationsView=true";var b=csrfParamName+"="+encodeURIComponent(csrfToken),w=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+C;(new crmRequestPool).initiate({action:w,type:"GET",success:function(e){if(Lyte.Component.registeredComponents["crm-ziaforcns"])validation.showZiaForCNSView(e,o);else{var t=networkUtils.returnDependencyFiles(["crm-ziaforcns.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-ziaforcns.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){validation.showZiaForCNSView(e,o)}))}},error:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("error.database.problem"),ltPropType:"error",ltPropDuration:"2000"}})}})}else if(u){C="action=viewMail&msgid="+e+"&user_id="+o.response.userId+"&module="+o.response.module+"&entId="+r+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(o.response.emailId)+"&flag="+n+"&isZiaNotificationsView=true";b=csrfParamName+"="+encodeURIComponent(csrfToken),w=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+C;(new crmRequestPool).initiate({action:w,type:"GET",success:function(e){if(Lyte.Component.registeredComponents["crm-ziaforemails"])validation.showZiaForEmailsView(e,o,c);else{var t=networkUtils.returnDependencyFiles(["crm-ziaforemails.js","crm-email-activity-suggestions.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-ziaforemails.css"],ResourceConstants.CRMClient),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){validation.showZiaForEmailsView(e,o,c)}))}},error:function(){}})}else{if(Crm.userDetails.EMAIL_THREAD_VIEW&&Lyte.registeredMixins["crm-emailconversation-view-mixin"])return void Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadView(e,t,a,i,l,s,n,r,o,d,c,m,g,v,f);var I=null!=event?$(event.target):null;if(null!=I&&(null==I||"INPUT"==I.prop("tagName")||"I"==I.prop("tagName")||I.hasClass("erlThreadViewIcon")||I.hasClass("MoveToMailIcon")||I.hasClass("ernSummery")))EmailTabHomeUtil&&EmailTabHomeUtil.loadEmailDetailViewFromConversations&&EmailTabHomeUtil.loadEmailDetailViewFromConversations(C);else{var L=y.outerWidth(),A=null,E="",S=null,R=$("#isFromNewAPI"),T=null;A=null;n=void 0!==n&&n;var _=$("#"+e),k="true"===$("#isMailAppsFlow").val(),M=$("#selectMails");if(i==crmConstants.Z_Retrying||i==crmConstants.Z_Scheduled||l==crmConstants.ZFSDown){if($(o.parentElement).closest("tr").find(".mailcontDiv").find(".import_unsuccess_img").length<=0){var O=$("#"+e),P=document.createElement("span");$(P).attr({class:"import_unsuccess_img",id:"errorMsg_"+i,onmouseover:"crmui.showTooltip(I18n.getMsg('crm.zfs.down.preview'),false,'left',$(this))",onclick:"crmui.showTooltip(I18n.getMsg('crm.zfs.down.preview'),false,'left',$(this))",onmouseleave:"crmui.hideTooltip()"});var D=O.closest("div");return O.css({cursor:"auto",color:"black"}),D.append(P),setTimeout((function(){$(o).closest(".mailcontDiv").find("#errorMsg_"+i).trigger("click")}),100),void setTimeout((function(){crmui.hideTooltip()}),3e3)}return}var U=Lyte.registeredMixins["crm-detailcanvas-utils"];if(U=U&&U.isFromCanvasActivityEnabledModule(f),y.length>0||Crm.renderDVLyteFlow&&Crm.renderDVLyteFlow(f)||U)Crm.renderDVLyteFlow&&Crm.renderDVLyteFlow(f)||U?(A=r,T=d):(h=$$rightPanel.currentModule,T=$$rightPanel.entityId,A=r);else{var F=$("#id");T=F.length>0?F.val():d;var B=$("#module");if(h=B.length>0?B.val():h,M.length>0){var x=null==M[0].value?M[0].getAttribute("lt-prop-selected"):M[0].value;R.length>0&&(x=M[0].getAttribute("lt-prop-selected")),A="IMAP_ALL"===x||"ALL_MAIL_VIEW"===x||"POP_ALL"===x?r:x.substring(0,x.indexOf("_"))}}var N=$("#associatedContEmail"),j=document.getElementById("subvalue_EMAIL"),V=document.getElementById("subvalue_ADDN_EMAIL"),H=document.getElementById("secondMail"),z=$("#primEmail");if(o&&$(o).attr("data-searchid"))E=$(o).attr("data-searchid");else if(N.length>0)E=N.val(),(S=V?V.innerText:"")||(S=H&&H.value?H.value:""),""!=S&&S.indexOf("<i")>1&&(S=S.substring(0,S.indexOf("<i")));else if(Lyte.Router.getRouteInstance()&&"canvas"==Lyte.Router.getRouteInstance().routeName&&"Potentials"==h&&null!=z.val())E=z.val(),S=$("#secondaryEmail").val();else if(j||V){if(""!=(E=j?j.innerText:"")&&E.indexOf("<i")>1&&(E=E.substring(0,E.indexOf("<i"))),(S=V?V.innerText:"")||(S=H&&H.value?H.value:""),""!=S&&S.indexOf("<i")>1&&(S=S.substring(0,S.indexOf("<i"))),null!=E&&!validationUtils.isValidEmail(E)&&null!=S&&!validationUtils.isValidEmail(S))return void alert(I18n.getMsg("crm.primary.no.valid.email",I18n.getMsg(singularModule)));validationUtils.isValidEmail(E)||(E=null)}o&&$(o).attr("data-isunread")&&(n=$(o).attr("data-isunread"));var q=$("#contactSelDropdownInAcc"),G="";if(q.length>0&&(G=R.length>0?q.attr("lt-prop-selected"):$("#contactSelDropdownInAcc :selected").attr("value")),"Accounts"===h&&q.length>0&&"ACCOUNTS_ALL"!=G)if(h="Contacts","ALL"!=G){T=G;var W=q.children(":selected").attr("email");R.length>0&&(W=$(document.querySelector("lyte-drop-item[data-value='"+G+"']")).data().email),W&&W.indexOf(",")>-1?(E=W.split(",")[0],S=W.split(",")[1]):E=W}else T=d;if("Potentials"===h&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL){var Z=null,J=(W=null,$L("#dealOnlyDropDown"));if(J.length>0){Z=J[0].component.data.ltPropSelected;var Y=$L("#contactRolesDropDown")[0].component.data.ltPropSelected;if("dealsOnly"!==Z&&(T=Y),!0===Y.includes("_")){T=$("#assoPotential_"+e).data("contactid");$L("crm-rl-users-list")[0].component.getData("crObj").contact_role.forEach((function(e){e.id===T&&(W=e.email)}))}h="dealsOnly"!==Z?"Contacts":"Potentials";var Q=$L("#primContactEmailsOnlyDropDown").find("lyte-drop-item[data-value='"+Y+"']");!1===Y.includes("_")&&(W=Q.length>0?Q.data().email:$L("#secContactEmailsOnlyDropDown").find("lyte-drop-item[data-value='"+Y+"']").data().email)}W&&W.indexOf(",")>-1?(E=W.split(",")[0],S=W.split(",")[1]):E=W}var X=$(o).attr("purpose")?$(o).attr("purpose"):t;if(k&&"ALL"!==G){var K=null!=M?M.attr("lt-prop-selected"):null;!K||"IMAP_ALL"!==K&&"ALL_MAIL_VIEW"!==K||(t=o&&o.nodeName&&"a"==o.nodeName.toLowerCase()&&$(o).parents(".ernThreadVSection").length>0?$(o).parents("lyte-tr").prev().find(".rLEmailSub").attr("purpose"):X)}("CRMMASSMAIL"===X||o&&"ernSummery2"==o.id&&"CRMMASSMAIL"===$(o).parent().find(".emailSubjectEllipisis").attr("purpose"))&&(t="ALLUSERSMAILS"),"ALL_MAIL_VIEW"===t&&(t="ALLUSERSMAILS");C="action=viewMail&msgid="+e+"&user_id="+A+"&module="+h+"&entId="+T+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(E)+"&flag="+n;if(null!=S&&validationUtils.isValidEmail(S)&&(C+="&secondaryEmailId="+encodeURIComponent(S)),"Potentials"==h&"dealsOnly"===$("#dealOnlyDropDown").val()&&(C+="&isDealsMail=true"),m&&(C+="&isForSummary=true"),((Crm.userDetails.isRelatedListLyteEnabled?$(o).closest("crm-related-list-view").length:$(o).closest("#RelatedListCommonDiv").length)>0||$("crm-emailsrl-canvas-view").length>0)&&(C+="&source=relatedList"),c&&(C+="&id="+c),commonUtils.showHideLoadingDiv(!0),"MailClient"===$$rightPanel.featureName||$(".outlookInfoCont").is(":visible"))if($(".outlookInfoCont").is(":visible")){w=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+C;w+="&isfromOutlookRightPanel=true",w+="&mailRead=false",$$rightPanel.openNewWindowFromOutlook(w,550,1100),$(".loadingsplash").hide()}else"MailClient"==$$rightPanel.featureName&&("true"===n&&(C+="&mailRead=false"),C+="&fromSource="+$$rightPanel.featureName,o&&($(o).attr("data-isunread","false"),$(o).addClass("erpSelectedMail"),$(o).css({width:L-40})),"salesinbox"==$$rightPanel.rightPanelSource?$$rightPanel.loadEmailDetailView(C):EmailTabHomeUtil&&EmailTabHomeUtil.loadEmailDetailViewFromConversations(C));else{b=csrfParamName+"="+encodeURIComponent(csrfToken);var w=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+C;mR(w,(function(t){if("object"!=typeof t&&"null"!=t&&null!=t){window.getSelection().removeAllRanges();var a=$("#lookupdiv");a.parent("crm-zsurvey-rl-body").length>0&&(a=$(".showhide").find("#lookupdiv"));var i=$("#isNewMailRLEnabled");if(commonUtils.showHideLoadingDiv(),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value)if(""!==mailtreeStructure)$(".recentDate").html($(mailtreeStructure).closest("tr").find(".kvMailtreedate").html()),$(".tkvMailBubble").addClass("hide"),$(".mailConversationList").css("background","var(--bg_white)"),$(mailtreeStructure).closest("li").css("background","#EDF0F4"),$(mailtreeStructure).closest("li").find(".tkvMailBubble").removeClass("hide"),$(".thread td em").css("color","#7a7a7a"),$(".thread td .kvMailtreedate").css("color","#7a7a7a"),$(mailtreeStructure).find("em").css("color","var(--baseColor)"),$(mailtreeStructure).closest("td").siblings("td").find(".kvMailtreedate").css("color","var(--baseColor)"),mailtreeStructure="";else{$(".recentDate").html($("#mailList"+e).find(".maildate").text()),$(".thread td em").css("color","#7a7a7a"),$(".mailConversationList").css("background","var(--bg_white)"),$(".tkvMailBubble").addClass("hide");var l=$("#mailList"+e);l.css("background","#EDF0F4"),l.find(".tkvMailBubble").removeClass("hide"),l.find("#mailconvstatus")&&("tkvincoming"===l.find("#mailconvstatus").val()?$(".tkvmailstatus").html("<span class='dIB kanbanviewImages tkvincoming'></span>"):$(".tkvmailstatus").html("<span class='dIB kanbanviewImages tkvoutgoing'></span>"))}o&&($("#krp_mail_conversation").length>0?$(o).removeClass("kso_mail_read_status0").addClass("kso_mail_read_status1").attr("data-isunread","false"):Crm.userDetails.USER_ID===r&&$(o).removeClass("sbFont crmBaseColor").attr("data-isunread","false")),R.length>0&&_.hasClass("crm-font-bold")&&_.removeClass("crm-font-bold");var s=$(document.createElement("iframe")),n="";try{n=CrmPlusLib?CrmPlusLib.getFrameOriginForURL():""}catch(e){n=""}var d=Crm.frameOriginForEmail&&""!=Crm.frameOriginForEmail?"?"+Crm.frameOriginForEmail:n&&""!=n?"?frameorigin="+CrmPlusLib.getFrameOriginForURL():"";s.attr({id:"emailDetailIframeContent",style:"opacity:1; width:100%; height:100%;clear: both; border: medium none",src:"/crm/html/content1.html"+d}),a.html(""),0==$("crm-emails-related-list").length&&"true"!=i.val()&&a.addClass("edvContainer"),a.append(s).append('<div id="edvFreezeLayer" class="hide"><div id="loading-bar-spinner" class="spinner"><div class="spinner-icon"></div></div></div>'),$("#emailDetailIframeContent").load((function(){setTimeout((function(){document.getElementById("emailDetailIframeContent").contentWindow.document.write(t),0==$("crm-emails-related-list").length&&"true"!=i.val()&&mailsetCenter("lookupdiv")}),0),$("#lookupdiv").removeClass("p20").addClass("mB20"),$("#emailDetailIframeContent").contents().find("body").css("overflow","hidden"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),setTimeout((function(){var e=$("#emailDetailIframeContent");$("#emailDetailIframeContent").contents().find("body").css("margin","0");var t=$("#emailDetailIframeContent").contents().find(".ecMailDp").hasClass("emptyImgContainer")?"/nophoto.png":$("#emailDetailIframeContent").contents().find(".ecMailDp").attr("src");if($("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter .getFirstEmailContent").height()>545&&$("#emailDetailIframeContent").contents().find("#mailClientPopupCss").addClass("headerFixCssAfter"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),t&&"nophoto.png"==t.substr(t.lastIndexOf("/")+1))$("#emailDetailIframeContent").contents().find(".ecMailDp").addClass("emptyImgContainer"),createAvatar();else{var a='<img src="'+t+'" alt="" style=" border:1px solid var(--br_fff);border-radius:50%;" height="48" width="48">';$("#emailDetailIframeContent").contents().find(".ecMailDp").parent().append(a),$("#emailDetailIframeContent").contents().find(".ecMailDp").remove()}$("#edvFreezeLayer").length&&$("#edvFreezeLayer").addClass("hide"),"canvas"==Lyte.Router.getRouteInstance().routeName&&e.contents().find(".enrichData").hide(),$("email-summary").hasClass("hide")||hideEmailSummaryDiv()}),200)})),renderingUtils.freezeBackground(),$("#FreezeLayer").css({"z-index":"24"}),$("#chatbotDiv #kso_mails_list .kso_eachMailContainer").length?(a.css({position:"absolute",width:"1000px",height:"600px",zIndex:35,opacity:"1"}).show(),$("#FreezeLayer").css({"z-index":"33"})):o&&null!=o._callee?"CRM-EMAILS-RELATED-LIST"===o._callee.tagName?(a.addClass("topAlignEmailDetail").show(),setPopCenter(a),crmui.modalZIndex("nonLyte",a[0],"open")):a.css({position:"absolute",width:"1000px",height:"600px",zIndex:30,opacity:"1"}).show():$("#isFromNewAPI").length>0||"true"==i.val()?(a.addClass("topAlignEmailDetail").show(),"true"==i.val()&&setPopCenter(a),crmui.modalZIndex("nonLyte",a[0],"open")):a.css({position:"absolute",width:"1000px",height:"600px",zIndex:30,opacity:"1"}).show(),EvalInnerScript(a.get(0)),$(".currViewedMail").removeClass("currViewedMail"),e&&$("#"+e).addClass("currViewedMail")}}),b)}}}}function setPopCenter(e){var t=e.innerWidth(),a=($(window).innerWidth()-t)/2;a+=20,e.css("left",a)}function addTempFreezeLayer(){var e;e=$(".etTrendsWrapper").length||$(".ziaCallAnalyticswrapper").length?"<div class='temp_freezelayer emailAI op3' style='z-index: 313' />":"<div class='temp_freezelayer emailAI zi28 op3'/>",$("body").append(e)}function removeTempFreezeLayer(){var e=$(".temp_freezelayer.emailAI");e&&e.remove()}function openEventCreate(e,t,a,i){var l;addTempFreezeLayer(),null==(l=Crm.frameOriginForEmail&&Crm.frameOriginForEmail.includes("one")&&Crm.frameOriginForEmail.includes("zoho.com")?Events:parent.Events)&&(l=Events),l.globalCreate(event,"quickcreate",void 0,void 0,void 0,void 0,void 0,(function(){if(addTempFreezeLayer(),$("#Events_fldRow_SUBJECT").find("input").val(e),$("#Events_fldRow_LOCATION").find("input").val(t),0!=a){var s=new Date(a);a=s.getTime(),0==i&&(i=s.getTime())}if(0!=i){var n=new Date(i);i=n.getTime()}l.setStartDateAndTime(a),a==i?l.setEndDateAndTime(i):l.setEndDateAndTime(!1,!1,i);var r=$("#module").val(),o=$("#entityName").val(),d=$("#id").val(),c=$("#subvalue_EMAIL"),m=""==c.text()?null:c.text(),u=$("#Crm_Events_CONTACTID_select");"Leads"==r||"Contacts"==r?u.val(r).change():u.val("Others").change();var p=$("#Crm_Events_CONTACTID");if("Contacts"==u.val()){var g=$("#value_ACCOUNTID").find("a"),v=null!=g.data().params?""==g.data().params.id?null:g.data().params.id:null,h=""==g.text()?null:g.text(),f=$("zpb-phone"),C=null==f.attr("number")?null:f.attr("number"),y=JSON.stringify({accountName:h,accountId:v,cntPhone:C,cntEmail:m});encodeURIComponent(y);if(p.val(o),p.data("id",d),""!=h)(b=$("#Crm_Events_SEID")).val(h),b.data("id",v)}else if("Leads"==u.val())p.val(o),p.data("id",d);else{var b;(b=$("#Crm_Events_SEID")).val(o),b.data("id",d)}var w=$("#addpartCheckbox");if($("#addpartCheck").show(),$("#addpartCheckboxTitle").text(I18n.getMsg("crm.event.add.contact",[o])),w.attr({recId:d,module:r,onclick:"Events.addRelatedParticipant($(this),'"+d+"','"+r+"')"}),$("#signalDetailViewClose").length>0&&$("#ntcInnerDivContent").length>0){var I=$(".temp_freezelayer");I.removeClass("zi28"),I.css("z-index","33"),$("#eventCreatePopup").css("z-index","34")}}))}function activityCreate(e,t,a,i,l,s,n,r){if("Event"==t)return openEventCreate(a,s,i,l),!0;var o,d,c,m="";o=n||(getObj("id")?getObj("id").value:null),d=r||((c=$("input[name=relmodule]")).length?c.val():getObj("property(module)")?getObj("property(module)").value:getObj("module")?getObj("module").value:null);var u,p=$("#module").val();u=n||$("#id").val();var g="",v=!0;if("Task"==t){if(i=Number(i),Lyte.Component.registeredHelpers.getUserDetail("TaskPopup"))crmRelatedList.relTaskCreate(void 0,void 0,void 0,void 0,void 0,(function(){let e=Utils.getDateInUserDatePattern($L.moment(i).toDate(),!0);$L("#Crm_Tasks_SUBJECT").val(a),$("#Crm_Tasks_DUEDATE").val(e),$("#Crm_Tasks_RECURRING").removeAttr("disabled"),$("#Crm_Tasks_REMINDAT").prop("disabled",!0)}));else if(n||r){h=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks&id="+o+"&relmodule="+d+"&primmodule="+p+"&entityid="+u;h+=Q.getCvidAndRecordNum()}else var h=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks";quickTask.init(),m="NewTask"}else if(isNewCallView)v=!1,Crm.globalCreate(e,"emailsAI",$(this),i);else{if($("#relatedPageContent").length)if(Crm.userDetails.isRelatedListLyteEnabled){var f="activityhistorypersonality",C=store.peekAll("related_list").filterBy({personality_name:f.toUpperCase()})[0];C&&f+"_"+C.id}else for(var y=crmRelatedList.personalityArr,b="string"==typeof y?y.split("||"):[],w=b.length,I=0;I<w;I++)if("activityhistorypersonality"===b[I].split("_")[0]){b[I];break}m="NewCall";h=Crm.getCrmBasePath()+"/QCreate.do?module=Calls&id="+o+"&relmodule="+d+"&primmodule="+p+"&entityid="+u;h+=Q.getCvidAndRecordNum(),$(".outlookqCreate").length&&(h+="&isfromOutlookRightPanel=true")}Crm.isFromSalesInbox&&(h+="&isFromSalesInbox=true"),v&&(Q.url=h,Q.anchor="",Q.operation=m,Q.callFrom="RelatedList",g=g+"&crmcsrfparam="+csrfToken,mR(h+"&fromCreate=QuickCreate",(function(e){Q.loadResponse(e,a,i,t)}),g))}function reloadActivityRL(){var e=$("#module").val(),t=$("#id").val(),a=new crmRequestPool;e&&t&&a.initiate({action:Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&type=jsp&id="+t+"&module="+e+"&cvid="+t+"&pname=ACTIVITYPERSONALITY",type:"GET",success:function(a){if(Crm.userDetails.isRelatedListLyteEnabled)Lyte.registeredMixins["crm-related-list-utils"].loadRelatedListComponents(e,t,a);else{var i=(a=a.replace("parent.crmRelatedList.load","window.parent.crmRelatedList.load").replace("parent.crmRelatedList.Module",'"'+e+'"').replace("parent.crmRelatedList.EntityId",t)).match(/window.parent.crmRelatedList.load(\S+)/);null!==i&&new Function("window.parent.crmRelatedList.load"+i[1])()}}})}function createAvatar(){if($("#emailDetailIframeContent").contents().find(".emptyImgContainer").length){$("#emailDetailIframeContent").contents().find(".ecMailDp").removeAttr("style");var e=["0px 0px","-53px 0px","-103px 0px","-154px 0px","-205px 0px","0px -55px","-53px -55px","-103px -55px","-154px -55px","-205px -55px"],t=e[Math.floor(Math.random()*e.length)];$("#emailDetailIframeContent").contents().find(".emptyImgContainer").css("background-position",t),dvTitle=$("#emailDetailIframeContent").contents().find(".ecSenderInfo").text(),dvTitle=dvTitle.trim(),$("#emailDetailIframeContent").contents().find(".emptyImgContainer").html(dvTitle.substring(0,1))}}function populateReplyDetailsFromIframe(e){var t=null,a=null,i=null,l=null,s=null,n=null,r=null,o=null,d=null,c=null;if(void 0!==e&&"null"!==e||(e=""),$("#emailDetailIframeContent"+e).length){var m=$("#emailDetailIframeContent"+e).contents();m.find("#fromAddress").length&&(i=m.find("#fromAddress").val()),m.find("#toAddress").length&&(l=m.find("#toAddress").val()),m.find("#ccAddress").length&&(s=m.find("#ccAddress").val()),m.find("#bccAddress").length&&(n=m.find("#bccAddress").val()),m.find("#replyToAddress").length&&(r=m.find("#replyToAddress").val());var u=m.find("#subject");u.length&&(o=encodeURIComponent(u.val().replace(/[\n\r]/g,"").trim())),m.find("#msgid").length&&(t=m.find("#msgid").val()),m.find("#sentOrReceived").length&&(a=m.find("#sentOrReceived").val()),m.find("#mid").length&&(d=m.find("#mid").val());var p=m.find("#gmailAPImsgId");Crm.userDetails.isNewEditor&&p.length&&(c=p.val())}var g="&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(l)+"&ccAddr="+encodeURIComponent(s)+"&bccAddr="+encodeURIComponent(n)+"&replyToAddr="+encodeURIComponent(r)+"&inReplyTo="+encodeURIComponent(null)+"&msgid="+t+"&sub="+o+"&sentOrReceived="+a+"&mid="+d;return c&&(g=g+"&gmailAPImsgId="+c),g}function populateReplyDetailsFromSummary(){var e=$L("#summaryMailDet"),t=e.data("msgid"),a=e.data("sentOrReceived"),i=e.data("from"),l=void 0!==e.data("to")?e.data("to"):null,s=void 0!==e.data("cc")?e.data("cc"):null,n=void 0!==e.data("bcc")?e.data("bcc"):null,r=void 0!==e.data("reply_to")&&""!==e.data("reply_to")?e.data("reply_to"):null,o=e.data("subject");o&&(o=encodeURIComponent(o.replace(/[\n\r]/g,"").trim()));return hideEmailSummaryDiv(),"&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(l)+"&ccAddr="+encodeURIComponent(s)+"&bccAddr="+encodeURIComponent(n)+"&replyToAddr="+encodeURIComponent(r)+"&inReplyTo="+encodeURIComponent(null)+"&msgid="+t+"&sub="+o+"&sentOrReceived="+a+"&mid=null"}function hideEmailSummaryDiv(){$("email-summary").addClass("hide"),$("#ernOptions").addClass("hide"),$("#ecnAttachment").addClass("hide"),$L(".ernActiveSummary").removeClass("ernActiveSummary");var e=document.querySelector("#replyOptionsMenu");e&&e.ltProp("show",!1);var t=document.querySelector("#ecnAttachmentUl");t&&t.ltProp("show",!1);var a=document.querySelector("#emailSummaryPopOver");a&&a.ltProp("show",!1)}function populateReplyDetailsForMailMagnet(e,t,a){var i,l=null,s=null,n=null,r=null,o=null,d=null,c=null,m=null,u=null;if(i=a||getObj("fromAddress").value,e&&"true"!==e.value?null!=getObj("toAddress")&&(n=t||getObj("toAddress").value):null!=$("#toAddress")&&(n=t||$("#toAddress")[0].value),null!=getObj("ccAddress")&&(addr=getObj("ccAddress").value)&&(r=addr),null!=getObj("bccAddress")&&(addr=getObj("bccAddress").value)&&(o=addr),null!=getObj("replyToAddress")&&(d=getObj("replyToAddress").value),null!=getObj("inReplyTo")&&(c=getObj("inReplyTo").value),null!=getObj("subject")&&(m=encodeURIComponent(getObj("subject").value)),null!=getObj("msgid")){var p=$("#rmDetailViewDiv #msgid");p&&(l=p.val()),l.length<=0&&(l=getObj("msgid").value)}return null!=getObj("sentOrReceived")&&(s=getObj("sentOrReceived").value),null!=getObj("mid")&&(u=getObj("mid").value),"&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(n)+"&ccAddr="+encodeURIComponent(r)+"&bccAddr="+encodeURIComponent(o)+"&replyToAddr="+encodeURIComponent(d)+"&inReplyTo="+encodeURIComponent(c)+"&msgid="+l+"&sub="+m+"&sentOrReceived="+s+"&mid="+u}function replyEmail(e,t,a,i,l,s,n,r,o){var d=$L("#module").val(),c=$L("#id").val();if(d&&"Potentials"===d&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&"mailMagnet"!=l&&(e=d,t=c),"Cases"===e&&Crm.userDetails.isEmailsForCasesModuleEnabled){var m=$L("crm-email-rl-filter"),u=m.length>0?m.get(0).component:void 0;if(u){var p=u.getData("moduleSelected");p&&"CASES_ALL"!==p&&(e="Contacts",t=p)}}EmailCompose.action=a;var g=document.getElementById("iskanbanview");if(o)var v=Lyte.registeredMixins["crm-emailconversation-view-mixin"].populateReplyDetailsForNewEmailView(o);else if(!l||"entityMailView"!==l&&"signalDetailView"!==l)if(l&&"summaryView"===l)v=populateReplyDetailsFromSummary();else v=populateReplyDetailsForMailMagnet(g,s,n);else var v=populateReplyDetailsFromIframe(r);var h=objectUtils.parseURLParamString(v),f=h.msgid;h.gmailAPImsgId&&"ALLUSERSMAILS"!==i&&(f=h.gmailAPImsgId);var C=t,y=EmailLaunchUtil.getApiNameForModule(e),b=h.sentOrReceived.toLowerCase(),w="sent"===b||"opened"===b||"clicked"===b||"bounced"===b||"delivered"===b,I=h.user_id&&"null"!==h.user_id?h.user_id:Crm.userDetails.USER_ID;if($("#krp_mail_conversation").length>0)I=-1===(I=$("#krp_sel_mail_user").attr("userId"))||"-1"===I||"-1"===I?"null":I;else{var L=document.getElementById("selectMails");if(L){var A=null==L.value?$(L).attr("lt-prop-selected"):L.value;if("ALL"!==A&&(I=A.substring(0,A.indexOf("_")),"IMAP_ALL"===A||"ALL_MAIL_VIEW"===A)){var E=$("#emailDetailIframeContent").contents();if(E=E[0])I=E.getElementById("mailUserId").value;else if("summaryView"===l){I=$("#rLEmailSub_"+h.msgid).data("userid")}}}}I&&"null"!==I&&!isNaN(I)||(I=Crm.userDetails.USER_ID),o&&(I=o.mailOwnerId),EmailLaunchUtil.selectedMailOwner=I;var S="/crm/v2/__internal/"+y+"/"+C+"/Emails/"+f+"/actions/"+a;v="user_id="+I+"&mail_type="+i+"&sent="+w;(new crmRequestPool).initiate({action:S,headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},data:v,type:"GET",success:function(t){EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.action=a},EmailSendingUtil.action=a,EmailLaunchUtil.launchReplyMail(t,e,C)},error:function(){renderingUtils.displayPermissionDenied(void 0)}})}function replyMail(e,t,a,i,l,s,n,r,o){var d=!1,c=document.getElementById("iskanbanview");if(Crm.userDetails.isNewEditor){if(EmailSendingUtil.isReplyClicked)return;return setTimeout((function(){EmailSendingUtil.isReplyClicked=!1}),2e3),EmailSendingUtil.isReplyClicked=!0,EmailSendingUtil.entityId=t,EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.action=a},void replyEmail(e,t,a,i,l,s,n,r,o)}var m="action=isEmailOptOut&entityId="+t+"&moduleName="+e;(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/mailer/EntReply.do",type:"POST",data:m,success:function(m){if(null!==(d=m)&&"true"===d)alert(I18n.getMsg("crm.label.emailoptout.alert.message"));else{var u=document.getElementById("subvalue_EMAIL"),p=u?""==u.innerText?" ":u.innerText:" ";if(o)var g=Lyte.registeredMixins["crm-emailconversation-view-mixin"].populateReplyDetailsForNewEmailView(o);else if(!l||"entityMailView"!==l&&"signalDetailView"!==l)if(l&&"summaryView"===l){g=populateReplyDetailsFromSummary();"allContacts"===i&&(i="ALLUSERSMAILS")}else g=populateReplyDetailsForMailMagnet(c,s,n);else var g=populateReplyDetailsFromIframe(r);m=objectUtils.parseURLParamString(g);if(validationUtils.checkEmailLimitExceed(m.toAddr,m.ccAddr,m.bccAddr))renderingUtils.showCustomAlert(I18n.getMsg("crm.email.bcc.check"));else{var v=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action="+a+"&entId="+t+"&module="+e+g+"&entityMail="+encodeURIComponent(p));if(void 0!==r&&"null"!==r&&(v=v+"&notificationId="+r),$("#mid").length>0&&(v+="&mid="+$("#mid").val()),c&&"true"===c.value&&(v+="&iskanbanview=true",$("#spacerDiv_Btm").hide()),""!=a&&"forward"==a){var h="";if($("#krp_mail_conversation").length>0)h=-1==(h=$("#krp_sel_mail_user").attr("userId"))?"null":h;else{var f=getObj("selectMails");if(f){var C=null==f.value?$(f).attr("lt-prop-selected"):f.value;if(h=C.substring(0,C.indexOf("_")),"POP_ALL"===C||"IMAP_ALL"===C||"ALL"===C||"ALL_MAIL_VIEW"===C){var y=$("#emailDetailIframeContent").contents();if(h=y.find("#mailUserId").val(),0===y.length&&"summaryView"===l){var b=$("#rLEmailSub_"+m.msgid);h=b.data("userid"),"CRMMASSMAIL"===b.data("emailtype")&&(i="ALLUSERSMAILS")}}}else h=Crm.userDetails.USER_ID}""===h&&(h=o.mailOwnerId),v+="&user_id="+h}if(i&&(v+="&mailType="+encodeURIComponent(i)),"recentMailView"==l)return v+="&source=recentMailView",hide("rmNavDiv"),new AjaxAPI({id:"rmDetailView",url:v,callbackfn:function(e){EvalInnerScript(document.getElementById("rmDetailView"))}}).post(),!1;openPopUp("entreplyWin",this,v,"entreply",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}}}})}function updateMailRange(e,t,a){if(0==e&&(Crm.mailIndex={}),t.mailRange){0==e&&(crmRelatedList.mailRange={});var i=t.mailRange;i&&(crmRelatedList.mailRange[e]=i),a&&crmRelatedList.mailRange[e+10]&&delete crmRelatedList.mailRange[e+10]}else if(t.next_index&&"number"!=typeof t.next_index&&t.next_index.length>5){var l=t.next_index;l&&(Crm.mailIndex[e]=l),a&&Crm.mailIndex[e+10]&&delete Crm.mailIndex[e+10]}}function getCassMailsRange(e,t){var a,i="";return crmRelatedList.mailRange&&crmRelatedList.mailRange[e]&&(t?0!=(e-=10)&&crmRelatedList.mailRange[e-10]&&(a=crmRelatedList.mailRange[e-10].cassRange):a=crmRelatedList.mailRange[e].cassRange,a&&(i+="&cassRangeEnd="+a.cassRangeEnd,i+="&lastMailTime="+a.lastMailTime)),i}function getMailAPIRange(e,t){var a,i="";return crmRelatedList.mailRange&&crmRelatedList.mailRange[e]&&(t?0!==(e-=10)&&crmRelatedList.mailRange[e-10]&&(a=crmRelatedList.mailRange[e-10].mailapiRange):a=crmRelatedList.mailRange[e].mailapiRange,a&&(i+="&mailapiLastIndex="+a.mailapiLastIndex)),i}function showEnrichmentInEmail(e,t){var a="canvas"===Lyte.Router.getRouteInstance().routeName?$L("crm-detailview-canvas")[0]:$L("crm-detailview-header")[0];if(a&&a.component&&("canvas"===Lyte.Router.getRouteInstance().routeName?a.component.data.dataEnrichmentAvailable:a.component.data.isDataEnrichmentAvailable)&&e===a.component.data.module){var i=Lyte.registeredMixins["enrichment-utils"];i&&i.CheckTriggerData("email",t,e,null)}}function showMailsListViaAPI(e,t,a,i,l,s,n){var r=$("#module"),o=r.length>0?r.val():getOpenerObj("module").value,d=$("#id"),c=d.length>0?d.val():getOpenerObj("id").value,m=!1,u=1,p="";p="canvas"===Lyte.Router.getRouteInstance().routeName?$L('div[data-api-name="Emails"]').attr("data-id"):$L('div[ddname="EMAILSPERSONALITY"]').attr("ddid");var g=null==moduleApiMapping[o]?opener.window.moduleApiMapping[o]:moduleApiMapping[o];"Deals"!=o&&"Deals"!=g||(o="Potentials",g="Potentials");var v=$("#addNewIcP_Emails");if(0==v.length)try{v=$(document.getElementById("addNewIcP_"+I18n.getMsg("Emails")))}catch(e){v=$("#newleft_"+p+" .addNewIcP")}var h="/crm/v6/"+g+"/"+c+"/Emails",f=$L("crm-email-rl-filter"),C=f.length>0?f.get(0).component:void 0;if(C&&C.getData("isVendorModule")&&C.getData("isPurchaseOrderSelected")){var y=C.getData("purchaseOrderId");o="PurchaseOrders",h="/crm/v6/"+(g=void 0===moduleApiMapping[o]?opener.window.moduleApiMapping[o]:moduleApiMapping[o])+"/"+y+"/Emails",c=y}var b={},w="",I=$L("#selectMails"),L=I.length>0?I:$(getOpenerObj("selectMails")),A=$("#scheduledMails"),E=$("#dealOnlyDropDown"),S=$L("crm-rl-users-list"),R=S.length>0?S[0].component:void 0,T=$("#relatedMailList"),_=$("#sendEntityMailLink"),k=$("#contactSelDropdownInAcc"),M=$("#accountsScheduled"),O=document.getElementById("accountsDrafts");l=l||$(".selectTab").attr("id");var P=$L("#emailsId"),D=P.length>0;if("mails"===l){if("Accounts"===o){var U=s&&null!==s?s:k.attr("lt-prop-selected");k.length>0&&k[0].ltProp("selected",U)}if(e&&"CASES_ALL"!==e&&"ACCOUNTS_ALL"!==e&&"ACCOUNTS_ALL"!==U&&"ALL"!==U&&!n&&D&&("next"===a||"nextPage"===a)&&C&&"allEmails"!==C.getData("emailsSelected")&&"allEmailsSentFrom"!==C.getData("emailsSelected"))(n=C.getData("emailsSelected"))&&(n=n.slice(0,-2))}else if("accountsScheduled"===l&&s)M[0].ltProp("selected",s);else if("scheduledMails"===l&&"Accounts"===o)if("emailassociatedcontacts"!==e&&"ACCOUNTS_ALL"!==e||!s){var F=C?C.getData("recordsSelected"):void 0,B=!!C&&C.getData("isDropdownNeeded");"ACCOUNTS_ALL"===(C?C.getData("moduleSelected"):void 0)?M[0].ltProp("selected","ACCOUNTS_ALL"):"allContacts"===F&&B?M[0].ltProp("selected","ALL"):s&&B&&M[0].ltProp("selected",s)}else M[0].ltProp("selected",s);else if("draftMails"===l&&"Accounts"===o)if("emailassociatedcontacts"!==e&&"ACCOUNTS_ALL"!==e||!s){F=C?C.getData("recordsSelected"):void 0,B=!!C&&C.getData("isDropdownNeeded");"ACCOUNTS_ALL"===(C?C.getData("moduleSelected"):void 0)?M[0].ltProp("selected","ACCOUNTS_ALL"):F&&"allContacts"===F&&B?O.ltProp("selected","ALL"):s&&B&&O.ltProp("selected",s)}else O.ltProp("selected",s);else s&&"Accounts"===o&&O.ltProp("selected",s);var x=!1,N=$(".selectTab"),j=$("#draftMails"),V=(ie=$("#mails")).length>0?ie:$(getOpenerObj("mails")),H=(O=document.getElementById("accountsDrafts"),"Potentials"==o&&E.length>0),z=$(".rLETabsElement"),q=$(".rLESelectAction"),G=$('[lt-prop-name="ernHead"]'),W=$("#isMailAppsFlow").val();try{opener&&opener.document&&(A=A.length>0?A:$(getOpenerObj("scheduledMails")),T=T.length>0?T:$(getOpenerObj("relatedMailList")),k=k.length>0&&"Accounts"==o?k:$(getOpenerObj("contactSelDropdownInAcc")),M=M.length>0?M:$(getOpenerObj("accountsScheduled")),N=N.length>0?N:window.opener.$(".selectTab"),j=j.length>0?j:$(getOpenerObj("draftMails")),O=$(O).length>0?O:getOpenerObj("accountsDrafts"),z=z.length>0?z:$(opener.document.getElementsByClassName("rLETabsElement")),q=q.length>0?q:$(opener.document.getElementsByClassName("rLESelectAction")),G=G.length>0?G:null!=opener?$(opener.document.querySelector('[lt-prop-name="ernHead"]')):G)}catch(e){murphy.error(e)}var Z="true"===W;if(A.show(),j.show(),commonUtils.showHideLoadingDiv(!0),"block"==q.css("display")&&(G.find("input").prop("checked")?G.attr("lt-prop-checked",!1):(q.hide(),z.show(),$("#mailsToDelete").val(""),$("#mailsSub").html(""),$(".eRListPartialSelect").removeClass("eRListPartialSelect"))),"scheduledMails"==l){if(e="scheduled_in_crm",T.hide(),"Accounts"===o){var J=getSelectedContact(N);k.hide(),$(O).hide();var Y=document.querySelector("#accountsScheduled"),Q=null===Y&&opener?opener.document.querySelector("#accountsScheduled"):Y;if(Q?(Q.ltProp("selected",J),"ALL"===J&&"ACCOUNTS_ALL"!==J?(Q.setData("ltPropSelected","ALL"),e="all_contacts_scheduled_crm_emails",_.hide(),$(Q).show()):"ACCOUNTS_ALL"===J?e="scheduled_in_crm":0==k.length?(e="scheduled_in_crm",_.hide(),$(Q).show()):(Q.setData("ltPropSelected",J),h="/crm/v6/Contacts/"+J+"/Emails",e="scheduled_in_crm",_.css("display","inline-block"),$(Q).show())):(e="scheduled_in_crm",_.hide()),C){var X=C.getData("emailModuleRelatedOptions").filter((e=>"allContacts"!==e.name));if(X.length>0){var K={name:"allContacts",value:I18n.getMsg("crm.label.all.contacts.email.scheduled")};X.unshift(K),C.setData("emailModuleRelatedOptions",X)}var ee=C.getData("emailAssociatedOptions");if("Accounts"===o){var te=ee.filter((e=>"ACCOUNTS_ALL"!==e.name));te.unshift({name:"ACCOUNTS_ALL",value:I18n.getMsg("crm.label.all.accounts.email.scheduled")})}C.setData("emailAssociatedOptions",te)}}if(C&&(P.css("display","none"),"Cases"===o)){ee=C.getData("emailAssociatedOptions");var ae=moduleRecordMapping.Cases.plural_label;te=ee.filter((e=>"CASES_ALL"!==e.name));te.unshift({name:"CASES_ALL",value:Lyte.Component.registeredHelpers.concat(ae," - ",I18n.getMsg("crm.rl.filter.scheduled"))}),C.setData("emailAssociatedOptions",te)}N.removeClass("selectTab"),A.addClass("selectTab")}else if("mails"==l){var ie,le=N.get(0).getAttribute("id");if("Accounts"===o&&k.length>0){var se=store.peekRecord("emails_rl_user","shared_users_"+U);U=J=getSelectedContact(N),k[0].ltProp("selected",U);var ne=C?C.getData("emailsSelected"):void 0;if("ACCOUNTS_ALL"!==U&&"ALL"!==U&&ne&&"allEmails"!==ne&&"allEmailsSentFrom"!==ne&&!n&&D&&(n=ne.slice(0,-2)),C&&C.data.emailIdOptions.length>0&&P.css("display","block"),ne&&"allEmailsSentFrom"===ne?T.css("display","none"):(L.find("lyte-drop-item").length>1||"scheduledMails"===le||"draftMails"===le)&&se&&T.css("display","block"),k.show(),M.hide(),$(O).hide(),"ACCOUNTS_ALL"!=U&&"ALL"!=U){if(h="/crm/v6/Contacts/"+U+"/Emails",_.show(),!se&&("scheduledMails"===le||"draftMails"===le)){x=!0;var re=store.peekRecord(moduleRecordMapping.Contacts.id,U);C&&C.populateEmailIdsDropdown.call(C,"Contacts",U,re),(ne=C?C.getData("emailsSelected"):void 0)&&"allEmails"!==ne&&"allEmailsSentFrom"!==ne&&!n&&D&&(n=ne.slice(0,-2))}}else"ALL"===U?_.hide():_.css("display","inline-block");if(C){X=C.getData("emailModuleRelatedOptions").filter((e=>"allContacts"!==e.name));if(X.length>0){K={name:"allContacts",value:I18n.getMsg("crm.label.all.contacts.email.sent")};X.unshift(K),C.setData("emailModuleRelatedOptions",X)}te=(ee=C.getData("emailAssociatedOptions")).filter((e=>"ACCOUNTS_ALL"!==e.name));te.unshift({name:"ACCOUNTS_ALL",value:I18n.getMsg("crm.label.all.accounts.email.sent")}),C.setData("emailAssociatedOptions",te)}}else if("Cases"===o){var oe=C.getData("moduleSelected");ne=C?C.getData("emailsSelected"):void 0;if(!oe||"CASES_ALL"===oe||"ACCOUNTS_ALL"===oe||"scheduledMails"!==le&&"draftMails"!==le)"CASES_ALL"===oe?(e="CASES_ALL",T.css("display","none")):(T.css("display","block"),L=I);else{x=!0,s=oe;re=store.peekRecord(moduleRecordMapping.Contacts.id,oe);C&&C.populateEmailIdsDropdown.call(C,"Contacts",oe,re),ne&&"allEmails"!==ne&&"allEmailsSentFrom"!==ne&&!n&&D&&(n=ne.slice(0,-2))}a&&("nextPage"===a||"previous"===a)&&ne&&"allEmails"!==ne&&"allEmailsSentFrom"!==ne&&!n&&D&&(n=ne.slice(0,-2));ee=C.getData("emailAssociatedOptions"),ae=moduleRecordMapping.Cases.plural_label,te=ee.filter((e=>"CASES_ALL"!==e.name));te.unshift({name:"CASES_ALL",value:Lyte.Component.registeredHelpers.concat(ae," - ",I18n.getMsg("crm.rl.filter.sent"))}),C.setData("emailAssociatedOptions",te)}else{(ne=C?C.getData("emailsSelected"):void 0)&&"allEmailsSentFrom"===ne?T.css("display","none"):(a&&("nextPage"===a||"previous"===a)&&ne&&"allEmails"!==ne&&"allEmailsSentFrom"!==ne&&!n&&D&&(n=ne.slice(0,-2)),T.css("display","block"))}C&&"Accounts"!==o&&P.css("display","block"),N.removeClass("selectTab"),(V=(ie=$("#mails")).length>0?ie:$(getOpenerObj("mails"))).addClass("selectTab")}else if("draftMails"==l){if(T.hide(),e="drafts","Accounts"===o){J=getSelectedContact(N);if(k.hide(),M.hide(),O?(O.ltProp("selected",J),"ALL"!==J&&"ACCOUNTS_ALL"!==J?(h="/crm/v6/Contacts/"+J+"/Emails",e="drafts",_.show(),$(O).show()):"ACCOUNTS_ALL"===J?e="drafts":(e="all_contacts_draft_crm_emails",$(O).css("display","inline-block"))):e="drafts",C){X=C.getData("emailModuleRelatedOptions").filter((e=>"allContacts"!==e.name));if(X.length>0){K={name:"allContacts",value:I18n.getMsg("crm.rl.filter.contacts.drafts")};X.unshift(K),C.setData("emailModuleRelatedOptions",X)}te=(ee=C.getData("emailAssociatedOptions")).filter((e=>"ACCOUNTS_ALL"!==e.name));te.unshift({name:"ACCOUNTS_ALL",value:I18n.getMsg("crm.rl.filter.accounts.drafts")}),C.setData("emailAssociatedOptions",te)}}if(C&&(P.css("display","none"),"Cases"===o)){ee=C.getData("emailAssociatedOptions"),ae=moduleRecordMapping.Cases.plural_label,te=ee.filter((e=>"CASES_ALL"!==e.name));te.unshift({name:"CASES_ALL",value:Lyte.Component.registeredHelpers.concat(ae," - ",I18n.getMsg("crm.rl.filter.drafts"))}),C.setData("emailAssociatedOptions",te)}N.removeClass("selectTab"),j.addClass("selectTab")}"Accounts"===o&&("ACCOUNTS_ALL"===U||"ALL"===U?(T.hide(),"ACCOUNTS_ALL"===U&&V.hasClass("selectTab")?C?(_.css("display","inline-block"),v.css("display","inline-block")):(_.hide(),A.hide(),j.hide()):(_.hide(),v.css("display","none")),Crm.userDetails.isEmailsForModuleEnabled||v.addClass("hide"),T.hide()):Crm.userDetails.isEmailsForModuleEnabled?Crm.userDetails.isEmailsForModuleEnabled&&v.css("display","inline-block"):v.removeClass("hide"));var de=j.hasClass("selectTab"),ce=A.hasClass("selectTab"),me=M.length>0?M.attr("lt-prop-selected"):"";if(null==l||"mails"==l){if(0==L.length&&(e="ALLUSERSMAILS"),"Cases"===o&&"CASES_ALL"===e&&(e="ALLUSERSMAILS"),"Accounts"===o&&null==U||"Accounts"===o&&"ACCOUNTS_ALL"==U?e="ALLUSERSMAILS":Z||null==L||"IMAP_ALL"!==L.attr("lt-prop-selected")||"Accounts"===o&&"ALL"==U?null!=L&&"ALL"===L.attr("lt-prop-selected")&&(e="ALLUSERSMAILS"):e="IMAP_ALLUSERSMAILS","Accounts"===o&&"ALL"==U&&(e="allContacts"),!Z&&null!=L&&"IMAP_ALL"===L.attr("lt-prop-selected")&&"ALL"!==U){var ue=$L("#isALLOptOnly");("true"===$("#isALLOptOnly").val()||ue.length>0&&"true"===ue[0].value)&&(e="IMAP_CRMMAILS")}if(Z&&"ALL"!==U&&"ALLUSERSMAILS_PO"!==e&&"allEmailsSentFrom"!==e&&"ALLUSERSMAILS"!==e){var pe=null!=L?L.attr("lt-prop-selected"):null;"IMAP_ALL"!==pe&&"POP_ALL"!==pe&&"ALL_MAIL_VIEW"!==pe||(e=pe)}de&&"Accounts"===o?"ALL"===$L(O).attr("lt-prop-selected")?(e="all_contacts_draft_crm_emails",_.hide()):(h="/crm/v6/Contacts/"+O.getAttribute("lt-prop-selected")+"/Emails",_.show()):ce&&"Accounts"===o&&("ALL"===me?(e="all_contacts_scheduled_crm_emails",_.hide()):(h="/crm/v6/Contacts/"+me+"/Emails",_.show()))}"Cases"===o&&((oe=C.getData("moduleSelected"))&&"CASES_ALL"!==oe&&"ACCOUNTS_ALL"!==oe&&(h="/crm/v6/Contacts/"+oe+"/Emails"));var ge=$(".selectTab")[0].id;if(R.setData("selTab",ge),"Accounts"===o&&"ACCOUNTS_ALL"!=U&&"ALL"!=U&&!de&&!ce&&k.length>0){_.show(),h="/crm/v6/Contacts/"+(U=ce?me:U)+"/Emails";var ve=!1;if((Crm.userDetails.isEmailsForModuleEnabled&&(event&&event.currentTarget&&event.currentTarget._callee&&("moduleId"===event.currentTarget._callee.id||"recordId"===event.currentTarget._callee.id)||s)&&"next"===a||x||!Crm.userDetails.isEmailsForModuleEnabled&&(event&&event.currentTarget&&event.currentTarget.origindd&&"contactSelDropdownInAcc"===event.currentTarget.origindd.id||void 0!==l)&&"next"===a)&&(ve=!0),ve)return void getContactSharedDetailsAndMail(U,l,h,c,o,a,i,L,n,T,C)}if("Cases"===o&&s&&"CASES_ALL"!==s&&"ACCOUNTS_ALL"!==s&&"next"===a&&"mails"===l||x)getContactSharedDetailsAndMail(s,l,h="/crm/v6/Contacts/"+s+"/Emails",c,o,a,i,L,n,T,C);else{var he=$('lyte-drop-item[data-value="'+L.attr("lt-prop-selected")+'"]'),fe=he.length>0?he:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+L.attr("lt-prop-selected")+'"]')):null,Ce=null!=fe?fe.parent():null,ye=$L("#contactRolesDropDown"),be=!(!R||!R.data.mailObj)&&R.data.mailObj.mailConfigured;if(H&&be)if(m=!0,Ae=E.attr("lt-prop-selected"),Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&(Ee=ye[0].component.data.ltPropSelected,Ae=E[0].component.data.ltPropSelected),"dealsOnly"!=Ae)m=!1,(Ee=Crm.userDetails.CONTACT_ROLES_EMAILS_RL?Ee:Ae)===c||Ee.includes(c)?("mails"!==l&&T.hide(),R.setData("selContact",c+"_"+ge),h="/crm/v6/Potentials/"+c+"/Emails",e=ge&&"draftMails"===ge?"all_contacts_draft_crm_emails":"scheduledMails"===ge?"all_contacts_scheduled_crm_emails":"allContacts"):(h="/crm/v6/Contacts/"+Ee+"/Emails","mails"===l&&T.show()),L[0].ltProp("disabledList",[]);else{var we=store.peekRecord("emails_rl_user","pop_users_"+c);if(we=null!=we?we.data:we,Crm.userDetails.CONTACT_ROLES_EMAILS_RL){if(""===e&&(1===parseInt(Ce.attr("type"))||3===parseInt(Ce.attr("type")))){var Ie=$L("#selectMails")[0].component.data.ltPropSelected.split("_")[0];if((we=$cmpt.data.mailObj.pop_users).some((e=>e.user_id===Ie))){var Le=$L("lyte-drop-item[data-value='IMAP_ALL']");Le&&Le.length>0?(e="IMAP_ALL",L[0].ltProp("selected","IMAP_ALL")):(e="ALLUSERSMAILS",L[0].ltProp("selected","ALL"))}}}else""===e&&1===parseInt(Ce.attr("type"))&&(e="IMAP_ALL",L[0].ltProp("selected","IMAP_ALL"));null!=we&&L[0].ltProp("disabledList",we)}else if(Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&ye.length>0){var Ae,Ee=ye&&ye.length>0?ye[0].component.data.ltPropSelected:ye;(Ae=E&&E.length>0?E[0].component.data.ltPropSelected:void 0)&&"dealsOnly"!==Ae&&(Ee===c||Ee.includes(c)?("mails"!==l&&T.hide(),R.setData("selContact",c+"_"+ge),h="/crm/v6/Potentials/"+c+"/Emails",e=ge&&"draftMails"===ge?"all_contacts_draft_crm_emails":"scheduledMails"===ge?"all_contacts_scheduled_crm_emails":"allContacts"):(h="/crm/v6/Contacts/"+Ee+"/Emails","mails"===l&&T.show()))}if(ce&&"all_contacts_scheduled_crm_emails"!=e?(e="scheduled_in_crm",w="scheduled_in_crm"):de&&"all_contacts_draft_crm_emails"!=e&&(e="drafts"),"ALLUSERSMAILS"===e||"allEmailsSentFrom"===e?(w="sent_from_crm",u=6):"scheduled_in_crm"==e?(w="scheduled_in_crm",u=7):"allContacts"==e?("dealsOnly"!==Ae&&T.hide(),w="all_contacts_sent_crm_emails",u=4):"IMAP_CRMMAILS"==e?(w="",u=5):"all_contacts_scheduled_crm_emails"==e?(w="all_contacts_scheduled_crm_emails",u=8):"drafts"==e?(w="drafts",u=9):"all_contacts_draft_crm_emails"==e?(w="all_contacts_draft_crm_emails",u=10):"ALL_MAIL_VIEW"==e?(w="",u=5):"IMAP_ALL"==e||"IMAP_ALLUSERSMAILS"==e?(w="all_imap_shared_users",u=3):"POP_ALL"==e?(w="all_pop_shared_users",u=11):(w="user_emails",e=parseInt(Ce.attr("type")),u=2),"ACCOUNTS_ALL"===U&&"drafts"!==e&&"scheduled_in_crm"!==e&&(w="sent_from_crm",u=6),""!=w&&(b.type=w),t=parseInt(t),"nextPage"===a||"next"===a?t+=10:"previous"===a&&(t-=10),b.index=t,2==u&&L&&null!=Ce&&"3"==Ce.attr("type")&&0!=t)b.index=Crm.mailIndex[t/10-1];else if(!Z&&(5==u||3==u||2==u&&L&&null!=Ce&&"2"==Ce.attr("type"))&&0!=t){var Se=t/10-1;Crm.mailIndex[Se]&&(b.index=Crm.mailIndex[Se])}else if(Z&&(3==u||5==u)&&0!=t){Se=t/10-1;Crm.mailIndex[Se]&&(b.index=Crm.mailIndex[Se])}csrfParamName,csrfToken;var $e=null!=L.attr("lt-prop-selected")?L.attr("lt-prop-selected").split("_")[0]:null;2==u&&$e!=Crm.userDetails.USER_ID&&(b.owner_id=$e),n&&null!==n&&"allEmailsSentFrom"!==n&&(n=n.trim(),b.filters='{"comparator" : "equal","field":{"api_name":"to"},"value" : {"email":$email}}'.replace("$email",'"'+n+'"')),getMailsListReq(e,c,o,t,m,u,a,$e,i,h,b)}}function getContactSharedDetailsAndMail(e,t,a,i,l,s,n,r,o,d,c){var m,u=store.peekRecord("emails_rl_user","shared_users_"+i);m=void 0!==u?u.data:u;var p=store.peekRecord("emails_rl_user","shared_users_"+e);if(void 0===p)store.findAll("emails_rl_user",{},!1,!0,{module:"Contacts",entityId:e,action:"getUsers"}).then((function(c){if((p={}).rid=m.rid,p.email="",p.fullName=$L("#fullname").val(),p.mailObj=c[0].data.email_related_list[0],p.mailObj.module=l,p.mailObj.entityId=i,p.mailObj.loginUserId=Crm.userDetails.USER_ID,p.mailObj.singularMod=moduleRecordMapping[l].singular_label,store.pushPayload("emails_rl_user",{content:"shared_users_"+e,data:p}),p.mailObj.selectedContact=e,"Accounts"===l&&(p.mailObj.all_contacts_emails=m.mailObj.all_contacts_emails,p.mailObj.contacts_details=m.mailObj.contacts_details),Crm.userDetails.isEmailsForModuleEnabled)var u=getSelOptionForAccountsForEAM(p,r,t);else u=getSelOptionForAccounts(p,r,t);var g=u.contactSharedDetails;document.querySelector("crm-rl-users-list").component.setData(g);var v=u.type;changeNewEmailDropDownVisibilty(g,d,v),getMailsForContact(v,a,i,l,s,n,r,o)}));else{if(void 0===(p=p.data).mailObj&&(p.mailObj=p.email_related_list[0]),"Accounts"===l&&(p.mailObj.module="Accounts",p.mailObj.all_contacts_emails=m.mailObj.all_contacts_emails,p.mailObj.contacts_details=m.mailObj.contacts_details),"Cases"===l&&(p.mailObj.module="Cases"),p.mailObj.selectedContact=e,Crm.userDetails.isEmailsForModuleEnabled)var g=getSelOptionForAccountsForEAM(p,r,t);else g=getSelOptionForAccounts(p,r,t);var v=g.contactSharedDetails;document.querySelector("crm-rl-users-list").component.setData(v);var h=g.type,f=c?c.getData("emailsSelected"):void 0;f&&"allEmailsSentFrom"===f?d.css("display","none"):d.css("display","block"),changeNewEmailDropDownVisibilty(v,d,h),getMailsForContact(h,a,i,l,s,n,r,o)}}function changeNewEmailDropDownVisibilty(e,t,a){var i=document.querySelector("#selectMails");i&&(i.ltProp("selected",""),i.ltProp("selected",a));var l=e.mailObj;l.all_emails||l.all_imap_shared_users||l.all_pop_shared_users||l.pop_users||l.imap_users||l.gmail_users?t.css("display","block"):t.css("display","none")}function getSelectedContact(e){if("mails"==(e=e.attr("id"))){var t=$("#contactSelDropdownInAcc");return(t=t.length>0?t:$(getOpenerObj("contactSelDropdownInAcc"))).attr("lt-prop-selected")}if("draftMails"==e){var a=$("#accountsDrafts");return(a=a.length>0?a:$(getOpenerObj("accountsDrafts"))).attr("lt-prop-selected")}var i=$("#accountsScheduled");return(i.length>0?i:$(getOpenerObj("accountsScheduled"))).attr("lt-prop-selected")}function getSelOptionForAccountsForEAM(e,t){var a={};if(0==t.length)a.contactSharedDetails=e,e.mailObj&&e.mailObj.all_emails&&Crm.userDetails.isMailAppsUser?a.type="ALL_MAIL_VIEW":a.type="ALL";else if(1===t.find("lyte-drop-item").length&&e.mailObj.mailConfigured)a.contactSharedDetails=e,a.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0);else{var i=t.attr("lt-prop-selected");if("ALL"===i||"ALL_MAIL_VIEW"===i)a.contactSharedDetails=e,e.mailObj&&e.mailObj.hasOwnProperty("all_emails")&&Crm.userDetails.isMailAppsUser?a.type="ALL_MAIL_VIEW":a.type="ALL";else if("IMAP_ALL"==i)a.contactSharedDetails=e,e.mailObj&&(e.mailObj.hasOwnProperty("all_imap_shared_users")||e.mailObj.hasOwnProperty("all_emails"))?a.type="IMAP_ALL":a.type="ALL";else{var l=$('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]'),s=l.length>0?l:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]')):null,n=null!=s?s.parent():null,r=parseInt(n.attr("type")),o=t.attr("lt-prop-selected").split("_");if(1==r){var d=e.mailObj.pop_users;if(null==d){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.pop_users=[],e.mailObj.pop_users[0]=h}else{for(var c=!1,m=d.length,u=0;u<m;u++)if(o[0]==d[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.pop_users.push(h)}}else if(2==r){var p=e.mailObj.imap_users;if(null==p){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.imap_users=[],e.mailObj.imap_users[0]=h}else{c=!1;var g=p.length;for(u=0;u<g;u++)if(o[0]==p[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.imap_users.push(h)}}else{var v=e.mailObj.gmail_users;if(null==v){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.gmail_users=[],e.mailObj.gmail_users[0]=h}else{c=!1;var h,f=v.length;for(u=0;u<f;u++)if(o[0]==v[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.gmail_users.push(h)}}a.contactSharedDetails=e,a.type=t.attr("lt-prop-selected")}}return a}function getSelOptionForAccounts(e,t,a){var i={};if(0==t.length)i.contactSharedDetails=e,i.type="ALL";else if(1===t.find("lyte-drop-item").length&&e.mailObj.mailConfigured)i.contactSharedDetails=e,i.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0);else if("ALL"===t.attr("lt-prop-selected"))i.contactSharedDetails=e,i.type="ALL";else if("ALL_MAIL_VIEW"===t.attr("lt-prop-selected"))e.mailObj&&e.mailObj.hasOwnProperty("all_emails")?(i.contactSharedDetails=e,i.type="ALL_MAIL_VIEW"):(i.contactSharedDetails=e,i.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0));else if("IMAP_ALL"==t.attr("lt-prop-selected"))e.mailObj&&(e.mailObj.hasOwnProperty("all_imap_shared_users")||e.mailObj.hasOwnProperty("all_emails"))?(i.contactSharedDetails=e,i.type="IMAP_ALL"):(i.contactSharedDetails=e,i.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0));else{var l=$('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]'),s=l.length>0?l:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]')):null,n=null!=s?s.parent():null,r=parseInt(n.attr("type")),o=t.attr("lt-prop-selected").split("_");if(1==r){var d=e.mailObj.pop_users;if(null==d){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.pop_users=[],e.mailObj.pop_users[0]=h}else{for(var c=!1,m=d.length,u=0;u<m;u++)if(o[0]==d[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.pop_users.push(h)}}else if(2==r){var p=e.mailObj.imap_users;if(null==p){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.imap_users=[],e.mailObj.imap_users[0]=h}else{c=!1;var g=p.length;for(u=0;u<g;u++)if(o[0]==p[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.imap_users.push(h)}}else{var v=e.mailObj.gmail_users;if(null==v){(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.gmail_users=[],e.mailObj.gmail_users[0]=h}else{c=!1;var h,f=v.length;for(u=0;u<f;u++)if(o[0]==v[u].user_id){c=!0;break}if(!c)(h={}).user_id=o[0],h.user_name=o[1],e.mailObj.gmail_users.push(h)}}i.contactSharedDetails=e,i.type=t.attr("lt-prop-selected")}return i}function getMailsListReq(e,t,a,i,l,s,n,r,o,d,c){var m,u={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};if(Lyte.registeredMixins["crm-email-emotions-mixin"])m=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails();else{var p=networkUtils.returnDependencyFiles(["email-emotions.js","zia-notification-settings.js","crm-emailsai-config.js"],ResourceConstants.CRMClient);Lyte.injectResources(p,void 0,(function(){m=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails()}))}m.then?m.then((function(m){m&&m.zia_config&&Lyte.registeredMixins["crm-email-emotions-mixin"].setEmailsAIVariables(m),rlAPI(d,c,u,e,t,a,i,l,s,n,r,o)})):rlAPI(d,c,u,e,t,a,i,l,s,n,r,o)}function rlAPI(e,t,a,i,l,s,n,r,o,d,c,m){var u=$("#fullname"),p=u.length>0?u.val():$("fullname").value,g=$("#mailListRelId"),v=g.length>0?g.val():$("mailListRelId").value;(new crmRequestPool).initiate({type:"GET",url:e,data:t,headers:a,success:function(e){showMailsListHandling(handleMailsList(e,i,l,s,n,p,r,o,d,c),v,n,"true",d,s,l,m,"previous"==d)},error:function(e){showMailsListHandling(handleMailsList(e,i,l,s,n,p,r,o,d,c),v,n,"true",d,s,l,m,"previous"==d)}})}function setContactSharedUsers(e,t){var a=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e);t.attr("lt-prop-selected",a),$("#relatedMailList").show()}function getMailsForContact(e,t,a,i,l,s,n,r){var o="",d={},c=0,m=$('lyte-drop-item[data-value="'+n.attr("lt-prop-selected")+'"]'),u=m.length>0?m:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+n.attr("lt-prop-selected")+'"]')):null,p=null!=u?u.parent():null,g=$("#isMailAppsFlow");if(1!=("true"===(g.length>0?g.val():$(getOpenerObj("isMailAppsFlow")).value))||"ALL_MAIL_VIEW"!=e&&"IMAP_ALL"!=e&&"POP_ALL"!=e)if("ALL"==e)o="ALLUSERSMAILS",d.type="sent_from_crm",c=6;else if("IMAP_ALL"==e)o="IMAP_ALL",c=3,0==$("#zmailPublicUsers").length&&(o="IMAP_CRMMAILS",c=5);else{o=parseInt(p.attr("type")),d.type="user_emails";var v=e.split("_")[0];v!=Crm.userDetails.USER_ID&&(d.owner_id=v),c=2}else"ALL_MAIL_VIEW"==e?(d.type="",c=5):"IMAP_ALL"==e?(d.type="all_imap_shared_users",c=3):"POP_ALL"==e&&(d.type="all_pop_shared_users",c=11);d.index=0;var h=null!=n.attr("lt-prop-selected")?n.attr("lt-prop-selected").split("_")[0]:null;r&&null!==r&&(r=r.trim(),d.filters='{"comparator" : "equal","field":{"api_name":"to"},"value" : {"email":$email}}'.replace("$email",'"'+r+'"')),getMailsListReq(o,a,i,0,!1,c,l,h,s,t,d)}function getRelatedMails(e,t,a,i,l,s,n){if(Crm.userDetails.EMAIL_THREAD_VIEW&&Lyte.registeredMixins["crm-emailconversation-view-mixin"])Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadView(e,a,void 0,i,void 0,void 0,void 0,t,l,s,void 0,void 0,n);else{var r=csrfParamName+"="+encodeURIComponent(csrfToken),o=document.getElementById("iskanbanview");if(o&&"true"===o.value)t=document.getElementById("userid").value;var d=Crm.getCrmBasePath()+"/ZMailConfig.do?action=showRelatedMails&msgid="+e+"&user_id="+t;o&&"true"===o.value&&(d+="&iskanbanview=true");var c="RelMails_"+e,m=$("#test_"+e+",#"+c),u=$("#"+c);a=$("#mail_type");if(u.length&&a.length&&"GMail"===a[0].value)"none"!==u[0].style.display?m.hide():m.show();else if(document.getElementById(c)&&"none"!==u[0].style.display&&!o)m.hide();else if(o&&"true"===o.value){var p=$("#mailthreads_"+e);p.hasClass("hide")?ajaxNew(d,void 0,(function(e){var t=setInterval((function(){var e=$("#addactionmain");""!==e.html()&&(p.html(e.html()),p.removeClass("hide"),clearInterval(t))}),100)}),"addactionmain"):p.addClass("hide")}else commonUtils.showHideLoadingDiv(!0),new AjaxAPI({id:c,url:d,params:r,callbackfn:function(){commonUtils.showHideLoadingDiv(),$("#test_"+e+",#"+c).show()}}).post()}}function handleMailsList(e,t,a,i,l,s,n,r,o,d){var c={},m=[],u=!1,p=$("#isMailAppsFlow"),g="true"===(p.length>0?p.val():getOpenerObj("isMailAppsFlow").value);e&&("error"==e.statusText?(e=e.responseJSON.message,m[0]=e,u=!0):null!=e.Emails?m=e.Emails:Array.isArray(e)?m=e:null!=e.mailsList?m=e.mailsList:(u=!0,m=e),null!=e.associatedContEmail&&(c.associatedContEmail=e.associatedContEmail)),g||3!=r||"true"!=$("#isALLOptOnly").val()||(r=5);var v=m.length;c.isScheduledMail="scheduled_in_crm"==t||"all_contacts_scheduled_crm_emails"==t;var h,f="scheduled_in_crm"==t||"ALL"==t?"ALLUSERSMAILS":t;if("all_contacts_sent_crm_emails"!=t&&"all_contacts_scheduled_crm_emails"!=t||(f="allContacts"),2==r&&(1==t?f="ZMAIL":2==t?f="IMAP":3==t&&(f="GMail")),3==r&&(f="IMAP"),3!=r&&5!=r||!Crm.userDetails.IMAP_STATUS||(f="IMAP"),!g||3!=r&&5!=r&&11!=r||(f="ZMAIL"),Crm.userDetails.mailType=f,"Deals"==i&&(i="Potentials"),c.mail_type=r,c.mailType=f,c.moduleEntityId=a,c.module=i,c.startIndex=l+1,c.toIndex=l+v,e&&e.meta&&(e.info=e.meta),e&&(e.info&&e.info.more_records||e.hasOwnProperty("disableNext")&&!e.disableNext)?c.disableNext=!1:c.disableNext=!0,c.fromIndex=l,c.noofMails=v,c.fullname=s,c.supportMailId=RebrandLinkUtil.getProperty("SUPPORTMAILID"),c.isDealsMail=n,c.emailId="",c.isZiaEnabled=!1,c.isSentimentEnabled=Crm.userDetails.emailsentimentEnabled,c.isIntentEnabled=Crm.userDetails.intentEnabled,c.isEmotionsEnabled=Crm.userDetails.isEmotionsEnabled,!JSON.stringify(m).includes("sentiment_info")&&!JSON.stringify(m).includes("intent")||3!=r&&5!=r&&"IMAP"!=f||"Quotes"==i||(c.isZiaEnabled=!0),c.isEmailSummaryEnabled=Crm.userDetails.isEmailSummaryEnabled,e&&null!=e.user_id?c.user_id=e.user_id:c.user_id=null!=d?d:null,!u)for(var C=0;C<v;C++){var y=m[C];if(null!=y.subject&&(m[C].subject=unescape(y.subject)),null!=y.summary){y.summary.includes("&nbsp;")&&(y.summary=y.summary.replaceAll("&nbsp;"," ")),y.summary.includes("&amp;")&&(y.summary=y.summary.replaceAll("&amp;","&"));m[C].summary=(h=y.summary,(new DOMParser).parseFromString(h,"text/html").documentElement.textContent)}if(g?"ews"===y.source||"EWS"===y.source||(5===r||3===r)&&"imap"===y.source||"IMAP"===y.source?m[C].viewmail="IMAP":2===r&&"GMail"!==f||"imap"===y.source||"IMAP"===y.source||"zmail"===y.source||"ZMAIL"===y.source?m[C].viewmail="ZMAIL":"GMail"!==f&&(m[C].viewmail="CRMMASSMAIL"):5!=r&&3!=r||"zmail"!=y.source&&"ZMAIL"!=y.source?"imap"==y.source||"IMAP"==y.source||"ews"==y.source||"EWS"==y.source||(2==r||3==r)&&"IMAP"==f?m[C].viewmail="IMAP":"GMail"!=f&&"ZMAIL"!=f&&(m[C].viewmail="CRMMASSMAIL"):m[C].viewmail="ZMAIL",null!=m[C].source?m[C].source=getMailSourceString(y.source):2==r&&"IMAP"==f&&(m[C].source="IMAP"),null==m[C].status){var b="Received";m[C].sent&&(b="Sent"),m[C].status=[{type:b}]}for(var w=y.to,I=null!=w?w.length:0,L=0;L<I;L++){var A=w[L];if(A.hasOwnProperty("user_name"))null!=(k=A.user_name)&&k.includes('"')&&(k=k.replace(/\"/g,""),m[C].to[L].user_name=k)}var E=y.cc,S=null!=E?E.length:0;for(L=0;L<S;L++){var R=E[L];if(R.hasOwnProperty("user_name"))null!=(k=R.user_name)&&k.includes('"')&&(k=k.replace(/\"/g,""),m[C].cc[L].user_name=k)}var T=y.bcc,_=null!=T?T.length:0;for(L=0;L<_;L++){var k,M=T[L];if(M.hasOwnProperty("user_name"))null!=(k=M.user_name)&&k.includes('"')&&(k=k.replace(/\"/g,""),m[C].bcc[L].user_name=k)}}e&&e.meta&&(e.info=e.meta);var O=$("#mailListRelId"),P=O.length>0?O.val():getOpenerObj("mailListRelId").value,D=$("div[id="+("fetch_"+P));D.hasClass("ref_loading")&&(D.removeClass("ref_loading peNone"),$(".rLETabsElement").show(),$(".rLESelectAction").hide());var U=D.prev();return U.show(),e?("string"!=typeof e?(c.next_index=null==c.next_index?null!=e.next_index?e.next_index:null!=e.info?e.info.next_index:0:c.next_index,c.mailsList=m,"canvas"==Lyte.Router.getRouteInstance().routeName&&(0==c.toIndex||Number.isNaN(c.toIndex)?U.hide():e.info?e.info.more_records?U.html(c.toIndex+"+"):U.html(c.toIndex):c.toIndex%10==0?U.html(c.toIndex+"+"):U.html(c.toIndex))):(c.mailsList=[],c.mailsList[0]=getErrorType(e),"permission_disabled"==c.mailsList[0]&&(c.permissionDisabled=e),c.partnerName=Crm.partnerName,"ticketUnavailable"==c.mailsList[0]?c.user_name=e.split(" ")[7]:"mailboxUnavailable"==c.mailsList[0]?c.user_name=e.split(" ")[9]:"currentUserMailboxUnavailable"==c.mailsList[0]?c.zmailId=e.split(" ")[2]:"errorwhileprocessing"==c.mailsList[0]&&(c.supportMailId=e.split('"link">')[1].split("</a>")[0]),U.hide()),"string"!=typeof e&&c.mailsList.length>0&&c.next_index&&c.next_index.length>5&&updateMailRange(l/10,c,"previous"==o)):(c.mailsList=[],c.mailsList[0]="permission_disabled",c.permissionDisabled=I18n.getMsg("crm.tooltip.note.insufficient.permission"),U.hide(),c.next_index=""),c.isFromNewAPI=!0,c}function getErrorType(e){return e.includes("Sorry, "+Crm.partnerName+" Mail is unavailable. Please try again later.")?"zohomailunavailable":e.includes("Customer email access in CRM is temporarily unavailable. Sorry for any inconvenience!")?"searchfunctionnotavailable":e.includes("mailbox may have been changed or deleted and is inaccessible. Please configure another mailbox.")?"currentUserMailboxUnavailable":e.includes("Unable to fetch emails from ")?"mailboxUnavailable":e.includes("Unable to display ")?"ticketUnavailable":e.includes("Sorry, we're unable to process your request. To send or receive emails, please update your ")?"currentUserTicketUnavailable":e.includes("This user has been deactivated. Backup for this user has not been initiated or completed. To back up your data or view the status of a current backup, click")||e.includes("This user has been deactivated. The administrator has not initiated a backup.")?"initiateBackup":e.includes("Sorry, you cannot view emails for this user because their account has been deactivated by your "+Crm.partnerName+" CRM administrator.")?"accountnotactive":e.includes("Email sync is in progress. You will receive an email notification once the sync is complete.")?"imap_sync_in_progress":e.includes("Sync not yet started")?"imap_sync_yet_to_start":e.includes("Sorry, we are unable to process your request. Please try again later. For assistance, contact us at")?"errorwhileprocessing":e.includes("Gmail API Authentication failed")?"gmailOAuth2Error":e.includes("the related id given seems to be invalid")||e.includes("permission denied")||e.includes("the module name given seems to be invalid")?"noAccessToRecord":"permission_disabled"}function getMailSourceString(e){return"IMAP"==e?I18n.getMsg("crm.label.email.imap"):"workflow"==e||e===I18n.getMsg("crm.workflow.alert")?featuresAvailable.AUTOMATION_NEW_MASSMAIL_SOURCES_ENABLED?I18n.getMsg("crm.label.cf.workflow"):I18n.getMsg("crm.workflow.alert"):"individual"==e?I18n.getMsg("emailSource.sendmail.option.individual"):"auto_massmail"==e?I18n.getMsg("emailSource.scheduler"):"manual_massmail"==e?I18n.getMsg("crm.module.mass.mail"):"consent_mail"==e?I18n.getMsg("crm.label.consent.email"):"datarequest_access"==e||"datarequest_rectify"==e||"datarequest_export"==e?I18n.getMsg("emailSource.sendmail.option.individual"):"outlook"==e?I18n.getMsg("emailSource.outlook.plugin"):"auto_responder"==e?I18n.getMsg("emailSource.autoresponder"):"auto_responder_follow_up"==e?I18n.getMsg("emailSource.autoresponder.followup"):"mass_email_follow_up"==e?I18n.getMsg("crm.massmail.source.followup"):"mass_primary_mail"==e?I18n.getMsg("crm.module.mass.mail"):"template_mass_mail"==e?I18n.getMsg("emailSource.sendmail.option.multiple"):"mail_merge"==e?I18n.getMsg("crm.module.mailmerge.mail"):"api"==e?I18n.getMsg("emailSource.sendmail.option.api",PartnerUtil.getBrandName()):"bcc_dropbox"==e?I18n.getMsg("emailSource.sendmail.option.bcc"):"auto_response"==e?I18n.getMsg("emailSource.autoresponder"):"webform"==e?I18n.getMsg("crm.label.webtoentity.webform"):"plugin_mail"==e?I18n.getMsg("emailSource.sendmail.pluginmail"):"imap"==e?I18n.getMsg("crm.mail.addon.imap"):"zmail"==e||"ZMAIL"==e?I18n.getMsg("crm.mail.addon.pop"):"event"==e?I18n.getMsg("emailSource.event.invitaion",[I18n.getMsg("Meeting")]):"integration_email"==e?I18n.getMsg("emailSource.integration.email"):"ews"==e||"EWS"==e?"EWS":"external"==e?I18n.getMsg("crm.label.widgets.external"):"cadence"===e?I18n.getMsg("Cadence"):"process flow"===e?I18n.getMsg("Process Flow"):"kiosk"===e?I18n.getMsg("Kiosk"):"journey"===e?I18n.getMsg("pf.journey"):"blueprint"===e?I18n.getMsg("crm.label.cf.blueprint"):"approval"===e?I18n.getMsg("crm.label.cf.approvals"):"wizard"===e?I18n.getMsg("Wizard"):I18n.getMsg("emailSource.sendmail.option.individual")}function disablePOPUsers(e){var t=[],a=e.pop_users,i=e.gmail_users;if(a||i){for(var l=a?a.length:0,s=i?i.length:0,n=0;n<l;n++){(o=a[n]).isOldFlow&&t.push(o.user_id+"_"+o.user_name)}for(var r=0;r<s;r++){var o=i[r];t.push(o.user_id+"_"+o.user_name)}var d=$("#selectMails");if(d.length>0)d[0].ltProp("disabledList",t),$L("crm-rl-users-list")[0].component.setData("isToolTipEnabled",!0);store.pushPayload("emails_rl_user",{content:"pop_users_"+$("#id").val(),data:t})}}function showMailsList(e,t,a,i,l,s,n,r,o,d,c){var m=!1,u=!1,p=csrfParamName+"="+encodeURIComponent(csrfToken),g="previous"==s;"object"==$.type(e)&&(e=$(e).val(),"Accounts"===o&&(m=!0));var v=$("#selectMails").length?$("#selectMails"):$(getOpenerObj("selectMails"));v.hasClass("onDealChange")&&(v.removeClass("onDealChange"),u=!0);var h,f=$("#id").val();h=null==d?Crm.getCrmBasePath()+"/ZMailConfig.do?action=getMailsList&isSendMail=true":Crm.getCrmBasePath()+"/ZMailConfig.do?action=getMailsList&isSendMail=false";var C=null,y=null,b=null,w=l,I=$("#isMailAppsFlow"),L="true"===(I.length>0?I.val():getOpenerObj("isMailAppsFlow").value);getObj("selectMails")?b=getObj("selectMails"):getOpenerObj("selectMails")&&(b=getOpenerObj("selectMails")),""==i&&getObj("mailListRelId")?i=getObj("mailListRelId").value:""==i&&getOpenerObj("mailListRelId")&&(i=getOpenerObj("mailListRelId").value);var A=$("#contactSelDropdownInAcc :selected");if(A.length<1&&(A=$(getOpenerObj("contactSelDropdownInAcc")).find("option:selected")),void 0!==o&&"null"!=o||!getObj("module")?void 0!==o&&"null"!=o||!getOpenerObj("module")||(o=getOpenerObj("module").value):o=getObj("module").value,"Accounts"===o&&0==A.length||"Accounts"===o&&A.length>0&&"ACCOUNTS_ALL"==A.attr("value"))h+="&mailType=ALLUSERSMAILS";else if(null==b||"IMAP_ALL"!==b.value||"Accounts"===o&&A.length>0&&"ALL"==A.attr("value"))if(!L||null===b||"POP_ALL"!==b.value||"Accounts"===o&&A.length>0&&"ALL"===A.attr("value"))if(null!=b&&"DRAFTS"===b.value)h+="&mailType=DRAFTS";else if(null===b||"ALL"===b.value||"ALL_MAIL_VIEW"===b.value||"Accounts"===o&&A.length>0&&"ALL"===A.attr("value"))h+="&mailType=ALLUSERSMAILS";else{var E=b.value;C=E.substring(0,E.indexOf("_")),y=E.substring(E.indexOf("_")+1,E.length),L||(h+=getCassMailsRange(parseInt(l),g))}else h+="&mailType=POP_ALLUSERSMAILS";else h+="&mailType=IMAP_ALLUSERSMAILS",L||(h+=getCassMailsRange(parseInt(l),g));if(null!=getObj("nextPageToken")){var S="",R=0;null!=s&&"next"===s&&(S=getObj("nextPageToken").innerHTML,R=parseInt(l)+10),null!=s&&"previous"===s&&(R=parseInt(l)-10),"undefined"!=typeof Storage&&("next"===s&&sessionStorage.setItem(R,S),h=h+"&pageToken="+(S=sessionStorage.getItem(R)))}A.length>0?"ACCOUNTS_ALL"==A.attr("value")?(e=$("#id").val(),$("#relatedMailList").hide(),$("#sendEntityMailLink").hide(),h+="&isAccountsMail=true"):"ALL"!=A.attr("value")?(e=A.attr("value"),t=A.attr("email"),$("#sendEntityMailLink").show(),$("#addNewIcP_Emails").removeClass("hide"),$("#relatedMailList").show()):(e=null==(e=$("#id").val())?getOpenerObj("id").value:e,$("#relatedMailList").hide(),$("#sendEntityMailLink").hide(),$("#addNewIcP_Emails").removeClass("dN"),h+="&entityType=allContacts"):"Potentials"==o&&(e=getObj("id")&&null!=getObj("id").value?getObj("id").value:getOpenerObj("id").value),$("#addNewIcP_Emails").removeClass("dN"),l="previous"==s?parseInt(l)-10:parseInt(l)+10,"true"==r&&commonUtils.showHideLoadingDiv(!0),"true"==d?a=getObj("entityName").value:(a.replace(/___/g,"'"),a=a.replace(/____/g,'"'));var T="Cases"===o||"Vendors"===o?$("#zs_EMAIL"):null;if(null!=t&&"null"!=t){getObj("zmailEmail")?t=getObj("zmailEmail").value:T&&(t=T.attr("value")),h=h+"&entId="+e+"&moduleId="+f+"&user_id="+C+"&user_name="+encodeURIComponent(y)+"&searchid="+encodeURIComponent(t)+"&fullname="+encodeURIComponent(a)+"&listRelationId="+i+"&module="+o+"&fromIndex="+l+"&stateinfo="+n;var _="true"===$("#isALLOptOnly").val()||getOpenerObj("isALLOptOnly")&&"true"===getOpenerObj("isALLOptOnly").value;if(!L&&null!==b&&"IMAP_ALL"===b.value&&"ALL"!==A.attr("value"))if(_&&(h+="&mailType1=IMAP_CRMMAILS"),!m&&!u)if(h+="&nav_action="+s,0!=l&&crmRelatedList.mailRange[l-10]&&crmRelatedList.mailRange[l-10].mmRange)h+="&mmLastIndex="+crmRelatedList.mailRange[l-10].mmRange.mmLastIndex;if(L&&null!==b&&"ALL_MAIL_VIEW"===b.value&&"ALL"!==A.attr("value"))if(_&&(h+="&mailType1=IMAP_POPMAILS",h+=getMailAPIRange(parseInt(w),g)),!m&&!u)if(h+="&nav_action="+s,0!==l&&crmRelatedList.mailRange[l-10]&&crmRelatedList.mailRange[l-10].mmRange)h+="&mmLastIndex="+crmRelatedList.mailRange[l-10].mmRange.mmLastIndex;var k=$L("#dealOnlyDropDown");"Potentials"===o&&k&&"dealsOnly"===k.val()&&(h+="&isDealsMail=true"),mR(h,(function(t){showMailsListHandling(t,i,l,r,s,o,e,c,g)}),p,null,r)}else getOpenerObj(i)&&(EmailSendingUtil.showFeedBack||window.self.close())}function showMailsListHandling(e,t,a,i,l,s,n,r,o){var d=$("crm-emails-related-list"),c=e;if("object"!=typeof e&&(c=JSON.parse(e)),c.toggleTableHead=!1,$(".emailTrackingDiv").hide(),"DRAFTS"===c.mailType){if(!(0==a||c&&c.draftsList&&0!==c.draftsList.length))return mailListOnly10RecordAlert(t,a),void commonUtils.showHideLoadingDiv(!1)}else if(!(0==a||c&&c.mailsList&&0!==c.mailsList.length))return mailListOnly10RecordAlert(t,a),void commonUtils.showHideLoadingDiv(!1);var m=null;if(c.hasOwnProperty("isFromNewAPI")||(m=Handlebars.templates.MailDetailsList(c)),getObj(t)){if("true"==i&&($("#zmNotifiedUsers").val(""),commonUtils.showHideLoadingDiv()),c.hasOwnProperty("isFromNewAPI")){d[0].component.setData(c);let e=$L("#ernTable");0!==e.length&&e[0].scrollTable&&e[0].scrollTable(0,0)}else $(getObj(t)).empty(),getObj(t).innerHTML=m;var u=getObj(t);placeExtra(),Crm.userDetails.isRelatedListLyteEnabled||("previous"!==l?populateRLCount(t,void 0,"nextPage"===l&&0!==a,0===a):populateRLCount(t,void 0,!1))}else if(getOpenerObj(t)||null!=opener&&opener.document.querySelector("crm-emailsrl-canvas-view")){if(c.hasOwnProperty("isFromNewAPI")){$("#id").val();c.navaction=l,c.fromIndex=a,opener.window.postMessage(JSON.stringify(c),window.location.origin)}else $(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=m;u=getOpenerObj(t);placeExtra(),"previous"!==l&&opener.populateRLCount(t,void 0,"next"===l&&0!==a),"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.isSurvey&&opener.ZSurvey.refreshSurveyPersonality(s,n),"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.isConsentEmail&&opener.DataPrivacy.loadDataPrivacy($("#newleft_DataPrivacy")),window.self.close()}else d[0].component.setData(c);var p=null;if(getObj("selectMails")?p=getObj("selectMails"):getOpenerObj("selectMails")&&(p=getOpenerObj("selectMails")),p&&(p.style.visibility="visible"),r){var g,v,h=$("#isFromNewAPI").length>0;if("first"===r)f=h?$($(".rLEmailSub")[0]):$($("#mailTable").find("tr")[1]).find(".emailSubjectEllipisis"),$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f);else if(h){if((v=(g=$("#ernTable")).find("lyte-tr.topband_dv_row").length)>1){var f=$("#ernTable").find("lyte-tr.topband_dv_row")[v-1].getElementsByClassName("emailRLSubjectText");$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f)}}else if((v=(g=$("#mailTable")).find("tr").length)>1){f=$(g.find("tr")[v-1]).find(".emailSubjectEllipisis");$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f)}}EvalInnerScript(u),d.length&&d[0].component.setData({toggleTableHead:!0}),Crm.userDetails.EMAIL_THREAD_VIEW&&Lyte.registeredMixins["crm-emailconversation-view-mixin"]&&Lyte.registeredMixins["crm-emailconversation-view-mixin"].calculateTotalWidth(),updateMailRange(parseInt(a),c,o),commonUtils.showHideLoadingDiv(!1)}function openComposeView(e,t){var a=null,i="",l="",s="",n=$("#isFromNewAPI");if(1===$("#krp_Rightpanel_InfoContainer").length||1===$("#kso_rightPanel_Card").length)i=$$rightPanel.entityId,l=$$rightPanel.currentModule;else{i=$("#id").val(),l=$("#module").val();var r=$("#subvalue_EMAIL");s=r.length?r.text():""}if("SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled)renderingUtils.displayPermissionDenied();else{if("Accounts"===l)i=$(e).attr("entityid"),l=$(e).attr("module");else if("Potentials"===l&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL){var o=$L("#dealOnlyDropDown");if(o.length>0){var d=o[0].component.data.ltPropSelected;d&&"dealsOnly"!==d&&(i=d,l="Contacts")}}var c=$("#emailDetailIframeContent"),m=$("email-summary");if(t)a=t.massMailId,i=t.entId,l=t.module,s=t.entEmailId,$L("#edvModalConversation")[0].ltProp("show",!1);else if(m.length>0&&!m.hasClass("hide")){var u=$L("#summaryMailDet");a=u.data("msgid"),s=u.data("to");var p=$L(".ernActiveSummary");if("Accounts"===l){var g=p.parent().parent().find(".rLEmailSub").data();g&&(i=g.contactid)}hideEmailSummaryDiv()}else if(c.length>0){s=null;var v=c.contents();a=v.find("#msgid").val(),s=v.find("#entity_emailAdd").val()}if(n.length>0){var h=$(".rLESelectAction");h.length>0&&"block"==h.css("display")&&$L(".ernLyteBody .ecnChkBoxtd lyte-checkbox").attr("lt-prop-checked",!1)}var f=new crmRequestPool,C=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=checkMailInQueue&massMailId="+a;f.initiate({action:C,type:"GET",success:function(e){if(null!=e&&"success"===e)if(Crm.userDetails.isNewEditor)EmailSendingUtil.entityId=i,EmailLaunchUtil.editScheduleMail(l,i,a);else{var t=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=editInCompose&massMailId="+a+"&entId="+i+"&entEmailId="+encodeURIComponent(s)+"&module="+l,n=Crm.getOrgSpecificURL(t);openPopUp("entreplyWin",this,n,"SendMail",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}else null!==e&&"Insufficient privileges to perform this operation."===e?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.besttime.mail.processed.msg"));if(c.length>0){var r=parent.$("#lookupdiv");r.parent("crm-zsurvey-rl-body").length>0&&(r=$(".showhide").find("#lookupdiv")),parent.renderingUtils.removeFreezeLayer(),parent.$("#ddm").hide(),parent.$("#kanbanTaskDetailctn").removeClass("hide"),r.hide()}store.deleteRecord("emails_rl_user",a)},error:function(){alert(I18n.getMsg("crm.unable.to.process.request"))}})}}function mailListOnly10RecordAlert(e,t){alert(I18n.getMsg("crm.label.no.more.records"));var a=$("div[ddid="+e+"]");a.find("img.next").removeClass("next").addClass("next_disabled"),("EMAILSPERSONALITY"==a.attr("ddname")||$("crm-emailsrl-canvas-view").attr("list-relation-id")==e&&"canvas"==Lyte.Router.getRouteInstance().routeName)&&$("#isFromNewAPI").length>0&&document.querySelector("crm-emails-related-list").component.setData("disableNext",!0),a.find("img.next_disabled").parent().parent().prepend(a.find("img.next_disabled")),a.find("img.next_disabled").siblings().remove(),$(getObj("newleft_"+e)).find("span.numCountVal").text(t);var i=$("#emailDetailIframeContent").contents();1==i.length&&i.find(".nextNav").addClass("eNavDisabled")}function mailPrintView(e,t,a){var i,l,s="",n="",r="";if(void 0!==t&&"null"!==t||(t=""),1===$("#krp_Rightpanel_InfoContainer").length||1===$("#kso_rightPanel_Card").length)s=$$rightPanel.entityId,n=$$rightPanel.currentModule;else if(crmNTC.isSignalDetailViewVisible()){s=(o=$("#notificationGroupList").find("li.ntc-entity-active").data("ntc-entityobj")).entityId,n=o.module,r=o.entityEmail}else if(void 0!==Lyte.registeredMixins["crm-zianotification-helper"]&&Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson&&Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson.entity_info){var o;s=(o=Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson.entity_info).entityId,n=o.module,r=o.entityEmail}else{var d;if($L(".etTrendsWrapper").length){var c=$L("crm-ziaforemails")[0].component.getData("onclickAttr");s=c.entityId,n=c.module}else if($L(".etTrendsWrapperCNS").length){s=(f=$L("crm-ziaforcns")[0].component.getData("data")).entityId,n=f.module}else s=$L("#id").val(),n=$L("#module").val(),d=document.getElementById("subvalue_EMAIL");r=null,d&&(r=d?d.innerHTML:"")}if(void 0!==a){i=a.msgid,l=a.mailUserId,s=a.entId,n=a.module;let e=Object.keys(moduleApiMapping).find((e=>moduleApiMapping[e]==a.module&&e!==moduleApiMapping[e]));if(n=e||a.module,r=a.entEmailId,!a.entEmailId){var m=$("#associatedContEmail");r=m.length>0?m.val():""}}else if($("#emailDetailIframeContent"+t).length>0){var u=$("#emailDetailIframeContent"+t).contents();i=u.find("#msgid").val(),l=u.find("#mailUserId").val(),!crmNTC.isSignalDetailViewVisible()&&u.find("#entity_emailAdd").length>0&&(r=u.find("#entity_emailAdd").val())}else if(!$("email-summary").hasClass("hide")){var p=$L("#summaryMailDet");i=p.data("msgid"),l=p.data("user_id");var g=$L("#selectMails");if(g.length>0){var v=void 0===g[0].value?g[0].getAttribute("lt-prop-selected"):g[0].value;if("IMAP_ALL"===v||"IMAP_CRMMAILS"===v)"CRMMASSMAIL"===$("#rLEmailSub_"+i).data("emailtype")&&(e="ALLUSERSMAILS")}"allContacts"===e&&(e="ALLUSERSMAILS")}var h=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action=printMail&mailUserId="+l+"&msgid="+i+"&mailType="+encodeURIComponent(e)+"&entId="+s+"&entEmailId="+encodeURIComponent(r)+"&module="+n),f=$("#contactSelDropdownInAcc :selected").attr("value"),C=$("#contactSelDropdownInAcc");if("Accounts"===n&&C.length>0&&"ACCOUNTS_ALL"!=f){if(n="Contacts","ALL"!=f){var y=C[0].component.getDropBox().querySelector(".lyteDropdownSelection").getAttribute("data-email");y&&y.indexOf(",")>-1&&(h+="&secondaryEmailId="+y.split(",")[1])}}else{var b=document.getElementById("subvalue_ADDN_EMAIL");if(b)h+="&secondaryEmailId="+(b?b.innerText:"")}openPopUp("entreplyWin",this,h,"printMail",860,570,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}function updateUsersList(e,t){var a=$("#status_"+t)[0];if(a){a.disabled="disabled";var i=$("#zmailkey")[0].value,l=Crm.getCrmBasePath()+"/ZMailConfig.do?action=updateUsersList&entId="+e+"&shareMails="+a.checked+"&zmailkey="+i,s="&"+csrfParamName+"="+csrfToken;commonUtils.showHideLoadingDiv(!0),mR(l,(function(e){commonUtils.showHideLoadingDiv();var t=$("#bulkUpdateSuccess");t.empty(),t[0].innerHTML=e,show("bulkUpdateSuccess"),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess"),a.disabled=""}),4e3)}),s)}}function getComboValues(e,t,a,i,l,s,n,r,o,d,c,m,u){var p="",g=Crm.getCrmBasePath()+"/GetComboValues.do";if(l&&l.includes("$$$")&&(l=l.split("$$$")[0]),!u||"100"===t){var v="fieldId="+e+"&module="+(void 0===l?"":l)+"&uiType="+t+"&action=workflow";s&&(v+="&allowEmpty=true"),r&&(v+="&isPotentialStage=true");var h=!1;if(t==CrmField.UITYPES.PICK_LIST&&Crm.userDetails.isMultiPipelineActivated&&e==Crm.userDetails.isMultiPipelineActivated)h=!0,store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname}).then((function(e){$(getObj("fieldValuetd1")).empty();var t=m?crmListView.BPFieldUpdateTemplate:crmListView.WFPipelineTemplate;getObj("fieldValuetd1").innerHTML=t({layouts:e,selectedPipeline:i}),thirdPartyUtils.bindSelect2($("#fieldValuetd1").find("select")),showDependentFieldsForEdit(c,i),m&&i&&ProcessBuilder.createTransformAction()}));else if(!h){var f=getHTTPObject();f&&(f.open("POST",g,!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.onreadystatechange=function(){if(4==f.readyState){if(dataStr=f.responseText.trim(),u){var e=a,l=i.split("_")[1];p+="<input class='textField newinputText datewidth cri_cal' onfocus='WFTask.bindDataTypeMergeFieldForFieldUpdate(this, "+t+")' type='text' id='fieldValue"+e+"' value='"+l+"' maxlength='50' onkeyup='blockContent(\"fieldValue"+e+"\",event);'/>"}else void 0!==n||100!==t&&"100"!==t&&t!==CrmField.UITYPES.GLOBAL_TAX?p+=null==n?"<div id='EmptyValue' class='dN'>$EMPTY</div><div id='picklistFieldDiv' class='newSelect'><span class='crm-font-regular crm-base-font-size sltSetVal sltBdr dIB'></span><select id='fieldValue"+a+"'":"<div id='EmptyValue' class='dN'>$EMPTY</div><div id='picklistFieldDiv' class='newSelect'><span class='crm-font-regular crm-base-font-size sltSetVal sltBdr dIB'></span><select id='"+n+"'":p+="<div class='cchosen mlSelect mlSelAutoWidth pR'><div class='wf_highLight'></div><span class='crm-font-regular crm-base-font-size sltSetVal sltBdr dIB'></span><select  multiple size='4' onchange='selectBoxLimitationInMultiselect(this);wfForm.setSltVal(this);' data-zcqa='select_MassUpdate_Value' id='fieldValue"+a+"'";null!=o&&(p+=" style='width:"+o+"%'"),100!=t&&t!=CrmField.UITYPES.GLOBAL_TAX&&(p+=null!=d?" onchange='"+d+";wfForm.setSltVal(this);'":" onchange=wfForm.setSltVal(this);");var s=!1,r=null,c=null;if(2===t||26===t||"2"===t||"26"===t){var m=JSON.parse(dataStr),g=[],v=m.length;for(M=0;M<v;M++)g.push(m[M].Id);for(var h=[],C=g.length,y=0;y<C;y++){var b=m[y];b.colorCode?(s=!0,h[h.length]=b):"-None-"===b.ActualValue&&(h[h.length]=b)}p+=" data-colorcode_enabled="+s+" data-picklistmap='"+JSON.stringify(h)+"' "}p+=">";var w=!1;if(2==t||26==t){var I=(L=JSON.parse(dataStr)).length;null==i&&(i="None"),t==CrmField.UITYPES.STAGE&&"None"==i&&(p+="<option id='None' value='None' actualvalue='-None-' selected>"+I18n.getMsg("crm.label.choose.stage")+"</option>");for(y=0;y<I;y++){(R=L[y])&&R.colorCode?R.DisplayValue==i||R.Id==i?(p+="<option data-colorcode='"+R.colorCode+"'value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>",r=R.colorCode,c=R.ActualValue):p+="<option data-colorcode='"+R.colorCode+"'value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>":R.DisplayValue==i||R.Id==i||"-None-"==R.ActualValue&&"None"==i?p+="<option value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>":p+="<option value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>"}s&&!c&&(t!==CrmField.UITYPES.STAGE&&t!==CrmField.UITYPES.STAGE+""||"None"!==i)&&(r=L[0].colorCode,c=L[0].ActualValue),p+="</select></div>"}else if(100==t||t==CrmField.UITYPES.GLOBAL_TAX){$("#typeSection").show();var L=JSON.parse(dataStr);if(u)var A=i.split("_");else if(void 0!==i){var E,S=(A=i.split("_"))[1].split(",");for(I=L.length,y=0;y<I;y++){var R=L[y];E=0;for(var T=0;T<S.length;T++)R.Id==S[T]&&(E=1);0==E?(p+="<option value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>",w=!0):p+="<option value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>"}}else for(I=L.length,y=0;y<I;y++){R=L[y];p+="<option value='"+R.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(R.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(R.DisplayValue)+"</option>"}p+="</select></div></tr></td>";var _="<tr id='typeSection' class= 'typeSection'> <td width='100'><div class='wf_requiredMark wf_form_lab'>"+I18n.getMsg("crm.workflow.field.to.update.Action")+"</div></td><td><label class='rbCheckHtml dIB'><input type='radio' id='OverwriteVal' class='rbRealHtml hide triggerRad' checked='checked' name='recordOrDate1'>";_+="<span class='rbHtml dIB irpR'> <span class='rbTickHtml pA'></span></span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.overwrite")+"</span></label><label class='pL15 rbCheckHtml dIB'> <input type='radio' id='AppendVal' class='rbRealHtml hide triggerRad' name='recordOrDate1'>",_+="<span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span> </span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label></td></tr> ",$("#wf_nw_fld tr:last").after(_);$("#pb_transitionAction_form");$("#isinitial").val("1"),void 0===i&&($("#OverwriteVal").prop("checked",!0),$("#AppendVal").prop("checked",!1)),null!=i&&(0==A[0]?($("#OverwriteVal").prop("checked",!0),$("#AppendVal").prop("checked",!1)):1==A[0]&&($("#AppendVal").prop("checked",!0),$("#OverwriteVal").prop("checked",!1)))}else{for(var k=dataStr.split("~~"),M=0;M<k.length;M++){var O=k[M];if(t==CrmField.UITYPES.LAYOUT){var P=O.split("|");P[0]===i?(p+="<option id='"+M+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(P[0])+"' selected>"+$ESAPI.encoder().encodeForHTML(P[1])+"</option>",w=!0):(0!=M||w||null!=i||(p+="<option id='None' value='' selected>"+I18n.getMsg("crm.pipeline.choose.layout")+"</option>"),p+="<option id='"+M+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(P[0])+"'>"+$ESAPI.encoder().encodeForHTML(P[1])+"</option>")}else O==i?(p+="<option id='"+M+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(O)+"' selected>"+$ESAPI.encoder().encodeForHTML(O)+"</option>",w=!0):p+="<option id='"+M+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(O)+"'>"+$ESAPI.encoder().encodeForHTML(O)+"</option>"}!w&&i&&"undefined"!=i&&(p+="<option id='"+M+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(i)+"' selected>"+$ESAPI.encoder().encodeForHTML(i)+"</option>"),p+="</select></div>"}var D=$(getObj("fieldValuetd"+a));if(D.empty(),getObj("fieldValuetd"+a).innerHTML=p,""==i&&($("#picklistFieldDiv").addClass("dN"),$("#EmptyValue").removeClass("dN")),null!==r)$('<span class="dIB activitesColor" data-zcqa="colorcode_selectWFupdatecolorcode" id="selectWFupdatecolorcode" style="background:'+$ESAPI.encoder().encodeForHTMLAttribute(r)+'"></span>').insertBefore("#fieldValue"+a);!0!==s||c&&"-None-"!==c?!0===s&&"-None-"!==c&&(D.removeClass("colorEnabledPKNone"),D.addClass("colorEnabledPicklist")):D.addClass("colorEnabledPicklist colorEnabledPKNone "),thirdPartyUtils.bindSelect2($("#fieldValuetd"+a).find("select")),t==CrmField.UITYPES.STAGE&&d.indexOf("handleStageSelection")>-1&&$("#fieldValue1").trigger("change")}},f.send(v))}}}function selectBoxLimitationInMultiselect(e){var t=$(e).val().length-1,a=$(e).attr("id");if(t<49&&($("#select2-"+a+"-results").show(),$("#"+a).closest("tr").removeClass("form_err_fld"),$("#"+a).closest("tr").find(".form_err_msg").remove()),t>=50){var i,l=e.parentElement.parentElement,s=$(l).attr("id");if($("#select2-"+a+"-results").hide(),renderingUtils.displayErrorDiv(s,void 0,I18n.getMsg("crm.alert.picklist.empty.message.overflow",[50])),workflow.selectedObj)i=$(e).val().filter((function(e){return workflow.selectedObj.indexOf(e)<0}));var n=$("#"+a+" option[value='"+i+"']").text();$("#"+s+" .selection ul li[title='"+n+"'] .select2-selection__choice__remove").click()}workflow.selectedObj=$(e).val()}function getOptOut(e,t,a){var i="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='fieldValue"+t+"' value='0'/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span></label>";1==a&&(i="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='fieldValue"+t+"' value='1' checked/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span></label>"),$(getObj("fieldValuetd"+t)).empty(),getObj("fieldValuetd"+t).innerHTML=i}function checkWFDupFields(e,t){for(var a=getObj("fieldOption1").value.split("&&&"),i="",l=2;l<e+1;l++){if(i=getObj("fieldOption"+l).value.split("&&&"),a[0]==i[0])return alert(t),!1}if(3==e){var s=getObj("fieldOption2").value.split("&&&");if(i[0]==s[0])return alert(t),!1}return!0}function enableZMailConfig(e,t){if("ActivateUser"==e||"purchase"==e)return alert(t),!1;if(-1===jQuery.inArray("mail",usernameNotNeeded))commonUtils.checkUsernameNeeded((function(){enableZMailConfig(e,t)}),"mail");else{var a=Crm.getCrmBasePath()+"/ZMailConfig.do?action=zmailLoginPage";"enabled"==e&&(a=Crm.getCrmBasePath()+"/ZMailConfig.do?action=checkConfiguration&isAjax=true"),commonUtils.showHideLoadingDiv(!0),mR(a,(function(e){if(commonUtils.showHideLoadingDiv(),$("#helpdesk").hasClass("cobclicked")){$("#cobdiv").show(),$("#cobdiv .zcrm-content").html(e),renderingUtils.freezeBackground()}else{var t=document.getElementById("result");$(t).empty(),t.innerHTML=e,EvalInnerScript(t)}}))}}function mailconfiguration(e,t){document.getElementById("currentmail"),document.getElementById("currentmailwithshare"),document.getElementById("currentmailTR"),document.getElementById("currentmailwithshareTR"),document.getElementById("currentmailwithglobalshareTR");var a=document.getElementById("sharingExcludes");$("#helpdesk").hasClass("cobclicked")&&(a=document.querySelector("#cobdiv #sharingExcludes")),"PR"==e?($("#excludeDiv").hide(),a.style.display="none",$("#currentmailTR").css("background-color","var(--bg_F8FAFF)"),$("#currentmailwithglobalshareTR").css("background-color","var(--bg_white)"),$("#currentmailwithshareTR").css("background-color","var(--bg_white)")):"RS"==e?(document.getElementById("plsInfoSpan").style.display="block",document.getElementById("glsInfoSpan").style.display="none",$("#currentmailwithshareTR").css("background-color","var(--bg_F8FAFF)"),$("#currentmailwithglobalshareTR").css("background-color","var(--bg_white)"),$("#currentmailTR").css("background-color","var(--bg_white)"),$("#excludeDiv").hide(),a.style.display="none"):"GLS"==e&&(document.getElementById("plsInfoSpan").style.display="none",document.getElementById("glsInfoSpan").style.display="block",document.getElementById("alertDiv").style.display="block",$("#cobdiv_alert .zcrm-content").html($("#alertDiv").show()),$("#excludeDiv").show(),a.style.display="inline-block",$("#currentmailwithglobalshareTR").css("background-color","var(--bg_F8FAFF)"),$("#currentmailTR").css("background-color","var(--bg_white)"),$("#currentmailwithshareTR").css("background-color","var(--bg_white)"),crmui.showPopup("cobdiv_alert")),document.getElementById("mailOption").value=e}function proceedZMailConfigSave(){renderingUtils.removeFreezeLayer(),$("#switchIMAPWarning").hide(),$("#imapConfigStatus").attr("data-confirm","true"),$(document.zloginForm).submit()}function zmailFormValidate(e,t,a,l){var s=$("#imapConfigStatus");if("true"===s.val()&&"false"===s.attr("data-confirm"))return renderingUtils.freezeBackground(),mailsetCenter("switchIMAPWarning"),!1;var n=document.getElementById("mailOption").value;if(($('input[id="zmailAccountId"]').val($("#mailBoxNameSSO1 option:selected").attr("accId")),"GLS"==n)&&!AdminEmailSharing.handleExcludeDomain())return!1;I18n.getMsg("mailbox");if("PR"==n&&0==$("#mailboxdiv").length)return alert(e),!1;if("RS"==n&&0==$("#mailboxdiv").length)return alert(e),!1;if("GLS"==n){var r=$("#excludeDomains").val();if(null!=r&&null!=r&&""!=r){var o=r.split(",");if(!checkSplChars("excludeDomains",a))return!1;if(o.length>10)return alert(l),!1;if(0==$("#mailboxdiv").length)return alert(e),!1;$('input[id="globalshareexclude"]').val(r)}}if($("#searchMailAliasesChk").prop("checked")&&$("input[name=searchMailAliases]:checked").length>3)return alert(fmtStr.mailaliasalert),!1;if($("#labelorfolderChk").prop("checked")){var d=new Array("`","~","!","@","#","$","%","^","&","*","(",")","+","=","[","]","\\","'",";",",",".","/","{","}","|",'"',":","<",">","?");if("folder"==$("input:radio[name=labelorfolder]:checked").val()&&!commonUtils.emptyCheck("labelorfolderName","Folder Name"))return!1;if("label"==$("input:radio[name=labelorfolder]:checked").val()&&!commonUtils.emptyCheck("labelorfolderName","Label Name"))return!1;var c=document.getElementById("labelorfolderName").value;if(c.length>50&&"folder"==$("input:radio[name=labelorfolder]:checked").val())return alert(fmtStr.folderlengthalert),!1;if(c.length>25&&"label"==$("input:radio[name=labelorfolder]:checked").val())return alert(fmtStr.labellengthalert),!1;for(i=0;i<d.length;i++)if(document.getElementById("labelorfolderName").value.indexOf(d[i])>=0)return"folder"==$("input:radio[name=labelorfolder]:checked").val()?alert(fmtStr.foldernamealert):alert(fmtStr.labelnamealert),!1}else $("labelorfolderName").val("");var m="result";return $("#helpdesk").hasClass("cobclicked")&&(m="cobdiv"),doAjaxUpdate(m,getAttr(document.zloginForm,"action"),commonUtils.formData2QueryString(document.zloginForm),(function(){crmTab.reloadTabMenu((function(){$("#toIMAP").length&&(Crm.userDetails.IMAP_STATUS=!1)}))})),!1}function cancelWizard(e){document.location.href=Crm.getCrmBasePath()+"/Customize.do?title="+e}function zmailLoginInitMethod(e,t,a,i,l){document.getElementById("currentmail"),document.getElementById("currentmailwithshare");var s=document.getElementById("currentmailTR"),n=document.getElementById("currentmailwithshareTR"),r=document.getElementById("currentmailwithglobalshareTR"),o=document.getElementById("sharingExcludes");$("#helpdesk").hasClass("cobclicked")&&(o=document.querySelector("#cobdiv #sharingExcludes")),"PR"==a?"null"!=e&&(document.getElementById("mailBoxNameSSO1").value=e,$("#mailBoxNameSSO").text(e),o.style.display="none"):"RS"==a?(s.style.backgroundColor="var(--bg_white)",n.style.backgroundColor="var(--bg_e7f2ff)",r.style.backgroundColor="var(--bg_white)","null"!=e&&($("#mailBoxNameSSO").text(e),document.getElementById("mailBoxNameSSO1").value=e,o.style.display="none")):"GLS"==a&&(s.style.backgroundColor="var(--bg_white)",n.style.backgroundColor="var(--bg_white)",r.style.backgroundColor="var(--bg_e7f2ff)","null"!=e&&(document.getElementById("mailBoxNameSSO1").value=e,$("#mailBoxNameSSO").text(e),o.style.display="block")),l&&$("#mailBoxNameSSO1").find("option[accid='"+l+"']").attr("selected","selected")}function showStatusDiv(e){$("#statusDiv").html(e),$("#helpdesk").hasClass("cobclicked")?(show("statusDiv"),setTimeout((function(){$("#statusDiv").hide()}),2e3)):(mailsetCenter("statusDiv"),setTimeout((function(){hide("statusDiv")}),2e3))}function deleteZMailConfig(){var e=Crm.getCrmBasePath()+"/ZMailConfig.do?action=delete";document.deleteForm.action=e;var t="result";$("#helpdesk").hasClass("cobclicked")&&(t="cobdiv"),doAjaxUpdate(t,getAttr(document.deleteForm,"action"),commonUtils.formData2QueryString(document.deleteForm),(function(){renderingUtils.removeFreezeLayer(),crmTab.reloadTabMenu()})),Lyte.Router.getRouteInstance().setQueryParams({action:"mailSelect"})}function showQuickCreate(e){var t=e.value;if(!isWorking&&http&&""!=t){var a="module="+t+"&fromCreate=QuickCreate",i=Crm.getCrmBasePath()+"/QuickCreateAction.do";try{http.open("POST",i,!0)}catch(e){http=getHTTPObject(),http.open("POST",i,!0)}http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(200==http.status){if(txt=http.responseText,txt.indexOf("Your login session has expired")>-1)return alert(I18n.getMsg("crm.alert.session.check")),void Utils.windowLocationReload();getObj("dashboardContent")&&(getObj("dashboardContent").style.display="none"),showDialog(txt,"position=absolute,title=<fmt:message key='crm.quickcreate.title'/>,top=100,left=100,width=335,height="+("Calls"!=t?"375":"475")+",modal=yes,closeOnEscKey=no")}isWorking=!1}},http.send(a)}document.QuickCreate.tabList.value=""}function showExportMenu(e,t,a,i,l){var s;if(hideMenu(),-1!=e.indexOf("linkDocs=true")){if(i||(i=renderingUtils.getTargetElem(event)),"undefined"!=typeof usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("zdoc",usernameNotNeeded))return commonUtils.checkUsernameNeeded((function(){showExportMenu(e,t,a,i)}),"zdoc"),!1;var n=objectUtils.URL(e).getParams();$.ajax({type:"POST",url:Crm.getCrmBasePath()+"/ZDocs.do?mode=isTrashedDocInZDocs",data:"fileId="+n.fileId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(a){if("true"==trimBoth(a)){var l=I18n.getMsg("crm.trashdoc.alert");return alert(l),!1}if($.inArray(t,["jpeg","jpg","gif","png","webp","bmp","svg"])>-1)return event.preventDefault(),$(i).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}),renderingUtils.triggerEvent("click",$(i)),!1}})}var r=a.includes("voice_"),o=$("#viewlink"),d=$("#ddm");r&&d.css({position:"fixed"});var c=$("#"+a);if("pdf"==t?(o.html(I18n.getMsg("crm.file.open")),s="pdfViewPlugin"):(s=function(){var e={sheet:["excel","xls","csv"],show:["ppt","pps"],writer:["word","txt","doc","docx","htm","html","sxw","odt","rtf"]};for(var a in e)if(e[a].indexOf(t)>-1)return a}(),o.html(I18n.getMsg("crm.view.attachment."+s,Crm.partnerName))),s?o.parent().parent().show():o.parent().parent().hide(),!Crm.userDetails.RTL_ENABLED||r){var m=$L("#setup_new_ContentDiv"),u=$("#kventitydetailspage");"true"===l&&(m=$L("#dvinner"));var p=renderingUtils.findPosX(c.get(0)),g=renderingUtils.findPosY(c.get(0))+c.height()-m.scrollTop();u.length&&(p-=u.offset().left,g=m.scrollTop()+c.offset().top-170),d.css({display:"block",left:p,top:g})}else d.css({display:"block",right:c.closest("td").prev("td").outerWidth()+40,top:c.position().top+c.height()});var v=e.split("attachName=");null!=v[1]&&(v[1]=v[1].replace("&","%26")),d.find("#downloadlink").attr("href",e+"&attach="+v[1]+"&downLoadMode=default"),"pdf"==t?o.attr("href","javascript:openSheetForExport('"+encodeURI(e)+"&downLoadMode=pdfViewPlugin','pdfViewPlugin')"):o.attr("href","javascript:openSheetForExport('"+encodeURI(e)+"&downLoadMode="+s+"')")}function openSheetForExport(e,t){var a=e.split("downLoadMode="),i=a[1];if("pdfViewPlugin"==t){var l=a[0].split("attachName=");Crm.userDetails.DOWNLOAD_SERVER_FLOW?networkUtils.openUrl(e):networkUtils.openUrl(e+"&attach="+encodeURIComponent(l[1]))}else if("undefined"!=typeof usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray(i,usernameNotNeeded)&&"viewer"!=i)commonUtils.checkUsernameNeeded((function(){openSheetForExport(e,t)}),i);else{l=a[0].split("attachName=");var s=e+"&attach="+encodeURIComponent(l[1]);mR(s,(function(e){var t=e.split("||"),a=t[1],i=t[3],l=httpprotocol+t[5];"writer"==i?networkUtils.openUrl(t[6]):"sheet"==i?a.includes("sheet")?networkUtils.openUrl(a):networkUtils.openUrl(l+"/sheeteditor.do?doc="+a):"show"==i?networkUtils.openUrl(t[6]):"viewer"==i&&window.open(l+"/apidoc/"+a)}))}}function openForDocs(e,t,a,i){var l=$("#multipleFieldsEditPop").is(":visible");if($("#attachOptionsFromDetailMenu,#eventActionsMenu").hide(),i&&(fileupload.fromFileUploadField=!0),"undefined"!=typeof usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray(e,usernameNotNeeded)){var s=e;"gcontacts"!=e&&"gdoc"!=e||(s="gadgets"),commonUtils.checkUsernameNeeded((function(){openForDocs(e,t,a)}),s)}else{var n=window.location.protocol;if("zdoc"==e){var r={servicename:"zcrm",attachCount:"5",docsURL:RebrandLinkUtil.getProperty("docsStaticUrl")};ATTACHDIALOG.showAttachFileDialog(r)}else if("gcontacts"==e)var o="<iframe id='zohodocsframe' height='500px' frameborder='0' width='650px' src='"+httpprotocol+"localgadgets.zoho.com/gcontacts?zservice=zcrm&serURL="+encodeURIComponent(n+"//localhost:9090/jsp/integration/gcontacts.jsp")+"'> </iframe>";else{var d;if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL)var c=CrmPlusLib.getFrameOriginForURL()+",";d=c?encodeURIComponent(c+n+"//"+a):encodeURIComponent(n+"//"+a),1==i?(o='<iframe id="zohodocsframe" height="500px" frameborder="0" width="650px" src="'+httpprotocol+t+"/gdocs?zservice=zcrm&serURL="+encodeURIComponent(n+"//"+a+"/crm/Gdocs.do?fromFileUploadField=true&moduleVal="+fileupload.module+"&FieldId="+fileupload.fieldID)+"&frameorigin="+d+'"></iframe>',fileupload.fromFileUploadField=!1):o='<iframe id="zohodocsframe" height="500px" frameborder="0" width="650px" src="'+httpprotocol+t+"/gdocs?zservice=zcrm&serURL="+encodeURIComponent(n+"//"+a+"/crm/Gdocs.do")+"&frameorigin="+d+'"></iframe>'}o&&($("body").append('<div id="freezeBackGround_gdocs" style="display:block"></div>'),getObj("attachdialogdiv").style.display="block",$(getObj("attachdialogdiv")).html(o),l&&$("#attachdialogdiv").css("z-index","40"),mailsetCenter("attachdialogdiv"))}}function check(e,t,a,i,l){if(commonUtils.emptyCheck("assignedto","Owner Name")){null==document.changeEntityOwner.notify?document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+l:document.changeEntityOwner.notify.checked?document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+l+"&notify=true":document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+l+"&notify=false";var s=document.getElementById("saveBtn");s.disabled=!0,s.style.opacity="0.7",document.changeEntityOwner.id.value=i,document.changeEntityOwner.submit()}}function deleteAction(e,t,a,i){var l=$("#deletepopup");if(e.indexOf("closeTask.do")>-1){"string"==typeof(s=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(s="true"===s);var s,n=networkUtils.parseUrl(e).params;if(($("#showDontAskOption").prop("checked")||s)&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),s=!0,"Activities"!==n.module&&"Tasks"!==n.module&&"Home_Tasks"!==n.module||localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0)),"string"==typeof(s=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(s="true"===s),!s&&"hidden"===l.css("visibility")){var r=window.event,o=renderingUtils.getTargetElem(r);return void showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.yes","","",o,void 0,"primarybtn",!0)}}document.deleteForm.action=e,document.deleteForm.method="post";var d="show";getObj("setupshow")&&(d="result",getObj("subTabBottomDiv")&&(d="subTabBottomDiv"));if(1==t)document.deleteForm.submit(),l.is(":visible")&&hideAnimatePopup("deletepopup");else{var c=!1;n=networkUtils.parseUrl(e).params;if(e.indexOf("closeTask.do")>-1&&(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks"))){c=!0,Crm.VR||(Crm.VR={});var m=Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+n.taskid+"&module=Tasks&format=json";if(Crm.VR.ajaxEditFieldLabel="STATUS",!i)return void Crm.downloadValidationRules(m,"Tasks",(function a(){deleteAction(e,t,a,!0)}))}if(e.indexOf("closeTask.do")>-1&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))){renderingUtils.freezeBackground();var u={module:"Tasks",entityId:n.taskid,layoutId:""};return c&&(u.includeVR=!0),u[csrfParamName]=encodeURIComponent(csrfToken),void(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:u,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),Crm.jsonDepValues.Tasks=JSON.parse(returnJson.Tasks.fieldDependency),c&&(Crm.VR.entityDetails=returnJson,Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON)),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list");var i=CFRExec.getTaskCompletedOptionLabel("list");if(CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",i)){hideAnimatePopup("deletepopup");var s={};s.moduleid=n.taskid,s.module="Tasks",s.columnName="STATUS",s.fieldValue=i,networkUtils.setCsrfParam(s);var r=$("#showDontAskOption").prop("checked"),o=$("#notifyOwnerOption").prop("checked"),m=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof m&&(m="true"===m),m||(r&&(s.isDontAskAgainChecked=r),s.isNotifyOwnerChecked=o),s.check={type:"closeTask",module:"Tasks",id:n.taskid,url:e},s.check.from="dashboard",CFRExec.haltStageChange(s)}else c?new Promise((function(t){t(evalVRForDbTaskClose(n,e))})).then((function(e){e||(renderingUtils.removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),l.is(":visible")&&hideAnimatePopup("deletepopup"))})):(renderingUtils.removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),l.is(":visible")&&hideAnimatePopup("deletepopup"))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}})}if(c)return renderingUtils.freezeBackground(),(u={module:"Tasks",entityId:n.taskid,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),u.onlyEntityDetails=!0,u.includeVR=!0,void(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:u,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),Crm.VR.entityDetails=$.parseJSON(t.entityInfo),Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),new Promise((function(t){t(evalVRForDbTaskClose(n,e))})).then((function(e){e||(renderingUtils.removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),l.is(":visible")&&hideAnimatePopup("deletepopup"))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}});doAjaxUpdateForm(d,document.deleteForm,a),l.is(":visible")&&hideAnimatePopup("deletepopup")}l.is(":visible")&&hideAnimatePopup("deletepopup")}function evalVRForDbTaskClose(e,t){var a=CVRExec.getTaskCompletedUserValue();return CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(i){if(!i){hideAnimatePopup("deletepopup");var l={};l.moduleid=e.taskid,l.module="Tasks",l.columnName="STATUS",l.fieldValue=a;var s=$("#showDontAskOption").prop("checked"),n=$("#notifyOwnerOption").prop("checked"),r=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);return"string"==typeof r&&(r="true"===r),r||(s&&(l.isDontAskAgainChecked=s),l.isNotifyOwnerChecked=n),networkUtils.setCsrfParam(l),l.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},l.check.from="dashboard",CVRExec.storeCachedParams(l),!0}return!1}))}function selectPermaLink(e,t){var a=document.querySelector("#tabNameLyte");""==a.ltProp("value").trim()&&(e=e.replace(/_/g," "),a.ltProp("value",e)),document.querySelector("#link").ltProp("value",t),$("#save_webTab").removeClass("inActiveSec"),closeownernamedialog()}function cancel(){document.location.href=Crm.getCrmBasePath()+"/SaveCreator.do?action=webTab"}function addToGTask(e){var t=Crm.getCrmBasePath()+"/GApps.do?mode=CheckGTask&isListView=true";renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(!0);var a=csrfParamName+"="+encodeURIComponent(csrfToken);mR(t,(function(t){var a=t;if(commonUtils.showHideLoadingDiv(),"true"==a)renderingUtils.removeFreezeLayer(),addCrmTaskIdsToGTask(e);else{taskArr=e;document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;$("#lookupdiv").css({display:"block","z-index":"30",width:"650px",position:"absolute"}),$("#lookupdiv").html(a),mailsetCenter("lookupdiv")}}),a)}function addCrmTaskIdsToGTask(e){renderingUtils.freezeBackground();var t=getObj("imageLoading"),a=csrfParamName+"="+encodeURIComponent(csrfToken);t.style.display="block",mailsetCenter("imageLoading");var i=Crm.getCrmBasePath()+"/GApps.do?mode=GTaskSync&taskIds="+e;mR(i,(function(e){var t="gCalMessageDiv";$("#"+t).empty(),document.getElementById(t).innerHTML=e,getObj("imageLoading").style.display="none",renderingUtils.removeFreezeLayer(),getObj("gCalMessageDiv").style.display="block",mailsetCenter("gCalMessageDiv"),$("#gCalMessageDiv").fadeOut(2e3)}),a)}function addToGCal(e,t,a,i,l,s,n,r,o,d,c){var m="",u=crmTab.getFromCache(e);if(0==u.body.length)return alert(I18n.getMsg("crm.alert.select.one")),!1;if(0==(m=u.selectedIds).length)return alert(I18n.getMsg("crm.alert.select.one")),!1;if(m=m.join(","),crmListView.startIndex={},!(t.indexOf("Events")>-1))return addToGTask(m),!1;renderingUtils.freezeBackground(),getObj("imageLoading").style.display="block",mailsetCenter("imageLoading");var p=Crm.getCrmBasePath()+"/GApps.do?mode=GCalSync&eventIds="+m;mR(p,(function(e){var t="gCalMessageDiv";$("#"+t).empty(),document.getElementById(t).innerHTML=e,getObj("imageLoading").style.display="none",renderingUtils.removeFreezeLayer(),getObj("gCalMessageDiv").style.display="block",mailsetCenter("gCalMessageDiv"),$("#gCalMessageDiv").fadeOut(2e3)}))}function GMailConfig(){var e=document.gmailConfForm.incomingUser.value,t=document.gmailConfForm.incomingPasswd.value;if(""==trim(e))return alert(I18n.getMsg("crm.alert.GApps.userId")),!1;if(""==trim(t))return alert(I18n.getMsg("crm.alert.GApps.password")),!1;renderingUtils.freezeBackground(),getObj("gmailConfigDiv").style.display="none";var a=getObj("imageLoading");a.style.display="block",mailsetCenter("imageLoading");var i=csrfParamName+"="+encodeURIComponent(csrfToken),l=Crm.getCrmBasePath()+"/GApps.do?mode=GMailConfig&incomingUser="+e+"&incomingPasswd="+t;return mR(l,(function(e){renderingUtils.removeFreezeLayer();var t=e,i=document.getElementById("result");$("#result").empty(),i.innerHTML=t,document.gmailConfForm.reset(),a.style.display="none",getObj("gmailMessageDiv").style.display="block",mailsetCenter("gmailMessageDiv")}),i),!1}function openCRMGadGets(e,t){var a=window.location.protocol;renderingUtils.freezeBackground();var i="<iframe id='zohoGadgetsframe' height='500px' frameborder='0' width='650px' src='"+a+"//"+RebrandLinkUtil.getProperty("GadGetsURL")+"/embed/crm/"+e+"?title="+t+"'> </iframe>";getObj("mainGadgetsDiv").style.display="block",$("#gadgetsdiv").empty(),getObj("gadgetsdiv").innerHTML=i,mailsetCenter("mainGadgetsDiv")}function openEGadgets(e,t){if("google"==e){var a=httpprotocol+"www.google.com/ig/directory?url=hosting.gmodules.com/ig/gadgets/file/112646789256826398286/";"tasks"==t?window.open(a+"ZohoCRMTasks.xml"):"contacts"==t?window.open(a+"ZohoCRMContacts.xml"):"leads"==t?window.open(a+"ZohoCRMLeads.xml"):"accounts"==t&&window.open(a+"ZohoCRMAccounts.xml")}else{var i=httpprotocol+"www.orkut.co.in/Main#AppInfo.aspx?appUrl="+httpprotocol+"hosting.gmodules.com/ig/gadgets/file/112646789256826398286/";"tasks"==t?window.open(i+"ZohoCRMTasks_Embed.xml&objs=&sn=&ref=SR"):"contacts"==t?window.open(i+"ZohoCRMContacts_Embed.xml&objs=&sn=&ref=SR"):"leads"==t?window.open(i+"ZohoCRMLeads_Embed.xml&objs=&sn=&ref=SR"):"accounts"==t&&window.open(i+"ZohoCRMAccounts_Embed.xml&objs=&sn=&ref=SR")}}function hideQuickCreate(){var e=getObj("ph3"),t=getObj("h3");null!=e&&null!=t&&(t.style.display="none",e.style.display="none")}function splitDialCode(e){var t=document.getElementById("dialCodeBackUp")[e].value.split(";");document.getElementById("groupName").selectedIndex=e;var a=document.createElement("SELECT");if(a.setAttribute("id","dialCode"),a.setAttribute("name","dialCode"),a.className="select",a.onchange=function(){phoneFormat()},document.getElementById("dialLabel").appendChild(a),valueArray=t,labelArray=t,t.length>1){$("#dialLabel").empty();for(var i=0;i<valueArray.length;i++){if(0==i){(l=document.createElement("option")).text="-None-",l.value="";try{a.add(l,null)}catch(e){a.add(l)}}(l=document.createElement("option")).text=changeDialCodeShape(valueArray[i]),l.value=changeDialCodeShape(labelArray[i]);try{a.add(l,null)}catch(e){a.add(l)}}document.getElementById("dialLabel").appendChild(a),$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value}else if(1==t.length&&""!=t&&"NOPREFIX"!=t){$("#dialLabel").empty();for(i=0;i<valueArray.length;i++){if(0==i){(l=document.createElement("option")).text="-None-",l.value="";try{a.add(l,null)}catch(e){a.add(l)}}var l;(l=document.createElement("option")).text=changeDialCodeShape(valueArray[i]),l.value=changeDialCodeShape(labelArray[i]);try{a.add(l,null)}catch(e){a.add(l)}}document.getElementById("dialLabel").appendChild(a),$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value}else $("#dialLabel").empty(),document.getElementById("dialLabel").innerHTML=document.getElementById("dialCodeBackUp")[e].value,$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value;phoneFormat()}function changeDialCodeShape(e){var t=new Array,a="";return t=e.split(":"),null!=e&&(a=t[0],""!=t[1]&&null!=t[1]&&(a+="("+t[1]+")")),a}function phoneFormat(){$("#phoneLabel").empty(),null!=document.getElementById("dialCode")&&null!=document.getElementById("dialCode")?dialCode=document.getElementById("dialCode").value:dialCode=document.getElementById("dialLabel").innerHTML;var e=splitByPattern("\\((.*?)\\)",dialCode);e=""!=e?e+"-":"",$("#phoneLabel").empty(),document.getElementById("phoneLabel").innerHTML=e+document.getElementById("toNumber").value}function showCFoffectedRecords(e,t,a,i,l){var s=a;$(getElemById(t+"div"));if("scoringRule"!==t){if(i){var n=$(document.createElement("div"));n.attr("id",t+"head").addClass("denyHead crm-font-regular wfcustomActionHead").text(I18n.getMsg("crm.workflow.title")+" "+t),n.insertAfter($("#wfDGdiv"));var r=$(document.createElement("div"));r.attr("id",t+"div").addClass("ncff wfcustomActionDiv"),r.insertAfter(n)}else null!=getElemById(t+"head")&&(getElemById(t+"head").style.display="",getElemById(t+"div").style.display="","kanban"===t&&(getElemById(t+"head").classList.remove("dN"),getElemById(t+"div").classList.remove("dN")));var o=document.createElement("ul"),d={},c=[];for(var m in e){var u=e[m];"canvasUsed"===t&&(u=[e[m].name]),"voc"!==t&&"voc_config"!==t&&"voc_components"!==t||(u=[e[m]]),"canvasUsed"===t&&(u=[e[m].name]),"ziaSimilarity"===t&&(u=e[m]),"kanban"===t&&(u.name&&(u[0]=u.name),u.cvId&&(s=Crm.getCrmBasePath()+"/tab/"+u.module+"/custom-view/"+u.cvId+"/kanban?kvId="+m+"&action=edit")),"timeline"===t&&(u.name&&(u[0]=u.name),u.cvId&&(s=Crm.getCrmBasePath()+"/tab/"+u.module+"/custom-view/"+u.cvId+"/timeline?action=edit")),"chart"===t&&(u.name&&(u.name="CUSTOM_VIEW"===u.feature_type?u.name:void 0,u[0]=u.name),u.cvId&&(s=Crm.getCrmBasePath()+"/tab/"+u.module+"/custom-view/"+u.cvId+"/chart?chart_id=")),"dbComponents"==t||"wizardUsed"===t?u.name&&(u.name=("dbComponents"===t&&u.feature_type&&u.feature_type,u.name),u[0]=u.name):"bPTransCriRule"==t?u[0]=u.ProcessName:("reports"===t&&u.name||"kiosks"===t||"datahubs"===t)&&(u[0]=u.name),u[0]=$ESAPI.encoder().encodeForHTML(u[0]),(w=document.createElement("li")).setAttribute("class","p3 pL0");I=document.createElement("a");$(I).empty(),I.innerHTML=u[0];a=s;if(i){var p=u[2];a+=p+"&actionId="+m}else if("dbComponents"===t)"cpq"===u.feature_type?a=Crm.getCrmBasePath()+"/tab/Quotes":0===u.presence?a=Crm.getCrmBasePath()+"/tab/Dashboards/deleted?tab=Component":0===u.dashboardPresence?a=Crm.getCrmBasePath()+"/tab/Dashboards/deleted?tab=Dashboard":a+=u.dashboardid+"&chooseComponent="+m;else if("reports"===t)void 0===u.presence||u.presence?a+=m:a+="list?category=deleted";else if("portals"===t)a+=m;else if("segmentCriteria"===t||"segmentField"===t)a=a+m+"/edit?step=1";else if("abmConfig"===t)a="RFM"===m?s+"techniques/rfm":"Firmographic"===m?s+"techniques/firmographic":"Data enrichment fields mapping"===u[0]?s+"enrichment/mapping":s+m;else if("abmSegment"===t)a=s+m+"/home";else if("abmSegmentCampaignsListCriteria"===t)a=s+m+"/home";else if("lookupFilter"===t||"dynamiclookupFilter"===t)if(4===u.length)a+=u[1]+"&module="+u[2];else{let e=Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].plural_label===u[3]}));a+=u[1]+"&module="+e[0]}else if("rollupField"===t)u[2]=idModuleMapping[u[1]],u[3]=moduleRecordMapping[u[2]].plural_label,a=a.replace("${module}",u[2]);else if("ziaSimilarity"===t||"lockingRules"===t||"ZiaCallTranscript"===t||"DataEnrichment"===t)a=s;else if("canvasUsed"===t){var g="FormView"===e[m].feature?"formview":"detailview",v=s.replace("detailview",g);v=v.replace("DetailView",e[m].feature),a=v+"&feature="+e[m].feature}else if("calSch"===t){var h=getElemById("module"),f=h?h.value:"Events";if("Appointments"===f&&(f=moduleApiMapping.Appointments),isnewCalendarBookingEnabled)if(u[1].includes("_confirmmail")||u[1].includes("_reschedulemail")||u[1].includes("_cancelmail")||u[1].includes("_remindermail")){var C={route:"crm.settings.section.crm-templates",queryParams:{name:u[1],step:"edit",feature_name:"CalendarBookings__s",templateId:u[1].split("_")[0],type:"email"}};a=Lyte.Router.getURL(C)}else a=a+"/"+m+"/view?module="+u[2]+"&type="+u[1];else a=a+"/"+m+"/edit?module="+f+"&type="+u[1]}else"wfDG"===t?a=a+m+"Row":"customButton"===t||"customLink"===t?a=a.replace("${module}",u[3]):"wizardUsed"==t?a=a+m+"?layoutid="+l:"territory"===t||"cpqProductConfigurator"===t||"cpqPriceRule"===t||"cpqGuidedSellingRule"===t?a=a+m+"/edit":"visionRulesOfLayout"===t?a+=m:"sharingRules"===t?a=a.replace("{id}",m):("webForm"!==t&&"pet"!==t&&"ef"!==t&&"voc_config"!==t&&"kanban"!==t&&"timeline"!==t||"wfAlert"===t||"portalsCriteriaDetails"===t)&&(a+=m);if("formRule"!=t&&"vR"!=t||(a=a+"&layoutId="+u[1]),"pfTransRule"===t&&(a+="/view"),"pet"===t&&(I.innerHTML=u[1]+" - "+u[0]+" ("+u[2]+")",a=a+"/settings/client-portal/user-types/"+u[3]+"/folders/"+u[4]+"/templates/"+m),"voc_components"===t&&(a=s+m.split("#####")[2],I.innerHTML+=" - "+m.split("#####")[1]),"st"===t&&(a=(a=a.replace(m,""))+"/settings/workflow-sms-notifications/templates/"+m),"wt"===t&&(a=(a=a.replace(m,""))+"/settings/workflow-whatsapp-notifications/templates/"+m),I.setAttribute("href",a),I.setAttribute("target","_blank"),"layout"===t)"-1"===u[1]||!CrmPageLayout.isMPLAvailable&&!CrmPageLayout.isMPLInGracePeriod?($(w).empty(),w.innerHTML=u[0]):w.appendChild(I),d[u[0]]=w,c.push(u[0]);else if("bPTransCriRule"===t)w.appendChild(I),u.Transitions.forEach((function(e){var a=document.createElement("span");a.innerHTML="vR"!=t?" -  "+e:"( "+e+" )",a.setAttribute("class","mL10");var i=w.cloneNode(!0);i.appendChild(a),o.appendChild(i)}));else if("lookupFilter"===t||"dynamicLookupFilter"===t||"rollupField"===t){moduleRecordMapping[u[2]].visible||(I.setAttribute("href","#"),$(I).on("click",(function(){return renderingUtils.showCustomAlert(I18n.getMsg("crm.lookupfilter.fielddelete.modulehidden.error")),!1}))),w.appendChild(I);var y=document.createElement("span");u.length>4?y.innerHTML="("+I18n.getMsg("crm.label.module")+":"+$ESAPI.encoder().encodeForHTML(u[4])+")":y.innerHTML="("+I18n.getMsg("crm.label.module")+":"+$ESAPI.encoder().encodeForHTML(u[3])+")",y.setAttribute("class","mL5"),w.appendChild(y),o.appendChild(w)}else if("ef"===t)w.appendChild(I),o.appendChild(w);else if("kiosks"===t)e[m].components?e[m].components.forEach((function(e){var t=document.createElement("a");$(t).empty(),t.setAttribute("href",a),t.setAttribute("target","_blank"),t.innerHTML=u[0]+" > "+e.subtype_name,"decision"===e.subtype&&(t.innerHTML=t.innerHTML+" > "+e.path_details);var i=w.cloneNode(!0);i.appendChild(t),o.appendChild(i)})):(w.appendChild(I),o.appendChild(w));else if("datahubs"===t)I.href=Crm.getCrmBasePath()+"/settings/queries?queryId="+m,w.appendChild(I),o.appendChild(w);else{if(w.appendChild(I),"bPTransRule"==t||"orchTransRule"==t||"bPTransAction"==t||"vR"==t&&null!=u[2])(y=document.createElement("span")).innerHTML="vR"!=t?" -  "+u[1]:"( "+u[2]+" )",y.setAttribute("class","mL10"),w.appendChild(y);else if("pfTransRule"===t){(y=document.createElement("span")).innerHTML="( "+u[1]+" ) - "+u[2],y.setAttribute("class","mL5"),I.appendChild(y)}else"voc"!==t&&"voc_components"!==t&&"voc_config"!==t||document.getElementById(t+"head").classList.remove("hide");o.appendChild(w)}}if("layout"===t){c=c.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}));for(var b=0;b<c.length;b++){var w=d[c[b]];o.appendChild(w)}}$(getElemById(t+"div")).html(""),getElemById(t+"div").appendChild(o)}else{if(0===$("#"+t+"head").has("a").length){var I=document.createElement("a");$(I).empty(),I.innerHTML=I18n.getMsg("crm.label.scoring.rules"),I.setAttribute("href",a),I.setAttribute("class","mL5"),I.setAttribute("target","_blank"),getElemById(t+"head").appendChild(I)}getElemById(t+"head").style.display=""}}function deleteCRFWarning(e,t,a,i,l,s,n,r,o,d){n=null!=n&&n,gblid=e,renderingUtils.freezeBackground();var c=$("#gameDashboardhead");c.hide();var m=$("#gameDashboarddiv");m.empty();var u=!1,p=document.getElementById("cvdiv"),g=$("#assRestDiv");g.empty(),$("#cadencesdiv,#itdiv,#businessCardDiv,#paUsedDiv,#ffdiv,#afdiv,#etdiv,#efdiv,#stdiv,#wtdiv,#petdiv,#cvdiv,#predictiondeldiv,#churndeldiv,#recommendationdeldiv,#ziacallanalyticsdeldiv,#wfOnFUdiv,#wfTaskdiv,#wfFUdiv,#macroFUdiv,#wfTBAdiv,#pfCridiv,#wfCridiv,#kiosksdiv,#datahubsdiv,#wfWHdiv,#wfDGdiv,#mailParserdiv,#convertLeadMappingdiv,#cpqProductConfiguratordiv,#cpqPriceRulediv,#soConvertMappingdiv,#quoteConvertMappingdiv,#territorydiv,#layoutdiv,#approvalRuleCridiv,#gametrophydeldiv,#gamebadgedeldiv,#autofollowdiv,#wftagActiondiv,#bPRulediv,#bPTransRulediv,#bPTransActiondiv,#assRuleDiv,#caseEscDiv,#vRdiv,#dbComponentsdiv,#reportsdiv,#calSchdiv,#lookupFilterdiv,#customButtondiv,#customLinkdiv,#wfAlertdiv,#alertCriteriadiv,#automationdiv,#orchTransRulediv,#reviewprocessCridiv,#reviewprocessdiv,#segmentCriteriadiv,#segmentFielddiv,#abmConfigdiv,#abmSegmentdiv,#abmSegmentCampaignsListCriteriadiv,#bPTransCriRulediv,#wizardUseddiv,#currencyISODiv,#visionRulesOfLayoutdiv #sharingRulesFUDiv,#lockingRulesdiv,#dataEnrichmentdeldiv,#enrichUseddiv,#kanbandiv").empty();var v=$("#assRestHead");if(0==n){getElemById("ithead").style.display="none",getElemById("ffhead").style.display="none",getElemById("afhead").style.display="none",getElemById("paUsedHead")&&(getElemById("paUsedHead").style.display="none"),getElemById("efhead")&&(getElemById("efhead").style.display="none"),getElemById("businessCardHead").style.display="none",getElemById("businessCardHead1").style.display="none",getElemById("ethead").style.display="none",getElemById("sthead")&&(getElemById("sthead").style.display="none"),getElemById("wthead")&&(getElemById("wthead").style.display="none"),getElemById("pethead").style.display="none",getElemById("predictiondelhead")&&(getElemById("predictiondelhead").style.display="none"),getElemById("churndelhead")&&(getElemById("churndelhead").style.display="none"),getElemById("recommendationdelhead")&&(getElemById("recommendationdelhead").style.display="none"),getElemById("ziacallanalyticsdelhead")&&(getElemById("ziacallanalyticsdelhead").style.display="none"),getElemById("dataEnrichmentdelhead")&&(getElemById("dataEnrichmentdelhead").style.display="none"),getElemById("enrichUsedhead")&&(getElemById("enrichUsedhead").style.display="none"),getElemById("wizardUsedhead").style.display="none",getElemById("portalsCriteriaDetailshead")&&(getElemById("portalsCriteriaDetailshead").style.display="none"),getElemById("canvasUsedhead")&&(getElemById("canvasUsedhead").style.display="none"),getElemById("ziaSimilarityhead")&&(getElemById("ziaSimilarityhead").style.display="none"),getElemById("ZiaCallTranscripthead")&&(getElemById("ZiaCallTranscripthead").style.display="none"),getElemById("wfTaskhead").style.display="none",getElemById("wfFUhead").style.display="none",getElemById("wfAlerthead").style.display="none",getElemById("alertCriteriahead")&&(getElemById("alertCriteriahead").style.display="none"),getElemById("mailParserhead").style.display="none",getElemById("macroFUhead").style.display="none",getElemById("reviewprocessCrihead")&&(getElemById("reviewprocessCrihead").style.display="none"),getElemById("reviewprocessCridiv").style.display="none",getElemById("reviewprocesshead").style.display="none",getElemById("reviewprocessdiv").style.display="none",getElemById("wfTBAhead").style.display="none",getElemById("wfCrihead").style.display="none",getElemById("kioskshead").style.display="none",getElemById("datahubshead").style.display="none",getElemById("wfWHdiv").style.display="none",getElemById("wfDGdiv").style.display="none",getElemById("mailParserdiv").style.display="none",getElemById("wfWHhead").style.display="none",getElemById("wfDGhead").style.display="none",getElemById("layouthead").style.display="none",getElemById("convertLeadMappinghead").style.display="none",getElemById("quoteConvertMappinghead").style.display="none",getElemById("soConvertMappinghead").style.display="none",getElemById("scoringRulehead").style.display="none",getElemById("scoringRuleNewhead").style.display="none",getElemById("scoringRuleNewdiv").style.display="none",getElemById("autoresponseruleNewhead").style.display="none",getElemById("autoresponseruleNewdiv").style.display="none",getElemById("wfOnFUhead").style.display="none",getElemById("cadenceshead").style.display="none",getElemById("formRulehead").style.display="none",getElemById("segmentCriteriahead").style.display="none",getElemById("segmentFieldhead").style.display="none",getElemById("clientPortalInvFieldHead")&&(getElemById("clientPortalInvFieldHead").style.display="none"),getElemById("clientPortalInvFieldDiv")&&(getElemById("clientPortalInvFieldDiv").style.display="none"),getElemById("abmConfighead")&&(getElemById("abmConfighead").style.display="none"),getElemById("abmSegmenthead")&&(getElemById("abmSegmenthead").style.display="none");var h=getElemById("abmSegmentCampaignsListCriteriahead");h&&(h.style.display="none"),getElemById("sharingRuleshead").style.display="none",getElemById("sharingRulesdiv").style.display="none",getElemById("customButtonhead")&&(getElemById("customButtonhead").style.display="none"),getElemById("customLinkhead")&&(getElemById("customLinkhead").style.display="none"),null!=getElemById("pfCrihead")&&null!=getElemById("pfCrihead")&&(getElemById("pfCrihead").style.display="none"),null!=getElemById("vRhead")&&null!=getElemById("vRhead")&&(getElemById("vRhead").style.display="none"),null!=getElemById("calSchdhead")&&null!=getElemById("calSchdhead")&&(getElemById("calSchdhead").style.display="none"),getElemById("currensyisohead")&&(getElemById("currensyisohead").style.display="none"),getElemById("visionRulesOfLayouthead")&&(getElemById("visionRulesOfLayouthead").style.display="none"),getElemById("visionRulesOfLayoutdiv")&&(getElemById("visionRulesOfLayoutdiv").style.display="none");var f=getElemById("criteriaLimitExceedDiv");f&&(f.style.display="none");var C=getElemById("gametrophydelheadForDynFormulaCrit");C&&(C.style.display="none");var y=getElemById("gametrophydeldivForDynFormulaCrit");y&&(y.style.display="none");var b=getElemById("gamebadgedelheadForDynFormulaCrit");b&&(b.style.display="none");var w=getElemById("scoringRuleheadForDynFormulaCrit");w&&(w.style.display="none");var I=getElemById("scoringRuledivForDynFormulaCrit");I&&(I.style.display="none");var L=getElemById("scoringRuleNewheadForDynFormulaCrit");L&&(L.style.display="none");var A=getElemById("scoringRuleNewdivForDynFormulaCrit");A&&(A.style.display="none");var E=getElemById("lookupFilterheadForDynFormulaCrit");E&&(E.style.display="none");var S=getElemById("lookupFilterdivForDynFormulaCrit");S&&(S.style.display="none");var R=getElemById("reportsheadForDynFormulaCrit");R&&(R.style.display="none");var T=getElemById("reportsdivForDynFormulaCrit");T&&(T.style.display="none");var _=getElemById("cpqProductConfiguratorheadForDynFormulaCrit");_&&(_.style.display="none");var k=getElemById("cpqProductConfiguratordivForDynFormulaCrit");k&&(k.style.display="none");var M=getElemById("cpqPriceRuleheadForDynFormulaCrit");M&&(M.style.display="none");var O=getElemById("cpqPriceRuledivForDynFormulaCrit");O&&(O.style.display="none");var P=getElemById("lockingRulesheadForDynFormulaCrit");P&&(P.style.display="none");var D=getElemById("lockingRulesdivForDynFormulaCrit");D&&(D.style.display="none");var U=getElemById("territorydivForDynFormulaCrit");U&&(U.style.display="none");var F=getElemById("sharingRulesheadForDynFormulaCrit");F&&(F.style.display="none");var B=getElemById("sharingRulesdivForDynFormulaCrit");B&&(B.style.display="none");var x=getElemById("dbComponentsheadForDynFormulaCrit");x&&(x.style.display="none");var N=getElemById("dbComponentsdivForDynFormulaCrit");N&&(N.style.display="none")}else $("#orchTransRulehead").hide(),$("#orchTransRulediv").hide(),$("#pfTransRulehead").hide(),$("#pfTransRulediv").hide(),$("#pfCrihead").hide(),$("#wfCrihead").hide(),$("#kioskshead").hide(),$("#datahubshead").hide(),$("#lockingRuleshead").hide(),$("#reviewprocessCrihead").hide(),$("#reviewprocess").hide(),$("#bPRulehead").hide(),$("#bPTransRulehead").hide(),$("#bPTransCriRulehead").hide(),$("#bPTransActionhead").hide(),$("#assRuleHead").hide(),v.hide(),g.hide(),$("#caseHead").hide(),getElemById("abmConfighead").style.display="none",getElemById("abmConfigdiv").style.display="none",getElemById("abmSegmenthead").style.display="none",getElemById("abmSegmentdiv").style.display="none",getElemById("abmSegmentCampaignsListCriteriahead").style.display="none",getElemById("abmSegmentCampaignsListCriteriadiv").style.display="none",getElemById("wftagActiondiv").style.display="none",$("#wftagActionhead").hide(),getElemById("approvalRuleCrihead").style.display="none",getElemById("approvalRuleCridiv").style.display="none",getElemById("visionRulesOfLayouthead")&&(getElemById("visionRulesOfLayouthead").style.display="none"),getElemById("visionRulesOfLayoutdiv")&&(getElemById("visionRulesOfLayoutdiv").style.display="none");getElemById("canvasruledeldiv")&&getElemById("canvasrulehead")&&($("#canvasruledeldiv").empty(),getElemById("canvasrulehead").style.display="none"),$("#deleteDetails").find(".wfcustomActionHead,.wfcustomActionDiv").remove(),getElemById("autofollowhead").style.display="none",getElemById("cvhead").style.display="none",$L("#kanbanhead")[0]&&$L("#kanbanhead")[0].classList.add("dN"),getElemById("territoryhead").style.display="none",$("#dbComponentshead").hide(),$("#reportshead").hide(),$("#cpqProductConfiguratorhead").hide(),$("#cpqPriceRulehead").hide(),$("#cpqGuidedSellinghead").hide(),$("#lookupFilterhead").hide(),$("#formRulediv").empty(),$("#wizardUseddiv").empty(),$("#canvasUseddiv").empty(),$("#ziaSimilaritydiv").empty(),$("#ZiaCallTranscriptdiv").empty(),$("#currencyISODiv").empty(),0==n&&(document.getElementById("caseHead")&&$("#caseHead").remove(),document.getElementById("caseEscDiv")&&$("#caseEscDiv").remove(),document.getElementById("assRuleHead")&&$("#assRuleHead").remove(),v&&v.length>0&&v.remove(),g&&g.length>0&&g.remove(),document.getElementById("assRuleDiv")&&$("#assRuleDiv").remove()),$("#gametrophydelhead,#gamebadgedelhead ").hide();var j=t.split("|~|")[0],V=t.split("|~|")[1],H=j.split("|*|");if(H.length>2){var z=JSON.parse(H[2]);for(var q in z){var G=z[q];if("forecastField"==q||"forecastArchivedField"===q){u=!0,$("#forecastDiv").show(),$("#deleteInfo2,#deleteDetails,#deleteInfo1").hide();break}if("gametrophies"===q){var W="<ul>",Z=G.length;if("true"===Crm.userDetails.isMotivatorEnabled)for(var J=0;J<Z;J++)W+="<li><a href='"+Crm.getCrmBasePath()+"/gamification/rules' target='_blank'>"+$ESAPI.encoder().encodeForHTML(G[J].paramname)+"</a></li>";else for(J=0;J<Z;J++)W+="<li><a href='"+Crm.getCrmBasePath()+"/ShowSetup.do?tab=general&subTab=gameSettings&action=gamesetting&entityid="+G[J].paramid+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(G[J].paramname)+"</a></li>";W+="</ul>",$("#gametrophydeldiv").html(W).show(),$("#gametrophydelhead").show()}else if("gamebadges"===q){for(var Y="<ul>",Q=0;Q<G.length;Q++)Y+="<li class='p3'><a href='"+Crm.getCrmBasePath()+"/ShowSetup.do?tab=general&subTab=gameSettings&action=gamesetting&entityid="+G[Q].badgeid+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(G[Q].badgename)+"</a></li>";Y+="</ul>",$("#gamebadgedeldiv").html(Y).show(),$("#gamebadgedelhead").show()}else if("gamedashboard"===q){var X="<ul>",K=G.length;for(Q=0;Q<K;Q++)X+="<li class='p3'><a href='"+Crm.getCrmBasePath()+"/gamification/dashboards?id="+G[Q].id+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(G[Q].paramname)+"</a></li>";X+="</ul>",m.html(X).show(),c.show()}else if("webtab"===q){Y="<ul>";var ee=G.Webtab;for(var q in ee)if(ee.hasOwnProperty(q)){var te=ee[q];Y+="<li class='p3'><link-to lt-prop-route='crm.settings.section.web-tabs.edit-webtabs' lt-prop-dp='[\""+te.id+"\"]' lt-prop-target='_blank'>"+$ESAPI.encoder().encodeForHTML(te.name)+"</link-to></li>"}Y+="</ul>",$("#webTabULDiv").html(Y).show(),$("#webTabHead").show()}else if("Image_Validation"===q){var ae="<ul>",ie=G.length;for(Q=0;Q<ie;Q++)ae+="<li class='p3'><link-to data-zcqa='VisionViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.vision.image-validation.view' lt-prop-target='_blank' lt-prop-dp= [\""+G[Q].id+'"]>'+$ESAPI.encoder().encodeForHTML(G[Q].name)+"</link-to></li>";ae+="</ul>",$("#imageValidationDelDiv").html(ae).show(),$("#imageValidationDelHead").show()}else if("Recommendation"===q){Y="<ul>";if(Array.isArray(G))for(ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.recommendation.view' lt-prop-target='_blank' lt-prop-dp= [\""+G[Q].recommendationId+'"]>'+$ESAPI.encoder().encodeForHTML(G[Q].recommendationName)+"</link-to></li>";else Object.keys(G).forEach((e=>{Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+e+"' lt-prop-route='crm.settings.section.zia.recommendation.view' lt-prop-target='_blank' lt-prop-dp= [\""+e+'"]>'+$ESAPI.encoder().encodeForHTML(G[e][0])+"</link-to></li>"}));Y+="</ul>",$("#recommendationdeldiv").html(Y).show(),$("#recommendationdelhead").show()}else if("Similarity"===q){Y="<ul>";if(Array.isArray(G))for(ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.similarity.view' lt-prop-target='_blank' lt-prop-dp= [\""+G[Q].similarityId+'"]>'+$ESAPI.encoder().encodeForHTML(G[Q].similarityName)+"</link-to></li>";else Object.keys(G).forEach((e=>{Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+e+"' lt-prop-route='crm.settings.section.zia.similarity.view' lt-prop-target='_blank' lt-prop-dp= [\""+e+'"]>'+$ESAPI.encoder().encodeForHTML(G[e][0])+"</link-to></li>"}));Y+="</ul>",$("#similaritydeldiv").html(Y).show(),$("#similaritydelhead").show()}else if("ZiaCallAnalytics"===q){for(Y="<ul>",ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.callanalytics' lt-prop-target='_blank' >"+I18n.getMsg($ESAPI.encoder().encodeForHTML(G[Q].title))+"</link-to></li>";Y+="</ul>";let e=$L("#ziacallanalyticsdeldiv"),t=$L("#ziacallanalyticsdelhead");e.html(Y),e.show(),t.html(I18n.getMsg("crm.setup.system.ziacallanalytics")),t.show()}else if("ZiaCallTranscript"===q&&G&&G.length){for(Y="<ul>",ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.calltranscription' lt-prop-target='_blank' >"+I18n.getMsg($ESAPI.encoder().encodeForHTML(G[Q].title))+"</link-to></li>";Y+="</ul>";let e=$L("#ziacallanalyticsdeldiv"),t=$L("#ziacallanalyticsdelhead");e.html(Y),e.show(),t.html(I18n.getMsg("crm.setup.system.ziacalltranscription")),t.show()}else if("DataEnrichment"===q&&G&&G.length){for(Y="<ul>",ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.data-enrichment.edit' lt-prop-target='_blank' lt-prop-dp= [\""+G[Q].dataEnrichmentId+'"] lt-prop-qp=\'{"fieldId": "'+e+"\"}' >"+I18n.getMsg($ESAPI.encoder().encodeForHTML(G[Q].label))+"</link-to></li>";Y+="</ul>";let t=$L("#dataEnrichmentdeldiv"),a=$L("#dataEnrichmentdelhead");t.html(Y),t.show(),a.html(I18n.getMsg("crm.label.auto.enrich")),a.show()}else if("Vision"===q){for(Y="<ul>",ie=G.length,Q=0;Q<ie;Q++)Y+="<li class='p3'><link-to data-zcqa='VisionViewfromDel"+Q+"' lt-prop-route='crm.settings.section.zia.vision.image-validation.view' lt-prop-target='_blank' lt-prop-dp= [\""+G[Q].visionId+'"]>'+$ESAPI.encoder().encodeForHTML(G[Q].visionName)+"</link-to></li>";Y+="</ul>",$("#visiondeldiv").html(Y).show(),$("#visiondelhead").show()}else if("ZiaVoice"===q){for(var le="<ul>",se=G.length,ne=0;ne<se;ne++){le+="<li class='p3'><link-to data-zcqa='ZiaVoicefromDel"+(Pe=G[ne]).configId+"' lt-prop-route='crm.settings.section.zia.zia-voice.index' lt-prop-target='_blank'>"+Pe.configName+"</link-to></li>"}le+="</ul>",$("#ziaVoicedeldiv").html(le).show(),$("#ziaVoicedelhead").show()}else if("canvas_rules"===q){Y="<ul>",ie=G.length;for(var re in G)Y+="<li class='p3'><link-to data-zcqa='canvasruleViewfromDel"+re+"' lt-prop-route='crm.settings.section.canvas-builder.canvasrules' lt-prop-target='_blank' lt-prop-qp='{\"ruleId\": \""+re+"\"}' >"+$ESAPI.encoder().encodeForHTML(G[re][0])+"</link-to></li>";Y+="</ul>",$("#canvasruledeldiv").html(Y).show(),$("#canvasrulehead").show()}else if("inventoryRecords"===q)showCFoffectedRecords(G,"it",Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=inventory&step=editInventoryTemplate&emailTemplateId=");else if("autofollowRulesRecords"===q){document.getElementById("autofollowhead").style.display="",document.getElementById("autofollowdiv").style.display="";var oe=document.createElement("ul");for(var e in null==n&&(oe.style.marginTop="0px"),G){var de=G[e];(xe=document.createElement("li")).setAttribute("class","p3");var ce=document.createElement("a");$(ce).empty(),ce.innerHTML=de,ce.setAttribute("href","javascript:void(0);"),ce.setAttribute("data-params",'{"action":"editFollowUp", "followUpId":"'+e+'" }'),ce.addEventListener("click",(function(){$("#feedsLookupDiv").data("id",gblid),CrmModule.hide("deletefield"),showFollowUpRule(this)}),!1),xe.appendChild(ce),oe.appendChild(xe)}document.getElementById("autofollowdiv").appendChild(oe)}else if("formulaFiledRecords"===q)if(i){if(!CrmSubform.showFormulaFieldInvolvedAlertOnPermDel(s,l,G,d))return}else{$("#ffhead").css("display",""),$("#ffdiv").css("display","");oe=document.createElement("ul");for(var e in oe.style.marginTop="0px",G){var me=G[e];(xe=document.createElement("li")).setAttribute("class","p3");var ue=document.createElement("a"),pe=Crm.getCrmBasePath()+"/EntityFieldCustomize.do?module="+me[1];if($(ce).empty(),ue.innerHTML=me[0],ue.setAttribute("href",pe),ue.setAttribute("target","_blank"),me.length>2&&(CrmPageLayout.isMPLAvailable||CrmPageLayout.isMPLInGracePeriod)){var ge=$("<span/>").addClass("moduleLink fontSmooth crmBaseColor");ge.append("&nbsp;&nbsp;(");var ve=[],he=Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module="+me[1]+"&layoutId=",fe=me[2];for(var q in fe){var Ce=fe[q];if("-1"===Ce[1])ve.push(Ce[0]);else{var ye=document.createElement("a"),be=he+q;ye.setAttribute("href",be),ye.setAttribute("target","_blank"),ye.innerHTML=$ESAPI.encoder().encodeForHTML(Ce[0]),ve.push(ye)}}if(ve.length>0){ge.append($ESAPI.encoder().encodeForHTML(ve[0]));for(ne=1;ne<ve.length-1;ne++)ge.append(",&nbsp;"),ge.append($ESAPI.encoder().encodeForHTML(ve[ne]));ve.length>1&&(ge.append("&nbsp;"),ge.append($("<span/>").addClass("crmNotFoundColor").html(I18n.getMsg("and")+"&nbsp;")),ge.append($ESAPI.encoder().encodeForHTML(ve[ve.length-1]))),ge.append(")"),xe.innerHTML=$ESAPI.encoder().encodeForHTML(me[0]),$(xe).append($ESAPI.encoder().encodeForHTML(ge))}else xe.appendChild(ue)}else!0,xe.appendChild(ue);oe.appendChild(xe)}$("#ffdiv").append(oe)}else{if(Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===q){var we=$("#dynPopupBox"),Ie=we.clone(!1);Ie.attr("id","dynnewpopupbox");var Le=Ie.find("#mesg");return Ie.find("#mainhd").text(I18n.getMsg("crm.mb.delete.field.deny.title")),Le.text(I18n.getMsg("static.subform.error.atleast.one.field")),Le.append("<br><br>"),Ie.find("#otherevbtn").css("display","block"),Le.append(I18n.getMsg("crm.mb.layout.saved.delete.2")),Ie.find("#popupicon").removeClass("delWarnMsg"),Ie.addClass("w550"),we.after(Ie),void CrmModule.show("dynnewpopupbox")}if("caseEscalationRuleRecords"===q)showLayoutOffectedPlaces("caseHead","caseEscDiv",I18n.getMsg("crm.pricing.case.escalation.rules"),pe=Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=escalationRules",G,n);else if("assignmentRuleRecords"===q){showLayoutOffectedPlaces("assRuleHead","assRuleDiv",I18n.getMsg("crm.common.menu.assignmentRules"),pe=Crm.getCrmBasePath()+"/settings/assignment-rules?module="+a+"&action=viewRuleEntries",G,n),n&&$("#assRuleDiv").find("ul").removeAttr("style")}else if("assignmentRestrictionRecords"==q){showLayoutOffectedPlaces("assRestHead","assRestDiv",I18n.getMsg("crm.label.assignment.restrictions"),pe=Crm.getCrmBasePath()+"/settings/assignment-thresholds?module="+a,G,n),n&&g.find("ul").removeAttr("style")}else if("emailTemplateRecords"==q)showCFoffectedRecords(G,"et",Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=email&step=editEmailTemplate&emailTemplateId=");else if("notificationSMSTemplateRecords"===q)showCFoffectedRecords(G,"st",Crm.getCrmBasePath());else if("whatsappTemplateRecords"===q)showCFoffectedRecords(G,"wt",Crm.getCrmBasePath());else if("portalEmailTemplateRecords"===q)showCFoffectedRecords(G,"pet",Crm.getCrmBasePath());else if("emailFooter"===q)showCFoffectedRecords({emailFooter:[I18n.getMsg("crm.fielddelete.emailfooter")]},"ef",Crm.getCrmBasePath()+"/settings/email-configuration/email-preference");else if("alertCriteria"==q)showCFoffectedRecords(G,"alertCriteria",Crm.getCrmBasePath()+"/settings/workflow-alerts/");else if("workflowCriteriaRecords"===q)showCFoffectedRecords(G,"wfCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("lockingRulesCriteria"===q)showCFoffectedRecords(G,"lockingRules",Crm.getCrmBasePath()+"/settings/modules/"+a+"/locking-configuration");else if("workflowTriggerRecords"===q)showCFoffectedRecords(G,"wfTrig",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("game_tagActionRecords"===q)showCFoffectedRecords(G,"gameKpiCri",Crm.getCrmBasePath()+"/gamification/rules/");else if("gamedashboard"===q)showCFoffectedRecords(G,"gameDashboard",Crm.getCrmBasePath()+"gamification/dashboards?id=");else if("cpqProductConfigurator"===q)showCFoffectedRecords(G,"cpqProductConfigurator",Crm.getCrmBasePath()+"/settings/zohocpq/productConfigurator/");else if("cpqPriceRule"===q)showCFoffectedRecords(G,"cpqPriceRule",Crm.getCrmBasePath()+"/settings/zohocpq/priceRules/");else if("cpqGuidedSellingRule"===q)showCFoffectedRecords(G,"cpqGuidedSellingRule",Crm.getCrmBasePath()+"/settings/zohocpq/guidedSelling/");else if("kiosks"===q)showCFoffectedRecords(G,"kiosks",Crm.getCrmBasePath()+"/settings/kiosk/");else if("datahubs"===q)showCFoffectedRecords(G,"datahubs",Crm.getCrmBasePath());else if("processFlowCriteriaRecords"===q){showCFoffectedRecords(G,n?"bPRule":"pfCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=")}else if(-1!==["automation_Task_used_details","workFlowFURuleRecords","actionsFieldUsage","orchestrationRecords","orchestrationCriteriaRecords","pathfinderCriteriaRecords","automationActions","workFlowWebHookRecords","chatActionsDtls","actionAlerts","wfConvertDtls","automation_triggers","orchestration_conectivity","workFlowCustomFunctions","workflowAssignOwner"].indexOf(q)){var Ae=JSON.parse(JSON.stringify(G));if("automation_triggers"===q){var Ee=Ae.Orchestration?Ae.Orchestration:Ae.PathFinder;if(Ee)for(var q in Ee){var Se=Ee[q].Trigger;Ee[q].Trigger=Se.map((function(e){return{id:e.id,rules:[{id:e.ruleId,name:e.ruleName,subtype:e.subtype,subtype_id:e.subtype_id,subtype_name:e.subtype_name}]}}))}}renderAutomationDenyPopComp(Ae,void 0,void 0,"#automationdiv")}else if("workOnFURuleRecords"===q)showCFoffectedRecords(G,"wfOnFU",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("workFlowFURuleRecords"===q)showCFoffectedRecords(G,"wfFU",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=fieldUpdate&step=showFieldUpdate&fieldUpdateId=");else if("mailParserRuleRecords"===q)showCFoffectedRecords(G,"mailParser",Crm.getCrmBasePath()+"/settings/email-parser/");else if("macroFURecords"===q)showCFoffectedRecords(G,"macroFU",Crm.getCrmBasePath()+"/showMacro.do?type=2&module="+a+"&ruleId=");else if("workFlowTimeRuleRecords"===q)showCFoffectedRecords(G,"wfTBA",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("WorkFlow Custom Actions"===q)for(var $e in G){showCFoffectedRecords(G[$e],$e,Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=",!0)}else if("Prediction"===q)showCFoffectedRecords(G,"predictiondel",Crm.getCrmBasePath()+"/settings/zia/prediction/builder/field/");else if("Churn"===q)showCFoffectedRecords(G,"churndel",Crm.getCrmBasePath()+"/settings/zia/prediction/builder/churn/");else if("territoryRecords"===q)showCFoffectedRecords(G,"territory",Crm.getCrmBasePath()+"/settings/territories/");else if("approvalCriteriaRecords"===q)showCFoffectedRecords(G,"approvalRuleCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=approvalProcess&processId=");else if("ApprovalProcessRecordModification"===q)showCFoffectedRecords(G,"approvalRuleCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=approvalProcess&processId=");else if("scoringRules"===q)isMultiScoreAvail?showCFoffectedRecords(G,"scoringRuleNew",Crm.getCrmBasePath()+"/settings/scoring-rules/"):showCFoffectedRecords(G,"scoringRule",Crm.getCrmBasePath()+"/settings/scoring-rules?module="+a);else if("scoringRulesLayoutAssociated"===q)showCFoffectedRecords(G,"scoringRuleNew",Crm.getCrmBasePath()+"/settings/scoring-rules/");else if("AutoResponseRules"===q)isAutoResponseEnabled?showCFoffectedRecords(G,"autoresponseruleNew",Crm.getCrmBasePath()+"/settings/auto-response-rules/"):showCFoffectedRecords(G,"autoresponseruleNew",Crm.getCrmBasePath()+"/ShowSetup.do?tab=devSpace&subTab=autoRespRules&seModule="+a+"&action=viewAutoRespRuleEntries&ruleId=");else if("series"===q||"cadences"===q)showCFoffectedRecords(G,"cadences",Crm.getCrmBasePath()+"/settings/cadences/");else if("layoutRecords"===q)showCFoffectedRecords(G,"layout",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module="+(void 0!==r?r:a)+"&layoutId=");else if("formRuleObj"===q)showCFoffectedRecords(G,"formRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=formRules&module="+a+"&formRuleId=");else if("workflow_tagActionRecords"===q){renderAutomationDenyPopComp(Ae=JSON.parse(JSON.stringify(G)),void 0,void 0,"#automationdiv")}else if("processFlowCriteriaRecords"===q||"blueprintRecords"===q)showCFoffectedRecords(G,"bPRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("wizardRecords"===q)showCFoffectedRecords(G,"wizardUsed",Crm.getCrmBasePath()+"/settings/wizard/",void 0,void 0!==o?o:e);else if("CanvasRecords"==q)showCFoffectedRecords(G,"canvasUsed",Crm.getCrmBasePath()+"/settings/canvas-builder/detailview?module="+a+"&layoutId="+e);else if("ZiaCallTranscript"===q)showCFoffectedRecords(G,"ZiaCallTranscript",Crm.getCrmBasePath()+"/settings/zia/calltranscription");else if("ZiaSimilarityRecords"===q)showCFoffectedRecords(G,"ziaSimilarity",Crm.getCrmBasePath()+"/settings/zia/similarity/"+Object.keys(G)[0]);else if("DataEnrichment"===q)showCFoffectedRecords(G,"DataEnrichment",Crm.getCrmBasePath()+"/settings/zia/data-enrichment/edit/"+Object.keys(G)[0]);else if("blueprintTransitionCriteriaRecords"==q)showCFoffectedRecords(G,"bPTransCriRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("processFlowTransitionCriteriaRecords"===q)showCFoffectedRecords(G,"bPTransRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("processFlowTransitionActionRecords"===q)showCFoffectedRecords(G,"bPTransAction",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("orchestrationTransitionCriteriaRecords"==q)showCFoffectedRecords(G,"orchTransRule",Crm.getCrmBasePath()+"/settings/commandcenter/journey-builder/");else if("pathfinderTouchpointCriteriaRecords"===q)showCFoffectedRecords(G,"pfTransRule",Crm.getCrmBasePath()+"/settings/commandcenter/path-finder/");else if("ConvertLeadMapping"===q)showCFoffectedRecords(G,"convertLeadMapping",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module=Leads&isLoadPage=mapping&leadLayoutId=");else if("QuoteConvertMapping"===q)showCFoffectedRecords(G,"quoteConvertMapping",Crm.getCrmBasePath()+"/settings/modules/Quotes/conversion-mapping?quoteLayoutId=");else if("SOConvertMapping"===q)showCFoffectedRecords(G,"soConvertMapping",Crm.getCrmBasePath()+"/settings/modules/SalesOrders/conversion-mapping?salesOrderLayoutId=");else if("validation_rule"===q)showCFoffectedRecords(G,"vR",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=validationRules&module="+a+"&validationRuleId=");else if("DashboardComponents"===q){for(var Re in G)G[Re].feature_type&&"cpq"===G[Re].feature_type&&(G[Re].name=I18n.getMsg("cpqdashboard.component.chart.name",[moduleRecordMapping.Quotes.plural_label,l]));showCFoffectedRecords(G,"dbComponents",Crm.getCrmBasePath()+"/Dashboard.do?action=showDashboard&dbId=")}else if("kanbanViews"===q){for(var Re in G)G[Re].module=a;var Te=!!G.isInaccessible&&G.isInaccessible;if(Te&&delete G.isInaccessible,showCFoffectedRecords(G,"kanban"),Te){var _e=document.createElement("div"),ke=document.getElementById("kanbandiv");_e.style.width=ke.clientWidth-20+"px",_e.id="AccessKVWarning",_e.innerHTML=I18n.getMsg("crm.warning.delete.field.from.inaccessible.viewname",I18n.getMsg("canvas.kanban.view.tooltip"));var Me=document.createElement("br");ke.appendChild(_e),ke.appendChild(Me)}}else if("ChartViews"===q){for(var Re in G)G[Re].feature_type&&(G[Re].module=a);showCFoffectedRecords(G,"chart")}else if("TimelineViews"===q){for(var Re in G)G[Re].module=a;showCFoffectedRecords(G,"timeline")}else if("Reports"===q)showCFoffectedRecords(G,"reports",Crm.getCrmBasePath()+"/tab/Reports/");else if("Portals"===q)showCFoffectedRecords(G,"portals",Crm.getCrmBasePath()+"/settings/client-portal/user-types/");else if("calendarScheduling"===q)showCFoffectedRecords(G,"calSch",Crm.getCrmBasePath()+"/settings/booking");else if("workflowAssignOwner"===q)showCFoffectedRecords(G,"wfAssignOwner",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("lookupFilterCriteria"===q||"dynamicLookupFilterCriteria"===q)showCFoffectedRecords(G,"lookupFilter",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&layoutId=");else if("customButtonRecords"===q)showCFoffectedRecords(G,"customButton",Crm.getCrmBasePath()+"/settings/modules/${module}/buttons");else if("rollupFieldRecords"===q)showCFoffectedRecords(G,"rollupField",Crm.getCrmBasePath()+"/settings/modules/${module}/field-listing");else if("customLinkRecords"===q)featuresAvailable&&featuresAvailable.CustomLinksNewTab?showCFoffectedRecords(G,"customLink",Crm.getCrmBasePath()+"/settings/modules/${module}/custom-link"):showCFoffectedRecords(G,"customLink",Crm.getCrmBasePath()+"/settings/modules/${module}/links");else if("ReviewProcessCriteria"===q)showCFoffectedRecords(G,"reviewprocessCri",Crm.getCrmBasePath()+"/settings/review-process/");else if("ReviewProcess"===q)showCFoffectedRecords(G,"reviewprocess",Crm.getCrmBasePath()+"/settings/review-process/");else if("segmentCriteria"===q||"segmentField"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/settings/segmentation/");else if("abmConfig"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/abm/configuration/");else if("abmSegment"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/abm/segments/");else if("abmSegmentCampaignsListCriteria"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/abm/segments/");else if("voc"===q||"voc_config"===q||"voc_components"===q){var Oe="voc"===q||"voc_components"===q?"/tab/voc/analytics/":"/settings/voice-of-customer/";showCFoffectedRecords(G,q,Crm.getCrmBasePath()+Oe)}else if("visionRulesOfLayout"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/settings/zia/vision/");else if("portalsCriteriaDetails"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/settings/client-portal/user-types/");else if("sharingRules"===q)showCFoffectedRecords(G,q,Crm.getCrmBasePath()+"/settings/data-sharing/{id}/edit?module="+a);else if("clientPortal"===q){for(le="<ul>",se=G.user_types.length,ne=0;ne<se;ne++){var Pe;le+="<li class='p3'><link-to data-zcqa='ClientPortalField"+(Pe=G.user_types[ne]).id+"' lt-prop-route='crm.settings.section.client-portal.user-types.summary' lt-prop-dp='[\""+Pe.id+"\"]' lt-prop-qp='{\"invitation_pref\":true}' lt-prop-target='_blank'>"+Pe.name+"</link-to></li>"}le+="</ul>",$("#clientPortalInvFieldDiv").html(le).show(),$("#clientPortalInvFieldHead").show()}else"TransitionFields"===q&&CMB.showIfAutomationRelConfiguredForField(void 0,G,"remove")}}}var De=H[0];if(H[1]&&"false"!=De)var Ue=H[1].split("~~");var Fe=!1;if(De.indexOf("||**||true")>-1&&(De=De.replace("||**||true",""),Fe=!0),De=De.split("~~"),p.innerHTML="",Fe||De[0].length&&!u){document.getElementById("cvhead").style.display="",p.style.display="";var Be;oe=document.createElement("ul");for(null==n&&(oe.style.marginTop="0px"),Be="Tasks"==a||"Calls"==a||"Events"==a?"Activities":a,ne=0;ne<De.length-1;ne++){var xe=document.createElement("li"),Ne=document.createElement("link-to");Ne.setAttribute("lt-prop-route","crm.settings.section.custom-view.cvid.edit-custom-view"),Ne.setAttribute("lt-prop-dp",JSON.stringify([Ue[ne]])),Ne.setAttribute("lt-prop-qp",JSON.stringify({module:Be})),Ne.setAttribute("lt-prop-target","_blank"),Ne.innerText=revertSplChrs(De[ne]),xe.appendChild(Ne),oe.appendChild(xe)}if(p.appendChild(oe),null!=V){var je=document.getElementById("lookupCrtDiv");je.style.display="",document.getElementById("lookupheading").style.display="",V=V.split("|*|");for(var Ve=document.createElement("ul"),He=V[0].split("~~"),ze=V[1].split("~~"),qe=He.length,Ge=0;Ge<qe;Ge++){(xe=document.createElement("li")).innerHTML=He[Ge]+" ("+ze[Ge]+" )",Ve.appendChild(xe)}je.appendChild(Ve)}if(Fe){var We=$("#cvdiv").width()-20;$("#cvdiv").append('<div style="width:'+We+'px" id="AccessCVWarning">'+I18n.getMsg("crm.warning.delete.field.from.inaccessible.cv")+"</div><br>")}}if(u||($("#forecastDiv").hide(),$("#deleteInfo2,#deleteDetails,#deleteInfo1").show()),"portalsCriteriaDetails"===q&&$("#portalsCriteriaDetailshead, #portalsCriteriaDetailsdiv").css("display","block"),void 0!==i){var Ze=$("#deletefield");Ze.find("#delfldhd").html(I18n.getMsg("crm.fielddelete.title")),Ze.find("#deleteInfo1").html(I18n.getMsg("crm.fielddelete.info1.1",$ESAPI.encoder().encodeForHTML(l))),Ze.find("#deleteInfo2").html(I18n.getMsg("crm.fielddelete.info2"))}i||null==n||null!=n&&0==n?($("#deletefield").addClass("ppTop p0"),crmui.showPopup("deletefield")):($("#tagDelete").addClass("ppTop p0"),crmui.showPopup("tagDelete"))}function renderAutomationDenyPopComp(e,t,a,i,l,s,n,r){i&&$(i).empty();var o=networkUtils.returnDependencyFiles(["crm-automationcomponentDenyPop.js"],ResourceConstants.CRMClient);o=o.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("facebook"),networkUtils.getI18nJSUrl("twitter"),networkUtils.getI18nJSUrl("createrecordaction"),networkUtils.getI18nJSUrl("actionlistlabel")],ResourceConstants.CRM)),Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-automation-component-denypop",{values:e,actionIdVsOptionArr:t,componentId:a,newUiModel:l,criteriaValues:s,currentModuleLable:n,fieldId:r?r.id:void 0},i)})),i&&$(i).show()}function renderDenyTemp(e,t,a){var i,l,s,n="workflow"==t?I18n.getMsg("rule.smaller.case"):I18n.getMsg("process.smaller.case");l=I18n.getMsg("deluge.v1.deny.msg.info1",n),s=I18n.getMsg("deluge.v1.deny.msg.info2")+' <a class="mL3" target="_blank" href="'+RebrandLinkUtil.getProperty("V1_DEPRECATED_HELP_DOC")+'">'+I18n.getMsg("crm.label.function.v1.deprecation.readmore")+"</a><br> "+I18n.getMsg("deluge.v1.deny.msg.info3"),"statuschange"==a&&(i=I18n.getMsg("rule.activate.deny",n)),"save"==a&&(i=I18n.getMsg("rule.save.deny",n)),"republish"==a&&(i=I18n.getMsg("republish.deny.msg",n)),"publish"==a&&(i=I18n.getMsg("publish.deny.msg",n));var r=Handlebars.templates.deleteFieldWarningPopup();$("#result").append(r);var o=$("#automationdiv");$("#delfldhd").html(i);var d=document.createElement("div"),c=document.createElement("ul"),m=e.details;for(var u in m){var p=m[u],g=document.createElement("li");g.setAttribute("class","p3"),g.innerHTML='<a class="mL3" target="_blank" href='+Crm.getCrmBasePath()+"/settings/workflow-deluge?delugeId="+u+">"+$ESAPI.encoder().encodeForHTML(p)+"</a>",c.appendChild(g)}d.appendChild(c),d.setAttribute("class","denyHead crm-font-regular mT10"),o.html(d),o.show(),$("#deleteInfo1").html(l),$("#deleteInfo2").html(s),crmui.showPopup("deletefield")}function showLayoutOffectedPlaces(e,t,a,i,l,s){var n=s?$("#"+e):document.createElement("div");s||(n.setAttribute("id",e),n.setAttribute("class","denyHead crm-font-regular"),$(n).empty(),n.innerHTML=a);var r=s?$("#"+t):document.createElement("div");s||(r.setAttribute("id",t),r.setAttribute("class","ncff"));var o=document.createElement("ul");for(var d in o.style.marginTop="0px",l){var c=l[d],m=document.createElement("li");m.setAttribute("class","p3");var u=document.createElement("a");if($(u).empty(),u.innerHTML=c[0],"assRestHead"===e){var p=i.replace("/assignment-thresholds","/assignment-thresholds/"+d);u.setAttribute("href",p)}else if("assRuleHead"===e){p=i.replace("/assignment-rules","/assignment-rules/"+d);u.setAttribute("href",p)}else u.setAttribute("href",i);u.setAttribute("target","_blank"),m.appendChild(u),o.appendChild(m)}var g=$("#deletefield").find("#deleteDetails");s?(n.show(),r.show()):(g.append(n),g.append(r)),document.getElementById(t).appendChild(o)}function closeTask(e,t,a){"string"==typeof(c=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(c="true"===c);var i=networkUtils.parseUrl(e).params;if(!c||"Tasks"!==$("#module").val()&&"Activities"!==i.module&&"Tasks"!==i.module||localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),"string"==typeof(c=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(c="true"===c),!c&&"hidden"===$("#deletepopup").css("visibility")){var l=networkUtils.parseUrl(e).params,s=window.event,n=renderingUtils.getTargetElem(s);$("#calendarCont").is(":visible")&&sE(s);var r=new crmRequestPool;return l[csrfParamName]=encodeURIComponent(csrfToken),l.action="showNotifyOwner",void r.initiate({action:Crm.getCrmBasePath()+"/closeTask.do",data:l,type:"POST",success:function(e){showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",n,void 0,"primarybtn",!0,void 0,"true"==e,t)},error:function(){showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",n,void 0,"primarybtn",!0,void 0,!1,t)}})}var o=!1;i=networkUtils.parseUrl(e).params;if($("#showDontAskOption").prop("checked")&&("Activities"===i.module||Crm.isActivitySplitDone&&"Tasks"===i.module)&&localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks")){o=!0,Crm.VR||(Crm.VR={}),"detailView"==i.page&&(Crm.VR.entityDetails=returnJson?objectUtils.cloneObject(returnJson):returnJson),Crm.VR.ajaxEditFieldLabel="STATUS";var d=Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+i.taskid+"&module=Tasks&format=json";if(!a)return void Crm.downloadValidationRules(d,"Tasks",(function(){closeTask(e,t,!0)}))}if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))if(void 0===i.page||"detailView"!==i.page){renderingUtils.freezeBackground();l={module:"Tasks",entityId:i.taskid,layoutId:""};o&&(l.includeVR=!0),l[csrfParamName]=encodeURIComponent(csrfToken);var c,m=$("#showDontAskOption").prop("checked"),u=$("#notifyOwnerOption").prop("checked");"string"==typeof(c=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(c="true"===c),c||(m&&(i.isDontAskAgainChecked=m),i.isNotifyOwnerChecked=u),(r=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:l,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),Crm.jsonDepValues.Tasks=JSON.parse(returnJson.Tasks.fieldDependency),o&&(Crm.VR.entityDetails=returnJson,Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON)),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list"),new Promise((function(t){t(validateTaskForLR(i,e,o))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}})}else validateTaskForLR(i,e,o);else if(o){if(void 0===i.page||"detailView"!==i.page)return renderingUtils.freezeBackground(),(l={module:"Tasks",entityId:i.taskid,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),l.onlyEntityDetails=!0,l.includeVR=!0,void(r=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:l,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),o&&(Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),Crm.VR.entityDetails=returnJson),new Promise((function(t){t(validateTaskForVR(i,e))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}});new Promise((function(t){t(validateTaskForVR(i,e))}))}else renderingUtils.removeFreezeLayer(),closeTaskNow(e)}function validateTaskForLR(e,t,a){"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:JSON.stringify(e),name:"givenParams",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-givenParams")));var i=CFRExec.getTaskCompletedOptionLabel("list");"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:i,name:"closedLbl",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-closedLbl")));var l=CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",i,"detailView"===e.page);if(-1!=l)if(l){hideAnimatePopup("deletepopup");var s={};s.moduleid=e.taskid,s.module="Tasks",s.columnName="STATUS",s.fieldValue=i,networkUtils.setCsrfParam(s);var n=$("#showDontAskOption").prop("checked"),r=$("#notifyOwnerOption").prop("checked"),o=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof o&&(o="true"===o),o||(n&&(s.isDontAskAgainChecked=n),s.isNotifyOwnerChecked=r),s.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},"true"===e.iskanbanview?s.check.from="kanbanview":"detailView"===e.page?s.check.from="detailspage":s.check.from="list",CFRExec.haltStageChange(s)}else a?new Promise((function(a){a(validateTaskForVR(e,t))})):(renderingUtils.removeFreezeLayer(),closeTaskNow(t))}function validateTaskForVR(e,t){var a=CVRExec.getTaskCompletedUserValue();CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(i){if(i)renderingUtils.removeFreezeLayer(),closeTaskNow(t);else{hideAnimatePopup("deletepopup");var l={};l.moduleid=e.taskid,l.module="Tasks",l.columnName="STATUS",l.fieldValue=a;var s=$("#showDontAskOption").prop("checked"),n=$("#notifyOwnerOption").prop("checked"),r=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof r&&(r="true"===r),r||(s&&(l.isDontAskAgainChecked=s),l.isNotifyOwnerChecked=n),networkUtils.setCsrfParam(l),l.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},"true"===e.iskanbanview?l.check.from="kanbanview":"detailView"===e.page?l.check.from="detailspage":l.check.from="list",CVRExec.storeCachedParams(l)}}))}function closeTaskNow(e){var t,a=networkUtils.parseUrl(e).params,i=$("#notifyOwnerOption"),l=$("#dv-button-layer"),s=$L(".canvas-element-button-id-close_task");if(l.length&&""!==l.html()||s.length||"true"===$("#iskanbanview").val()&&$(".leftheaderBack:visible").length){(o={})[csrfParamName]=csrfToken;var n=$("#showDontAskOption").prop("checked"),r=i.prop("checked");return"string"==typeof(d=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(d="true"===d),d||(n&&(o.isDontAskAgainChecked=n),o.isNotifyOwnerChecked=r),-1===e.indexOf("page")&&(o.page="detailView"),void mR(e,(function(e){if(hideAnimatePopup("deletepopup"),e.indexOf("success")>-1){var t=JSON.parse(e),i=t.closedTime,l=t.modifiedTime,n="";if($L("crm-detailview-canvas").length&&s.length){var r=store.peekRecord(moduleRecordMapping.Tasks.id,a.taskid),o=Lyte.registeredMixins["crm-detailcanvas-utils"].processParamsForFollowUpTask(r);return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.create.followup.task.new",o),ltPropType:"success",ltPropDuration:1e4,ltPropYield:!0}}),void Lyte.Router.getRouteInstance().refresh()}Crm.isActivitySplitDone&&"Tasks"===a.module?crmTab.deleteFromCache("Tasks"):crmTab.deleteFromCache("Activities");var d,c,m,u=Crm.renderDVLyteFlow("Tasks"),p=(i=t.closedTime,l=t.modifiedTime,n="",$("#entityId").val());if(u){var g=(d=$L("crm-detail-view")[0].component).data.content_json.meta_info;c=g.fieldvsOptions[g.fieldColumnNameMap.STATUS[1]].filter((e=>"Completed"===e.actual_value))[0].display_value,p=d.data.record.id}else c=(m=$("#completedTask")).find("#completedValue").text();if(null!=t.uiFormulaUpdateVals&&(n=t.uiFormulaUpdateVals),p===a.taskid)if(u)Lyte.triggerEvent("detail_view_listener_"+d.getData("unique_listener_id"),{componentsToBeReloaded:["all_components"]});else{""===$('[id="value_CLOSEDTIME"]').text().trim()&&($('[id="value_CLOSEDTIME"]').text(i),$('[id="headervalue_CLOSEDTIME"]').length>0&&$('[id="headervalue_CLOSEDTIME"]').text(i));var v='<span purpose="showUserBC" data-params=\'{"userId":"'+Crm.userDetails.USER_ID+'"}\' id="ownerName_id" >'+$ESAPI.encoder().encodeForHTML(Crm.userDetails.DISPLAY_NAME)+'</span><span class="crm-small-font-size crmLabelColor crm-font-regular mL10 createdTimeDetailview">'+l+"</span>";$('[id="value_MODIFIEDBY"]').html(v),null!=getElemById("headervalue_MODIFIEDBY")&&$('[id="headervalue_MODIFIEDBY"]').html(v),Crm.bindEventForUserBCView();for(var h=n.split("||"),f=0;f<h.length;f++){var C=h[f].lastIndexOf("##"),y=h[f].substring(0,C),b=h[f].substring(C+2,h[f].length);null!=getElemById("value_"+y)&&($("#value_"+y).empty(),getElemById("value_"+y).innerHTML=b)}m.prev("tr").hide(),m.show(),m.find("#followup").show(),m.find("#completedValue").show(),$$rightPanel.detailRightPanel(!0,"info",!0),$("#value_STATUS").text(c),$("#headervalue_STATUS").text(c),$("#cvlist_"+p).length&&$("#cvlist_"+p).find("#lp_Status").text(c).attr("title",c)}"true"===$("#iskanbanview").val()&&($("#recordid_"+a.taskid).find('[class="seperatorLine"]').hide(),$("#listViewClose_"+a.taskid).hide(),$("#recordid_"+a.taskid).find("#Status").text(c).attr("title",c)),u||detailView.replaceDataParams("STATUS",c),refreshFollowDiv()}else $("#show").html(e)}),o)}if(document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value){var o={};n=$("#showDontAskOption").prop("checked"),r=i.prop("checked");if(-1!=e.indexOf("action=CloseTask"))"string"==typeof(d=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(d="true"===d),d||(e+="&isNotifyOwnerChecked="+r),t=csrfParamName+"="+csrfToken;e=networkUtils.constructUrl(e,o);ajaxNew(e,t,(function(e){var t=JSON.parse(e);if(-1!=t.response.indexOf("success")){$("#listViewClose_"+t.taskid).hide();var a=$("#recordid_"+t.taskid);a.find("#Status").text(t.taskStatus).attr("title",t.taskStatus);var i=a.find(".overDueCtn");i.length&&(i[0].parentElement.innerText=i[0].firstElementChild.innerText),hideAnimatePopup("deletepopup")}}),"closetask")}else{e=Crm.getCrmBasePath()+"/closeTask.do",a[csrfParamName]=csrfToken;var d,n=$("#showDontAskOption").prop("checked"),r=i.prop("checked");"string"==typeof(d=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID))&&(d="true"===d),!d&&n&&(a.isDontAskAgainChecked=n),d||(a.isNotifyOwnerChecked=r);var c=Lyte.Router.getRouteInstance().transition.target;"crm.tab.module.custom-view.list"==c?a.from="listview":"crm.tab.module.custom-view.canvas"===c?a.from="canvaslistview":crmListView.getFilterParams(a),(new crmRequestPool).initiate({action:e,data:a,type:"POST",dataType:"json",success:function(e){hideAnimatePopup("deletepopup");var t=$L("crm-activity-component");if(Crm.isActivitySplitDone&&"Tasks"===a.module?crmTab.deleteFromCache("Tasks"):crmTab.deleteFromCache("Activities"),"Tasks"===a.module&&$("#calendarCont").is(":visible"))_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.call.completed.successfully"),ltPropDuration:"4000",ltPropShow:!0}}),calView&&calView.refresh();else if("Tasks"===a.module&&t.length>0){var i=t[0].component;i.completeActivityCallback.bind(i)()}if("listview"==a.from)crmListView.reloadCurrentListView();else if("canvaslistview"===a.from)Lyte.Router.getRouteInstance().refresh();else{if(e.body&&0!=e.body.length){for(var l=[],s=e.fromIndex-1,n=0;s<=e.toIndex;s++,n++)e.body[n]?l[s]=e.body[n]:l[s]=null;e.body=l}crmTasks.completeActivityCallback&&crmTasks.completeActivityCallback(),crmListView.createTemplate(e),Crm.isActivitySplitDone?crmTab.putInCache("Tasks",e):crmTab.putInCache("Activities",e)}}})}}function mailProcess(e){if(getObj("mailListRelId")){var t=getObj("mailListRelId").value,a=$("#norec_"+t).html(),i=$("crm-rl-users-list");if(null!=a&&" "!=a||(a=$("#ract_"+t).html()),getObj(t)){if(0==i.length&&$(getObj(t)).empty(),"object"==typeof e){var l=$("#associatedContEmail");l.length>0&&(e.associatedContEmail=l.val()),"sent_from_crm"!=e.mailType&&"allContacts"!=e.mailType||(e.mailType="ALLUSERSMAILS"),"all_contacts_sent_crm_emails"==e.mailType&&(e.mailType="allContacts");let a=store.peekAll("email_column_widths");a&&(e.columnWidths=a),e.isEmailSummaryEnabled=e.isSummaryEnabled,e.isEmotionsEnabled=Crm.userDetails.isEmotionsEnabled,Crm.userDetails.mailType=e.mailType,store.pushPayload("emails_rl_user",{content:"emails_"+$("#id").val(),data:e});var s=JSON.parse(JSON.stringify(e));if(s&&s.mailsList)for(var n=s.mailsList,r=n.length,o=0;o<r;o++)s.mailsList[o].source=getMailSourceString(n[o].source);var d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],ResourceConstants.CRM);0==$("crm-emails-related-list").length?(Lyte.injectResources(d,void 0,void 0),Lyte.Component.render("crm-emails-related-list",s,"[id='"+t+"']")):document.querySelector("crm-emails-related-list").component.setData(s)}else getObj(t).innerHTML=e;var c=null!=e.mailsList?e.mailsList.length:0;if(c>0&&(e.mailsList[c-1].hasOwnProperty("mail_index")||e.hasOwnProperty("next_index"))){var m=$("#mailIndex");m.length>0?i.append("<input type='hidden' id='mailIndex' value='"+e.mailsList[c-1].mail_index+"'/>"):m.val(e.mailsList[c-1].mail_index)}var u=getObj(t);placeExtra()}"object"!=typeof e&&$("#ract_"+t).html(a),placeExtra(),$("#selectMails optgroup[id=zmailPublicUsers] option").sort((function(e,t){return"NA"==e.innerHTML?1:"NA"==t.innerHTML?-1:e.innerHTML>t.innerHTML?1:-1})).appendTo("#selectMails optgroup[id=zmailPublicUsers]");var p=null,g=$("#dealOnlyDropDown");if(g.length&&0==i.length&&thirdPartyUtils.bindSelect2(g),getObj("selectMails")){p=getObj("selectMails"),g.length&&("dealsOnly"===g.val()||g.attr("lt-prop-selected"))&&$(p).find('optGroup:not([type="2"]) option').prop("disabled",!0),p.style.visibility="visible";var v=$("#isFromNewAPI");v&&0==v.length&&thirdPartyUtils.bindSelect2("#selectMails")}EvalInnerScript(u),getObj("zs_EMAIL")&&(getObj("zs_EMAIL1")?getObj("zs_EMAIL").value=getObj("zs_EMAIL1").value:getObj("subvalue_EMAIL")&&(getObj("zs_EMAIL").value=getObj("subvalue_EMAIL").innerHTML)),getObj("contactSelDropdownInAcc")&&0==i.length&&thirdPartyUtils.bindSelect2("#contactSelDropdownInAcc"),detailView.dataParamDetails&&(detailView.dataParamDetails.isLoaded=!!detailView.dataParamDetails||void 0),populateRLCount(t)}}function SelectAllUsers(e,t,a){if(!isDisabledAll(a)){e&&getObj(t)&&getObj(t).removeChild(getObj(t+"link"));var i=document.createElement("A");document.getElementById(t)&&"selected"==document.getElementById(t).name||isCheckedAll(a)?(document.getElementById(t).name="unselected",$(i).empty(),i.innerHTML=I18n.getMsg("crm.select.unselectall"),i.setAttribute("class","cP"),i.setAttribute("onclick","selectORUnselect('"+a+"', false);SelectAllUsers(this,'"+t+"','"+a+"');")):(getObj(t)&&(document.getElementById(t).name="selected"),$(i).empty(),i.innerHTML=I18n.getMsg("crm.select.all"),i.setAttribute("class","cP"),i.setAttribute("onclick","SelectAllUsers(this,'"+t+"','"+a+"');selectORUnselect('"+a+"', true)")),i.id=t+"link",getObj(t)&&($(getObj(t)).empty(),getObj(t).appendChild(i))}}function togglegsearchmenu(e){var t=document.getElementById("newgsearchcatagory");"hide"!=arguments[0]&&"none"==t.style.display?t.style.display="block":t.style.display="none",sE(e)}function changeSearchCategory(e){var t=e.sModule.length;for(i=0;i<t;i++){if(0!=i&&0==e.sModule[i].checked){e.sModule[0].checked=!1;break}e.sModule[0].checked=!0}}function sendMail(e,t,a,i,l){var s=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+e+"/send-mail?action=compose&entEmail="+encodeURIComponent(a));(i&&(s+="&isRequestFrom=invitee"),document.getElementById("tkvsentmail"))&&(s=s+"&isSendMail="+document.getElementById("isSendMail").value);return openPopUp("entreplyWin",this,s,"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),!1}function showSubMenuLayer(){if(getObj("createsubmenu")){var e=$(window),t=$(".lyteMenuSettings #createNew");Crm.userDetails.RTL_ENABLED?($("#createsubmenu").css("left",t.offset().left-55),$("#createsubmenu .SocialArrow").css({left:"52px",right:"auto"})):($("#createsubmenu").css("right",e.width()+e.scrollLeft()-(t.offset().left+t.outerWidth())-16.5),$("#createsubmenu .SocialArrow").css({left:"auto",right:"15px"})),$("#createsubmenu .boxShadowMask").css("max-height",renderingUtils.windowHeight-(renderingUtils.tabLayerOuterHeight()+20+$("#wmstoolbar").outerHeight())-70),$("#createsubmenu .boxShadowMask").addClass("oH pR"),getObj("createsubmenu").style.display="block";getObj("createNew");getObj("createNew").className="svgIconsImg createNewIconH",thirdPartyUtils.bindPerfectScroll("#createsubmenu .boxShadowMask",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1})}}function assignRurl(){var e=getObj("rurl");e&&(cvUrlInfo.CV_URL=e.value)}function isGlobalSearch(e){if(e){var t=renderingUtils.getTargetElem(e);return $(t).parents("#gsearchTable").length}}function loadDVWithRp(e,t,a,i){var l=e.pfrom?e.pfrom:null;if("CEC"===l&&(l="cv"),$("#gsearchTable").length>1&&(e.pfrom=l="gsearch",e.FROM_INDEX=1,e.TO_INDEX=crmNavig[e.module].recordId.length),null!==l&&"null"!==l){if(e.FROM_INDEX=e.FROM_INDEX?e.FROM_INDEX:1,e.TO_INDEX=e.TO_INDEX?e.TO_INDEX:10,"rel"===(l=e[""])){var s=getObj("pn"),n=getObj("peId"),r=getObj("bMod");null!==s&&"null"!==s.value&&(e.pn=s.value),null!==n&&"null"!==n.value&&(e.peId=n.value),null!==r&&"null"!==r.value&&(e.bMod=r.value)}if("cv"===e.pfrom){var o=crmListView.getObject();o&&o.module===Crm.activityGrp[e.module]&&(crmListView.getAdvSearchCrtFromCVObject(e),e.filters&&(e.isNewFilter=!0))}var d=parseInt(e.FROM_INDEX),c=e.cvid&&null!==e.cvid&&"null"!==e.cvid?e.cvid:e.module;if("gsearch"===e.pfrom){var m=commonUtils.getFromToIndexes(parseInt(e.recordNum)-1,10);d=e.FROM_INDEX=m[0],e.TO_INDEX=m[1],d--}e.forRp=!0;for(var u=[];c&&crmNavig[c]&&crmNavig[c].recordId[d]&&d<=parseInt(e.TO_INDEX);)u.push(crmNavig[c].recordId[d].id),d++;if(!crmNavig[c]&&void 0!==crmNavig.NAVIGCACHEOBJ.globalSearch&&void 0!==crmNavig.NAVIGCACHEOBJ.globalSearch.data){const e=crmNavig.NAVIGCACHEOBJ.globalSearch.data[c];e&&e.flat().forEach((e=>u.push(e.id)))}var p;delete e.step,p="Calls"===e.module&&Crm.renderDVLyteFlow("Calls")?Lyte.injectResources(networkUtils.returnDependencyFiles(["call-fromto-field.js","calls-cvcard.js","entity-field.js","calls-kanbancard.js"],ResourceConstants.CRMClient)):Promise.resolve();var g=new Promise((function(i){var l=networkUtils.constructEncodedUrl(Crm.getCrmBasePath()+"/RelActCV.do",e,!0);(new crmRequestPool).initiate({action:l,type:"GET",data:{seIds:u.toString()},success:function(s){if(t?a?(a.outlet="#show",a.html=s,i(a)):i({outlet:"#show",html:s}):$("#show").html(s),l=l.replace("fromActivityListView=true&",""),e.cvid&&null!==e.cvid&&"null"!==e.cvid&&(crmNavig.customViewKey=e.cvid),crmNavig[crmNavig.customViewKey]&&(crmNavig[crmNavig.customViewKey].rpURl=l),cvUrlInfo.CV_URL=l+"&seIds="+u,crmNavig.removeFeaturCacheObj("gsearch"),!t){var n=$("#detailCView").children().length;if(n<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var r=parseInt(getObj("cvFromIndex").value);parseInt(getObj("cvToIndex").value);$("#from_To").text(r+" - "+(r+n-1))}i()}}})})),v=[];void 0!==i&&v.push(i),v.push(g),v.push(p),Lyte.resolvePromises(v).then((function(e){void 0!==e[0]&&t(e[0])}))}}function selectCurrentCV(e){var t=$("#taskDetailsPart").find("form").attr("name");if(!t||-1==t.indexOf("createEntityForm")){var a=getObj("detailCView");if($(a).find("li.selectedRightActivity").removeClass("selectedRightActivity"),e=e||$("[name='id']").val()){var i=$("#detailView_"+e);if(i.length){i.addClass("selectedRightActivity").length;Territory.doHighLight("#rightPanelInfo",i,$("#rightPanelInfo").offset().top,$("#rightPanelInfo").height())}else crmNavig.parseCurrentListView(!0)}setTimeout((function(){var e=$("#backArrowDV").clone().addClass("fL pR5"),t=$("#relcvname");0===t.find("#backArrowDV").length&&(Crm.lyteHeaderNeeded(detailView.currentModule)?t.prepend(e.attr("onclick","crmHistory.backOneLevel()").removeClass("hide")):t.prepend(e.removeClass("hide")))}),300)}}function disableAll(e){var t=e.sModule.length,a=e.sModule,l=e.sModule[0].checked;for(i=1;i<t;i++){a[i].checked=l}}function showHideNew(e){var t=getObj(e);t&&("none"==t.style.display?(t.style.display="",thirdPartyUtils.bindSelect2($(".newSelect").find("select"))):"block"!=t.style.display&&""!=t.style.display||(t.style.display="none"))}function placeExtra(){try{buttonIdChange()}catch(e){}var e=document.getElementById("btl"),t=document.getElementById("getPushToDB"),a=document.getElementById("placePushToDB"),i=document.getElementById("tcInner"),l=document.getElementById("tcDiv");i&&l&&($(l).empty(),l.innerHTML=i.innerHTML),e&&document.showcvdetails&&(e.style.display="none"),t&&a&&($(a).empty(),a.innerHTML=t.innerHTML);var s=getAccessibleObj("getMailOpt"),n=getAccessibleObj("putMailOpt");s&&n&&($(n).empty(),n.innerHTML=s.innerHTML)}function swapACPcount(e,t,a,i,l){var s=0,n=0,r=0,o=0;document.getElementById("totalLead")&&(s=document.getElementById("totalLead").value),document.getElementById("totalContact")&&(n=document.getElementById("totalContact").value),document.getElementById("totalPotential")&&(r=document.getElementById("totalPotential").value),document.getElementById("potentialAmount")&&(o=document.getElementById("potentialAmount").value),0==s||"0"==s?($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+t+"</span><br><span class='title'>"+n+"</span></td><td valign='top' style='border:none'><span class='relListHead'>"+a+"</span><br><span class='title'>"+r+"</span><br><span>"+i+"&nbsp; </span><span>"+o+"</span></td></tr></table>"):0!=s||0!=n||0!=r?($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+e+"</span><br><span class='title'>"+s+"</span></td><td valign='top'><span class='relListHead'>"+t+"</span><br><span class='title'>"+n+"</span></td><td valign='top' style='border:none'><span class='relListHead'>"+a+"</span><br><span class='title'>"+r+"</span><br><span>"+i+"&nbsp; </span><span>"+o+"</span></td></tr></table>"):($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+l+"</span></td></tr></table>"),$("#showSummaryAlink").empty(),document.getElementById("showSummaryAlink").style.display="none"}function closeCal(e){e&&sE(e)}function showHideListViewBtnFn(e){var t=$(".cvBtnHeader");($("#listviewtablescroll").length||$("#stageViewContainer").length||$("#canvasview-container").length)&&t.css("overflow","hidden"),clearTimeout(crmListView.listviewActionTimer);var a=Lyte.Router.getRouteInstance().routeName,i=$("#listviewButtonLayerDiv");if("list"===a||"canvas"===a||"kanban"===a||"zia"===a||"chart"===a){var l=document.getElementsByTagName("crm-custom-outer-box")[0],s=l.getData("selectedIds");if(s&&s.length&&(l.setData("selectedIds",[]),"list"===a)){for(var n=$("#listviewtablescroll lyte-checkbox[data-id='selectEntity'] .customCheckBoxChecked"),r=n.length,o=0;o<r;o++)n[o].closest("lyte-checkbox").ltProp("class","customCheckBox"),n[o].classList.add("customCheckBox"),n[o].classList.remove("customCheckBoxChecked"),n[o].closest("lyte-exptable-tr").classList.remove("listViewRowSelected");var d=document.getElementById("listviewHeaderRow"),c=d.querySelector("lyte-checkbox");d&&c&&c.ltProp("class","customCheckBox")}var m=$("crm-customview-buttons");$("#listviewButtonLayer").length>0&&m[0]&&($("#custom_layer_table").removeClass("cvtransform"),document.getElementsByTagName("crm-custom-filter")[0].classList.remove("selectAllOverlay"),m[0].setData("selectAllEntity",!1),document.getElementById("viewcontainer").classList.remove("selectAllOverlay"),setTimeout((function(){$L("crm-customview-layer")[0].style.visibility="visible",$("#listviewButtonLayer").css({visibility:"hidden"})}),200))}if(crmListView.getObject().selectedIds&&0==crmListView.getObject().selectedIds.length){var u=$("#cvTable");u.css("visibility","visible"),t.hasClass("headNormalPost")?$(".detailPageNation").removeClass("detailPageNationAct"):$(".detailPageNation").addClass("detailPageNationAct"),u.removeClass("cvTableAct"),t.removeClass("cvBtnHeaderAct"),cvTablDown(),i.removeClass("privacyDBbtnHeadShow"),crmListView.getObject().isCampaignAddMemberListView&&$("#addCampaignMembersNextButton").addClass("dN")}else $("#cvTable").addClass("cvTableAct"),$("#selectAllRecords").length>0&&0==customViewObject.showSelectAll?($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,customViewObject.doMassActioninScheduler=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})):customViewObject.selectAllInCurrentView&&!customViewObject.doMassActioninScheduler&&customViewObject.totalCount<=Crm.massOperationTotalLimit&&$("#selectAllRecords").length>0&&"customCheckBoxChecked"==$("#checkAll").attr("class")&&$("#selectAllRecords").show(),i.css({display:"",visibility:"visible"}),customViewObject.isPrivacyListView&&i.addClass("privacyDBbtnHeadShow"),crmListView.getObject().isCampaignAddMemberListView&&(i.addClass("privacyDBbtnHeadShow"),$("#addCampaignMembersNextButton").removeClass("dN")),0==customViewObject.doMassActioninScheduler&&$("#selectAllRecords").length>0&&($("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})),0==customViewObject.doMassActioninScheduler&&void 0!==customViewObject.totalCount&&customViewObject.totalCount>Crm.massOperationTotalLimit?($("#selectAllRecords").length>0&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})),$("#macroDiv").css({display:"",visibility:"visible"}),$("#moreActionsDiv").css({display:"",visibility:"visible"})):1==customViewObject.doMassActioninScheduler&&(customViewObject.totalCount<=Crm.massOperationTotalLimit||customViewObject.indTotalCount<=Crm.massOperationTotalLimit)?showMassOperationsForScheduler():($("#macroDiv").css({display:"",visibility:"visible"}),$("#moreActionsDiv").css({display:"",visibility:"visible"})),$(".detailPageNation").addClass("detailPageNationAct"),cvTablUp(e)}function cvTablUp(e){$(".cvBtnHeader").addClass("cvBtnHeaderAct"),crmListView.listviewActionTimer=setTimeout((function(){$("#cvTable").css("visibility","hidden"),$(".cvBtnHeader").css("overflow","inherit")}),500);var t,a=!1;t=e?$("#"+e+" .customCheckBox[data-cid=selectEntity]"):$(".customCheckBox[data-cid=selectEntity]");for(var i=0;i<t.length;i++){var l=$(t)[i];if("customCheckBox"==$(l).attr("class")){a=!0;break}}if(customViewObject.doMassActioninScheduler&&0==customViewObject.selectedStages.length&&("customCheckBox"==$("#checkAll").attr("class")||"customCheckBox checkAlllistView"==$("#checkAll").attr("class")||a)){var s=crmListView.getObject().module,n=crmTab.getFromCache(s).selectedIds,r=crmListView.getObject().fromIndex;$("#checkAll").attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked");for(i=0;i<t.length;i++){l=$(t)[i];$(l).attr("class","customCheckBoxChecked"),crmListView.getObject().isStageView&&$(l).closest("li").addClass("sv-stage-card-selected"),$(l).closest("tr").css("background-color","var(--tableHighlight)").addClass("setTdBorBtm"),0==$(l).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(l).closest("tr").prev("tr").addClass("setTdBorBtm"),selectedId=JSON.parse($(l).attr("data-params")).entityId,n.contains(selectedId)||n.push(selectedId)}crmListView.startIndex.hasOwnProperty(r)?crmListView.startIndex[r]=crmListView.startIndex[r]+t.length:crmListView.startIndex[r]=t.length,crmTab.getFromCache(s).selectedIds=customViewObject.selectedIds=n}}function cvTablDown(){crmListView.listviewActionTimer=setTimeout((function(){$("#listviewButtonLayerDiv").css("visibility","hidden"),customViewObject.selectAllInCurrentView=!1,customViewObject.doMassActioninScheduler=!1,$("#selectAllRecords").length>0&&$("#selectAllRecords").hide();for(var e=!1,t=customViewObject.moreActions?customViewObject.moreActions.length:0,a=0;a<t;a++)if("hideSelectAllRecords"==customViewObject.moreActions[a]){e=!0;break}void 0===customViewObject.filters&&"All"===customViewObject.searchletter?($("#selectAllRecords").hide(),customViewObject.showSelectAll=!0):(customViewObject.filters&&customViewObject.filters.length>0||"All"!==customViewObject.searchletter)&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1),e&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1),$("#maxLimitAlertMassOperation").length>0&&$("#maxLimitAlertMassOperation").css("display","none"),$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"}),$(".cvBtnHeader").css("overflow","inherit")}),500)}function validateAddUser(){$("#j_saveuser").prop("disabled",!0);var e=getObj("orgName");if(e&&""==e.value)return $("#userErrorMsgDisp").empty(),getObj("userErrorMsgDisp").innerHTML=document.getElementById("compnamealert").value,getObj("userErrorMsgDisp").style.display="block",$("#j_saveuser").prop("disabled",!1),!1;getElemById("userTerritoryIds")&&setTerritoryValue(),"None"==$("#addUserReporting").val()&&$("#userReporting").remove(),UpdateDetails(["newUserForm"],document.addUserForm,"","",(function(){$("#j_saveuser").prop("disabled",!1).val(I18n.getMsg("crm.button.save"))}))}function setTerritoryValue(){var e=[];$("#territories li").each((function(){var t=this.id;t=t.replace("li",""),e.push(t)})),$('form[name="addUserForm"] #userTerritoryIds').val(e.join(","))}function getFieldPresencePopup(e){var t=!0,a=e;if("object"!=typeof e&&(t=validationUtils.IsJsonString(e))&&(a=JSON.parse(e)),t){if(e&&null!=e.InvalidCriteria)return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("cpq.pr.criteriaerror"),ltPropType:"error"}}),commonUtils.showHideLoadingDiv(!1),!0;if(null!==a.FieldPresenceError&&"FieldPresenceError"===a.FieldPresenceError){var i=null!==a.FieldIds?a.FieldIds:null;if(null!==i){var l=i.length,s="",n=0,r=0,o=!1,d={Groups:{},Roles:{},Territories:{}};d.Groups.value=[],d.Roles.value=[],d.Territories.value=[],d.Groups.key="",d.Roles.key="",d.Territories.key="";for(var c=automationActions.comboBoxInfo.comboBoxInfo_TO.optionModels,m=automationActions.comboBoxInfo.comboBoxInfo_CC.optionModels.length,u=0;u<m;u++){var p=automationActions.comboBoxInfo.comboBoxInfo_CC.optionModels[u];c.contains(p)||c.concat(p)}m=automationActions.comboBoxInfo.comboBoxInfo_BCC.optionModels.length;for(u=0;u<m;u++){p=automationActions.comboBoxInfo.comboBoxInfo_BCC.optionModels[u];c.contains(p)||c.concat(p)}var g=[];for(u=0;u<l;u++)if("Creator"===i[u])s+="Creator, ",n++,o=!0;else for(var v=c.length,h=0;h<v;h++){var f=c[h];if("availEmailFieldPL"===f.prefix.split(":")[0]||"availRelEmailFieldPL"===f.prefix.split(":")[0]){var C=c[h].cxPropOptions.length;if("availRelEmailFieldPL"===f.prefix.split(":")[0]&&f.prefix.split(":")[1].split("_")[1]===i[u]){g.push($ESAPI.encoder().encodeForHTML(f.name)),n++,o=!0;break}for(var y=0;y<C;y++)if(f.cxPropOptions[y].id.split(":")[1]===i[u]){-1===g.indexOf(f.cxPropOptions[y].name)&&g.push($ESAPI.encoder().encodeForHTML(f.cxPropOptions[y].name)),"REF"!==f.cxPropOptions[y].id.split(":")[0]&&(n++,o=!0);break}}else if("G"===f.prefix.split(":")[0]||"R"===f.prefix.split(":")[0]||"RS"===f.prefix.split(":")[0]||"T"===f.prefix.split(":")[0]||"TS"===f.prefix.split(":")[0])for(C=c[h].cxPropOptions.length,y=0;y<C;y++)if(f.cxPropOptions[y].id===i[u]){var b=f.cxPropOptions[y].name;r++,o=!0,"G"===f.prefix.split(":")[0]?(d.Groups.value.push(b),d.Groups.key=I18n.getMsg("crm.profile.groups")):"R"===f.prefix.split(":")[0]||"RS"===f.prefix.split(":")[0]&&!d.Roles.value.includes(b)?(d.Roles.value.push(b),d.Roles.key=I18n.getMsg("crm.profile.roles")):("T"===f.prefix.split(":")[0]||"TS"===f.prefix.split(":")[0]&&!d.Territories.value.includes(b))&&(d.Territories.value.push(b),d.Territories.key=I18n.getMsg("Territories"));break}}var w="",I=g.length;for(u=0;u<I;u++)s+=g[u]+", ";if(s=s.substring(0,s.length-2),n>1?w=I18n.getMsg("crm.workflow.alert.multipleEmailFieldNotPresentMsg",s):1===n&&(w=I18n.getMsg("crm.workflow.alert.emailFieldNotPresentMsg",s)),r>0){var L="";for(users in d){var A="";if((b=d[users].value).length>0){var E=b.length;for(u=0;u<E;u++)A+=b[u]+", ";A=A.substring(0,A.length-2)+"  ",L+=d[users].key+" - "+A}}L=I18n.getMsg("crm.workflow.alert.othervaluesNotPresent",L)}else L="";o&&renderingUtils.showCustomAlert(w.concat("<br>",L),null,!0);var S=$("#save_Alert");return void 0!==S&&S[0].removeAttribute("disabled"),commonUtils.showHideLoadingDiv(),!0}}}return!1}function UpdateDetails(e,t,a,i,l,s,n){var r,o="",d=!0,c="",m=$("#isSandboxAddDeveloper").val(),u=Crm.isMultiSandboxEnabled;event&&(event.target&&"submit"==event.target.type||"submit"==event.type)&&(r=!0),$("#deletepopup").is(":visible")&&hideAnimatePopup("deletepopup");if(e&&e.length){c=e[0];var p=e.slice(1);if(d=window[c].apply(window,p),"true"===m&&u){var g=$L("#selectSandboxDropdown")[0].ltProp("selected");"[]"===g||""===g?($("#displayContent_sandboxName_Add").removeClass("dN"),d=!1):JSON.parse(g).length>10?($("#displayContent_sandboxName_Add").addClass("dN"),$("#displayContent_sandboxName_Limit").removeClass("dN"),d=!1):($("#displayContent_sandboxName_Add").addClass("dN"),$("#displayContent_sandboxName_Limit").addClass("dN"))}}var v=$(t).attr("action");if(o=v,null!=a&&""!=a&&(o=a),d){$("#j_saveuser")&&$("#j_saveuser").prop("disabled",!0).val(I18n.getMsg("crm.signup.wait")+"...");var h=!1;"WFFieldDetails"==t.name&&(h=!0);var f=$("#reportingtoId");if(f.length>0){var C=$("#reportingToDropdown")[0].component.getData("cxPropSelectedUser").id;f.val(C)}var y=0,b=/^criteria_\d+$/;t.elements.forEach((e=>{b.test(e.name)&&y++}));var w=e=>{var t=["crmcompetitormentions_positive_competitors__s","crmcompetitormentions_negative_competitors__s","crmcompetitormentions_neutral_competitors__s"];return e.forEach((e=>{e instanceof String||(Array.isArray(e)?e=w(e):e.api_name&&t.includes(e.api_name.split(".")[1])&&(e.value=e.value.match(E).sort().join()))})),e},I=1;for(I=1;I<=y;I++){var L="criteria_"+I,A=t.elements[L];if(A){var E=/(?:\\,|[^,])+/g,S=JSON.parse(A.value);S.relCrt&&"Competitor Mentions"===S.relCrt.module&&S.relCrt.criteriaJSON&&(S.relCrt.criteriaJSON=w(S.relCrt.criteriaJSON),t.elements[L].value=JSON.stringify(S))}}var R=commonUtils.formData2QueryString(t,void 0,h),T=$(t).attr("name");if(void 0!==n&&(R+="&hierarchyDetails="+encodeURIComponent(JSON.stringify(n))),"profilePerForm"==T)R+=unCheckedPermissions();var _=$("#entityID");"true"===Crm.userDetails.MPL_MIGRATION_COMPLETED&&o===Crm.getCrmBasePath()+"/CustomRelatedList.do?action=saveCustomFormAsRelatedList"&&_.length>0&&(R=R+"&entityId="+_.val()),"true"===m&&u&&(R=R+"&sandboxIds="+g);var k=$("#j_username")?$("#j_username").val():"";return commonUtils.showHideLoadingDiv(!0),$.ajax({type:"POST",url:v,data:R,success:function(e){if(e&&"string"==typeof e&&e.indexOf("CUSTOM_RELATED_LIST_ERROR")>-1){const t=JSON.parse(e).CUSTOM_RELATED_LIST_ERROR;return crmui.showMsgBand("error",t,"2000"),commonUtils.showHideLoadingDiv(!1),!1}if(r&&"updateEscalationForEscRuleEntry"!==t.action.value&&"addEscalationForEscRuleEntry"!==t.action.value){var a=Lyte.Router.getRouteInstance().transition.info;"crm.settings.section.case-escalation-rule.view-case-escalation-rule"===a.route&&a.queryParams.entryId&&Lyte.Router.getRouteInstance().setQueryParams("entryId",void 0,!1)}if(e.misMatchType)networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js",networkUtils.getI18nJSUrl("reportingtopopup")],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change);var t=$("#roleChangePopUp");t.length>0&&t.remove(),$("#show").append(Handlebars.templates.role_branch_change(e));var a=$("#roleDD"),i=[];a.children().each((function(){var e=$(this).val();i.contains(e)?$(this).remove():i.push(e)})),showAnimatePopup("roleChangePopUp"),userSelect(),a.trigger("change"),$("#subOrdinateList").hide()}));else{if("scheduler running"===e.error)return crmui.showPopup("scheduler_Sharing_Rule"),void commonUtils.showHideLoadingDiv();if("module unavailable"===e.error)return crmui.showPopup("module_Sharing_Rule"),void commonUtils.showHideLoadingDiv();if("deleted_role/group/DSR_selected"!==e.error){if("invalid_ruleid"===e.error)return crmui.showMsgBand("error",I18n.getMsg("com.datasharingrules.error.unavailable"),4e3),void commonUtils.showHideLoadingDiv();var i=$("#save_Alert");if("PermissionDeniedIAR"==e)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void(void 0!==i&&i[0].removeAttribute("disabled"));if(!($("#wfNewAlert").length>0&&getFieldPresencePopup(e))){if($("[name=fromModuleBuilder]").length>0&&"object"==typeof e&&null!=l&&"function"==typeof l)return commonUtils.showHideLoadingDiv(),l(e),!1;if(networkUtils.loadFeatureScripts(["zohocrm_msintegration.js",networkUtils.getI18nJSUrl("office365")],(function(){""!==msApps.approvalList&&k&&""!==k&&"ALERTERROR:::"!==e.substring(0,"ALERTERROR:::".length)&&msApps.removeAddeduserFromUserList(k)})),-1==e.indexOf("tError")||-1!==e.indexOf("msUserDD")){var s="result";if(getObj("subTabBottomDiv")&&(s="subTabBottomDiv"),"ALERTERROR:::"===e.substring(0,"ALERTERROR:::".length)){var n=e.split("ALERTERROR:::"),d=$(t).find("#userErrorMsgDisp")[0];if($("#tpUsers")&&null!=$("#tpUsers").val()&&$("#tpUsers").select2({placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),allowClear:!1,templateResult:tpuserName,templateSelection:tpuserName,matcher:function(e,t){return matchStart(e,t)},escapeMarkup:function(e){return e}}),d){if($(d).empty(),n[1].includes("OTHERDC:::")){n[1]=n[1].replace("OTHERDC:::",""),$(d).removeClass(),$(d).addClass("crmErrorSection dF"),$(d).append('<span class="zcicncss-warning-rounded zcicn-cssIcons zcicn_darkRed_mask pR10"></span>');let e=$('<span class="pL5"></span>').html(n[1]);$(d).append(e)}else d.innerHTML=n[1];return d.style.display="block",commonUtils.showHideLoadingDiv(),!1}}if(-1!=this.data.indexOf("isSandboxAddDeveloper"))return $("#adduserPopup").hide(),commonUtils.showHideLoadingDiv(!1),renderingUtils.removeFreezeLayer(),renderingUtils.hideFreezeLayer(),void $L("crm-profile-menu")[0].component.actions.featureMarkCompletion("teamInvite");if("newUserForm"===c&&Crm.trackSpotLightAction("Users - Added"),o!==Crm.getCrmBasePath()+"/Role.do?action=transferAndDel"||"ALERTERROR:::"!==e.substring(0,"ALERTERROR:::".length)){if(o===Crm.getCrmBasePath()+"/WorkFlowTask.do?step=createTask")Crm.trackSpotLightAction("Workflow Tasks - Added",{Place:"Tasks"});else if(o===Crm.getCrmBasePath()+"/WorkFlowTask.do?step=updateTask")Crm.trackSpotLightAction("Workflow Tasks - Updated",{Place:"Tasks"});else if(o==Crm.getCrmBasePath()+"/potentials/EditOrgFiscal.do?action=saveFiscal")Crm.trackSpotLightAction("Fiscal Month Changed");else if(o===Crm.getCrmBasePath()+"/WorkFlowWebHook.do?step=createWebHook")Crm.trackSpotLightAction("Webhook Configured");else if(o===Crm.getCrmBasePath()+"/WorkFlowAlert.do?step=createAlert")Crm.trackSpotLightAction("Workflow Alerts - Added");else if(o==Crm.getCrmBasePath()+"/autoresprules.do"){"createEmptyRule"===(u=getObj("action")?getObj("action").value:"")&&Crm.trackSpotLightAction("Autoresponder Rule Created")}else if(o==Crm.getCrmBasePath()+"/CaseEscalation.do"){"addBusinessHour"==(u=getObj("action")?getObj("action").value:"")&&Crm.trackSpotLightAction("Business Hour Added")}if(void 0!==l&&"function"==typeof l&&-1===o.indexOf("SharingSetting"))if(""==e)l();else if(-1!=e.indexOf("InvalidWebHookUrl"))wfNew.showWebHookInValidAlert();else if("true"==e)$("#relatedListDuplicateDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListDuplicateDiv").hide()}),5e3);else if(-1!=e.indexOf("customRelatedListCountExceeded")){var m=e.split(":")[1];$("#relatedListLimitExceededDiv").html(I18n.getValueForFields("crm.label.newrelatedlist.exceeded",m)),$("#relatedListLimitExceededDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListLimitExceededDiv").hide()}),5e3)}else $("#relatedListErrorDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListErrorDiv").hide()}),5e3);else if(getObj("basic")&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50}),"addUserForm"===T&&"true"===$(document.viewAllUsersForm).attr("data-ispersonal"))""!=$("#showAddUser").val()&&"true"==$("#showAddUser").val()?($("#bulkUpdateSuccess").show(),$("#bulkUpdateSuccess").html("User Added Successfully!"),setTimeout((function(){$("#bulkUpdateSuccess").hide()}),2e3)):mR(Crm.getCrmBasePath()+"/ShowDetails.do?module=Setup&isload=true&loadJson=true",(function(e){$("#show").html(e),$("#usersPermi_users").trigger("click")})),hideAnimatePopup("topBandPopup");else{if(""!=$("#showAddUser").val()&&"true"==$("#showAddUser").val())$("#bulkUpdateSuccess").show(),$("#bulkUpdateSuccess").html("User Added Successfully!"),setTimeout((function(){$("#bulkUpdateSuccess").hide()}),2e3);else{var u;if($("#"+s).show(),$("#subTabBottomDiv").hasClass("setBgClr")&&($("#subTabBottomDiv").removeClass("setBgClr"),$("#setup_new_ContentDiv").removeClass("workflow_rule")),o===Crm.getCrmBasePath()+"/CaseEscalation.do"||-1!==o.indexOf(Crm.getCrmBasePath()+"/CaseEscalation.do?action=deleteEscRuleEntry"))"createBusinessHour"!==(u=$(t).find("input[name='action']").val())&&"editBusinessHour"!==u&&"addBusinessHour"!==u&&"updateBusinessHour"!==u&&"addEscRuleEntry"!==u&&"newEscRule"!==u&&"renameEscRule"!==u&&"addEscalationForEscRuleEntry"!==u&&"updateEscRuleEntry"!==u&&Lyte.Router.transitionTo(Lyte.Router.getRouteInstance().transition.info);if($("#"+s).empty(),$("#"+s)[0].innerHTML=e,o===Crm.getCrmBasePath()+"/Role.do?action=transferAndDel"&&$("#result").find("#roleListPage").length>0){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles").data={data:e};var p={status:"progress"};p.message=I18n.getMsg("crm.role.transfer.delete.inprogress",[t.getElementsByTagName("td")[1].innerText]),crmSchedulerNotification.addOrUpdateStatus(p,I18n.getMsg("crm.role.transfer.delete.status"))}JSEvalScript(getObj(s)),wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),$("#roleChangePopUp").length>0&&showAnimatePopup("roleChangePopUp"),-1!==o.indexOf("SharingSetting")&&-1!==o.indexOf("delRule")&&0===$("#sharingRuleUnavailable").length&&(UserModule.showSharingRuleSuccessPopup("delRule"),l())}hideAnimatePopup("topBandPopup")}return thirdPartyUtils.bindSelect2($(".newSelect").find("select")),commonUtils.showHideLoadingDiv(!1),!1}Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles").data={data:e}}else alert(I18n.getMsg("crm.alert.thresholdError"))}}else l(e)}},error:function(e){400===e.status&&e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1&&renderingUtils.showCustomAlert(I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1])),-1!==o.indexOf(Crm.getCrmBasePath()+"/SharingSetting.do?action=updateOrgDefPer")&&(hideAnimatePopup("editOrgDefDiv"),renderingUtils.displayPermissionDenied(e)),e.status===crmConstants.limitExceedsCode?Search.displayLookupExceedsMsg(e):400===e.status&&"CRITERIA_LIMIT_EXCEEDED"===e.responseText?renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.limit.error",Search.MAX_CRT_CNT)):(401===e.status&&o.indexOf("Role.do")>-1||401===e.status&&o.indexOf("WorkFlowTask.do")>-1)&&renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()}}),!1}return!1}function updateAndStayonPage(e,t){commonUtils.showHideLoadingDiv(!0);var a=validate(),i=e.action,l=commonUtils.formData2QueryString(e);return a&&$.ajax({type:"POST",url:i,data:l,success:function(a){(commonUtils.showHideLoadingDiv(),getObj("basic")&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50}),"SignatureForm"===e.name&&!0===t)&&(setSignatureContent(a),"plaintext"==$("#emailEditor").data("zEditor").mode?$("form[name=SignatureForm]").find("iframe").contents().find("body").text(a):$("form[name=SignatureForm]").find("iframe").contents().find("body").html(a));return!1}}),!1}function navTwenty(e){var t,a=document.getElementsByName("chk");for(t=0;t<a.length;t++)a[t].checked=!1;if(-1!=encodeURIComponent(e).indexOf(encodeURIComponent("isload=false")))if(document.recyclebin){document.recyclebin.sortColumnString.value="";var i=commonUtils.formData2QueryString(document.recyclebin);doAjaxUpdate("result",e,i,updateRBRecCountFromCache)}else doAjaxUpdate("result",e,updateRBRecCountFromCache);else document.location.href=e}function loadRecycleBinTotalRecCount(){var e=new getHTTPObject,t="https://"+location.host+Crm.getCrmBasePath()+"/ShowRBList.do?"+commonUtils.formData2QueryString(document.recyclebin)+"loadRBRecCount=true";e.open("GET",t,!0),e.onreadystatechange=function(){if(4==e.readyState){var t=e.responseText.trim();$("#rbRecCount").html(t),crmTab.getFromCache("RecycleBin")?crmTab.getFromCache("RecycleBin").totalCount=t:crmTab.cacheObj.RecycleBin={totalCount:t}}},e.send(null)}function updateRBRecCountFromCache(){crmTab&&crmTab.getFromCache("RecycleBin")&&crmTab.getFromCache("RecycleBin").totalCount?$("#rbRecCount").html(crmTab.getFromCache("RecycleBin").totalCount):loadRecycleBinTotalRecCount()}function buttonIdChange(){if(null!=getObj("lvBottomButtonTD")){var e=getObj("lvBottomButtonTD"),t=e.getElementsByTagName("span");if(t[0]){var a=t[0].getElementsByTagName("input"),i=e.getElementsByTagName("div");a.length>0&&i.length>0&&(a[0].id="moreAct1",i[0].id="actionMenu1")}}}function showCustomizeBusinessCardPopup(e,t,a){networkUtils.loadFeatureScripts(["OptionChooser-min.js"],(function(){showCustomizePopup(e,t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,a,void 0)}))}function showCustomizePopup(e,t,a,i,l,s,n,r,o,d,c,m){var u,p;if((E=$("#id").val())||(E=CustomRelatedListObj.getCurrentPageDetails("entityId"),d?E=d.id:c&&(E=c)),void 0!==m){var g=m.getData("cxPropField");fileupload.module=t,fileupload.fieldID=g.id,fileupload.column_name=g.column_name}var v,h=$("#orgId");if(null==h||""===h.val()||"null"===h.val())return redirectTOCompanyInfo(),!1;if("RelatedList"==e)u=Crm.getCrmBasePath()+"/CustomizePage.do?module="+t+"&id="+E+"&entityid="+E+"&nocache="+(new Date).getTime();else if("SummaryView"==e)u=d?Crm.getCrmBasePath()+"/CustomizeBC.do?module="+t+"&id="+E+"&cvid="+d.cvid+"&recordNum="+d.recordNum:Crm.getCrmBasePath()+"/CustomizeBC.do?module="+t+"&id="+E+"&cvid="+getObj("cvid").value+"&recordNum="+getObj("recordNum").value;else if("CreateList"==e)t||(t=$("[id=module]").val()),u=Crm.getCrmBasePath()+"/CustomButton.do?step=createCustomButton&module="+t+"&component=link",null==$("[id=fromPage]").val()||"setup"!=$("[id=fromPage]").val()&&!$("#topBandPopup").is(":visible")?u+="&fromPage=popup":u+="&fromPage="+$("[id=fromPage]").val();else if("ManageLink"==e)u=Crm.getCrmBasePath()+"/CustomButton.do?step=loadCustomButtonsForModule&module="+t+"&component=Links&fromPage=detailPage",p="manageLink";else if("createTabGroup"==e)u=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action="+e+"&isFrom="+t;else if("tabGroupList"==e)u=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action="+e+"&isFrom="+t;else if("addDeveloper"==e)u=Crm.getCrmBasePath()+"/Security.do?actionName=newUser&mode=create&tptype=5&showAddUser="+t;else if("addUser"==e)u=Crm.getCrmBasePath()+"/Security.do?actionName=newUser&mode=create&showAddUser="+t;else if("Attach"==e){if(1==l){var f=!1;if(null!=n){var C=$(n).attr("data-subformname")?$(n).attr("data-subformname"):$(n).attr("data-module"),y=$(n).attr("data-fieldid");fileupload.module=C,fileupload.fieldID=y}if(5==s&&(f=!0),Crm.userDetails.CLIENT_ACCOUNT&&(fileupload.rowNum=fileupload.rowNum&&""===fileupload.rowNum&&o?o:o||"",fileupload.isSubformField=!1,fileupload.elementClass="",o)){var b=$(n).data("subformdisplaylabel");fileupload.module=b||fileupload.module,fileupload.elementClass=$(n).attr("id"),fileupload.isSubformField=!0}var w=$("#attachSize_"+fileupload.fieldID+fileupload.rowNum).val(),I=$("#attachCount_"+fileupload.fieldID+fileupload.rowNum).val();if(void 0===w&&void 0!==m){var L=m.getData("cxPropValue");w=0,I=0,L.forEach((e=>{w+=parseInt(e.size)})),I=L.length}if(""==w&&(w=0),fileupload.cxPropId){var A=Lyte.registeredMixins["crm-uploadfields-mixin"];w=A.getFileUploadAttachedSize(fileupload.cxPropId),I=A.getFileUploadAttachedCount(fileupload.cxPropId)}u=Crm.getCrmBasePath()+"/NewFileAttachment.do?module="+fileupload.module+"&fromFileUploadField=true&fieldId="+fileupload.fieldID+"&attachedSize="+w+"&attachedCount="+I,r&&(u+="&isAjaxEdit=true")}else{var E,S;d?(C=d.module,E=d.entityId,S=d.cvid,fileupload.module=d.module):"bluePrint"===i&&(C=getAttachmentModule(i),E=getAttachmentEntityId(i),S=getAttachmentCvid(i));var R=void 0===getObj("recordNum")?null:getObj("recordNum").value;u=Crm.getCrmBasePath()+"/NewFileAttachment.do?module="+C+"&returnAnchor="+t+"&id="+E+"&cvid="+S+"&recordNum="+R}getElemById("attachTotCnt")&&(u+="&attachTotCnt="+getElemById("attachTotCnt").value);var T="false";try{FileUploader&&(T="true")}catch(e){T="false"}u+="&newAttachFlow="+T,void 0!==i&&(u+="&fromSrc="+i)}if("ManageLink"==e||"CreateList"==e)renderingUtils.showFreezeLayer(),store.findAll("dummy",{},!1,!1,{url:"/crm/v6/__features?api_names=custom_link_new_tab",method:"GET"}).then((function(a){if(a.__features&&a.__features[0]){var i=networkUtils.returnDependencyFiles(["crux-merge-field.css","lyte-beta-popover.css","crm-custom-link.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles(["custom_link_model.js","crm-custom-link.js","crm-custom-link-list-view.js","lyte-hovercard.js","crux-merge-field.js","lyte-caret.js","crux-lazyLoad.js","crux-parent-form-component.js","crm-client-portal-module.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("customLink"),ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("CrmPermissionPopup"),ResourceConstants.CRM),r=l.concat(s).concat(n).concat(i);Lyte.injectResources(r,void 0,(function(){var a=[],i=moduleApiMapping[t],l=moduleDetailedInfo.modules.filter((e=>e.api_name===i)),s={get_assigned:{feature:"module",related_entity_id:l&&0!==l.length?l[0].id:moduleRecordMapping[t].id,page:1,per_page:200}};a.push(store.findAll("custom_link",{module:i},!1,!0,{isV6Api:!0})),a.push(store.triggerAction("profile","get_assigned",void 0,void 0,"POST",s)),a.push(store.findAll("dummy",{module:t,includelookups:!0},!1,!1,{url:"/crm/v2.2/settings/mergefields",method:"GET"})),a.push(store.findAll("dummy",{},!1,!1,{url:"/crm/v6/__features?api_names=custom_link",method:"GET"}));var n=Lyte.resolvePromises(a);Lyte.registeredMixins["crm-custom-link-mixin"].showLinkNewFlow(e,n,i,p,t)}))}else mR(u,(function(t){$("#topBandPopup").html(t),"ManageLink"==e&&$("#topBandPopup").setPopupClass(p),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),setTimeout((function(){getObj("linkLabel")&&$("#linkLabel").focus()}),500)}))}));else if("createTabGroup"==e||"tabGroupList"==e)mR(u,(function(t){if(-1!=t.toString().indexOf("TABGROUPLIMITEXCEED")){var a=t.split(":")[1];alert(I18n.getMsg("crm.tabgroup.length.exceeded",a))}else{if($("#topBandPopup").html(t),"createTabGroup"===e)$('[name=CustomizeTabGroupForm] [data-zcqa="btn_tab_cancel"]').attr("onclick","hideAnimatePopup('topBandPopup');");showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),setTimeout((function(){getObj("tabGroupName")&&getObj("tabGroupName").focus()}),500)}}));else if("addUser"==e||"addDeveloper"==e){var _="";a&&(_="isMsAppsCreate=true",msApps.userNextPage&&(msApps.data.nextlink=msApps.userNextPage,$("#tpUsers").one("select2:open",(function(e){msApps.lazyLoadUsers(),$("#select2-tpUsers-results").parent().parent().find(".select2-search__field").attr("onkeyup","msApps.searchMSUsers();")})))),"addLiteUser"===i&&(_="isLiteUserCreate=true"),mR(u,(function(t){var l=t;try{var s,n=JSON.parse(l),r=n.accounttype;"CRMPLUS"!==r&&"ZOHOONE"!==r||(s=n.redirectUrl,window.open(s))}catch(e){}if("CRMPLUS"!=r&&"ZOHOONE"!=r)if(l.indexOf("ALERTERROR:::")>-1){var o=l.split("ALERTERROR:::");alert(o[1])}else if(l.indexOf("DeveloperLimitExceeds")>-1)crmui.showMsgBand("warning",I18n.getMsg("crm.sandbox.developer.limit.reached"),5e3);else{if(l.indexOf("LimitExceeds")>-1)return"addLiteUser"===i?(Crm.client_tracking("Lite exceed popup"),showAnimatePopup("liteUserLimitExceedsAlertDiv")):showAnimatePopup("limitExceedsAlertDiv"),!1;if($("#topBandPopup").html(l),$("#topBandPopup .popup-model-content").css({"max-height":renderingUtils.windowHeight-270}),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"addDeveloper"===e&&Crm.isMultiSandboxEnabled){var d=$L("crm-sandbox-list")[0].component.data.sandboxList,c=d.length;if(c>0){for(var m=new Array,u=0;u<c;u++)m.push({value:d[u].id,name:d[u].name});$L("#selectSandboxDropdown")[0].ltProp("options",JSON.parse(JSON.stringify(m)))}}}if(a){$("#fromTP").show();var p="<option data-fullname='' data-fn='' data-ln='' data-email='' selected>"+I18n.getMsg("crm.lar.rr.chooseUser")+"</option>";$("#tpUsers").append(p),networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("office365")],(function(){msApps.appendUsers(a)})),setTimeout((function(){$("#tpUsers").select2({placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),allowClear:!1,matcher:function(e,t){return matchStart(e,t)},templateResult:tpuserName,templateSelection:tpuserName,escapeMarkup:function(e){return e}}),msApps.userNextPage&&$("#tpUsers").one("select2:open",(function(e){msApps.lazyLoadUsers(),$("#select2-tpUsers-results").parent().parent().find(".select2-search__field").attr("onkeyup","msApps.searchMSUsers();")}))}),10),"true"!=$("#isMSAppsAcc").val()||!msApps||msApps.approvalList&&msApps.approvalList.id&&""!==msApps.approvalList.id?($("#fromTP").hide(),$("input[name='property(First Name)']").parent().parent().hide(),$("input[name='property(Last Name)']").parent().parent().hide(),$("#fN").hide(),$("#lN").hide(),$("#fullName").show(),$("#approveBTN").show(),$("#addUserBTN").hide()):($("input[name='property(First Name)']").parent().parent().hide(),$("input[name='property(Last Name)']").parent().parent().hide(),$("input[name='property(Email)']").parent().parent().hide(),$("#fN").hide(),$("#lN").hide(),$("#eM").hide(),$("#fullName").hide())}}),_)}else mR(u,(v=e,function(e){if($("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"Attach"===v)if(1==l)fileupload.bindFileUploaderForFileUploadField({save:crmConstants.FileUploader.fileUploadFieldAttachments.saveElement,uploadmethod:crmConstants.FileUploader.uploadMethod.ZFSNG,acceptedfiles:crmConstants.FileUploader.fileUploadFieldAttachments.acceptedfiles,previewtemplate:crmConstants.FileUploader.fileUploadFieldAttachments.previewtemplate,clickable:crmConstants.FileUploader.fileUploadFieldAttachments.clickableElement,container:crmConstants.FileUploader.fileUploadFieldAttachments.previewElement,cancel:crmConstants.FileUploader.fileUploadFieldAttachments.cancelElement,mainform:crmConstants.FileUploader.fileUploadFieldAttachments.mainformElement,uploadlimit:s,uploadsizeflex:crmConstants.FileUploader.fileUploadFieldAttachments.uploadSizeFlex,uploadsizelimit:fileupload.maximum_allowed_size?fileupload.maximum_allowed_size:crmConstants.FileUploader.fileUploadFieldAttachments.uploadSizeLimit,parallelupload:crmConstants.FileUploader.fileUploadFieldAttachments.parallelUpload,filesizebase:crmConstants.FileUploader.fileUploadFieldAttachments.fileSizeBase,progressratio:crmConstants.FileUploader.fileUploadFieldAttachments.progressratio,tabload:crmConstants.FileUploader.fileUploadFieldAttachments.tabLoadElement,attachframe:crmConstants.FileUploader.fileUploadFieldAttachments.targetAttachFrameElement,popupname:crmConstants.FileUploader.fileUploadFieldAttachments.popupName,module:fileupload.module,fieldId:fileupload.fieldID,column_name:fileupload.column_name,action:crmConstants.FileUploader.fileUploadFieldAttachments.action,resourcetype:crmConstants.Docs.ResourceTypes.ENTITY_ATTACHMENTS,workspace:crmConstants.Docs.WorkSpace.WS_ATTACHMENT_LIBRARY,zgid:Crm.userDetails.ZGID,needMultipleSelection:f});else{const e=/fromSrc=([^&]+)/,t=u.match(e),a=t?t[1]:null;(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].bindFileUploaderForRelatedListAttachments:crmRelatedList.bindFileUploaderForRelatedListAttachments)({save:crmConstants.FileUploader.relatedListAttachments.saveElement,uploadmethod:crmConstants.FileUploader.uploadMethod.ZFSNG,acceptedfiles:crmConstants.FileUploader.relatedListAttachments.acceptedfiles,previewtemplate:crmConstants.FileUploader.relatedListAttachments.previewtemplate,clickable:crmConstants.FileUploader.relatedListAttachments.clickableElement,container:crmConstants.FileUploader.relatedListAttachments.previewElement,cancel:crmConstants.FileUploader.relatedListAttachments.cancelElement,mainform:crmConstants.FileUploader.relatedListAttachments.mainformElement,uploadlimit:crmConstants.FileUploader.relatedListAttachments.uploadLimit,uploadsizeflex:crmConstants.FileUploader.relatedListAttachments.uploadSizeFlex,uploadsizelimit:crmConstants.FileUploader.relatedListAttachments.uploadSizeLimit,parallelupload:crmConstants.FileUploader.relatedListAttachments.parallelUpload,filesizebase:crmConstants.FileUploader.relatedListAttachments.fileSizeBase,progressratio:crmConstants.FileUploader.relatedListAttachments.progressratio,tabload:crmConstants.FileUploader.relatedListAttachments.tabLoadElement,attachframe:crmConstants.FileUploader.relatedListAttachments.targetAttachFrameElement,popupname:crmConstants.FileUploader.relatedListAttachments.popupName,entityid:$("#multipleFieldsEditPop").is(":visible")?$("#multipleFieldEditEntityId").val():$("#entityId").val(),module:Lyte.Globals.get("relatedList.module")?Lyte.Globals.get("relatedList.module"):fileupload.module,action:crmConstants.FileUploader.relatedListAttachments.action,resourcetype:crmConstants.Docs.ResourceTypes.ENTITY_ATTACHMENTS,workspace:crmConstants.Docs.WorkSpace.WS_ATTACHMENT_LIBRARY,zgid:Crm.userDetails.ZGID,fromSrc:a,preventUploadObjDestroy:{prevent:$("#multipleFieldsEditPop").is(":visible"),objBindTo:"#multipleFieldsEditPop"}})}}));$(".actSettings").removeClass("actSettings")}function tpuserName(e){var t=e.element,a=e.text;return null!=$(t).data("email")?""!=$(t).data("email")?($("#searchCreateDiv").length>0?($("input[name='property(First Name)']").val($(t).data("fn")),$("input[name='property(Last Name)']").val($(t).data("ln")),$("input[name='property(Email)']").val($(t).data("email"))):($("#firstName").val($(t).data("fn")),$("#lastName_focus ").val($(t).data("ln")),$("#j_username").val($(t).data("email"))),$("#Name").val($(t).data("fullname")),$("#tp_username").val($(t).data("tpemail")),a+' <br/><span class="crmNotFoundColor crm-extra-small-font-size">'+$(t).data("email")+"</span>"):I18n.getMsg("crm.lar.rr.chooseUser")+"":""}function showCustomizeListPopup(e,t,a,i){var l;if(Crm.listRId=e.id.split("_"),$(e).data()&&!Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality($(e).data().name)&&(Crm.listRId=$(e).data().relid.split("_")),3==Crm.listRId.length&&(Crm.listRId[0]=Crm.listRId[0]+"_"+Crm.listRId[1],Crm.listRId[1]=Crm.listRId[2]),"gsearchclm"==Crm.listRId[0]){function s(){var e=$("#ajax_"+a);e.find("#fieldListContents").sortable({helper:"clone"}),e.find("#columnlistsearch").focus()}$(e).siblings("#GSearch").length&&($("#GSearch").remove(),$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),s(),sE(event)),l=Crm.getCrmBasePath()+"/CustomSearchAction.do?action=custom&module="+a,(new crmRequestPool).initiate({action:l,type:"POST",success:function(t){var i={from:"gsearch"};i.save="saveSearchFields('"+a+"');",i.cancel="hideCustomizeListPopup('GSearch');",i.divid="fieldListContents",i.otherparams={gSearchMod:a},i.columns=t,i.module=a;var l=Handlebars.templates.columnList(i);$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).parent().addClass("pR"),$(e).after(l),s();var n=$(window).height()-($(e).next().children().first().outerHeight()+$(e).next().find(".columnListBtn").outerHeight()+$("#wmstoolbar").outerHeight()+$(e).offset().top)-30;$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").css({"max-height":n}),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}})}else if(!Crm.userDetails.isRelatedListLyteEnabled){function n(t){var a=!Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality(Crm.listRId[0]),i=t?$("#"+t):$("[ddid="+Crm.listRId[1]+"]");i.find("#relateList_"+Crm.listRId[1]).sortable({helper:"clone"}),i.find("#columnlistsearch").focus();var l=$L("#dvinner").scrollTop(),s=$L("#dvinner"),n=$(".newTopbar:visible"),r=n.length?n.outerHeight():null,o=$("#dv-button-layer:visible"),d=o.length?o.outerHeight()+10:null,c=$("#wmstoolbar:visible"),m=renderingUtils.windowHeight-(r+d+(c.length?c.outerHeight():null))-290,u="#relatedListCols_"+Crm.listRId[0];if(a){var p=$(u);p.addClass("actColumnsDivStd"),p.hide(),p.show();var g=$(".openActPop").offset().top-100;p.find("#menuColumnListView").css({"max-height":m-g}),p.find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}else $(".ddMenus.boxShadowMask").hide(),$(e).next(".ddMenus.boxShadowMask").show(),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").css({"max-height":m}),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1});var v=a?$(e).find(u).next(".ddMenus.boxShadowMask").offset().top:$(e).next(".ddMenus.boxShadowMask").offset().top,h=a?$(e).find(u).next(".ddMenus.boxShadowMask").outerHeight():$(e).next(".ddMenus.boxShadowMask").outerHeight(),f=$(window).outerHeight(),C=h+v;h+v>f&&s.scrollTo({top:C-(f-(d+r))+l},{duration:400})}var r=!Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality($(e).data().name),o=$(e).siblings(".ddMenus");!r&&$(e).siblings("#relatedListCols").length?($("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).siblings("#relatedListCols").show(),$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),n()):r&&$(e).siblings("#relatedListCols_"+$(e).data().name).length?(o.hide(),$(e).siblings("#relatedListCols_"+$(e).data().name).show(),n(e.id+"_outer"),crmRelatedList.validateLimit(void 0,$(e).data().name)):(l=Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=show&frmmodule="+a+"&from=detailView&nocache="+(new Date).getTime(),Crm.listRId[0]&&(Crm.listRId[1]&&crmRelatedList.EachModuleData[Crm.listRId[1]]&&crmRelatedList.EachModuleData[Crm.listRId[1]].isLinkingModule||0===Crm.listRId[0].indexOf("HISTORYPERSONALITY"))?(l+="&pname="+Crm.listRId[0],l+="&rid="+Crm.listRId[1],crmRelatedList.EachModuleData[Crm.listRId[1]]&&(l+="&cust_disp_module="+crmRelatedList.EachModuleData[Crm.listRId[1]].parentModule)):(r&&(l+="&pname="+Crm.listRId[0]),l+="&cust_disp_module="+a,Crm.listRId&&Crm.listRId[1]&&(l+="&rid="+Crm.listRId[1],"POTSTAGEHISTPERSONALITY"==Crm.listRId[0]&&(l+="&pname="+Crm.listRId[0]))),"SERIESPERSONALITY"===Crm.listRId[0]&&(l+="&pname="+Crm.listRId[0]),l=l+"&entityid="+$("[name='id']").val()+"&entitymodule="+detailView.currentModule,(new crmRequestPool).doAjax(l,(function(t){var a="relateList_"+Crm.listRId[1];if("object"==typeof t){t.from="relatedlist",t.save="saveRelatedListColumns('"+Crm.listRId[1]+"');",t.cancel="hideCustomizeListPopup('relatedListCols');",t.divid=a;var i=$(e).siblings(".ddMenus");r&&(t.isActComp=!0,t.name=$(e).data().name,i.hide(),t.cancel="hideCustomizeListPopup('relatedListCols_"+t.name+"');");var l=Handlebars.templates.columnList(t);r||($("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).parent().addClass("pR")),$(e).after(l);var s=null;if(r){(i=$(e).siblings(".ddMenus")).addClass("selectColPop");var o=$("#"+a+" input[type='checkbox']:disabled"),d=o.length;o.addClass("actMandColUnSort"),crmRelatedList.mandFields[$(e).data().name]=d;var c=$(e).data().name,m=-1===c.indexOf("HISTORY")?"openActivities":"closedActivities",u=$(".addNewValues_"+m),p=$("#"+m+"_btn"),g=p.offset().left+p.outerWidth()-u.offset().left+1,v=$("#relatedListCols_"+c);v.removeClass("right0"),Crm.userDetails.RTL_ENABLED?(g=u.offset().left+u.outerWidth()+1-p.offset().left,v.css("left",g+"px")):v.css("right",g+"px"),s=e.id+"_outer",crmRelatedList.restrictMandatorySortable(c),crmRelatedList.validateLimit(void 0,c)}n(s),rowClickRelList(a)}else alert(I18n.getMsg("game.common.error"))}),void 0,(function(e){555===e.status&&alert(e.responseText)}))),sE(event)}}function rowClickRelList(e){$("#"+e+" li").find("label").on("click",(function(t){var a=$(this).find("input"),i=Crm.moduleInfo.Services?Crm.moduleInfo.Services.Id:void 0;if("moduleList"==e&&i&&(arguments.length<2||"avoidRec"!==arguments[1])&&!a.is(":disabled"))if(i===a.val()){if(a.is(":checked"))return showServicesHideAlert("Services"),void t.preventDefault();setTimeout((function(){$("#"+e+" li[tabid='"+Crm.moduleInfo.Appointments.Id+"'] label").trigger("click",["avoidRec"])}),400)}else if(Crm.moduleInfo.Appointments.Id===a.val()){if(a.is(":checked"))return showServicesHideAlert("Appointments"),void t.preventDefault();setTimeout((function(){$("#"+e+" li[tabid='"+Crm.moduleInfo.Services.Id+"'] label").trigger("click",["avoidRec"])}),400)}"moduleList"==e&&!0!==a.prop("disabled")?OptionChooser.checkDependentModule(this):sortableRowClickEvent(e,a),e.startsWith("relateList")&&crmListView.relatedMandatoryCheck(e),t.preventDefault()})),e.startsWith("relateList")&&crmListView.relatedMandatoryCheck(e)}function showServicesHideAlert(e){$("crm-services-deleteprofile").remove();var t=networkUtils.returnDependencyFiles(["crm-services-deleteprofile.js"],ResourceConstants.CRMClient);Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-services-deleteprofile",{isHide:!0,modName:e},"#modulePermissionDiv"),$("#services-deleteProfile")[0].ltProp("show",!0)}))}function sortableRowClickEvent(e,t){var a=$("#"+e+" > li");if(t.is(":disabled"))return!1;if("zoho_cpq_innerTabs"===t.closest("li").parent().attr("id")&&(e="zoho_cpq_innerTabs"),t.is(":checked")?t.prop("checked",!1):t.prop("checked",!0),"bcardList"==e){var i=(a=$("#"+e+" li")).find("label  input:checked");i.length>=5?a.find("label  input:not(:checked)").attr("disabled","disabled").closest("li").addClass("disable"):1===i.length?a.find("label  input:checked").attr("disabled","disabled").closest("li").addClass("disable"):i.length<5&&i.length>1&&a.find("label  input").removeAttr("disabled").closest("li").removeClass("disable")}}function hideCustomizeListPopup(e){$("[id="+e+"]").hide(),$(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden")}function saveSearchFields(e){var t,a=trimBoth(getObj("searchStr").value),i=[];$("#ajax_"+e+" #fieldListContents input[type='checkbox']").each((function(e,t){var a=$(this);a.is(":checked")?(i.push(a.attr("id")),a.prop("checked",!0)):a.prop("checked",!1)})),t="&fieldIds="+(i=i.join(","))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&searchword="+encodeURIComponent(a),url=Crm.getCrmBasePath()+"/CustomSearchAction.do?action=addOrUpdate&module="+e,crmNavig[e]&&crmNavig[e].recordId&&(crmNavig[e].recordId=[],crmNavig.NAVIGCACHEOBJ.gsearch[e]={}),(new crmRequestPool).initiate({action:url,type:"POST",data:t,success:function(t){if($("#ajax_"+e).find("#GSearch").hide(),"NO_CHANGE"!=t){var a=getObj("ajax_"+e);$(a).empty(),a.innerHTML=t,JSEvalScript(a),searchResultObj.searchResponse=getObj("show").innerHTML}else $(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden")},error:function(e){commonUtils.showHideLoadingDiv(),e.responseText&&555==e.status&&(alert(e.responseText),$("[id^=GSearch]").hide(),$(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden"))}})}function tabGroupLimitCheck(e,t){var a=$("#ajax_"+t+" #fieldListContents input[type='checkbox']:checked").length;a>10?(alert(I18n.getMsg("crm.custom.search.maxfields")),$(e).prop("checked",!1)):a<1&&(alert(I18n.getMsg("crm.custom.search.minfields")),$(e).prop("checked",!0))}function fixedBtnFnCreate(){if($("#rwb").length&&$("#buttonTD").length){var e=$L(window).scrollTop(),t=$("#rwb").offset().top,a=$(".calculaterInfo");if(0==$("#createFixedButtonDiv").length){$("<div id='createFixedButtonDiv' style='display:none; position:fixed; top:0px; left:0px; width:100%; z-index:10;box-shadow: rgb(229, 229, 229) 0px 1px 3px;'></div>").prependTo("#rwb"),$("#show").find(".cvpadding").clone().appendTo("#createFixedButtonDiv");var i=(p=$("#createFixedButtonDiv")).find(".valTopAlertCheck");if(i.length>0){var l=i[0].className.search("valTopAlertCheck"),s=i[0].className.replaceBetween(l,l+16,"valTopAlertCheck_f");i.attr("class",s),p.find("crm-validation-alert").remove();var n=$L("crm-validation-alert")[0];if(n){var r=n.component,o=r.getData("alertTOPMsg"),d=r.getData("closedPop");r.setData("closedCustData","scroll"),$L(".valTopAlertCheck crm-validation-alert #vr_topErrBtn").attr("id","vr_topErrBtn1"),$L(".valTopAlertCheck crm-validation-alert lyte-popover")[0].ltProp("originElem","#vr_topErrBtn1"),Lyte.Component.render("crm-validation-alert",{alertTOPMsg:o,alertTOPBool:!0,closedPop:d,errorsCheck:!d,isDetReq:!0,closedCustData:"scroll",popoverDirection:"bottomLeft"},".valTopAlertCheck_f")}}p.find("#layoutDetails").attr("id","layoutDetails_f");var c=$("#layoutDetails_f");c.next(".select2").remove(),thirdPartyUtils.bindSelect2(c);var m=$("#zCampIntegLayout");if(m.length>0){p.find("#zCampIntegLayout").attr("id","zCampIntegLayout_f");var u=$("#zCampIntegLayout_f");u.val(m.val()),u.next(".select2").remove(),thirdPartyUtils.bindSelect2(u)}}var p=$("#createFixedButtonDiv");if(t<e){p.css("display","block"),$(".cvpadding .customPluswithImpotBtnCon, #btntoolsId").hide(),$("#createFixedButtonDiv .cvpadding .customPluswithImpotBtnCon").show(),showHideAlertComponent(p,$(".valTopAlertCheck"))}else{p.hide(),$(".cvpadding .customPluswithImpotBtnCon").show(),$("#createFixedButtonDiv .cvpadding .customPluswithImpotBtnCon").hide(),showHideAlertComponent($(".valTopAlertCheck"),p);var g=p.find("lyte-messagebox");g&&g.remove()}a.is(":visible")&&a.hide()}}function showHideAlertComponent(e,t){var a=t.find("crm-validation-alert");a.length>0&&a[0].component.setData("closedPop",!1);var i=e.find("crm-validation-alert");i.length>0&&i[0].component.setData("closedPop",!0)}function changeMyTabGroup(e){$("#tabGroupList .yes").css("visibility","hidden"),$("#"+e+" .yes").css("visibility","visible"),e="alltabgroups"===e?"0":e;var t=Crm.getCrmBasePath()+"/CustomizeTabGroup.do",a="action=updateMyTabGroup&tabGroupId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);store.findAll("tab_group").then((function(e){document.getElementsByTagName("crm-tab-group")[0].setData("tabGroupsName",e)})),mR(t,(function(){Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:["Home"]}),crmTab.reloadTabMenu()}),a)}function openNewTab(e,t,a,i,l){var s=document.deleteForm;if("get"==a){s=document.getForm;var n="";if(i)for(var r in i)n+="<input type='hidden' name='"+r+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(i[r])+"'/>";$("#getFormParams").html(n)}"subscription"==t&&($("#lookupdiv").empty(),getObj("lookupdiv").style.display="none"),l&&(s.rel="opener"),s.action=e,s.target="_blank",s.submit()}function showWFtab(e,t,a){$("#workrule").addClass("sel"),$("li").removeClass("sel"),$("#"+a).addClass("sel"),-1!==t.indexOf("editRule")?doAjaxUpdate(e,t,""):doAjaxUpdate(e,t,"",wfBG.setWhiteBG)}function updateCustomization(e,t,a){var i=Crm.getCrmBasePath()+"/EntityCustomization.do?action=updateCustomization",l="&key="+e+"&value="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){try{var t=JSON.parse(e);Crm.userDetails.CUSTOMIZE_INFO=t,null!=a&&"function"==typeof a&&a()}catch(e){}}),l)}function saveAndExportToGoogleCal(e,t,a){var i=$("#pcVersionInfo").closest("form")[0].name,l="&"+csrfParamName+"="+encodeURIComponent(csrfToken);if("continue"==a){getObj("alertMessageForUserDiv").style.display="none",getObj("FreezeLayer").style.display="none";$.ajax({url:Crm.getCrmBasePath()+"/CalendarSyncConfig.do",type:"POST",data:"event=add_gcal_alerted"+l,dataType:"json",success:function(a){if("3003"==a.result){var l="",s="",n=commonUtils.formData2QueryString(document[i],t);"Create"==e?(l=Crm.getCrmBasePath()+"/CreateCommonModule.do",s="ActionType=AddToZG&"):"Edit"==e&&(l=Crm.getCrmBasePath()+"/EditCommonModule.do",s="ActionType=Edit&GappsUpdate=yes&"),s=(s+=n)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(l,s)}else"3004"==a.result&&alert("<fmt:message key='crm.GcalSync.error'/>")},error:function(e){alert("<fmt:message key='crm.GcalSync.error'/>")}})}else"cancel"==a&&(getObj("alertMessageForUserDiv").style.display="none",getObj("FreezeLayer").style.display="none")}function showFrameMsg(e,t){jQuery(t).html($("#AttachmentFrame").contents().find(e).html()),jQuery("#fileAttachForm  input[name=Attach]").attr({style:"opacity: none;",disabled:""})}function getModuleLinks(){var e=$("#module").val(),t=$L("crm-detail-view")[0]||$L("crm-detailview-canvas")[0];e=void 0!==e?e:t?t.component.data.module:null;var a=Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFromCanvasActivityEnabledModule(e);if(Crm.userDetails.DETAIL_VIEW_LYTE||a){if("Tasks"===e||"Calls"===e){var i=$L("crm-related-list-view-custom-link")[0];void 0!==i&&(store.clearCachedQuery("custom_link",{module:moduleRecordMapping[e].api_name}),i.component.getCustomLinksData()),hideAnimatePopup("topBandPopup")}else if("Calls"!==e&&"Tasks"!==e&&"Meetings"!==e){var l=$L("crm-related-custom-link")[0];void 0!==l&&l.component.getCustomLinksData(),hideAnimatePopup("topBandPopup")}}else{var s=Crm.getCrmBasePath()+"/CustomButton.do?step=showLnkInDetailPage&module="+e+"&fromPage=popup";if(CScriptLib){var n=$("#cuslnkquickact").attr("data-restricted-links");n&&""!==n&&(s+="&restrictedLinks="+n)}var r=new getHTTPObject;r.open("POST",s,!0),r.onreadystatechange=function(){if(4==r.readyState){if(r.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(r);var e=r.responseText;hideAnimatePopup("topBandPopup"),$("#cuslnkquickact").empty(),getObj("cuslnkquickact").innerHTML=e;var t=$("#detailAddLink"),a=$("#linksCreatedCount").val(),i=parseInt($("#customlinkcount").data("max"));$("#customlinks").removeClass("noDataFountDetail"),a<i?(t.attr("onclick","showCustomizePopup('CreateList','"+$("#module").val()+"')"),t.attr("onmouseenter",""),t.attr("onmouseleave","")):(t.attr("onmouseenter","renderingUtils.zctt.showtt('"+I18n.getMsg("crm.customlink.limitexist.new",i)+"',"+!0+")"),t.attr("onmouseleave","renderingUtils.zctt.hidett()"),t.attr("onclick","")),0===parseInt(a)?$("#customlinks").addClass("noDataFountDetail"):$("#customlinks").removeClass("noDataFountDetail")}},r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),r.setRequestHeader("X-ZCSRF-TOKEN",csrfParamName+"="+csrfToken),r.send(null)}}function submitInvPdtDelAction(){return deleteInvLineItems(gblid),renderingUtils.removeFreezeLayer(),getObj("InventoryWarningDiv").style.display="none",!1}function setCaretPosition(e,t){var a=document.getElementById(e);if(null!=a)if(a.createTextRange){var i=a.createTextRange();i.move("character",t),i.select()}else document.createRange?$("#"+e).get(0).setSelectionRange(t,t):a.selectionStart?(a.focus(),a.setSelectionRange(t,t)):a.focus()}function showHideCallDuration(e,t){if($("#checkDuplicateEvent").hide(),$("input[name='property(Call Start Time)']").length>0&&$("input[name='property(Call Start Time)']")[0].setAttribute("onclick","crmCalendar.showCalendar(event,'leftPanel',undefined, undefined, 786)"),$("form[name='"+t+"'] #whichCallDiv").length&&($("form[name='"+t+"'] input[name='property(Call Duration)']").parent().css("display",e).parent().css("display",e),$("form[name='"+t+"'] input[name='property(Call Start Time)']").parent().css("display",e),getObj("compCalDiv")&&$("form[name='"+t+"'] #compCalDiv").css("display",e),getObj("qownerName_select")&&$("#call_qowner").css("display","none"),getObj("remTime")&&($("#remTime").closest(".tabDivCreate").css("display","none"),$("form[name='"+t+"'] [name='remCheckTask']").prop("checked",!1))),$("form[name='"+t+"'] #whichCall1").is(":checked")){var a=$("form[name='"+t+"'] select[name='property(Call Type)']").find("[actualvalue=Outbound]").val();$("form[name='"+t+"'] select[name='property(Call Type)']").val(a).trigger("change").attr("disabled",!0)}else $("form[name='"+t+"'] select[name='property(Call Type)']").prop("disabled",!1);$("form[name='"+t+"'] [id='_leContModSel']").parent().children("span").children("label").removeClass("qmandatory"),"ScheduleCall"===jQuery("input[name=whichCall]:checked").val()&&($("#checkDuplicateEvent").show(),$("input[name='property(Call Start Time)']")[0].setAttribute("onclick","crmCalendar.showCalendar(event,'leftPanel',Events.callDuplicationDateHandler, undefined, 786)"))}function create_twtLoad(){$(".twtinpt").focus((function(){$("#twtInptDiv").addClass("twtFocus")})),$(".twtinpt").bind("click",(function(){$("#twtInptDiv").addClass("twtFocus")})),$(".twtinpt").bind("blur",(function(){$("#twtInptDiv").removeClass("twtFocus")}))}function openZDocsLinkDialog(e,t){if(t&&(fileupload.fromFileUploadField=!0),$("#attachOptionsFromDetailMenu,#eventActionsMenu").hide(),"undefined"!=typeof usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("zdoc",usernameNotNeeded))commonUtils.checkUsernameNeeded((function(){LINKDOCS.showLinkFileDialog("crm",e,"10","true","docsURL",RebrandLinkUtil.getProperty("docsStaticUrl"))}),"zdoc",(function(){return!1}));else{var a={servicename:"crm",zsoid:e,filelimit:"10",docsURL:RebrandLinkUtil.getProperty("docsStaticUrl")};LINKDOCS.showLinkFileDialog(a);var i=setInterval((function(){var e=$L("#attachfiledialogdiv"),t=$L("#linkdocsdialogdiv"),a=$L("#zohodocsframe");(t.length>0||e.length>0||a.length>0)&&(crmui.modalZIndex("nonLyte",$L(".docsdialog")[0],"open"),clearInterval(i))}),300)}}function isEmailValidInAssocCont(e,t,a,i){if("object"==typeof e&&(e=e.value),t&&"null"!=t.value&&""!=t.value||void 0!==a&&"null"!=a){var l=void 0===a?t.value:a,s=[i=i||(void 0===a?"Contact":"Vendor"),e];return!(""==l||!validationUtils.isValidEmail(l))||(renderingUtils.showCustomAlert(I18n.getMsg("no.proper.email.for.mapped.contactOrVendor",I18n.getMsg(s))),!1)}return!0}function callGAppsURL(e,t,a){t&&null!=t&&"createdLeads"==t&&onscrollhiddendiv(),null!=t&&""!=t||(t="result");var i=csrfParamName+"="+encodeURIComponent(csrfToken);if(e.indexOf("processFromAdminPage")<=0&&!a){var l=adwordParams||{};if(l){var s=null!=l.startDate?l.startDate:"",n=null!=l.endDate?l.endDate:"",r=null!=l.orderby?l.orderby:"",o=null!=l.sortby?l.sortby:"",d=null!=l.dateFilter?l.dateFilter:"";e.indexOf("startDate")<=0&&(e+="&startDate="+s),e.indexOf("endDate")<=0&&(e+="&endDate="+n),e.indexOf("dateFilter")<=0&&(e+="&dateFilter="+d),e.indexOf("orderby")<=0&&(e+="&orderby="+r),e.indexOf("sortBy")<=0&&(e+="&sortBy="+o)}}commonUtils.showHideLoadingDiv(!0),e.indexOf("isFirstTime=true")<=0&&commonUtils.showHideLoadingDiv(!0),$.ajax({type:"POST",url:e,data:i,success:function(a){if("ITS_NOT_ADWORD_ACC"==a){if(getObj("NOT_VALID_ADWORD_ACC"))return renderingUtils.freezeBackground(),document.getElementById("ajax_load_tab")&&commonUtils.showHideLoadingDiv(),getObj("NOT_VALID_ADWORD_ACC").style.zIndex=645,getObj("NOT_VALID_ADWORD_ACC").style.display="block",void mailsetCenter("NOT_VALID_ADWORD_ACC")}else{if(-1!=e.toLowerCase().indexOf("adword")&&-1!=a.indexOf("NO_OF_ACCOUNT_EXCEEDED")){var i=JSON.parse(a).Message;return renderingUtils.showCustomAlert(i),getObj("savebutton").disabled=!1,getObj("cancelbutton").disabled=!1,void commonUtils.showHideLoadingDiv()}if(-1!=e.indexOf("adwDemo")){var l=a.split("successfullySchDemo")[1];return document.getElementById("ajax_load_tab")&&commonUtils.showHideLoadingDiv(),getObj("training").style.display="none",void alert(l)}if(-1!=e.indexOf("MSApps.do"))return $("#result").html(Handlebars.templates.MScalendar(a)),void commonUtils.showHideLoadingDiv(!1);if(-1!=e.indexOf("GoogleApps.do"))return a.addressError?(commonUtils.showHideLoadingDiv(!1),void crmui.showMsgBand("error",I18n.getMsg("crm.gmail.emailChange"),5e3)):($("#result").html(""),Lyte.Component.render("crm-email-gmail-api",{email_config:Lyte.registeredMixins["crm-email-config-mixin"].transformGmailApiNewConfigResponse(a)},"#result"),void commonUtils.showHideLoadingDiv(!1));if(-1!=e.indexOf("mode=GoogleChatConfig"))return"Error while Adding Chat"===a?crmui.showMsgBand("error",I18n.getMsg("crm.creator.error.authenticationFailed"),5e3):"nonGSuiteAccount"===a?_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("crm.googlechat.not.gsuit.account.primary"),cxPropReason:I18n.getMsg("crm.googlechat.not.gsuit.account.secondary")}}):"noAuthScope"===a&&_cruxUtils.showPermissionDeniedModal({params:{cxPropTitle:I18n.getMsg("crm.googlechat.insufficient.authentication.scopes.primary"),cxPropReason:I18n.getMsg("crm.googlechat.insufficient.authentication.scopes.secondary")}}),void commonUtils.showHideLoadingDiv()}renderingUtils.removeFreezeLayer(),commonUtils.showHideLoadingDiv(),$(t).empty(),getObj(t).innerHTML=a,JSEvalScript(getObj(t)),-1!=e.indexOf("dataPopulated=S")?getObj("successfullyDataPopulated")&&(renderingUtils.freezeBackground(),getObj("successfullyDataPopulated").style.zIndex=3455,getObj("successfullyDataPopulated").style.display="block",mailsetCenter("successfullyDataPopulated")):-1!=e.indexOf("action=profileList")?(renderingUtils.freezeBackground(),getObj("profilePermission").style.zIndex=545,getObj("profilePermission").style.display="block",mailsetCenter("profilePermission"),JSEvalScript(getObj("profilePermission"))):-1!=e.indexOf("action=addDelPermission")?(renderingUtils.removeFreezeLayer(),getObj("profilePermission").style.display="none"):getObj(t)&&"successfully deactivated"==getObj(t).value?location.href=Crm.getCrmBasePath()+"/ShowHomePage.do":"createdLeads"==t?(renderingUtils.freezeBackground(),$("#LeadConversionDiv").css({position:"absolute"}),mailsetCenter("LeadConversionDiv")):"historyInfo"==t?(renderingUtils.freezeBackground(),$("#historyInfo").css({height:$(window).height()-100}),mailsetCenter("historyInfo"),getObj("historyInfo").style.zIndex=545,getObj("historyInfo").style.display="block"):-1!=e.indexOf("sortBy=")&&changeImageClass()},error:function(){}})}function regerateHTML(e){renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(!0),http&&(http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(http.status==crmConstants.errorStatusCode)return commonUtils.showHideLoadingDiv(),void renderingUtils.displayPermissionDenied(http);var e=http.responseText;$("#appendHTML").empty(),getObj("appendHTML").innerHTML=e,mailsetCenter("ContainerDiv"),getObj("ContainerDiv").style.display="block",commonUtils.showHideLoadingDiv(),JSEvalScript(getObj("ContainerDiv"))}},http.send())}function removeHTML(){renderingUtils.removeFreezeLayer(),getObj("ContainerDiv").style.display="none"}function sendProfile(e){var t=!1,a="";if(getObj(e).length>1)for(var i=0;i<getObj(e).length;i++)1==getObj(e)[i].checked&&(a+=getObj(e)[i].value+",",t=!0);else 1==getObj(e).checked&&(t=!0,a=getObj(e).value);t?callGAppsURL(Crm.getCrmBasePath()+"/gadword.do?action=addDelPermission&profileId="+a):alert("Please atleast one profile")}function showDivOnFreezeLayer(){renderingUtils.freezeBackground(),mailsetCenter("genaratescriptPop")}function loadMailListForRL(e){if(getObj("mailListRelId")&&getObj("mailConfigType")){var t=getObj("mailListRelId").value,a=getObj("mailConfigType").value.split("#"),i=a[0];getObj("getMailOpt")&&getObj("getMailOpt").innerHTML,"1"==i&&a[1]?($("#"+t).empty(),document.getElementById(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>"):"2"==i&&a[1]?getObj(t)?($("#"+t).empty(),document.getElementById(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>"):($("#"+t).empty(),getOpenerObj(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>",window.self.close()):getObj("entIdForZMail")&&($("#isFromNewAPI").length>0?showMailsListViaAPI("ALL","-10","next"):showMailsList(getObj("entIdForZMail").value,i,"",t,"-10","next","","false",e,"true"),getObj("zmailRS").style.display="")}getObj("zs_EMAIL")&&(getObj("zs_EMAIL1")?getObj("zs_EMAIL").value=getObj("zs_EMAIL1").value:getObj("subvalue_EMAIL")&&(getObj("zs_EMAIL").value=getObj("subvalue_EMAIL").innerHTML))}function gotoAccount(e,t,a){var i="",l=$("#account")[0];i=l&&""==l.value?Crm.getCrmBasePath()+"/gadword.do?action=accDesc":Crm.getCrmBasePath()+"/gadword.do?action=accSummary",l&&""!=l.value&&(i+="&accId="+l.value),null!=t&&(i+="&campId="+t),null!=a&&(i+="&gid="+a);var s=adwordParams||"";""!=s.dateFilter&&(i+="&dateFilter="+s.dateFilter+"&startDate="+s.startDate),callGAppsURL(i,"show")}function showFeedBackResponse(e){$("#helpHome").hide(),$("#timesData").show();var t=$(window).width();"Yes"==e?($("#timesData").text(I18n.getMsg("crm.case.sent.message")),$("#timesData").addClass("successAlert"),t=t/2-200):($("#timesData").text(I18n.getMsg("crm.MassEmail.ajax.failure")),$("#timesData").addClass("errorAlert"),t=t/2-300);var a=$("#tmC").get(0),i=renderingUtils.findPosY(a);$("#timesData").css({left:t,top:i+5,position:"absolute"}),setTimeout((function(){$("#timesData").fadeOut(2e3)}),2e3)}function checkHandle(e,t){32==(e=e||window.event).keyCode&&(alert(I18n.getMsg("crm.quick.create.twitter.error")),t.value=t.value.substring(0,t.value.length-1))}function attachmentExceedCheck(){for(var e=0,t=0,a=getfilesCount(),i=0;i<a;i++)if(null==getObj("fvtheFile_"+i)&&t<5)t+=1,a+=1;else if(null!=getObj("fvtheFile_"+i)){t=0,e+=getObj("theFile_"+i).files[0].size}return e>10485760}function hideShowDiv(e,t){getObj(e)&&(getObj(e).style.display="none"),getObj(t)&&(getObj(t).style.display="block")}function activeBanner(e){getObj("banner_"+e).className="gawMenutype mL30 fL gawActive";for(var t=e-1;t>=1;t--)getObj("banner_"+t)&&(getObj("banner_"+t).className="gawMenutype mL30 fL gawComplete")}function showPlayIcon(e){jQuery(e).find(".icon_play").show()}function hidePlayIcon(e){jQuery(e).find(".icon_play").hide()}function playAudio(e,t){var a=jQuery(e),i=jQuery("#"+t+"_audio")[0],l=jQuery("#timerarea_"+t);a.hasClass("icon_pause")?(a.removeClass("icon_pause"),i.pause(),l.addClass("hide")):(a.addClass("icon_pause"),i.play(),l.removeClass("hide"),"IE"!==$L.userAgent.browser&&i.addEventListener("ended",(function(){a.removeClass("icon_pause"),i.load(),l.addClass("hide")})))}function validateCallTime2(e,t=!0){var a="property(Call Start Time)";if(!getElm(e,a))return!0;var i=$("form[name='"+e+"'] input[name='operation']").val(),l=$("form[name='"+e+"'] input[name='whichCall']:checked"),s=0!=l.length?l.val():"";return!("CompletedCall"===s&&!CrmDateUtils.dateTimeValidate(a,"Call Start Time","Call Start Time","LE",e,void 0,void 0,t))&&("ScheduleCall"!==s||"edit"===i||!!commonUtils.emptyCheck(a,"Call Start Time",void 0,void 0,void 0,t)&&(!!CrmDateUtils.dateTimeValidate(a,"Call Start Time","Call Start Time","G",e,void 0,void 0,t)&&qCreateCall.isEntityAssociated(e,s)))}function getZuidsForGroupId(e,t){var a=void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Groups&&Crm.userDetails.permissions.Crm_Implied_Manage_Groups;if(null==groupIdsVsZuids||null==groupIdsVsZuids[e]){var i="actionType=groupUsersInfo&groupId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(i){var l=JSON.parse(i);groupIdsVsZuids[e]=l[e];var s=Handlebars.templates.FeedsGroupUsers;if(groupIdsVsZuids[e].length>20)var n=s({zuids:groupIdsVsZuids[e].slice(0,15),count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});else n=s({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});$("#groupUsers").html(""),$("#groupUsers").html(n),$("#groupUsers").show()}),i)}else{var l=Handlebars.templates.FeedsGroupUsers;if(groupIdsVsZuids[e].length>20)var s=l({zuids:groupIdsVsZuids[e].slice(0,15),count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});else s=l({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});$("#groupUsers").html(""),$("#groupUsers").html(s),$("#groupUsers").show()}}function getZuidsForGroupIdPopup(e,t,a){var i=void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Groups&&Crm.userDetails.permissions.Crm_Implied_Manage_Groups,l=(0,Handlebars.templates.FeedsGroupAllUsers)({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupName:t,groupId:e,manageGroupPermission:i}),s=$(a).offset().left,n=$(a).offset().top;$("#feedsGroupMembersDiv").css({visibility:"hidden"}),$("#feedsGroupMembersDiv").show();var r=$("#feedsGroupMembersDiv").outerWidth();$("#feedsGroupMembersDiv").css({left:s-(r+10),top:n-200}),$("#feedsGroupMembersDiv").html(""),$("#feedsGroupMembersDiv").html(l),$("#feedsGroupMembersDiv").css({visibility:"visible"}),EvalInnerScript(getElemById("feedsGroupMembersDiv")),setPerfectScrollBar("feed_member_popup_outer","feed_member_popup_inner")}function getComboValuesForAp(e,t,a,i,l,s,n,r,o){var d="",c="";null!=s&&(d=s);var m="";null!=n&&(m=n);var u=l,p=Crm.getCrmBasePath()+"/GetComboValues.do",g="fieldId="+e+"&module="+(void 0===i?"":i)+"&uiType="+t+"&action=approvalProcess";r&&(g+="&allowEmpty=true"),o&&(g+="&isPotentialStage=true");var v=getHTTPObject();v&&(v.open("POST",p,!0),v.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.onreadystatechange=function(){if(4==v.readyState){dataStr=v.responseText.trim();for(var e=null,i=!1,l=null,s=1;s<=u;s++){if(c="",a=$("#"+m+"fieldUpdate"+s+d).val(),100==t||t==CrmField.UITYPES.GLOBAL_TAX){$("#"+m+"typeSection"+d).show(),c+="<div class='cchosen mlSelect mlSelAutoWidth noborder_multiselect pR'><span class='crm-font-regular crm-base-font-size sltSetVal sltBdr dIB'></span><select  multiple size='4' data-zcqa='select_MassUpdate_Value' id='"+m+"fieldUpdate"+s+d+"' onchange='approvalProcess.selectBoxLimitationInMultiselect(this);wfForm.setSltVal(this);'>";var n=JSON.parse(dataStr);if(null!=a&&("object"!=typeof a||"object"==typeof a&&0!=a.length)){var r=a.split("_");1==r.length&&r.unshift($("#"+m+"isAppend"+d).val());for(var o,p=r[1].split(","),g=n.length,h=0;h<g;h++){var f=n[h];o=0;for(var C=0;C<p.length;C++)f.Id==p[C]&&(o=1);c+=0==o?"<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>":"<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>"}0==r[0]?($("#"+m+"OverwriteVal"+d).prop("checked",!0),$("#"+m+"AppendVal"+d).removeAttr("checked")):1==r[0]&&($("#"+m+"AppendVal"+d).prop("checked",!0),$("#"+m+"OverwriteVal"+d).removeAttr("checked"))}else for(g=n.length,h=0;h<g;h++){f=n[h];c+="<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>"}if(c+="</select></div>","0"==$("#"+m+"isinitial"+d).val()){var y="recordOrDate1";"Approval"==m&&(y="recordOrDate2");var b="",w="";"1"===(1===a.indexOf("_")?a.split("_")[0]:void 0)?b=" checked='checked' ":w=" checked='checked' ";var I="<tr id='"+m+"typeSection"+d+"' class= 'typeSection'> <td width='100'><div class='wf_requiredMark wf_form_lab'>"+I18n.getMsg("crm.workflow.field.to.update.Action")+"</div></td><td><label class='rbCheckHtml dIB'><input type='radio' id='"+m+"OverwriteVal"+d+"' class='rbRealHtml hide triggerRad' "+w+" name='"+y+"'>";I+="<span class='rbHtml dIB pR'> <span class='rbTickHtml pA'></span></span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.overwrite")+"</span></label><label class='pL15 rbCheckHtml dIB'> <input type='radio' id='"+m+"AppendVal"+d+"' class='rbRealHtml hide triggerRad' "+b+" name='"+y+"'>",I+="<span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span> </span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label></td></tr> ",$("#"+m+"APFieldUpdate"+d+" tr:last").after(I),$("#"+m+"isinitial"+d).val("1")}approvalProcess.selectedObj=$("#"+m+"fieldUpdate"+s+d).val()}else if(2==t||26==t){c="<div class='newSelect'><select id='"+m+"fieldUpdate"+s+d+"' name='"+m+"fieldUpdate"+s+d+"' onchange='wfForm.setSltVal(this);'>";var L=JSON.parse(dataStr),A=[],E=L.length;for(D=0;D<E;D++)A.push(L[D].Id);var S=[],R=A.length;for(h=0;h<R;h++){var T=L[h],_=T.colorCode;T.Id;_?(i=!0,S[S.length]=T):"-None-"===T.ActualValue&&(S[S.length]=T)}S.length>0&&(c="<div class='newSelect'><select data-colorcode_enabled="+i+" id='"+m+"fieldUpdate"+s+d+"' name='"+m+"fieldUpdate"+s+d+"' onchange='wfForm.setSltVal(this);'",c+=" data-picklistmap='"+JSON.stringify(S)+"'>");g=(n=JSON.parse(dataStr)).length;null==a&&(a="None");for(h=0;h<g;h++){(f=n[h])&&f.colorCode?f.DisplayValue==a||f.Id==a?(c+="<option data-colorcode='"+f.colorCode+"'value='"+f.Id+"'actualvalue='"+f.ActualValue+"'selected>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>",e=f.colorCode,l=f.ActualValue):c+="<option data-colorcode='"+f.colorCode+"'value='"+f.Id+"'actualvalue='"+f.ActualValue+"'>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>":"-None-"==f.ActualValue?c+="None"==a?"<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML("None")+"</option>":"<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML("None")+"</option>":f.DisplayValue==a||f.Id==a?c+="<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>":c+="<option value='"+f.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(f.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(f.DisplayValue)+"</option>"}i&&!l&&(e=n[0].colorCode,l=n[0].ActualValue),c+="</select></div>",$("#"+m+"isinitial"+d).val("0")}else{var k,M=dataStr.split("~~"),O=!1;c="<div class='newSelect'><select id='"+m+"fieldUpdate"+s+d+"' name='"+m+"fieldUpdate"+s+d+"' onchange='wfForm.setSltVal(this);'>";for(var P=M.length,D=0;D<P;D++){var U=M[D];if(U=(U=(U=U.replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&#39;"),208==t){var F=U.split("|");F[0]==a?(0==D&&(k=F[1]),c+="<option data-val='"+F[0]+"' id='"+D+"' value='"+F[0]+"' selected>"+F[1]+"</option>",O=!0):(0==D&&(k=F[1],t!=CrmField.UITYPES.LAYOUT||O||null!=a||(c+="<option id='None' value='' selected>"+$ESAPI.encoder().encodeForHTML(I18n.getMsg("crm.social.choose.layout"))+"</option>")),c+="<option data-val='"+F[0]+"' id='"+D+"' value='"+F[0]+"'>"+F[1]+"</option>")}else U==a?(0==D&&(k=U),c+="<option data-val='"+U+"' id='"+D+"' value='"+U+"' selected>"+U+"</option>",O=!0):(0==D&&(k=U),c+="<option data-val='"+U+"' id='"+D+"' value='"+U+"'>"+U+"</option>")}!O&&a&&(0==D&&(k=a),c+="<option data-val='"+a+"' id='"+D+++"' value='"+a+"' selected>"+a+"</option>"),c+="</select></div>",$(getObj(m+"fieldLabletd"+s+d)).empty(),$("#fldUp_spn").text(k),wfForm.chosen_show(),$("#"+m+"isinitial"+d).val("0")}var B=getObj(m+"fieldLabletd"+s+d);if(B.innerHTML=c,thirdPartyUtils.bindSelect2($("#"+m+"fieldLabletd"+s+d).find("select")),null!==e)$('<span class="dIB activitesColor" data-zcqa="colorcode_selectWFupdatecolorcode" id="selectWFupdatecolorcode"style="background:'+e+'"></span>').insertBefore("#"+m+"fieldUpdate"+s+d);!0!==i||l&&"-None-"!==l?!0===i&&"-None-"!==l&&$(B).addClass("colorEnabledPicklist"):$(B).addClass("colorEnabledPicklist colorEnabledPKNone ")}}},v.send(g))}function getOptOutForAp(e,t,a,i,l){var s="";null!=i&&(s=i);var n="";null!=l&&(n=l);var r=a,o="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='"+n+"fieldUpdate"+r+s+"' name='"+n+"fieldUpdate"+r+s+"' value='0' onchange='OnChangeCheckbox(this)'/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span><div class='cBoth'></div></label>";1==t&&(o="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='"+n+"fieldUpdate"+r+s+"' name='"+n+"fieldUpdate"+r+s+"' value='1' onchange='OnChangeCheckbox(this)' checked/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span><div class='cBoth'></div></label>"),$(getObj(n+"fieldLabletd"+r+s)).empty(),getObj(n+"fieldLabletd"+r+s).innerHTML=o,$("#"+n+"isinitial"+s).val("0")}function updateTaskOwner(e,t,a){$("#value_SMOWNERID").find("#ownerName_id").text(t),$("#headervalue_SMOWNERID").find("#ownerName_id").text(t);var i=document.viewentityform.id;if(i)if(i=i.value,a){var l=$("#recordid_"+i),s=l.find("[id='TaskOwner']").length?"TaskOwner":"taskOwner";l.find("[id='"+s+"']").attr("title",t).text(t)}else e===Crm.userDetails.USER_ID?$("#cvlist_"+i).find("#lp_owner").text(I18n.getMsg("crm.label.you")):$("#cvlist_"+i).find("#lp_owner").text(t)}function loadActivityDetails(e,t,a,i,l,s,n,r,o,d){crmTemplate.downloadedContentLoaded=!1;var c=customViewObject?customViewObject.isKanbanView:void 0;if(c=c||"true"===$("#iskanbanview").val(),t?t=$(t):i&&(t=$("#cvlist_"+i).length?$("#cvlist_"+i):$("#recordid_"+i)),t.length){a=JSON.parse(t.attr("data-params"));if(1==t.attr("loading")||!l&&a.id===$('form[name="viewentityform"]').find('input[name="id"]').val()&&t.parent("li").hasClass("selectedRightActivity"))return;if(t.attr("loading",!0),$("#fromTaskPage").remove(),c){Calls.callGroupArr=[],Calls.callGroupArrLabel=[],$("#cvEditSave").empty(),$("#cvEditSave").css("display","none");m="entitypopup",u=""}else{a.FROM_INDEX=$("#cvFromIndex").val(),a.TO_INDEX=$("#cvToIndex").val();var m="taskDetailsPart",u="lp_"}if(Crm.renderDVLyteFlow(a.module))return void(o&&(o.outlet=m));if(detailView.isKafkaRefreshForActivitiesPage(a.module))return;$("#"+m).html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>');var p=networkUtils.constructUrl(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a);if(n)var g=!0;if(r){var v=new Promise((function(e,t){r.resolve=e,r.reject=t}));r.dummyPromise=v}var h="Calls"===a.module&&!o&&d;if(ajaxNew(p,void 0,(function(e){if(n&&n(e),crmTemplate.downloadedContentLoaded=!0,"Events"==a.module){var t=$("#detailViewButtonLayerMainTable").find(".activitesColor"),i=$("#detailView_"+a.id),l=!1;0==i.length&&(i=$("#kanban_"+a.id),l=!0);var r=i.find(".activitesColor");if(t.length>0){var o=t.css("background-color"),d=Events.rgbtohex(o);r.length>0?r.css("background-color",d):l?i.append('<span class="activitesColor" data-zcqa="relcvColor_'+a.id+'" style="background: '+d+'"></span>'):$("#cvlist_"+a.id).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+a.id+'" style="background: '+d+'"></span>')}else r.length>0&&r.remove()}s&&s.call(window),Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a.module,a.id)}),m,h,o),c&&!g){var f=t.closest(".kvtlistbgheader").attr("id");$("#kvType").val(f),taskDetailsview.listAnimation("open"),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(a.module))&&Crm.downloadValidationRules(p,a.module)}if(a.conid&&"null"!==a.conid)var C=a.conid;if(a.relid&&"null"!==a.relid)var y=a.relid;var b=a.setype;if(C&&y&&C!==y){var w='<option value=\'{"id":"'+C+'","module":"Contacts"}\'>'+$ESAPI.encoder().encodeForHTML(t.find("#"+u+"contactname").text())+'</option><option value=\'{"id":"'+y+'", "module":"'+b+"\"}'>"+$ESAPI.encoder().encodeForHTML(t.find("#"+u+"relatedto").text())+"</option>";!c&&$("#rightPanelSelect option").length>0&&thirdPartyUtils.unbindSelect2("#rightPanelSelect"),$("#rightPanelSelect").html(w).parent().show()}else $("#rightPanelSelect").parent().hide();C&&(y=C,b="Contacts"),y?($("#rp_parent").show(),$("#rp_td").css("visibility","hidden"),getRightPanelDetails(y,b,"rp_parent",(function(){}),r)):$("#rp_parent").hide()}else{if(Lyte.Router.getRouteInstance().transition.renderFullLytePage)return;var I=Lyte.Router.getRouteInstance(),L=a&&a.module?a.module:I.obj?I.obj.module:I.params.module;if(I.params&&I.params.id!=i)Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:["Activities",i],queryParams:{sub_module:L}}).data={fromDetailView:!0,backOneLevel:I.transition.data.backOneLevel};else{a=$("#rightPanel").length?{id:i,module:L,fromDetailView:!0}:{id:i,module:L},p=networkUtils.constructUrl(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a);ajaxNew(p,"",(function(e){Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a.module,a.id)}))}}}function switchTaskRightPanel(e){var t=$(e).val();t=JSON.parse(t),getRightPanelDetails(t.id+"",t.module+"","rp_parent",(function(){}))}function updateLeftPanel(e,t){var a="true"===$("#iskanbanview").val(),i=a?$("#recordid_"+e):$("#cvlist_"+e),l=a?"":"lp_";if(i&&i.length){var s=JSON.parse(i.attr("data-params")),n=["property(leContModName)","property(modname)","property(Venue)","property(Subject)","property(Status)","property(Priority)"],r=["contactname","relatedto","Venue","Subject","Status","Priority"],o="Events"===t;$("#leContModSel").length?$("#leContModSel").val():$('input[name="property(leContModSel)"]:checked').val();if(s.conid="",s.relid="",s.setype="","Contacts"===Crm.requestParam["property(leContModSel)"]&&Crm.requestParam["property(leContModId)"]?s.conid=Crm.requestParam["property(leContModId)"]:Crm.requestParam["property(leContModId)"]&&(s.relid=Crm.requestParam["property(leContModId)"],s.setype="Leads"),Crm.requestParam["property(modid)"]){var d=Crm.requestParam["property(modsel)"];s.setype=d,s.relid=Crm.requestParam["property(modid)"]}if(Crm.requestParam["property(Event Title)"]&&i.find("#"+l+"Subject").text(Crm.requestParam["property(Event Title)"]),Crm.requestParam["property(Start DateTime)"]&&Crm.requestParam["property(End DateTime)"]){if("HH:mm"===Crm.userDetails.TIME_FORMAT)var c=Utils.getDateObject(Crm.requestParam["property(Start DateTime)"],{hrs:Crm.requestParam["property(Start DateTimehour)"],mins:Crm.requestParam["property(Start DateTimeminute)"]}),m=Utils.getDateObject(Crm.requestParam["property(End DateTime)"],{hrs:Crm.requestParam["property(End DateTimehour)"],mins:Crm.requestParam["property(End DateTimeminute)"]});else c=Crm.requestParam["property(Start DateTime)"]+" "+Crm.requestParam["property(Start DateTimehour)"]+":"+Crm.requestParam["property(Start DateTimeminute)"]+" "+Crm.requestParam["property(Start DateTimeampm)"],m=Crm.requestParam["property(End DateTime)"]+" "+Crm.requestParam["property(End DateTimehour)"]+":"+Crm.requestParam["property(End DateTimeminute)"]+" "+Crm.requestParam["property(End DateTimeampm)"];var u=taskDetailsview.formatdatetime(c,m,e);i.find('span[id="'+l+'Start DateTime_tkv"]').text(u).removeAttr("title")}if(Crm.requestParam["property(Due Date)"]){var p=getFormattedDate(Crm.requestParam["property(Due Date)"]);a?taskDetailsview.updaterecord(e,"Due Date",Crm.requestParam["property(Due Date)"],p):i.find('span[id="'+l+'Due Date"]').text(p)}if($("#Crm_Tasks_SMOWNERID").length)(f=Crm.requestParam["property(ownerId)"])===Crm.userDetails.USER_ID?i.find("#"+l+"owner").text(I18n.getMsg("crm.label.you")):i.find("#"+l+"owner").text($("#Crm_Tasks_SMOWNERID").text());i.attr("data-params",JSON.stringify(s));for(var g=o?3:n.length,v=0;v<g;v++){var h=Crm.requestParam[n[v]];h=h||"",i.find("#"+l+r[v]).text(h)}if("Calls"==t&&isNewCallView){var f,C,y,b,w,I=crmCallsNew.getCallStartCrmDate(),L=$("#createEditCallPopup"),A=L.find("#Crm_Calls_CALLDURATION_Mins").val(),E=L.find("#Crm_Calls_CALLDURATION_Secs").val(),S=L.find("#Crm_Calls_OUTBOUNDCALLSTATUS").find("option:selected").data("actual-value"),R=L.find("#Crm_Calls_CALLTYPE").find("option:selected").data("actual-value"),T=null,_=null,k=L.find("#Crm_Calls_CONTACTID_WhoId_select"),M=L.find("#Crm_Calls_CONTACTID"),O=L.find("#Crm_Calls_SEID_select"),P=L.find("#Crm_Calls_SEID"),D=M.data("id")?k:O,U=M.data("id")?M:P,F=L.find("#Calls_fldRow_TONUMBER"),B=L.find("#Calls_fldRow_FROMNUMBER");"Outbound"===R&&F.is(":visible")?(b=L.find("#Crm_Calls_TONUMBER").val(),w=Calls.getPhoneId(b),b||(b="null")):B.is(":visible")&&(b=L.find("#Crm_Calls_FROMNUMBER").val(),w=Calls.getPhoneId(b),b||(b="null")),L.find("#"+crmCallsNew.fields.Call_Owner.fieldRow).is(":visible")&&(f=L.find("#"+crmCallsNew.fields.Call_Owner.dataElement).data("id"),T=L.find("#"+crmCallsNew.fields.Call_Owner.displayNameEl).text()),U.data("id")&&(_=D.val(),y=U.val(),C=U.data("id")),Calls.updateDataInCards(e,S,I,A,E,f,T,_,C,y,b,w)}}}function populateRLCount(e,t,a,i,l){var s=$("#lp_rellist").children("li"),n=e?$("#newleft_"+e):s;!n.length&&e&&(n=s);var r=n.length,o=0,d=document.querySelector("crm-child-campaigns");if(d)var c=d.getData("info");var m=$L("crm-webinar-poll-details")[0];if(m)var u=m.getData("pollDetails");var p=$L("crm-webinar-qanda-details")[0];if(p)var g=p.getData("questionRecords");var v,h=$L("crm-zsurvey-rl-label")[0];h&&(v=h.getData("rlCount"));$("#deskRelatedListMenu");var f="TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY CHRONOLOGICALVIEWPERSONALITY",C="TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY CHRONOLOGICALVIEWHISTORYPERSONALITY",y=0,b=0,w=document.querySelector("#tabview_Activities_header"),I=document.querySelector("#TASKSPERSONALITY_split"),L=document.querySelector("#CALLSPERSONALITY_split"),A=document.querySelector("#EVENTSPERSONALITY_split"),E=document.querySelector("#APPOINTMENTSPERSONALITY_split"),S=document.querySelector("#Activities"),R=document.querySelector("#chronoview_Activities_split"),T=document.querySelector("#tabview_Activities_History_header"),_=document.querySelector("#TASKSHISTORYPERSONALITY_split"),k=document.querySelector("#CALLSHISTORYPERSONALITY_split"),M=document.querySelector("#EVENTSHISTORYPERSONALITY_split"),O=document.querySelector("#APPOINTMENTSHISTORYPERSONALITY_split"),P=document.querySelector("#Activities_History"),D=document.querySelector("#chronoview_Activities_History_split");if(null!==I||null!==L||null!==A||null!==E||null!==S||null!==R){var U=null!=I?I.component.data.info:void 0,F=null!=L?L.component.data.info:void 0,B=null!=A?A.component.data.info:void 0,x=null!=E?E.component.data.info:void 0,N=null!=S?S.component.data.leftRelTotalCount:void 0,j=null!=R?R.component.data.relatedListNavigData:void 0;if(0!==(b=(null!=F?(F.page-1)*F.per_page+F.count:0)+(null!=U?(U.page-1)*U.per_page+U.count:0)+(null!=B?(B.page-1)*B.per_page+B.count:0)+(null!=x?(x.page-1)*x.per_page+x.count:0))&&void 0!==b||void 0!==U||void 0!==F||void 0!==B||void 0!==x||void 0!==j&&"TimeLineView"===Crm.userDetails.openActRelView&&(b=j.length),"TabView"===Crm.userDetails.openActRelView&&(0===N||void 0===N)&&S&&void 0!==S.component){let e=S.component.data.tabHeadCount;b=e.Tasks+e.Meetings+e.Calls+e.Appointments__s,null===w&&(b=0)}}if(null!==_||null!==k||null!==M||null!==O||null!==P||null!==D){var V=null!=_?_.component.data.info:void 0,H=null!=k?k.component.data.info:void 0,z=null!=M?M.component.data.info:void 0,q=null!=O?O.component.data.info:void 0,G=null!=P?P.component.data.leftRelTotalCount:void 0,W=null!=D?D.component.data.relatedListNavigData:void 0;if(0!==(y=(null!=H?(H.page-1)*H.per_page+H.count:0)+(null!=V?(V.page-1)*V.per_page+V.count:0)+(null!=z?(z.page-1)*z.per_page+z.count:0)+(null!=q?(q.page-1)*q.per_page+q.count:0))&&void 0!==y||void 0!==V||void 0!==H||void 0!==z||void 0!==q||void 0!==W&&"TimeLineView"===Crm.userDetails.closedActRelView&&(y=W.length),"TabView"===Crm.userDetails.closedActRelView&&(0===G||void 0===G)&&P&&void 0!==P.component){let e=P.component.data.tabHeadCount;y=e.Tasks+e.Meetings+e.Calls+e.Appointments__s,null===T&&(y=0)}}for(;o<r;o++){var Z=n.eq(o),J=Z.attr("id").split("_")[1],Y=$("div[ddid="+J+"]"),Q=Y.attr("ddname");if("SUPPORTPERSONALITY"!==Q){var X=!("APPOINTMENTSPERSONALITY"===Q&&(module&&"Services"===module.value||!Crm.isActivitySplitDone)),K=t?$("#customRelatedListDiv_"+J).find(".topband_dv_row").length:Y.find(".topband_dv_row").length?Y.find(".topband_dv_row").length:$("#"+J).find(".topband_dv_row").length;K=f.includes(Q)&&X?b:K,K=C.includes(Q)?y:K,K="CHILDCAMPAIGNSPERSONALITY"==Q&&c&&null!=c.count?c.more_records?c.count+"+":c.count:K,K="WEBINAR_POLLS_PERSONALITY"==Q&&u?u.length:K,K="WEBINAR_QUESTION_PERSONALITY"==Q&&g?g.length:K;var ee=document.querySelector('crm-related-list-view-header[related-module="Attachments"]');if(K="ATTACHMENTSPERSONALITY"===Q&&ee&&void 0!==ee.getData("relatedListCount")?ee.getData("relatedListCount"):K,a)K=Y.find("#rellist_end_index").length?parseInt(Y.find("#rellist_end_index").text()):Z.find("span.numCountn").text().replace("+","")?parseInt(Z.find("span.numCountn").text().replace("+",""))+K:K;else if(1==r&&"EMAILSPERSONALITY"===Q){var te=Z.find("span.numCountn").text().replace("+","");if(Y.find("#rellist_end_index").length)K=parseInt(Y.find("#rellist_end_index").text());else if(te){var ae=te?parseInt(te):0;ae>10&&(i||(K=ae%10==0?ae-K:ae-ae%10))}}if(f.includes(Q)||C.includes(Q)||0===K){if("CIRCUITSPERSONALITY"===Q){Z.find("span.addNewIcP").addClass("dN");continue}if(0===K&&"CIRCUITSPERSONALITY"!==Q)$("#newleft_"+J).find(".numCountn").removeClass("numCountVal"),K="";else if(f.includes(Q)||C.includes(Q)){if(K>=10)K=f.includes(Q)&&null!=U&&1==U.more_records||null!=F&&1==F.more_records||null!=B&&1==B.more_records||C.includes(Q)&&(null!=V&&1==V.more_records||null!=H&&1==H.more_records||null!=z&&1==z.more_records)?K+"+":K}}else"ATTACHMENTSPERSONALITY"!==Q&&K>=10&&0===Y.find("#rellist_navig_next").find("img.next_disabled").length&&(K=K%10==0?K+"+":K);"SURVEYPERSONALITY"==Q&&"0"!==v&&($("#newleft_"+J).find("span.numCountn").addClass("numCountVal").text(v),K=v),"SUPPORTPERSONALITY"==Q&&K>=7&&0===Y.find("#rellist_navig_next").find("img.next_disabled").length&&(K=K%7==0?K+"+":K),""!=K?(Z.find("span.numCountn").addClass("numCountVal").text(K),"EMAILSPERSONALITY"===Q&&Z.find("span.numCountn").addClass("plusVal"),"SOCIALPERSONALITY"!==Q&&"ATTACHMENTSPERSONALITY"!==Q&&$('#RelatedListCommonDiv[ddid="'+J+'"]').removeClass("noDataFountDetail")):Z.find("span.numCountn").text(K).removeClass("numCountVal");var ie=Y.find(".dummyForLeftPanel");if((!ie.length&&!f.includes(Q)||Crm.userDetails.CLIENT_ACCOUNT&&f.includes(Q))&&"CALENDARBOOKINGSPERSONALITY"!==Q)"newleft_Notes"!==Z.attr("id")&&Z.find("span.addNewIcP").addClass("dN");else{if(("ACTIVITYPERSONALITY"==Q||"ATTACHMENTSPERSONALITY"==Q)&&0==$("#options_"+J).length){var le=Y.find("#ract_"+J).find(".dummyForLeftPanel").clone();0==le.length&&(le=Y.find("#norec_"+J).find(".dummyForLeftPanel").clone());var se='<div id="options_'+J+'" class="eventActionsMenu wsNowrap" style="display:none;" data-options="'+Q+'" onclick="sE(event)"></div>';Z.closest("td").append(se),$("#options_"+J).append(le)}"SUPPORTPERSONALITY"!==Q&&Z.find("span.addNewIcP").removeClass("dN"),ie.length||"APPOINTMENTSPERSONALITY"!==Q||(!module||"Services"!==module.value)&&Crm.isActivitySplitDone||Z.find("span.addNewIcP").addClass("dN"),"SERIESPERSONALITY"===Q&&void 0===Crm.userDetails.permissions.Crm_Implied_Manage_Enroll_Series&&Z.find("span.addNewIcP").addClass("dN")}var ne=$L("crm-attachments lyte-menu-item");if("ATTACHMENTSPERSONALITY"==Q&&ne.length>0){Z.find("crm-related-list-actions").remove(),Z.find("span.addNewIcP").remove();var re=store.peekRecord("related_list",J),oe=store.peekRecord(moduleRecordMapping[detailView.currentModule].id,entityId.value),de=$("#newleft_"+J).find(".addNewIcP")[0];de&&(de.tabIndex="-1"),Lyte.Component.render("crm-related-list-actions",{module:detailView.currentModule,relatedList:re,record:oe,options:"left_pannel"},"#newleft_"+J);let e=Z.find("span.addNewIcP");e.hasClass("dN")||Lyte.Component.registeredHelpers.showAddRecord("Attachments")||e.addClass("dN")}if(Crm.userDetails.hideUnauthorizedCreateLink&&l&&(l[J]||"Notes"===J)){let e=Z.find("span.addNewIcP");if(!e.hasClass("dN")){let t="TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY CHRONOLOGICALVIEWPERSONALITY",a="TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY CHRONOLOGICALVIEWHISTORYPERSONALITY";if(!["SERIESPERSONALITY"].contains(Q))if(t.includes(Q)||a.includes(Q)){let t=$L("crm-activity-rel-wrapper");t=t&&t[0],t=t&&t.component.data.subModuleData,t=t&&t.find((e=>"Appointments"===e.module));let a=Lyte.Component.registeredHelpers.showAddRecord("Appointments");Lyte.Component.registeredHelpers.showAddRecord("Tasks")||Lyte.Component.registeredHelpers.showAddRecord("Events")||Lyte.Component.registeredHelpers.showAddRecord("Calls")||t&&(!t||a)||e.addClass("dN")}else"Notes"===J?(!1===Notes.noteChk||"false"===Notes.noteChk)&&e.addClass("dN"):l[J].mxnfieldid&&!Lyte.Component.registeredHelpers.showAddRecord(l[J].searchmodule)&&!ie.length&&e.addClass("dN")}}}}if($("#TotalNotesCount").length&&!Crm.userDetails.isRelatedListLyteEnabled&&(0==$("#TotalNotesCount").val()?$("#newleft_Notes").find("span.numCountn").text("").removeClass("numCountVal"):$("#newleft_Notes").find("span.numCountn").text($("#TotalNotesCount").val()).addClass("numCountVal")),"undefined"!=typeof businessCardJson&&(businessCardJson.customizePermission?businessCardJson.customRelatedListEnabled?$("#newleft_NewRL").addClass("dIB").removeClass("dN"):$("#newleft_NewRL").remove():($("#newleft_OrganizeRL").remove(),$("#newleft_NewRL").remove())),$("#lp_salesSummaryDiv").length&&SalesSummaryInfo&&loadSalesSummary(),detailView.bindScroll(),Crm.userDetails.detailView_newUI){$L("#RelatedListCommonDiv #RelatedListDataScroll,#newRelDetailsScroll,#RelatedListCommonDiv #ticketsDropDiv").scroll({preventVertical:!0});var ce=$L.debounce(detailView.detailViewRelatedListDataScrollHandler,1);$("#RelatedListCommonDiv .lyteScrollBar").off("scroll",ce).on("scroll",ce)}}function searchColumnList(e,t,a){var i,l=$L("#"+e);i=$("#"+e+" li:visible");var s=$(".columnListBtn");if(13===(t.keyCode?t.keyCode:t.which)){var n=i[0];return null!=n&&crmListView.selectColumn(void 0,n),!1}if(!a){$("#"+e+" li").show(),$("#columnlistnomatch").hide(),s.show(),l.show();var r=l.parent().parent().parent()[0].id.split("_")[1];if(Crm.isActivitySplitDone&&!Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality(r,"Services"===getObj("module").value||void 0)){var o=$("#relatedListCols_"+r),d=o.find("#customize_error"),c=o.width()-38;d.css("width",c+"px")}}a=a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var m=new RegExp(a,"i");l.show(),$("#"+e+" li").each((function(){m.test($(this).text())?$(this).show():$(this).hide(),i=$L("#"+e+" li:visible")})),i.length?($("* #columnlistnomatch").hide(),l.show(),s.show(),l.closest(".ps-container").scrollTo(i.eq(0))):(l.closest("#menuColumnListView").next("#columnlistnomatch").show(),l.hide(),s.hide())}function getAlertContent(e,t,a){var i=new Array,l="fromDetailsView"==e?new Array($("#id").val()):null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.selectedIds:i,s=null;"module"in window?s=module.value:null!=customViewObject?s=customViewObject.module:"zbCustomModuleObjForAccountContactDeletion"in window&&(s=zbCustomModuleObjForAccountContactDeletion.module),ZInvoice.fetchAssociatedIds(s,l,(function(e){if(e.length>0){var a;a=null==customViewObject||!(customViewObject.selectedIds.length>1);var i=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.singularModName?customViewObject.singularModName:moduleRecordMapping[s].singular_label:zbCustomModuleObjForAccountContactDeletion.singularModuleName,l=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.pluralModName?customViewObject.pluralModName:moduleRecordMapping[s].plural_label:zbCustomModuleObjForAccountContactDeletion.pluralModuleName,n=I18n.getMsg("crm.cannot.delete.account.contact.singular",i.toLowerCase()),r=I18n.getMsg("crm.cannot.delete.account.contact.plural",l.toLowerCase()),o=a?n:r;o=null==$("#id").val()||""==$("#id").val()?o:n;var d='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.cannot.delete.account.contact.header",a?i:l)+'</h2></div><div class="mT10">'+o+'</div></div><br class="cBoth"><div  class="alignRight mT20"><input type="button" id="popupok" class="newgraybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(d)}else{var c=isRelatedRecordsModule(customViewObject.module)?I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(customViewObject.module)):"";showDeletePopup(I18n.getMsg("crm.warning.move.to.trash"),"crm.button.delete","",c,t)}}))}function changeImageClass(){var e="";"undefined"!=typeof Storage&&(e="asc"===localStorage.orderby?"sort_asc":"desc"===localStorage.orderby?"sort_desc":""),$("#"+localStorage.sortby+"_img").addClass(e)}function siChangeVideoUrl(e,t){$(".selectedList").removeClass("selectedList"),$(e).addClass("selectedList"),$("#siQTVideo").attr("src",RebrandLinkUtil.getProperty(t))}function docsIntegCallBackFn(e){var t=$("#fileCheckVariable"),a=!1,i=Lyte.registeredMixins["crm-detailcanvas-utils"];if(i&&(i.isFormViewCommonCheck()||i.isWizardView())&&(a=!0),Crm.userDetails.isNewEditor&&(t=$("#fileCheckVariable_"+EmailComposeUtil.CURRENT_TAB)),t.length>0&&("EntMail"==t.val()||"EntityMail"==t.val()||"EmailClient"==t.val()))EmailAttachmentsUtil.docsIntegCallBackFn(e);else if($("#multipleFieldsEditPop").is(":visible")||$("crm-blueprint-exec-popup").is(":visible"))fileAttachSubmitIntercept("attachDocuments",e);else{if(!fileupload.fromFileUploadField){var l=document.getElementById("moduleForIFrame").value,s=document.getElementById("anchorId").value,n=document.getElementById("entityId").value;e=e+"&entityID="+n+"&module="+l+"&anchorId="+s+"&service=ZDocsLink&linkDocs=true"}var r="crmcsrfparam="+$("input[name='crmcsrfparam']").val(),o=!1;if(fileupload.fromFileUploadField){var d=$("#attachSize_"+fileupload.fieldID+fileupload.rowNum).val(),c=$("#attachCount_"+fileupload.fieldID+fileupload.rowNum).val();if(""==d&&(d=0),fileupload.cxPropId){var m=Lyte.registeredMixins["crm-uploadfields-mixin"];d=m.getFileUploadAttachedSize(fileupload.cxPropId),c=m.getFileUploadAttachedCount(fileupload.cxPropId)}e=e+"&fromFileUploadField=true&fieldId="+fileupload.fieldID+"&module="+fileupload.module+"&service=ZDocsLink&linkDocs=true&attachedSize="+d+"&attachedCount="+c}"Events"==l&&document.getElementById("attachTotCnt")&&(o=!0,e+="&attachTotCnt="+document.getElementById("attachTotCnt").value),fileupload.isSubformField&&(fileupload.fieldID=detailView.fileuploadfieldId,fileupload.rowNum=fileupload.rowNum?fileupload.rowNum:detailView.rowNum);var u=Crm.getCrmBasePath()+"/docsSubmit.do?"+e;mR(u,(function(e){if(fileupload.fromFileUploadField){if("crm.FileuploadField.size.limitstmt"===e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.FileuploadField.size.limitstmt"));if("crm.FileuploadField.size.newlimitstmt"===e.trim()){let e=fileupload.maximum_allowed_size?fileupload.maximum_allowed_size:crmConstants.FileUploader.fileUploadFieldAttachments.maximumAllowedSize;return void renderingUtils.showCustomAlert(I18n.getMsg("crm.FileuploadField.size.newlimitstmt",e))}if("crm.attachment.name.check"===e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"));if("crm.attachment.fileUploadField.Maxcount.check"===e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check"));if("crm.attachment.fileUploadField.Mincount.check"===e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.fileUploadField.Mincount.check"));var t=Lyte.registeredMixins["crm-uploadfields-mixin"].getCruxFileUploadCreateComponents(fileupload.cxPropId);t.length&&(t=t[0].component).setData("cxPropErrorMessage","");var i=JSON.parse(e),s=$(".zc_fileup_alert");s.addClass("dNImp"),a&&(s.removeClass("cruxErrMsg"),s.closest(".zcanvas-field").removeClass("zc_errorstate"));var r=fileupload.maximum_allowed_size?fileupload.maximum_allowed_size:crmConstants.FileUploader.fileUploadFieldAttachments.uploadSizeLimit;switch(i.message){case"crm.FileuploadField.size.newlimitstmt":case"crm.attachment.fileUploadField.Maxcount.check":case"crm.attachment.fileUploadField.Mincount.check":return renderingUtils.removeFreezeLayer(),t&&(t.setData("cxPropErrorMessage",parent.I18n.getMsg(i.message,r)),a&&Lyte.registeredMixins["crm-formview-mixin"].addStateClass(elem.closest(".zcanvas-field"),"zc_errorstate")),!1}i.fromFileUpload.length&&(fileupload.createAttachElement(i,void 0,a),renderingUtils.removeFreezeLayer())}else{if("crm.attachment.size.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.size.exceed.limit"));if("crm.attachment.name.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"));if(o)return void(document.querySelector('crm-related-list-view-header[related-module="Attachments"]')?(Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()):$("#AttachmentFrame").html(e));doAjaxUpdate("relatedPageContent",Crm.getCrmBasePath()+"/NewRelatedList.do?id="+n+"&module="+l+"&action=getAllData")}ZDDialog.closePopUp("linkdocsdialogdiv"),fileupload.fromFileUploadField=!1}),r)}}function backToSearchResult(){var e=searchResultObj.searchResponse;$("#show").empty(),getObj("show").innerHTML=e,hide("zohobusy_loadpage_search"),isWorking=!1,enableSkype()}function mailsetCenterNew(e,t){var a=$("#"+e),i=$(window).width()/2-a.outerWidth()/2;a.css({top:0,left:i}).show(),t&&$("#qCreateOuter").css({top:"80px",left:i}).show()}function fileAttachSubmitIntercept(e,t){var a=$("#multipleFieldsEditPop"),i=$L("#attachmentBlueprint")[0],l=$L("crm-detail-view-blueprint-action")[0],s=$L("crm-blueprint-exec-popup"),n=a.is(":visible")||s.is(":visible")?"bluePrint":"general";if((i||s[0])&&(n="bluePrint"),"general"===n)return"proceed";if("bluePrint"===n){if(s[0]){var r=document.querySelector("crm-blueprint-exec-attach");switch(e){case"fileUpload":hideAnimatePopup("topBandPopup"),r.component.executeMethod("addFileuploads",t);break;case"attachDocuments":r.component.executeMethod("addDocuments",t);break;case"attachFromTeamDrive":r.component.executeMethod("addTeamDriveAttachments",t)}return"skipSave"}var o;if("undefined"!=typeof ProcessFlow){var d=$("#transitionAttachDiv .labelValCreate");switch(e){case"fileUpload":if(hideAnimatePopup("topBandPopup"),renderingUtils.showFreezeLayer(),i)return l.component.attachmentInterceptor(e,t),"skipSave";validatePreview(e,d,t),$("#freezeBackGround").addClass("hide"),commonUtils.showHideLoadingDiv(!1);break;case"attachLink":o=$("#attachmentUrl").val();var c=$("#invalidUrl"),m=$("#invalidUrlName"),u={action:"validateFileName"};u.fileName=$("#linkattachmentTitle")[0].value,u.attachmentUrl=o,u.entityId=i?l.getData("record").id:ProcessFlow.ExcecutionObjs.entityId,u.module=$("#multipleFieldEditModule").val(),u.feature=n;var p=new crmRequestPool;commonUtils.showHideLoadingDiv(!0),p.initiate({type:"GET",action:Crm.getCrmBasePath()+"/fileattach.do",data:u,success:function(t){if(c.hide(),m.hide(),"failure"===t.status)$("#attachlinkbtn").prop("disabled",!0),"LinkExists"===t.reason&&(c[0].innerText=I18n.getMsg("crm.attach.link.exists"),c.show()),"invalidname"===t.reason&&"attachmentUrl"===t.paramName&&(c[0].innerText=I18n.getMsg("crm.custombutton.valid.url.check"),c.show()),"invalidname"===t.reason&&"fileName"===t.paramName&&(m[0].innerText=I18n.getMsg("crm.label.valid.name"),m.show()),"morethanmaxlength"===t.reason&&(m[0].innerText=I18n.getMsg("crm.template.editor.name.len.check",250),m.show());else{if(c.hide(),i)return l.component.attachmentInterceptor(e,o,t),"skipSave";t.fileName=t.fileName.replace(/\+/g,"%20");var a=decodeURIComponent(t.fileName),s="bp_attachitem_"+o;if(null!==document.getElementById(s))c[0].innerText=I18n.getMsg("crm.attach.link.exists"),c.show();else{c.hide();var n=$("<div>",{id:"attachmentList-"+e,type:e}),r=ProcessFlow.getFileNamesHtmlForTransPop({names:[a],ids:[o]},e);if(r)if(n.html(r),"true"===d.attr("isAttachmentAdded")){var u=$("#attachmentList-"+e);u.length>0?u.append(r):d.append(n)}else{if(Crm.userDetails.isRelatedListLyteEnabled){var p,g=$("#attachBlueprint").find("crm-related-list-actions")[0],v=$L("#attachmentAdded");g&&g.component&&((p=g.component.getData("relatedList")).fromBlueprint=!0,p.menuSelector="#attachmentAdded",g.component.$node.remove());var h=$("<div>",{id:"attachmentAdded",class:"attachmentsLabel blueprintAttachment"});v[0]&&v[0].remove();var f=$(d.html())}else{(f=$(d.html())).addClass("attachmentsLabel blueprintAttachment"),f.css("margin","7px")}d.removeClass("attachmentsLabel"),d.html(n),Crm.userDetails.isRelatedListLyteEnabled?(d.parent().after().append(h).append(f),Lyte.Component.render("crm-related-list-actions",{relatedList:p},"#attachmentAdded")):d.parent().after().append($("<div>").append(f).html()),d.attr("isAttachmentAdded","true"),BlueprintAttachment.appendClickEventForDropdown()}hideAnimatePopup("topBandPopup"),$("#freezeBackGround").addClass("hide")}}commonUtils.showHideLoadingDiv(!1)}});break;case"attachDocuments":if(i)return l.component.attachmentInterceptor(e,t),"skipSave";validatePreview(e,d,t);break;case"attachZDocs":case"attachGDocs":validateDocAttachment(e,d,t);break;case"attachFromTeamDrive":validatePreview(e,d,t)}return"skipSave"}}return"proceed"}function validateDocAttachment(e,t,a){var i,l,s=$("#multipleFieldEditModule").val(),n=$("#multipleFieldEditEntityId").val(),r=$("#attachdialogdiv"),o=document;"attachGDocs"===e?(o=document.getElementById("zohodocsframe").contentDocument,(i=$(o.getElementsByName("submitForm")[0])).append($("<input>").attr("type","hidden").attr("name","fromGoogleDocs").val("fromGoogleDocs"))):(i=$(document.getElementsByName("submitForm")[0])).append($("<input>").attr("type","hidden").attr("name","crmcsrfparam").val(csrfToken));i.append($("#anchorId").clone()),l=i.serializeArray(),o.submitForm.action=Crm.getCrmBasePath()+"/docsSubmit.do?entityID="+n+"&module="+s+"&fromSrc=blueprint";var d=o.submitForm.action;commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:"POST",url:d,data:l,dataType:"text",success:function(i,l,s){return commonUtils.showHideLoadingDiv(),null==s&&(s={requestUrl:d}),"crm.attachment.size.check"==i.trim()?(renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.size.exceed.limit","")),void renderingUtils.removeFreezeLayer()):"crm.attachment.name.check"==i.trim()?(renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"),""),void renderingUtils.removeFreezeLayer()):(validatePreview(e,t,a),r.css("display","none"),r.empty(),void(r.innerHTML=""))},error:function(e){if(e.status===crmConstants.limitExceedsCode)return Search.displayLookupExceedsMsg(e),commonUtils.showHideLoadingDiv(),!1;400===e.status&&"CRITERIA_LIMIT_EXCEEDED"===e.responseText&&renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.limit.error",Search.MAX_CRT_CNT)),commonUtils.showHideLoadingDiv()}}),i.remove()}function validatePreview(e,t,a){$("<div>",{id:"attachmentList-"+e,type:e});var i=ProcessFlow.getFileNames(e,a);if("attachFromTeamDrive"!==e){var l={};l.fileDetails=JSON.stringify(i),l.attachType=e,l.moduleId=$("#multipleFieldEditEntityId").val(),l.featureName="blueprint",l.action="getFileDetails",networkUtils.setCsrfParam(l);var s={};s.params=l,networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,"POST",s).then((function(l){var s=l;if(i.isPreviewAvailable=s.isPreviewAvailable,"attachZDocs"===e||"attachGDocs"===e&&void 0!==s.fileNames){var n=JSON.stringify(s.fileNames);n=n.replace(/\+/g,"%20"),n=decodeURIComponent(n),i.names=JSON.parse(n)}(appendAttachDivContent(i,t,e),"fileUpload"===e)&&$("#multipleFieldsEditPop").data("attachUploaderObj",a);"attachGDocs"===e&&$("#freezeBackGround_gdocs").remove()}))}else appendAttachDivContent(i,t,e)}function appendAttachDivContent(e,t,a){var i=$("<div>",{id:"attachmentList-"+a,type:a}),l=ProcessFlow.getFileNamesHtmlForTransPop(e,a);if(l)if(i.html(l),"true"===t.attr("isAttachmentAdded")){var s=$("#attachmentList-"+a);s.length>0?s.append(l):t.append(i)}else{if(Crm.userDetails.isRelatedListLyteEnabled){var n,r=t.parent(),o=r.find("crm-related-list-actions"),d=$L("#attachmentAdded");o[0]&&o[0].component&&((n=o[0].component.getData("relatedList")).fromBlueprint=!0,n.menuSelector="#attachmentAdded",o[0].component.$node.remove());var c=$("<div>",{id:"attachmentAdded",class:"attachmentsLabel blueprintAttachment"});d[0]&&d[0].remove();var m=$(t.html());t.removeClass("attachmentsLabel"),t.html(i),r.after().append(c).append(m),Lyte.Component.render("crm-related-list-actions",{relatedList:n},"#attachmentAdded")}else{(m=$(t.html())).addClass("attachmentsLabel blueprintAttachment"),m.css("margin","7px"),t.removeClass("attachmentsLabel"),t.html(i),t.parent().after().append($("<div>").append(m).html())}t.attr("isAttachmentAdded","true"),BlueprintAttachment.appendClickEventForDropdown();var u=$(".blueprintAttachment .atch-dropdown"),p=u.attr("onclick");p=void 0!==p&&p.length>0&&";"!==p[p.length-1]?p.concat(";BlueprintAttachment.removeContextMenu()"):Crm.userDetails.isRelatedListLyteEnabled?"BlueprintAttachment.removeContextMenu()":p.concat("BlueprintAttachment.removeContextMenu()"),u.attr("onclick",p)}}function getAttachmentModule(e){return"bluePrint"===e&&"undefined"!=typeof ProcessFlow?ProcessFlow.ExcecutionObjs.module:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#module")[0].value:document.viewentityform.module.value}function getAttachmentEntityId(e){return"bluePrint"===e&&"undefined"!=typeof ProcessFlow?ProcessFlow.ExcecutionObjs.entityId:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#id")[0].value:document.viewentityform.id.value}function getAttachmentCvid(e){return"bluePrint"===e?null:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#id")[0].value:document.viewentityform.id.value}function showDependentFieldsForEdit(e,t){t&&e&&(pipelineDropdown=$("#fieldValue1"),pipelineDropdown.attr("data-depFields",e),pipelineDropdown.trigger("change"))}function deleteMultipleMailsViaAPI(){var e=$("#id"),t=e.length>0?e.val():getOpenerObj("id").value,a=$("#module").val(),i=Crm.moduleInfo[a].apiname;if("Potentials"==a){var l=$L("#dealOnlyDropDown").attr("lt-prop-selected");l&&"dealsOnly"!==l&&(i="Contacts",t=l)}if("Cases"===a){var s=$L("crm-email-rl-filter"),n=s.length>0?s.get(0).component:void 0;if(n){var r=n.getData("moduleSelected");r&&"CASES_ALL"!==r&&"ACCOUNTS_ALL"!==r&&(i="Contacts",t=r)}}var o="/crm/v2.1/"+i+"/"+t+"/Emails?message_ids=",d=$("#mailsToDelete").val();o+=d.substring(0,d.length);var c={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({type:"DELETE",url:o,headers:c,success:function(e){var t=e.email_related_list;hideAnimatePopup("removepopup"),hideAnimatePopup("deletepopup");for(var a="",i=t.length,l=0;l<i;l++)if("error"==t[l].status){a=t[l].code;break}var s=$("#draftMails"),n=s.hasClass("selectTab");if(""!=a)commonUtils.showHideLoadingDiv(),"INVALID_DATA"==a?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.email.message.invalid.data")):"NO_PERMISSION"===a&&i>1?_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.email.message.delete.partial"),ltPropSecondaryMessage:I18n.getMsg("crm.email.message.delete.partial.explanation"),ltPropYield:!0}}):renderingUtils.displayPermissionDenied(void 0);else if(n){if(crmui.showMsgBand("success",I18n.getMsg("crm.drafts.deleted.successfully"),"5000"),s.hasClass("selectTab")){var r=$("#maxComposeBtn");r&&!r.hasClass("hide")&&d.substring(0,d.length).includes($("#enc_msgId").val())&&r.addClass("hide");var o=d.split(","),c=o.length;for(l=0;l<c;l++){var m=EmailComposeUtil.getTabIdContainingGivenDraft(o[l]);m&&EmailUtil.closeEmailTab(m,!0)}}}else""===a&&crmui.showMsgBand("success",I18n.getMsg("crm.emails.deleted.successfully"),"5000");showMailsListViaAPI("","-10","next"),$(".rLESelectAction").css("display","none"),$(".rLETabsElement").css("display","flex"),$('lyte-checkbox[lt-prop-name="ernHead"]').removeClass("eRListPartialSelect"),$("#mailsToDelete").val(""),$("#mailsSub").text("")},error:function(e){commonUtils.showHideLoadingDiv(),hideAnimatePopup("deletepopup"),$(".rLESelectAction").css("display","none"),$(".rLETabsElement").css("display","flex"),$('lyte-checkbox[lt-prop-name="ernHead"]').removeClass("eRListPartialSelect"),$("#mailsToDelete").val(""),$("#mailsSub").text("");var t=document.querySelector(".erlclearlink");selectAllMails(t);for(var a="",i=null!=e.email_related_list?e.email_related_list:e,l=i.length,s=0;s<l;s++)if("error"==i[s].status){a=i[s].code;break}"INVALID_DATA"==a?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.email.message.invalid.data")):renderingUtils.displayPermissionDenied(void 0)}})}validation.showZiaForCNSView=function(e,t){var a={entityId:t.response.entityId,module:t.response.module,isSelfMarketingEnabled:t.response.isSelfMarketingEnabled,isVOCEnabled:t.response.isVOCAvailable,VOCLink:"<link-to lt-prop-rel='noopener noreferrer' lt-prop-target='_blank' lt-prop-route='crm.settings.section.voice-of-customer'>"+I18n.getMsg("crm.label.zia.email.selfmarketing.VOC")+"</link-to>"};Lyte.Component.render("crm-ziaforcns",{data:a},"#cns"),closeUnneccessaryPopup();var i=document.getElementById("emailDetailIframeContent");null!==i&&i.parentNode.removeChild(i);var l=$("#mainDiv"),s=$(document.createElement("iframe")),n="";Crm.frameOriginZiaForEmails&&(n="?"+Crm.frameOriginZiaForEmails),s.attr({id:"emailDetailIframeContent",style:"opacity:1; padding: 20px 30px; box-sizing: border-box;width:100%; height: calc( 100% - 60px);clear: both; border: medium none",src:"/crm/html/content1.html"+n}),l.append(s);var r=$("#emailDetailIframeContent");r.parent().css("z-index",28),r.load((function(){setTimeout((function(){r.parent().css("z-index",28),document.getElementById("emailDetailIframeContent").contentWindow.document.write(e)}))})),renderingUtils.freezeBackground()},validation.showZiaForEmailsView=function(e,t,a){if($L(".etTrendsWrapper").length){var i=$L("crm-ziaforemails")[0].component;(l=getOnclickAttr(t)).notificationId=a,i.setData("onclickAttr",l),i.setData("highlight_class","highlight-detailview")}else{var l;(l=getOnclickAttr(t)).notificationId=a,Lyte.Component.render("crm-ziaforemails",{onclickAttr:l},"#ziaForEmails")}var s=$("#lookupdiv");s.html(""),s.css({display:"none"}),renderingUtils.removeFreezeLayer(),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),$("#diNotificationDetails").css({right:"-900px",display:"none"}),$("#diNotificationDetailsContent").empty();var n=document.getElementById("emailDetailIframeContent");null!==n&&n.parentNode.removeChild(n);var r=$("#ziaForEmailsDiv"),o=$(document.createElement("iframe")),d="";Crm.frameOriginZiaForEmails&&(d="?"+Crm.frameOriginZiaForEmails),o.attr({id:"emailDetailIframeContent",style:"opacity:1; padding: 20px 30px; box-sizing: border-box;width:100%; height: calc( 100% - 60px);clear: both; border: medium none",src:"/crm/html/content1.html"+d}),r.append(o);var c=$("#emailDetailIframeContent");c.parent().css("z-index",28),c.load((function(){setTimeout((function(){(c.parent().css("z-index",28),document.getElementById("emailDetailIframeContent").contentWindow.document.write(e),$L(".etTrendsWrapper").length)&&("true"===$L("crm-ziaforemails")[0].component.getData("onclickAttr").isActivityCreated?$L(".ziaForEventButton").attr("lt-prop-title",I18n.getMsg("crm.label.zia.ziaforemail.event.alreadycreated")):$L(".ziaForEventButton").removeAttr("lt-prop-title"))})),setTimeout((function(){var e=$L("crm-ziaforemails")[0];e&&e.component&&e.component.setData("highlight_class","")}),2e3)})),renderingUtils.freezeBackground()},validation.updateEventCreatedInfo=function(){var e=$L("crm-ziaforemails")[0],t=e?e.component:void 0;if(t){var a=t.getData("onclickAttr"),i={action:"getAndUpdate",id:a.notificationId},l=new crmRequestPool;i[csrfParamName]=csrfToken,l.initiate({type:"POST",data:i,action:Crm.getCrmBasePath()+"/crminotification.do",success:function(e){"success"===e.status&&($L(".ziaForEventButton").attr("lt-prop-title",I18n.getMsg("crm.label.zia.ziaforemail.event.alreadycreated")),Lyte.objectUtils(a,"add","isActivityCreated","true"))},error:function(e){crmui.showMsgBand("info",I18n.getMsg(e),2e3,"top")}})}};