var oneTimeData={setOneTimeDatas:function(e,i){this[e]=i}};function setOneTimeDatas(e,i){oneTimeData.setOneTimeDatas(e,i)}var callNotificationDetails={callIdsToBeClosed:[],callIdsNotified:[],hardClosedIds:[],waitingTimer:""};function makeCall(e,i,t,a,l){if(""!==e.trim()&&""!==e.getOnlyNO()){var n=Crm.getCrmBasePath()+"/ZTIMakeCall.do",r={event:"makeCall"};if("makecall"==i){var s=$("#email").val(),o=$("#mobile").val(),c=$("#contact").val(),d=$("#callthru").val(),p=$("#pbxType").val(),u=$("#groupName").val(),m=$("#dialCode"),f=null!=m?m.val():$("#dialLabel").html();a=$("#accountId").val(),r.callnow="callnow",r.dialCode=validationUtils.isNotEmpty(f)?f:"",r.email=validationUtils.isNotEmpty(s)?s:"",r.mobile=validationUtils.isNotEmpty(o)?o:"",r.contact=validationUtils.isNotEmpty(c)?c:"",r.callthru=validationUtils.isNotEmpty(d)?d:"",r.pbxType=validationUtils.isNotEmpty(p)?p:"",r.groupName=validationUtils.isNotEmpty(u)?u:"",r.accId=validationUtils.isNotEmpty(a)?a:"",r.toNumber=e.getOnlyNO(),r.fromNumber=$("#extension").val().getOnlyNO(),r.ReminderCallActivityId=l}else{s=document.getElementById("subvalue_EMAIL")?document.getElementById("subvalue_EMAIL").innerHTML:document.getElementsByName("subvalue_EMAIL")[0]?document.getElementsByName("subvalue_EMAIL")[0].innerHTML:"",c=document.getElementById("subvalue_LASTNAME")?document.getElementById("subvalue_LASTNAME").innerHTML:""==c&&document.getElementById("subvalue_ACCOUNTID")?document.getElementById("subvalue_ACCOUNTID").innerHTML:"",o=document.getElementById("subvalue_MOBILE")?document.getElementById("subvalue_MOBILE").innerHTML:"";var _=$("#id");a=void 0!==_?_.val():a||"",r.accId=a||"",r.email=s||"",r.mobile=o||"",r.contact=c||"",r.callthru="",r.fromNumber="",r.toNumber=e.getOnlyNO(),r.ReminderCallActivityId=l}networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:n,cache:!1,type:"POST",data:r,success:function(e){ctiApiNotifier.processMakeCallResp(e)}})}else CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.zti.invalidphone"))}var ctiApiNotifier={tabid:Math.random(),isUserInCall:!1,ctiApiNotification:function(e,i){if(e.fromcontactDV+""=="true"&&validationUtils.isNotEmpty(e.callId)){if(callNotificationDetails.callIdsToBeClosed.includes(e.callId+"")||callNotificationDetails.callIdsNotified.includes(e.callId+""))return;callNotificationDetails.callIdsNotified.push(e.callId+"")}CTIAPI.put("ctiname",e.ctiname);var t=$("#remindercallactivityid");if(validationUtils.isEmpty(t.val())&&ctiApiNotifier.isCurrentCallBoxMessage(e)&&validationUtils.isNotEmpty(e.caid)){t.val(e.caid);var a=$("#ctinotifier").find("call-fromto-field");a.length>0&&a[0].setData("activityId",e.caid)}"twilio"===e.ctiname?twilioNotifier.twiHandleWMSMessage(e):"AWSlily"===e.ctiname?lilyUINotify.handleWMSMessage(e):ctiApiNotifier.showCtiApiType2Notification(e),i&&i()},showCtiNotifier:function(){$("#ctinotifier").attr("is","true").show()},showCallNotification:function(e){var i=$("#ctinotifier"),t=$("#ctiapi_present_callstate").text().trim(),a=$("#callrefid").val()+"",l=$("#callId").val()+"",n=!0;if(ctiApiNotifier.endWaiting(),i.is(":visible")&&(t===I18n.getMsg("crm.tpi.ctiapi.connecting").trim()||t===I18n.getMsg("crm.tpi.ctiapi.connected").trim())&&!ctiApiNotifier.isCurrentCallBoxMessage(e)&&!callNotificationDetails.hardClosedIds.includes(a)&&!callNotificationDetails.hardClosedIds.includes(l)){n=!1;var r=$("#call_custnumber").val(),s=$("#Ctiapi_entityName").val()||"",o={};o.i18nErrorMsg=validationUtils.isNotEmpty(r)?I18n.getMsg("crm.tpi.ctiapi.error.unabletocall",[s,r]):I18n.getMsg("crm.telephony.unable.tocall"),o.popupclose=!0,ctiApiNotifier.closeNotify(a,l,o),ctiApiNotifier.hidePopup(),validationUtils.isNotEmpty(a)?callNotificationDetails.hardClosedIds.push(a):validationUtils.isNotEmpty(l)&&callNotificationDetails.hardClosedIds.push(l),setTimeout(ctiApiNotifier.showCtiNotifier,2e3)}CTIAPI.put("caid",e.caid),i.is(":visible")||CTIAPI.LocalStorage.put("call_desc",""),CTIAPI.CallTimer.reset(),CTIAPI.chatBarCheck(),ctiApiNotifier.moveReminderNotification(!0),e.hasOwnProperty("i18nCallState")||(e.i18nCallState=I18n.getMsg("crm.tpi.ctiapi.calling")),e.isNewCallView=isNewCallView,isNewCallView||Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("phonenumberassociate")],ResourceConstants.CRM)[0]]),e.activityCallBackParams=JSON.stringify(e.activityCallBackParams),i.html(Handlebars.templates.ctiapinotifier({ctiapinotifierjson:e})).css({overflow:"inherit"}),n&&i.attr("is","true").show(),$("#ctinotifier_center").html('<div class="ctiapi_activitys" id="ctiapi_entitys_create_contact"></div><div class="ctiapi_activitys" id="ctiapi_entitys_create_lead" style="display:none;" ></div>').hide(),$("#ctiapi_lead_freezeLayers,#ctiapi_contact_freezeLayers").remove();var c=$("#ctiapi_inboundcall_answer_button"),d=$("#ctiapi_type4_call_control");if(ctiApiNotifier.bindListeners(),"type4"===e.ctiapitype&&CTIAPI.put("ctiapitype","type4"),e.directcallto&&"callconnected"===e.directcallto?(d.show(),c.hide(),$("#ctiapi_transfercall_button,#ctiapi_zti_start_button,#ctiapi_dialpad").hide()):(e.calltype&&-1!==e.calltype.indexOf("out")&&(d.show(),c.hide(),"twilio"==e.ctiname&&twilioNotifier.isBrowserMode()&&$("#ctiapi_twilio_call_ctrl_bts").show(),$("#ctiapi_outboundcall_status_icon").show(),$("#ctiapi_inboundcall_status_icon").hide(),void 0===e.fromcontactDV?("twilio"===e.ctiname&&$("#ctiapi_call_endcall_button").show(),CTIAPI.get("potentialView")&&$("#ctiapi_businesscard_potential_link").click(),"type4"===CTIAPI.get("ctiapitype")&&(c.hide(),$("#ctiapi_transfercall_button,#ctiapi_zti_start_button,#ctiapi_dialpad").hide())):(c.hide(),$("#ctiapi_transfercall_button,#ctiapi_zti_start_button,#ctiapi_dialpad").hide(),"type4"!==CTIAPI.get("ctiapitype")&&$("#ctiapi_common_cancel_button").show())),"type4"==CTIAPI.get("ctiapitype")&&e.calltype&&-1==e.calltype.indexOf("out")&&d.show()),"inbound"==$("#call_type").val()&&ctiApiNotifier.notifyCrmPlus("received"),CallReminder.call(e.caid),validationUtils.isNotEmpty(e.callrefid)||"quickCreate"===e.source){var p=e.i18nCallState==I18n.getMsg("crm.tpi.ctiapi.calling.user",Crm.userDetails.DISPLAY_NAME)?"CallingAgent":"CallingCustomer";CTIAPI.storeInClientStorage(e.callrefid,e.source,0,0,p,e.qcStatus,e.callStartTime,e.isAnswerable,e.callId),isNewCallView&&qCreateCall.setCallDetails(e.entityid,e.entitymodule,e.extraid,e.extramodule,"")}else CTIAPI.removeClientStorage("");$("#ctinotifier, #eventCreatePopup").draggable({axis:"x",containment:"body",start:function(){$("#ctiapi_businesscard_potential").hide(),$("#ctiapi_businesscard_table").css("visibility","visible").show(),$("#ctiapi_businesscard_potential_arrow,#ctiapi_businesscard_potential_link").removeClass("active"),CTIAPI.put("potentialView",!1)},stop:function(e,i){var t=$("#ctinotifier"),a=i.offset.left;t.css({top:"initial"}),"ctinotifier"!==i.helper.attr("id")&&t.css({left:a})}})},showCtiApiType2Notification:function(e){var i=e.callstate,t=e.caid+"",a=e.callrefid+"",l=e.zticallid+"";$("#callrefid");if(ctiApiNotifier.setAllowedOperationKeys(e),"closenotify"===i||"callmissed"===i)ctiApiNotifier.new_closeNotificationPopUp(e);else if("closecallstatusalert"===i){ctiApiNotifier.new_closeNotificationPopUp_withoutCallrefid();var n=$("#callStatusAlertDiv");n.find(".msgBody").text(""),n.hide(),renderingUtils.removeDummyBackground()}else if("callanswered"===i||"callconnected"===i)if($("#intermediate_answer_process").hide(),CTIAPI.put("caid",t),CTIAPI.put("zticallid",l),e.directcallto&&"callconnected"===e.directcallto)e.i18nCallState="",ctiApiNotifier.new_showNotificationPopUp(e,!0);else{CTIAPI.get("ctiname");CTIAPI.setCallRefid(a),CTIAPI.setCallState(i),ctiApiNotifier.new_startTimer()}else if("callhungup"===i||"callended"===i||"calltransfered"===i){$("#intermediate_hungup_process").hide(),CTIAPI.put("caid",t),CTIAPI.put("zticallid",l),CTIAPI.setCallRefid(a),CTIAPI.setCallState(i),CTIAPI.put("desc",e.desc),e.directcallto&&"callhungup"===e.directcallto&&(e.i18nCallState="",ctiApiNotifier.new_showNotificationPopUp(e));var r=parseInt(e.callduration);if("calltransfered"===i){ctiApiNotifier.new_endCall();var s;s=CTIAPI.CallTimer.getTotalSeconds(),e.callduration=s,ctiApiNotifier.updateNotificationDurationForTransferCall(s)}else if(-1===r)CTIAPI.put("activitysubject",e.activitysubject),ctiApiNotifier.new_stopTimerManually();else if(ctiApiNotifier.new_endCall(),ctiApiNotifier.new_updateNotificationDuration(e.callduration),null!=e.dplist&&e.dplist>0){for(var o=e.agentdisposition,c="<option value='default'>-select-</option>",d=o.length,p=0;p<d;p++)c=c+"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(o[p])+"'>"+$ESAPI.encoder().encodeForHTML(o[p])+"</option>";var u=$("#agentdisp");$("#agentdispdiv").show(),u.html(c).show()}}else if("stopTimerManually"===i)ctiApiNotifier.new_endCall();else if("startTimerManually"===i)ctiApiNotifier.new_startTimer();else if("stopTimerDuringTransfer"===i)CTIAPI.put("caid",t),CTIAPI.put("activitysubject",e.activitysubject),CTIAPI.setCallRefid(a),CTIAPI.setCallState(i),ctiApiNotifier.new_stopTimerManually();else if("closenotifyByCallId"===i)ctiApiNotifier.new_closeNotificationPopUp_ByCallId(e);else if("closenotifywithoutrefid"===i)ctiApiNotifier.new_closeNotificationPopUp_withoutCallrefid(e);else if(CTIAPI.put("caid",t),CTIAPI.put("zticallid",l),void 0===e.fromcontactDV||!1===e.fromcontactDV||"false"===e.fromcontactDV?CTIAPI.put("fromcontactDV",!1):CTIAPI.put("fromcontactDV",!0),ctiApiNotifier.new_showNotificationPopUp(e),"calldialed"===e.callstate&&"success"===e.agentstatus&&$("#ctiapi_call_endcall_button").show(),"callreceived"===e.callstate&&null!=e.transfer){var m=I18n.getMsg("crm.tpi.ctiapi.transferfrom",$ESAPI.encoder().encodeForHTML(e.transfer));$("#transferusername").html(m).show()}if(e.i18nCallState){$("#ctiapi_present_callstate").text(e.i18nCallState);var f=e.i18nCallState==I18n.getMsg("crm.tpi.ctiapi.calling.user",Crm.userDetails.DISPLAY_NAME)?"CallingAgent":"CallingCustomer";CTIAPI.updateDisplayStatusInClientStorage(e.callrefid,f)}},setAllowedOperationKeys:function(e){var i=Crm.userDetails.ZUID;if(void 0!==e.hungupallowedusers){var t=e.hungupallowedusers.split(","),a=$.inArray(i,t);e.hungupurl=-1===a?"":"true"}if(void 0!==e.answerallowedusers){t=e.answerallowedusers.split(","),a=$.inArray(i,t);e.answerurl=-1===a?"":"true"}if(void 0!==e.muteallowedusers){t=e.muteallowedusers.split(","),a=$.inArray(i,t);e.muteurl=-1===a?"":"true"}if(void 0!==e.holdallowedusers){t=e.holdallowedusers.split(","),a=$.inArray(i,t);e.holdurl=-1===a?"":"true"}if(void 0!==e.keypressallowedusers){t=e.keypressallowedusers.split(","),a=$.inArray(i,t);e.keypressurl=-1===a?"":"true"}},click2Call:function(e,i,t,a,l,n,r){var s="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("Telephony"):void 0;if($("#eventViewPopup").is(":visible")&&Events.closeQuickView(),l=l||"",a=a||"",e=commonUtils.getPlainPhoneNo(e),"Calls"===n){var o,c=[store.findRecord("module",moduleRecordMapping.Calls.id)],d=store.peekRecord(moduleRecordMapping.Calls.id,entityid);if(void 0!==d&&d.hasOwnProperty("Who_Id")&&(void 0!==d.Who_Id||d.hasOwnProperty("What_Id"))&&d.hasOwnProperty("Outgoing_Call_Status")&&d.hasOwnProperty("Call_Type")&&d.hasOwnProperty("From_Number__s")&&d.hasOwnProperty("To_Number__s"))o=crmCallsNew.getCallAssociatedRecordJson(d);else{var p=store.findRecord(moduleRecordMapping.Calls.id,entityid);c.push(p)}l=a,Lyte.resolvePromises(c).then((function(r){r[1]&&(d=r[1][0],o=crmCallsNew.getCallAssociatedRecordJson(d));var s=crmCallsNew.isOutboundCall(d.Call_Type);s&&e===d.To_Number__s||!s&&e===d.From_Number__s?(n=o.Who_Id?"Contacts":o.What_Id?o.$se_module:void 0,a=o.Who_Id?o.Who_Id.id:o.What_Id?o.What_Id.id:void 0,n||(n="PhoneNumbers"),l=crmCallsNew.isOpenCall(d.Outgoing_Call_Status)?l:"",ctiApiNotifier.click2Call(e,i,t,a,l,n)):ctiApiNotifier.click2Call(e,i,t)}))}if(""!==e.trim()&&""!==e.getOnlyNO()&&e.length<=25){if(isTelephonyWidgetInstalled&&s){var u="";return/^\+/.test(e)&&(u="+"),void WidgetHandler.EventNotifier.dial(e.replace(/\D/g,""),n,a,l,u)}var m=Crm.getCrmBasePath()+"/CtiApiConfig.do",f={mode:"click2call",userId:t+"",contactid:a+"",custnumber:e+"",callactivityid:l+"",entitymodule:n+""};if("twilio"===CTIAPI.CTI.ctiname){var _=$("#twistatusimg").attr("statusvalue")+"";"0"==(_=validationUtils.isEmpty(_)?"0":_)&&twilioNotifier.twilioRegisterBrowser()}if("AWSlily"==CTIAPI.CTI.ctiname&&0==lilyUINotify.lilyLogin)return validationUtils.isNotEmpty(lilyAgentBasicDetails.lilyCCPurl)?lilyUINotify.loginNow():lilyUINotify.lily_config_show_login(),!1;crmCallsNew.getClick2CallPromise(a,n,r,l).then((function(r){var s=$("#protocol").attr("value");validationUtils.isEmpty(s)?(f.activityCallBackParamMap=r,ctiApiNotifier.makeClick2Call(m,f,e,l,i,a,t,n)):top.frames.phoneBridgeHistoryFrame.location.href=s+e+"?call"}))}else renderingUtils.showCustomAlert(I18n.getMsg("crm.zti.invalidphone",""))},makeClick2Call:function(e,i,t,a,l,n,r,s){networkUtils.setCsrfParam(i),(new crmRequestPool).initiate({action:e,cache:!1,type:"POST",data:i,success:function(e){var i=e;switch(i.status){case"success":var o="";validationUtils.isNotEmpty(i.notifyjson)&&(ctiApiNotifier.ctiApiNotification(i.notifyjson),o=i.notifyjson.entityname||""),$("#apiparam").text(i.parametersent),$("#apiurl").text(i.urlcalled),$("#methodType").text("POST");var c=i.outboungdetjson;if(null!=i.pbxtype&&"onpremise"==i.pbxtype)return void ctiApiNotifier.onPremiseCall(c,i.callId);"server"===i.connectionSide&&ctiApiNotifier.updateToConnectedStatus(i.callId),null!=c&&(c.callactivityid=a,c.custnumber=t,localStorage.setItem("userStatus",c.userStatus),"twilio"===c.ctiname?ctiApiNotifier.TwilioMakeClick2Call(t,i.currenttime,l,a,n,s,c,o):"phonebridge"===c.ctiname?makeCall(t,"","",r,a):"AWSlily"===c.ctiname&&lilyActions.makeOutgoingCall(t,i.callId,o));break;case"failure":if(i.popupclose=!i.popupclose||i.popupclose,i.ConnTimeOut){var d=$("#ctinotifier"),p=$("#ctiapi_present_callstate").text().trim();"true"===d.attr("is")&&ctiApiNotifier.isCurrentCallBoxMessage(i.notifyjson)&&p===I18n.getMsg("crm.tpi.ctiapi.connecting").trim()&&(ctiApiNotifier.new_closeNotificationPopUp_ByCallId(i),ctiApiNotifier.closeNotify(null,i.callId,i))}else i.isNotified?ctiApiNotifier.new_closeNotificationPopUp_ByCallId(i):ctiApiNotifier.showErrorStatus(i,i.popupclose);break;case"OpenVendorOAuth":ctiApiNotifier.openOAuthCtiApiType4(i.ctiname,i.vendor_client_id,i.oauthcodeurl,i.redirecturl,i.vendor_scope)}}})},TwilioMakeClick2Call:function(e,i,t,a,l,n,r,s){var o=r.params,c={PhoneNumber:e,ctinumber:o.callerid,zgid:t,zuid:r.zuid,callactivityid:a,contactid:l,contactModule:n,callId:i};0!=o.userStatus&&5!=o.userStatus||ctiApiNotifier.ctiapiUpdateUserStatus(1,o.userStatus,"twilio"),2!=o.userStatus&&3!=o.userStatus&&6!=o.userStatus&&7!=o.userStatus&&twilioNotifier.twilioMakeCallFinally(c,s)},showTwiStatusPopup:function(){var e=null,i=null;twilioNotifier.isBrowserMode()?(i=0,e=1):(i=2,e=3);var t={preffun:"TwilioConf.showPreferences()",statuslist:[{statusid:"twistonline",statusvalue:e,onclickfn:"ctiApiNotifier.statusChangePopUpClick(twistatusimg,'twistonline')",colourcode:"green",statusname:I18n.getMsg("crm.twilio.status.online")},{statusid:"twistoffline",statusvalue:i,onclickfn:"ctiApiNotifier.statusChangePopUpClick(twistatusimg,'twistoffline')",colourcode:"red",statusname:I18n.getMsg("crm.twilio.status.offline")}]};$("#twistatuschangepopup").html(Handlebars.templates.ctiapi_statuslist({data:t})).css({bottom:"26px",right:"0px"}).show()},statusChangePopUpClick:function(e,i){var t=$("#"+i).attr("statusvalue"),a=$(e).attr("statusvalue");0==a&&1==t&&twilioNotifier.twilioRegisterBrowser(),ctiApiNotifier.ctiapiUpdateUserStatus(t,a,"twilio",(function(){TwilioConf.twilioUpdateUserStatus(t),$("#twistatuschangepopup").hide()}))},new_showNotificationPopUp:function(e,i){CTIAPI.setCallRefid(e.callrefid),CTIAPI.setCallState(e.callstate),CTIAPI.checkOldCallSaved(e,(function(e){Lyte.injectResources(networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","crux-lookupfilter-component.js","crux-column-list.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient),void 0,(function(){ctiApiNotifier.showCallNotification(e)})),i&&ctiApiNotifier.new_startTimer()}))},new_showNotificationPopUpWithNewCheck:function(e){var i=CTIAPI.get("old_callrefid"),t=CTIAPI.get("callrefid");e.callStartTime=Date.now();var a=e.callrefid;if(validationUtils.isNotEmpty(t)?CTIAPI.setCallRefid(a):CTIAPI.put("callrefid",a),("outbound"===e.calltype||e.fromcontactDV+""=="true")&&"true"===$("#ctinotifier").attr("is")&&a!=i&&validationUtils.isNotEmpty(i)&&$("#callrefid").val()==i){ctiApiNotifier.createCaid((function(){}),1,!0,e)}Lyte.injectResources(networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","crux-lookupfilter-component.js","crux-column-list.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient),void 0,(function(){ctiApiNotifier.showCallNotification(e)})),t=CTIAPI.get("callrefid"),validationUtils.isNotEmpty(t)&&CTIAPI.setCallRefid(t)},new_startTimer:function(e){var i=$("#popupFrom"),t=$L(".callNotifyInScroll"),a=t.height();if("quickCreate"!==i.val()||"callhungup"!==CTIAPI.get("callState")){var l=$("#ctiapi_calldesc"),n=CTIAPI.get("callrefid"),r=$("#ctiapi_dialpad");"type4"!==CTIAPI.get("ctiapitype")&&CTIAPI.checkCTICallNotifed(n,!0);var s=CTIAPI.get("ctiname");0===CTIAPI.CallTimer.TimerID&&(CTIAPI.CallTimer.start(CTIAPI.DisplayCallTimer,1e3,e),CTIAPI.updateAnsweredTimeInClientStorage("",CTIAPI.CallTimer.callStartedTimeInMilliSeconds)),"twilio"===s&&ctiApiNotifier.addEventHandlerDialpad_Keypress(),"quickCreate"===i.val()&&qCreateCall.callDescVal&&l.val(qCreateCall.callDescVal),$("#ctiapi_present_callstate").text("");var o=networkUtils.returnDependencyFiles(["crm-call-popup-menu.js"],ResourceConstants.CRMClient);Lyte.injectResources(o,void 0,(function(){$("crm-call-popup-menu").show()})),$(".status_icon,.call_ctrl_bts").hide(),$("#ctiapi_answeredcall_status_icon,#ctiapi_calltimer,#ctiapi_calldesc_div,#ctiapi_call_endcall_button,#ctiapi_zti_stop_button,#ctiapi_unknown_add_associate_plus").show(),ctiApiNotifier.endWaiting(),"twilio"==CTIAPI.CTI.ctiname&&"quickCreate"!==i.val()?twilioNotifier.isBrowserMode()&&r.show():r.show(),CTIAPI.setIE9Placeholder(l),l.focus();var c=r.find("a").length,d=r.outerWidth();if(c>0){var p=d/c;r.find("a").css("width",p)}$("#ctinotifier").find(":tabbable").attr("tabindex",0),"inbound"==$("#call_type").val()&&ctiApiNotifier.notifyCrmPlus("answered"),t.scrollTop(a)}},new_startTimerManually:function(){var e=CTIAPI.get("ctiname"),i=CTIAPI.get("callrefid"),t=CTIAPI.get("caid"),a=Crm.getCrmBasePath()+"/CtiApiConfig.do",l={mode:"startTimerManually",ctiname:e,callrefid:i,callactivityid:t};networkUtils.setCsrfParam(l),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:l,success:function(){}}),ctiApiNotifier.new_startTimer()},new_stopTimerManually:function(){var e=CTIAPI.get("caid"),i=CTIAPI.get("callrefid")+"",t=CTIAPI.get("ctiname"),a=CTIAPI.CallTimer.getTotalSeconds(),l="";0===a&&(l=CTIAPI.get("activitysubject"),$("#ctiapi_calltimer_min,#ctiapi_calltimer_sec").text("00"),CTIAPI.put("activitysubject",""));var n=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={mode:"stopTimerManually",ctiname:t,callduration:a,callActivityId:e+"",activitySubject:l,callrefid:i};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:n,cache:!1,type:"POST",data:r,success:function(){}}),ctiApiNotifier.new_endCall()},addEventHandlerDialpad_Keypress:function(){$("#ctiapi_dialpad_keypad_numbers").keydown((function(e){var i=e.keyCode,t=String.fromCharCode(i);e.shiftKey&&(t=56===i?"*":51===i?"#":t),/[0-9*#]/g.test(t)&&(e.shiftKey&&56===i||51===i||!e.shiftKey)&&(CTIAPI.keypadClick(t),$("[ctiapi_dialpad_keypad_number='ctiapi_dialpad_keypad_number_"+t+"']").animate({backgroundColor:"#e1e6ec"},"fast",(function(){$(this).css({background:""})})))}))},new_endCall:function(){if(CTIAPI.CallTimer.pause(),void 0!==CTIAPI.get("desc")&&void 0!==CTIAPI.get("ctiapitype")&&"type4"==CTIAPI.get("ctiapitype")){var e=$("#ctiapi_calldesc");e.val(e.val()+CTIAPI.get("desc")),CTIAPI.decideShowHide_CloseBT()}else("twilio"==CTIAPI.get("ctiname")&&"completed"==CTIAPI.get("callState")||"twilio"!=CTIAPI.get("ctiname"))&&CTIAPI.decideShowHide_CloseBT();$("#ctiapi_present_callstate").text("");var i=networkUtils.returnDependencyFiles(["crm-call-popup-menu.js"],ResourceConstants.CRMClient);Lyte.injectResources(i,void 0,(function(){$("crm-call-popup-menu").show()})),$("#ctinotifier,#ctinotifier .chatContainer").css({overflow:"hidden"}),$(".status_icon,.call_ctrl_bts,#ctiapi_businesscard,#ctiapi_calltransfer_from,#ctiapi_calltransfer_to,#ctiapi_dialpad,#ctiapi_dialpad_keypad,#ctiapi_holdcall_status_icon,#ctiapi_onhold_status_text").hide(),$("#ctiapi_endcall_status_icon,#ctiapi_calltimer,#ctiapi_calldesc_div,#ctiapi_close_bt_div,#ctiapi_unknown_add_associate_plus").show(),ctiApiNotifier.endWaiting(),"true"===$("#ctiapi_known_caller").val()||ctiApiNotifier.isUnknownConverted()?$("#ctiapi_folloup_create").show():$("#ctiapi_close_bt, #ctiapi_save_bt, #ctiapi_cancel_bt").addClass("mT20"),"inbound"==$("#call_type").val()&&ctiApiNotifier.notifyCrmPlus("ended"),isNewCallView&&$(".tabDivCreate:not(#Calls_fldRow_DESCRIPTION)").show()},new_closeNotificationPopUp:function(e){if("true"===$("#ctinotifier").attr("is")&&e.callrefid===CTIAPI.get("callrefid")){if(ctiApiNotifier.hidePopup(),e.i18nErrorMsg){var i=!validationUtils.isNotEmpty(e.popupclose)||e.popupclose;ctiApiNotifier.showErrorStatus(e,i)}else if(e.i18nKey){e.i18nErrorMsg=I18n.getMsg(e.i18nKey,[e.i18nParam]);i=!validationUtils.isNotEmpty(e.popupclose)||e.popupclose;ctiApiNotifier.showErrorStatus(e,i)}e.ctiname&&"twilio"==e.ctiname&&(e.browserStatus||e.zuidVsStatus||(e.browserStatus="online"),twilioNotifier.setBrowserStatus(e),CTIAPI.setCallState("completed"),CTIAPI.put("twiCurrentStatus","completed"))}},new_closeNotificationPopUp_ByCallId:function(e){var i=$("#ctinotifier"),t=$("#callId").val();if(callNotificationDetails.callIdsToBeClosed.push(e.callId+""),"true"===i.attr("is")&&validationUtils.isNotEmpty(t)&&e.callId===t&&(ctiApiNotifier.hidePopup(),e.i18nErrorMsg)){var a=!validationUtils.isNotEmpty(e.popupclose)||e.popupclose;ctiApiNotifier.showErrorStatus(e,a)}},new_closeNotificationPopUp_withoutCallrefid:function(){"true"===$("#ctinotifier").attr("is")&&""===$("#callrefid").val()&&ctiApiNotifier.hidePopup()},hidePopup:function(){var e=$("#ctinotifier");ctiApiNotifier.moveReminderNotification(!1),e.find("#ctiapi_calldesc_div").empty(),e.find("#followUpCallFields").empty(),e.attr("is","false").hide(),$("#ctinotifier_center").hide(),$("#ctiapi_lead_freezeLayers").remove(),$("#ctiapi_contact_freezeLayers").remove(),CTIAPI.CallTimer.reset(),renderingUtils.removeDummyBackground(),ctiApiNotifier.endWaiting(),"inbound"==$("#call_type").val()&&ctiApiNotifier.notifyCrmPlus("ended"),clienttab.showAlertBeforeUnload=!1;var i=$("#callrefid").val(),t=$("#callId").val(),a=validationUtils.isNotEmpty(t)?t:i;validationUtils.isNotEmpty(a)&&CTIAPI.removeClientStorage(a)},ctiapiUpdateUserStatus:function(e,i,t,a){if(e===i)return!1;var l=CTIAPI.get("callrefid"),n=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={mode:"updateUserStatus",ctiname:t,prestatus:i,currentstatus:e,callrefid:l};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:n,cache:!1,type:"POST",data:r,success:function(){$.isFunction(a)&&a()}})},moveReminderNotification:function(e){var i=$("#ctireminder"),t=$("#ctiapi_multireminder_bussinessview");e?Crm.userDetails.RTL_ENABLED?(i.animate({left:"380px",right:"inherit"}),t.animate({left:380+i.outerWidth()+"px"})):(i.animate({right:"380px"}),t.animate({right:380+i.outerWidth()+"px"})):Crm.userDetails.RTL_ENABLED?(i.animate({left:"0px",right:"inherit"}),t.animate({left:"370px",right:"inherit"})):(i.animate({right:"0px"}),t.animate({right:"370px"}))},type4Answer:function(){var e=CTIAPI.get("callrefid"),i=CTIAPI.get("ctiname"),t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"type4CallAnswer",ctiname:i,callrefid:e};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:a,success:function(e){if("success"===e.status){if(null!=e.pbxtype&&"onpremise"==e.pbxtype)return void ctiApiNotifier.onPremiseCall(e);$("#ctiapi_inboundcall_answer_button").hide(),$("#intermediate_answer_process").show(),$("#ctiapi_present_callstate").text(I18n.getMsg("crm.tpi.ctiapi.type4.answerprocess")),$("#apiparam").text(e.parametersent),$("#apiurl").text(e.urlcalled),$("#methodType").text("POST")}else ctiApiNotifier.showErrorStatus(e,!1)},error:function(){CTIAPI.customCtiApiConfirm("error")}})},type4Hungup:function(){var e=CTIAPI.get("callrefid"),i=CTIAPI.get("ctiname"),t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"type4CallHungup",ctiname:i,callrefid:e};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:a,success:function(e){if("success"===e.status){if(null!=e.pbxtype&&"onpremise"==e.pbxtype)return void ctiApiNotifier.onPremiseCall(e);$("#intermediate_hungup_process").show(),$("#ctiapi_dialpad,#ctiapi_call_endcall_button").hide(),$("#ctiapi_present_callstate").text(I18n.getMsg("crm.tpi.ctiapi.type4.hungupprocess")),$("#apiparam").text(e.parametersent),$("#apiurl").text(e.urlcalled),$("#methodType").text("POST")}else ctiApiNotifier.showErrorStatus(e,!1)},error:function(){CTIAPI.customCtiApiConfirm("error")}})},type4Mute_Hold:function(e){var i=CTIAPI.get("callrefid"),t=CTIAPI.get("ctiname"),a=Crm.getCrmBasePath()+"/CtiApiConfig.do",l="",n="",r=$("#ctiapi_dialpad_bt_"+e);r.hasClass("active")?(n="off",l="un"+e):(n="on",l=e);var s={mode:"type4CallAction",ctiname:t,callrefid:i,callaction:l};networkUtils.setCsrfParam(s),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:s,success:function(e){null==e.pbxtype||"onpremise"!=e.pbxtype?"success"===e.status?("on"===n?r.addClass("active"):r.removeClass("active"),$("#apiparam").text(e.parametersent),$("#apiurl").text(e.urlcalled),$("#methodType").text("POST")):ctiApiNotifier.showErrorStatus(e,!1):ctiApiNotifier.onPremiseCall(e)},error:function(){CTIAPI.customCtiApiConfirm("error")}})},type4KeyPress:function(e){var i=CTIAPI.get("callrefid"),t=CTIAPI.get("ctiname"),a=Crm.getCrmBasePath()+"/CtiApiConfig.do",l={mode:"type4KeyPress",ctiname:t,callrefid:i,digit:e};networkUtils.setCsrfParam(l),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:l,success:function(e){"success"===e.status?($("#apiparam").text(e.parametersent),$("#apiurl").text(e.urlcalled),$("#methodType").text("POST")):ctiApiNotifier.showErrorStatus(e,!1)},error:function(){CTIAPI.customCtiApiConfirm("error")}})},updateHoldState:function(){var e={mode:"updateHoldState"};networkUtils.setCsrfParam(e),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:e,success:function(){WebMessanger.systemdown&&ctiApiNotifier.holdNotify()}})},holdNotify:function(){CTIAPI.CallTimer.timerRun?($("#ctiapi_dialpad_bt_hold").addClass("active"),$(".status_icon").hide(),$("#ctiapi_holdcall_status_icon").show(),$("#call_hold").val("true"),CTIAPI.CallTimer.pause(),CTIAPI.updatePausedTimeInClientStorage("",CTIAPI.CallTimer.callPausedTimeInMilliSeconds)):($("#ctiapi_dialpad_bt_hold").removeClass("active"),$(".status_icon,#ctiapi_holdcall_status_icon").hide(),$("#ctiapi_answeredcall_status_icon").show(),$("#call_hold").val("false"),CTIAPI.CallTimer.resume(CTIAPI.DisplayCallTimer,1e3),CTIAPI.updatePausedTimeInClientStorage("",CTIAPI.CallTimer.callPausedTimeInMilliSeconds))},new_editDesc:function(e){CTIAPI.LocalStorage.put("call_desc",e),CTIAPI.decideShowHide_CloseBT()},descTextAreaAdjust(e){var i=$(e).clone(),t=$L(e).parent();t.append(i),i[0].style.height="auto";var a=i[0].scrollHeight;if(i.remove(),e.style.height=a+"px",e.value.length==e.selectionStart){var l=t.parent();l.scrollTo(l[0].scrollHeight)}},decideShowHide_ActivitysCreateLink:function(){var e="true"===$("#is_task_created").val(),i="true"===$("#is_call_created").val(),t=validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text());e&&i&&t?$("#ctiapi_folloup_create").hide():$("#ctiapi_folloup_create").show()},createCall_unknownCaller:function(){var e="true"===$("#is_contact_associated").val(),i="true"===$("#is_lead_associated").val();if(e){var t=$("#Ctiapi_associated_contact_id").val(),a="Contacts";ctiApiNotifier.createCall(t,a)}else if(i){t=$("#Ctiapi_associated_lead_id").val(),a="Leads";ctiApiNotifier.createCall(t,a)}else ctiApiNotifier.createCall()},createCall:function(e,i,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else if(isNewCallView)ctiApiNotifier.createFollowUp("call",e,i,$("#Ctiapi_entityName").val());else{commonUtils.showHideLoadingDiv(!0);var a=$("#ctiapi_activitys_create_call");if("true"===a.attr("is"))ctiApiNotifier.create_EditCalls_CallBack(!0);else{var l=Crm.getCrmBasePath()+"/QCreate.do",n={module:"Calls",fromCreate:"QuickCreate",recordNum:1,ctiapi:!0};networkUtils.setCsrfParam(n),validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(i)&&(n.id=e+"",n.entityid=e+"",n.relmodule=i,n.primmodule=i),(new crmRequestPool).initiate({action:l,cache:!1,type:"POST",data:n,success:function(e){if(-1!==e.indexOf("createEntityForm"))if(a.html(e).attr("is","true"),handleQCScheduleCall($("[name='createEntityFormctiapiCalls']")),t){ctiApiNotifier.populateContactDetails("Calls");var i=$("#ctinotifier_center");i.show(),$("#ctiapi_activitys_create_call").show();var l=i.outerHeight()/2;i.css("margin-top","-"+l+"px"),commonUtils.showHideLoadingDiv(),$("#Calendar").css("z-index",1001)}else ctiApiNotifier.create_EditCalls_CallBack(!1)},error:function(){ctiApiNotifier.cancelCalls()}})}}},isUnknownConverted:function(){return"true"===$("#is_contact_created").val()||"true"===$("#is_contact_associated").val()||"true"===$("#is_lead_created").val()||"true"===$("#is_lead_associated").val()},getCreatedOrAssocEntity:function(){var e={},i="true"===$("#is_contact_created").val(),t="true"===$("#is_lead_created").val();return i||"true"===$("#is_contact_associated").val()?(e.entityId=$("#Ctiapi_associated_contact_id").val(),e.entityName=i?$("#ctiapi_unknown_added_contact_name").text():$("#ctiapi_unknown_associated_contact_name").text(),e.entityModule="Contacts",e.relatedId=i?$("#actName").val():$("#Ctiapi_associated_contact_modid").val(),e.relatedName=i?$(document.getElementById("Account Name")).prop("value"):$("#Ctiapi_associated_contact_modname").val(),e.relatedModule="Accounts"):(t||"true"===$("#is_lead_associated").val())&&(e.entityId=$("#Ctiapi_associated_lead_id").val(),e.entityName=t?$("#ctiapi_unknown_added_lead_name").text():$("#ctiapi_unknown_associated_lead_name").text(),e.entityModule="Leads"),e},populateContactDetails:function(e){if(!("Calls"===e&&"true"===$("#is_call_created").val()||"Task"===e&&"true"===$("#is_task_created").val())){var i=ctiApiNotifier.getCreatedOrAssocEntity();if(i&&i.entityId&&i.entityName){var t="Calls"===e?"createEntityFormctiapiCalls":"createEntityFormctiapiTasks";$("form[name="+t+"] #leContModSel").val(i.entityModule).trigger("change"),$("form[name="+t+"] #leContModId").val(i.entityId),$("form[name="+t+"] #leContModName").val(i.entityName),"Contacts"===i.entityModule&&i.relatedId&&i.relatedName&&($("form[name="+t+"] #modsel").val(i.relatedModule).trigger("change"),$("form[name="+t+"] #modname").val(i.relatedName),$("form[name="+t+"] #modid").val(i.relatedId))}}},create_EditCalls_CallBack:function(){if(!isNewCallView){ctiApiNotifier.callPopupFreezeLayer(),renderingUtils.ShakeDivInfreeze("ctinotifier","right",20,100,$("#pb_freezeLayer")),ctiApiNotifier.populateContactDetails("Calls"),$("#callpopup").hide();$("#ctiapi_activitys_create_call").show().height();$("#ctiapi_chatmain").addClass("callnoactive"),commonUtils.showHideLoadingDiv(),$("#Calendar").css("z-index",1001)}},add_remove_cancelCalls_CallBack:function(){ctiApiNotifier.callPopupDefreezeLayer(),$("#callpopup").show(),commonUtils.showHideLoadingDiv();var e=$("#ctiapi_chatmain"),i=$("#ctiapi_activitys_create_call");e.removeClass("callnoactive"),i.hide()},cancelCalls:function(){Crm.isHeadless&&Lyte.triggerEvent("crm-quick-create",{message:"close"}),ctiApiNotifier.add_remove_cancelCalls_CallBack()},callsAdd:function(e){var i=$(e).closest("form").get(0).name;if(quickCreateValidateAction("All","Calls",i)){multiSelectRemoval(i),$("#callpopup").show(),$("#ctiapi_module_head_msg_Call").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Call"))),$("#ctiapi_folloup_call_list,#removeCalls_link").show(),$("#ctiapi_folloup_call_create_lnk").hide(),$("#ctiapi_folloup_call_list_subject").text(getElm("createEntityFormctiapiCalls","property(Subject)").value),$("#is_call_created").val("true").trigger("change"),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.add_remove_cancelCalls_CallBack();var t=commonUtils.formData2QueryString(document.createEntityFormctiapiCalls,"Calls");CTIAPI.put("callsformDataTemp",t),Crm.isHeadless&&ctiApiNotifier.saveCalls(t,!0)}return!1},deleteCalls:function(){$("#callpopup").show(),$("#ctiapi_activitys_create_call").attr("is","false"),$("#ctiapi_folloup_call_list,#removeCalls_link").hide(),$("#ctiapi_folloup_call_create_lnk").show(),$("#ctiapi_folloup_call_list_subject").text(""),$("#is_call_created").val("false").trigger("change"),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.add_remove_cancelCalls_CallBack(),CTIAPI.put("callsformDataTemp","")},createTask_unknownCaller:function(){var e="true"===$("#is_contact_associated").val(),i="true"===$("#is_lead_associated").val();if(e){var t=$("#Ctiapi_associated_contact_id").val(),a="Contacts";ctiApiNotifier.createTask(t,a)}else if(i){t=$("#Ctiapi_associated_lead_id").val(),a="Leads";ctiApiNotifier.createTask(t,a)}else ctiApiNotifier.createTask()},createTask:function(e,i,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{if(isNewCallView&&!Crm.isHeadless)return ctiApiNotifier.createFollowUp("task",e,i),"";commonUtils.showHideLoadingDiv(!0);var a=$("#ctiapi_activitys_create_task");if("true"===a.attr("is"))ctiApiNotifier.create_EditTaskCallBack(!0);else{var l=Crm.getCrmBasePath()+"/QCreate.do",n={module:"Tasks",fromCreate:"QuickCreate",ctiapi:!0,recordNum:1};networkUtils.setCsrfParam(n),validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(i)&&(n.id=e+"",n.entityid=e+"",n.relmodule=i,n.primmodule=i),Crm.isHeadless&&(n.headless=!0),(new crmRequestPool).initiate({action:l,cache:!1,type:"POST",data:n,success:function(e){if(-1!==e.indexOf("createEntityForm"))if(a.html(e).attr("is","true"),t){ctiApiNotifier.populateContactDetails("Task");var i=$("#ctinotifier_center");i.show(),$("#ctiapi_activitys_create_task").show();var l=i.outerHeight()/2;i.css("margin-top","-"+l+"px"),commonUtils.showHideLoadingDiv(),$("#Calendar").css("z-index",1001),$(".ctiChatWrapper").addClass("taskpop")}else ctiApiNotifier.create_EditTaskCallBack(!1)},error:function(){ctiApiNotifier.cancelTask()}})}}},create_EditTaskCallBack:function(){if(!isNewCallView){var e=$("#ctiapi_chatmain"),i=$("#ctinotifier"),t=i.height(),a=document.body.offsetWidth,l="",n="";i[0]&&(l=i[0].style.left,n=i[0].offsetLeft),ctiApiNotifier.callPopupFreezeLayer(),renderingUtils.ShakeDivInfreeze("ctinotifier","right",20,100,$("#pb_freezeLayer")),ctiApiNotifier.populateContactDetails("Task"),$("#callpopup").hide(),e.css({overflow:"hidden",height:t});var r=$("#ctiapi_activitys_create_task").show().height();e.css({height:r+3}),commonUtils.showHideLoadingDiv(),$(".ctiChatWrapper").addClass("taskpop"),""!=l&&a-n<500&&(i[0].style.left=a-500+"px"),$("#Calendar").css("z-index",1001)}},add_remove_cancelTaskCallBack:function(){ctiApiNotifier.callPopupDefreezeLayer(),$("#callpopup").show(),commonUtils.showHideLoadingDiv();var e=$("#ctiapi_chatmain"),i=$("#ctiapi_activitys_create_task");e.removeClass("callnoactive"),i.hide()},cancelTask:function(){if($(".ctiChatWrapper").removeClass("taskpop"),Crm.isHeadless)return $("#ctinotifier_center:visible").hide(),WindowsCommunicator.notifyParent("cancel-operation");var e=$("#ctiapi_chatmain")[0];e&&e.style.removeProperty("height"),ctiApiNotifier.add_remove_cancelTaskCallBack()},addTask:function(e){var i=$(e).closest("form").get(0).name;if(quickCreateValidateAction("All","Tasks",i)){multiSelectRemoval(i),$("#callpopup").show(),$("#ctiapi_module_head_msg_Task").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Task"))),$("#ctiapi_folloup_task_list,#removeTask_link").show(),$("#ctiapi_folloup_task_create_lnk").hide(),$("#ctiapi_folloup_task_list_subject").text(getElm("createEntityFormctiapiTasks","property(Subject)").value),$("#is_task_created").val("true").trigger("change"),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.add_remove_cancelTaskCallBack();var t=commonUtils.formData2QueryString(document.createEntityFormctiapiTasks,"Tasks");if(CTIAPI.put("tasksFormDataTemp",t),$(".ctiChatWrapper").removeClass("taskpop"),Crm.isHeadless)return void ctiApiNotifier.saveTask(null,null,!0);var a=$("#ctiapi_chatmain")[0];a&&a.style.removeProperty("height"),$L(".callNotifyInScroll").scrollTo($(".callNotifyInScroll")[0].scrollHeight)}return!1},removeTask:function(){$("#ctiapi_folloup_task_list,#removeTask_link").hide(),$("#ctiapi_folloup_task_create_lnk").show(),$("#ctiapi_folloup_task_list_subject").text(""),$("#ctiapi_activitys_create_task").attr("is","false"),$("#is_task_created").val("false").trigger("change"),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.add_remove_cancelTaskCallBack(),CTIAPI.put("tasksFormDataTemp",""),$(".ctiChatWrapper").removeClass("taskpop");var e=$("#ctiapi_chatmain")[0];return e&&e.style.removeProperty("height"),!1},populateEventData:function(e){if(e){var i;i=e["property(Meeting Title)"]?e["property(Meeting Title)"]:e["property(Event Title)"],$("#Crm_Events_SUBJECT").prop("value",i);var t=e["property(Venue)"];$("#Crm_Events_LOCATION").prop("value",t);var a=e["property(Description)"];$("#Crm_Events_DESCRIPTION").prop("value",a);var l=ctiApiNotifier.isAllDayEvent(e);l&&$("#Crm_Events_ALLDAYEVENT").attr("checked","checked").triggerHandler("click"),ctiApiNotifier.populateEventReminder(l,ctiApiNotifier.reminderObj),ctiApiNotifier.populateEventPeriod(e),ctiApiNotifier.populateEventOwner(e);var n=e["property(leContModSel)"];if(n){$("#Crm_Events_CONTACTID_select").val(n).trigger("change");var r=e["property(leContModId)"],s=e["property(leContModName)"],o=e["property(modid)"],c=e["property(modname)"],d=e["property(modsel)"];if(("Leads"===n||"Contacts"===n)&&r){var p=$("#Crm_Events_CONTACTID");p.data("id",r),p.prop("value",s),p.attr("title",s)}if(("Others"===n||"Contacts"===n)&&($("#Crm_Events_SEID_label_select").val(d).trigger("change"),o)){var u=$("#Crm_Events_SEID");u.data("id",o),u.prop("value",c),u.attr("title",c)}}ctiApiNotifier.populateEventRecurr(e),ctiApiNotifier.populateEventParticpants(e)}},populateEventPeriod:function(e){var i=e["property(Start DateTime)"],t=e["property(Start DateTimehour)"]+":"+e["property(Start DateTimeminute)"]+" "+e["property(Start DateTimeampm)"],a=e["property(End DateTime)"],l=e["property(End DateTimehour)"]+":"+e["property(End DateTimeminute)"]+" "+e["property(End DateTimeampm)"];$("#Crm_Events_STARTDATETIME").prop("value",i),$("#Crm_Events_STARTDATETIME_TimeOption").prop("value",t),$("#Crm_Events_ENDDATETIME").prop("value",a),$("#Crm_Events_ENDDATETIME_TimeOption").prop("value",l)},populateEventOwner:function(e){var i=e["property(ownerId)"],t=e["property(ownerName)"],a=$("#Crm_Events_SMOWNERID"),l=$("#ownerNameLookupSpan");a.data("id",i),a.attr("title",t),l.text(t),l.attr("userid",i)},populateEventReminder:function(e,i){e?($.extend(!0,Events.allDayReminders,i),Events.retrieveAllDayReminders()):($.extend(!0,Events.reminders,i),Events.retrieveReminders())},populateEventRecurr:function(e){var i=e.period;if(i&&"None"!==i){$("#Crm_Events_RECURRING").siblings("a").trigger("click");var t=e.mainSelect&&"custom"===e.mainSelect;if(t?$("#Crm_Events_REPEATTYPE").val(e.mainSelect).trigger("change"):$("#Crm_Events_REPEATTYPE").val(i).trigger("change"),t){if($("#Crm_Events_RECURRING_FREQUENCY").val(i).trigger("change"),"weekly"===i){var a=e.selectedWeekDays;if(validationUtils.isNotEmpty(a)){var l=a.split(";");$("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON").val(l).trigger("change")}}else"monthly"===i?($("input:radio[name='monthlyhidden']:checked").val(e.monthlyhidden).trigger("change"),"1"===e.monthlyhidden?$("#Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY").val(e.monthly1select).trigger("change"):"2"===e.monthlyhidden&&($("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val(e.weeksequence).trigger("change"),$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val(e.weekdays).trigger("change"))):"yearly"===i&&($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST").val(e.weeksequence1).trigger("change"),"Day"===e.weeksequence1?$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val(e.yearlydays1select).trigger("change"):$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val(e.weekdays1).trigger("change"));var n=e.repeatEveryCnt;$("#Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT").prop("value",n)}$("input[name=endRadioOption][value="+e.endRadioOption+"]").prop("checked",!0);var r=e.repeatEndCount,s=e.repeatEndDate;$("#Crm_Events_RECURRING_REPEAT_COUNT").prop("value",r),$("#Crm_Events_RECURRING_END_DATE").prop("value",s),"daily"===i&&e.exceptHoliday&&0!=e.exceptHoliday&&$("#Crm_Events_EXCEPT_HOLIDAY_0").trigger("click"),"1"===e["property(RecInvMailType)"]&&$("#Crm_Events_RECURRING_INVITATIONMAIL_0").trigger("click"),Events.doneRecuring()}},populateEventParticpants:function(e){if(e["property(Participants)"]){Events.invJsonCreate=JSON.parse(e["property(Participants)"]);var i=0,t=JSON.parse(e["property(Participants)"]);for(var a in t)t.hasOwnProperty(a)&&(i+=Object.keys(t[a]).length);Events.selInviteesCnt=i,Events.setSelInvCnt()}},populteRelDetEvent:function(){var e=$("#Ctiapi_relatedEntityId").val(),i=$("#Ctiapi_relatedEntityModule").val(),t=$("#Ctiapi_relatedEntityName").val(),a=$("#Crm_Events_SEID");$("#Crm_Events_SEID_label_select").val(i).trigger("change"),a.data("id",e),a.prop("value",t),a.attr("title",t)},positionEventPopup:function(){var e=0,i=$("#eventCreatePopup"),t=$("#ctinotifier"),a=t.offset();a.left>=i.width()-t.width()&&(e=i.outerWidth()-t.outerWidth());var l=a.left-e;i.addClass("eventPopupRightFixed").css({left:l,"margin-left":"0"}).show()},createEventfromZPB:function(e,i){$("#Calendar").css("z-index",1001),Events.globalCreate(null,"call_popup",null,null,null,null,null,(function(){var t={};(t.entityId=e,t.entityModule=i,e&&i)&&($("#Crm_Events_CONTACTID_select").val(i).trigger("change"),$("#Crm_Events_CONTACTID").data("id",e));$("#removeEvents_link").hide(),$("#saveEventsBtn").addClass("smallbtn").val(I18n.getMsg("Done")),$("#cancelEventBtn").addClass("smallbtn").attr("onclick","ctiApiNotifier.hideEvent();"),$("#doneAddParticipantBtn").addClass("smallbtn"),renderingUtils.removeFreezeLayer()}))},createEvent:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{if(isNewCallView){var i,t,a;if(!e)i=$("#Ctiapi_entityId").val(),t=$("#Ctiapi_entityModule").val(),a=$("#Ctiapi_entityName").val(),ctiApiNotifier.createFollowUp("event",i,t,a)}else{if($("#eventCreatePopup").is(":visible")){var l={};return l.i18nErrorMsg=I18n.getMsg("crm.telephony.event.create.error",[Events.getModuleName(!0,!0,!0)]),void ctiApiNotifier.showErrorStatus(l,!1)}ctiApiNotifier.eventCreate=!0;$("#Calendar").css("z-index",1001),ctiApiNotifier.eventHidden?($("#ctiapi_chatmain").hide(),e&&($("#showMoreFiledsLink").trigger("click"),$("#removeEvents_link").show()),ctiApiNotifier.positionEventPopup(),renderingUtils.removeFreezeLayer(),ctiApiNotifier.callPopupFreezeLayer(),renderingUtils.ShakeDivInfreeze("eventCreatePopup","right",20,100,$("#pb_freezeLayer"))):Events.globalCreate(event,"call_popup",null,null,null,null,null,(function(){if(!0===e)ctiApiNotifier.populateEventData.bind(this,ctiApiNotifier.eventObj)(),$("#showMoreFiledsLink").trigger("click"),$("#removeEvents_link").show();else{var i={},t=$("#Ctiapi_entityId").val();if(validationUtils.isNotEmpty(t)?(i.entityId=t,i.entityModule=$("#Ctiapi_entityModule").val(),i.entityName=$("#Ctiapi_entityName").val(),i.relatedId=$("#Ctiapi_relatedEntityId").val(),i.relatedModule=$("#Ctiapi_relatedEntityModule").val(),i.relatedName=$("#Ctiapi_relatedEntityName").val()):i=ctiApiNotifier.getCreatedOrAssocEntity(),i&&i.entityId&&i.entityName){var a=i.entityModule;$("#Crm_Events_CONTACTID_select").val(a).trigger("change");var l=$("#Crm_Events_CONTACTID");if(l.data("id",i.entityId),l.prop("value",i.entityName),l.attr("title",i.entityName),"Contacts"===a&&i.relatedId&&i.relatedName){var n=$("#Crm_Events_SEID");$("#Crm_Events_SEID_label_select").val(i.relatedModule).trigger("change"),n.data("id",i.relatedId),n.prop("value",i.relatedName),n.attr("title",i.relatedName)}}$("#removeEvents_link").hide()}ctiApiNotifier.positionEventPopup(),$("#ctiapi_chatmain").hide(),$("#saveEventsBtn").addClass("smallbtn").val(I18n.getMsg("Done")),$("#cancelEventBtn").addClass("smallbtn").attr("onclick","ctiApiNotifier.hideEvent();"),$("#doneAddParticipantBtn").addClass("smallbtn"),$("#eventCreatePopup").draggable(),$("#eventCreatePopup").draggable("enable"),renderingUtils.removeFreezeLayer(),ctiApiNotifier.callPopupFreezeLayer(),renderingUtils.ShakeDivInfreeze("eventCreatePopup","right",20,100,$("#pb_freezeLayer"))}))}setTimeout((function(){EmailSendingUtil.isNewEditor()&&EmailSendingUtil.composeActive&&$L("#eventCreatePopup").addClass("zi33")}),400)}},addRemoveCancelCallBack:function(e){ctiApiNotifier.callPopupDefreezeLayer(),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),CTIAPI.decideShowHide_CloseBT(),$("#callpopup").show(),ctiApiNotifier.eventCreate=!1,commonUtils.showHideLoadingDiv();var i=$("#ctiapi_chatmain");i.show(),i.removeClass("callnoactive"),CTIAPI.hideElem(e)},hideEvent:function(){$("#eventCreatePopup").hide(),Crm.isHeadless?WindowsCommunicator.notifyParent("cancel-operation"):ctiApiNotifier.eventHidden=!0,ctiApiNotifier.addRemoveCancelCallBack()},notifierCloseEvent:function(e){$("#eventCreatePopup").removeClass("eventPopupRightFixed").draggable().draggable("disable"),$("#removeEvents_link").hide(),$("#cancelEventBtn").removeClass("smallbtn").attr("onclick","Events.closeEntity(true)"),$("#saveEventsBtn").removeClass("smallbtn").val(I18n.getMsg("crm.button.save")),$("#doneAddParticipantBtn").removeClass("smallbtn"),ctiApiNotifier.eventHidden=!1,e&&ctiApiNotifier.addRemoveCancelCallBack()},isAllDayEvent:function(e){return"on"===e["property(All day)"]},addEvent:function(e){return $("#callpopup").show(),e&&(ctiApiNotifier.eventObj=Crm.requestParam,ctiApiNotifier.participantsObj=Events.invJsonCreate,ctiApiNotifier.reminderObj=[],ctiApiNotifier.isAllDayEvent(ctiApiNotifier.eventObj)?(Events.saveAllDayRemindersState(),$.extend(!0,ctiApiNotifier.reminderObj,Events.allDayReminders)):(Events.saveRemindersState(),$.extend(!0,ctiApiNotifier.reminderObj,Events.reminders)),$("#ctiapi_folloup_event_list").show(),$("#ctiapi_folloup_event_create_lnk").hide(),ctiApiNotifier.eventObj["property(Meeting Title)"]?$("#ctiapi_folloup_event_list_subject").text(ctiApiNotifier.eventObj["property(Meeting Title)"]):$("#ctiapi_folloup_event_list_subject").text(ctiApiNotifier.eventObj["property(Event Title)"]),$("#is_event_created").val("true").trigger("change"),ctiApiNotifier.hideEvent()),!1},removeEvent:function(){ctiApiNotifier.eventObj=null,ctiApiNotifier.participantsObj=null,$("#ctiapi_folloup_event_list").hide(),$("#ctiapi_folloup_event_create_lnk").show(),$("#ctiapi_folloup_event_list_subject").text(""),$("#is_event_created").val("false").trigger("change"),Events.closeEntity(null,!0)},saveEvent:function(){Crm.requestParam=ctiApiNotifier.eventObj,Events.invJsonCreate=ctiApiNotifier.participantsObj,Events.validateEntity(null,!0,!0,"callPopup")},createCaid:function(e,i,t,a){var l="",n=(t=t||!1)?CTIAPI.get("old_callrefid"):CTIAPI.get("callrefid");if(validationUtils.isNotEmpty(n)){var r=$("#ctiapi_calldesc");(validationUtils.isNotEmpty(r.val())||l)&&"true"===$("#call_desc_presence").val()&&1===i&&(l=r.val()!==r.attr("placeholder")?r.val():"");var s=Crm.getCrmBasePath()+"/CtiApiConfig.do",o={mode:"createcaid",callrefid:n,type:i,desc:l,autosave:t,ctiapitype:CTIAPI.get("ctiapitype")};networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({action:s,cache:!1,type:"POST",data:o,success:function(i){if("0"===i){var l=CTIAPI.get("caid");validationUtils.isNotEmpty(l)?e(l,t,a):ctiApiNotifier.closeNotify()}else if("null"!==i){e(l=i,t,a)}commonUtils.showHideLoadingDiv()}})}else"quickCreate"===$("#popupFrom").val()&&"callhungup"===CTIAPI.get("callState")&&(qCreateCall.saveCall(i,e.bind(window,null,t,a)),commonUtils.showHideLoadingDiv())},duringNotificationClose:function(e){var i=CTIAPI.get("ctiname"),t=CTIAPI.get("callState"),a=CTIAPI.LocalStorage.get("noOfTabs"),l="true"===$("#call_desc_mandatory").val(),n=$("#ctiapi_calldesc").val(),r=validationUtils.isEmpty(n),s="";1===e?s=function(e){CTIAPI.put("caid",e),ctiApiNotifier.saveCallWithCaid()}:2===e&&(s=function(){ctiApiNotifier.cancelCall()});var o=$("#ctinotifier");if("twilio"===i){var c=twiOutgoingConn;if(Object.keys(twiIncomingConn).length>0&&(c=twiIncomingConn),"completed"===t&&1===a||"in-progress"===t||"ringing"===t&&validationUtils.isNotEmpty(c)&&"open"===c.status()||2===e||1===e)if(r){if(l)return CTIAPI.customCtiApiConfirm(I18n.getValueForFields("crm.field.empty.check",I18n.getMsg("Description"))),!1;ctiApiNotifier.createCaid(s,e)}else{if(2===e&&l)return CTIAPI.customCtiApiConfirm(I18n.getValueForFields("crm.field.empty.check",I18n.getMsg("Description"))),!1;ctiApiNotifier.createCaid(s,e)}}else if((1===a||a>1&&(1===e||2===e))&&"phonebridge"!==i&&"true"===o.attr("is")&&("callhungup"===t||"callended"===t)||"callanswered"===t||"calltransfered"===t)if(r){if(l)return CTIAPI.customCtiApiConfirm(I18n.getValueForFields("crm.field.empty.check",I18n.getMsg("Description"))),!1;ctiApiNotifier.createCaid(s,e)}else{if(2===e&&l)return CTIAPI.customCtiApiConfirm(I18n.getValueForFields("crm.field.empty.check",I18n.getMsg("Description"))),!1;ctiApiNotifier.createCaid(s,e)}else ctiApiNotifier.createCaid(s,e)},saveCallWithCaid:function(e,i,t){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;var a=CTIAPI.get("ctiname"),l=CTIAPI.get("caid"),n="true"===$("#is_task_created").val(),r=validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text());if(("phonebridge"===a||validationUtils.isNotEmpty(l))&&ctiApiNotifier.updateCallDesc(l),"true"===$("#ctiapi_known_caller").val()){var s=$("#Ctiapi_entityId").val(),o=$("#Ctiapi_entityModule").val();ctiApiNotifier.saveTask(s,o,n)}else{var c="true"===$("#is_contact_created").val(),d="true"===$("#is_lead_created").val(),p="true"===$("#is_contact_associated").val(),u="true"===$("#is_lead_associated").val();if(c||d){if(d){var m=$("#Ctiapi_associated_lead_id").val();CTIAPI.associateEntityWithCall(m,"Leads",l,n)}else if(c){var f=$("#Ctiapi_associated_contact_id").val();CTIAPI.associateEntityWithCall(f,"Contacts",l,n)}}else if(p||u){var _=$("#callrefid").attr("value");if(u){m=$("#Ctiapi_associated_lead_id").val();CTIAPI.associateEntityWithCall(m,"Leads",l,n,_)}else if(p){f=$("#Ctiapi_associated_contact_id").val();CTIAPI.associateEntityWithCall(f,"Contacts",l,n,_)}}else ctiApiNotifier.saveTask()}if(ctiApiNotifier.saveCalls(CTIAPI.get("callsformDataTemp")),r&&ctiApiNotifier.saveEvent(),i?ctiApiNotifier.closeNotify(null,null,null,i):ctiApiNotifier.closeNotify(),$.isFunction(e)&&e(),i&&"callhungup"===CTIAPI.get("callState")&&"callhungup"===CTIAPI.get("old_callstate")&&"callhungup"===t.directcallto&&"type4"===CTIAPI.get("ctiapitype"))if(-1===parseInt(t.callduration))CTIAPI.put("activitysubject",t.activitysubject),ctiApiNotifier.new_stopTimerManually();else if(ctiApiNotifier.new_endCall(),ctiApiNotifier.new_updateNotificationDuration(t.callduration),null!=t.dplist&&t.dplist>0){for(var v=t.agentdisposition,h="<option value='default'>-select-</option>",C=v.length,g=0;g<C;g++)h=h+"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(v[g])+"'>"+$ESAPI.encoder().encodeForHTML(v[g])+"</option>";var y=$("#agentdisp");$("#agentdispdiv").show(),y.html(h).show()}},updateCallDesc:function(e,i){var t=$("#ctiapi_calldesc");if((validationUtils.isNotEmpty(t.val())||i)&&"true"===$("#call_desc_presence").val()){i=i||t.val();var a="/crm/v2/Calls/"+e+"?affected_data=true",l={},n=[],r={};l.Description=i,n.push(l),r.data=n;var s={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(s["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:a,type:"PUT",data:JSON.stringify(r),contentType:"application/json",headers:s,success:function(e){CTIAPI.isError(e)&&CTIAPI.customCtiApiConfirm(I18n.getMsg("zb.common.error.Content1"))}})}},saveTask:function(e,i,t){if("true"===$("#is_task_created").val()||t){var a=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true";commonUtils.showHideLoadingDiv(!0);var l=CTIAPI.get("tasksFormDataTemp");l=objectUtils.parseURLParamString(l),validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(i)&&(validationUtils.isEmpty(l.primmodule)&&validationUtils.isEmpty(l.entityid)&&(l.entityid=e,l.primmodule=i),(validationUtils.isEmpty(l["property(leContModSel)"])||validationUtils.isEmpty(l["property(leContModId)"]))&&(l["property(leContModSel)"]=i,l["property(leContModId)"]=e)),l=$.param(l),(new crmRequestPool).initiate({action:a,type:"POST",data:l,success:function(e){if(commonUtils.showHideLoadingDiv(),$("#ctiapi_activitys_create_task").html(""),Crm.isHeadless){var i=new BasicEntityInfo(Tasks.moduleName,e.entityId,e.entityName);WindowsCommunicator.notifyParent("crm-followup-create",i)}}}),Crm.isHeadless||$L(".callNotifyInScroll").scrollTo($(".callNotifyInScroll")[0].scrollHeight)}return!0},saveCalls:function(e,i,t,a){if(!Crm.userDetails.isStorageLimitReached){if(i||"true"===$("#is_call_created").val()){var l=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true";l+="&entityInView="+t,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:l,cache:!1,type:"POST",data:e,success:function(i){Crm.isHeadless&&"object"==typeof i&&Lyte.triggerEvent("crm-quick-create",{message:"success",RecordName:i.entityName}),commonUtils.showHideLoadingDiv(),$("#ctiapi_activitys_create_call").html(""),i&&"object"==typeof i&&!Crm.isHeadless&&(Crm.userDetails.isRelatedListLyteEnabled?Lyte.triggerEvent("relatedList",{res:i,callActivity:!0}):crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,i),crmListView.isSmartFilterSupportedModule(detailView.currentModule)&&crmListView.dropCacheOnActivityCreate(detailView.currentModule,"Calls"),$L("#relatedPageContent").scrollTo({axis:"y"})),CTIAPI.isError(i)&&"callQC"===CTIAPI.getValueFromQuery(e,"viewType")?CTIAPI.customCtiApiConfirm(I18n.getMsg("zb.common.error.Content1")):($.isFunction(a)&&a(),("canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName||Crm.userDetails.isRelatedListLyteEnabled)&&Lyte.triggerEvent("relatedList",{res:i,callActivity:!0}))}})}return!0}Crm.showStorageExceedPopup()},new_updateNotificationDuration:function(e){var i=parseInt(e),t=Math.floor(i/60),a=i%60;if("true"===$("#ctinotifier").attr("is")){var l=CTIAPI.CallTimer.getTotalSeconds();if(-1===i){if(t=Math.floor(l/60),a=l%60,$("#ctiapi_calltimer_min").text(isNaN(t)&&-1!==t?"00":t<10?"0"+t:t),$("#ctiapi_calltimer_sec").text(isNaN(a)&&-1!==t?"00":a<10?"0"+a:a),0===l){CTIAPI.callThisFunctionOneTime("missedCallNotification",!0,(function(){ctiApiNotifier.duringNotificationClose(2)}))}}else $("#ctiapi_calltimer_min").text(isNaN(t)?"00":t<10?"0"+t:t),$("#ctiapi_calltimer_sec").text(isNaN(a)?"00":a<10?"0"+a:a)}else i>0&&(CTIAPI.CallTimer.Minute=t,CTIAPI.CallTimer.Second=a)},updateNotificationDurationForTransferCall:function(e){var i=$("#zticallid").val(),t=(i=CTIAPI.get("callrefid"),Crm.userDetails.USER_ID),a=Crm.getCrmBasePath()+"/CtiApiConfig.do",l={mode:"updateTransferDuration",callrefid:i,callduration:e,answeruserid:t+""};networkUtils.setCsrfParam(l),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:l,success:function(){}})},cancelCall:function(){"twilio"===CTIAPI.get("ctiname")&&twilioNotifier.twilioLogger("outgoingusercancel","NONE"),ctiApiNotifier.closeNotify()},closeNotify:function(e,i,t,a){commonUtils.showHideLoadingDiv(!0);var l=CTIAPI.CTI.ctiname,n=validationUtils.isNotEmpty(e)?e:a?CTIAPI.get("old_callrefid"):CTIAPI.get("callrefid");validationUtils.isEmpty(n)&&(n=""),CTIAPI.CallTimer.reset(),ctiApiNotifier.followUpData={};var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={mode:"closeNotify",ctiname:l,callrefid:n+"",callId:i};networkUtils.setCsrfParam(s),(new crmRequestPool).initiate({action:r,cache:!1,type:"POST",data:s,success:function(e){if(ctiApiNotifier.ctiApiNotification(e),commonUtils.showHideLoadingDiv(),validationUtils.isNotEmpty(t)){var i=!!validationUtils.isNotEmpty(t.popupclose)&&t.popupclose;ctiApiNotifier.showErrorStatus(t,i)}ctiApiNotifier.callPopupDefreezeLayer()}})},showHidePotentials:function(){var e=$("#ctiapi_businesscard_table"),i=$(".potentialTableBody");"visible"===e.css("visibility")?(CTIAPI.put("potentialView",!0),$L(".callNotifyInScroll").scrollTo(0,0),e.css("visibility","hidden"),$("#ctiapi_businesscard_potential").show(),$("#ctiapi_businesscard_potential_arrow,#ctiapi_businesscard_potential_link").addClass("active"),i.scroll((function(){$(".potentialHeader").css({left:-1*this.scrollLeft})})),i.find("tr").length<5?i.css({"min-height":107,"max-height":e.innerHeight()-13}):i.find("tr").length<=5&&i.css(max-height,150)):(CTIAPI.put("potentialView",!1),e.css("visibility","visible"),$("#ctiapi_businesscard_potential").hide(),$("#ctiapi_businesscard_potential_arrow,#ctiapi_businesscard_potential_link").removeClass("active"));var t=$("#ctiapi_businesscard_multi_potential"),a=t.offset().left,l=a+t.outerWidth();a<=0?t.css("left",0):l>=$(window).width()&&t.css("left","-502px")},getMorePotentialsType4:function(e){var i=$("#ctiapi_businesscard_multi_potential");if("false"===i.attr("content_exist")){var t={},a=[],l=[],n=e.noOfpotential;t.module="Potentials",t.headingCount="6",t.noRecord="false";for(var r=1;r<=n;r++){var s={},o=[],c=e["potential"+r],d=c.businessCard;if(1==r){t.module=c.potentialmodule;var p={};p.DISPLAYLABEL=I18n.getValueForFields("Potential Name",c.potentialmodule),a.push(p);var u={};u.DISPLAYLABEL=I18n.getValueForFields("Amount"),a.push(u);var m={};m.DISPLAYLABEL=I18n.getValueForFields("Type"),a.push(m)}var f={};f.DISPLAYVALUE=c.potentialname,o.push(f);var _={};_.DISPLAYVALUE=c.amount,o.push(_);var v={};for(var h in v.DISPLAYVALUE=c.type,o.push(v),d){if("Potential Owner"!=h&&"Potential Name"!=h&&"Expected Revenue"!=h&&"Account Name"!=h&&"Contact Name"!=h){var C={};(g={}).DISPLAYLABEL=I18n.getValueForFields(h),C.DISPLAYVALUE=d[h],1==r&&a.push(g),o.push(C)}if("Account Name"===h){C={};(g={}).DISPLAYLABEL=I18n.getValueForFields(h,"Accounts"),C.DISPLAYVALUE=d[h],1==r&&a.push(g),o.push(C)}if("Contact Name"==h){var g;C={};(g={}).DISPLAYLABEL=I18n.getValueForFields(h,"Contact"),C.DISPLAYVALUE=d[h],1==r&&a.push(g),o.push(C)}}s.content=o,s.module=c.potentialmodule,s.entityId=c.potentialid,l.push(s)}if(t.body=l,t.heading=a,t&&"object"==typeof t&&Object.keys(t).length>0){i.html(Handlebars.templates.ctiapi_businesscard_multi_potential(t)).attr("content_exist","true");var y=$("#ctiapi_multi_potential_tablebody tr"),I=y.length;if($("#ctiapi_businesscard_potential_count").text(I18n.getMsg("crm.right.open.module",moduleRecordMapping.Potentials.plural_label+" ("+I+")")).attr("count",I),I>=50){var b=I-6;$(y.get(b)).attr({id:"last6",requested:!1,loaded:!1,range:1})}ctiApiNotifier.showHidePotentials()}}else ctiApiNotifier.showHidePotentials()},intermediateCallProcess:function(e){"error"===e.type?ctiApiNotifier.intermediateClick2CallErrorProcess(e):"connected"===e.type&&ctiApiNotifier.updateToConnectedStatus(e.callId)},intermediateClick2CallErrorProcess:function(e){e.popupclose=!e.popupclose||e.popupclose,validationUtils.isNotEmpty(e.callrefid)?ctiApiNotifier.new_closeNotificationPopUp(e):validationUtils.isNotEmpty(e.callId)&&ctiApiNotifier.new_closeNotificationPopUp_ByCallId(e)},processMakeCallResp:function(e){if("401"==e)CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.zti.error.notauthendication"));else if(null!=e&&"string"==typeof e&&-1!=e.indexOf("SELECT:::")){renderingUtils.freezeBackground(),e=e.split("SELECT:::")[1],$("#ztipopup_freezeContiner").html(e);var i=document.getElementById("ztipopup");i||(i=document.getElementsByName("ztipopup")[0]),i.className="",i.style.top="381px",i.style.position="absolute",i.style.zIndex="30",i.style.display="block",mailsetCenter("ztipopup"),window.onLoad=splitDialCode("0")}},showErrorStatus:function(e,i){var t=e.message;t=t?t.toLowerCase():t;var a=$("#callStatusAlertDiv");a.find(".msgBody").text("");var l=$("#telephonyErrorTitle");if(validationUtils.isNotEmpty(e.i18nErrorMsg))l.text(e.i18nErrorMsg);else{if(!validationUtils.isNotEmpty(e.i18nErrorHtml))return null!=t&&(t.indexOf("invalid_token")>-1||t.indexOf("emptytoken")>-1)?void ctiApiNotifier.openOAuthCtiApiType4(e.ctiname,e.vendor_client_id,e.oauthcodeurl,e.redirecturl,e.vendor_scope):void 0;l.html(e.i18nErrorHtml)}var n=a.attr("id");(renderingUtils.dummyBackground(!1,n),mailsetCenter(n),a.show(),i)?a.find(".callOk").off("click").click(ctiApiNotifier.closeErrorDivInAllTabs):a.find(".callOk").off("click").click(ctiApiNotifier.closeErrorDivInThisTab);return!1},closeErrorDivInThisTab:function(){return $("#callStatusAlertDiv").hide(),renderingUtils.removeDummyBackground(),renderingUtils.stopEvent(event),!1},closeErrorDivInAllTabs:function(){var e=CTIAPI.get("ctiname"),i=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={mode:"closecallstatusalert",logmsg:"Popup Close",ctiname:e};return networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({action:i,cache:!1,type:"POST",data:t,success:function(){commonUtils.showHideLoadingDiv()}}),$("#callStatusAlertDiv").hide(),renderingUtils.removeDummyBackground(),renderingUtils.stopEvent(event),!1},onPremiseCall:function(e,i){var t="",a="",l="",n="",r="",s="",o="",c=e.callaction;if("clicktocall"!=c){var d=null!=e.fromnumber?e.fromnumber:"";a=null!=e.tonumber?e.tonumber:"",l=null!=e.name?e.name:"",n=null!=e.value?e.value:"",r=null!=e.authtype?e.authtype:"",s=null!=e.otherparam?e.otherparam:"",o=(o=(o="tonumber="+a)+"&callrefid="+(null!=e.callrefid?e.callrefid:""))+"&fromnumber="+d,t=null!=e.callactionurl?e.callactionurl:""}else{o="tonumber="+(a=null!=e.custnumber?e.custnumber:"");var p=e.params;t=null!=p.click2callurl?p.click2callurl:"",n=null!=p.value?p.value:"",r=null!=p.authorizationtype?p.authorizationtype:"",l=null!=p.name?p.name:"",s=null!=p.otherparam?p.otherparam:""}if("keypress"==c&&(o=o+"&digit="+e.digit),""!=s)for(var u=s.length,m=0;m<u;m++){var f=s[m];o=o+"&"+f.name+"="+f.value}if(""!=r&&"param"==r&&""!=l&&""!=n)o=o+"&"+l+"="+n,(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:o,success:function(){ctiApiNotifier.onPremiseSuccess(c,i)},error:function(){ctiApiNotifier.onPremiseError(c,i)}});else if(""!=r&&"header"==r&&""!=l&&""!=n){var _={};_[l]=n,(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:o,headers:_,success:function(){ctiApiNotifier.onPremiseSuccess(c,i)},error:function(){ctiApiNotifier.onPremiseError(c,i)}})}else if(""==r||""==l||""==n){(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:o,success:function(){ctiApiNotifier.onPremiseSuccess(c,i)},error:function(){ctiApiNotifier.onPremiseError(c,i)}})}},onPremiseSuccess:function(e,i){var t=$("#ctiapi_dialpad_bt_"+e);"answer"==e?($("#ctiapi_inboundcall_answer_button").hide(),$("#intermediate_answer_process").show(),$("#ctiapi_present_callstate").text(I18n.getMsg("crm.tpi.ctiapi.type4.answerprocess"))):"hungup"==e?($("#intermediate_hungup_process").show(),$("#ctiapi_dialpad,#ctiapi_call_endcall_button").hide(),$("#ctiapi_present_callstate").text(I18n.getMsg("crm.tpi.ctiapi.type4.hungupprocess"))):e.indexOf("un")<0?t.addClass("active"):0==e.indexOf("un")?(t=$("#ctiapi_dialpad_bt_"+e.replace("un",""))).removeClass("active"):"clicktocall"==e&&ctiApiNotifier.updateToConnectedStatus(i)},onPremiseError:function(e,i){if("clicktocall"==e){var t={};t.i18nErrorMsg=I18n.getMsg("crm.telephony.unable.tocall"),ctiApiNotifier.closeNotify(null,i,t)}},openOAuthCtiApiType4:function(e,i,t,a,l){$("#callStatusAlertDiv,.freezeLayer").hide(),$("html").css("overflow","auto"),renderingUtils.removeDummyBackground(),t=t+"?client_id="+i+"&redirect_uri="+a+"&response_type=code&state="+Crm.userDetails.ZGID,null!=l&&""!=l&&(t=t+"&scope="+l),window.open(t,"_blank","toolbar=yes, scrollbars=yes, resizable=yes, top=250, left=500, width=400, height=400")},notifyCrmPlus:function(e){if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame){var i=$("#callrefid").val(),t=$("#call_ctinumber").val();if(validationUtils.isNotEmpty(i)&&i!=CTIAPI.get(e)){var a={servicename:"crm",type:"phone",callrefid:i,info:{label:"Unknown",values:{contactname:"",phone:t}}};$("#ctiapi_known_caller").val()&&(t=$("#Ctiapi_entityName").val(),a.info.label=$("#Ctiapi_entityModule").val(),a.info.values.contactname=t),{received:function(){a.header=I18n.getMsg("crm.tpi.crmplus.notify.received",t),a.subtype="incoming"},answered:function(){a.header=I18n.getMsg("crm.tpi.crmplus.notify.answered",t),a.subtype="answered"},ended:function(){a.subtype="ended"}}[e]();var l=[a];CrmPlusImpl.trigger("pushNotification",l),CTIAPI.put(e,i)}}},callPopupFreezeLayer:function(){$("#pb_freezeLayer").addClass("op0").show()},callPopupDefreezeLayer:function(){$("#pb_freezeLayer").removeClass("op0").off("click").hide()},showFollowUpCreate:function(){"callhungup"===CTIAPI.get("callState")&&($("#ctiapi_folloup_create").show(),$("#ctiapi_save_bt, #ctiapi_cancel_bt").removeClass("mT20"))},updateStatusInCrmPlus:function(e){if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame){var i=[{servicename:"crm",type:"phone",subtype:"updatestatus",has_access:!0,provider:CTIAPI.CTI.ctiname,currentstatus:e}];CrmPlusImpl.trigger("updatePhoneAgentStatus",i)}},showLoginPopupInCrmPlus:function(){if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame){var e=[{type:"message",subtype:"showphoneloginpopup"}];CrmPlusImpl.trigger("pushNotification",e)}},logMessage:function(e,i){var t=Crm.getCrmBasePath()+"/TwilioLogger.do",a={message:e,param:i};networkUtils.setCsrfParam(a),(new crmRequestPool).doAjax(t,(function(){}),a)},startWaiting:function(){ctiApiNotifier.endWaiting(),callNotificationDetails.waitingTimer=setTimeout((function(){ctiApiNotifier.checkAndClosePopup()}),6e4)},endWaiting:function(){""!=callNotificationDetails.waitingTimer&&(clearTimeout(callNotificationDetails.waitingTimer),callNotificationDetails.waitingTimer="")},checkAndClosePopup:function(){var e=$("#ctinotifier"),i=$("#ctiapi_present_callstate").text().trim(),t=$("#callId").val(),a=parseInt(t),l=Date.now();"true"===e.attr("is")&&a&&a<=l-55e3&&i===I18n.getMsg("crm.tpi.ctiapi.connected").trim()&&ctiApiNotifier.closeNotify(null,t)},updateToConnectedStatus:function(e){var i=$("#ctinotifier"),t=$("#ctiapi_present_callstate");"true"===i.attr("is")&&e===$("#callId").val()&&t.text().trim()===I18n.getMsg("crm.tpi.ctiapi.connecting").trim()&&(t.text(I18n.getMsg("crm.tpi.ctiapi.connected")),ctiApiNotifier.startWaiting())},isCurrentCallBoxMessage:function(e){var i=!1;if(e.callrefid&&e.callrefid===$("#callrefid").val())i=!0;else if(e.callId&&e.callId===$("#callId").val())i=!0;else if(e.custnumber&&ctiApiNotifier.checkSameNumbers(e.custnumber+"",$("#call_custnumber").val()+"")){var t=$("#call_type").val();i=!e.calltype||!validationUtils.isNotEmpty(t)||e.calltype===t}return i},checkSameNumbers:function(e,i){var t=!1;if(e=e.replace(/[^a-zA-Z0-9]/g,""),i=i.replace(/[^a-zA-Z0-9]/g,""),e.startsWith("0")&&(e=e.substr(1)),i.startsWith("0")&&(i=i.substr(1)),i.length>e.length){var a=i;i=e,e=a}return(e.endsWith(i)||i.length>=9&&e.includes(i.startsWith("1")?i.substr(1):i))&&(t=!0),t},saveCallEntity:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i=$("#ctinotifier"),t=(i.find("#ctiapi_calldesc_div"),i.find("#callrefid").val()),a=i.find("#callId").val(),l=i.find("#c2cFormParamPresent").val(),n=i.find("#remindercallactivityid").val(),r=i.find("#popupFrom").val(),s=i.find("#Ctiapi_entityId").val(),o=(i.find("#Ctiapi_entityModule").val(),i.find("#Ctiapi_entityName").val(),i.find("#ctiapi_calldesc")),c=o.length>0,d=o.val(),p=null,u=null,m="POST",f={},_=null;if("quickCreate"===r&&l){u=JSON.parse(l);var v=i.find("#ctiapi_calltimer_min").text(),h=i.find("#ctiapi_calltimer_sec").text();return u.Call_Duration=v+":"+h,c&&(u.Description=d),i.find("#ctiapi_close_bt_div").find("input").attr("disabled",!0),void(store.model[moduleRecordMapping.Calls.id]?ctiApiNotifier.createCallRecord(u,t,a,s,r):store.findRecord("module",moduleRecordMapping.Calls.id).then((function(){ctiApiNotifier.createCallRecord(u,t,a,s,r)})))}if(validationUtils.isNotEmpty(n))if(e){u={};_={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},clientPortalName&&(_["X-CRMPORTAL"]=window.clientPortalName),p="/crm/v2/Calls/"+n+"?affected_data=true";var C={};m="PUT",C.Description=c?d:"",f.data=[C]}else ctiApiNotifier.closeNotify(t,validationUtils.isNotEmpty(t)?null:a),"quickCreate"!=r&&ctiApiNotifier.onPopupCloseByUser();else e&&(p=Crm.getCrmBasePath()+"/CtiApiConfig.do",u={mode:"createcaid",callrefid:t,type:e?1:2,desc:d,autosave:!1});if(p)i.find("#ctiapi_close_bt_div").find("input").attr("disabled",!0),commonUtils.showHideLoadingDiv(),u&&networkUtils.setCsrfParam(u),"PUT"===m&&(u=JSON.stringify(f)),(new crmRequestPool).initiate({url:p,type:m,data:u,headers:_,success:function(e){ctiApiNotifier.successCallback(e,t,a,s,r)},error:function(){$("#ctinotifier").find("#ctiapi_close_bt_div").find("input").attr("disabled",!1)}})}},successCallback:function(e,i,t,a,l){if(commonUtils.showHideLoadingDiv(),ctiApiNotifier.closeNotify(i,validationUtils.isNotEmpty(i)?null:t),"quickCreate"!==l&&ctiApiNotifier.onPopupCloseByUser(),void 0!==SourceIdentifier){SourceIdentifier.checkCurrentPageAndRefresh("Calls");var n=$("#Ctiapi_relatedEntityId").val();a&&SourceIdentifier.checkDetailPageAndRefreshRelatedList(a,e.module),n&&SourceIdentifier.checkDetailPageAndRefreshRelatedList(n,e.module)}},createCallRecord:function(e,i,t,a,l){var n=store.createRecord(moduleRecordMapping.Calls.id,e,!0);for(var r in n)n.$.model.fieldList[r]&&"multi-picklist"==n.$.model.fieldList[r].type&&n[r]&&"string"!=typeof n[r]&&(n[r]=JSON.stringify(n[r]));n.$.isError?($("#ctinotifier").find("#ctiapi_close_bt_div").find("input").attr("disabled",!1),renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"))):n.$.save(void 0,void 0,{validateOnSave:!0}).then((function(){ctiApiNotifier.successCallback({module:"Calls"},i,t,a,l)}),(function(){$("#ctinotifier").find("#ctiapi_close_bt_div").find("input").attr("disabled",!1),renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"))}))},onPopupCloseByUser:function(){"twilio"===CTIAPI.CTI.ctiname&&twilioNotifier.dequeueCallsorSetAvailable()},bindListeners:function(){$("#PhoneNumberDiv").bind("convertedFromPhone",(function(e,i,t,a){var l=$("#ctinotifier"),n=l.find("#c2cFormParamPresent"),r=n.val();l.find("#Ctiapi_entityId").val(i),l.find("#Ctiapi_entityModule").val(t),l.find("#Ctiapi_entityName").val(a),l.find("#ctiapi_known_caller").val("true"),l.find("#ctiapi_close_bt_div").is(":visible")&&l.find("#ctiapi_folloup_create").show();var s=document.getElementsByTagName("crm-call-popup-menu")[0];if(s&&s.setData("isKnownNumber",!0),r){reqParams=JSON.parse(r),"Contacts"===t?reqParams.Who_Id={id:i,name:a}:(reqParams.What_Id={id:i,name:a},reqParams.$se_module=t);var o=JSON.stringify(reqParams);n.val(o)}}))},getCallRefIdForPhoneNo:function(e){var i=$("#ctinotifier");if("true"===i.attr("is")&&i.find(".phoneNo_"+e).length&&validationUtils.isEmpty($("#remindercallactivityid").val()))return i.find("#callrefid").val()},doneFollowUpCall:function(){var e={operation:"create",module:"Calls","property(module)":"Calls"},i=$("#followUpCallFields");if(crmCallsNew.validateEntityAndShowErrorMsg(i,e,null,"PBCalls",["Crm_PBCalls_CONTACTID","Crm_PBCalls_CONTACTID_select","Crm_PBCalls_SEID","Crm_PBCalls_SEID_select","Crm_PBCalls_SMOWNERID"])){var t=i.find("#Crm_Calls_CALLSTARTDATETIME").val(),a=i.find("#Crm_Calls_CALLSTARTDATETIME_TimeOption").val();$("#createFollowUpCallParameters").val(JSON.stringify(e)),$("#callpopup").show(),$("#followUpCallHeader").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Call"))),$("#ctiapi_folloup_call_list,#removeCalls_link").show(),$("#ctiapi_folloup_call_create_lnk").hide(),$("#ctiapi_folloup_call_list_subject").text(t+" "+a),$("#is_call_created").val("true").trigger("change"),$("#removeCalls_link").show(),ctiApiNotifier.decideShowHide_ActivitysCreateLink(),ctiApiNotifier.add_remove_cancelCalls_CallBack()}return!1},hideMultiPotentialTable:function(e){0!=(e=$L(e)).scrollTop&&($("#ctiapi_businesscard_potential").hide(),$("#ctiapi_businesscard_table").css("visibility","visible").show(),$("#ctiapi_businesscard_potential_arrow,#ctiapi_businesscard_potential_link").removeClass("active"),CTIAPI.put("potentialView",!1))},openCallFieldsFrame:function(){var e=$("#ctinotifier"),i=e.find("#call_type").val(),t=e.find("#callrefid").val(),a=e.find("#callId").val(),l=t||a;if(l){var n,r={route:"crm.tab.module.modal-create",dynamicParams:["Calls"],queryParams:{headless:"true",listenData:"true",formName:"PBPoup_Form",callbackcode:l}};if("Inbound"===i||"inbound"===i)n=Crm.getCrmBasePath()+"/tab/Calls/modal-create?headless=true&listenData=true&callType=Inbound&formName=PBPoup_Form&callbackcode="+l,r.queryParams.callType="Inbound";else{if("Outbound"!==i&&"outbound"!==i)return;n=Crm.getCrmBasePath()+"/tab/Calls/modal-create?headless=true&listenData=true&callType=Outbound&callStatus=Completed&formName=PBPoup_Form&callbackcode="+l,r.queryParams.callType="Outbound",r.queryParams.callStatus="Completed"}WindowsCommunicator.switchRouterInstance(n,"headless","callnotifypopup",r)}},reopenCallFieldsFrame:function(){var e=$("#ctinotifier"),i=e.find("#callrefid").val(),t=e.find("#callId").val(),a=!1;validationUtils.isNotEmpty(i)&&(a=WindowsCommunicator.reopenChildWindow("callfieldspopup_"+i)),!a&&validationUtils.isNotEmpty(t)&&(a=WindowsCommunicator.reopenChildWindow("callfieldspopup_"+t))},saveCallFieldsParamFromFrame:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val();if(!i.is(":visible")||t!==e.callbackcode&&a!==e.callbackcode){if(validationUtils.isNotEmpty(e.callbackcode)){var l=JSON.stringify(e.Details.createParameters),n=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={mode:"createcaid",callrefid:e.callbackcode,type:1,desc:"",autosave:!1,callOutcomeFields:l};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({url:n,type:"POST",data:r,success:function(){}})}}else i.find("#ctiapi_display_call_fields").text(I18n.getMsg("View Call Details")).prop("onclick",null).click(ctiApiNotifier.reopenCallFieldsFrame),i.find("#ctiapi_edit_call_fields").show(),clienttab.showAlertBeforeUnload=!0,WindowsCommunicator.notifyOtherTabs("call-popup-update-callfields-data",e)},handleFieldsCollectorError:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val();if(i.is(":visible")&&(t===e.callbackcode||a===e.callbackcode)){var l=i.find("#ctiapi_display_call_fields");l.text()===I18n.getMsg("Add Call Details")&&l.remove(),WindowsCommunicator.notifyOtherTabs("call-popup-remove-callfields-link",e.callbackcode),("No_Fields"===e.Details||"No_Permission"===e.Details)&&renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"))}},removeCallFieldslink:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val(),l=i.find("#ctiapi_display_call_fields");!i.is(":visible")||t!==e&&a!==e||l.text()!==I18n.getMsg("Add Call Details")||l.remove()},updateCallFieldsData:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val();if(i.is(":visible")&&(t===e.callbackcode||a===e.callbackcode)){var l=i.find("#ctiapi_display_call_fields");i.find("#duringCallFieldsCreateParameters").val(JSON.stringify(e.Details.createParameters)),i.find("#duringCallFieldsUpdateParameters").val(JSON.stringify(e.Details.updateParameters)),l.text(I18n.getMsg("Add Call Details")).prop("onclick",null).click(ctiApiNotifier.openCallFieldsFrame),WindowsCommunicator.closeAllChildWindows("callnotifypopup")}},createFollowUp:function(e,i,t,a){i=i||"",t=t||"",a=a||"";var l=$("#ctinotifier"),n=l.find("#callrefid").val(),r=l.find("#callId").val(),s=n||r,o={call:Crm.getCrmBasePath()+"/tab/Calls/quick-create?headless=true&sub_module=Calls&entityid="+i+"&entitymodule="+t+"&entityname="+a+"&callbackcode="+s,event:Crm.getCrmBasePath()+"/tab/Events/quick-create?headless=true&sub_module=Events&entityid="+i+"&entitymodule="+t+"&entityname="+a+"&callbackcode="+s,task:Crm.getCrmBasePath()+"/tab/Tasks/quick-create?headless=true&sub_module=Tasks&entityid="+i+"&entitymodule="+t+"&entityname="+a+"&callbackcode="+s},c={call:"Calls",event:"Events",task:"Tasks"},d={route:"crm.tab.module.quick-create",dynamicParams:[c[e]],queryParams:{headless:"true",sub_module:c[e],entityid:i,entitymodule:t,entityname:a,callbackcode:s}};if(e){var p=o[e];WindowsCommunicator.switchRouterInstance(p,"headless","callnotifypopup",d)}},followupListner:function(e,i){if(e&&"success"===e.message){var t=$("#ctinotifier"),a=$("#callrefid").val(),l=$("#callId").val();if(t.is(":visible")&&(a===e.callbackcode||l===e.callbackcode)){var n=ctiApiNotifier.followupModules[e.Details.module];if(n){var r=$("#ctiapi_folloup_"+n+"_list_subject");$("#ctiapi_folloup_"+n+"_list").show(),r.text(e.Details.recordname),$("#ctiapi_folloup_"+n+"_create_lnk").remove(),e.Details.recordurl&&r.attr("href",e.Details.recordurl),ctiApiNotifier.followUpData[e.callbackcode]?ctiApiNotifier.followUpData[e.callbackcode].push(e):ctiApiNotifier.followUpData[e.callbackcode]=Array(e)}return 0===$(".callPopupfollowActivity").length&&$("#ctiapi_folloup_create").hide(),i&&this.notifyToOtherTabs(e,"followup"),n}}},followUpData:{},followupModules:{Calls:"call",Events:"event",Tasks:"task"},getCallBackparam:function(){var e=$("#ctinotifier").find("#c2cFormParamPresent");return e.val()?JSON.parse(e.val()):{}},setCallBackParam:function(e){var i=$("#ctinotifier"),t="object"==typeof e?JSON.stringify(e):e;i.find("#c2cFormParamPresent").val(t)},setFollowUpData:function(e,i){var t=e[i];if(t)for(var a=t.length,l=0;l<a;l++)ctiApiNotifier.followupListner(t[l])},setCallPopupData:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val();t!==e.id&&a!==e.id||(i.attr("is","true").show(),ctiApiNotifier.setCallBackParam(e.callBackParam),e.followUpData&&ctiApiNotifier.setFollowUpData(e.followUpData,e.id),e.durationData&&e.durationData.min&&e.durationData.sec&&($("#ctiapi_calltimer_min").text(e.durationData.min),$("#ctiapi_calltimer_sec").text(e.durationData.sec),e.durationData.Minute&&(CTIAPI.CallTimer.Minute=e.durationData.Minute),e.durationData.Second&&(CTIAPI.CallTimer.Second=e.durationData.Second),e.durationData.callStartedTimeInMilliSeconds&&(CTIAPI.CallTimer.callStartedTimeInMilliSeconds=e.durationData.callStartedTimeInMilliSeconds),e.durationData.callPausedTimeInMilliSeconds&&(CTIAPI.CallTimer.callPausedTimeInMilliSeconds=e.durationData.callPausedTimeInMilliSeconds)))},updateCallBackparam:function(e,i){var t=$("#ctinotifier"),a=t.find("#callrefid").val(),l=t.find("#callId").val(),n=t.find("#popupFrom").val(),r=t.find("#c2cFormParamPresent");if(e?("quickCreate"!=n||e.Call_Start_Time||(e.Call_Start_Time=JSON.parse(r.val()).Call_Start_Time),e=JSON.stringify(e)):e=r.val(),(a||l)&&e){var s=Crm.getCrmBasePath()+"/CtiApiConfig.do?mode=updateCallBackParam",o={callRefId:a,callBackParam:e,callId:l,callSource:n};networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({action:s,cache:!1,type:"POST",data:o,success:function(n){"object"==typeof n&&"success"===n.status?!t.is(":visible")||a!==i&&l!==i||r.val(e):renderingUtils.showCustomAlert(I18n.getMsg("crm.errorpage.note1"))}})}},notifyCallPopup:function(e){var i=$("#ctinotifier"),t=i.find("#callrefid").val(),a=i.find("#callId").val(),l=i.is(":visible")&&(e.callRefId===t||"quickCreate"===e.callSource&&e.callId===a);if("updateCallBackParam"===e.action){var n="object"==typeof e.callBackParam?JSON.stringify(e.callBackParam):e.callBackParam;n&&l&&i.find("#c2cFormParamPresent").val(n)}else if("notifyToOtherTabs"===e.action){var r=e.notifyData;r&&"followup"===r.action&&this.followupListner(r.data)}},notifyToOtherTabs:function(e,i){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do?mode=notifyToOtherTabs",a={notifyData:JSON.stringify({data:e,action:i})};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:a})},getPopup:function(e){var i=$("#Ctiapi_entityId").val(),t=$("#Ctiapi_entityModule").val(),a=$("#call_custnumber").val(),l={mode:"callFromQC",callState:e,recordId:i,recModule:t,customerNo:a};networkUtils.setCsrfParam(l),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:l,success:function(i){ctiApiNotifier.ctiApiNotification(i),"callhungup"===e&&qCreateCall.updateCallDuration()}});var n=localStorage.getObject("crm-presentCallDetails");if(n){var r=e;if("callhungup"===e){var s=(new Date).getTime()-CTIAPI.CallTimer.callStartedTimeInMilliSeconds;s/=1e3,r=r+"_"+(s=Math.floor(s))}n.qcStatus=r,localStorage.setObject("crm-presentCallDetails",n)}}};!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).ctiapi_reminder_businesscard=e({1:function(e,i,t,a,l){return' <div class="br_top_border4 p20 profileCont"> '},3:function(e,i,t,a,l){var n;return' <div class="p15 pT20 pB20 bussinesCardCtn '+(null!=(n=t.if.call(null!=i?i:{},null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(4,l,0),inverse:e.noop,data:l}))?n:"")+'" > '},4:function(e,i,t,a,l){return" zchat-zcmsg_bx zchat-zcmsg_bx10"},6:function(e,i,t,a,l){return" <div> "},8:function(e,i,t,a,l){return' <div class="fL"> '},10:function(e,i,t,a,l){var n;return" "+(null!=(n=t.isNotEmpty.call(null!=i?i:{},null!=i?i.extradetails:i,{name:"isNotEmpty",hash:{},fn:e.program(11,l,0),inverse:e.noop,data:l}))?n:"")+" "},11:function(e,i,t,a,l){return" "+e.escapeExpression(t.ctiapi_businesscard_entityextradetails_forchat.call(null!=i?i:{},null!=i?i.entitymodule:i,null!=i?i.extraid:i,null!=i?i.extramodule:i,null!=i?i.extradetails:i,{name:"ctiapi_businesscard_entityextradetails_forchat",hash:{},data:l}))+" "},13:function(e,i,t,a,l){return' <div class="cBoth"></div> </div> '},15:function(e,i,t,a,l){var n;return' <div> <a href="javascript;;" class="color_79"> '+(null!=(n=t.isNotEmpty.call(null!=i?i:{},null!=i?i.extradetails:i,{name:"isNotEmpty",hash:{},fn:e.program(16,l,0),inverse:e.noop,data:l}))?n:"")+" </a> </div> "},16:function(e,i,t,a,l){return" "+e.escapeExpression(t.ctiapi_businesscard_entityextradetails.call(null!=i?i:{},null!=i?i.entitymodule:i,null!=i?i.extraid:i,null!=i?i.extramodule:i,null!=i?i.extradetails:i,{name:"ctiapi_businesscard_entityextradetails",hash:{},data:l}))+" "},18:function(e,i,t,a,l){return" </div> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression,o=e.lambda;return" "+(null!=(n=t.if.call(r,null!=i?i.lower_reminder:i,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l}))?n:"")+" "+(null!=(n=t.if.call(r,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l}))?n:"")+" "+s(t.ctiapi_businesscard_entityimage.call(r,null!=i?i.entitymodule:i,null!=i?i.entityid:i,null!=i?i.photofileid:i,null!=i?i.isForChat:i,{name:"ctiapi_businesscard_entityimage",hash:{},data:l}))+" "+(null!=(n=t.unless.call(r,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(8,l,0),inverse:e.noop,data:l}))?n:"")+' <div class="fL zchat-btncnt"> <a href="javascript:void(0);" class="crm-heading-font-size crmBaseColor ellipsistext dB w250" id="ctiapi_businesscard_entityname" onclick="CTIAPI.openUrl(\''+s(o(null!=i?i.entityid:i,i))+"','"+s(o(null!=i?i.entitymodule:i,i))+"','','','','_blank');\" title=\""+s(t.encodeForHtmlWithoutNull.call(r,null!=i?i.entityname:i,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))+'"> '+s(t.encodeForHtmlWithoutNull.call(r,null!=i?i.entityname:i,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))+" </a> "+(null!=(n=t.if.call(r,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(10,l,0),inverse:e.noop,data:l}))?n:"")+" </div> "+(null!=(n=t.if.call(r,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(13,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.unless.call(r,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(15,l,0),inverse:e.noop,data:l}))?n:"")+" "+s(t.ctiapi_businesscard_create.call(r,i,{name:"ctiapi_businesscard_create",hash:{},data:l}))+" "+(null!=(n=t.unless.call(r,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(18,l,0),inverse:e.noop,data:l}))?n:"")+' <br class="cBoth"> </div>'},useData:!0})}();var CallReminder={cti_obj:{},get:CTIAPI.get,put:CTIAPI.put,remove:CTIAPI.remove,has:CTIAPI.has,keys:CTIAPI.keys,set obj(e){for(var i in e)this.put(i,e[i])},handleCustomMessage:function(e){var i=e;if("laterReminder"===i.action){if(!0!==CallReminder.get("laterBtClickThisWindow")){var t=i.activityid,a=ctiapiRem_dataparam["dataparam_"+t];void 0!==a&&appendReminder(a,$("#later_"+t),!0)}CallReminder.put("laterBtClickThisWindow",!1)}else if("cancelReminder"===i.action){t=i.activityid;closeReminder($("#endcall_"+t)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):updateReminderHead()}},later:function(e,i){if(i){CallReminder.put("laterBtClickThisWindow",!0);var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"laterReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},call:function(e){if(void 0!==ctiapiRem_dataparam["dataparam_"+e]){var i=ctiapiRem_dataparam["dataparam_"+e].call_description;i=validationUtils.isNotEmpty(i)?i:"",$("#ctiapi_calldesc").val(i),CTIAPI.LocalStorage.put("call_desc",i),removeReminder(e),closeReminder($("#later_"+e)),closeMultipleReminderBussinesscardView(),$(".reminderslist div[ctiapi-data-params=dataparam_"+e+"]").remove()}},cancel:function(e,i){if(i){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"cancelReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},getEntityImgSrc:function(e){var i=e.entitymodule,t=e.entityid,a=e.photofileid,l=networkUtils.getImageUrl("user.jpg",ResourceConstants.CRM);return i!==moduleRecordMapping.Accounts.plural_label&&validationUtils.isNotEmpty(a)&&(l=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+i+"&entityId="+t+"&actionName=readImage&fileId="+a),l},ctiapi_showReminderClick2CallPhnos:function(e,i,t){var a=validationUtils.isNotEmpty(t)?$("#"+t):$(e).closest("#businessView"),l=a.height(),n=a.offset().top,r=renderingUtils.windowHeight,s=$(a).find("#entityPhnoDiv_"+i),o=s.innerHeight();if(s.toggle(),r>l+n+o)a.hasClass("bot150")?s.css("top",l+2*$(e).height()-59):s.css("top",l+2*$(e).height()-9);else if(validationUtils.isNotEmpty(t))s.css("top",l-2*$(e).height()-o+2);else{$(e).closest("#ctireminder").length>0?s.css("top",l-o-$(e).innerHeight()/2+10):s.css("top",l-o+8)}},scrollReminderBody:function(){var e=$("#ctiapi_multireminder_bussinessview_arrow"),i=$(".reminderusers.selectedReminderUser");if(i.length>0){var t=e.attr("selectedreminderoldposition");t=NaN!==parseInt(t)?parseInt(t):0;var a=i.position().top;t-34<=a&&a<=t+34||i.click()}},deleteReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1),reminderDatatemp.reminders.deleteRemindersList.push(i),ctiapiSche.deleteReminderId(e)},getSelectedReminder:function(e){var i=$(e),t=i.position().top,a=$("#ctiapi_multireminder_bussinessview"),l=$L(".remindercallList.reminderslist");if(t<0){var n=l.scrollTop()+t;l.scrollTop(n),t=0}else if(t>270){var r=335-t,s=i.innerHeight()-r;n=l.scrollTop()+s;l.scrollTop(n),t=270}if(t<=68?$(".remindercallList").find(".reminderusers").length<=3?a.removeClass("bot150"):a.addClass("bot150"):t>68&&t<126?a.addClass("bot150"):a.removeClass("bot150"),i.hasClass("chooseOwnerHov"))closeMultipleReminderBussinesscardView();else{var o=ctiapiRem_dataparam[i.attr("ctiapi-data-params")],c=o.zgid,d=o.userid,p=o.phone,u=o.entityid,m=o.entitymodule,f=o.recordEntityName,_=o.reminderClick2CallPhoneNos,v=o.reminderPhno;o.lower_reminder=!0;var h=o.callactivityid+"",C=getremindertime([h]),g=validationUtils.isNotEmpty(setMoreLater(C,!1))?setMoreLater(C,!1):setMoreLater(0,!1),y=validationUtils.isNotEmpty(setMoreLater(C,!0))?setMoreLater(C,!0):setMoreLater(0,!0),I=C<-6e4?"color:var(--negativeColor)":"color:#66bb33",b="";for(var w in $("#tof_"+h).html(g).attr("title",y).css(I),$(".reminderTime_Msg_"+h).html(y).css(I),Crm.userDetails.RTL_ENABLED?b+='<div style="left : -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>':b+='<div style="right: -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>',b+='<div class="crm-heading-font-size p10 pL15 pR15 reminderTime_Msg_'+h+'" style="'+I+'">'+y+"</div>",b+=Handlebars.templates.ctiapi_reminder_businesscard(o),b+='<div class="newPopup zi100" id="entityPhnoDiv_'+h+'" style="display: none;margin-left: 10px" onclick="sE(event);">',b+='<div class="pR">',b+='<div class="multipleNos">',b+='<table cellpadding="5" cellspacing="0" border="0"><tbody>',_){var A=_[w];validationUtils.isNotEmpty(A)&&(b+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='pointer' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(A)+"','"+c+"','"+d+"','"+u+"','"+h+"','"+m+"','"+$ESAPI.encoder().encodeForJavaScript(f)+"');closeReminder(this);\">",b+='<td class="crmLabelColor pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(w))+" </td>",b+='<td class="crmBaseColor pR20">'+CTIAPI.encodeForHTMLWithoutNull(A)+"</td>",b+="</tr>")}b+="</tbody></table>",b+="</div>",b+="</div>",b+="</div>",b+='<div class="br_top_border4 p15 oH">',!0===CallReminder.get("outgoingEnable")&&parseInt(o.timeOfReminder)<=6e4&&(v.length<=1?(b+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+h+'" style="height:auto" >',b+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(p)+"','"+c+"','"+d+"','"+u+"','"+h+"','"+m+"','"+$ESAPI.encoder().encodeForJavaScript(f)+"');\" >"+I18n.getMsg("Call")+"</span> ",b+="</a>"):(b+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+h+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+h+"','ctiapi_multireminder_bussinessview');sE(event);\">",b+='<span class="fL">'+I18n.getMsg("Call")+"</span> ",b+='<i class="whtdownArw fL"></i>',b+="</a>")),b+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal" id="endcall" onclick="closeMultipleReminderBussinesscardView();">'+I18n.getMsg("crm.button.mass.hide")+"</span>",b+='<span class="actSelArw" data-zcqa="callMoreOption" tabindex="0" id="arrow_'+h+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+d+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>',b+="</div>";var P=$(".remindercallList").innerHeight()-t,N=i.innerHeight()/2;a.html(b).show(),crmui.modalZIndex("nonLyte",a[0],"open","noFreeze"),$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),i.addClass("chooseOwnerHov selectedReminderUser"),a.hasClass("bot150")?$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",P+N-201).attr("selectedreminderoldposition",t).show():$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",P+N-75).attr("selectedreminderoldposition",t).show()}}};Object.freeze(CallReminder);var ctiapiRem_dataparam={getTime:function(e){if(void 0!==e&&""!==e){var i=this["dataparam_"+e];return parseInt(i.timeOfReminder)+parseInt(i.date)}}},reminderDatatemp={reminders:{availableReminders:0,noOfReminders:0,timesOfReminders:[],deleteRemindersList:[],deletedRemindersIDList:[],reminderIdNameMap:{}},removeReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&void 0!==i&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1,reminderDatatemp.reminders.deletedRemindersIDList.push(e+""),reminderDatatemp.reminders.deleteRemindersList.push(i),delete reminderDatatemp.reminders.reminderIdNameMap[e],ctiapiSche.deleteReminderId(e)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):$("#reminderbody").is(":hidden")||$("#ICPOP1 #reminderTitle").click(),updateReminderHead()}},ctiapiSche={reminderIds:{},timeInterval:6e4,serverTimeInterval:9e5,clientScheId:null,serverScheId:null,clientScheLastRunTime:null,serverScheLastRunTime:null,clientScheStartTime:null,serverScheStartTime:null,scheStartDelaySec:0,start:function(e){var i=new Date;if(this.scheStartDelaySec=60-i.getSeconds(),this.scheStartDelaySec<2||this.scheStartDelaySec>58)null===this.clientScheId&&Object.keys(this.reminderIds).length>0?((e=e||updateRemindersTime)(),this.clientScheId=setInterval(e,this.timeInterval),this.clientScheStartTime=i,this.serverScheId=setInterval((function(){updateRemindersTimesFromServer(Object.keys(ctiapiSche.reminderIds))}),this.serverTimeInterval),this.serverScheStartTime=i,this.scheStartDelaySec=0):this.stop()&&Object.keys(this.reminderIds).length>0&&this.start();else{var t=this.scheStartDelaySec||0;setTimeout((function(){ctiapiSche.start(e)}),1e3*t)}},stop:function(){return null!==this.clientScheId&&(clearInterval(this.clientScheId),clearInterval(this.serverScheId),this.serverScheId=null,this.clientScheId=null,!0)},deleteReminderId:function(e){delete this.reminderIds[e+""],0===Object.keys(this.reminderIds).length&&this.stop()},appendReminderId:function(e){this.reminderIds[e+""]=e+"",null===this.clientScheId&&this.start(updateRemindersTime)},log:function(){var e={client:this.clientScheId,server:this.serverScheId},i={client:this.clientScheStartTime+"",server:this.serverScheStartTime+""},t={client:this.clientScheLastRunTime+"",server:this.serverScheLastRunTime+""},a="reminderIds : "+Object.keys(this.reminderIds)+" \n scheStartDelaySec : "+this.scheStartDelaySec+" \n ";return a+="scheId : "+JSON.stringify(e)+"\n ",a+="startTime : "+JSON.stringify(i)+"\n ",a+="lastRunTime : "+JSON.stringify(t)}};function closeMultipleReminderBussinesscardView(){$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),$("#ctiapi_multireminder_bussinessview_arrow").hide(),$("#ctiapi_multireminder_bussinessview").hide(),crmui.modalZIndex("nonLyte",$L("#ctiapi_multireminder_bussinessview")[0],"close")}function createReminder1(e,i){var t="",a="",l=e,n=l.zgid,r=l.userid,s=l.entityid,o=l.entitymodule,c=l.recordEntityName,d=l.callactivityid+"",p=l.reminderClick2CallPhoneNos;CallReminder.put("outgoingEnable",l.outgoingenabled);var u=new Array;if(l.toNumberOfCall)u.push(l.toNumberOfCall);else for(var m in p){var f=p[m];validationUtils.isNotEmpty(f)&&u.push(f)}l.reminderPhno=u,ctiapiRem_dataparam["dataparam_"+d]=l,ctiapiSche.appendReminderId(d);var _=getremindertime(d),v=_<-6e4?"color:var(--negativeColor)":"color:#66bb33",h=validationUtils.isNotEmpty(setMoreLater(_,!0))?setMoreLater(_,!0):setMoreLater(0,!0);i?(t+='<div class="singlereminder " id="ICPOP2" style=" position:absolute;margin:0 auto;z-index:25;top:24%;left:42%">',a+='<div class="chatPopTitle oH cDefault"> ',a+='<table cellspacing="0" cellpadding="0" border="0" width="100%" class="pT10 pB10" style="height:auto">',a+="<tr>",a+='<td class="aligncenter crm-heading-font-size">',a+='<span class="reminderTime_Msg_'+d+'" style="'+v+'">'+h+"</span>",a+="</td>",a+="</tr>",a+="</table>",t+=a+="</div>",t+='<div id="businessView" class="chatContainer">',l.lower_reminder=!1):(t+='<div id="ICPOP2" style="z-index:25;width:370px;">',t+='<div class="chatPopTitle oH" onclick="toggleSingleReminder(\''+d+"')\">",t+='<div class="pT10 pB10 oH">',t+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL crm-base-font-size">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify crm-small-font-size mL5">1</span></span>',t+="</div>",t+="</div>",t+='<div id="businessView" class="chatContainer">',t+='<div class="crm-heading-font-size p10 pL15 pR15 reminderTime_Msg_'+d+'" style="'+v+'">'+h+"</div>",l.lower_reminder=!0),t+=Handlebars.templates.ctiapi_reminder_businesscard(l);d=l.callactivityid+"";t+='<div class="br_top_border4 p15"><div class="dIB w100_per">';e.protocolDetails&&e.protocolDetails.ctiprotocolvalue;for(var m in!0===CallReminder.get("outgoingEnable")&&parseInt(l.timeOfReminder)<=6e4&&u.length>0?(1===u.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+d+'" style="height:auto" >',t+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(u[0])+"','"+n+"','"+r+"','"+s+"','"+d+"','"+o+"','"+$ESAPI.encoder().encodeForJavaScript(c)+"');closeReminder(this);\" >"+I18n.getMsg("Call")+"</span> ",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+d+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+d+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+d+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+d+",this,"+i+");CallReminder.later('"+d+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose mT2"><span class="actVal p5" id="endcall_'+d+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+d+"');CallReminder.cancel('"+d+"','true');\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw" data-zcqa="callMoreOption" id="endcall_'+d+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+r+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>'):window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()?(1===u.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+d+'" style="height:auto" >',t+="<span class='fL' onclick='crmCallsNew.initiateCallViaZPB(\""+u[0]+'","'+s+'","'+o+'","'+$ESAPI.encoder().encodeForJavaScript(c)+'","'+d+"\");closeReminder(this);' >"+I18n.getMsg("Call")+"</span>",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+d+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+d+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+d+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+d+",this,"+i+");CallReminder.later('"+d+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal newgraybtn mL5 btnTransfer norBtn" id="endcall_'+d+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+d+"');CallReminder.cancel('"+d+"','true');\"style=\"margin: -1px !important;\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw customImportBtn" data-zcqa="callMoreOption" id="endcall_'+d+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+r+'\');sE1(event);"style="padding: 6px 14px 15px 12px !important;margin: -8px !important;"><span class="dIB actArwNew"></span></span></span>'):(t+="</a><span  id='later_"+d+"' hide='false' data-zcqa='callMoreOption' class='fL mL5 remselVal oH ellipsistext blueNewBtn btnTransfer primarybtn' onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+r+"');sE1(event);\"><span class='remval'>"+I18n.getMsg("crm.label.mark.completed")+"</span>  <span class='remSelArw'> <span class='dIB remArwNew'></span>  </span>     </span>",t+='<input type="button" value='+I18n.getMsg("crm.button.close")+' class="newgraybtn mL5 cP fR norBtn" id="endcall_'+d+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+d+"');CallReminder.cancel('"+d+"','true');\">"),t+='<input type="hidden" id="singleReminderId" value="'+d+'"/>',t+="</div></div>",t+='<div class="newPopup zi100" id="entityPhnoDiv_'+d+'" style="display: none;margin-left: 10px" onclick="sE(event);">',t+='<div class="pR">',t+='<div class="multipleNos">',t+='<table cellpadding="5" cellspacing="0" border="0">',p){f=p[m];validationUtils.isNotEmpty(f)&&(!0===CallReminder.get("outgoingEnable")?t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='cP' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(f)+"','"+n+"','"+r+"','"+s+"','"+d+"','"+o+"','"+$ESAPI.encoder().encodeForJavaScript(c)+"');closeReminder(this);\">":window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()&&(t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='cP' onclick='crmCallsNew.initiateCallViaZPB(\""+f+'","'+s+'","'+o+'","'+$ESAPI.encoder().encodeForJavaScript(c)+'","'+d+"\");closeReminder(this);'>"),t+='<td class="crmLabelColor pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(m))+" </td>",t+='<td class="crmBaseColor pR20">'+CTIAPI.encodeForHTMLWithoutNull(f)+"</td>",t+="</tr>")}if(t+="</table>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="<div>",t+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -325px; top: -90px; display: block;"></div>',i){var C=$("body");C.append(t),1===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").remove(),C.append('<div class="ctiapiFreezeLayer ctiapiReminderFreezeLayer"></div>'),$("#ctireminder").addClass("noboxShadow"),$(".lookFieldSrcWrap").hide(),Crm.menu.globalHideMenu()),callRemCenter("singlereminder");var g=$L(".singlereminder");g.length>0&&crmui.modalZIndex("nonLyte",g[g.length-1],"open")}else{$("#ctireminder").html(t).show(),toggleSingleReminder(d);var y=$L("#ctireminder");y.length>0&&crmui.modalZIndex("nonLyte",$L(y[y.length-1])[0],"open","noFreeze"),closeReminder($(".singlereminder #later_"+d).get(0))}$L(window).scrollTop("ICPOP2"),multiReminderShowHide(),$L("#ICPOP2").trapFocus({preventDefault:!0})}function callRemCenter(e){var i=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollLeft||document.body.scrollLeft,a=renderingUtils.windowHeight,l=$("."+e),n=l.height(),r=l.width(),s=l.length,o=$("#setWidthForCallRemDesc"),c=o.width();if(a>n)$(l[s-1]).css({display:"block",position:"absolute",left:"50%",top:"50%","margin-left":-r/2+t,"margin-top":-n/2+i});else{var d=i+10;$(l[s-1]).css({display:"block",position:"absolute",left:"50%",top:d,"margin-left":-r/2+t,"margin-top":"0px"})}c<r&&o.css({width:r/2+40})}function multiReminderShowHide(){var e=$(".singlereminder");e.hide(),$(e[e.length-1]).show(),$(".totalsinglereminder").html(" ("+e.length+")")}function removeReminder(e){reminderDatatemp.removeReminder(e)}function closeReminder(e){var i=null;e?0===(i=$(e).closest(".singlereminder")).length&&(i=$(e).closest("#ICPOP2")):i=$("#ICPOP2"),i.slideUp(100,(function(){multiReminderShowHide();var e=$L(".singlereminder");e.length>0&&crmui.modalZIndex("nonLyte",e[e.length-1],"open")})),i.length>0&&crmui.modalZIndex("nonLyte",i[0],"close"),i.remove(),0===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").hide(),$("#ctireminder").removeClass("noboxShadow"))}function appendReminder(e,i,t){var a=e,l=reminderDatatemp.reminders.noOfReminders,n=reminderDatatemp.reminders;if(t&&void 0===n.reminderIdNameMap[a.callactivityid+""]&&-1===n.deletedRemindersIDList.indexOf(a.callactivityid+"")){l=reminderDatatemp.reminders.noOfReminders=l+1,reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders+1;var r={remindername:"reminder"+l,time:a.timeOfReminder};reminderDatatemp.reminders.timesOfReminders.push(r),reminderDatatemp.reminders.reminderIdNameMap[a.callactivityid+""]="reminder"+l,reminderDatatemp.reminders["reminder"+l]=a}1===reminderDatatemp.reminders.availableReminders?createReminder1(a,!1):(createReminder(reminderDatatemp),closeReminder(i))}function createReminder(e){var i="";i+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -305px; top: -90px; display: block;"></div>',i+='<div id="ICPOP1" class="content" style="width:370px;">',i+=getReminderHead(e),i+=getReminderBody(e),i+="<div>",$("#ctireminder").html(i);var t=$(".reminderusers").length,a=t>1?" ("+t+")":"";$("#reminderTitleSpan").html(I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminder",a)),toggleReminder(!0),toggleSingleReminder("","false")}function getReminderHead(e){var i="",t=e.reminders.availableReminders>1?e.reminders.availableReminders:"1";return i+='<div class="chatPopTitle oH" onclick="toggleReminder();">',i+='<div class="pT10 pB10 oH">',i+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL crm-base-font-size">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify crm-small-font-size mL5" id="reminder_count">'+t+"</span></span>",i+="</div>",i+="</div>"}function updateReminderHead(){var e=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"";$("#reminder_count").html(e)}function toggleSingleReminder(e,i){var t=$("#later_"+e),a=i||t.attr("hide"),l=$("#reminderbody").css("display");if("false"===a)$("#ctireminder #businessView").slideUp().hide(1e3),t.attr("hide","true");else if("true"===a){$("#ctireminder #businessView").slideDown(),t.attr("hide","false");var n=new Array;n.push($("#singleReminderId").val());var r=getremindertimes(n);if(typeof r!=={}){var s=r[n[0]],o=validationUtils.isNotEmpty(setMoreLater(s,!0))?setMoreLater(s,!0):setMoreLater(0,!0),c=getremindertime(n[0])<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"};$("#reminderTimeSpan_"+n[0]).html(o).attr("time",s),$(".reminderTime_Msg_"+n[0]).html(o).css(c);var d=ctiapiRem_dataparam["dataparam_"+n[0]],p=$("#twistatusimg");if(((void 0===p||p.is(":hidden"))&&!0===d.outgoingenabled||void 0!==p&&"1"===p.attr("statusvalue"))&&parseInt(s)<=6e4){var u=d.zgid+"",m=d.userid+"",f=d.phone+"",_=d.callactivityid+"",v=d.entityid+"",h=d.entitymodule,C=d.reminderPhno,g=d.recordEntityName,y='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";C.length<=1?y='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(f)+'","'+u+'","'+m+'","'+v+'","'+_+'","'+h+'","'+$ESAPI.encoder().encodeForJavaScript(g)+"\");' >"+I18n.getMsg("Call")+"</span> ":(y='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",y+='<i class="whtdownArw fL"></i>');var I=".singleReminderCallBt_"+n[0];$(I).html(y),$(I).parent().find(".btnTransfer").addClass("ctireminderBtnTransfer")}}}else toggleSingleReminder("","none"===l?"true":"false")}function toggleReminder(e){!0===e?$("#reminderbody").slideUp().hide(1e3):!1===e?updateMultipleReminderTimes():"none"===$("#reminderbody").css("display")?toggleReminder(!1):toggleReminder(!0),closeMultipleReminderBussinesscardView()}function updateMultipleReminderTimes(){var e=new Array;$(".reminderusers").each((function(){var i=ctiapiRem_dataparam[$(this).attr("ctiapi-data-params")];-1===e.indexOf(i.callactivityid)&&e.push(i.callactivityid)}));var i=getremindertimes(e);if(i!=={}){for(var t=reminderDatatemp.reminders.timesOfReminders,a=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"",l=e.length,n=0;n<l;n++){var r=e[n],s=i[r],o=validationUtils.isNotEmpty(setMoreLater(s,!1))?setMoreLater(s,!1):setMoreLater(0,!1),c=validationUtils.isNotEmpty(setMoreLater(s,!0))?setMoreLater(s,!0):setMoreLater(0,!0),d=s<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"},p=reminderDatatemp.reminders.reminderIdNameMap[r+""];$("#tof_"+r).html(o).attr("title",c).css(d);for(var u=t.length,m=0;m<u;m++)if(t[m].remindername===p){t[m].time=s;break}}var f=getReminderBody(reminderDatatemp),_=$("#reminderbody");$("#reminder_count").html(a),_.addClass("oldreminderslist").attr("id","oldreminderbody").after(f).remove(),_.hide().slideDown(500)}}function updateRemindersTimesFromServer(e){var i=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={mode:"getremindertimes",isAjax:!0,activityids:e+""};networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({type:"POST",url:i,data:t,success:function(i){if("object"==typeof i){for(var t=e.length,a=0;a<t;a++){var l=e[a],n=i[l],r=(new Date).getTime();if(void 0!==l){var s=ctiapiRem_dataparam["dataparam_"+l];s.date=r,s.timeOfReminder=n}}updateRemindersTime(),ctiapiSche.serverScheLastRunTime=new Date}}})}function getremindertime(e){return getremindertimes([e])[e]}function getremindertimes(e){for(var i={},t=(new Date).getTime(),a=e.length,l=0;l<a;l++){var n=e[l],r=ctiapiRem_dataparam.getTime(n)-t;i[n]=r}return i}function showHideSelectedReminder(e){var i=getremindertime(e);parseInt(i)<=6e4?$(".selectedReminder.reminderCallBt").show():$(".selectedReminder.reminderCallBt").hide()}function updateRemindersTime(){var e=!1;for(var i in ctiapiSche.reminderIds){var t=ctiapiRem_dataparam["dataparam_"+i],a=t.callactivityid+"",l=getremindertime(a),n=validationUtils.isNotEmpty(setMoreLater(l,!1))?setMoreLater(l,!1):setMoreLater(0,!1),r=validationUtils.isNotEmpty(setMoreLater(l,!0))?setMoreLater(l,!0):setMoreLater(0,!0),s=getremindertime(a)<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"};$(".reminderTimeBig_"+i).html('<span id="reminderTimeSpan_'+a+'">'+r+'</span>  <label href="javascript:void(0);" class="dB crmNegativeColor crm-medium-large-font-size ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+'">"'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+"</label>"),$(".reminderTime_Msg_"+a).html(r).css(s),$("#tof_"+a).html(n).attr("title",r).css(s);var o=$("#twistatusimg");if(((void 0===o||o.is(":hidden"))&&!0===t.outgoingenabled||void 0!==o&&"1"===o.attr("statusvalue"))&&parseInt(l)<=6e4){var c=t.zgid+"",d=t.userid+"",p=t.phone+"",u=a,m=t.entityid+"",f=t.entitymodule,_=t.reminderPhno,v=t.recordEntityName,h='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";_.length<=1?h='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(p)+'","'+c+'","'+d+'","'+m+'","'+u+'","'+f+'","'+$ESAPI.encoder().encodeForJavaScript(v)+"\");' >"+I18n.getMsg("Call")+"</span> ":(h='<span class="fL">'+I18n.getMsg("Call")+"</span> ",h+='<i class="whtdownArw fL"></i>'),$(".singleReminderCallBt_"+a).html(h),e=!0}}if(e){$(".reminderCallBt").show();var C=$(".reminderusers.sel");if(void 0!==C&&C.length>0)showHideSelectedReminder(C.attr("ctiapi-data-params").split("dataparam_")[1]+"")}else $(".reminderCallBt").hide();ctiapiSche.clientScheLastRunTime=new Date}function getReminderBody(e){var i=new Array,t=e.reminders,a=t.timesOfReminders.sort((function(e,i){return e.time-i.time})),l="";l+='<div class="chatContainer pR" id="reminderbody">',l+='<div id="businessView">',l+='<div class="remindercallList reminderslist" onscroll="CallReminder.scrollReminderBody()">';for(var n=0,r=0;n<t.noOfReminders;n++,r++){var s=a[n].remindername,o=a[n].time,c=t[s],d=c.callactivityid+"",p=o<-6e4?"color:var(--negativeColor)":"color:#66bb33";if(-1===reminderDatatemp.reminders.deleteRemindersList.indexOf(s)&&-1===i.indexOf(d)){var u=setMoreLater(o,!0);i.push(d),l+='<div id="ICPOP2" class="chooseOwner reminderusers" ctiapi-data-params="dataparam_'+d+'" orderno="'+r+'" onclick="CallReminder.getSelectedReminder(this);">',l+='<div class="">',l+='<img src="'+CallReminder.getEntityImgSrc(c)+'" width="40" class="fL mR10">',l+='<input type="hidden" id="endcall_'+d+'">',l+='<span class="fL w220 oH">',l+='<label class="dB crm-small-font-size crm-font-bold crmBaseColor cP ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(c.entityname)+'">',l+=CTIAPI.encodeForHTMLWithoutNull(c.entityname),l+="</label>",l+='<a href="javascript:void(0);" class="ellipsistext crm-small-font-size crmNotFoundColor w220 oH dIB" title="'+(validationUtils.isNotEmpty(c.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(c.entityemailid):"")+'">',l+=validationUtils.isNotEmpty(c.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(c.entityemailid):"",l+="</a>",l+="</span> ",l+='<span class="fR w70 ellipsistext alignRight" id="tof_'+d+'" title="'+u+'" style="'+p+'">',l+=setMoreLater(o,!1),l+="</span>",l+="</div>",l+="</div>"}else r--}return l+="</div>",l+="</div>",l+="</div>"}function setMoreLater(e,i){return setDaysHoursMins(e,i)}function setDaysHoursMins(e,i){var t=Utils.getMillisecondsToBasicDateProperties(e),a=i?".detailedtext":"",l=t.days,n=t.hours,r=t.mins;if(!(parseInt(e)>0&&parseInt(e)<1e3||parseInt(e)<0&&parseInt(e)>-1e3))if(Math.abs(l)>0)if(n%=24,Math.abs(n)>0){var s=(Math.abs(n)+"").length>1?Math.abs(n)+"":"0"+Math.abs(n);if(l>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshoursmore"+a,[l+"",s]);if(l<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshourslate"+a,[Math.abs(l)+"",s])}else{if(l>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.daysmore"+a,l+"");if(l<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayslate"+a,Math.abs(l)+"")}else if(Math.abs(n)>0)if(Math.abs(r)>0){var o=(Math.abs(r)+"").length>1?Math.abs(r)+"":"0"+Math.abs(r);if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminutesmore"+a,[n+"",o]);if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminuteslate"+a,[Math.abs(n)+"",o])}else{if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourssmore"+a,n+"");if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourslate"+a,Math.abs(n)+"")}else if(Math.abs(r)>0){if(0===r)return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall");if(r>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minutesmore"+a,r+"");if(r<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minuteslate"+a,Math.abs(r)+"")}return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall")}!function(){var e=Handlebars.template,i=Handlebars.templates=Handlebars.templates||{};i.ctiapi_businesscard=e({1:function(e,i,t,a,l){return' <div class="fL"> '},3:function(e,i,t,a,l){return" "+e.escapeExpression(t.ctiapi_businesscard_entityextradetails.call(null!=i?i:{},null!=i?i.entitymodule:i,null!=i?i.extraid:i,null!=i?i.extramodule:i,null!=i?i.extradetails:i,{name:"ctiapi_businesscard_entityextradetails",hash:{},data:l}))+" "},5:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_gt.call(null!=i?i:{},null!=(n=null!=i?i.potentials:i)?n.noOfpotential:n,0,{name:"if_gt",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l}))?n:"")+" "},6:function(e,i,t,a,l){var n,r=null!=i?i:{};return' <div class="mT10" id="ctiapi_businesscard_potential_button"> '+(null!=(n=t.if_gt.call(r,null!=(n=null!=i?i.potentials:i)?n.noOfpotential:n,1,{name:"if_gt",hash:{},fn:e.program(7,l,0),inverse:e.program(9,l,0),data:l}))?n:"")+' </div> <div class="potentialPopView" id="ctiapi_businesscard_potential" style="display:none;"> '+(null!=(n=t.if_gt.call(r,null!=(n=null!=i?i.potentials:i)?n.noOfpotential:n,1,{name:"if_gt",hash:{},fn:e.program(11,l,0),inverse:e.program(16,l,0),data:l}))?n:"")+" </div> "},7:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression;return' <a href="javascript:void(0);" class="ctiPotentialDD pR" id=\'ctiapi_businesscard_potential_link\' onClick="ctiApiNotifier.getMorePotentialsType4('+s(t.ctiapi_pass_multipotential.call(r,null!=i?i.potentials:i,{name:"ctiapi_pass_multipotential",hash:{},data:l}))+");\" > <span id='ctiapi_businesscard_potential_count'> "+s(t.ctiapi_businesscard_potential_count_multiple.call(r,null!=(n=null!=i?i.potentials:i)?n.noOfpotential:n,{name:"ctiapi_businesscard_potential_count_multiple",hash:{},data:l}))+" </span> <i class=\"icon_cti_dwnArw dIB mL10\" id='ctiapi_businesscard_potential_arrow'></i> </a> "},9:function(e,i,t,a,l){return' <a href="javascript:void(0);" class="ctiPotentialDD pR" id=\'ctiapi_businesscard_potential_link\' onClick="ctiApiNotifier.showHidePotentials();"> '+e.escapeExpression(t.ctiapi_businesscard_potential_count_single.call(null!=i?i:{},{name:"ctiapi_businesscard_potential_count_single",hash:{},data:l}))+" <i class=\"icon_cti_dwnArw dIB mL10\" id='ctiapi_businesscard_potential_arrow'></i> </a> "},11:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_eq.call(null!=i?i:{},null!=i?i.entitymodule:i,"Accounts",{name:"if_eq",hash:{},fn:e.program(12,l,0),inverse:e.program(14,l,0),data:l}))?n:"")+" "},12:function(e,i,t,a,l){return' <div class="morePotential pA"  id="ctiapi_businesscard_multi_potential" content_exist="false">  </div> '},14:function(e,i,t,a,l){return' <div class="morePotential pA "  id="ctiapi_businesscard_multi_potential" content_exist="false">  </div> '},16:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_eq.call(null!=i?i:{},null!=i?i.entitymodule:i,"Accounts",{name:"if_eq",hash:{},fn:e.program(17,l,0),inverse:e.program(19,l,0),data:l}))?n:"")+" "},17:function(e,i,t,a,l){return' <div class="singlePotential p10 pB0 pR ctimL_20" style="background:#fff;" id="ctiapi_businesscard_single_potential" > '+e.escapeExpression(t.ctiapi_singlepotential.call(null!=i?i:{},i,{name:"ctiapi_singlepotential",hash:{},data:l}))+" </div> "},19:function(e,i,t,a,l){return' <div class="singlePotential p10 pB0 pR" style="background:#fff;" id="ctiapi_businesscard_single_potential" > '+e.escapeExpression(t.ctiapi_singlepotential.call(null!=i?i:{},i,{name:"ctiapi_singlepotential",hash:{},data:l}))+" </div> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression,o=e.lambda;return' <div class="p20"> '+s(t.ctiapi_businesscard_entityimage.call(r,null!=i?i.entitymodule:i,null!=i?i.entityid:i,null!=i?i.photofileid:i,{name:"ctiapi_businesscard_entityimage",hash:{},data:l}))+" "+(null!=(n=t.if_eq.call(r,null!=i?i.entitymodule:i,"Accounts",{name:"if_eq",hash:{},fn:e.program(1,l,0),inverse:e.program(1,l,0),data:l}))?n:"")+' <div class="oH"> <a href="javascript:void(0);" class="crm-heading-font-size crmBaseColor ellipsistext dB w250" id="ctiapi_businesscard_entityname" onclick="CTIAPI.openUrl(\''+s(o(null!=i?i.entityid:i,i))+"','"+s(o(null!=i?i.entitymodule:i,i))+"','','','','_blank');\" title=\""+s(o(null!=i?i.entityname:i,i))+'">'+s(t.encodeForHtmlWithoutNull.call(r,null!=i?i.entityname:i,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))+"</a> "+(null!=(n=t.isNotEmpty.call(r,null!=i?i.extradetails:i,{name:"isNotEmpty",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l}))?n:"")+" </div> "+(null!=(n=t.isNotEmpty.call(r,null!=i?i.potentials:i,{name:"isNotEmpty",hash:{},fn:e.program(5,l,0),inverse:e.noop,data:l}))?n:"")+" <div id='ctiapi_businesscard_table'> "+s(t.ctiapi_businesscard_create.call(r,i,{name:"ctiapi_businesscard_create",hash:{},data:l}))+' </div> </div> <br class="cBoth"> </div> '},useData:!0}),i.ctiapi_businesscard_multi_potential=e({1:function(e,i,t,a,l){var n,r=null!=i?i:{};return' <a href="javascript:void(0);" class="icon_close_chatpop dIB pA right10" style="top:-20px" onclick="ctiApiNotifier.showHidePotentials();"></a> <div class="potentialTable pR bg_white zi1"> <div class="ctihalfShadow"></div> <div class="potentialHeader" id="ctiapi_multi_potential_tablehead"> <table class="ctiPotentialList" cellpadding="0" cellspacing="0" border="0" width="100%"> <thead> <tr> '+(null!=(n=t.each.call(r,null!=i?i.heading:i,{name:"each",hash:{},fn:e.program(2,l,0),inverse:e.noop,data:l}))?n:"")+' </tr> </thead> </table> </div> <div class="potentialTableBody oA" id="ctiapi_multi_potential_tablebody" style="height:150px"> <table border="0" cellspacing="0" cellpadding="0" class="ctiPotentialListScroll" width="100%"> <tbody> '+e.escapeExpression(t.ctiapi_businesscard_multi_potential_tablebody.call(r,null!=i?i.body:i,{name:"ctiapi_businesscard_multi_potential_tablebody",hash:{},data:l}))+" </tbody> </table> </div> </div> "},2:function(e,i,t,a,l){return' <td class="headRow"> <a href="javascript:void(0);" class="crm-base-font-size crmBaseColor"> '+e.escapeExpression(e.lambda(null!=i?i.DISPLAYLABEL:i,i))+" </a> </td> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n;return null!=(n=t.if_eq.call(null!=i?i:{},null!=i?i.noRecord:i,"false",{name:"if_eq",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:""},useData:!0}),i.ctiapi_businesscard_multi_potential_tablebody=e({1:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression;return" <tr onclick=\"CTIAPI.openUrl('"+s(r(null!=i?i.entityId:i,i))+"','"+s(r(null!=i?i.module:i,i))+"');\"> "+(null!=(n=t.each.call(null!=i?i:{},null!=i?i.content:i,{name:"each",hash:{},fn:e.program(2,l,0),inverse:e.noop,data:l}))?n:"")+" </tr> "},2:function(e,i,t,a,l){return' <td class="rowCell"> <a class="crm-small-font-size crmBaseColor" href="javascript:void(0);"> '+e.escapeExpression(e.lambda(null!=i?i.DISPLAYVALUE:i,i))+" </a> </td> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n;return" "+(null!=(n=t.each.call(null!=i?i:{},i,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:"")},useData:!0}),i.ctiapi_businesscard_single_potential=e({1:function(e,i,t,a,l){var n;return e.escapeExpression(t.encodeForHtmlWithoutNull.call(null!=i?i:{},null!=(n=null!=(n=null!=i?i.potentials:i)?n.potential1:n)?n.amount:n,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return' <div class="crm-base-font-size cP" onclick="CTIAPI.openUrl(\''+s(r(null!=(n=null!=(n=null!=i?i.potentials:i)?n.potential1:n)?n.potentialid:n,i))+"','"+s(r(null!=(n=null!=(n=null!=i?i.potentials:i)?n.potential1:n)?n.potentialmodule:n,i))+"');\"> "+s(t.encodeForHtmlWithoutNull.call(o,null!=(n=null!=(n=null!=i?i.potentials:i)?n.potential1:n)?n.potentialname:n,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))+" - "+(null!=(n=t.isNotEmpty.call(o,null!=(n=null!=(n=null!=i?i.potentials:i)?n.potential1:n)?n.amount:n,{name:"isNotEmpty",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:"")+' </div> <a href="javascript:void(0);" class="icon_close_chatpop dIB pA right10 top20" onClick="ctiApiNotifier.showHidePotentials();"></a> '+s(t.ctiapi_singlepotential_create.call(o,i,{name:"ctiapi_singlepotential_create",hash:{},data:l}))},useData:!0}),i.ctiapi_calltransfer_to_repslistview=e({1:function(e,i,t,a,l){return' <div style="padding:7px;" id="ctiapi_calltransfer_to_reps_searchbox"> <input type="text" class="newinputText2" placeholder="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.tpi.ctiapi.config.choosesalesrep",{name:"getI18n",hash:{},data:l}))+'" onkeyup=""> </div> '},3:function(e,i,t,a,l,n,r){var s,o=e.lambda,c=e.escapeExpression;return' <a href="javascript:void(0)" class="dB oH" id="ctiapi_calltransfer_to_rep_'+c(o(null!=i?i.repid:i,i))+'" rep_id="'+c(o(null!=i?i.repid:i,i))+'" onclick=""> <img src="'+c(o(null!=r[1]?r[1].contactserverurl:r[1],i))+"/file?ID="+c(o(null!=i?i.photoid:i,i))+'" class="fL mT2" id="ctiapi_calltransfer_to_repimage"> <span class="fL mL10"> '+(null!=(s=t.if_eq.call(null!=i?i:{},null!=i?i.repstatus:i,0,{name:"if_eq",hash:{},fn:e.program(4,l,0,n,r),inverse:e.program(6,l,0,n,r),data:l}))?s:"")+' <span class="fL pL5"> <label class="crmBaseColor crm-base-font-size" id="ctiapi_calltransfer_to_repname">'+c(o(null!=i?i.repname:i,i))+'</label> <span class="crmNotFoundColor dB" id="ctiapi_calltransfer_to_rep_phno">'+c(o(null!=i?i.repphno:i,i))+"</span> </span> </span> </a> "},4:function(e,i,t,a,l){return' <i class="icon_offstatus fL mT5"></i> '},6:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_eq.call(null!=i?i:{},null!=i?i.repstatus:i,1,{name:"if_eq",hash:{},fn:e.program(7,l,0),inverse:e.program(9,l,0),data:l}))?n:"")+" "},7:function(e,i,t,a,l){return' <i class="icon_onstatus fL mT5"></i> '},9:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_eq.call(null!=i?i:{},null!=i?i.repstatus:i,5,{name:"if_eq",hash:{},fn:e.program(4,l,0),inverse:e.noop,data:l}))?n:"")+" "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l,n,r){var s,o=null!=i?i:{};return" "+(null!=(s=t.if_gt.call(o,null!=i?i.no_of_users:i,10,{name:"if_gt",hash:{},fn:e.program(1,l,0,n,r),inverse:e.noop,data:l}))?s:"")+" "+(null!=(s=t.each.call(o,null!=i?i.reps_details:i,{name:"each",hash:{},fn:e.program(3,l,0,n,r),inverse:e.noop,data:l}))?s:"")+" "},useData:!0,useDepths:!0}),i.ctiapi_ringcentral_choose_phonenumbers=e({1:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_eq.call(null!=i?i:{},null!=(n=null!=i?i.ctiapijson:i)?n.loginusername:n,null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,{name:"if_eq",hash:{},fn:e.program(2,l,0),inverse:e.program(4,l,0),data:l}))?n:"")+" "},2:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression;return' <li class="selectedDDList mT5" data-value="'+s(r(null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,i))+'">'+s(r(null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,i))+"</li> "},4:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression;return' <li class="mT5" data-value="'+s(r(null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,i))+'">'+s(r(null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,i))+"</li> "},6:function(e,i,t,a,l){return' class="selectedDDList mB5" '},8:function(e,i,t,a,l){return"dN"},10:function(e,i,t,a,l){var n;return'value="'+e.escapeExpression(e.lambda(null!=(n=null!=i?i.ctiapijson:i)?n.loginusername:n,i))+'"'},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression,o=e.lambda;return'<div class="popup-model-header crm-heading-font-size crm-font-regular bxShTp">'+s(t.getI18n.call(r,"crm.label.preferences",{name:"getI18n",hash:{},data:l}))+'</div> <div class="popup-model-content pT50 pB40" style="overflow: visible;"> <div class="crm-font-regular crm-base-font-size crmBaseColor mT7 fL" style="width:220px">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.options",{name:"getI18n",hash:{},data:l}))+'</div> <div id="selection" class="fL pR" > <div id="rcnumber" style="font-size: var(--crm-extra-medium-font-size)" class="pR"> <span id="phnnolist" onclick="sE(event)">'+s(t.getI18n.call(r,"zc.editor.select",{name:"getI18n",hash:{},data:l}))+'</span> <ul class="DDListMenu_RC" data-close="true"> '+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapijson:i)?n.Browser:n,"Browser",{name:"if_eq",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:"")+" <li "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapijson:i)?n.selection:n,"customphone",{name:"if_eq",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l}))?n:"")+' data-value="customphone">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.customphone",{name:"getI18n",hash:{},data:l}))+'</li> </ul> </div> </div> <span id="errormsgwebrtc" class="telbrowserErrorMsgonpop"></span> <div id="customno" class="fL pR w100_per mT10 '+(null!=(n=t.ifNotEquals.call(r,null!=(n=null!=i?i.ctiapijson:i)?n.selection:n,"customphone",{name:"ifNotEquals",hash:{},fn:e.program(8,l,0),inverse:e.noop,data:l}))?n:"")+'"> <span class="rbHtmlLb crm-base-font-size fL mT5 " style="width:220px;">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.custom",{name:"getI18n",hash:{},data:l}))+'</span> <span> <input type="text" style="width:181px;font-size: var(--crm-extra-medium-font-size);"  class="textField p6 tel_cus_input crmBaseColor" id="customnofield" '+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapijson:i)?n.selection:n,"customphone",{name:"if_eq",hash:{},fn:e.program(10,l,0),inverse:e.noop,data:l}))?n:"")+'> </span> <span id="errormsg" class="telErrorMsgonpop"></span> </div> <div class="cBoth"></div> </div> <div class="popup-model-footer aligncenter bdrTope8e8e8"> <input id="save" type="button" onclick="'+s(o(null!=(n=null!=i?i.ctiapijson:i)?n.savefn:n,i))+'" class="primarybtn"  Value="'+s(t.getI18n.call(r,"crm.button.save",{name:"getI18n",hash:{},data:l}))+'"></input> <input type="button" onclick="'+s(o(null!=(n=null!=i?i.ctiapijson:i)?n.cancelfn:n,i))+'" class="newgraybtn" value="'+s(t.getI18n.call(r,"crm.button.cancel",{name:"getI18n",hash:{},data:l}))+'"></input> </div> '},useData:!0}),i.ctiapi_statuslist=e({1:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return' <tr class="cP opac"> <td id="'+s(r(null!=i?i.statusid:i,i))+'" statusvalue="'+(null!=(n=t.if.call(o,null!=i?i.statusvalue:i,{name:"if",hash:{includeZero:!0},fn:e.program(2,l,0),inverse:e.noop,data:l}))?n:"")+'" onclick="'+s(r(null!=i?i.onclickfn:i,i))+'" class="p10 pL15"> <span class='+(null!=(n=t.if_eq.call(o,null!=i?i.colourcode:i,"green",{name:"if_eq",hash:{},fn:e.program(4,l,0),inverse:e.program(6,l,0),data:l}))?n:"")+' style="position:inherit"> </span> <span style="color:var(--notfoundColor)" class="pL10 crm-small-font-size" >'+s(r(null!=i?i.statusname:i,i))+" </span> </td> </tr> "},2:function(e,i,t,a,l){return e.escapeExpression(e.lambda(null!=i?i.statusvalue:i,i))},4:function(e,i,t,a,l){return'"onlineIcon-RC dIB fL mT3"'},6:function(e,i,t,a,l){return'"offlineIcon-RC dIB fL mT3"'},8:function(e,i,t,a,l){var n,r=e.escapeExpression;return' <tr class="cP opac" id="forum" data-zcqa=\'userPhonePref\'> <td  onclick="'+r(e.lambda(null!=(n=null!=i?i.data:i)?n.preffun:n,i))+'" class="p10 pL30 prefBdr"> <span style="color:var(--notfoundColor)" class="crm-small-font-size dIB">'+r(t.getI18n.call(null!=i?i:{},"crm.label.preferences",{name:"getI18n",hash:{},data:l}))+" </span> </td> </tr> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=null!=i?i:{};return'<div style="min-width:180px;" class="pT10 pB20"> <table cellpadding="0" cellspacing="0" data-zcqa=\'telephonyStatusesList\' class="w100_per"> '+(null!=(n=t.each.call(r,null!=(n=null!=i?i.data:i)?n.statuslist:n,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if.call(r,null!=(n=null!=i?i.data:i)?n.preffun:n,{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.noop,data:l}))?n:"")+" </table> </div>"},useData:!0}),i.ctiapinotifier=e({1:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return' <input type="hidden" id="ctinumber" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctinumber:n,i))+'"></input> <input type="hidden" id="call_singleclient" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.singleclient:n,i))+'"></input> <input type="hidden" id="call_hold" value="false"> <div class="transferFrom oH" id="ctiapi_calltransfer_from" style="display:none;"> <img src="" width="30" class="fL mT2 mR10" id="ctiapi_calltransfer_from_repimage"> <div class="fL" style="width:136px;"> <p class="w100_per ellipsistext crm-base-font-size crmWhiteColor" id="ctiapi_calltransfer_from_repname"></p> <p class="crm-extra-small-font-size w100_per crm-small-font-size ellipsistext crmWhiteColor pT2">'+s(t.getI18n.call(o,"crm.tpi.ctiapi.transfercall",{name:"getI18n",hash:{},data:l}))+'</p> </div> <div class="fR mT5"> <input type="button" value="'+s(t.getI18n.call(o,"crm.label.answer",{name:"getI18n",hash:{},data:l}))+'" class="ctiGreenbtn" onClick="" id="ctiapi_calltransfer_from_answer_button"> <input type="button" value="'+s(t.getI18n.call(o,"crm.creator.cancelbutton",{name:"getI18n",hash:{},data:l}))+'" class="ctiSecondarybtn mL8" id="ctiapi_calltransfer_from_cancel_button" style="display:none;"> </div> </div> '},3:function(e,i,t,a,l){return' <td valign="middle"> <i class="icon_incomingCall fL status_icon" id="ctiapi_inboundcall_status_icon" ></i> <i class="icon_outgoingCall fL status_icon" id="ctiapi_outboundcall_status_icon" style="display:none;"></i> <i class="icon_answerCall fL status_icon" id="ctiapi_answeredcall_status_icon" style="display:none;"></i> <i class="icon_endCall fL status_icon" id="ctiapi_endcall_status_icon" style="display:none;"></i> </td> '},5:function(e,i,t,a,l){return' <td valign="middle"> <i class="icon_incomingCall fL status_icon" id="ctiapi_inboundcall_status_icon"></i> <i class="icon_outgoingCall fL status_icon" id="ctiapi_outboundcall_status_icon" style="display:none;"></i> <i class="icon_answerCall fL status_icon" id="ctiapi_answeredcall_status_icon" style="display:none;"></i> <i class="icon_endCall fL status_icon" id="ctiapi_endcall_status_icon" style="display:none;"></i> <i class="icon_holdCall fL" id="ctiapi_holdcall_status_icon" style="display:none;"></i> </td> '},7:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression;return' <div id="PhoneNumberDiv"> <call-fromto-field class="dIB fL" activity-id="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.caid:n,i))+'" se-module="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entitymodule:n,i))+'" se-id="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityid:n,i))+'" se-name="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityname:n,i))+'" phone-id="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.phoneNoId:n,i))+'" phone-number="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.custnumber:n,i))+'" estyle="crmWhiteColor" open-in-new-tab=true mover-bcard=false show-module=false></call-fromto-field> <crm-call-popup-menu phone-id="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.phoneNoId:n,i))+'" is-known-number="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.recordexist:n,i))+'"  style="display:none;"></crm-call-popup-menu> </div> '},9:function(e,i,t,a,l){var n;return null!=(n=t.if_eq.call(null!=i?i:{},null!=(n=null!=i?i.ctiapinotifierjson:i)?n.recordexist:n,!0,{name:"if_eq",hash:{},fn:e.program(10,l,0),inverse:e.program(12,l,0),data:l}))?n:""},10:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression;return' <div class="crm-heading-font-size crmWhiteColor ellipsistext w250 cP" id="ctiapi_entityname" onclick="CTIAPI.openUrl(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityid:n,i))+"','"+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entitymodule:n,i))+"','','','','_blank');\" title=\""+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityname:n,i))+'">'+s(t.encodeForHtmlWithoutNull.call(null!=i?i:{},null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityname:n,{name:"encodeForHtmlWithoutNull",hash:{},data:l}))+"</div> "},12:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return' <a href="javascript:void(0);" class="ellipsistext w250 crm-heading-font-size crmWhiteColor cDefault dIB" id="ctiapi_unknown"> <span class="fL" id="ctiapi_unknown_phone_no">'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+' </span> <i class="icon_addUK cP" id="ctiapi_unknown_add_associate_plus" onclick="CTIAPI.ctiapiUnknownAdd_associate(this);" style="display:none;z-index:1;"></i> </a> <a href="javascript:void(0);" class="ctiapi_unknown_added_associated" id="ctiapi_unknown_added_contact" style="display:none;" onclick="CTIAPI.createContact(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+'\')"> <span class="ellipsistext w250 crm-heading-font-size crmWhiteColor dB" id="ctiapi_unknown_added_contact_name"></span> </a> <a href="javascript:void(0);" class=" ctiapi_unknown_added_associated" id="ctiapi_unknown_added_lead" style="display:none;" onclick="CTIAPI.createLead(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+'\')"> <span class="ellipsistext w250 crm-heading-font-size crmWhiteColor dB" id="ctiapi_unknown_added_lead_name"></span> </a> <a href="javascript:void(0);" class=" ctiapi_unknown_added_associated" id="ctiapi_unknown_associated_contact" style="display:none;" onclick="CTIAPI.openAssociateContact();"> <span class="ellipsistext w250 crm-heading-font-size crmWhiteColor dB" id="ctiapi_unknown_associated_contact_name"></span> </a> <a href="javascript:void(0);" class=" ctiapi_unknown_added_associated" id="ctiapi_unknown_associated_lead" style="display:none;" onclick="CTIAPI.openAssociateLead();"> <span class="ellipsistext w250 crm-heading-font-size crmWhiteColor dB" id="ctiapi_unknown_associated_lead_name"></span> </a> <div class="ctiAddRecord" style="display: none;z-index:999" id=\'ctiapi_unknown_add_associate\'> <a href="javascript:void(0);" class="dB" onclick="CTIAPI.createLead(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+"');\" id='ctiapi_unknown_add_lead'>"+s(t.getI18n.call(o,"crm.label.convert.create.new.module",t.getModFromMap.call(o,"Leads",{name:"getModFromMap",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="dB" onclick="CTIAPI.createContact(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+"');\" id='ctiapi_unknown_add_contact'>"+s(t.getI18n.call(o,"crm.label.convert.create.new.module",t.getModFromMap.call(o,"Contacts",{name:"getModFromMap",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="dB" onclick="CTIAPI.associateLead()" id=\'ctiapi_unknown_associate_lead\'>'+s(t.getI18n.call(o,"crm.tpi.ctiapi.associate.new.module",t.getModFromMap.call(o,"Leads",{name:"getModFromMap",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="dB" onclick="CTIAPI.associateContact();" id=\'ctiapi_unknown_associate_contact\'>'+s(t.getI18n.call(o,"crm.tpi.ctiapi.associate.new.module",t.getModFromMap.call(o,"Contacts",{name:"getModFromMap",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+"</a> </div> "},14:function(e,i,t,a,l){var n;return e.escapeExpression(e.lambda(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.i18nCallState:n,i))},16:function(e,i,t,a,l){return' <div class="crm-small-font-size calingTxt pT5" id="transferusername" style="display:none;"></div> '},18:function(e,i,t,a,l){return'  <div class="crm-small-font-size calingTxt pT5" id="ctiapi_onhold_status_text" style="display:none;">'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.tpi.ctiapi.onhold",{name:"getI18n",hash:{},data:l}))+"</div>  "},20:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <div id="ctiapi_twilio_call_ctrl_bts" style="display:none;"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.answer",{name:"getI18n",hash:{},data:l}))+'" class="mL0 greenbtn call_ctrl_bts" onClick="twilioNotifier.twilioCheckCallStatusAndAccept();" id="ctiapi_inboundcall_answer_button"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" onClick="twilioNotifier.twilioEndCall();" id="ctiapi_call_endcall_button" style="display:none;"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.transfer",{name:"getI18n",hash:{},data:l}))+'" class="newSaveBtn mR10 call_ctrl_bts" onClick="transferInitiate();" id="ctiapi_transfercall_button" style="display:none;"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.connect",{name:"getI18n",hash:{},data:l}))+'" class="primarybtn call_ctrl_bts" onClick="" id="ctiapi_transfercall_connect_button" style="display:none;">  <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn mR10 call_ctrl_bts" onClick="twilioNotifier.twilioEndCall();" id="ctiapi_common_cancel_button" style="display:none;"> </div> '},22:function(e,i,t,a,l){var n,r=null!=i?i:{};return" "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"phonebridge",{name:"if_eq",hash:{},fn:e.program(23,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"AWSlily",{name:"if_eq",hash:{},fn:e.program(25,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiapitype:n,"type4",{name:"if_eq",hash:{},fn:e.program(28,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.source:n,"quickCreate",{name:"if_eq",hash:{},fn:e.program(33,l,0),inverse:e.noop,data:l}))?n:"")+" "},23:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.cancel",{name:"getI18n",hash:{},data:l}))+'" class="newSaveBtn mR10 call_ctrl_bts" onClick="ctiApiNotifier.cancelCall();" id="ctiapi_common_cancel_button" style="display:none;"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.start",{name:"getI18n",hash:{},data:l}))+'" class="greenbtn mR10 call_ctrl_bts" onClick="ctiApiNotifier.new_startTimerManually();" id="ctiapi_zti_start_button"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.stop",{name:"getI18n",hash:{},data:l}))+'" class="redbtn mR10 call_ctrl_bts" onClick="ctiApiNotifier.new_stopTimerManually();" id="ctiapi_zti_stop_button" style="display:none;"> '},25:function(e,i,t,a,l){var n,r=null!=i?i:{};return" "+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.isAnswerable:n,"true",{name:"if_eq",hash:{},fn:e.program(26,l,0),inverse:e.noop,data:l}))?n:"")+' <input type="button" value="'+e.escapeExpression(t.getI18n.call(r,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" onClick="lilyActions.endCall();" id="ctiapi_call_endcall_button"> '},26:function(e,i,t,a,l){return' <input type="button" value="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.tpi.ctiapi.answer",{name:"getI18n",hash:{},data:l}))+'" class="mL0 greenbtn call_ctrl_bts" onClick="lilyActions.answerCall();" id="ctiapi_inboundcall_answer_button"> '},28:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression;return' <div id="ctiapi_type4_call_control" style="display:none;"> '+(null!=(n=t.if_nq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.answerurl:n,"",{name:"if_nq",hash:{},fn:e.program(29,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_nq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.hungupurl:n,"",{name:"if_nq",hash:{},fn:e.program(31,l,0),inverse:e.noop,data:l}))?n:"")+' <input type="button" value="'+s(t.getI18n.call(r,"crm.tpi.ctiapi.transfer",{name:"getI18n",hash:{},data:l}))+'" class="newSaveBtn mR10 call_ctrl_bts" onClick="transferInitiate();" id="ctiapi_transfercall_button" style="display:none;"> <input type="button" value="'+s(t.getI18n.call(r,"crm.tpi.ctiapi.connect",{name:"getI18n",hash:{},data:l}))+'" class="primarybtn call_ctrl_bts" onClick="" id="ctiapi_transfercall_connect_button" style="display:none;"> <input type="button" value="'+s(t.getI18n.call(r,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn mR10 call_ctrl_bts" onClick="ctiApiNotifier.cancelCall();" id="ctiapi_common_cancel_button" style="display:none;"> </div> '},29:function(e,i,t,a,l){return' <input type="button" value="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.tpi.ctiapi.answer",{name:"getI18n",hash:{},data:l}))+'" class="greenbtn call_ctrl_bts" onClick="ctiApiNotifier.type4Answer();" id="ctiapi_inboundcall_answer_button"> '},31:function(e,i,t,a,l){return' <input type="button" value="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" onClick="ctiApiNotifier.type4Hungup();" id="ctiapi_call_endcall_button" style="display:none;> '},33:function(e,i,t,a,l){var n;return" "+(null!=(n=t.ifEquals.call(null!=i?i:{},null!=(n=null!=i?i.ctiapinotifierjson:i)?n.isNewCallView:n,!0,{name:"ifEquals",hash:{},fn:e.program(34,l,0),inverse:e.program(36,l,0),data:l}))?n:"")+" "},34:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.answered",{name:"getI18n",hash:{},data:l}))+'" class="greenbtn call_ctrl_bts" data-zcqa="test_answered" onclick="ctiApiNotifier.getPopup(\'callanswered\');" id="ctiapi_outboundcall_answered_button" > <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.rejected",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" data-zcqa="test_rejected" onclick="ctiApiNotifier.saveCallEntity(false);" id="ctiapi_inboundcall_reject_button" > <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" data-zcqa="test_ended" onclick="ctiApiNotifier.getPopup(\'callhungup\');" id="ctiapi_call_endcall_button" style="display:none;" > '},36:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.answered",{name:"getI18n",hash:{},data:l}))+'" class="greenbtn call_ctrl_bts" data-zcqa="test_answered" onclick="qCreateCall.getPopup(\'callanswered\');" id="ctiapi_outboundcall_answered_button" > <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.rejected",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" data-zcqa="test_rejected" onclick="qCreateCall.rejectCall();" id="ctiapi_inboundcall_reject_button" > <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.endcall",{name:"getI18n",hash:{},data:l}))+'" class="redbtn call_ctrl_bts" data-zcqa="test_ended" onclick="qCreateCall.getPopup(\'callhungup\');" id="ctiapi_call_endcall_button" style="display:none;" > '},38:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return'  <div class="transferDiv" id="ctiapi_calltransfer_to" style="display:none;">  <div class="transferChoose"> <div> <div class="selectElement h30" onclick="" id="ctiapi_calltransfer_to_repslist_selectbox"> <div class="pT4 pL10 pR6"> <span>'+r(t.getI18n.call(n,"crm.label.transfer.to",{name:"getI18n",hash:{},data:l}))+'</span> <a href="javascript:void(0);">&nbsp;</a> </div> </div> <div class="dropdownUsers" id="ctiapi_calltransfer_to_repslistview" style="display:none;"> </div> </div> <div class="mT10"> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.transfer",{name:"getI18n",hash:{},data:l}))+'" class="primarybtn br3" id="ctiapi_calltransfer_to_transfer_button"></input> <input type="button" value="'+r(t.getI18n.call(n,"crm.tpi.ctiapi.cancel",{name:"getI18n",hash:{},data:l}))+'" class="newSaveBtn  br3" id="ctiapi_calltransfer_to_cancel_button"></input> </div> </div> </div> <div class="dialPad" id=\'ctiapi_dialpad\' style="display:none;"> <a href="javascript:void(0);" class="icon_keypad" id="ctiapi_dialpad_bt_keypad" onclick="CTIAPI.keypadShowHide();"><i></i></a> <a href="javascript:void(0);" class="icon_mute" id="ctiapi_dialpad_bt_mute" onclick="TwilioCalls.inform_mute_unmuteChanges();"><i></i></a> <a href="javascript:void(0);" class="icon_hold" id="ctiapi_dialpad_bt_hold" onclick="twilioNotifier.modifyLivecall(\'holdtwiCall\');"><i></i></a> </div> '},40:function(e,i,t,a,l){return' <div class="dialPad" id=\'ctiapi_dialpad\' style="display:none;"> <a href="javascript:void(0);" class="icon_keypad" id="ctiapi_dialpad_bt_keypad" onclick="CTIAPI.keypadShowHide();" style="width:185px;"><i></i></a> <a href="javascript:void(0);" class="icon_hold" id="ctiapi_dialpad_bt_hold" onclick="lilyActions.holdUnhold();" style="width:185px;"><i></i></a> </div> '},42:function(e,i,t,a,l){return' <div class="dialPad" id=\'ctiapi_dialpad\' style="display:none;"> <a href="javascript:void(0);" title="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.button.pause.call",{name:"getI18n",hash:{},data:l}))+'" class="icon_hold" id="ctiapi_dialpad_bt_hold" data-zcqa="test-pauseCall" onclick="ctiApiNotifier.updateHoldState();" style="width:185px;"><i></i></a> </div> '},44:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression;return'  <div class="transferDiv" id="ctiapi_calltransfer_to" style="display:none;">  <div class="transferChoose"> <div> <div class="selectElement h30" onclick="" id="ctiapi_calltransfer_to_repslist_selectbox"> <div class="pT4 pL10 pR6"> <span>'+s(t.getI18n.call(r,"crm.label.transfer.to",{name:"getI18n",hash:{},data:l}))+'</span> <a href="javascript:void(0);">&nbsp;</a> </div> </div> <div class="dropdownUsers" id="ctiapi_calltransfer_to_repslistview" style="display:none;"> </div> </div> <div class="mT10"> <input type="button" value="'+s(t.getI18n.call(r,"crm.tpi.ctiapi.transfer",{name:"getI18n",hash:{},data:l}))+'" class="primarybtn br3" id="ctiapi_calltransfer_to_transfer_button"></input> <input type="button" value="'+s(t.getI18n.call(r,"crm.tpi.ctiapi.cancel",{name:"getI18n",hash:{},data:l}))+'" class="newSaveBtn  br3" id="ctiapi_calltransfer_to_cancel_button"></input> </div> </div> </div> <div class="dialPad" id=\'ctiapi_dialpad\' style="display:none;"> '+(null!=(n=t.if_nq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.keypressurl:n,"",{name:"if_nq",hash:{},fn:e.program(45,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_nq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.muteurl:n,"",{name:"if_nq",hash:{},fn:e.program(47,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_nq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.holdurl:n,"",{name:"if_nq",hash:{},fn:e.program(49,l,0),inverse:e.noop,data:l}))?n:"")+" </div> "},45:function(e,i,t,a,l){return' <a href="javascript:void(0);" class="icon_keypad" id="ctiapi_dialpad_bt_keypad" onclick="CTIAPI.keypadShowHide();" style="width:126px;"><i></i></a> '},47:function(e,i,t,a,l){return' <a href="javascript:void(0);" class="icon_mute" id="ctiapi_dialpad_bt_mute" onclick="ctiApiNotifier.type4Mute_Hold(\'mute\')"  style="width:126px;" ><i></i></a> '},49:function(e,i,t,a,l){return' <a href="javascript:void(0);" class="icon_hold" id="ctiapi_dialpad_bt_hold" onclick="ctiApiNotifier.type4Mute_Hold(\'hold\')"  style="width:118px;" ><i></i></a> '},51:function(e,i,t,a,l){var n,r=null!=i?i:{};return' <div id="ctiapi_dialpad_keypad" style="display:none;" > <div> <input type="text" class="keynotext h20" id="ctiapi_dialpad_keypad_numbers" readonly> <div class="p20 bTop"> <p class="keyBtns"> '+(null!=(n=t.ctiapi_dialpad_keypad.call(r,{name:"ctiapi_dialpad_keypad",hash:{},fn:e.program(52,l,0),inverse:e.noop,data:l}))?n:"")+' </p> </div> <div class="pB10 aligncenter"> <input type="button" onclick="CTIAPI.keypadShowHide()" class="newSaveBtn smallbtn" value="'+e.escapeExpression(t.getI18n.call(r,"crm.button.mass.hide",{name:"getI18n",hash:{},data:l}))+'" > </div> </div> </div> '},52:function(e,i,t,a,l){var n=e.lambda,r=e.escapeExpression;return' <a href="javascript:void(0);" ctiapi_dialpad_keypad_number="ctiapi_dialpad_keypad_number_'+r(n(i,i))+'" onclick="CTIAPI.keypadClick(\''+r(n(i,i))+"')\">"+r(n(i,i))+"</a> "},54:function(e,i,t,a,l){return'  <div id="ctiapi_businesscard"> '+e.escapeExpression(t.ctiapi_businesscard.call(null!=i?i:{},null!=i?i.ctiapinotifierjson:i,{name:"ctiapi_businesscard",hash:{},data:l}))+" </div> "},56:function(e,i,t,a,l){return" "+e.escapeExpression(t.ctiapi_calldesc_div_create.call(null!=i?i:{},null!=i?i.ctiapinotifierjson:i,{name:"ctiapi_calldesc_div_create",hash:{},data:l}))+" "},58:function(e,i,t,a,l){var n,r=null!=i?i:{},s=e.escapeExpression;return' <p class="followDiv" id=\'ctiapi_folloup_call_list\' onclick="ctiApiNotifier.create_EditCalls_CallBack(true);" style="display:none;"> <label class="crmNotFoundColor w150 dIB fL">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.followup.call",{name:"getI18n",hash:{},data:l}))+'</label> <a href="javascript:void(0);" target=\'_blank\' rel=\'noopener\' class="linkblue linkblue fL w150 ellipsistext" id=\'ctiapi_folloup_call_list_subject\'></a> </p> <p class="followDiv" id=\'ctiapi_folloup_event_list\' onclick="ctiApiNotifier.createEvent(true);" style="display:none;"> <label class="crmNotFoundColor  w150 dIB fL">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.followup.event",t.getModuleDisplayName.call(r,!0,!0,{name:"getModuleDisplayName",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</label> <a href="javascript:void(0);" target=\'_blank\' rel=\'noopener\' class="linkblue linkblue fL w150 ellipsistext" id=\'ctiapi_folloup_event_list_subject\'></a> </p> <p class="followDiv" id=\'ctiapi_folloup_task_list\' onclick="ctiApiNotifier.create_EditTaskCallBack(true);" style="display:none;"> <label class="crmNotFoundColor  w150 dIB fL">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.followup.task",{name:"getI18n",hash:{},data:l}))+'</label> <a href="javascript:void(0);" target=\'_blank\' rel=\'noopener\' class="linkblue fL w150 ellipsistext" id=\'ctiapi_folloup_task_list_subject\'></a> </p> <p class="oH followDiv br_top_border4" id=\'ctiapi_folloup_create\' style="display:none;"> <span class="fL w100"><label class="crmBaseColor crm-base-font-size fL">'+s(t.getI18n.call(r,"crm.tpi.ctiapi.followup",{name:"getI18n",hash:{},data:l}))+'</label><i class="icon_right_arrow fL mL10 mT5"></i></span> '+(null!=(n=t.if_eq.call(r,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.recordexist:n,!0,{name:"if_eq",hash:{},fn:e.program(59,l,0),inverse:e.program(61,l,0),data:l}))?n:"")+" </p> "},59:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return' <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_call" id=\'ctiapi_folloup_call_create_lnk\' onclick="ctiApiNotifier.createCall(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityid:n,i))+"','"+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entitymodule:n,i))+"');\">"+s(t.getI18n.call(o,"Call",{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_event" id=\'ctiapi_folloup_event_create_lnk\' onclick="ctiApiNotifier.createEvent();">'+s(t.getI18n.call(o,t.getModuleDisplayName.call(o,!0,!0,{name:"getModuleDisplayName",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_task" id=\'ctiapi_folloup_task_create_lnk\' onclick="ctiApiNotifier.createTask(\''+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityid:n,i))+"','"+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entitymodule:n,i))+"');\">"+s(t.getI18n.call(o,"Task",{name:"getI18n",hash:{},data:l}))+"</a> "},61:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_call" id=\'ctiapi_folloup_call_create_lnk\' onclick=\'ctiApiNotifier.createCall_unknownCaller();\'>'+r(t.getI18n.call(n,"Call",{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_event" id=\'ctiapi_folloup_event_create_lnk\' onclick="ctiApiNotifier.createEvent()">'+r(t.getI18n.call(n,t.getModuleDisplayName.call(n,!0,!0,{name:"getModuleDisplayName",hash:{},data:l}),{name:"getI18n",hash:{},data:l}))+'</a> <a href="javascript:void(0);" class="fL crm-base-font-size link mR20 callPopupfollowActivity" data-zcqa="create_followup_task" id=\'ctiapi_folloup_task_create_lnk\' onclick=\'ctiApiNotifier.createTask_unknownCaller();\'>'+r(t.getI18n.call(n,"Task",{name:"getI18n",hash:{},data:l}))+"</a>  "},63:function(e,i,t,a,l){return' <div class="p20 br_top_border4" id=\'ctiapi_close_bt_div\' style="display:none;"> <input type="button" data-zcqa="callpopup_done" class="newSaveBtn smallbtn" value="'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.button.done",{name:"getI18n",hash:{},data:l}))+'" id=\'crmcall_done_bt\' onclick="ctiApiNotifier.saveCallEntity(true);"> </div> '},65:function(e,i,t,a,l){var n;return' <div class="p20 br_top_border4" id=\'ctiapi_close_bt_div\' style="display:none;"> '+(null!=(n=t.ifAllMatch.call(null!=i?i:{},null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"!=","phonebridge",{name:"ifAllMatch",hash:{},fn:e.program(66,l,0),inverse:e.program(69,l,0),data:l}))?n:"")+" </div> "},66:function(e,i,t,a,l){var n;return" "+(null!=(n=t.if_nq.call(null!=i?i:{},null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"URL",{name:"if_nq",hash:{},fn:e.program(67,l,0),inverse:e.program(69,l,0),data:l}))?n:"")+" "},67:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <input type="button" class="newgreybtn bt-smallnewgraybtn" value="'+r(t.getI18n.call(n,"crm.button.close",{name:"getI18n",hash:{},data:l}))+'" id=\'ctiapi_close_bt\' onclick="ctiApiNotifier.duringNotificationClose(2);" style="display:none;" > <input type="button" class="newSaveBtn dIB fL greenbgtbn bt-smallprimarybtn" value="'+r(t.getI18n.call(n,"crm.button.save",{name:"getI18n",hash:{},data:l}))+'" id=\'ctiapi_save_bt\' onclick="ctiApiNotifier.duringNotificationClose(1);" style="display:none;"> <input type="button" class="newgreybtn bt-smallnewgraybtn" value="'+r(t.getI18n.call(n,"crm.button.cancel",{name:"getI18n",hash:{},data:l}))+'" id=\'ctiapi_cancel_bt\' onclick="ctiApiNotifier.duringNotificationClose(2);" style="display:none;"> '},69:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <input type="button" class="newgreybtn bt-smallnewgraybtn" value="'+r(t.getI18n.call(n,"crm.button.close",{name:"getI18n",hash:{},data:l}))+'" id=\'ctiapi_close_bt\' onclick="ctiApiNotifier.cancelCall();"> <input type="button" class="newSaveBtn dIB fL greenbgtbn bt-smallprimarybtn" value="'+r(t.getI18n.call(n,"crm.button.save",{name:"getI18n",hash:{},data:l}))+'" id=\'ctiapi_save_bt\' onclick=\'ctiApiNotifier.saveCallWithCaid();\' style="display:none;"> <input type="button" class="newgreybtn bt-smallnewgraybtn" value="'+r(t.getI18n.call(n,"crm.button.cancel",{name:"getI18n",hash:{},data:l}))+"\" id='ctiapi_cancel_bt' onclick='ctiApiNotifier.cancelCall();' style=\"display:none;\"> "},71:function(e,i,t,a,l){var n=null!=i?i:{},r=e.escapeExpression;return' <div id="followUpCallHeader" class="contHeadInfo pL20 pR20"></div> <div class="callNotifyScrollFade pR"></div> <div id="followUpCallFields" class="maxH550 oA pL20 pR20"></div> <div class="cBoth"></div> <div class="p20 mT0 br_top_border4 alignRight"> <input type="button" data-zcqa="done_followup_call" class="primarybtn dIB smallbtn fR" value="'+r(t.getI18n.call(n,"crm.button.done",{name:"getI18n",hash:{},data:l}))+'" id="ctiapiCallAddBt" onclick=\'ctiApiNotifier.doneFollowUpCall(this);\'> <input type="button" data-zcqa="cancel_followup_call" class="newgraybtn smallbtn" value="'+r(t.getI18n.call(n,"crm.button.cancel",{name:"getI18n",hash:{},data:l}))+'" onclick="ctiApiNotifier.cancelCalls();"> <a href="javascript:void(0);" class="crmNegativeColor fL" data-zcqa="delete_followup_call" id="removeCalls_link" style="display:none;" onclick="ctiApiNotifier.deleteCalls();">Remove</a> </div> <input type="hidden" id="createFollowUpCallParameters"></input> '},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,l){var n,r=e.lambda,s=e.escapeExpression,o=null!=i?i:{};return'   <input type="hidden" id="ctiapi_known_caller" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.recordexist:n,i))+'"></input> <input type="hidden" id="is_call_created" value="false"></input> <input type="hidden" id="is_task_created" value="false"></input> <input type="hidden" id="is_event_created" value="false"></input> <input type="hidden" id="is_contact_created" value="false"></input> <input type="hidden" id="is_lead_created" value="false"></input> <input type="hidden" id="is_contact_associated" value="false"></input> <input type="hidden" id="is_lead_associated" value="false"></input> <input type="hidden" id="popupFrom" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.source:n,i))+'"></input> <input type="hidden" id="createParameters" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.createParamJson:n,i))+'"></input> <input type="hidden" id="c2cFormParamPresent" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.activityCallBackParams:n,i))+'"></input> <form name="ctiapicontactsearch" onsubmit="return false;"> <input type="hidden" id="Ctiapi_associated_contact_id"> <input type="hidden" id="Ctiapi_associated_contact_name"> <input type="hidden" name="property(modname)" id="Ctiapi_associated_contact_modname" value=""> <input type="hidden" name="property(modid)" id="Ctiapi_associated_contact_modid" > <input type="hidden" name="property(modsel)" id="Ctiapi_associated_contact_modsel" value="Accounts"> </form> <form name="ctiapileadsearch" onsubmit="return false;"> <input type="hidden" id="Ctiapi_associated_lead_id"> <input type="hidden" id="Ctiapi_associated_lead_name"> </form> <input type="hidden" id="remindercallactivityid" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.caid:n,i))+'"></input> <input type="hidden" id="zticallid" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.zticallid:n,i))+'"></input> <input type="hidden" id="callrefid" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callrefid:n,i))+'"></input> <input type="hidden" id="callId" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callId:n,i))+'"></input> <input type="hidden" id="childcallrefid"></input> <input type="hidden" id="iscallrecording" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callrecording:n,i))+'"></input> <input type="hidden" id="call_ctinumber" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callnumber:n,i))+'"></input> <input type="hidden" id="call_custnumber" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.custnumber:n,i))+'"></input> <input type="hidden" id="call_type" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.calltype:n,i))+'"></input> <input type="hidden" id="call_desc_presence" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callDescPre:n,i))+'"></input> <input type="hidden" id="call_desc_mandatory" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callDescMandatory:n,i))+'"> <input type="hidden" id="Ctiapi_entityId" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityid:n,i))+'"></input> <input type="hidden" id="Ctiapi_entityModule" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entitymodule:n,i))+'"></input> <input type="hidden" id="Ctiapi_entityName" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.entityname:n,i))+'"></input> <input type="hidden" id="Ctiapi_relatedEntityId" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.extraid:n,i))+'"></input> <input type="hidden" id="Ctiapi_relatedEntityModule" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.extramodule:n,i))+'"></input> <input type="hidden" id="Ctiapi_relatedEntityName" value="'+s(r(null!=(n=null!=i?i.ctiapinotifierjson:i)?n.extradetails:n,i))+'"></input> '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"twilio",{name:"if_eq",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?n:"")+' <div class="crm-font-regular" id=\'ctiapi_calltransfer_freezelayer\'> <div class="ctiChatmain" id="ctiapi_chatmain" style="overflow:inherit;"> <div id="callpopup" class="ctiChatmainLeft" style="overflow:inherit;">  <div class="chatPopTitle oH" > <table> <tr> '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiapitype:n,"type4",{name:"if_eq",hash:{},fn:e.program(3,l,0),inverse:e.program(5,l,0),data:l}))?n:"")+' <td> <div class="fL pL25"> '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.isNewCallView:n,!0,{name:"if_eq",hash:{},fn:e.program(7,l,0),inverse:e.program(9,l,0),data:l}))?n:"")+' <div class="crm-small-font-size calingTxt pT5 cBoth" id="ctiapi_present_callstate"> '+(null!=(n=t.if.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.i18nCallState:n,{name:"if",hash:{},fn:e.program(14,l,0),inverse:e.noop,data:l}))?n:"")+"</div> "+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiapitype:n,"type4",{name:"if_eq",hash:{},fn:e.program(16,l,0),inverse:e.noop,data:l}))?n:"")+'  <div class="crm-small-font-size calingTxt pT5 cBoth" id="ctiapi_calltimer" style="display:none;"> <span> <span class="crm-small-font-size" id="ctiapi_calltimer_min">00</span>&nbsp;:&nbsp;<span class="crm-small-font-size" id="ctiapi_calltimer_sec">00</span> </span> </div>  '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"twilio",{name:"if_eq",hash:{},fn:e.program(18,l,0),inverse:e.noop,data:l}))?n:"")+' <div class="mT10" > '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"twilio",{name:"if_eq",hash:{},fn:e.program(20,l,0),inverse:e.program(22,l,0),data:l}))?n:"")+" </div> </div> </td> </tr> </table> </div> "+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"twilio",{name:"if_eq",hash:{},fn:e.program(38,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"AWSlily",{name:"if_eq",hash:{},fn:e.program(40,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.source:n,"quickCreate",{name:"if_eq",hash:{},fn:e.program(42,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiapitype:n,"type4",{name:"if_eq",hash:{},fn:e.program(44,l,0),inverse:e.noop,data:l}))?n:"")+'  <div class="chatContainer pR"> '+(null!=(n=t.ifAnyMatch.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"=","twilio",null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiapitype:n,"=","type4",null!=(n=null!=i?i.ctiapinotifierjson:i)?n.ctiname:n,"=","AWSlily",{name:"ifAnyMatch",hash:{},fn:e.program(51,l,0),inverse:e.noop,data:l}))?n:"")+' <div class="pR callNotifyScrollFade mT5"> <div class="callNotifyInScroll oA" onscroll="ctiApiNotifier.hideMultiPotentialTable(this)"> '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.recordexist:n,!0,{name:"if_eq",hash:{},fn:e.program(54,l,0),inverse:e.noop,data:l}))?n:"")+" "+(null!=(n=t.if.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.callDescPre:n,{name:"if",hash:{},fn:e.program(56,l,0),inverse:e.noop,data:l}))?n:"")+" </div> </div> "+(null!=(n=t.checkUserPermission.call(o,"Crm_Implied_Create_Activities",{name:"checkUserPermission",hash:{},fn:e.program(58,l,0),inverse:e.noop,data:l}))?n:"")+' <div class="p20 br_top_border4" id="agentdispdiv" style="display:none;" > Call result :<select id="agentdisp" onchange="CTIAPI.decideShowHide_CloseBT()"> </select> </div> '+(null!=(n=t.if_eq.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.isNewCallView:n,!0,{name:"if_eq",hash:{},fn:e.program(63,l,0),inverse:e.program(65,l,0),data:l}))?n:"")+' </div> </div> <div class="ctiChatmainRight ctiapi_activitys" id="ctiapi_activitys_create_call" style="display:none;"> '+(null!=(n=t.ifEquals.call(o,null!=(n=null!=i?i.ctiapinotifierjson:i)?n.isNewCallView:n,!0,{name:"ifEquals",hash:{},fn:e.program(71,l,0),inverse:e.noop,data:l}))?n:"")+' </div> <div class="ctiChatmainRight ctiapi_activitys" id="ctiapi_activitys_create_task" style="display:none;"></div>  </div> </div>  '},useData:!0})}();