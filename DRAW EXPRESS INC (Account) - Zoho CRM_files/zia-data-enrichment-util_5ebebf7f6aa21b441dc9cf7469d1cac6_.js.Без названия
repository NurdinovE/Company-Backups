Lyte.Mixin.register("enrichment-utils",{getOrgModules(){const e=store.peekRecord("data_enrichment_count","1");return e&&e.modules.length?Promise.resolve(e):store.triggerAction("data_enrichment_count","get_modules")},PopulateMeta(e,t){const a={module:store.peekRecord("module",e).api_name,type:t},i=store.peekRecord("zia-data-enrichment-meta",e);return i&&i.type===t?Promise.resolve(i):store.findAll("zia-data-enrichment-meta",a)},PopulateModuleFields(e){const t=store.peekRecord("module",e);return t&&t.fields&&t.fields.length?Promise.resolve(t):store.findAll("field",{module:t.api_name})},getConfigForModule:e=>store.peekAll("data_enrichment").length?store.peekAll("data_enrichment").find((t=>"204"!==t.id&&t.status&&t.module.id===e)):null,getAllConfigs:(e=!1)=>store.peekAll("data_enrichment").length||e?Promise.resolve(store.peekAll("data_enrichment")):store.findAll("data_enrichment"),getConfig:e=>e.trigger_fields&&e.trigger_fields.length&&e.enrich_fields&&e.enrich_fields.length?e:store.findRecord("data_enrichment",e.id),getConfigResolved:e=>e.trigger_fields&&e.trigger_fields.length&&e.enrich_fields&&e.enrich_fields.length?Promise.resolve(e):store.findRecord("data_enrichment",e.id),getEnrichmentLimits:(e=!1)=>e||!store.peekRecord("data_enrichment_count","1")?store.findAll("data_enrichment_count"):Promise.resolve(store.peekRecord("data_enrichment_count","1")),getEnrichmentGlobalList:e=>[{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.industries")},suggested_values:["Services","Construction Industries","Agriculture","Utilities","All Kind Of Personal Services","Textile and Apparel Industries","Manufacturing Industries","Health Care Industries","Food Industries","AutomobileIndustry","Mining Industries","Transportation/Warehousing and Postal Services","Finance and Real Estate Industries","Wholesale and Retail Dealers","Computer Programming Services","Public Administrative Services","Publishing/Printing Related Activities","Publishing and Printing Related Activities","Accounting Related Services","Financial Services","Insurance Services","Real Estate","Agricultural Services","Crops Production","Forestry","Retail Nurseries and Garden Supply Stores","Livestock Production or Fishing/Hunting Related Activities","Automobile Dealers","Automobile Manufacturing","Automobile Rental/Repair Services and Parking","Transportation Equipment Manufacturing and Dealers","Construction and Related Activities","Non-Metallic Mineral and Construction Material Manufacturing","Lumber and Construction Material Dealers","Drug Manufacturing and Drug Stores","Health Services","Medical Equipment Manufacturing and Dealers","Veterinary Hospitals and Services","Electric/Sanitary/Gas and Pipelines Services","Communications","Air or Railroad or Water Transportation Services and Dealers","Warehousing","Transportation Related Services","Postal and Courier Services","Taxi/Bus or Local Suburban Transits","Beauty shop/Barber shop and Beauty Supply Stores","Building Cleaning and Pest Control Services","Laundry/Cleaning and Garment Services","Personal Services","Funeral Services and Crematories","Textile or Apparel Dealers and Stores","Textile or Apparel Manufacturing","Food and Beverage Manufacturing","Food and Grocery Stores","Restaurants and Related Services","Membership Organizations","Tobacco and Alcoholic Products Manufacturing and Dealers","Oil/Gas Extraction Refining and Dealers","Mining Related Services and Dealers","Chemical Products Manufacturing and Dealers","Electrical Equipment/Appliances Manufacturing and Dealers","Electronics or Computer or Office equipments Manufacturing and Dealers","Industrial and Commercial Machines Manufacturing and Dealers","Measuring Equipment Manufacturing and Dealers","Metal and Metal Products Manufacturing and Dealers","Miscellaneous Manufacturing and Related Activities","Paper Products Manufacturing and Dealers","Rubber/Leather and Miscellaneous Plastic Products Manufacturing and Dealers","Wood and Furniture Manufacturing and Dealers","Arts/Entertainment and Recreation Related Services","Business Related Services","Day Care Services","Educational Services","Motion Pictures and Recording Related Industries","Employment Agencies","Engineering and Scientific Research Related Services"]},{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.address.country")},suggested_values:["Andorra - AD","United Arab Emirates - AE","Afghanistan - AF","Antigua and Barbuda - AG","Anguilla - AI","Albania - AL","Armenia - AM","Angola - AO","Antarctica - AQ","Argentina - AR","American Samoa - AS","Austria - AT","Australia - AU","Aruba - AW","Aland Islands - AX","Azerbaijan - AZ","Bosnia and Herzegovina - BA","Barbados - BB","Bangladesh - BD","Belgium - BE","Burkina Faso - BF","Bulgaria - BG","Bahrain - BH","Burundi - BI","Benin - BJ","Saint Barthelemy - BL","Bermuda - BM","Brunei - BN","Bolivia - BO","Bonaire - BQ","Brazil - BR","Bahamas - BS","Bhutan - BT","Bouvet Island - BV","Botswana - BW","Belarus - BY","Belize - BZ","Canada - CA","Cocos Islands - CC","Democratic Republic of the Congo - CD","Central African Republic - CF","Republic of the Congo - CG","Switzerland - CH","Ivory Coast - CI","Cook Islands - CK","Chile - CL","Cameroon - CM","China - CN","Colombia - CO","Costa Rica - CR","Cuba - CU","Cape Verde - CV","Curacao - CW","Christmas Island - CX","Cyprus - CY","Czechia - CZ","Germany - DE","Djibouti - DJ","Denmark - DK","Dominica - DM","Dominican Republic - DO","Algeria - DZ","Ecuador - EC","Estonia - EE","Egypt - EG","Western Sahara - EH","Eritrea - ER","Spain - ES","Ethiopia - ET","Finland - FI","Fiji - FJ","Falkland Islands - FK","Micronesia - FM","Faroe Islands - FO","France - FR","Gabon - GA","United Kingdom - GB","Grenada - GD","Georgia - GE","French Guiana - GF","Guernsey - GG","Ghana - GH","Gibraltar - GI","Greenland - GL","Gambia - GM","Guinea - GN","Guadeloupe - GP","Equatorial Guinea - GQ","Greece - GR","South Georgia and the South Sandwich Islands - GS","Guatemala - GT","Guam - GU","Guinea-Bissau - GW","Guyana - GY","Hong Kong - HK","Heard Island and McDonald Islands - HM","Honduras - HN","Croatia - HR","Haiti - HT","Hungary - HU","Indonesia - ID","Ireland - IE","Israel - IL","Isle of Man - IM","India - IN","British Indian Ocean Territory - IO","Iraq - IQ","Iran - IR","Iceland - IS","Italy - IT","Jersey - JE","Jamaica - JM","Jordan - JO","Japan - JP","Kenya - KE","Kyrgyzstan - KG","Cambodia - KH","Kiribati - KI","Comoros - KM","Saint Kitts and Nevis - KN","North Korea - KP","South Korea - KR","Kosovo - XK","Kuwait - KW","Cayman Islands - KY","Kazakhstan - KZ","Laos - LA","Lebanon - LB","Saint Lucia - LC","Liechtenstein - LI","Sri Lanka - LK","Liberia - LR","Lesotho - LS","Lithuania - LT","Luxembourg - LU","Latvia - LV","Libya - LY","Morocco - MA","Monaco - MC","Moldova - MD","Montenegro - ME","Saint Martin - MF","Madagascar - MG","Marshall Islands - MH","North Macedonia - MK","Mali - ML","Myanmar - MM","Mongolia - MN","Macau - MO","Northern Mariana Islands - MP","Martinique - MQ","Mauritania - MR","Montserrat - MS"]},{enrich_field:{name:I18n.getMsg("crm.skyeye.fields.business.type")},suggested_values:["Public Limited Company","Private Limited Company","Government Agencies","Privately Held","Non Profit","Sole Proprietorship","Conglomerate","Subsidiary","Partnership","Employed"]},{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.business.size")},suggested_values:["Start-up Company","Micro Business","Small to Medium Business","Small to Medium Enterprise","Large Enterprise","Unclassified Organization"]},{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.business.model")},suggested_values:["Business to Business","Business to consumer","Business to government"]},{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.deg")},suggested_values:["associate of arts","associates","bachelor of aerospace engineering","bachelor of applied science","bachelor of architecture","bachelor of arts","bachelor of arts in business administration","bachelor of arts in communication","bachelor of arts in education","bachelor of biosystems engineering","bachelor of business administration","bachelor of civil engineering","bachelor of commerce","bachelor of design","bachelor of education","bachelor of electrical engineering","bachelor of engineering","bachelor of fine arts","bachelor of general studies","bachelor of industrial & systems engineering","bachelor of industrial design","bachelor of interdisciplinary studies","bachelor of interior architecture","bachelor of law","bachelor of liberal arts","bachelor of liberal arts and sciences","bachelor of mathematics","bachelor of mechanical engineering","bachelor of medicine","bachelor of music","bachelor of music education","bachelor of pharmacy","bachelor of science","bachelor of science in aerospace engineering","bachelor of science in business administration","bachelor of science in chemistry","bachelor of science in civil engineering","bachelor of science in commerce business administration","bachelor of science in computer science","bachelor of science in education","bachelor of science in electrical engineering","bachelor of science in engineering","bachelor of science in engineering technology","bachelor of science in geology","bachelor of science in human environmental sciences","bachelor of science in materials engineering","bachelor of science in mechanical engineering","bachelor of science in metallurgical engineering","bachelor of science in nursing","bachelor of science in social work","bachelor of social work","bachelor of software engineering","bachelor of technology","bachelor of textile engineering","bachelor of veterinary science","bachelor of wireless engineering","bachelors","doctor of audiology","doctor of business administration","doctor of chiropractic","doctor of dental surgery","doctor of education","doctor of jurisprudence","doctor of medical dentistry","doctor of medicine","doctor of ministry","doctor of musical arts","doctor of nursing practice","doctor of optometry","doctor of pharmacy","doctor of philosophy","doctor of physical therapy","doctor of psychology","doctor of public health","doctor of science","doctor of veterinary medicine","doctorates","magister juris","magisters","master of accountancy","master of accounting","master of aerospace engineering","master of agriculture","master of applied mathematics","master of arts","master of arts in education","master of arts in teaching","master of building construction","master of business administration","master of civil engineering","master of commerce","master of communication disorders","master of dental surgery","master of design","master of divinity","master of education","master of electrical engineering","master of engineering","master of fine arts","master of health science","master of international studies","master of laws","master of liberal arts","master of library & information studies","master of library science","master of mechanical engineering","master of music","master of natural resources","master of nurse anesthesia","master of political science","master of professional studies","master of public administration","master of public health","master of real estate development","master of rehabilitation counseling","master of science","master of science in aerospace engineering","master of science in biomedical engineering","master of science in civil engineering","master of science in computer science","master of science in criminal justice","master of science in education","master of science in electrical engineering","master of science in forensic science","master of science in health administration","master of science in health informatics","master of science in industrial engineering","master of science in information systems","master of science in materials engineering","master of science in mechanical engineering","master of science in nursing","master of science in occupational therapy","master of science in operations research","master of science in physician assistant studies","master of science in public health","master of science in software engineering","master of social work","master of software engineering","master of tax accounting","master of taxation","master of technology","master of urban and regional planning","masters"]},{enrich_field:{name:I18n.getMsg("crm.label.auto.enrich.education")},suggested_values:["3d modelling","3d modelling and animation","accountancy","accounting","acting","actuarial science","addiction counseling","administration","administration of justice","advertising","aerospace and aeronautical engineering","aerospace engineering","african american studies","african culture","african language","african language studies","african languages","african literature","african studies","africana studies","afrikaans","agricultural economics","agricultural engineering","agriculture","agriculture production","agriculture production and management","agronomy","airway science","american history","american indian studies","american literature","american sign language","american studies","anatomy","ancient civilizations","anesthesiology","animal behavior","animal bioscience","animal science","animation","anthropology","anthropology and archeology","apparel and merchandising","apparel and textiles","apparel design","applied economics","applied graphic design","applied linguistics","applied mathematics","applied physics","applied psychology","applied science","applied statistics","aquaculture","aquatics","arabic","arabic language","arabic language and culture","arabic language and literature","arabic language studies","arabic languages","arabic literature","arabic studies","archeology","architectural engineering","architecture","architecture and engineering","art","art and design","art education","art history","art therapy","asian american studies","asian studies","astrology","astronomy","astronomy and astrophysics","astrophysics","atmospheric science","atmospheric science and meteorology","audiology","automotive mechanics","aviation","avionic systems","avionics","avionics maintenance","baking","baking and pastry art","balkan studies","ballet","baltic languages","baltic studies","banking","behavioral science","behavioural science","biblical preaching","biblical studies","biobehavioral health","biochemical engineering","biochemical science","biochemistry","bioengineering","bioinformatics","biological engineering","biological science","biology","biomedical engineering","biomedical science","biophysics","biotechnology","botany","brass instruments","british literature","broadcast and cinematic art","broadcast journalism","broadcasting","buddhist studies","bulgarian","bulgarian language","bulgarian language and literature","bulgarian languages","bulgarian literature","bulgarian studies","business","business admin","business administration","business administration and management","business and medical administration","business economics","business finance","business law","business management","business management and administration","business marketing","business studies","celtic studies","ceramics","chemical engineering","chemistry","chicano","chicano studies","child and adolescent development","child development","chinese","chinese culture","chinese language","chinese language and culture","chinese language and literature","chinese language studies","chinese languages","chinese literature","chinese literature and culture","chinese studies","choral conducting","christian administration","christian preaching","civil engineering","classical culture","classical language","classical languages","classical literature","classical studies","classics","clinical nurse","clinical nursing","clinical psychology","coaching","cognitive science","college student affairs","commerce","commercial art","commercial science","commercial studies","communication","communication art","communication disorders science and services","communication management","communication studies","communication tech","communications","communications and media studies","community","community and public health","community development","comp lit","comp sci","comparative literature","comparative race and ethnic studies","comparative religious studies","composition","composition and rhetoric","computer","computer and information science","computer and information systems","computer application","computer applications","computer engineering","computer graphics","computer information systems","computer networking and telecommunications","computer programming","computer programming and data processing","computer science","computer science and electrical engineering","computer science and engineering","computer science and mathematics","computer systems","computer systems engineering","computer systems management","computer tech","conducting","conflict resolution","construction","construction and land development","construction management","construction services","consulting","consulting and sales","consumer science","corporate finance","corporate law","corrections","cosmetology","counseling","counseling psychology","court reporting","creative writing","criminal justice","criminology","culinary art","culinary arts","curriculum and instruction","curriculum supervision","customer service","customer service management","cybersecurity","czech","czech language","czech language and culture","czech language and literature","czech languages","czech literature","czech studies","dance","dance performance","danish","danish culture","danish language","danish language and culture","danish language and literature","danish language studies","danish literature","danish studies","data science","demography","dental hygiene","dental tech","dentistry","design","digital art","digital video","digital video and cinema","digital visual effects","disability studies","distribution management","diversity studies","divinity","documentary production","drama","drawing","drug development","dutch","dutch culture","dutch language","dutch language and culture","dutch"]}].filter((t=>!("personal"===e?[I18n.getMsg("crm.label.auto.enrich.business.model"),I18n.getMsg("crm.label.auto.enrich.business.size"),I18n.getMsg("crm.skyeye.fields.business.type")]:[I18n.getMsg("crm.label.auto.enrich.deg"),I18n.getMsg("crm.label.auto.enrich.education")]).includes(t.enrich_field.name))),beforeFieldShowDrop:function(e,t,a,i){i.$node.parentNode.component.setData("cxPropOptions",this.getDropDownFields(e,t,a))},getSpecialCharacter:function(e){let t=e.match(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/);return t?Array.from(new Set(t.join("").split("")))[0]:"?!@"},ConstructEnrichFields(e){let t=[];const a=e.length;for(let i=0;i<a;i++){const n=this.getSpecialCharacter(e[i].display_label);if(e[i].display_label.split(n).length>=2){let r={};r.display_label=e[i].display_label.split(n)[0].trim();let s=[];const o=e[i].display_label.split(n).length;for(;i<a&&o>=2;){if(e[i].display_label.split(n)[0].trim()!==r.display_label){i--;break}{let t={};t.display_label=e[i].display_label.split(n)[1].trim(),t.enrich_field=e[i].enrich_field,t.crm_fields=e[i].crm_fields,s.push(t),i++}}r.sub_fields=s,t.push(r)}else t.push(e[i])}return t},getFieldsMapping:function(e,t){return Object.keys(e).map((a=>({enrich_field:{name:a,display_label:t.find((e=>e.enrich_field===a)).display_label},crm_field:""===e[a]?null:{id:e[a],api_name:store.peekRecord("field",e[a]).api_name,name:store.peekRecord("field",e[a]).field_label}})))},openExtensionUrl:function(){networkUtils.openUrl("true"===RebrandLinkUtil.getProperties("IS_LOCAL_ZOHO").IS_LOCAL_ZOHO?"/crm/settings/extensions/all/webamigo?tab=webInteg&subTab=marketPlace&nameSpace=webamigo&portalName=yogeswaran1&install=true&versionIndex=908087000000137001&":"/market/installPlugin.do?portalName=sysadmin4&nameSpace=webamigoleadenrichment")},showExtensionError:function(e){const t="true"===RebrandLinkUtil.getProperties("IS_LOCAL_ZOHO").IS_LOCAL_ZOHO?"/crm/settings/extensions/all/webamigo?tab=webInteg&subTab=marketPlace&nameSpace=webamigo&portalName=yogeswaran1&install=true&versionIndex=908087000000137001&":"/market/installPlugin.do?portalName=sysadmin4&nameSpace=webamigoleadenrichment";_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropOutputNode:e,ltPropYield:!0,cxPropFooterYield:!0,ltPropShowCloseButton:!0,ltPropPrimaryMessage:I18n.getMsg("crm.auto.enrich.ext.failed"),ltPropSecondaryMessage:I18n.getMsg("crm.auto.enrich.ext.check")+"<div class='flexAlignCenter gap5 crmLinkColor cP mT15'> <span class='zcicncss-expandsm zcicn-cssIcons zcicn_blue_mask'></span> <a href='"+t+"' target='_blank' rel='noopener noreferrer' data-zcqa='extensionLink'>"+I18n.getMsg("crm.campaign.visit.campaigns.dynamic",I18n.getMsg("crm.auto.enrich.web.amigo"))+"</a></div>"}})},RemoveDisplayLabel:function(e){return e.filter((e=>e.crm_field)).map((e=>{const t={},a={};return Object.keys(e.enrich_field).filter((e=>"display_label"!==e)).forEach((a=>t[a]=e.enrich_field[a])),Object.keys(e.crm_field).filter((e=>"name"!==e)).forEach((t=>a[t]=e.crm_field[t])),{...e,enrich_field:t,crm_field:a}}))},TrackForEnrichClick:function(e,t,a,i){switch(e){case"create":case"edit":case"form_edit":case"form_create":Crm.client_tracking(a,{Module:t,enrich_type:i,Place:"Create"});break;case"detail":case"canvas_detail":Crm.client_tracking(a,{Module:t,enrich_type:i,Place:"Detail View"});break;case"email":Crm.client_tracking(a,{Module:t,enrich_type:i,Place:"Email"});break;case"config":if(!t)return void Crm.client_tracking(a);let e={};"object"==typeof t?e=t:e.Module=t,i&&(e.enrich_type=i),Crm.client_tracking(a,e)}},idValidField:function(e,t,a,i){if(!t||!a)return!1;const n=store.peekRecord("field",t);return n&&!n.read_only&&!n.private&&!n.hipaa_compliance_enabled&&n.visible&&n.layouts&&n.layouts.some((e=>e.id===a))&&!n.global_picklist&&!this.getLayoutHiddenFields(e,a,i).includes(n.column_name)},getDropDownFields:function(e,t,a){let i=e.filter((e=>e.id!==t&&!a.includes(e.id)));return t?i.some((e=>""===e.id))||i.push({field_label:I18n.getMsg("crm.label.field.do.not.map"),id:""}):i=i.filter((e=>""!==e.id)),i},triggerDataEnrichment(e,t,a){"clone"===a||"form_clone"===a||Crm.userDetails.CLIENT_ACCOUNT||!e||Crm.userDetails.isSandbox||"Leads"!==t&&"Accounts"!==t&&"Contacts"!==t&&"Vendors"!==t&&!t.startsWith("CustomModule")||!["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)||this.CheckTriggerData(a,null,t,e)},CheckTriggerData(e,t,a,i){const n=this;n.getEnrichmentLimits().then((function(r){if((r=r[0]?r[0]:r)&&r.status&&r.enrich_count&&r.enrich_count.used_count<=r.enrich_count.limit){let s=networkUtils.returnDependencyFiles(["crm-ui-loaders.js","zia-data-enrichment-popup.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["crm-ui-loaders.css"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["crm-data-enrichment-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment"),"zohocrm_blueprintexport.js"],ResourceConstants.CRM),d=s.concat(o).concat(l).concat(c);Lyte.injectResources(d,void 0,(function(){n.processTriggerData(e,t,a,i,r)}))}}),(function(e){e=(e=JSON.parse(e.response)).__features?e.__features[0]?e.__features[0]:e.__features:e,n.showErrorMessage(e.message)}))},processTriggerData:function(e,t,a,i,n){const r=this;r.getAllConfigs(!1).then((function(s){const o=(s=s.data_enrichment?s.data_enrichment:s).find((e=>"204"!==e.id&&(!("organization"===e.type)||e.status)&&e.module.id===moduleRecordMapping[a].id));o&&("personal"!==o.type||Crm.isPeopleEnrichmentEnabled)?o&&"personal"===o.type&&!n.people_enrichment&&["canvas_detail","detail","email"].includes(e)?r.showExtensionError(Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().component?Lyte.Router.getRouteInstance().component:Lyte.Router.getRouteInstance().ORComponent?Lyte.Router.getRouteInstance().ORComponent:Lyte.Router.getRouteInstance().outlet:void 0):r.getConfigResolved(o).then((function(s){if(!(s=s.data_enrichment?s.data_enrichment[0]:s[0]?s[0]:s))return;const o="personal"===s.type&&n.people_enrichment&&("Leads"===a||"Contacts"===a?["First_Name","Last_Name"]:[moduleRecordMapping[a].display_field.api_name]).includes(i);if("create"!==e&&"edit"!==e&&"form_create"!==e&&"form_edit"!==e||!i||!o&&!s.trigger_fields.some((e=>e.crm_field&&e.crm_field.api_name===i)))if("edit"!==e&&"form_edit"!==e||i){if("detail"===e||"canvas_detail"===e){let i="canvas_detail"===e?$L("crm-detailview-canvas")[0]:$L("crm-detailview-header")[0];if(!i||!i.component)return;i=i.component;let o={};if(s.trigger_fields.filter((a=>a.crm_field&&r.idValidField(e,a.crm_field.id,i.data.layoutId,i.data.currentInstObjKey)&&t[a.crm_field.api_name]&&""!==t[a.crm_field.api_name].trim())).forEach((function(e){o[e.enrich_field.name]=t[e.crm_field.api_name]})),"personal"===s.type){if(!n.people_enrichment)return void r.showErrorMessage(I18n.getMsg("crm.auto.enrich.ext.info"));o.name=t[moduleRecordMapping[a].display_field.api_name],o=r.checkPeopleTriggerFields(s,o)}if(validationUtils.isNotEmpty(o)){let n={triggerSelected:o,triggerChanged:{...o},moduleName:a,layoutData:t,parentType:e,layoutId:i.data.layoutId,entityId:"detail"===e&&Crm.renderDVLyteFlow(a)?i.data.record_id:i.data.entityId};Lyte.Component.render("crm-data-enrichment",n,"#enrichDiv");let c=$L("crm-data-enrichment")[0];c&&(c=c.component,c.setData(n),c.setCriteriaArr(),r.TrackForEnrichClick(e,a,"Data Enrichment - Enrich Data Click",s.type),r.CreateEnrichment(c))}else r.showErrorMessage(I18n.getMsg("crm.label.auto.enrich.empty.data"))}else if("email"===e){let i="canvas"===Lyte.Router.getRouteInstance().routeName?$L("crm-detailview-canvas")[0]:$L("crm-detailview-header")[0];if(i){if("personal"===s.type&&!n.people_enrichment)return void r.showErrorMessage(I18n.getMsg("crm.auto.enrich.ext.info"));i=i.component;const o=t.replace(/<[^>]*>/g," ").replace(/<br\s*\/?>/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim();store.triggerAction("data_enrichment","enrich_text",{text:o}).then((function(t){if(!(t=t.__zia_extracted_text_details)||"success"!==t.status||!t.details.extracted_values)return void r.showErrorMessage(I18n.getMsg("crm.label.auto.enrich.empty.data"));const n={org_name:"organization",org_website:"website",email:"email",name:"person",twitter:"twitter",facebook:"facebook",linkedin:"linkedin"};let c=s.trigger_fields.filter((e=>e.crm_field)).map((e=>e.enrich_field.name));"personal"===s.type&&(c.includes("org_name")||c.includes("org_website"))&&c.push("name");let l=t.details.extracted_values.filter((e=>Object.entries(n).some((t=>t[1]===e.type&&c.includes(t[0])))));if(0===l.length)return void r.showErrorMessage(I18n.getMsg("crm.label.auto.enrich.empty.data"));let d={},m=[];if(c.forEach((e=>{let t=l.filter((t=>t.type===n[e]));t&&t.forEach((e=>{e.values=e.values.reduce(((e,t)=>t.score>e.score?t:e),e.values[0]),m.push(e)}))})),"personal"===s.type){if(c.includes("twitter")){const e=o.match(/(https?:\/\/)?(www\.)?twitter\.com\/([\w\/-]+)/g);e&&e.length&&m.push({type:"twitter",values:{value:e[0]}})}if(c.includes("facebook")){const e=o.match(/(https?:\/\/)?(www\.)?facebook\.com\/([\w\/-]+)/g);e&&e.length&&m.push({type:"facebook",values:{value:e[0]}})}if(c.includes("linkedin")){const e=o.match(/(https?:\/\/)?(www\.)?linkedin\.com\/([\w\/-]+)/g);e&&e.length&&m.push({type:"linkedin",values:{value:e[0]}})}}let u=[];if(1===m.length)u=m;else{const e=m.length;for(let t=0;t<e;t++){const a=[],i=m[t].values.value.toLowerCase(),n=i.length;for(let r=t+1;r<e;r++){const e=m[r].values.value.toLowerCase(),s=e.length;for(let t=0;t<n;t++)for(let r=t+1;r<=n;r++){const n=i.substring(t,r);for(let t=0;t<s;t++)for(let i=t+1;i<=s;i++){n===e.substring(t,i)&&a.push(n)}}const o=a.filter((e=>/^[a-zA-Z0-9]+$/.test(e))).reduce(((e,t)=>t.length>e.length?t:e),"");o&&o.length>3&&i.includes(o)&&e.includes(o)&&(u.some((e=>e.type===m[t].type))||u.push(m[t]),u.some((e=>e.type===m[r].type))||u.push(m[r]))}}u=u.length?u:m.find((e=>("personal"===s.type?["email","twitter","facebook","linkedin"]:["website","organization","email"]).includes(e.type))),"personal"!==s.type||u&&0!==u.length||(u=m.find((e=>"organization"===e.type)),u=u||m.find((e=>"website"===e.type))),u=u&&"object"==typeof u&&!Array.isArray(u)?[u]:u,u=u||[]}if(u.forEach((e=>d[Object.entries(n).find((t=>t[1]===e.type))[0]]=e.values.value)),"personal"===s.type){if((d.org_name||d.org_website)&&!d.name){const e=m.find((e=>"person"===e.type));e?d.name=e.values.value:Object.keys(d).some((e=>["email","twitter","facebook","linkedin"].includes(e)))&&(delete d.org_name,delete d.org_website)}if(!r.checkPeopleTriggerFields(s,d,!0))return}let g={triggerSelected:d,triggerChanged:{...d},configId:s.id,moduleName:a,layoutData:i.data.record,layoutId:i.data.layoutId,entityId:i.data.entityId,parentType:"email"};Lyte.Component.render("crm-data-enrichment",g,"#enrichDiv");let p=$L("crm-data-enrichment")[0];p&&(p=p.component,p.setData(g),p.setCriteriaArr(),r.TrackForEnrichClick(e,a,"Data Enrichment - Enrich Data Click",s.type),r.CreateEnrichment(p))}),(function(){r.showErrorMessage(I18n.getMsg("crm.label.auto.enrich.empty.data"))}))}}}else{const t=$L("crm-create-layout")[0];let i="form_edit"===e?$L("crm-canvas-form")[0]:t;if(!i||!i.component)return;i=i.component;let o={},c="form_edit"===e?i.getData("record"):i.getData("dataBind");if(s.trigger_fields.filter((t=>t.crm_field&&c[t.crm_field.api_name]&&""!==c[t.crm_field.api_name].trim()&&r.idValidField(e,t.crm_field.id,i.data.layoutId,i.data.currentInstObjKey))).forEach((e=>{Lyte.objectUtils(o,"add",e.enrich_field.name,c[e.crm_field.api_name].trim())})),"personal"===s.type){if(!n.people_enrichment)return;const e="leads"===a||"Contacts"===a?c.First_Name&&c.Last_Name?c.First_Name+" "+c.Last_Name:c.First_Name?c.First_Name:c.Last_Name:c[moduleRecordMapping[a].display_field.api_name];e&&(o.name=e),o=r.checkPeopleTriggerFields(s,o)}r.setTriggerFieldsToComponent("form_edit"===e&&t&&t.component&&t.component.data.activeScreenView?t.component:i,o,s)}else{const t=$L("crm-create-layout")[0];let c="form_create"===e||"form_edit"===e?$L("crm-canvas-form")[0]:t;if(!c||!c.component)return;if(c=c.component,!r.idValidField(e,o?moduleRecordMapping[a].fields.find((e=>e.api_name===i)).id:s.trigger_fields.find((e=>e.crm_field&&e.crm_field.api_name===i)).crm_field.id,c.data.layoutId,c.data.currentInstObjKey))return;const l="form_create"===e||"form_edit"===e?c.getData("record"):c.getData("dataBind");let d={};if(s.trigger_fields.filter((t=>t.crm_field&&l[t.crm_field.api_name]&&""!==l[t.crm_field.api_name].trim()&&r.idValidField(e,t.crm_field.id,c.data.layoutId,c.data.currentInstObjKey))).forEach((e=>{Lyte.objectUtils(d,"add",e.enrich_field.name,l[e.crm_field.api_name].trim())})),"personal"===s.type){if(!n.people_enrichment)return;let e="Leads"===a||"Contacts"===a?l.First_Name&&l.Last_Name?l.First_Name+" "+l.Last_Name:l.First_Name?l.First_Name:l.Last_Name:l[moduleRecordMapping[a].display_field.api_name];e=r.validateField(e)?e:void 0,e&&(d.name=e),d=r.checkPeopleTriggerFields(s,d)}r.setTriggerFieldsToComponent(("form_edit"===e||"form_create"===e)&&t&&t.component&&t.component.data.activeScreenView?t.component:c,d,s)}}),(function(e){r.handleError(e,!1,!1)})):"email"===e&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.zia.email.enrich.empty"),ltPropType:"warning",ltPropDuration:"2000"}})}),(function(e){r.handleError(e,!1,!1)}))},checkPeopleTrigger:function(e,t){const a=e.some((e=>e.crm_field&&["org_name","org_website"].contains(e.enrich_field.name)&&t[e.enrich_field.name]));return t.name?a:a?t.name:e.filter((e=>e.crm_field&&["email","facebook","twitter","linkedin"].contains(e.enrich_field.name))).some((e=>t[e.enrich_field.name]))},checkPeopleTriggerFields:function(e,t,a=!1){const i=e.trigger_fields.filter((e=>e.crm_field&&["org_name","org_website"].contains(e.enrich_field.name))).map((e=>e.enrich_field.name)),n=e.trigger_fields.filter((e=>e.crm_field&&["email","facebook","twitter","linkedin"].contains(e.enrich_field.name))),r=Object.keys(t).some((e=>n.some((t=>t.enrich_field.name===e))&&t[e])),s=Object.keys(t).some((e=>i.includes(e)&&t[e]));if(0!==n.length&&!r&&t.name&&!s){t=void 0;let e="";return n.forEach(((t,a)=>{const i=store.peekRecord("field",t.crm_field.id);i&&(e+=i.field_label+(0===a||a===n.length-1?" ":" or "))})),void(a&&this.showErrorMessage(I18n.getMsg("crm.sandbox.update.error",[e,I18n.getMsg("crm.label.value.lrwcase")])))}if(!t.name||r||s){if(!s||r||t.name)r&&(s&&!t.name?i:t.name&&!s?["name"]:[]).forEach((e=>Lyte.objectUtils(t,"delete",e)));else if(t=void 0,a)return void this.showErrorMessage(I18n.getMsg("crm.sandbox.update.error",[I18n.getMsg("crm.label.auto.enrich.person.name"),""]))}else if(t=void 0,a)return void this.showErrorMessage(I18n.getMsg("crm.sandbox.update.error",[I18n.getMsg("crm.setup.system.companydetails"),I18n.getMsg("crm.label.value.lrwcase")]));return t},unloadTempConfigs(){store.peekAll("data_enrichment").forEach((e=>{e.id.length<10&&store.unloadRecord("data_enrichment",e.id)}))},setTriggerFieldsToComponent:function(e,t,a){try{e.setData({isFetchEnrichment:this.validateTriggerField(t,a,!1)});let i=$L("crm-data-enrichment")[0];if(i){const e=$L("#enrichDataLink");e&&e[0]&&(e[0].classList.add("highlight-detailview"),setTimeout((()=>{e.removeClass("highlight-detailview")}),1500)),i=i.component,i.setData({triggerSelected:t,triggerChanged:{...t}}),i.setCriteriaArr()}}catch(e){murphy.error(e)}},getDefaultMapping:function(e,t=!1){if(!e)return null;return t?{Leads:{org_name:"COMPANY",email:"EMAIL",org_website:"WEBSITE"},Contacts:{org_website:"WEBSITE",email:"EMAIL"},Accounts:{org_website:"WEBSITE",org_name:"ACCOUNTNAME",email:"EMAIL"},Vendors:{org_name:"VENDORNAME",email:"EMAIL",org_website:"WEBSITE"}}[e]:{Leads:{last_name:"LASTNAME",first_name:"FIRST_NAME",name:"COMPANY",primary_contact:"PHONE",primary_email:"EMAIL",secondary_email:"ADDN_EMAIL",company_info_industries:"INDUSTRY",industries:"INDUSTRY",website:"WEBSITE",social_media_twitter:"TWITTER",social_media_skype:"SKYPEIDENTITY",address_street:"LANE",address_state:"STATE",address_city:"CITY",address_zip_code:"CODE",address_country:"COUNTRY",description:"DESCRIPTION",no_of_employees:"EMPCT",revenue:"ANNUALREVENUE",logo:"PHOTO_FILEID",primary_address_info_state:"STATE",primary_address_info_city:"CITY",primary_address_info_country:"COUNTRY"},Contacts:{last_name:"LASTNAME",first_name:"FIRST_NAME",primary_contact:"PHONE",secondary_contact:"OTHERPHONE",primary_email:"EMAIL",secondary_email:"ADDN_EMAIL",description:"DESCRIPTION",social_media_twitter:"TWITTER",social_media_skype:"SKYPEIDENTITY",address_street:"OTHERSTREET",address_state:"OTHERSTATE",address_city:"OTHERCITY",address_zip_code:"OTHERZIP",address_country:"OTHERCOUNTRY",logo:"PHOTO_FILEID",primary_address_info_state:"OTHERSTATE",primary_address_info_city:"OTHERCITY",primary_address_info_country:"OTHERCOUNTRY"},Accounts:{name:"ACCOUNTNAME",primary_contact:"PHONE",industries:"INDUSTRY",description:"DESCRIPTION",revenue:"ANNUALREVENUE",no_of_employees:"EMPLOYEES",address_street:"BILLINGSTREET",address_state:"BILLINGSTATE",address_city:"BILLINGCITY",address_zip_code:"BILLINGCODE",address_country:"BILLINGCOUNTRY",logo:"PHOTO_FILEID",primary_address_info_state:"BILLINGSTATE",primary_address_info_city:"BILLINGCITY",primary_address_info_country:"BILLINGCOUNTRY"},Vendors:{name:"VENDORNAME",primary_email:"EMAIL",primary_contact:"PHONE",description:"DESCRIPTION",address_street:"STREET",address_state:"STATE",address_city:"CITY",address_zip_code:"ZIPCODE",address_country:"COUNTRY",logo:"PHOTO_FILEID",primary_address_info_state:"STATE",primary_address_info_city:"CITY",primary_address_info_country:"COUNTRY"}}[e]},getImageBase64:function(e,t){e||t(null);const a=new Image;a.crossOrigin="Anonymous",a.onload=function(){const e=document.createElement("canvas");e.width=a.width,e.height=a.height;e.getContext("2d").drawImage(a,0,0);const i=e.toDataURL("image/png");t(i)},a.onerror=function(){t(null)},a.src=e},CompareImages:async function(e,t){const a=this;return new Promise((i=>{a.getImageBase64(t,(function(t){t||i(!0),e?a.getImageBase64(e,(function(e){i(e===t)})):i(!1)}))}))},convertLogo:async function(e,t,a,i){return new Promise(((n,r)=>{e||r(null);const s=new Image;s.src=e;const o=document.createElement("canvas"),c=o.getContext("2d");s.onload=function(){o.width=s.width,o.height=s.height,c.drawImage(s,0,0);const e=o.toDataURL("image/png"),l=dataURItoBlob(e),d=document.createElement("input");d.value=encodeURIComponent(csrfToken),d.name="crmcsrfparam";const m=document.createElement("form");m.appendChild(d),m.target="oprexcutefrm";const u=new FormData(m);u.append("upload_photo",l,"logo.png");let g=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+t+"&actionName=storeCroppedImage&layoutId="+a;$.ajax({url:g,type:"POST",data:u,contentType:!1,processData:!1,success:function(e){$("#"+m.target).html(e),hideAnimatePopup("topBandPopup");var t=$("[name='action_module']").val();null!==customViewObject&&customViewObject.isCustomizedView&&"Users"!==t&&"Org"!==t&&crmTab.deleteFromCache(t);var a=document.querySelector("crm-create-avatarupload"),r=document.getElementById("photoID"),s=document.querySelector("crm-create-entity");a&&(a.component.setData("uploadId",r.apiValue),a.component.executeMethod("setUploadIdinEntityRecord")),s&&s.component.setData("isRecordImgRemoved",!1),"canvas"===Lyte.Router.getRouteInstance().routeName&&delete crmTab.cacheObj[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()],"detail"===Lyte.Router.getRouteInstance().routeName&&crmTab.deleteFromCache(Lyte.Router.getRouteInstance().parent.parent.getDynamicParam());var o="crm.tab.module.create.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.edit.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.clone.canvas"===Lyte.Router.getRouteInstance().transition.info.route;if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||o){$("[id=nonrellistProfileImage_canvas]").remove();var c=$L("crm-canvas-profile-image")[0];"undefined"!=typeof fileID&&c&&c.component&&c.component.setData("imageUrl",i+fileID)}r&&"undefined"!=typeof fileID&&(r.value=fileID);const l=$L(".lnPhoto");l&&l.length&&l.addClass("enrichBG"),n(!0)},error:function(){commonUtils.showHideLoadingDiv(),hideAnimatePopup("topBandPopup"),renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),r(!1)}})}}))},addEnrichDetailsToRecord:function(e,t,a){let i={},n=Object.keys(e).filter((i=>"id"!==i&&"enrich_id"!==i&&"enrich_based_on"!==i&&t[i]&&("logo"!==e[i].enrich_field||a)));const r=this;n.forEach((t=>{"logo"===e[t].enrich_field&&a?i[t]=r.getImageId():"logo"!==e[t].enrich_field&&(i[t]=e[t].enrich_value)})),n.length&&n.push("__zia_enrich_id_"+e.enrich_id),r.AddRecordEnrichFields(t,e.enrich_based_on,n,i)},InitializeEnrichment:function(e){const t=this,a=e.getData("layoutData"),i=e.getData("config"),n=e.getData("layoutId"),r=e.getData("parentType"),s=e.getData("currentInstObjKey"),o={};if(i.trigger_fields.filter((e=>e.crm_field&&t.idValidField(r,e.crm_field.id,n,s)&&a[e.crm_field.api_name]&&""!==a[e.crm_field.api_name].trim())).forEach((e=>{o[e.enrich_field.name]=a[e.crm_field.api_name].trim()})),"personal"===i.type&&e.getData("triggerChanged.name")){const t=e.getData("moduleName"),i="Leads"===t||"Contacts"===t?a.First_Name&&a.Last_Name?a.First_Name+" "+a.Last_Name:a.First_Name?a.First_Name:a.Last_Name:a[moduleRecordMapping[t].display_field.api_name];i&&""!==i.trim()?Lyte.objectUtils(o,"add","name",i):Lyte.objectUtils(o,"delete","name")}e.setData("triggerChanged",o),e.setCriteriaArr(),this.TrackForEnrichClick(e.getData("parentType"),e.getData("moduleName"),"Data Enrichment - Enrich Data Click",i.type),e.CreateEnrichment(e)},CreateEnrichment:function(e){const t=this;this.getEnrichmentLimits().then((function(a){if(!(a=a[0]?a[0]:a)||!a.status||!a.manage&&!a.view)return void t.showErrorMessage(I18n.getMsg("crm.zianotification.config.update.permission.msg"));const i=a.enrich_count?a.enrich_count:a;if(!i||i.used_count>=i.limit)return void t.limitExceedAlert();const n=e.getData("triggerChanged"),r=store.peekAll("data_enrichment").find((t=>"204"!==t.id&&(!("organization"===t.type)||t.status)&&t.module.module_name===e.getData("moduleName")));if(!r)return;if("personal"===r.type&&!Crm.isPeopleEnrichmentEnabled)return void t.showErrorMessage(I18n.getMsg("crm.promo.cannot.enable",I18n.getMsg("crm.canvas.gallary.people")+" "+I18n.getMsg("crm.label.enrich")));if("personal"===r.type&&!a.people_enrichment)return void t.showExtensionError(e.$node._callee);if(!t.validateTriggerField(n,r,!0))return void e.setData("isTriggerEdited",!0);"personal"!==r.type||"Leads"!==r.module.module_name&&"Contacts"!==r.module.module_name||!n.twitter||/(https?:\/\/)?(www\.)?twitter\.com\/([a-zA-Z0-9_]{3,15})\/?/g.test(n.twitter)||(n.twitter="https://twitter.com/"+n.twitter),store.unloadAll("zia_data_enrichment");store.createRecord("zia_data_enrichment",{type:r.type,enrich_based_on:n}).$.save({module:r.module.api_name,entityId:e.getData("entityId")}).then((function(a){a.zia_data_enrichment.id&&(e.setData({isEnrichmentFound:!0,loader:!0,showEnrichModal:!0,showTriggerModal:!1,isUpdateLayout:!0,updateAllFields:!1,triggerSelected:{...n}}),t.FetchEnrichment(a.zia_data_enrichment.id,e))}),(function(a){e.setData({isEnrichmentFound:e.getData("showTriggerModal")&&e.getData("isEnrichmentFound"),loader:!1,isTriggerEdited:!0}),t.handleEnrichError(a,e.$node._callee)}))}),(function(e){e=(e=JSON.parse(e.response)).__features?e.__features[0]?e.__features[0]:e.__features:e,t.showErrorMessage(e.message)}))},FetchEnrichment:async function(e,t){store.findRecord("zia_data_enrichment",e,void 0,void 0,void 0,{type:store.peekRecord("zia_data_enrichment",e).type}).then((function(e){t.setData("enriched_data",e[0]),t.ConstructEnrichFieldObject()}),(function(){t.setData({loader:!1,isEnrichmentFound:!1})}))},setEnrichCssClass:function(e,t){t.enrich_fields.filter((e=>e.crm_field)).forEach((function(t){const a=store.peekRecord("field",t.crm_field.id);a&&Lyte.objectUtils(e,"add",a.column_name,!1)})),Lyte.objectUtils(e,"add","isFieldChanged",!1)},IncreaseConfigCount(){const e=store.peekRecord("data_enrichment_count","1");e.$.set("config_count.used_count",e.config_count.used_count+1)},decreaseConfigCount(){const e=store.peekRecord("data_enrichment_count","1");e.$.set("config_count.used_count",e.config_count.used_count-1)},addNewData:function(e){const t=this,a=e.getData("newData"),i=e.getData("EnrichFieldObject");if(a.mergeExisting)Lyte.objectUtils(i[a.fieldName],"add","enrich_value",a.mergeValue),Lyte.objectUtils(i[a.fieldName],"delete","newData"),Lyte.objectUtils(i[a.fieldName],"add","update_enabled",!0),e.setData({newDataModal:!1,isOnlyNewData:!1});else{const n=store.peekRecord("field",e.getData("config.enrich_fields").find((e=>e.crm_field&&e.crm_field.api_name===a.fieldName)).crm_field.id);let r={field_label:n.field_label,data_type:"picklist",pick_list_values:[{display_value:a.valueFetched}]};n.colour_code_enabled&&(r.enable_colour_code=!0),e.setData("newDataOnSave",!0),commonUtils.showHideLoadingDiv(!0),store.triggerAction("zia_data_enrichment","pick_list",{field:n.id,picklist:{fields:[r]},module:e.getData("config.module.api_name")}).then((function(r){commonUtils.showHideLoadingDiv(!1),e.setData({newDataModal:!1,newDataOnSave:!1,isOnlyNewData:!1}),void 0!==r?(store.findRecord("module",e.getData("config.module.id")),Lyte.objectUtils(i[a.fieldName],"add","enrich_value",a.valueFetched),Lyte.objectUtils(i[a.fieldName],"delete","newData"),Lyte.objectUtils(i[a.fieldName],"add","update_enabled",!0),t.showSuccessMessage(I18n.getMsg("crm.module.added.msg.success1",[I18n.getMsg("crm.label.new.module1",I18n.getMsg("crm.lable.pick.list.lowercase")+" "+I18n.getMsg("crm.variables.value")),n.field_label+" "+I18n.getMsg("zia.recommendation.notification.successfully")]))):t.handleError(r)}),(function(a){commonUtils.showHideLoadingDiv(!1),a=(a=JSON.parse(a.response)).fields?a.fields[0]?a.fields[0]:a.fields:a,t.showErrorMessage(a.message),e.setData({newDataModal:!1,newDataOnSave:!1})}))}},validateTriggerField:function(e,t,a){if(!e||validationUtils.isEmpty(e)||!t.trigger_fields.some((t=>t.crm_field&&e[t.enrich_field.name])))return a&&this.showErrorMessage(I18n.getMsg("crm.label.auto.enrich.empty.data")),!1;const i=/(https?:\/\/)?(www\.)?linkedin\.com\/(.+?)\/?/g,n=/(https?:\/\/)?(www\.)?facebook\.com\/(.+?)\/?/g,r=/(https?:\/\/)?(www\.)?twitter\.com\/(.+?)\/?/g,s=/^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,o=/[a-zA-Z].*[a-zA-Z].*[a-zA-Z]/,c=/^[0-9]+$/;if(!/^[\x00-\xFF'’]*$/.test(JSON.stringify(e)))return a&&this.showErrorMessage(I18n.getMsg("crm.auto.enrich.otherlanguage.unsupported")),!1;const l=Object.keys(e);for(const d of l){const l="name"===d?"Person Name":t.trigger_fields.find((e=>e.enrich_field.name===d)).enrich_field.display_label;if(e[d].length<3)return a&&this.showErrorMessage(I18n.getMsg("crm.competitoralert.error.name.length.minimum.limit",[l,"3"])),!1;if(s.test(e[d])||c.test(e[d])||!o.test(e[d]))return a&&this.showErrorMessage(I18n.getMsg("crm.criteria.fieldvalue.valid.check",l)),!1;if("email"===d&&!validationUtils.isValidEmail(e[d]))return a&&this.showErrorMessage(I18n.getMsg("crm.zsupport.error.enterEmail")),!1;if(!("website"!==d&&"org_website"!==d||validationUtils.isValidWebUrl(e[d])))return a&&this.showErrorMessage(I18n.getMsg("crm.bm.fb.req.invalid.website")),!1;if("facebook"===d&&!n.test(e[d]))return a&&this.showErrorMessage(l+" should be a valid facebook url"),!1;if("linkedin"===d&&!i.test(e[d]))return a&&this.showErrorMessage(l+" should be a valid linkedIn url"),!1;if("twitter"===d&&("Leads"!==t.module.module_name&&"Contacts"!==t.module.module_name||22!==store.peekRecord("field",t.trigger_fields.find((e=>"twitter"===e.enrich_field.name)).crm_field.id).ui_type||!validationUtils.isValidTwitter(e[d]))&&!r.test(e[d]))return a&&this.showErrorMessage(l+" should be a valid twitter url"),!1}return!0},validateField:function(e){return e&&""!==e.trim()&&e.length>=3&&/^[\x00-\xFF'’]*$/.test(JSON.stringify(e))},showErrorMessage:function(e){_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:e}})},showSuccessMessage:function(e){_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:e}})},validateEnrichData:function(e){return e&&Object.keys(e).some((t=>!["id","type","status","enrich_based_on"].includes(t)&&e[t]))},parseEnrichResponse(e){const t=this;return e?(Object.keys(e).forEach((a=>{switch(a){case"address":case"head_quarters":e[a]=t.parseOrgAddress(e[a]?e[a][0]:e[a]);break;case"social_media":e[a]=t.parseMedia(e[a]);break;case"industries":e[a]=t.parseIndustries(e[a]);break;case"educations":e[a]=t.parseEducations(e[a]);break;case"email_infos":e.secondary_email=t.parseSecondaryEmail(e[a],e.primary_email),delete e[a];break;case"primary_address_info":e[a]=t.parsePeopleAddress(e[a]);break;case"company_info":e[a]=t.parseCompanyInfo(e[a]);break;case"description":e[a]=t.parseDescription(e[a]);break;case"revenue":e[a]=t.parseRevenue(e[a])}})),e):{}},parseSecondaryEmail:(e,t)=>(e=e&&t?e.find((e=>e.email!==t)):null)?e.email:null,parseDescription:e=>e&&e.length?e[0].description:null,parseRevenue(e){if(!e)return null;e=(e=e.toUpperCase()).split("-").length>1?e.split("-")[1]:e;let t=parseFloat(e.replace(/[£$€¥₹]/g,""));return Number.isNaN(t)?null:(e.includes("B")?t*=1e9:e.includes("M")?t*=1e6:e.includes("K")&&(t*=1e3),this.convertCurrencyToLocale(t))},parseOrgAddress(e){if(!e)return null;let t=e.fill_address?e.fill_address.split(new RegExp(e.city?e.city:e.state?e.state:e.country?e.country:"`!@#","gi"))[0]:null;return t=t?t.replace(/,\s*$/,"").trim():t,{street:t,state:e.state,city:e.city,country:e.country,zip_code:e.pin_code}},parsePeopleAddress:e=>e?{state:e.region,city:e.name?e.name.split(",")[0]!==e.region?e.name.split(",")[0].trim():null:e.name,country:e.country}:null,parseEducations(e){if(!e||!e.length)return null;let t={},a=e.find((e=>e.degrees&&e.degrees.some((e=>e.toLowerCase().includes("master")||e.toLowerCase().includes("doctor")))));return a=a||e.find((e=>e.majors&&e.majors.length||e.degrees&&e.degrees.length)),a=a||e[0],t.degree=a.degrees?a.degrees.reduce(((e,t)=>t.length>e.length?t:e),""):null,t.institution=a.school_name,t.graduate=a.majors?a.majors[0]:null,t},parseMedia(e){if(!e||!e.length)return null;let t={other:[]};return e.filter((e=>e.media_type)).forEach((e=>{e.media_type.toLowerCase().includes("facebook")?t.facebook=e.media_url[0]:e.media_type.toLowerCase().includes("twitter")?t.twitter=e.media_url[0]:e.media_type.toLowerCase().includes("skype")?t.skype=e.media_url[0]:e.media_type.toLowerCase().includes("linkedin")?t.linkedin=e.media_url[0]:t.other.push(e.media_url[0])})),t},parseIndustries:e=>e&&e.length?e.map((e=>e.name)):null,parseCompanyInfo(e){if(!e)return null;let t={};if(t.industries=e.industries,t.current_company=e.name,e.experiences&&(1===e.experiences.length||e.name&&2===e.experiences.length)){const a=e.experiences.find((e=>!e.primary)),i=e.name?e.experiences.find((e=>e.primary)):null,n=i?i.start_period?i.start_period:i.end_period:null;t.previous_company=a?a.company_name:null,t.experience=n?Math.abs($L.moment()._dateObj.getFullYear()-$L.moment(n).toDate().getFullYear()).toString():null}else if(e.experiences&&e.experiences.length>=2){let a=e.experiences.find((e=>e.primary));a=a?a.start_period?a.start_period:a.end_period:null;const i=a?$L.moment(a).toDate():$L.moment()._dateObj;let n=e.experiences.map((e=>{const t=e.start_period?e.start_period:e.end_period;return t?$L.moment(t).toDate():null})).filter((e=>e&&e.getFullYear()<i.getFullYear()));n=n.length?n.reduce(((e,t)=>Math.abs(t.getFullYear()-i.getFullYear())<Math.abs(e.getFullYear()-i.getFullYear())?t:e)):null;const r=n?n.getFullYear().toString():null;let s=e.experiences.find((e=>r&&(e.start_period&&e.start_period.includes(r)||e.end_period&&e.end_period.includes(r))));s=s||e.experiences[0],t.previous_company=s?s.company_name:null,t.experience=a?Math.abs($L.moment()._dateObj.getFullYear()-$L.moment(a).toDate().getFullYear()).toString():null}else t.previous_company=null,t.experience=null;return t},convertCurrencyToLocale:function(e){const t=Crm.userDetails.defaultCurrencyISOCode?Crm.userDetails.defaultCurrencyISOCode:Crm.userDetails.BASE_CURRENCY?Crm.userDetails.BASE_CURRENCY:"USD",a={AFN:"69.28",ALL:"91.72",DZD:"133.692",USD:"1",EUR:"0.912",AOA:"827.716",XCD:"2.7",ARS:"360.014",AMD:"399.5",AWG:"1.79",AUD:"1.513",AZN:"1.698",BSD:"1",BHD:"0.377",BDT:"110.5",BBD:"2",BYN:"3.099",BZD:"2",XOF:"598.337",BMD:"1",BTN:"83.32",BOB:"6.858",BAM:"1.784",BWP:"13.441",BRL:"4.883",BND:"1.333",BGN:"1.784",BIF:"2828.212",KHR:"4110",XAF:"598.337",CAD:"1.361",CVE:"100.579",KYD:"0.82",CLP:"870",CNY:"7.13",COP:"3997",KMF:"448.753",CDF:"2480.658",NZD:"1.628",CRC:"530.67",CUP:"24",CZK:"22.12",DKK:"6.801",DJF:"177",DOP:"56.707",EGP:"30.9",ERN:"15",SZL:"18.595",ETB:"55.607",FJD:"2.25",XPF:"108.85",GMD:"63.06",GEL:"2.713",GHS:"11.95",GIP:"0.789",GTQ:"7.829",GNF:"8505",GYD:"209.3",HTG:"132.58",HNL:"24.508",HKD:"7.804",HUF:"344.91",ISK:"137.19",INR:"83.32",IDR:"15390",IRR:"378018",IQD:"1310",ILS:"3.684",JMD:"154.284",JPY:"147.65",JOD:"0.708",KZT:"458.39",KES:"152.98",KPW:"110",KRW:"1287.45",KWD:"0.308",KGS:"88.7",LAK:"20749",LBP:"85500",LSL:"18.595",LRD:"187.103",LYD:"4.9",CHF:"0.876",MOP:"8.038",MGA:"4480.42",MWK:"1700",MYR:"4.65",MVR:"15",MRU:"39.39",MUR:"44.549",MXN:"17.21",MDL:"17.711",MNT:"3437.53",MAD:"10.041",MZN:"63.25",MMK:"2940",NAD:"18.595",NPR:"133.133",ANG:"1.79",NIO:"36.296",NGN:"813.94",MKD:"55.784",NOK:"10.696",OMR:"0.385",PKR:"285.487",PAB:"1",PGK:"3.724",PYG:"7435",PEN:"3.733",PHP:"55.369",PLN:"3.959",QAR:"3.646",RON:"4.534",RUB:"88.438",RWF:"1231.493",SHP:"0.789",WST:"2.729",STN:"22.445",SAR:"3.751",RSD:"106.884",SCR:"13.338",SLE:"22.506",SGD:"1.333",SBD:"8.177",SOS:"24300",ZAR:"18.595",SSP:"1067.917",LKR:"327.85",SDG:"760.5",SRD:"37.906",SEK:"10.377",SYP:"11500",TJS:"10.95",TZS:"2501.99",THB:"34.86",TOP:"2.339",TTD:"6.749",TND:"3.098",TRY:"28.905",TMT:"3.5",UGX:"3814",UAH:"37",AED:"3.672",GBP:"0.789",UYU:"38.855",UZS:"12300",VUV:"116.39",VES:"35.47",VND:"24269",YER:"516.46",ZMW:"23.75",ZWL:"5777.054"};return Number(e*(a[t]?a[t]:1))},flattenObject:function(e){let t={};for(let a in e)e.hasOwnProperty(a)&&(Array.isArray(e[a])||"object"!=typeof e[a]||null===e[a]?t[a]=e[a]:Object.assign(t,this.flattenObject(e[a])));return t},flattenObjectWithParent:function(e,t=""){let a={};for(let i in e)if(e.hasOwnProperty(i)){let n=t?`${t}_${i}`:i;"object"!=typeof e[i]||Array.isArray(e[i])?a[n]=e[i]:a={...a,...this.flattenObjectWithParent(e[i],n)}}return a},getImageId(e=!0){const t=$L("#photoID");if(e)return t[0].apiValue;if("canvas"===Lyte.Router.getRouteInstance().routeName){const e=$L("crm-canvas-profile-image")[0];if(e&&e.component&&e.component.data.imagefileId)return e.component.data.imagefileId;{const e=$L("#image_container")[0],t=e?e.querySelector("img"):null,a=t&&t.hasAttribute("data-fileid")?t.getAttribute("data-fileid"):"";return"null"===a?"":a}}return t.val()},updateEnrichData:function(e){commonUtils.showHideLoadingDiv(!0),e.setData({isUpdateLayout:!0,isUpload:!0}),"form_create"===e.getData("parentType")||"form_edit"===e.getData("parentType")||e.getData("isWizardForm")?this.updateEnrichFieldsForCanvas(e):this.updateFieldData(e)},updateFieldData:async function(e){const t=e.getData("EnrichFieldObject"),a=e.getData("layoutData"),i=e.getData("config"),n=e.getData("parentType"),r=e.getData("enriched_data.id"),s=i.module.id,o=e.getData("moduleName"),c=e.getData("triggerChanged"),l=Object.keys(c).filter((e=>"name"!==e&&c[e]&&""!==c[e])).map((e=>i.trigger_fields.find((t=>t.enrich_field.name===e)).crm_field.api_name));if(this.TrackForEnrichClick(n,e.getData("moduleName"),"Data Enrichment - Enrich Data Update Click",i.type),"create"===n||"edit"===n){let n=e.getData("enrichCssClass");this.setEnrichCssClass(n,i),Lyte.objectUtils(n,"add","isFieldChanged",!1);const s=i.enrich_fields.find((e=>e.crm_field&&"logo"===e.enrich_field.name));let c=!1;s&&t[s.crm_field.api_name]&&t[s.crm_field.api_name].update_enabled&&(e.setData("isUpdateLayout",!0),await this.convertLogo(t[s.crm_field.api_name].enrich_value,o,e.getData("layoutId")).then(function(e){e&&(c=!0,a.$.set(s.crm_field.api_name,this.getImageId()))}.bind(this))),i.enrich_fields.filter((e=>e.crm_field&&"logo"!==e.enrich_field.name)).forEach((function(e){let i=!1;t[e.crm_field.api_name]&&t[e.crm_field.api_name].update_enabled&&(a.$.set(e.crm_field.api_name,t[e.crm_field.api_name].enrich_value),i=!0);const r=store.peekRecord("field",e.crm_field.id);r&&void 0!==n[r.column_name]&&Lyte.objectUtils(n,"add",r.column_name,i)})),Lyte.objectUtils(n,"add","isFieldChanged",!0);let d=Object.keys(t).filter((e=>t[e].update_enabled&&a[e]&&("logo"!==t[e].enrich_field||c)));d.length&&d.push("__zia_enrich_id_"+r),this.AddRecordEnrichFields(a,l,d,null),e.setData({layoutData:a,showEnrichModal:!1,isFetchEnrichment:!1}),commonUtils.showHideLoadingDiv()}else if("detail"===n||"canvas_detail"===n||"email"===n){let a={};Object.keys(t).forEach((function(e){t[e].update_enabled&&(a[e]=t[e],delete a[e].update_enabled)})),a.id=s,a.enrich_based_on=l,a.enrich_id=r,store.peekRecord("create-enrichment-layout",s)&&store.unloadRecord("create-enrichment-layout",s),store.pushPayload("create-enrichment-layout",a),e.setData("showEnrichModal",!1),Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[o,e.getData("entityId")],queryParams:{layoutId:e.getData("layoutId")}})}},updateEnrichFieldsForCanvas:async function(e){e.setData("isUpdateLayout",!0);const t=e.getData("EnrichFieldObject"),a=e.getData("config"),i=e.getData("layoutData"),n=e.getData("enriched_data.id"),r=e.getData("triggerChanged"),s=e.getData("isWizardForm"),o=Object.keys(r).filter((e=>"name"!==e&&r[e])).map((e=>a.trigger_fields.find((t=>t.enrich_field.name===e)).crm_field.api_name)),c=a.enrich_fields.find((e=>e.crm_field&&"logo"===e.enrich_field.name));let l=!1;!s&&c&&t[c.crm_field.api_name]&&t[c.crm_field.api_name].update_enabled&&await this.convertLogo(t[c.crm_field.api_name].enrich_value,e.getData("moduleName"),e.getData("layoutId"),e.getData("imgUrl")).then(function(e){e&&(l=!0,i.$.set(c.crm_field.api_name,this.getImageId()))}.bind(this)),a.enrich_fields.filter((e=>e.crm_field&&t[e.crm_field.api_name]&&t[e.crm_field.api_name].update_enabled&&"logo"!==e.enrich_field.name)).forEach((e=>{const a=$(".fieldupdate_"+store.peekRecord("field",e.crm_field.id).column_name),n=t[e.crm_field.api_name].enrich_value;if(s&&i.$.set(e.crm_field.api_name,n),a.length){i.$.set(e.crm_field.api_name,n),a[0].component.setData("cxPropValue",n);const t=a.closest(".zcanvas-value-container");t&&t.addClass("highlightcanvasformfield")}}));let d=Object.keys(t).filter((e=>t[e].update_enabled&&("logo"===t[e].enrich_field?l:i[e])));d.push("__zia_enrich_id_"+n),e.setData({showEnrichModal:!1,isFetchEnrichment:!1}),this.AddRecordEnrichFields(i,o,d,null),setTimeout((function(){$L(".highlightcanvasformfield").removeClass("highlightcanvasformfield")}),3e3),commonUtils.showHideLoadingDiv()},getLayoutHiddenFields:function(e,t,a){let i=[];const n=store.peekRecord("layout",t),r=Lyte.Router.getRouteInstance().routeName;return"detail"===e||"email"===e&&"canvas"!==r?CFRExec.LayoutRuleHiddenElem:("edit"===e||"create"===e?i=n.fields.filter((e=>e[a]&&e[a].isHiddenInLayoutRules)).map((e=>e.column_name)).concat(n.sections.filter((e=>e[a]&&e[a].hasOwnProperty("isvalidSection")&&!e[a].isvalidSection)).flatMap((e=>e.fields.map((e=>e.column_name))))):("form_create"===e||"form_edit"===e||"canvas_detail"===e||"email"===e&&"canvas"===r)&&(i=n.fields.filter((e=>{if("PHOTO_FILEID"===e.column_name){const e=$L("crm-canvas-profile-image")[0];return!e||!e.component}const t=".fieldupdate_"+e.column_name,a=$L(t),i=2===a.length?a[1]:a[0];return!i||!i.component||$L(i.closest(".zcanvas-field")).hasClass("hide")})).map((e=>e.column_name))),i)},AddRecordEnrichFields:function(e,t,a,i){const n=e.$.model;t&&t.length&&(n.fieldList.$enrich_based_on||store.addField(n._name,"$enrich_based_on","array"),e.$.set("$enrich_based_on",t)),a&&a.length&&(n.fieldList.$enriched_fields||store.addField(n._name,"$enriched_fields","array"),e.$.set("$enriched_fields",a)),i&&validationUtils.isNotEmpty(i)&&(n.fieldList.$enriched_fields_map||store.addField(n._name,"$enriched_fields_map","object"),e.$.set("$enriched_fields_map",i))},deleteEnrichDetails:function(e){e.$enrich_based_on&&delete e.$enrich_based_on,e.$enriched_fields&&delete e.$enriched_fields,e.$enriched_fields_map&&delete e.$enriched_fields_map},postFeedback:function(e){const t=e.getData("feedback");let a={};a.enrich_id=e.getData("enriched_data.data_id"),a.type=e.getData("config.type"),a.feedback=t.type;const i=t.options.find((e=>e.val===t.review)),n=""!==t.comment?t.comment:i?i.apiVal:void 0;"negative"===t.type&&n&&(a.comment=n),this.TrackForEnrichClick("config",{Module:e.getData("moduleName"),feedback:t.type,Place:["create","edit","form_edit","form_create"].includes(e.getData("parentType"))?"Create":"Detail View"},"Data Enrichment - Scrapy Feedback API",a.type),store.triggerAction("data_enrichment","scrapy_feedback",{feedback:a}).then(function(){e.setData("showFeedbackModal",!1),Lyte.objectUtils(t,"add","previousType",t.type),this.showSuccessMessage(I18n.getMsg("crm.profile.pic.writetous.success"))}.bind(this),function(a){let i=JSON.parse(a.response);i=i.scrapy_feedback?i.scrapy_feedback:i,t.comment&&"NOT_SUPPORTED"!==i.code?Lyte.objectUtils(t,"add","comment",""):(e.setData("showFeedbackModal",!1),e.resetFeedback()),this.showErrorMessage(i.details&&i.details.message?i.details.message:i.message)}.bind(this))},onHelpIconFocusUrl:function(e){installAsasp("Data Enrichment"),e.setData({helpIconFocus:!0})},onHelpIconBlurUrl:function(e){e.setData({helpIconFocus:!1})},handleEnrichError:function(e,t){const a=(e=(e=JSON.parse(e.response)).__zia_org_enrichment?e.__zia_org_enrichment[0]:e.__zia_people_enrichment?e.__zia_people_enrichment[0]:e).code;let i=e.message;switch(a){case"LIMIT_EXCEEDED":return void this.limitExceedAlert();case"EXPECTED_FIELD_MISSING":i=I18n.getMsg("crm.label.auto.enrich.empty.data");break;case"FEATURE_NOT_ENABLED":if(i.toLowerCase().includes("extension"))return void this.showExtensionError(t);i=I18n.getMsg("crm.promo.cannot.enable",i.includes("People")?I18n.getMsg("crm.canvas.gallary.people")+" "+I18n.getMsg("crm.label.enrich"):I18n.getMsg("crm.label.auto.enrich"))}this.showErrorMessage(i)},limitExceedAlert:function(){_cruxUtils.showCustomAlert({params:{ltPropYield:!0,ltPropPrimaryMessage:I18n.getMsg("crm.data.enrich.limit.reached"),ltPropSecondaryMessage:"<div class='mB10'>"+I18n.getMsg("crm.data.enrich.limit.reached.info")+"</div><div>"+I18n.getMsg("crm.data.enrich.limit.reached.info1")+" <span class='cP crmLinkColor'>"+RebrandLinkUtil.getProperty("SUPPORTMAILID")+"</sapn></div>",ltPropButtons:[{type:"accept",appearance:"primary",text:I18n.getMsg("crm.button.ok"),cxPropZcqa:"button_1"}]}})},handleError:function(e,t=!1,a=!1){commonUtils.showHideLoadingDiv(!1);const i=(e=(e=JSON.parse(e.response)).data_enrichment?Array.isArray(e.data_enrichment)?e.data_enrichment[0]:e.data_enrichment:e).code?e.code:"";let n=e.message;switch(i){case"LIMIT_EXCEEDED":n=I18n.getMsg("crm.cpq.appliedrules.addsugstPrd.lmtexcd",e.details.limit);break;case"INVALID_DATA":e.details&&e.details.resource_path_index&&(n=I18n.getMsg("crm.auto.enrich.no.config")),a=!1;break;case"INTERNAL_SERVER_ERROR":a=!1;break;case"FEATURE_NOT_SUPPORTED":n=I18n.getMsg("crm.auto.enrich.edition.not.support");break;case"NO_PERMISSION":n=I18n.getMsg("crm.setup.attribution.NO_PERMISSION");break;case"FEATURE_NOT_ENABLED":if(n.toLowerCase().includes("extension"))return void this.showExtensionError(Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().component?Lyte.Router.getRouteInstance().component:Lyte.Router.getRouteInstance().ORComponent?Lyte.Router.getRouteInstance().ORComponent:Lyte.Router.getRouteInstance().outlet:void 0);n=I18n.getMsg("crm.promo.cannot.enable",n.includes("People")?I18n.getMsg("crm.canvas.gallary.people")+" "+I18n.getMsg("crm.label.enrich"):I18n.getMsg("crm.label.auto.enrich"))}this.showErrorMessage(n),t?Lyte.Router.transitionTo({route:"crm.settings.section.zia.data-enrichment.index-data-enrichment"}):a&&crmHistory.backOneLevel()}}),Lyte.Component.registerHelper("getFieldDisplayValue",(function(e){return e&&store.peekRecord("field",e)?store.peekRecord("field",e).field_label:I18n.getMsg("crm.label.field.do.not.map")})),Lyte.Component.registerHelper("getEnrichHelpLink",(function(){return commonUtils.getHelpUrl("help.zia.data.enrichment")})),Lyte.Component.registerHelper("getHelpIconFocusUrl",(function(){return Crm.userDetails.LOCALE.includes("iw")?networkUtils.getImageUrl("context-help-shadow-rtl.png",ResourceConstants.CRM):networkUtils.getImageUrl("context-help-shadow.png",ResourceConstants.CRM)})),Lyte.Component.registerHelper("getHelpIconBlurUrl",(function(){return Crm.userDetails.LOCALE.includes("iw")?networkUtils.getImageUrl("context-help-rtl.png",ResourceConstants.CRM):networkUtils.getImageUrl("context-help.png",ResourceConstants.CRM)})),Lyte.Component.registerHelper("getModuleNameForHistory",(function(e){return store.peekRecord("module",e).module_name})),Lyte.Component.registerHelper("isNewDataAdd",(function(e){return e.manage&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM})),Lyte.Component.registerHelper("checkFirstAndLastDate",(function(e,t){const a="pB70",i="ziaNewDateTag pB70";let n=!1,r=!1;return e[t+1]&&e[t].labelDate!==e[t+1].labelDate&&(n=!0),e[t-1]&&e[t].labelDate!==e[t-1].labelDate&&(r=!0),0===t?n?"ziaNewDateTag pB70 zEHFirstindex mT60":"ziaNewDateTag zEHFirstindex mT60 pB30":n&&r?i:n?a:r?"ziaNewDateTag pB30":"pB30"})),Lyte.Component.registerHelper("getSuggestedFields",(function(e,t){return e.find((e=>e.enrich_field.name===t)).suggested_values})),Lyte.Component.registerHelper("isLastField",(function(e,t,a){const i=e.find((e=>e.enrich_field.name===t)).suggested_values;return i[i.length-1]===a})),Lyte.Component.registerHelper("isAddOrRemoveTrigger",(function(e,t,a,i){const n=a.filter((e=>e.crm_field)).length;return e.length>1||e.length-1===i&&(t.name?e.length<n+1:e.length<n)})),Lyte.Component.registerHelper("getMappedTriggerFields",(function(e,t){const a="personal"===e.type&&e.trigger_fields.some((e=>e.crm_field&&["org_name","org_website"].contains(e.enrich_field.name)))?this.component.validateField("Leads"===e.module.module_name||"Contacts"===e.module.module_name?t.First_Name&&t.Last_Name?t.First_Name+" "+t.Last_Name:t.First_Name?t.First_Name:t.Last_Name:t[moduleRecordMapping[e.module.module_name].display_field.api_name])?[]:["org_name","org_website"]:[];return e.trigger_fields.filter((e=>e.crm_field&&!a.includes(e.enrich_field.name))).length})),Lyte.Component.registerHelper("isSearchHistory",(function(e){return e&&e.includes(I18n.getMsg("crm.label.searched.for"))})),Lyte.Component.registerHelper("getActionSplit",(function(e,t){return e&&void 0!==t?e.split("`~`")[t]:""})),Lyte.Component.registerHelper("getDropDownFields",(function(e,t){return e.filter((e=>!t.includes(e.id)))})),Lyte.Component.registerHelper("isSubFieldDisabled",(function(e){return!e||!e.some((e=>e.crm_fields.some((e=>""!==e.id))))})),Lyte.Component.registerHelper("getTriggerDisplayValue",(function(e,t){return t.find((t=>t.enrich_field.name===e)).enrich_field.display_label})),Lyte.Component.registerHelper("getModulePlural",(function(e){return e?store.peekRecord("module",e).plural_label:""})),Lyte.Component.registerHelper("isFieldNotMapped",(function(e){return!e||""===e})),Lyte.Component.registerHelper("isFieldDisabled",(function(e){return!e||!e.some((e=>""!==e.id))})),Lyte.Component.registerHelper("multipleTrigger",(function(e){return e.filter((e=>e.crm_field)).length>1})),Lyte.Component.registerHelper("getTriggerData",(function(e){if(!e||0===e.length)return"";let t="";e.filter((e=>e.crm_field)).forEach((e=>{t+=e.crm_field.name+", "}));const a=t.lastIndexOf(",");return-1!==a?t.slice(0,a)+t.slice(a+1):t})),Lyte.Component.registerHelper("isPeopleEnrichmentEnabled",(function(){return Crm.isPeopleEnrichmentEnabled})),Lyte.Component.registerHelper("getEnrichDisplayValue",(function(e,t){return"revenue"===e?(-1===window.location.href.indexOf("csez.zohocorpin.com")?Crm.userDetails.BASE_CURRENCY?Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY].symbol:"$":Crm.userDetails.DEFAULT_ORG_CURRENCY&&Crm.userDetails.DEFAULT_ORG_CURRENCY.symbol?Crm.userDetails.DEFAULT_ORG_CURRENCY.symbol:"$")+" "+currencyUtils.getNumberWithCommas(t):"no_of_employees"===e||"years_in_industry"===e&&t?currencyUtils.getNumberWithCommas(t):t}));
