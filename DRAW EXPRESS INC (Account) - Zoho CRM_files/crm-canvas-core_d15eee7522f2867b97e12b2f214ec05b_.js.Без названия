Lyte.Mixin.register("crm-canvas-core-construct-component",{ownerFieldCount:0,constructCruxComponentForCanvas:function(e,t,o,r,a,i,n,c,s,l,d,p){var u,m,v=t,_="MobileDetailView"===s;r=!!(Lyte.registeredMixins["crm-detailcanvas-utils"].isSandboxDiffPage||Lyte.registeredMixins["crm-detailcanvas-utils"].isProdDiffPage)||r;var f,y,g,h,x,b,C,w,M=o&&o.$&&objectUtils.cloneObject(o);o=$u.isEmpty(o)||void 0!==o.$module||!(o&&o.$&&o.$.toJSON)?o:o.$.toJSON();var A=[36,77,143,144,145];a&&(C=a.connectedModName,w=a.relatedListModule);var L,S=n?c:store.peekRecord("field",e),I=S.module&&S.module[0]?S.module[0].module_name:null;L=a||n?"fieldupdate_rl":"canvas_fld fieldupdate_"+S.column_name;var z=["website","email","lookup","multiselectlookup","Twitter"];(z.indexOf(S.data_type)>=0||z.indexOf(S.api_name)>=0)&&(L+=" zc-link-hover");var k={comptype:S.data_type,compId:e};if(o){if(y=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(o)),g=o.id+"","Activities"===t&&(u=o.Activity_Type,m=o.$se_module),"Tasks"===t||"Events"===t||"Calls"===t){if(n&&o.$se_module){var R;R={api_name:moduleApiMapping[o.$se_module]},S.lookup.module=R}m=o.$se_module}if("Member_Status"!==S.api_name||S.custom_field)if("Role"===S.api_name&&"CNTROLEID"===S.column_name){var F=o.Contact_Role,D=store.peekRecord("contact_role",F);h=D?D.name:null}else if(C&&I&&I!==w){var E=S.module[0].module_name,$=o&&o[C]?o[C].id:null;if($){var P=store.peekRecord(moduleRecordMapping[E].id,$);h=P?P[S.api_name]:null}if("profileimage"===S.data_type)return k.module=I,k.record=P,f=new CrmDetailViewHandler(k).getHTML();if(A.indexOf(S.ui_type)>=0){var O=P?P.Currency:"",T=P?P.Exchange_Rate:"";if(h)return f="<crux-number-component cx-prop-exchange-rate='"+T+"' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent  '+L+" \" cx-prop-iso-code='"+O+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-number-component>"}}else h=o[S.api_name];else h=o.$member_info?o.$member_info.Member_Status:null;h&&"object"==typeof h&&(!Array.isArray(h)||h.length>0)&&(x=h.id+"",(b=h.name+"")&&"string"==typeof b&&(b=$ESAPI.encoder().encodeForHTMLAttribute(b)),h=JSON.stringify(h)),h&&"string"==typeof h&&(h=$ESAPI.encoder().encodeForHTMLAttribute(h))}else if(C&&I&&I!==t&&I!==w){if(y='{{getConnectedModuleData(record,"'+(v=S.module[0].module_name)+'","'+C+'")}}',g='{{getConnectedModuleData(record,"'+v+'","'+C+'","id")}}',h='{{getConnectedModuleData(record,"'+v+'","'+C+'","'+(U=S.api_name)+'")}}',x='{{getConnectedModuleData(record,"'+v+'","'+C+'","'+U+'.id")}}',b='{{getConnectedModuleData(record,"'+v+'","'+C+'","'+U+'.name")}}',"Activities"===v&&(u='{{getConnectedModuleData(record,"'+v+'","'+C+'","'+U+'.Activity_Type")}}'),"profileimage"===S.data_type){return k.module=t,k.record=o,k.from=a,f=new CrmDetailViewHandler(k).getHTML()}if(A.indexOf(S.ui_type)>=0){var N='{{getConnectedModuleData(record,"'+v+'","'+C+'","Currency")}}',H='{{getConnectedModuleData(record,"'+v+'","'+C+'","Exchange_Rate")}}';O=P?P.Currency:"";return f="<crux-number-component cx-prop-exchange-rate='"+H+"' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+L+" \" cx-prop-iso-code='"+N+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-number-component>"}if(this.isRelListLookupFld(v,U))return f="<crux-lookup-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S,a,h))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+L+' "',"Activities"===v&&(f+=' cx-prop-query-params=\'{"sub_module" : "'+u+"\"}' "),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity"  cx-prop-dynamic-params=\'["'+v+'","'+g+"\"]'   cx-prop-value='"+h+"'></crux-lookup-component>"}else{var U;if("profileimage"===S.data_type)if(!!Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck())return k.module=I,k.record=P,k.compId=e,k.comptype=S.data_type,k.form_type=l,f=new CrmDetailViewHandler(k).getHTML();"Member_Status"!==(U=S.api_name)||S.custom_field?"Role"===U&&"CNTROLEID"===S.column_name?(y="{{record}}",g="{{record.id}}",h="{{getContactRoles(record."+(U="Contact_Role")+")}}"):"Status"===U&&"Events"===w?(U="status",y="{{record}}",g="{{record.id}}",h="{{getInvitedEventStatus(record.Participants)}}"):(y="{{record}}",g="{{record.id}}",h="{{record."+U+"}}",x="{{record."+U+".id}}",b="{{record."+U+".name}}"):(y="{{record}}",g="{{record.id}}",h="{{record."+(U="$member_info.Member_Status")+"}}"),"Activities"===v&&(u="{{record.Activity_Type}}",m="{{getSEmodulenameByApiname(record.$se_module)}}"),("Tasks"!==t&&"Events"!==t&&"Calls"!==t||"Who_Id"!==S.api_name)&&"What_Id"!==S.api_name||(m="{{getLookupModuleForWhoOrWhatId(record,'"+S.api_name+"','lookupModule')}}",x="{{getLookupModuleForWhoOrWhatId(record,'"+S.api_name+"','dataId')}}"),"Appointments"===t&&"Appointment_For"===U&&(v="{{getSEmodulenameByApiname(record.Appointment_For.module.api_name)}}")}if(_&&("Active"===S.api_name&&"PriceBooks"===I||"Product_Active"===S.api_name&&"Products"===I)&&(h=void 0!==h?h.toString():null),("Tasks"===t&&["Recurring_Activity","Remind_At","Who_Id","What_Id"].indexOf(S.api_name)>=0||"Calls"===t&&["Reminder","Who_Id","What_Id"].indexOf(S.api_name)>=0||"Events"===t&&["Recurring_Activity","Who_Id","What_Id"].indexOf(S.api_name)>=0||"Services"===t&&["Available_Dates"].indexOf(S.api_name)>=0)&&((i||p)&&M?h=Lyte.registeredMixins["crm-detailcanvas-utils"].constructFldValue(S.id,t,M):i||(h='{{getValueForField("'+S.id+'",record, module)}}')),"profileimage"===S.data_type)k.module=t,k.record=o,a&&(k.from=a),k.feature=s,f=new CrmDetailViewHandler(k).getHTML();else if(!Lyte.registeredMixins["crm-detailcanvas-utils"].isListViewPage()&&(S.subform||"subform"===S.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===S.data_type)&&S.section&&!a)f=_?"<crm-mobile-subform subform='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(S.section[0].$.toJSON()))+"'  subform_api='"+S.section[0].api_name+"' record='"+y+"' module='"+t+"'></crm-mobile-subform>":"<crm-detail-view-subform id='"+S.id+"' cx-Prop-Empty-Value=\"-\"  subform='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(S.section[0].$.toJSON()))+"'  subform_api='"+S.section[0].api_name+"' record='"+y+"' module='"+t+"'></crm-detail-view-subform>";else if("Quotes"!==t&&"SalesOrders"!==t&&"PurchaseOrders"!==t&&"Invoices"!==t||"Product_Details"!==S.api_name||!S.section){if("PriceBooks"===t&&"Pricing_Details"===S.api_name)f=_?"<crm-mobile-pricing-detail record='"+y+"'></crm-mobile-pricing-detail>":'<crm-detail-view-pricing-details cx-Prop-Empty-Value="-"  record=\''+y+"'></crm-detail-view-pricing-details>";else if("Comments"===S.api_name&&99===S.ui_type)if(_)f='<crm-mobile-comment-info record="'+y+'"></crm-mobile-comment-info>';else{var j=!1;i&&(j=!0),f='<crm-comment-information cx-Prop-Empty-Value="-" class="zc_cursor_nodrop canvasCruxComponent '+L+' " lyte-unbound= '+j+' cx-Prop-Empty-Value="-" cx-prop-field=\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' ",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="record='"+y+"'></crm-comment-information>"}else if("Status"===S.api_name&&"Events"===w)if(i){var V=$L("crm-detailview-canvas-gallery")[0];if(G=V?V.component.getData("record"):store.peekAll(moduleRecordMapping[t].id)[0]){var q=o?store.peekRecord(moduleRecordMapping.Events.id,o.id):null;if(q)f="<span>"+Lyte.Component.registeredHelpers.getInvitedEventStatus(q,G)+"</span>"}}else f="{{unescape(getInvitedData( "+i+" , fromRecord , '"+t+"' , record ))}}";else if(null!=h&&(!Array.isArray(h)||h.length>0)&&("string"==typeof h?h.length>0:"boolean"!=typeof h||h)){var J=Lyte.registeredMixins["crm-detailcanvas-utils"].getCruxName(S.ui_type,S.data_type);if("SERVICEDURATION"===S.column_name&&(J="picklist"),_&&("Active"===S.api_name&&"PriceBooks"===I||"Product_Active"===S.api_name&&"Products"===I)){J="text";var Z=S.api_name;h=o?!0===o[Z]?"Active":"InActive":'{{PriceBookStatusChange(record,"'+Z+'")}}'}if("Entity_Cadences"===v)f=Crm.userDetails.isRelatedListLyteEnabled?"<crux-lookup-component  onclick=\"Lyte.registeredMixins['crm-related-list-utils'].OpenSeriesPop('{{record.id}}','{{record.End_Date__s}}',event)\" data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"'  class=\"cP canvasCruxComponent "+L+' "  cx-Prop-Empty-Value="-" ':"<crux-lookup-component  onclick=\"crmRelatedList.OpenSeriesPop('{{record.id}}','{{record.End_Date__s}}',event)\" data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"'  class=\"cP canvasCruxComponent "+L+' "  cx-Prop-Empty-Value="-" ',f+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"'  cx-prop-value='"+h+"'></crux-lookup-component>";else if(4===S.ui_type||"lookup"===S.data_type)f="<crux-lookup-component onmouseenter=\"{{action('showHideRelatedFields','"+t+"','"+e+"',event ,record.id)}}\" onmouseleave=\"{{action('showHideRelatedFields',,,event)}}\" on-value-change=\"{{method('onValueChange')}}\"   data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-" ',"Who_Id"===S.api_name||"What_Id"===S.api_name?f+=' class="canvasCruxComponent canvasmultimoduleActivitylookup '+L+'" ':f+=' class="canvasCruxComponent '+L+'" ',"Activities"===v&&(f+=' cx-prop-query-params=\'{"sub_module" : "'+u+"\"}' "),"Activities"===v||"Tasks"===v||"Events"===v||"Calls"===v?a||"DetailView"!==s||"Who_Id"!==S.api_name&&"What_Id"!==S.api_name||(f+="cx-prop-type='multi_module_lookup'"):m="Service_Name"===S.api_name&&"Appointments"===v?"Services":S&&S.lookup&&S.lookup.module?S.lookup.module.api_name:m,store.peekAll("module").forEach((function(e){e.api_name==m&&(m=e.module_name)})),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity"  cx-prop-dynamic-params= ["'+m+'","'+x+'"] cx-prop-transition-data={{transitionDataHandler("'+t+"\",record)}} cx-prop-value='"+h+"'></crux-lookup-component>";else if(132==S.ui_type&&"multi_module_lookup"==S.data_type&&"Connected_To__s"===S.api_name)f="<crux-lookup-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-" ',f+="cx-prop-type='multi_module_lookup'",i&&o?(b=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(o[S.api_name])),f+='class="canvasCruxComponent  canvasmultimodulelookup zc_nonempty '+L+' " ',f+='cx-prop-icon-class= "zcicncss-attachments-colored zcicncss14" '):(b="{{record."+S.api_name+"}}",f+="class=\"canvasCruxComponent canvasmultimodulelookup {{addConnectedRecordNonEmptyClass(record,'"+S.id+"')}} "+L+' " ',f+="onmouseenter=\"{{action('showHideRelatedFields','"+t+"','"+e+"',event,record.id)}}\" onmouseleave=\"{{action('showHideRelatedFields',,,event,record.id)}}\" cx-prop-dynamic-params =\"{{getDynamicParamForMultiModule(record,'"+S.id+'\')}}"  cx-prop-icon-class= "zcicncss-attachments-colored zcicncss14" '),f+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity"  cx-prop-value="'+b+'"></crux-lookup-component>';else if(132==S.ui_type&&"multi_module_lookup"==S.data_type)f="<crux-lookup-component  onmouseenter=\"{{action('showHideRelatedFields','"+t+"','"+e+"',event,record.id)}}\" onmouseleave=\"{{action('showHideRelatedFields',,,event,record.id)}}\"  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"'  class=\"canvasCruxComponent canvasmultimoduleActivitylookup "+L+' "  cx-Prop-Empty-Value="-" ',"Appointments"!==t||"Appointment_For"!==S.api_name||a||"DetailView"!==s||(f+="cx-prop-type='multi_module_lookup'",b=h),f+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity"  cx-prop-dynamic-params = ["'+v+'","'+x+'"]  cx-prop-value="'+b+'"></crux-lookup-component>';else if(445==S.ui_type)f="<crux-user-component  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\'  cx-Prop-Empty-Value="-" class="canvasCruxComponent '+L+" \"  cx-prop-value='"+h+"' cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' ",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="cx-prop-value='"+h+"' cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"'></crux-user-component>";else if(444==S.ui_type){j=!1;i&&(j=!0);var B=S.api_name;S.multiselectlookup&&S.multiselectlookup.connectedlookup_apiname&&(B=S.multiselectlookup.connectedlookup_apiname);var W="subvalue"+S.id.trim();f="<crm-multi-lookup lyte-unbound= "+j+" data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' cx-Prop-Empty-Value=\"-\" class='canvasCruxComponent "+L+" ' cx-prop-field-arr='"+h+" ' data-key='"+W+" ' cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-field-label='"+B+"'></crm-multi-lookup>"}else if(8==S.ui_type){f="<crm-owner-field ownerfieldzcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+" ownerField_"+this.ownerFieldCount+'"  zia_owner_assignment="{{record.$zia_owner_assignment}}" parent-comp-name="crm-detailview-canvas" owner-field-count="'+this.ownerFieldCount+'"',!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crm-owner-field>",this.ownerFieldCount++}else if(221==S.ui_type){let t=!!(Crm.userDetails.isDynamicLookupFilterEnabled&&S.lookup&&S.lookup.query_details&&S.lookup.query_details.query_id);f="<crux-"+J+"-component  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent  '+L+" \"   cx-prop-is-business-card='true' cx-prop-forced-fetch='"+t+"' ",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crux-"+J+"-component>"}else if(37==S.ui_type)f="<crm-skype-field  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' cx-Prop-Empty-Value=\"-\" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' class='canvasCruxComponent "+L+" ' ",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+=" crm-skype-value='"+h+"'></crm-skype-field>";else if(555==S.ui_type&&"Call_Transcription__c"!==S.api_name){j=!1;i&&(j=!0);var Y=[];o&&(Y=Lyte.registeredMixins["crm-uploadfields-mixin"].getFileDataInCruxFormat(o[S.api_name]));let e='"canvasCruxComponent canvas_fld maxW100per crm-font-regular '+L+'"',t=C?'{{getConnectedModuleDataForUploadFields(record,"'+S.module[0].module_name+'","'+C+'","'+S.api_name+'","fileupload")}}':'{{getFilesDataInCruxFormat(record["'+S.api_name+'"])}}',r=i?'"'+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(Y))+'"':t,a=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON())),c=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(this.data?this.data.optionsForFileUpload:[])),s="{{method('cruxFileUploadShowPreview')}}",l="{{method('onRemoveFileClick')}}",d="{{method('onFileUploadOptionClick',fieldrecord.module[0].api_name)}}",p=this.getZcqa(S),u="label_"+S.column_name,m="subvalue_"+S.column_name;f="<crux-file-upload-component fieldid="+S.id+" class="+e+' cx-prop-zcqa="'+p+'" id="'+m+'" cx-prop-id="'+u+'" cx-prop-from="view" cx-prop-empty-value="-" cx-prop-field="'+a,f+='" cx-prop-value='+r+' cx-prop-options-type="menu" cx-prop-options="'+c+'" ',f+='cx-prop-file-unique-selector="unique_file_selector" show-preview="'+s+'" on-remove-file="'+l+'" on-menu-click="'+d+'" cx-prop-file-limit="'+S.length+'" cx-prop-readonly="'+S.read_only+'"></crux-file-upload-component>'}else if(S.ui_type===CrmField.UITYPES.IMAGE_UPLOAD)f=this.getImageUploadComponentData(o,S,v,h,g,C,i);else if(A.indexOf(S.ui_type)>=0||116===S.ui_type&&"currency"===S.formula.return_type||118===S.ui_type&&"currency"===S.rollup_summary.return_type||117===S.ui_type){O=o?o.Currency:"{{record.Currency}}";if(f="<crux-number-component cx-prop-exchange-rate= {{record.Exchange_Rate}}",o&&o.id)(G=store.peekRecord(moduleRecordMapping[t].id,o.id))&&G.$formatted_currency&&G.$formatted_currency[S.api_name]&&(f+=' cx-prop-formatted-currency= "'+G.$formatted_currency[S.api_name]+'"'),G&&G.$home_converted_currency&&G.$home_converted_currency[S.api_name]&&(f+=' cx-prop-home-currency= "'+G.$home_converted_currency[S.api_name]+'"');else f+=' cx-prop-formatted-currency="{{canvasformattingCurrency('+("record.$formatted_currency."+S.api_name)+')}}" ',f+=' cx-prop-home-currency="{{canvasformattingCurrency('+("record.$home_converted_currency."+S.api_name)+')}}" ';O?(f+=" data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent  "+L+' " cx-Prop-Empty-Value="-"  cx-prop-iso-code=\''+O+"' ",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-number-component>"):f+=" data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+' " cx-Prop-Empty-Value="-"  cx-prop-field=\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-number-component>"}else{if(25===S.ui_type||"Email"===S.api_name){var G,Q=!0;return(G=o||(this.$node&&this.getData("records")?this.getData("records")[0]:void 0))&&G.Data_Processing_Basis_Details&&!G.Data_Processing_Basis_Details.Contact_Through_Email&&(Q=!1),f="<crm-email-field class='canvasCruxComponent "+L+" ' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' record=\"{{record}}\" module-name='"+t+"'  email-opt-out="+!1+" email-opt-value="+Q,!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="  cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crm-email-field>"}if(999==S.ui_type){var K=!(!a&&!Lyte.registeredMixins["crm-detailcanvas-utils"].isListViewPage()),X=a?a.relatedListModule:t,ee=i?"zcflag lyte-rendered":"",te=!!i;return f="<crm-assign-territory-detail-view cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"'  class=\"canvasCruxComponent "+L+"\" seid='"+g+"'",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="module='"+X+"' from-rl="+K+" from-canvas-view='true' "+ee+" lyte-unbound="+te+"' from-canvas-editor="+te+"></crm-assign-territory-detail-view>"}if(r&&this.isRelListLookupFld(t,S.api_name))f="<crux-lookup-component  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S,a,h))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+L+' "',r||(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),"Activities"===v&&(f+=' cx-prop-query-params=\'{"sub_module" : "'+u+"\"}' "),"crm.tab.module.custom-view.canvas"===Lyte.Router.getRouteInstance().__lp.objPath?f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-route-name={{getCanvasId('"+t+"',record)}}  cx-prop-dynamic-params ={{getCanvasId('"+t+"',record,"+!0+')}} cx-prop-transition-data={{transitionDataHandler("'+t+'",record)}}  cx-prop-value="'+h+'"></crux-lookup-component>':f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity"  cx-prop-dynamic-params =\'["'+t+'","'+g+'"]\' cx-prop-transition-data={{transitionDataHandler("'+t+'",record)}}  cx-prop-value="'+h+'"></crux-lookup-component>',!a||"Activities"!==a.relatedListModule&&"Tasks"!==a.relatedListModule||"Subject"!==S.api_name||(f+=Lyte.Component.registeredHelpers.getColorCodeForEvents(i,o),f+='<template is="if" value="{{record.$in_project_sync}}"><template case="true"><span style="margin-left: 2px;margin-bottom: 2px;" class="task_syncIcon vaM" lt-prop-title="{{concat(getI18n(&quot;crm.schedules.prefix.in&quot;),getI18n(&quot;crm.integ.sync.message&quot;,&quot;crm.project.integration.title&quot;))}}"  lt-prop-tooltip-config="{&quot;position&quot;:&quot;followcursor&quot;, &quot;appearance&quot; : &quot;box&quot;}"></span></template>');else if("SERVICEDURATION"!==!S.column_name||"integer"!==S.data_type&&"currency"!==S.data_type)if("tag"===J){if(i&&h.length<=2)return f;i&&$&&(y=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(P)),t=E);K=!1;(a&&(a.relatedListModule||a.connectedModName)||n)&&(K=!0);j=!1;i&&(j=!0);var oe=!1;d&&d.ui&&d.ui.value&&d.ui.value.fixed&&(oe=!0),f="<crm-tag fixed-component="+oe+' class="crmtagrecord_'+g+'" lyte-unbound='+j+" from-Rl="+K+"  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' cx-Prop-Empty-Value=\"-\" record='"+y+"' module=\""+t+'" record-id="'+g+'"></crm-tag>'}else if("picklist"===J||"multi-picklist"===J){var re=S;if(t=S.module&&S.module[0]?S.module[0].api_name:t||"",f="<crux-picklist-component   data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+L+" \" cx-prop-from='view'",!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),"multi-picklist"===J)f+="cx-prop-type= ' multisearch ' ";else if("picklist"===J&&S.enable_colour_code&&"Activities"!==t||Lyte.registeredMixins["crm-detailcanvas-utils"].isListViewPage()&&"picklist"===J&&S.enable_colour_code&&"Activities"===t){S[se=(ce=(ce=$L("crm-detailview-canvas")[0]?$L("crm-detailview-canvas")[0]:$L("crm-detailview-oldeditor")[0])||$L("crm-detailview-canvas-gallery")[0])?ce.component.data.layoutId:""]&&null!==S[se]&&(f+=" cx-prop-layout="+se),_||(f+=" cx-prop-is-color-code-enabled="+S.enable_colour_code)}if("SERVICEDURATION"===S.column_name){var ae="";if(i)ce=(ce=$L("crm-detailview-oldeditor")[0])||$L("crm-detailview-canvas-gallery")[0],ae=JSON.stringify(ce.component.executeMethod("setDurationOptions",o));else ae="{{getPKValuesForServiceDuration(record)}}";f+="cx-prop-picklist-values="+ae}f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:re.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-picklist-component>"}else if(116===S.ui_type&&"boolean"===S.formula.return_type)f="<crux-"+S.formula.return_type+"-component   data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"'  class=\"canvasCruxComponent "+L+' " cx-Prop-Empty-Value="-" ',f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crux-"+S.formula.return_type+"-component>";else if(301===S.ui_type&&"Email_Opt_Out"===S.api_name)f="<crm-email-field data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' record="{{record}}" class="canvasCruxComponent '+L+' " cx-Prop-Empty-Value="-" module-name=\''+t+"' email-opt-out="+!0+" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crm-email-field>";else if(104===S.ui_type&&"multireminder"===S.data_type){var ie="{{record}}",ne=!0;i&&(ie=JSON.stringify(o),ne=!1),f="<crm-reminder-view data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+" \" record='"+ie+"' place=\"view\" remfield= '"+JSON.stringify(n?S:S.$.toJSON())+"' module='"+t+"' viewport = "+ne+"></crm-reminder-view>"}else if(21===S.ui_type&&"Voice_Recording__s"===S.api_name){var ce,se;ie="{{record}}";i&&(ie=JSON.stringify(o)),f="<crux-voicenote-component  cx-Prop-Empty-Value=\"-\" cx-prop-width='auto' cx-prop-appearance='box' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+"\" cx-prop-field= '"+JSON.stringify(n?S:S.$.toJSON())+"' cx-prop-value='"+h+"'",S[se=(ce=(ce=$L("crm-detailview-canvas")[0]?$L("crm-detailview-canvas")[0]:$L("crm-detailview-oldeditor")[0])||$L("crm-detailview-canvas-gallery")[0])?ce.component.data.layoutId:""]&&null!==S[se]&&(f+=" cx-prop-layout="+se),f+="></crux-voicenote-component>"}else if("Call_Transcription__c"===S.api_name){var le="{{record.id}}";i&&(le=o.id),f="<crm-zia-call-transcription activity-id='"+le+"'></crm-zia-call-transcription>"}else if("number"==typeof h&&(h=h.toString()),(116===S.ui_type&&"double"===S.formula.return_type||118===S.ui_type&&("longinteger"===S.rollup_summary.return_type||"integer"===S.rollup_summary.return_type||"decimal"===S.rollup_summary.return_type))&&(J="number"),3==S.ui_type||110==S.ui_type){j=!1;i&&(j=!0),f=Lyte.registeredMixins["crm-detailcanvas-utils"].isListViewPage()?"<crux-"+J+"-component cx-prop-highlight-url='true' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' lyte-unbound= "+j+' class="canvasCruxComponent '+L+' " cx-Prop-Empty-Value="-" ':"<crux-"+J+"-component cx-prop-highlight-url='true' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+'\' cx-Prop-MaxCharacter="295" lyte-unbound= '+j+' class="canvasCruxComponent '+L+' " cx-Prop-Empty-Value="-" ',!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),3==S.ui_type&&(f+="on-show-more=\"{{method('multiLineFieldShowLess')}}\""),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crux-"+J+"-component>"}else if(250===S.ui_type)f="<crm-richtext-component cx-prop-highlight-url='true' data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+' " cx-Prop-Empty-Value="-" cx-prop-from="view"',!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+="cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crm-richtext-component>";else{if(f="<crux-"+J+"-component data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' "+("user"===J?"cx-prop-show-bus-card='true'":"")+' class="canvasCruxComponent '+L+' " cx-Prop-Empty-Value="-" ',33==S.ui_type)f+="cx-prop-module='"+v+"' cx-prop-entity-name='"+(o?o.Full_Name:"{{record.Full_Name}}")+"' cx-prop-entity-id='"+g+"'";"phone"===J&&o&&S&&33==S.ui_type&&(h=Lyte.Component.registeredHelpers.getFormattedPhoneNumber(o,h,S)),"user"===J&&(f+="cx-prop-is-business-card='true'"),"Events"===v&&"Event_Title"===S.api_name&&11==S.ui_type&&(f+='style="cursor: pointer;"'),!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),!i&&a&&"Activities"===a.relatedListModule&&"Activity_Type"===S.api_name&&(h="{{meetingLiteral(record)}}"),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"' ></crux-"+J+"-component>",a&&("Activities"===a.relatedListModule||"Tasks"===a.relatedListModule)&&"Subject"===S.api_name&&o&&o.$in_project_sync&&(f+='<span style="margin-left: 2px;margin-bottom: 2px;" class="task_syncIcon vaM"></span>'),a&&"Activities"===a.relatedListModule&&"Subject"===S.api_name&&(f+=Lyte.Component.registeredHelpers.getColorCodeForEvents(i,o))}else f="<crux-"+J+"-component  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(S))+"' class=\"canvasCruxComponent "+L+' " cx-Prop-Empty-Value="-" ',!r&&this.isAjaxEditableField(e)&&(f+=" onmouseenter=\"{{action('handleMouseActions',this)}}\" onmouseleave=\"{{action('handleMouseActions',this)}}\""),f+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n?S:S.$.toJSON()))+"' cx-prop-value='"+h+"'></crux-"+J+"-component>"}}}else f="<crm-detail-view-subform id='"+S.id+"' cx-Prop-Empty-Value=\"-\"  subform='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(S.section[0].$.toJSON()))+"' subform_api='"+S.section[0].api_name+"' record='"+y+"'  module='"+t+"'></crm-detail-view-subform>";return f&&a&&"Events"===a.relatedListModule&&"Event_Title"===S.api_name&&!_&&(f+=Lyte.Component.registeredHelpers.getColorCodeForEvents(i,o)),f},getZcqa:function(e,t,o,r){return!Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()&&!Lyte.registeredMixins["crm-detailcanvas-utils"].isWizardView()||r?t?"relatedList_"+o+"_"+(t.connectedModName?t.connectedModName:t.relatedListModule):"TimeLineView"===Crm.userDetails.openActRelView||"TimeLineView"===Crm.userDetails.closedActRelView?e.custom_field?"value_"+e.display_label:"value_"+e.field_label:e.custom_field?"value_"+e.display_label:"value_"+e.column_name:e.custom_field?e.display_label:e.column_name},constructCruxCompForForm:function(e,t,o,r,a,i,n,c,s,l,d,p){var u,m="form_edit"===d||"form_clone"===d||"form_create"===d,v=$L("crm-detailview-oldeditor")[0],_=$L("crm-canvas-form");if("form_create"===d||"form_edit"===d||"form_clone"===d||"form_gallery"===d)u=_[0];else if("form_preview"===d||"builder_preview"===d){var f=$L("crm-canvas-dynamic-preview");u=window.isCanvasSandboxDiff&&f[1]||f[0]}else u="FormView"===d||"WizardView"===d?v:$L("crm-detailview-canvas")[0];"form_gallery"===d&&(u=u||(v||$L("crm-form-view-canvas-gallery")[0]));var y,g=(u="FormView"!==d||u?u:$L("crm-form-view-canvas-gallery")[0])?u.component.data.layoutId:Lyte.Router.getRouteInstance().getQueryParams().layoutId,h=store.peekRecord("field",e),x='{{setValueForComponent(record,"'+h.id+'", "'+g+'")}}',b=this.$node&&"CRM-CANVAS-FORM"===this.$node.tagName;if("COUNTRY"===h.column_name||"BILLINGCOUNTRY"===h.column_name||"Company"===h.api_name&&Lyte.registeredMixins["crux-textautocomplete-options"]){var C=u&&u.component;y=JSON.stringify(C&&C.getTextAutocompleteOptions({column_name:"COUNTRY"})),y=$ESAPI.encoder().encodeForHTMLAttribute(y)}var w=h.$.toJSON();(o&&(w.required=!0),s)&&(n=((u&&u.getData("cscriptconfigs")||{}).field||{})[h.id]);n&&n.maxlen&&(w.length=n.maxlen);var M="",A="";if("form_edit"===d||"form_clone"===d||"form_create"===d&&t&&t[h.api_name])A=void 0!==a&&a?i:Lyte.registeredMixins["crm-detailcanvas-utils"].preProcessFieldValue(t,h,c),["text","textarea"].includes(h.data_type)&&$u.isString(A)&&(A=$ESAPI.encoder().encodeForHTMLAttribute(A));else{A=void 0!==a&&a?i:Lyte.registeredMixins["crm-detailcanvas-utils"].preProcessFieldValue(t,h,c);["text","textarea"].includes(h.data_type)&&(A=$ESAPI.encoder().encodeForHTMLAttribute(A))}var L=h.tooltip,S="";L&&"Static Text"===L.name&&(S=$ESAPI.encoder().encodeForHTMLAttribute(L.value)),r?(r=$ESAPI.encoder().encodeForHTMLAttribute(r),r=$ESAPI.encoder().encodeForHTMLAttribute(r)):r="";var I=crmConstants.defaultUiTypeToCruxMapping[h.ui_type];I||(I="multi_module_lookup"===h.data_type?"lookup":h.data_type),M="";var z,k="",R="form_create"===d||"form_edit"===d||"form_clone"===d||"FormView"===d||"WizardView"===d||"form_preview"===d||"form_gallery"===d;if(R){if("form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&"form_preview"!==d||p)if(Lyte.registeredMixins["crm-detailcanvas-utils"].isCanvasWizardBuilder()||"form_gallery"===d||p)F="";else var F=" lyte-rendered zcflag ";else var F=" lyte-view-port=true ",D=" cx-prop-prevent-focus-on-error=true ";var E="";if((208===h.ui_type||"ROI"===h.column_name&&h.field_read_only)&&(h.read_only=!0,w.read_only=!0),m){var P=!1;8!==h.ui_type||Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+h.module[0].module_name]||(P=!0),o?E="zc_mandatorystate":(h.read_only||P)&&(E="zc_disabledstate")}var O="formviewfield fieldupdate_"+h.column_name;if(301===h.ui_type?k=` class="zcanvas_value_input ${O} ${E}" cx-prop-input-class="zc-icon zcanvas icon-Icon_uncheck zcanvas-input-icon zcanvas_checkbox_icon zcicon" cx-prop-wrapper-class="zcanvas_inputwrapper" `:8===h.ui_type||20===h.ui_type||221===h.ui_type||55===h.ui_type?k=` class="zcanvas_value_lookup ${O} ${E}" cx-prop-wrapper-class="zcanvas_crux_lookup" `:132===h.ui_type?k=` class="zcanvas_value_lookup ${O} ${E}" cx-prop-wrapper-class="zcanvas_crux_lookup zcanvas_multimodule_lookup" `:"Country"===h.api_name&&"COUNTRY"===h.column_name||"Billing_Country"===h.api_name&&"BILLINGCOUNTRY"===h.column_name||"Company"===h.api_name||133===h.ui_type?k=` class="zcanvas_value_with_icon ${O} ${E}" `:36===h.ui_type||143===h.ui_type||144===h.ui_type||145===h.ui_type?k=` class="zcanvas_value_with_icon zcanvas_currency_field ${O} ${E}" `:2===h.ui_type||207===h.ui_type||208===h.ui_type||100===h.ui_type||26===h.ui_type||96===h.ui_type||445===h.ui_type||39===h.ui_type?k=` class="zcanvas_value_dropdown ${O} ${E}" `:22===h.ui_type?k=`class="zcanvas_value_insidelabel ${O} ${E}"  cx-prop-input-class="zcanvas_input" cx-prop-class="zcanvas_inputwrapper" `:33===h.ui_type&&Crm.userDetails.isPhoneNoNewView?k=`class="zcanvas_value_with_dropdown ${O} ${E}"  cx-prop-input-class="zcanvas_input" cx-prop-wrapper-class="zcanvas_inputwrapper" cx-prop-dropdown-class= "zcanvas_value_with_dropbutton" cx-prop-is-dropdown-icon-node=true cx-prop-dropdown-icon-class= "zcanvas zcanvas-input-icon icon-Icon_dropdownfill" `:200===h.ui_type||333===h.ui_type?k=`class="zcanvas_value_input  zcanvas_datetime_field ${O} ${E}"  cx-prop-input-class="zcanvas_input zcanvas_date_input" cx-prop-wrapper-class="zcanvas_inputwrapper zcanvas_datetime_wrapper" cx-prop-input-time-class="zcanvas_input zcanvas_time_input"  `:556!==h.ui_type&&555!==h.ui_type&&(k=`class="zcanvas_value_input ${O} ${E}"  cx-prop-input-class="zcanvas_input" cx-prop-wrapper-class="zcanvas_inputwrapper" `),2===h.ui_type||26===h.ui_type||39===h.ui_type)k+=' cx-prop-class="zcanvas_dropdown" cx-prop-dropdown-icon-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill"  ';else if(207===h.ui_type||208===h.ui_type||100===h.ui_type||96===h.ui_type||445===h.ui_type)k+=' cx-prop-class="zcanvas_dropdown" cx-prop-dropdown-icon-node-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill"  cx-prop-is-dropdown-icon-node=true';else if(8===h.ui_type||20===h.ui_type||55===h.ui_type)k+=' cx-prop-class="zcanvas_dropdown" cx-prop-dropdown-icon-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill" cx-prop-icon-class="zcanvas icon-Icon_userlookup zcanvas_icon_nochange zcanvas-input-icon1 zcanvas-right-icon" cx-prop-right-icon-class="zcanvas_inputicon_container " ';else if(221===h.ui_type)k+=' cx-prop-dropdown-icon-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill" cx-prop-icon-class="zcanvas icon-Icon_userlookup zcanvas_icon_nochange zcanvas-input-icon1 zcanvas-right-icon" cx-prop-right-icon-class="zcanvas_inputicon_container " ';else if(36===h.ui_type||143===h.ui_type||144===h.ui_type||145===h.ui_type)k+='  cx-prop-icon-class="zcanvas icon-Icon_Info_outline zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon" cx-prop-right-icon-class="zcanvas_inputicon_container " cx-prop-tooltip-class="canvasCalculatorPopoverWrapper"  ';else if(132===h.ui_type){if(k+=' cx-prop-right-icon-class="zcanvas_inputicon_container" cx-prop-dropdown-icon-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill" ',b)k+="  cx-prop-icon-class='zcanvas zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon {{setClassIcon(record,\""+h.id+"\")}}' ";else k+=`  cx-prop-icon-class="zcanvas ${ze=this.getModuleIcon(h.multi_module_lookup.modules[0].api_name)} zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon" `}else if(133===h.ui_type){var T="";T="lookup"===h.data_type?h.lookup.module.api_name:h.multi_module_lookup.api_name,k+=`  cx-prop-icon-class="zcanvas ${ze=this.getModuleIcon(T)} zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon" cx-prop-right-icon-class="zcanvas_inputicon_container "  `}556!==h.ui_type&&555!==h.ui_type&&"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&(k+=' cx-prop-readonly=true cx-prop-tooltip="" '),556===h.ui_type&&"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&(k+=' cx-prop-tooltip="" '),32!==h.ui_type&&34!==h.ui_type&&38!==h.ui_type&&52!==h.ui_type&&40!==h.ui_type||(k+=" cx-prop-direction='vertical' "),556===h.ui_type&&(k+=` class=" zcanvas_value_button ${O} ${E}" `),555===h.ui_type&&(k+=`class=" zcanvas_value_fileupload_button zcinputicon ${O} ${E}" `),3!==h.ui_type&&110!==h.ui_type||(k+=" cx-prop-height=50 ");var N=Lyte.Router.getRouteInstance().currentModel;if("picklist"===h.data_type){var H=N&&(N.blueprint||N.bluePrintProcessInfo),U=H&&H.process_info&&H.process_info.field_id===h.id;if("form_edit"===d&&U)var j=!0}8===h.ui_type&&"form_edit"===d&&(k+=" cx-prop-hide-lookup-icon=true ");var V=!1;if(Crm.userDetails.LITE&&Crm.userDetails.LITE.IS_LITE_USER&&"form_create"===u.getData("form_type")&&(V=!0),(h.read_only||j||8===h.ui_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+h.module[0].module_name]||"ROI"===h.column_name)&&301!==h.ui_type&&!V){if("Reporting_To"===h.api_name)var q="icon-Icon_Contacts";else q="icon-Icon_lock";k+=` cx-prop-disabled=true cx-prop-disabled-icon-class='${q} zcanvas_disabled_icon zcanvas_icon_nochange zcanvas zcanvas-input-icon2 ' cx-prop-show-disabled-icon='true'`}}var J="";"picklist"!==h.data_type&&"multiselectpicklist"!==h.data_type||(b?(z='{{setPicklistValues(record, "'+h.id+'", "'+g+'")}}',J="on-show=\"{{method('onDropDownShow')}}\" on-hide=\"{{method('onDropDownHide')}}\" on-option-selected=\"{{method('onOptionSelected', this)}}\" "):z="Stage"===h.api_name?this.stageValues(h,t,g):h.canvasDependencyMap&&h.canvasDependencyMap.length>0?h.canvasDependencyMap:h[g]?h[g].pick_list_values:h.pick_list_values);var Z="";D="";if("form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(p?(Z="onfocusout=\"{{Lyte.registeredMixins['crm-formview-mixin'].onCruxFocusOut(this)}}\"",D=" cx-prop-prevent-focus-on-error=true "):("boolean"!==h.data_type&&301!==h.ui_type&&(Z="onfocusout=\"{{action('onCruxFocusOut', this)}}\" "),D=" cx-prop-prevent-focus-on-error=true "),33===h.ui_type&&Crm.userDetails.isPhoneNoNewView&&(Z+=" on-before-show=\"{{method('onDropDownShow')}}\" on-before-hide=\"{{method('onDropDownHide')}}\" "),p&&"currency"===h.data_type&&(Z+=" cx-prop-boundary='{\"top\" : 115}' ")),"form_create"===d||"form_edit"===d||"form_clone"===d)var B=!1;else B=!0;if(96===h.ui_type)M="<crux-picklist-component cx-prop-error-message = '"+r+"' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-placeholder='"+S+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A)))+"' "+k+F+Z+D+"></crux-picklist-component>";else if(500===h.ui_type){var W=g||Lyte.Router.getRouteInstance().getQueryParams().layoutId,Y=h.section.filter((function(e){return e.layout&&e.layout.id===W}))[0],G=u&&u.component.data.currentInstObjKey;M='<crm-create-subformsection cx-Prop-Empty-Value="-"  subform-section-id=\''+Y.id+'\' from="FormView" prevent-subform-cscript-execution={{lbind(preventSubformCscriptExecution)}} module-formulafields={{lbind(moduleFormulafields)}} is-builder= '+B+" current-inst-obj-key='"+G+"' module-name='"+h.module[0].module_name+"' module-id='"+h.module[0].id+"'"+F+">",M+="</crm-create-subformsection>"}else if(51===h.ui_type){var Q=h.section[0];G=u&&u.component.data.currentInstObjKey;var K=!1;b||(Q[G]={},K=!0),Lyte.Component.set(Q[G],"isvalidSection",K),Lyte.Component.set(Q[G],"haveValidFields",!0);t="form_preview"===d?{}:t;var X={sectionId:Q.id,isCreatePageComp:!(!b&&!p),initRoute:"form_edit"===d?"edit":"create",moduleId:h.module[0].id};M+="<crm-create-pricingdetails sections-curnt-inst-obj="+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(Q[G]))+" fieldname-vf-record="+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({}))+' toggle="false" is-wizard='+Lyte.registeredMixins["crm-detailcanvas-utils"].isWizardView()+" current-inst-obj-key="+G+' global-data="'+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({}))+'" data-bind='+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(t))+" current-layout="+g+" custom-form-obj="+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(X))+" is-canvas-form=true></crm-create-pricingdetails>"}else if(250===h.ui_type){var ee=!1,te=$L(".rtfViewModalValWrap").closest("lyte-yield")[0];te&&te._callee&&te._callee.ltProp("show")&&(ee=!0);var oe=B?"view":"create";M="<crm-richtext-component id='"+("zc_richText_"+w.api_name)+"' is-lyte-create= 'true' comp-func-used= 'true'cx-prop-maxlength= '"+w.length+"' cx-prop-from = '"+oe+"' class='canvasCruxComponent zcanvas_value_richtext zc_formviewfield' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h))+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' cx-prop-initial-scroll-needed = 'true' cx-prop-default-maximize = "+ee+" canvas-form-view = "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({isFormView:!0}))+"></crm-richtext-component>"}else if(36===h.ui_type||143===h.ui_type||144===h.ui_type||145===h.ui_type){if(M="<crux-"+I+"-component cx-prop-error-message = '"+r+"' cx-prop-clear-error-message='false' cx-prop-placeholder='"+S+"' cx-prop-display-currency='true' cx-prop-from = 'create' cx-prop-show-calculator='true' "+k+F+D,h.length&&(M+=" cx-prop-maxlength= '"+w.length+"'"),"form_create"===d||"form_edit"===d||"form_clone"===d||"form_preview"===d){var re=b?"{{setCurrencyCode(record)}}":Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY]?Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY].key:"";M+=Z+D+"cx-prop-currency-code= '"+(re=p?t.Currency?t.Currency:Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY]?Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY].key:"":re)+"' cx-prop-disabled='"+h.read_only+"'"}else l&&(M+='onfocusout="Customization.layoutRuleFocusOutHandling()"');M+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' ></crux-"+I+"-component>"}else if(35===h.ui_type)M="<crux-phone-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+S+"' cx-prop-from = 'create'"+k+F+D,w.length&&(M+=" cx-prop-maxlength= '"+w.length+"'"),"form_create"===d||"form_edit"===d||"form_clone"===d?M+=Z+D:l&&(M+='onfocusout="Customization.layoutRuleFocusOutHandling()"'),M+="cx-prop-appearance='box'  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"'    cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' ></crux-phone-component>";else if(555===h.ui_type){h.read_only;var ae=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({position:"followcursor",margin:"10",hidedelay:"50"}));let e;e=Crm.userDetails.CLIENT_ACCOUNT?"zcanvas zcanvas-input-icon icon-Icon_Upload":"zcanvas zcanvas-input-icon icon-Icon_dropdownfill";let o="menu";Crm.userDetails.CLIENT_ACCOUNT&&(o="local"),w.maximum_allowed_size=h.maximum_allowed_size;let r=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w)),a=$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p)),i=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].getOptionsForFileUploadField())),n="{{method('onCruxFileUploadOptionClick','"+h.module[0].module_name+"')}}",c="{{method('cruxFileUploadShowUploadModal','"+h.module[0].module_name+"')}}",s="{{method('cruxFileUploadShowPreview')}}",l="{{method('onCruxFileUploadRemoveFileClick')}}",d="subvalue_"+h.column_name,u="label_"+h.column_name+(p?"_FromOverviewPopup":""),m='{{getFileUploadDataCruxFormView("'+w.api_name+'")}}';p&&(m=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].getFileDataInCruxFormat(t[h.api_name])))),M='<crux-file-upload-component cx-prop-right-icon-class="'+e+'" '+k+'" cx-prop-zcqa="'+a+'" id="'+d+'" cx-prop-id="'+u+'" cx-prop-from="create" cx-prop-field="'+r,M+='" cx-prop-inner-button-class="zcanvas_value_fileupload_btn_button zc_allow_resize zcnoprop"  cx-prop-button-class="zcanvas_value_fileupload_btn" cx-prop-value='+m+' cx-prop-options-type="'+o+'" cx-prop-options="'+i+'" ',M+='cx-prop-file-unique-selector="unique_file_selector" show-preview="'+s+'" on-remove-file="'+l+'" on-menu-click="'+n+'" show-upload-modal="'+c+'" cx-prop-file-limit="'+h.length+'" cx-prop-readonly="'+h.read_only+'"></crux-file-upload-component>'}else if(556!==h.ui_type||"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&"FormView"!==d&&"form_preview"!==d&&"WizardView"!==d)if("multiselectpicklist"===h.data_type){h.canvasDependencyMap&&0===h.canvasDependencyMap.length&&delete h.canvasDependencyMap;var ie="";"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(ie="on-show=\"{{method('onDropDownShow')}}\" on-hide=\"{{method('onDropDownHide')}}\" "),M="<crux-"+I+"-component cx-prop-error-message = '"+r+"' cx-prop-clear-error-message='false' cx-prop-type ='multiple' cx-prop-placeholder='"+S+"' cx-prop-picklist-values = ' "+(b?z:$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(z)))+" '  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A)))+"' "+k+F+Z+D+ie+" ></crux-"+I+"-component>"}else if("multiuserlookup"===h.data_type)A&&A.users&&(A=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A))),M='<crux-user-component id="'+h.id+"\" cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+S+"' cx-prop-max-limit='10' cx-prop-filterable='false' cx-prop-clear-error-message='false' cx-prop-searchable='true' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-selected-users='"+A+"' cx-prop-value='"+(b?x:A)+"'","form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&"FormView"!==d&&"form_preview"!==d&&"form_gallery"!==d&&"WizardView"!==d||(M+=k+F+Z+D+" cx-prop-hide-lookup-icon=true "),"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(M+=" on-before-show=\"{{method('onDropDownShow')}}\" on-user-lookup-modal-close=\"{{method('onDropDownHide')}}\" on-hide=\"{{method('onDropDownHide')}}\" "),!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users&&(M+=" cx-prop-is-subordinate= "+!0),M+="></crux-user-component>";else if("userlookup"===h.data_type){A&&(A.name||A.id)&&(A=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A)));const t=store.peekRecord("field",e);let o={};t&&t.lookup&&t.lookup.query_details&&(o.query_id=t.lookup.query_details.query_id);let a=!!(h.lookup&&h.lookup.query_details&&h.lookup.query_details.query_id),i=!!(Crm.userDetails.isDynamicLookupFilterEnabled&&a&&Lyte.registeredMixins["crm-lookup-filter-mixin"].isDynamicCriteriaInvolved(h.lookup.query_details.criteria));M="<crux-user-component cx-prop-error-message = '"+r+"' cx-prop-query-param='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(o))+"' cx-prop-placeholder='"+S+"' cx-prop-filterable='false' cx-prop-clear-error-message='false' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-show-close-icon='true'  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' "+F+k+"cx-prop-forced-fetch='"+i+"' on-before-show=\"{{method('setFilterQueryId')}}\"",R&&(M+=' cx-prop-dropdown-icon-class="zcanvas zcanvas-input-icon icon-Icon_dropdownfill" '),"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(M+=D+"  on-hide=\"{{method('onDropDownHide')}}\" on-clear=\"{{method('onValueChangeUserLookup', this, '"+d+"')}}\" on-value-change=\"{{method('onValueChangeUserLookup', this, '"+d+"')}}\"  cx-prop-disabled='"+h.read_only+"'"),!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users&&(M+=" cx-prop-is-subordinate= "+!0),M+="></crux-user-component>"}else if("datetime"===h.data_type||"date"===h.data_type){var ne="",ce="";("Invoices"===h.module[0].module_name&&"INVOICEDATE"===h.column_name||"PurchaseOrders"===h.module[0].module_name&&"PODATE"===h.column_name)&&"form_create"===d&&(A=Utils.getDateInUserDatePattern($L.moment().toDate()),t.$.set(h.api_name,A)),A&&(ce="datetime"===h.data_type?Utils.getDateTimeInUserFormat($L.moment(Lyte.Transform[h.data_type].serialize(A)).toDate(),!0):A),"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(ne=" on-before-calendar-open=\"{{method('onDropDownShow')}}\" on-before-calendar-close=\"{{method('onDropDownHide')}}\"",ne+=p?"on-date-change=\"{{Lyte.registeredMixins['crm-formview-mixin'].onCruxFocusOut(this)}}\"":"on-value-change=\"{{method('onValueChangeDate', this)}}\"","datetime"===h.data_type&&(ne+=" on-before-show=\"{{method('onDropDownShow')}}\" on-before-hide=\"{{method('onDropDownHide')}}\" ")),t&&t.$&&t.$.model&&t.$.model._name&&Lyte.registeredMixins["crm-create-mixin"].setCustomValidationsforfields(t.$.model._name,h,t,!1,Lyte.Router.getRouteInstance().parent.getQueryParams().layoutId),M="<crux-"+I+"-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+S+"' cx-prop-clear-error-message='false' cx-prop-default-time='"+this.getNearestDate()+"'cx-prop-date-in-user-pattern = 'true' cx-prop-datetime-in-user-pattern='true' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"'cx-prop-disabled='"+h.read_only+"' cx-prop-value='"+(b?x:ce)+"' "+k+D+F+ne+"></crux-"+I+"-component>"}else if("lookup"===h.data_type){var se=h.lookup.module.id,le=(_e=store.peekRecord("module",se)).module_name,de=I18n.getMsg("crm.label.lookup.norecord",$ESAPI.encoder().encodeForHTMLAttribute(_e.singular_label))+" ",pe="";"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(A=""===A&&p?void 0:A,pe="fetch-module-data=\"{{method('fetchModuleData','"+h.lookup.module.id+"')}}\" fetch-records=\"{{method('fetchRecords',record, this)}}\" on-value-change=\"{{method('onValueChangeLookup', this, '"+d+"')}}\" on-clear=\"{{method('onClearLookup',this)}}\" on-before-dropdown-open=\"{{method('onBeforeDropDownShow')}}\" cx-prop-module='"+h.lookup.module.api_name+'\' on-before-dropdown-open="{{method(\'onDropDownShow\')}}" on-hide-dropdown="{{method(\'onDropDownHide\')}}" cx-prop-clear-error-message="false" cx-prop-search-format="true" before-request-change-data = "{{method(\'changeRequestData\')}}"');var ue=h.read_only,me=I18n.getMsg("crm.canvas.create.form.page.reportingto.tooltip"),ve="";let e=Lyte.Component.registeredHelpers.showAddRecord(le);""!==A&&(ve=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A))),M="Reporting_To"===h.api_name?"form_create"===d||"form_edit"===d||"form_clone"===d?"<crux-"+I+"-component cx-prop-dont-show-related-dropdown='true' cx-prop-footer-yield = '"+e+"' cx-prop-placeholder='"+S+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='"+e+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-disabled='"+ue+"' cx-prop-open-on-focus='"+!!p+"' cx-prop-tooltip='"+me+"' cx-prop-clear-error-message='false' cx-prop-value='"+(b?x:ve)+"'cx-prop-zcqa = '"+h.column_name+"'"+k+F+pe+" >":"<crux-"+I+"-component cx-prop-dont-show-related-dropdown='true' cx-prop-footer-yield = '"+e+"' cx-prop-placeholder='"+S+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='"+e+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-disabled='"+ue+"' cx-prop-open-on-focus='"+!!p+"' cx-prop-clear-error-message='false' cx-prop-value='"+(b?x:ve)+"'cx-prop-zcqa = '"+h.column_name+"'"+k+F+pe+" >":"<crux-"+I+"-component cx-prop-footer-yield = '"+e+"' cx-prop-placeholder='"+S+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='"+e+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-disabled='"+ue+"' cx-prop-open-on-focus='"+!!p+"' cx-prop-clear-error-message='false' cx-prop-value='"+(b?x:ve)+"' cx-prop-zcqa = '"+h.column_name+"'"+k+F+pe+" >","Quotes"!==le&&"PriceBooks"!==le&&(M+="<template is='yield' yield-name= 'footer'><span id='lookupFldId_"+w.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", false, "+o+");\" class='lookupFldVal dropFooterList pL25 '>"+I18n.getMsg("crm.module.new",$ESAPI.encoder().encodeForHTMLAttribute(_e.singular_label))+" </span></template>",M+="<template is='yield' yield-name= 'createYield'><span id='lookupFldId_"+w.id+"' data-zcqa ='btn_Lookup_CreateNewRecord' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", true, "+o+");\" class='lookupFldVal outlineprimaryflat '> "+I18n.getMsg("crm.module.new",$ESAPI.encoder().encodeForHTMLAttribute(_e.singular_label))+" </span></template> "),M+="<template is='yield' yield-name= 'errorYield'>",M+="Quotes"!==le&&"Invoices"!==le&&"SalesOrders"!==le&&"PurchaseOrders"!==le&&"Services"!==le&&e?"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+de+' <span class="crmLinkColor cP mL5 autoRecordCreateAlert"onclick="Customization.quickCreatePop( '+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", false, "+o+')">'+I18n.getMsg("crm.label.create.new")+" "+$ESAPI.encoder().encodeForHTMLAttribute(_e.singular_label)+"</span></span></div>":"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+de+"</span></div>",M+="</template></crux-"+I+"-component>"}else if("multi_module_lookup"===h.data_type){var _e;le=(_e=store.peekAll("module").filter((function(e){return e.api_name===h.multi_module_lookup.api_name}))[0]).module_name,de=I18n.getMsg("crm.label.lookup.norecord",_e.singular_label)+" ",pe="";"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(A=""===A&&p?void 0:A,pe="fetch-module-data=\"{{method('fetchModuleData','"+_e.id+"')}}\" fetch-records=\"{{method('fetchRecords',record, this)}}\" on-value-change=\"{{method('onValueChangeLookup', this, '"+d+"')}}\" on-clear=\"{{method('onClearLookup',this)}}\" on-before-dropdown-open=\"{{method('onBeforeDropDownShow')}}\" cx-prop-module='"+_e.api_name+'\' on-before-dropdown-open="{{method(\'onDropDownShow\')}}" on-hide-dropdown="{{method(\'onDropDownHide\')}}" cx-prop-clear-error-message="false" cx-prop-search-format="true" before-request-change-data = "{{method(\'changeRequestData\')}}"  on-module-select="{{method(\'onModuleSelectIcon\',this)}}"     ');ue=h.read_only,me=I18n.getMsg("crm.canvas.create.form.page.reportingto.tooltip"),ve="";""!==A&&(ve=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A))),M="<crux-"+I+"-component cx-prop-type='multi_module_lookup' cx-prop-footer-yield = 'true' cx-prop-placeholder='"+S+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='true' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-disabled='"+ue+"' cx-prop-open-on-focus='"+!!p+"' cx-prop-clear-error-message='false' cx-prop-value='"+(b?x:ve)+"' cx-prop-zcqa = '"+h.column_name+"'"+k+F+pe+" >","Quotes"!==le&&"PriceBooks"!==le&&(M+="<template is='yield' yield-name= 'footer'><span id='lookupFldId_"+w.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", false, "+o+");\" class='lookupFldVal dropFooterList pL25 '>"+I18n.getMsg("crm.module.new",_e.singular_label)+" </span></template>",M+="<template is='yield' yield-name= 'createYield'><span id='lookupFldId_"+w.id+"' data-zcqa ='btn_Lookup_CreateNewRecord' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", true, "+o+");\" class='lookupFldVal outlineprimaryflat '> "+I18n.getMsg("crm.module.new",_e.singular_label)+" </span></template> "),M+="<template is='yield' yield-name= 'errorYield'>",M+="Quotes"!==le&&"Invoices"!==le&&"SalesOrders"!==le&&"PurchaseOrders"!==le&&"Services"!==le?"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+de+' <span class="crmLinkColor cP mL5 autoRecordCreateAlert"onclick="Customization.quickCreatePop( '+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+", false, "+o+')">'+I18n.getMsg("crm.label.create.new")+" "+_e.singular_label+"</span></span></div>":"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+de+"</span></div>",M+="</template></crux-"+I+"-component>"}else if("picklist"===h.data_type){"form_edit"===d&&N&&N.blueprint&&N.blueprint.process_info&&N.blueprint.process_info.field_id===h.id&&(J+=" cx-prop-disabled='true' "),h.canvasDependencyMap&&0===h.canvasDependencyMap.length&&delete h.canvasDependencyMap;var fe="";if(h.enable_colour_code&&(fe=" cx-prop-is-color-code-enabled="+h.enable_colour_code),!b){if("Stage"===h.api_name&&z.length&&"form_clone"!==d&&"form_edit"!==d&&(A=z[0].display_value),A||!h.default_value||"form_create"!==d&&"form_clone"!==d&&"FormView"!==d&&"form_preview"!==d)if(39===h.ui_type){var ye=store.peekRecord("user",Crm.userDetails.USER_ID);A=A||(ye&&ye.Currency?ye.Currency:Crm.userDetails.BASE_CURRENCY)}else if(A||26!==h.ui_type)if(A||"Forecast_Category__s"!==h.api_name)A||(A=h.pick_list_values&&h.pick_list_values[0]?h.pick_list_values[0].display_value:"-None-");else{var ge,he,xe;if(t&&t.Stage)ge=t.Stage;else{var be=store.peekAll("field").filter((function(e){if("Stage"===e.api_name)return e}))[0],Ce=this.stageValues(be,t,g);ge=Ce.length?Ce[0].display_value:h[g].pick_list_values[0]}(he=Lyte.registeredMixins["crm-canvas-view-rules"]&&Lyte.registeredMixins["crm-canvas-view-rules"].parentChildDependencies.Stage)&&(Object.keys(he).map(function(e){xe=Lyte.registeredMixins["crm-canvas-view-rules"].parentChildDependencies.Stage[e][ge]}.bind(this)),z=xe),A=z[0].display_value}else A=z[0].display_value;else A=h.default_value;t=t.id&&t.$?t.$.set(h.api_name,A):t}M="form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&"form_preview"!==d&&"FormView"!==d||39!==h.ui_type?"<crux-"+I+"-component "+fe+"  cx-prop-error-message = '"+r+"' cx-prop-clear-error-message='false' cx-prop-placeholder='"+S+"' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"'  cx-prop-picklist-values = ' "+(b?z:$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(z)))+" ' cx-prop-dropdown-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:$ESAPI.encoder().encodeForHTMLAttribute(A))+"' "+k+F+J+" ></crux-"+I+"-component>":"<crux-"+I+"-component "+fe+"  cx-prop-error-message = '"+r+"' cx-prop-clear-error-message='false' cx-prop-placeholder='"+S+"' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-dropdown-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"'  cx-prop-picklist-values = ' "+(b?z:$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(z)))+" '  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:$ESAPI.encoder().encodeForHTMLAttribute(A))+"' "+k+F+J+" ></crux-"+I+"-component>"}else if(444===h.ui_type&&R){var we="",Me=A&&A.length;if(Me){we+=A[0][h.multiselectlookup.connectedlookup_apiname].name;for(var Ae=1;Ae<Me;Ae++)we+=","+A[Ae][h.multiselectlookup.connectedlookup_apiname].name}var Le=h.module[0].module_name,Se=store.peekRecord("module",h.multiselectlookup.connected_module.id).module_name,Ie=h.hasMorethan100MxNRecords?"op5":"";h.read_only||"form_edit"!==d||Lyte.registeredMixins.approvalprocess.restrictFieldsConfiguredInAP(h,t,N.isWizard?N.moduleData:N.moduleObj);var ze=h.read_only?"icon-Icon_lock zcanvas_disabled_icon":this.getModuleIcon(h.multiselectlookup.connected_module.api_name),ke=h.read_only?"disabled":"",Re=(ae=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({position:"followcursor",margin:"10",hidedelay:"50"})),h.required?"mandatoryField":""),Fe=b?"onclick=\"{{action('showLookup',event,this,true,true)}}\"":"onClick=\"{{Lyte.registeredMixins['crm-formview-mixin'].showLookup(event,this,true,undefined,this)}}\"";if(M="form_preview"===d||"FormView"===d?`<div class='zcanvas_value_with_icon zc_formviewfield zcanvas_mutiselect_lookup FValue customfieldValue customParentField multiL ' data-required=${h.required} data-readonly=${h.read_only} >`:`<div class='zcanvas_value_with_icon zc_formviewfield zcanvas_mutiselect_lookup FValue customfieldValue customParentField multiL ' data-required=${h.required} data-readonly=${h.read_only} lt-prop-title="{{if(${h.read_only},'Read only field','')}}" lt-prop-tooltip-config=${ae}>`,M+='<div class="cxElementValue">\n\t\t\t\t\t\t\t\t\t<div class="createmxnlookupDIV cxBoxWithRightIcon '+Re+'" >\n\t\t\t\t\t\t\t\t\t\t<div class="cxBoxLeftContent">\n\t\t\t\t\t\t\t\t\t\t\t<div class="cxBoxInput dF fg1 horizontal lyteInputReadonly lyteInputBox ">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="lyteField fg1" '+Fe+">"+`<input data-cid="showLookup" type="text" class="${Ie} MultiLookupInp w100_per createFieldsInput boxBB socShowLookup_ fieldupdate_${h.column_name}" id="Crm_${Le}_${h.column_name}"`+`tabindex="${h.tab_index}" maxlength="${h.length}" data-sysrefname=${h.api_name} `+`data-mandate="${h.required}" data-content-type="Multiselect Lookup" data-uitype=${h.ui_type}  data-colname=${h.column_name} data-name=${h.column_name} data-zcqa=${$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))}`+`data-maxlength="${h.length}" data-customfield=${h.custom_field} data-lookup-module="${Se}"`+`data-displaylabel="${$ESAPI.encoder().encodeForHTMLAttribute(h.display_label)}" data-label="${$ESAPI.encoder().encodeForHTMLAttribute(h.field_label)}" //NO I18N\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-readonly=${h.read_only} data-linkingmodule = "${h.multiselectlookup.linking_module.api_name}" data-fieldid=${h.id} data-selectedid=`+(b?"{{setSeletedId(record,'"+h.id+"')}}":"''")+" value='"+(b?x:we)+`' readonly="${h.read_only}"`+ke+"/></div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>","form_preview"===d||"FormView"===d||"WizardView"===d)M+=`<div class="uiFieldIcon cxFlexCenter cxBoxRightIcon zcanvas_inputicon_container">\n\t\t\t\t\t\t\t\t\t\t\t<span alt="{{getI18n('loading')}}" tabindex="${h.tab_index}"  class=" zcanvas ${ze} zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon {{dynamicData.classone}} ${Ie}" data-module=${Le} label=${h.id} data-lookup-module="${Se}" data-zcqa="lookup_${h.column_name}" data-label="Crm_${Le}_${h.column_name}" id="Crm_${Le}_${h.column_name}_img"></span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`;else{var De=b?"onclick=\"{{action('showLookup',event,undefined,true,undefined, this)}}\"":"onClick=\"{{Lyte.registeredMixins['crm-formview-mixin'].showLookup(event,undefined,true,undefined, this)}}\"";M+=`<div class="uiFieldIcon cxFlexCenter cxBoxRightIcon zcanvas_inputicon_container"> \n\t\t\t\t\t\t\t\t\t\t\t<span alt="{{getI18n('loading')}}" tabindex="${h.tab_index}" `+De+` class=" zcanvas ${ze} zcanvas-input-icon zcanvas_icon_nochange zcanvas-right-icon {{dynamicData.classone}} ${Ie}" data-module=${Le} data-fieldid=${h.id} label=${h.id} data-lookup-module="${Se}" data-zcqa="lookup_${h.column_name}" data-label="Crm_${Le}_${h.column_name}" id="Crm_${Le}_${h.column_name}_img"></span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`}if(M+='<div id="zc_copylimitexceed"></div>',"form_clone"===d)if(Lyte.Router.getRouteInstance().currentModel.msFldsHasMorethan100MxNRecords.includes(h.id))M+='<div id="zc_copylimitexceed"><crm-canvasform-overlay-popup type="copylimiterror" mxn-con-module-plural-label=\''+store.peekRecord("module",h.multiselectlookup.connected_module.id).plural_label+"'></crm-canvasform-overlay-popup></div>"}else{var Ee=!1;if(8===h.ui_type)if(Crm.userDetails.CLIENT_PORTAL_NAME,!h.read_only&&Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+h.module[0].module_name]||(Ee=!0),"form_create"===d){var $e=store.peekRecord("user",Crm.userDetails.USER_ID);$("crm-canvas-form")[0].component.executeUserFieldsofLookupForFormView($e,void 0,void 0,h)}else"form_edit"!==d&&"form_clone"!==d||(userDetails={},userDetails.id=t&&t.Owner?t.Owner.id:Crm.userDetails.USER_ID,userDetails.name=t&&t.Owner?t.Owner.name:Crm.userDetails.DISPLAY_NAME,A=userDetails);if(208===h.ui_type&&"form_edit"===d&&(A.id=Lyte.Router.getRouteInstance().transition.data.layoutId?Lyte.Router.getRouteInstance().transition.data.layoutId:A.id,A.name=Lyte.Router.getRouteInstance().transition.data.layoutName?Lyte.Router.getRouteInstance().transition.data.layoutName:A.name,t.$.set("Layout",{id:A.id,name:A.name})),"object"==typeof A&&(A=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(A))),M="<crux-"+I+"-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+S+"' cx-prop-clear-error-message='false' cx-prop-from = 'create'"+k+D,"team_based"!==h.module[0].access_type&&(M+=F),"Email_Opt_Out"===h.api_name&&"EMAILOPTOUT"===h.column_name&&"boolean"===h.data_type&&301===h.ui_type&&(M+="class='"+h.api_name+"' id='zc-edit-el-confirm'"),"form_create"===d||"form_edit"===d||"form_clone"===d){P=!1;8===h.ui_type&&(P=Ee),"Owner"===h.api_name&&Crm.userDetails.LITE&&Crm.userDetails.LITE.IS_LITE_USER&&"form_create"===u.getData("form_type")&&(P=Ee),8!==h.ui_type&&(M+=Z),"Company"===h.api_name&&(M+='cx-prop-autocomplete-options={{autocompleteOptions(undefined,"'+h.id+'")}} fetch-data="{{method(\'fetchData\')}}"'),M+=D+" cx-prop-disabled='"+(h.read_only||P)+"' "}else l&&(M+='onfocusout="Customization.layoutRuleFocusOutHandling()"');if(w.length&&(M+=" cx-prop-maxlength= '"+w.length+"'"),"text-area"===I&&(M+=" class = 'cxBigTextarea' cx-prop-prevent-collapse = 'true' "),("Country"===h.api_name&&"COUNTRY"===h.column_name||"Billing_Country"===h.api_name&&"BILLINGCOUNTRY"===h.column_name||"Company"===h.api_name&&B)&&(M+="cx-prop-autocomplete-options='"+y+"'"),"boolean"===h.data_type&&301===h.ui_type)A=""!==A&&void 0!==A?A:!0===h.default_value,b||(t=t.id&&t.$?t.$.set(h.api_name,A):t),"Email_Opt_Out"===h.api_name&&"EMAILOPTOUT"===h.column_name&&(M+="class='"+h.api_name+"' id='zc-edit-el-confirm'"),M+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' on-value-change='{{method( \"onCruxValueChange\", this)}}'  ></crux-"+I+"-component>";else if("form_create"!==d&&"form_edit"!==d&&"form_clone"!==d&&"form_preview"!==d||40!==h.ui_type)if(99===h.ui_type)M='<crm-comment-information cx-Prop-Empty-Value="-" is-canvas-formview='+R+' class="zc_cursor_nodrop canvasCruxComponent" cx-prop-disabled="true" cx-Prop-Empty-Value="-" cx-prop-field =\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' ",M+="record='"+(b?"{{record}}":$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(t)))+"'></crm-comment-information>";else{if(8===h.ui_type){M+=Ee?" cx-prop-disabled = 'true'":" cx-prop-filterable = 'false'",Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users&&(M+=" cx-prop-is-subordinate='true' ");var Pe=h.module[0]&&h.module[0].profiles,Oe=Pe&&Pe.length,Te=[],Ne="(profile:in:",He=[],Ue=[];for(Ae=0;Ae<Oe;Ae++)He.push(Pe[Ae].id),Ue.push(Pe[Ae].name);var je={comparator:"in",field:"profile.id"};je.value=He,Te.push(je),Ne=Ne+He.join()+")","team_based"===h.module[0].access_type&&(M+="on-custom-request=\"{{method('TeamDropdownUsers')}}\"",M+="cx-prop-custom-request = ' true '"),M+="cx-prop-user-criteria='"+JSON.stringify(Te)+"' cx-prop-user-search-criteria='"+Ne+"'",M+=" on-before-show=\"{{method('onDropDownShow' ,this)}}\" on-user-lookup-modal-close=\"{{method('onDropDownHide')}}\" on-hide=\"{{method('onDropDownHide')}}\" on-value-change=\"{{method('onUserChange', this)}}\""}else if(55===h.ui_type)M+=" cx-prop-filterable = 'false'";else if(208===h.ui_type){var Ve=window.isCanvasSandboxDiff?$("crm-canvas-dynamic-preview")[1]:$("crm-canvas-dynamic-preview")[0],qe=Lyte.Router.getRouteInstance();g="form_preview"===d?Ve.getData("layoutId"):Lyte.Router.getRouteInstance().getQueryParams().layoutId;!(g="form_edit"===d&&Lyte.Router.getRouteInstance().transition.data.layoutId?Lyte.Router.getRouteInstance().transition.data.layoutId:g)&&qe&&qe.transition&&qe.transition.info&&"crm.settings.canvas.import"===qe.transition.info.route&&(g=qe.transition.info.queryParams.layoutId),M+="cx-prop-module = '"+h.module[0].module_name+"' cx-prop-display-value='"+store.peekRecord("layout",g).display_label+"' cx-prop-type='single' cx-prop-tooltip = '"+I18n.getMsg("crm.field.layout.edit.change.restriction")+"'"}else if(33===h.ui_type&&Crm.userDetails.isPhoneNoNewView)M+="cx-prop-enable-country-code = 'true'";else if("Probability"===h.api_name&&"Potentials"===h.module[0].module_name){var Je=store.peekAll("field").filter((function(e){return"Stage"===e.api_name}))[0],Ze=this.stageValues(Je,t,g);if(Ze&&Ze.length){var Be=Je.pick_list_values.filter((function(e){return e.display_value===Ze[0].display_value}))[0];A=A||(Be?Be.probability:void 0)}else Je&&Je.pick_list_values&&(A=A||Je.pick_list_values[0].probability);t=t.id&&t.$?t.$.set(h.api_name,A):t}M+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:A)+"' ></crux-"+I+"-component>"}else M+="cx-prop-disabled = 'true' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(h,void 0,void 0,p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(w))+"' cx-prop-value='"+(b?x:parseFloat(t.Exchange_Rate))+"' ></crux-"+I+"-component>"}else{var We,Ye=[],Ge=null,Qe=null;let e=Lyte.registeredMixins["crm-uploadfields-mixin"].formatBytes(h.maximum_allowed_size);if("FormView"!==d&&!p||null===t)"WizardView"!==d&&"form_preview"!==d&&(We=this&&this.data&&this.getData("module_name")||module.value,Qe=JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].setAttachmentsUrl(We,h.id)),null!==t&&t[h.api_name]&&(Ge=Lyte.registeredMixins["crm-uploadfields-mixin"].setTooltipValue(t[h.api_name])),Ge='{{setImageUploadToolTip(record,"'+h.id+'")}}',Ye='{{getImageDataForCanvasFormView("'+h.api_name+'","'+h.id+'","'+h.column_name+'","'+We+'",true)}}');else{var Ke=t[h.api_name];void 0!==Ke&&(We=this&&this.data&&this.getData("module_name")||module.value,p&&(Qe=JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].setAttachmentsUrl(We,h.id))),Ye=Lyte.registeredMixins["crm-uploadfields-mixin"].constructImageDataFromServer(Ke,We,t.id,h.id),Ye=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(Ye)))}M="<crux-image-component "+k+' cx-prop-child-wrapper-class="zcanvas_valuebutton_wrapper" cx-prop-tab-index=\''+h.tab_index+'\'  cx-prop-button-class="zcanvas_value_btn zcanvas zcnoprop" cx-prop-from = "create" cx-prop-modal-wrapper-class="crmImgUploadModal" cx-prop-ajax = \''+Qe+"'  cx-prop-progress-status-colours = '"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({count:"var(--linkColor)",size:"var(--linkColor)",list:"var(--linkColor)"}))+"' cx-prop-modal-properties= '"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify({maxHeight:"85%",wrapperClass:"crmImgUploadModal"}))+"' cx-prop-validation-tooltip='"+Ge+"' cx-prop-field ='"+JSON.stringify(h.$.toJSON())+"' cx-prop-type=\"multiple\" cx-prop-allowed-count = '"+h.length+"' cx-prop-id = 'label_"+h.column_name+"' id ='Image_"+h.id+"' api-name ='"+h.api_name+"' cx-prop-zcqa='Image_"+h.api_name+"'  data-zcqa='value_"+h.api_name+"'  cx-prop-value = '"+Ye+"'  cx-prop-allowed-total-size = \""+e+'" ',"form_create"!==d&&"form_edit"!==d&&"form_clone"!==d||(M+=" cx-prop-readonly= '"+h.read_only+"' on-element-rendered=\"{{method('onImageCompRendered',this)}}\" "),M+="on-validation-image-click=\"{{method('openZiaVisionPopup',this)}}\"  on-add-in-modal = \"{{method('onImageAddORRemove')}}\"  on-remove-in-modal = \"{{method('onImageAddORRemove')}}\"   on-remove=\"{{method('onImageChange',this)}}\"  on-edit=\"{{method('onImageChange',this)}}\"  on-attach=\"{{method('onImageChange',this)}}\" on-crop-success=\"{{method('onCropSuccess',this)}}\" on-file-success=\"{{method('setImageData')}}\" ></crux-image-component>"}return M},constructCruxDummyComponentForCanvas:function(e,t){var o,r=store.peekRecord("field",e),a="record."+r.api_name,i=-1!==["text","datetime","date","userlookup"].indexOf(r.data_type),n=-1===[33,209,37].indexOf(r.ui_type),c=crmConstants&&crmConstants.moduleDisplayField&&crmConstants.moduleDisplayField[t]&&crmConstants.moduleDisplayField[t]instanceof Array?crmConstants.moduleDisplayField[t]:[];(t.indexOf("CustomModule")>-1||t.indexOf("LinkingModule")>-1)&&(c=["Name"]);var s=!c.includes(r.api_name);return i&&n&&s&&(o='<lyte-text class="canvasSpanWrapper" lt-prop-value="{{DummyComponentValueSetter('+a+" , '"+r.data_type+"' , '"+r.ui_type+"')}}\" ></lyte-text>"),o},constructCompForAjaxEdit:function(e,t,o,r,a,i,n,c,s,l){var d,p=(k=$L("crm-detailview-canvas")[0]).component.data.layoutId,u=store.peekRecord("field",e);if("COUNTRY"===u.column_name||"BILLINGCOUNTRY"===u.column_name){var m=k.component;d=JSON.stringify(m.getTextAutocompleteOptions({column_name:"COUNTRY"})),d=$ESAPI.encoder().encodeForHTMLAttribute(d)}var v=u.$.toJSON();(o&&(v.required=!0),s)&&(n=((k.getData("cscriptconfigs")||{}).field||{})[u.id]);n&&n.maxlen&&(v.length=n.maxlen);var _="",f=void 0!==a&&a?i:Lyte.registeredMixins["crm-detailcanvas-utils"].preProcessFieldValue(t,u,c);["text","textarea"].includes(u.data_type)&&(f=$ESAPI.encoder().encodeForHTMLAttribute(f));var y=u.tooltip,g="";y&&"Static Text"===y.name&&(g=$ESAPI.encoder().encodeForHTMLAttribute(y.value)),r||(r=""),r=$ESAPI.encoder().encodeForHTMLAttribute(r),r=$ESAPI.encoder().encodeForHTMLAttribute(r);var h=crmConstants.defaultUiTypeToCruxMapping[u.ui_type];h||(h=u.data_type),_="";var x,b=!1;if("picklist"!==u.data_type&&"multiselectpicklist"!==u.data_type||(x=u.cscript_picklist_values?u.cscript_picklist_values:"Stage"===u.api_name?this.stageValues(u,t,p):u.canvasDependencyMap&&u.canvasDependencyMap.length>0?u.canvasDependencyMap:u[p]?u[p].pick_list_values:pick_list_values),"SERVICEDURATION"===u.column_name&&(h="picklist",x=k.component.executeMethod("setDurationOptions",t)),(u.read_only||u.field_read_only)&&(b=!0),96===u.ui_type)_="<crux-picklist-component cx-prop-error-message = '"+r+"' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-placeholder='"+g+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-readonly='"+b+"' ></crux-picklist-component>";else if(36===u.ui_type||143===u.ui_type||144===u.ui_type||145===u.ui_type)_="<crux-"+h+"-component   cx-prop-error-message = '"+r+"' cx-prop-clear-error-message='false' cx-prop-placeholder='"+g+"' cx-prop-display-currency='false' cx-prop-from = 'create' cx-prop-show-calculator='true' ",u.length&&(_+=" cx-prop-maxlength= '"+v.length+"'"),l&&(_+='onfocusout="Customization.layoutRuleFocusOutHandling()"'),_+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+f+"' cx-prop-readonly='"+b+"' ></crux-"+h+"-component>";else if(35===u.ui_type)_="<crux-phone-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+g+"' cx-prop-from = 'create'",v.length&&(_+=" cx-prop-maxlength= '"+v.length+"'"),l&&(_+='onfocusout="Customization.layoutRuleFocusOutHandling()"'),_+="cx-prop-appearance='box'  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"'    cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+f+"' cx-prop-readonly='"+b+"' ></crux-phone-component>";else if(555===u.ui_type)_="<crm-file-upload cx-Prop-View='false' class='canvasCruxComponent' lyte-unbound = 'false' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-fieldvalue='"+f+"'></crm-file-upload>";else if(250===u.ui_type){var C=!1,w=$L(".rtfViewModalValWrap").closest("lyte-yield")[0];w&&w._callee&&w._callee.ltProp("show")&&(C=!0),_="<crm-richtext-component id='zc-edit-el-confirm' is-rich-text-needed= 'true' comp-func-used= 'true'cx-prop-maxlength= '"+v.length+"' cx-prop-from = 'create' class='canvasCruxComponent' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+f+"' cx-prop-readonly='"+b+"'cx-prop-initial-scroll-needed = 'true' cx-prop-default-maximize = "+C+"></crm-richtext-component>"}else if("multiselectpicklist"===u.data_type)u.canvasDependencyMap&&0===u.canvasDependencyMap.length&&delete u.canvasDependencyMap,_="<crux-"+h+"-component cx-prop-error-message = '"+r+"' cx-prop-type ='multiple' cx-prop-placeholder='"+g+"' cx-prop-picklist-values = ' "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(x))+" '  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-readonly='"+b+"' ></crux-"+h+"-component>";else if("multiuserlookup"===u.data_type){_="<crux-user-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+g+"' cx-prop-max-limit='10' cx-prop-filterable='false' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-readonly='"+b+"' cx-prop-value='' ",!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users&&(_+=" cx-prop-is-subordinate= "+!0);const t=store.peekRecord("field",e);if(M=t&&t.userSearchCriteria)_+="user-criteria='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(M.userCriteria))+"' cx-prop-user-search-criteria='"+M.criteria+"'";_+="></crux-user-component>"}else if("userlookup"===u.data_type){f&&(f.name||f.id)&&(f=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f)));const t=store.peekRecord("field",e);let o=Crm.userDetails.isDynamicLookupFilterEnabled&&t&&t.lookup&&t.lookup.query_details&&t.lookup.query_details.query_id&&Lyte.registeredMixins["crm-lookup-filter-mixin"].isDynamicCriteriaInvolved(t.lookup.query_details.criteria),a={};var M;if(void 0!==u.module&&"team_based"===u.module[0].access_type&&(a.include_lite_users=!0),t&&t.lookup&&t.lookup.query_details&&(a.query_id=t.lookup.query_details.query_id),_="<crux-user-component cx-prop-error-message = '"+r+"' cx-prop-query-param='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(a))+"' cx-prop-placeholder='"+g+"' cx-prop-filterable='false' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-show-close-icon='true'  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-readonly='"+b+"' cx-prop-value='"+f+"' cx-prop-forced-fetch='"+o+"' ",!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users&&(_+=" cx-prop-is-subordinate= "+!0),M=t&&t.userSearchCriteria)_+="user-criteria='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(M.userCriteria))+"' cx-prop-user-search-criteria='"+M.criteria+"'";_+="></crux-user-component>"}else if("datetime"===u.data_type||"date"===u.data_type)_="<crux-"+h+"-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+g+"' cx-prop-clear-error-message='false' cx-prop-default-time='"+this.getNearestDate()+"'cx-prop-date-in-user-pattern = 'true' cx-prop-datetime-in-user-pattern='true' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+f+"' cx-prop-readonly='"+b+"' ></crux-"+h+"-component>";else if("lookup"===u.data_type){var A=u.lookup.module.id,L=store.peekRecord("module",A),S=L.module_name,I=I18n.getMsg("crm.label.lookup.norecord",L.singular_label)+" ";let e=Lyte.Component.registeredHelpers.showAddRecord(S);_="<crux-"+h+"-component cx-prop-footer-yield = 'true' cx-prop-placeholder='"+g+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='true' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-readonly='"+b+"' >","Quotes"!==S&&"PriceBooks"!==S&&e&&(_+="<template is='yield' yield-name= 'footer'><span id='lookupFldId_"+v.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+", false, "+o+");\" class='lookupFldVal crmLinkColor cP pL10 dIB'> +"+I18n.getMsg("crm.module.new",L.singular_label)+" </span></template>",_+="<template is='yield' yield-name= 'createYield'><span id='lookupFldId_"+v.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+", true, "+o+");\" class='lookupFldVal outlineprimaryflat crmLinkColor cP pL10 dIB'> "+I18n.getMsg("crm.module.new",L.singular_label)+" </span></template> "),_+="<template is='yield' yield-name= 'errorYield'>",_+="Quotes"!==S&&"Invoices"!==S&&"SalesOrders"!==S&&"PurchaseOrders"!==S&&"Services"!==S&&e?"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+I+'<u><span class="crmLinkColor cP" onclick="Customization.quickCreatePop( '+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+", false, "+o+')">'+I18n.getMsg("crm.label.create.new")+" "+L.singular_label+"</span></u></span></div>":"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+I+"</span></div>",_+="</template></crux-"+h+"-component>"}else if("SERVICEDURATION"===u.column_name||"picklist"===u.data_type){u.canvasDependencyMap&&0===u.canvasDependencyMap.length&&delete u.canvasDependencyMap;var z="";if(u.enable_colour_code&&(z=" cx-prop-is-color-code-enabled="+u.enable_colour_code),!f&&u.default_value&&(f=u.default_value),_="<crux-"+h+"-component "+z+" cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+g+"' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"'  cx-prop-picklist-values = ' "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(x))+" '  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+$ESAPI.encoder().encodeForHTMLAttribute(f)+"' cx-prop-readonly='"+b+"'","SERVICEDURATION"===u.column_name)_+="cx-prop-footer-yield = 'true' cx-prop-id=\"serviceDuration\" >"+('<template is="yield" yield-name="footer"><span class="customDuration crmLinkColor cP pL25 pR25 pT6 pB6 dF" onclick=Lyte.registeredMixins[\'crm-detailcanvas-utils\'].setCustomDuration()>'+I18n.getMsg("Custom")+"</span></template");_+="> </crux-"+h+"-component>"}else if(21===u.ui_type&&"Voice_Recording__s"===u.api_name){var k;_="<crux-voicenote-component  cx-Prop-Empty-Value=\"-\" cx-prop-from = 'create' cx-prop-width='390px' cx-prop-appearance='box'  data-zcqa='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field= '"+JSON.stringify(u.$?u.$.toJSON():u)+"' cx-prop-value='"+f+"'",u[p=(k=(k=$L("crm-detailview-canvas")[0]?$L("crm-detailview-canvas")[0]:$L("crm-detailview-oldeditor")[0])||$L("crm-detailview-canvas-gallery")[0])?k.component.data.layoutId:""]&&null!==u[p]&&(_+=" cx-prop-layout="+p),_+="></crux-voicenote-component>"}else _="<crux-"+h+"-component cx-prop-error-message = '"+r+"' cx-prop-placeholder='"+g+"' cx-prop-readonly='"+b+"' cx-prop-clear-error-message='false' cx-prop-from = 'create'","Email_Opt_Out"===u.api_name&&"EMAILOPTOUT"===u.column_name&&"boolean"===u.data_type&&301===u.ui_type&&(_+="class='"+u.api_name+"' id='zc-edit-el-confirm'"),l&&(_+='onfocusout="Customization.layoutRuleFocusOutHandling()"'),v.length&&(_+=" cx-prop-maxlength= '"+v.length+"'"),33===u.ui_type&&Crm.userDetails.isPhoneNoNewView&&(_+="cx-prop-enable-country-code = 'true'"),"text-area"===h&&(_+=" class = 'cxBigTextarea' cx-prop-prevent-collapse = 'true' "),("Country"===u.api_name&&"COUNTRY"===u.column_name||"Billing_Country"===u.api_name&&"BILLINGCOUNTRY"===u.column_name)&&(_+="cx-prop-autocomplete-options='"+d+"'"),"Email_Opt_Out"===u.api_name&&"EMAILOPTOUT"===u.column_name&&"boolean"===u.data_type&&301===u.ui_type?_+="class='"+u.api_name+"' id='zc-edit-el-confirm' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+t.Email_Opt_Out+"' ></crux-"+h+"-component>":_+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(u))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(v))+"' cx-prop-value='"+f+"' ></crux-"+h+"-component>";return _},stageValues:function(e,t,o){var r=Lyte.registeredMixins["crm-detailcanvas-utils"];if(r.isWizardView()||r.isCanvasWizardPreview()||r.isCanvasWizardBuilder())return this.stageValuesForWizards(e,t,o);var a=[],i=store.peekAll("stage"),n=store.peekRecord("layout",o).fields.filter((function(e){if("Pipeline"===e.api_name)return!0}));if(t&&t.Pipeline||n.length){for(var c=!0,s=n[0]&&n[0][o].pick_list_values,l=s&&s.length,d=0;d<l;d++)if(t.Pipeline===s[d].display_value||!t.Pipeline&&n[0].default_value===s[d].display_value){for(var p=s[d].maps[0].pick_list_values.length,u=0;u<p;u++)i.forEach((function(e){e.name===s[d].maps[0].pick_list_values[u].actual_value&&a.push(s[d].maps[0].pick_list_values[u])}));c=!1}if(c){var m=e.pick_list_values.filter((function(e){return e.display_value===t.Stage})),v={};v.display_value=m[0]&&m[0].display_value,v.actual_value=m[0]&&m[0].actual_value,m[0]&&m[0].colour_code&&(v.colour_code=m[0].colour_code),a.push(v)}}else a=e[o]&&e[o].pick_list_values;return a},stageValuesForWizards:function(e,t,o){var r=[],a=store.peekAll("field").filter((function(e){if("Pipeline"===e.api_name)return!0}));return r=e[o]&&e[o].pick_list_values,a&&a.length&&a.forEach((function(e){e[o]&&e[o].pick_list_values&&e[o].pick_list_values.length&&e[o].pick_list_values.forEach((function(o){t.Pipeline&&t.Pipeline===o.display_value?r=o.maps[0].pick_list_values:t.Pipeline||e.default_value!==o.display_value||(r=o.maps[0].pick_list_values)}))})),r},getNearestDate:function(){var e=new Date;e.setMinutes(0);var t=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(t=!0);var o="";if(t)o=Utils.formatTimeVal(e.getHours())+":"+Utils.formatTimeVal(e.getMinutes());else{var r=Utils.convertTo12HoursFormatTimeObj(e);o=r.hrs+":"+r.mins+" "+I18n.getMsg(r.meridiem.toUpperCase())}return o},isRelListLookupFld:function(e,t){return!!(Customization.displayFieldMap[e]&&Customization.displayFieldMap[e].indexOf(t)>=0)||(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1)&&"Name"===t},getImageUploadComponentData:function(e,t,o,r,a,i,n){var c;void 0===r&&(r=[]),"canvas"===Lyte.Router.getRouteInstance().routeName&&(componentRenderingType="class",componentRenderingElement="zc-page-component-outer");var s=[],l=null;if(s=i?'{{getConnectedModuleDataForUploadFields(record,"'+t.module[0].module_name+'","'+i+'","'+t.api_name+'","imageupload","'+t.id+'","'+t.id+'")}}':'{{getImageDataForCanvasFormView("'+t.api_name+'","'+t.id+'","'+t.column_name+'","'+o+'")}}',null!==e&&(l=Lyte.registeredMixins["crm-uploadfields-mixin"].setTooltipValue(s),s=JSON.stringify(s)),e&&Array.isArray(e[t.api_name])){var d=e[t.api_name];s=Lyte.registeredMixins["crm-uploadfields-mixin"].constructImageDataFromServer(d,o,a,t.id),null!==e&&(s=JSON.stringify(s))}let p=Lyte.registeredMixins["crm-uploadfields-mixin"].formatBytes(t.maximum_allowed_size);if(n)Lyte.registeredMixins["crm-canvas-builder-process"].imageUploadFieldIdsInBuilder.pushUniqValues(t.id);else{var u=Lyte.Router.getRouteInstance().__ltp.dynamicParam;Customization.imageuploadFieldsId[u]||(Customization.imageuploadFieldsId[u]=[]);var m=moduleRecordMapping[o].id;Customization.imageuploadFieldsId[m]&&Customization.imageuploadFieldsId[m].contains(t.id)||Customization.imageuploadFieldsId[u].pushUniqValues(t.id)}return c="<crux-image-component class='canvasCruxComponent  uitype_556 imageUploadDetailPage fieldupdate_"+t.column_name+" '   zcflag  cx-prop-progress-status-colours = "+{count:"var(--linkColor)",size:"var(--linkColor)",list:"var(--linkColor)"}+" cx-prop-modal-properties= "+{maxHeight:"85%",wrapperClass:"crmImgUploadModal"}+' cx-prop-from = "view" cx-prop-error-class="cxErrorMsgMultiLines" record-id = \''+a+"' cx-prop-allowed-count = '"+t.length+"' cx-prop-validation-tooltip='"+l+"' cx-prop-field ='"+JSON.stringify(t.$.toJSON())+"' cx-prop-type=\"multiple\" cx-prop-id = 'vlabel_"+t.column_name+"'api-name ='"+t.api_name+"'  cx-prop-zcqa='"+t.api_name+"'data-zcqa='value_"+t.api_name+"' id ='Image_"+t.id+"'  cx-prop-readonly= '"+t.read_only+"'  cx-prop-value = '"+s+"'  cx-prop-allowed-total-size = \""+p+'" ',c=e?c.replace("zcflag","lyte-rendered zcflag"):c.replace("zcflag",""),this.isAjaxEditableField(t.id)&&(c+=" onmouseover=\"{{action('handleMouseActions',this,event)}}\" onmouseout=\"{{action('handleMouseActions',this,event)}}\""),c+="cx-prop-ajax = '"+JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].setAttachmentsUrl(o,t.id))+"' on-preview-close=\"{{method('onPreviewClose',this)}}\" on-validation-image-click=\"{{method('openZiaVisionPopup',this)}} \" on-element-rendered=\"{{method('onImageCompRendered',this)}}\" on-remove=\"{{method('onImageChange',this)}}\" on-crop-success=\"{{method('onCropSuccess',this)}}\"  on-edit=\"{{method('onImageChange',this)}}\"  ></crux-image-component>"},getModuleIcon:function(e){var t={accounts:"icon-Icon_Accounts",appoinments:"icon-Icon_Appoinment",campaigns:"icon-Icon_Campaigns",cases:"icon-Icon_Cases",contacts:"icon-Icon_Contacts",deals:"icon-Icon_Deals",invoices:"icon-Icon_Invoice",leads:"icon-Icon_Leads",price_books:"icon-Icon_Pricebook",products:"icon-Icon_Products",purchase_orders:"icon-Icon_PurchaseOrder",quotes:"icon-Icon_Quotes",sales_orders:"icon-Icon_Sales_Orders",solutions:"icon-Icon_solution",vendors:"icon-Icon_Vendors",custom:"icon-Icon_Apps"};return t[e=e.toLowerCase()]?t[e]:t.custom},isAjaxEditableField:function(e,t,o){if(!t)return!1;var r;if(!(r="string"==typeof e?store.peekRecord("field",e):e))return!1;var a=r.api_name;if(o&&o.indexOf(r.data_type)>-1)return!1;if("Currency"===a||"Probability"===a||"Pricing_Model"===a||"Wizard"===a||"territory_updated_time"===a||"Connected_To__s"===a)return!1;var i=r.module&&r.module[0].module_name;return!("Tasks"===i&&["Remind_At","Recurring_Activity","Who_Id","What_Id"].indexOf(a)>=0||"Calls"===i&&["Call_Start_Time","Reminder","Call_Duration","Who_Id","What_Id"].indexOf(a)>=0||"Events"===i&&["Remind_At","Who_Id","What_Id"].indexOf(a)>=0||"Services"===i&&["Status"].indexOf(a)>=0||"Appointments"===i&&["Remind_At","Status","Appointment_For","Owner","Location","Appointment_Name","Rescheduled_From"].indexOf(a)>=0)&&("Calls"===i&&"Owner"===a||"Appointments"===i&&("Duration"===a||"Reschedule_Count"===a)||(-1!==Lyte.registeredMixins["crm-detailcanvas-utils"].visitFldColumn.indexOf(r.column_name)||("Territories"===a||"Territory"===a||r.view_type.edit)))},constructCruxByType:function(e,t,o,r){var a=o;switch(e){case"profileimage":a='<crm-canvas-profile-image is-decrypted=true lyte-if="{{ '+(r?r.record:"true")+'}}" module-on-demand="true" record-id = "'+(r?"{{"+r.record+".id}}":"null")+'" record-obj = "'+(r?"{{"+r.record+"}}":"{}")+'" field-id = "'+(r?"{{"+r.field+".id}}":"")+'" edit-available="false" is-rellist-profileimage="true" is-lazy-load-need="false" is-from="external"> </crm-canvas-profile-image>';break;case"user":a="<crm-owner-field cx-prop-field="+t+" cx-prop-value= "+o+"></crm-owner-field>";break;default:a="<crux-"+e+'-component cx-prop-from="view" cx-Prop-Empty-Value="-"  class="canvasCruxComponent" cx-prop-field='+t+" cx-prop-value = "+o+" ></crux-"+e+"-component/>"}return a}}),Lyte.Mixin.register("crm-canvas-core-gallery",{gallerypreviewRL:[],processgallery:function(e,t,o){var r=Lyte.registeredMixins["crm-detailview-canvas-utils"],a=!!r&&r.getmetadata().fromDVGallery;a=o&&o.isFormView?!o.isFormView:a;var i=$L("crm-detailview-canvas-gallery")[0],n=$L("crm-detailview-oldeditor")[0],c=$L("crm-form-view-canvas-gallery")[0],s=!(!i||!i.component)&&i.component.getData("isPreviewClicked"),l=!1;n&&n.component.getData("showObjPreview")&&(s=!0,l=!0);var d=objectUtils.cloneObject_new($("#zcanvas_menu").data("zcdatamap"));d=a?i.component.getData("menuOptionsData"):!d&&c&&c.component.getData("showGallery")?objectUtils.cloneObject_new(c.component.getData("galleryCache")):d,i&&s&&!a||i&&t?i.component.setData("menuOptionsData",d):n&&n.component.setData("menuDetails",d),o&&o.isListView&&(d=o.currentfields),o&&o.isFormView&&(o.currentfields=d||o.currentfields,d=d||o.currentfields,$L("crm-form-view-canvas-gallery")[0].component.setData("menuOptionsData",d)),"FormView"===e.feature&&(o=o||{isFormView:!0}),o&&o.isPreview&&(s=o.isPreview);var p={},u={},m={},v=["upcoming_activity"],_=[],f=[];for(key in d){var y=d[key],g=y.api_name?"api_name":"apiname";p[y[g]]||(p[y[g]]=[]),u[y.datatype]||(u[y.datatype]=[]),"relatedlist"!==y.group&&"kiosk"!==y.group||y.hidden||("crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.target&&!a&&!l||t?y.data&&$u.isEmpty(y.data)?_.push(y):f.push(y):(delete y.mappedCount,y.sub_type?(y.zcscope=1,_.push(y)):"relatedlist"===y.datatype?(y.zcscope=2,delete y.template,delete y._data,y.connectedModName||f.push(y)):(y.zcscope=1,_.push(y)))),"crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.target&&!a&&!s||t||y.mappedCount&&y.zcscope&&(y.zcscope=y.zcscope+y.mappedCount,delete y.mappedCount),y.hidden||v.contains(y.id)||(p[y[g]].push(y),u[y.datatype].push(y)),v.contains(y.id)&&(m[y.id]||(m[y.id]=[]),m[y.id].push(y))}var h=function(e,t){for(var o=e,r=e.length,a=0;a<r;a++)e[a]&&e[a][t]&&delete e[a][t],e[a].children&&(e[a].children=h(e[a].children,t));return o},x=function(e,r,a,i){var n,c=e,s=e.api_name?"api_name":"apiname",d=$L("crm-detailview-oldeditor")[0],y=$L("crm-detailview-footer")[0];if(n="MobileDetailView"===(V=d?d.getData("feature"):y?y.getData("feature"):"DetailView")?["fileupload","image"]:["profileimage","textarea","fileupload","image","subform","static_subform"],"FormView"===V&&"create_page_comp"===e.type&&n.push(e.datatype),c.zcanvasId&&!t||(c.zcanvasId=zutils.getRandomId()),e[s]||e.datatype&&!e.noprocess&&!v.contains(e.id)){var g=!1,x=e[s],b=!1,C=[];if(p[x]&&x&&!t&&!l&&(C.length||(C=p[x].filter((function(o){return t&&o.zcscope>0?o.id!==e.id||0!==o.mappedCount&&o.mappedCount?o.zcscope:o.id===e.id:o.mappedCount<o.zcscope||!o.mappedCount}))),C&&C.length>1&&(C=C.filter((function(t){return e.datatype===t.datatype}))),g=C.length>0),u[e.datatype]&&!g&&!e.noprocess){C=[];var w=!1;if("button"===e.datatype&&(C=u[e.datatype].filter((function(o){return t&&o.zcscope>0?o.id!==e.id||0!==o.mappedCount&&o.mappedCount?o.zcscope:o.id===e.id:"MobileDetailView"!==V||o.type===e.type?o.id===e.id&&o.zcscope>0:void 0})),t)){var A=C.filter((function(t){return t.id===e.id&&0!==t.zcscope&&t.zcscope<=5}));C=A.length>0?A:C}if(!C.length)if("create_page_comp"===e.type&&(C=u[e.datatype].filter((function(t){return t.id===e.id}))),"button"===e.type&&(C=u[e.datatype].filter((function(e){return store.peekRecord("custom_button",e.id)})),w=!!C.length),e.custom_field)C=u[e.datatype].filter((function(e){return e.custom_field&&(e.mappedCount<e.zcscope||!e.mappedCount)}));else if(l&&(C=u[e.datatype].filter((function(t){return t.id===e.id}))),C.length||(C=u[e.datatype].filter((function(o){return t&&o.zcscope>0?o.id!==e.id||0!==o.mappedCount&&o.mappedCount?o.zcscope:o.id===e.id:"MobileDetailView"!==V||o.type===e.type?o.mappedCount<o.zcscope||!o.mappedCount&&o.zcscope>0:void 0}))),t){var L=C.filter((function(t){return t.id===e.id&&(0===t.mappedCount||!t.mappedCount)}));C=L.length>0?L:C}C&&C.length?g=!0:b="button"!==e.type&&("action"!==e.type||"FormView"!==V)||w}if("link"!==e.datatype||u[e.datatype]||g||(g=!0,e.delFromjson=!0),"button"!==e.type||C.length||g?"MobileDetailView"!==V||"action"!==e.type||C.length||g||(g=!0,e.delFromjson=!0,b=!1):(g=!0,e.delFromjson=!0),!u[e.datatype]&&!g||b){C=[];if(n.indexOf(e.datatype)<0)for(var S in u)if("MobileDetailView"!==V||"profileimage"===e.datatype||"profileimage"!==S){if(n.indexOf(S)<0&&u[S].length>0&&("fields"===u[S][0].group||"field"===u[S][0].group||"mandatory"===u[S][0].group&&"button"!==u[S][0].datatype)&&(C=u[S].filter((function(e){return t&&e.zcscope>0?e.zcscope:e.mappedCount<e.zcscope||!e.mappedCount&&e.zcscope>0})),C&&C.length))break;if(n.indexOf(S)<0&&u[S].length>0&&"action"===u[S][0].group&&(C=u[S].filter((function(t){if("button"===e.datatype)return e.datatype==t.datatype&&(t.mappedCount<=t.zcscope||!t.mappedCount)})),C&&C.length))break}}if("button"!==e.datatype||C.length||g||(g=!0,e.delFromjson=!0),C&&C.length){var I=0;if("clone"===Lyte.Router.getRouteInstance().routeName){let t=C.length;for(let o=0;o<t;o++)if(C[o].id===e.id){I=o;break}}if(c.sys_ref_name)for(var z=C.length,k=0;k<z;k++)if(C[k].apiname===c.sys_ref_name){var R=C.splice(k)[0];C.unshift(R);break}if(C[I].mappedCount){for(var F=C.length,D=0;D<F;D++)if(C.push(C.shift()),!C[I].mappedCount){C[I].mappedCount=0;break}}else C[I].mappedCount=0;C[I].mappedCount=C[I].mappedCount+1,"MobileDetailView"!==V||"action"!==e.type||!r||"zcanvas-editor-outer-header"!==r.static_id&&"zcanvas-editor-outer-footer"!==r.static_id?C[I].zcscope=C[I].zcscope-1:C[I].zcscope=0;var E=$L("crm-detailview-oldeditor")[0];if(!!E&&E.component.getData("showObjPreview")||!a&&!i){if(!l){var P="zcanvas_menu",O=$("#"+P).data("zcdatamap");if("MobileDetailView"!==V||"action"!==e.type||!r||"zcanvas-editor-outer-header"!==r.static_id&&"zcanvas-editor-outer-footer"!==r.static_id||(P=r.static_id+"-menu",O=$("#"+P).data("zcdatamap"),C[I].fieldContainer=O[C[I].id].fieldContainer),O[C[I].id].zcscope=C[I].zcscope,O[C[I].id].mappedCount=C[I].mappedCount,C[I].zcscope<=0){var T=$("#"+P+' [data-uniquekey="'+C[I].id+'"]');T.addClass("zc-strict-hide");var N=T.parent(".zcanvas-submenu-container");N.find(".zcanvas-field:not(.zc-strict-hide)").length||(N.addClass("zc-strict-hide"),N.prev(".zcanvas-submenu-heading").addClass("zc-strict-hide"))}}}else o&&(o.isListView||o.isFormView)?o.currentfields[C[0].id].zcscope=C[0].zcscope:$L("crm-detailview-canvas-gallery")[0].component.getData("menuOptionsData")[C[0].id].zcscope=C[0].zcscope;if((c=$L.extend(c,C[I]))&&c.details&&C[I]&&!C[I].details&&delete c.details,"picklist"===c.zctype&&"FormView"!==V&&"WizardView"!==V&&Lyte.registeredMixins["crm-detailcanvas-utils"].removePicklistprops(c,r),"picklist"===c.zctype&&"FormView"===V&&store.peekRecord("field",c.id).colour_code_enabled)for(S in c.ui.field.style)parseInt(c.ui.field.style[S].padding_left)<30&&(c.ui.field.style[S].padding_left="30px")}else c.noMapAvail="FormView"!==r.feature,c.value="DetailView"===r.feature?"N/A":'<div class="zcunmappedValue">N/A<div>',c.label="DetailView"===r.feature?"N/A":'<div class="zcunmappedValue">N/A<div>',c.fieldContainer="#zcanvas_menu"}if(v.contains(e.id))if(m[e.id]){var H=m[e.id].filter((function(t){return t.id===e.id}))[0];if(H.zcscope=H.zcscope-1,c=$L.extend(c,H),i)o&&(o.isListView||o.isFormView)&&(o.currentfields[e.id].zcscope=H.zcscope);else if(!l){(O=$("#zcanvas_menu").data("zcdatamap"))[e.id].zcscope=H.zcscope}}else c.noMapAvail=!0,c.noExactMap="noMapAvail";if(e.section_id){var U=e.section_id.split("_")[1],j=u.undefined.filter((function(e){return e.sectionid&&e.sectionid.split("_")[1]===U}));0===j.length&&(j=u.undefined.filter((function(e){if(e.data.length&&"profileimage"!==e.data[0].datatype&&"subform"!==e.data[0].datatype&&"static_subform"!==e.data[0].datatype&&(!e.mappedCount||e.mappedCount<2))return e}))),j&&j.length?(j[0].mappedCount||(j[0].mappedCount=0),j[0].mappedCount+=1,M(j[0]),c.children=j[0].data.children,c.children&&c.children.forEach((function(e){e.noprocess=!0}))):c.noMapAvail=!0}var V=(E=E||$L("crm-detailview-oldeditor")[0])?E.getData("feature"):y?y.getData("feature"):"DetailView",q=e.children;if(e.related_list||q&&q.related_list){var J,Z,B,W,Y;Z="MobileDetailView"===V?[]:0;for(var G=c.children.length,Q=0;Q<G;Q++){var K=c.children[Q];switch(K.type){case"relatedlist":J=Q;var X=K.data?K.data.p_name:void 0;B=X||(store.peekRecord("related_list",K.id)?store.peekRecord("related_list",K.id).personality_name:K.id),W=K.id;break;case"static_content":"MobileDetailView"===V?Z.push(Q):Z=Q;break;case"component":if(K.children.length>0)for(var ee=K.children.length,te=0;te<ee;te++){var oe=K.children[te];if("relatedlist"===oe.type){J=te;X=oe.data?oe.data.p_name:void 0;B=X||(store.peekRecord("related_list",oe.id)?store.peekRecord("related_list",oe.id).personality_name:oe.id),W=oe.id}else"static_content"===oe.type&&("MobileDetailView"===V?Z.push(te):Z=te)}}}var re=c.children[J];if(re||(re=c.children[0].children[J],Y=!0),re){var ae,ie,ne=!1,ce=!(!re.data||!re.data.mappedCount),se=!(!re.data||"relatedlist"!==re.data.datatype),le=[];if("relatedlist"===re.type&&"FormViewReusableComponent"===r.feature&&(re.subform_id=re.id,o={isFormView:!0}),re.data&&!ce||(se="Table Layout"!==re.theme,le=function(e,o,r,a,i,n){var c=[];if((c=e.filter((function(e){var o=store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:null;return l||t?o===r&&(e.mappedCount<e.zcscope||!e.mappedCount||1===e.mappedCount&&1===e.zcscope):o===r}))).length||(c=o.filter((function(e){var o=store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:e.id;return l||t?(o===r||e.id===a)&&(e.mappedCount<e.zcscope||!e.mappedCount):o===r||e.id===a&&(e.mappedCount<e.zcscope||!e.mappedCount)}))),!c.length)if(i.noExactMap)i.static_rel||(c=e.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope||1===e.mappedCount&&1===e.zcscope}))),c.length||(c=o.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope||1===e.mappedCount&&1===e.zcscope}))),i.noExactMap=!(c.length>0)&&"noMapAvail";else{var s=i.children,d=2;"MobileDetailView"===n&&3===s.length&&(d=3);var p=s.length===d?s[1]:s[0].children[1];p&&p.id&&(Lyte.registeredMixins["crm-detailcanvas-utils"].staticComponents.indexOf(p.id)>-1?i.static_rel=!0:i.static_rel=!1),p&&!p.subform_id&&(i.noExactMap=!0)}return c}(f,_,B,W,c,V),ne=!0),ne||(se?(le=f.filter((function(e){return(store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:null)===B})),le.length||(c.noExactMap?(le=f.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope})),c.noExactMap=!(le.length>0)&&"noMapAvail"):c.noExactMap=!0),ae="canvasRL"):(le=_.filter((function(e){return((store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:e.id)===B||e.id===W)&&(e.mappedCount<e.zcscope||!e.mappedCount)})),le.length||(c.noExactMap?(le=_.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope})),c.noExactMap=!(le.length>0)&&"noMapAvail"):c.noExactMap=!0),ae="staticRL")),re.subform_id&&(o&&o.isFormView?(u.subform&&(le=u.subform.filter((function(e){return("subform"===e.datatype||"static_subform"===e.data[0].datatype)&&e.required&&(e.mappedCount<=e.zcscope||!e.mappedCount&&e.zcscope>0)})),le.length||(le=u.subform.filter((function(e){return("subform"===e.datatype||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data[0].datatype)&&(e.mappedCount<=e.zcscope||!e.mappedCount&&e.zcscope>0)})))),le=le||[]):le=u.undefined.filter((function(e){return e.data.length&&("subform"===e.data[0].datatype||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data[0].datatype)&&(!e.mappedCount||e.mappedCount<2)})),le&&0===le.length&&(c.noExactMap="noMapAvail")),"MobileDetailView"===V&&le[0]&&"SERIESPERSONALITY"===le[0].p_name&&le.splice(0,1),le&&le.length){if(le[0].mappedCount){for(var de=le.length,pe=0;pe<de;pe++)if(le.push(le.shift()),!le[0].mappedCount){le[0].mappedCount=0;break}}else le[0].mappedCount=0;var ue;le[0].mappedCount=le[0].mappedCount+1,l||!a&&$("#zcanvas_menu").length&&$("#zcanvas_menu").data("zcdatamap")[le[0].id]&&($("#zcanvas_menu").data("zcdatamap")[le[0].id].mappedCount=le[0].mappedCount),!re.subform_id||o&&o.isFormView||(le=le[0].data);var me=$L("crm-detailview-canvas-gallery")[0];if(c.ui&&c.ui.value&&c.ui.value.zcode&&(c.ui.value.zcode.name="RL-"+le[0].zcvalue),c.children[J]){if(c.children[J].id=le[0].id,"MobileDetailView"===V){ue=[];var ve=Z.length;for(Q=0;Q<ve;Q++)ue.push(c.children[Z[Q]].children)}else ue=c.children[Z].children;c.children[J].components=c.children[J].children,c.children[J].data=le[0],"canvasRL"===ae&&(c.children[J].data.rellistdata=[]),j=!(o&&o.isFormView)&&Lyte.registeredMixins["crm-canvas-core-gallery"].relListCreate(c.children[J],me?me.component.getData("menuOptionsData")[le[0].id]:$("#zcanvas_menu").data("zcdatamap")[le[0].id],t,l)}else{if(c.children[0].children[J].id=le[0].id,"MobileDetailView"===V){ue=[];for(ve=Z.length,Q=0;Q<ve;Q++)ue.push(c.children[0].children[Z[Q]].children)}else ue=c.children[0].children[Z].children;c.children[0].children[J].components=c.children[0].children[J].children,c.children[0].children[J].data=le[0],"canvasRL"===ae&&(c.children[0].children[J].data.rellistdata=[]),j=Lyte.registeredMixins["crm-canvas-core-gallery"].relListCreate(c.children[0].children[J],me?me.component.getData("menuOptionsData")[le[0].id]:$("#zcanvas_menu").data("zcdatamap")[le[0].id],t,l)}if((a||i)&&j&&j.data instanceof Promise&&Lyte.registeredMixins["crm-canvas-core-gallery"].gallerypreviewRL.push(j.data),"MobileDetailView"===V)Lyte.registeredMixins["crm-canvas-mobile-utils"].processCloneRLforMobileCanvas(c,ue,Z,le,Y,r);else for(var _e=ue.length,fe=0;fe<_e;fe++)if(ue[fe])if(ue[fe].ui.value.class&&ue[fe].ui.value.class.indexOf("zc_disabled")>-1)"stage_navigator"!==le[0].id&&(ue[fe].ui.value.value=le[0].zcvalue),Y||r&&r.tab_relatedlist_id?r&&r.tab_relatedlist_id?(r.tab_relatedlist_id=r.children[0].children[1].id,"stage_navigator"!==le[0].id&&(r.ui.value.name=le[0].zcvalue)):(c.children[0].children[Z].children=ue,c.tab_relatedlist_id&&"stage_navigator"!==le[0].id&&(c.ui.value.name=le[0].zcvalue)):c.children[Z].children=ue;else if("button"===ue[fe].datatype){var ye,ge=store.peekRecord("related_list",le[0].id),he=!1;if(he=Lyte.registeredMixins["crm-detailcanvas-utils"].staticRlMapping.indexOf(le[0].api_name)>=0,!ge||he)(Y?c.children[0].children[1].id:c.children[1].id)===le[0].id&&(Lyte.registeredMixins["crm-canvas-builder-process"].fetchActionsForStaticRel(le[0],Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]),ye=le[0].actions,he=!0);if(ge||he){he||(ye="DetailView"===V?Lyte.registeredMixins["crm-canvas-builder-process"].getRelListActions(ge,V):Lyte.registeredMixins["crm-canvas-mobile-utils"].getMobileCustomRelatedListActions(ge));var xe=ye.length;0===xe&&(Y?c.children[0].children[Z].children.splice(fe,1):c.children[Z].children.splice(fe,_e-1));var be=!1;for(Q=0;Q<xe;Q++)ye[Q].id.indexOf(ue[fe].id.split(/(\d+)/)[0])>-1&&(ue[fe]=$L.extend(ue[fe],ye[Q]),ue[fe].noprocess=!0,be=!0);if(1===xe&&ue[fe]&&ue[fe].ui.icon?ue[fe].ui.icon.icon="icon-Icon_plus":xe>1&&ue[fe]&&ue[fe].ui.icon&&(ue[fe].ui.icon.icon="icon-Icon_dot_three"),!be&&xe>0){var Ce=xe>1?ye[xe-1]:ye[0];ue[fe]=$L.extend(ue[fe],Ce),ue[fe].zcvalue=ue[fe].value,ue[fe].noprocess=!0}}else Y?c.children[0].children[Z].children.splice(fe,1):c.children[Z].children.splice(fe,1)}}else if("noMapAvail"===c.noExactMap&&(c.ui.value.editorclass+=" zcanvas-loading-component",(c.children[J]||c.children[0].children[J])&&(Y?(c.children[0].children[J].noMapAvail=!0,c.children[0].children[J].children.forEach((function(e){e.label="N/A",e.value="N/A"})),se||(c.children[0].children[J].components=[])):(c.children[J].noMapAvail=!0,c.children[J].children.forEach((function(e){e.label="N/A",e.value="N/A"})),se||(c.children[J].components=[]))),r&&r.tab_relatedlist_id&&(r.noMapAvail=!0,r.noExactMap="noMapAvail"),c.noMapAvail=!0,"FormView"===V)){j={template:'<div class="zcunmappedValue">N/A<div>',zclabel:'<div class="zcunmappedValue">N/A<div>',noMapAvail:!0,label:'<div class="zcunmappedValue">N/A<div>',value:'<div class="zcunmappedValue">N/A<div>'};c.children[0].children[0].ui.value.value='<div class="zcunmappedValue">N/A<div>',c.children[1].data=j,c.noMapAvail=!!t&&c.noMapAvail}if(!le.length)if("MobileDetailView"===V)Lyte.registeredMixins["crm-canvas-mobile-utils"].processCloneRLforMobileCanvas(c,ue,Z,le,Y,r);else{var we=Y?c.children[0].children[Z]:c.children[Z];if(we)for(var Me=we.children,Ae=Me.length,Le=0;Le<Ae;Le++){Me[Le].noprocess=!0}}if(c.children[J]){var Se=c.children[J].children.length;for(Q=0;Q<Se;Q++){(ze=c.children[J].children[Q]).noprocess=!0,ze.datatype&&n.indexOf(ze.datatype)>-1&&(c.children[J].children.splice(Q,1),Q-=1,Se-=1)}ie=h(c.children[J].children,"id"),c.children[J].children=ie}if(Y&&c.children[0].children){var Ie=c.children[0].children[J].children.length;for(Q=0;Q<Ie;Q++){var ze;(ze=c.children[0].children[J].children[Q]).noprocess=!0,ze.datatype&&n.indexOf(ze.datatype)>-1&&(c.children[0].children[J].children.splice(Q,1),Q-=1,Ie-=1)}}c.noprocess=!0}}if("canvas_progress_circle"===e.theme||"canvas_progress_bar"===e.theme){var ke=store.peekAll("field").filter((function(e){return 34===e.ui_type}));ke&&ke.length>0?c.mapped_field_id=ke[0].id:c.mapped_field_id=void 0}var Re,Fe=Lyte.registeredMixins["crm-detailcanvas-utils"].integ_comp;if((e.data&&e.data.personality_name||e.data&&e.data.p_name)&&(Re=e.data.api_name,Fe.indexOf(Re)>-1&&(c.personality_name=e.data.personality_name?e.data.personality_name:e.data.p_name)),c&&c.children&&c.children[J]){var De=Lyte.registeredMixins["crm-detailcanvas-utils"].staticComponents,Ee=c.children[J];Ee&&De.indexOf(Ee.id)>-1&&Ee.personality_name?delete Ee.personality_name:Ee&&Ee.data&&(Ee.personality_name!==Ee.data.p_name||Ee.personality_name!==Ee.data.personality_name)&&(Re=Ee.data.api_name,Fe.indexOf(Re)>-1&&(Ee.personality_name=Ee.data.p_name?Ee.data.p_name:Ee.data.personality_name))}return c},b=function(e,o,r,a){for(var i=e,n=e.children,c=n?n.length:0,s=[],l=0;l<c;l++){var d=n[l].noprocess;o?d=!0:"Tab Layout"===e.theme&&n[l]&&n[l].children&&n[l].ui.value.class.indexOf("zc-tab-all-fields")>-1?(t&&$(".zc-tab-content[data-zcanvasclass~='zc-tab-all-fields']").length?(n[l].noMapAvail=!0,n[l].noExactMap="noMapAvail"):(n[l].children=[],n[l].ui.allfieldstabstyle={}),d=!0):e.children[l]=x(e.children[l],e,r,a),e.children[l].delFromjson||s.push(b(e.children[l],d,r,a))}return i.children=s,i},C=function(e,t,o){var r,a=e,i=$L("crm-detailview-oldeditor")[0];r="MobileDetailView"===(i?i.getData("feature"):"DetailView")?["fileupload","image"]:["profileimage","textarea","fileupload","image"];for(var n=a.children.length,c=0;c<n;c++){var s=a.children[c];s.noMapAvail&&s.datatype&&r.indexOf(s.datatype)>-1&&(s.fieldContainer="#zcanvas_menu"),s.noExactMap&&"noMapAvail"!==s.noExactMap?s=x(s,a,t,o):C(s,t,o)}return e},w=function(e){for(var t=e,o=t?t.children.length:0,r=0;r<o;r++){var a=t.children[r];a&&a.noMapAvail&&"noMapAvail"===a.noExactMap?(e.children.splice(r,1),o-=1,r-=1):w(a)}return e},M=function(e){e.menudata&&(e.data=objectUtils.cloneObject_new(e.menudata));var t=e.data&&1===e.data.length&&(e.data[0].datatype.indexOf("image")>-1||e.data[0].datatype.indexOf("subform")>-1||Crm.userDetails.isStaticSubFormEnabled&&e.data[0].datatype.indexOf("static_subform")>-1);if(t){if(t&&!external){var o=$("#zcanvas_menu").data("zcanvasMenu");el.helper.addClass("zcanvas-field zcanvas-afterdrop").removeClass("zcanvas-submenu-heading");var r=objectUtils.cloneObject_new(e.data[0]),a=el.helper.attr("data-uniquekey"),i=$('#zcanvas_menu [data-uniquekey="'+a+'"]');r["zcanvas-afterdrop"]=e,i.data("zcanvas",r),o.dragstarthandler(null,el,r)}}else{var n={ui:{value:{style:{},class:"zc-fieldsection",position:{start_x:0,start_y:0,end_x:1640,width:1620,height:943,min_top:37,min_left:24},tagname:"DIV"}},children:[],type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd",zcMinWidth:"500"},c={ui:{value:{style:{default:{border_radius:"0",box_shadow:"none",border:"none",background_color:"rgba(243, 242, 242, 1)"}},position:{start_x:0,start_y:0,end_x:1640,width:"100%",height:38,min_top:37,min_left:24},tagname:"DIV"}},children:[],type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd"},s={zcanvasId:"zcanvas_4si4xy5gemp",type:"component",ui:{value:{style:{},position:{start_x:10,start_y:7,end_x:174,width:164,height:27},class:"zc_disabled",value:"Products"}},theme:"Static Text",children:[]},l={zcanvasId:"#zcanvas_us58qoeplr",type:"component",ui:{value:{position:{start_x:30,start_y:52,end_x:1278,width:"calc(100% - 60px)",height:480,min_top:5},style:{},class:"zclayout-table zcrestricttable",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]};l.zcanvasId=zutils.getRandomId();var d={type:"row",ui:{value:{position:{start_x:0,start_y:5,end_x:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},p={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",type:"field",ui:{value:{style:{},position:{start_x:0,start_y:0,end_x:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]},u=l,m=Math.round(e.data.length/2);c.zcanvasId=zutils.getRandomId(),n.zcanvasId=zutils.getRandomId(),s.zcanvasId=zutils.getRandomId(),s.ui.value.value=e.zclabel,c.children.push(s);for(var v=0,_=0;_<m;_++){var f=JSON.parse(JSON.stringify(d)),y=objectUtils.cloneObject_new(p);if(y.zcanvasId=zutils.getRandomId(),f.children.push(y),2*(_+1)<=e.data.length){var g=objectUtils.cloneObject_new(p);y.zcanvasId=zutils.getRandomId(),f.children.push(g)}u.children.push(f),v+=50}u.ui.value.position.height=v,n.ui.value.position.height=v+100;var h=e.data.map((function(e){return e.id})),x=Lyte.Router.getRouteInstance().parent.currentModel,b=Lyte.registeredMixins["crm-detailcanvas-utils"].processRelListObj(u,x.entityData,x.module,h);if(n.children.push(c),n.children.push(b),e.zctype="component",e.value="",e.menudata=objectUtils.cloneObject_new(e.data),n.zccompmeta={section_id:e.sectionid},e.data=n,e.containment="parent",e.condition=function(e){return!($(".zc-fieldsection[data-sectionid="+e.sectionid+"]").length>1)},e.callback=function(e,t){e.attr("data-sectionid",t.sectionid);var o=e.attr("id");e.addClass("zc-non-insertable");var r=e.find(".ui-draggable");r.draggable("option","containment","parent"),r.draggable("option","scope",o),e.find(".ui-droppable").add(e).droppable("option","scope",o),e.find(".zctable-sortable").addClass("zctable-disabled")},external)return e}},A=b(e,void 0,a,s);if(A=C(A,a,s),A=w(A),o&&o.currentfields)return A;if(t)return A.children.length||_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.reusable.component.norelevantdata"),ltPropType:"warning"}}),A.children;if(n&&n.component.getData("showObjPreview"))Lyte.registeredMixins["crm-canvas-core-gallery"].getObjParsedJson(A);else if(a||s)i.component.setData("current_view",A),i.component.fetchParsedJson(A);else{var L=$("#zcanvas-editor-outer");L.find(".zcanvas").remove();var S=L.data("zcanvas");if(S&&(S.config.toolsRef.config.preventDeleteRule=!0,S.config.toolsRef.config.isFromGallery=!0,S.addElement(A.children),A.ui&&A.ui.theme&&S&&(S.config.toolsRef.config.theme.currenttheme=zutils.decompresstheme(A.ui.theme),S.config.isFormView&&S.config.toolsRef.compiletheme()),S.config.toolsRef.config.preventDeleteRule=!1,S.config.toolsRef.config.isFromGallery=!1),L.zccss(A.ui.value.style||{}),A.ui.page)$(".canvas-customizable-background").zccss(A.ui.page.style||{});A.ui.value&&A.ui.value.position&&A.ui.value.position.width&&("TableView"===Canvas.builderConfig.builderMode?(L.css({width:zutils.pageContainer().width()-20}),L.parent().css({width:zutils.pageContainer().width()-20})):(L.css({width:A.ui.value.position.width}),L.parent().css({width:A.ui.value.position.width}))),L.addClass(A.ui.value.class).zaddClass(A.ui.value.class),L.removeClass("zcanvas-editor").zremoveClass("zcanvas-editor"),"DetailView"===Canvas.builderConfig.builderMode?S&&(S.resetheight(),zutils.getScrollDefaultPage()):L.css({height:e.ui.value.position.height}),setTimeout((function(){zutils.search();var e=zcanvasZoomHandler&&zcanvasZoomHandler.options;zutils.getScrollDefaultPage(e&&e.defaultBuilderAlignment)}),0)}},customStatiView:function(e,t){var o=e.id,r=null,a=$("#zcanvas_menu").data("zcdatamap");if(t||(t={record:{},module:" "}),a&&a[o]&&a[a[o].label]&&a[a[o].label].menudata)r=a[a[o].label].menudata;else{var i=Lyte.Router.getRouteInstance().parent.getDynamicParam(),n=$L("crm-detailview-canvas-gallery")[0];n&&(i=n.getData("layoutId"),t.record=n.getData("record"),t.module=n.getData("module"));var c=store.peekRecord("layout",i);if(c){var s=c.sections.filter((function(e){return e.uid===o}));s&&s[0]&&(r=s[0].fields)}}return Lyte.registeredMixins["crm-detailcanvas-utils"].sectionview(e,r||[],t)},afterPreview:function(){var e=$("#previewcanvas .zclayout.zctabview"),t=zclayout.prototype.layouts["Tab Layout"];e.each((function(){var e=$L(this);t.refreshlayout(e,(function(){var e=$L("#previewcanvas");e.find("crm-stage-history").each((function(){var e=$(this);e.length&&e[0].component.setWidthForStagesParent()}));var t=e.find("crm-zia-score-result"),o=$("#ziascorechart");t.length&&o.length&&t[0].component.scoreChart()})),Lyte.registeredMixins["crm-detailcanvas-utils"].setactivetab(e)}));var o=$L(".zccbutton .navigateRecord");if(o.length){var r=o[0];r.setMethods({onNext:function(){},onPrevious:function(){}}),r.component.buttonDisable.call(r.component)}var a=$L("#previewcanvas");a.find("crm-stage-history").each((function(){var e=$(this);e.length&&e[0].component.setWidthForStagesParent()}));var i=a.find("crm-zia-score-result"),n=$("#ziascorechart");i.length&&n.length&&i[0].component.scoreChart();for(var c=$("#previewcanvas [zcflag]"),s=c.length,l=$L("crm-detailview-oldeditor")[0],d=0;d<s;d++){var p=c.eq(d),u=p.removeAttr("lyte-rendered zcflag").outerHTML(),m=p.parent();p.remove(),m.append(u);let e=m.find("crux-image-component");if(e.length){var v=e[0].id.split("_")[1];let t=l?void 0:module.value,o=l?void 0:entityId.value;Lyte.registeredMixins["crm-uploadfields-mixin"].thumbnailRequestForCanvas(l,v,t,o)}}("FormView"===Canvas.builderConfig.builderMode&&Lyte.registeredMixins["crm-canvas-form-design-config-mixin"].afterpreviewcallbackformview(),"WizardView"===Lyte.Router.getRouteInstance().transition.info.queryParams.feature)?Lyte.registeredMixins["crm-canvas-form-design-config-mixin"].wizardviewAfterPreview():"FormView"===Canvas.builderConfig.builderMode&&(Lyte.registeredMixins["crm-canvas-core-mixin"].fieldCallSerializer(),Lyte.registeredMixins["crm-canvas-form-design-config-mixin"].afterpreviewcallbackformview())},relListCreate:function(e,t,o,r){var a,i=$L("crm-detailview-canvas-gallery")[0],n=$L("crm-detailview-oldeditor")[0],c=n&&n.getData("feature")?n.getData("feature"):"DetailView",s=Lyte.Router.getRouteInstance().transition.target,l=(a="crm.settings.section.modules.module.canvas.clone"===s||"crm.settings.section.modules.module.canvas.edit"===s||"crm.settings.section.modules.module.canvas.import"===s||"FormView"===c&&o?n.component.getData("menuDetails"):i.component.getData("menuOptionsData"))[e.id];if(l&&1===l.zcscope&&"Custom Layout"===e.theme&&!r&&(e.theme="Table Layout"),"Table Layout"===e.theme&&l){var d=$(l.fieldContainer).data("zcanvasMenu");if(d&&d.config&&d.config.zmenustart&&!o&&d.config.zmenustart(l),n&&e.data&&"relatedlist"===e.data.datatype&&("crm.settings.section.modules.module.canvas.clone"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.section.modules.module.canvas.edit"===Lyte.Router.getRouteInstance().transition.target)){var p=n.component.getData("layoutId"),u=n.component.getData("module"),m=n.component.getData("record")&&n.component.getData("record").$&&n.component.getData("record").$.toJSON()?JSON.stringify(n.component.getData("record").$.toJSON()):void 0,v=n.component.getData("entityId");l.template="<crm-related-list-view-header layout-id='"+p+"' record='"+m+"' entity-id=\""+v+"\" module='"+u+'\' show-loading="{{lbind(isLoading)}}" related-list-id="'+l.id+"\" related-list='"+JSON.stringify(store.peekRecord("related_list",l.id).$.toJSON())+"'></crm-related-list-view-header>"}else if(e.data&&"relatedlist"===e.data.datatype){p=i.component.getData("layoutId"),u=i.component.getData("module"),m=i.component.getData("record")&&i.component.getData("record").$&&i.component.getData("record").$.toJSON()?$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(i.component.getData("record").$.toJSON())):void 0,v=i.component.getData("entityId");l.template="<crm-related-list-view-header layout-id='"+p+"' record='"+m+"' entity-id=\""+v+"\" module='"+u+'\' show-loading="{{lbind(isLoading)}}" related-list-id="'+l.id+"\" related-list='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(store.peekRecord("related_list",l.id).$.toJSON()))+"'></crm-related-list-view-header>"}}if(o)return l;if(l&&l.template&&$u.isEmpty(l.data)&&(!(2===l.zcscope&&l.mappedCount>1&&"Custom Layout"===e.theme)||"static_rel"===l.datatype&&1===l.zcscope&&1===l.mappedCount&&"Custom Layout"===e.theme))return a[e.id].data=new Promise((function(e){l.async&&Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(l);var t=l.actions;e({data:{},template:l.template,async:l.async,asyncloader:l.asyncloader,actions:t})})),l;e.children=e.components;var _=!0,f=!0;if(l&&!l.noAction){var y=l.action.url_params[2],g=store.peekRecord("related_list",y);if(g&&"multiselectlookup"===g.type){var h=g.connectedmodule;moduleRecordMapping[h]&&(_=moduleRecordMapping[h].viewable,f=moduleRecordMapping[h].visible)}}if("create"!==Lyte.Router.getRouteInstance().routeName&&"import"!==Lyte.Router.getRouteInstance().routeName&&"clone"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().routeName&&"edit"!==Lyte.Router.getRouteInstance().routeName||!l)if(l&&_&&f&&!l.noAction)Lyte.registeredMixins["crm-canvas-builder-process"].relatedListDataProcessing(l,e);else{l={};var x="";u=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if(("import"===Lyte.Router.getRouteInstance().routeName||"create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().routeName||"edit"===Lyte.Router.getRouteInstance().routeName)&&"Table Layout"===e.theme){var b,C,w={module:u,record:{},compId:e.id,from:"",personalityName:e.personality_name};if(["timeline","journeys","sales_summary","data_privacy","stage_navigator","followers","blueprint","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","pathfinders","segmentation","best_time","prediction","churn_prediction","zia_score","recommendation","similarity","next_best_action","competitor_mentions","abm"].indexOf(e.id)>-1){w.comptype=e.id;var M=new CrmDetailViewHandler(w)}else{w.comptype="static_rel";M=new CrmDetailViewHandler(w)}b=M.getHTML(),C=M.getResources(),l.asyncresources=C,l.async=!0,x=b}l.data=new Promise((function(t){Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(l),t({data:e,template:x,actions:[],rellistdata:[],module:"",asyncloader:l.asyncloader,async:l.async})}))}else Lyte.registeredMixins["crm-canvas-builder-process"].relatedListDataProcessing(l,e,t,c);return l},relatedlistcompile:function(e,t,o){var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if((t&&t._data&&(t=t._data),t&&t.id)&&!store.peekRecord("related_list",t.id))return;return Lyte.registeredMixins["crm-canvas-builder-process"].getRelListHtml(e,t&&t.rellistdata?t.rellistdata:[],r,t&&t.fieldid?t.fieldid:[],null,o,t)},openCanvasGalleryModal:function(e,t,o,r,a){var i=networkUtils.returnDependencyFiles(["crm-canvasform.js","crm-listview-canvas-gallery.js","crm-canvas-listview.js","crm-canvas-helpers.js","crm-canvas-image.js","crm-tag.js","crm-skype-field.js","crm-email-field.js","crm-upcoming-activity.js","crm-list-helpers.js","crm-canvas-import-button.js","features_model.js","custom_link_model.js","crm-canvas-core-builder.js","crm-canvasview.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js"],ResourceConstants.CRMClient);i=(i=(i=(i=(i=i.concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crux-boolean-component.css","crm-detailview-canvas-gallery.css"],ResourceConstants.CRMClient)}])).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-formview-canvas-gallery.css","crm-listview-canvas-gallery.css","crm-canvas-export.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}])).concat(networkUtils.returnDependencyFiles(["crm-upcoming-activity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-inventory-detail-view.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(i=i.concat(networkUtils.returnDependencyFiles(["zcanvas-rtl.css"],ResourceConstants.CRM))),Lyte.injectResources(i).then((function(){if("FormView"===t)$L("#previewcanvas").empty(),Lyte.Component.render("crm-form-view-canvas-gallery",{recordList:a.recordlist,record:a.currentrecord,menuType:"all",standaloneView:a.recordJson,showGallery:!0,module:e,featureName:"FormView",defaultShrinkMode:!0},"#previewcanvas");else if("canvas_editor"!==r&&"settings_page"!==r||"WizardView"===t)"WizardView"!==t&&($L("#canvas-listview-gallery-container").empty(),Lyte.Component.render("crm-list-view-canvas-gallery",{showGallery:!0,module:e,viewType:o,featureName:t,defaultShrinkMode:!0},"#canvas-listview-gallery-container"));else{var i=!1,n=!1,c=!1,s="previewcanvas";a&&a.isSandboxDiff?(s="sandboxObj_sandboxChanges",i=!0,n=!0):a&&a.isProdDiff&&(s="parentObj_sandboxChanges",i=!0,c=!0),$L("#"+s).empty(),Lyte.Component.render("crm-list-view-canvas-gallery",{menuType:"all",standaloneView:a.recordJson,showGallery:!0,module:e,viewType:o,featureName:"ListView",defaultShrinkMode:!0,fromPreview:!0,fromSandboxViewDiff:i,isProdDiff:c,isSandboxDiff:n},"#"+s)}}))},convertmenuToMap:function(e){var t=e.groups,o={};for(key in t){e=[];if(t[key].data)e=this.normalize(t[key].data,key,o);else for(subkey in t[key])e=this.normalize(t[key][subkey].data,key,o),o[subkey]=t[key][subkey],o[subkey].zctype="component",o[subkey].zcsubtype="submenu",o[subkey].zclabel=subkey,o[subkey].zcvalue=""}return o},normalize:function(e,t,o){for(var r="label",a="value",i="datatype",n=["text-area","profileimage","Owner_photo","button","tag"],c=["profileimage","Owner_photo","relatedlist","link","button","system","static_rel","subform","zia"],s=!this.data||"FormView"!==this.data.featureName&&"ListView"!==this.data.featureName?5:1,l={relatedlist:2,static_rel:1,system:1,zia:1,image:1},d={blueprint:1,data_privacy:1},p=e.length,u=0;u<p;u++)e[u].zctype=e[u][i],e[u].zclabel=e[u][r],e[u].zcvalue=e[u][a],e[u].group=t,n&&n.indexOf(e[u].zctype)>-1&&(e[u].nonmergable=!0),c&&c.indexOf(e[u].zctype)>-1&&(e[u].hideLabel=!0,c&&c.indexOf(e[u].id)>-1&&(e[u].hideLabel=!1)),e[u].zcscope=s||1,l&&l[e[u].zctype]&&(e[u].zcscope=l[e[u].zctype]),d&&d[e[u].id]&&(e[u].zcscope=d[e[u].id]),e[u].id&&(o[e[u].id]=e[u]);return e},getObjParsedJson:function(e){var t=e.children;t&&t[0]&&t[0].ui.value.position&&(t[0].ui.value.position.start_x=0,t[0].ui.value.position.start_y=0),Lyte.resolvePromises(Lyte.registeredMixins["crm-canvas-core-gallery"].gallerypreviewRL).then(function(){networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CanvasParser.do","POST",{params:JSON.stringify(e),skip_load_tab:!0}).then(function(e){this.manipulateObjJson(e)}.bind(this))}.bind(this))},manipulateObjJson:function(e){var t=$L("crm-detailview-oldeditor")[0];Lyte.registeredMixins["crm-canvas-core-gallery"].gallerypreviewRL=[],zclayout&&zclayout.prototype.layouts&&!zclayout.prototype.layouts["Tab Layout"].onnavigation&&(zclayout.prototype.layouts["Tab Layout"].onnavigation=Lyte.registeredMixins["crm-detailcanvas-utils"].tabOnNavigation);var o=Lyte.registeredMixins["crm-canvas-common-utils"].gettoolinst();createStruture.toolinst=o,createStruture.toolinst.rellistcompile=this.relatedlistcompile,createStruture.toolinst.tabViewcallback=Lyte.registeredMixins["crm-detailcanvas-utils"].allFieldFormation.bind(this),createStruture.toolinst.customstaticview=Lyte.registeredMixins["crm-canvas-core-gallery"].customStatiView,createStruture.singleshotrender=!0,createStruture.galleryrender=!0,createStruture.menuData=$("#zcanvas_menu").data("zcanvasMenu");var r=canvasOutput.html(void 0,e,!0);createStruture.singleshotrender=!1,createStruture.galleryrender=!1;var a=$("#previewObj"),i=$L("#obj-preview")[0];r.width(e.ui.value.position.width);var n=renderingUtils.windowOuterHeight,c=t.getData("previewTopOffset");if(e.ui.value.position.width>700&&e.ui.value.position.height>500){var s=Math.round(700/e.ui.value.position.width*10)/10/2+.1,l=Math.round(500/e.ui.value.position.height*10)/10/2+.1;r.css({transform:"scale("+s+","+l+")","transform-origin":"top left","margin-bottom":"-100%"}),c>n/2&&($L(".zc-reusable-preview-modal .lyteModal").e[0].style.top=c/2+"px"),i.ltProp({height:"460px",width:"560px"})}else if(e.ui.value.position.width>700&&e.ui.value.position.height<500||e.ui.value.position.width<700&&e.ui.value.position.height<500){var d=!1,p=null,u=renderingUtils.windowOuterWidth;e.ui.value.position.width>u/2&&(p=u/2*100/e.ui.value.position.width,r.css({transform:"scale("+p/100+")","transform-origin":"top left","margin-bottom":"-100%"}),d=!0,p=u/2+p-20);var m=d?p:e.ui.value.position.width+40,v=t.component.data.objPreviewName.match(new RegExp(".{1,"+m+"}","g")),_=(v?18*v.length:0)+90;i.ltProp({height:e.ui.value.position.height+_+"px",width:m+"px"})}else if(e.ui.value.position.height>500&&e.ui.value.position.width<700){if(e.ui.value.position.height<n)e.ui.value.position.height+c>n&&($L(".zc-reusable-preview-modal .lyteModal").e[0].style.top="2px");var f=e.ui.value.position.width+40,y=t.component.data.objPreviewName.match(new RegExp(".{1,"+f+"}","g")),g=(y?18*y.length:0)+90;i.ltProp({height:e.ui.value.position.height+g+"px",width:e.ui.value.position.width+"px"})}a.html(r),t.component.setData("isPreviewAppend",!0);var h=e.ui.theme;createStruture.toolinst.config.theme.currenttheme=h,createStruture.toolinst.compiletheme(),Lyte.registeredMixins["crm-canvas-core-gallery"].afterPreview()},renderPreview:function(e,t,o,r,a,i){return this.canvasModelPromise(e,t,r,i).then(function(n){var c="#preview";if(c=i&&i.isSandboxDiff?"#sandboxObj_sandboxChanges #previewcanvas":i&&i.isProdDiff?"#parentObj_sandboxChanges #previewcanvas":c,!n.views.length)return commonUtils.showHideLoadingDiv(!1),document.getElementById("previewModal").ltProp("show",!1),void _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.cv.delete.message"),ltPropType:"error"}});o&&(n.views.filter((function(e){return e.id===t})).length?document.getElementById("previewModal").ltProp("show",!0):Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup());return this.afterModelCanvasPromise(n,e,t).then(function(t){var i=this.getPreviewResources(e);return Lyte.Router.getRouteInstance().currentModel||(Lyte.Router.getRouteInstance().currentModel={}),Lyte.Router.getRouteInstance().currentModel.relatedlist=t.relatedlist,Lyte.Router.getRouteInstance().currentModel.layoutId=t.layoutId,Lyte.Router.getRouteInstance().currentModel.components=t.components,t.components.forEach((function(e){"segmentation"===e.name&&e.comp_available&&(Lyte.Router.getRouteInstance().currentModel[e.name+"_canvas"]=!0)})),Lyte.injectResources(i,void 0,function(){t.viewType="preview",r&&(t.comp_name_export_time=a),"DetailView"===zutils.feature&&Lyte.Component.viewPortSettings.resetLazy(),o?Lyte.Component.render("crm-detailview-canvas",t,"#gallerypreview"):Lyte.Component.render("crm-detailview-canvas",t,c),$(".canvas-rp-bar").addClass("eventNone");var e=$("#showFldPopup");e.length>0&&e.addClass("dNImp"),Lyte.registeredMixins["crm-detailcanvas-utils"].loadRecordImage(),this.debouncemethod=Lyte.registeredMixins["crm-detailcanvas-utils"].debouncescroll.bind(this)(),document.addEventListener("scroll",this.debouncemethod,!0),Lyte.registeredMixins["crm-detailcanvas-utils"].scrollhandler(),c&&c.indexOf("sandboxChanges")||commonUtils.showHideLoadingDiv()}.bind(this))}.bind(this))}.bind(this))},getPreviewResources:function(e){var t=networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-canvas-common-utils.js","crm-canvas-helpers.js","crm-skype-field.js","crm-circuits-helper.js","crm-circuits-rl-all.js","crm-circuits-mixin.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","zia/prediction/builder/field-prediction-result.js","zia/prediction/builder/churn-prediction-result.js","zia/scoring_rule/zia-score-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","setup/pathfinder/crm-pathfinder-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","zia-notification-settings.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","macro-model.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-email-field.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js","crux-color-palette.js","crm-tag-modal.js","crm-tag-helpers.js","crm-tag-mixin.js","lyte-colorpicker.js","lyte-shortcut.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-activity-rel.js","delete-popup.js","crux-criteria-component.js","crux-criteria-conditions.js","crm-social-convo-inner-new.js","recommendation-util.js","crm-cloud-picker-mixin.js","crux-lookupfilter-component.js","crux-column-list.js","crm-detail-view-utils.js","crm-detailview-common-footer.js","crm-create-mixin.js","canvasview_model.js","zia_reminder_model.js","features_model.js","servapp_preferences_model.js","note_model.js","reviewprocess_model.js","besttime_zia_new_model.js","nba-detail-page.js","crm-canvas-profile-image.js","crm-owner-field.js","crm-file-upload.js","crm-multi-lookup.js"],ResourceConstants.CRMClient),o=store.peekAll("module").find((function(t){return t.module_name===e})).api_name;if(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-inventory-detail-view.js","crm-multi-lookup.js"],ResourceConstants.CRMClient))).concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat(networkUtils.returnDependencyFiles(["crm-detail-view-utils.js","crm-create-mixin.js","servapp_preferences_model.js","note_model.js","reviewprocess_model.js","besttime_zia_new_model.js","crm-detail-view-initial-files.js"],ResourceConstants.CRMClient)),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=Crm.userDetails.detailView_newUI?t.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view_new.js",networkUtils.getI18nJSUrl("customization")],ResourceConstants.CRM)):t.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view.js",networkUtils.getI18nJSUrl("customization")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("threadsummaryandtranslation")],ResourceConstants.CRM))).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css","crm-canvas-mobile.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","crm-list-view-crux.css"],ResourceConstants.CRMClient)}])).concat(networkUtils.returnDependencyFiles(["crux-note.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["canvas-detailview-less.css","crm-mobile-components.css","zia/prediction/builder/field-prediction-result.css","zia/prediction/builder/churn-prediction-result.css","zia/scoring_rule/zia-score-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-zia-call-analytics.css","crm-zia-call-transcription.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("salesnavigator"),networkUtils.getI18nJSUrl("zdeskrelatedlist")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crrl")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("salesnavigator")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-canvas-mobile-utils.js","crm-mobile-component.js","crm-mobile-stage.js","crm-mobile-checklist.js","crm-mobile-picklist-history.js","crm-mobile-email.js","crm-mobile-note.js","crm-mobile-blueprint.js","crm-mobile-widget.js","crm-mobile-attachments.js","lyte-progressbar.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["zcanvas-rtl.css"],ResourceConstants.CRM))),Crm.userDetails.isSegmentationEnabled&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["related-list-rfm.js","segmentation-utils.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["related-list-rfm.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")],ResourceConstants.CRM))),!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&crmTab.ABMConfiguredModule===o&&(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-abm-widget.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-abm-widget.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("abmwidget")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM))),Crm.userDetails.EMAIL_THREAD_VIEW&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-emailconversation-view.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-emailconversation-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailthreadview")],ResourceConstants.CRM))),Crm.userDetails.timelineRevamp&&(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("journeys")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-timeline.css","crm-ui-loaders.css","crm-notes-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-journeys.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),"Activities"!==e&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-upload-create.js","crm-image-preview.js","lyte-cropper.js","lyte-colorbox.js","exif-plugin.js","crm-vision-create.js"],ResourceConstants.CRMClient)),t=(t=Crm.userDetails.RTL_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css"],ResourceConstants.CRMClient)):t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("scoringRulesChart")],ResourceConstants.CRM))),"Campaigns"===e){var r=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js","lyte-step.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM));var a=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],ResourceConstants.CRMClient);t=t.concat(r.concat(a));var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")],ResourceConstants.CRM);t=t.concat(i);var n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")],ResourceConstants.CRM);t=t.concat(n)}"Potentials"!==e&&"Deals"!==e||(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage"),"zohocrm_ProcessFlow.js"],ResourceConstants.CRM))),"Tasks"!==e&&"Calls"!==e&&"Events"!==e||(t=t.concat(networkUtils.returnDependencyFiles(["crm-detail-view-initial-files.js","crm-msg-utils.js","crm-detailview-helpers.js"],ResourceConstants.CRMClient))),"Calls"===e&&(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["phone-entity.js","lyte-voicenote.js","lyte-multislider.js","call-transcription-comp.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["calls-button.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_detailview"),"zohocrm_phoneNumbers.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["lyte-ui-voicenote.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),"Events"!==e&&"Appointments"!==e||(t=t.concat(networkUtils.returnDependencyFiles(["crm-events-view-utils.js","crm-detailview-helpers.js"],ResourceConstants.CRMClient))),"Services"!==e&&"Appointments"!==e||(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-services-create-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))),"Services"===e&&(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("servicesDetailView")],ResourceConstants.CRM))),moduleRecordMapping.Services&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-services-appointments.js"],ResourceConstants.CRMClient)));var c=networkUtils.returnDependencyFiles(["crm_finance_suite.js","zohocrm_lookupBusinessCard.js"],ResourceConstants.CRM);return t=t.concat(c)},canvasModelPromise:function(e,t,o,r){var a=store.peekRecord("canvasview",t),i=store.peekAll("layout").filter((t=>t.module&&t.module.module_name===e&&"active"===t.status)),n={per_page:1,approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"};if(i&&i.length>1){var c={comparator:"equal",field:{api_name:"Layout"},value:[a.layout.id]};n.filters=JSON.stringify(c)}var s=!1;return r&&(r.isSandboxDiff||r&&r.isProdDiff)&&(s=!0),Lyte.resolvePromises({module:app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,{getOnlyMeta:!1}),views:this.fetchViewJsonFor(t,o),records:s?[]:app.store.makeRequest("findAll",moduleRecordMapping[e].id,n),button:app.store.makeRequest("findAll","custom_button",{module:moduleRecordMapping[e].api_name},!0),link:app.store.makeRequest("findAll","custom_link",{module:moduleRecordMapping[e].api_name},!0),zia_features:window.isCanvasSandboxDiff||window.isCanvasProdDiff?void 0:store.findAll("features-status",{module:moduleRecordMapping[e].api_name,group:"zia",page:1,per_page:20})})},fetchViewJsonFor:function(e,t){return t?store.triggerAction("canvasview","import",null,{import_token:t,parsed:!0},"GET").then((function(e){return e.canvas_view})).catch((function(e){e&&JSON.parse(e.responseText).message&&(commonUtils.showHideLoadingDiv(),document.getElementById("previewModal").ltProp("show",!1),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.import.templatekey.deleted"),ltPropType:"error"}}))})):app.store.makeRequest("findRecord","canvasview",e,{parsed:!0},void 0,void 0,{apiVersion:"v2.2"})},afterModelCanvasPromise:function(e,t,o){var r=e;r.view=r.views[0],r.viewId=e.view.id,r.module=t,r.record=e.records[0],r.feature=r.view.feature,window.isCanvasProdDiff||commonUtils.showHideLoadingDiv(!1);var a=store.peekRecord("module",moduleRecordMapping[t].id),i=a.api_name;if(r.record&&r.record.Layout&&r.record.Layout.id)r.layoutId=r.record.Layout.id;else if(r.record&&r.record.layout_id)r.layoutId=e.record.layout_id;else{var n=a.layouts.filter((function(t){return e.view.layout&&e.view.layout.id===t.id}));r.layoutId=n.length?n[0].id:a.layouts[0].id}"Deals"!==r.module&&"Potentials"!==r.module||(r.stage=app.store.makeRequest("findAll","stage",{module:"Deals",layout_id:r.layoutId}));var c={feature:r.feature,module:t,layout_id:r.layoutId},s="",l="/crm/v2/settings/canvas/views/components";"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(s=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(s=sandbox.orgInfo.crmSandboxOrParentZgid.toString());var d=Lyte.resolvePromises({components:""!==s?store.findAll("dummy",c,!1,!1,{url:l,headers:{"X-CRM-ORG":s},method:"GET"}):networkUtils.lyteInitiateRequest(l,"GET",{params:c}),currentLayout:app.store.makeRequest("findRecord","layout",r.layoutId,{module:i},!1,!0,{apiVersion:"2.2"}),relatedlist:app.store.makeRequest("findAll","related_list",{module:i,layout_id:r.layoutId})}),p=[];return a.fields.forEach((function(e){if("subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type){var t=e.subform.id;p.push(store.findRecord("module",t))}})),d.subform=Lyte.resolvePromises(p),r.record?d.record=app.store.makeRequest("findRecord",moduleRecordMapping[t].id,r.record.id,{approved:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}):r.record={},new Promise((function(e){d.then((function(t){r.components=t.components.components,r.relatedlist=t.relatedlist,r.currentLayout=t.currentLayout,e(r)}))}))},saveCanvasViewFromGallery:function(e,t,o,r){var a=this;this.setData("isSaving",!0),this.saveTemplateCanvas(e,o,t).then(function(e){var t=e&&e.canvasview&&e.canvasview.id;if(r&&r.redirection){var o=r.redirection.params;o.push(t);var i=r.redirection.queryparams;Lyte.Router.transitionTo({route:r.redirection.route,dynamicParams:o,queryParams:i}).data={refreshTemplate:!0}}else Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[a.getData("module"),a.getData("entityId"),t]}).openassignment=!0;if(a.setData("showcanvassavemodal",!1),r&&r.closeVariable)a.setData(r.closeVariable,!1);else{var n=this.getData("selectedTemplate")||"orgview";if(a.closeGallery(),this.setData("isSaving",!1),n){var c=a.getData("module");Crm.client_tracking("Canvas Gallery Save completed",{template:n,Type:"Gallery",Place:"Builder_Page"}),Crm.client_tracking("CanvasEditorActions - Save",{Module:c,template:n,Type:"Gallery",Place:"Record Detail Page"})}}}.bind(this)).catch(function(e){this.setData("isSaving",!1);var t=e.response;if(!t)throw new Error(e);switch("string"==typeof t&&(t=(t=JSON.parse(t)).canvas_view&&t.canvas_view[0]?t.canvas_view[0]:t),t.code){case"DUPLICATE_DATA":_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.duplicate","Canvas"),ltPropType:"error"}});break;case"LIMIT_EXCEEDED":_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.limit.exceeded","Canvas"),ltPropType:"error"}});break;case"INVALID_REQUEST":_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.module.invalid"),ltPropType:"error"}});break;case"NOT_ALLOWED":_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.cf.error.authorization"),ltPropType:"error"}});break;case"INCOMPATIBLE_DATA":this.showErrorCompoent(t),crmui.showMsgBand("error",I18n.getMsg("crm.components.alignment.error"),3e3);break;case"INVALID_ID":var o=[];t.details.canvas_rules.filter((function(e){o.push(store.peekRecord("canvas_rule",e).name)})),o=o.join("<br/>"),renderingUtils.showCustomAlert(o,I18n.getMsg("crm.canvas.rule.deleted"),!0)}}.bind(this))},saveTemplateCanvas:function(e,t,o){return new Promise(function(r){var a=this.getRecordJSONTemplate(e,t,o);r(this.createNewCanvasView(a))}.bind(this))},getRecordJSONTemplate:function(e,t,o){var r=o||this.getData("current_view");r=jsonCreation.compress(r,["id","datatype","type","ui","theme","name","tab_relatedlist_id","subform_id","section_id","personality_name","related_list","custom_field","api_name"]);var a=this.getData("module"),i={id:moduleRecordMapping[a].id,api_name:moduleRecordMapping[a].api_name},n=this.getData("layoutId"),c=r.children;if(c.length>0){var s={name:e,ui:r.ui,width:parseInt(r.ui.value.position.width),row_size:parseInt(r.ui.value.position.height),view_type:this.getData("viewType"),feature:this.getData("featureName"),components:c,module:i,layout:{id:n},auto_save:!1,action:"save"};return s.ui&&s.ui.theme&&delete s.ui.theme,s}return null},createNewCanvasView:function(e){var t=store.createRecord("canvasview");return t.$.set(e),t.$.set("action","save"),t.$.save()}});

