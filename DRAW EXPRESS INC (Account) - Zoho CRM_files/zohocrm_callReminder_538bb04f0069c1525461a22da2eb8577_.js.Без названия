!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).ctiapi_reminder_businesscard=e({1:function(e,i,t,a,r){return' <div class="br_top_border4 p20 profileCont"> '},3:function(e,i,t,a,r){var n;return' <div class="p15 pT20 pB20 bussinesCardCtn '+(null!=(n=t.if.call(null!=i?i:{},null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(4,r,0),inverse:e.noop,data:r}))?n:"")+'" > '},4:function(e,i,t,a,r){return" zchat-zcmsg_bx zchat-zcmsg_bx10"},6:function(e,i,t,a,r){return" <div> "},8:function(e,i,t,a,r){return' <div class="fL"> '},10:function(e,i,t,a,r){var n;return" "+(null!=(n=t.isNotEmpty.call(null!=i?i:{},null!=i?i.extradetails:i,{name:"isNotEmpty",hash:{},fn:e.program(11,r,0),inverse:e.noop,data:r}))?n:"")+" "},11:function(e,i,t,a,r){return" "+e.escapeExpression(t.ctiapi_businesscard_entityextradetails_forchat.call(null!=i?i:{},null!=i?i.entitymodule:i,null!=i?i.extraid:i,null!=i?i.extramodule:i,null!=i?i.extradetails:i,{name:"ctiapi_businesscard_entityextradetails_forchat",hash:{},data:r}))+" "},13:function(e,i,t,a,r){return' <div class="cBoth"></div> </div> '},15:function(e,i,t,a,r){var n;return' <div> <a href="javascript;;" class="color_79"> '+(null!=(n=t.isNotEmpty.call(null!=i?i:{},null!=i?i.extradetails:i,{name:"isNotEmpty",hash:{},fn:e.program(16,r,0),inverse:e.noop,data:r}))?n:"")+" </a> </div> "},16:function(e,i,t,a,r){return" "+e.escapeExpression(t.ctiapi_businesscard_entityextradetails.call(null!=i?i:{},null!=i?i.entitymodule:i,null!=i?i.extraid:i,null!=i?i.extramodule:i,null!=i?i.extradetails:i,{name:"ctiapi_businesscard_entityextradetails",hash:{},data:r}))+" "},18:function(e,i,t,a,r){return" </div> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,a,r){var n,s=null!=i?i:{},l=e.escapeExpression,d=e.lambda;return" "+(null!=(n=t.if.call(s,null!=i?i.lower_reminder:i,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r}))?n:"")+" "+(null!=(n=t.if.call(s,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(6,r,0),inverse:e.noop,data:r}))?n:"")+" "+l(t.ctiapi_businesscard_entityimage.call(s,null!=i?i.entitymodule:i,null!=i?i.entityid:i,null!=i?i.photofileid:i,null!=i?i.isForChat:i,{name:"ctiapi_businesscard_entityimage",hash:{},data:r}))+" "+(null!=(n=t.unless.call(s,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(8,r,0),inverse:e.noop,data:r}))?n:"")+' <div class="fL zchat-btncnt"> <a href="javascript:void(0);" class="crm-heading-font-size crmBaseColor ellipsistext dB w250" id="ctiapi_businesscard_entityname" onclick="CTIAPI.openUrl(\''+l(d(null!=i?i.entityid:i,i))+"','"+l(d(null!=i?i.entitymodule:i,i))+"','','','','_blank');\" title=\""+l(t.encodeForHtmlWithoutNull.call(s,null!=i?i.entityname:i,{name:"encodeForHtmlWithoutNull",hash:{},data:r}))+'"> '+l(t.encodeForHtmlWithoutNull.call(s,null!=i?i.entityname:i,{name:"encodeForHtmlWithoutNull",hash:{},data:r}))+" </a> "+(null!=(n=t.if.call(s,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(10,r,0),inverse:e.noop,data:r}))?n:"")+" </div> "+(null!=(n=t.if.call(s,null!=i?i.isForChat:i,{name:"if",hash:{},fn:e.program(13,r,0),inverse:e.noop,data:r}))?n:"")+" "+(null!=(n=t.unless.call(s,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(15,r,0),inverse:e.noop,data:r}))?n:"")+" "+l(t.ctiapi_businesscard_create.call(s,i,{name:"ctiapi_businesscard_create",hash:{},data:r}))+" "+(null!=(n=t.unless.call(s,null!=i?i.isForChat:i,{name:"unless",hash:{},fn:e.program(18,r,0),inverse:e.noop,data:r}))?n:"")+' <br class="cBoth"> </div>'},useData:!0})}();var CallReminder={cti_obj:{},get:CTIAPI.get,put:CTIAPI.put,remove:CTIAPI.remove,has:CTIAPI.has,keys:CTIAPI.keys,set obj(e){for(var i in e)this.put(i,e[i])},handleCustomMessage:function(e){var i=e;if("laterReminder"===i.action){if(!0!==CallReminder.get("laterBtClickThisWindow")){var t=i.activityid,a=ctiapiRem_dataparam["dataparam_"+t];void 0!==a&&appendReminder(a,$("#later_"+t),!0)}CallReminder.put("laterBtClickThisWindow",!1)}else if("cancelReminder"===i.action){t=i.activityid;closeReminder($("#endcall_"+t)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):updateReminderHead()}},later:function(e,i){if(i){CallReminder.put("laterBtClickThisWindow",!0);var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"laterReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},call:function(e){if(void 0!==ctiapiRem_dataparam["dataparam_"+e]){var i=ctiapiRem_dataparam["dataparam_"+e].call_description;i=validationUtils.isNotEmpty(i)?i:"",$("#ctiapi_calldesc").val(i),CTIAPI.LocalStorage.put("call_desc",i),removeReminder(e),closeReminder($("#later_"+e)),closeMultipleReminderBussinesscardView(),$(".reminderslist div[ctiapi-data-params=dataparam_"+e+"]").remove()}},cancel:function(e,i){if(i){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"cancelReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},getEntityImgSrc:function(e){var i=e.entitymodule,t=e.entityid,a=e.photofileid,r=networkUtils.getImageUrl("user.jpg",ResourceConstants.CRM);return i!==moduleRecordMapping.Accounts.plural_label&&validationUtils.isNotEmpty(a)&&(r=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+i+"&entityId="+t+"&actionName=readImage&fileId="+a),r},ctiapi_showReminderClick2CallPhnos:function(e,i,t){var a=validationUtils.isNotEmpty(t)?$("#"+t):$(e).closest("#businessView"),r=a.height(),n=a.offset().top,s=renderingUtils.windowHeight,l=$(a).find("#entityPhnoDiv_"+i),d=l.innerHeight();if(l.toggle(),s>r+n+d)a.hasClass("bot150")?l.css("top",r+2*$(e).height()-59):l.css("top",r+2*$(e).height()-9);else if(validationUtils.isNotEmpty(t))l.css("top",r-2*$(e).height()-d+2);else{$(e).closest("#ctireminder").length>0?l.css("top",r-d-$(e).innerHeight()/2+10):l.css("top",r-d+8)}},scrollReminderBody:function(){var e=$("#ctiapi_multireminder_bussinessview_arrow"),i=$(".reminderusers.selectedReminderUser");if(i.length>0){var t=e.attr("selectedreminderoldposition");t=NaN!==parseInt(t)?parseInt(t):0;var a=i.position().top;t-34<=a&&a<=t+34||i.click()}},deleteReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1),reminderDatatemp.reminders.deleteRemindersList.push(i),ctiapiSche.deleteReminderId(e)},getSelectedReminder:function(e){var i=$(e),t=i.position().top,a=$("#ctiapi_multireminder_bussinessview"),r=$L(".remindercallList.reminderslist");if(t<0){var n=r.scrollTop()+t;r.scrollTop(n),t=0}else if(t>270){var s=335-t,l=i.innerHeight()-s;n=r.scrollTop()+l;r.scrollTop(n),t=270}if(t<=68?$(".remindercallList").find(".reminderusers").length<=3?a.removeClass("bot150"):a.addClass("bot150"):t>68&&t<126?a.addClass("bot150"):a.removeClass("bot150"),i.hasClass("chooseOwnerHov"))closeMultipleReminderBussinesscardView();else{var d=ctiapiRem_dataparam[i.attr("ctiapi-data-params")],o=d.zgid,c=d.userid,m=d.phone,p=d.entityid,u=d.entitymodule,h=d.recordEntityName,v=d.reminderClick2CallPhoneNos,g=d.reminderPhno;d.lower_reminder=!0;var f=d.callactivityid+"",b=getremindertime([f]),R=validationUtils.isNotEmpty(setMoreLater(b,!1))?setMoreLater(b,!1):setMoreLater(0,!1),y=validationUtils.isNotEmpty(setMoreLater(b,!0))?setMoreLater(b,!0):setMoreLater(0,!0),C=b<-6e4?"color:var(--negativeColor)":"color:#66bb33",I="";for(var _ in $("#tof_"+f).html(R).attr("title",y).css(C),$(".reminderTime_Msg_"+f).html(y).css(C),Crm.userDetails.RTL_ENABLED?I+='<div style="left : -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>':I+='<div style="right: -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>',I+='<div class="crm-heading-font-size p10 pL15 pR15 reminderTime_Msg_'+f+'" style="'+C+'">'+y+"</div>",I+=Handlebars.templates.ctiapi_reminder_businesscard(d),I+='<div class="newPopup zi100" id="entityPhnoDiv_'+f+'" style="display: none;margin-left: 10px" onclick="sE(event);">',I+='<div class="pR">',I+='<div class="multipleNos">',I+='<table cellpadding="5" cellspacing="0" border="0"><tbody>',v){var w=v[_];validationUtils.isNotEmpty(w)&&(I+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='pointer' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(w)+"','"+o+"','"+c+"','"+p+"','"+f+"','"+u+"','"+$ESAPI.encoder().encodeForJavaScript(h)+"');closeReminder(this);\">",I+='<td class="crmLabelColor pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(_))+" </td>",I+='<td class="crmBaseColor pR20">'+CTIAPI.encodeForHTMLWithoutNull(w)+"</td>",I+="</tr>")}I+="</tbody></table>",I+="</div>",I+="</div>",I+="</div>",I+='<div class="br_top_border4 p15 oH">',!0===CallReminder.get("outgoingEnable")&&parseInt(d.timeOfReminder)<=6e4&&(g.length<=1?(I+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+f+'" style="height:auto" >',I+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(m)+"','"+o+"','"+c+"','"+p+"','"+f+"','"+u+"','"+$ESAPI.encoder().encodeForJavaScript(h)+"');\" >"+I18n.getMsg("Call")+"</span> ",I+="</a>"):(I+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+f+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+f+"','ctiapi_multireminder_bussinessview');sE(event);\">",I+='<span class="fL">'+I18n.getMsg("Call")+"</span> ",I+='<i class="whtdownArw fL"></i>',I+="</a>")),I+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal" id="endcall" onclick="closeMultipleReminderBussinesscardView();">'+I18n.getMsg("crm.button.mass.hide")+"</span>",I+='<span class="actSelArw" data-zcqa="callMoreOption" tabindex="0" id="arrow_'+f+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+c+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>',I+="</div>";var M=$(".remindercallList").innerHeight()-t,L=i.innerHeight()/2;a.html(I).show(),crmui.modalZIndex("nonLyte",a[0],"open","noFreeze"),$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),i.addClass("chooseOwnerHov selectedReminderUser"),a.hasClass("bot150")?$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",M+L-201).attr("selectedreminderoldposition",t).show():$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",M+L-75).attr("selectedreminderoldposition",t).show()}}};Object.freeze(CallReminder);var ctiapiRem_dataparam={getTime:function(e){if(void 0!==e&&""!==e){var i=this["dataparam_"+e];return parseInt(i.timeOfReminder)+parseInt(i.date)}}},reminderDatatemp={reminders:{availableReminders:0,noOfReminders:0,timesOfReminders:[],deleteRemindersList:[],deletedRemindersIDList:[],reminderIdNameMap:{}},removeReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&void 0!==i&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1,reminderDatatemp.reminders.deletedRemindersIDList.push(e+""),reminderDatatemp.reminders.deleteRemindersList.push(i),delete reminderDatatemp.reminders.reminderIdNameMap[e],ctiapiSche.deleteReminderId(e)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):$("#reminderbody").is(":hidden")||$("#ICPOP1 #reminderTitle").click(),updateReminderHead()}},ctiapiSche={reminderIds:{},timeInterval:6e4,serverTimeInterval:9e5,clientScheId:null,serverScheId:null,clientScheLastRunTime:null,serverScheLastRunTime:null,clientScheStartTime:null,serverScheStartTime:null,scheStartDelaySec:0,start:function(e){var i=new Date;if(this.scheStartDelaySec=60-i.getSeconds(),this.scheStartDelaySec<2||this.scheStartDelaySec>58)null===this.clientScheId&&Object.keys(this.reminderIds).length>0?((e=e||updateRemindersTime)(),this.clientScheId=setInterval(e,this.timeInterval),this.clientScheStartTime=i,this.serverScheId=setInterval((function(){updateRemindersTimesFromServer(Object.keys(ctiapiSche.reminderIds))}),this.serverTimeInterval),this.serverScheStartTime=i,this.scheStartDelaySec=0):this.stop()&&Object.keys(this.reminderIds).length>0&&this.start();else{var t=this.scheStartDelaySec||0;setTimeout((function(){ctiapiSche.start(e)}),1e3*t)}},stop:function(){return null!==this.clientScheId&&(clearInterval(this.clientScheId),clearInterval(this.serverScheId),this.serverScheId=null,this.clientScheId=null,!0)},deleteReminderId:function(e){delete this.reminderIds[e+""],0===Object.keys(this.reminderIds).length&&this.stop()},appendReminderId:function(e){this.reminderIds[e+""]=e+"",null===this.clientScheId&&this.start(updateRemindersTime)},log:function(){var e={client:this.clientScheId,server:this.serverScheId},i={client:this.clientScheStartTime+"",server:this.serverScheStartTime+""},t={client:this.clientScheLastRunTime+"",server:this.serverScheLastRunTime+""},a="reminderIds : "+Object.keys(this.reminderIds)+" \n scheStartDelaySec : "+this.scheStartDelaySec+" \n ";return a+="scheId : "+JSON.stringify(e)+"\n ",a+="startTime : "+JSON.stringify(i)+"\n ",a+="lastRunTime : "+JSON.stringify(t)}};function closeMultipleReminderBussinesscardView(){$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),$("#ctiapi_multireminder_bussinessview_arrow").hide(),$("#ctiapi_multireminder_bussinessview").hide(),crmui.modalZIndex("nonLyte",$L("#ctiapi_multireminder_bussinessview")[0],"close")}function createReminder1(e,i){var t="",a="",r=e,n=r.zgid,s=r.userid,l=r.entityid,d=r.entitymodule,o=r.recordEntityName,c=r.callactivityid+"",m=r.reminderClick2CallPhoneNos;CallReminder.put("outgoingEnable",r.outgoingenabled);var p=new Array;if(r.toNumberOfCall)p.push(r.toNumberOfCall);else for(var u in m){var h=m[u];validationUtils.isNotEmpty(h)&&p.push(h)}r.reminderPhno=p,ctiapiRem_dataparam["dataparam_"+c]=r,ctiapiSche.appendReminderId(c);var v=getremindertime(c),g=v<-6e4?"color:var(--negativeColor)":"color:#66bb33",f=validationUtils.isNotEmpty(setMoreLater(v,!0))?setMoreLater(v,!0):setMoreLater(0,!0);i?(t+='<div class="singlereminder " id="ICPOP2" style=" position:absolute;margin:0 auto;z-index:25;top:24%;left:42%">',a+='<div class="chatPopTitle oH cDefault"> ',a+='<table cellspacing="0" cellpadding="0" border="0" width="100%" class="pT10 pB10" style="height:auto">',a+="<tr>",a+='<td class="aligncenter crm-heading-font-size">',a+='<span class="reminderTime_Msg_'+c+'" style="'+g+'">'+f+"</span>",a+="</td>",a+="</tr>",a+="</table>",t+=a+="</div>",t+='<div id="businessView" class="chatContainer">',r.lower_reminder=!1):(t+='<div id="ICPOP2" style="z-index:25;width:370px;">',t+='<div class="chatPopTitle oH" onclick="toggleSingleReminder(\''+c+"')\">",t+='<div class="pT10 pB10 oH">',t+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL crm-base-font-size">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify crm-small-font-size mL5">1</span></span>',t+="</div>",t+="</div>",t+='<div id="businessView" class="chatContainer">',t+='<div class="crm-heading-font-size p10 pL15 pR15 reminderTime_Msg_'+c+'" style="'+g+'">'+f+"</div>",r.lower_reminder=!0),t+=Handlebars.templates.ctiapi_reminder_businesscard(r);c=r.callactivityid+"";t+='<div class="br_top_border4 p15"><div class="dIB w100_per">';e.protocolDetails&&e.protocolDetails.ctiprotocolvalue;for(var u in!0===CallReminder.get("outgoingEnable")&&parseInt(r.timeOfReminder)<=6e4&&p.length>0?(1===p.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" >',t+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(p[0])+"','"+n+"','"+s+"','"+l+"','"+c+"','"+d+"','"+$ESAPI.encoder().encodeForJavaScript(o)+"');closeReminder(this);\" >"+I18n.getMsg("Call")+"</span> ",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+c+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+c+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+c+",this,"+i+");CallReminder.later('"+c+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose mT2"><span class="actVal p5" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw" data-zcqa="callMoreOption" id="endcall_'+c+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>'):window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()?(1===p.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" >',t+="<span class='fL' onclick='crmCallsNew.initiateCallViaZPB(\""+p[0]+'","'+l+'","'+d+'","'+$ESAPI.encoder().encodeForJavaScript(o)+'","'+c+"\");closeReminder(this);' >"+I18n.getMsg("Call")+"</span>",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+c+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+c+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+c+",this,"+i+");CallReminder.later('"+c+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal newgraybtn mL5 btnTransfer norBtn" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\"style=\"margin: -1px !important;\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw customImportBtn" data-zcqa="callMoreOption" id="endcall_'+c+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+'\');sE1(event);"style="padding: 6px 14px 15px 12px !important;margin: -8px !important;"><span class="dIB actArwNew"></span></span></span>'):(t+="</a><span  id='later_"+c+"' hide='false' data-zcqa='callMoreOption' class='fL mL5 remselVal oH ellipsistext blueNewBtn btnTransfer primarybtn' onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+"');sE1(event);\"><span class='remval'>"+I18n.getMsg("crm.label.mark.completed")+"</span>  <span class='remSelArw'> <span class='dIB remArwNew'></span>  </span>     </span>",t+='<input type="button" value='+I18n.getMsg("crm.button.close")+' class="newgraybtn mL5 cP fR norBtn" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\">"),t+='<input type="hidden" id="singleReminderId" value="'+c+'"/>',t+="</div></div>",t+='<div class="newPopup zi100" id="entityPhnoDiv_'+c+'" style="display: none;margin-left: 10px" onclick="sE(event);">',t+='<div class="pR">',t+='<div class="multipleNos">',t+='<table cellpadding="5" cellspacing="0" border="0">',m){h=m[u];validationUtils.isNotEmpty(h)&&(!0===CallReminder.get("outgoingEnable")?t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='cP' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(h)+"','"+n+"','"+s+"','"+l+"','"+c+"','"+d+"','"+$ESAPI.encoder().encodeForJavaScript(o)+"');closeReminder(this);\">":window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()&&(t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='cP' onclick='crmCallsNew.initiateCallViaZPB(\""+h+'","'+l+'","'+d+'","'+$ESAPI.encoder().encodeForJavaScript(o)+'","'+c+"\");closeReminder(this);'>"),t+='<td class="crmLabelColor pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(u))+" </td>",t+='<td class="crmBaseColor pR20">'+CTIAPI.encodeForHTMLWithoutNull(h)+"</td>",t+="</tr>")}if(t+="</table>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="<div>",t+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -325px; top: -90px; display: block;"></div>',i){var b=$("body");b.append(t),1===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").remove(),b.append('<div class="ctiapiFreezeLayer ctiapiReminderFreezeLayer"></div>'),$("#ctireminder").addClass("noboxShadow"),$(".lookFieldSrcWrap").hide(),Crm.menu.globalHideMenu()),callRemCenter("singlereminder");var R=$L(".singlereminder");R.length>0&&crmui.modalZIndex("nonLyte",R[R.length-1],"open")}else{$("#ctireminder").html(t).show(),toggleSingleReminder(c);var y=$L("#ctireminder");y.length>0&&crmui.modalZIndex("nonLyte",$L(y[y.length-1])[0],"open","noFreeze"),closeReminder($(".singlereminder #later_"+c).get(0))}$L(window).scrollTop("ICPOP2"),multiReminderShowHide(),$L("#ICPOP2").trapFocus({preventDefault:!0})}function callRemCenter(e){var i=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollLeft||document.body.scrollLeft,a=renderingUtils.windowHeight,r=$("."+e),n=r.height(),s=r.width(),l=r.length,d=$("#setWidthForCallRemDesc"),o=d.width();if(a>n)$(r[l-1]).css({display:"block",position:"absolute",left:"50%",top:"50%","margin-left":-s/2+t,"margin-top":-n/2+i});else{var c=i+10;$(r[l-1]).css({display:"block",position:"absolute",left:"50%",top:c,"margin-left":-s/2+t,"margin-top":"0px"})}o<s&&d.css({width:s/2+40})}function multiReminderShowHide(){var e=$(".singlereminder");e.hide(),$(e[e.length-1]).show(),$(".totalsinglereminder").html(" ("+e.length+")")}function removeReminder(e){reminderDatatemp.removeReminder(e)}function closeReminder(e){var i=null;e?0===(i=$(e).closest(".singlereminder")).length&&(i=$(e).closest("#ICPOP2")):i=$("#ICPOP2"),i.slideUp(100,(function(){multiReminderShowHide();var e=$L(".singlereminder");e.length>0&&crmui.modalZIndex("nonLyte",e[e.length-1],"open")})),i.length>0&&crmui.modalZIndex("nonLyte",i[0],"close"),i.remove(),0===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").hide(),$("#ctireminder").removeClass("noboxShadow"))}function appendReminder(e,i,t){var a=e,r=reminderDatatemp.reminders.noOfReminders,n=reminderDatatemp.reminders;if(t&&void 0===n.reminderIdNameMap[a.callactivityid+""]&&-1===n.deletedRemindersIDList.indexOf(a.callactivityid+"")){r=reminderDatatemp.reminders.noOfReminders=r+1,reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders+1;var s={remindername:"reminder"+r,time:a.timeOfReminder};reminderDatatemp.reminders.timesOfReminders.push(s),reminderDatatemp.reminders.reminderIdNameMap[a.callactivityid+""]="reminder"+r,reminderDatatemp.reminders["reminder"+r]=a}1===reminderDatatemp.reminders.availableReminders?createReminder1(a,!1):(createReminder(reminderDatatemp),closeReminder(i))}function createReminder(e){var i="";i+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -305px; top: -90px; display: block;"></div>',i+='<div id="ICPOP1" class="content" style="width:370px;">',i+=getReminderHead(e),i+=getReminderBody(e),i+="<div>",$("#ctireminder").html(i);var t=$(".reminderusers").length,a=t>1?" ("+t+")":"";$("#reminderTitleSpan").html(I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminder",a)),toggleReminder(!0),toggleSingleReminder("","false")}function getReminderHead(e){var i="",t=e.reminders.availableReminders>1?e.reminders.availableReminders:"1";return i+='<div class="chatPopTitle oH" onclick="toggleReminder();">',i+='<div class="pT10 pB10 oH">',i+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL crm-base-font-size">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify crm-small-font-size mL5" id="reminder_count">'+t+"</span></span>",i+="</div>",i+="</div>"}function updateReminderHead(){var e=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"";$("#reminder_count").html(e)}function toggleSingleReminder(e,i){var t=$("#later_"+e),a=i||t.attr("hide"),r=$("#reminderbody").css("display");if("false"===a)$("#ctireminder #businessView").slideUp().hide(1e3),t.attr("hide","true");else if("true"===a){$("#ctireminder #businessView").slideDown(),t.attr("hide","false");var n=new Array;n.push($("#singleReminderId").val());var s=getremindertimes(n);if(typeof s!=={}){var l=s[n[0]],d=validationUtils.isNotEmpty(setMoreLater(l,!0))?setMoreLater(l,!0):setMoreLater(0,!0),o=getremindertime(n[0])<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"};$("#reminderTimeSpan_"+n[0]).html(d).attr("time",l),$(".reminderTime_Msg_"+n[0]).html(d).css(o);var c=ctiapiRem_dataparam["dataparam_"+n[0]],m=$("#twistatusimg");if(((void 0===m||m.is(":hidden"))&&!0===c.outgoingenabled||void 0!==m&&"1"===m.attr("statusvalue"))&&parseInt(l)<=6e4){var p=c.zgid+"",u=c.userid+"",h=c.phone+"",v=c.callactivityid+"",g=c.entityid+"",f=c.entitymodule,b=c.reminderPhno,R=c.recordEntityName,y='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";b.length<=1?y='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(h)+'","'+p+'","'+u+'","'+g+'","'+v+'","'+f+'","'+$ESAPI.encoder().encodeForJavaScript(R)+"\");' >"+I18n.getMsg("Call")+"</span> ":(y='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",y+='<i class="whtdownArw fL"></i>');var C=".singleReminderCallBt_"+n[0];$(C).html(y),$(C).parent().find(".btnTransfer").addClass("ctireminderBtnTransfer")}}}else toggleSingleReminder("","none"===r?"true":"false")}function toggleReminder(e){!0===e?$("#reminderbody").slideUp().hide(1e3):!1===e?updateMultipleReminderTimes():"none"===$("#reminderbody").css("display")?toggleReminder(!1):toggleReminder(!0),closeMultipleReminderBussinesscardView()}function updateMultipleReminderTimes(){var e=new Array;$(".reminderusers").each((function(){var i=ctiapiRem_dataparam[$(this).attr("ctiapi-data-params")];-1===e.indexOf(i.callactivityid)&&e.push(i.callactivityid)}));var i=getremindertimes(e);if(i!=={}){for(var t=reminderDatatemp.reminders.timesOfReminders,a=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"",r=e.length,n=0;n<r;n++){var s=e[n],l=i[s],d=validationUtils.isNotEmpty(setMoreLater(l,!1))?setMoreLater(l,!1):setMoreLater(0,!1),o=validationUtils.isNotEmpty(setMoreLater(l,!0))?setMoreLater(l,!0):setMoreLater(0,!0),c=l<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"},m=reminderDatatemp.reminders.reminderIdNameMap[s+""];$("#tof_"+s).html(d).attr("title",o).css(c);for(var p=t.length,u=0;u<p;u++)if(t[u].remindername===m){t[u].time=l;break}}var h=getReminderBody(reminderDatatemp),v=$("#reminderbody");$("#reminder_count").html(a),v.addClass("oldreminderslist").attr("id","oldreminderbody").after(h).remove(),v.hide().slideDown(500)}}function updateRemindersTimesFromServer(e){var i=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={mode:"getremindertimes",isAjax:!0,activityids:e+""};networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({type:"POST",url:i,data:t,success:function(i){if("object"==typeof i){for(var t=e.length,a=0;a<t;a++){var r=e[a],n=i[r],s=(new Date).getTime();if(void 0!==r){var l=ctiapiRem_dataparam["dataparam_"+r];l.date=s,l.timeOfReminder=n}}updateRemindersTime(),ctiapiSche.serverScheLastRunTime=new Date}}})}function getremindertime(e){return getremindertimes([e])[e]}function getremindertimes(e){for(var i={},t=(new Date).getTime(),a=e.length,r=0;r<a;r++){var n=e[r],s=ctiapiRem_dataparam.getTime(n)-t;i[n]=s}return i}function showHideSelectedReminder(e){var i=getremindertime(e);parseInt(i)<=6e4?$(".selectedReminder.reminderCallBt").show():$(".selectedReminder.reminderCallBt").hide()}function updateRemindersTime(){var e=!1;for(var i in ctiapiSche.reminderIds){var t=ctiapiRem_dataparam["dataparam_"+i],a=t.callactivityid+"",r=getremindertime(a),n=validationUtils.isNotEmpty(setMoreLater(r,!1))?setMoreLater(r,!1):setMoreLater(0,!1),s=validationUtils.isNotEmpty(setMoreLater(r,!0))?setMoreLater(r,!0):setMoreLater(0,!0),l=getremindertime(a)<-6e4?{color:"var(--negativeColor)"}:{color:"#66bb33"};$(".reminderTimeBig_"+i).html('<span id="reminderTimeSpan_'+a+'">'+s+'</span>  <label href="javascript:void(0);" class="dB crmNegativeColor crm-medium-large-font-size ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+'">"'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+"</label>"),$(".reminderTime_Msg_"+a).html(s).css(l),$("#tof_"+a).html(n).attr("title",s).css(l);var d=$("#twistatusimg");if(((void 0===d||d.is(":hidden"))&&!0===t.outgoingenabled||void 0!==d&&"1"===d.attr("statusvalue"))&&parseInt(r)<=6e4){var o=t.zgid+"",c=t.userid+"",m=t.phone+"",p=a,u=t.entityid+"",h=t.entitymodule,v=t.reminderPhno,g=t.recordEntityName,f='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";v.length<=1?f='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(m)+'","'+o+'","'+c+'","'+u+'","'+p+'","'+h+'","'+$ESAPI.encoder().encodeForJavaScript(g)+"\");' >"+I18n.getMsg("Call")+"</span> ":(f='<span class="fL">'+I18n.getMsg("Call")+"</span> ",f+='<i class="whtdownArw fL"></i>'),$(".singleReminderCallBt_"+a).html(f),e=!0}}if(e){$(".reminderCallBt").show();var b=$(".reminderusers.sel");if(void 0!==b&&b.length>0)showHideSelectedReminder(b.attr("ctiapi-data-params").split("dataparam_")[1]+"")}else $(".reminderCallBt").hide();ctiapiSche.clientScheLastRunTime=new Date}function getReminderBody(e){var i=new Array,t=e.reminders,a=t.timesOfReminders.sort((function(e,i){return e.time-i.time})),r="";r+='<div class="chatContainer pR" id="reminderbody">',r+='<div id="businessView">',r+='<div class="remindercallList reminderslist" onscroll="CallReminder.scrollReminderBody()">';for(var n=0,s=0;n<t.noOfReminders;n++,s++){var l=a[n].remindername,d=a[n].time,o=t[l],c=o.callactivityid+"",m=d<-6e4?"color:var(--negativeColor)":"color:#66bb33";if(-1===reminderDatatemp.reminders.deleteRemindersList.indexOf(l)&&-1===i.indexOf(c)){var p=setMoreLater(d,!0);i.push(c),r+='<div id="ICPOP2" class="chooseOwner reminderusers" ctiapi-data-params="dataparam_'+c+'" orderno="'+s+'" onclick="CallReminder.getSelectedReminder(this);">',r+='<div class="">',r+='<img src="'+CallReminder.getEntityImgSrc(o)+'" width="40" class="fL mR10">',r+='<input type="hidden" id="endcall_'+c+'">',r+='<span class="fL w220 oH">',r+='<label class="dB crm-small-font-size crm-font-bold crmBaseColor cP ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(o.entityname)+'">',r+=CTIAPI.encodeForHTMLWithoutNull(o.entityname),r+="</label>",r+='<a href="javascript:void(0);" class="ellipsistext crm-small-font-size crmNotFoundColor w220 oH dIB" title="'+(validationUtils.isNotEmpty(o.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(o.entityemailid):"")+'">',r+=validationUtils.isNotEmpty(o.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(o.entityemailid):"",r+="</a>",r+="</span> ",r+='<span class="fR w70 ellipsistext alignRight" id="tof_'+c+'" title="'+p+'" style="'+m+'">',r+=setMoreLater(d,!1),r+="</span>",r+="</div>",r+="</div>"}else s--}return r+="</div>",r+="</div>",r+="</div>"}function setMoreLater(e,i){return setDaysHoursMins(e,i)}function setDaysHoursMins(e,i){var t=Utils.getMillisecondsToBasicDateProperties(e),a=i?".detailedtext":"",r=t.days,n=t.hours,s=t.mins;if(!(parseInt(e)>0&&parseInt(e)<1e3||parseInt(e)<0&&parseInt(e)>-1e3))if(Math.abs(r)>0)if(n%=24,Math.abs(n)>0){var l=(Math.abs(n)+"").length>1?Math.abs(n)+"":"0"+Math.abs(n);if(r>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshoursmore"+a,[r+"",l]);if(r<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshourslate"+a,[Math.abs(r)+"",l])}else{if(r>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.daysmore"+a,r+"");if(r<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayslate"+a,Math.abs(r)+"")}else if(Math.abs(n)>0)if(Math.abs(s)>0){var d=(Math.abs(s)+"").length>1?Math.abs(s)+"":"0"+Math.abs(s);if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminutesmore"+a,[n+"",d]);if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminuteslate"+a,[Math.abs(n)+"",d])}else{if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourssmore"+a,n+"");if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourslate"+a,Math.abs(n)+"")}else if(Math.abs(s)>0){if(0===s)return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall");if(s>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minutesmore"+a,s+"");if(s<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minuteslate"+a,Math.abs(s)+"")}return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall")}