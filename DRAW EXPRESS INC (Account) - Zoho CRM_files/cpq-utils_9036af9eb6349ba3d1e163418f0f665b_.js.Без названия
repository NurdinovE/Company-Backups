Lyte.Mixin.register("crm-cpq-utils",{cpqSubModules:{Orders:[],Rules:[{module_name:"productConfigurator",plural_label:"Product configurator"},{module_name:"priceRules",plural_label:"cpq.pr.featurename"},{module_name:"guidedselling",plural_label:"Guided Selling"}]},cpqTabSelectionData:{cpqTab:""},isValidMobilePhoneFax:function(e){return new RegExp("^[+]*[a-zA-Z0-9]+[-]*[a-zA-Z0-9]+[-]*[a-zA-Z0-9]+[-]*$").test(e)},getModuleNameByAPIName:function(e){return Object.keys(moduleRecordMapping).find((r=>moduleRecordMapping[r].api_name===e))},fetchFieldsListFromLayoutResp:function(e,r){var i=[];return e.layouts.forEach((function(e){e.sections.forEach((function(e){if(!e.isSubformSection||!0!==e.isSubformSection||r&&!1===r){var o=e.fields;i=i.concat(o)}}))})),i},filterSubformFieldsForAction:function(e,r){for(var i=[],o=e.length,t=0;t<o;t++)if((!r||r.includes(e[t].ui_type))&&!e[t].column_name.includes("SERIAL_NUMBER")){if(2===e[t].ui_type&&(e[t].cxPropType="single"),32===e[t].ui_type&&(e[t].decimal_place=0),this.data.dynamicActionUITypes.includes(e[t].ui_type)&&(e[t].cxPropDynamicFieldValue=!0),e[t].crypt&&null!==e[t].crypt)continue;i.push(e[t])}return i},getPriceRulesActionTypeForUI:function(e){var r;switch(e){case"direct":r="Direct";break;case"volume":r="Volume"}return r},getLabelForCPQModules:function(e,r){var i=!0;return(void 0===moduleRecordMapping||"Quotes"===e&&void 0===moduleRecordMapping.Quotes||"QuotedItems"===e&&void 0===moduleRecordMapping.QuotedItems||"Products"===e&&void 0===moduleRecordMapping.Products||"PriceBooks"===e&&void 0===moduleRecordMapping.PriceBooks||"SalesOrders"===e&&void 0===moduleRecordMapping.SalesOrders||"PurchaseOrders"===e&&void 0===moduleRecordMapping.PurchaseOrders||"Invoices"===e&&void 0===moduleRecordMapping.Invoices)&&(i=!1),1===r?this.getSingularLabelForCPQModulesBasedOnDataAvailability(e,i):2===r?this.getPluralLabelForCPQModulesBasedOnDataAvailability(e,i):void 0},getSingularLabelForCPQModulesBasedOnDataAvailability:function(e,r){return!0===r?moduleRecordMapping[e].singular_label:"Quotes"===e?I18n.getMsg("Quote"):"QuotedItems"===e?I18n.getMsg("Quoted Item"):"Products"===e?I18n.getMsg("Product"):"Bundles"===e?I18n.getMsg("Bundle"):"PriceBooks"===e?I18n.getMsg("Price Book"):"SalesOrders"===e?I18n.getMsg("SalesOrder"):"PurchaseOrders"===e?I18n.getMsg("PurchaseOrder"):"Invoices"===e?I18n.getMsg("Invoice"):void 0},getPluralLabelForCPQModulesBasedOnDataAvailability:function(e,r){return!0===r?moduleRecordMapping[e].plural_label:"Quotes"===e?I18n.getMsg("Quotes"):"QuotedItems"===e?I18n.getMsg("Quoted Items"):"Products"===e?I18n.getMsg("Products"):"Bundles"===e?I18n.getMsg("Bundles"):"PriceBooks"===e?I18n.getMsg("Price Books"):"SalesOrders"===e?I18n.getMsg("Sales Orders"):"PurchaseOrders"===e?I18n.getMsg("Purchase Orders"):"Invoices"===e?I18n.getMsg("Invoices"):void 0},getCruxCriteria:function(e,r){e.field&&(e.field.api_name.includes(r+".")&&!e.field.api_name.includes("_"+r+".")?e.field.api_name=e.field.api_name.replace(r+".","Parent_Id."):"Parent_Id"!==e.field.api_name.slice(0,9)&&(e.field.api_name="Parent_Id."+e.field.api_name),e.field.formula&&delete e.field.formula,e.field.field_label&&delete e.field.field_label,e.field.data_type&&delete e.field.data_type,e.field.decimal_place&&delete e.field.decimal_place),void 0!==e.group&&(e.group[0]&&this.getCruxCriteria(e.group[0],r),e.group[1]&&this.getCruxCriteria(e.group[1],r))},getValueFromArray:function(e,r){for(var i=r.length,o=0;o<i;o++)if(r[o].cpqlookUpFieldId===e||r[o].id===e||r[o].api_name===e)return r[o]},getFieldsForModules:function(e,r,i,o,t){if(i.hasOwnProperty(r[o].id)||void 0===r[o].api_name||void 0!==t&&r[o].api_name===t)this.fetchingFields(o,r,e,i,t);else{var a={};"crm-cpqpricerulecontainer"===e&&(a.skip_load_tab=!0),networkUtils.lyteInitiateRequest("/crm/v2.2/settings/fields?module="+r[o].api_name+"&type=all","GET",a).then(function(a){void 0!==a&&void 0!==a.fields&&a.fields.length>0?(i[r[o].id]=a.fields,this.fetchingFields(o,r,e,i,t)):this.onResponseOfFetchingFieldsForModules(e,"failure",r,void 0,r[o].plural_label)}.bind(this),function(i){i&&i.responseJSON&&"NO_PERMISSION"===i.responseJSON.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.crud.lookup.module.inaccessible"),ltPropType:"error"}}):this.onResponseOfFetchingFieldsForModules(e,"failure",r,void 0,r[o].plural_label)}.bind(this))}},fetchingFields:function(e,r,i,o,t){e===r.length-1?this.onResponseOfFetchingFieldsForModules(i,"success",r,o,void 0):this.getFieldsForModules(i,r,o,e+1,t)},formLookupAPINameAndFieldsObject:function(e,r){for(var i={},o=e.length,t=0;t<o;t++)r&&r.hasOwnProperty(e[t].id)&&(i[e[t].cpqApiName]=Lyte.deepCopyObject(r[e[t].id]));return Lyte.deepCopyObject(i)},onResponseOfFetchingFieldsForModules:function(e,r,i,o,t){"crm-cpqconfiguratorlistview"===e?this.onResponseCallBackOfFetchingLookupModuleFieldsFromListView(r,this.formLookupAPINameAndFieldsObject(i,o),t):"crm-cpqpricerulecontainer"===e&&this.onResponseCallBackOfFetchingLookupModuleFieldsFromEditPage(r,this.formLookupAPINameAndFieldsObject(i,o),t)},postProcessCruxCriteriaForQuotes:function(e,r,i){if(e&&e.field&&(e.field.api_name.split(".").length>2?e.field.api_name=e.field.api_name.slice(10):"Parent_Id."===e.field.api_name.slice(0,10)&&(e.field.api_name=e.field.api_name.replace("Parent_Id.",r+".")),void 0!==i))if(i.push(e.field.id),Array.isArray(e.value))for(let r of e.value)void 0!==r.id&&"-1"!==r.id&&i.push(r.id);else 0!==Object.keys(e.value).length&&void 0!==e.value.id&&-1!==e.value.id&&i.push(e.value.id);e&&void 0!==e.group&&(e.group[0]&&this.postProcessCruxCriteriaForQuotes(e.group[0],r,i),e.group[1]&&this.postProcessCruxCriteriaForQuotes(e.group[1],r,i))},postProcessCruxCriteriaForLineItmCrt:function(e,r,i){if(e&&e.field&&(e.field.api_name&&(e.field.api_name=r+"."+e.field.api_name),void 0!==i&&(i.push(e.field.id),Array.isArray(e.value))))for(let r of e.value)void 0!==r.id&&"-1"!==r.id&&i.push(r.id);e&&void 0!==e.group&&(e.group[0]&&this.postProcessCruxCriteriaForLineItmCrt(e.group[0],r,i),e.group[1]&&this.postProcessCruxCriteriaForLineItmCrt(e.group[1],r,i))},getHeaderFromField:function(e,r){for(var i=[],o=e.length,t=r.length,a=0;a<o;a++){var n=e[a].id;e:for(var s=0;s<t;s++){var l=r[s].id,d=r[s].visible;if(n===l){void 0!==d&&!0===d&&i.push(r[s]);break e}}}return i},getModuleInfo:function(e,r){store.findRecord("module",moduleRecordMapping[r].id,{}).then(function(e){e||this.showDefaultMessage("error","No Modules Found")}.bind(this))},getModuleList:function(e,r,i,o){var t={page:r,per_page:100};o&&o.sort_by&&o.sort_order&&(t.sort_by=o.sort_by,t.sort_order=o.sort_order),store.findAll(moduleRecordMapping[e].id,t).then(function(e){e&&0!==e.length?this.setData("bcHasMoreRecords",e.$.meta.more_records):this.setData("bcHasMoreRecords",!1)}.bind(this))},checkChangesForCPQfeatures:function(e,r,i){var o;switch(i){case"priceRules":o=$L("crm-cpqpriceruleheader");break;case"productConfigurator":o=$L("crm-productconfigurator-header");break;case"guidedSelling":o=$L("crm-cpq-gscreate")}if(o[0]&&o[0].component){var t=e.pause(),a=o[0].component.executeMethod("checkChangesForOtherTransitions"),n=!1;"edit"!==r||a?"priceRules"===i&&"edit"===r&&!0===o[0].component.getData("ruleNotInSync")&&(n=!0):n=!0,n?t.resume():("priceRules"===i&&o[0].component.setData("isOtherTransitionClick",!0),o[0].component.setData("otherTransitionObj",t),o[0].component.executeMethod("showCancelPopupForOtherTransitions"))}},getunusedData:function(e,r){var i={};e.forEach((function(e){i[e.id]=!0})),r.forEach((function(r){if(!i[r.field.id]){switch(r.field.unused=!0,r.field.api_name){case"Deal_Name":r.field.display_label=moduleRecordMapping.Deals.plural_label;break;case"Account_Name":r.field.display_label=moduleRecordMapping.Accounts.plural_label;break;case"Contact_Name":r.field.display_label=moduleRecordMapping.Contacts.plural_label}e.push(r.field)}}))},getParamsForRecordsAPI:function(e){if(void 0!==e&&!0===Crm.userDetails.isSandbox&&void 0!==Crm.userDetails.sandboxLastRefreshTime){var r={comparator:"less_than",field:{api_name:"Created_Time"},value:Crm.userDetails.sandboxLastRefreshTime};if(void 0!==e.filters)if(void 0!==e.filters.group)Lyte.arrayUtils(e.filters.group,"push",r);else{var i=e.filters;e.filters={group_operator:"AND",group:[i,r]}}else e.filters=r}},generateCPQTabs:function(e){return"1"===e?this.getChildModules("Orders"):"2"===e?this.getChildModules("Items"):void 0},getChildModules:function(e){var r=[];if(moduleRecordMapping.ZohoCPQ&&moduleRecordMapping.ZohoCPQ.child_module)if(r=moduleRecordMapping.ZohoCPQ.child_module.filter((function(e){return e.visible&&e.viewable})),"Orders"===e){if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.PriceBooks&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.Products.module_name&&e.module_name!==moduleRecordMapping.PriceBooks.module_name&&e.module_name!==moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.PriceBooks&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.PriceBooks.module_name&&e.module_name!==moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.Products.module_name&&e.module_name!==moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.PriceBooks)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.Products.module_name&&e.module_name!==moduleRecordMapping.PriceBooks.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.Products.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.PriceBooks)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.PriceBooks.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name!==moduleRecordMapping.Bundles)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}))}else if("Items"===e){if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.PriceBooks&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name===moduleRecordMapping.Products.module_name||e.module_name===moduleRecordMapping.PriceBooks.module_name||e.module_name===moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name===moduleRecordMapping.Products.module_name||e.module_name===moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.PriceBooks&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name===moduleRecordMapping.PriceBooks.module_name||e.module_name===moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products&&moduleRecordMapping.PriceBooks)return r.filter((function(e){if(e.module_name===moduleRecordMapping.Products.module_name||e.module_name===moduleRecordMapping.PriceBooks.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Products)return r.filter((function(e){if(e.module_name===moduleRecordMapping.Products.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.PriceBooks)return r.filter((function(e){if(e.module_name===moduleRecordMapping.PriceBooks.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}));if(moduleRecordMapping&&moduleRecordMapping.Bundles)return r.filter((function(e){if(e.module_name===moduleRecordMapping.Bundles.module_name)return e.visible&&e.viewable})).sort((function(e,r){return e.sequence_number-r.sequence_number}))}},checkModulePermissions:function(e){var r=!1;return(moduleRecordMapping.Quotes&&e===moduleRecordMapping.Quotes.module_name&&moduleRecordMapping.Quotes.visible&&moduleRecordMapping.Quotes.viewable&&Crm.userDetails.permissions.Crm_Implied_View_Quotes||moduleRecordMapping.SalesOrders&&e===moduleRecordMapping.SalesOrders.module_name&&moduleRecordMapping.SalesOrders.visible&&moduleRecordMapping.SalesOrders.viewable&&Crm.userDetails.permissions.Crm_Implied_View_SalesOrders||moduleRecordMapping.PurchaseOrders&&e===moduleRecordMapping.PurchaseOrders.module_name&&moduleRecordMapping.PurchaseOrders.visible&&moduleRecordMapping.PurchaseOrders.viewable&&Crm.userDetails.permissions.Crm_Implied_View_PurchaseOrders||moduleRecordMapping.Invoices&&e===moduleRecordMapping.Invoices.module_name&&moduleRecordMapping.Invoices.visible&&moduleRecordMapping.Invoices.viewable&&Crm.userDetails.permissions.Crm_Implied_View_Invoices||moduleRecordMapping.Products&&e===moduleRecordMapping.Products.module_name&&moduleRecordMapping.Products.visible&&moduleRecordMapping.Products.viewable&&Crm.userDetails.permissions.Crm_Implied_View_Products||moduleRecordMapping.Bundles&&e===moduleRecordMapping.Bundles.module_name&&moduleRecordMapping.Bundles.visible&&moduleRecordMapping.Bundles.viewable&&Crm.userDetails.permissions.Crm_Implied_View_Bundles||"productConfigurator"===e&&Crm.userDetails.permissions.Crm_Implied_View_CPQ_Product_Configurator||"priceRules"===e&&Crm.userDetails.permissions.Crm_Implied_View_CPQ_Price_Rules||"guidedSelling"===e&&Crm.userDetails.permissions.Crm_Implied_View_CPQ_Guided_Selling||"CpqSettings"===e&&Crm.userDetails.IS_ADMIN)&&(r=!0),r},checkPCLimits:function(e){var r={};return e&&e.__features&&e.__features.length>0&&(e=e.__features).forEach((function(e){e&&"criteria_entities_product_configurator"===e.api_name&&e.details&&e.details.limits&&e.details.limits.total?r.criteria_entity_limit=parseInt(e.details.limits.total):e&&"action_entities_product_configurator"===e.api_name&&e.details&&e.details.limits&&e.details.limits.total?r.action_entity_limit=parseInt(e.details.limits.total):e&&"action_field_update_product_configurator"===e.api_name&&e.details&&e.details.limits&&e.details.limits.total&&(r.action_fieldUpdate_limit=parseInt(e.details.limits.total))})),r},comparePCPRLimit:function(e,r){return!(0!==e&&!e||!r)&&e<r},hideSetupMenu:function(){var e=$L(".setupleftmenutd"),r=$L("#setupshow");void 0!==e&&void 0!==e[0]&&void 0!==r&&void 0!==r[0]&&(e[0].classList.contains("hide")||e.addClass("hide"),r[0].className.includes("new_setupview")&&r.removeClass("new_setupview"),setTimeout((function(){$("#setup_new_ContentDiv").css("height","100%")}),100))},getUpdatedFieldNames:function(e){for(var r="",i=e.length,o=!1,t=0;t<i;t++){t>=1&&!r.trim().endsWith(",")&&(r+=", ");var a=e[t].name;!0===e[t].visible?r+=a:o=!0}return!0===o&&(""!==r?(","===r.charAt(r.length-1)&&(r=r.slice(0,-1)),r=I18n.getMsg("crm.cpq.and.some.fields",[r])):r=I18n.getMsg("crm.cpq.some.fields")),r},flattenToTreeCruxCriteria:function(e,r,i){if(0===i)return(o={group_operator:"and",group:[]}).group.push(r),o.group.push(e[i]),o;if(i>=1){if(r.group){var o={};return o=this.treeCruxCriteriaMethod(e,r,i),this.flattenToTreeCruxCriteria(e,o,i-1)}return r.group_operator="and",r.group=[],r.group.push(e[i-1]),r.group.push(e[i-2]),e[i-3]?this.flattenToTreeCruxCriteria(e,r,i-3):r}},treeCruxCriteriaMethod:function(e,r,i){var o={group_operator:"and",group:[]};return o.group.push(r),o.group.push(e[i]),o},convertGSFieldsToCriteria:function(e){var r=e.length;if(1===r)return this.formCriteriaFieldObject(e[0]);return e=this.addFieldKeyForCrux(e),this.flattenToTreeCruxCriteria(e.reverse(),{},r)},addFieldKeyForCrux:function(e){var r=[];return e.forEach((function(e){var i={};i.field=e,i.comparator=null,i.value=null,r.push(i)})),r},formCriteriaFieldObject:function(e){var r={};return r.field=e,r.comparator=null,r.value=null,r},getModuleNameFromTypeForGS:function(e){switch(e){case 1:return"Products";case 2:return"Vendors";case 3:return"Deals";case 4:return"Contacts";case 5:return"Accounts";case 6:return"QuotedItems"}},getTypeFromModuleNameForGS:function(e){switch(e){case"Products":return 1;case"Vendors":return 2;case"Deals":return 3;case"Contacts":return 4;case"Accounts":return 5;case"QuotedItems":return 6}},addModuleNameInFieldsForGS:function(e,r){for(var i=[],o=e.length,t=0;t<o;t++){var a=Lyte.deepCopyObject(e[t]);switch(a.field_label=moduleRecordMapping[this.getModuleNameFromTypeForGS(r)].plural_label+" - "+a.field_label,r){case 2:a.api_name="Vendor_Name."+a.api_name;break;case 3:a.api_name="Deals__r.Potential_Name."+a.api_name;break;case 4:a.api_name="Contacts__r.Contact_Name."+a.api_name;break;case 5:a.api_name="Accounts__r.Account_Name."+a.api_name}i.push(a)}return i},getModulesForFieldsGS:function(e,r){var i=e.question_pages,o=i.length,t=[];if(o>0)for(var a=0;a<o;a++){var n=i[a].input_options;if(n)for(var s=n.length,l=0;l<s;l++){var d=n[l].module.api_name;!t.includes(n[l].module.api_name)&&this.getVisibleModulesForOrg(r).includes(d)&&t.push(d)}}return t},getVisibleModulesForOrg:function(e){for(var r=[],i=e.length,o=0;o<i;o++)e[o].visible&&!0===e[o].visible&&r.push(e[o].api_name);return r},getInfoTipForLyteSearch:function(e){var r=e.trim();return""===r&&e.length>0?(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("cpq.prForpart.invalidkeyinsearch"),ltPropType:"error"}}),!0):""!==r&&r.length<3&&(_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("cpq.prForpart.minimumchartosearch"),ltPropType:"error"}}),!0)},showSearchInfo:function(e,r,i,o){i&&(i=i.replace("#",""));var t=r.attr("id");t=void 0!==t?t:i,$("#lyteerrorMsg_"+t).remove();var a=document.createElement("span"),n=$(a);t?n.html(e).attr({class:"lyteErrorMsg cpqPrGreyText",id:"lyteerrorMsg_"+t}):n.html(e).attr({class:"lyteErrorMsg cpqPrGreyText"}),o&&n.html(e).removeClass("cpqPrGreyText"),r.append(a),this.getOuterWidth(r)<200&&n.css("whiteSpace","nowrap")},getOuterWidth:e=>e.outerWidth(),getCriteriaObjectForGSProductsServerSearch:function(e){var r={api_name:"Product_Name"},i={api_name:"Product_Code"},o={};o.field=r,o.comparator="contains",o.value=e;var t={};t.field=i,t.comparator="contains",t.value=e;var a={group_operator:"or"},n=[];return n.push(o),n.push(t),a.group=n,a},searchEachModuleFields:function(e,r){for(var i=e.length,o=0;o<i;o++)if(e[o].id===r)return e[o];return!1},setPermissionsForGs:function(e){e=$L(e).e[0].component,Crm.userDetails.permissions.Crm_Implied_View_CPQ_Guided_Selling&&e.setData("viewPermission",!0),Crm.userDetails.permissions.Crm_Implied_Create_CPQ_Guided_Selling&&(this.checkModulePermissions(moduleRecordMapping.Quotes.api_name)||(e.setData("createPermission",!1),e.setData("tooltipErrorMessage",I18n.getMsg("cpq.pr.createbutton.quotesViewDisabledTooltip",moduleRecordMapping.Quotes.plural_label)))),Crm.userDetails.permissions.Crm_Implied_Edit_CPQ_Guided_Selling&&e.setData("editPermission",!0),Crm.userDetails.permissions.Crm_Implied_Delete_CPQ_Guided_Selling&&e.setData("deletePermission",!0)},setModuleIDVsFieldsForGs:function(e,r){for(var i=e.length,o={},t={},a=[],n=0;n<i;n++)t[moduleRecordMapping[e[n]].id]=r[n+1],a.push(moduleRecordMapping[e[n]].id);return o.moduleIdVsFields=t,o.modulesLoadedArr=a,o},disableCruxFieldsForGS:function(){$L("#gsPreviewCriteria .cx_fieldDropdownLabel").addClass("lyteDropdown-disabled")},sortJsonArrayByKey:function(e,r){return e.sort(((e,i)=>e[r].toLowerCase()>i[r].toLowerCase()?1:-1)),e},treeToObjForGs:function(e){var r=[];if(e.hasOwnProperty("field")&&r.push(e.field),e.hasOwnProperty("group")){var i=e.group,o=i.length;for(let e=0;e<o;e++)r=r.concat(this.treeToObjForGs(i[e]))}return r},getDisabledGsList:function(e){var r,i,o=$L("crm-create-subformsection"),t=new Set([moduleApiMapping.Accounts,moduleApiMapping.Contacts,moduleApiMapping.Deals]),a=new Set([moduleApiMapping.Vendors]);for(var n of Object.keys(o)){var s=o[n];if(s.component.data.apiName===moduleApiMapping.QuotedItems){r=s.component.data.subformsectionData.fields;break}}for(var l=r.length,d=0;d<l;d++)if("Product_Name"===r[d].api_name){var u=r[d];void 0!==u.lookup&&void 0!==u.lookup.query_details&&void 0!==u.lookup.query_details.criteria&&(i=u.lookup.query_details.criteria)}if(i){var c=this.treeToObjForGs(i),p=c.length;let r=new Set;for(var m=0;m<p;m++){var g=c[m];g.api_name&&g.api_name.split(".").length>1&&r.add(g.api_name)}return r.size<=3||(4===r.size?e=this.addDisableForGsList([],e,!0,r,t):5===r.size?e=this.addDisableForGsList(Array.from(t),e):r.size>5&&(e=this.addDisableForGsList(Array.from(t).concat(Array.from(a)),e))),e}return e},addDisableForGsList:function(e,r,i,o,t){for(var a=moduleApiMapping.Vendors,n=r.length,s=0;s<n;s++){var l=r[s].question_pages;if(void 0!==l&&l.length){var d=l.length;let n=new Set;for(var u=0;u<d&&!r[s].disabled;u++)for(var c=l[u].input_options,p=c.length,m=0;m<p;m++){var g=c[m].module.api_name;if(e.includes(g)&&!i){r[s].disabled=!0;break}i&&n.add(g)}if(i&&!o.has("Vendor_Name.Vendor_Name")){var f=n.size;if(f>1&&n.has(a))for(var _=Array.from(n),v=0;v<f;v++)if(t.has(_[v])){r[s].disabled=!0;break}}}}return r},clearFilterAndSearch:function(e,r){this.data.filters={},this.data.cross_filters={},this.data.filterCri={};var i=$L("#smartFilterID")[0],o=$L("#smartFilterActionPanel")[0];o&&o.component.resetFields(),i&&i.component.resetFields();var t=this.getData("addProductFrom"),a="add_line_item"===t||"suggest_line_item"===t||"line_item_field_update"===t;""===this.getData("searchDataString")&&""===this.getData("oldSearchedValue")||(this.setData("oldSearchedValue",""),this.setData("searchDataString","")),(this.getData("isSearchApplied")||this.getData("isFilterApplied"))&&(this.setData("isProductLoading",!0),e?this.executeMethod("getFilteredRecords",this.getData("lookupModuleSelectedData.module_name"),null,!0):this.executeMethod("getFilteredRecords",this.getData("selectedLookupData.module_name"),!a,"",!0,r)),this.setData("isSearchApplied",!1),this.setData("isFilterApplied",!1),this.setData("isApplyFilter",!1),this.setData("applied_filters","")},setAppliedFilterSummary:function(e){var r=$L("#"+e)[0].component.data.checked,i="";if(r.length>0){var o=r.length;i+=r[o-1].display_field_label;for(var t=o-2;t>=0;t--)i+=", ",i+=r[t].display_field_label}this.setData("applied_filters",i)},getParamsForCPQRules:function(e){var r={};return"price_rules"===e?r.include_inner_details="criteria.group.field.data_type,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.rollup_summary,criteria_field_metadata,record.Product_Code,record.Unit_Price,field.field_label,range_field.field_label,actions.percentage_from_field.field_label,actions.percentage_from_field.module.display_label":"product_configurator"===e?r.include_inner_details="criteria.group.field.data_type,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.rollup_summary,criteria_field_metadata,actions.update_fields.field.field_label,actions.update_fields.field.data_type,actions.update_fields.display_value,actions.set_free_field.field_label":"guided_selling"===e&&(r.include="question_pages.input_options.field.field_label,question_pages.input_options.module.plural_label"),r},getCPQRuleDataForSandboxDifftool:function(e,r){var i,o=this.getParamsForCPQRules(r);if((i=e.url).match("sandbox/diff")||i.match("production/diff/")){t=i.split("diff/").pop().split("v2.2/")[0];e.url=i.replace(t,"")}else{var t=i.split("crm/").pop().split("v2.2/")[0];e.url=i.replace(t,"")}return store.findAll("dummy",o,!1,!1,e).then(function(e){if(e)return e}.bind(this),(function(e){commonUtils.showHideLoadingDiv(!1),sandbox.isSeeDiffTriggered=!1;var r=JSON.parse(e.responseText);return"NO_PERMISSION"===r.code&&void 0===r.details.permissions?{}:r.code}))},preShowDifftool:function(e,r,i){var o=null,t=null;return"guided_selling"===e?e=I18n.getMsg("crm.auditlog.guidedselling"):"price_rules"===e?e=I18n.getMsg("crm.auditlog.pricerules"):"product_configurator"===e&&(e=I18n.getMsg("crm.auditlog.productconfigurator")),"NO_PERMISSION"===r&&"NO_PERMISSION"===i?(o=I18n.getMsg("crm.configuration.nopermission.both",e)+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),t=!1):0===Object.keys(r).length&&0===Object.keys(i).length?(o=I18n.getMsg("crm.sandbox.cpq.inaccessible.both")+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),t=!1):"NO_PERMISSION"===r&&0===Object.keys(i).length?(o="<div class='mB8 mT12'>"+I18n.getMsg("crm.sandbox.reason.desc")+"</div> <p class=lh22>1. "+I18n.getMsg("crm.configuration.nopermission",[e,I18n.getMsg("crm.org.production")])+"</p> <p class=lh22>2. "+I18n.getMsg("crm.sandbox.cpq.inaccessible",I18n.getMsg("crm.auditlog.sandbox"))+"</p> <div class='crm-font-semibold mT20'>"+I18n.getMsg("cpq.permissiondenied.secondarymessage")+"</div>",t=!1):"NO_PERMISSION"===i&&0===Object.keys(r).length?(o="<div class='mB8 mT12'>"+I18n.getMsg("crm.sandbox.reason.desc")+"</div> <p class=lh22>1. "+I18n.getMsg("crm.configuration.nopermission",[e,I18n.getMsg("crm.auditlog.sandbox")])+"</p> <p class=lh22>2. "+I18n.getMsg("crm.sandbox.cpq.inaccessible",I18n.getMsg("crm.org.production"))+"</p> <div class='crm-font-semibold mT20'>"+I18n.getMsg("cpq.permissiondenied.secondarymessage")+"</div>",t=!1):"NO_PERMISSION"!==r&&0!==Object.keys(r).length||"INVALID_DATA"!==i?"NO_PERMISSION"!==r&&0!==Object.keys(r).length||"NO_PERMISSION"===i?"NO_PERMISSION"===r||"NO_PERMISSION"!==i&&0!==Object.keys(i).length?"NO_PERMISSION"!==r&&"INVALID_DATA"===i&&(o=I18n.getMsg("crm.sandbox.nopermission")+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),t=!0):(o=("NO_PERMISSION"===i?I18n.getMsg("crm.configuration.nopermission",[e,I18n.getMsg("crm.auditlog.sandbox")]):I18n.getMsg("crm.sandbox.cpq.inaccessible",I18n.getMsg("crm.auditlog.sandbox")))+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),i=null,t=!0):(o=("NO_PERMISSION"===r?I18n.getMsg("crm.configuration.nopermission",[e,I18n.getMsg("crm.org.production")]):I18n.getMsg("crm.sandbox.cpq.inaccessible",I18n.getMsg("crm.org.production")))+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),r=null,t=!0):(o=("NO_PERMISSION"===r?I18n.getMsg("crm.sandbox.configuration.nopermission",e):I18n.getMsg("crm.sandbox.configuration.noperm.inaccessible"))+" "+I18n.getMsg("cpq.permissiondenied.secondarymessage"),t=!1),sandbox.isErrorInCPQ=o,t},getExecuteOnDisplayValue:function(e){return"create_and_edit"===e?I18n.getMsg("cpq.rules.execute.CreateandEdit"):"create"===e?I18n.getMsg("cpq.rules.execute.CreateOnly"):"edit"===e?I18n.getMsg("cpq.rules.execute.EditOnly"):void 0},changeVisiblePropertyOfFields:function(e){e.forEach((function(e){e.visible=!0}))},getModuleListInPriceRules:function(e){var r=[],i=Lyte.deepCopyObject(this.getModuleObjectBasedOnPageTypeAndHeirarchy("parent"));if(i.display_label=i.plural_label,Lyte.arrayUtils(r,"push",Lyte.deepCopyObject(i)),e){for(var o=0,t=e.length;o<t;)17===e[o].show_type||50===e[o].ui_type||"multiselectlookup"===e[o].data_type||132===e[o].ui_type||"Layout"===e[o].api_name||"DISCOUNT_TYPE"===e[o].column_name||"DISCOUNT_PERCENTAGE"===e[o].column_name||"Tax"===e[o].api_name?(Lyte.arrayUtils(e,"removeAt",o),t--):"lookup"===e[o].data_type&&e[o].lookup&&e[o].lookup.module&&e[o].lookup.module.id!==i.id?(e[o].display_label=e[o].field_label+" - "+this.getModulePluralLabelByAPIName(e[o].lookup.module.api_name),Lyte.arrayUtils(r,"push",e[o]),Lyte.arrayUtils(e,"removeAt",o),t--):o++;this.setData("quoteFields",[]),Lyte.arrayUtils(this.getData("quoteFields"),"push",e)}return this.getunusedData(r,this.getData("PR_criteria_field_metadata")),this.changeUnusedFields(r)},getI18NDisplayValyeForStatus:function(e){return e?I18n.getMsg("crm.label.status"):I18n.getMsg("Inactive")},compareRangeArrays:function(e,r){for(var i=e.length,o=r.length,t=0,a=0;a<i;a++){var n=e[a].quantity_from,s=e[a].quantity_to,l=e[a].value;e:for(var d=0;d<o;d++){var u=r[d].quantity_from,c=r[d].quantity_to,p=r[d].value;if(n===u&&s===c&&l===p){t+=1;break e}}}return t===i},compareCriteria:function(e,r,i,o){if(e&&e.field&&r&&r.field){if(i&&e.field.id!==o[r.field.id]||!i&&e.field.id!==r.field.id||e.comparator!==r.comparator)return!1;if(Array.isArray(e.value)&&Array.isArray(r.value)){if(e.value.length!==r.value.length)return!1;for(let i of e.value){var t=!1;for(let e of r.value){if(void 0===i.id&&void 0===e.id&&void 0===i.name&&void 0===e.name&&i===e){t=!0;break}if(void 0===i.id&&void 0!==e.id||void 0!==i.id&&void 0===e.id)break;if(i.id===o[e.id]||i.id===e.id){t=!0;break}}if(!t)return!1}}else if(Array.isArray(e.value)&&!Array.isArray(r.value)||!Array.isArray(e.value)&&Array.isArray(r.value)||void 0!==e.value.id&&void 0===r.value.id||void 0===e.value.id&&void 0!==r.value.id||i&&void 0!==e.value.id&&void 0!==r.value.id&&("-1"!==e.value.id&&"-1"===r.value.id||"-1"===e.value.id&&"-1"!==r.value.id||"-1"!==r.value.id&&e.value.id!==o[r.value.id])||!i&&void 0!==e.value.id&&void 0!==r.value.id&&e.value.id!==r.value.id||void 0===e.value.id&&void 0===r.value.id&&e.value!==r.value)return!1}if(e&&void 0!==e.group&&r&&void 0!==r.group){if(e.group[0]&&r.group[0]&&!this.compareCriteria(e.group[0],r.group[0],i,o))return!1;if(e.group[1]&&r.group[1]&&!this.compareCriteria(e.group[1],r.group[1],i,o))return!1}return!e||!r||e.group_operator===r.group_operator},getModuleObjectBasedOnPageTypeAndHeirarchy:function(e){if("create"===this.getData("mode"))switch(e){case"parent":return this.getData("transitionData.pricerulemoduleselected");case"subform":return this.getData("transitionData.pricerulesubmoduleselected");case"lookup":return this.getData("transitionData.pricerulelookupmoduleselected")}else if("edit"===this.getData("mode")){var r=$L("crm-cpqpriceruleheader").e[0].component;switch(e){case"parent":return r.getData("parentModuleSelected");case"subform":return r.getData("subformSelected");case"lookup":return r.getData("lookupModuleSelected")}}else if("diff"===this.getData("mode")){var i=this.getData("moduleData");return i.plural_label=i.name,i}},getModulePluralLabelByAPIName:function(e,r){let i=Object.values(moduleRecordMapping).find((r=>r.api_name===e));return i?i.plural_label:r?r.name:""},changeUnusedFields:function(e){return e.map((e=>("unused"===e.type&&(e.type="used"),e)))}});
