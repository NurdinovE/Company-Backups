Lyte.Component.register("lyte-hovercard",{_template:'<template tag-name="lyte-hovercard"> <template is="if" value="{{ltPropShow}}"><template case="true"> <lyte-wormhole case="{{ltPropShow}}" style="{{if(ltPropShowCopy,\'visibility:visible\',\'visibility:hidden\')}}" on-before-append="{{method(&quot;beforeWormholeAppend&quot;)}}"> <template is="registerYield" yield-name="lyte-content"> <div class="hoverCardWrapper {{ltPropClass}}" id="{{ltPropId}}"> <lyte-yield yield-name="hoverCardYield"></lyte-yield> </div> </template> </lyte-wormhole> </template></template> <template is="if" value="{{ltPropUseBetaPopover}}"><template case="true"> <lyte-beta-popover class="lyteHoverCard" lt-prop="{{stringify(ltPropPopover)}}" lt-prop-close-on-scroll="{{ltPropCloseOnScroll}}" lt-prop-aria="{{ltPropAria}}" lt-prop-aria-attributes="{{ltPropAriaAttributes}}" lt-prop-wrapper-class="lyteHovercardPopover {{ltPropPopoverWrapperClass}} {{if(ltPropFollowCursor,\'lyteHoverCardFollowCursor\',\'\')}}" lt-prop-close-on-body-click="false" lt-prop-type="{{ltPropType}}" lt-prop-show-close-button="false" lt-prop-bind-to-body="true" lt-prop-placement="{{ltPropPlacement}}" lt-prop-offset="{{ltPropOffset}}" lt-prop-close-on-escape="{{ltPropCloseOnEscape}}" lt-prop-prevent-focus="{{ltPropPreventFocus}}" lt-prop-dimmer="{{ltPropDimmer}}" lt-prop-animation="{{ltPropAnimation}}" lt-prop-auto-align="{{ltPropAutoAlign}}" on-before-close="{{method(&quot;onPopoverBeforeClose&quot;)}}" on-close="{{method(&quot;onPopoverClose&quot;)}}" on-before-show="{{method(&quot;onPopoverBeforeShow&quot;)}}" on-show="{{method(&quot;onPopoverBeforeShow&quot;)}}"> <template is="registerYield" yield-name="popover"> </template> </lyte-beta-popover> </template><template case="false"> <lyte-popover class="lyteHoverCard" lt-prop="{{stringify(ltPropPopover)}}" lt-prop-close-on-scroll="{{ltPropCloseOnScroll}}" lt-prop-aria="{{ltPropAria}}" lt-prop-aria-attributes="{{ltPropAriaAttributes}}" lt-prop-wrapper-class="lyteHovercardPopover {{ltPropPopoverWrapperClass}} {{if(ltPropFollowCursor,\'lyteHoverCardFollowCursor\',\'\')}}" lt-prop-close-on-body-click="false" lt-prop-type="{{ltPropType}}" lt-prop-show-close-button="false" lt-prop-bind-to-body="true" lt-prop-placement="{{ltPropPlacement}}" lt-prop-offset="{{ltPropOffset}}" lt-prop-close-on-escape="{{ltPropCloseOnEscape}}" lt-prop-prevent-focus="{{ltPropPreventFocus}}" lt-prop-dimmer="{{ltPropDimmer}}" lt-prop-animation="{{ltPropAnimation}}" lt-prop-auto-align="{{ltPropAutoAlign}}" on-before-close="{{method(&quot;onPopoverBeforeClose&quot;)}}" on-close="{{method(&quot;onPopoverClose&quot;)}}" on-before-show="{{method(&quot;onPopoverBeforeShow&quot;)}}" on-show="{{method(&quot;onPopoverBeforeShow&quot;)}}"> <template is="registerYield" yield-name="popover"> </template> </lyte-popover> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"if",args:["ltPropShowCopy","'visibility:visible'","'visibility:hidden'"]}}}},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"insertYield",position:[1,1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["ltPropDisplay","ltPropShow","ltPropOriginElem","ltPropMaxHeight","ltPropWidth","ltPropHeight","ltPropPlacement","ltPropClass","ltPropId","ltPropShowDelay","ltPropHideDelay","ltPropMaxDisplayTime","ltPropKeepAlive","ltPropFollowCursor","ltPropPopoverWrapperClass","ltPropOffset","ltPropCloseOnEscape","ltPropAutoShow","ltPropHideOnClick","ltPropAria","ltPropAriaAttributes","ltPropPreventFocus","ltPropMaxWidth","ltPropType","ltPropDimmer","ltPropAnimation","ltPropAutoAlign","ltPropPopover","ltPropCloseOnScroll","ltPropUseBetaPopover","mousePosition","mouseover","originEle","popoverTagName"],data:function(){return{ltPropDisplay:Lyte.attr("boolean",{default:!0}),ltPropShow:Lyte.attr("boolean",{default:!1}),ltPropOriginElem:Lyte.attr("string",{default:""}),ltPropMaxHeight:Lyte.attr("string",{default:""}),ltPropWidth:Lyte.attr("string",{default:""}),ltPropHeight:Lyte.attr("string",{default:"auto"}),ltPropPlacement:Lyte.attr("string",{default:""}),ltPropClass:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-hovercard","class","")}),ltPropId:Lyte.attr("string",{default:""}),ltPropShowDelay:Lyte.attr("number",{default:0}),ltPropHideDelay:Lyte.attr("number",{default:0}),ltPropMaxDisplayTime:Lyte.attr("number",{default:5e3}),ltPropKeepAlive:Lyte.attr("boolean",{default:!0}),ltPropFollowCursor:Lyte.attr("boolean",{default:!1}),ltPropPopoverWrapperClass:Lyte.attr("string",{default:_lyteUiUtils.resolveDefaultValue("lyte-hovercard","popoverWrapperClass","")}),ltPropOffset:Lyte.attr("object",{default:{}}),ltPropCloseOnEscape:Lyte.attr("boolean",{default:!0}),ltPropAutoShow:Lyte.attr("boolean",{default:!0}),ltPropHideOnClick:Lyte.attr("boolean",{default:_lyteUiUtils.resolveDefaultValue("lyte-hovercard","hideOnClick",!1)}),ltPropAria:Lyte.attr("boolean",{default:!1}),ltPropAriaAttributes:Lyte.attr("object",{default:{}}),ltPropPreventFocus:Lyte.attr("boolean",{default:!0}),ltPropMaxWidth:Lyte.attr("string",{default:""}),ltPropType:Lyte.attr("string",{default:"callout"}),ltPropDimmer:Lyte.attr("object",{default:{color:"black",opacity:"0.4"}}),ltPropAnimation:Lyte.attr("string",{default:"fade"}),ltPropAutoAlign:Lyte.attr("boolean",{default:!1}),ltPropPopover:Lyte.attr("object",{default:{}}),ltPropCloseOnScroll:Lyte.attr("boolean",{default:!0}),ltPropUseBetaPopover:Lyte.attr("boolean",{default:!1}),mousePosition:Lyte.attr("array",{default:[]}),mouseover:Lyte.attr("boolean",{default:!1}),originEle:Lyte.attr("string",{default:""}),popoverTagName:Lyte.attr("string",{default:"lyte-popover"})}},init:function(){this.getMethods("beforeRender")&&this.executeMethod("beforeRender",this.$node),this.getData("ltPropUseBetaPopover")&&this.setData("popoverTagName","lyte-beta-popover")},didConnect:function(){if(this._popover=this.$node.getElementsByTagName(this.getData("popoverTagName"))[0],this._hovercardScroll=this.hovercardScroll.bind(this),this._hovercardHideOnClick=this.hovercardHideOnClick.bind(this),this._mousemove=this.mousemove.bind(this),this._oriEleMouseMove=this.oriEleMousemove.bind(this),this._originEleFocus=this.originEleFocus.bind(this),this._originEleBlur=this.originEleBlur.bind(this),this.getData("ltPropOriginElem"))try{document.querySelector(this.getData("ltPropOriginElem"))||console.error("Provide a valid selector for 'ltPropOriginElem'; '"+this.getData("ltPropOriginElem")+"' is not a valid origin selector for the Hovercard component")}catch(e){console.warn("Provide a valid selector for 'ltPropOriginElem'; '"+this.getData("ltPropOriginElem")+"' is not a valid origin element selector for the Hovercard component")}this.getData("ltPropAutoShow")&&this.getData("ltPropOriginElem")&&(this.setMouseMove(),this.addMutationObserver(),this.addFocusAndBlur()),$L.fastdom.measure(function(){var e="rtl"==window.getComputedStyle(this.$node).getPropertyValue("direction");$L.fastdom.mutate(function(){e&&(this.direction=!0)}.bind(this))}.bind(this)),_lyteUiUtils.dispatchEvent("afterrender",this.$node),this.getMethods("afterRender")&&this.executeMethod("afterRender",this.$node),this.$node.alignHovercard=function(){this._popover=this._popover||this.$node.getElementsByTagName(this.getData("popoverTagName"))[0],this._popover&&this._popover.alignPopover&&this._popover.alignPopover()}.bind(this),this.$node.calculateOffset=function(){this._popover=this._popover||this.$node.getElementsByTagName(this.getData("popoverTagName"))[0],this._popover&&this._popover.calculateOffset&&this._popover.calculateOffset()}.bind(this)},didDestroy:function(){if(this.$node.classList.remove("lyteActive"),this.getData("ltPropHideOnClick")&&document.removeEventListener("click",this._hovercardHideOnClick),this.$node.ltProp("originElem")){var e=document.querySelector(this.$node.ltProp("originElem"));e&&(this._closeHoverCard&&e.removeEventListener("mouseleave",this._closeHoverCard),this.removeEventListenerForOriginElem(e),this.getData("ltPropAutoShow")&&(this.removeFocusAndBlur(e),this.removeMutationObserver(),this.removeFocusAndBlur(e)))}this._popover&&this._popover.setData("ltPropShow",!1),_lyteUiUtils.lyteHovercard&&delete _lyteUiUtils.lyteHovercard[this.$node.ltProp("originElem")],this._childComp&&this._childComp.remove(),this.getData("ltPropAutoShow")&&document.removeEventListener("mousemove",this._mousemove),delete this.prevHoverCardNode,delete this._childComp,delete this._popover},addFocusAndBlur:function(){const e=document.querySelector(this.getData("ltPropOriginElem"));e&&(e.addEventListener("focus",this._originEleFocus),e.addEventListener("blur",this._originEleBlur))},removeFocusAndBlur:function(e){e&&(e.removeEventListener("focus",this._originEleFocus),e.removeEventListener("blur",this._originEleBlur))},originEleFocus:function(e){this.getData("ltPropShow")||this.setData("ltPropShow",!0)},originEleBlur:function(){this.getData("ltPropShow")&&this.setData("ltPropShow",!1)},setMaxHeightAndWidth:function(e){this.getData("ltPropMaxWidth")&&(e.style.maxWidth=this.getData("ltPropMaxWidth")),this.getData("ltPropMaxHeight")&&(e.style.maxHeight=this.getData("ltPropMaxHeight"),e.classList.add("lyteHovercardWithMaxHeight"))},isNode:function(e){return e instanceof HTMLElement||e instanceof Node},addEventListenerForOriginElem:function(e){e&&e.addEventListener("mousemove",this._oriEleMouseMove)},removeEventListenerForOriginElem:function(e){e&&e.removeEventListener("mousemove",this._oriEleMouseMove),this.setData("mousePosition",[]),this.setData("mouseover",!1)},hovercardHideOnClick:function(e){var t=e.target,o=this._popover.component.actualModalDiv;this.getData("ltPropHideOnClick")&&this.getData("ltPropShow")&&this.isNode(t)&&t!==o&&!o.contains(t)&&this.setData("ltPropShow",!1)},oriEleMousemove:function(e){this.getData("mouseover")||(this.mouseovereve(e),this.setData("mouseover",!0));var t=[e.clientX,e.clientY],o=this.getData("mousePosition"),r=[t[0]-(o[0]?o[0]:0),t[1]-(o[1]?o[1]:0)];if(this._popover.ltProp("show")&&this._popover.component.childComp){var i=$L(".lyteHoverCardFollowCursor .lytePopover",this._popover.component.childComp)[0],l=i.getBoundingClientRect();i.style.top=l.top+r[1]+"px",i.style.left=l.left+r[0]+"px"}this.setData("mousePosition",t)},mouseovereve:function(e){var t=[e.clientX,e.clientY];this._popover.ltProp({offset:{left:t[0]-9,top:t[1]-9,height:18,width:18}}),this.setData("ltPropOffset",{left:t[0],top:t[1],height:18,width:18}),this.setData("mousePosition",t)},mousemove:function(e){for(var t=e.target.correspondingElement||e.target;t&&"BODY"!=t.tagName&&t!=document&&"HTML"!=t.tagName&&!(t instanceof ShadowRoot);){if(t.getAttribute("lyte-hovercard")){var o=this.findMatchingHoverCard(t);o&&!o.getData("ltPropShow")&&o.setData("ltPropShow",!0);break}t=t.parentNode}},findMatchingHoverCard:function(e){for(var t in _lyteUiUtils.lyteHovercard)if(e.matches(t))return _lyteUiUtils.lyteHovercard[t]},setMouseMove:function(){var e=_lyteUiUtils.lyteHovercard?_lyteUiUtils.lyteHovercard:[];e[this.$node.ltProp("originElem")]=this.$node,_lyteUiUtils.lyteHovercard=e;var t=window.document===document?"mousemove":"mouseover";document.addEventListener(t,this._mousemove)},compouteOffset:function(e){for(var t=["ltPropWidth","ltPropHeight"],o=0;o<t.length;o++)this.getData(t[o])&&e.setData(t[o],this.getData(t[o]))},createHoverCard:function(e,t){var o=this._popover;if(o){_lyteUiUtils.dispatchEvent("beforeshow",this.$node,{originalEvent:e});var r=!0;if(this.getMethods("onBeforeHovercardShow")&&(r=this.executeMethod("onBeforeHovercardShow",this.$node)),!r)return this.setData("ltPropShow",!1),!1;o.ltProp("show",!0),o.ltProp("allowMultiple",!0),this.$node.classList.add("lyteActive"),this.getMethods("onHovercardShow")&&this.executeMethod("onHovercardShow",this.$node)}if(!this.getData("ltPropKeepAlive")&&!this.getData("ltPropFollowCursor")){var i=document.querySelector(this.$node.ltProp("originElem"));o._maxdisp=setTimeout(function(){this.removeHoverCard(o,i,e,t)}.bind(this),this.getData("ltPropMaxDisplayTime"))}},removeTimeout:function(e){clearTimeout(e._settime),clearTimeout(e._maxdisp),clearTimeout(e._bodyTimeout)},originEleObs:function(e){if(this.getData("ltPropOriginElem"))try{document.querySelector(this.getData("ltPropOriginElem"))||console.error("Provide a valid selector for 'ltPropOriginElem'; '"+this.getData("ltPropOriginElem")+"' is not a valid origin selector for the Hovercard component")}catch(e){console.warn("Provide a valid selector for 'ltPropOriginElem'; '"+this.getData("ltPropOriginElem")+"' is not a valid origin element selector for the Hovercard component")}if(e.oldValue&&_lyteUiUtils.lyteHovercard){var t=document.querySelector(e.oldValue);t&&(this._closeHoverCard&&t.removeEventListener("mouseleave",this._closeHoverCard),this.removeEventListenerForOriginElem(t),this.removeFocusAndBlur(t),e.oldValue&&this.removeMutationObserver(e.oldValue),this.getData("ltPropAutoShow")&&!this.getData("ltPropOriginElem")&&document.removeEventListener("mousemove",this._mousemove)),delete _lyteUiUtils.lyteHovercard[e.oldValue],this.getData("ltPropShow")&&this.setData("ltPropShow",!1),this.getData("ltPropOriginElem")&&(_lyteUiUtils.lyteHovercard[this.getData("ltPropOriginElem")]=this.$node,this.addMutationObserver(),this.addFocusAndBlur())}else this.getData("ltPropAutoShow")&&this.getData("ltPropOriginElem")&&(this.setMouseMove(),this.addMutationObserver(),this.addFocusAndBlur())}.observes("ltPropOriginElem"),showToggled:function(){var e=this._popover;e.component&&!e.getData("ltPropBindToBody")&&e.ltProp("bindToBody",!0);var t=this._childComp.querySelector(".hoverCardWrapper"),o=this._popover.component.actualModalDiv,r=document.querySelector(this.$node.ltProp("originElem"));this.getData("ltPropShow")&&r?(this.prevHoverCardNode=r,this.getData("ltPropHideOnClick")&&document.addEventListener("click",this._hovercardHideOnClick),_lyteUiUtils.appendChild(o,t),e.ltProp("originElem",this.getData("ltPropOriginElem")),e.ltProp("freeze",!1),e.ltProp("duration",void 0),this.compouteOffset(e),this.setMaxHeightAndWidth(t),this.getData("ltPropFollowCursor")&&this.addEventListenerForOriginElem(r),e._settime=setTimeout(this.createHoverCard.bind(this),this.getData("ltPropShowDelay"),event,o),this._closeHoverCard=this.closeHoverCard.bind(this),r.addEventListener("mouseleave",this._closeHoverCard)):(e.ltProp("show",!1),e.ltProp("bindToBody",!1),this.$node.classList.remove("lyteActive"),r&&r.removeEventListener("mouseleave",this._closeHoverCard),this._popovermouseleave&&o.removeEventListener("mouseleave",this._popovermouseleave),this.getData("ltPropHideOnClick")&&document.removeEventListener("click",this._hovercardHideOnClick),this.removeEventListenerForOriginElem(r),this.getMethods("onHovercardHide")&&this.executeMethod("onHovercardHide",this.$node),this.prevHoverCardNode&&delete this.prevHoverCardNode,delete this._childComp,delete this._mousedownFlag,this.removeTimeout(e))}.observes("ltPropShow"),addMutationObserver:function(){let e=this;const t=document.querySelector(this.getData("ltPropOriginElem"));this._observer=new MutationObserver(((o,r)=>{for(const r of o)if("childList"===r.type){for(let o=0;o<r.removedNodes.length;o++){if(r.removedNodes[o]===t){e.getData("ltPropShow")&&e.setData("ltPropShow",!1),_lyteUiUtils.lyteHovercard&&_lyteUiUtils.lyteHovercard[this.getData("ltPropOriginElem")]&&delete _lyteUiUtils.lyteHovercard[this.getData("ltPropOriginElem")],e._observer.disconnect();break}}r.removedNodes.forEach((e=>{}))}}));t&&this._observer.observe(t.parentElement,{childList:!0})},removeMutationObserver:function(){this._observer&&this._observer.disconnect(),delete this._observer},closeHoverCard:function(e){this._childComp;var t=this._popover.component.actualModalDiv,o=this._popover,r=document.querySelector(this.$node.ltProp("originElem"));this.prevHoverCardNode&&this.isNode(e.target)&&(this.getData("ltPropFollowCursor")||e.target==this.prevHoverCardNode||this.prevHoverCardNode.contains(e.target))&&t&&e.relatedTarget!=t&&!t.contains(e.relatedTarget)?o._bodyTimeout=setTimeout(this.removeHoverCard.bind(this),this.getData("ltPropHideDelay"),o,r,e):t&&this.isNode(e.relatedTarget)&&(e.relatedTarget==t||t.contains(e.relatedTarget))&&(this.removeTimeout(o),this._popovermouseleave=this.popoverMouseLeave.bind(this),t.addEventListener("mouseleave",this._popovermouseleave),r.removeEventListener("mouseleave",this._closeHoverCard))},removeHoverCard:function(e,t,o,r){var i=!0;this.getMethods("onHovercardBeforeHide")&&!(i=this.executeMethod("onHovercardBeforeHide",this.$node,o))&&t&&(t.removeEventListener("mouseleave",this._closeHoverCard),this._popovermouseleave&&r&&r.removeEventListener("mouseleave",this._popovermouseleave)),i&&(this.prevHoverCardNode&&this.isNode(o.target)&&(o.target==this.prevHoverCardNode||this.prevHoverCardNode.contains(o.target))||r&&this.isNode(o.target)&&(o.target==r||r.contains(o.target)))&&(this.removeTimeout(e),this.getData("ltPropShow")&&e&&(this.setData("ltPropShow",!1),e.setData("ltPropShow",!1)))},popoverMouseLeave:function(e){this._childComp;var t=this._popover.component.actualModalDiv,o=this._popover,r=document.querySelector(this.$node.ltProp("originElem"));document.elementFromPoint(e.clientX,e.clientY);t&&this.isNode(e.target)&&(e.target==t||t.contains(e.target))&&e.relatedTarget!=this.prevHoverCardNode&&!this.prevHoverCardNode.contains(e.relatedTarget)?o._bodyTimeout=setTimeout(this.removeHoverCard.bind(this),this.getData("ltPropHideDelay"),o,r,e,t):this.prevHoverCardNode&&this.isNode(e.relatedTarget)&&(e.relatedTarget==this.prevHoverCardNode||this.prevHoverCardNode.contains(e.relatedTarget))&&(o._settime=setTimeout(this.createHoverCard.bind(this),this.getData("ltPropShowDelay"),e,t),this._closeHoverCard=this.closeHoverCard.bind(this),r.addEventListener("mouseleave",this._closeHoverCard),this._popovermouseleave&&t.removeEventListener("mouseleave",this._popovermouseleave))},hovercardScroll:function(e){if($L(this.$node).hasClass("lyteActive")){var t=!0,o=this,r=(o._childComp,o._popover.component.actualModalDiv),i=o._popover,l=document.querySelector(this.getData("ltPropOriginElem"));o.getMethods("onHovercardBeforeHide")&&!(t=o.executeMethod("onHovercardBeforeHide",o.$node))&&l&&(l.removeEventListener("mouseleave",o._closeHoverCard),o._popovermouseleave&&r&&r.removeEventListener("mouseleave",o._popovermouseleave)),t&&(o.getData("ltPropShow")&&i&&o.setData("ltPropShow",!1),o.prevHoverCardNode&&delete o.prevHoverCardNode,o.removeTimeout(i))}},methods:{beforeWormholeAppend:function(e){this._childComp=e},onPopoverBeforeClose:function(e,t){if(e&&"scroll"===e.type){var o=!0;if(this.getMethods("onHovercardBeforeHide")){o=this.executeMethod("onHovercardBeforeHide",this.$node,e);const t=document.querySelector(this.getData("ltPropOriginElem")),r=this._popover.component.actualModalDiv;if(!o&&t)return t.removeEventListener("mouseleave",this._closeHoverCard),this._popovermouseleave&&r&&r.removeEventListener("mouseleave",this._popovermouseleave),o}}},onPopoverClose:function(e){e&&"scroll"===e.type&&this.setData("ltPropShow",!1)},onPopoverBeforeShow:function(e){this.getData("ltPropShow")||this.setData("ltPropShow",!0)}}});
