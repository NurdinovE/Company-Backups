Lyte.Mixin.register("crm-zianotification-helper",{inc:0,userList:"",tempCount:0,cFlag:0,isZiaNotificationClicked:!1,monthNames:{monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthFullNames:["January","February","March","April","May","June","July","August","September","October","November","December"]},notificationDetailJson:{},getZiaNotificationDetails:function(e,t){$("#diNotificationDetails").css({display:"none"}),$(".jarvisFreeze").removeClass("showFreeze");var i=this,o=0,n=0,a=0,s=0,r="",c=0,l="",d=e.id,m=0,u="",f="",p="",g="",C=!1,h=!1,y=!1,v="",D=!1,_=!0,w=1;store.peekRecord("zianotificationpanel",d).$.set("read",!0);var b,M=$L("crm-zia-cv-anomaly-result")[0];if(M&&M.component.getData("showModal")&&"custom_view_anomaly"!==e.type&&"deals_stage_anomaly"!==e.type&&M.component.executeMethod("closeResult"),e.type?b=e.type:e.associated_resources[0].type&&(b=e.associated_resources[0].type),Crm.client_tracking("Zia Notification - message viewed",{feature:b}),"email_custom_intent"===e.type)m=711,C=!0;else if("duplicate_image_detection"===e.type)m=667;else if("selfmarketing"===e.type)m=801,Crm.client_tracking("EmailsAISelfmarketingPhase 2 -  notification clicked"),y=!0;else if("Macro Suggestions"===e.title)m=105;else if("zia_score_lead"===e.associated_resources[0].type)m=330;else if("zia_score_deal"===e.associated_resources[0].type)m=331;else if("churn_prediction"===e.associated_resources[0].type)m=332;else if("prediction"===e.associated_resources[0].type)m=333;else if("custom_view_anomaly"===e.type)m=320;else if("deals_stage_anomaly"===e.type)m=309;else if("default_prediction"===e.associated_resources[0].type)m=338,w=e.associated_resources[0].resources[0].batch?e.associated_resources[0].resources[0].batch:1;else if("recommendation_builder"===e.associated_resources[0].type)m=334;else if("workflow_suggestion"===e.associated_resources[0].type)m=112;else if("analytics"===e.type)m=301;else if("recommendation"===e.type)m=335;else if("similarity"===e.type)m=336;else if("anomaly"===e.type)m=4;else if(e.associated_resources[0].type.includes("system_workflow")){var k=e.associated_resources[0].type;m=parseInt(k.substr(k.length-3))}else if("presentation"===e.type||"dashboard_presentation"===e.type)m=1e3;else if("email_extracted_activities"===e.type)g=!0,m=700;else if("cns"===e.type)v=!0,m=800;else if("cns_selfmarketing"===e.type)m=800,h=!0;else if("next_best_experience"===e.associated_resources[0].type){m=7===e.associated_resources[0].resources[0].type?337:339,D=e.associated_resources[0].resources[0]&&"completed"===e.associated_resources[0].resources[0].status,(Crm.userDetails.permissions.Crm_Implied_View_Calls||Crm.userDetails.permissions.Crm_Implied_View_Events||Crm.userDetails.permissions[337===m?"Crm_Implied_Send_Mail_Potentials":"Crm_Implied_Send_Mail_Leads"])&&Crm.userDetails.permissions.Crm_Implied_View_Nba&&moduleRecordMapping[337===m?"Potentials":"Leads"].isNbxEnabled||(D=!1)}else"custom_view_anomaly"===e.associated_resources[0].type?(m=320,_=!!e.associated_resources[0].details):"deals_stage_anomaly"===e.associated_resources[0].type?(m=309,_=!!e.associated_resources[0].details):"vision"===e.type?m=666:"zia_component_suggestions"===e.type&&(m=400);switch(m){case 330:case 331:case 332:case 333:o=e.associated_resources[0].resources[0].id;break;case 334:n=e.associated_resources[0].resources[0].id;break;case 301:a=e.associated_resources[0].resources[0].details.components[0].id,s=e.associated_resources[0].resources[0].id,r=e.associated_resources[0].resources[0].details.components[0].name;break;case 112:c=e.associated_resources[0].resources[0].id,l=e.associated_resources[0].resources[0].details.module[0].api_name;break;case 1e3:if(u=void 0!==e.associated_resources[0].resources[0].id?e.associated_resources[0].resources[0].id:"",f=e.associated_resources[0].resources[0].details.showUrl,p=e.associated_resources[0].resources[0].details.crmUrl,""==u)return L||($L(t).addClass("alreadyClicked"),i.setNotificationAsSeen(d)),void commonUtils.showHideLoadingDiv(!1)}commonUtils.showHideLoadingDiv(!0),e=$(e),$L(".ziaNotificationClicked").removeClass("ziaNotificationClicked");var L=$L(t).hasClass("alreadyClicked");$L(t).addClass("alreadyClicked").addClass("ziaNotificationClicked");var I=$(".clickedSection"),R=$("#diNotificationDetails"),U="#diNotificationDetailsContent",S=$(U);Crm.trackSpotLightAction("AI Trend Dashboard - ZIA Notifications Click");var N={action:"details",id:d};if(m>=101&&m<150&&(N.action="diRuleDetails",Crm.client_tracking("AI Trend Dashboard - ZIA Notifications Click",{feature_id:m})),700!==m){var T=$L("crm-ziaforemails")[0];if(T)T.component.executeMethod("close")}if(801!==m){var z=$L("crm-emailsai-selfmarketing")[0];if(z)z.component.executeMethod("close")}if(800!==m){var F=$L("crm-ziaforcns")[0];if(F)F.component.executeMethod("close")}switch(N[csrfParamName]=csrfToken,m){case 112:Lyte.injectResources(networkUtils.returnDependencyFiles(["workflow-suggestion-components.js","workflow-recommendation.js"],ResourceConstants.CRMClient),void 0,(function(){store.batch((function(){commonUtils.showHideLoadingDiv(!0),store.findRecord("workflow_suggestion_details",c),store.findAll("field",{module:l})})).then((function(t){var o=t[0][0];if(i.showNotificationDetails(e,I,R,S),commonUtils.showHideLoadingDiv(),R.addClass("p0"),o.status&&"failure"===o.status)$("#dIchartTitle").text("No Suggestion Found");else{var n=o.execute_when,a="";"create"===n.type&&(a="Create"),"edit"===n.type&&(a="Edit"),o.fields=t[1],o.module.plural_name=store.model.module.data.filterBy({api_name:o.module.api_name})[0].plural_label,n.execute_on=I18n.getMsg("crm.workflow.rule.label.On"+a),S.empty(),$("#dIchartTitle").addClass("hide"),Lyte.Component.render("crm-workflow-suggestion-details-inner",{suggestion:o,call_from:"zia"},"#diNotificationDetailsContent")}}))}));break;case 301:i.showNotificationDetails(e,I,R,S),R.find(".jarvisClosebtn").hide();var A=!1;"undefined"!=typeof CrmAnalytics&&(A=!0),A?i.requestAnalyticsData(S,a,r,s):Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"].concat(networkUtils.includeChartFiles()).concat(networkUtils.getI18nJSUrl("dashboard")),ResourceConstants.CRM),void 0,(function(){CrmAnalytics.init(),CrmAnalytics.isAnomalyNotificationEnabled=!0,i.requestAnalyticsData(S,a,r,s)})),L||i.setNotificationAsSeen(d),commonUtils.showHideLoadingDiv(!1);break;case 105:i.showMacroSuggestion(d,e,S);break;case 667:L||i.setNotificationAsSeen(d),commonUtils.showHideLoadingDiv(!1);break;default:R.removeClass("p0");var P="action="+N.action+"&id="+d+"&"+csrfParamName+"="+csrfToken,E={url:Crm.getCrmBasePath()+"/crminotification.do",method:"POST",payLoad:P,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};Lyte.resolvePromises({dummy:store.findAll("dummy",{},!1,!1,E)}).then((t=>{var a=t.dummy.dummy,s=S;commonUtils.showHideLoadingDiv();var r=$(".jarvisFreeze");if(700===m)if(r.removeClass("showFreeze"),a.entityPresence){var c={response:a};viewMail(a.messageId,a.mailType,"Close",a.sentOrReceived,"","",!0,a.entityId,c,"",d,"",!0)}else{var l=$L("crm-ziaforemails")[0];if(l)l.component.executeMethod("close");_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.zia.email.cns.recorddeleted"),ltPropType:"error",ltPropDuration:"4000"}})}if(801===m)if(Lyte.Component.registeredComponents["crm-emailsai-selfmarketing"])Lyte.Mixin.get("crm-zianotification-helper").showSelfMarketingView(t);else{var g=networkUtils.returnDependencyFiles(["crm-emailsai-selfmarketing.js"],ResourceConstants.CRMClient),C=networkUtils.returnDependencyFiles(["crm-emailsai-selfmarketing.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),h=g.concat(C);Lyte.injectResources(h,void 0,(function(){Lyte.Mixin.get("crm-zianotification-helper").showSelfMarketingView(t)}))}if(800===m)if(r.removeClass("showFreeze"),a.entityPresence){c={response:a};viewMail(a.msgid,a.mailType,"Close","Received","","",!0,a.entityId,c,"",d,"",void 0,!0)}else{var y=$L("crm-ziaforcns")[0];if(y)y.component.executeMethod("close");_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.zia.email.cns.recorddeleted"),ltPropType:"error",ltPropDuration:"4000"}})}if(m>=0&&m<100)i.showAnomalyDetails(a,m);else if(m>100&&m<150)if($("#dIchartTitle").hide(),$("#wfDINotificationHeader").show(),Crm.isZohoChartsEnabled?thirdPartyUtils.unbindZohoCharts(s):thirdPartyUtils.unbindHighcharts(s),101===m||103===m||103===m||104===m){var v,b,M="";M=101===m||103===m?I18n.getMsg("crm.wf.di.duplicate.email.same.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[a.EmailModule].singular_label)]):I18n.getMsg("crm.wf.di.duplicate.email.diff.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[a.EmailModule].singular_label)]),a.IsSameTemplate&&(v=a.Rules[0].Alerts[0].EncryptedTemplateId,b=a.Rules[0].Alerts[0].TemplateName);var k='<a data-zcqa="btn_di_ignoreNotification" href="javascript:void(0)" onclick="Lyte.Mixin.get(\'crm-zianotification-helper\').ignoreNotification(\''+d+'\')" class="link">'+I18n.getMsg("crm.wf.di.btn.ignore")+"</a>";k=I18n.getMsg("crm.wf.di.ignore.desc",[k]),Lyte.Component.render("crm-wf-detail-page",{wfcase:"5",Data:a,EncryptedTemplateId:v,TemplateName:b,Description:M,NotificationId:d,IgnoreNotificationMsg:k},U)}else if(106===m){var L=a.Module,I=a.TotalCreatedModule,R=a.TotalCreatedModuleTouched,N=0;if(I>0){var T=100*(I-R);N=Math.floor(T/I)}var z=a.PluralLevelName,F=a.SingularLevelName,A=a.workFlowNotUsed.RulesDetails,P={Module:L,RulesDetails:A,TotalPercentage:N,PluralLevelName:z,SingularLevelName:F};Lyte.Component.render("crm-wf-detail-page",{wfcase:"1",Result:a,Data:P},U);var E=a.NotTouchedRecordsCounts;if(Crm.isZohoChartsEnabled){var x=!1;"undefined"!=typeof $ZC&&(x=!0),x?i.crmUsagePieChartZCharts(E,z):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM),void 0,(function(){i.crmUsagePieChartZCharts(E,z)}))}else{x=!1;"undefined"!=typeof Highcharts&&(x=!0),x?i.crmUsagePieChart(E,z):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM),void 0,(function(){i.crmUsagePieChart(E,z)}))}var j=E[1]||0;if(j>0){var O=I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(z)]);P={Module:L,UntouchedRecords:a.workFlowNotUsed.RecordsDetails},Lyte.Component.render("crm-wf-detail-page",{wfcase:"4",Data:P,Heading:O,HeadingVsI18n:a.workFlowNotUsed.RecordsHeadings,HeadingAvailable:a.workFlowNotUsed.HeadingAvailability},"#diNotificationDetailCase1Append")}var H=!1;a.workFlowNotUsed.RecordsDetails.length>0&&(H=!0);var B=$L("#wfcase1").parent("crm-wf-detail-page")[0].component;j>0&&!H&&B.setData("isRecordDeleted",!0),a.RuleNotUsedCount>0&&0===A.length&&B.setData("isRuleDeleted",!0)}else if(109===m){L=a.Module;var Z=a.UntouchedRecords.length;if(Z>0){var J=a.PluralLevelName;O=I18n.getMsg("crm.wf.di.records.without.any.followup",[I18n.getMsg(J)]);Lyte.Component.render("crm-wf-detail-page",{wfcase:"4",Data:a,Heading:O,HeadingVsI18n:a.RecordsHeadings,HeadingAvailable:a.HeadingAvailability,IsrecordSample:Z},U)}else s.html('<div class="m30 p30 aligncenter crm-medium-large-font-size">'+I18n.getMsg("crm.wf.di.records.deleted.error.msg")+"</div>")}else if(107===m||110===m){var W=$L.moment(a.ModifieyOn).toDate(),Y=a.IsDropped?"Drop":"Increased";Lyte.Component.render("crm-wf-detail-page",{wfcase:"2",Data:a,ModifiedOn:W.toDateString(),DroppedOrIncreased:Y},U),jQuery.isEmptyObject(a.CrtDetails)||(a.CrtDetails.isDICases=!0,WFAuditLog.renderWFAuditLogDiffComp({usecase:"updatedCondition",details:a.CrtDetails},"#diNotificationDetailsCase2CriteriaDetails"))}else 108!==m&&111!==m||i.showWFDetails108_111(a);else if(201===m){networkUtils.loadFeatureScripts(["zcrm_chatbot_Zia.js",networkUtils.getI18nJSUrl("AskZia"),networkUtils.getI18nJSUrl("Chatbot")],(function(){a.fromZiaNotification=!0,Lyte.Component.registeredComponents["crm-intelligence-config-result"]?Lyte.registeredMixins["crm-chatbot-helper"].ziaRenderResult(a,$("#diNotificationDetailsContent")):Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-chatbot-components.js","crm-chatbot-helper.js"],ResourceConstants.CRMClient),(function(){Lyte.registeredMixins["crm-chatbot-helper"].ziaRenderResult(a,$("#diNotificationDetailsContent"))}));var e=$("#dIchartTitle");e.text(a.name),e.removeClass("aligncenter").addClass("mB0")}))}else 501===m?i.showCompetitorAlertDetails(a,e,d):332===m?i.showChurnNotificationDetails(e,o):333===m?i.showPredictionNotificationDetails(e,o):338===m?i.showDefaultFieldPredictionNotificationDetails(e,w):334===m?i.showRecommendationNotificationDetails(e,n):400===m?i.showZiaComponentSuggestionsTypeNotifications(e):335===m?i.showRecommendationtypeNotifications(e):1e3===m?($L(".jarvisClosebtn").addClass("top25"),$L("#diNotificationDetailsContent").addClass("diPresenterHeight"),i.showPresentationDetails(e,u,f,p)):336===m?i.showSimilarityNotifications(e):337!==m&&339!==m||!D?(320===m&&_||309===m)&&i.showCVAnomaly(e[0]):i.showNbxNotificationDetails(e)}),(()=>{S.append("Notification Details Unavailable"),commonUtils.showHideLoadingDiv(!1)})),h||y||C||g||v||!(337!==m&&339!==m||D)||330===m||331===m||666===m||320===m||309===m||i.showNotificationDetails(e,I,R,S)}Crm.client_tracking("Zia Notification - message viewed")},showSelfMarketingView:function(e){Lyte.Component.render("crm-emailsai-selfmarketing",{data:e.dummy.dummy},"#cns")},showMacroSuggestion:function(e,t,i){var o,n=this,a=$(".clickedSection"),s=$("#diNotificationDetails"),r=t.hasClass("alreadyClicked"),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("macrosuggestion")],ResourceConstants.CRM),l=networkUtils.returnDependencyFiles(["macro-suggestion-components-zia.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["macro-suggestion-common.js","macro-suggestion-model.js"],ResourceConstants.CRMClient);o=!0===Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-macrosuggestions-listview-rtl.css","crm-macrosuggestions-listview.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["crm-macrosuggestions-listview.css"],ResourceConstants.CRMClient);var m=c.concat(l).concat(d).concat(o);Lyte.injectResources(m,void 0,(function(){store.findAll("macro_suggestion",{include_inner_details:"module.display_label,field_updates.field.field_label,field_updates.field.ui_type"}).then((function(o){n.showNotificationDetails(t,a,s,i);var c=i,l={},d=[];$("#dIchartTitle").hide(),Crm.isZohoChartsEnabled?thirdPartyUtils.unbindZohoCharts(c):thirdPartyUtils.unbindHighcharts(c),commonUtils.showHideLoadingDiv(),o||(o=[]);for(var m=o,u=m.length,f=0;f<u;f++){var p=m[f];p.macroName="",p.isMacroNameValid=!1,p.savErrorMsg="";var g=p.created_on.split("-"),C=parseInt(g[0]),h=parseInt(g[1])-1,y=parseInt(g[2]),v=n.processDateString($L.moment(`${C}/${h}/${y}`,"YYYY/MM/DD").toDate(),!0);p.displaydate=v;var D=l[v];d.indexOf(v)<0&&(d.push(v),D=[],l[v]=D),D.push(p)}Lyte.Component.render("crm-macrosuggestions-zia",{dateWiseArr:l},"#diNotificationDetailsContent"),!r&&o.length>0&&n.setNotificationAsSeen(e)}),(function(){commonUtils.showHideLoadingDiv(),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.security.error.add.user"),ltPropType:"error",ltPropDuration:"1500"}}),i.append("Notification Details Unavailable")}))}))},requestAnalyticsData:function(e,t,i,o){if($("#dIchartTitle").removeClass().addClass("widgetHeading").html($ESAPI.encoder().encodeForHTML(i)),newDashbordsEnabled){s=[a=networkUtils.returnDependencyFiles(["crm-analytics-new.js","crm-analytics-chart.js","crm-analytical-component-model.js","zia-notification-settings.js","crm-analytics-components.js","crm-analytics-chart-table.js","Analytics.js","gamescope-grid.js","model-crm-report.js","crm-report-util.js","crm-lyte-slider.js"],ResourceConstants.CRMClient),n=(n=networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM))];Lyte.injectResources(s,void 0,(function(){Lyte.Component.render("crm-analytics-notification-layout",{component_id:t,component_name:i,dashboard_id:o},"#diNotificationDetailsContent"),Lyte.registeredMixins["crm-dashboard-utils"].fetchComponentAndRenderChart(o,t,"notify_"+t,void 0,!1,void 0,!0,void 0)}))}else{var n,a=networkUtils.returnDependencyFiles(["crm-analytics.js","lyte-progressbar.js","crux-form-component.js"],ResourceConstants.CRMClient);n=(n=(n=(n=networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-strategy.css","crm-analytics-v3-pitch.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-analytics.css","crm-analytics-anomaly-table.css","crm-analytics-v3-pitch.css","crm-analytics-strategy.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["analytics-zia-pitch.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["analytics-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(n=n.concat(networkUtils.returnDependencyFiles(["crm-analytics-rtl.css"],ResourceConstants.CRMClient)));var s=[a,n];Lyte.injectResources([s],void 0,(function(){if(Lyte.Component.render("crm-analytics-notification-layout",{component_id:t,component_name:i,dashboard_id:o},"#diNotificationDetailsContent"),void 0===CrmAnalytics.isNewAnomalyNotificationEnabled){CrmAnalytics.getApiData("/crm/v2/__internal/Analytics/actions/new_anomaly_notification",crmConstants.requestMethods.GET,(function(e){CrmAnalytics.isNewAnomalyNotificationEnabled=e.new_anomaly_notification.enabled,CrmAnalytics.loadComponentData(t,o,void 0,void 0,!1,!0)}))}else CrmAnalytics.loadComponentData(t,o,void 0,void 0,!1,!0)}))}},setNotificationAsSeen:function(e){var t="action=setseen&id="+e+"&"+csrfParamName+"="+csrfToken,i={url:Crm.getCrmBasePath()+"/crminotification.do",method:"POST",payLoad:t,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};store.findAll("dummy",{},!1,!1,i)},updateCVAnomalySeen:function(e){var t="action=cvanomalyseen&id="+e+"&"+csrfParamName+"="+csrfToken,i={url:Crm.getCrmBasePath()+"/crminotification.do",method:"POST",payLoad:t,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};store.findAll("dummy",{},!1,!1,i)},showNotificationDetails:function(e,t,i,o){var n=i.is(":visible");i.find(".jarvisClosebtn").show(),$L("#dIchartTitle").show();var a=$L(".jarvisFreeze");a.show(),a.addClass("showFreeze"),a[0].style.display="block",$L("body").addClass("oH"),t.addClass("alreadyClicked"),t.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection");var s=0;n||(i.css({display:"inline-block"}),crmui.modalZIndex("wmsbar",i[0],"open"),clearTimeout(s),s=setTimeout((function(){var t=201===parseInt(e.data("featureid"))?"400px":"900px";Crm.userDetails.RTL_ENABLED?i.css({left:"437px",width:t}):i.css({right:"437px",width:t})}),30)),o.empty()},crmUsagePieChartZCharts:function(e,t){var i=e[9]||0,o=e[2]||0,n=e[1]||0,a=e[4]||0,s=$(".chartC");s.empty();var r={legend:{layout:"vertical",colors:["#52519e","#1cadda","#1e4f2e","#ee5b2e"],vAlign:"center",hAlign:"right",showAs:"{{val(0)}} - {{val(1)}}",marginLeft:0,marginRight:75,maxWidth:"70%",fontSize:14,fontWeight:"bolder",itemHeight:25,highlightEffect:{selectedSeries:"illuminate"},colorBox:{strokeWidth:10},textPadding:15},tooltip:{backgroundColor:"var(--bg_white)",fontColor:"var(--baseColor)",borderRadius:1,opacity:1,maxWidth:"100%",borderWidth:"2"},chart:{plot:{plotoptions:{pie:{outerPadding:15,maxRadius:105}}},marginLeft:0},metadata:{axes:{x:[0],y:[[1]],tooltip:["<div class='p10'><div class='fL cBoth mB3 crm-font-regular' style='font-size:14px'>{{val(0)}} -  {{val(1)}} </div><div class='fL cBoth mB3 crm-font-bold' style='font-size:14px'>{{per(1)}}</div></div>"]},columns:[{dataindex:0,columnname:"Year(Date)",datatype:"ordinal"},{dataindex:1,columnname:"Sum(Sales)",datatype:"numeric"}]},seriesdata:{chartdata:[{type:"pie",data:[[[I18n.getMsg("crm.wf.di.unused.records.import",[I18n.getMsg(t)]),i],[I18n.getMsg("crm.wf.di.unused.records.api",[I18n.getMsg(t)]),o],[I18n.getMsg("crm.wf.di.unused.records.other",[I18n.getMsg(t)]),a],[I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(t)]),n]]]}]},canvas:{shadow:{show:!1},title:{show:!1},subtitle:{show:!1},border:{show:!1},fontColor:"var(--baseColor)",background:{color:null}}};CrmChartUtil.renderChart(s[0],r,!0)},crmUsagePieChart:function(e,t){var i=this,o=e[9]||0,n=e[2]||0,a=e[1]||0,s=e[4]||0;$(".chartC").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},credits:{enabled:!1},tooltip:{enabled:!0,useHtml:!0,formatter:function(){return"<div class='fL cBoth mB3 crm-font-regular' style='font-size:14px'>"+this.key+" - "+this.y+"</div><div class='fL cBoth crm-font-bold' style='font-size:14px'>"+this.percentage.toFixed(1)+" %</div>"},pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0,center:[90,90]}},legend:{floating:!0,align:"left",verticalAlign:"middle",useHTML:!0,layout:"vertical",labelFormatter:function(){return 0===this.index?'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR crmBaseColor removehovele">'+this.y+'</span><span class="dIB wfInfoIconDet cP" onmouseover="crmui.showTooltip(\''+I18n.getMsg("crm.wf.di.notification.import.info")+"',false,'center',this)\" onmouseout=crmui.hideTooltip()></span></div>":1===this.index?'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR crmBaseColor removehovele">'+this.y+'</span><span class="dIB wfInfoIconDet cP" onmouseover="crmui.showTooltip(\''+I18n.getMsg("crm.wf.di.notification.api.info")+"',false,'center',this)\" onmouseout=crmui.hideTooltip()></span></div>":'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR crmBaseColor removehovele">'+this.y+"</span></div>"},itemMarginTop:5,itemMarginBottom:10,x:240,symbolRadius:4,symbolHeight:20,borderWidth:0,symbolWidth:20,shadow:!1},series:[{name:"Brands",colorByPoint:!0,data:[{name:I18n.getMsg("crm.wf.di.unused.records.import",[I18n.getMsg(t)]),y:o,color:"#52519e"},{name:I18n.getMsg("crm.wf.di.unused.records.api",[I18n.getMsg(t)]),y:n,sliced:!1,selected:!1,color:"#1cadda"},{name:I18n.getMsg("crm.wf.di.unused.records.other",[I18n.getMsg(t)]),y:s,color:"#1e4f2e"},{name:I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(t)]),y:a,color:"#ee5b2e"}]}]},(function(e){for(var t=[$(".chartC .highcharts-legend-item .labelLegendForm"),$(".chartC .labellegentNum"),$(".chartC .highcharts-legend .highcharts-legend-item"),$(".chartC .highcharts-legend-item span")],o=t.length,n=0;n<o;n++)i.removeLegendHoverAnimationPieChart(t[n],e)}))},showChurnNotificationDetails:function(e,t){commonUtils.showHideLoadingDiv(!0),(e=$(e)).addClass("ziaNotificationClicked");var i=$(".clickedSection"),o=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");i.addClass("alreadyClicked"),i.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),o.show(),n.removeClass("p0");var a=networkUtils.returnDependencyFiles(["zia/prediction/builder/churn-prediction.js","crux-criteria-component.js","crux-criteria-conditions.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-mixins.js","zia-commons.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["crm-zia-error.css"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-common.css","zia/prediction/builder/churn-prediction.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaCommon"),networkUtils.getI18nJSUrl("Prediction"),networkUtils.getI18nJSUrl("ChurnPrediction")],ResourceConstants.CRM),m=a.concat(s).concat(r).concat(c).concat(l).concat(d);Lyte.injectResources(m,void 0,(function(){Lyte.resolvePromises({prediction:store.findRecord("churn_prediction",t)}).then((function(e){var t=e.prediction[0];if(void 0!==t){var i=void 0!==moduleRecordMapping.Consents&&(Crm.userDetails.privacyPrefEnabledModules.contains(t.customer_module.module_name)||Crm.userDetails.privacyPrefEnabledModules.contains(t.payment_module.module_name));Lyte.resolvePromises({module:store.findRecord("module",t.customer_module.id),unused_fields:store.findAll("field",{module:t.customer_module.api_name,type:"Unused"}),related_module:store.findRecord("module",t.payment_module.id),unused_rfields:store.findAll("field",{module:t.payment_module.api_name,type:"Unused"}),consent_module:i?store.findRecord("module",moduleRecordMapping.Consents.id,void 0,void 0,void 0,{getFields:!0}):[],prediction_meta:store.findRecord("dummy",t.id,{},void 0,!1,{url:"crm/v2.2/settings/zia/predictions/"+t.id+"/models"})}).then((function(e){commonUtils.showHideLoadingDiv(!1),e.unused_fields.map((function(e){e.unused=!0})),e.unused_rfields.map((function(e){e.unused=!0})),Lyte.registeredMixins["crm-prediction-route-utils"].processPredictionMeta(t,{meta:e.prediction_meta.models},"churn").then((function(e){e.isFromNotification=!0,Lyte.Component.render("crm-churn-prediction-view",e,"#diNotificationDetailsContent")})),$L("#dIchartTitle").hide()}))}else commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showPredictionNotificationDetails:function(e,t){commonUtils.showHideLoadingDiv(!0),(e=$(e)).addClass("ziaNotificationClicked");var i=$(".clickedSection"),o=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");i.addClass("alreadyClicked"),i.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),o.show(),n.removeClass("p0");var a=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction.js","crux-criteria-component.js","crux-criteria-conditions.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-mixins.js","zia-commons.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["crm-zia-error.css"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-common.css","zia/prediction/builder/field-prediction.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaCommon"),networkUtils.getI18nJSUrl("Prediction"),networkUtils.getI18nJSUrl("FieldPrediction")],ResourceConstants.CRM),m=a.concat(s).concat(r).concat(c).concat(l).concat(d);Lyte.injectResources(m,void 0,(function(){Lyte.resolvePromises({prediction:store.findRecord("field_prediction",t)}).then((function(e){var i=e.prediction[0];void 0!==i?Lyte.resolvePromises({module:store.findRecord("module",i.module.id),consent_module:void 0!==moduleRecordMapping.Consents&&Crm.userDetails.privacyPrefEnabledModules.contains(i.module.module_name)?store.findRecord("module",moduleRecordMapping.Consents.id,void 0,void 0,void 0,{getFields:!0}):void 0,unused_fields:store.findAll("field",{module:i.module.api_name,type:"Unused"}),prediction_meta:store.findRecord("dummy",t,{},void 0,!1,{url:"crm/v2.2/settings/zia/predictions/"+t+"/models"})}).then((function(e){commonUtils.showHideLoadingDiv(!1),e.unused_fields.map((function(e){e.unused=!0})),Lyte.registeredMixins["crm-prediction-route-utils"].processPredictionMeta(i,{meta:e.prediction_meta.models},"field").then((function(e){e.isFromNotification=!0,Lyte.Component.render("crm-field-prediction-view",e,"#diNotificationDetailsContent")})),$L("#dIchartTitle").hide()})):(commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent"))}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showRecommendationNotificationDetails:function(e,t){(e=$(e)).addClass("ziaNotificationClicked");var i=$(".clickedSection"),o=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");t=t;i.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),o.show(),n.removeClass("p0");var a=networkUtils.returnDependencyFiles(["recommendation-detailed.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["recommendation-detailed.js","orchestration_config.js","zia-helpers.js","crux-criteria-component.js","crux-criteria-conditions.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],ResourceConstants.CRM),l=s.concat(a).concat(c).concat(r);Lyte.injectResources(l,void 0,(function(){Lyte.resolvePromises({recommendation:store.findRecord("recommendations",t)}).then((function(e){var t=e.recommendation;if(void 0!==t&&void 0!==t.id){var i=[],o=[],n=[];n.push(t.what_module.id),n.push(t.whom_module.id),n.push(t.based_module.id),n.forEach((function(e){var t=e;if(!i.contains(t)){i.push(t);var n=void 0===store.peekRecord("module",t).fields||0===store.peekRecord("module",t).fields.length?store.findRecord("module",t,void 0,void 0,void 0):store.peekRecord("module",t);o.push(n)}})),Lyte.resolvePromises({recommendationJson:t,prom1:Lyte.resolvePromises(o)}).then((function(e){var i={isNotification:!0,recommendationJson:e.recommendationJson,what_fields:t.what_module.fields,whom_fields:t.whom_module.fields,based_fields:t.based_module.fields,profilename:Crm.userDetails.PROFILE_NAME,records_count:networkUtils.lyteInitiateRequest("/crm/v2.2/settings/zia/recommendations/"+t.id+"/actions/record_count","GET",null)};$L("#dIchartTitle").hide(),Lyte.Component.render("crm-recommendation-detailedview",i,"#diNotificationDetailsContent")}))}else Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}),(function(){Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showZiaComponentSuggestionsTypeNotifications:function(e){const t=e[0].associated_resources[0].resources.config;var i=networkUtils.returnDependencyFiles(["analytics-zia-suggestions.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),o=networkUtils.returnDependencyFiles(["zia-component-suggestions-component.js","zia-component-suggestion-model.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaComponentSuggestions")],ResourceConstants.CRM),a=o.concat(i).concat(n);Crm.client_tracking("Zia CS - Notification",{Type:"Anomaly",Loc:"View point"}),Lyte.injectResources(a,void 0,(function(){$L("#dIchartTitle").empty(),Lyte.Component.render("zia-component-suggestions-notification",{config:t},"#diNotificationDetailsContent")}))},showRecommendationtypeNotifications:function(e){var t=this;(e=$(e)).addClass("ziaNotificationClicked");var i=$(".clickedSection"),o=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails"),a=e[0].recommendation_notifications;i.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),o.show(),n.removeClass("p0");var s=networkUtils.returnDependencyFiles(["recommendation-notification-list.css"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["recommendation-notification-list.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],ResourceConstants.CRM),d=r.concat(c).concat(s).concat(l),m=function(e,t,i,o){var n=-e.getTimezoneOffset(),a=n>=0?"+":"-",s=function(e){var t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return e.getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+"T"+s(t)+":"+s(i)+":"+s(o)+a+s(n/60)+":"+s(n%60)},u=null;if("re_buy"===a.suggestion_type_api_name){var f=parseInt(a.re_buy_date);u=[m($L.moment(f).toDate(),0,0,0),m($L.moment(f).toDate(),23,59,59)]}var p=store.peekRecord("module",a.whom_module_id),g=store.peekRecord("module",a.what_module_id),C=[a.suggestion_type,p.plural_label],h=I18n.getMsg("zia.recommendation.notification.list.title",C),y=a.recommendation_id,v=a.notification_id,D=p.api_name,_="/crm/v2.2/settings/zia/recommendations/"+y+"/notifications/"+v+"/notification_info";commonUtils.showHideLoadingDiv(!0);var w=store.findRecord("custom_view",p.cvid,{module:p.api_name}),b=store.findAll("field",{module:D}),M="/crm/v2/"+D,k={params:{ids:null}},L={},I=networkUtils.lyteInitiateRequest(_,"GET",{skip_load_tab:!0}),R="/crm/v2.2/settings/zia/recommendations/"+y+"/notifications/"+v,U=networkUtils.lyteInitiateRequest(R,"GET"),S=[];Promise.all([w,b,I,U]).then((function(e){if(void 0!==e[0]&&void 0!==e[0].fields&&void 0!==e[1]&&0!==e[1].length&&void 0!==e[2]&&void 0!==e[2].notification_info&&e[3]&&e[3].recommendation_notifications){for(var i=e[0].fields,o=e[1],n=i.length,s=o.length,r=0;r<n;r++)for(var c=0;c<s;c++)if(i[r].id===o[c].id){S.push(o[c]);break}var l=function(e,t){var i={comparator:"equal",value:e,field:{api_name:"Item_Id__s"}},o={comparator:"between",value:t,field:{api_name:"Bought_Date__s"}},n={api_name:"frequently_bought_together"===a.suggestion_type_api_name?"bundle_whom":"customer_also_bought"===a.suggestion_type_api_name?"cross_selling_whom":a.suggestion_type_api_name+"_whom"};return e?"re_buy"===a.suggestion_type_api_name?JSON.stringify([{include_objects:!0,relation:n,criteria:{group_operator:"and",group:[i,o]}}]):JSON.stringify([{include_objects:!0,relation:n,criteria:i}]):JSON.stringify([{include_objects:!0,relation:n,criteria:{comparator:"not_equal",value:"${EMPTY}",field:{api_name:"Item_Id__s"}}}])}(e[3].recommendation_notifications[0].selected_records,u),m=e[2].notification_info,f=m[0].whom_to.id;L[m[0].whom_to.id]=m[0].what_to;for(var C=m.length,y=1;y<C;y++)f=f+","+m[y].whom_to.id,L[m[y].whom_to.id]=m[y].what_to;k.params.ids=f,k.skip_load_tab=!0;var v=null;networkUtils.lyteInitiateRequest(M,"GET",k).then((function(e){if(void 0!==e){var i={};i.whatModule=!0===g.module_name.includes("CustomModule")?"CustomModule":g.api_name,i.whomModule=!0===p.module_name.includes("CustomModule")?"CustomModule":p.api_name;var o={module:JSON.stringify({whatModule:i.whatModule,whomModule:i.whomModule}),suggestion_type:a.suggestion_type_api_name};Crm.client_tracking("Zia Recommendation Notification ZiaPanelView",o),v=e.data,Lyte.injectResources(d,void 0,(function(){var e={query_params:{}};e.query_params.cross_filters=l,e.contentTitle=h,e.whomToVwhatTo=L,e.whomToRecords=v,e.whomToFields=S,e.whom_module=p,e.whatModuleSingularLabel=g.singular_label,$L("#dIchartTitle").hide(),commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-recommendation-notification-list",e,"#diNotificationDetailsContent")}))}else t.renderZiaError()}),(function(){t.renderZiaError()}))}else t.renderZiaError()}),(function(){t.renderZiaError()}))},removeLegendHoverAnimationPieChart:function(e,t){$(e).each((function(e,i){$(i).hover((function(){return $(i).parent().css("cursor","default"),!1}),(function(){t.tooltip.hide()}))}))},showAnomalyDetails:function(e,t){$("#dIchartTitle").html(I18n.getMsg(e.title,[I18n.getMsg(e.title.split(" ")[0])])).show(),$("#wfDINotificationHeader").hide(),CrmDashboard.reprocessTrendAnalysisResponse(e),e.start=0,e.end=e.currentPeriodIndex?e.currentPeriodIndex+1:7,CrmDashboard.createTrendDashboardGraph("diNotificationDetailsContent",e,t)},showCVAnomaly:function(e){if(e.associated_resources[0].details){var t=networkUtils.returnDependencyFiles(["zia/anomaly/customview_result.js","zia/anomaly/customview_mixin.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CVAnomalyResult")],ResourceConstants.CRM),o=networkUtils.returnDependencyFiles(["zia/anomaly/customview_result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=t.concat(o).concat(i);Lyte.injectResources(n,void 0,(function(){var t={};t.anomaly=e,Lyte.registeredMixins["cv-anomaly-utils"].openAnomalyDetails(t,void 0,"cvAnomalyNotificationResult","notification")}))}else Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")},showNbxNotificationDetails:function(e){(e=$(e)).addClass("ziaNotificationClicked");var t=$(".clickedSection"),i=e.find(".ziaSeemorecontainer"),o=$("#diNotificationDetails");t.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),i.show(),o.removeClass("p0");var n=e[0].associated_resources[0].resources[0].relation,a={api_name:n=Crm.userDetails.isRelatedModuleFilters?n+"__r":n},s=7===e[0].associated_resources[0].resources[0].type?337:339,r=networkUtils.returnDependencyFiles(["recommendation-notification-list.css"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["recommendation-notification-list.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaNbxNotification")],ResourceConstants.CRM),d=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),m=c.concat(r).concat(l);commonUtils.showHideLoadingDiv(!0);var u=337===s?moduleRecordMapping.Potentials:moduleRecordMapping.Leads,f=I18n.getMsg("crm.zia.nba.feature.label"),p=u.api_name,g=moduleRecordMapping[337===s?"Potentials":"Leads"].cvid,C=[],h=function(){var e=moduleRecordMapping[337===s?"Potentials":"Leads"].NBX,t=[];Crm.userDetails.permissions.Crm_Implied_View_Calls&&t.push("Calls"),Crm.userDetails.permissions.Crm_Implied_View_Events&&t.push("Events"),Crm.userDetails.permissions[337===s?"Crm_Implied_Send_Mail_Potentials":"Crm_Implied_Send_Mail_Leads"]&&t.push("Emails");var i={comparator:"equal",value:t,field:{api_name:e.action.api_name}},o=$L.moment().toDate();o.setTime(o.getTime()-6e4*o.getTimezoneOffset()),o=o.toISOString().split(/\./)[0];var n={comparator:"less_equal",value:"${DUEINDAYS}+30",field:{api_name:e.duration.api_name}},r={group_operator:"and",group:[{comparator:"greater_than",value:o,field:{api_name:e.duration.api_name}},n]};return JSON.stringify([{include_objects:!0,relation:a,criteria:{group_operator:"and",group:[i,r]}}])}(),y=337===s?JSON.stringify({comparator:"equal",field:{api_name:"Stage"},value:"${OPEN}",from:"NBX"}):void 0,v=store.findRecord("custom_view",g,{module:p}),D=store.findAll("field",{module:p,type:"all"},void 0,!0,{apiVersion:"2.2"}),_=new FormData;_.append("cross_filters",h),y&&_.append("filters",y);var w="/bulk?page=1&approved=both&cvid="+g+"&per_page=10",b=337===s?"crm/v2.2/Deals"+w:"crm/v2.2/Leads"+w,M=store.findAll("dummy",{},!1,!1,{url:b,method:"POST",payLoad:_});Promise.all([v,D,M]).then((function(e){if(void 0!==e[0]&&void 0!==e[1]&&void 0!==e[2]){for(var t=e[0].fields,i=e[1],o=e[2].dummy.data,n=void 0===o||o.length<1,a=t.length,s=i.length,r=0;r<a;r++)for(var c=0;c<s;c++)if(t[r].id===i[c].id){C.push(i[c]);break}Lyte.injectResources(m,void 0,(function(){var e={query_params:{}};e.query_params.cross_filters=h,e.query_params.filters=y,e.contentTitle=f,e.whomToVwhatTo=void 0,e.whomToRecords=o,e.isNoData=n,e.whomToFields=C,e.whom_module=u,e.whatModuleSingularLabel=u.singular_label,e.featureName="NBX",$L("#dIchartTitle").hide(),$L("#diNotificationDetailsContent").empty(),Lyte.Component.render("crm-recommendation-notification-list",e,"#diNotificationDetailsContent"),commonUtils.showHideLoadingDiv(!1)}))}else Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}),(function(){Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showSimilarityNotifications:function(e){(e=$(e)).addClass("ziaNotificationClicked");var t=$(".clickedSection"),i=e.find(".ziaSeemorecontainer"),o=$("#diNotificationDetails"),n=e[0];t.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),i.show(),o.removeClass("p0");var a=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles(["recommendation-similarity-detailed.js","zia-error.js","crux-criteria-component.js","crux-criteria-conditions.js","similarity-model.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM),c=s.concat(a).concat(r),l={errorMsg:I18n.getMsg("zia.similarity.error.message")},d=n.associated_resources[0].resources[0].similarity_id;Lyte.injectResources(c,void 0,(function(){commonUtils.showHideLoadingDiv(!0),store.findRecord("similarity",d).then((function(e){if(!e||void 0===e[0]||!e[0].hasOwnProperty("module"))return commonUtils.showHideLoadingDiv(!1),void Lyte.Component.render("crm-zia-error",l,"#diNotificationDetailsContent");store.findRecord("module",e[0].module.id).then((function(t){var i={};i.similarity=e[0],i.module=t[0],i.similarity.module=i.module,i.isNotification=!0,$L("#dIchartTitle").hide(),commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-similarity-detailedview",i,"#diNotificationDetailsContent")}))}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",l,"#diNotificationDetailsContent")}))}))},showCompetitorAlertDetails:function(e,t,i){var o=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.js","crm-competitors-utilities.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.css"],ResourceConstants.CRMClient);Lyte.injectResources(o.concat(n),void 0,(function(){var t={notificationObjs:[{id:i,from:"di-notification",metadata:e.metadata,signal:{namespace:crmNTC.MAIL_INCOMING_COMPETITORS_ALERT,display_label:crmNTC.MAIL_INCOMING_COMPETITORS_ALERT,extension:{namespace:crmNTC.EXT_EMAILTRACKING,display_label:I18n.getMsg(crmNTC.EXT_EMAILTRACKING)}},date:e.date}]};$L("#diNotificationDetailsContent").html(Handlebars.templates.signalDetailViewTemplate(t)),t={notificationObj:t.notificationObjs[0],entityObj:e.entity_info},$L("#ntc-detailv-content-"+i).html(Handlebars.templates.signalEmailDetailView(t)),$L("#dIchartTitle").hide()})),Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson=e},showWFDetails108_111:function(e){var t=this,i=e.TemplateOpenInfoOnModified,o=i.OpenedBeforeModification,n=i.DeliveredBeforeModification,a=i.BouncedBeforeModification,s=n+a,r=i.ClickedBeforeModification,c=i.OpenedAfterModification,l=i.DeliveredAfterModification,d=i.BouncedAfterModification,m=l+d,u=i.ClickedAfterModification,f=s>m,p=s>m?t.findPercentage(s,s-m):t.findPercentage(m,m-s),g=t.findPercentage(s,n),C=t.findPercentage(m,l),h=t.findPercentage(n,o),y=t.findPercentage(l,c),v=t.findPercentage(o,r),D=t.findPercentage(c,u);e.WFOrTemplate=I18n.getMsg(e.WFOrTemplate);var _=e.IsDrop?"Drop":"Increased",w=$L.moment(e.ModifieyOn).toDate(),b=[{bCount1:s,aCount1:m,Name1:I18n.getMsg("Sent"),IsDropped:f,Per:p},{Name1:I18n.getMsg("Delivered"),Name2:I18n.getMsg("Bounced"),bCount1:n,bPer1:g,bCount2:a,bPer2:s>0?100-g:0,aCount1:l,aPer1:C,aCount2:d,aPer2:m>0?100-C:0},{Name1:I18n.getMsg("Opened"),Name2:I18n.getMsg("crm.templatestats.label.unopened"),bCount1:o,bPer1:h,bCount2:n-o,bPer2:n>0?100-h:0,aCount1:c,aPer1:y,aCount2:l-c,aPer2:l>0?100-y:0,IsDropped:e.IsDrop,Per:e.LessUsgePercentage},{Name1:I18n.getMsg("Clicked"),bCount1:r,bPer1:v,aCount1:u,aPer1:D}];Lyte.Component.render("crm-wf-detail-page",{wfcase:"3",detailInfoCount:b,Result:e,DroppedOrIncreased:_,ModifiedOn:w.toDateString()},"#diNotificationDetailsContent"),t.matchWidthinDiffTable(),t.matchWidthinDiffTableForSecond(),jQuery.isEmptyObject(e.CrtDetails)||(e.CrtDetails.isDICases=!0,WFAuditLog.renderWFAuditLogDiffComp({usecase:"updatedCondition",details:e.CrtDetails},"#diNotificationDetailsCase2CriteriaDetails"))},showDefaultFieldPredictionNotificationDetails:function(e,t){commonUtils.showHideLoadingDiv(!0),(e=$(e)).addClass("ziaNotificationClicked");var i=$(".clickedSection"),o=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");i.addClass("alreadyClicked"),i.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),o.show(),n.removeClass("p0");var a=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction.css","zia/prediction/builder/prediction-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles(["zia/prediction/builder/prediction-mixins.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaCommon"),networkUtils.getI18nJSUrl("DefaultFieldPrediction")],ResourceConstants.CRM),l=networkUtils.returnDependencyFiles(["zia-error.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["crm-zia-error.css"],ResourceConstants.CRMClient),m=a.concat(s).concat(r).concat(c).concat(l).concat(d);Lyte.injectResources(m,void 0,(function(){commonUtils.showHideLoadingDiv(!0);for(var e=Lyte.registeredMixins["crm-prediction-utils"].getAvailableModulesByFeature(),i=e.length,o=0;o<i;o++)if("Deals"===e[o].api_name){var n=e[o].id;break}void 0!==n?Lyte.resolvePromises({module:store.findRecord("module",n)}).then((function(){Lyte.Component.render("crm-default-prediction-detail-page",{notificationBatch:t},"#diNotificationDetailsContent")}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")})):(commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent"))}))},findPercentage:function(e,t){var i=0;return e>0&&(i=100*t/e),Math.floor(i)},matchWidthinDiffTable:function(){for(var e=0,t=0;t<=3;t++){var i=$("#templateSubColTab_"+t).outerWidth();i>e&&(e=i)}$(".templateSubColTabWidth").css({width:e})},matchWidthinDiffTableForSecond:function(){for(var e=0,t=0;t<=3;t++){var i=$("#templateSubColTabSecond_"+t).outerWidth();i>e&&(e=i)}$(".templateSubColTabSecondWidth").css({width:e})},loadAnimation:function(e,t,i){t.removeClass("ziaCountActive zia-active"),this.hideDiNotification(),$(".crm-wms-icon").removeClass("blinkEl"),$(e).addClass("blinkEl"),i.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),$("#diNotificationDetails").off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),$(".remainder-notifi,#LDPOP").hide(),hideFeedBackPopup(),massActionNotification.hideMassOperationProgressDiv(),$(".timericon,#wVisTitBar").removeClass("footIconActive timericonAct ldchatPop_active")},fromFooter:function(e){var t=(e=$(e)).outerHeight();0!==this.cFlag?(e.css({bottom:"-"+t+"px",display:"block"}),e.css({bottom:"26px"})):(crmui.fromFooter("diNotificationDiv"),this.cFlag=1)},processAPIresponse:function(e){if(e.__zia_notifications=void 0!==e.__zia_notifications?e.__zia_notifications:e,0===e.__zia_notifications.length)return{fromFilter:!1,noNotification:!0,showMarkAllAsRead:!1};var t,i,o=this,n=0,a=0,s=0,r=0,c=0,l=0,d=0,m=0,u=0,f=0,p=0,g=0,C=0,h=0,y=[],v=[],D=[],_=[],w=[],b=[],M=[],k=[],L=[],I=[],R=[],U=[],S=[],N=e.__zia_notifications,$=!1,T=e.__zia_notifications.$.meta.more_records,z=[];t=void 0!==Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled&&Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled,(i=void 0!==Crm.userDetails.CUSTOMIZE_INFO.unread_only&&Crm.userDetails.CUSTOMIZE_INFO.unread_only)&&(N=N.filter((function(e){return!1===e.read})));for(var F=N.map(((e,t)=>"email_extracted_activities"===e.type&&void 0===e.summary?t:"")).filter(String),A=F.length-1;A>=0;A--)N.splice(F[A],1);var P=[];if(e.categorize){var E=e.categorize.categorize;if(E){var x=E.length;for(A=0;A<x;A++)P.push(E[A].value);-1!==P.indexOf("anomaly")&&-1!==P.indexOf("analytics")&&P.splice(P.indexOf("analytics"),1,"")}}else{var j=$L("crm-zianotification-popup")[0];j&&(P=j.component.data.availableFeatures)}var O="";return N.forEach((function(e){e.date=e.notification_time;var t=e.date.split("-"),i=parseInt(t[0]),N=parseInt(t[1]),T=parseInt(t[2]),F=o.processDateString($L.moment(i+"/"+N+"/"+T,"YYYY/MM/DD").toDate(),!0);switch(O!==F?(e.date=F,O=F):e.date=void 0,e.read?e.cls="jarvisSectionBox alreadyClicked":(e.cls="jarvisSectionBox",$=!1===$||$),e.type){case"prediction":var A=$ESAPI.encoder().encodeForHTML(e.associated_resources[0].resources[0].name);e.title=$ESAPI.encoder().encodeForHTML(e.title);var P=e.associated_resources[0].resources[0].createdBy,E=e.associated_resources[0].resources[0].details.module[0].id,x=[];x.push(A);var j=store.peekRecord("module",E);void 0!==j?x.push(j.$.get("plural_label")):x.push(""),-1!==e.summary.indexOf("{2}")&&x.push(P);var H=I18n.getMsg(e.summary,x);e.summary=H,y[n]=[e],n++,e.iconClass="configSetup";break;case"default_prediction":e.iconClass="suggestionAI";break;case"zia_score":e.iconClass="configSetup";break;case"presentation":e.iconClass="ziapresentIcon";var B=[],Z="",J="Dashboard";N="April";e.associated_resources[0]&&e.associated_resources[0].resources[0].month&&(N=e.associated_resources[0].resources[0].month),e.associated_resources[0].resources[0].name?(e.title=I18n.getMsg("crm.ziapresentation.title.dashboard"),e.type="dashboard_presentation",J=$ESAPI.encoder().encodeForHTML(e.associated_resources[0].resources[0].name)):e.associated_resources[0].resources[0].config_name&&(e.type="presentation",B[0]=$ESAPI.encoder().encodeForHTML(e.associated_resources[0].resources[0].config_name),J=B[0]),e.associated_resources[0].resources[0].user_name&&(B[1]=$ESAPI.encoder().encodeForHTML(e.associated_resources[0].resources[0].user_name)),N=I18n.getMsg(N),"crm.ziapresentation.msg3"===e.summary?(Z=I18n.getMsg(e.summary,B),e.no_content=!1):"crm.ziapresentation.dashboard.wms.msg"===e.summary||"crm.ziapresentation.dashboard.export.nodata1"===e.summary||"crm.ziapresentation.dashboard.export.nodata"===e.summary?(Z=I18n.getMsg(e.summary,J),e.no_content=!1):"crm.ziapresentation.dashboard.wms.msg1"===e.summary?(Z=I18n.getMsg("crm.ziapresentation.msg1",N),e.no_content=!1):"crm.ziapresentation.msg.nocontent.config"===e.summary?(Z=I18n.getMsg(e.summary,J),e.no_content=!0):(Z=I18n.getMsg("crm.ziapresentation.msg.nocontent",N),e.no_content=!0),e.summary=Z;break;case"workflow":if(e.associated_resources[0].type.includes("system_workflow")){var W=e.associated_resources[0].type;if("106"===W.substr(W.length-3)){var Y=e.associated_resources[0].resources,G=I18n.getMsg("crm.wf.di.usage.vs.records.body",Y);e.summary=G}}R[r]=[e],r++,e.iconClass="suggestionAI";break;case"anomaly":case"analytics":Y=e.associated_resources[0].resources;var q=I18n.getMsg(e.summary,Y);e.summary=q,U[c]=[e],c++,e.iconClass="anamolyAI";break;case"competitor_alert":Y=e.associated_resources[0].resources,G=I18n.getMsg(e.summary,Y);e.summary=G,S[l]=[e],l++,e.iconClass="cmpAl";break;case"chat_bot":Y=$ESAPI.encoder().encodeForHTML(e.associated_resources[0].resources[0]),G=I18n.getMsg("crm.intelligence.notification.body",Y);e.summary=G,e.iconClass="cmpAl";break;case"recommendation":var V,X=e.summary.split("$"),K=X[0],Q="daily"===X[1]?I18n.getMsg("Daily"):I18n.getMsg("Weekly"),ee=store.peekRecord("module",e.associated_resources[0].resources[0].whom_module_id),te=[Q,V=ee.hasOwnProperty("recommendationsDetailsJson")?"re_buy"===K?ee.recommendationsDetailsJson.suggestion_type.rebuy.label:ee.recommendationsDetailsJson.suggestion_type[K].label:o.getDefaultSuggestionTypeLabel(K),ee.plural_label];e.summary=I18n.getMsg("zia.recommendation.notification.ziapanel.summary",te),e.recommendation_notifications=e.associated_resources[0].resources[0],e.recommendation_notifications.suggestion_type=V,e.recommendation_notifications.suggestion_type_api_name=K,_[m]=[e],m++,e.iconClass="configSetup";break;case"similarity":e.title=I18n.getMsg("crm.setup.system.ziasimilarity");var ie=e.summary.split(",");1===ie.length?e.summary=I18n.getMsg("zia.similarity.notification.summary.current",ie):e.summary=I18n.getMsg("zia.similarity.notification.summary.all",ie),I[C]=[e],C++,e.iconClass="configSetup";break;case"recommendation_builder":_[m]=[e],m++,e.iconClass="configSetup";break;case"email_extracted_activities":b[f]=[e],f++,e.iconClass="suggestionAI";break;case"cns":case"cns_selfmarketing":"cns_selfmarketing"===e.type&&(e.title=I18n.getMsg("crm.label.zia.email.cns.heading.selfmarketing")),M[p]=[e],p++,e.iconClass="cmpAl";break;case"selfmarketing":k[g]=[e],g++,e.iconClass="cmpAl";break;case"email_custom_intent":L[u]=[e],u++,e.iconClass="configSetup";break;case"next_best_experience":v[a]=[e],a++,e.iconClass="suggestionAI";break;case"vision":e.summary=$ESAPI.encoder().encodeForHTML(e.summary),z[h]=[e],h++,e.iconClass="configSetup";break;case"zia_component_suggestions":w[d]=[e],d++,e.iconClass="suggestionAI";break;case"custom_view_anomaly":e.module=store.peekRecord("module",e.associated_resources[0].details.module.id),D[s]=[e],s++,e.iconClass="";break;case"deals_stage_anomaly":e.module="Potentials",moduleRecordMapping&&moduleRecordMapping.Potentials&&moduleRecordMapping.Potentials.plural_label&&(e.module=moduleRecordMapping.Potentials.plural_label),D[s]=[e],s++,e.iconClass=""}})),{fromFilter:!1,notifications:N,noNotification:!1,predNotifications:y,nbxNotification:v,recommendationNotifications:_,similarityNotifications:I,wfNotifications:R,anomalyNotifications:U,prev:"",desktopEnabled:t,unreadOnly:i,showMarkAllAsRead:$,availableFeatures:P,isMoreRecAvailable:T,visionNotifications:z,cvAnomalyNotifications:D}},processDateString:function(e,t){var i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),n=null,a=$L.moment().add(0,"date",!0).toDate(),s=$L.moment().add(0,"date",!0).toDate();return s.setDate(a.getDate()-1),e.toDateString()===a.toDateString()?(n=I18n.getMsg("Today"),t||(n+=", "+I18n.getMsg(i[e.getDay()]))):e.toDateString()===s.toDateString()?(n=I18n.getMsg("Yesterday"),t||(n+=", "+I18n.getMsg(i[e.getDay()]))):n=e.getFullYear()===a.getFullYear()?I18n.getMsg(i[e.getDay()])+", "+I18n.getMsg(o[e.getMonth()])+" "+e.getDate():I18n.getMsg(o[e.getMonth()])+" "+e.getDate()+", "+e.getFullYear(),n},showPresentationDetails:function(e,t,i,o){(e=$(e)).addClass("ziaNotificationClicked");var n=$("#diNotificationDetailsContent");n.removeClass("pR"),n.removeAttr("style"),$("#diNotificationDetails").removeClass("p0"),$L("#dIchartTitle").addClass("vH");var a=networkUtils.returnDependencyFiles(["crm-zia-notification.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-presentation-popup.js"],ResourceConstants.CRMClient);o=document.location.host;var r=s.concat(a),c=i+"/show/present/"+t+"?frameorigin=https://"+o;"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL&&(c=c+","+CrmPlusLib.getFrameOriginForURL());var l=i+"/show/open/"+t,d={title:e.get(0).title,showPreviewUrl:c,showOpenUrl:l};""!=t?Lyte.injectResources(r,void 0,(function(){Lyte.Component.render("crm-presentation-popup",d,"#diNotificationDetailsContent")})):this.closeDINotificationDetails(),Crm.client_tracking("ZiaPresentation-Wms Bar Viewed")},getDefaultSuggestionTypeLabel:function(e){var t;switch(e){case"re_buy":t="rebuy";break;case"first_buy":t="firstbuy";break;case"next_buy":t="nextbuy";break;case"customer_also_bought":t="cwbab";break;case"frequently_bought_together":t="fbt"}return I18n.getMsg("crm.filter.label."+t)},toFooter:function(e){var t=this;if(!$L(".etTrendsWrapperSelf").length){var i=(e=$(e)).outerHeight();e.css({bottom:"-"+i+"px"}),e.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),t.isZiaNotificationClicked=!1,$("#diNotificationDiv").html(""),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}},disableResizableandFixWidth:function(){var e=$("#dashboardItemsSort"),t=$("#dashboard-leftpanel").outerWidth(),i=$(".crmTrendDashBoard").find(".dashBrdContent");i.eq(0).hasClass("ui-resizable")&&i.resizable("destroy"),e.hasClass("ui-sortable")&&e.sortable("destroy"),i.removeClass("mR30").removeClass("mB30").addClass("mB20").addClass("pR30 pL30");var o=renderingUtils.windowWidth-t-40;i.css({width:o}),i.find(".sortClass").addClass("cDefault")},convertToIntArray:function(e){for(var t=[],i=e.length,o=0;o<i;o++)t.push(Math.round(e[o]));return t},convertToPositiveArray:function(e){for(var t=[],i=e.length,o=0;o<i;o++)t.push(e[o]<0?0:e[o]);return t},getReadableDate:function(e,t){var i=e.getFullYear(),o=e.getMonth(),n=e.getDate(),a=I18n.getMsg(this.monthNames.monthShortNames[o]),s=($L.moment(`${i}/${o}/${n}`).toDate().getDay()+6)%7,r=Math.ceil((e.getDate()+s)/7),c=null;switch(t){case"day":c=n+" "+a+" "+i;break;case"week":switch(r){case 1:c=I18n.getMsg("crm.emailstats.firstweek",[a])+" "+i;break;case 2:c=I18n.getMsg("crm.emailstats.secondweek",[a])+" "+i;break;case 3:c=I18n.getMsg("crm.emailstats.thirdweek",[a])+" "+i;break;case 4:c=I18n.getMsg("crm.emailstats.fourthweek",[a])+" "+i;break;case 5:c=I18n.getMsg("crm.emailstats.fifthweek",[a])+" "+i;break;case 6:c=I18n.getMsg("crm.emailstats.sixthweek",[a])+" "+i}break;case"month":c=a+" "+i.toString();break;case"year":c=i.toString()}return c},getPeriodEndDate:function(e,t){var i=e.split("-"),o=$L.moment().toDate();switch(t){case"year":o.setFullYear(parseInt(i[0])+1,0,0);break;case"month":o.setFullYear(parseInt(i[0]),parseInt(i[1]),0);break;case"week":o.setFullYear(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2])+6)}return this.convertDateObjectToString(o)},convertDateObjectToString:function(e){var t=e.getMonth()+1,i=e.getDate();return e.getFullYear()+"-"+(t<10?"0":"")+t+"-"+(i<10?"0":"")+i},calendarDropAppend:function(){if($(".crmTrendDashBoard").length){for(var e=$L.moment().toDate().getFullYear(),t=[],i=e-5;i<=e;i++)t.push(i);var o,n,a=Handlebars.templates.CalendarMonthFilter({months:this.monthNames.monthFullNames}),s=Handlebars.templates.CalendarYearFilter({years:t}),r=$(".sCalMon");r.text("");$("#calendarMonthid").length||(r.append(a),o=$("#calendarMonthid")),$("#calendarYearid").length||(r.append(s),n=$("#calendarYearid"));var c=this.monthNames.monthFullNames[crmCalendar.currMonth],l=crmCalendar.currYear;o.find("option.month_"+c).attr("selected",!0),n.find("option.year_"+l).attr("selected",!0)}},displayTooltipPlotLines:function(e,t,i){var o=$(t.target).parents(".dashBrdContent").find(".tooltiptext");o.hide(),o.text(I18n.getMsg("Today")),o.show(),o.css({left:parseInt(parseInt(i)+17)})},getDayDifferenceFromDateStr:function(e,t,i){var o=crmCalendar.getDateObjectFromGivenDateString(e,i),n=crmCalendar.getDateObjectFromGivenDateString(t,i);return this.getDayDifference(o,n)},getDayDifference:function(e,t){var i=e.getTime();return(t.getTime()-i)/864e5},getAllowedPeriods:function(e){var t=[];return e>0&&e<=99?t=[0,1]:e>99&&e<=693?t=[1,2]:e>693&&e<=2970?t=[2,3]:e>2970&&(t=[3]),t},diScrollOrSearchInitiated:function(e){var t,i,o=$(e).attr("id").split("_")[1],n=$("#trendDBUserList_"+o),a=CrmDashboard.trendDashboardObj[o];if(""===$(e).parents(".diUserListContainerData").find(".trendDBUserSearch").val()?(t=CrmDashboard.trendDashboardObj[o].filters.selected.group,i=$.extend(!0,[],t?CrmDashboard.trendDBGroupList:CrmDashboard.trendDBUserList)):i=CrmDashboard.trendDashboardObj[o].filters.searchList,i.length>a.dashboardUserOrGroupCount){var s=i.slice(a.dashboardUserOrGroupCount,a.dashboardUserOrGroupCount+10);n.append(Handlebars.templates.TrendDashboardUserList({dbItemId:o,userlist:s})),CrmDashboard.checkSelectedIds(o),a.dashboardUserOrGroupCount=a.dashboardUserOrGroupCount+10}},notifyOnWms:function(e){var t=this,i="",o="",n="",a="",s="",r="dashboard_presentation",c=$("#di-notification-icon"),l=!(!e||void 0===e.status)&&e.status;if("true"===l||!0===l){var d=e.count;void 0!==d?($(".ziaCount").text(d),c.addClass("ziaCountActive"),c.removeClass("zia-active")):("true"!==l&&!0!==l||($(".ziaCount").text(1),c.addClass("ziaCountActive")),c.addClass("zia-active"))}if(e&&void 0!==e.summary&&e.summary.length>0)for(var m=e.summary.length,u=0;u<m;u++)switch(e.summary[u].type){case"title":i=I18n.getMsg(e.summary[u].key);break;case"body":switch(e.summary[u].key){case"crm.zia.nba.notify.nodata":o=I18n.getMsg(e.summary[u].key,moduleRecordMapping.Deals.singular_label);break;case"crm.zia.nba.notify.complete":o=I18n.getMsg(e.summary[u].key,moduleRecordMapping.Deals.plural_label.toLocaleLowerCase());break;default:o=I18n.getMsg(e.summary[u].key)}n=e.summary[u].key;break;case"extra_info":if(i.includes("Prediction")&&e.summary[u].extra_info){var f=e.summary[u].extra_info.name,p=e.summary[u].extra_info.tabid,g=[];g.push(f),g.push(store.peekAll("module").filterBy({id:p})[0].plural_label),o=I18n.getMsg(n,g)}else if("Presentation"===i){if(void 0!==e.summary[u].extra_info.resource_name?s=e.summary[u].extra_info.resource_name:void 0!==e.summary[u].extra_info.config_name&&(r="presentation_config",s=e.summary[u].extra_info.config_name),a=I18n.getMsg(n,$ESAPI.encoder().encodeForHTML(s)),"crm.ziapresentation.dashboard.notification.msg"===n||"crm.ziapresentation.dashboard.wms.msg"===n)n="crm.ziapresentation.dashboard.wms.msg1",i=I18n.getMsg("crm.ziapresentation.title.dashboard");else if(i=I18n.getMsg("crm.setup.system.ziapresentation"),"Your monthly presentation is ready to view"===n)s=e.summary[u].extra_info.month,n="crm.ziapresentation.msg2",a=I18n.getMsg("crm.ziapresentation.msg1",$ESAPI.encoder().encodeForHTML(s));else if("crm.ziapresentation.msg3"===n){var C=[];C.push($ESAPI.encoder().encodeForHTML(s)),C.push($ESAPI.encoder().encodeForHTML(e.summary[u].extra_info.user_name)),a=I18n.getMsg(n,C)}o="crm.ziapresentation.msg3"===n?I18n.getMsg("crm.ziapresentation.msg4",C):I18n.getMsg(n,$ESAPI.encoder().encodeForHTML(s))}}""===i&&(i=I18n.getMsg("crm.zia.config.notification")),""===o&&(o=I18n.getMsg("crm.zianotification.new.notification"));var h=Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled;if(void 0!==h&&h&&"granted"===Notification.permission){var y=networkUtils.getImageUrl("zia-logo-512.png",ResourceConstants.CRMClient),v=new Notification(i,{body:o,icon:y});v.onclick=function(e){t.getZiaNotificationSummary(e,this),v.close()}}if("dashboard_presentation"===r&&("crm.ziapresentation.msg2"===n||"crm.ziapresentation.dashboard.notification.msg"===n||"crm.ziapresentation.wms.notification.msg"===n||"crm.ziapresentation.dashboard.wms.msg1"===n)){var D=networkUtils.returnDependencyFiles(["crm-presentation-export-notification.js"],ResourceConstants.CRMClient),_=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PresentationNotification")],ResourceConstants.CRM),w=D.concat(_);Lyte.injectResources(w,void 0,(function(){var t=$L("crm-presentation-export-notification");t&&t[0]&&t[0].remove(),Lyte.Component.render("crm-presentation-export-notification",{title:i,dbName:s,notifyObj:e,message:a},"body"),$L("#present_real_notify")[0].ltProp("show",!0)}))}},notifyOnWmsForRM:function(){var e=$L("#chatbotDiv");e&&e[0]&&"visible"===e[0].style.visibility?$L(".askziaRoutineIcon").addClass("pointlabl"):$L("#askZiaCont").addClass("zia-active-rm")},hideDiNotification:function(e){this.isZiaNotificationClicked=!1;var t=$L("crm-zia-cv-anomaly-result")[0];t&&t.component.executeMethod("closeResult");var i=$("#diNotificationDetails"),o=i.is(":visible"),n=$("#diNotificationDetailsContent");($L(".etTrendsWrapper").length||$L(".etTrendsWrapperCNS").length)&&(document.getElementById("etTrendsOuterDiv1").ltProp("show",!1),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),renderingUtils.removeFreezeLayer());var a=$L(".etTrendsWrapperSelf");a.length&&e&&(a.html(""),a.removeClass("etTrendsWrapperSelf"),document.getElementById("etTrendsOuterDivSelf").ltProp("show",!1));var s=$("#di-notification-icon");$(".jarvisSectionBox").length>$(".jarvisSectionBox.alreadyClicked").length&&s.addClass("zia-active"),this.toFooter($("#diNotificationDiv")),n&&(thirdPartyUtils.unbindHighcharts(n),n.empty());var r=$(".clickedSection");s.removeClass("blinkEl"),o&&(Crm.userDetails.RTL_ENABLED?i.css({left:"-900px"}):i.css({right:"-900px"}),i.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))),$(".jarvisFreeze").removeClass("showFreeze").hide(),$L("body").removeClass("oH"),r.addClass("alreadyClicked").removeClass("clickedSection"),delete Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson},showSubSettingList:function(e,t){e=$(e);var i=$(".titPanner"),o=$(".TeamSettingDivSub");if(t)o.hide(),$(".TeamSettingDiv").hide();else{var n=i.offset().top+i.outerHeight()+2,a=e.parent().offset().left-o.outerWidth()-27,s=renderingUtils.windowHeight-($("#DashboardHeadingDiv").outerHeight()+$("#tabLayer").outerHeight()+$("#wmstoolbar").outerHeight());o.css({"max-height":s,top:n,left:a,opacity:1}).show(),$(".crmUserListDiv").css({"max-height":s-140}),$(".viewSelected").removeClass("viewSelected"),e.parents("li").addClass("viewSelected")}},scrolltoBottomShadow:function(e){$L(e).scrollTop()>10?$("#DashboardHeadingDiv").addClass("dashbtmshad"):$("#DashboardHeadingDiv").removeClass("dashbtmshad")},ignoreNotification:function(e,t){var i=this;if(t){var o="action=ignoreNotification&id="+e+"&"+csrfParamName+"="+csrfToken,n={url:Crm.getCrmBasePath()+"/crminotification.do",method:"POST",payLoad:o,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};store.findAll("dummy",{},!1,!1,n).then((e=>{var t=e.dummy;if("Success"===t.Status){var o="div[data-noti-id='"+t.NotificationId+"']",n=$(o);if(n.length){i.closeDINotificationDetails();var a=n.closest(".notificationSummaryDateWise");_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.wf.di.ignore.success.msg"),ltPropType:"error",ltPropDuration:"1500"}}),a.find(".jarvisSectionBox").length<=1?(a.addClass("ignoreNotification"),a.on("animationend webkitAnimationEnd oAnimationEnd",(function(){this.remove()}))):(n.addClass("ignoreNotification"),n.on("animationend webkitAnimationEnd oAnimationEnd",(function(){this.remove()})))}}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.security.error.add.user"),ltPropType:"error",ltPropDuration:"1500"}})}))}else{var a={val:I18n.getMsg("crm.wf.di.ignore.snooz",[90]),fn:function(){i.ignoreNotification(e,!0)}},s={val:I18n.getMsg("crm.button.cancel")};renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.wf.di.ignore.confirmation",[90]),a,s)}},closeDINotificationDetails:function(){var e=$(".clickedSection"),t=$("#diNotificationDetails");$L(".ziaNotificationClicked").removeClass("ziaNotificationClicked"),$("#diNotificationDetailsContent").empty(),t.removeClass("p0"),$("#dIchartTitle").removeClass("hide");var i=$(".jarvisFreeze");i.removeClass("showFreeze").hide(),$L("body").removeClass("oH"),i.removeAttr("onclick"),i.off("click").attr("onclick","javascript:sE(event);"),i.off(),e.addClass("alreadyClicked"),e.removeClass("clickedSection"),Crm.userDetails.RTL_ENABLED?t.css({left:"-900px"}):t.css({right:"-900px"}),t.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")})),delete Lyte.registeredMixins["crm-zianotification-helper"].notificationDetailJson},slider:function(e,t){t=t.toString(),CrmDashboard.setTrendDashboardFilters(t),$(".diUserListContainerData,.dIMonthRelatedDropdownUl").hide(),$(".custom.dateFilter."+t).hasClass("selected")||$(".dIDateRangeinInputCont").hide(),$(e).parents(".dIDateRangeContainer").find(".diUserSettingContainerData").fadeToggle(200),this.addActiveBorder(e)},inputSearchUser:function(e){var t=$(e).val(),i=$(e).parents(".diUserListContainerData"),o=i.find(".dIUserListScrollContainer ul").attr("id").split("_")[1],n=CrmDashboard.trendDashboardObj[o],a=i,s=a.find(".dIUserListScrollContainer").find("ul");(s.html(""),""===t)?($(e).parents().find(".diUserListContainerData").find(".selectAllUser").removeClass("hide"),a.find(".diAllCheckBoxContainerSection").show(),CrmDashboard.trendDashboardObj[o].filters.searchList=[],CrmDashboard.trendDashboardObj[o].dashboardUserOrGroupCount=0):(a.find(".diAllCheckBoxContainerSection .noneSelected").length>0?a.find(".diAllCheckBoxContainerSection").hide():a.find(".diAllCheckBoxContainerSection").show(),n.dashboardUserOrGroupCount=0);var r=CrmDashboard.trendDashboardObj[o].filters.selected.group,c=$.extend(!0,[],r?CrmDashboard.trendDBGroupList:CrmDashboard.trendDBUserList),l=[];CrmDashboard.trendDashboardObj[o].filters.searchList=l,c.each((function(e){-1!==e.name.toUpperCase().search(t.toUpperCase())&&l.push(e)})),Lyte.registeredMixins["crm-zianotification-helper"].diScrollOrSearchInitiated(s)},nextArrowPress:function(e,t){CrmDashboard.slideGraph(e,0===t?-10:10)},showDateChangeDropdown:function(e,t){if(e=e.toString(),$(t).prev().text($(t).val()),$(t).addClass("valAddedInField"),$(t).parent().hasClass("startDate")){var i=$(t).val(),o=$("#trendDBRowSectionToDate_"+e),n=o.val();void 0!==n&&""!==n.trim()&&(i=crmCalendar.getDateObjectFromGivenDateString(i),n=crmCalendar.getDateObjectFromGivenDateString(n),i.getTime()>=n.getTime()&&(i.setDate(i.getDate()+1),o.val(crmCalendar.convertToUserDatePattern(i.getDate()+" "+i.getMonth()+" "+i.getFullYear())),o.trigger("click")))}},closeSettingContainer:function(){$(".dIDateRangeinInputCont").css({bottom:"-400px"}).hide(),$(".dIRangeFreeze").hide(),$(".diUserSettingContainerData").hide(),$("#Calendar").hide(),$(".dIactiveBorder").removeClass("dIactiveBorder")},calendarUpd:function(e,t,i){var o=$(e).val();Lyte.registeredMixins["crm-zianotification-helper"].inc=0,1===i?(Lyte.registeredMixins["crm-zianotification-helper"].inc=o,crmCalendar.updateDatePicker(t,void 0,1,void 0,1)):(Lyte.registeredMixins["crm-zianotification-helper"].inc=o-1,crmCalendar.updateDatePicker(t,1,void 0,void 0,1)),crmCalendar.updateDatePicker(t)},showFilterCalendar:function(e,t,i){i=i.toString();var o=$(t).parent().hasClass("startDate"),n=$L.moment().toDate();if(o){var a="1,1,"+(n.getFullYear()-5);n=n.getMonth()+1+","+n.getDate()+","+n.getFullYear()}else{a=$("#trendDBRowSectionFromDate_"+i).val();(a=crmCalendar.getDateObjectFromGivenDateString(a)).setDate(a.getDate()+1),a=a.getMonth()+1+","+a.getDate()+","+a.getFullYear(),n=n.getMonth()+1+","+n.getDate()+","+n.getFullYear()}crmCalendar.showCalendar(e,t,void 0,void 0,void 0,void 0,a,n)},showUserContainer:function(e){$(".diUserSettingContainerData").hide(),$(e).find(".diUserListContainerData").fadeToggle(200),$(e).find(".selectAllUser").show(),this.addActiveBorder(e)},addActiveBorder:function(e){var t=$L(e),i=$(".diUserSettingContainerData"),o=$(".diUserListContainerData"),n=t.find("select"),a=t.parents(".crmTrendDashBoard"),s=t.parents(".dashBrdContent"),r=a.outerHeight()-40,c=s.position().top+a.scrollTop(),l=i.outerHeight()+s.position().top,d=o.outerHeight()+s.position().top;$(".dIactiveBorder").removeClass("dIactiveBorder"),t.hasClass("trendDBRowSectionDate")&&(i.hide(),o.hide(),n.on("select2:close",(function(){$(".dIactiveBorder").removeClass("dIactiveBorder")}))),t.addClass("dIactiveBorder"),$(".select2-container").find(".select2-dropdown").addClass("addselect2Arrow"),t.hasClass("dISubModuleconta")?l>r&&a[0].scroll({top:c-30,behavior:"smooth"}):t.hasClass("dIUserListContainer")&&d>r&&a[0].scroll({top:c-30,behavior:"smooth"}),t.hasClass("trendDBRowSectionDate")&&(n.on("select2:open",(function(){$(this).addClass("remHidToolTip"),crmui.hideTooltip()})),n.on("select2:close",(function(){$(this).removeClass("remHidToolTip"),crmui.hideTooltip()})))},showTodayDrop:function(e){if($("#Calendar").hide(),$(e).parents(".dIDateRangeContainerUlLi").find("li").removeClass("selected"),$(e).addClass("selected"),"custom"===$(e).attr("datetype")?($(".dIRangeFreeze").show(),$(e).parents(".diUserSettingSubContainer").find(".dIDateRangeinInputCont").fadeIn(200)):$(e).parents(".diUserSettingSubContainer").find(".dIDateRangeinInputCont").fadeOut(200),"LI"!==$(e)[0].tagName)return null;$(e).find("input").focus()},diUserListScrollAddShad:function(e){var t=$(e).parents(".diUserListContainerData").find(".diUserListActContainer");$L(e).scrollTop()+$(e).outerHeight()>=e.scrollHeight&&Lyte.registeredMixins["crm-zianotification-helper"].diScrollOrSearchInitiated($(e).find("ul")),$L(e).scrollTop()>30?t.addClass("setShadow"):t.removeClass("setShadow")},hideOtherpops:function(){$(".dIuserOpenChange").hide()},getZiaNotificationSummary:function(e,t){if(this.isZiaNotificationClicked)return!1;if(this.isZiaNotificationClicked=!0,crmui.fromCloseOther||crmui.closeOtherWMSBars("zia"),featuresAvailable.NEXTGENUI_ENABLED){var i=document.querySelector("crm-left-menu");i&&i.component&&i.component.closeNewUIMenus()}var o=0;"visible"===$("#chatbotDiv").css("visibility")&&"undefined"!=typeof zia&&zia&&(zia.minimizeChat(),o=300);var n=$L("crm-accessibility-shortcut")[0];n&&n.component.getData("showModal")&&n.component.setData("showModal",!1),setTimeout((()=>{var e=$("#diNotificationDiv"),i="block"===e.css("display"),o="none"===e.css("display"),n=$("#di-notification-icon");Lyte.registeredMixins["crm-zianotification-helper"].loadAnimation(t,n,e),e.addClass("ziaNotificationLoader"),(!0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||void 0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||e&&o)&&(e&&i?Lyte.registeredMixins["crm-zianotification-helper"].hideDiNotification():Lyte.injectResources(networkUtils.returnDependencyFiles(["zianotificationpanel.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-zianotification-helper"].fromFooter(e);var i=store.triggerAction("zianotificationpanel","categorize",null,{group_by:"type"},"GET",null),o=store.findAll("zianotificationpanel",{type:"all"});Crm.client_tracking("Zia Notification - icon clicked");var n=networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM),a=networkUtils.returnDependencyFiles(["crm-zia-notification.js","zia-helpers.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-zia-notification.css"],ResourceConstants.CRMClient),r=a.concat(s);r=r.concat(n);var c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification"),networkUtils.getI18nJSUrl("PresentationNotification")],ResourceConstants.CRM),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CVAnomalyResult")],ResourceConstants.CRM),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("DuplicateImageDetectionOther")],ResourceConstants.CRM),m=r.concat(c).concat(l).concat(d);Lyte.injectResources(m,void 0,(function(){Lyte.resolvePromises({__zia_notifications:o,categorize:i}).then((function(i){if(""===e.html()){var o=Lyte.registeredMixins["crm-zianotification-helper"].processAPIresponse(i);e.removeClass("ziaNotificationLoader"),Lyte.Component.render("crm-zianotification-popup",o,"#diNotificationDiv");var n=$L("#present_real_notify");if(n&&n[0]&&!0===n[0].ltProp("show")&&null!==t.data){var a=t.data.notifyObj,s=o.notifications.filter((function(e){return e.id===a.id}));if(s[0]){var r=$L("crm-zianotification-popup")[0],c=o.notifications,l=c.length,d=!1;if(l>0){for(var m=0;m<l;m++)c[m].read||d||(d=!0);d?r.setData("showMarkAllAsRead",!0):r.setData("showMarkAllAsRead",!1)}Lyte.Mixin.get("crm-zianotification-helper").getZiaNotificationDetails(s[0],$L("#notificationContainer_"+a.id)[0])}var u=$L("crm-presentation-export-notification");u&&u[0]&&u[0].remove()}}EmailSendingUtil.closeTabALertPopup(),EmailSendingUtil.composeActive&&EmailCompose.etMinimiseCompose(),crmui.WMSBarOpened(document.querySelector("#diNotificationDiv"))}),(function(e){-1!==JSON.parse(e.response).code.indexOf("NO_PERMISSION")?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zianotification.common.error.msg"))}))}))})))}),o)},chatbotTrackSpotLightAction:function(){Crm.trackSpotLightAction("Chatbot - Group By Result Click")},renderZiaError:function(){Lyte.injectResources(dependencyFiles,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))},convertComponentsToConfigObj:function(e,t,i){var o;if(e){(o={}).category=53,o.category_header=I18n.getMsg("crm.zia.config.user.anomaly.custom"),o.configs=[],o.no_of_configs=e.length;var n=t.length;e.each((function(e){var a={};if(a.title=e.name,a.component_id=e.id,i){if(a.mystatus=!1,t)for(var s=0;s<n;s++)if(t[s].notify_for&&"custom_anomaly"===t[s].notify_for.type&&t[s].notify_for.id===e.id){a.mystatus=t[s].enabled,a.id=t[s].id;break}}else a.dashboard_id=e.analytics.id,a.mystatus=e.component_props.notification_props.opted_in,a.isTopTen=e.topTen;o.configs.push(a)}))}return o}},{mixins:["crm-dashboard-utils"]});
