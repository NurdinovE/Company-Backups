store.registerModel("canvasview",{width:Lyte.attr("number"),canvas_enabled:Lyte.attr("number"),access_type:Lyte.attr("string"),shared_to:Lyte.attr("array"),view_type:Lyte.attr("string"),row_size:Lyte.attr("number"),name:Lyte.attr("string"),module:Lyte.attr("object"),layout:Lyte.attr("object"),relation_id:Lyte.attr("string"),thumbnail_id:Lyte.attr("string"),modified_time:Lyte.attr("string"),id:Lyte.attr("string"),feature:Lyte.attr("string"),modified_by:Lyte.attr("string"),created_by:Lyte.attr("string"),created_time:Lyte.attr("string"),components:Lyte.attr("array"),children:Lyte.attr("array"),ui:Lyte.attr("object"),related_to:Lyte.attr("object",{default:{}}),action:Lyte.attr("string"),profiles:Lyte.attr("array",{default:[]}),removeProfiles:Lyte.attr("array",{default:[]}),canvas_rules:Lyte.attr("boolean",{default:!1}),source:Lyte.attr("string"),type:Lyte.attr("string"),map:Lyte.attr("object")},{actions:{export_tokens:{},import:{}}}),store.registerAdapter("canvasview",{namespace:"crm/v7/settings/canvas",buildURL:function(e,t,a,i,r,n,s){if(r=r.replace("canvasview","views"),a&&"ListView"===a.feature||a&&("DetailView"===a.feature||"MobileDetailView"===a.feature)||i&&"ListView"===i.feature||i&&("DetailView"===i.feature||"MobileDetailView"===i.feature)||s&&s.apiVersion){var o=s&&s.apiVersion?s.apiVersion:"v7";r=r.replace("crm/v7/settings/canvas","crm/"+o+"/settings/canvas")}return"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(r=r.replace("/crm/","/crm/v7/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(r=r.replace("/crm/","/crm/v7/production/diff/")),"updateRecord"===t?r=(r=r.slice(0,r.lastIndexOf("views")+"views".length))+"/"+i.id:"export_tokens"===n?r=s?"/crm/v7/settings/canvas/views/export_tokens/"+s.secretKey:"/crm/v7/settings/canvas/views/export_tokens":"import"===n&&(r="/crm/v7/settings/canvas/views/actions/import"),r},methodForRequest:function(e){return"PATCH"==e?"PUT":e}}),store.registerSerializer("canvasview",{normalizeResponse:function(e,t,a,i,r){if(204===r)return{payLoad:{canvas_view:[]}};if("updateRecord"===t){a.canvas_view={id:a.canvas_view[0].details.id};var n=new CrmDate,s=$L.moment(n.getDateTimeInDefault()).toDate(),o=Utils.convertDateToGivenPattern("M d, yy",s),v=Utils.getTimeInUserFormat(s,!0);a.canvas_view.modified_time=apiDateTimeFormat(o+" "+v);var c={};c.name=Crm.userDetails.DISPLAY_NAME,c.id=Crm.userDetails.USER_ID,a.canvas_view.modified_by=c}else if("createRecord"===t)a.canvas_view={id:a.canvas_view[0].details.id},delete a.canvasview;else if("update"===t)a.ids=a.canvas_view[0].details.ids,delete a.canvas_view;else if("findRecord"===t&&a&&a.canvas_view&&a.canvas_view[0]&&a.canvas_view[0].ui&&!a.canvas_view[0].ui.theme)a.canvas_view[0].ui.theme=canvasTheme.getCanvasThemeJson(a.canvas_view[0].feature);else if("findAll"===t&&a&&a.canvas_view)for(viewIndex in a.canvas_view)"WizardView"===a.canvas_view[viewIndex].feature&&a.canvas_view[viewIndex].ui&&!a.canvas_view[viewIndex].ui.theme&&(a.canvas_view[viewIndex].ui.theme=canvasTheme.getCanvasThemeJson(a.canvas_view[viewIndex].feature));return a},payloadKey:function(){return"canvas_view"},extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t,a,i,r,n,s){if("updateRecord"===e){var o=[],v=t.canvasview.id,c=(d=store.peekRecord("canvasview",v)).action;return y=(d.feature,{name:d.name,ui:d.ui,feature:d.feature,children:d.components,module:d.module,layout:d.layout&&d.layout.id?d.layout:void 0,type:d.type,canvas_enabled:d.canvas_enabled,view_type:d.view_type}),c&&"save"!==c&&(y.action=c),d.related_to&&(y.related_to=d.related_to),o.push(y),{canvas_view:o}}if("createRecord"===e){var d;o=[],c=(d=store.peekRecord("canvasview",t.canvasview.$.pK)).action;if("presets"===d.feature&&!d.type){var l={type:"custom event",name:"canvas type null error"};l.message=JSON.stringify(d),murphy.addCustomTracking(l),murphy.error(new Error("INFO - Canvas type sended as null in Payload"))}return delete(y={name:d.name,ui:d.ui,feature:d.feature,row_size:d.row_size,width:d.width,components:d.components,module:d.module,layout:d.layout&&d.layout.id?d.layout:void 0,type:d.type,thumbnail_id:d.thumbnail_id,view_type:d.view_type}).row_size,delete y.width,delete y.components,y.children=d.components,t.canvasview.id&&(y.canvasId=t.canvasview.id),c&&"save"!==c&&(y.action=c),d.related_to&&(y.related_to=d.related_to),Crm.userDetails.isCanvasFormViewEnabled&&"FormViewPresets"===d.feature&&"field"===d.type&&d.field_state&&(y.field_state=d.field_state),o.push(y),{canvas_view:o}}if("update"===e){o=[];for(var u,w=t.canvasview?t.canvasview.length:0,m=0;m<w;m++){u=t.canvasview[m].id;var y={id:(d=store.peekRecord("canvasview",u)).id,feature:d.feature?d.feature:i,module:d.module,layout:d.layout&&d.layout.id?d.layout:void 0,profiles:d.profiles,removeProfiles:d.removeProfiles,action:"canvasAssignment"};o.push(y)}return{canvas_view:o}}return"action"!==e||"export_tokens"!==s&&"import"!==s?t:t=i}});
