var crmExportWMSMsg={userDetails:Crm.userDetails,newkey:0,export:"EXPORT",closeAll:null,init:function(){if(crmExportWMSMsg.newkey=0,crmExportWMSMsg.MODIFIEDTIME="MODIFIEDTIME",crmExportWMSMsg.ACTION="ACTION",crmExportWMSMsg.MODULE="MODULE",crmExportWMSMsg.FILENAME="FILENAME",crmExportWMSMsg.UNIQUEID="UNIQUEID",crmExportWMSMsg.USERID="USERID",crmExportWMSMsg.STATUS="STATUS",crmExportWMSMsg.CUSTOMID="CUSTOMID",crmExportWMSMsg.LINK="LINK","undefined"!=typeof Storage){var e=localStorage.getItem(crmExportWMSMsg.export);if("true"===isSandboxAcc)(new crmRequestPool).initiate({url:"/crm/v2/settings/translations/sandbox/status",type:"GET",headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},success:function(o){null!==o&&(sanStatus=o.responseText),e&&"Refreshing"!=sanStatus&&crmExportWMSMsg.scheduledFiles(e)}});else e&&crmExportWMSMsg.scheduledFiles(e);try{for(var o in localStorage)o&&0==o.indexOf(crmExportWMSMsg.export)&&0==!o.indexOf(crmExportWMSMsg.export)&&localStorage.removeItem(o)}catch(e){}}},checkExportAlreadyScheduled:function(e,o){var r=localStorage.getItem(crmExportWMSMsg.export);if(r){r=JSON.parse(r);var t=!1;for(var n in r){var s=r[n],a=s[crmExportWMSMsg.MODULE],i=s[crmExportWMSMsg.CUSTOMID],c=s[crmExportWMSMsg.STATUS];(a&&e&&a===e||i&&o&&i==o)&&(t=4!=c&&crmExportWMSMsg.showScheduledMsg(n,s))}return t}return!1},showScheduledMsg:function(e,o){var r=(new Date).getTime()-o[crmExportWMSMsg.MODIFIEDTIME],t=$("#"+("chatcontain"+e));return r<=18e6&&t.length>0?($("#EXPORTPOP1 #callTitleSpan").css("color","var(--eeeeee)"),$("#EXPORTPOP1 .chatPopTitle").effect("highlight",{color:"var(--linkColor)"},500),setTimeout((function(){$("#EXPORTPOP1 #callTitleSpan").css("color","var(--baseColor)")}),500),!0):(crmExportWMSMsg.removeFun(e),t.length>0&&t.remove(),!1)},removeFun:function(e){if("undefined"!=typeof Storage)for(var o in localStorage){var r=localStorage.getItem(o);if(r){if(r=JSON.parse(r),o===crmExportWMSMsg.export)for(var t in r)e==t&&delete r[t];localStorage.setItem(o,JSON.stringify(r))}}},showMessageBasedResult:function(e,o){if("string"==typeof e&&(e=JSON.parse(e)),o)e&&-1==e[crmExportWMSMsg.UNIQUEID]&&!e[crmExportWMSMsg.STATUS]&&crmExportWMSMsg();else{var r=e[crmExportWMSMsg.UNIQUEID];crmExportWMSMsg.updateLocalStorage(e),crmExportWMSMsg.showCommonMsg(r,e)}},showCommonMsg:function(e,o){var r="chatcontain"+e,t=o[crmExportWMSMsg.FILENAME],n=o[crmExportWMSMsg.MODULE],s=o[crmExportWMSMsg.STATUS],a=$("#"+r);if((void 0===t&&void 0!==n&&void 0!==moduleRecordMapping[n]||void 0!==n&&n.startsWith("LinkingModule"))&&(t=moduleRecordMapping[n].plural_label),0===s||1===s){if(a.length>0)return;crmExportWMSMsg.showExportProcess(r,t),$(".cancellink").attr("onclick","crmExportWMSMsg.callCancel(this,'"+n+"')")}else if(2===s)0===a.length&&crmExportWMSMsg.showExportProcess(r,t),crmExportWMSMsg.processingImage(r);else if(5===s){var i;0===a.length&&(crmExportWMSMsg.showExportProcess(r,t),crmExportWMSMsg.processingImage(r));var c=Crm.getCrmBasePath()+"/Export.do?action=Download&module="+n+"&uniqueID="+e;"Reports"===n&&(c=o[crmExportWMSMsg.LINK]+"?job_id="+e,i="report_download"),crmExportWMSMsg.showDownloadlink(r,c,i)}else 4===s?(0===a.length&&(crmExportWMSMsg.showExportProcess(r,t),crmExportWMSMsg.processingImage(r)),crmExportWMSMsg.showFailedIcon(r,n)):6===s&&crmExportWMSMsg.clearAPopupDiv(e)},showExportProcess:function(e,o){var r=$(".sumplusdiv").css("display");if(crmExportWMSMsg.newkey++,1!=crmExportWMSMsg.newkey){(a=$(Handlebars.templates.ExportPopUp()).find(".chatContainer").clone()).attr("id",e),a.find(".ExportFileName").html($ESAPI.encoder().encodeForHTML(o));var t=(i=$("#EXPORTPOP1")).find(".ChatContains .chatDiv");t.append(a);var n=t.outerHeight(),s=i.find(".ChatContains");n>s.outerHeight()&&$L(s).scrollTop(n)}else{var a,i;(a=$(Handlebars.templates.ExportPopUp())).find(".chatContainer").attr("id",e),a.css("bottom","26px"),a.attr("id","EXPORTPOP"+crmExportWMSMsg.newkey),a.find(".ExportFileName").html($ESAPI.encoder().encodeForHTML(o)),$("body").append(a),(i=$("#EXPORTPOP1")).slideToggle({direction:"up"})}"block"==r&&i.find(".chatContainer").show()},processingImage:function(e){var o=$("#"+e),r=o.find(".Downstatus");r.find("span").text(I18n.getMsg("crm.report.export.alert.h1")),r.find("img").remove(),o.find(".cancellink").hide(),o.find(".slidercontainer").show();var t=0;!function e(){setTimeout((function(){o.find(".cancellink").text()!=n&&o.find(".cancellink").text()!=s?(o.find(".slidercolor").css({width:"30px",left:t+"px"}),e(),160==t&&(t=0,1),t+=10):o.find(".slidercolor").css({width:"inherit",left:"0px"})}),100)}();var n=I18n.getMsg("crm.view.attachment.download"),s=I18n.getMsg("crm.view.attachment.retry")},exportPopup:function(e){"none"==$(e).parent().find(".chatContainer").css("display")?($("#EXPORTPOP1").find(".chatContainer").show(),$(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll"),$(".sumplusdiv").hide()):($("#EXPORTPOP1").find(".chatContainer").hide(),$(".sumplusdiv").show(),$(".summinusdiv").hide(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","hidden"))},callHide:function(e){$(e).parent().parent().find(".chatContainer").hide(),$(e).hide(),$(e).find("img").css("transform","rotate(180deg)"),$(e).siblings(".sumplusdiv").show()},callShow:function(e){$(e).parent().parent().find(".chatContainer").show(),$(e).hide(),$(e).find("img").css("transform","rotate(0deg)"),$(e).siblings(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll")},callCancel:function(e,o){if($(e).text()===I18n.getMsg("crm.button.cancel")){var r=$(e).closest(".chatContainer").attr("id");if(r){var t=r.replace("chatcontain","");if("undefined"!=typeof Storage){var n=localStorage.getItem(crmExportWMSMsg.export);n&&((n=JSON.parse(n))[t]="",localStorage.setItem(crmExportWMSMsg.export,JSON.stringify(n)))}var s={};s.module=o,s.action="cancel",s.uniqueID=t;var a,i=Crm.getCrmBasePath()+"/Export.do";"Reports"===o&&(s=void 0,i="/crm/v2/Reports/actions/export_jobs?ids="+t,a="DELETE"),crmExportWMSMsg.ajaxCall(i,s,a,(function(){crmExportWMSMsg.clearAPopupDiv(t)}))}}},ajaxCall:function(e,o,r,t){(new crmRequestPool).initiate({action:e,data:o,headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},type:r||"POST",success:function(e){t&&t(e)}})},showDownloadlink:function(e,o,r){var t,n=I18n.getMsg("crm.view.attachment.download"),s=$("#"+e),a=s.find(".cancellink"),i=s.find(".Downstatus");"block"==$(".sumplusdiv").css("display")?((t=$("#EXPORTPOP1")).find(".chatContainer").show(),t.find(".sumplusdiv").hide(),t.find(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll"),setTimeout((function(){s.find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),a.text(n).show(),a.attr("href",o),a.attr("data-zcqa","DownloadAuditLog"),a.attr("target","_blank"),a.attr("rel","noreferrer noopener"),a.removeAttr("onclick"),a.addClass("downloadlink_report"),a.on("click",(function(){var o=$("#"+e);o.find(".downloadlink_report").hide(),o.find(".downloadingLink").show();var r=e.replace("chatcontain","");crmExportWMSMsg.clearAPopupDiv(r)})),a.removeClass("cancellink"),i.find(".slidercontainer").remove(),i.find("span").remove()}),200)):((t=i).find("span").text(I18n.getMsg("crm.report.export.alert.h1")),t.find("img").remove(),setTimeout((function(){s.find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),a.text(n).show(),a.removeAttr("onclick"),a.addClass("downloadlink_report"),a.attr("target","_blank"),a.attr("rel","noreferrer noopener"),"report_download"!==r&&a.attr("href",o),a.on("click",(function(){"report_download"===r&&crmExportWMSMsg.download_report(o);var t=$("#"+e);t.find(".downloadlink_report").hide(),t.find(".downloadingLink").show();var n=e.replace("chatcontain","");"report_download"!==r&&crmExportWMSMsg.clearAPopupDiv(n)})),a.removeClass("cancellink"),t.find(".slidercontainer").remove(),t.find("span").remove()}),200))},showFailedIcon:function(e,o){var r,t=I18n.getMsg("crm.import.status.failed"),n=$("#"+e),s=n.find(".exportCloseIcon"),a=n.find(".cancellink");"block"==$(".sumplusdiv").css("display")?((r=$("#EXPORTPOP1")).find(".chatContainer").show(),r.find(".sumplusdiv").hide(),r.find(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll"),setTimeout((function(){n.find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),s.show(),a.text(t).show().css("pointer-events","none"),a.css("color","red"),s.on("click",(function(){var r=e.replace("chatcontain",""),t={};t.module=o,t.action="cancel",t.uniqueID=r;var n,s=Crm.getCrmBasePath()+"/Export.do";"Reports"===o&&(t=void 0,s="/crm/v2/Reports/actions/export_jobs?ids="+r,n="DELETE"),crmExportWMSMsg.ajaxCall(s,t,n,(function(){crmExportWMSMsg.clearAPopupDiv(r)}))})),a.addClass("retrylink"),a.removeClass("cancellink");var r=n.find(".Downstatus");r.find(".slidercontainer").remove(),r.find("span").remove()}),200)):((r=n.find(".Downstatus")).find("span").text(I18n.getMsg("crm.report.export.alert.h1")),r.find("img").remove(),setTimeout((function(){n.find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),s.show(),a.text(t).show().css("pointer-events","none"),a.css("color","red"),s.on("click",(function(){var r=e.replace("chatcontain",""),t={};t.module=o,t.action="cancel",t.uniqueID=r;var n,s=Crm.getCrmBasePath()+"/Export.do";"Reports"===o&&(t=void 0,s="/crm/v2/Reports/actions/export_jobs?ids="+r,n="DELETE"),crmExportWMSMsg.ajaxCall(s,t,n,(function(){crmExportWMSMsg.clearAPopupDiv(r)}))})),a.addClass("retrylink"),a.removeClass("cancellink"),r.find(".slidercontainer").remove(),r.find("span").remove()}),200))},clearAPopupDiv:function(e){var o=$("#EXPORTPOP1");if(crmExportWMSMsg.newkey>0?crmExportWMSMsg.newkey--:crmExportWMSMsg.newkey=0,"undefined"!=typeof Storage){var r=localStorage.getItem(crmExportWMSMsg.export);r&&(delete(r=JSON.parse(r))[e],localStorage.setItem(crmExportWMSMsg.export,JSON.stringify(r)))}var t=$("#chatcontain"+e),n=o.find(".chatContainer");t[0]&&1===n.length?(crmExportWMSMsg.newkey=0,o.remove()):t.remove()},updateLocalStorage:function(e){if("undefined"!=typeof Storage){var o=e[crmExportWMSMsg.UNIQUEID],r=localStorage.getItem(crmExportWMSMsg.export);r||(r="{}"),r=JSON.parse(r),e[crmExportWMSMsg.MODIFIEDTIME]=(new Date).getTime(),delete e[crmExportWMSMsg.ACTION],delete e[crmExportWMSMsg.UNIQUEID],delete e[crmExportWMSMsg.USERID],delete e.date,r[o]=e,localStorage.setItem(crmExportWMSMsg.export,JSON.stringify(r))}},showHidePicklistSchedulerDiv:function(){var e=$("#rls-contSharStaLoad-pop");e.hasClass("schedularOpen")?(e.removeClass("schedularOpen"),clearTimeout(crmExportWMSMsg.closeAll),crmExportWMSMsg.clearAllreplace()):(e.addClass("schedularOpen"),setTimeout((function(){e.removeClass("schedularOpen")}),5e3))},showPicklistinfo:function(e){$(".viewInfoTbl").removeClass("dN"),$(".viewInfoData").slideUp(300),$(e).addClass("dN"),$(e).siblings(".viewInfoData").slideDown(300),clearTimeout(crmExportWMSMsg.closeAll),crmExportWMSMsg.clearAllreplace()},clearAllreplace:function(){crmExportWMSMsg.closeAll=setTimeout((function(){var e=$("#rls-contSharStaLoad-pop");e.removeClass("schedularOpen"),e.remove(),$("#wmsstatusbar .crm-chatBarIcons").find(".schedularProgress-icon").remove()}),15e3)},showHideSchedulerNotificationModal:function(){var e=document.querySelector("crm-scheduler-notification-modal");e&&e.getData("showModal")?e.setData("showModal",!1):e&&!e.getData("showModal")&&e.setData("showModal",!0)},scheduledFiles:function(e){var o=JSON.parse("{}");e=JSON.parse(e);var r=$L.moment().toDate().getTime();for(var t in e){var n=e[t];r-n[crmExportWMSMsg.MODIFIEDTIME]<=18e6&&(o[t]=n,crmExportWMSMsg.showCommonMsg(t,n,crmExportWMSMsg.export))}localStorage.setItem(crmExportWMSMsg.export,JSON.stringify(o))},download_report:function(e){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&!window.Encryptionenabled){var e=window.URL.createObjectURL(o.response),r=document.createElement("a");r.href=e;var t="",n=o.getResponseHeader("Content-Disposition");if(n&&-1!==n.indexOf("attachment")){var s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(n);null!==s&&s[1]&&(t=s[1].replace(/['"]/g,""))}r.download=decodeURIComponent(t),r.click()}2===o.readyState&&(200===o.status?o.responseType="blob":o.responseType="text")},o.open("GET",e,!0),o.setRequestHeader("Content-type","application/json");var r={"X-CRM-ORG":crmZgid,"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};for(var t in r)o.setRequestHeader(t,r[t]);o.responseType="blob",o.send()},showHideMcActivationSchedulerNotificationModal:function(){var e=$L("crux-schedular-notification-popup")[0];e&&e.setData("cxPropShow",!e.getData("cxPropShow"))}};