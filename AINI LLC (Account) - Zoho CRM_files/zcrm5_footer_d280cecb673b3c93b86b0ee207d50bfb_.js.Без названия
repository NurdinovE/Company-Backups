var crmReports={};function quickCreateValidateAction(e,t,r){var a="100%",o=$("#qCreate"),i=o.find(".qcontainer").outerHeight();if("Remind At"===e){if(("Tasks"==(g=$("form[name="+r+"]").find("input[id=quick_module]").val())||"Events"==g)&&getElm(r,"remCheckTask")){var n=null,s=null,l=null,c=null,d=null;if("Tasks"==g){var u=!1;if(getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&(u=!0),getElm(r,"remCheckTask").checked&&!u&&getElm(r,"periodBased")&&!getElm(r,"periodBased").checked){if(!commonUtils.emptyCheck("property(Remind At)","Remind At",void 0,void 0,void 0,!0))return $("#quickTaskDefault").css({left:"0px"}),$("#quickRemindAt").css({left:"100%"}),quickTask.offReminder(),!1;if(!CrmDateUtils.dateValidate("property(Remind At)","Remind At",""))return!1;if(getElm(r,"property(Due Date)")&&""!=getElm(r,"property(Due Date)").value&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN,getElm(r,"property(Due Date)").value)&&!CrmDateUtils.dateComparison("property(Remind At)","Remind At","property(Due Date)","Due Date","LE"))return!1}if(d=" ",n=getElm(r,"property(Remind At)").value,getElm(r,"periodBased")&&getElm(r,"periodBased").checked&&(d=getElm(r,"remTimeOn").value+" "+getElm(r,"remTimePeriod").value,getElm(r,"remTime").value=d,n=getElm(r,"property(Due Date)").value,getElm(r,"property(Remind At)").value=n,getElm(r,"property(Remind Athour)").value=getElm(r,"property(Remind At1hour)").value,getElm(r,"property(Remind Atminute)").value=getElm(r,"property(Remind At1minute)").value,$("#dateBasedRemindAtTime").val($("#periodBasedRemindAtTime").val()),"HH:mm"!=Crm.userDetails.TIME_FORMAT&&(getElm(r,"property(Remind Atampm)").value=getElm(r,"property(Remind At1ampm)").value,$('[id="Remind At_ampmSpan"]').text($('[id="Remind At1_ampmSpan"]').text()))),s=getElm(r,"property(Remind Athour)").value,l=getElm(r,"property(Remind Atminute)").value,"HH:mm"!=Crm.userDetails.TIME_FORMAT&&(c=getElm(r,"property(Remind Atampm)").value),u)return!0}"Events"==g&&(n=getElm(r,"property(Start DateTime)").value,getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&(n=getElm(r,"property(Start Date1)").value),s=getElm(r,"property(Start DateTimehour)").value,l=getElm(r,"property(Start DateTimeminute)").value,"HH:mm"!=Crm.userDetails.TIME_FORMAT&&(c=getElm(r,"property(Start DateTimeampm)").value),d=getElm(r,"remTime").value);var m=!1,p={date:n,hour:s,minute:l,ampm:c,eventBefore:d};return Activities.checkForReminderDate(p,(function(e){if("true"==e)return $("#reminderValidationMsg").text(I18n.getMsg("crm.noreminder.atspecdate")),m=!1,!1;m=!0,$("[name="+r+"] [id=remindAtInfo]").text($("select[name=alertType] option:selected").text()),$("[name="+r+"] [id=quickRemindChk]").attr("checked",!0),$("[name="+r+"] [id=quickTaskDefault]").css({left:"0px"}),$("[name="+r+"] [id=quickRemindAt]").css({left:a}),quickTask.createReminder()})),0==m?!1:("Tasks"!==g&&$("#remindAtInfo").hasClass("BT")&&$("#remindAtInfo").append('<span class="taskPopDescSpan" >'+n+"  -  "+s+":"+l+" "+(void 0!==c?c:"")+"</span>"),"salesinbox"==Q.source&&o.css("height",i),!0)}}else if("Recurring"===e){var g;if("Tasks"!=(g=$("form[name="+r+"]").find("input[id=quick_module]").val())&&isRecurringActivity(g)&&($("[name="+r+"] [id=qRecInfo]").text($("select[name=period] option:selected").text()),$("[name="+r+"] [id=quickRecurringChk]").prop("checked",!0),$("[name="+r+"] [id=quickTaskDefault]").css({left:"0px"}),$("[name="+r+"] [id=quickRecurring]").css({left:a})),"salesinbox"==Q.source&&o.css("height",i),"Tasks"==g){$("[name="+r+"] [id=recurAtCheckbox]").prop("checked",!0);var h=$("[name='"+r+"'] input[name='property(Recurring Activity)']"),v=$("[name='"+r+"'] input[name='property(Remind At)']");h.length&&v.length&&h.prop("checked")?-1!=r.indexOf("ctiapi")&&(getElm(r,"remTime").className="select",v.attr("class","hide")):v.length;var f=getElm(r,"period").value;if("custom"!=f&&"none"!=f){var C=crmCalendar.getDateObjectFromGivenDateString($("#Crm_Tasks_DUEDATE").val());"daily"==f?getElm(r,"dailyhidden").value=1:"weekly"==f?$("[name="+r+"] input[name='day"+(C.getDay()+1)+"']").prop("checked",!0):"monthly"==f?(getElm(r,"noMonths1").value=1,getElm(r,"monthlyhidden").value=1,getElm(r,"monthly1select").value=C.getDate()):"yearly"==f&&(getElm(r,"yearlyhidden").value=1,getElm(r,"yearmonths").value=C.getMonth(),getElm(r,"yearlydays1select").value=C.getDate())}else"custom"==f&&"none"!=f&&"monthly"==getElm(r,"customPeriod").value&&(getElm(r,"noMonths2").value=getElm(r,"noMonths1").value);return getElm(r,"endRadioOption").value=$('.qc_rec_content [name="qc_rec_ends"]:checked').val(),$("[name="+r+"] input[name='property(Recurring Activity)']").prop("checked")&&$("[name="+r+"] input[name='remCheckTask']").prop("checked")&&"none"!=$("[name="+r+"] select[name='remTaskRepeat']").val()&&quickTask.offReminder(),!0}}else if("All"===e){if(("Events"==t||"Tasks"==t)&&$("[name="+r+"] input[name='property(Recurring Activity)']").prop("checked")&&$("[name="+r+"] input[name='remCheckTask']").prop("checked")&&"none"!=$("[name="+r+"] select[name='remTaskRepeat']").val())return alert(I18n.getMsg("crm.norepreminder.recurring")),!1;if("Tasks"===t&&"custom"==getObj("period").value)switch(getObj("customPeriod").value){case"daily":getObj("weeklyhidden").value=1,getObj("noMonths1").value=1,getObj("noMonths2").value=1;break;case"weekly":getObj("daily111").value=1,getObj("noMonths1").value=1,getObj("noMonths2").value=1;break;case"monthly":getObj("daily111").value=1,getObj("weeklyhidden").value=1;break;case"yearly":getObj("daily111").value=1,getObj("weeklyhidden").value=1,getObj("noMonths1").value=1,getObj("noMonths2").value=1}var y=qComboCount-1;if(y>0)for(var b=1;b<=y;b++)for(var I=0,T=getElm(r,"comboValue"+b).length,w=0;w<T;w++)1==getElm(r,"comboValue"+b).options[w].selected?(getElm(r,"combo"+b).value=0==I?getElm(r,"comboValue"+b).options[w].value:getElm(r,"combo"+b).value+";"+getElm(r,"comboValue"+b).options[w].value,I++):0==I&&(getElm(r,"combo"+b).value="");if("Calls"==t&&getElm(r,"property(Call Duration)")&&(getElm(r,"property(Call Duration)").value=getCallDuration(r)),!validationUtils.formValidate(r))return!1;if("Cases"==t){var E=getElm(r,"property(Case Origin)"),k="property(Email)";if(E)if("Email"==E.options[E.options.selectedIndex].value&&getElm(r,k)&&!commonUtils.emptyCheck(k,"Email"))return!1}document[r],t.toUpperCase().substring(0,t.length-1);return!0}}function multiSelectRemoval(e){for(var t,r=new RegExp("^comboValue"),a=document[e].elements.length,o=document[e].elements,i=0;i<a;i++)if((t=o[i])&&r.test(t.name)&&-1===e.indexOf("ctiapi"))try{$(t).remove(),i--}catch(e){}}function selectCreateEntityAction(e,t,r,a){if(a&&-1==r.indexOf("createEntityForm")){var o=a.target;r=$(o).closest("form")[0].name}var i=getObj("comboCount").value;if(t=getObj("module").value,i>0)for(var n=1;n<=i;n++){var s=0;if(getElm(r,"comboValue"+n))for(var l=0;l<getElm(r,"comboValue"+n).length;l++)1==getElm(r,"comboValue"+n).options[l].selected?(getElm(r,"combo"+n).value=0==s?getElm(r,"comboValue"+n).options[l].value:getElm(r,"combo"+n).value+";"+getElm(r,"comboValue"+n).options[l].value,s++):0==s&&(getElm(r,"combo"+n).value="")}if(("Contacts"==t||"Leads"==t)&&getObj("property(Twitter)")){var c=getObj("property(Twitter)").value;if(c.trim().length>50)return alert(I18n.getMsg("crm.tw.err.max.twHandleName",I18n.getMsg(singularModule))),!1;if(c.trim().length<50&&c.trim().length>0){if(!/^[a-zA-Z0-9_]*$/.test(c))return alert(I18n.getMsg("crm.tw.err.twHandleName.patterenCheck",I18n.getMsg(singularModule))),!1}}if("Events"==t){if(getElm(r,"invitees")){var d=getElm(r,"invitees").value.split(","),u=new RegExp("^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$");for(n=0;n<d.length;n++)if(""!=d[n]&&!u.test(trimBoth(d[n])))return alert(I18n.getMsg("crm.email.check",I18n.getMsg(singularModule))),getElm(r,"invitees").focus(),!1}}else if("Cases"==t){var m=getElm(r,"property(Case Origin)");if(m.options[m.options.selectedIndex].value==I18n.getMsg("Email")&&getElm(r,"property(Email)")&&!commonUtils.emptyCheck("property(Email)","Email"))return!1}else if("Leads"==t||"Accounts"==t||"Vendors"==t){var p=getElm(r,"property(Website)")?getElm(r,"property(Website)").value.trim():"";if(p&&!validationUtils.isValidWebURL_extended("Website",p))return!1}else if("Calls"==t)$("#timesData #sdiv").hide(),$(".AmpmnewValues").addClass("hide"),getElm(r,"property(Call Duration)")&&(getElm(r,"property(Call Duration)").value=getCallDuration(r)),getElm(r,"property(Call Start Timehour)")&&(getElm(r,"property(Call Start Timehour)").disabled=!1,getElm(r,"property(Call Start Timeminute)").disabled=!1,getElm(r,"property(Call Start Timeampm)").disabled=!1);else if(Crm.isInventoryModule(t)){if(settotalnoofrows(),!inventoryValidate())return!1;if("Invoices"==t){var g=0;for(l=1;l<=rowCnt;l++)getElm(r,"hdnQtyStock"+l).value<=0&&1==++g&&getElm(r,"txtProduct"+l).value;if(1==g){if(!window.confirm(getElm(r,"confirmvalid").value))return!1}else if(g>1&&!window.confirm(getElm(r,"confirmvalid").value))return!1}var h=getElm(r,"currentSelectedRow");null!=h&&-1!=h.value&&calcTotal(getElm(r,"txtQty"+parseInt(h.value)))}else if("PriceBooks"==t)if(getElm(r,"secDivPricing Details")&&"block"==getElm(r,"secDivPricing Details").style.display||""==getElm(r,"secDivPricing Details").style.display){if(!priceListValidate())return!1;getElm(r,"totalPriceCount").value=priceRowCount}else getElm(r,"totalPriceCount").value=0;else"Potentials"==t&&calculateExpectedRevenue();if(("Events"==t||"Tasks"==t)&&!isRecurringActivity(t))return!1;if("Tasks"==t&&getElm(r,"remCheckTask")){var v=!1;if(getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&(v=!0),getElm(r,"remCheckTask").checked&&!v){if(!commonUtils.emptyCheck("property(Remind At)","Remind At"))return!1;if(!CrmDateUtils.dateValidate("property(Remind At)","Remind At",""))return!1}else getElm(r,"property(Remind At)").value=""}if(("Events"==t||"Tasks"==t)&&getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&getElm(r,"remCheckTask")&&getElm(r,"remCheckTask").checked&&"none"!=getElm(r,"remTaskRepeat").value)return alert(I18n.getMsg("crm.norepreminder.recurring",I18n.getMsg(singularModule))),!1;if(!pageValidate(r))return!1;if(("Tasks"===t||"Events"===t)&&getElm(r,"remCheckTask")&&getElm(r,"remCheckTask").checked||"Calls"===t&&"ScheduleCall"===jQuery("input[name=whichCall]:checked").val()&&getElm(r,"remTime")&&"0"!==getElm(r,"remTime").value){var f,C,y,b,I,T;if("Tasks"==t&&(f=getElm(r,"property(Remind At)").value,I=" ",getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&(f=getElm(r,"property(Start Date1)").value,I=getElm(r,"remTime").value),C=getElm(r,"property(Remind Athour)").value,y=getElm(r,"property(Remind Atminute)").value,"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(b=getElm(r,"property(Remind Atampm)").value),getElm(r,"dtPtn_property(Remind At)").innerHTML),"Events"==t&&(f=getElm(r,"property(Start DateTime)").value,getElm(r,"property(Recurring Activity)")&&getElm(r,"property(Recurring Activity)").checked&&(f=getElm(r,"property(Start Date1)").value),C=getElm(r,"property(Start DateTimehour)").value,y=getElm(r,"property(Start DateTimeminute)").value,"HH:mm"!=Crm.userDetails.TIME_FORMAT&&(b=getElm(r,"property(Start DateTimeampm)").value),getElm(r,"dtPtn_property(Start DateTime)").innerHTML,I=getElm(r,"remTime").value),"Calls"===t&&(f=getObj("property(Call Start Time)").value,C=getObj("property(Call Start Timehour)").value,y=getObj("property(Call Start Timeminute)").value,"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(b=getObj("property(Call Start Timeampm)").value),getObj("dtPtn_property(Call Start Time)").innerHTML,I=getObj("remTime").value),""==f||""==C||""==y)return!1;var w={date:f,hour:C,minute:y,ampm:b,eventBefore:I};if(Activities.checkForReminderDate(w,(function(a){"true"==a?(alert(I18n.getMsg("crm.noreminder.atspecdate",I18n.getMsg(singularModule))),T=!1):"Tasks"==t&&"Create&AddToZG"==e?checkForGTaskList(e,t):viewEntityInfo(e,t,r)})),0==T)return!1}else"Tasks"==t&&"Create&AddToZG"==e?checkForGTaskList(e,t):(crmTab.emptyCache(),viewEntityInfo(e,t,r));return!1}function viewEntityInfo(e,t,r){if(r&&"undefined"!==r&&"null"!==r||(r=$("[name^=createEntityForm]")[0].name),getObj("property(Probability)")&&getObj("property(Probability)").value>100)return alert(I18n.getMsg("crm.create.pbty.check",I18n.getMsg(singularModule))),!1;if(null!=document[r].elements["property(Portal User)"]&&document[r].elements["property(Portal User)"].checked){if(null==document[r].elements["property(Email)"])return alert(I18n.getMsg("crm.alert.portal.email.check",I18n.getMsg(t))),!1;if(!commonUtils.emptyCheck("property(Email)","Email"))return!1}if("Create&New"==e){var a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModuleandNew.do";i=(i=a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value&&(ActivityMoreInfoContent="none"),ajaxNew(o,i)}else if("Create&NewFUTask"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModuleandNew.do";i=(i=a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&futask=1",ajaxNew(o,i)}else if("Edit&NewFUTask"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModuleandNew.do";i=(i="ActionType=Edit&"+a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&futask=1",ajaxNew(o,i)}else if("Create&AddToZG"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModule.do";i=(i="ActionType=AddToZG&"+a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}else if("Edit&New"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModuleandNew.do";i=(i="ActionType=Edit&"+a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}else if("Create"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CreateCommonModule.do";i=(i=a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),"Events"==t&&(i+="&createdFrom="+$("#createFromHid").val()),taskKanbanViewCache&&"false"!==taskKanbanViewCache?document.getElementById("cvEditSave")&&($("#cvEditSave").empty(),hide("cvEditSave")):(commonUtils.showHideLoadingDiv(),taskDetailsview.listAnimation("close")),ajaxNew(o,i)}else if("Edit"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/EditCommonModule.do";var i="lookback=true&ActionType=Edit&"+a;if(iskvFollowupEdit=!0,iskvFollowupTask=!0,getObj("viewType")&&"CalendarView"==getObj("viewType").value){document[r];for(var n,s=t.toUpperCase().substring(0,t.length-1)+"CF",l=new RegExp("^"+s),c=new RegExp("^comboValue"),d=document[r].elements.length,u=document[r].elements,m=0;m<d;m++)if((n=u[m])&&"hidden"==n.type&&("fieldname"==n.name||"dateFields"==n.name||"fieldlabel"==n.name||"fielddatatype"==n.name||"picklistFields"==n.name||"fieldvalues"==n.name||"mapValues"==n.name||"fieldName"==n.name||"fieldLabel"==n.name||"fieldDatatype"==n.name||"fieldUitype"==n.name||"fieldId"==n.name||"fieldTableName"==n.name||"fieldLen"==n.name||n.name.indexOf("uiType_")>=0||l.test(n.name)||c.test(n.name)))try{n.parentNode.removeChild(n),m--}catch(e){}var p=document.createElement("INPUT");p.type="hidden",p.value=encodeURIComponent(csrfToken),p.name=csrfParamName,document[r].appendChild(p),document[r].action=o+"?ActionType=Edit",document[r].method="post",i=i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}else i=i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}else if("Clone"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CloneCommonModule.do";i=(i=a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}else if("Clone&New"==e){a=commonUtils.formData2QueryString(document[r],t),o=Crm.getCrmBasePath()+"/CloneCommonModuleandNew.do";i=(i=a)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(o,i)}return!1}function inventoryValidate(){var e=getObj("totalProductCount").value;if(null!=e&&""!=e&&parseInt(e)<=0||null==e||""==e)return alert(I18n.getMsg("crm.product.select.check",I18n.getMsg(singularModule))),!1;for(var t=1;t<=rowCnt;t++)if(!commonUtils.emptyCheck(getElemById("txtProduct"+t),"Product Name","text"))return!1;return!0}function priceListValidate(){for(var e=1;e<=priceRowCount;e++){if(!commonUtils.emptyCheck("txtFromRange"+e,"From Range"))return!1;if(!commonUtils.emptyCheck("txtToRange"+e,"To Range"))return!1;if(!commonUtils.emptyCheck("txtDiscount"+e,"Discount"))return!1;if(!validationUtils.decimalValidate("txtFromRange"+e,"From Range","any"))return!1;if(!validationUtils.decimalValidate("txtToRange"+e,"To Range","any"))return!1;if(!validationUtils.decimalValidate("txtDiscount"+e,"Discount","any"))return!1;var t=parseFloat(getObj("txtFromRange"+e).value),r=parseFloat(getObj("txtToRange"+e).value);if(r<t)return alert(I18n.getMsg("crm.alert.selected.rangevalue",I18n.getMsg(singularModule))),!1;for(var a=1;a<=priceRowCount;a++)if(e!=a){var o=parseFloat(getObj("txtFromRange"+a).value),i=parseFloat(getObj("txtToRange"+a).value);if(t>=o&&t<=i||r>=o&&r<=i)return alert(I18n.getMsg("crm.alert.selected.rangevalue",I18n.getMsg(singularModule))),!1}}return!0}function isRecurringActivity(e){if(getObj("property(Recurring Activity)")&&1==getObj("property(Recurring Activity)").checked){if("Tasks"==e){if("3"==$('.qc_rec_content [name="qc_rec_ends"]:checked').val()){if(""==getObj("repeatEndDate").value)return alert(I18n.getMsg("crm.recurrence2",I18n.getMsg(e))),getObj("repeatEndDate").focus(),!1;if(!CrmDateUtils.dateValidate("repeatEndDate","End Date",""))return!1;if(!CrmDateUtils.dateComparison("repeatEndDate","End Date","property(Due Date)","Start Date","G"))return!1;var t=new Date(crmCalendar.getDateObjectFromGivenDateString($(getObj("property(Due Date)")).val())),r=new Date(crmCalendar.getDateObjectFromGivenDateString($(getObj("repeatEndDate")).val())),a=t,o=1;if("custom"==(n=getObj("period").value))switch(n=getObj("customPeriod").value){case"daily":o=parseInt(trimBoth(getObj("daily111").value));break;case"weekly":o=parseInt(trimBoth(getObj("weeklyhidden").value));break;case"monthly":o=parseInt(trimBoth(getObj("noMonths1").value))}switch(n){case"daily":if(a.setDate(a.getDate()+o*(crmConstants.recurringEndDateLimit[n]-1)),!Utils.compareDate(r,a))return alert(I18n.getMsg("crm.recurrence.days.exceed",[Utils.getDateInUserDatePattern(a)])),!1;break;case"weekly":if(a.setDate(a.getDate()+o*(crmConstants.recurringEndDateLimit[n]-1)),!Utils.compareDate(r,a))return alert(I18n.getMsg("crm.recurrence.weekly.exceed",[Utils.getDateInUserDatePattern(a)])),!1;break;case"monthly":if(a.setDate(a.getDate()+o*(crmConstants.recurringEndDateLimit[n]-1)/2),!Utils.compareDate(r,a))return alert(I18n.getMsg("crm.recurrence.monthly.exceed",[Utils.getDateInUserDatePattern(a)])),!1;break;case"yearly":if(a.setDate(a.getDate()+o*(crmConstants.recurringEndDateLimit[n]-1)),!Utils.compareDate(r,a))return alert(I18n.getMsg("crm.recurrence.yearly.bulk.exceed",[Utils.getDateInUserDatePattern(a)])),!1}}else if("2"==$('.qc_rec_content [name="qc_rec_ends"]:checked').val()){var i=trimBoth(getObj("repeatEndCount").value);if(getObj("repeatEndCount").value=i.replace(/^0+/,""),""==i||parseInt(i)<=0||isNaN(i))return alert(I18n.getMsg("crm.recurrence6",I18n.getMsg(e))),!1;switch("custom"==(n=getObj("period").value)&&(n=getObj("customPeriod").value),n){case"daily":if(parseInt(i)>365)return alert(I18n.getMsg("crm.recurrence.daily.exceed1")),!1;break;case"weekly":if(parseInt(i)>105)return alert(I18n.getMsg("crm.recurrence.weekly.exceed1")),!1;break;case"monthly":if(parseInt(i)>30)return alert(I18n.getMsg("crm.recurrence.monthly.exceed1")),!1;break;case"yearly":if(parseInt(i)>10)return alert(I18n.getMsg("crm.recurrence.yearly.exceed1")),!1}}}else if("Tasks"!=e){if(""==trimBoth(getObj("property(Start Date1)").value))return alert(I18n.getMsg("crm.recurrence1",I18n.getMsg(e))),getObj("property(Start Date1)").focus(),!1;if(!CrmDateUtils.dateValidate("property(Start Date1)","Start Date",""))return!1;if(""==getObj("property(End Date1)").value)return alert(I18n.getMsg("crm.recurrence2",I18n.getMsg(e))),getObj("property(End Date1)").focus(),!1;if(!CrmDateUtils.dateValidate("property(End Date1)","End Date",""))return!1;if(!CrmDateUtils.dateComparison("property(End Date1)","End Date","property(Start Date1)","Start Date","GE"))return!1}var n=getObj("period").value;if("Tasks"==e&&"custom"==n&&(n=getObj("customPeriod").value),"none"==n)return alert(I18n.getMsg("crm.recurrence3",I18n.getMsg(e))),!1;if("daily"==n){if(""==getObj("dailyhidden").value)return alert(I18n.getMsg("crm.recurrence4",I18n.getMsg(e))),!1;if("2"==getObj("dailyhidden").value){var s=trimBoth(getObj("daily111").value);if(getObj("daily111").value=s.replace(/^0+/,""),""==s||parseInt(s)<=0||isNaN(s))return alert(I18n.getMsg("crm.recurrence6",I18n.getMsg(e))),getObj("daily111").focus(),!1;if(!validationUtils.intValidate("daily111","crm.recurrence10"))return!1}else getObj("daily111")&&(getObj("daily111").value="")}else if("weekly"==n){var l=trimBoth(getObj("weeklyhidden").value);if(getObj("weeklyhidden").value=l.replace(/^0+/,""),""==l||parseInt(l)<=0||isNaN(l))return alert(I18n.getMsg("crm.recurrence6",I18n.getMsg(e))),!1;if(!validationUtils.intValidate("weeklyhidden","crm.recurrence10"))return!1;if("custom"==getObj("period").value){var c="false";for(chkcnt=1;chkcnt<=7;chkcnt++)1==getObj("day"+chkcnt).checked&&(c="true");if("false"==c)return alert(I18n.getMsg("crm.recurrence7",I18n.getMsg(e))),!1}}else if("monthly"==n){if(""==getObj("monthlyhidden").value)return alert(I18n.getMsg("crm.recurrence4",I18n.getMsg(e))),!1;if("1"==getObj("monthlyhidden").value){var d=trimBoth(getObj("noMonths1").value);if(getObj("noMonths1").value=d.replace(/^0+/,""),getObj("noMonths2")&&(getObj("noMonths2").value=""),""==d||parseInt(d)<=0||isNaN(d))return alert(I18n.getMsg("crm.recurrence6",I18n.getMsg(e))),getObj("noMonths1").focus(),!1;if(!validationUtils.intValidate("noMonths1","crm.recurrence10"))return!1}else if("2"==getObj("monthlyhidden").value){var u=trimBoth(getObj("noMonths2").value);if("Tasks"==e&&(u=trimBoth(getObj("noMonths1").value)),getObj("noMonths2").value=u.replace(/^0+/,""),getObj("noMonths1")&&"Tasks"!=e&&(getObj("noMonths1").value=""),""==u||parseInt(u)<=0||isNaN(u))return alert(I18n.getMsg("crm.recurrence6",I18n.getMsg(e))),getObj("noMonths2").focus(),!1;if(!validationUtils.intValidate("noMonths2","crm.recurrence10"))return!1}}else if("yearly"==n&&""==getObj("yearlyhidden").value)return alert(I18n.getMsg("crm.recurrence4",I18n.getMsg(e))),!1;if("Tasks"!=e&&!recurringEventLimitChk(getObj("property(Start Date1)").value,getObj("property(End Date1)").value,getObj("period").value))return!1}return!0}function recurringEventLimitChk(e,t,r){var a="Events",o=!1,i=0,n=crmCalendar.getDateObjectFromGivenDateString(e),s=crmCalendar.getDateObjectFromGivenDateString(t),l=new Date(n);if(!Crm.isHeadless&&crmListView.getObject()&&crmListView.getObject().selectedIds&&null==getObj("entityid")&&(i=crmListView.getObject().selectedIds.length),(document.getElementsByName("property(bulkIds)").length>0&&document.getElementsByName("property(bulkIds)")[0].value.split(";").length>1||i>1)&&(o=!0),"yearly"==r){yrsBetween(e,t);if(l.setDate(l.getDate()+3652.5),o&&!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.yearly.bulk.exceed",[Utils.getDateInUserDatePattern(l)])),!1;if(!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.yearly.bulk.exceed",[Utils.getDateInUserDatePattern(l)])),!1}else if("monthly"==r){var c;if(number_of_months=monthsBetween(e,t),0==(c="1"==getObj("monthlyhidden").value?getObj("noMonths1").value:getObj("noMonths2").value))return alert(I18n.getMsg("crm.recurrence.repeat.frequency",I18n.getMsg(a))),!1;if(number_of_months/=parseInt(c),l.setMonth(l.getMonth()+30*c),o&&!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.monthly.bulk.exceed",[Utils.getDateInUserDatePattern(l)])),!1;if(!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.monthly.exceed",[Utils.getDateInUserDatePattern(l)])),!1}else if("weekly"==r){var d=daysBetween(e,t),u=parseInt(d)/7,m=getObj("weeklyhidden").value;if(0==m)return alert(I18n.getMsg("crm.recurrence.repeat.frequency",I18n.getMsg(a))),!1;u/=parseInt(m);var p=0;for(chkcnt=1;chkcnt<=7;chkcnt++)1==getObj("day"+chkcnt).checked&&p++;if(parseInt(u)*parseInt(p),l.setDate(l.getDate()+parseInt(210*parseInt(m))),o&&!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.weekly.bulk.exceed",[Utils.getDateInUserDatePattern(l)])),!1;if((l=new Date(n)).setDate(l.getDate()+parseInt(735*parseInt(m))),!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.weekly.exceed",[Utils.getDateInUserDatePattern(l)])),!1}else if("daily"==r){d=daysBetween(e,t);var g=1;if("2"==getObj("dailyhidden").value&&(g=getObj("daily111").value),0==g)return alert(I18n.getMsg("crm.recurrence.repeat.frequency",I18n.getMsg(a))),!1;if(d/=parseInt(g),l.setDate(l.getDate()+30*parseInt(g)),o&&!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.days.bulk.exceed",[Utils.getDateInUserDatePattern(l)])),!1;if((l=new Date(n)).setDate(l.getDate()+365*parseInt(g)),!Utils.compareDateandTime(s,l))return alert(I18n.getMsg("crm.recurrence.days.exceed",[Utils.getDateInUserDatePattern(l)])),!1}return!0}function addViewRow(e){I18n.getMsg("Tax"),I18n.getMsg("TotalAfterDiscount"),I18n.getMsg("NetTotal"),I18n.getMsg("Discount"),getElemById("shrow1");rowCnt++;var t="";t+='<tr id="hrow'+rowCnt+"\" onmouseover=\"$(this).find('.icon_roundinfo').css('visibility', 'visible')\" onmouseout=\"$(this).find('.icon_roundinfo').css('visibility', 'hidden')\"> <td align=\"left\"> <span id='value_sno"+rowCnt+"' style='padding:3px;'> "+rowCnt+" </span> </td> ",t+="<td> <span id='value_hdnProductName"+rowCnt+"' onmouseover='productDetails.showPrdDetInView("+rowCnt+')\' onmouseout=\'renderingUtils.zctt.hidett()\'> <a href="javascript:;" class="crm-small-font-size crmLinkColor cP"> <h3 class="fL crm-font-semibold"> </h3> </a> </span> <div class="h20 pR20">',t+="<p id='value_itemDescription"+rowCnt+'\' class="crmEllipticText w200 fL pR5 itemDescription" style="white-space:normal;height:50;overflow:auto"> </p> </div> </td>',t+='<td class="crm-small-font-size aligncenter"> <span id=\'value_txtListPrice'+rowCnt+"' class='lineCurrVal'> </span> <span id='value_hdnUnitPrice"+rowCnt+"' style='display:none'> </span> </td>",t+='<td class="crm-small-font-size aligncenter"> <span id=\'value_txtQty'+rowCnt+"'> </span> <span id='value_hdnQtyStock"+rowCnt+"' style='display:none'> </span> </td> <td class=\"crm-small-font-size aligncenter\"> <span id='value_hdnTotal"+rowCnt+"' class='lineCurrVal'> </span> </td>",t+='<td class="crm-small-font-size aligncenter"> <div class="fL alignRight w60_per"> <span id=\'value_hdnDiscount'+rowCnt+'\' class=\'lineCurrVal\'> </span> </div> <div class="fL alignLeft" style="width:40%"> <i class="icon_roundinfo cP mL5" onclick="productDetails.showDiscountScheme(this,module);sE(event)" style="visibility:hidden"></i></td>',t+='<td class="crm-small-font-size aligncenter"> <span id=\'value_hdnTax'+rowCnt+"' class='lineCurrVal'> </span> </td> <td class=\"crm-small-font-size aligncenter\"> <span id='value_hdnNetTotal"+rowCnt+"' class='lineCurrVal'> </span> <span id=\"value_pricingRange"+rowCnt+'" style="display:none"> </span>  </td> </tr>',$("#linesTable").append(t)}function getProdListBody(){var e=getElemById("productList"),t=null;return e&&(t="TABLE"==e.childNodes.item(0).tagName?e.childNodes.item(0).childNodes.item(0):e.childNodes.item(1).childNodes.item(1)),t}function addRow(e,t){var r=I18n.getMsg("Tax"),a=I18n.getMsg("TotalAfterDiscount"),o=I18n.getMsg("NetTotal"),i=I18n.getMsg("Discount"),n=I18n.getMsg("ProductNameLookup"),s=I18n.getMsg("DeleteRow"),l=I18n.getMsg("PriceBookNameLookUp"),c=I18n.getMsg("PrdDescription"),d=!!getElemById("itemDescription1"),u=document.getElementById("currencySymbol_hdnUnitPrice1"),m=u?u.innerHTML:"&nbsp;";if(null==e&&rowCnt>=100)return alert(I18n.getMsg("crm.lineitem.exceeds.alert",I18n.getMsg(["Products",getObj("singularModule").value]))),!1;rowCnt++;var p="oddListRow";rowCnt%2==0&&(p="evenListRow");var g="<tr id=hrow"+rowCnt+" class='"+p+"'>";g+="<td style='padding:3px;' class='tableData' valign='top'><input id='txtProduct"+rowCnt+"' name='property(hdnProductName"+rowCnt+")' type='text' size='17' maxlength='120' readonly='true'/><img src='"+networkUtils.getImageUrl("Products_small.gif",ResourceConstants.CRM)+"' title='"+n+"' onclick=\"newShowLookUp('txtProduct"+rowCnt+"','hdnProductId"+rowCnt+"','','Products','','','vendorName',undefined,undefined,undefined,undefined,undefined,undefined,undefined,event)\" align='absmiddle' style='cursor:hand;cursor:pointer'/></td>",g+="<td style='padding:3px;' class='tableData' valign='top'><input type='text' class='searchlineItem' id='hdnQtyStock"+rowCnt+"' name='property(hdnQtyStock"+rowCnt+")' readonly='true' size='6' maxlength='9'/><input type='hidden' size='6' id='hdnOldQty"+rowCnt+"' name='property(hdnOldQty"+rowCnt+")'/></td>",g+="<td style='padding:3px;' class='tableData' valign='top'><input type=text id='txtQty"+rowCnt+"' name='property(txtQty"+rowCnt+")' size='7' maxlength='9' onBlur='calcTotal(this)' onkeypress='calcTotalOnEnter(this,event);'/></td>",g+="<td rowspan=2 style='padding:3px;' class='tableData' valign='top'><span id='currencySymbol_hdnUnitPrice"+rowCnt+"'>"+m+"</span><input type='text' id='hdnUnitPrice"+rowCnt+"' name='property(hdnUnitPrice"+rowCnt+")' size='7' maxlength='19' readonly='true' class='searchlineItem'/><input type='hidden' id='hdnProductId"+rowCnt+"' name='property(hdnProductId"+rowCnt+")'/><input type='hidden' id='hdnPriceBookId"+rowCnt+"' name='property(hdnPriceBookId"+rowCnt+")'/></td>",g+="<td rowspan=2 class='tableData' valign='top'>",g+="<table>",g+="<tr><td><span id='currencySymbol_txtListPrice"+rowCnt+"'>"+m+"</span><input type=text id='txtListPrice"+rowCnt+"' name='property(txtListPrice"+rowCnt+")' size='10' maxlength='19' onBlur='calcTotal(this.parentNode.parentNode.parentNode.parentNode)' onkeypress='calcTotalOnEnter(this.parentNode.parentNode.parentNode.parentNode,event);'/> <img src='"+networkUtils.getImageUrl("PriceBooks_small.gif",ResourceConstants.CRM)+"' title='"+l+"' onclick=\"newShowLookUp('txtListPrice"+rowCnt+"','hdnPriceBookId"+rowCnt+"','','PriceBooks','','','hdnProductId"+rowCnt+"',undefined,undefined,undefined,undefined,undefined,undefined,undefined,event)\" align='absmiddle' style='cursor:hand;cursor:pointer'/></td></tr>",g+='<tr><td><div class="alignRight">(-)<b><a id=\'discountInv'+rowCnt+"' href=\"javascript:;\" onclick=\"displayCoords(this,'discount_div_final','discount','linkCount"+rowCnt+"')\" class='link'>"+i+":</a></b></div></td></tr>",g+="<tr><td class='alignRight'>"+a+":</td></tr>",g+='<tr><td><div class="alignRight">(+)<b><a id=\'taxInv'+rowCnt+"' href=\"javascript:;\" onclick=\"displayCoords(this,'tax_div_final','tax','linkCount"+rowCnt+"')\" class='link'>"+r+":</a></b></div></td></tr>",g+="<tr><td class='alignRight'>"+o+":</td></tr></table></td>",g+="<td rowspan=2 style='padding:3px;' class='tableData'><table><tr><td><input type='text' class='searchlineItem' size='10' readonly='true' id='total"+rowCnt+"' name='property(hdnTotal"+rowCnt+")' /></td></tr>",g+="<tr><td><input type='text' id='discount"+rowCnt+"'  name='property(hdnDiscount"+rowCnt+")' size='10' readonly='true' class='searchlineItem'/></td></tr>",g+="<tr><td><input type='text' id='totalAfterDiscount"+rowCnt+"'  name='property(hdnTotalAfterDiscount"+rowCnt+")' size='10' readonly='true' class='searchlineItem'/></td></tr>",g+="<tr><td><input type='text' id='tax"+rowCnt+"'  name='property(hdnTax"+rowCnt+")' size='10' readonly='true' class='searchlineItem'/></td></tr>",g+="<tr><td><input type='text' id='netTotal"+rowCnt+"'  name='property(hdnNetTotal"+rowCnt+")' size='10' readonly='true' class='searchlineItem'/></td></tr></table></td>",g+="<td rowspan=2 style='padding:3px;' align='center' width='15' class='tableData'><span id='delRow"+rowCnt+"'  title='"+s+"'  class='close1 dIB vaM'   onclick='return delRow(this.id)'></span>",g+="&nbsp</td></tr>",g+="<tr id=shrow"+rowCnt+" class='"+p+"'>",g+="<td colSpan='3' class=\"tableData\" style='padding:3px;' valign='top'>",d&&(g+='<span id="indicator_itemDescription'+rowCnt+'"  class="mainleftArrow dIB vaM"></span><a href="javascript:;" onclick="toggleDivDisplay(\'div_itemDescription'+rowCnt+"',"+rowCnt+')">&nbsp;'+c+':</a><div id="div_itemDescription'+rowCnt+'" style="visibility:hidden"><textarea id=\'itemDescription'+rowCnt+"' name='property(itemDescription"+rowCnt+")' cols='30' rows='3' maxlength='3000' style=\"width:100%\"></textarea></div>"),g+="</td></tr>",t||(t=getProdListBody());for(var h=new Array(rowCnt-1),v=(new Array(rowCnt-1),new Array(rowCnt-1)),f=new Array(rowCnt-1),C=new Array(rowCnt-1),y=new Array(rowCnt-1),b=new Array(rowCnt-1),I=new Array(rowCnt-1),T=(i=new Array(rowCnt-1),new Array(rowCnt-1)),w=new Array(rowCnt-1),E=new Array(rowCnt-1),k=new Array(rowCnt-1),O=new Array(rowCnt-1),S=1,R=0;S<=rowCnt-1;S++,R++){h[R]=getElemById("txtProduct"+S).value,f[R]=getElemById("txtQty"+S).value,I[R]=getElemById("hdnOldQty"+S).value,y[R]=getElemById("txtListPrice"+S).value,v[R]=getElemById("hdnQtyStock"+S).value,C[R]=getElemById("hdnUnitPrice"+S).value,i[R]=getElemById("discount"+S).value,w[R]=getElemById("tax"+S).value,T[R]=getElemById("netTotal"+S).value,E[R]=getElemById("totalAfterDiscount"+S).value,k[R]=getElemById("total"+S).value,b[R]=getElemById("hdnProductId"+S).value,(L=getElemById("itemDescription"+S))&&(O[R]=L.value)}getElemById("productList");g=listTableStart+g+"</table>";var M=getDocumentFragment(g),_=M.childNodes[0].childNodes[0].childNodes[0],D=M.childNodes[0].childNodes[0].childNodes[1];t.appendChild(_),t.appendChild(D);for(S=1,R=0;S<=rowCnt-1;S++,R++){var L;getElemById("txtProduct"+S).value=h[R],getElemById("hdnQtyStock"+S).value=v[R],getElemById("txtQty"+S).value=f[R],getElemById("hdnOldQty"+S).value=I[R],getElemById("hdnUnitPrice"+S).value=C[R],getElemById("txtListPrice"+S).value=y[R],getElemById("discount"+S).value=i[R],getElemById("tax"+S).value=w[R],getElemById("netTotal"+S).value=T[R],getElemById("totalAfterDiscount"+S).value=E[R],getElemById("total"+S).value=k[R],getElemById("hdnProductId"+S).value=b[R],(L=getElemById("itemDescription"+S))&&(L.value=O[R])}return!0}function delRow(e){rowCnt>100?invPdtDeleteWarning(e):deleteInvLineItems(e)}function deleteInvLineItems(e){var t=$("#module").closest("form")[0].name;e=parseInt(e.substr(e.indexOf("w")+1,e.length)),getProdListBody();getProdListBody().removeChild(getObj("hrow"+e)),getProdListBody().removeChild(getObj("shrow"+e));for(var r="<tr class='tableHeadBg' height='20' id='tablehead'>"+getObj("tablehead").innerHTML+"</tr>",a=new Array(rowCnt-1),o=new Array(rowCnt-1),i=new Array(rowCnt-1),n=(new Array(rowCnt-1),new Array(rowCnt-1)),s=new Array(rowCnt-1),l=new Array(rowCnt-1),c=new Array(rowCnt-1),d=new Array(rowCnt-1),u=new Array(rowCnt-1),m=new Array(rowCnt-1),p=new Array(rowCnt-1),g=new Array(rowCnt-1),h=new Array(rowCnt-1),v=new Array(rowCnt-1),f=new Array(rowCnt-1),C=1,y=0;C<=e-1;C++,y++){var b=getElemById("shrow"+C)?getElemById("shrow"+C).innerHTML:"";if(C%2==0)var I="evenListRow";else I="oddListRow";a[y]="<tr id='hrow"+C+"' class='"+I+"'>"+getElemById("hrow"+C).innerHTML+"</tr>",o[y]="<tr id='shrow"+C+"' class='"+I+"'>"+b+"</tr>",r+=a[y]+o[y]+"<tr id='tableline'><td colSpan='8' class='tableRowSep'></td></tr>",i[y]=getElemById("txtProduct"+C).value,n[y]=getElemById("hdnQtyStock"+C).value,s[y]=getElemById("txtQty"+C).value,u[y]=getElemById("hdnOldQty"+C).value,c[y]=getElemById("hdnUnitPrice"+C).value,l[y]=getElemById("txtListPrice"+C).value,m[y]=getElemById("discount"+C).value,h[y]=getElemById("tax"+C).value,p[y]=getElemById("netTotal"+C).value,g[y]=getElemById("totalAfterDiscount"+C).value,v[y]=getElemById("total"+C).value,d[y]=getElemById("hdnProductId"+C).value,(O=getElemById("itemDescription"+C))&&(f[y]=O.value)}for(C=e+1;C<=rowCnt;C++,y++){a[y]=getElemById("hrow"+C).innerHTML,o[y]=getElemById("shrow"+C).innerHTML;var T=a[y];T=replace(T,"hrow"+C,"hrow"+(C-1)),T=replace(T,"hdnProductName"+C,"hdnProductName"+(C-1)),T=replace(T,"txtProduct"+C,"txtProduct"+(C-1)),T=replace(T,"hdnQtyStock"+C,"hdnQtyStock"+(C-1)),T=replace(T,"txtQty"+C,"txtQty"+(C-1)),T=replace(T,"hdnOldQty"+C,"hdnOldQty"+(C-1)),T=replace(T,"hdnUnitPrice"+C,"hdnUnitPrice"+(C-1)),T=replace(T,"txtListPrice"+C,"txtListPrice"+(C-1)),T=replace(T,"discount"+C,"discount"+(C-1)),T=replace(T,"discountInv"+C,"discountInv"+(C-1)),T=replace(T,"hdnDiscount"+C,"hdnDiscount"+(C-1)),T=replace(T,"tax"+C,"tax"+(C-1)),T=replace(T,"taxInv"+C,"taxInv"+(C-1)),T=replace(T,"hdnTax"+C,"hdnTax"+(C-1)),T=replace(T,"totalAfterDiscount"+C,"totalAfterDiscount"+(C-1)),T=replace(T,"hdnTotalAfterDiscount"+C,"hdnTotalAfterDiscount"+(C-1)),T=replace(T,"netTotal"+C,"netTotal"+(C-1)),T=replace(T,"hdnNetTotal"+C,"hdnNetTotal"+(C-1)),T=replace(T,"total"+C,"total"+(C-1)),T=replace(T,"linkCount"+C,"linkCount"+(C-1)),T=replace(T,"delRow"+C,"delRow"+(C-1)),T=replace(T,"hdnProductId"+C,"hdnProductId"+(C-1)),T=replace(T,"hdnPriceBookId"+C,"hdnPriceBookId"+(C-1)),T=replace(T,"hdnTotal"+C,"hdnTotal"+(C-1));var w=o[y];if(w=replace(w,"shrow"+C,"shrow"+(C-1)),w=replace(w,"toggleDivDisplay('div_itemDescription"+C+"',"+C+")","toggleDivDisplay('div_itemDescription"+(C-1)+"',"+(C-1)+")"),w=replace(w,"itemDescription"+C,"itemDescription"+(C-1)),w=replace(w,"indicator_itemDescription"+C,"indicator_itemDescription"+(C-1)),w=replace(w,"prdLineDesc"+C,"prdLineDesc"+(C-1)),(C-1)%2==0)I="evenListRow";else I="oddListRow";a[y]="<tr id='hrow"+(C-1)+"' class='"+I+"'>"+T+"</tr>",o[y]="<tr id='shrow"+(C-1)+"' class='"+I+"'>"+w+"</tr>",r+=a[y]+o[y]+"<tr id='tableline'><td colSpan='8' class='tableRowSep'></td></tr>",i[y]=getElemById("txtProduct"+C).value,n[y]=getElemById("hdnQtyStock"+C).value,s[y]=getElemById("txtQty"+C).value,u[y]=getElemById("hdnOldQty"+C).value,c[y]=getElemById("hdnUnitPrice"+C).value,l[y]=getElemById("txtListPrice"+C).value,m[y]=getElemById("discount"+C).value,h[y]=getElemById("tax"+C).value,p[y]=getElemById("netTotal"+C).value,g[y]=getElemById("totalAfterDiscount"+C).value,v[y]=getElemById("total"+C).value,d[y]=getElemById("hdnProductId"+C).value,(O=getElemById("itemDescription"+C))&&(f[y]=O.value)}getProdListBody();var E=listTableStart+r+"</table>",k=getDocumentFragment(E);getElemById("productList").removeChild(getElemById("productList").children[0]),getElemById("productList").appendChild(k),rowCnt--;for(C=1,y=0;C<=rowCnt;C++,y++){var O;getElemById("txtProduct"+C).value=i[y],getElemById("hdnQtyStock"+C).value=n[y],getElemById("txtQty"+C).value=s[y],getElemById("hdnOldQty"+C).value=u[y],getElemById("hdnUnitPrice"+C).value=c[y],getElemById("txtListPrice"+C).value=l[y],getElemById("discount"+C).value=m[y],getElemById("netTotal"+C).value=p[y],getElemById("totalAfterDiscount"+C).value=g[y],getElemById("tax"+C).value=h[y],getElemById("total"+C).value=v[y],getElemById("hdnProductId"+C).value=d[y],(O=getElemById("itemDescription"+C))&&(O.value=f[y])}calcGrandTotal(t)}function calcRowTotal(e){for(var t=1;t<=rowCnt;t++){var r=getObj("property(hdnTotal"+t+")").value;if(""!=r){getElemById("netTotal"+t).value=r.toString(),getElemById("totalAfterDiscount"+t).value=r.toString();var a,o=parseFloat(getElemById("totalAfterDiscount"+t).value);if(""!=getElemById("discount"+t).value&&(o=null!=getElemById("discount"+t).value?getElemById("totalAfterDiscount"+t).value=r.toString()-parseFloat(getElemById("discount"+t).value):getElemById("totalAfterDiscount"+t).value=r.toString()),"NaN"!=o.toString()&&(getElemById("netTotal"+t).value=(Math.round(100*o)/100).toString()),""!=getElemById("tax"+t).value)"NaN"!=(a=null!=getElemById("tax"+t).value?parseFloat(o)+parseFloat(getElemById("tax"+t).value):parseFloat(o)).toString()&&(getElemById("netTotal"+t).value=(Math.round(100*a)/100).toString())}}calcGrandTotal(e)}function calcTotalOnEnter(e,t){if(13==(t.keyCode?t.keyCode:t.which?t.which:t.charCode)){var r=getObj("currentSelectedRow");if(r){var a=e.parentNode.parentNode,o=parseInt(a.id.substr(a.id.indexOf("w")+1,a.id.length));r.value=o}}return!0}function calcTotal(e){var t=$(e).closest("form")[0].name,r=e.parentNode.parentNode,a=parseInt(r.id.substr(r.id.indexOf("w")+1,r.id.length)),o=getObj("txtQty"+a).value,i=getObj("txtListPrice"+a).value,n=getObj("hdnPriceBookId"+a).value;if(o=o.replace(/,+/g,""),i=i.replace(/,+/g,""),null!=n&&""!=n&&null!=i&&""!=i&&null!=o&&""!=o){var s=Crm.getCrmBasePath()+"/CreateInventory.do?action=getReductionPrice&quantity="+o+"&listPrice="+i+"&bookId="+n+"&isload=true";(new crmRequestPool).initiate({action:s,type:"GET",success:function(e){null!=e&&null!=e&&(getObj("total"+a).value=Math.round(100*parseFloat(e))/100,calcRowTotal(t))}})}else{var l=Math.round(o*i*100)/100;"NaN"!=l.toString()&&(getObj("total"+a).value=parseFloat(l.toString())),calcRowTotal(t)}}function calcGrandTotal(e){e&&"string"!=typeof e?e=$(e).closest("form")[0].name:void 0===e&&(e=$("[name^=createEntityForm]")[0].name);var t=0,r=0;taxTotal=0;for(var a=1;a<=rowCnt;a++){var o=getObj("property(hdnNetTotal"+a+")");""==o.value&&(o.value=0),isNaN(o.value)||(t+=parseFloat(o.value)),taxTotal+=getObj("tax"+a).value}t=Math.round(100*t)/100,getObj("subTotal").value=t.toString(),r=t;var i=getObj("txtDiscount").value;i=i.replace(/,+/g,"");var n=getObj("txtTax").value;n=n.replace(/,+/g,"");var s=getObj("txtAdjustment").value;s=s.replace(/,+/g,"");var l=document[e].elements["property(Discount)"];null!=l&&null!=l.value&&null!=l.value&&""!=l.value&&(r-=parseFloat(i));var c=document[e].elements["property(Tax)"];null!=c&&null!=c.value&&null!=c.value&&""!=c.value&&(r+=parseFloat(n));var d=document[e].elements["property(Adjustment)"];null!=d&&null!=d.value&&null!=d.value&&""!=d.value&&("plus"==getObj("operator").value?r+=parseFloat(s):r-=parseFloat(s)),"NaN"!=r.toString()&&(getObj("grandTotal").value=(Math.round(100*r)/100).toString())}function roundValue(e){if(e.indexOf(".")<0)e+=".00";else{var t=e.substring(e.indexOf(".")+1,e.length);t.length>2?e=e.substring(0,e.indexOf("."))+"."+t.substring(0,2):1==t.length&&(e+="0")}return e}function copyMapLocation(e){var t=getObj("module").value;"Contacts"==t?"Other to Mailing"==e?(getObj("property(Mailing Street)")&&getObj("property(Other Street)")&&(getObj("property(Mailing Street)").value=getObj("property(Other Street)").value),getObj("property(Mailing City)")&&getObj("property(Other City)")&&(getObj("property(Mailing City)").value=getObj("property(Other City)").value),getObj("property(Mailing State)")&&getObj("property(Other State)")&&(getObj("property(Mailing State)").value=getObj("property(Other State)").value),getObj("property(Mailing Zip)")&&getObj("property(Other Zip)")&&(getObj("property(Mailing Zip)").value=getObj("property(Other Zip)").value),getObj("property(Mailing Country)")&&getObj("property(Other Country)")&&(getObj("property(Mailing Country)").value=getObj("property(Other Country)").value)):"Mailing to Other"==e&&(getObj("property(Mailing Street)")&&getObj("property(Other Street)")&&(getObj("property(Other Street)").value=getObj("property(Mailing Street)").value),getObj("property(Mailing City)")&&getObj("property(Other City)")&&(getObj("property(Other City)").value=getObj("property(Mailing City)").value),getObj("property(Mailing State)")&&getObj("property(Other State)")&&(getObj("property(Other State)").value=getObj("property(Mailing State)").value),getObj("property(Mailing Zip)")&&getObj("property(Other Zip)")&&(getObj("property(Other Zip)").value=getObj("property(Mailing Zip)").value),getObj("property(Mailing Country)")&&getObj("property(Other Country)")&&(getObj("property(Other Country)").value=getObj("property(Mailing Country)").value)):"Shipping to Billing"==e?(getObj("property(Billing Street)")&&getObj("property(Shipping Street)")&&(getObj("property(Billing Street)").value=getObj("property(Shipping Street)").value),getObj("property(Billing City)")&&getObj("property(Shipping City)")&&(getObj("property(Billing City)").value=getObj("property(Shipping City)").value),getObj("property(Billing State)")&&getObj("property(Shipping State)")&&(getObj("property(Billing State)").value=getObj("property(Shipping State)").value),getObj("property(Billing Code)")&&getObj("property(Shipping Code)")&&(getObj("property(Billing Code)").value=getObj("property(Shipping Code)").value),getObj("property(Billing Country)")&&getObj("property(Shipping Country)")&&(getObj("property(Billing Country)").value=getObj("property(Shipping Country)").value)):"Billing to Shipping"==e&&(getObj("property(Billing Street)")&&getObj("property(Shipping Street)")&&(getObj("property(Shipping Street)").value=getObj("property(Billing Street)").value),getObj("property(Billing City)")&&getObj("property(Shipping City)")&&(getObj("property(Shipping City)").value=getObj("property(Billing City)").value),getObj("property(Billing State)")&&getObj("property(Shipping State)")&&(getObj("property(Shipping State)").value=getObj("property(Billing State)").value),getObj("property(Billing Code)")&&getObj("property(Shipping Code)")&&(getObj("property(Shipping Code)").value=getObj("property(Billing Code)").value),getObj("property(Billing Country)")&&getObj("property(Shipping Country)")&&(getObj("property(Shipping Country)").value=getObj("property(Billing Country)").value)),murphy.addCustomTracking({message:t,name:"copyMapLocation called",type:"custom event"}),murphy.error(new Error("copyMapLocation called"))}function pageValidate(e,t){singularModule=getElm(e,"singularModule")?getElm(e,"singularModule").value:"";for(var r=getElm(e,"fieldname").value.split(";"),a=getElm(e,"fielddatatype").value.split(";"),o=getElm(e,"fieldlabel").value.split(";"),i=0;i<r.length;i++){var n=a[i].split("~");if("M"==n[1]){if(getElm(e,"property(Recurring Activity)")&&1==getElm(e,"property(Recurring Activity)").checked){if(getElm(e,"property(Start DateTimetime)")){var s=!1;if(2!=(l=getElm(e,"property(Start DateTimetime)").value.split(":")).length&&(s=!0),l[0]>=0&&l[0]<24&&l[1]>=0&&l[1]<=59||(s=!0),""==getElm(e,"property(Start DateTimetime)").value.trim()||s)return alert(I18n.getMsg("crm.recurrence8",I18n.getMsg(Crm.getModuleDisplayName(!1,!0,!0)))),getElm(e,"property(Start DateTimetime)").focus(),!1}if(getElm(e,"property(End DateTimetime)")){var l;s=!1;if(2!=(l=getElm(e,"property(End DateTimetime)").value.split(":")).length&&(s=!0),l[0]>=0&&l[0]<24&&l[1]>=0&&l[1]<=59||(s=!0),""==getElm(e,"property(End DateTimetime)").value.trim()||s)return alert(I18n.getMsg("crm.recurrence9",I18n.getMsg(Crm.getModuleDisplayName(!1,!0,!0)))),getElm(e,"property(End DateTimetime)").focus(),!1}}if(getElm(e,"property(Recurring Activity)")&&1==getElm(e,"property(Recurring Activity)").checked&&("property(Start DateTime)"==r[i]||"property(End DateTime)"==r[i]))continue;if("Call"!==singularModule||"property(DurationInMinute)"!==r[i]&&"property(DurationInSecond)"!==r[i]&&"property(Call Duration)"!==r[i]){if(null!=getElm(e,r[i])&&!commonUtils.emptyCheck(r[i],o[i],void 0,e,t))return!1}else if("ScheduleCall"!==(0!=$("input[name=whichCall]:checked").length?$("input[name=whichCall]:checked").val():"")&&null!=getObj(r[i])&&!commonUtils.emptyCheck(r[i],o[i]))return!1}switch(n[0]){case"O":case"V":case"C":break;case"E":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.emailValidate(r[i],o[i],e))return!1;break;case"DT":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===n[3])var c="OTH";else c=n[3];if(!CrmDateUtils.dateTimeValidate(r[i],n[2],o[i],c))return!1;if(n[4]&&!CrmDateUtils.dateTimeComparison(r[i],n[2],o[i],n[5],n[6],n[7],n[4],e))return!1}break;case"D":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===n[2])c="OTH";else c=n[2];if(!CrmDateUtils.dateValidate(r[i],o[i],c,e))return!1;if(n[3]&&!CrmDateUtils.dateComparison(r[i],o[i],n[4],n[5],n[3]))return!1}break;case"T":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===n[2])var d="OTH";else d=n[2];if(!CrmDateUtils.timeValidate(r[i],o[i],d,e))return!1;if(n[3]&&!CrmDateUtils.timeComparison(r[i],o[i],n[4],n[5],n[3],e))return!1}break;case"I":case"B":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(!validationUtils.intValidate(r[i],o[i],e))return!1;if(n[2]&&!validationUtils.numConstComp(r[i],o[i],n[2],n[3],e))return!1}break;case"DE":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===n[2])var u="any";else u=n[2];if(!validationUtils.decimalValidate(r[i],o[i],u))return!1;if(n[2]&&!validationUtils.numConstComp(r[i],o[i],n[2],n[3],e))return!1}break;case"N":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===n[2])u="any";else u=n[2];if(!validationUtils.numValidate(r[i],o[i],u,e))return!1;if(n[3]&&!validationUtils.numConstComp(r[i],o[i],n[3],n[4],e))return!1}break;case"P":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.phoneValidate(r[i],o[i],e))return!1;break;case"W":if(null!=getElm(e,r[i])&&0!=getElm(e,r[i]).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.isValidWebURL_extended(o[i],getElm(e,r[i]).value,"inline",getElm(e,r[i])))return!1}if(("property(Question)"===r[i]||"property(Solution)"===r[i]||"property(Answer)"===r[i]||"property(Internal Comments)"===r[i]||"property(Add Comment)"===r[i]||"property(Description)"===r[i])&&!maxLengthCheck(r[i]))return!1}if("Call"===singularModule&&!1===validateCallTime2(e))return!1;return!0}function create(e,t,r,a,o){getObj("mapValues")&&(getObj("mapValues").value="");var i=encodeURIComponent(getObj("entityName").value),n=Crm.getCrmBasePath()+"/Create.do?module="+e+"&entityid="+t+"&entityname="+i+"&returnAnchor="+r+"&primmodule="+a;null!=o&&(n=Crm.getCrmBasePath()+"/Create.do?module="+e+"&entityid="+t+"&entityname="+i+"&returnAnchor="+r+"&primmodule="+a+"&listRelationId="+o),"Accounts"!=a||"Quotes"!=e&&"SalesOrders"!=e&&"Invoices"!=e&&"Contacts"!=e?"Quotes"!=a||"SalesOrders"!=e&&"Invoices"!=e?"SalesOrders"==a&&"Invoices"==e?n=Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule=SalesOrders&operation=create&module="+e+"&entityid="+t+"&entityname="+i+"&primmodule="+a+"&returnAnchor="+r:"Vendors"==a&&"Contacts"==e?n=Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule=Vendors&operation=create&module="+e+"&entityid="+t+"&entityname="+i+"&primmodule="+a+"&returnAnchor="+r:(null!=getObj("cvid").value&&(n=n+"&cvid="+getObj("cvid").value+"&recordNum="+getObj("recordNum").value),n=n+"&relmodule="+a):n=Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule=Quotes&operation=create&module="+e+"&entityid="+t+"&entityname="+i+"&primmodule="+a+"&returnAnchor="+r:n=Crm.getCrmBasePath()+"/FillEntityObject.do?fillUpModule=Accounts&operation=create&module="+e+"&entityid="+t+"&entityname="+i+"&primmodule="+a+"&returnAnchor="+r,params=params+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(n,params)}function addMultiValue(e,t,r,a,o,i,n){var s=Crm.getCrmBasePath()+"/ShowMultiValuesForAdd.do?moduleid="+e+"&frommodule="+t+"&tomodule="+r+"&returnAnchor="+a+"&parentCurrencyISOCode="+o+"&parentER="+i+"&pname="+a.split("_")[0].toUpperCase();n&&(s+="&rid="+n),commonUtils.openCustomLookup(s,void 0,"topBandPopup")}function editAllValues(e,t,r,a,o,i,n){var s=Crm.getCrmBasePath()+"/ShowMultiValuesForAdd.do?moduleid="+e+"&frommodule="+t+"&tomodule="+r+"&EditAll=true&parentCurrencyISOCode="+a+"&parentER="+o;i&&(s+="&rid="+i+"&pname="+n),commonUtils.openCustomLookup(s,void 0,"topBandPopup")}function massActionDelete(e,t,r,a,o,i,n,s,l){a=crmListView.getObject().module,o=o||crmListView.getObject().dispCvName,i=crmListView.getObject().cvId,n=crmListView.getObject().fromIndex,s=crmListView.getObject().toIndex,l=crmListView.getObject().currentOption;Lyte.injectResources(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("massAction")],ResourceConstants.CRM),void 0,(function(){massAction(e,t,r,a,o,i,n,s,l)}))}function massAction(e,t,r,a,o,n,s,l,c,d,u,m){var p,g=document.showcvdetails;crmListView.getObject().isWorkFlowRequired&&crmListView.getObject().isWorkFlowRequired,void 0!==u&&(g=u[0]);var h=!1,v=0,f=!0;if(null!=g?f=!1:m&&"potentialpipeline"===m?(g=document.TransferWizardForm,f=!1):($("#listWFWebHookTable").length>0||$("#detailViewWebHookTable").length>0)&&(f=!1),1==f){var C=0;1==customViewObject.isStageView?(C=0,crmTab.getFromCache(a).categoryList.forEach((function(e){C+=e.cards?e.cards.length:0})),noofrows=C):1==customViewObject.isPredictView?(C=0,Object.keys(crmTab.getFromCache(a).predictData).forEach((function(e){C+=crmTab.getFromCache(a).predictData[e].body.length})),noofrows=C):noofrows=customViewObject.isPrivacyListView?customViewObject.body.length:crmTab.getFromCache(a).body.length,0==noofrows&&(noofrows=crmTab.getFromCache(a).address.address_jsonarrayObj.length),p=customViewObject.isPrivacyListView?customViewObject.selectedIds.length:crmTab.getFromCache(a).selectedIds.length,(h=customViewObject.isPrivacyListView?customViewObject.doMassActioninScheduler&&customViewObject.doMassActioninScheduler.length:crmTab.getFromCache(a).doMassActioninScheduler)&&(v=customViewObject.isPrivacyListView?customViewObject.totalCount.length:crmTab.getFromCache(a).totalCount)}else{if(!$("[name=chk]"))return;noofrows=$("[name=chk]").length,p=$("[name=chk]:checked").length}var y="",b=I18n.getMsg("confirmforecast"),I="",T=document.showcvdetails?document.showcvdetails.module.value:"";if(1==noofrows){if(0==p)return alert(I18n.getMsg("crm.alert.select.one",I18n.getMsg(a))),!1;if(1==f)y=customViewObject.selectedIds[0];else{var w=$("[name=chk]")[0].value.split("&&||");y=w[0];I=w[1]}if(document.showcvdetails&&(g.idlist.value=y,g.namelist.value=I),"printmailinglabels"==e)return!0;if(0==f&&(g.action=Crm.getCrmBasePath()+"/"+t+".do?"+r),"massdelete"==e)if("Forecasts"==T){if(!window.confirm(b))return!1;g.method="post",g.innerHTML+=document.deleteForm.innerHTML,g.submit()}else{var E=Events.checkEventAvailToSendCancel(y,"Events",(function(e){e||(e=!1);var t={cancelMailNeeded:e,skipAlert:!0};return Callonclickofbutton2(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,void 0,t),!1}));if(!E){if("undefined"!=typeof event&&(N=renderingUtils.getTargetElem(event)),N&&!$(N).hasClass("fromDeletePopup")){var k=!isRelatedRecordsModule(a)||o&&o.includes("Review")?"":I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(a));(j=$("#actionMenu"))&&j.hide(),showDeletePopup(I18n.getMsg("crm.warning.move.to.trash"),"crm.button.delete","",k,N)}else{var O={skipAlert:!0};Callonclickofbutton2(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,void 0,O)}return!1}}else if("bulktask"==e)Q.selectAction("BulkTask");else{if("changeowner"==e)return newShowLookUp("assignedto","SalesManId","Assigned To","ownername","listview"),!1;if("sendmail"==e)if("Potentials"==a){var S=Crm.getCrmBasePath()+"/ShowTemplates.do?idlist="+y+"&module="+a,R=document.getElementById("loadingDiv");$("#loadingDiv").empty(),R.style.zIndex=30,renderingUtils.freezeBackground(),new AjaxAPI({id:"loadingDiv",url:S,callbackfn:function(){mailsetCenter("loadingDiv"),thirdPartyUtils.bindSelect2("#templateId")}}).post()}else{var M;M=1==f?y:getObj("idlist").value.split(";")[0],EntSendMail(a,M,"listview")}else if("updateresponse"==e){S=Crm.getCrmBasePath()+"/SelectResponder.do?module="+a;document.getElementById("loadingDiv").style.zIndex=30,renderingUtils.freezeBackground();O={};new AjaxAPI({id:"loadingDiv",url:S,params:O,callbackfn:function(){mailsetCenter("loadingDiv")}}).get()}else if("mailMerge"==e){var _=crmListView.getObject().sortColumnString,D=crmListView.getObject().sortOrderString;if(_.indexOf("##")>-1&&(_=_.split("##",1)),d&&"CONVERTEDVIEWS"==d||"MYCONVERTEDVIEWS"==d)return alert(I18n.getMsg("crm.mailmerge.cvsupport",I18n.getMsg(a))),!1;S=Crm.getCrmBasePath()+"/MailMerge.do?";S+=J="action=mergeAction&idlist="+y+"&module="+a+"&previous_sort_column="+_+"&previous_sort_order="+D;var L=csrfParamName+"="+encodeURIComponent(csrfToken);mR(S,(function(e){getObj("lookupdiv").style.display="block",getObj("lookupdiv").style.zIndex=30,getObj("lookupdiv").style.width="550px",renderingUtils.freezeBackground(),$("#lookupdiv").empty(),getObj("lookupdiv").innerHTML=e,mailsetCenter("lookupdiv"),JSEvalScript(getObj("lookupdiv")),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}),L)}else if("runRules"==e){S=Territory.territoryAction+"runRules",O="idsList="+y+"&module="+a+"&"+Territory.csrf();var A=objectUtils.getKeys(crmListView.startIndex).sort()[0];crmListView.getObject().fromIndex=A,crmListView.getObject().toIndex=parseInt(A)+parseInt(crmListView.getObject().currentOption)-1,mR(S,(function(e){crmListView.reloadCurrentListView()}),O)}else if("makepublic"==e||"makeprivate"==e)if(y.split(";").length>100){var P="makepublic"===e?"crm.email.sharing.custom.limit1":"crm.email.sharing.custom.limit2";crmui.showMsgBand("error",I18n.getMsg(P,100),3e3)}else{S=Crm.getCrmBasePath()+"/ZMailConfig.do?",O="action="+e+"&idlist="+y+"&module="+a+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(S,(function(e){$("#bulkUpdateSuccess").empty(),getObj("bulkUpdateSuccess").innerHTML=e,mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess"),deSelectAll(),getObj("allcheck")&&(getObj("allcheck").checked=!1)}),2e3)}),O)}else if("executeMacro"==e)m="campView"===m?m:"",getElemById("requestFrom")&&(m=getElemById("requestFrom").value),Macro.showMacroExecDialog(r,a,y,m);else if("convert"==e){if(p>Crm.userDetails.massConvertLimit)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.convert.alert",Crm.userDetails.massConvertLimit));showMassConvertDialog(a,y)}else g.method="post",g.submit()}}else{if(0==noofrows)return!1;if(0==p)return null==a&&(a=""),alert(I18n.getMsg("crm.alert.select.one",I18n.getMsg(a))),!1;if(1==f)y=crmListView.getObject().selectedIds.join(";");else{var U=$("[name=chk]");for(i=0;i<noofrows;i++)if(U[i].checked){var B=(w=U[i].value.split("&&||"))[0],x=w[1];y=""==y?B:y+";"+B,I=x+"&&##"+I}document.showcvdetails&&(g.idlist.value=y,g.namelist.value=I)}if("printmailinglabels"==e)return!0;if(document.showcvdetails&&(g.action=Crm.getCrmBasePath()+"/"+t+".do?"+r),"massdelete"==e)if("Forecasts"==T){if(!window.confirm(b))return!1;g.method="post",g.innerHTML+=document.deleteForm.innerHTML,g.submit()}else{E=Events.checkEventAvailToSendCancel(y,"Events",(function(e){e||(e=!1);var t=!1;h&&v>Crm.massOperationWorkflowLimit&&(handleIgnoreWorkFlowPopupForDelete(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,r),t=!0);var r={cancelMailNeeded:e,skipAlert:!0,isWfTriggerCheckReq:t};return Callonclickofbutton2(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,void 0,r),!1}));var N,F=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];if(F.triggeredFromShortcutMixin&&Crm.userDetails.isKeyboardShortcutsEnabled&&(N=$("#deleteAppRecordbtn"),F.triggeredFromShortcutMixin=!1),!E){if("undefined"!=typeof event&&(N=renderingUtils.getTargetElem(event)),N&&!$(N).hasClass("fromDeletePopup")){if(("Accounts"===a||"Contacts"===a)&&customViewObject.isZBCustomModuleEnabled)return void getAlertContent(e,N);var j;k=!isRelatedRecordsModule(a)||o&&o.includes("Review")?"":I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(a));(j=$("#actionMenu"))&&j.hide(),showDeletePopup(I18n.getMsg("crm.warning.move.to.trash"),"crm.button.delete","",k,N),h&&Crm.trackSpotLightAction("Mass Scheduler - Delete Clicked",{Module:a})}else{var V=!1;h&&v>Crm.massOperationWorkflowLimit&&(handleIgnoreWorkFlowPopupForDelete(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,O),V=!0,!0);O={skipAlert:!0,isWfTriggerCheckReq:V};Callonclickofbutton2(Crm.getCrmBasePath()+"/DeleteFromCV.do",a,y,o,n,s,l,c,void 0,O),(1==V||"true"==V||v<=Crm.massOperationWorkflowLimit)&&h&&Crm.trackSpotLightAction("Mass Scheduler - Delete Confirmed",{Module:a})}return!1}}else if("bulktask"==e)Q.selectAction("BulkTask");else{if("changeowner"==e)return crmTab.getFromCache(a).doMassActioninScheduler?(newShowLookUp("assignedto","SalesManId","Assigned To","ownername","customview"),Crm.trackSpotLightAction("Mass Scheduler - Change Owner Clicked",{Module:a})):newShowLookUp("assignedto","SalesManId","Assigned To","ownername","listview"),!1;if("sendmail"==e){var H;if(1==p)return H=1==f?crmTab.getFromCache(a).selectedIds[0]:getObj("idlist").value.split(";")[0],EntSendMail(a,H,"listview"),!0;if("L"!=Crm.userDetails.LICENSE_TYPE&&"N"!=Crm.userDetails.LICENSE_TYPE&&"F"!=Crm.userDetails.LICENSE_TYPE)if(Crm.userDetails.MassMailUnificationEnabled)networkUtils.loadFeatureScripts(["zohocrm_massmail_unification.js"],(function(){MassMailUnificationUtil.showMassMailPop(a,"LV",y)}));else{showAnimatePopup("massMailstatsPop");S=Crm.getCrmBasePath()+"/ShowTemplates.do?module="+a,O={idlist:y},R=document.getElementById("massMailstatsPop");$("#massMailstatsPop").empty(),new AjaxAPI({id:"massMailstatsPop",url:S,params:O,callbackfn:function(){}}).post()}else sendMailPermissionAlert()}else if("ziaReminder"==e)crmBstTime.showZiaReminderSettingsforListView(a,n);else if("convert"==e){if(p>Crm.userDetails.massConvertLimit)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.convert.alert",Crm.userDetails.massConvertLimit));showMassConvertDialog(a,y)}else if("updateresponse"==e){S=Crm.getCrmBasePath()+"/SelectResponder.do?module="+a;document.getElementById("loadingDiv").style.zIndex=30,renderingUtils.freezeBackground();O={};new AjaxAPI({id:"loadingDiv",url:S,params:O,callbackfn:function(){mailsetCenter("loadingDiv")}}).get()}else if("mailMerge"==e){_=crmListView.getObject().sortColumnString,D=crmListView.getObject().sortOrderString;if(_.indexOf("##")>-1&&(_=_.split("##",1)),d&&("CONVERTEDVIEWS"==d||"MYCONVERTEDVIEWS"==d))return alert(I18n.getMsg("crm.mailmerge.cvsupport",I18n.getMsg(a))),!1;S=Crm.getCrmBasePath()+"/MailMerge.do?";var J="action=mergeAction&module="+a+"&previous_sort_column="+_+"&previous_sort_order="+D,W={idlist:y};W[csrfParamName]=encodeURIComponent(csrfToken),S+=J,mR(S,(function(e){getObj("lookupdiv").style.display="block",getObj("lookupdiv").style.zIndex=30,getObj("lookupdiv").style.width="550px",renderingUtils.freezeBackground(),$("#lookupdiv").empty(),getObj("lookupdiv").innerHTML=e,mailsetCenter("lookupdiv"),JSEvalScript(getObj("lookupdiv")),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}),W)}else if("runRules"==e){S=Territory.territoryAction+"runRules",O="idsList="+y+"&module="+a+"&"+Territory.csrf(),A=objectUtils.getKeys(crmListView.startIndex).sort()[0];crmListView.getObject().fromIndex=A,crmListView.getObject().toIndex=parseInt(A)+parseInt(crmListView.getObject().currentOption)-1,mR(S,(function(e){crmListView.reloadCurrentListView()}),O)}else if("makepublic"==e||"makeprivate"==e)if(y.split(";").length>100){P="makepublic"===e?"crm.email.sharing.custom.limit1":"crm.email.sharing.custom.limit2";crmui.showMsgBand("error",I18n.getMsg(P,100),3e3)}else{S=Crm.getCrmBasePath()+"/ZMailConfig.do?",O="action="+e+"&idlist="+y+"&module="+a+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);commonUtils.showHideLoadingDiv(!0),mR(S,(function(e){commonUtils.showHideLoadingDiv(),$("#bulkUpdateSuccess").empty(),getObj("bulkUpdateSuccess").innerHTML=e,show("bulkUpdateSuccess"),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess"),deSelectAll(),1==f?$("#checkAll").attr("class","customCheckBox"):getObj("allcheck")&&(getObj("allcheck").checked=!1)}),2e3)}),O)}else if("executeMacro"==e)m="campView"===m?m:"",getElemById("requestFrom")&&(m=getElemById("requestFrom").value),Macro.showMacroExecDialog(r,a,y,m);else if("downloadVcard"==e){S=Crm.getCrmBasePath()+"/BCCDropbox.do?action=downloadCustomModuleVCard";J="&idlist="+y+"&module="+a,downloadVcardAction(S,J)}else g.method="post",g.submit()}}}function handleIgnoreWorkFlowPopupForDelete(e,t,r,a,o,i,n,s,l){var c="deleteWorkflowHandleSave('"+Crm.getCrmBasePath()+"/DeleteFromCV.do','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(t))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(r))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(a))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(o))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(i))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(n))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(s))+"')",d="<input type='button' data-zcqa='btn_MassDeleteWorkflowPopupOk' value='"+I18n.getMsg("crm.mass.actions.ok.proceed")+"' class='redbtn fromDeletePopup' id='buttonMassDeleteWorkflowOk' name='buttonMassDeleteWorkflowOkName' onclick=\""+c+'">',u=getWorkflowPopUpContent(d,"handleIgnoreWorkFlowPopupForDeleteCancel",t);$("#massActionWorkFlowPopUp").html(u)}function deleteWorkflowHandleSave(e,t,r,a,o,i,n,s){hideAnimatePopup("massActionWorkFlowPopUp"),Callonclickofbutton2(Crm.getCrmBasePath()+"/DeleteFromCV.do",t,r,a,o,i,n,s,void 0,{skipAlert:!0}),Crm.trackSpotLightAction("Mass Scheduler - Delete Workflow Ok Proceed",{Module:t})}function handleIgnoreWorkFlowPopupForDeleteCancel(e){hideAnimatePopup("massActionWorkFlowPopUp",!0),renderingUtils.removeFreezeLayer(),Crm.trackSpotLightAction("Mass Scheduler - Delete Workflow Cancel",{Module:e})}function createAction(){var e=getObj("module").value,t=Crm.getCrmBasePath()+"/Create.do?module="+e;ajaxNew(t)}function createActionByModule(e){var t=Crm.getCrmBasePath()+"/Create.do?module="+e;"Events"==e&&(t=Crm.getCrmBasePath()+"/Create.do?createdFrom=listView&module="+e),ajaxNew(t)}function setDiscount(e,t){var r=0;if(document.getElementById("discountType").value=e,""==document.getElementById("discount_percentage_final").value&&(document.getElementById("discount_percentage_final").value=0),"amount"==e){if(getObj("discount_amount_final").style.visibility="visible",getObj("discount_percentage_final").style.visibility="hidden",getObj("discount_percentage_final").value="0",!validationUtils.decimalValidate("discount_amount_final","Discount","any"))return!1;r=document.getElementById("discount_amount_final").value}else if("percentage"==e){if(getObj("discount_percentage_final").style.visibility="visible",getObj("discount_amount_final").style.visibility="hidden",getObj("discount_amount_final").value="0",!validationUtils.decimalValidate("discount_percentage_final","Discount","any"))return!1;"_final"==t?""!=document.getElementById("subTotal").value&&(r=parseFloat(document.getElementById("subTotal").value)*parseFloat(document.getElementById("discount_percentage_final").value)/100):""!=document.getElementById("total"+t).value&&(r=parseFloat(document.getElementById("total"+t).value)*parseFloat(document.getElementById("discount_percentage_final").value)/100)}else getObj("discount_amount_final").style.visibility="hidden",getObj("discount_percentage_final").style.visibility="hidden",getObj("discount_percentage_final").value="0",getObj("discount_amount_final").value="0",r=0;document.getElementById("discount_type_final").value=r}function calculateDiscount(e){var t=$("#module").closest("form")[0].name;setDiscount(document.getElementById("discountType").value,e);var r=document.getElementById("discount_type_final").value;"_final"==e&&"NaN"!=r.toString()?document.getElementById("txtDiscount").value=r:"NaN"!=r.toString()&&(document.getElementById("discount"+e).value=r),calcRowTotal(t),hide("discount_div_final")}function displayCoords(e,t,r,a){var o=a.substr(a.indexOf("t")+1);if((renderingUtils.freezeBackground(),document.getElementById(t).style.display="block",$(t).empty(),document.getElementById(t).innerHTML=I18n.getMsg("loading")+"..","discount_final"!=r&&"sh_tax_div_title"!=r&&"tax_final"!=r)&&""==document.getElementById("txtProduct"+o).value)return alert(I18n.getMsg("crm.product.select.check",I18n.getMsg(singularModule))),document.getElementById("FreezeLayer")&&document.body.removeChild(document.getElementById("FreezeLayer")),document.getElementById(t).style.display="none",!1;if("discount"==r){var i=Crm.getCrmBasePath()+"/DiscountCal.do?curr_row="+o;mR(i,(function(e){$(t).empty(),document.getElementById(t).innerHTML=e,$("#discount_div_title_final").empty(),document.getElementById("discount_div_title_final").innerHTML="<b>"+I18n.getMsg("setDiscountFor")+" : "+document.getElementById("total"+o).value+"</b>",getObj("discount_amount_final").style.visibility="hidden",getObj("discount_percentage_final").style.visibility="hidden"}))}else if("tax"==r);else if("discount_final"==r){i=Crm.getCrmBasePath()+"/DiscountCal.do?curr_row=_final";mR(i,(function(e){$(t).empty(),document.getElementById(t).innerHTML=e,$("#discount_div_title_final").empty(),document.getElementById("discount_div_title_final").innerHTML="<b>"+I18n.getMsg("setDiscountFor")+" : "+document.getElementById("subTotal").value+"</b>",getObj("discount_amount_final").style.visibility="hidden",getObj("discount_percentage_final").style.visibility="hidden"}))}else"sh_tax_div_title"==r&&($("#sh_tax_div_title").empty(),document.getElementById("sh_tax_div_title").innerHTML="<b>Set S&H Tax for : "+document.getElementById("shipping_handling_charge").value+"</b>");var n=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;getObj(t).style.zIndex=50,getObj(t).style.top=n+200+"px",getObj(t).style.left="50%"}function calculateExpectedRevenue(){var e=0,t=0,r=getObj("property(Amount)");if(getObj("value_Expected Revenue"))r&&""!=r.value&&!isNaN(r.value)&&(e=parseFloat($ESAPI.encoder().encodeForHTML(r.value))),getObj("value_Probability")&&""!=getObj("value_Probability").innerHTML&&(t=parseFloat(getObj("value_Probability").innerHTML),t=$ESAPI.encoder().encodeForHTML(t)),getObj("value_Expected Revenue").innerHTML=roundValue((e*(t/100)).toString()),getObj("headervalue_Expected Revenue")&&(getObj("headervalue_Expected Revenue").innerHTML=roundValue((e*(t/100)).toString()));else{r&&""!=r.value&&!isNaN(r.value)&&(e=parseFloat(r.value));var a=getObj("property(Stage)");if(a&&""!=a.options[a.selectedIndex].value){var o=a.options[a.selectedIndex].value;o=o.indexOf(":")>-1?o.split(":")[0]:a.options[a.selectedIndex].dataset.val,t=parseFloat(o)}if(getObj("property(Probability)")&&""!=getObj("property(Probability)").value&&(t=parseFloat(getObj("property(Probability)").value)),getObj("property(Expected Revenue)")){var i=0;0!=e&&0!=t&&(i=roundValue((e*(t/100)).toString())),getObj("property(Expected Revenue)").value=i}getObj("headervalue_Expected Revenue")&&(getObj("headervalue_Expected Revenue").innerHTML=i)}}function addRange(){var e=I18n.getMsg("deleteRange");priceRowCount++;var t="<tr id=hrow"+priceRowCount+">";t+="<td class=\"tableData\" style='padding:3px;' valign='top'><input id='txtFromRange"+priceRowCount+"' name='property(fromRange"+priceRowCount+")' type='text' size='17' maxlength='19'></td>",t+="<td class=\"tableData\" style='padding:3px;' valign='top'><input id='txtToRange"+priceRowCount+"' name='property(toRange"+priceRowCount+")' type='text' size='17' maxlength='19'></td>",t+="<td class=\"tableData\" style='padding:3px;' valign='top'><input type='text' id='txtDiscount"+priceRowCount+"'  name='property(discount"+priceRowCount+")' size='19' maxlength='19' /></td>",t+="<td style='padding:3px;' align='center' width='15' class='tableData'><img id='delRange"+priceRowCount+"' align='absmiddle' title='"+e+"' src='"+networkUtils.getImageUrl("del.gif",ResourceConstants.CRM)+"'  onclick='delRange(this.id)' class='cP'></td>",t+="</tr>";for(var r=getPriceListBody(),a=new Array(priceRowCount-1),o=new Array(priceRowCount-1),i=new Array(priceRowCount-1),n=1,s=0;n<=priceRowCount-1;n++,s++)o[s]=getObj("txtToRange"+n).value,a[s]=getObj("txtFromRange"+n).value,i[s]=getObj("txtDiscount"+n).value;$("#pricingList").empty(),getObj("pricingList").innerHTML=listTableStart+r.innerHTML+t+"<tr><td colSpan='8' class='tableRowSep'></td></tr></table>";for(n=1,s=0;n<=priceRowCount-1;n++,s++)getObj("txtFromRange"+n).value=a[s],getObj("txtToRange"+n).value=o[s],getObj("txtDiscount"+n).value=i[s]}function getPriceListBody(){if("TABLE"==getObj("pricingList").childNodes.item(0).tagName)var e=getObj("pricingList").childNodes.item(0).childNodes.item(0);else e=getObj("pricingList").childNodes.item(1).childNodes.item(1);return e}function delRange(e){e=parseInt(e.substr(e.lastIndexOf("e")+1,e.length));getPriceListBody().removeChild(getObj("hrow"+e));for(var t="<tr class='tableHeadBg' height='20' id='tablehead'>"+getObj("tablehead").innerHTML+"</tr>",r=new Array(priceRowCount-1),a=new Array(priceRowCount-1),o=new Array(priceRowCount-1),i=new Array(priceRowCount-1),n=1,s=0;n<=e-1;n++,s++)r[s]="<tr id='hrow"+n+"'>"+getObj("hrow"+n).innerHTML+"</tr><tr id='tableline'><td colSpan='8' class='tableRowSep'></td></tr>",t+=r[s],o[s]=getObj("txtToRange"+n).value,a[s]=getObj("txtFromRange"+n).value,i[s]=getObj("txtDiscount"+n).value;for(n=e+1;n<=priceRowCount;n++,s++){r[s]=getObj("hrow"+n).innerHTML;var l=r[s];l=replace(l,"hrow"+n,"hrow"+(n-1)),l=replace(l,"txtFromRange"+n,"txtFromRange"+(n-1)),l=replace(l,"fromRange"+n,"fromRange"+(n-1)),l=replace(l,"txtToRange"+n,"txtToRange"+(n-1)),l=replace(l,"toRange"+n,"toRange"+(n-1)),l=replace(l,"txtDiscount"+n,"txtDiscount"+(n-1)),l=replace(l,"discount"+n,"discount"+(n-1)),l=replace(l,"delRange"+n,"delRange"+(n-1)),r[s]="<tr id='hrow"+(n-1)+"'>"+l+"</tr><tr id='tableline'><td colSpan='8' class='tableRowSep'></td></tr>",t+=r[s],o[s]=getObj("txtToRange"+n).value,a[s]=getObj("txtFromRange"+n).value,i[s]=getObj("txtDiscount"+n).value}$("#pricingList").empty(),getObj("pricingList").innerHTML=listTableStart+t+"</table>",priceRowCount--;for(n=1,s=0;n<=priceRowCount;n++,s++)getObj("txtFromRange"+n).value=a[s],getObj("txtToRange"+n).value=o[s],getObj("txtDiscount"+n).value=i[s]}function addViewRange(){if(priceRowCount++,priceRowCount%2==0)var e="<tr id=hrow"+priceRowCount+" class='evenBg'>";else e="<tr id=hrow"+priceRowCount+" class='value'>";e+="<td style='padding:3px;' ><div><span id='value_fromRange"+priceRowCount+"'></span></div></td>",e+="<td style='padding:3px;' ><div><span id='value_toRange"+priceRowCount+"'></span></div></td>",e+="<td style='padding:3px;' ><div><span id='value_discount"+priceRowCount+"'></span></div></td>",e+="</tr></table></td>",$("#pricingList").empty(),getObj("pricingList").innerHTML=viewTableStart+getPriceListBody().innerHTML+e+"<tr><td colSpan='8' class='tableRowSep'></td></tr></table>"}function fieldValidate(e,t,r,a,o,i,n,s,l){if(e=null!=s?I18n.getMsg(e,I18n.getMsg(s)):I18n.getMsg(e,I18n.getMsg(singularModule)),!commonUtils.emptyCheck(t,e,void 0,void 0,l))return!1;var c=t;userDateFormat=getObj("dtPtn").value;var d=r.split("~");switch(d[0]){case"O":case"V":case"C":break;case"E":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.emailValidate(c,e,void 0,l))return!1;break;case"DT":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===d[3])var u="OTH";else u=d[3];if("undefined"!=o){if(!(m=validateExecDay(c,a,i,n))&&!CrmDateUtils.dateTimeValidate(c,o,e,u,void 0,l))return!1}else{if(d[2]=c,!CrmDateUtils.dateTimeValidate(c,d[2],e,u,void 0,l))return!1;if(d[4]&&!CrmDateUtils.dateTimeComparison(c,d[2],e,d[5],d[6],d[7],d[4],void 0,l))return!1}}break;case"D":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===d[2])u="OTH";else u=d[2];var m;if(!(m=validateExecDay(c,a,i,n))&&!CrmDateUtils.dateValidate(c,e,u,void 0,void 0,l))return!1;if(!m&&d[3]&&!CrmDateUtils.dateComparison(c,e,d[4],d[5],d[3]))return!1}break;case"T":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===d[2])var p="OTH";else p=d[2];if(!CrmDateUtils.timeValidate(c,e,p,void 0,l))return!1;if(d[3]&&!CrmDateUtils.timeComparison(c,e,d[4],d[5],d[3],void 0,l))return!1}break;case"I":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(!validationUtils.intValidate(c,e,void 0,l))return!1;if(d[2]&&!validationUtils.numConstComp(c,e,d[2],d[3],void 0,l))return!1;if(e==I18n.getMsg("Probability")&&(s===moduleRecordMapping.Potentials.singular_label||s===moduleRecordMapping.Deals.singular_label)){var g=$("[id='"+c+"']").val();if(g>100)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.editor.probability.value.exceed"));if(g<0)return void renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",e))}}break;case"B":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(!validationUtils.intValidate(c,e,void 0,l))return!1;if(d[2]&&!validationUtils.numConstComp(c,e,d[2],d[3],void 0,l))return!1}break;case"DE":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===d[2])var h="any";else h=d[2];if(!validationUtils.decimalValidate(c,e,h,void 0,l))return!1;if(d[2]&&!validationUtils.numConstComp(c,e,d[2],d[3],void 0,l))return!1}break;case"N":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===d[2])h="any";else h=d[2];if(!validationUtils.numValidate(c,e,h,void 0,l))return!1;if(d[3]&&(validationUtils.numConstComp(c,e,d[3],d[4]),l))return!1}break;case"P":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.phoneValidate(c,e,void 0,l))return!1;break;case"W":if(null!=getObj(c)&&0!=getObj(c).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!validationUtils.isValidWebURL_extended(e,getObj(c).value,l,getObj(c)))return!1}return!0}function downloadRecordBccVCard(e,t,r){var a=Crm.getCrmBasePath()+"/BCCDropbox.do?action=downloadCustomModuleVCard";param="&idlist="+t+"&module="+e,r&&(param+="&individualRecord="+r),downloadVcardAction(a,param)}function validateExecDay(e,t,r,a){if(t){var o=getObj(e).value;if((o=o.replace(/ /g,""))!=crmConstants.executionDayFormula&&o!=crmConstants.executionTimeFormula)return!1;if(null!=a){var i="";if(null!=r&&""!=r&&(i=r),isNaN(getObj(i+"execDayCount"+a).value))return!1}else if(isNaN(getObj("execDayCount").value))return!1;return!0}return!1}function toggleDivDisplay(e,t){var r=getObj(e);if(r){var a="indicator_itemDescription"+t;"visible"==r.style.visibility?(r.style.visibility="hidden",getObj(a)&&(getObj(a).className="mainleftArrow")):(r.style.visibility="visible",getObj(a)&&(getObj(a).className="maindownArrow"))}}function sendMailPermissionAlert(){$("#lookupdiv").empty();var e=I18n.getMultipleMsg([{key:"crm.sendmail.upgrade",params:""},{key:"crm.upgrade.feature.access.msg",params:""},{key:"crm.store.upgrade",params:""},{key:"crm.button.cancel",params:""}]),t=e["crm.sendmail.upgrade"],r=e["crm.upgrade.feature.access.msg"],a=e["crm.store.upgrade"],o=e["crm.button.cancel"];getObj("lookupdiv").style.display="block",getObj("lookupdiv").style.zIndex=30,getObj("lookupdiv").style.width="550px",renderingUtils.freezeBackground(),mailsetCenter("lookupdiv"),JSEvalScript(getObj("lookupdiv")),getObj("lookupdiv").innerHTML="<div style='text-align:left;'><div class='p30'>"+t+"<br><br>"+r+"<br><br><input type='button' value='"+a+"' onclick='renderingUtils.removeFreezeLayer(),openNewTab(\""+Crm.getCrmBasePath()+"/Security.do?actionName=manageSubscription&fm=tp\",\"subscription\");' class='button'>&nbsp;&nbsp;<input type='button' class='button' value='"+o+"' onclick=\"getObj('lookupdiv').innerHTML='';getObj('lookupdiv').style.display='none';renderingUtils.removeFreezeLayer()\"></div></div>"}function invPdtDeleteWarning(e){gblid=e,renderingUtils.freezeBackground(),mailsetCenter("InventoryWarningDiv")}function sendConsentMail(e){if("L"!=Crm.userDetails.LICENSE_TYPE&&"N"!=Crm.userDetails.LICENSE_TYPE&&"F"!=Crm.userDetails.LICENSE_TYPE){showAnimatePopup("massMailstatsPop");var t=Crm.getCrmBasePath()+"/ShowTemplates.do?module="+e,r={idlist:crmListView.getObject().selectedIds.join(";"),consent:"true"};document.getElementById("massMailstatsPop");$("#massMailstatsPop").empty(),new AjaxAPI({id:"massMailstatsPop",url:t,params:r,callbackfn:function(){var e=$("#fromAddress");Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy(e,e.val(),"campaign",$("#replyToLink"),$("#replyToAddress"))}}).post()}else sendMailPermissionAlert()}function controlPercentagefieldValue(e,t){switch(t.keyCode){case 8:case 9:case 13:case 16:case 39:case 37:break;default:var r=$(e),a=r.val(),o=r.data("maxlength"),i=a.length,n=r.data("uitype"),s=currencyUtils.isCurrencyField(n),l=currencyUtils.getOperatorsLen(a);if(setTimeout((function(){if(e.value){var t=e.value.length;-1==e.value.indexOf(".")&&t>i&&(e.value=e.value.substr(0,s?o+currencyUtils.getOperatorsLen(e.value):o))}}),10),e.value&&e.value.substring(e.selectionStart,e.selectionEnd))break;if(s)i&&(i-=l);else if(-1!=a.indexOf(".")&&(i&&i--,190==t.keyCode)){t.preventDefault();break}if(i>=o){if(190==t.keyCode&&-1==a.indexOf("."))break;if((t.ctrlKey||t.metaKey)&&(65==t.which||67==t.which||88==t.which||90==t.which))break;t.preventDefault()}}}crmReports.exportReports="ExportReports",crmReports.downloadVCard="DownloadVCard",crmReports.newkey=0,crmReports.scrollleft=0,crmReports.dummyBPColumns=["CrmProcessLogs:RECORD_ENTERED_TIME_DUMMY","CrmProcessLogs:TRANS_OWNER_DUMMY","CrmProcessLogs:STATE_TIME_DUMMY","CrmProcessLogs:STATUS_DUMMY"],crmReports.clickEventIdVsMethodMapping={showContainer:"crmReports.manageChart",customizeChart:"crmReports.customizeChart",deleteChart:"crmReports.deleteChart",customizeReport:"Crm.lyteTransition",showChatNotification:"Crm.loadChatIntegrations",showSlackNotification:"Crm.loadChatIntegrations",showCiscoNotification:"Crm.loadChatIntegrations",getFolderReports:"crmReports.getFolderReports",newReport:"Crm.lyteTransition",scheduleReport:"Crm.addToHistory",newScheduler:"crmReports.createSchedule"},crmReports.selectedModules=[],crmReports.selectedCount=0,crmReports.folderData="",crmReports.sharedData="",crmReports.orgTerritoryId="",crmReports.territoryEnabled=!1,crmReports.isReportSchedulePage=!1,crmReports.scheduledData="",crmReports.scheduledsharedData="",crmReports.disableMigrateBtn=!1,crmReports.scheduledTime="",crmReports.tooltipMsgHeading="",crmReports.tooltipMsgContent="",crmReports.updatedTimeMsg="",crmReports.showCommonMsg=function(e,t){var r="chatcontain"+e,a=t.ReportName,o=getObj(r),i=null!=o&&o;if("EXPORT_CREATED"===t.EXPORT_STATUS){if(i)return;crmReports.showExportReportProcess(r,a)}else if("EXPORT_RUNNING"===t.EXPORT_STATUS)i||crmReports.showExportReportProcess(r,a),crmReports.processingImage(r);else if("EXPORT_FINISHED"===t.EXPORT_STATUS){i||(crmReports.showExportReportProcess(r,a),crmReports.processingImage(r));var n=Crm.getCrmBasePath()+"/downloadExportReport?parentId="+t.ReportID+"&fileType=csv&module=ExportReport&fileId="+t.UniqueID;t.isDownloadVCard&&(n=Crm.getCrmBasePath()+"/downloadVCard?moduleName="+t.ModuleName+"&fileType=vcf&module=DownloadVCard&fileId="+t.UniqueID),crmReports.showDownloadlink(r,n)}},crmReports.showExportReportProcess=function(e,t){var r;(crmReports.newkey++,"block"==$(".sumplusdiv").css("display")&&$("#EXPORTPOP1").find(".chatContainer").show("slow"),1!=crmReports.newkey)?((r=$(Handlebars.templates.ExportPopUp()).find(".chatContainer").clone()).css("border-top","1px solid var(--br_c0c6cc)"),r.attr("id",e),r.find(".ExportReportFileName").html(t),$("#EXPORTPOP1 .ChatContains").append(r)):((r=$(Handlebars.templates.ExportPopUp())).find(".chatContainer").attr("id",e),r.css("bottom","0px"),r.attr("id","EXPORTPOP"+crmReports.newkey),r.find(".ExportReportFileName").html(t),$("body").append(r),$("#EXPORTPOP1").slideToggle({direction:"up"},4e3))},crmReports.processingImage=function(e){$("#"+e).find(".Downstatus").find("span").text(I18n.getMsg("crm.report.export.alert.h1"));var t=$("#"+e);t.find(".Downstatus").find("img").remove(),t.find(".cancellink").hide(),t.find(".slidercontainer").show();var r=0;!function t(){setTimeout((function(){var o=$("#"+e);o.find(".cancellink").text()!=a?(o.find(".slidercolor").css({width:"30px",left:r+"px"}),t(),160==r&&(r=0,1),r+=10):o.find(".slidercolor").css({width:"inherit",left:"0px"})}),100)}();var a=I18n.getMsg("crm.view.attachment.download")},crmReports.showDownloadlink=function(e,t){var r,a=I18n.getMsg("crm.view.attachment.download");"block"==$(".sumplusdiv").css("display")?((r=$("#EXPORTPOP1")).find(".chatContainer").show(300),r.find(".sumplusdiv").hide(),r.find(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll"),setTimeout((function(){$("#"+e).find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),$("#"+e).find(".cancellink").text(a).show(),$("#"+e).find(".cancellink").attr("href",t),$("#"+e).find(".cancellink").addClass("downloadlink_report");var r=$("#"+e);r.find(".cancellink").removeClass("cancellink"),r.find(".Downstatus").find(".slidercontainer").remove(),r.find(".Downstatus").find("span").remove()}),200)):((r=$("#"+e).find(".Downstatus")).find("span").text(I18n.getMsg("crm.report.export.alert.h1")),r.find("img").remove(),setTimeout((function(){$("#"+e).find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css({width:"inherit",left:"0"})})),$("#"+e).find(".cancellink").text(a).show(),$("#"+e).find(".cancellink").attr("href",t),$("#"+e).find(".cancellink").addClass("downloadlink_report"),$("#"+e).find(".cancellink").removeClass("cancellink"),r.find(".slidercontainer").remove(),r.find("span").remove()}),200))},crmReports.escapeSplChars=function(e){var t=e.indexOf(":")?e.split(":"):[e];if(t.length>0){e=t[0].replace(/,/g,"\\,");for(var r=t.length,a=1;a<r;a++)t[a].indexOf(",")>-1&&(t[a]=t[a].replace(/,/g,"\\,")),e=e+":"+t[a]}return e},crmReports.goToReportsTab=function(){-1!==Lyte.Router.getRouteInstance().transition.url.indexOf("/tab/Reports")&&Utils.windowLocationHref(""),Lyte.Router.transitionTo({route:"crm.tab.newReports.index"})},crmReports.clearAPopupDiv=function(e){if(crmReports.newkey>0?crmReports.newkey--:crmReports.newkey=0,"undefined"!=typeof Storage){var t=localStorage.getItem(crmReports.exportReports);t&&((t=JSON.parse(t))[e]="",localStorage.setItem(crmReports.exportReports,JSON.stringify(t)))}var r=$("#EXPORTPOP1");1==r.find(".chatContainer").length?(crmReports.newkey=0,r.remove()):$("#chatcontain"+e).remove()},crmReports.showStatusBasedResult=function(e,t){if("string"==typeof e&&(e=JSON.parse(e)),t)e&&-1==e.UniqueID&&!e.EXPORT_STATUS&&exportReport("csv");else{var r=e.UniqueID;if("undefined"!=typeof Storage){var a=localStorage.getItem(crmReports.exportReports);a||(a="{}"),a=JSON.parse(a),e.MODIFIEDTIME=$L.moment().toDate().getTime(),a[r]=e,localStorage.setItem(crmReports.exportReports,JSON.stringify(a))}crmReports.showCommonMsg(r,e)}},crmReports.showMigrateTooltip=function(){var e=$(".tryNewTooltip");e&&(e.find(".tryNewtooltipHdr").text(crmReports.tooltipMsgHeading),e.find(".tryNewtooltipContent").text(crmReports.tooltipMsgContent),e.find(".tryNewtooltipTime").text(crmReports.updatedTimeMsg))},crmReports.csrf=function(){return csrfParamName+"="+encodeURIComponent(csrfToken)};var ConsentLawBasisUpdates=function(){function e(){crmui.showPopup("updateConsenttype"),thirdPartyUtils.bindSelect2(".lawFulSelect");var e="",t=$("#cautionmsg"),r=$(".reasonTextWrap");if(void 0!==customViewObject.privacyDetails&&(e=customViewObject.privacyDetails.status),"Not Applicable"===e){$("#massUpdateselect").find("#removeNotApplicable_0").remove(),$("#selectopt").removeClass("dN");var a=I18n.getMsg("crm.consent.reasontype.select");0===$("#massUpdateselect").find("#selectopt").length&&$("#massUpdateselect").prepend('<option id="selectopt" value="Select">'+a+"</option>"),$(".lawFulSelect").val("Select").trigger("change"),r.addClass("dN"),t.addClass("dN")}else{a=ConsentLawBasisUpdates.consentLawBasis.lawful_picklists.not_applicable[0]["Not Applicable"];0===$("#massUpdateselect").find("#removeNotApplicable_0").length&&$("#massUpdateselect").prepend('<option id="removeNotApplicable_0" value="Not Applicable">'+a+"</option>"),$(".lawFulSelect").val("Not Applicable").trigger("change"),r.addClass("dN"),t.removeClass("dN"),$("#massUpdateselect").find("#selectopt").remove()}thirdPartyUtils.bindSelect2(".lawFulSelect")}function t(e){var t=Lyte.Router.getRouteInstance().routeName,r=$("#lawfulbasissavebtn");r.attr("disabled",!1),r.prev().attr("disabled",!1);var a=Lyte.Router.getRouteInstance().parent&&Lyte.Router.getRouteInstance().parent.parent&&"voc"===Lyte.Router.getRouteInstance().parent.parent.routeName;"list"===t||"chart"===t||"canvas"===t||a?crmListView.reloadCurrentListView():"kanban"===t?Lyte.triggerEvent("clearSelection"):e?(Events.isPageLayoutModified=!0,CrmPrivacyDashboard.reloadCurrentListView()):crmListView.selectAllEntity("",$(".selCountIcon dIB"))}return{updateConsentType:function(){if(0===$("#updateConsenttype").length){var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/Consents/lawful_basis",headers:t,type:"GET",success:function(t){ConsentLawBasisUpdates.consentLawBasis=t;var r=Handlebars.templates.updateConsentType;$("#show").append(r(t)),e()}})}else e()},updateConsentstatusAllRecords:function(){var e=$("#lawfulbasissavebtn");e.attr("disabled",!0);var r="",a="",o="",i=$("#reqOptionDetailview"),n=i.length>0,s=customViewObject.isPrivacyListView,l="";if(l=n?detailView.currentModule?detailView.currentModule:$L("#module")[0].value:customViewObject.module,"true"===$("#disabledPrivacyStatus").val())a="Not Applicable";else{var c=$(".lawFulSelect option:checked"),d=c.length;if(1==d)a=c.val(),c.html();else for(var u=0;u<d;u++){var m=c[u].value,p=c[u].outerText;"Select"!==m&&(a=m,p)}}if(n)r=detailView.entityId?detailView.entityId:$L("#entityId")[0].value;else{var g=customViewObject.selectedIds.length;for(u=0;u<g;u++)r=customViewObject.selectedIds[u]+","+r;r=r.substring(0,r.length-1)}var h="";if($(".textReason").length>1){var v=$(".textReason")[1];h=$(v).val()}else h=$(".textReason").val();if("Pending"!==a&&""!==h&&(o=h),void 0!==e){var f=e.prev();void 0!==f&&f.attr("disabled",!0)}var C={};C.module=l,C.entityIds=r,C.Consent_Status=a,C.Lawful_Reason=o;var y=[];y.push(C);var b={consent_details:y},I={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},T=new crmRequestPool;commonUtils.showHideLoadingDiv(!0),T.initiate({action:"/crm/v2/Consents/update/data_processing",data:JSON.stringify(b),headers:I,type:"POST",success:function(e){if("success"===e.consent_details.success){if(n&&null!=detailView.currentModule&&"crm.tab.module.entity.canvas"!==Lyte.Router.getRouteInstance().transition.info.route&&crmTab.deleteFromCache(detailView.currentModule),isWFSchedulerUser()&&e.isWFScheduler)return void(n&&(detailView.singleRecordLyteOffloading=!0,detailView.refreshInWms=!0));if(i.length>0){$(".notRequiredProcess").addClass("dN"),DataPrivacy.refreshDataPrivacyView();var r=$L("#consentLawfuldetails");return crmui.modalZIndex("nonLyte",r[0],"close"),r&&r.length>0&&r[0].remove(),commonUtils.showHideLoadingDiv(),void(n&&(detailView.isDataPrivacyModified=!0))}crmui.hidePopup("updateConsenttype"),renderingUtils.removeFreezeLayer(),crmui.showMsgBand("success",I18n.getMsg("crm.massupdate.updatedsuccesfully"),"4000",""),t(s),commonUtils.showHideLoadingDiv(),"Pending"===a?($(".consentEdit").removeClass("consentTypeEdit"),$(".afterDeactivateConsent").removeClass("notAConsent")):($(".consentEdit").addClass("consentTypeEdit"),$(".afterDeactivateConsent").addClass("notAConsent"))}},error:function(e){403==e.status&&(crmui.hidePopup("updateConsenttype"),renderingUtils.removeFreezeLayer(),renderingUtils.showAlertMsg(I18n.getMsg("crm.security.error"),"error"),commonUtils.showHideLoadingDiv())}}),Crm.trackSpotLightAction("GDPR - Data Processing Basis Updated",{Module:l,Type:a,"Basis Type":"Lawfull Basis"})},reasonSelected:function(e){var t=$(e).val(),r=$(".reasonTextWrap"),a=$("#lawfulbasissavebtn");$("#reqOptionDetailview").is(":visible")&&(a=$(".reasonSaveBtn")),"Select"!==t?a.attr("disabled",!1):(a.attr("disabled",!0),r.addClass("dN")),"Pending"!==t&&"Select"!==t&&"Not Applicable"!==t?(r.removeClass("dN").show(),$(".textReason").val("").removeClass("dN"),detailView.scrollDataProcessingPop()):"Pending"===t&&"Select"===t&&"Not Applicable"!==t||r.addClass("dN")},afterchangeToggle:t,showDataProcessingPopup:e}}(),massActionNotification={hideMassOperationProgressDiv:function(){$("#massOperationProgressDiv").css({bottom:"-400px"});var e=$(".massOperationProgressIcon");e.removeClass("activeProgress"),e.parent().css({top:"","border-top":""}),$("#massScheduleMinClose").hasClass("closeSchedularPop")&&($("#massOperationJobsDiv").empty(),$("#massProgress").addClass("dN"))},showProgressDiv:function(){var e=$(".massOperationProgressIcon");e.hasClass("activeProgress")?massActionNotification.hideMassOperationProgressDiv():(Crm.menu.globalHideMenu(),hideFeedBackPopup(),$("#massOperationProgressDiv").css({bottom:"26px"}),e.addClass("activeProgress"),e.parent().css({top:"-1px","border-top":"1px solid #fff"}))},changeIcon:function(e){"close"===e?$("#massScheduleMinClose").removeClass("minimizeSchedularPop").addClass("closeSchedularPop"):$("#massScheduleMinClose").removeClass("closeSchedularPop").addClass("minimizeSchedularPop")},showMassOperationProgress:function(e){var t=$("#massProgress");$("#massScheduleMinClose").hasClass("closeSchedularPop")&&($("#massProgress").removeClass("dN"),massActionNotification.changeIcon("min"),$(".massOperationProgressIcon").hasClass("activeProgress")||massActionNotification.showProgressDiv());var r=$("#wmsstatusbar"),a=$("#ProgressIconDiv"),o=r.find("tr"),i=$("#massOperationJobsDiv"),n=i.find(".massJobHover"),s=$("#job_"+e.jobId),l=$("#massOperationProgressDiv"),c=l.find(s);if(o.find(a).length<=0){o.prepend("<td style='border-left: 1px solid #c0c6cc;' id='massProgress'><div class='vaM pR h30' style='padding: 5px; display: table-cell; bottom: 0px; top: -1px; border-top: 1px solid #fff;'><div id='ProgressIconDiv' data-zcqa='massActionProgressIcon' class='massOperationProgressIcon cP pR activeProgress'  onclick='massActionNotification.showProgressDiv()' onmouseover='' data-title='Mass Operation'></div></div></td>");var d=$("#touricon");($("#wldpop").length>0||d.length>0)&&t.css({"border-right":"1px solid #c0c6cc"}),d.length>0&&d.parent().find("span").css({"padding-left":"10px"})}var u=$("#progressAreaDiv_"+e.jobId),m=$("#processedCountSpan_"+e.jobId),p=$("#totalCountSpan_"+e.jobId),g=$("#massOperationTitle"),h=e.moduleLabel;if(e.moduleLabel=moduleRecordMapping[e.moduleLabel].plural_label,0===l.find("div").length){Handlebars.registerPartial("massOperationQueuedJobs",Handlebars.templates.massOperationQueuedJobs);var v=Handlebars.templates.massOperationProgress(e);l.html(v);var f="",C="";switch(g=$("#massOperationTitle"),e.actionType){case 1:case 7:case 8:f="crm.mass.actions.update",C="crm.mass.actions.update.action";break;case 12:case 2:f="crm.mass.actions.delete",C="crm.mass.actions.delete.action";break;case 3:f="crm.mass.actions.transfer",C="crm.mass.actions.transfer.action";break;case 4:f="crm.blueprint.mass.actions.titlekey",C="crm.blueprint.mass.actions.preparing.actionkey";break;case 6:case 11:f="crm.blueprint.flowchange.wms.titlekey",C="crm.blueprint.flowchange.wms.preparing.actionkey";break;case 9:g=$("#massOperationTitle"),C="crm.reviewprocess.deactivate.action.wms.preparing";break;case 10:g=$("#massOperationTitle"),C="crm.reviewprocess.update.action.wms.preparing"}var y="";if(l.find(n).length>1)f="crm.mass.actions.common.title",y=I18n.getMsg(f);else{var b=I18n.getMsg(f);y=6===e.actionType||11===e.actionType?I18n.getMsg("crm.blueprint.flowchange.wms.progress.title",[b]):4===e.actionType?I18n.getMsg("crm.blueprint.mass.actions.progress.title",[b]):9===e.actionType?I18n.getMsg("crm.reviewprocess.deactivate.wms.preparing"):10===e.actionType?I18n.getMsg("crm.reviewprocess.update.wms.preparing"):I18n.getMsg("crm.mass.actions.progress.title",[b])}if(l.find(g).text(y),1===e.status){var I=I18n.getMsg(C),T=I18n.getMsg("crm.mass.actions.preparing",[I]);$("#prepareMsg_"+e.jobId).text(T)}l.css({bottom:"26px"}).show(),$(".massOperationProgressIcon").addClass("activeProgress").parent().css({top:"-1px","border-top":"1px solid #fff"})}else if(5===e.status||4===e.status){u.addClass("dN");var w="",E="",k="";switch(e.actionType){case 1:4!==e.status?(w=I18n.getMsg("crm.mass.actions.mass.updated.done",[e.processedCount,e.moduleLabel]),Crm.trackSpotLightAction("Mass Scheduler - Mass update completed",{Module:e.module})):(E=I18n.getMsg("crm.mass.actions.mass.update.job"),Crm.trackSpotLightAction("Mass Scheduler - Mass Update Failed",{Module:e.module})),k="crm.mass.actions.update";break;case 12:case 2:4!==e.status?(w=I18n.getMsg("crm.mass.actions.mass.deleted.done",[e.processedCount,e.moduleLabel]),Crm.trackSpotLightAction("Mass Scheduler - Delete completed",{Module:e.module})):(E=I18n.getMsg("crm.mass.actions.mass.delete.job"),Crm.trackSpotLightAction("Mass Scheduler - Delete Failed",{Module:e.module})),k="crm.mass.actions.delete";break;case 3:4!==e.status?(w=I18n.getMsg("crm.mass.actions.mass.transfered.done",[e.processedCount,e.moduleLabel,e.ownerName]),Crm.trackSpotLightAction("Mass Scheduler - Change Owner completed",{Module:e.module})):(E=I18n.getMsg("crm.mass.actions.mass.transfer.job"),Crm.trackSpotLightAction("Mass Scheduler - Change Owner Failed",{Module:e.module})),k="crm.mass.actions.transfer";break;case 4:4!==e.status?(w=I18n.getMsg("crm.mass.actions.mass.updated.done",[e.processedCount,e.moduleLabel]),Crm.trackSpotLightAction("Mass Scheduler - Remapping State completed",{Module:e.module})):(E=I18n.getMsg("crm.blueprint.mass.actions.preparing.actionkey"),Crm.trackSpotLightAction("Mass Scheduler - Remapping State Failed",{Module:e.module})),k="crm.blueprint.mass.actions.titlekey";break;case 6:if(4!==e.status){var O="";"exit"===e.flowAction?O="crm.blueprint.flowchange.wms.exit.success":"remap"===e.flowAction&&(O="crm.blueprint.flowchange.wms.update.success"),w=I18n.getMsg(O,[e.processedCount,e.moduleLabel]),Crm.trackSpotLightAction("Mass Scheduler - Blueprint FlowChange Action completed",{Module:e.module,FlowAction:e.flowAction})}else E=I18n.getMsg("crm.blueprint.flowchange.wms.preparing.actionkey"),Crm.trackSpotLightAction("Mass Scheduler - Blueprint FlowChange Action Failed",{Module:e.module});k="crm.blueprint.flowchange.wms.titlekey";break;case 7:case 8:4!==e.status?(w=I18n.getMsg("crm.mass.actions.mass.updated.done",[e.processedCount,e.moduleLabel]),Crm.trackSpotLightAction("Mass Scheduler - Pipeline transfer completed",{Module:e.module})):(E=I18n.getMsg("crm.mass.actions.mass.update.job"),Crm.trackSpotLightAction("Mass Scheduler - Pipeline transfer Failed",{Module:e.module}));break;case 9:4!==e.status&&(E=I18n.getMsg("crm.rp.wms.error.deactivate.action")),k="crm.rp.wms.error.title";break;case 10:4!==e.status&&(E=I18n.getMsg("crm.rp.wms.error.field.update")),k="crm.rp.wms.error.title";break;case 11:if(4!==e.status){O="push_in"===e.massAction?"blueprint.settings.records.include":"blueprint.settings.records.exclude";w=I18n.getMsg(O,[e.added_count||0,e.totalCount])}k="crm.blueprint.flowchange.wms.titlekey"}var S=I18n.getMsg("crm.mass.actions.refresh2",[e.moduleLabel,e.jobId]),R=I18n.getMsg(k);if(l.find(n).length>0){var M,_;if(4===e.status)w=I18n.getMsg("crm.mass.actions.failed",[E,e.moduleLabel]),M=6===e.actionType||11===e.actionType?I18n.getMsg("crm.blueprint.flowchange.wms.failed.title",[R]):4===e.actionType?I18n.getMsg("crm.blueprint.mass.actions.failed.title",[R]):7===e.actionType||8===e.actionType?I18n.getMsg("crm.pipeline.transfer.failure"):I18n.getMsg("crm.mass.actions.failed.title",[R]),g.text(M);else _=6===e.actionType||11===e.actionType?I18n.getMsg("crm.blueprint.flowchange.wms.completed.title",[R]):4===e.actionType?I18n.getMsg("crm.blueprint.mass.actions.completed.title",[R]):7===e.actionType||8===e.actionType?I18n.getMsg("crm.pipeline.transfer.success"):9===e.actionType?I18n.getMsg("crm.reviewprocess.deactivate.wms.completed"):10===e.actionType?I18n.getMsg("crm.reviewprocess.update.wms.completed"):I18n.getMsg("crm.mass.actions.completed.title",[R]),g.text(_)}else{4===e.status&&(w=I18n.getMsg("crm.mass.actions.failed",[E,e.moduleLabel]));var D="crm.mass.actions.common.title",L=I18n.getMsg(D);g.text(L)}$("#prepareMsg_"+e.jobId).text("");var A=$("#completedMsgDiv_"+e.jobId),P=A.find("span"),U=$("#clearLink");if(P.html($ESAPI.encoder().encodeForHTML(w)),4===e.status&&P.css("color","rgb(221, 0, 0)"),A.show(),c.find(m).text(e.processedCount),c.find(p).text(e.totalCount),5===e.status){var B=Lyte.Router.getRouteInstance().transition.info.route;(-1!==B.indexOf("crm.tab.module.custom-view.kanban")||-1!==B.indexOf("crm.tab.module.custom-view.list")&&crmTab.getFromCache(h)&&crmTab.getFromCache(h).cvId==e.cvId)&&$("#refreshMsg_"+e.jobId).html(S)}if(l.css({bottom:"26px"}).show(),$(".massOperationProgressIcon").addClass("activeProgress").parent().css({top:"-1px","border-top":"1px solid #fff"}),"undefined"!=typeof customViewObject&&Object.keys(customViewObject).length>0){var x=crmTab.getFromCache(h);if(x&&e.cvId===x.cvId&&customViewObject.cvId===e.cvId){var N=$("#selectAllRecords");N.length>0&&(customViewObject.showSelectAll=!0),"customCheckBoxChecked"===$("#checkAll").attr("class")&&(customViewObject.showSelectAll=!0,N.show())}}s.find(U).css("visibility","visible"),massActionNotification.changeIcon("close")}else if(0===l.find(s).length){var F=l.find(i),j=Handlebars.templates.massOperationQueuedJobs(e),V=F.find(s);V.length>0?V.replaceWith(j):F.prepend(j);D="crm.mass.actions.common.title",L=I18n.getMsg(D);g.text(L)}else{if(0!==e.processedCount&&$("#prepareMsg_"+e.jobId).text(""),c.find(u).find(".slidercont .slidercolor").css({width:e.perCentageCompleted+"%"}),c.find(m).text(e.processedCount),c.find(p).text(e.totalCount),l.find(n).length>1){D="crm.mass.actions.common.title",L=I18n.getMsg(D);g.text(L)}l.show()}}},recordLockingConfigNotification={hideRecordLockingRuleProgress:function(){var e=$L(".recordLockRuleProgressIcon");e.removeClass("activeProgress"),e.parent().css({top:"","border-top":""}),$L("#lockRuleNotify").removeClass("schedularOpen")},showLockingRuleProgressDiv:function(){var e=$L(".recordLockRuleProgressIcon");e.hasClass("activeProgress")?recordLockingConfigNotification.hideRecordLockingRuleProgress():(Crm.menu.globalHideMenu(),hideFeedBackPopup(),e.addClass("activeProgress"),e.parent().css({top:"-1px","border-top":"1px solid #fff"}),$L("#lockRuleNotify").addClass("schedularOpen"))}},crmCommonModule={createEditJson:"",moduleName:void 0,currentStatus:void 0,isApproved:void 0,setStatus:function(e){this.currentStatus=e},createFieldLabel:function(e,t){var r="Crm_"+this.moduleName+"_"+e.colname,a=$("#multipleFieldsEditPop").is(":visible");if(4==e.uitype&&"Who Id"==e.label&&("Tasks"!==this.moduleName||!a)){var o=this.moduleName,i=objectUtils.getKeys(crmConstants.defaultWhoId[o]);e.defaultid&&"null"!==e.defaultid&&""!==e.lookupmodule&&!crmConstants.defaultWhoId[this.moduleName][e.lookupmodule]&&Crm.userDetails.MODULE_LIST[e.lookupmodule]&&Crm.userDetails.MODULE_LIST[e.lookupmodule].visible&&Crm.userDetails.MODULE_LIST[e.lookupmodule].viewable&&i.push(e.lookupmodule);o=this.moduleName;var n=renderingUtils.createSelectBox((function(t){var r=moduleRecordMapping[i[t]]?moduleRecordMapping[i[t]].singular_label:crmConstants.defaultWhoId[o][i[t]];if(!r)return!1;var a={html:I18n.getMsg(r),value:i[t]};return 1!==t||e.defaultid?a.value==e.lookupmodule&&(a.defaultVal="true"):a.defaultVal="true",a})),s=$(n);s.removeClass("select"),s.css({width:"135px"}),s.attr({id:r+"_WhoId_select"}).data({displayLabel:I18n.getMsg("Related To"),uitype:e.uitype,mandate:e.mandate,name:t,maxlength:e.maxlength}),Crm.fieldsObj[this.moduleName].push(r+"_select");o=this.moduleName;s.change((function(){window[o].showRelatedToOptions(this,!0)})),t.append(n)}return t},setWidthBasedOnFieldType:function(e){var t;switch(e){case 300:case 301:t="107";break;case 24:case 202:t="145";break;case 32:case 34:case 36:case 38:case 52:case 143:case 144:case 145:t="160";break;case 116:t="195";break;case 1:case 2:case 11:case 19:case 20:case 21:case 25:case 33:case 35:case 37:case 127:case 133:case 221:t="265";break;case 333:t="298";break;case 3:case 100:case 110:case 555:t="365"}return t},createFieldContent:function(e,t){return"ADDCOMMENT"!==e.colname||"Solutions"!==this.moduleName&&"Cases"!==this.moduleName||!/create|clone/.test(this.currentStatus)||t.find("textarea").prop("disabled","true"),t},createTemplate:function(e,t,r,a){var o=this.moduleName;if(e=removeRFMSegmentationCustomFields(e,o),crmCommonModule.createEditJson=e,e[o]&&e[o].fieldDependency&&(Crm.fieldDependency[o]=JSON.parse(e[o].fieldDependency),"Potentials"==o&&e.entityMapJson&&e.entityMapJson.PIPELINE&&e.entityMapJson.STAGE&&Crm.fieldDependency[o].PIPELINE&&Crm.fieldDependency[o].PIPELINE.STAGE&&!Crm.fieldDependency[o].PIPELINE.STAGE[e.entityMapJson.PIPELINE.defaultvalue]&&e.entityMapJson.STAGE.defaultvalue.indexOf(":")>-1&&(Crm.fieldDependency[o].PIPELINE.STAGE[e.entityMapJson.PIPELINE.defaultvalue]=[Crm.getDealsStageValue(e.entityMapJson.STAGE.defaultvalue)])),e[o].subforms&&Crm.userDetails.isMapDepencySubFormSupported)for(var i=e[o].subforms.section.length,n=e[o].subforms.section,s=0;s<i;s++){var l=n[s].subFormName;n[s].fieldDependency&&(Crm.fieldDependency[l]=JSON.parse(n[s].fieldDependency))}if(e[o]&&(e[o].DatePattern&&(Crm.userDetails.DATE_PATTERN=e[o].DatePattern.toLowerCase()),e[o].calPreferences&&(Crm.calPreferences=e[o].calPreferences)),e.WhatId&&(window[o].whatIdModulesArr=e.WhatIdArr.split(":::"),crmConstants.defaultWhatId[o]=window[o].whatIdModulesArr),e.WhoId&&(window[o].whoIdModulesArr=[],""!=e.WhoIdArr.split(":::")&&(window[o].whoIdModulesArr=e.WhoIdArr.split(":::"))),e.currencyDetails&&(this.currencyDetails=e.currencyDetails),Crm.isInventoryModule(o)&&Crm.userDetails.lineItemFormulaCalcFlow!=e.lineItemFormulaCalcFlow&&(Crm.userDetails.lineItemFormulaCalcFlow=e.lineItemFormulaCalcFlow),e.businessJSON||e.holidays){Crm.businessJSON=e.businessJSON;var c=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(Crm.businessJSON.business_days){if((ye=Crm.businessJSON.business_days.length)>0&&ye<7){for(s=0;s<ye;s++)c.removeFirstOccurenceOfElement(Crm.businessJSON.business_days[s]);Crm.businessJSON.closedDay=c}}else Crm.businessJSON.business_days=c,Crm.businessJSON.closedDay=[];Crm.holidays=e.holidays,Crm.holidays.selectedDate=[]}e.appointmentPreferences&&(Lyte.registeredMixins["crm-appointments-mixin"].appointmentPreferences=e.appointmentPreferences);r=r||"show";var d=$("#"+r),u="Activities"===Crm.activityGrp[o]&&"edit"===window[o].currentStatus&&0===$("#gsearchparentdiv:visible").length;if(u){var m=Crm.renderDVLyteFlow(this.moduleName);"true"===$("#iskanbanview").val()?(ActivityMoreInfoContent=$("#entitypopup").html(),d=thirdPartyUtils.bindPerfectScrollUpdate("#cvEditSave"),d=$("#cvEditSave").show(),m&&(d=$("#show"))):$("#taskDetailsPart").length?(d=$("#taskDetailsPart"),ActivityMoreInfoContent=d.html(),$("#rp_td").hide(),m&&(d=$("#show"))):u=!1}"Appointments"===this.moduleName&&"layoutPreview"!==r||"Tasks"===this.moduleName&&e.isFromRelatedList||$(d).empty(),e.isClientAccount=Crm.userDetails.CLIENT_ACCOUNT;var p="create",g=40;if($("#moduleBuilderForm").is(":visible")&&(p="preview",g=20),-1===crmTemplate.arrayNewClass.indexOf(this.moduleName))var h=getDomWidthCalculation(e[this.moduleName].section,p);if(("relatedlist_new"===Events.createSource||"krp"===Events.createSource||"salessignals"===Events.createSource||"listview"===Events.createSource&&("kanban"===Lyte.Router.getRouteInstance().routeName||"list"===Lyte.Router.getRouteInstance().routeName))&&"Appointments"===this.moduleName){var v=Events.appointmentParams?Crm.userDetails.isRelatedListLyteEnabled?"custom_lookup"!==Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(Events.appointmentParams.listRelationId).type:!crmRelatedList.getPersonalityModuleObj(Events.appointmentParams.listRelationId).isCustLookUp:void 0;if(Events.appointmentParams&&("krp"===Events.createSource||"salessignals"===Events.createSource||"canvas"===Lyte.Router.getRouteInstance().routeName||"listview"===Events.createSource&&("kanban"===Lyte.Router.getRouteInstance().routeName||"list"===Lyte.Router.getRouteInstance().routeName)||v)){var f=e[this.moduleName].section[0];if("Appointment Information"===f.name){var C=Events.appointmentParams.relmodule,y=Events.appointmentParams.entityname,b=Events.appointmentParams.entityid,I=f.FL.length;for(i=0;i<I;i++){if("Services"===C&&"SERVICEID"===f.FL[i].colname&&f.FL[i].uitype===CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY.toString()){f.FL[i].defaultvalue=y,f.FL[i].defaultid=b;break}if("Services"!==C&&f.FL[i].uitype===CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY.toString()){f.FL[i].lookupmodule=C;for(var T=f.FL[i].multiModuleLookup.length,w=0;w<T;w++){var E=f.FL[i].multiModuleLookup[w].id,k=store.peekRecord("module",E);if(k&&k.module_name==C){f.FL[i].defaultvalue1=k.plural_label;break}}f.FL[i].defaultvalue2=y,f.FL[i].defaultid=b;break}}}e[this.moduleName].section[0]=f}delete Events.appointmentParams}var O=crmTemplate.create(e,this.moduleName,e[this.moduleName].section,r);h!==[]&&-1===crmTemplate.arrayNewClass.indexOf(this.moduleName)&&(O.find(".columnCal1").css("width",h[0]+g+"px"),O.find(".columnCal2").css("width",h[1]+g+"px"));var S=$("#markPopups");if("Appointments"===this.moduleName&&"setup"!==this.currentStatus&&"layoutPreview"!==r)if("calendar"==Events.createSource){var R=$("#qCreate");if(R.prop("onclick",null),R.is(":empty")||R.empty(),R.append("<span class='qcpopuparrow'></span>"),R.removeClass("newActivitesPopupStyleEle"),R.append(O),Crm.isAppAction&&"edit"===e.currentStatus){var M=Handlebars.templates.ServiceModuleUtils();S.html(M);var _=Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppMenu(e,null,this.moduleName);if(delete Crm.isAppAction,Events.entityId=e.entityId,!_)return;crmui.showPop(_,!1),thirdPartyUtils.bindSelect2($(".newChosenSel").find("select")),setTimeout((function(){$("#Calendar").hide()}),50)}else crmCommonModule.serviceLookupDisabled=!1,Events.isAppointmentReschedule=!1,R.append('<div class="appointment_cal_btn"><input type="button" data-zcqa="Lookup_Appointment_cancelAppointmentBtn" id="cancelAppointmentBtn" onclick="Lyte.registeredMixins["crm-services-appointments-old-mixin"].hideAppointment_calendar()" class="newgraybtn" value='+I18n.getMsg("crm.button.cancel")+'><input type="button" data-zcqa="Lookup_Appointment_saveEventsBtn" id="saveAppointmentsBtn"  class="primarybtn mR0" onclick="Events.validateEntity(event);" value='+I18n.getMsg("crm.button.save")+"></div>"),R.addClass("appointment_calendar").show(),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentScroll(),renderingUtils.positionArrow(Events.crntEleappointment,"qCreate",Events.evtappointment,"qcpopuparrow",Events.appointmentPos),thirdPartyUtils.bindSelect2("select"),$("#Crm_Appointments_APPOINTMENTNAME").data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this)),renderingUtils.freezeBackground()}else{var D='<div id="appointmentCreate" class="newPopup ppTop  is-scroll showPpTop" style="display: none;"> <div class="pp-content">    <form action="'+Crm.getCrmBasePath()+'/CreateCommonModule.do" method="POST" name="createAppointmentForm" onsubmit="return crmTemplate.submitCreate(\'Events\');"><div id="appointmentCreationInnerDiv" class="eventForm-ins boxBB" style="width: 100%;"></div><input type="submit" style="display:none"/></form></div><div class="pp-footer "> <input type="button" data-zcqa="Lookup_Appointment_cancelAppointmentBtn" id="cancelAppointmentBtn" onclick="Lyte.registeredMixins["crm-services-appointments-old-mixin"].cancelAppointmentBTN()" class="newgraybtn" value='+I18n.getMsg("crm.button.cancel")+'><input type="button" data-zcqa="Lookup_Appointment_saveEventsBtn" id="saveAppointmentsBtn"  class="primarybtn mR0" onclick="Events.validateEntity(event);" value='+I18n.getMsg("crm.button.save")+"> </div></div>";$(".bodycontainer").append(D),$("#appointmentCreationInnerDiv").html(O);$("#secDiv_Appointment_Information"),$("#unAvailableSpan").text();thirdPartyUtils.bindSelect2($(".newChosenSel select")),Events.module="Appointments",Events.moduleName="Appointments",Events.currentStatus=e.currentStatus;C=getObj("module")?getObj("module").value:null;"relatedlist_new"===Events.createSource&&"Appointments"===this.moduleName?crmCommonModule.isAppointmentForModuleLooked=!0:crmCommonModule.isAppointmentForModuleLooked=!1,crmCommonModule.serviceModuleLooked=!1,Events.isAppointmentReschedule=!1,crmCommonModule.customerAddress=[];var L=$("#Crm_Appointments_APPOINTMENTNAME");"clone"==e.currentStatus&&(e.entityMapJson&&e.entityMapJson.SEID&&!e.entityMapJson.SEID.defaultvalue1&&$("#Crm_Appointments_SEID_RELATEDTO").val(""),L.data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this)));var A=$("#Crm_Appointments_SERVICEID");if("create"==e.currentStatus){"salessignals"===Events.createSource&&crmNTC.positionAppointmentcreatePopup(),crmCommonModule.serviceLookupDisabled=!1,L.data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this));var P=A.data().id;if(P)networkUtils.lyteInitiateRequest("/crm/v2.1/Services__s/"+P,"GET").then((function(e){if(e&&e.data&&e.data.length){crmCommonModule.serviceModuleLooked=!0,Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentRelatedDataOldFlow(e.data[0]),new Promise((function(t){if(e.data[0].$has_more.Members){store.model[moduleRecordMapping.Services.id]||store.registerModel(moduleRecordMapping.Services.id,{},{extends:"entity"});var r=Lyte.registeredMixins["crm-services-mixin"].getRelationIdofMembersField(),a={};a.relatedId=P,a.relationId=r,store.findAll(moduleRecordMapping.Services.id,a,void 0,!1).then((function(e){t(e[moduleRecordMapping.Services.id])}))}else t()})).then((function(e){Lyte.registeredMixins["crm-services-appointments-old-mixin"].setMemberDataForAppointment(e),setTimeout((function(){var e=document.getElementById("Crm_Appointments_SMOWNERID");if(e&&e.hasChildNodes()>0){e.component.setData("dataId",""),e.component.setData("userRecord",void 0);var t=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");Lyte.registeredMixins["crm-appointments-mixin"].checkServiceAvailability(t)}}),200)})),crmui.showPop("appointmentCreate",!1),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentScroll();var t=$("#checkDuplicateEvent"),r=t.prev();if(t.is(":visible")){var a=r.find(".labelValCreate").outerWidth(),o=r.find(".labelTabCreate").outerWidth();t.css({width:a,"margin-top":"-10px","margin-left":o})}}}));else{crmui.showPop("appointmentCreate",!1),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentScroll();var U=(j=$("#checkDuplicateEvent")).prev();if(j.is(":visible")){var B=U.find(".labelValCreate").outerWidth(),x=U.find(".labelTabCreate").outerWidth();j.css({width:B,"margin-top":"-10px","margin-left":x})}}}if("edit"==e.currentStatus||"clone"==e.currentStatus){if(Crm.isAppAction&&"edit"===e.currentStatus){M=Handlebars.templates.ServiceModuleUtils();S.html(M);_=Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppMenu(e,_,this.moduleName);if(delete Crm.isAppAction,!_)return;crmui.showPop(_,!1)}else if(crmui.showPop("appointmentCreate",!1),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setAppointmentScroll(),Lyte.registeredMixins["crm-services-appointments-old-mixin"].setMemberDataForAppointment(),"edit"==e.currentStatus){var N=$("#Appointments_fldRow_SERVICEID");$("#Crm_Appointments_APPOINTMENTDATEANDTIME").attr("disabled","disabled"),$("#Crm_Appointments_APPOINTMENTDATEANDTIME_TimeOption").attr("disabled","disabled"),$("#Appointments_fldRow_APPOINTMENTDATEANDTIME").addClass("readonlyF"),N.find(".clear_lookupfield").hide(),N.addClass("readonlyF"),$("#Crm_Appointments_SERVICEID_loadimg").remove(),$("#Crm_Appointments_SERVICEID_img").attr("data-lookup-module",""),A.attr("disabled","disabled"),crmCommonModule.serviceModuleLooked=!0,crmCommonModule.isAppointmentForModuleLooked=!0,crmCommonModule.serviceLookupDisabled=!0}else{var F=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");Lyte.registeredMixins["crm-appointments-mixin"].checkServiceAvailability(F)}Events.entityId=e.entityId;var j;U=(j=$("#checkDuplicateEvent")).prev();if(j.is(":visible")){B=U.find(".labelValCreate").outerWidth(),x=U.find(".labelTabCreate").outerWidth();j.css({width:B,"margin-top":"-10px","margin-left":x})}}$("#appointmentCreate .pp-content").on("scroll",(function(){$(".lookFieldSrcWrap,.eventActionsMenu").hide()})),crmTemplate.bindFldTooltip(),renderingUtils.labelWidthFixed("secContent_Appointment_Information"),setTimeout((function(){$("#Calendar").hide()}),50)}else if("Tasks"===this.moduleName&&e.isFromRelatedList){$("#newRelatedListPopUpDiv").append(O),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),$("#cancelTasksBtn_Bottom").attr("data-cid",""),$("#saveAndNewTasksBtn_Bottom").hide()}else{var V=!0;if(e.isFrom&&"clientPortal"===e.isFrom&&!1===e.showLayoutLabel){O[0].lastElementChild.innerHTML='<div class="wiz_loading" style="display: block"><div class="wiz_alignCenter"><span class="wiz_loading_gif"></span></div></div>',d.append(O),V=!1;var H=e.layout_jsonarrayObj.layout_jsonarrayObj[0],J=H.layouts[0].id;crmCommonModule.renderWizardPreview(this.moduleName,J,H.id,e.profileId)}V&&d.append(O)}"layoutPreview"===r&&$(".dvPhotoShadow").show();var W=$("#zCampIntegLayout");if(W.length>0)if("zCampIntegLayoutOffline"!=(J=W.val())){var Y=$L('input[data-sysrefname="Native__Backstage__Extn__Event_Name"]');Y.length||(Y=$L('input[data-sysrefname="Native__Campaigns__Extn__Campaign_Subject"]')),$("#changeDefLayout").addClass("hide"),Y.length&&Y.on("focusout",(function(){var e=$(this).val(),t=$('input[data-sysrefname="Campaign_Name"]');validationUtils.isNotEmpty(e)&&!t.val()&&t.val(e)}))}else $("#changeDefLayout").removeClass("hide");for(var z,q=e[this.moduleName].section.length,G=0;G<q;G++){var Q=e[this.moduleName].section[G].FL.length;for(s=0;s<Q;s++)if("555"===e[this.moduleName].section[G].FL[s].uitype&&"clone"!=this.currentStatus){var K=e[this.moduleName].section[G].FL[s].fieldid;if(e[this.moduleName].section[G].FL[s].defaultvalue!=I18n.getMsg("crm.tpi.ctiapi.config.choosefile")&&null!=e[this.moduleName].section[G].FL[s].defaultvalue&&""!=e[this.moduleName].section[G].FL[s].defaultvalue&&0!=e[this.moduleName].section[G].FL[s].defaultvalue.length){for(var X=0,Z=0,ee=e[this.moduleName].section[G].FL[s].defaultvalue.length,te=0;te<ee;te++){1==e[this.moduleName].section[G].FL[s].defaultvalue[te].link_Docs?!0:3==e[this.moduleName].section[G].FL[s].defaultvalue[te].link_Docs&&!0;var re=0,ae=e[this.moduleName].section[G].FL[s].defaultvalue[te].file_Size.split(" ");"KB"==ae[1]?re=1024*ae[0]:"MB"==ae[1]&&(re=1024*ae[0]*1024);var oe=e[this.moduleName].section[G].FL[s].defaultvalue[te].file_Id;null==oe&&(oe=e[this.moduleName].section[G].FL[s].defaultvalue[te].preview_Url),""!=e[this.moduleName].section[G].FL[s].defaultvalue[te].file_Size&&null!=e[this.moduleName].section[G].FL[s].defaultvalue[te].file_Size&&(Z+=parseInt(re),X++)}$("#attachCount_"+K).val(X),$("#attachSize_"+K).val(Z)}}}if(/Tasks|Calls/.test(o)){var ie=$("#Crm_"+o+"_CONTACTID"),ne=$("#Crm_"+o+"_SEID"),se=$("#Crm_"+o+"_CONTACTID_WhoId_select");""==ie.val()&&""!=ne.val()&&se.val("Contacts"),$("#Crm_"+o+"_CONTACTID_WhoId_select").parent().addClass("newChosenSel"),window[o].showRelatedToOptions(se)}("Campaigns"===o&&e.isZohoSurvey&&"true"===e.isZohoSurvey&&networkUtils.loadFeatureScripts(["zsurvey_home-min.js","zsurvey_templates.js"],(function(){ZSurvey.handleCampaignSurveyFieldsData(e)})),"PurchaseOrders"===o&&"create"===this.currentStatus)&&((z=$("#"+crmTemplate.getElemIdByColname("PurchaseOrders","PODATE")))[0]&&z.val(Utils.getDateInUserDatePattern(new Date(e.currentDate))));"Invoices"===o&&"create"===this.currentStatus&&((z=$("#"+crmTemplate.getElemIdByColname("Invoices","INVOICEDATE")))[0]&&z.val(Utils.getDateInUserDatePattern(new Date(e.currentDate))));var le=$("#Crm_"+this.moduleName+"_TERMSANDCONDITIONS");if(le[0]&&"create"===this.currentStatus&&le.val(e.TERMSANDCONDITIONS),"layoutPreview"===r&&"Calls"===o||d.find(".newInputStyleEle select, div.selectElementNew1").closest(".tabDivCreate").addClass("selectBoxSelect2"),d.find(".editParentSection").removeClass("pL30"),"PriceBooks"==o){var ce=$("#"+crmTemplate.getElemIdByColname("PriceBooks","PRICINGMODEL")).val();"-None-"!=ce&&""!=ce&&null!=ce||$("#secDiv_Pricing_Details").hide()}if("setup"!=this.currentStatus&&setTimeout((function(){crmTemplate.setDependentFields(o,window[o].currentStatus)}),10),"Tasks"===o){crmTasks.init(),"edit"!=window[o].currentStatus&&"clone"!=window[o].currentStatus||(crmTasks.editTask=!0),!e||null==e.compDisplayVal&&""==e.compDisplayVal||(crmTasks.compDispVal=e.compDisplayVal);var de=$("#Crm_Tasks_DUEDATE"),ue=$("#Crm_Tasks_RECURRING"),me=$("#Crm_Tasks_REMINDAT"),pe=$("#Crm_Tasks_STATUS"),ge=me.parent();if(!de||""==de.val()||de.data("readonly")||ue.data("readonly")||ue.prop("disabled",!1),ue.data()&&null!=ue.data().recdata&&(crmTasks.isRecurringSaved=!0),"true"==e.EditSeries&&ue.is(":checked")){crmTemplate.constructRecurringActivity(o,ue[0]);var he=$("#TasksrecurringDiv");he.addClass("sliderPop popClose").removeClass("popOpen").removeAttr("width"),he.addClass("pA zi31 popup_shadow").css("width","500px").hide(),crmTasks.createRecurringSummmary("commonModule"),crmTasks.recDataBefEdit=crmTasks.recurringSummaryText,"clone"!==window.Tasks.currentStatus&&(crmTasks.handleRecurChange(he.find("select")),crmTasks.handleRecurChange(he.find("input"))),$("#taskEndPart input").off("change.recurEdit")}$("#"+crmTemplate.getElemIdByColname("Tasks","REMINDAT")).is(":checked")&&(crmTemplate.showRemindAt(o,$("#"+crmTemplate.getElemIdByColname("Tasks","REMINDAT"))[0],!0),crmTasks.createReminderSummary("commonModule"),$("#RemindAtdiv").hide()),de&&de.data("readonly")&&ue.prop("disabled",!0),de.length?""==de.val()||Utils.compareDate(new Date,new Date(de.data("dateObj")))||ue.is(":checked")||(crmTasks.freezeReminder(),ge.off("mouseenter.duedateinpast"),ge.off("mouseleave.duedateinpast"),ge.on("mouseenter.duedateinpast",(function(){crmui.toolTip_show(this,"left",I18n.getMsg("crm.task.reminder.tooltip1"))})),ge.on("mouseleave.duedateinpast",(function(){crmui.toolTip_hide()}))):(ue.prop("disabled",!0),($("#Crm_Tasks_RemindAt_remTime_Radio").is(":checked")||ue.is(":checked"))&&me.prop("disabled",!0)),pe&&pe.val()==crmTasks.compDispVal&&!ue.is(":checked")&&(crmTasks.freezeReminder(),ge.off("mouseenter.duedateinpast"),ge.off("mouseleave.duedateinpast"),ge.on("mouseenter.duedateinpast",(function(){crmui.toolTip_show(this,"left",I18n.getMsg("crm.task.reminder.tooltip2"))})),ge.on("mouseleave.duedateinpast",(function(){crmui.toolTip_hide()}))),"clone"==window.Tasks.currentStatus&&Crm.userDetails.USER_ID!=$("#Crm_Tasks_SMOWNERID").data().id&&($(".Tasks_Notify_Owner").show(),$("#Crm_Tasks_SENDNOTIFICATION").data("ownerChngd",!0))}if(u){var ve=$(window).height()-d.find(".cvpadding").offset().top-d.find(".cvpadding").outerHeight()-d.find(".topband_graybg").outerHeight();isChatEnabled&&(ve-=26);var fe=$("#preHTMLContainer_"+o);fe.before('<div id="forEditViewScroll" class="pR oH"></div>'),$("#forEditViewScroll").append(fe).css("max-height",ve+"px"),thirdPartyUtils.bindPerfectScroll("#forEditViewScroll",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1});var Ce=document.querySelectorAll(".cruxcomponent"),ye=Ce.length;for(s=0;s<ye;s++){var be=Ce[s].querySelector("crm-user-wrapper");if(be){e=be.getData();var Ie=be.id;e.id=Ie,e.dataLabel=be.getAttribute("data-label"),e.dataColname=be.getAttribute("data-colname"),e.dataCustomfield=be.getAttribute("data-customfield"),e.dataField=be.getAttribute("data-field"),be.remove(),Lyte.Component.render("crm-user-wrapper",e,"#"+Ce[s].id)}}}"create"!==this.currentStatus&&"setup"!==this.currentStatus&&setTimeout((function(){$("#preHTMLContainer_"+this.moduleName).find("textarea.textField").each((function(){!function(e){var t=e.outerWidth(),r=$("<span>");r.attr({id:"span_tarea",class:"dIB newgraybtn"}).css({visiblity:"hidden","font-size":"1rem","overflow-y":"scroll","line-height":"18px"}),$("body").append(r);var a=$("#span_tarea");a.text(e.val()),a.css({width:t,"word-break":"break-word"});var o=18*parseInt(a.outerHeight()/18);o>361?(a.remove(),e.css({height:"360px"})):(o=0==o?18:o,e.css({height:o}),a.remove())}($(this))}))}),200),setTimeout((function(){crmTemplate.backUpFormVals("createEntityNewForm")}),200),$("#layoutDetails").length>0&&setTimeout((function(){thirdPartyUtils.bindSelect2("#layoutDetails, #zCampIntegLayout")}),50),this.renderSubformInSection(d,e),setTimeout((function(){crmTemplate.appendSubFrmSnOverLay()}),200),setTimeout((function(){thirdPartyUtils.bindSelect2(d.find(".newChosenSel select,.mlSelect select"))}),200),crmTemplate.bindFldTooltip(),Crm.userDetails.isAdjustFieldWidthEnabled&&$L(".subformTabl").each((function(){$L(this).find(".subFrmDateAndTimeFld").each((function(e,t){t.style.setProperty("min-width",t.style.minWidth,"important")}))})),"setup"!==this.currentStatus&&crmTemplate.contentLoaded(e,this.moduleName),crmTemplate.bindSubformScrollEvent();var Te=-1!==window.location.href.indexOf("portal");Crm.userDetails.isAdjustFieldWidthEnabled&&Te&&d.find(".subformTabl").each((function(){var e,t=0,r=$L(this),a=.6*r.closest(".subFrmTablWrapper")[0].offsetWidth;r.find("th").each((function(r,o){var i=Number($L(o).attr("data-width"));t+=i&&0!==i?Number($L(o).attr("data-width")):$L(o).width(),a<t&&($L(o).removeClass("sbmPinnedPreview"),e||(e=r))})),r.find("td.sbmPinnedPreview").each((function(t,r){r.cellIndex>=e&&$L(r).removeClass("sbmPinnedPreview")})),r.css("width",t)}))},renderSubformInSection:function(e,t,r,a){crmTemplate.canSetupFormulaDependencies=!0,crmTemplate.forSubformFormulaNewEpxTriggered=!1;for(var o=Object.keys(crmTemplate.subformContents).length,i=Crm.userDetails.SUBFORM_PERMISSIONS,n=0;n<o;n++){var s=crmTemplate.subformContents["subFormRender"+(n+1)],l=(s.subFormSectionId,s.subFormTable),c=s.subFormContent,d=s.subFormTabId,u=s.subFormCreateJSON,m=s.moduleName,p=s.subFormAggContent,g=s.layout,h=s.subFormSecData;if(i)for(var v,f=t[m].subforms&&t[m].subforms.section?t[m].subforms.section:[],C=f.length,y=0;y<C;y++)if(f[y].subFormTabId===d){v=f[y].profilePermissionMap;break}if(c.length>0){var b=$(l).find("tbody tr"),I=c.find(".subFrmTablWrapper");I.append(l);var T=$(l).find(".tableHeadBg .subFrmSnFld");T.length>0&&I.append("<div class='subFrmTablSerlNoOverlay' style='display: none;'><table cellpadding='0' cellspacing='0'><thead><tr class='tableHeadBg'><td class='subFrmSnFld textFld'>"+T.html()+"</td></tr></thead><tbody></tbody></table></div><div class='subFrmTablSerlNoheadOverlay' style='display: none;'><table cellpadding='0' cellspacing='0'><thead><tr class='tableHeadBg'><td class='subFrmSnFld textFld'>"+T.html()+"</td></tr></thead></table></div>"),r?this.setSizeAndCountForSubform(d,t[m]):this.setSizeAndCountForSubform(d,t[this.moduleName]);var w=b.length,E=$(l).data("data-max_rows"),k=$(l).data("data-show-bulkOption"),O="<a href='javascript:;' id='subFrmaddRowBtn' class='outlineprimaryflat newbutton mT20 fL subFrmaddRowBtn",S=I18n.getMsg("crm.label.subform.allowedlimit",E),R=$(l).data("data-type");if(Crm.userDetails.isStaticSubFormEnabled&&("static"===h.type||"static"===R||JSON.parse($(l).data("dataFields"))[0].static_field))c.find("#subFrmaddRowBtn").remove(),c.find(".subFrmAggTablWrapper").append(crmTemplate.createSubFormAggr(p,u,m,h,r));else if(!r&&k){var M='<div class="lyteClubbedButton mT20">';M+="<lyte-button lt-prop-appearance='primary' lt-prop-class='outlineprimary' id='subFrmaddRowBtn' class=' subFrmaddRowBtn";S=I18n.getMsg("crm.label.subform.allowedlimit",E);if(i&&v&&!v.create)M+="'lt-prop-disabled=true  onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+(_=I18n.getMsg("crm.sf.permission.no.create"))+"','sfrmLimitReached');\">",M+="'<template is='registerYield' yield-name='text'>"+I18n.getMsg("crm.label.subform.addrows")+"</template></lyte-button>",M+=" <lyte-button lt-prop-appearance='primary' id='bulk_subform' lt-prop-class='outlineprimary'",M+="lt-prop-disabled=true   onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+_+"','sfrmLimitReached');\">",M+="<template is='registerYield' yield-name=\"text\"> </template></lyte-button>",M+="</div>";else M+=w>=E?"'lt-prop-disabled=true  onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+S+"','sfrmLimitReached');\"":"'",M+="' onclick=\"crmTemplate.addSubFromRow(this, '"+d+"','"+m+"','"+g+"')\"><template is='registerYield' yield-name='text'>"+I18n.getMsg("crm.label.subform.addrows")+"</template></lyte-button>",M+=" <lyte-button lt-prop-appearance='primary' id='bulk_subform' lt-prop-class='outlineprimary'",M+=w>=E?"lt-prop-disabled=true   onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+S+"','sfrmLimitReached');\"":"'",M+=">",M+="<template is='registerYield' yield-name=\"text\"> </template></lyte-button>",M+="</div>",M+='<lyte-menu lt-prop-wrapper-class = "copyAddWrapper" lt-prop-yield = true lt-prop-event = \'click\' lt-prop-query = \'lyte-button#bulk_subform\'><template is = "registerYield" yield-name = "yield"><lyte-menu-body>',M+="<lyte-menu-item><lyte-menu-label>Add multiple rows</lyte-menu-label></lyte-menu-item></lyte-menu-body></template></lyte-menu>";c.find(".subFrmAggTablWrapper").append(M).append(crmTemplate.createSubFormAggr(p,u,m,h,r))}else if(i&&v&&!v.create){var _;O+=" subDisabledBtn' onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+(_=I18n.getMsg("crm.sf.permission.no.create"))+"','sfrmLimitReached');\" >"+I18n.getMsg("crm.label.subform.addrows")+"</a>",c.find(".subFrmAggTablWrapper").append(O).append(crmTemplate.createSubFormAggr(p,u,m,h,r))}else O+=w>=E?" subDisabledBtn' onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+S+"','sfrmLimitReached');\"":"'",O+="' onclick=\"crmTemplate.addSubFromRow(this, '"+d+"','"+m+"','"+g+"')\">"+I18n.getMsg("crm.label.subform.addrows")+"</a>",c.find(".subFrmAggTablWrapper").append(O).append(crmTemplate.createSubFormAggr(p,u,m,h,r));null==$(l).data("data-toolTip")?c.closest(".secContent").prev('[id^="secHead"]').find(".subformTooltip").css("display","none"):(c.closest(".secContent").prev('[id^="secHead"]').find(".subformTooltip").css("display","").attr("fldtooltip",$ESAPI.encoder().encodeForHTMLAttribute($(l).data("data-toolTip"))),crmTemplate.bindFldTooltip())}}crmTemplate.subformContents=[];var D=$(".aggTempClass");D.length>0&&D.each((function(){$(this).find(".subFrmAggTablWrapper").css({"max-width":$(this).find(".subFrmTablWrapper").width(),width:$(this).find(".subFrmTablWrapper table.subformTabl").width()}),$(this).removeClass("aggTempClass")}));$(".subFrmTablWrapper").each((function(){if($(this)[0].scrollWidth>$(this).width()){var e=$(this).find(".subformTabl").height(),t=$(this).closest(".subFrmLayout");t.addClass("pR").append('<div class="SubFrmScrolIn pA"></div>'),t.find(".SubFrmScrolIn").css("height",e)}})),$(".subformParentSection").on("mouseenter",(function(){$(".subformTabl").each((function(){var e=$(this).data("datasubformreorder"),t=$(this).find("tbody"),r=t.find("tr").length,a=$(this).closest(".subFrmLayout");"true"==e?(a.removeClass("reorderDisabled").addClass("reorderEnabled"),t.sortable({revert:!1,axis:"y",containment:$(this).closest(".subFrmLayout"),stop:function(e,t){var r=t.item.closest("table"),a=r.data("data-subformid"),o=r.data("data-parentmodule");crmTemplate.updateSubFormSerialNumber(o,a);var i=r.find("crm-entity-lookup");i.length>0&&i.remove()}}),1==r&&t.sortable("disable")):(a.removeClass("reorderEnabled").addClass("reorderDisabled"),a.find(".subFrmDragIconWrap").remove())})),$(".subformParentSection").off("mouseenter")})),Crm.isInventoryModule(m)&&"setup"!==this.currentStatus?($("#discountPop,#grandTaxPop,#taxPop").click((function(e){sE(e)})),productDetails.initSFLineItem(t,m,r,a)):productDetails.isInited=!1,crmTemplate.productLineItemSettings()},edit:function(e,t,r){crmCommonModule.currentStatus="edit",this.entityId=e,t.entityId=e,"Potentials"==this.moduleName&&r&&r.layoutId&&(t.triggerPipelineChange=!0),t&&void 0!==t.Appointments&&(crmCommonModule.moduleName="Appointments"),this.createTemplate(t)},clone:function(e,t){crmCommonModule.currentStatus="clone",t.module?crmCommonModule.moduleName=t.module:t.hasOwnProperty("Appointments")&&(crmCommonModule.moduleName="Appointments",Events.createSource=void 0),this.createTemplate(t)},showRelatedToOptions:function(e,t){var r=$("#Crm_"+this.moduleName+"_CONTACTID"),a=$("#Crm_"+this.moduleName+"_SEID"),o=a.data("lookupModule"),i=r.data("lookupModule"),n=$("#Crm_"+this.moduleName+"_SEID_label_select");if(n.prop("disabled",!1),$("#Crm_"+this.moduleName+"_SEID").prop("disabled",!1).data("mandate",$("#Crm_"+this.moduleName+"_SEID").data("defMandate")),$("#Crm_"+this.moduleName+"_SEID_img").show(),e){$("#errorMsg_Crm_"+this.moduleName+"_CONTACTID").remove(),r.removeClass("errorHighlight").css({"border-color":""});var s=$(e).val();r.data("lookupModule",s);var l=store.peekAll("module").filterBy({module_name:"Accounts"});if("Leads"==s)$("#Crm_"+this.moduleName+"_CONTACTID_img").data("lookupModule",s),crmTab.tabList.contains(s)||$("#Crm_"+this.moduleName+"CONTACTID_img").hide(),$("#Crm_"+this.moduleName+"_SEID_label_select").prop("disabled",!0),$("#Crm_"+this.moduleName+"_SEID").prop("disabled",!0).data("mandate",!1),$("#Crm_"+this.moduleName+"_SEID_img").hide(),t&&(r.val("").data("id","").data("displaylabel",I18n.getMsg("crm.module.name",[moduleRecordMapping[s].singular_label])),a.val("").data("id",""),l[0]&&l[0].visible&&Crm.moduleInfo&&Crm.moduleInfo.Accounts&&"true"===Crm.moduleInfo.Accounts.isVisible&&Crm.userDetails.MODULE_LIST.Accounts&&Crm.userDetails.MODULE_LIST.Accounts.viewable&&$("#Crm_"+this.moduleName+"_SEID_label_select").val("Accounts").trigger("change.select2")),Crm.userDetails.TaskPopup&&$("#Tasks_fldRow_SEID .labelValCreate").addClass("disableTaskPopEle");else if("Contacts"==s){if($("#Crm_"+this.moduleName+"_CONTACTID_img").data("lookupModule",s),crmTab.tabList.contains(s)||$("#Crm_"+this.moduleName+"CONTACTID_img").hide(),t&&r.val("").data("id","").data("displaylabel",I18n.getMsg("crm.module.name",[moduleRecordMapping[s].singular_label])),""===a.attr("data-lookup-module")&&l[0]&&l[0].visible)Crm.moduleInfo&&Crm.moduleInfo.Accounts&&"true"===Crm.moduleInfo.Accounts.isVisible&&Crm.userDetails.MODULE_LIST.Accounts&&Crm.userDetails.MODULE_LIST.Accounts.viewable&&$("#Crm_"+this.moduleName+"_SEID_label_select").val("Accounts");else{var c=a.attr("data-lookup-module");o=c,Crm.userDetails.MODULE_LIST[c]&&Crm.userDetails.MODULE_LIST[c].visible&&Crm.userDetails.MODULE_LIST[c].viewable?(n.val(c).trigger("change.select2"),a.val(a.attr("value"))):(n.prop("selectedIndex",0).trigger("change.select2"),a.val(""))}Crm.userDetails.TaskPopup&&$("#Tasks_fldRow_SEID .labelValCreate").removeClass("disableTaskPopEle")}thirdPartyUtils.bindSelect2("#Crm_"+this.moduleName+"_SEID_label_select"),thirdPartyUtils.bindSelect2("#Crm_"+this.moduleName+"_CONTACTID_WhoId_select")}if(t){if(r[0]){var d=r.data();i===e.value&&(r.val(d.oldValue),r.data("id",d.oldid))}if(a[0]){d=a.data();o===n.val()&&"Contacts"===s&&a.val(d.oldValue).data("id",d.oldid)}}},setSizeAndCountForSubform:function(e,t){for(var r=t.subforms.section.length,a=0;a<r;a++)if(e===t.subforms.section[a].subFormTabId)for(var o=t.subforms.section[a].FL.length,i=0;i<o;i++)for(var n=t.subforms.section[a].FL,s=n[i].length,l=0;l<s;l++)if("LINKINGMODULE_ID"!==n[i][l].colname&&"555"===n[i][l].uitype&&"clone"!==this.currentStatus){var c=n[i][l].fieldid;if(n[i][l].defaultvalue!==I18n.getMsg("crm.tpi.ctiapi.config.choosefile")&&n[i][l].defaultvalue){for(var d=0,u=0,m=n[i][l].defaultvalue.length,p=0;p<m;p++){var g=0,h=n[i][l].defaultvalue[p].file_Size.split(" ");"KB"===h[1]?g=1024*h[0]:"MB"===h[1]&&(g=1024*h[0]*1024);var v=n[i][l].defaultvalue[p].file_Id;void 0===v&&(v=n[i][l].defaultvalue[p].preview_Url),n[i][l].defaultvalue[p].file_Size&&(u+=parseInt(g),d++)}$("#attachCount_"+c+n[i][l].rowNum).val(d),$("#attachSize_"+c+n[i][l].rowNum).val(u)}}},updateCreateEditJson:function(e){var t=(e=$(e))&&e.attr("id")?e.attr("id").split("_"):"",r="defaultvalue",a="";if(t.length>1){var o=e.attr("id").split("_")[1],i=e.data();"checkbox"==e.attr("type")?a=e.prop("checked")?e.prop("checked")+"":"":t[3]&&"TimeOption"==t[3]?(r="timeVal",a=e.val()):a=e.val(),a||(a="");var n=i.colname;window[o]&&window[o].createEditJson&&window[o].createEditJson.entityMapJson&&window[o].createEditJson.entityMapJson[n]&&(window[o].createEditJson.entityMapJson[n][r]=a)}},renderWizardPreview:function(e,t,r,a){var o=moduleRecordMapping[e].id,i={};i.model=store.findRecord("module",o),Lyte.resolvePromises(i).then((function(o){var i=o.model[0],n=i.layouts?i.layouts:void 0,s={isWizard:!0,selectedLayoutid:t+";"+r},l={queryParams:{layoutId:t},dynamicParam:void 0},c={module:i.api_name,isWizard:!0,selectedLayoutid:t+";"+r},d=networkUtils.returnDependencyFiles(["zohocrm_wizard_record_create.js"],ResourceConstants.CRM);d=(d=d.concat(networkUtils.returnDependencyFiles(["crm-create-mixin.js","crm-create-mixin2.js","crm-create-fields.js","crm-create-resources.js","crm-create-pricingdetails.js","crm-create-helpers.js","crm-create-dependent-resources.js","crm-wizard-common-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-services-create-resources.js"],ResourceConstants.CRMClient));var u=networkUtils.returnDependencyFiles(["crm-create-resources-less.css","crm-create-dependent-resources-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);u=u.concat(networkUtils.returnDependencyFiles(["crm-create-dependent-resources.css"],ResourceConstants.CRMClient));var m=d.concat(u);Lyte.injectResources(m,void 0,(function(){var t=Lyte.registeredMixins["crm-create-mixin"].getCurrentLayoutDetails(n,s,i,l,c,!0,!0,a);Lyte.resolvePromises(t).then((function(t){Lyte.Component.render("crm-create-entity",t,"#preHTMLContainer_"+e),commonUtils.showHideLoadingDiv(!1);var r=$L(".wiz_loading");r&&r.hide()}))}))}))}},PremiumChat="object"!=typeof PremiumChat?{}:PremiumChat;PremiumChat.invokePremiumChat=function(e,t,r,a,o){FeedbackChat.checkSupport_WorkingDay().then((function(i){if(!i&&o)return renderingUtils.showCustomAlert(I18n.getMsg("crm.premiumsupport.not.supported.hour",RebrandLinkUtil.getProperty("SUPPORTMAILID")),"",!1),!1;if($zoho.salesiq.floatbutton.visible("hide"),t=t||Crm.userDetails.DISPLAY_NAME,r=r||Crm.userDetails.LOGIN_NAME,$zoho.salesiq.visitor.name(t),$zoho.salesiq.visitor.email(r),$zoho.salesiq.chat.agent(e),"Call"===a){if($zoho.salesiq.visitor.ongoingchat())return renderingUtils.showCustomAlert(I18n.getMsg("crm.premiumsupport.chat.ongoing"),"",!1),!1;$zoho.salesiq.call.start(),$zoho.salesiq.floatwindow.visible("show")}else"Chat"===a&&($zoho.salesiq.visitor.question(""),$zoho.salesiq.floatwindow.visible("show"),$zoho.salesiq.floatwindow.defaultview("Classic"))}))},PremiumChat.closeMailPop=function(){$("#feedBackForm").remove()},PremiumChat.addFile=function(e){var t=document.createElement("input"),r=document.getElementById("attach_desktop");t.setAttribute("type","file"),t.setAttribute("name","attachments"),t.setAttribute("id","fb_attachFile"),t.setAttribute("style","background: none; right: 0px; left: auto; top: 9px;"),t.setAttribute("class","smFile file0"),t.setAttribute("tabIndex","-1"),t.setAttribute("multiple","true"),t.onchange=function(){PremiumChat.addFile(this)},$(e).hide(),r.appendChild(t);var a=function(e){var t=$(this);$(e).remove(),t.parent(".noteFileName").remove(),PremiumChat.fileCount--,$("#attach_desktop").show(),PremiumChat.fileCount>0?($("#fbAttachFiles").addClass("hide"),$("#fbAttachMoreFiles").removeClass("hide")):($("#fbAttachFiles").removeClass("hide"),$("#fbAttachMoreFiles").addClass("hide"))};if(null!=document.getElementsByName("attachments")[0])for(var o=0;o<$(e).get(0).files.length;o++){var i=$(e).get(0).files[o].name,n=$("<div>",{class:"noteFileName oH crm-small-font-size"});null!=$(e).get(0).files[o]&&(fileSizeEx=$(e).get(0).files[o].size);if(0===fileSizeEx)return"0 Bytes";var s=parseInt(Math.floor(Math.log(fileSizeEx)/Math.log(1e3)),10);fileSize="- ("+(fileSizeEx/Math.pow(1e3,s)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][s]+")";var l=$("<span>",{class:"fL flNameSize crmBaseColor",html:$ESAPI.encoder().encodeForHTML(i)+" "+fileSize}),c=$("<span>",{class:"fL mL15 smalledit noteAttachedClose cP",text:I18n.getMsg("crm.label.remove")});c.click(a),n.append(l),n.append(c),$("#attachMoreFiles").append(n),PremiumChat.totalFileSize=PremiumChat.totalFileSize+fileSizeEx,PremiumChat.fileCount++}return document.getElementsByName("attachments").length-1>=4?(alert(I18n.getMsg("crm.info.attachment.limit")),c.click(),!1):PremiumChat.totalFileSize>10485760||fileSizeEx>10485760?(alert(I18n.getMsg("crm.attach.restriction.rellist")),c.click(),!1):void 0},PremiumChat.sendMail=function(){if(void 0===$("#ps_subject").val()||""===$("#ps_subject").val())return alert(I18n.getMsg("crm.support.subject.cannot.be.empty")),!1;var e=Crm.getCrmBasePath()+"/PremiumSupport.do?action=sendMail",t=new FormData;t.append("subject",$("#ps_subject").val()),t.append("summary",$("#ps_summary").val());for(var r=function(e,r){t.append("attachments",r)},a=document.getElementsByName("attachments"),o=0;o<a.length-1;o++)$.each(a[o].files,r);return t.append(csrfParamName,encodeURIComponent(csrfToken)),$("#feedBackForm").remove(),$.ajax({type:"POST",url:e,processData:!1,contentType:!1,data:t,success:function(){crmui.showMsgBand("success",I18n.getMsg("crm.email.mail.sent.msg"),3e3)}}),!1};var FeedbackChat={loadChat:function(e,t){FeedbackChat.checkSupport_WorkingDay().then((function(r){if(!r)return renderingUtils.showCustomAlert(I18n.getMsg("crm.chat.not.supported.hour",RebrandLinkUtil.getProperty("SUPPORTMAILID")),"",!1),!1;e?FeedbackChat.isChatAvailable().then((function(e){if(!e)return Lyte.Component.render("crm-chat-outoftime-error",{show:!0,isAdminProfileUser:t},"body"),!1;FeedbackChat.loadChatAfterTimeCheck()}),(function(){FeedbackChat.loadChatAfterTimeCheck()})):FeedbackChat.loadChatAfterTimeCheck()}),(function(){var e=new Error("Error occurred while loading chat with us");murphy.error(e)}))},loadChatAfterTimeCheck:function(){try{$zoho.salesiq.visitor.name(Crm.userDetails.DISPLAY_NAME),$zoho.salesiq.visitor.email(Crm.userDetails.LOGIN_NAME),$zoho.salesiq.floatwindow.visible("show"),murphy.error(new Error("Chat with us float window's visible is set as show"))}catch(e){throw showAnimatePopup("live_unavail_alert_popup"),e}},setVisitorInfo:function(e){if($zoho.salesiq.visitor){var t=$zoho.salesiq.visitor.info();t.feature=e,$zoho.salesiq.visitor.info(t)}},getDaysInNumber:function(e){let t={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},r="";return e.forEach((function(e){r+=t[e]+","})),r=r.substring(0,r.length-1),r},checkSupport_WorkingDay:function(){let e=RebrandLinkUtil.getProperty("LIVECHAT_WEEKLY_START_TIME"),t=RebrandLinkUtil.getProperty("LIVECHAT_WEEKLY_END_TIME"),r=RebrandLinkUtil.getProperty("LIVECHAT_SUPPORTED_DAYS");return FeedbackChat.checkAndLoadTimingDetails().then((function(){return Crm.timingCheckNeeded&&Crm.ChatSupportTiming&&Crm.ChatSupportTiming.working_days&&Crm.ChatSupportTiming.working_days.days&&(e=Crm.ChatSupportTiming.working_days.from,t=Crm.ChatSupportTiming.working_days.to,r=Crm.ChatSupportTiming.working_days.days),Promise.resolve(FeedbackChat.checkSupport_fromInput(e,t,r))}))},checkSupport_fromInput:function(e,t,r){var a=e.split(":"),o=t.split(":"),i=parseInt(a[0]),n=parseInt(a[1]),s=parseInt(o[0]),l=parseInt(o[1]),c=RebrandLinkUtil.getProperty("DeploymentLocation"),d=!1;null!=c&&"China"==c&&(d=!0);var u=d?-8:-5.5,m=$L.moment().toDate(),p=m.getTime()+6e4*m.getTimezoneOffset(),g=$L.moment(p-36e5*u).toDate(),h=r.split(","),v=parseInt(h[0]),f=parseInt(h[h.length-1]),C=g.getDay();if(!h.contains(C))return!1;var y=g.getHours(),b=g.getMinutes(),I=Crm.userDetails.COUNTRY_LOCALE?Crm.userDetails.COUNTRY_LOCALE.substr(3):null;if(d)return y>=i&&y<=s&&(y<17||y==s&&b<=l);if(["AE","YE","SY","BH","ALGR","EG","IR","IQ","IL","JO","KU","LB","OM","PS","QA","SA","SO","SU"].contains(I))return!0;switch(C){case v:return y>=i&&!(y==i&&b<n);case f:return y<=s&&!(y==s&&b>l);default:return!0}},checkAndLoadTimingDetails:function(){return Crm.timingCheckNeeded?Crm.ChatSupportTiming&&(Crm.ChatSupportTiming.working_days||Crm.ChatSupportTiming.isLoaded)?Promise.resolve(!0):FeedbackChat.loadTimingDetails().then((function(){return Promise.resolve(!0)})):Promise.resolve(!1)},isChatAvailable:function(){return 1!=Crm.userDetails.SUPPORT_TIMING_CHECK_ENABLE?Promise.resolve(!0):Crm.ChatSupportTiming&&(Crm.ChatSupportTiming.from||Crm.ChatSupportTiming.isLoaded)?Promise.resolve(FeedbackChat.timeCheck()):FeedbackChat.loadTimingDetails().then((function(){return Promise.resolve(FeedbackChat.timeCheck())}))},timeCheck:function(){if(!Crm.ChatSupportTiming||!Crm.ChatSupportTiming.from)return!0;let e=Crm.ChatSupportTiming.from.split(":"),t=Crm.ChatSupportTiming.to.split(":"),r=parseInt(e[0]),a=parseInt(e[1]),o=parseInt(t[0]),i=parseInt(t[1]),n=$L.moment().toDate(),s=n.getUTCHours(),l=n.getUTCMinutes();if(r>o||r==o&&a>i){if((r>s||r==s&&a>l)&&(s>o||s==o&&l>i))return!1}else if(r>s||r==s&&a>l||s>o||s==o&&l>i)return!1;return!0},loadTimingDetails:function(){var e={url:"crm/v2.2/__internal/users/actions/support_chat_availability_timing",method:"GET",contentType:"application/json"};return store.findAll("dummy",null,!1,!1,e).then((function(e){return Crm.ChatSupportTiming=e.support_chat_availability_timing[0],Crm.ChatSupportTiming.isLoaded=!0,Crm.ChatSupportTiming.working_days&&Crm.ChatSupportTiming.working_days.days&&(Crm.ChatSupportTiming.working_days.days=FeedbackChat.getDaysInNumber(Crm.ChatSupportTiming.working_days.days)),delete Crm.ChatSupportTiming.user,e}),(function(e){return Crm.ChatSupportTiming={isLoaded:!0},e}))},enableTracking:function(){"IN"==RebrandLinkUtil.getProperty("DeploymentLocation")&&Crm.timingCheckNeeded&&$zoho.salesiq.tracking.on()},pathTracking:function(e){"IN"==RebrandLinkUtil.getProperty("DeploymentLocation")&&Crm.timingCheckNeeded&&$zoho.salesiq&&$zoho.salesiq.visitor&&$zoho.salesiq.visitor.customaction(e)}},Territory={};Territory.territoryAction=Crm.getCrmBasePath()+"/TerritoryConfig.do?action=",Territory.forcastAction=Crm.getCrmBasePath()+"/TerritoryForecast.do?action=",Territory.rolefcAction=Crm.getCrmBasePath()+"/RoleForecast.do?action=",Territory.deleteInfo={},Territory.currentInfo={},Territory.terrNameRegex=/[^~`#%^&*()+={}[\]|\;",'!<>\\]/g,Territory.editMode=!1,Territory.isValidated=!1,Territory.territoryUserIds,Territory.delForecastDet,Territory.csrf=function(){return csrfParamName+"="+encodeURIComponent(csrfToken)},Territory.init=function(){Territory.templates={userTemplStr:"{{#each this}}<tr><td width='60%'>{{NAME}}</td><td><input type='text' pre-data='' cur-data=''  id='userTarget_{{USERID}}' class='inputTxtBox fL mT5 w120' maxlength='15' value='' /><span onclick='Territory.showPreviousTarget(this, event);' class='iconInfo mL8 mT10 fromTemp vaM'></span></td></tr>{{/each}}",territoryTemplStr:"<li class='bg_crmBg2 p0 dIB pR5 mR5 mT5' id='li{{TERRITORYID}}' title='{{NAME}}'><label class='pR5 pB5 mT5 pL10 fL crmNotFoundColor'>{{NAME}}</label><a class='dbBtnClose fL mT5' href='javascript:;' onclick=\"Territory.deleteTerritoriesFromCriteria('{{TERRITORYID}}')\" ><span alt='' class='dbBtnCloseBorder dIB vaM ico-close-small svgIcons'></span></a></li>"},Territory.usersTemplate=Handlebars.compile(Territory.templates.userTemplStr),Territory.terrTemplate=Handlebars.compile(Territory.templates.territoryTemplStr)},Territory.hideDiv=function(){var e=this.rolefcAction+"updateToHide";mR(e,(function(e){"false"!=e&&($("#activationInfo").hide(),$("#newFcLink").show())}))},Territory.compareOldValues=function(e,t){var r,a=$("#oldDuration").val(),o=$("#oldFiscal").val(),i=$("#oldFieldId").val(),n=$("#displayMode").val(),s=e.value,l=t.value,c=$("#fiscalStart").val(),d=$("input:radio[name=fYDisplay]:checked").val();return(a!=s||o!=c||i!=l||n!=d)&&(r=!0),1==a&&1==s&&i==l&&(r=!1),r},Territory.checkChangeInRole=function(){var e=$("#oldRoleId").val(),t=$("#roleId").val(),r=getElemById("removeUser");if(e!=t&&r){if("block"!=r.style.display)return Territory.showTerritoryPopup("removeUser"),!1;var a=$('select[id="changedManagerId"]').val();$('input[name="changedManagerId"]').val(a)}return!0},Territory.setUserTerritoryIds=function(){var e="";if(getElemById("territoryLookup")){var t=getElemById("userTerritoryIds").value,r=getElemById("managedids").value,a=(r=(r=r.trim()).substr(0,r.length)).split(","),o=[];$("#territoryLookup input:checked").each((function(){var e=this.id;e=e.replace("check",""),o.push(e)}));for(var i=0;i<a.length;i++)-1==o.indexOf(a[i])&&o.push(a[i]);var n=(t=t.trim()).length>0?t.length-1:0;t.lastIndexOf(",")<n&&(n+=1);for(var s=(t=t.substr(0,n)).split(","),l=0;l<s.length;l++)""!=s[l]&&-1==o.indexOf(s[l])&&-1==a.indexOf(s[l])&&(e+=s[l]+",");$("#removedTerritories").val(e),this.territoryUserIds=o.join(",")}},Territory.checkUserTerritory=function(){var e=getElemById("removeUser");if(e&&"block"==e.style.display)return this.isValidated=!0,$("#userTerritoryIds").val(Territory.territoryUserIds),this.setRemoveUserValues(","),!0;this.setUserTerritoryIds();var t=$("#removedTerritories").val();return null==t||""==t||this.isValidated?(this.isValidated=!0,Territory.territoryUserIds&&($("#userTerritoryIds").val(Territory.territoryUserIds),Territory.territoryUserIds=void 0),!0):(this.isValidated=!0,!1)},Territory.territoryList=function(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.old-territories.old-index-territories")},Territory.newTerritory=function(e){var t={};null!=e&&""!=e&&(t.parentId=encodeURIComponent(e)),Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.old-territories.old-create-territory",t)},Territory.editTerritory=function(e){Lyte.Router.transitionTo({route:"crm.settings.section.old-territories.old-edit-territory",dynamicParams:[e]})},Territory.showDeletePopup=function(e,t){this.deleteInfo.name=t,this.deleteInfo.id=e;var r=$("#li_"+e+" li");if($("#showDeleteName").text(t),delete this.deleteInfo.terrNames[e],0==r.length)$("#withoutTransfer").show(),$("#transfer, #withTransfer").hide(),$("#transferbut").val(I18n.getMsg("crm.button.deleteterritory"));else{$("#withoutTransfer").hide(),$("#transfer,#withTransfer").show(),$("#transferbut").val(I18n.getMsg("crm.button.transfer.and.delete.territory")),this.deleteInfo.newObject=$.extend(!0,{},this.deleteInfo.terrNames);for(var a=0;a<r.length;a++){var o=r[a].id.replace("li_","");delete this.deleteInfo.terrNames[o]}this.setTerritoryNamesAsOption()}this.showTerritoryPopup("deletePopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))},Territory.cancelDelTerritory=function(e){"none"==$("#withoutTransfer").css("display")&&(this.deleteInfo.terrNames=this.deleteInfo.newObject),this.cancelTerritoryPopup(e)},Territory.setTerritoryNamesAsOption=function(){var e=this.deleteInfo.terrNames.sortedList,t=document.createElement("option"),r=$("#transferTo");$("#transferTo option[value=none]").nextAll().remove();for(var a=0;a<e.length;a++){var o=e[a],i=this.deleteInfo.terrNames[o];null!=i&&r.append($(t).clone().attr({value:o}).html(i.nameToDisplay))}},Territory.canBeDeleted=function(){var e=getElemById("transferTo");if(e&&"none"==$("#withoutTransfer").css("display")&&"none"==e.value)return e.focus(),alert(I18n.getMsg("crm.territory.choose.transferto")),!1;if("none"!==e.value)Territory.deleteTerritory(e);else{var t=this.deleteInfo.id,r=this.deleteInfo.name,a=[I18n.getMsg("Territory"),$ESAPI.encoder().encodeForHTML(r)];$("#deleteSubIdPopUpHd").html(I18n.getMsg("crm.label.delete.role.group.msg",a)),deleteUserCheck(t,"delete",void 0,!0)}},Territory.deleteTerritory=function(){var e,t=getElemById("transferTo"),r=this.territoryAction+"deleteTerritory";e=!newForecastsEnabled&&$("#deleteForecast").prop("checked");var a="territoryId="+this.deleteInfo.id+"&deletedName="+encodeURIComponent(this.deleteInfo.name)+"&"+this.csrf()+"&deleteForecast="+e;t&&"none"!=t.value&&(a+="&transferTo="+t.value),this.cancelDelTerritory("deletePopup"),mR(r,(function(e){if("Transfer to is not allowed"==trimBoth(e))_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.territory.access.denied"),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok")}]},accept:function(){Lyte.Router.getRouteInstance().refresh()}});else if("false"==trimBoth(e))alert("unable to process the request");else{if("DELETED"==trimBoth(e)){var t=$("#li_"+Territory.deleteInfo.id);t.hasClass("listHierarchy")&&t.prev().addClass("listHierarchy"),t.remove()}else{var r=getElemById("result");$(r).empty(),r.innerHTML=e,EvalInnerScript(r)}var a=Territory.deleteInfo.name+"  "+I18n.getMsg("crm.territory.delete.success.msg");crmui.showMsgBand("success",a,2e3,""),Crm.userDetails.TERRITORY_COUNT_BASED_USER-=1}}),a)},Territory.disableTerritory=function(){var e=this.territoryAction+"disable";this.doUpdateForm("result",this.csrf(),!1,!1,e),this.cancelTerritoryPopup("disable"),$("#sub_assignTerritory, #sub_territoryRules").css("display","none")},Territory.defineOrEnableTerritory=function(e,t){var r=e?"enableTerritory":"defineTerritories",a=this.territoryAction+r;doAjaxUpdate("result",a,this.csrf()),t&&"resume"==$(t).attr("data-id")&&($("#sub_assignTerritory, #sub_territoryRules").css("display","block"),$("#assign").show(),$("#rules").show()),Crm.userDetails.TMENABLED=1},Territory.createTerritoryHierarchy=function(e,t){this.cancelTerritoryPopup("Activation"),$(t).prop("disabled",!0);var r=this.territoryAction+"createHierarchy",a="mode="+e+"&"+this.csrf();doAjaxUpdate("result",r,a),$("#sub_assignTerritory, #sub_territoryRules").css("display","block"),$("#assign").show(),$("#rules").show()},Territory.redirectToTerritoryAssignMent=function(e,t){if(void 0===e&&(e=getElemById("parentId").value),getElemById("module"))t=getElemById("module").value;this.cancelTerritoryPopup("redirect");var r={actiontype:"territoryassignment",filter:"territory",territoryids:e,module:t};1!==e&&(r.includechild=1),Lyte.Router.transitionTo({route:"crm.settings.section.old-territory-assign"}).data=r},Territory.changeModule=function(e){var t=Crm.getCrmBasePath()+"/TerritoryAssignment.do?actiontype=search",r="module="+e;this.doUpdateForm("result",r,!0,!1,t)},Territory.togglePotentialRule=function(){var e=$("#potentialRule");"block"===e.css("display")?(e.slideUp(),$("#potArrow").addClass("upArrow").removeClass("downArrow"),setTimeout((function(){e.stop(!0,!0).hide()}),400)):(e.slideDown(),$("#potArrow").addClass("downArrow").removeClass("upArrow"),setTimeout((function(){e.stop(!0,!0).show()}),400))},Territory.toggleTerritory=function(e){var t=$("#div"+e),r=$("#img_"+e);"block"==t.css("display")?(t.slideUp(500),setTimeout((function(){t.stop(!0,!0).hide()}),400),r.removeClass("expand2").addClass("collapse2")):(t.slideDown(500),setTimeout((function(){t.stop(!0,!0).show()}),400),r.removeClass("collapse2").addClass("expand2"))},Territory.expandAllTerritories=function(){for(var e=$("#parentId").val(),t=$("#div"+e),r=$("#div"+e+" div"),a=0;a<r.length;a++){var o=r[a].id;o=o.replace("div","");var i=$("#div"+o).slideDown(500);setTimeout((function(){i.stop(!0,!0).show()}),400),$("#img_"+o).removeClass("collapse2").addClass("expand2")}t.slideDown(500),setTimeout((function(){t.stop(!0,!0).show()}),400),$("#img_"+e).removeClass("collapse2").addClass("expand2")},Territory.collapseAllTerritories=function(){for(var e=$("#parentId").val(),t=$("#div"+e),r=$("#div"+e+" div"),a=0;a<r.length;a++){var o=r[a].id;o=o.replace("div","");var i=$("#div"+o).slideUp(500);setTimeout((function(){i.stop(!0,!0).hide()}),400),$("#img_"+o).removeClass("expand2").addClass("collapse2")}t.slideUp(500),setTimeout((function(){t.stop(!0,!0).hide()}),400),$("#img_"+e).removeClass("expand2").addClass("collapse2")},Territory.editParent=function(){var e=$("#parentTerritory").text();this.editMode=!0;var t="<input type='text' id='textbox_parent' onkeydown=\"handleButton('save',event)\" maxlength='50' value='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' class='inputTxtBox mT5'>";t+="<input type='button' id='save' value='"+I18n.getMsg("Save")+"' class='saveLink' onclick='Territory.saveParent()'>",t+="<input type='button' id='cancel' value='"+I18n.getMsg("Cancel")+"' class='saveLink' onclick='Territory.cancelParent()'>",$("#parent").html(t),$("#parentTerritory").hide()},Territory.cancelParent=function(){var e=$("#old_parent").val();$("#parentTerritory").show().text(e),$("#parent").html(""),this.editMode=!1},Territory.showTerritorySettings=function(){var e=$("#forecastSettings"),t=$("#slidePopUp");e.css("display","block"),e.height(t[0].scrollHeight),$("#innerSlideWrapper").height(t[0].scrollHeight)},Territory.showEnable=function(){var e=$("#oldPotAssignment").val();if(0!==(e=parseInt(e))){var t,r,a,o=$("#enableT");$("#slidePopUp").animate({left:"-570px"}),o.animate({left:"0px"});var i=[];i.push(moduleRecordMapping.Potentials.singular_label),i.push(moduleRecordMapping.Potentials.plural_label),1===e?(t=I18n.getMsg("crm.territory.label.disable.rule",I18n.getMsg(i)),r=I18n.getMsg("crm.territory.note.disable.rule",I18n.getMsg(i)),a=I18n.getMsg("crm.button.understand.disable.now")):(t=I18n.getMsg("crm.territory.label.reenable.rule",I18n.getMsg(i)),r=I18n.getMsg("crm.territory.note.reenable.rule",I18n.getMsg(i)),a=I18n.getMsg("crm.button.yes.understand")),renderingUtils.freezeBackground(),$("#FreezeLayer").css("opacity",".1"),renderingUtils.ShakeDivInfreeze("forecastSettings","up",20,100),$("#reenable").text(t),$("#reenablenote").text(r),$("#butValue").val(a),$("#forecastSettings,#innerSlideWrapper").height(o[0].scrollHeight)}else Territory.updateTerritorySettings()},Territory.cancelEnable=function(){var e=$("#slidePopUp");$("#enableT").animate({left:"937px"}),e.animate({left:"0px"}),$("#forecastSettings,#innerSlideWrapper").height(e[0].scrollHeight),renderingUtils.removeFreezeLayer()},Territory.updateTerritorySettings=function(){var e=$("#oldPotAssignment").val(),t=1===(e=parseInt(e))?2:1;if(t!==e){var r=this.territoryAction+"updatePotRuleSettings",a={};a.potRule=t,a.crmcsrfparam=encodeURIComponent(csrfToken),mR(r,(function(e){if("false"===trimBoth(e))alert("unable to process the request");else{$("#oldPotAssignment").val(t);var r,a=$("#spanValue"),o=[];o.push(moduleRecordMapping.Potentials.singular_label),1===t?(a.text(I18n.getMsg("crm.label.enabled")),a.next("a").text(I18n.getMsg("crm.button.disable")),r=I18n.getMsg("crm.territory.success.msg.enable.rule",I18n.getMsg(o))):(a.text(I18n.getMsg("Disabled")),a.next("a").text(I18n.getMsg("crm.button.enable")),r=I18n.getMsg("crm.territory.success.msg.disable.rule",I18n.getMsg(o))),crmui.showMsgBand("success",r,4e3,"")}}),a)}this.cancelEnable(),$("#forecastSettings,#innerSlideWrapper").height($("#slidePopUp")[0].scrollHeight),$("#forecastSettings").hide()},Territory.checkTerritoryname=function(e,t){var r=e.value,a=getClrTxtPtnResChars(r,this.terrNameRegex).join(", ");if(""!=a){var o=[];return o.push(t),o.push(a),a.length,alert(I18n.getMsg("crm.clearTextPattern.validationFail.alert",I18n.getMsg(o))),e.focus(),!1}return""!=trimBoth(r)||(renderingUtils.displayErrorDiv("territoryName",t,"crm.field.empty.check"),e.focus(),!1)},Territory.saveParent=function(){var e=$("#old_parent").val(),t=getElemById("textbox_parent"),r=trimBoth(t.value);if(e!=r){var a=getElemById("parentId").value;if(!this.checkTerritoryname(t,I18n.getMsg("crm.label.territory.name")))return!1;var o=this.territoryAction+"updateParent",i="territoryId="+a+"&territoryName="+r+"&"+this.csrf();mR(o,(function(e){"false"==trimBoth(e)?alert("unable to process the request"):($("#parentTerritory").show().text(r),$("#parent").html(""),$("#old_parent").val(r))}),i),this.editMode=!1}else this.cancelParent()},Territory.doUpdateForm=function(e,t,r,a,o,i,n,s,l){var c="";null!=o?c=t:(o=getAttr(t,"action"),c=commonUtils.formData2QueryString(t)),void 0!==l&&(c+="&hierarchyDetails="+encodeURIComponent(JSON.stringify(l)));var d=getElemById(e);i&&(c+="&criteria="+encodeURIComponent(JSON.stringify(i))),void 0!==n&&n&&(c+="&potcriteria="+encodeURIComponent(JSON.stringify(n))),s&&(c+="&leadcriteria="+encodeURIComponent(JSON.stringify(s))),null!=r&&1==r&&(c+="&"+this.csrf());var u=t&&t.name?t.name:"",m=t&&t.territoryId?t.territoryId.value:"";mR(o,(function(e){var t=e.split("###")[0].trim(),r=e.split("###")[1];if("AssignCriteria"===u&&"NO_CHANGE"!==t){var i=JSON.parse(e),n=i.CriteriaString,s=$("#li_"+m);s.find(".terroritoryRulesDropdown").eq(0).show().html(n),s.find(".terplace").eq(0).addClass("crm-font-bold");var l=$("#mo"+m);if(0===n.length)s.find(".terroritoryRulesDropdown").eq(0).hide(),l.html(""),l.append("<a class='fblink mT10 fL mL20' style='color: #6d99c6;' href='javascript:void(0);' onclick=\"Territory.assignRule('"+m+"', 'assign',this)\">"+I18n.getMsg("crm.territory.assign.rule")+"</a>");else if(l.length>0)l.find(".fblink").eq(0).text(I18n.getMsg("crm.territory.hide.rule"));else if(0==l.length){var c=s.find(".terplace").eq(0);c.next("a").remove(),c.after("<span class='pL10 fL' id='mo"+m+"' style='visibility:hidden'><a class='fblink mT10 fL mL20' style='color: #6d99c6;' href='javascript:void(0);' onclick='Territory.showOrHideTerritoryRule(this)'>"+I18n.getMsg("crm.territory.hide.rule")+"</a><a class='fblink mT10 fL lh35 mL20' style='color: #6d99c6;' href='javascript:void(0);' data-params='{\"isLAEnabled\" : "+$("#isLAEnabled").val()+"}' data-cid='editTerrRule' onclick=\"Territory.assignRule('"+m+"', 'edit', this)\">"+I18n.getMsg("crm.territory.edit.rule")+"</a></span>")}if(i.accCrtChanged||i.potCrtChanged||i.leadCrtChanged){var p=i.module;getElemById("parentId").value=i.territoryId,getElemById("module").value=p,$("#redirectMsg").empty(),getElemById("redirectMsg").innerHTML=I18n.getMsg("crm.territory.msg.changed.rule",I18n.getMsg(moduleRecordMapping[p].plural_label)),getElemById("redirectBut").value=I18n.getMsg("crm.button.runrules",I18n.getMsg(moduleRecordMapping[p].plural_label)),Territory.showTerritoryPopup("redirect")}}else if("NO_CHANGE"===t)a=!1;else if(e.indexOf("ALREADY_EXSISTS_ERROR")>=0){var g=e.split("###");getElemById("errorMsg");$("#territoryName").length>0?renderingUtils.displayErrorDiv("territoryName","crm.label.parent.territory",g[1]):$("#roleName").length>0&&renderingUtils.displayErrorDiv("roleName","crm.security.role.name",g[1]),a=!0}else if(e.indexOf("REPORTSTO_ROLE_DELETED")>=0){g=e.split("###"),getElemById("errorMsg");$("#reportsTo").length>0&&renderingUtils.displayErrorDiv("reportsTo","crm.security.role.reportsTo",g[1]),a=!0}else{if("REACHED_MAX_LIMIT"===t)return renderingUtils.showCustomAlert(I18n.getMsg("crm.territory.alert.add",r)),!1;if(e.indexOf("REACHED_MAX_USER_LIMIT")>=0){g=e.split("###");return renderingUtils.showCustomAlert(I18n.getMsg("crm.territory.alert.add.users",g[1])),!1}if("SHOW_NO_RECORDS_ALERT"===t)$("#advancedsearchArrowN").addClass("nextDisabled"),alert(I18n.getMsg("crm.new.label.no.records"));else{if(e.indexOf("TERRITORY_NOT_FOUND")>=0)return renderingUtils.showCustomAlert(I18n.getMsg("crm.territories.delete.territories")),!1;if(e.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>=0)return renderingUtils.showCustomAlert(I18n.getMsg("crm.forecast.encryption.error.msg")),$("#custom_alert_button").prop("disabled",!1),!1;if("false"===t)alert("unable to process the request");else if(e.indexOf("misMatchType")>0){var h=JSON.parse(e);networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js",networkUtils.getI18nJSUrl("reportingtopopup")],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change);var e=$("#roleChangePopUp");e.length>0&&e.remove(),$("#show").append(Handlebars.templates.role_branch_change(h));var t=$("#roleDD"),r=[];t.children().each((function(){var e=$(this).val();r.contains(e)?$(this).remove():r.push(e)})),showAnimatePopup("roleChangePopUp"),userSelect(),t.trigger("change"),$("#subOrdinateList").hide()}))}else{$(d).empty(),d.innerHTML=e,EvalInnerScript(d),"create"===o.substring(o.lastIndexOf("=")+1,o.length)&&(Crm.userDetails.TERRITORY_COUNT_BASED_USER+=1);var v=$(d);if(("createRole"===u||"editRoleForm"===u)&&v.find("#roleid").length>0&&null!=v.find("#roleid").val()&&""!==v.find("#roleid").val()&&"null"!==v.find("#roleid").val())Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.view-role",v.find("#roleid").val()).data={data:e}}}}null!=a&&1==a&&(0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$L("#basic").scrollTo({axis:"y",duration:1e3,offset:-50}));"TerritoryForm"===u&&-1==e.indexOf("ALREADY_EXSISTS_ERROR")&&(Lyte.Router.transitionTo({route:"crm.settings.section.old-territories.old-index-territories"}).cachedResponse=$(d).html()),o.indexOf("disable")>-1&&(Crm.userDetails.TMENABLED=2)}),c)},Territory.setTerritoryCV=function(e,t){t=null==t?0:t;var r,a={module:crmListView.getObject().module,cvid:crmListView.getObject().cvId},o=crmListView.getObject().searchletter;a.territoryId=e,1==t&&(r=!0),a.updateCV=!0,a.webTab="false",a[csrfParamName]=csrfToken,o&&"All"!=o&&(a.searchletter=o),a.clearCache=!0;var i=Lyte.Router.getRouteInstance().transition.info.route;Lyte.Router.transitionTo({route:i,dynamicParams:[a.module,a.cvid,crmListView.getObject().viewid],queryParams:{territory_id:e,include_child:r}}).data=a},Territory.territoryLookUp=function(e,t,r,a){var o="";if("assignTerritory"==e){var i=$("#id").val();null!=i&&(o="&seId="+i+"&module="+$("#module").val())}var n=this.territoryAction+"territoryLookup&operation="+e+"&hideParent="+t+"&fieldname="+r+"&fieldid="+a+o;mR(n,(function(e){var t=$("<div>");t.html(e),t.find("br").remove(),$("#topBandPopup").html(t),$("#FLEEMsgError").length&&t.addClass("bg_white p20"),renderingUtils.freezeBackground(),showAnimatePopup("topBandPopup")}))},Territory.hideMouseOver=function(e,t){var r=$("#leadRuleSelect");r.is(":visible")&&e==r.data("territoryId")||(jQuery("#mo"+e).css("visibility","hidden"),t&&((t=$(t)).removeClass("hover"),t.find("span").eq(0).removeClass("crmLinkColor cP")))},Territory.showParentRules=function(){var e=this.territoryAction+"viewParent",t=getElemById("parentId").value;mR(e,(function(e){$("#topBandPopup").html(e),showAnimatePopup("topBandPopup")}),"parentId="+t)},Territory.assignRule=function(e,t,r){var a=this.territoryAction+"assignRule";r=$(r);void 0===e&&(e=r.data("territoryId"));var o="territoryId="+e+"&mode="+encodeURIComponent(t);if("editTerrRule"==r.data("cid")&&JSON.parse(r.attr("data-params")).isLAEnabled){var i=r.offset().top,n=r.offset().left;return $("#leadRuleSelect").data("territoryId",e),$("#accRuleSelect").data("territoryId",e),void $(".settingsDropDownPopup").css({top:i+30,left:n}).show()}mR(a,(function(t){$("#assignrulediv").empty(),$("#assignrulediv")[0].innerHTML=t,crmui.showPopup("assignrulediv",!0),$("#editTerritoryRuleSelect").hide(),$("#mo"+e).css("visibility","hidden"),"leadRuleSelect"===r.data("cid")?($("#accountRuleAssign").hide(),$("#potRuleAssign").hide()):$("#leadRuleAssign").hide(),EvalInnerScript(getElemById("assignrulediv"))}),o)},Territory.assignTerritory=function(e,t,r,a){renderingUtils.removeFreezeLayer();var o="",i=$("#module").val(),n=$("#id").val(),s=$("#entityName").val(),l=this.territoryAction+"manualAdd",c="seId="+encodeURIComponent(n)+"&territoryId="+e+"&territoryName="+encodeURIComponent(t)+"&entityname="+encodeURIComponent(s)+"&module="+i+"&"+this.csrf();if("canvas"===Lyte.Router.getRouteInstance().routeName){var d={data:{Territories:[{id:e}]}};store.peekRecord(moduleRecordMapping[i].id,n).$.triggerAction("assign_territories",{type:"POST"},!1,!1,d).then((function(e){store.findRecord(moduleRecordMapping[i].id,n,{approved:"both"}).then((function(e){e[0]&&Lyte.triggerEvent("update_territories",e[0].Territories?e[0].Territories:e[0].Territory?e[0].Territory:void 0)}))}))}else crmTab.deleteFromCache(i),mR(l,(function(e){var t=e.split("###");if("false"!==t){$("#"+a).append(t[1]);var n=$("#"+r);""!=n.text()?(o=$ESAPI.encoder().encodeForHTML(n.text())+", "+$ESAPI.encoder().encodeForHTML(t[0]),n.html(o)):n.html($ESAPI.encoder().encodeForHTML(t[0]));var s=$("#seTerritoryCount").val();s=parseInt(s)+1,("Potentials"==i&&""!=e||s>=Crm.userDetails.TERRITORIES_PER_RECORD)&&$(".show-panel").hide(),$("#seTerritoryCount").val(s),refreshFollowDiv()}}),c),getElemById("seterritories").style.display="";this.cancelTerritoryPopup("topBandPopup")},Territory.removeManually=function(e){var t=$("#id").val(),r=$("#module").val(),a=$("#entityName").val(),o=this.territoryAction+"manualDelete",i="territoryId="+e+"&seId="+t+"&entityname="+encodeURIComponent(a)+"&module="+r+"&"+this.csrf();mR(o,(function(t){if(0!=t){$("#tr_"+e).remove(),crmTab.deleteFromCache(r);var a=[],o=0;$("#territoryprops tr.remove").each((function(){a[o]=$(this).find("div:first").text(),o++}));var i=a.join(", ");$("#seterritories").text(i);var n=$("#seTerritoryCount").val();n=parseInt(n)-1,("Potentials"==r||n<Crm.userDetails.TERRITORIES_PER_RECORD)&&$(".show-panel").show(),$("#seTerritoryCount").val(n)}}),i)},Territory.setTerritoryValue=function(e,t,r,a){renderingUtils.removeFreezeLayer(),$("#"+r).val(e),$("#"+a).val(t),this.cancelTerritoryPopup("topBandPopup"),Territory.checkParentOrg()},Territory.checkParentOrg=function(){var e=getElemById("orgterrid").value,t=getElemById("parentId").value;getElemById("viewparentrule").style.visibility=t===e?"hidden":"visible"},Territory.showTerritoryPopup=function(e){var t=$("#profileEditPopup");crmui.showPopup(e,!0),"removeUser"==e&&t.is(":visible")&&t.css("z-index","10")},Territory.cancelTerritoryPopup=function(e){if($("#"+e).hasClass("zcrm-effect"))hideAnimatePopup(e);else{crmui.hidePopup(e);var t=$("#profileEditPopup");"removeUser"==e&&t.is(":visible")&&t.css("z-index","249")}this.isValidated=!1},Territory.disableTerritoryUsingKey=function(e,t){if(8==e.keyCode&&""==$("#territorysearch").val()){var r=$("#"+t).find("li:visible:last");if("background-image:none;"==r.attr("style")){var a=r.attr("id");a=a.replace("li",""),r.removeAttr("style"),"territories"==t?this.deleteTerritoriesFromCriteria(a,e):this.removeterritory(a,e)}else r.attr("style","background-image:none;")}},Territory.deleteTerritoriesFromCriteria=function(e,t){return $("#li"+e).remove(),$("#"+e).addClass("active").removeClass("sel").show(),$("#child label").hasClass("disabled")&&($("#child label").removeClass("disabled"),$("#child input").prop("disabled",!1),$("#child input").prop("checked",!1)),predefined=!1,t&&stopEvent(t),!1},Territory.setTerritoryValues=function(){for(var e=$("#territories li"),t="",r=0;r<e.length;r++){t+=e[r].id.replace("li","")+","}t=t.substr(0,t.length-1);var a=getElemById("includechild");a&&1==a.checked&&(a.value=1),$("#territoryids").val(t)},Territory.setTarget=function(){for(var e="",t="",r=$("#individualTarget input"),a=0;a<r.length;a++){var o=r[a],i=o.id;if(!validationUtils.numValidate(o.id,"target",""))return!1;e+=i.replace("user_","")+";",t+=o.value+";"}return $("#indiviualUsers").val(e),$("#indiviualTargets").val(t),!0},Territory.childTerritoryTarget=function(){for(var e="",t="",r="",a="",o=$("#childTerritory tr input[type='text']"),i=0;i<o.length;i++){var n=o[i],s=n.id;if(!validationUtils.numValidate(n.id,"target",""))return!1;if(-1!=s.indexOf("target"))r+=s.replace("target_","")+";",a+=n.value+";";else if(-1!=s.indexOf("manager")){var l=$("#"+s).attr("array");e=s.replace("manager"+l+"_",""),t=n.value,l=parseInt(l)+1,$("#childTerritoryUsers"+l).val(e),$("#usersTarget"+l).val(t)}}return $("#childTerritories").val(r),$("#childTargets").val(a),!0},Territory.assignTargetstoArray=function(){var e=$("#index").val();e=parseInt(e);for(var t=childArr[e],r=t[0],a=t[1],o=$("#userTarget input"),i=0;i<o.length;i++){var n=o[i],s=n.id;if(!validationUtils.numValidate(n.id,"target",""))return!1;s=s.replace("userTarget_",""),r[i]=s,a[i]=n.value}t[0]=r,t[1]=a,childArr[e]=t;var l=$("#actionval").val();$("#"+l).hide()},Territory.showUsers=function(e,t){$("#childMembers").html("");var r=$(e).offset(),a=r.left,o=r.top,i=getElemById(t);i.style.display="",i.style.left=a-200+"px",i.style.top=o+23+"px";var n=e.getAttribute("array"),s=JSON.parse(e.getAttribute("data-userinfo")),l=Territory.usersTemplate(s);if($("#childMembers").append(l),$("#index").val(n),null!=childArr[n])for(var c=childArr[n],d=(c[0],c[1]),u=c[2],m=c[3],p=$("#userTarget input"),g=0;g<p.length;g++){var h=p[g],v=u[g]?u[g]:"",f=m[g]?m[g]:"";h.setAttribute("pre-data",f),h.setAttribute("cur-data",v),null==d[g]||""==d[g]?h.value="":h.value=d[g]}},Territory.showPreviousTarget=function(e,t){stopEvent(t);var r=$(e).position(),a=r.left,o=r.top,i=getElemById("suggestDetails");if(i.style.display="",$(e).hasClass("fromTemp")){var n=$("#actionval").val(),s=$("#"+n).position();a=s.left+a,o=s.top+o}if(i.style.left=a+40+"px",i.style.top=o-26+"px",Crm.userDetails.RTL_ENABLED){var l=$("#suggestDetails").outerWidth();i.style.left=a-l+"px",i.style.top=o-26+"px"}var c=$(e).prev("input[type=text]").attr("cur-data"),d=$(e).prev("input[type=text]").attr("pre-data");if(null!=c&&""!=c?(c=JSON.parse(c),$("#current_pipe").html(c.pipeline),$("#current_achieved").html(c.closed)):($("#current_pipe").html(0),$("#current_achieved").html(0)),null!=d&&""!=d){d=JSON.parse(d);var u=this.getFcNamesAsOptions(d);$("#fcName").append(u).addClass("newSelect");var m=$("#previous").val();this.changePrevDetails(m,d)}else $("#previous_target").html(0),$("#previous_achieved").html(0),$("#previous_pipe").html(0)},Territory.changePrevDetails=function(e,t){var r=t[e];if(null!=r){var a=r.target?r.target:0,o=r.closed?r.closed:0,i=r.pipeline?r.pipeline:0;$("#previous_target").html(a),$("#previous_achieved").html(o),$("#previous_pipe").html(i)}else $("#previous_target").html(0),$("#previous_achieved").html(0),$("#previous_pipe").html(0)},Territory.getFcNamesAsOptions=function(e){var t=e.sortedList;$("#previous").remove();for(var r=document.createElement("select"),a=document.createElement("option"),o=$(r).attr({id:"previous"}),i=0;i<t.length;i++){var n=t[i];o.append($(a).clone().attr({value:n}).text(n))}return o.change((function(){Territory.changePrevDetails(this.value,e)})),o},Territory.saveForecast=function(e,t){if(!this.setTarget())return!1;if(!this.childTerritoryTarget())return!1;if(getElemById(t)&&!validationUtils.numValidate(t,"target",""))return!1;$("#saveForeBut").prop("disabled",!0);for(var r=$("#childTerritory a"),a="",o="",i=0;i<r.length;i++){var n=r[i].id,s=$("#"+n).attr("array");if(null!=childArr[s]){var l=childArr[s];a=l[0].join(";"),o=l[1].join(";")}s=parseInt(s)+1,$("#childTerritoryUsers"+s).val(a),$("#usersTarget"+s).val(o)}return"CreateForecast"==getAttr(e,"name")&&Crm.trackSpotLightAction("Forecast Created"),this.doUpdateForm("show",e,!0,!0),getElemById("fclookup")&&this.cancelTerritoryPopup("fclookup"),!1},Territory.cancelTerrMembersTarget=function(){var e=$("#actionval").val();$("#"+e).hide()},Territory.cancelDiv=function(){getElemById("fclookup")?(this.cancelTerritoryPopup("fclookup"),this.cancelTerrMembersTarget()):window.history.back()},Territory.computeForecast=function(e,t,r){var a;a=t?this.rolefcAction:this.forcastAction,a+="compute";var o="fcYear="+$("#fcYear").val()+"&fcQuarter="+$("#fcQuarter").val()+"&module=Forecasts&isload=false";o+=t?"&roleId=":"&territoryId=",o+=e+"&"+this.csrf(),null!=r&&1==r&&(o+="&computeForAll=true"),mR(a,(function(e){var t=getElemById("show");$(t).empty(),t.innerHTML=e,EvalInnerScript(t)}),o)},Territory.editForecastSetting=function(e,t){var r;t?Lyte.Router.transitionTo({route:"crm.tab.forecasts.editSettings"}):(r=e?this.rolefcAction:this.forcastAction,r+="forecastSettings&module=Forecasts&isload=false",ajaxNew(r))},Territory.cancelFCAction=function(e,t){var r;t?window.history.back():(r=e?this.rolefcAction:this.forcastAction,r+="startPage&module=Forecasts&isload=false",ajaxNew(r))},Territory.showParamConfirmation=function(e){var t=$("#forecastField option:selected").text(),r=$("#targetPeriod option:selected").text(),a=[];a.push($ESAPI.encoder().encodeForHTML(t)),a.push(r);var o=e?"crm.forecast.param.change.note2":"crm.label.forecast.settings.note";o=I18n.getMsg(o,I18n.getMsg(a,Crm.moduleInfo.Leads.translatedSingularLabel)),$("#confirmmsg").html(o),this.showTerritoryPopup("forecastsettingpopup")},Territory.addForecastToHistory=function(e){var t={mode:$("#mode").val(),fcYear:$("#fcYear").val(),fcQuarter:$("#fcQuarter").val()};"territoryId"==e?t.territoryId=$("#territoryId").val():t.roleId=$("#roleId").val(),Lyte.Router.transitionTo({route:"crm.tab.forecasts.index",queryParams:t}).data={cachedResponse:$("#show").val()}},Territory.viewChildForecast=function(e,t,r,a){var o={};t=null==t?$("#"+e).val():t,a=null==a?$("#mode").val():a,r=null==r&&null!=a&&"viewUser"==a?$("#ownerId").val():r,"territoryId"==e?o.territoryId=t:o.roleId=t,null!=r&&""!=r&&(o.ownerId=r),o.fcYear=$("#fcYear").val(),o.fcQuarter=$("#fcQuarter").val(),o.mode=a,Lyte.Router.transitionTo({route:"crm.tab.forecasts.index",queryParams:o})},Territory.setQuota=function(e,t,r){var a={};"setTarget"==t?(a.fcYear=$("#fcYear").val(),a.fcQuarter=$("#fcQuarter").val(),"TerritoryForecast"==e?a.territoryId=$("#territoryId").val():a.roleId=$("#roleId").val(),Lyte.Router.transitionTo({route:"crm.tab.forecasts.create",queryParams:a})):Lyte.Router.transitionTo({route:"crm.tab.forecasts.create"}).data={action:e}},Territory.showPipeline=function(e,t,r,a,o,i){var n={};null!=r&&""!=r&&(n.ownerId=r),null!=o&&"true"==o&&(n.isParent=o),null!=a&&1==a&&(n.closed="true"),null!=i&&1==i&&(n.others="true"),1==e?n.roleId=t:n.territoryId=t,n.fcYear=$("#fcYear").val(),n.fcQuarter=$("#fcQuarter").val(),n.parModule="Forecasts";var s=localStorage.getItem("rangeValueForPipeline");s&&!isNaN(parseInt(s))&&(n.rangeValue=s),Lyte.Router.transitionTo({route:"crm.tab.forecasts.pipeline",queryParams:n})},Territory.editForecast=function(e,t,r,a,o){var i,n=$("#mode").val(),s=$("#fcYear").val(),l=$("#fcQuarter").val();i=null!=a&&1==a?this.rolefcAction+"editRoleForecast&roleId=":this.forcastAction+"editTerritoryForecast&territoryId=",i+=t+"&fcYear="+s+"&fcQuarter="+l+"&mode="+r+"&prevMode="+n+"&module=Forecasts",null!=o&&(i=i+"&prevTerritoryId="+o),mR(i,(function(t){if("NO_CHILDS"==trimBoth(t))$(e).hide();else if("NO_USERS"==trimBoth(t))$(e).hide();else{renderingUtils.freezeBackground(),$("#fclookup").empty(),getElemById("fclookup").innerHTML=t,EvalInnerScript(getElemById("fclookup"));var r=getElemById("childContainer"),a=getElemById("individualContainer");r?(r.style.height="350px",r.style.overflow="auto",getElemById("childTerritory").style.width="97%"):a&&(a.style.height="350px",a.style.overflow="auto"),$("#fclookup").addClass("ppTop is-scroll"),crmui.showPopup("fclookup")}}))},Territory.adjustWidth=function(e){if(getElemById(e)){var t=$("#"+e).width();(t=0==$("#"+e).val().length?25:6*$("#"+e).val().length+10)>425&&(t=440),$("#"+e).css("width",t+"px")}},Territory.toShowDefaultValue=function(e,t){t=null==t?"territorysearch":t,0==e&&($("#"+t).val($("#"+t).attr("data-holder")),this.adjustWidth(t))},Territory.getNamesAndConcat=function(e,t){for(var r=[],a=$("input[name=chk]:checked"),o=0;o<a.length;o++){var i=a[o],n=$(i).attr(e);r.push(n)}return{nameList:r.join(t)}},Territory.createBulkTask=function(){var e=this.getNamesAndConcat("pot-name","&&##"),t="&secmod="+$("#module").val()+"&bulkCreate=bulkTask&actType=Tasks&idlist="+$("#id").val()+"&namelist="+encodeURIComponent(e.nameList);t=t+"&crmcsrfparam="+csrfToken;var r=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks&fromCreate=QuickCreate";mR(r,(function(e){0!==$("#qCreate").length&&(renderingUtils.freezeBackground(),$("#FreezeLayer").css("opacity",".1")),renderingUtils.ShakeDivInfreeze("qCreate","left",20,100),$("#qCreate").empty(),$("#qCreate")[0].innerHTML=e;var t=$("#qCreate");t.css("display","block");var r=getElemById("pipelinebut"),a=renderingUtils.findPosX(r),o=renderingUtils.findPosY(r);t[0].style.left=a+106+"px",t[0].style.top=o-28+"px",EvalInnerScript(t[0]),$(".qcpopuparrow").addClass("qcLeft").removeClass("qcRight")}),t)},Territory.sendBulkMail=function(){var e=getElemById("module").value;if(1==getNoOfSelected(document.TransferWizardForm)){var t=this.getNamesAndConcat("data-owner",";");openPopUp("entreplyWin",this,networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action=sendReminder&userIds="+t.nameList+"&module="+e+"&entId="+getElemById("id").value),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}else{var r=getElemById("id").value;getElemById("idlist").value=r;var a=Crm.getCrmBasePath()+"/ShowTemplates.do?idlist="+r+"&module="+e+"&remainderMail=true",o=getElemById("massMailstatsPop");$(o).empty(),o.style.display="block",o.style.zIndex=100,showAnimatePopup("massMailstatsPop"),mR(a,(function(e){$(o).empty(),o.innerHTML=e,manipulateScriptElems(o)}))}},Territory.constructOptionsForQuarter=function(e,t){if("none"!=e){for(var r,a=t[e],o=$("#fcQuarter").val(),i=0;i<a.length;i++){var n=a[i].split("##");o==n[1]?r+="<option value='"+n[1]+"' Selected >":r+="<option value='"+n[1]+"'>",r+=n[0]+"</option>"}$("#fcQuarter option[value=none]").nextAll().remove(),$("#fcQuarter option[value=none]").after(r)}},Territory.createForecast=function(e,t,r){var a="",o=$("#fcYear").val(),i=$("#fcQuarter").val(),n=$("#"+t).val();null!=o&&null!=i&&null!=n&&"none"!=o&&"none"!=i&&"none"!=n&&""!=n?(a=r?this.rolefcAction:this.forcastAction,a+="ajaxCall&fcYear="+o+"&fcQuarter="+i+"&"+t+"="+n+"&module="+e):$("#qutoaDIV").empty(),""!=a&&mR(a,(function(e){var t=getElemById("qutoaDIV");$(t).empty(),t.innerHTML=e,EvalInnerScript(t)}))},Territory.changeFcOwner=function(e,t,r,a){var o=r,i=Crm.getCrmBasePath()+"/Role.do?action=changeManager",n="roleId="+a+"&fctownerId="+e+"&"+this.csrf();(new crmRequestPool).doAjax(i,(function(i){if("true"==i&&($("#owner"+a).text(t),$("#"+r).data("ownerid",e),o.indexOf("addManager")>-1)){var n=o.replace("addManager","changeManager");$("#"+o).addClass("changeUserIcon fL fblink crm-small-font-size lh38 mT10 svgIcons ico-search-users changeIconTerritoryNew").attr("id",n)}}),n,(function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}))},Territory.changeManager=function(e,t,r,a){var o="",i=r,n=this.territoryAction+"changeManager",s="userId="+e+"&territoryId="+a+"&"+this.csrf();(new crmRequestPool).doAjax(n,(function(n){if("true"==n){var s=$ESAPI.encoder().encodeForJavaScript(t);if($("#owner"+a).text(t).attr("onmouseover",'crmui.toolTip_show(this,"center","'+s+'");'),$("#"+r).data("ownerid",e),i.indexOf("addManager")>-1){var l=i.replace("addManager","changeManager");o=I18n.getMsg("crm.territory.add.manager.success.msg");var c=$("#"+i);c.text(""),c.append('<svg class="zcicn_embedSvg zcicn-user-search  zcicn_7c8bae"> <use href="#zcicn-user-search"></use> </svg>').attr("id",l)}else o=I18n.getMsg("crm.territory.change.manager.success.msg");crmui.showMsgBand("success",o,2e3,"")}}),s,(function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}))},Territory.setParamsForPipeline=function(){var e="";getElemById("territoryId")?e="&territoryId="+getElemById("territoryId").value:getElemById("roleId")&&(e="&roleId="+getElemById("roleId").value),getElemById("ownerId")&&(e+="&ownerId="+getElemById("ownerId").value);var t=getElemById("isParent");e+=t?"&isParent="+t.value:"",e+="&fcYear="+getElemById("fcYear").value+"&fcQuarter="+getElemById("fcQuarter").value+"&frmidx="+getElemById("frmidx").value+"&toidx="+getElemById("toidx").value+"&rangeValue="+getElemById("rangeValue").value,this.currentInfo.pipelineInfo=e},Territory.showTerritoryFilter=function(e,t){if("none"==$("#territoryfilter").css("display")){var r=$("#territoryfilter,#cvbutton").slideDown(500);setTimeout((function(){r.stop(!0,!0).show()}),400);var a=$("#criteria,#displayrecords").slideUp(500);setTimeout((function(){a.stop(!0,!0).hide()}),400);var o=$("#customviewselect").fadeOut(500);setTimeout((function(){o.stop(!0,!0).hide()}),400)}},Territory.showCriteria=function(){if("none"==$("#criteria").css("display")){$("#criteria,#cvbutton").slideDown(500);var e=$("#customviewselect").fadeOut(500);setTimeout((function(){e.stop(!0,!0).hide()}),400);var t=$("#territoryfilter,#displayrecords").slideUp(500);setTimeout((function(){t.stop(!0,!0).hide()}),400)}},Territory.removeterritory=function(e,t){$("#territorysearch").autocomplete("close"),$("#"+e).removeClass("dN");var r=$("#territoryuserIds").val(),a=getElemById("li"+e);if(a){a.style.display="none";for(var o=(r=r.substr(0,r.length-1)).split(";"),i=0;i<o.length;i++)o[i]==e&&a.setAttribute("remove","yes")}return stopEvent(t),!1},Territory.setUserValues=function(){for(var e=$("#territoryUserDropdown").find("ul").find("li"),t="",r="",a=e.length,o=0;o<a;o++){var i=e[o],n=$(i).data("value");"yes"==i.getAttribute("remove")?r+=n+";":""==i.style.display&&(t+=n+";")}var s=$("#old_ownerId").val();""!=s&&-1==t.indexOf(s+";")&&(t+=s);n=$(i).data("value");$("#removeduserIds").val(r),$("#territoryuserIds").val(t)},Territory.changeOwner=function(){var e=$("#territoryManagerDropdown")[0].component.getData("cxPropSelectedUser");e&&($("#territoryOwnerName").val(e.full_name),$("#ownerId").val(e.id))},Territory.checkTerritory=function(){this.setUserValues();var e=$("#removeduserIds").val();return"block"==getElemById("removeUser").style.display?(this.setRemoveUserValues(";"),!0):null==e||""==e},Territory.showRemoveUsersPopup=function(){var e=$("#removeduserIds").val(),t=$("#territoryId").val();if(null!=e&&null!=t&&""!=e){var r="",a=$("#old_ownerId").val();null!=a&&""!=a&&(r="&managerId="+a);var o=Territory.territoryAction+"removeUsers&userId="+e+"&territoryId="+t+r;mR(o,(function(e){if("false"==e)return Territory.doUpdateForm("result",document.TerritoryForm,!0,!1),!1;$("#removepopup").html(e),Crm.userDetails.RTL_ENABLED&&$("#removeUser .select").addClass("chosen-rtl"),thirdPartyUtils.bindSelect2("#removeUser .select"),$(".chosen-single").css("width","190px"),$(".chosen-drop").css("width","198px"),$(".chosen-search input").css("width","163px"),Territory.showTerritoryPopup("removeUser")}))}},Territory.catchEnter=function(e){$("#"+e).keypress((function(e){13==e.which&&e.preventDefault()}))},Territory.setRemoveUserValues=function(e){var t="";if(getElemById("removepopup"))for(var r=$("#removepopup .select"),a=0;a<r.length;a++){var o=r[a];o.id.replace("change_","");t+=o.value+e}$("#newOwnerIds").val(t),hide("removeUser")},Territory.showCvDiv=function(){if("none"==$("#customviewselect").css("display")){var e=$("#customviewselect").fadeIn(500);setTimeout((function(){e.stop(!0,!0).show()}),400);var t=$("#criteria,#displayrecords,#cvbutton,#territoryfilter").slideUp(500);setTimeout((function(){t.stop(!0,!0).hide()}),400),$("#cvid").val(""),$(".SelectedOption").text(I18n.getMsg("crm.select"))}},Territory.setUserTerritoryValues=function(){for(var e=$("#managedids").val(),t=(e=e.substr(0,e.length-1)).split(","),r=0;r<t.length;r++)$("#check"+t[r]).prop("checked",!0).prop("disabled",!0);for(var a=$("#userTerritoryIds").val(),o=(a=a.substr(0,a.length-1)).split(","),i=0;i<o.length;i++){var n=o[i];$("#check"+n).prop("checked",!0)}},Territory.getCvRecords=function(){var e=$("#cvid").val();if(null!=e&&""!=e)return this.doUpdateForm("result",document.AssignmentRuleForm,!0,!0),!1;var t=$("#displayrecords").slideUp(500);setTimeout((function(){t.stop(!0,!0).hide()}),400)},Territory.validateAssignment=function(e){var t;return this.setTerritoryValues(),$("#criteria:visible").length?(t=Search.getCriteriaDetails())?null==t||t.length<1?(renderingUtils.stopEvent(event),renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.error.criteria")),!1):($("#criteriajson").val(""),Territory.doUpdateForm("result",document.AssignmentRuleForm,!0,!1,void 0,t),!1):(renderingUtils.stopEvent(event),!1):(e=null==e||e,this.doUpdateForm("result",document.AssignmentRuleForm,!0,e),!1)},Territory.runRule=function(){$("#runrule").val("true"),this.cancelTerritoryPopup("assignmentRuleMsg"),this.validateAssignment(!1)},Territory.showTerritorySuggest=function(e,t,r,a){var o=$(e).val().trim().toLowerCase(),i=getElemById(a),n=getElemById("noMoreTerritory"),s=$("#"+r+" a.active, a.search"),l=0;currSechExtMatCnt=0;for(var c=0;c<s.length;c++){var d=s[c],u=d.innerHTML.toLowerCase();""==o||-1!=u.indexOf(o)?($(d).addClass("active").removeClass("search").show(),i&&(i.style.display="none"),l++,u.trim()===o&&currSechExtMatCnt++):$(d).removeClass("active").addClass("search").hide()}0==l&&i&&n&&"block"!=n.style.display&&(i.style.display="")},Territory.doHighLight=function(e,t,r,a){if(t||(t=curElem),t.length){if(e)var o=$L(e);else{r=0;o=$L(resultsObj)}a||(a=315);var i=o.scrollTop(),n=a+i,s="rightPanelInfo"===o.attr("id")?t.offset().top:t.position().top,l=(s=s+i-r)+t.outerHeight()+r;l>=n?o.scrollTop(l-a>0?l-a:0):s<i&&o.scrollTop(s)}},Territory.key_up=function(){var e;showing?curElem&&(e=curElem.prevAll("a.active").first()).length>0&&(curElem.removeClass("hoverhighlight"),curElem=e,curElem.addClass("hoverhighlight"),this.doHighLight()):this.showResults()},Territory.key_down=function(){var e;showing?curElem&&!isFirst&&(e=curElem.nextAll("a.active").first()).length>0&&(curElem.removeClass("hoverhighlight"),curElem=e,curElem.addClass("hoverhighlight"),this.doHighLight()):this.showResults()},Territory.addSelected=function(){if(curElem&&curElem.length){var e=curElem.attr("id");if(getElemById("li"+e))isFirst=!0;else{var t=curElem.text(),r={TERRITORYID:e,NAME:t};if($("#territories").hasClass("mT20")||$("#territories").addClass("mT20"),e<=0){var a=$("#territories li"),o=a.length;if(o>0){if(!confirm(I18n.getMsg("crm.alert.territory.pre.views",I18n.getMsg(t))))return!1;for(var i=0;i<o;i++){var n=a[i].id.replace("li","");this.deleteTerritoriesFromCriteria(n)}this.showTerritories(e,r),$(resultsObj).hide(),showing=!1}else this.showTerritories(e,r);predefined=!0,$("#child label").addClass("disabled"),$("#child input").prop("disabled",!0)}else $("#child label").hasClass("disabled")&&($("#child label").removeClass("disabled"),$("#child input").prop("disabled",!1)),this.showTerritories(e,r),predefined=!1}}},Territory.showTerritories=function(e,t){$("#"+e).removeClass("active hoverhighlight search").addClass("sel").hide(),$("#territories").append(Territory.terrTemplate(t))},Territory.showResults=function(){predefined||($(resultsObj).show(),showing=!0,0==$("#territorydrop a:visible").length?$("#noMoreTerritory").show():$("#noMoreTerritory").hide())},Territory.registerEvents=function(e,t,r){var a=$(e),o=$(t),i=$(r);a.on("click",(function(){Territory.showResults()})),i.on("focus",(function(){Territory.showResults()})),i.on("blur",(function(){curElem&&curElem.length&&(curElem.removeClass("hoverhighlight"),isFirst=!0)})),i.on("keydown",(function(e){Territory.eventChecker(e,t.id)})),i.on("keyup",(function(e){Territory.showTerritorySuggest(this,e,"territorydrop","noMatchUsers")})),o.on("mouseenter",(function(e){var t,r=e.target;(t=$(r).hasClass("active")?$(r):$(r).parents(".active").first()).length&&(curElem=t,curElem.addClass("hoverhighlight"))})),o.off("click").on("click",(function(e){var r,a=e.target;(r=$(a).hasClass("active")?$(a):$(a).parents(".active").first()).length&&showing&&(curElem=r,Territory.addSelected(),$(t).hide(),showing=!1)})),o.on("mouseleave",(function(e){target=$(e.target).hasClass("active")?$(e.target):$(e.target).parents(".active").first(),target&&curElem.removeClass("hoverhighlight")}))},Territory.hideRows=function(){for(var e=$("#territories li"),t=e.length,r=0;r<t;r++){var a=e[r].id.replace("li","");$("#"+a).removeClass("active hoverhighlight search").addClass("sel").hide(),a<=0&&(predefined=!0,$("#child label").addClass("disabled"),$("#child input").prop("disabled",!0))}},Territory.showTerritoryList=function(e,t,r){containerObj=getElemById(e),resultsObj=getElemById(t),searchObj=getElemById(r),bindEvents||(this.registerEvents(containerObj,resultsObj,searchObj),bindEvents=!0,Territory.showResults())},Territory.registerOverEvents=function(){$(".selDumy").mouseenter((function(){$(this).addClass("forecastHovr"),$(this).mouseleave((function(){$(this).removeClass("forecastHovr")}))}))},Territory.eventChecker=function(e,t){switch(e.keyCode){case 38:e.preventDefault(),Territory.key_up();break;case 40:e.preventDefault(),Territory.key_down();break;case 13:showing&&(Territory.addSelected(),curElem=curElem.nextAll("a.active").first(),0==curElem.length&&(curElem=curElem.prevAll("a.active").first()),curElem.addClass("hoverhighlight"),$(resultsObj).hide(),showing=!1)}isFirst&&(curElem=$("#"+t+" a:visible").first(),curElem.addClass("hoverhighlight"),isFirst=!1)},Territory.showOrHideTerritoryRule=function(e){(e=$(e)).hasClass("viewRule")?(e.removeClass("viewRule").html(I18n.getMsg("crm.territory.hide.rule")),e.closest("li").children().find(".terroritoryRulesDropdown:first").slideDown(),e.parent().prev("a").addClass("crm-font-bold")):(e.parent().prev("a").removeClass("crm-font-bold"),e.addClass("viewRule").html(I18n.getMsg("crm.territory.view.rule")),e.closest("li").children().find(".terroritoryRulesDropdown:first").slideUp())},Territory.initAutoComplete=function(){thirdPartyUtils.bindSelect2("#access"),$("body").off("click").click((function(e){e.target&&"terrDIV"!==e.target.id&&e.target.parentNode&&"territoryuser"!==e.target.parentNode.id&&($("#containerDIV").addClass("dN"),Territory.toShowDefaultValue($("#territoryuser li:visible").length))})),Territory.toShowDefaultValue($("#territoryuser li:visible").length)},Territory.removeTerrLookup=function(e){this.cancelTerritoryPopup(e),$("#territoryLookup").remove()},Territory.showForecastDelMessage=function(e,t,r,a,o){var i,n=[];if(n.push($("#fcQuarter").find("option[selected]").text()),n.push($("#fcYear").val()),n.push(moduleRecordMapping.Forecasts.singular_label),a){var s=$(r).closest("tr");Territory.delForecastDet={deletedObj:s,roleOrTerritoryId:o,forecastId:a},n.push(e),n.push($ESAPI.encoder().encodeForHTML(t)),$("#deletedCheck").css("display",""),i=I18n.getMsg("crm.warning.remove.deleted.forecast",n),$("#warningMsg").next("ul").css("display","none")}else Territory.delForecastDet=void 0,$("#deletedCheck").css("display","none"),i=I18n.getMsg("crm.warning.delete.organisation.forecast",n),$("#warningMsg").next("ul").css("display","");renderingUtils.freezeBackground(),$("#Warningdiv").css({display:"block",zindex:98}),mailsetCenter("Warningdiv"),$("#showDeleteName").text(t),$("#warningMsg").html(i)},Territory.deleteForecast=function(e){var t=JSON.parse($(e).attr("data-params")),r=Crm.getCrmBasePath()+"/"+$(e).attr("data-fctype")+".do",a=1;Territory.delForecastDet&&(a=2,$("#deleteAllForecasts").prop("checked")&&(a=3),t.roleOrTerritoryId=Territory.delForecastDet.roleOrTerritoryId,t.forecastId=Territory.delForecastDet.forecastId),t.deleteMode=a,t.crmcsrfparam=encodeURIComponent(csrfToken),mR(r,(function(e){Territory.updateForecastValues(a,e)}),t,(function(e){alert("Unable to process the request")}))},Territory.updateForecastValues=function(e,t){if(1===e){var r=getElemById("show");$(r).empty(),r.innerHTML=t,EvalInnerScript(r)}else{var a=Territory.delForecastDet.deletedObj.siblings("tr").length;if(1===a)Territory.delForecastDet.deletedObj.parents("table").eq(1).remove();else if(3===a||2===a)Territory.delForecastDet.deletedObj.remove(),$("#totalProp").remove();else{var o,i,n=Territory.getCurrencyObj($("#target").text()),s=Territory.getForecastValues(n,Territory.delForecastDet.deletedObj),l=Territory.getForecastValues(n);for(var c in l)l[c]=l[c]-s[c];if(l.target>0){o=l.closed/l.target*100;var d=l.target-l.closed-l.pipeline;$("#quotaPercent").text(o.toFixed(1)),d>0&&(i=d/l.target*100,$("#shortPercent").text(i.toFixed(1)))}l=Territory.formatNumtoCurrency(l,n),$("#target").text(l.target),$("#pipeline").text(l.pipeline),$("#closed").text(l.closed),Territory.delForecastDet.deletedObj.remove()}Territory.delForecastDet=void 0}$("#Warningdiv").css("display","none"),renderingUtils.removeFreezeLayer()},Territory.getForecastValues=function(e,t){var r={},a=t?$(t).find("td"):$("#totalProp").find("td");return r.target=a.eq(1).text().trim(),r.closed=a.eq(2).text().trim(),r.pipeline=a.eq(3).text().trim(),r=Territory.formatCurrencytoNum(r,e)},Territory.formatNumtoCurrency=function(e,t){var r=t.decimals,a=t.symbol,o=t.format.split("|")[0],i=t.format.split("|")[1];for(var n in e){var s=e[n]||0,l=parseInt(s=Math.abs(s||0).toFixed(r),10)+"",c=(c=l.length)>3?c%3:0;e[n]=a+(c?l.substr(0,c)+o:"")+l.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+o)+(r?i+Math.abs(s-l).toFixed(r).slice(2):"")}return e},Territory.formatCurrencytoNum=function(e,t){var r=t.format.split("|"),a="[\\"+r[0]+"]";for(var o in a=new RegExp(a,"g"),e){var i=0,n=e[o];n&&(n=(n=n.replace(t.symbol,"").replace(a,"").replace(r[1],".")).replace(new RegExp("[-]\\s*"),"-"),n=parseFloat(n),i=isNaN(n)?0:n.toFixed(t.decimals)),e[o]=i}return e},Territory.toggleSaveBtn=function(e){var t=getElemById("userTerritoryIds").value.split(","),r=[],a=$("#btn_SaveTerritory"),o=$("#btn_AddTerritory");$("#territoryLookup input:checked").each((function(){var e=this.id;e=e.replace("check",""),r.push(e)}));var i=getElemById("managedids").value,n=$("#check"+e).prop("checked"),s=document.querySelector("#div"+e);s&&s.querySelectorAll("input").forEach((function(e){var t=e.id.replace("check","");if(n&&!r.includes(t))r.push(t);else if(!n&&!i.includes(t)){var a=r.indexOf(t);-1!==a&&r.splice(a,1)}}));if(r.length!=t.length-1)return a.prop("disabled",!1),void o.prop("disabled",!1);for(var l=t.length,c=0;c<l;c++)if(""!=t&&""!=t[c]&&!r.includes(t[c]))return o.prop("disabled",!1),void a.prop("disabled",!1);o.prop("disabled",!0),a.prop("disabled",!0)},Territory.showOrHideDelIcon=function(e,t){$(e).children("a").eq(0).toggle(t)},Territory.getCurrencyObj=function(e){var t={};if(t.format=",|.",t.decimals=2,Crm.userDetails.defaultOrgCurrency&&Crm.userDetails.DEFAULT_ORG_CURRENCY?(t.symbol=Crm.userDetails.defaultOrgCurrency,Crm.userDetails.DEFAULT_ORG_CURRENCY&&Crm.userDetails.DEFAULT_ORG_CURRENCY.format&&(t.format=Crm.userDetails.DEFAULT_ORG_CURRENCY.format)):Crm.userDetails.BASE_CURRENCY&&Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY]&&(t=Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY]),void 0!==Crm.userDetails.defaultRoundOff&&(t.decimals=parseInt(Crm.userDetails.defaultRoundOff)),!t.symbol&&e){var r=(e=e.trim()).match(/^.*?(?=[0-9])/);t.symbol=r[0]}return t};var CrmPageLayout={showMsgBand:function(e,t,r,a){crmui.showMsgBand(t,r,a,e)},showOrHideBusinessCard:function(e){var t=$("#dvBusinessCardVisibility"),r=t.find(".radio_button"),a=$(".businessCardDetails");r.hasClass("on_state")?(r.removeClass("on_state").addClass("off_State"),t.find(".white_ball").removeClass("fR").addClass("fL"),$("#bcVisible").val("false"),a.find(".fieldCountAlert, .crmLinkHover, .detailViewBusinessCardFields").hide(),a.find(".detaiViewBCFieldsMessage").show(),e&&(CMB.isDetailViewBCVisible=!1),$(".popup-model-content").hide(),$(".bcfieldslimit, .bcfieldnote").hide(),$(".dv_bcfieldsmsg").show()):(r.removeClass("off_State").addClass("on_state"),t.find(".white_ball").removeClass("fL").addClass("fR"),$("#bcVisible").val("true"),a.find(".fieldCountAlert, .crmLinkHover, .detailViewBusinessCardFields").show(),a.find(".detaiViewBCFieldsMessage").hide(),e&&(CMB.isDetailViewBCVisible=!0),$(".popup-model-content").show(),$(".bcfieldslimit, .bcfieldnote").show(),$(".dv_bcfieldsmsg").hide()),Events.isPageLayoutModified=!0,$("#saveBtn,#saveCloseBtn").removeClass("inActiveSec")},showLayoutPopup:function(e,t,r){var a={};a.module=e,a.layoutId=t;var o=Crm.getCrmBasePath()+"/PageLayout.do?action=showPageLayoutPopup";o=networkUtils.getPortalURL(o),jQuery.ajax({type:"GET",url:o,data:a,dataType:"json",success:function(a){a.module=e,a.entityId=r,a.selectedLayoutId=t,a.layout_jsonarrayObj=CrmPageLayout.removeIntegrationLayout(a.layout_jsonarrayObj),$("#lookupdiv").html($(Handlebars.templates.PageLayoutPopup(a))).addClass("newShowLayoutPopup"),renderingUtils.freezeBackground(),mailsetCenter("lookupdiv")}}),Crm.trackSpotLightAction("MPL - Change Layout From Record Click",{Module:e})},openLayout:function(e,t){var r,a="Crm_"+t+"_LAYOUTID";$("#"+a).val()||(a="layoutDetails"),r=$(".changeDefLayout").hasClass("hide")?Crm.getCrmBasePath()+"/settings/modules/"+t+"/layouts/"+$("#zCampIntegLayout").val():Crm.getCrmBasePath()+"/settings/modules/"+t+"/layouts/"+$("#"+a).val(),$(e).attr("href",r)},removeIntegrationLayout:function(e){for(var t=new Array,r=e.length,a=0;a<r;a++){var o=e[a];12!=o.SOURCE&&t.push(o)}return t},configureAppointments:function(e){return"ask_appointment_provider_to_complete"===e.when_duration_exceeds?e.ask_app_provider=!0:e.ask_app_provider=!1,"create_deal"===e.when_appointment_completed?e.create_deal=!0:e.create_deal=!1,e}},CustomButtonJSObjectInit={requestButtonSend:!0,sortedOrderButtonIds:[],webtabUrl:"",closeCBSuccessDiv:function(){var e=$("#cbExecutedPage");if(e&&(position=e.val()),$("#cbSuccessPopup").removeClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").hide()}),300),$("#cbSuccessPopupRespContent").html(""),renderingUtils.removeFreezeLayer(),$("#cbSuccessPopup").remove(),"viewEntity"===position)"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName?Lyte.Router.getRouteInstance().refresh():reloadCurrentEntityView();else if("eachRecord"===position||"listView"===position)crmListView.reloadCurrentListView();else if("relatedlist"===position){var t=Object.keys(CustomButtonJSObjectInit.checkBox)[0].split("_")[1];if(!Crm.userDetails.isRelatedListLyteEnabled){var r={};r.id=detailView.entityId,r.module=detailView.currentModule,r.rid=t,r.isSortRequest=!1}if(Crm.userDetails.EMAIL_THREAD_VIEW){let e=$L("crm-emailconversation-view");if((0===e.length?-1:e[0].component.emailRelationId)===t)return}Crm.userDetails.isRelatedListLyteEnabled?Lyte.triggerEvent("relatedList",{id:t}):networkUtils.makeRequest(Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData","GET",{params:r,success_callback:function(e){crmRelatedList.load(detailView.currentModule,detailView.entityId,e)}})}else if("related_list"===position){var a=CustomButtonJSObjectInit.canvas_rlid;a&&Lyte.triggerEvent("relatedList",{id:a,refreshTemplate:!0})}},insertAtCaret:function(e,t){if(document.selection)e.focus(),document.selection.createRange().text=t;else if(e.selectionStart||"0"==e.selectionStart){startPosition=e.selectionStart;var r=e.selectionEnd;e.value=e.value.substring(0,startPosition)+t+e.value.substring(r,e.value.length)}else e.value+=t},closeDiv:function(e){crmui.hidePopup(e)},execute:function(e,t,r,a,o){if(!CustomButtonJSObjectInit.requestButtonSend)return!1;if(CustomButtonJSObjectInit.update)return CustomButtonJSObjectInit.update=!1,!1;r=""===r?$("#entityIdEachRec").val():r;var i=Crm.getCrmBasePath()+"/CustomButton.do",n="step=executeCB&buttonId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+o+"&pos="+t,s="";switch("webtab"==$("#opencbresponse :selected").val(),t){case"viewEntity":case"eachRecord":n=n+"&entityId="+r;break;case"listView":var l=crmListView.getObject().selectedIds;if(l.length<=0)return crmui.showMsgBand("warning",I18n.getMsg("crm.alert.select.one"),"5000"),!1;n=n+"&entityId="+l;break;case"relatedlist":var c="CB_"+a,d=CustomButtonJSObjectInit.checkBox[c];n=n+"&listRelationId="+a+"&relatedListIds="+d.toString()+"&entityId="+r}if(void 0!==t&&"cbedit"!=t&&"cbeditInv"!=t&&"create"!=t&&"clone"!=t&&"createclone"!=t&&""!=t){if(!CustomButtonJSObjectInit.requestButtonSend)return;CustomButtonJSObjectInit.requestButtonSend=!1,(new crmRequestPool).doAjax(i,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e)?CustomButtonJSObjectInit.buttonExecuteResp(e,t,void 0,r):CustomButtonJSObjectInit.requestButtonSend=!0}),n)}else{CustomButtonJSObjectInit.requestButtonSend=!0;var u="",m=crmCommonModule.createEditJson.module;r="cbedit"===(t="cbeditInv"===t?"cbedit":t)?window[m].entityId:1;n="step=getCustomButtonInfo&module="+m+"&buttonId="+e+"&entityId="+r;(new crmRequestPool).doAjax(i,(function(a){var l=JSON.parse(a);if(l.paramMap&&(l.paramMap.userOrgCrmVar&&(u=l.paramMap.userOrgCrmVar),delete l.paramMap.userOrgCrmVar),l.isError){if(l.errorMsg&&l.errorMsg.startsWith("CIRCUITS_"))if(!CustomButtonJSObjectInit.showButtonErrorMsg(l.errorMsg))return!1;return alert(l.errorMsg),!1}if("url"===l.buttonType)switch(l.buttonDisplay){case"sametab":s="_self";break;case"newwindow":s="newWin";break;case"newtab":s="_blank"}else if("customfunctions"===l.buttonType)"Parent window"===l.openIn?s="_self":"Same window"===l.openIn&&(s="_blank");else{if("widget"===l.buttonType){var c={Entity:l.moduleName};if(r&&1!==r&&(c.EntityId=r),l.ButtonID){var d=l.ButtonID,p="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",d):void 0;p&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-create-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){var e=WidgetHandler.Utils.readForm();c=jQuery.extend(c,e),WidgetHandler.CustomButtons.render(p,c,t)}))}return}if("circuit"===l.buttonType)return void CustomButtonJSObjectInit.processCircuitResponse(l)}var g,h=[];if(l.paramMap.urlExpression){var v=l.paramMap.urlExpression;l.isWebTab&&(g=l.url,l.weburl=g),l.url=v,l.paramMap.returnValue&&(h=JSON.parse(l.paramMap.returnValue),l.returnValue=h),delete l.paramMap.urlExpression,delete l.paramMap.returnValue}if($.isEmptyObject(l.paramMap)&&!l.isWebTab){if("url"===l.buttonType)"newWin"===s?openPopUp("newWin","",networkUtils.getOrgSpecificURL(l.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(l.url,s),commonUtils.showHideLoadingDiv();else if("customfunctions"===l.buttonType){if(paramValuejsonObj=[],t="createclone"===t?"create":t,n="step=executeCB&buttonId="+e+"&cbParamValue="+encodeURIComponent(JSON.stringify(paramValuejsonObj))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+o+"&pos="+t,"cbedit"==t&&(n+="&entityId="+window[m].entityId),"customfunctions"===l.buttonType){var f=CustomButtonJSObjectInit.constructJsonForCreatePage(o);n=n+"&formFieldData="+encodeURIComponent(JSON.stringify(f))}commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).doAjax(i,(function(e){if(commonUtils.showHideLoadingDiv(!1),CustomButtonJSObjectInit.showButtonErrorMsg(e)){"TOO_MANY_REQUESTS"===JSON.parse(e).creator_error?crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.function.limit.exceed"),5e3):"SOCKET_CLOSED"===JSON.parse(e).creator_error&&crmui.showMsgBand("warning",I18n.getMsg("crm.custombutton.function.time.exceed"),7e3),""!=(l=JSON.parse(e)).alertMessage&&networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(l.alertMessage),$("#cbExecutedPage").val(t)}));var r=l.openURL,a=l.openIn;""!==r&&validationUtils.isValidWebUrl(r)&&("Popup window"===a?(width=l.width,height=l.height,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.open(l.openURL,"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=1,location=no,directories=no")):"New window"===a?openPopUp("newWin","",networkUtils.getOrgSpecificURL(r),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(r,a))}}),n)}}else if($.isEmptyObject(l.paramMap)&&l.isWebTab)l.weburl&&(CustomButtonJSObjectInit.webtabparams=l.url,l.url=l.weburl),"newWin"===s?openPopUp("newWin","",networkUtils.getOrgSpecificURL(l.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(networkUtils.getOrgSpecificURL(l.url),s),commonUtils.showHideLoadingDiv();else if("url"===l.buttonType||"customfunctions"===l.buttonType){paramValuejsonObj=[];var C=!1,y="";$.each(l.paramMap,(function(e,a){paramValueitem={};var i=e.split("::::"),n=i[1],s="";e=i[0];var c=a.split("::::");if(a=c[0],2==n?(paramValueitem.param=e,y=e,s=a,2==c.length&&(paramValueitem.param=c[1])):(paramValueitem.param=a,y=a,s=e,2==c.length&&(paramValueitem.param=c[1])),100==n)paramValueitem.param=a,paramValueitem.value=r,2==c.length&&(paramValueitem.param=c[1]),paramValuejsonObj.push(paramValueitem);else if(200==n)paramValueitem.param=a,paramValueitem.value=$("#"+s).attr("data-id"),paramValuejsonObj.push(paramValueitem);else if("Layout"==a&&"cbedit"!=t)paramValueitem.value=$("#layoutDetails").val(),paramValuejsonObj.push(paramValueitem);else if(s.startsWith("Crm_")){var d=$("#"+s),m=d.val();"Crm_"+o+"_SMOWNERID"===s&&(m=d.text());var p=$("[name='property\\("+a+"\\)']").val();if(null==m&&""==p||""==m){var g={},v="${"+o+"."+c[1]+"}";f=(f=l.url).replace(v,""),l.url=f,g[o]=y,h.push(g),C=!0}else if(null==m&&""!=p)paramValueitem.value=p,paramValuejsonObj.push(paramValueitem);else{paramValueitem.value=m,paramValuejsonObj.push(paramValueitem);var f=l.url;v="${"+o+"."+c[1]+"}";f=f.replace(v,m),l.url=f,l.isWebTab&&(u=l.url)}}else if(""==$("#Crm_"+l.moduleName+"_"+s).val()&&"SMOWNERID"!=s){"Leads"==l.moduleName&&"Designation"==y&&(y="Title"),(g={})[o]=y,h.push(g),C=!0,paramValueitem.value="",paramValuejsonObj.push(paramValueitem)}else paramValueitem.value="SMOWNERID"===s?$("#Crm_"+l.moduleName+"_"+s).text():$("#Crm_"+l.moduleName+"_"+s).val(),paramValuejsonObj.push(paramValueitem)}));var b=CustomButtonJSObjectInit.processForLookupRecords(l.lookupFieldsDataMap,o),I=CustomButtonJSObjectInit.processForDefaultLookupRecords(l.defaultLookupFieldObject,o);if(l.isWebTab&&(l.webtabparams=u),0!=h.length&&(C=!0),C&&(l.returnValue=h,l.paramValuejsonObj=paramValuejsonObj,l.id=e,l.module=o,l.lookupRecordsMap=b,l.defaultLookupRecordsMap=I,CustomButtonJSObjectInit.processError(l,t)),!C){for(var T in paramValuejsonObj){var w=paramValuejsonObj[T].param;if("undefined"!=w&&null!=w&&null!=w&&w.indexOf("$map_")>-1){var E=(k=w.substring(5)).split("_$KEY$"),k=(E[0],E[1]);paramValuejsonObj[T].param=k}}if(t="createclone"===t?"create":t,n="step=executeCB&buttonId="+e+"&cbParamValue="+encodeURIComponent(JSON.stringify(paramValuejsonObj))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+o+"&pos="+t+"&entityId="+r+"&url="+encodeURIComponent(v)+"&lookupRecordsMap="+JSON.stringify(b)+"&defaultLookupRecordsMap="+JSON.stringify(I),"customfunctions"===l.buttonType){f=CustomButtonJSObjectInit.constructJsonForCreatePage(o);n=n+"&formFieldData="+encodeURIComponent(JSON.stringify(f))}(new crmRequestPool).doAjax(i,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e)&&CustomButtonJSObjectInit.buttonExecuteResp(e,t,"executeCB")}),n)}}}),n)}},processForLookupRecords:function(e,t,r,a){var o={};if(e){var i,n=e.split(";"),s=n.length;for(i=0;i<s;i++){var l=n[i],c="#Crm_"+t+"_"+l.split("=")[0],d=l.split("=");if(d.length>=2){var u=d[1].split("::"),m=u[0],p=$(c).data();if(p){var g=null!=p.id&&null!=p.id?p.id:"";if(o[m]=[g,u[1],u[2],u[3]],!g&&null!=r){var h=t+" "+p.displaylabel;r.contains(h)||(a[t]&&a[t].push(p.displaylabel),r.push(h))}}}}}return null!=a?a:o},processForDefaultLookupRecords:function(e,t,r,a){var o={};if(e){var i,n=e.split(";"),s=n.length;for(i=0;i<s;i++){var l=n[i],c="#Crm_"+t+"_"+(l.split("=")[0]?l.split("=")[0].split("###")[0]:""),d=l.split("=");if(d.length>=2){var u=d[1].split("::"),m=u[0],p=$(c).data();if(p){var g=p.id&&null!=p.id?p.id:"";if(o[m]=[g,u[1],u[2],u[3]],!g&&null!=r){var h=t+" "+p.displaylabel;r.contains(h)||(a[t]&&a[t].push(p.displaylabel),r.push(h))}}}}}return null!=a?a:o},showHideMenu:function(e,t,r,a,o,i){$("#actionMenu").hide();var n=$("#"+a);if(n.is(":visible"))n.hide();else{var s=$("#customButtonDetails").offset(),l=n.width(),c=$(window).width(),d=$("span[id=customButtonDetails]:visible").eq(0).width();switch(e){case"listView":(u=$(".eachRecord")).is(":visible")&&u.hide(),n.css({padding:"0 16px 16px",top:s.top+33,right:c-(s.left+d+18)}).show();break;case"withoutRecord":var u;(u=$(".eachRecord")).is(":visible")&&u.hide(),s=$("#customButtonDetailsWithoutRec").offset(),d=$("#customButtonDetailsWithoutRec:visible").eq(0).width(),n.css({padding:"0 16px 16px",top:s.top+35,right:c-(s.left+d+18)}).show();break;case"create":case"cbedit":case"createclone":if("customButtonDetailsBottom"==i){s=$("#customButtonDetailsBottom").offset();var m=n.height();d=$("span[id=customButtonDetails]:visible").eq(0).width();n.css({padding:"0 16px 16px",top:s.top-m,right:c-(s.left+d)-16}).show(),"cbedit"==e&&n.css({padding:"0 16px 16px",top:s.top-145,right:c-(s.left+d)-16}).show()}else s=$(".customPluswithImpotBtnCon:visible").eq(0).offset(),n.css({top:s.top+33,right:c-(s.left+d+16)}).show();break;case"eachRecord":var p=$(".listView");p.is(":visible")&&p.hide();var g=$("#customButtonDetails_"+t);s=g.offset(),d=g.width();n.is(":visible")?n.hide():(l=n.width(),n.css({padding:"0 16px 16px",top:s.top+32,right:c-(s.left+d)-16}).show());break;default:$("#customButtonDetails").hasClass("btntoolsIdIsBottom")?n.addClass("btntoolsIdBottom").css({padding:"16px 16px 0",top:s.top-($("."+buttonId).outerHeight()+8),left:s.left-l+16}).show():n.css({padding:"0 16px 16px",top:s.top+33,right:c-(s.left+d+16)}).show()}CustomButtonJSObjectInit.isRecordLocked()||CustomButtonJSObjectInit.sortable(r,a,o,null,t)}},timeoutId:null,isRecordLocked:function(){return detailView.changedBCJson&&detailView.changedBCJson.hasOwnProperty("recordLockingDetails")&&detailView.changedBCJson.recordLockingDetails.hasOwnProperty("restricted_custom_buttons")&&Array.isArray(detailView.changedBCJson.recordLockingDetails.restricted_custom_buttons)&&detailView.changedBCJson.recordLockingDetails.restricted_custom_buttons.length>0},relatedListDropDown:function(e,t,r,a,o,i,n){var s=$("#"+n);s.removeClass("customButtonDom"),$(".customButtonDom").show()&&($(".customButtonDom").hide(),s.addClass("customButtonDom"));var l=JSON.parse(e),c=l[0].listRelationId,d=a+"_"+c,u={};u.cbArray=l;var m=l.length;u.btnCount=m;var p={};if(p.module=a,p.entityId=t,p.position=r,p.buttonDetails=u,p.sorterId="sorterId_"+c,p.buttondivId=a+"_"+c,p.relatedListId=c,$("#"+d).is(":visible"))$("#"+d).hide();else{Handlebars.registerPartial("customButtonDropDown",Handlebars.templates.customButtonDropDown),$("#tabLayer").after(Handlebars.templates.customButtonDropDown(p));var g=$(window).width(),h=$("#custBtnRel_"+c),v=h.width(),f=h.offset();$("#"+d).css({padding:"0 16px 16px",display:"block !important",top:f.top+32,right:g-f.left-v-16}).show()}CustomButtonJSObjectInit.isRecordLocked()||CustomButtonJSObjectInit.sortable(i,d,"sorterId_"+c,null,t)},showCusBtnDetTt:function(e,t,r,a,o){$("#"+a).addClass("ui-sortable-helper"),$(".cbBtnValue").removeClass("hide"),$(".ui-sortable-handle").removeClass("handCursorIcon"),CustomButtonJSObjectInit.timeoutId||(CustomButtonJSObjectInit.timeoutId=window.setTimeout((function(){if(CustomButtonJSObjectInit.timeoutId=null,""==r||"null"==r?$("#btnDesc,#btnToolTipDescDiv").hide():(r=r.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<br>/g,"\n"),$("#btnDesc,#btnToolTipDescDiv").show()),pos=$(e).offset(),$("#btnToolTipNameDiv").text(t),$("#btnToolTipDescDiv").text(r),$(e).hasClass("customImportBtn"))Crm.userDetails.RTL_ENABLED?($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-10,left:pos.left+($(e).outerWidth()+15)}).show(),$L(".cusBtnDetTt .yellowTopArw").css({top:"8px",left:"-12px",right:""})):$(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-10,left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show();else if(Crm.userDetails.RTL_ENABLED){$("#btntoolsId").hasClass("btntoolsIdBottom")?($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-($(".cusBtnDetTt").outerWidth()-$(e).outerWidth()),right:renderingUtils.windowWidth-(pos.left+$(e).outerWidth())-($("#cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"auto",bottom:"4px"})):($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top,right:renderingUtils.windowWidth-(pos.left+$(e).outerWidth())-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"8px",bottom:"auto"}))}else $(e).closest("#btntoolsId").hasClass("btntoolsIdBottom")?($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-($(".cusBtnDetTt").outerHeight()-$(e).outerHeight()),left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"auto",bottom:"4px"})):($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top,left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"8px",bottom:"auto"}))}),3e3))},hideCusBtnDetTt:function(e){$("#"+e).removeClass("ui-sortable-helper"),$(".cusBtnDetTt").removeClass("cusBtnDetTtAct"),CustomButtonJSObjectInit.timeoutId&&(window.clearTimeout(CustomButtonJSObjectInit.timeoutId),CustomButtonJSObjectInit.timeoutId=null)},createCustBtnPage:function(e,t){switch(store.clearCachedQuery("custom_button",{module:moduleRecordMapping[e].api_name}),t){case"eachRecord":t="list_view_each_record";break;case"listView":t="list_view";break;case"viewEntity":t="view";break;case"withoutRecord":t="list_view_without_record";break;case"edit":case"cbedit":t="edit";break;case"createclone":t="create_clone"}"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled?renderingUtils.displayPermissionDenied():networkUtils.openUrl(Lyte.Router.getURL("crm.settings.section.modules.module.custom-button.custom-button-create",e,{position:t}))},manageCustBtn:function(e){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.modules.module.custom-button.custom-button-index",e)},sortable:function(e,t,r,a){var o="#"+r;0!==$("#"+r+"_semodule").length&&(o=o+",#"+r+"_semodule"),0!==$("#"+r+"_contactmodule").length&&(o=o+",#"+r+"_contactmodule"),$(o).sortable({axis:"y",start:function(e,t){t.item.on("click.prevent",(function(e){e.preventDefault()}));var r=$(t.item);r.addClass("handCursorIcon"),$(".cbBtnValue").addClass("hide");var a=r.attr("class");(a.indexOf("contactmodule")>=0||a.indexOf("semodule")>=0)&&crmui.showMsgBand("info",I18n.getMsg("crm.custombutton.sort.msg"),3e3),$("#listViewToolTipDiv").removeClass("cusBtnDetTtAct"),t.item.on("click.prevent",(function(e){e.preventDefault()}))},stop:function(e,t){setTimeout((function(){t.item.off("click.prevent")}),300),$(".ui-sortable-handle").removeClass("handCursorIcon")},update:function(t,a){a.item.on("click.prevent",(function(e){e.preventDefault()}));var o="#"+r;0!==$("#"+r+"_semodule").length&&(o=o+",#"+r+"_semodule"),0!==$("#"+r+"_contactmodule").length&&(o=o+",#"+r+"_contactmodule");for(var n=$(o).children(),s=n.length,l=[],c=0;c<s;c++){var d=JSON.parse($(n[c]).attr("data-params").replace(/\\x20/g," "));l.push(d.buttonId)}var u,m={},p=JSON.parse($(n[0]).attr("data-params").replace(/\\x20/g," ")),g=p.moduleName,h=p.position,v={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(m.step="sortButtonOrder",m.position=h,m.moduleName=g,"viewEntity"===h&&detailView.entityId&&(m.entityId=detailView.entityId),"relatedlist"===h&&(u=r.split("_")[1],m.listRelationId=u),l.length>1)&&(m.order=l.toString(),CustomButtonJSObjectInit.sortedOrderButtonIds=l,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomButton.do?",type:"POST",data:m,headers:v,success:function(e){}}));var f=p.buttonId,C=p.entityId,y=p.buttonName,b=decodeURIComponent(p.buttonDesc);$("."+e).val();if(onclickStr="return CustomButtonJSObjectInit.execute('"+f+"','"+h+"','"+C+"',"+u+",'"+g+"');",dataParamStr="{buttonId:'"+f+"',entityId:'"+C+"'}",mouseOverStr="$('#btntoolsId').hide(); CustomButtonJSObjectInit.showCusBtnDetTt(this,'"+y+"','"+b+"')",$("."+e).val(y).attr("data-params",dataParamStr).attr("onmouseover",mouseOverStr).attr("onclick",onclickStr),"listView"==h||"eachRecord"==h){var I=l.length,T={buttonDetails:[]};for(i=0;i<I;i++){var w=JSON.parse($(n[i]).attr("data-params").replace(/\\x20/g," "));f=w.buttonId,y=w.buttonName,b=decodeURIComponent(w.buttonDesc);T.buttonDetails.push({name:y,desc:b,key:f})}switch(h){case"listView":crmTab.cacheObj[g].customButtonMap.cbArray=T.buttonDetails,crmTab.cacheObj[g].customButtonMap.buttonCount=I;break;case"eachRecord":crmTab.cacheObj[g].customButtonListViewEachRecordMap.cbArray=T.buttonDetails,crmTab.cacheObj[g].customButtonListViewEachRecordMap.buttonCount=I}}CustomButtonJSObjectInit.update=!0}}),$(o).disableSelection()},sortButtons:function(e){let t=CustomButtonJSObjectInit.sortedOrderButtonIds;const r=(e,r)=>{let a=t.indexOf(e.key),o=t.indexOf(r.key);return a<o?-1:o<a?1:0};if(t&&t.length&&Object.keys(e).length)for(const t in e){let a=e[t];Array.isArray(a)&&(a=a.sort(r)),e[t]=a}return e},getCustomButtonDtls:function(e,t,r,a,o,i,n){var s=t+r;$("#"+s).remove(),CustomButtonJSObjectInit.customButtonSearch($("#buttonSearch").val("").trigger("keyup")),$("#noButtonFound").hide(),hideMenu();if($("#entityIdEachRec").length)$("#entityIdEachRec").val(i);else{var l='<input type="hidden" value="'+i+'" id="entityIdEachRec"/>';$("#tabLayer").after(l)}var c={};c.module=t,c.position=r;var d=JSON.parse(e);if(Object.keys(CustomButtonJSObjectInit.cscriptChecks.rename).length>0){var u=Object.keys(CustomButtonJSObjectInit.cscriptChecks.rename);d.cbArray.forEach((function(e){u.indexOf(e.key)>=0&&(e.name=CustomButtonJSObjectInit.cscriptChecks.rename[e.key])}))}c.buttonDetails=d;let m=CustomButtonJSObjectInit.findOtherCBArray(c.buttonDetails);c.buttonDetails=CustomButtonJSObjectInit.sortButtons(m),c.buttondivId=s,c.sorterId=o,c.entityId=i,Handlebars.registerPartial("customButtonDropDown",Handlebars.templates.customButtonDropDown),$("#tabLayer").after(Handlebars.templates.customButtonDropDown(c));try{if(CustomButtonJSObjectInit.cscriptChecks.restrict.length>0){let e=$L(".cscriptCustButton");if(e){let t=e.length;for(let r=0;r<t;r++){let t=JSON.parse(e[r].dataset.params);t&&t.buttonId&&CustomButtonJSObjectInit.cscriptChecks.restrict.includes(t.buttonId)&&e[r].classList.add("peNone","disable","cscript_disable")}}}}catch(e){murphy.error("Error disabling / enabling custom button ",e)}return CustomButtonJSObjectInit.showHideMenu(r,i,a,s,o,n),CustomButtonJSObjectInit.showOrHideButtons(),$L("#sortableListView").scrollTop(0),!1},showOrHideButtons:function(){var e=Crm.userDetails.LICENSE_TYPE;!!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Customize_Zoho_CRM")&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&["E","A","Z","C","U","D"].contains(e)||($L("#createCustomButtonDiv").hide(),$L("#manageCustomButtonDiv").hide(),$L("#detailsCB").hide())},findOtherCBArray:function(e){for(var t=0;t<2;){if(e.hasOwnProperty("cbArray")){var r=e.cbArray.length-1;if(0!==e.cbArray.length&&e.cbArray[r].hasOwnProperty("dependentCBArray")){var a=e.cbArray.pop();e.dependentCBArray=a.dependentCBArray,r=e.cbArray.length-1}if(0!==e.cbArray.length&&e.cbArray[r].hasOwnProperty("dependentContactCBArray")){a=e.cbArray.pop();e.dependentContactCBArray=a.dependentContactCBArray,r=e.cbArray.length-1}}t+=1}return e.hasOwnProperty("cbArray")&&1===e.cbArray.length&&e.cbArray[0].hasOwnProperty("notInCurrentModule")&&e.cbArray[0].notInCurrentModule&&e.cbArray.pop(),e},customButtonSearch:function(e,t,r){var a,o=0;(n=$("#"+t)).sortable("enable"),a=$(e).length>0?$(e).val().toLowerCase():"";var i=$("."+r),n=$("#"+t),s=$("#noButtonFound");if(a.length>=1||""==a){for(var l=i.length,c=0;c<l;c++){var d=i[c],u=$(d);""==a||u.text().toLowerCase().indexOf(a)>-1?(u.addClass("active searchDisplay").removeClass("searchLbl").show(),o++,n.sortable("disable")):(u.removeClass("active searchDisplay").addClass("searchLbl").hide(),n.sortable("disable"))}0==o?(s.attr("style","color:#adadad; padding:10px 27px 0px !important;").show(),s.click(!1),n.hide()):(s.hide(),n.show())}""==a&&n.sortable("enable")},divDeletion:function(e,t){CustomButtonJSObjectInit[e]=t},moduleOnChange:function(){var e=$("#ModuleListUL :selected").val(),t=$L("crm-wizard-builder")[0];Lyte.Router.getRouteInstance().routeName.includes("wizard")&&(e=t.getData("primaryModule.module_name"));var r=$("#urlContent"),a=$("#createWhereSelect");if(-1==e)$("#trCreateWhere,#trButtonName,.viewPlace,#trDesc,#trCBOptions,.selectedactionsCtn,.viewBtnPlace,#trCBDisplay,#trCBProfile,#trCBLocationDetail").addClass("hide"),r.addClass("hide"),a.val("-1"),$("#buttonAction").val("-1").trigger("change.select2"),$("#expression,#buttonLabel,#description").val(""),$("#savebtn").addClass("inActiveSec");else if(null!=r.attr("class")&&-1===r.attr("class").indexOf("hide")||-1===$("#customFunctionNameDisp").attr("class").indexOf("hide")){if(confirm(I18n.getMsg("crm.custombutton.ChangeModuleConfirm"))){$("#expression").val("");e=$("#ModuleListUL :selected").val();Lyte.Router.getRouteInstance().routeName.includes("wizard")&&(e=t.getData("primaryModule.module_name")),$("#trCBDisplay,#trCBProfile,#trCBLocationDetail").addClass("hide"),$("#savebtn").addClass("inActiveSec"),$("#buttonAction").val("-1").trigger("change.select2"),null!=r.attr("class")&&-1===r.attr("class").indexOf("hide")&&r.addClass("hide"),-1===$("#customFunctionNameDisp").attr("class").indexOf("hide")&&($("#customFunctionNameDisp,#editCustomFunction,#remoteCustomFunction,#undoCustomFunctionChange").addClass("hide"),$("#workflowLinkId").val(""),$("#buttonActionSelect").removeClass("hide"))}}else $("#trButtonName,#trCreateWhere,#descLink").removeClass("hide")},customBtnMouseOver:function(e){if("eachRecord"!=e)return!1;var t="#customButtonDetails_"+$("#entityIdEachRec").val();$(t).attr("style","visibility:visible"),$(t).closest("tr").removeClass("bg_white"),$(t).closest("tr").addClass("bg_crmSelectBg")},customBtnMouseOut:function(e){if("eachRecord"!=e)return!1;var t="#customButtonDetails_"+$("#entityIdEachRec").val();$(t).attr("style","visibility:hidden"),$(".customButtonDom").hide(),$(t).closest("tr").removeClass("bg_crmSelectBg"),$(t).closest("tr").addClass("bg_white")},selectRecord:function(e,t){var r=$(e).attr("id"),a=r.split("_")[1],o=$(e).attr("class"),i=$(e).attr("value"),n=i.split("_")[1],s=$("#"+t).width();$("#"+r).closest(".component1").hasClass("pR")||$("#"+r).closest(".component1").addClass("pR");var l=$("#customButtonDetails_"+n);if(l.css("left",s+30),o.indexOf("customCheckBoxChecked")>-1){$(e).addClass("customCheckBox"),$(e).removeClass("customCheckBoxChecked"),$("#"+i).removeClass("customCheckBoxChecked"),$("#"+i).addClass("customCheckBox");var c=CustomButtonJSObjectInit.checkBox[i].indexOf(a);c>-1&&CustomButtonJSObjectInit.checkBox[i].splice(c,1);var d=$(".customCheckBoxChecked[data-cid=selectEntity_"+n+"]").length;$("#relatedListRecVal_"+i.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[i].length),d>=1?1==Crm.userDetails.detailView_newUI?(l.animate({top:8},500).show(),l.addClass("dVHierarchyView")):l.animate({top:-5},500).show():(l.animate({top:40},500,(function(){l.hide()})),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].hideOnCheckRlActions(n):crmRelatedList.hideOnCheckRlActions(n))}else{if($(".customCheckBoxChecked[data-cid=selectEntity_"+n+"]").length===crmConstants.maxSelectCount)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));$(e).removeClass("customCheckBox"),$(e).addClass("customCheckBoxChecked");d=$(".customCheckBoxChecked[data-cid=selectEntity_"+n+"]").length;$(".customDom[data-cid=selectEntity_"+n+"]").length==d&&($("#"+i).removeClass("customCheckBox"),$("#"+i).addClass("customCheckBoxChecked")),CustomButtonJSObjectInit.checkBox||(CustomButtonJSObjectInit.checkBox={}),CustomButtonJSObjectInit.checkBox[i]||(CustomButtonJSObjectInit.checkBox[i]=new Array),CustomButtonJSObjectInit.checkBox[i].push(a),$("#relatedListRecVal_"+i.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[i].length),1==Crm.userDetails.detailView_newUI?($("#customButtonDetails_"+n).addClass("dVHierarchyView"),$("#customButtonDetails_"+n).animate({top:8},500).show()):$("#customButtonDetails_"+n).animate({top:-5},500).show(),1===d&&(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].showOnCheckRlActions(n):crmRelatedList.showOnCheckRlActions(n))}},selectAllRecord:function(e,t){var r=$(e).attr("value"),a=$(e).attr("id"),o=a.split("_")[1];if($("#"+a).closest(".component1").hasClass("pR")||$("#"+a).closest(".component1").addClass("pR"),$("#customButtonDetails_"+o).css("left",$("#"+t).width()+30),$(e).attr("class").indexOf("customCheckBoxChecked")>-1){var n=$(".customDom[data-cid=selectEntity_"+o+"]");for(i=0;i<n.length;i++){(s=CustomButtonJSObjectInit.checkBox[r].indexOf(n[i].id.split("_")[1]))>-1&&CustomButtonJSObjectInit.checkBox[r].splice(s,1),$("#"+n[i].id+"[data-cid=selectEntity_"+o+"]").removeClass("customCheckBoxChecked").addClass("customCheckBox")}$("#"+a).removeClass("customCheckBoxChecked"),$("#"+a).addClass("customCheckBox"),$("#relatedListRecVal_"+r.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[r].length),0==CustomButtonJSObjectInit.checkBox[r].length&&$("#customButtonDetails_"+o).animate({top:40},500,(function(){$("#customButtonDetails_"+o).hide()})),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].hideOnCheckRlActions(o):crmRelatedList.hideOnCheckRlActions(o)}else{null==CustomButtonJSObjectInit.checkBox?(CustomButtonJSObjectInit.checkBox={},CustomButtonJSObjectInit.checkBox[r]=new Array):null==CustomButtonJSObjectInit.checkBox[r]&&(CustomButtonJSObjectInit.checkBox[r]=new Array);n=$(".customDom[data-cid=selectEntity_"+o+"]");for(i=0;i<n.length;i++){var s=CustomButtonJSObjectInit.checkBox[r].indexOf(n[i].id.split("_")[1]);if(CustomButtonJSObjectInit.checkBox[r].length==crmConstants.maxSelectCount)return renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)),void CustomButtonJSObjectInit.showRLCustomBtnActions(r,o);s>-1||CustomButtonJSObjectInit.checkBox[r].push(n[i].id.split("_")[1]),$("#"+n[i].id+"[data-cid=selectEntity_"+o+"]").removeClass("customCheckBox").addClass("customCheckBoxChecked")}$("#"+a).removeClass("customCheckBox"),$("#"+a).addClass("customCheckBoxChecked"),CustomButtonJSObjectInit.showRLCustomBtnActions(r,o)}},buttonExecuteResp:function(e,t,r,a){var o=$.parseJSON(e);o&&"kiosk"!==o.buttonType&&(CustomButtonJSObjectInit.requestButtonSend=!0),t||(t=o.buttonPosition);var i=!0;if(o.empty_fields)return delete o.empty_fields,o.proceed_empty=!0,Lyte.registeredMixins["crm-view-utils"].executeCustomButtons(o),void crmui.hidePopup("customButtonPopUp");var n=o.returnValue;if(o.isError&&crmui.showMsgBand("warning",o.errorMsg,"2000"),n)return CustomButtonJSObjectInit.processError(o,t),!1;if("customfunctions"===o.buttonType&&!0===o.isErrorValue){i=!1,crmui.hidePopup("customButtonPopUp");var s={step:"executeCBAction"};delete o.isErrorValue,s.buttonDetailsMap=JSON.stringify(o),s[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomButton.do",data:s,success:function(e){return o=$.parseJSON(e),CustomButtonJSObjectInit.buttonResponseToLoad(o,t),!1}})}if("viewEntity"===t&&"circuit"===o.buttonType)$L("crm-circuits-rl-body").length?Lyte.triggerEvent("cirRlLabel_reloadCircuits"):null!=detailView.currentModule&&null!=detailView.entityId&&o.module===detailView.currentModule&&(o.isRefreshOnProcess=!0,CustomButtonJSObjectInit.refreshPage(detailView.currentModule,detailView.entityId,(function(){o.isRefreshOnProcess=!1,CustomButtonJSObjectInit.processCircuitResponse(o)})));else if("customfunctions"!==o.buttonType||"createclone"!==t&&"cbedit"!==t||"executeCB"==r){if("kiosk"===o.buttonType&&o.kioskId){var l=networkUtils.returnDependencyFiles(["kiosk-execute.js","kiosk-listview-component.js","crm-model-kiosk.js","kiosk-pb-builder-output.js","crm-emailconversation-view-helpers.js","lyte-fileupload.js","kiosk-file-api.js"],ResourceConstants.CRMClient);l=(l=(l=l.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("kiosk")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zlib_phonenumber.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["kiosk-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(l,void 0,(function(){Lyte.registeredMixins.kiosk_execute.setKioskExecution(!1),Lyte.registeredMixins.kiosk_execute.renderExecuteKiosk(o.kioskId,"buttons",!0,a)}))}}else{i=!1,t="createclone"===t?"create":t;var c=o.id,d=o.paramValuejsonObj,u=o.lookupRecordsMap,m=o.defaultLookupRecordsMap,p=o.module,g=crmCommonModule.createEditJson.module,h=(a="cbedit"===(t="cbeditInv"===t?"cbedit":t)?window[g].entityId:1,"step=executeCB&buttonId="+c+"&cbParamValue="+encodeURIComponent(JSON.stringify(d))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+p+"&entityId="+a+"&pos="+t+"&lookupRecordsMap="+JSON.stringify(u)+"&defaultLookupRecordsMap="+JSON.stringify(m)),v=Crm.getCrmBasePath()+"/CustomButton.do";(new crmRequestPool).doAjax(v,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e),CustomButtonJSObjectInit.showButtonErrorMsg(e)&&CustomButtonJSObjectInit.buttonExecuteResp(e,t,"executeCB")}),h)}i&&CustomButtonJSObjectInit.buttonResponseToLoad(o,t)},refreshPage:function(e,t,r){"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName?Lyte.Router.getRouteInstance().refresh():(crmTab.deleteFromCache(e),reloadCurrentEntityView(t,e,(function(){r&&r()})))},buttonResponseToLoad:function(e,t){var r="";if(e.isWebTab&&(CustomButtonJSObjectInit.webtabparams=e.webtabparams,"create"!=e.buttonPosition&&"cbedit"!==e.buttonPosition&&"createclone"!==e.buttonPosition||(CustomButtonJSObjectInit.webtabparams=e.webtabparams,e.url=e.weburl)),"url"===e.buttonType){switch(e.buttonDisplay){case"sametab":r="_top";break;case"newwindow":r="newWin";break;case"newtab":r="_blank"}"newWin"===r?openPopUp("newWin","",networkUtils.getOrgSpecificURL(e.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(networkUtils.getOrgSpecificURL(e.url),r)}else if("customfunctions"===e.buttonType){""!=e.alertMessage&&null!=e.alertMessage?networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(e.alertMessage),$("#cbExecutedPage").val(t)})):renderingUtils.removeFreezeLayer();var a=e.openURL;if(r=e.openIn,a&&CustomButtonJSObjectInit.isValidWebUrl(a))if(Crm.userDetails.CUSTOM_BUTTON_CUSTOM_FUNCTION_OPEN_URL_NEW_FLOW){const t=e.height||1e3,o=e.width||800;let i,n="_blank";switch(r){case"same window":n="_top";break;case"popup window":i=`height=${t},width=${o},menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes`;break;case"parent window":window.opener&&(window.opener.open(a,"_blank"),n=void 0)}n&&networkUtils.openUrl(networkUtils.getOrgSpecificURL(a),n,i)}else switch(r){case"iframe":$("#"+e.frameElement).attr("src",a);break;case"Popup window":case"popup window":width=e.width,height=e.height,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.winObj=window.open(networkUtils.getOrgSpecificURL(e.openURL),"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=1,location=no,directories=no");break;case"New window":openPopUp("newWin","",networkUtils.getOrgSpecificURL(a),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");break;case"parent window":window.parent.location.href=networkUtils.getOrgSpecificURL(e.openURL);break;default:window.winObj=e.successiveTab?window.open(networkUtils.getOrgSpecificURL(a)):window.open(networkUtils.getOrgSpecificURL(a),r)}}else if("circuit"!==e.buttonType||e.isRefreshOnProcess){if("widget"===e.buttonType){if(e.ButtonID){var o,i=e.WidgetData;if(e.relatedListId)if(Crm.userDetails.isRelatedListLyteEnabled)(o=Lyte.registeredMixins["crm-related-list-utils"].getPersonalityModuleObj(e.relatedListId))&&(i.Entity=CrmWidgets.Utils.GetSysRefFromTabName(o.module.api_name));else(o=crmRelatedList.getPersonalityModuleObj(e.relatedListId))&&(i.Entity=CrmWidgets.Utils.GetSysRefFromTabName(o.module));var n=e.ButtonID,s="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",n):void 0;s&&WidgetHandler.CustomButtons.render(s,i,t)}}else if("component"===e.buttonType&&e.ButtonID){let r={};e.argParamJSON&&Object.keys(e.argParamJSON).length&&Object.keys(e.argParamJSON).forEach((t=>{if(t.startsWith("arg-")){let a=t.substring(4);r[a]=e.argParamJSON[t]}else r[t]=e.argParamJSON[t]})),CustomButtonJSObjectInit.renderButtonLux(e.ButtonID,{position:t,...e.LuxData,arguments:r})}}else CustomButtonJSObjectInit.processCircuitResponse(e);crmui.hidePopup("customButtonPopUp"),commonUtils.showHideLoadingDiv()},renderButtonLux:function(e,t){return new Promise((r=>{let a={position:"POPUP",listRelationId:e,infos:t,onsuccess:function(){r(!0)},onerror:function(){r(!1)}};Lyte.triggerEvent("render",a)}))},isValidWebUrl:function(e){if(""==e)return!0;return new RegExp('^(http:\\/\\/www.|https:\\/\\/www.|ftp:\\/\\/www.|www.|http:\\/\\/|https:\\/\\/|ftp:\\/\\/|){1}[^\0-"-%\'-,.-/:@[-^`{-{}-]+(\\.[^\0-"$%\',.-/<>@[-^`{-{}-]+)+(/[^\0-"(-)<>^{-{}-]*)*$').test(e)},processError:function(e,t){Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_customButtonPopup.js"],ResourceConstants.CRM)).then((function(){for(var r={Message:[]},a={},o=[],i=e.returnValue,n=i.length,s=[],l=0;l<n;l++)for(var c in i[l]){var d=i[l][c],u=c+" "+d;s.contains(u)||(void 0===a[c]?(o[c]=[],o[c].push(d),a[c]=o[c]):(o[c].push(d),a[c]=o[c]),r.Message.push(u),s.push(u))}delete e.returnValue;var m={},p=e.moduleName;a=CustomButtonJSObjectInit.processForLookupRecords(e.lookupFieldsDataMap,p,s,a),a=CustomButtonJSObjectInit.processForDefaultLookupRecords(e.defaultLookupFieldObject,p,s,a),m.errorMessage=a,m.jsonResString=e,m.position=t,Handlebars.registerPartial("CustomButtonPopup",Handlebars.templates.CustomButtonPopup),$("#tabLayer").after(Handlebars.templates.CustomButtonPopup(m)),crmui.showPop("customButtonPopUp")}))},removeDisabledSaveOfLink:function(){var e=$("#create");e.prop("disabled",!1),e.css("opacity","")},setHeightForDelugeEditor:function(){var e=$("#delugeEditorArea"),t=$("#wfDelugeEditorDIV").find(".wf_newUi_form"),r=e.find("#dreTopBar"),a=$("#delugeLeftPane"),o=$("#delugeEditorCont"),i=o.find(".CodeMirror"),n=o.find("#codemirror_scroll"),s=$("#dreEditorFooter"),l=$("#wfDelugeEditorDIV").find(".pp-content").height()-(t.outerHeight()+15),c=l-r.outerHeight(),d=c-s.outerHeight();a.css({height:c}),i.css({height:d}),n.css({height:d}),o.css({height:c}),$("#wfDelugeEditorInnerDIV").css({height:l}),e.css({height:l})},setDelugeDivHeight:function(e){"true"==e&&setTimeout((function(){CustomButtonJSObjectInit.setHeightForDelugeEditor(),$("#wfDelugeEditorDIV .pp-footer").removeClass("box-sh")}),300)},showButtonErrorMsg:function(e){if("RECORD_LOCKED"===e)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.record.locking.permission.denied"),ltPropDuration:1500}}),!1;if("button_action_error"===e)return crmui.showMsgBand("warning",I18n.getMsg("crm.security.error.add.user"),1500),!1;if("UNABLE_EXECUTE_THE_SCRIPT"===e||"FUNCTION_ERROR_OUTPUT"===e)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("Sorry, the button action couldn't be completed as some error occurred in the intended function. Please check your function."),ltPropDuration:5e3}}),!1;if("TOO_MANY_REQUESTS"===e)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("Sorry, the action can’t be performed as you have reached the allowed functions call limit that can be made in the last 24 hours"),ltPropDuration:3e3}}),!1;if("CIRCUITS_EXECUTION_LIMIT_REACHED"===e)return crmui.showMsgBand("error",I18n.getMsg("crm.circuits.limit.exceeded"),5e3),!1;if("CIRCUITS_FEATURE_NOT_AVAILABLE"===e)return crmui.showMsgBand("error",I18n.getMsg("crm.circuits.button.feature.not.available",Crm.brandName),5e3),!1;if("CIRCUITS_ACCOUNT_FREEZED"===e)return Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.admin",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.nonadmin",Crm.brandName),5e3),!1;if("CIRCUITS_TYPE_NOT_ALLOWED"===e)return Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),5e3),!1;if("SOCKET_CLOSED"===e)return _cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:I18n.getMsg("Sorry, Your Button's function takes more than 10s to execute. We will notify you once it completed"),ltPropDuration:4e3}}),!1;try{var t=JSON.parse(e);if(t.creator_error){if("TOO_MANY_REQUESTS"===t.creator_error)return crmui.showMsgBand("error","Sorry, the action can’t be performed as you have reached the allowed functions call limit that can be made in the last 24 hours",2500),!1;"SOCKET_CLOSED"===t.creator_error&&crmui.showMsgBand("warning","Sorry, Your Button's function takes more than 10s to execute. We will notify you once it completed",4e3)}}catch(e){return!0}return!0},unselectAllRecord:function(e,t,r){var a=$(e).attr("value");if(Crm.userDetails.isRelatedListLyteEnabled&&r){var o=$L("#"+r).closest("crm-related-list-view-header");if(o&&o[0]&&o[0].component)return o[0].component.setData({selectedIds:[]}),void o[0].component.handleCampaignsActions()}if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[a]&&0!==CustomButtonJSObjectInit.checkBox[a].length){var i=$(e).attr("id"),n=i.split("_")[1],s=$("#"+t).width()+10,l=$("#"+i);l.closest(".component1").addClass("pR");var c=$("#customButtonDetails_"+n);c.css("left",s);for(var d=$(".customDom[data-cid=selectEntity_"+n+"]"),u=d.length,m=0;m<u;m++){var p=CustomButtonJSObjectInit.checkBox[a].indexOf(d[m].id.split("_")[1]);p>-1&&CustomButtonJSObjectInit.checkBox[a].splice(p,1),$("#"+d[m].id).removeClass("customCheckBoxChecked").addClass("customCheckBox")}CustomButtonJSObjectInit.checkBox[a].length=0,l.removeClass("customCheckBoxChecked"),l.addClass("customCheckBox"),$("#relatedListRecVal_"+a.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[a].length),0==CustomButtonJSObjectInit.checkBox[a].length&&(c.animate({top:40},500,(function(){c.hide()})),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].hideOnCheckRlActions(n):crmRelatedList.hideOnCheckRlActions(n))}},clearDom:function(){$("#newRelatedListPopUpDiv").empty()},showModuleFields:function(e){var t=$(e),r=e.options[e.selectedIndex].value;$("#"+r+"_td").removeClass("dN"),$("#"+t.data("selectedModule")+"_td").addClass("dN"),t.data("selectedModule",r)},applySelectedFunctionCLNew:function(e){var t=e.options[e.selectedIndex].value;"-1"!==t&&CustomButtonJSObjectInit.insertAtCaret($("#txtarea_cl_url")[0],t),e.value="-1"},pushNotifyCx:function(e){$("#fin_notification").remove();var t="";try{var r=e.succeed_functions;if("functionsfailures"==Lyte.Router.getRouteInstance().routeName){for(var a=r.length,o=0;o<a;o++){var i=r[o];$("#failureRow_"+i).remove()}var n={};n.componentType=document.querySelector("#fail_function_category").ltProp("selected"),n.language=document.querySelector("#fail_function_lang").ltProp("selected"),n.start="1",n.limit="100",store.findAll("failures",n).then((function(e){$("crm-function-failureslist")[0].component.setData("functionFailures",e)}))}}catch(e){t=""}t=0!=e.successCount?I18n.getMsg("crm.functions.failures.alert.wms.few",[e.successCount,e.totalCount])+"<br>":I18n.getMsg("crm.functions.failures.alert.wms.none");var s='<div id="fin_notification" class="mig_notification dN" style="width:475px; bottom:28px;"><div class="migCardTitle"><div>'+(I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.functions.heading"))+'</div><div class="pA svgIconsImg top15 right15 ico-close-white-small2 cP" onclick="$(\'#fin_notification\').slideUp(); $(\'#fin_notification\').remove();"></div></div><div class="pT20 pB10 pR15 pL15"><div class="aligncenter mB15 wwBreakWord" onclick="$(\'#fin_notification\').slideUp(200)">'+t+"</div></div></div>";$("body").append(s),$("#fin_notification").slideDown()},constructJsonForCreatePage:function(e){var t={};try{for(var r=Crm.fieldsObj[e].length,a=0;a<r;a++)if(!Crm.fieldsObj[e][a].endsWith("SALUTATION")){var o=$("#"+Crm.fieldsObj[e][a]),i=o.attr("data-uitype"),n=o.attr("data-sysrefname"),s={column_name:o.attr("data-colname"),uitype:i};try{var l=CustomButtonJSObjectInit.getFieldValueforCF(!0,"edit",s,void 0,void 0,void 0,e);""!==(l=CustomButtonJSObjectInit.getValueBasedOnUIType(l,parseInt(i)))&&(t[n]=l)}catch(e){}}return t}catch(e){return t}},getFieldValueforCF:function(e,t,r,a,o,i,n){var s=null,l=r.column_name;"view"!=t||"FIRSTNAME"!=r.column_name&&"SALUTATION"!=r.column_name?"SALUTATION"==r.column_name&&(l="LASTNAME"):l="LASTNAME";var c=!1;o&&(null!=a?c=a==l:Crm.VR&&(Crm.VR.ajaxEditFailedFields&&Crm.VR.ajaxEditFailedFields.contains(l)||Crm.VR.ajaxEditFieldLabel&&Crm.VR.ajaxEditFieldLabel==l)&&(c=!0));var d=!0;i&&!c&&null!=Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(l)&&(c=!0),(i&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(l)||Crm.VR&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(l))&&(c=!0,d=!1);var u=CustomButtonJSObjectInit.getElemId(c&&"print"!=t?"edit":t,l,n);d&&(i&&(null==Crm.VR.globalAjaxEditedFields||null!=Crm.VR.globalAjaxEditedFields&&!Crm.VR.globalAjaxEditedFields.contains(l))?s=getFieldVal(l):o&&!c&&null==a&&Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(l)&&(s=Crm.VR.ajaxEditFailedFieldValues[l]));var m=$("#"+u),p=!1;if(void 0!==Crm.VR&&null!=Crm.VR){if(Crm.VR.IsQuickCreate&&"Tasks"==validationRuleModule&&"SUBJECT"==l)u="task_subject",m=$("#"+u);else if(Crm.VR.IsQuickCreate&&0==m.length){var g=$("."+u);1==g.length&&(m=g)}Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(l)&&(p=!0),null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(u=Crm.VR.SC_fieldsMap[l],m=$("[id='"+u+"']"))}if(m.length>0&&(m.is(":visible")||p)||null!=s){var h=null;null==s&&(c&&"view"==t||"edit"==t?300==r.uitype||301==r.uitype?s=m.is(":checked"):14==r.uitype||333==r.uitype||786==r.uitype||30==r.uitype?(s=m.val(),Crm.VR&&Crm.VR.fromSC||(h=$("#"+u+"_TimeOption").val()),null!=h&&""!=h||void 0===Crm.VR||null==Crm.VR||(Crm.VR.IsQuickCreate?h=$("#"+l+"dateTime").val()+" "+$("[id='property("+l+"ampm)']").val():Crm.VR.fromSC&&(h=$("."+l+"_timefrmhour").val()+":"+$("."+l+"_timefrmminute").val()+" "+$("."+l+"_timefrmampm").val())),""!=s&&""!=h&&(s=getDateObjectFromDateTimeStr(s,h))):(s=m.val(),void 0!==Crm.VR&&null!=Crm.VR&&"STAGE"==r.column_name&&null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(s=m.find("option:selected").text().replace(/[\r\n\t]/g,"")),24!=r.uitype&&202!=r.uitype||""==s||(s=Utils.convertUsrtoDefaultDatePattern(s))):s="FIRSTNAME"==r.column_name?m.data("params").nameInfo.firstname:"LASTNAME"==r.column_name?m.data("params").nameInfo.lastname:"SALUTATION"==r.column_name?m.data("params").nameInfo.salutation:null!=m.data("params").plainValue?m.data("params").plainValue:m.data("params").defaultvalue,"STAGE"==r.column_name&&s.indexOf(":")>-1&&("Deals"==n||"Potentials"==n)&&(s=Crm.getDealsStageValue(s)))}return s},getValueBasedOnUIType:function(e,t){switch(t){case CrmField.UITYPES.ACCOUNT_NAME_LOOKUP:case CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP:case CrmField.UITYPES.PRODUCT_NAME_LOOKUP:case CrmField.UITYPES.CONTACT_LOOKUP:case CrmField.UITYPES.OWNER:case CrmField.UITYPES.VENDOR_NAME_LOOKUP:case CrmField.UITYPES.POTENTIAL_ID:case CrmField.UITYPES.SALESORDER_ID:case CrmField.UITYPES.CONTACT_ID:case CrmField.UITYPES.QUOTE_ID:case 116:case CrmField.UITYPES.AGGREGATE_FIELD:case 123:case CrmField.UITYPES.LOOK_UP_ENTITY:case CrmField.UITYPES.CREATED_TIME:case CrmField.UITYPES.LAYOUT:case CrmField.UITYPES.TAGMODULEREFID:case CrmField.UITYPES.USERLOOKUP:case CrmField.UITYPES.MULTISELECT_LOOK_UP:case CrmField.UITYPES.CREATED_BY:case CrmField.UITYPES.RECORD_CURRENCY:case 51:case CrmField.UITYPES.PRODUCT_HANDLER:case 77:case CrmField.UITYPES.COMMENTCONTENTS:case CrmField.UITYPES.MULTI_PICK_LIST:case CrmField.UITYPES.MULTI_LINE_CF:case CrmField.UITYPES.AUTONUMBER:return"";case CrmField.UITYPES.DATE:case CrmField.UITYPES.DATE_LONG:if(!e)return"";var r=new Date(e),a="";return a=$.datepicker.formatDate("yy-mm-dd",r);case CrmField.UITYPES.DATE_TIME2:case CrmField.UITYPES.DATE_TIME1:case CrmField.UITYPES.DATE_TIME_LONG:case CrmField.UITYPES.DATETIME:if(!e)return"";r=new Date(e),a="";return a=$.datepicker.formatDate("yy-mm-ddT",r),a+=Utils.formatTimeVal(r.getHours())+":"+Utils.formatTimeVal(r.getMinutes())+":"+Utils.formatTimeVal(r.getSeconds()),Crm&&Crm.userDetails.TIME_ZONE&&(a+=Crm.userDetails.TIME_ZONE.replace(".",":")),a;case CrmField.UITYPES.BOOLEAN_DEF:case CrmField.UITYPES.BOOLEAN_DEF_NOT:return("true"===e||"1"===e||1==e)+"";case CrmField.UITYPES.PHONE:return e?commonUtils.getPlainPhoneNo(e):"";default:return void 0===e||""===e||null===e?"":e.trim()}},getElemId:function(e,t,r){if("edit"===e){if(!0===Crm.isCalendarSchedule)return t;var a="Crm_"+r+"_"+t;if(void 0!==Crm.VR&&Crm.VR.IsQuickCreate&&Crm.VR.IsSearchCreate){var o="createEntityForm #"+a;0==$("#"+o).length&&(o="createEntityForm ."+a),a=o}return a}return"view"===e?"mouseArea__"+t:"print"===e?"rowTR_"+t:void 0},showRLCustomBtnActions:function(e,t){$("#relatedListRecVal_"+e.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[e].length),1==Crm.userDetails.detailView_newUI?($("#customButtonDetails_"+t).animate({top:8},500).show(),$("#customButtonDetails_"+t).addClass("dVHierarchyView")):$("#customButtonDetails_"+t).animate({top:-5},500).show(),Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].showOnCheckRlActions(t):crmRelatedList.showOnCheckRlActions(t)},sandboxDiffPageDifferenceCheck:function(){var e=$("#parent_buttonLabel"),t=$("#buttonLabel"),r=$("#parent_description"),a=$("#description"),o=$("#parent_buttonActionSelect :selected").val(),i=$("#buttonActionSelect :selected").val();if(e.val()!=t.val()&&t.css("background-color","#FAE3B1"),r.val()!=a.val()&&a.css("background-color","#FAE3B1"),o===i&&"url"===o){var n=$("#parent_expression"),s=$("#expression");n.val()!=s.val()&&s.css("background-color","#FAE3B1")}},processCircuitResponse:function(e){var t=Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Advanced_Dev_Access")&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access;if(e.hasOwnProperty("circuitsInfo")&&e.circuitsInfo.hasOwnProperty("circuitId")&&!e.circuitsInfo.hasOwnProperty("scheduled")&&t)if(e.circuitsInfo.hasOwnProperty("executionUrl")){a=e.circuitsInfo.executionUrl;var r=e.circuitsInfo.name;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.trigger.success",e.circuitsInfo.name)+'. <span class="crmLinkColor cP" onClick="crmRelatedList.showCircuitPreview(\''+a+"','"+r+"')\">"+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>","5000")}else{var a=Crm.getCrmBasePath()+"/settings/circuits/executionLogs?circuit_id="+e.circuitsInfo.circuitId;Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Advanced_Dev_Access")&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access?crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.trigger.success",e.circuitsInfo.name)+'. <span class="crmLinkColor cP" onClick="crmRelatedList.showCircuitPreview(\''+a+"','"+r+"')\">"+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>","5000"):crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.trigger.success",e.circuitsInfo.name),4e3)}else e.circuitsInfo.hasOwnProperty("message")&&e.circuitsInfo.hasOwnProperty("status")&&"failure"===e.circuitsInfo.status?crmui.showMsgBand("error",e.circuitsInfo.message,4e3):e.hasOwnProperty("circuitsInfo")&&e.circuitsInfo.hasOwnProperty("scheduled")&&t?crmui.showMsgBand("success",I18n.getMsg("crm.circuits.schedule.success"),4e3):crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.trigger.success",e.circuitsInfo.name),4e3)},buttonWMSNotification:function(e){var t,r=$L("crm-create-buttons")[0];if(r&&r.component){var a=r.component.custombuttonWizardDetails;if(a&&a.buttonId===e.custombuttonid)return void r.component.fromCustomButtonWMS(r.component,e)}$("#fin_notification").remove(),t='<div id="fin_notification" class="mig_notification dN" style="width:475px; bottom:28px;"><div class="migCardTitle"><div>'+(I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.custombutton.execution.result"))+'</div><div class="pA svgIconsImg top15 right15 ico-close-white-small2 cP" onclick="$(\'#fin_notification\').slideUp(); $(\'#fin_notification\').remove();"></div></div><div class="pT20 pB10 pR15 pL15"><div class="aligncenter mB15 wwBreakWord">'+("success"===e.action?I18n.getMsg("crm.custombutton.execution.wms.success",e.execution_start_time)+I18n.getMsg("crm.custombutton.response")+"<b>"+e.data+"</b>":I18n.getMsg("crm.custombutton.execution.wms.failed",e.execution_start_time)+I18n.getMsg("crm.custombutton.response")+"<b>"+e.message+"</b>")+"</div></div></div>",$("#basic").append(t),$("#fin_notification").slideDown()},cscriptChecks:{restrict:[],rename:{}},getAPINameFromMergeField:function(e){for(var t,r=[],a=new RegExp(/\$\{([^\}].*?)\}/g);t=a.exec(e);){var o=t[1].split("."),i={};i.module=o[0],i.module_field=o[1],o.length>2&&(i.lookup_field=o[2]),r.push(i)}return r}},CrmFieldConstants={OWNER_PHOTO:0,TEXTFIELD:1,WEBSITE:21,TWITTER:22,DATE:24,DATE1:14,DATE2:24,DATE_LONG:202,EMAIL:25,DATE3:333,TAGS:209,PHONE:33,DECIMAL:38,IMAGE:66,IMAGE1:67,IMAGE2:68,MULTIPICKLIST:100,DATETIME:200,BOOLEAN_YES:300,BOOLEAN_NO:301,FORMULA:116,DATETIME_EVENT_START:786,TEXTAREA:3,CUSTOMTEXTAREA:110,TERRITORY:999,LAYOUT:208,WIZARD:207,TEXTAREA1:110,TEXT:1e3,PICK_LIST:2,STAGE:26,RICHTEXT:250},CrmField=function(e,t){this.fromGallery=t,this.fieldMetaJson=e,this.fieldId=this.fieldMetaJson.id,this.defKey=this.fieldId+"_defaultvalue",this.defValString="{{"+this.fieldId+"_defaultvalue}}",this.defValEncodedForAttribute=this.getEncodedKey(this.defKey,2),this.defValEncodedForURL=this.getEncodedKey(this.defKey,3),this.defValEncodedForJS=this.getEncodedKey(this.defKey,4)};CrmField.prototype.getHTML=function(){var e="";switch(this.fieldMetaJson.UITYPE){case CrmFieldConstants.OWNER_PHOTO:e+=this.handleOwnerPhoto();break;case CrmFieldConstants.EMAIL:e+=this.handleEmailField();break;case CrmFieldConstants.WEBSITE:e+=this.handleWebsiteField();break;case CrmFieldConstants.TWITTER:e+=this.handleTwitterField();break;case CrmFieldConstants.PHONE:e+=this.handlePhoneField();break;case CrmFieldConstants.TAGS:e+=this.handleTagFields();break;case CrmFieldConstants.IMAGE:case CrmFieldConstants.IMAGE1:case CrmFieldConstants.IMAGE2:e+=this.handleImageFields();break;case CrmFieldConstants.BOOLEAN_YES:case CrmFieldConstants.BOOLEAN_NO:e+=this.handleBooleanFields();break;case CrmFieldConstants.FORMULA:e+=this.handleFormulaFields();break;case CrmFieldConstants.DATETIME:case CrmFieldConstants.DATETIME_EVENT_START:case CrmFieldConstants.DATE1:case CrmFieldConstants.DATE2:case CrmFieldConstants.DATE3:case CrmFieldConstants.DATE_LONG:e+=this.handleDateTimeFields();break;case CrmFieldConstants.TEXTAREA:case CrmFieldConstants.CUSTOMTEXTAREA:case CrmFieldConstants.RICHTEXT:e+=this.handleTextAreaField();break;case CrmFieldConstants.STAGE:case CrmFieldConstants.PICK_LIST:e+=this.handlePickListField();break;default:e+=this.handleTextField()}return e},CrmField.UITYPES={FILE_UPLOAD:555,IMAGE_UPLOAD:556,OWNER:8,USERLOOKUP:221,PRODUCT_HANDLER:55,SINGLE_LINE:1,DATE:24,DATE_LONG:202,DATETIME:786,DATE_TIME2:333,END_DATE_TIME:14,MULTI_LINE_CF:110,NUMERIC_FIELD:32,PHONE:33,PERCENT:34,PRICING_DETAILS:51,LONG_INTEGER:52,WEBSITE:21,EMAIL:25,FAX:35,CURRENCY:36,DECIMAL:38,MULTI_PICK_LIST:100,GLOBAL_TAX:96,PICK_LIST:2,SKYPE_FIELD:37,TEXT_FIELD:11,TWITTER:22,FIRST_NAME:27,LAST_NAME:127,TASK_SUBJECT:62,TEXT_AREA:3,DATE_TIME1:30,LONG_DATE_TIME:333,DATE_TIME2:14,DATE_TIME_LONG:333,CREATED_TIME:200,RESCHEDULED_TIME:200,CREATED_BY:20,AGGREGATE_FIELD:117,BIG_DECIMAL:40,STAGE:26,RECORD_CURRENCY:39,ACCOUNT_NAME_LOOKUP:4,CAMPAIGN_NAME_LOOKUP:5,PRODUCT_NAME_LOOKUP:6,CONTACT_LOOKUP:7,VENDOR_NAME_LOOKUP:9,POTENTIAL_ID:10,SALESORDER_ID:12,CONTACT_ID:13,QUOTE_ID:15,ROLE_NAME:16,MULTI_MODULE_LOOK_UP_ENTITY:132,LOOK_UP_ENTITY:133,SYSTEM_SINGLE_LOOK_UP_ENTITY:135,MULTISELECT_LOOK_UP:444,MULTISELECT_USERLOOKUP:445,TERRITORY:999,BOOLEAN_DEF:300,BOOLEAN_DEF_NOT:301,CURRENCY_ROUND_OFF:143,CURRENCY_ROUND_DOWN:144,CURRENCY_ROUND_UP:145,LAYOUT:208,WIZARD:207,TAGS:209,AUTONUMBER:111,SUBFORMS:500,OWNER_PHOTO:0,IMAGE:66,IMAGE1:67,IMAGE2:68,TEXTAREA:3,CUSTOMTEXTAREA:110,RICHTEXT:250,COMMENTCONTENTS:99,PHOTO_FILEID:66,PROFILE_PIC:67,PRODUCT_IMAGE:68,TAGMODULEREFID:209,SUBFORM:500,LINKINGMXN1:500,ADD_PARTICIPANT:41,FORMULA:116,LINE_ITEM_DOUBLE_CURRENCY:77,RECURRING_EVENTS:123,LAYOUT_LOOKUP:136,SERVICE_DURATION:80,SERVICE_TIMING:82,MULTI_DATE_SELECT:81,IMAGE_UPLOAD:556,DATA_PARAM:118,LINETAX:47,INPUT_BOX:19,ADWORD_FIELDS:31,BIG_INTEGER:46,PRODUCT_DETAILS:50,PLAIN_TEXT_DYNAMIC_FIELDS:60,ADWORD_AD_FIELD:103,EVENT_REMINDER:104,DATA_PROCESSING_BASIS:134,MODULE_LIST:137},CrmField.wizardIncludedFieldUiTypes=[CrmField.UITYPES.OWNER,CrmField.UITYPES.USERLOOKUP,CrmField.UITYPES.PRODUCT_HANDLER,CrmField.UITYPES.SINGLE_LINE,CrmField.UITYPES.DATE,CrmField.UITYPES.DATE_LONG,CrmField.UITYPES.DATETIME,CrmField.UITYPES.DATE_TIME1,CrmField.UITYPES.DATE_TIME2,CrmField.UITYPES.DATE_TIME_LONG,CrmField.UITYPES.MULTI_LINE_CF,CrmField.UITYPES.NUMERIC_FIELD,CrmField.UITYPES.PHONE,CrmField.UITYPES.PERCENT,CrmField.UITYPES.FAX,CrmField.UITYPES.LONG_INTEGER,CrmField.UITYPES.WEBSITE,CrmField.UITYPES.EMAIL,CrmField.UITYPES.STAGE,CrmField.UITYPES.CURRENCY,CrmField.UITYPES.DECIMAL,CrmField.UITYPES.MULTI_PICK_LIST,CrmField.UITYPES.PICK_LIST,CrmField.UITYPES.SKYPE_FIELD,CrmField.UITYPES.TEXT_FIELD,CrmField.UITYPES.TWITTER,CrmField.UITYPES.FIRST_NAME,CrmField.UITYPES.LAST_NAME,CrmField.UITYPES.TASK_SUBJECT,CrmField.UITYPES.TEXT_AREA,CrmField.UITYPES.DATE_TIME1,CrmField.UITYPES.AGGREGATE_FIELD,CrmField.UITYPES.BIG_DECIMAL,CrmField.UITYPES.RECORD_CURRENCY,CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.POTENTIAL_ID,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.QUOTE_ID,CrmField.UITYPES.ROLE_NAME,CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.BOOLEAN_DEF,CrmField.UITYPES.BOOLEAN_DEF_NOT,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,CrmField.UITYPES.LAYOUT,CrmField.UITYPES.AUTONUMBER,CrmField.UITYPES.SUBFORM,CrmField.UITYPES.STAGE,CrmField.UITYPES.FILE_UPLOAD,CrmField.UITYPES.IMAGE_UPLOAD,CrmField.UITYPES.RICHTEXT,CrmField.UITYPES.MULTISELECT_LOOK_UP,CrmField.UITYPES.MULTISELECT_USERLOOKUP,CrmField.UITYPES.PRICING_DETAILS,CrmField.UITYPES.IMAGE],CrmField.UITYPEHINT={8:I18n.getMsg("crm.field.label.user.lookup"),221:I18n.getMsg("crm.field.label.user.lookup"),55:I18n.getMsg("crm.field.label.user.lookup"),1:I18n.getMsg("crm.field.label.single.line"),24:I18n.getMsg("crm.field.label.date"),202:I18n.getMsg("crm.field.label.date"),786:I18n.getMsg("crm.field.label.date.time"),30:I18n.getMsg("crm.field.label.date.time"),14:I18n.getMsg("crm.field.label.date.time"),333:I18n.getMsg("crm.field.label.date.time"),110:I18n.getMsg("crm.field.label.text.area"),250:I18n.getMsg("ze.editor.rich.text"),32:I18n.getMsg("crm.field.label.integer"),33:I18n.getMsg("crm.field.label.phone"),34:I18n.getMsg("crm.field.label.percentage"),35:I18n.getMsg("crm.field.label.phone"),52:I18n.getMsg("crm.field.label.long.integer"),21:I18n.getMsg("crm.field.label.url"),25:I18n.getMsg("crm.field.label.email"),26:I18n.getMsg("crm.value.label.option1"),36:I18n.getMsg("crm.field.label.currency"),38:I18n.getMsg("crm.field.label.decimal"),100:I18n.getMsg("crm.value.label.option1"),2:I18n.getMsg("crm.value.label.option1"),37:I18n.getMsg("crm.field.label.single.line"),11:I18n.getMsg("crm.field.label.single.line"),22:I18n.getMsg("crm.field.label.single.line"),27:I18n.getMsg("crm.field.label.single.line"),127:I18n.getMsg("crm.field.label.single.line"),62:I18n.getMsg("crm.field.label.text.area"),3:I18n.getMsg("crm.field.label.text.area"),117:I18n.getMsg("crm.subform.aggregate"),40:I18n.getMsg("crm.field.label.decimal"),39:I18n.getMsg("crm.field.label.currency"),4:I18n.getMsg("crm.field.label.lookup"),5:I18n.getMsg("crm.field.label.lookup"),6:I18n.getMsg("crm.field.label.lookup"),7:I18n.getMsg("crm.field.label.lookup"),9:I18n.getMsg("crm.field.label.lookup"),10:I18n.getMsg("crm.field.label.long.integer"),13:I18n.getMsg("crm.field.label.lookup"),15:I18n.getMsg("crm.field.label.long.integer"),16:I18n.getMsg("crm.field.label.single.line"),133:I18n.getMsg("crm.field.label.lookup"),300:I18n.getMsg("crm.value.label.choice2"),301:I18n.getMsg("crm.value.label.choice2"),143:I18n.getMsg("crm.field.label.currency"),144:I18n.getMsg("crm.field.label.currency"),145:I18n.getMsg("crm.field.label.currency"),111:I18n.getMsg("crm.field.label.auto.number"),555:I18n.getMsg("crm.label.widgets.fileupload"),556:I18n.getMsg("crm.image.name"),444:I18n.getMsg("crm.field.label.mxn"),445:I18n.getMsg("crm.field.label.multiuserlookup")},CrmField.prototype.getEncodedKey=function(e,t){var r="{{"+e+"}}";return 2===t?r="{{encodeForHTMLAttribute "+e+"}}":3===t?r="{{encodeURL "+e+"}}":4===t&&(r="{{encodeJS "+e+"}}"),r},CrmField.prototype.handleTextField=function(){return"{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}"},CrmField.prototype.handleTextAreaField=function(){return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<pre style='word-wrap: break-word; white-space:pre-wrap;'>{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}</pre>{{/canvasEmptyCheck}}"},CrmField.prototype.handlePhoneField=function(){if(!0!==this.fieldMetaJson.donotshow||Crm.userDetails.CLIENT_ACCOUNT){var e="{{#canvasEmptyCheck this '"+this.fieldId+"'}}{{#if ISCALLALLOWED}}";if(!0===this.fieldMetaJson.outbound)e+="<span class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"<a href='javascript:;' class='cd_style_inherit calliconOuter' onmouseover='CTIAPI.showCallButtonlabel(this)' onmouseout=\"CTIAPI.hideCallButtonlabel(this)\" onclick=\"sE();ctiApiNotifier.click2Call('"+this.defValEncodedForJS+"','"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"','{{ENTITYID}}','','{{MODULE}}','{{ENTITYNAME}}')\"><i class='callIcon'></i><span id='calllabel1'>"+I18n.getMsg("Call")+"</span></a></span>";else if(Crm.userDetails.ZPBENABLED){var t="asyncFn(crmCallsNew.getClick2CallPromise,'{{ENTITYID}}','{{MODULE}}','{{ENTITYNAME}}','','"+this.defValString+"')";e+="<span class='phoneRtl cd_style_inherit' style='min-width:100%'><zpb-phone number='"+this.defValString+"' module='{{MODULE}}' recordid='{{ENTITYID}}' callbackparamfn="+t+">"+this.defValString+"</zpb-phone></span>"}else e+="<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"<a style='visibility:hidden;' class='ico-call3 phoneRtl cd_style_inherit' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+this.defValEncodedForJS+"?call' onclick='sE();'></a></span>";return e+="{{else}}<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"</span>{{/if}}{{/canvasEmptyCheck}}"}return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"</span>{{/canvasEmptyCheck}}"},CrmField.prototype.handleEmailField=function(){var e="";return this.fromGallery||(e+='href="mailto:'+this.defValString+'" '),EmailUnblocking&&EmailUnblocking.isEmailBounced&&EmailUnblocking.isEmailBounced("canvas",this.fieldMetaJson.COLUMNNAME)?"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<a class='cd_style_inherit'"+e+">"+this.defValString+"<crmutil-icon lyte-hovercard=true icon-name='alert-filled' icon-class='zcicn-alert-filled zcicn12  zcicn_sandal' id='bounceicon' onmouseover='EmailUnblocking.unblockEmailHelper(event,this,`canvas`)' onmouseleave='EmailUnblocking.emailUnblockingMouseOut(this)' class ='emailUnblocking "+this.fieldMetaJson.COLUMNNAME+" mL3 vaM mB2 cP'></crmutil-icon></a>{{/canvasEmptyCheck}}":"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<a class='cd_style_inherit'"+e+">"+this.defValString+"<crmutil-icon lyte-hovercard=true icon-name='alert-filled' icon-class='zcicn-alert-filled zcicn12  zcicn_sandal' id='bounceicon' onmouseover='EmailUnblocking.unblockEmailHelper(event,this,`canvas`)' onmouseleave='EmailUnblocking.emailUnblockingMouseOut(this)' class ='emailUnblocking "+this.fieldMetaJson.COLUMNNAME+" mL3 vaM mB2 cP hide'></crmutil-icon></a>{{/canvasEmptyCheck}}"},CrmField.prototype.handleWebsiteField=function(){var e='href ="'+this.getEncodedKey(this.fieldId+"_href",1)+'"';return"{{#canvasEmptyCheck this '"+this.fieldId+'\'}}<a class=\'cd_style_inherit\' data-cid="dummy" class="cd_style_inherit" '+e+' target="_blank">'+this.defValString+"</a>{{/canvasEmptyCheck}}"},CrmField.prototype.handleTwitterField=function(){var e=RebrandLinkUtil.getProperty("TW_URL");return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<a class='cd_style_inherit link' data-cid='dummy' href='"+e+"/"+this.defValEncodedForURL+"' target='_blank' >"+this.defValString+"</a>{{/canvasEmptyCheck}}"},Handlebars.registerHelper("processTags",(function(e,t){return e=""==e?[]:e,crmListView.displayTags(e,t,"p0")})),Handlebars.registerHelper("split_color",(function(e){return CrmTags.gettagname(e,"tagcolor")})),Handlebars.registerHelper("text_color",(function(e){var t=CrmTags.gettagname(e,"tagcolor");return getPickListFontColor(t)})),Handlebars.registerHelper("split_name",(function(e){return CrmTags.gettagname(e,"tagname")})),CrmField.prototype.handleTagFields=function(){return Customization.isBuilder||customViewObject.fluidWidth?"<ul class='listview_taglists p0 m0 dIB'>{{#each "+this.fieldId+"_defaultvalue}}<li class='tagElementList crm-base-font-size br2 dIB br_border1 cxTagBgSpan' style='background-color:{{split_color this}};color:{{text_color this}}'> {{split_name this}}</li>{{/each}}</ul>":"{{{processTags "+this.fieldId+"_defaultvalue "+this.fieldMetaJson.ui.position.width+"}}}"},CrmField.prototype.handleDateTimeFields=function(){return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<span class='cd_style_inherit'>"+this.defValString+"</span>{{/canvasEmptyCheck}}"},CrmField.prototype.handleBooleanFields=function(){return" {{#ifEquals "+this.defKey+' "true"}}<img src="'+Search.spacerImg+'" class="yes"/>{{else}}<img src="'+Search.spacerImg+'" class="no-new" width="9" height="9"/>{{/ifEquals}}'},CrmField.prototype.handleFormulaFields=function(){return"boolean"===this.fieldMetaJson.RETURNTYPE?this.handleBooleanFields():"datetime"===this.fieldMetaJson.RETURNTYPE?this.handleDateTimeFields():this.handleTextField()},CrmField.prototype.handleImageFields=function(){return'{{#if hasZiaVisionApproval}}<img onerror="emptyImgRemove(this);" id="img_{{ENTITYID}}" lt-prop-title="{{getVisionTitle approveStatus}}" src="{{getVisionImgSrc approveStatus}}" class="cd_people_image h100_per w100_per"/>{{else}}<img onerror="emptyImgRemove(this);" id="img_{{ENTITYID}}" data-cvsrc="'+Crm.getCrmBasePath()+'/EntityImageAttach.do?action_module={{MODULE}}&entityId={{ENTITYID}}&actionName=readImage&encfileId=" data-fileid="'+this.defValString+'" class="cd_people_image entityImg"/>{{/if}}'},CrmField.prototype.handleOwnerPhoto=function(){return"<img onerror='emptyImgRemove(this);' data-cvsrc='"+Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module=Users&entityId={{"+this.fieldId+"_USERID}}&actionName=readImage&fileid=' data-fileid='{{"+this.fieldId+"_USERID}}' class='cd_people_image'/>"},CrmField.prototype.handlePickListField=function(){if(this.fieldMetaJson.colorcode_enabled){var e={enable_colour_code:!0,pick_list_values:this.fieldMetaJson.picklistmap};return"{{#ifNotEquals "+this.defKey+' ""}}<span class="colorAppliedPicklist" data-zcqa="colorcode_value_{{ENTITYID}}_'+this.fieldId+'" style="{{getColorCodeStyleForPickList this \''+this.fieldId+"' '"+$ESAPI.encoder().encodeForHTML(JSON.stringify(e))+"'}}\">{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}</span>{{/ifNotEquals}}"}return"{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}"},Handlebars.registerHelper("getColorCodeStyleForPickList",(function(e,t,r){var a=store.peekRecord("field",t);if(a&&!0===a.enable_colour_code&&r)return getPicklistStyleObj(e[t+"_defaultvalue"],a.pick_list_values)})),CrmField.prototype.getContext=function(){return this.context},CrmField.prototype.setContext=function(e){this.context=e},CrmField.getDataType=function(e){var t="";switch(e){case 32:case 98:t="integer";break;case 24:case 202:t="date";break;case 300:case 301:t="boolean";break;case 34:t="percent";break;case 38:case 40:case 343:t="double";break;case 52:case 41:case 208:case 207:t="bigint";break;case 111:t="autonumber";break;case 21:t="website";break;case 1:case 11:case 22:case 27:case 50:case 127:case 35:case 37:case 51:case 123:case 1234:case 99:case 999:case 31:case 103:case 62:case 19:case 17:case 1e3:t="text";break;case 77:case 36:case 143:case 144:case 145:t="currency";break;case 33:t="phone";break;case 25:t="email";break;case 2:case 26:case 39:t="picklist";break;case 786:case 333:case 30:case 14:case 200:t="datetime";break;case 4:case 5:case 6:case 7:case 9:case 10:case 12:case 13:case 15:case 55:case 135:case 133:t="lookup";break;case 8:t="ownerlookup";break;case 100:case 18:t="multiselectpicklist";break;case 110:case 3:case 250:t="textarea";break;case 116:t="formula";break;case 221:t="userlookup";break;case 118:t="rollup_summary";break;case 132:t="multi_module_lookup";break;case 555:t="fileupload"}return t};var crmLookupAutoComplete={searchText:"",searchModule:"",fldName:"",openpopupclick:!1,searchResult:[],scrollEnd:!1,scrollPageIndex:0,listcount:0,searchModuleBCFields:[],fetchedAllItems:!1,gotResult:!1,filterConfigured:!1,currenctISOCode:"",matchingResultsFound:!1,DLF_Data:{},DYNAMIC_CRTERIA_STARTS_WITH:"${",DYNAMIC_CRITERIA_ENDS_WITH:"}",DYNAMIC_CRITERIA_FIELD_TYPE:"field",initAutoCompletePlugin:function(e,t,r){var a=!0,o=0;if(r&&!1===r.scrollFocus&&(a=!1),"searchLookup"===t&&(o=3),0==$("#lookFieldSrcWrap").length){$("body").append('<div id="lookFieldSrcWrap" class="lookFieldSrcWrap vH dNImp" ><div id="lookupFieldULWrap" class="lookupFieldULWrap" ><div id="lookupPerfectScroll" onclick="sE(event)"></div></div><div id="lookupFieldAddNew"  class="lookupFieldAddNew p10 bg_white zi29 pR br_top_border4 cP"><span class="crmLinkColor cP pL10 dIB">+ new Button</span></div></div>')}e=$(e);var i="";e.autocomplete({minLength:o,delay:500,source:function(r,a){crmLookupAutoComplete.scrollPageIndex=1,crmLookupAutoComplete.scrollEnd=!1;var o=$("[id='"+e.attr("id")+"_img']");"createPageLookup"===t&&o.data()&&(Crm.moduleName=o.data().module);var i,n,s=$("select[id='"+e.attr("id")+"_label_select']");if(s[0]||(s=$("select[id='"+e.attr("id")+"_select']")),s[0]?i=s.val():(i=e.data("lookupModule"),e[0]&&e[0].id&&(n=e[0].id)),moduleRecordMapping.Unknown&&moduleRecordMapping.Unknown.module_name===i)return!1;if(null==i&&(i=e.attr("data-lookup-module")),void 0!==e.data("searchModule")&&(i=e.data("searchModule")),i&&(!crmCommonModule.serviceLookupDisabled||1!=crmCommonModule.serviceLookupDisabled||!i||"Services"!=i)){var l=$("#portalPreview");if(!(Crm.userDetails.CLIENT_ACCOUNT&&Crm.userDetails.moduleVsCriteriaLookup[e[0].id.split("_")[1]]&&-1!==Crm.userDetails.moduleVsCriteriaLookup[e[0].id.split("_")[1]].toString().indexOf($(e[0]).attr("data-fieldid"))||1===l.length)){var c=r.term.trim();c||e.data("id","");var d=!1;if(crmLookupAutoComplete.searchModule===i&&crmLookupAutoComplete.gotResult)if(crmLookupAutoComplete.searchText===c)0===crmLookupAutoComplete.searchResult.length?(crmLookupAutoComplete.matchingResultsFound=!1,a(crmLookupAutoComplete.getEmptyItem(c,e.attr("id")))):(crmLookupAutoComplete.matchingResultsFound=!0,a(crmLookupAutoComplete.searchResult)),d=!0;else if(0===c.indexOf(crmLookupAutoComplete.searchText)&&crmLookupAutoComplete.fetchedAllItems){var u,m=Crm.isInventoryModule(Crm.moduleName)&&Crm.isLineItemSubFormModule(e.data().subformdisplaylabel)&&"Products"===i&&e.attr("id").indexOf("PRODUCTID")>-1,p=$.ui.autocomplete.escapeRegex(c),g=new RegExp("^"+p,"i"),h=new RegExp(" "+p,"i");if(m){var v="";c.split(" ").forEach((function(e){v=v+"(?=.*"+$.ui.autocomplete.escapeRegex(e)+")"}));var f=new RegExp(v,"i");u=$.grep(crmLookupAutoComplete.searchResult,(function(e){var t=e.value;return e.productDetails&&e.productDetails["Product Code"]&&(t=e.value+" "+e.productDetails["Product Code"]),g.test(t)||h.test(t)||f.test(t)}))}else u=$.grep(crmLookupAutoComplete.searchResult,(function(e){return g.test(e.value)||h.test(e.value)}));0===u.length?(crmLookupAutoComplete.matchingResultsFound=!1,a(crmLookupAutoComplete.getEmptyItem(c,e.attr("id")))):(crmLookupAutoComplete.matchingResultsFound=!0,a(u)),d=!0}if(!d){if(crmLookupAutoComplete.fetchedAllItems=!1,crmLookupAutoComplete.listcount=0,crmLookupAutoComplete.searchModule=i,crmLookupAutoComplete.fldName=n,crmLookupAutoComplete.searchText=r.term.trim(),crmLookupAutoComplete.searchResult=[],crmLookupAutoComplete.gotResult=!1,!e.attr("disabled"))$("img[id='"+e.attr("id")+"_loadimg']").addClass("vVIm");let t=$L("#socialEntityCreate").is(":visible");if(!t&&window.hasOwnProperty("module"))var C=module;if(t){let e=$L("#module_option lyte-radiobutton");e.each((function(t){if(e[t].component.data.ltPropChecked)return C=e[t].component.data.ltPropValue,!1}))}crmLookupAutoComplete.searchForLookupValue(1,a,e.attr("id"),void 0,void 0,void 0,void 0,e,C)}}}},appendTo:"#lookupFieldULWrap",open:function(){var r=$("#VRAjaxEdit").is(":visible"),o=renderingUtils.windowHeight,n=$(".textField.ui-autocomplete-input.ui-autocomplete-loading"),s=$("#lookFieldSrcWrap");i=e._form()?e._form().attr("name"):"";var l,c=e.autocomplete("widget").find("li[data-value='001']"),d=$("#socAddToCrmPop"),u=$(this),m=$L(document).scrollTop(),p=$(".accountCreateWarn").is(":visible"),g=u.closest(".subFrmTablWrapper").length;c[0]&&(l=c.data("ui-autocomplete-item").Id),s.removeClass("dNImp");var h=$("#lookupFieldAddNew");"searchLookup"===t&&h.addClass("dN"),"createPageLookup"===t&&"2"!==l&&h.removeClass("dN");var v,f=u.autocomplete("widget"),C=e.width(),y=e.parent(),b=y.outerHeight(),I=parseFloat(y.offset().top+b),T=parseFloat(e.offset().left),w=s.outerWidth(),E=renderingUtils.windowWidth-(T+C),k={},O=$("html,body"),S=$L("html"),R=$L("body"),M=0,_=S.scrollTop(),D=R.scrollTop();_>D?(M=_,v=S):D>_?(M=D,v=R):v=O;var L=R.height(),A=$("#wms-chatwindowcontainer").height();A||(A=0);var P=$(document).height(),U=$L(window).scrollTop(),B="auto",x=e.closest(".ppTop");x.length||(x=e.closest(".zcrm-modal")),x.length>0&&(B=parseInt(x.css("z-index"))+1),d.length>0&&!$("#searchCreateDiv").is(":visible")&&s.addClass("zi100"),f.css("width",C),T=g?E+20>w?parseFloat(e.offset().left):T-w/2:parseFloat(e.offset().left),k.width=C,k.left=T,k.top=I,s.css("z-index",B),s.removeClass("vH");var N=$("#lookupFieldAddNew .crmLinkColor.cP");h=$("#lookupFieldAddNew");let F=Lyte.Component.registeredHelpers.showAddRecord($(e).data("lookupModule"));if(crmTab.isZBCustomModule(crmLookupAutoComplete.searchModule)||crmTab.isZSCustomModule(crmLookupAutoComplete.searchModule))h.addClass("dN");else{h.attr("onmousedown","crmLookupAutoComplete.openSearchCreatePopUp('"+e.attr("id")+"','"+t+"')");var j=Crm.moduleInfo[crmLookupAutoComplete.searchModule].translatedSingularLabel;N.text("+ "+I18n.getMsg("crm.module.new",j||I18n.getMsg(moduleRecordMapping[crmLookupAutoComplete.searchModule]?moduleRecordMapping[crmLookupAutoComplete.searchModule].singular_label:"Record")));var V=$L("#dvinner");h.removeClass("dN");var H=e.attr("id");("createPageLookup"!==t||crmLookupAutoComplete.isInventoryModule(crmLookupAutoComplete.searchModule)||"2"===l||"Crm_Appointments_SERVICEID"===H||r||!F)&&h.addClass("dN")}f.addClass("lookupFieldULlist");var J=s.outerHeight(),W=n[0].getBoundingClientRect().top+n.parent().outerHeight(),Y=s.outerHeight(),z=o-W;if(I+J>L-A&&"viewentityform"!=i)$(".topband_tb").addClass("mT130"),v.animate({scrollTop:P});else if(renderingUtils.windowHeight<I+J-(U-28)&&"viewentityform"!==i)a?v.animate({scrollTop:J-(o-W)+M}):renderingUtils.windowHeight-(I-m)>J||J>I-m?k.top=I:k.top=I-J-b;else if("viewentityform"==i)if(z<=Y){s.addClass("vH");var q=V.scrollTop()+(Y-z)+20;V.animate({scrollTop:q},(function(){var e=parseFloat(y.offset().top+y.outerHeight());s.css("top",e).removeClass("vH")}))}else s.css("top",I).removeClass("vH");"viewentityform"!=i?($("#createEditCallPopup").addClass("oH"),s.removeClass("vH")):(u.closest(".businesscall").length&&thirdPartyUtils.unbindPerfectScroll("#dvinner"),V.addClass("oH")),R.addClass("oH");var G=$("#searchCreatePopup .popup-model-content");$("#searchCreatePopup").is(":visible")?G.addClass("oH"):G.removeClass("oH"),"searchLookup"!==t||crmLookupAutoComplete.matchingResultsFound||e.autocomplete("instance").options.close(),s.css({top:k.top,width:k.width,left:k.left}),$("#appointmentCreate").is(":visible")&&$("#secContent_Appointment_Information").addClass("oH"),p||$(".lookupFieldULWrap").removeClass("accountCreateNote");u.data();s.removeClass("zI300Imp")},select:function(r,a){if("001"!=a.item.seId){var o=$(this);o.val(a.item.value);var n=o.data(),s=n.id,l=a.item.seId;o.data("id",l);var c=o.data("dependfield"),d=e.parent(),u="PRODUCTID"===n.colname&&Crm.isLineItemSubFormModule(n.subformdisplaylabel)?d.find("textarea"):d.find("input");if(c&&s!=l){var m=n.fieldid;ProcessFlow.getDuringTransitionDependentFields(l,m)}if(("searchCreateLookup"==t||"leadConvertLookup"==t)&&d&&u&&u.length>=2){var p=u[1];$(p).attr("value",a.item.seId)}var g=e.data().colname;if("createPageLookup"==t&&null!=g&&g.indexOf("CF")<0)if("Accounts"==crmLookupAutoComplete.searchModule&&"PARENTACCOUNTID"!=g){var h=a.item.addressInfo;Crm.fillAddressinfo(Crm.moduleName,JSON.stringify(h))}else if(crmLookupAutoComplete.searchModule===crmModuleConstants.Contacts){var v=e.attr("id").replace(g,"ACCOUNTID");v=$("#"+v);var f=!1;if(e.attr("id").startsWith("Crm_Tasks_")||e.attr("id").startsWith("Crm_Calls_")){f=!0;var C=e.attr("id").replace(g,"SEID");v=$("#"+C)}if(v&&v[0]&&(""===v.val()||""===v.data("id"))){if(f){var y=e.attr("id").replace(g,"SEID_label_select");(y=$("#"+y))[0]||(y=$("#"+e.attr("id").replace(g,"SEID_select"))),Crm.userDetails.MODULE_LIST.Accounts.visible&&Crm.userDetails.MODULE_LIST.Accounts.viewable?y.val("Accounts"):y.prop("selectedIndex",0),y.change()}var b=crmLookupAutoComplete.searchModuleBCFields[a.item.LAYOUTID][2],I=a.item[b.FIELDID],T=a.item.refInfo1;Crm.userDetails.MODULE_LIST.Accounts&&Crm.userDetails.MODULE_LIST.Accounts.viewable&&"ACCOUNTNAME"===b.COLUMNNAME||(T=""),T&&(v.val(unescape(I)).data("id",T),$("#multipleFieldsEditPop").is(":visible")&&v.data("dependfield")&&ProcessFlow.getDuringTransitionDependentFields(T,v.data("fieldid")))}if(v&&v[0]&&v.data()&&v.attr({"data-selectedlookupvalue":v.val(),"data-selectedid":v.data().id}),e.attr("id").startsWith("Crm_Cases_")){var w=a.item.refInfo2,E=a.item.refInfo3,k=$("#Crm_Cases_PHONE"),O=$("#Crm_Cases_EMAIL");"null"!==w&&k.length>0&&""===k.val()&&k.val(w),"null"!==E&&O.length>0&&""===O.val()&&O.val(E)}h=a.item.addressInfo;Crm.fillAddressinfo(Crm.moduleName,JSON.stringify(h))}else if("Products"===crmLookupAutoComplete.searchModule&&"PRODUCTDETAILS"===g){var S=a.item.productDetails;(j={}).Product_Name=S["Product Name"],j.id=l,j.Unit_Price=S["Unit Price"],j.Qty_in_Stock=S["Qty in Stock"],j.Qty_Ordered=S["Qty Ordered"],j.Product_Code=S["Product Code"],j.Taxable=S.Taxable;var R=S.Tax;if(""!=R&&null!=R&&"null"!=R){var M={};if(Crm.userDetails.TAX_MIGRATION_COMPLETED)M=JSON.parse(R);else for(var _=R.split(";"),D=JSON.parse(productDetails.allTaxes),L=_.length,A=0;A<L;A++){var P=_[A],U=D[P];M[P]=U}j.TaxDetails=M}j.Tax=S.hdnPrdSortedTaxs?S.hdnPrdSortedTaxs:[],productDetails.setValuesForAddedRowNew(n.rownumber,j)}else if("SalesOrders"===Crm.moduleName&&"Quotes"===crmLookupAutoComplete.searchModule||"Invoices"===Crm.moduleName&&("Quotes"===crmLookupAutoComplete.searchModule||"SalesOrders"===crmLookupAutoComplete.searchModule)){var B=o.attr("id");Crm.fillFormObject(a.item.value,l,crmLookupAutoComplete.searchModule,null,Crm.moduleName,B,$("#layoutDetails").val(),!0)}var x=a.item.refFieldsInfo,N=!!n.subformdisplaylabel,F=Crm.isLineItemSubFormModule(n.subformdisplaylabel);if(F&&e.attr("id").indexOf("PRODUCTID")>-1){S=a.item.productDetails;var j,V=crmLookupAutoComplete.searchModuleBCFields[a.item.LAYOUTID];(j={}).Product_Name=S["Product Name"],j.id=l;for(var H,J=V.length,W=0;W<J;W++)"Qty in Stock"===V[W].FIELDLABEL&&(j.Qty_in_Stock=S["Qty in Stock"]),"Quantity in Stock"===V[W].FIELDLABEL&&(H=V[W].FIELDID);S["Qty in Stock"]&&S["Qty in Stock"].toString()===Search.reverseFormatNumber(a.item[H])&&(j.isNumberSeparatorEnabledForQInS=!0),j.Unit_Price=S["Unit Price"],j.Qty_Ordered=S["Qty Ordered"],j.Product_Code=S["Product Code"],j.Taxable=void 0!==S.Taxable&&0!==S.Taxable.length&&JSON.parse(S.Taxable),j.Tax=Crm.getPrdTaxDetails(S.Tax),j.LAYOUTID=a.item.LAYOUTID,e.attr("prdDetails",JSON.stringify(j)),S["Product Code"]&&""!==S["Product Code"]&&e.data("lineitemprodcode")?o.val(a.item.value.replace(/(\r\n|\n|\r)/gm," ")+" ("+S["Product Code"]+")"):o.val(a.item.value.replace(/(\r\n|\n|\r)/gm," ")),o.css({height:"18px"}),o.css({height:o[0].scrollHeight-8})}if(x&&(a.item.parentFieldsColumnName||N)){var Y=$("#socAddToCrmPop");if("crm.tab.approvals.index"===Lyte.Router.getRouteInstance().transition.target||Y.is(":visible"))Crm.setRefFieldValues(e,a.item.seId,x||{});else{var z,q=$("#createEntityForm");q.is(":visible")||(z=Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam());var G=$("#multipleFieldsEditPop"),Q=$("#convertLeadForm"),K=Lyte.Router.getRouteInstance().routeName;q.is(":visible")||G.is(":visible")||Q.is(":visible")||"view"!==window[z].currentStatus?(q.is(":visible")||"create"===window[z].currentStatus||"clone"===window[z].currentStatus||"edit"===window[z].currentStatus||G.is(":visible")&&("detail"===K||"canvas"===K)||Q.is(":visible"))&&(x=x||{},Crm.setRefFieldValues(e,a.item.seId,x),F&&e.attr("id").indexOf("PRODUCTID")>-1&&Crm.handleProductLineItemUpdate(e)):fieldOfLookup.participatingfieldsvalidationrule(a,g)}}if("convertlead"!=i&&"MassConvertForm"!=i&&"WFConvert"!=i||$("#"+this.parentElement.id).addClass("show-close"),"Contacts"===Crm.moduleName&&"ACCOUNTID"===n.colname){var X=$("#Contacts_fldRow_REPORTINGTOCONTACTID"),Z=$("#Crm_Contacts_REPORTINGTOCONTACTID");Z.prop("disabled",!1),Z.autocomplete("enable"),X.removeClass("noclick"),X.unbind("mouseover"),X.unbind("mouseout"),X.removeAttr("onmouseenter onmouseleave")}o.attr({"data-selectedlookupvalue":o.val(),"data-selectedid":l})}return!1},close:function(){var e=$("#createEditCallPopup"),t=e.is(":visible");$("body").removeClass("oH"),e.removeClass("oH");var r=$("#searchCreatePopup .popup-model-content");r.is(":visible")&&r.removeClass("oH"),"viewentityform"==i&&$("#dvinner").removeClass("oH"),crmLookupAutoComplete.searchText="",crmLookupAutoComplete.searchResult=[],crmLookupAutoComplete.searchModule="",t||(crmLookupAutoComplete.searchModuleBCFields=[]);var a=$("#lookFieldSrcWrap");a.removeClass("zi100").addClass("dNImp vH"),a.css("z-index","inherit"),$(".topband_tb").removeClass("mT130");var o=$(this);o&&o.closest(".businesscall").length&&thirdPartyUtils.bindPerfectScroll("#dvinner",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1})}}),thirdPartyUtils.bindPerfectScroll("#lookupPerfectScroll",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1}),e.on("focus",(function(){crmLookupAutoComplete.scrollPageIndex=1}));var n=e.data("ui-autocomplete");n._renderMenu=function(e,t){$("#lookFieldSrcWrap").show(),$(e).unbind("scroll"),crmLookupAutoComplete.scrollMenu(e,t,n)},n._renderItem=function(r,a){if("searchLookup"!==t||"001"!==a.seId){var o,i='aria-selected="false"';a.seId==e.data("id")&&(i='aria-selected="true"');var n=Lyte.Router.getRouteInstance("crm.tab.module")?Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam():void 0;$("#multipleFieldsEditPop").is(":visible")&&(n=$("#multipleFieldsEditPop").find("li.sel").data("mod")),o=crmLookupAutoComplete.isInventoryModule(n)&&a.productDetails&&a.productDetails["Product Code"]&&e.data("lineitemprodcode")?a.value+" ("+a.productDetails["Product Code"]+")":a.value;var s='<a class="ui-corner-all lookupTxtOverflow" style="padding: 7px 20px 10px 27px !important;" '+i+"><span class='lookupTxtVal' onmouseenter='if(!$(this).hasClass(\"lookupDummyClass\")){crmLookupAutoComplete.titleToolTipForEllipsis(this,\""+$ESAPI.encoder().encodeForJavaScript(o)+"\");}' >"+$ESAPI.encoder().encodeForHTML(o)+" </span>",l="";"001"!=a.seId&&(l='<i class="icon_roundinfo infoIcoLookupAuto cP fR vH" onmouseenter="crmLookupAutoComplete.showBCDetails(\''+$ESAPI.encoder().encodeForJavaScript(JSON.stringify(a))+'\');" onmouseout="crmui.hideTooltip(); renderingUtils.zctt.hidett();"></i>');var c=$("<li>"),d=c.data("ui-autocomplete-item",a).attr("data-value",a.seId).attr("class","lookupSearchLi").append(s+l+" </a>");try{var u=Lyte.Router.getRouteInstance();if(u){var m=u.parent.parent.getDynamicParam();null!==m&&"Activities"===m&&c.attr("onclick","detailView.getEntityTaskSync('"+a.seId+"','"+crmLookupAutoComplete.searchModule+"')")}}catch(e){murphy.error(e)}return $(".accountCreateWarn").remove(),d.appendTo(r)}$("#lookFieldSrcWrap").hide()}},getLoadingDiv:function(e){if(0==e.find("li[data-value='001']").length){var t='<a class="ui-corner-all lookupTxtOverflow" style="padding: 0px 20px 0px 20px !important;"><img style=\'margin-bottom: 6px;display: inline-block;\' src=\''+networkUtils.getImageUrl("loading.gif",ResourceConstants.CRM)+"'></a>";$("<li>").attr("data-value","001").attr("class","lookupSearchLi lookupSvgLoader").append(t).appendTo(e)}thirdPartyUtils.bindPerfectScrollUpdate(e)},removeLoadingDiv:function(e){var t=e.find("li[data-value='001']");t.length>0&&(t.remove(),thirdPartyUtils.bindPerfectScrollUpdate(e))},titleToolTipForEllipsis:function(e,t){e.scrollWidth>e.clientWidth&&(e.title=t),$(e).addClass("lookupDummyClass")},getEmptyItem:function(e,t){var r=Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().parent.getQueryParams().sub_module:"";r=void 0===r&&Crm.isActivitySplitDone&&"Tasks"===Lyte.Router.getRouteInstance().parent.getDynamicParam()?"Tasks":r;var a=[];if(0===e.length){var o=Crm.moduleInfo[crmLookupAutoComplete.searchModule].translatedSingularLabel;a.push({seId:"001",Id:"1",value:I18n.getMsg("crm.module.empty.message",o||I18n.getMsg(moduleRecordMapping[crmLookupAutoComplete.searchModule]?moduleRecordMapping[crmLookupAutoComplete.searchModule].singular_label:"Record"))})}else a.push({seId:"001",Id:"3",value:I18n.getMsg("crm.template.listview.search.no.results")});return a},loadItemsToAutoCompleteWidget:function(e,t,r,a){var o=[];o=t.slice(r*crmLookupAutoComplete.scrollPageIndex,r*crmLookupAutoComplete.scrollPageIndex+r),++crmLookupAutoComplete.scrollPageIndex,o.length<r&&(crmLookupAutoComplete.fetchedAllItems=!0,crmLookupAutoComplete.scrollEnd=!0),o.each((function(t){null!=t&&(a._renderItem(e,t),thirdPartyUtils.bindPerfectScrollUpdate(e))})),a.menu.refresh(),e.show(),e.position($.extend({of:a.element},a.options.position)),e.css("top",e.position().top+8),a.options.autoFocus&&a.menu.next(new $.Event("mouseover"))},scrollMenu:function(e,t,r){var a=[];crmLookupAutoComplete.pages=Math.ceil(crmLookupAutoComplete.listcount/10),a=t.slice(0,10),(e=$(e)).scrollTop(0),crmLookupAutoComplete.pages>1?e.scroll((function(){var a=e;if(crmLookupAutoComplete.isScrollbarBottom(a)){if(crmLookupAutoComplete.scrollEnd)return null;if(crmLookupAutoComplete.scrollPageIndex>=crmLookupAutoComplete.pages){if(crmLookupAutoComplete.searchText.lenght>1)return crmLookupAutoComplete.listcount<1e3&&(crmLookupAutoComplete.fetchedAllItems=!0),null;var o=crmLookupAutoComplete.listcount+1;return crmLookupAutoComplete.getLoadingDiv(a),void crmLookupAutoComplete.searchForLookupValue(o,null,r.element.attr("id"),a,t,10,r,r.element)}crmLookupAutoComplete.loadItemsToAutoCompleteWidget(a,t,10,r)}})):(crmLookupAutoComplete.fetchedAllItems=!0,crmLookupAutoComplete.scrollEnd=!0),renderingUtils.scrollPrevent(e),a.each((function(t){null!=t&&r._renderItem(e,t)}))},isScrollbarBottom:function(e){e=$L(e);var t=Math.round(e.outerHeight()),r=e[0].scrollHeight-9;return e.scrollTop()>=r-t},showBCDetails:function(e){for(var t='<div><table class="lookupAutocomBC crm-extra-small-font-size alignLeft">',r=(e=JSON.parse(e)).LAYOUTID,a=crmLookupAutoComplete.searchModuleBCFields[r],o=a.length,i=2;i<o;i++){var n=a[i],s=n.FIELDLABEL,l=n.FIELDID;if(!(l.indexOf("addressInfo")>-1||s.indexOf("_refFieldsInfo")>-1||s.indexOf("_refInfo")>-1||l.indexOf("productDetails_")>-1)){var c,d=n.UITYPE;116==d&&(c=n.RETURNTYPE);var u=e[l];if(u){if("NOTALLOWED_LAYOUTRULE"==u)continue;if(786==d||14==d||333==d){var m=new Date(u);u=Utils.getDateTimeInUserFormat(m,!0)}else if(24==d||202==d||116==d&&null!=c&&"date"==c){var p=new Date(u);u=Utils.getDateInUserDatePattern(p,!0)}else if(96==d){var g=JSON.parse(u);for(var h in u="",g)u=u+h+";";-1!=u.indexOf(";")&&(u=u.substring(0,u.lastIndexOf(";")))}else n.COLUMNNAME&&n.TABLENAME&&"SERVICEDURATION"===n.COLUMNNAME&&"CrmServiceDetails"===n.TABLENAME?u=Handlebars.helpers.setServiceDuration(u):300!=d&&301!=d&&(u=$ESAPI.encoder().encodeForHTML(u.toString()))}else u="-";t+=250===d?"<tr > <td> "+$ESAPI.encoder().encodeForHTML(s)+' </td><td  style="max-width: 266px;" class="tooltipInfoEllipsis"> <crm-richtext-component  cx-prop-from ="view" cx-prop-value ="'+u+'" show-more-button = "false"></crm-richtext-component> </td> </tr> ':"<tr > <td> "+$ESAPI.encoder().encodeForHTML(s)+' </td><td  style="max-width: 266px;" class="tooltipInfoEllipsis"> '+u+" </td> </tr> "}}t+="</table></div>";var v=$L("crm-canvas-quicksavepopup")[0];v&&v.component.data.showPopup?crmui.showTooltip({content:t,isHTML:!0,position:"center",tooltipHover:!1,classList:"maxW500 lookupACToolTip tooltipInCanvasQuickSavepopup"}):crmui.showTooltip({content:t,isHTML:!0,position:"center",tooltipHover:!1,classList:"maxW500 lookupACToolTip"})},searchForLookupValue:async function(e,t,r,a,o,i,n,s,l){var c=$.escapeSelector(r),d=$("img[id='"+c+"_loadimg']"),u=$("img[id='"+c+"_img']"),m=[],p="",g="",h="",v="",f=$("input[id='"+c+"']"),C=$("#socAddToCrmPop");f.length<1&&(f=!!(s&&s.length>0)&&(Crm.isLineItemSubFormModule(s.data("subformdisplaylabel"))&&"PRODUCTID"===s.data("colname"))?s:f);if(f.length&&"Services"===f.data().lookupModule){var y=$("#serviceDurationAndPrice");y.length&&""!==f.data().uiAutocomplete.previous&&f.data().uiAutocomplete.previous!==f.val()&&y.slideUp(100,(function(){$("#serviceDurationAndPrice").remove()}))}if(u&&u.data()){p=u.data("module"),g=$("#Crm_"+p+"_CURRENCYISOCODE").val();var b=$("#subvalue_CURRENCYISOCODE");void 0===g&&(g=b.html(),"Calls"===p&&void 0!==b.html()&&(g=b[0].component.data.cxPropValue))}else f._form()&&(p=f._form().data("module"),g=$("#Crm_"+p+"_CURRENCYISOCODE").val());crmLookupAutoComplete.searchText=crmLookupAutoComplete.searchText.trim(),null==g&&(g=""),crmLookupAutoComplete.currenctISOCode=g;var I=!1;if(void 0!==f.data("subformsectionlabel")&&""!==f.data("subformsectionlabel")&&(I=!0),"Contacts"===crmLookupAutoComplete.searchModule&&"Crm_Contacts_REPORTINGTOCONTACTID"===crmLookupAutoComplete.fldName){var T=$("#Crm_Contacts_ACCOUNTID");T[0]&&(h=T.data("id")),""===h&&(T=$("#mouseArea__ACCOUNTID"))&&(h=T.data(P).params.defaultid),"edit"===window[crmLookupAutoComplete.searchModule].currentStatus&&(v=window[crmLookupAutoComplete.searchModule].entityId),""===v&&window.businessCardJson&&(v=window.businessCardJson.entityid)}var w=$("#multipleFieldsEditPop").is(":visible");if(Crm.userDetails.isLookupAdvancedSearchEnabled){var E=$L("#socialEntityCreate").is(":visible");if(void 0===p||void 0===window[p].createEditJson||E)k=$("#layoutdetails").val();else var k=null!=window[p].createEditJson.layout_jsonarrayObj?window[p].createEditJson.layout_jsonarrayObj.sysLayoutId:w&&window[p].createEditJson.LayoutId?window[p].createEditJson.LayoutId:returnJson.layout_jsonarrayObj.sysLayoutId}if(Crm.userDetails.isDynamicLookupFilterEnabled){var O=store.peekRecord("field",f.data("fieldid"));let e=$("#createEntityForm").is(":visible"),t=$L("#VRAjaxEdit").is(":visible"),r=$L("#formRuleMandatoryFields").is(":visible"),a=$L("#socialEntityCreate").is(":visible");var S;let o=p?moduleRecordMapping[p].api_name:"";if(I){let e=moduleRecordMapping[f.data("subformdisplaylabel")].id;for(let t in moduleRecordMapping)moduleRecordMapping[t].id===e&&(o=moduleRecordMapping[t].api_name,S=moduleRecordMapping[t].module_name)}if(O||(await store.findAll("field",{module:o,type:"all"},!1,void 0,{apiVersion:"4"}),O=store.peekRecord("field",f.data("fieldid"))),O&&O.lookup&&O.lookup.query_details&&O.lookup.query_details.criteria){var R=O.lookup.query_details.criteria;if(crmLookupAutoComplete.DLF_Data={},e||t||r){let t=e?l:p;var M=t,_=store.peekRecord("module",moduleRecordMapping[t].id).fields;crmTemplate.iterateGroupFieldsAndGetFieldValues(R,_,crmLookupAutoComplete.DLF_Data,M)}else if(w){if((_=store.peekRecord("module",moduleRecordMapping[p].id).fields)||(_=await store.findAll("field",{module:moduleRecordMapping[p].api_name,type:"all"},!1,void 0,{apiVersion:"4"})),I){var D={};D.subformApiName=moduleRecordMapping[S].api_name,D.subformTabId=subFormTabId,D.subformTabName=S,D.isSubformField=I,D.index=f.attr("id").split("_")[4];var L=await Lyte.registeredMixins["crm-lookup-filter-mixin"].loadChildRelationShip(D,p);_=store.peekRecord("module",moduleRecordMapping[p].id).fields,_=L.concat(_)}crmTemplate.iterateGroupFieldsAndGetFieldValues(R,_,crmLookupAutoComplete.DLF_Data,p,D),"fieldsContainer_header"===$L("#multipleFieldsEditPop #duringTabs").find(".sel").attr("id")&&(crmLookupAutoComplete.DLF_Data.id=detailView.entityId)}else{if(!(_=store.peekRecord("module",moduleRecordMapping[p].id).fields)){_=(await store.findRecord("module",moduleRecordMapping[p].id)).fields}crmTemplate.iterateGroupFieldsAndGetFieldValues(R,_,crmLookupAutoComplete.DLF_Data,p)}if(!e&&!a&&!w){var A=detailView.entityId;!A&&Crm.isInventoryModule(Crm.moduleName)&&(A=crmCommonModule.createEditJson.entityId),crmLookupAutoComplete.DLF_Data.id=A}}}var P={searchmodule:crmLookupAutoComplete.searchModule,fldValue:crmLookupAutoComplete.searchText,isAutoComplete:!0,offset:e,currencyISOCode:g,productId:h,fldName:crmLookupAutoComplete.fldName,entityId:v,fieldId:f.data("fieldid"),layoutId:k,isSubFormField:I,isBP:w};if(Crm.userDetails.isDynamicLookupFilterEnabled&&(P.child_data=JSON.stringify(crmLookupAutoComplete.DLF_Data)),"PhoneNumbers"!==crmLookupAutoComplete.searchModule){if(crmLookupAutoComplete.searchModule!==crmModuleConstants.Accounts||p!==crmModuleConstants.Accounts||C.is(":visible")||"edit"!==window[p].currentStatus&&"view"!==window[p].currentStatus||(P.seId=window[p].entityId),P.parentModule=p,p&&window[p]&&window[p].createEditJson)window[p].createEditJson.layout_jsonarrayObj?U=window[p].createEditJson.layout_jsonarrayObj.sysLayoutId:returnJson.layout_jsonarrayObj&&(U=returnJson.layout_jsonarrayObj.sysLayoutId),"view"==window[p].currentStatus&&returnJson.layout_jsonarrayObj&&(U=returnJson.layout_jsonarrayObj.sysLayoutId);else var U=$("#layoutdetails").val();U&&"null"!=U&&"undefined"!=U&&(P.layoutId=U);var B,x=$("#createEntityForm");if(x.is(":visible"))(B=x.find("[name=layoutId]").val())&&(P.layoutId=B);if($("#convertLeadForm").is(":visible"))(B=Crm.VR.potLayoutId)&&(P.layoutId=B);""!==s.attr("data-criteria")&&(P.filtercriteria=s.attr("data-criteria")),P[csrfParamName]=csrfToken,crmLookupAutoComplete.DLF_Data&&(P.child_data=JSON.stringify(crmLookupAutoComplete.DLF_Data),crmLookupAutoComplete.DLF_Data={}),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/Search.do?",data:P,type:"POST",success:function(e){crmLookupAutoComplete.searchModuleBCFields=e.Field,m=e.Value,crmLookupAutoComplete.filterConfigured=e.filterConfigured,m&&(crmLookupAutoComplete.searchResult=crmLookupAutoComplete.searchResult.concat(m),crmLookupAutoComplete.listcount=crmLookupAutoComplete.listcount+m.length,crmLookupAutoComplete.matchingResultsFound=crmLookupAutoComplete.listcount>0),null!=t?(d.removeClass("vVIm"),0===crmLookupAutoComplete.listcount?t(crmLookupAutoComplete.getEmptyItem(crmLookupAutoComplete.searchText,r)):t(m)):(crmLookupAutoComplete.pages=Math.ceil(crmLookupAutoComplete.listcount/i),o.push.apply(o,m),crmLookupAutoComplete.removeLoadingDiv(a),crmLookupAutoComplete.loadItemsToAutoCompleteWidget(a,o,i,n)),d.removeClass("vVIm"),crmLookupAutoComplete.gotResult=!0},error:function(e){d.removeClass("vVIm"),e.status===crmConstants.errorStatusCode&&$L(window).scrollTo({top:0})}})}},openSearchCreatePopUp:function(e,t,r){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=(e=$("[id='"+e+"']")).val(),o=crmLookupAutoComplete.searchModule;r&&(o=r);var i=e.attr("id"),n=[],s={accounts:[]};if(!crmLookupAutoComplete.isInventoryModule(o)){var l=Crm.getCrmBasePath()+"/QuickCreateAction.do?module="+encodeURIComponent(o)+"&searchmodule="+encodeURIComponent(o)+"&fldName="+encodeURIComponent(i)+"&fldId="+encodeURIComponent(i)+"&fldLabel="+encodeURIComponent(o)+"&fldValue="+encodeURIComponent(a)+"&newModel=true";""!=crmLookupAutoComplete.currenctISOCode&&(l=l+"&currencyISOCode="+crmLookupAutoComplete.currenctISOCode),"leadConvertLookup"===t&&(l=Crm.getCrmBasePath()+"/QuickCreateAction.do?targetForm=convertlead&module="+encodeURIComponent(o)+"&searchmodule="+encodeURIComponent(o)+"&fldName="+encodeURIComponent(i)+"&fldId="+encodeURIComponent(i)+"&fldLabel="+encodeURIComponent(o)+"&fldValue="+encodeURIComponent(a)+"&frmzc=false&newModel=false");var c,d=$("#"+i).data("fieldid");if(o&&window[o]&&window[o].createEditJson)window[o].createEditJson.layout_jsonarrayObj?u=window[o].createEditJson.layout_jsonarrayObj.sysLayoutId:returnJson.layout_jsonarrayObj&&(u=returnJson.layout_jsonarrayObj.sysLayoutId),"view"==window[o].currentStatus&&returnJson.layout_jsonarrayObj&&(u=returnJson.layout_jsonarrayObj.sysLayoutId);else var u=$("#layoutdetails").val();if(u&&"null"!=u&&"undefined"!=u?l+="&folLayoutId="+u:returnJson&&returnJson.relListLabelsJson&&returnJson.relListLabelsJson.module&&"view"==window[returnJson.relListLabelsJson.module].currentStatus&&(l+="&folLayoutId="+returnJson.layoutIdOfEntity),d&&"null"!=d&&"undefined"!=d&&(l+="&folLookupFieldId="+d),"Crm_Contacts_REPORTINGTOCONTACTID"===i)if(l=l+"&entityId="+window[o].entityId,"view"===window[o].currentStatus)(c=$("#subvalue_ACCOUNTID"))[0]&&null!=(m=JSON.parse(c[0].dataset.params).id)&&"null"!=m&&""!=m&&(n[0]=m,s.accounts[0]={},s.accounts[0].id=m,s.accounts[0].name=c[0].text,l=l+"&productId="+m+"&accDetails="+encodeURIComponent(JSON.stringify(s))+"&accountid="+m+"&accountname="+encodeURIComponent(c[0].text));else if((c=$("#Crm_Contacts_ACCOUNTID"))[0]){var m=c.data("id");null!=m&&"null"!=m&&""!=m&&(n[0]=m,s.accounts[0]={},s.accounts[0].id=m,s.accounts[0].name=c[0].value,l=l+"&productId="+m+"&accDetails="+encodeURIComponent(JSON.stringify(s))+"&accountid="+m+"&accountname="+encodeURIComponent(c[0].value))}$("#searchCreatePopup").addClass("fromAutoComplete"),l=networkUtils.getPortalURL(l),commonUtils.openCustomLookup(l,void 0,"searchCreatePopup",void 0,void 0,void 0,void 0,void 0,(function(){var e=$("#ac-recordname").children().find("input"),t=e.attr("maxlength");a.length>t&&(a=a.substring(0,t)),e.val(a)})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(o))&&Crm.downloadValidationRules(l,o)}}},isInventoryModule:function(e){return["Quotes","SalesOrders","PurchaseOrders","Invoices","PriceBooks"].contains(e)}};