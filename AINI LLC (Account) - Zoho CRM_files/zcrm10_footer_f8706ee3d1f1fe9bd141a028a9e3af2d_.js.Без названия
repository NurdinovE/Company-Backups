var CFRExec={formRuleModule:null,ruleExecutedinDetailViewPage:!0,ruleDownloadPromise:void 0,oldResJson:{},CFRules:{},actionTakenTrueHolder:{},actionTakenFalseHolder:{},LayoutRuleHiddenElem:[],LayoutRuleConditionInvolvedElem:[],mandatoryInputNeededElem:[],lrMandatoryElem:[],relatedEntityMap:{},_relatedEntityMap:{},tabIndexingResult:[],ruleLayoutId:null,ajaxEditedFields:[],ajaxEditHaltedFieldColName:void 0,ajaxEditHaltNeeded:!1,promptIfMandatory:!1,workOnDom:!1,haltStateParams:{},revertPotentials:void 0,tempHolder:{},setDependentCall:!1,isServiceAvailabilitySection:!1,fromVR:!1,feature:void 0,reExecuteNeed:!1,reExecuteStarted:!1,reExecuteStarted2:!1,popupShowingFieldArr:[],CONSTANTFORSTRING:{EMPTYSTRING:"",FORMRULEDATATYPE:"frDT"},OPERATIONCONSTANT:{EDIT:"edit",VIEW:"view",PRINT:"print",LIST:"list",QUICK_CREATE:"quick_create"},DATATYPE:{PICKLIST:"picklist",DATE:"D",DATETIME:"DT",NUMBER:"N",TEXT:"T",BOOLEAN:"B",MXN:"MXN",USER:"U"},COMMONCOMPARATOR:{EMPTY:"${EMPTY}",NOTEMPTY:"${NOTEMPTY}"},TEXTCOMPARATOR:{IS:"is",ISNT:"isn't",CONTAINS:"contains",DOESNTCONTAINS:"doesn't contain",STARTSWITH:"starts with",ENDSWITH:"ends with"},NUMBERCOMPARATOR:{EQUAL:"=",NOTEQUAL:"!=",LESSTHAN:"<",LESSTHANEQUAL:"<=",GREATERTHAN:">",GREATERTHANEQUAL:">=",BETWEEN:"between",NOTBETWEEN:"not between"},DATETIMECOMPARATOR:{TODAY:"${TODAY}",TOMORROW:"${TOMORROW}",STARTINGTOMORROW:"${TOMORROWPLUS}",YESTERDAY:"${YESTERDAY}",TILLYESTERDAY:"${YESTERDAYMINUS}",LASTMONTH:"${LASTMONTH}",CURRENTMONTH:"${THISMONTH}",NEXTMONTH:"${NEXTMONTH}",AGEORDUE:"${AGE",LASTWEEK:"${LASTWEEK}",CURRENTWEEK:"${THISWEEK}",NEXTWEEK:"${NEXTWEEK}",BETWEEN:"between",NOTBETWEEN:"not between",ISAFTER:"is after",ISBEFORE:"is before",ISNT:"isn't",IS:"is"},CFRule:function(){this.cfPrimaryFieldName,this.queryObj={}},CFQuery:function(){this.actionsObj={},this.conditionsObj={},this.logicRepresentation},CFRCondition:function(){this.relationalcriteriaid,this.conditionElementName,this.dataType,this.comparatorStr,this.compareValue=[],this.userCompareDTValue=[],this.islookup,this.casesensitive},CFRAction:function(){this.actionElementId,this.actionElementName,this.actionType,this.actionValue},init:function(e,t,a,r){var i=CFRExec.OPERATIONCONSTANT.QUICK_CREATE===a;if(i?CFRExec.initQCObject(t,r):(CFRExec.moveToTempHold(),CFRExec.CFRules={},CFRExec.ruleLayoutId=null,CFRExec.haltStateParams={},CFRExec.relatedEntityMap={},CFRExec.oldResJson=e,CFRExec.formRuleModule=t),"string"==typeof e&&(e=$.parseJSON(e)),!validationUtils.isEmpty(e.rules)){CFRExec.ruleLayoutId=e.layoutId,CFRExec.LayoutRuleConditionInvolvedElem=[],CFRExec.LayoutRuleHiddenElem=[];let r=[];for(var n in e.rules){var l=e.rules[n],o=new CFRExec.CFRule;o.cfPrimaryFieldName=l.pfcol;for(var s=l.qarr,d=s?s.length:0,c=0;c<d;c++)if(s[c].scid)r.push(n);else{var m=s[c].actns,u=s[c].cnds,C=new CFRExec.CFQuery;C.logicRepresentation=s[c].lrep;for(var p=u.length,f=0;f<p;f++){var g=u[f],R=new CFRExec.CFRCondition;R.casesensitive=g.cs,R.relationalcriteriaid=g.rcid,R.conditionElementName=g.col,R.compareStr=g.cmps,R.compareValue=g.cmpv,R.dataType=g.dt,R.userCompareDTValue=g.ufdtarr,!0===g.islkup&&(R.isLookup=g.islkup),C.conditionsObj[f+1]=R,CFRExec.LayoutRuleConditionInvolvedElem.pushUniqValues(g.col)}for(var E=m.length,v=0;v<E;v++){var T=m[v],F=new CFRExec.CFRAction;if(F.actionType=T.atyp,1===F.actionType||4===F.actionType)F.actionElementId=CFRExec.getElemId(a,T.aenm,T.isAggField),F.isAggField=T.isAggField;else{if(i)continue;F.actionElementId="secDiv_"+T.aenm.replace(/ /g,"_")}F.actionElementName=T.aenm,F.actionValue=T.val,C.actionsObj[v+1]=F}o.queryObj[c+1]=C}r.includes(n)||(CFRExec.CFRules[n]=o)}a===CFRExec.OPERATIONCONSTANT.EDIT&&$("#preHTMLContainer_"+t).find(".labelValCreate :input,crm-user-wrapper[id^=Crm_]").not("[data-subformdisplaylabel]").on("executeFormRules",(function(){var e=$(this).data(),t=e.colname;if(void 0!==e.colname&&void 0===e.subformdisplaylabel){var r=CFRExec.getValueFromEditForm(this,a);CFRExec.setValue(t,r,CFRExec.OPERATIONCONSTANT.EDIT),CFRExec.isColTriggerLayoutRule&&CFRExec.evalRules(a,!0)}}))}i&&(r.qcObject.LayoutRuleConditionInvolvedElem=CFRExec.LayoutRuleConditionInvolvedElem,r.qcObject.LayoutRuleHiddenElem=CFRExec.LayoutRuleHiddenElem,r.qcObject.ruleLayoutId=CFRExec.ruleLayoutId)},getValueFromEditForm:function(e,t){var a=$(e).data("colname"),r=$(e).data("uitype"),i=$(e).val();if(i!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING)786===r||30===r||14===r||333===r?i=CFRExec.getDateTimeValue(a,t):4===r||5===r||6===r||7===r||9===r||10===r||12===r||13===r||15===r||133===r||r===CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY?i=$(e).data("id")+"#"+i:301!==r&&300!==r||(i=$(e).is(":checked")?"true":"false");else if(8===r)i=$(e).data("id")+"#"+i;else if(Crm.userDetails.isMULQCSupported&&445===r&&$(e)[0].tagName.startsWith("CRUX")){let t=$L(e)[0].component.getValue();i=t&&t.map((e=>e.id)).toString()}return i},getDateTimeValue:function(e,t){if(t===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var a=CFRExec.getContainerDiv(t),r=".Crm_"+CFRExec.formRuleModule+"_"+e;return"HH:mm"===Crm.userDetails.TIME_FORMAT?a.find(r).val()+" "+a.find(r+"_dateTime").val():a.find(r).val()+" "+a.find(r+"_dateTime").val()+" "+a.find(r+"_ampm").val()}return $("#Crm_"+CFRExec.formRuleModule+"_"+e).val()+" "+$("#Crm_"+CFRExec.formRuleModule+"_"+e+"_TimeOption").val()},evalRules:function(e,t,a){var r=CFRExec.OPERATIONCONSTANT.QUICK_CREATE===e;if(!r&&void 0!==Lyte.Router.getRouteInstance()&&void 0!==Lyte.Router.getRouteInstance().currentModel){var i=Lyte.Router.getRouteInstance().currentModel.module;void 0===i&&Lyte.Router.getRouteInstance().currentModel.model&&(i=Lyte.Router.getRouteInstance().currentModel.model.module)}if(r||void 0!==CFRExec.previousModuleName||(CFRExec.previousModuleName=i),!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&CFRExec.holdFormRule()&&CFRExec.getCurrentLayoutId(e)===CFRExec.ruleLayoutId){for(var n in CFRExec.actionTakenFalseHolder={},CFRExec.actionTakenTrueHolder={},CFRExec.workOnDom=t,0===Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(e)),r||"Leads"!==CFRExec.formRuleModule&&"Contacts"!==CFRExec.formRuleModule||CFRExec.correctEntityMapForSalutation(e),CFRExec.CFRules)if(CFRExec.relatedEntityMap.hasOwnProperty(CFRExec.CFRules[n].cfPrimaryFieldName))for(var l in CFRExec.CFRules[n].queryObj){var o=CFRExec.CFRules[n].queryObj[l].logicRepresentation,s=null,d=null;for(var c in 1===o.length?(s=!1,d=!1):null===o.match(/\|/)?s=!0:null===o.match(/&/)&&(d=!0),CFRExec.CFRules[n].queryObj[l].conditionsObj){var m=!1;if(CFRExec.relatedEntityMap.hasOwnProperty(CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName)>0){var u,C;"MXN"===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType&&Lyte.Router.getRouteInstance()&&(C=Lyte.Router.getRouteInstance().parent.currentModel?Lyte.Router.getRouteInstance().parent.currentModel.module_name:Lyte.Router.getRouteInstance().parent.parent.currentModel.module.module_name);var p=document.getElementById("Crm_"+C+"_"+CFRExec.CFRules[n].cfPrimaryFieldName),f=document.getElementById("value_"+CFRExec.CFRules[n].cfPrimaryFieldName),g=document.getElementById("subvalue_"+CFRExec.CFRules[n].cfPrimaryFieldName);if(u="MXN"===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType&&"quick_create"!==e?p?p.value:g?g.innerHTML:f?f.innerHTML.replace(/\s/g,""):CFRExec.getValue(CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName,e,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType):"MXN"===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType&&g&&"related_list"!==a&&"view"===e?g.innerHTML:CFRExec.getValue(CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName,e,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType),"print"!==e&&"MXN"===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType&&CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName.includes("MXNDUMMYCOLUMN_USER")){var R=document.getElementById("value_"+CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName);let e=u;u=!R||"ajaxEdit"===a&&CFRExec.ajaxEditHaltedFieldColName.includes("MXNDUMMYCOLUMN_USER")?document.querySelector("[id^=sel_Crm_"+C+"_"+CFRExec.ajaxEditHaltedFieldColName+"]")?document.querySelector("[id^=sel_Crm_"+C+"_"+CFRExec.ajaxEditHaltedFieldColName+"]").firstChild.data:"":R.textContent.trim(),Crm.userDetails.isMULQCSupported&&r&&(u=e)}if("Potentials"===CFRExec.formRuleModule&&"STAGE"===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName&&u&&-1!==u.indexOf(":")){u=u.substring(u.indexOf(":")+1,u.length);var E=CFRExec.CFRules[n].queryObj[l].conditionsObj[c].compareValue;if("${OPEN}"===E[0]||"${CLOSEDWON}"===E[0]||"${CLOSEDLOST}"===E[0]){var v=$("#Crm_Potentials_STAGE").data("values"),T="html";e!==CFRExec.OPERATIONCONSTANT.VIEW&&e!==CFRExec.OPERATIONCONSTANT.LIST&&e!==CFRExec.OPERATIONCONSTANT.PRINT||v||(v=returnJson.entityMapJson.STAGE.val,T="content");var F=null;if(v)for(var h=v.length,y=0;y<h;y++)if(v[y][T]===u){F=v[y].actualFcCategory?v[y].actualFcCategory:v[y].fccategory?v[y].fccategory:v[y].fcCategory;break}!F&&r&&(F=$("#Potentials_fldRow_STAGE").find("option:selected").attr("fctype")),u="Closed"===F||"Closed Won"===F?"${CLOSEDWON}":"Omitted"===F||"Closed Lost"===F?"${CLOSEDLOST}":"${OPEN}"}}CFRExec.fieldVsValue&&(CFRExec.fieldVsValue[CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName]=u),m=CFRExec.getCompareResult(CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].dataType,u,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].compareStr,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].compareValue,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].userCompareDTValue,CFRExec.CFRules[n].queryObj[l].conditionsObj[c].casesensitive);var _=CFRExec.CFRules[n].queryObj[l].actionsObj,x=!1;for(var O in _)if(1===_[O].actionType){x=!0;break}if(m!=CFRExec.tabIndexingResult[c]&&x&&(CFRExec.tabIndexingResult[n]=m,CFRExec.tabIndexingRequired=!0),CFRExec.CFRules[n].cfPrimaryFieldName===CFRExec.CFRules[n].queryObj[l].conditionsObj[c].conditionElementName&&!1===m){o=!1;break}}else m=!1;if("ignore"===m){o="ignore";break}if(s&&!1===m){o=!1;break}if(d&&!0===m){o=!0;break}o=o.replace(CFRExec.CFRules[n].queryObj[l].conditionsObj[c].relationalcriteriaid,m)}var N=o;if("boolean"!=typeof o){if("ignore"===o)break;N=CFRExec.evalBooleanExpression(o)}CFRExec.handleActionTakenLaterHolder(CFRExec.CFRules[n].queryObj[l].actionsObj,N,e)}CFRExec.performActionFromHolder(e),!CFRExec.tabIndexingRequired&&CFRExec.previousModuleName==i||null==i||(CFRExec.previousModuleName=i,CFRExec.tabIndexingRequired=!1,CFRExec.tabIndexing()),e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.promptIfMandatory&&CFRExec.promptMandatoryInputIfApplicable(),"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_FIELD_FEATURE&&ProcessFlow.performPostLRExecActions()}CFRExec.actionTakenFalseHolder={},CFRExec.actionTakenTrueHolder={},CFRExec.fromVR=!1},addListenerForQCMode:function(e,t){if(CFRExec.QCObj&&validationUtils.isNotEmpty(CFRExec.QCObj.CFRules)){var a=$("#"+t);a.find(".labelValCreate :input,crm-user-wrapper[id^=Crm_],crux-user-component[id^=Crm_]").on("change",(function(){CFRExec.collectFieldInfoForQCAndTrigger(this,e)})),a.find(".labelTabCreate :input,crm-user-wrapper[class^=Crm_],crux-user-component[class^=Crm_]").on("change",(function(){CFRExec.collectFieldInfoForQCAndTrigger(this,e)}))}},collectFieldInfoForQCAndTrigger:function(e,t){var a=$(e).data(),r=a.colname;if(void 0!==a.colname){var i=CFRExec.getValueFromEditForm(e,CFRExec.OPERATIONCONSTANT.QUICK_CREATE);CFRExec.setValue(r,i,CFRExec.OPERATIONCONSTANT.QUICK_CREATE),CFRExec.isColTriggerLayoutRule(r)&&CFRExec.evalRulesForQCMode(t)}},evalRulesForQCMode:function(e,t){if(CFRExec.QCObj&&validationUtils.isNotEmpty(CFRExec.QCObj)&&validationUtils.isNotEmpty(CFRExec.QCObj.CFRules)){if(t)for(var a=Object.keys(t),r=a.length,i=0;i<r;i++){var n=t[a[i]],l=n.column_name,o=$(".Crm_"+e+"_"+l);o&&(o.data({colname:l,uitype:n.uitype}),"DateTime"===n.type&&$(".Crm_"+e+"_"+l+"_dateTime").data({colname:l,uitype:n.uitype})),CFRExec.relatedEntityMap[l]={uitype:n.uitype+"",type:n.type,mandate:n.mandatory};var s=CFRExec.getValueFromEditForm(o,CFRExec.OPERATIONCONSTANT.QUICK_CREATE);CFRExec.setValue(l,s,CFRExec.OPERATIONCONSTANT.QUICK_CREATE)}CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.QUICK_CREATE,!0)}},initQCObject:function(e,t){var a=t.qcObject;a.formRuleModule=e,a.ruleLayoutId=null,a.relatedEntityMap={},a.CFRules={},a.promptIfMandatory=!1,a.LayoutRuleHiddenElem=[],a.LayoutRuleConditionInvolvedElem=[],CFRExec.QCObj&&(t.previousModeTempHolder.previousQCObject=CFRExec.QCObj),CFRExec.makeReallocationForQC(a,!1,t.previousModeTempHolder)},makeReallocationForQC:function(e,t,a){var r=["formRuleModule","ruleLayoutId","CFRules","relatedEntityMap","LayoutRuleConditionInvolvedElem","LayoutRuleHiddenElem","promptIfMandatory"],i=r.length;if(t){if(a)for(n=0;n<i;n++)CFRExec[r[n]]=a[r[n]];delete CFRExec.QCObj}else{CFRExec.QCObj=e;for(var n=0;n<i;n++)a[r[n]]=CFRExec[r[n]],CFRExec[r[n]]=e[r[n]]}},flushQCDataForMod:function(e){var t=CFRExec[e];void 0!==t&&(t&&validationUtils.isNotEmpty(t)&&(CFRExec.makeReallocationForQC(void 0,!0,t),t.previousQCObject&&(CFRExec.QCObj=t.previousQCObject)),delete CFRExec[e])},getWorkingContainer:function(){var e=$("#closedWon");!1===e.is(":visible")&&!1===(e=$("#multipleFieldsEditPop")).is(":visible")&&(e=$("#formRuleMandatoryFields"));var t=$("#VRAjaxEdit");return(CFRExec.fromVR||!0===t.is(":visible"))&&(e=t),e},tabIndexing:function(){var e=$(".secContent"),t=1;setTimeout((function(){$(".select2-hidden-accessible").length>0&&$.fn.select2.defaults.reset();for(var a=e.length,r=0;r<a;r++){for(var i=e[r],n=$(i).children(),l=$(n[0]).children(),o=$(n[1]).children(),s=0,d=l.length,c=o.length,m=0;m<d;m++){var u=$(l[m]).find(".labelValCreate");if("none"!=l[m].style.display){if(t=CFRExec.tabIndexingForFields(u,t),o[s]&&"2"==$(e[r]).attr("tab-traversal"))for(var C=s;C<c;C++){u=$(o[C]).find(".labelValCreate");if("none"!=o[C].style.display){t=CFRExec.tabIndexingForFields(u,t),s++;break}CFRExec.setTabindexForHiddenFields(u),s++}}else CFRExec.setTabindexForHiddenFields(u)}for(var p=s;p<c;p++){u=$(o[p]).find(".labelValCreate");"none"!=o[p].style.display?t=CFRExec.tabIndexingForFields(u,t):CFRExec.setTabindexForHiddenFields(u)}}}),1)},hideWorkingContainer:function(){var e="multipleFieldsEditPop",t=$("#multipleFieldsEditPop");!1===t.is(":visible")&&(e="closedWon",!1===(t=$("#closedWon")).is(":visible")&&(e="formRuleMandatoryFields",t=$("#formRuleMandatoryFields"))),CFRExec.fromVR&&(e="VRAjaxEdit",t=$("#VRAjaxEdit")),t.empty(),crmui.hidePopup(e)},promptMandatoryInputIfApplicable:function(){for(var e=[],t=$("#subSecondaryPopup").is(":visible"),a=CFRExec.getWorkingContainer(),r=$L("#multipleFieldsEditPop"),i=r.length>0&&"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_FIELD_FEATURE,n=$("#formRuleMandatoryFields"),l=$("#closedWon"),o=CFRExec.lrMandatoryElem.length,s=0;s<o;s++){if("FIRSTNAME"!==(O=CFRExec.lrMandatoryElem[s]))if(!CFRExec.isLayoutRuleHiddenElem(O)||CFRExec.skipActionForFeature(1)||r.length>0&&r.find("."+O+" .bp-during-field").length>0){if(CFRExec.mandatoryInputNeededElem.contains(O))e.push(O);else if(a.length>0){(x=a.find("#"+CFRExec.formRuleModule+"_fldRow_"+O)).find(".labelTabCreate").addClass("newmandatory"),x.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']").data("mandate","true"),x.show()}}else if(a.length>0){if(null!=(x=a.find("#"+CFRExec.formRuleModule+"_fldRow_"+O)).find(".bp-during-field"))continue;x.find(".labelTabCreate").removeClass("newmandatory"),x.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']").data("mandate","false"),x.hide()}}if(e.length>0){var d=a.is(":visible");if(d){for(var c=a.find(".fieldsContainer"),m=e.length,u=r.find(".bpLayoutRuleFldsContainer"),C=0;C<m;C++){var p=c.find("#"+CFRExec.getElemId(CFRExec.OPERATIONCONSTANT.EDIT,e[C]));if(p.find(".labelTabCreate").hasClass("newmandatory")||p.addClass("LR"),p.length>0)p.hasClass("LR")&&(p.find(".labelTabCreate").addClass("newmandatory"),p.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']").data("mandate","true"),p.show(),CFRExec.popupShowingFieldArr.pushUniqValues(e[C]));else if(i){u.removeClass("hide");var f=CFRExec.getFieldRow(e[C]);$L(f).addClass("LR bpLRmand crm-font-regular"),void 0!==f&&u.append(f)}else c.append(CFRExec.getFieldRow(e[C]))}CFRExec.makeFieldsOptionalIfNeeded(a,CFRExec.lrMandatoryElem),CFRExec.reExecuteNeed&&!CFRExec.reExecuteStarted&&(CFRExec.reExecuteStarted=!0,CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),CFRExec.reExecuteStarted=!1,CFRExec.reExecuteNeed=!1),t&&($("#subSecondaryPopup .fieldsContainer .labelTabCreate").addClass("columnCal1"),renderingUtils.labelWidthFixed("","subSecondaryPopup"))}else{crmTemplate.dependentFieldsList=[];var g=$(Handlebars.templates.FormRuleMandatoryFieldsInput()),R=(c=g.find(".fieldsContainer"),e.length);for(C=0;C<R;C++)c.append(CFRExec.getFieldRow(e[C]));$("#show").prepend(g),a=$("#formRuleMandatoryFields")}for(var E=a.find(".labelValCreate").find("input,select,textarea"),v=E.length,T=0;T<v;T++)E[T].setAttribute("tabindex",T+1);if(void 0!==CFRExec.ajaxEditHaltedFieldColName&&(CFRExec.ajaxEditHaltNeeded=!0),commonUtils.showHideLoadingDiv(),!d){var F=E.eq(0);if(void 0!==F){var h=F.attr("data-uitype"),y=F.closest("crux-text-area-component");y.length&&(h=y.attr("data-uitype")),(void 0===h||"333"!=h&&"30"!=h&&"201"!=h&&"786"!=h&&"14"!=h)&&(void 0===h||"1"===h?F.addClass("focusEleField").focus():F.focus())}CScriptLib?crmui.showPopup({id:"formRuleMandatoryFields",escToClose:!0,complete:()=>CScript.Engine.Global.dispatchEvent("onMandatoryFormLoad",void 0,void 0)}):crmui.showPopup("formRuleMandatoryFields",!0)}}else CFRExec.ajaxEditHaltNeeded=!1,CFRExec.promptIfMandatory=!1,CFRExec.makeFieldsOptionalIfNeeded(a,CFRExec.lrMandatoryElem);var _=CFRExec.popupShowingFieldArr.length;if((n.is(":visible")||l.is(":visible"))&&_>0&&!CFRExec.reExecuteStarted2){CFRExec.reExecuteStarted2=!0;for(C=0;C<_;C++){var x,O=CFRExec.popupShowingFieldArr[C],N=(x=a.find("#"+CFRExec.formRuleModule+"_fldRow_"+O)).find("#Crm_"+CFRExec.formRuleModule+"_"+O);CFRExec.setValue(O,CFRExec.getValueFromEditForm(N,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.OPERATIONCONSTANT.VIEW)}CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),CFRExec.popupShowingFieldArr=[],CFRExec.reExecuteStarted2=!1}CFRExec.handleChangeEventForFREval(a),CFRExec.setDependentCall&&(crmTemplate.setDependentFields(CFRExec.formRuleModule?CFRExec.formRuleModule:detailView.currentModule,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.setDependentCall=!1)},getFieldRow:function(e){var t=CFRExec.relatedEntityMap[e];"undefined"!=typeof ProcessFlow&&void 0!==ProcessFlow.layoutRuleData&&ProcessFlow.layoutRuleData.hasOwnProperty(e)&&($("#multipleFieldsEditPop").is(":visible")||void 0!==ProcessFlow.processConfiguredFieldColumn&&ProcessFlow.processConfiguredFieldColumn===CFRExec.ajaxEditHaltedFieldColName)&&((t=objectUtils.cloneObject_new(CFRExec.relatedEntityMap[e])).defaultvalue=ProcessFlow.layoutRuleData[e]);var a=crmTemplate.createFieldRow(returnJson.layout_jsonarrayObj.currLayoutId,CFRExec.formRuleModule,void 0,t,void 0,!0);return"2"!==CFRExec.relatedEntityMap[e].uitype&&"100"!==CFRExec.relatedEntityMap[e].uitype||(CFRExec.setDependentCall=!0),$(a).addClass("LR"),a},modifyAndTriggerDomChangeEvent:function(e,t){var a=$(e).data(),r=$("#multipleFieldsEditPop").is(":visible");if("36"==a.uitype){var i=$("#formRuleMandatoryFields").is(":visible");if(r||i){var n=$(e).parent().find(".resultValue").attr("data-valueres");null!=n&&null!=n&&(e.value=n)}}333===a.uitype&&r||$(e).trigger("create_edit_clone_DomChange",t)},handleChangeEventForFREval:function(e){var t=e.find(":not(.sfFormulaCalcBP).labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']");t.off("change").on("change",(function(e,t){CFRExec.modifyAndTriggerDomChangeEvent(this,t)})),t.off("create_edit_clone_DomChange").on("create_edit_clone_DomChange",(function(e,t){var a=CFRExec.validateObject(this);100===$(a).data("uitype")?CFRExec.setValue($(a).data("colname"),CFRExec.getValueFromEditForm($(a)),CFRExec.OPERATIONCONSTANT.VIEW):CFRExec.validateElementAndEvaluateLayoutRule(a,t),"SELECT"==$(this).prop("tagName")&&crmTemplate.modifySelectBox(e)})),thirdPartyUtils.bindSelect2(e.find("select")),crmTemplate.bindFldTooltip()},validateObject:function(e){var t=$(e).attr("id");if(-1!==t.indexOf("_TimeOption")){var a=t.substring(0,t.indexOf("_TimeOption"));return document.getElementById(a)}return e},makeFieldsOptionalIfNeeded:function(e,t){for(var a=e.find("div.LR"),r=a.length,i=null!=document.getElementById("multipleFieldsEditPop"),n=$("#formRuleMandatoryFields"),l=$L("#multipleFieldsEditPop"),o=$L("#bpsaveasdraft"),s=$("#closedWon"),d=0;d<r;d++){var c=a.eq(d),m=c.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']"),u=m.data("colname");if(!t.contains(u))if("undefined"==typeof ProcessFlow||!i||ProcessFlow.OPTIONAL_FIELD_FEATURE&&(!ProcessFlow.OPTIONAL_FIELD_FEATURE||m.hasClass("bp-during-field")||c.hasClass("bpLRshow"))){if(c.find(".labelTabCreate").removeClass("newmandatory"),m.data("mandate","false"),m.hasClass("bp-during-field")&&(c.removeClass("LR errorFieldP form_err_fld"),c.find(".errMsg").remove()),(n.is(":visible")||s.is(":visible"))&&!CFRExec.reExecuteNeed&&returnJson.entityMapJson[u]){CFRExec.reExecuteNeed=!0;var C=returnJson.entityMapJson[u].defaultvalue;CFRExec.setValue(u,C,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.relatedEntityMap[u].defaultvalue=C}}else c.remove()}"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_FIELD_FEATURE&&l.find(".LR").length>0?o.attr("lt-prop-disabled",!0):o.attr("lt-prop-disabled",!1)},validateElementAndEvaluateLayoutRule:function(e,t){var a=[],r=$(e),i=CFRExec.OPERATIONCONSTANT.VIEW,n=null!==document.getElementById("multipleFieldsEditPop");a.push(r.attr("id"));var l=!0;if("mapFieldDep"!==t&&(l=Crm.validateEntityAndShowErrorMsg(a,CFRExec.formRuleModule,!0),n&&"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_FIELD_FEATURE&&(l=Crm.validateEntityAndShowErrorMsg(a,CFRExec.formRuleModule,!0,void 0,!0))),l){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(i));var o=r.data("colname");"Lookup"===r.data("contentType")?r.val()===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?CFRExec.setValue(o,"#",i):CFRExec.setValue(o,Crm.requestParamWithColname[r.data("colname")]+"#"+r.val(),i):CFRExec.setValue(o,CFRExec.getValueFromEditForm(e),i),CFRExec.promptIfMandatory=!0,CFRExec.evalRules(i,!0)}else{var s=r.parent().next(".vr_err_verify_container");s&&s.length>0&&s.remove()}},performActionFromHolder:function(e){var t=!1,a=!1,r=Crm.userDetails.DV_MANDATORY_FIELD_ASTERIX_SYMBOL&&CFRExec.OPERATIONCONSTANT.VIEW&&"detail"===Lyte.Router.getRouteInstance().routeName,i=CFRExec.getContainerDiv(e),n=$L("#multipleFieldsEditPop"),l=$("#multipleFieldsEditPop").is(":visible")&&CFRExec.OPERATIONCONSTANT.VIEW===e;for(var o in CFRExec.mandatoryInputNeededElem=[],CFRExec.lrMandatoryElem=[],CFRExec.actionTakenTrueHolder)switch(CFRExec.actionTakenTrueHolder[o].actionType){case 1:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName]){var s=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName];if(CFRExec.workOnDom){if((y=i.find("#"+CFRExec.getElemId(e,CFRExec.actionTakenTrueHolder[o].actionElementName,CFRExec.actionTakenTrueHolder[o].isAggField))).hasClass("agrFld"))y.closest("#tr_"+CFRExec.actionTakenTrueHolder[o].actionElementName).show();else if(0===y.length&&Crm.userDetails.isSubformNewComponentEnabled&&CFRExec.actionTakenTrueHolder[o].isAggField){var d=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName];if(b=store.peekRecord("field",d.fieldid))(_=Lyte.deepCopyObject(b.view_type)).view=!0,Lyte.objectUtils(b,"add","view_type",_)}else if(y.hasClass("PRICINGMODEL")){var c=$("#"+crmTemplate.getElemIdByColname("PriceBooks","PRICINGMODEL")).val();"-None-"!=c&&c&&$("#secDiv_Pricing_Details").show(),y.show()}else e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?(y.addClass("formruleshow"),a=!0):y.show();if(e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.handleBusinessCardVisibility(CFRExec.actionTakenTrueHolder[o].actionElementName,!0),"Events"!==CFRExec.formRuleModule){var m=y.closest("."+e+"ParentSection"),u=m.attr("id")+"~2";void 0===m.data("nofield")||CFRExec.actionTakenFalseHolder.hasOwnProperty(u)||m.show()}}if(l&&"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_LR_ENABLED&&0===$L("#"+CFRExec.formRuleModule+"_fldRow_"+CFRExec.actionTakenTrueHolder[o].actionElementName).length&&"FIRSTNAME"!==CFRExec.actionTakenTrueHolder[o].actionElementName){var C=n.find(".fieldsContainer .bpLayoutRuleFldsContainer"),p=CFRExec.getFieldRow(CFRExec.actionTakenTrueHolder[o].actionElementName),f=$L(p);f.addClass("bpLRshow crm-font-regular"),0===C.find("."+CFRExec.actionTakenTrueHolder[o].actionElementName).length&&ProcessFlow.isValidLRFieldUIType(CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName].uitype,CFRExec.actionTakenTrueHolder[o].actionElementName)&&(C.removeClass("hide"),void 0!==s&&void 0!==s.mandate&&"true"===s.mandate&&f.addClass("bplayoutReq"),C.append(p),$L("#bpsaveasdraft").attr("lt-prop-disabled",!0))}CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(CFRExec.actionTakenTrueHolder[o].actionElementName)}break;case 2:case 6:CFRExec.showHideRequestedSection(i,e,CFRExec.actionTakenTrueHolder[o].actionElementId,!1);break;case 4:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName]){s=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName];if("detail"===Lyte.Router.getRouteInstance().routeName&&"true"!==s.readonly&&!0!==s.readonly){var g=store.peekRecord(moduleRecordMapping[CFRExec.formRuleModule].id,detailView.entityId);g&&g.$approval_state&&("approval_process_pending"===g.$approval_state||"approval_process_rejected"===g.$approval_state)&&(s.readonly=Lyte.registeredMixins.approvalprocess.restrictFieldsConfiguredInAPFromDetailView(s,g,businessCardJson.hidden,s.fieldid))}var R=e===CFRExec.OPERATIONCONSTANT.VIEW&&"detail"===Lyte.Router.getRouteInstance().routeName&&"undefined"!=typeof businessCardJson&&businessCardJson&&businessCardJson.isEditRestricted&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&detailView.changedBCJson.recordLockingDetails.fieldIds&&!detailView.changedBCJson.recordLockingDetails.fieldIds.contains(s.fieldid);if("true"!==s.restricted&&!0!==s.restricted&&"true"!==s.readonly&&!0!==s.readonly&&!R){if(void 0!==s.mandate&&!1!==s.mandate&&"false"!==s.mandate||("boolean"==typeof s.mandate?s.mandate=!0:s.mandate="true",s.frmandate=!0),!0===s.frmandate&&CFRExec.workOnDom){var E=i.find("#"+CFRExec.actionTakenTrueHolder[o].actionElementId);if(e===CFRExec.OPERATIONCONSTANT.EDIT){let e;e="FIRSTNAME"===CFRExec.actionTakenTrueHolder[o].actionElementName?E.find("input[id^='Crm_'],textarea[id^='Crm_'],crm-richtext-component[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']").not("[id*='SALUTATION']"):E.find("input[id^='Crm_'],textarea[id^='Crm_'],crm-richtext-component[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']"),e.data("mandate",s.mandate),s.mandate&&!1===e.data("cscript_visibility")&&(e.data("cscript_visibility",!0),E.show()),E.find("#Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenTrueHolder[o].actionElementName+"_label").addClass("newmandatory")}else if(e===CFRExec.OPERATIONCONSTANT.VIEW&&E.data("params"))E.data("params").mandate=s.mandate,r&&($("#mandate_ast_"+CFRExec.actionTakenTrueHolder[o].actionElementName+"_header").removeClass("dN"),$("#mandate_ast_"+CFRExec.actionTakenTrueHolder[o].actionElementName).removeClass("dN"));else if(0===E.length&&Crm.userDetails.isSubformNewComponentEnabled&&CFRExec.actionTakenTrueHolder[o].isAggField){d=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName];(b=store.peekRecord("field",d.fieldid))&&Lyte.objectUtils(b,"add","required","true"===s.mandate),r&&$("#mandate_ast_"+CFRExec.actionTakenTrueHolder[o].actionElementName+"_header").removeClass("dN")}else if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var v=CFRExec.QCObj,T="Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenTrueHolder[o].actionElementName;v&&v.qcFlow?E.find("#"+T+"_label").addClass("newmandatory"):E.find("td").eq(0).addClass("wf_requiredMark"),E.find("."+T).data("mandate",s.mandate)}}if(e===CFRExec.OPERATIONCONSTANT.VIEW){var F,h=void 0!==CFRExec.getRelatedEntityMap(CFRExec.OPERATIONCONSTANT.VIEW)[CFRExec.actionTakenTrueHolder[o].actionElementName]?CFRExec.getRelatedEntityMap(CFRExec.OPERATIONCONSTANT.VIEW)[CFRExec.actionTakenTrueHolder[o].actionElementName].defaultvalue:s.defaultvalue;if(Crm.userDetails.isSubformNewComponentEnabled&&CFRExec.actionTakenTrueHolder[o].isAggField){F=!0;d=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName];h=(h=store.peekRecord(moduleRecordMapping[CFRExec.formRuleModule].id,detailView.entityId)[d.sysRefName])||""}("Pick List"===CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[o].actionElementName].type&&(""===s.defaultvalue||"-None-"===s.defaultvalue||l&&""===h)||"Lookup"===s.type&&(void 0===s.defaultvalue||""===s.defaultvalue||l&&""===h)||"Currency"===s.type&&("null"===s.defaultvalue||s.defaultvalue===CFRExec.CONSTANTFORSTRING.EMPTYSTRING||l&&""===h)||556!==parseInt(s.uitype)&&(""===s.defaultvalue||l&&""===h))&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[o].actionElementName),556===parseInt(s.uitype)&&(void 0!==E?0===E.find("crm-image-upload-detail")[0].component.data.imageData.length&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[o].actionElementName):(""===s.defaultvalue||l&&""===h)&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[o].actionElementName)),CFRExec.lrMandatoryElem.pushUniqValues(CFRExec.actionTakenTrueHolder[o].actionElementName),CFRExec.manateFldVsValue&&(CFRExec.manateFldVsValue[CFRExec.actionTakenTrueHolder[o].actionElementName]=F?h:s.defaultvalue)}}}}for(var o in CFRExec.actionTakenFalseHolder)switch(CFRExec.actionTakenFalseHolder[o].actionType){case 1:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName]){s=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName];if(CFRExec.workOnDom){var y;if((y=i.find("#"+CFRExec.getElemId(e,CFRExec.actionTakenFalseHolder[o].actionElementName,CFRExec.actionTakenFalseHolder[o].isAggField))).hasClass("agrFld"))y.closest("#tr_"+CFRExec.actionTakenFalseHolder[o].actionElementName).hide();else if(0===y.length&&Crm.userDetails.isSubformNewComponentEnabled&&CFRExec.actionTakenFalseHolder[o].isAggField){var _;d=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName];if(b=store.peekRecord("field",d.fieldid))(_=Lyte.deepCopyObject(b.view_type)).view=!1,Lyte.objectUtils(b,"add","view_type",_)}else y.hasClass("PRICINGMODEL")?($("#secDiv_Pricing_Details").hide(),y.hide()):e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?(y.addClass("formruledn"),t=!0):y.hide();e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.handleBusinessCardVisibility(CFRExec.actionTakenFalseHolder[o].actionElementName,!1),CFRExec.LayoutRuleHiddenElem.pushUniqValues(CFRExec.actionTakenFalseHolder[o].actionElementName)}if(l&&"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_LR_ENABLED){var x,O="#"+CFRExec.formRuleModule+"_fldRow_"+CFRExec.actionTakenFalseHolder[o].actionElementName,N=$L(O),I=N.hasClass("bpLRshowSect");I&&(x=N.parent()),N.length>0&&0===N.find(".bp-during-field").length&&N.hasClass("bpLRshow")&&N.e.remove(),I&&x.hasClass("bpLRSectHeader")&&0===x.children().length&&x.e[0].remove();var A=n.find(".bpLayoutRuleFldsContainer");0===A.children().length&&A.addClass("hide")}}break;case 6:case 2:CFRExec.showHideRequestedSection(i,e,CFRExec.actionTakenFalseHolder[o].actionElementId,!0);break;case 4:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName])if("true"!==(s=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName]).restricted&&!0!==s.restricted&&"true"!==s.readonly&&!0!==s.readonly){if(void 0===s.frmandate&&"false"!==s.mandate&&!1!==s.mandate||("boolean"==typeof s.mandate?s.mandate=!1:s.mandate="false",s.frmandate=!1),!1===s.frmandate&&CFRExec.workOnDom){E=i.find("#"+CFRExec.actionTakenFalseHolder[o].actionElementId);if(e===CFRExec.OPERATIONCONSTANT.EDIT)E.find("#Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenFalseHolder[o].actionElementName+"_label").removeClass("newmandatory"),E.find("input[id^='Crm_'],textarea[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']").data("mandate",s.mandate);else if(e===CFRExec.OPERATIONCONSTANT.VIEW&&E.data("params"))E.data("params").mandate=s.mandate,r&&($("#mandate_ast_"+CFRExec.actionTakenFalseHolder[o].actionElementName+"_header").addClass("dN"),$("#mandate_ast_"+CFRExec.actionTakenFalseHolder[o].actionElementName).addClass("dN"));else if(0===E.length&&Crm.userDetails.isSubformNewComponentEnabled&&CFRExec.actionTakenFalseHolder[o].isAggField){var b;d=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[o].actionElementName];(b=store.peekRecord("field",d.fieldid))&&Lyte.objectUtils(b,"add","required","false"!==s.mandate),r&&$("#mandate_ast_"+CFRExec.actionTakenFalseHolder[o].actionElementName+"_header").addClass("dN")}else if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){v=CFRExec.QCObj,T="Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenFalseHolder[o].actionElementName;v&&v.qcFlow?E.find("#"+T+"_label").removeClass("newmandatory"):E.find("td").eq(0).removeClass("wf_requiredMark"),E.find("."+T).data("mandate",s.mandate)}}CFRExec.mandatoryInputNeededElem.removeLastOccurenceOfElement(CFRExec.actionTakenFalseHolder[o].actionElementName),CFRExec.lrMandatoryElem.removeLastOccurenceOfElement(CFRExec.actionTakenFalseHolder[o].actionElementName)}}t&&setTimeout((function(){i.find(".formruledn").removeClass("formruledn").hide()}),250),a&&setTimeout((function(){i.find(".formruleshow").removeClass("formruleshow").show()}),250),CFRExec.workOnDom&&CFRExec.hideSectionIfEmpty(e)},handleBusinessCardVisibility:function(e,t){var a=$("#headerlabel_"+e);a&&(t?a.parent().show():a.parent().hide())},skipActionForFeature:function(e){return!!CFRExec.feature&&("blueprint"===CFRExec.feature&&!e)},handleActionTakenLaterHolder:function(e,t,a){for(var r in e){var i=e[r],n=i.actionType;CFRExec.skipActionForFeature(n)||(a===CFRExec.OPERATIONCONSTANT.PRINT&&4===n||(t?(CFRExec.actionTakenFalseHolder=objectUtils.removeKeyFromGivenObj(CFRExec.actionTakenFalseHolder,i.actionElementId+"~"+n),CFRExec.actionTakenTrueHolder=objectUtils.addKeyToGivenObj(CFRExec.actionTakenTrueHolder,i.actionElementId+"~"+n,i),1===n&&CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(i.actionElementName)):CFRExec.actionTakenTrueHolder.hasOwnProperty(i.actionElementId+"~"+n)||(CFRExec.actionTakenFalseHolder=objectUtils.addKeyToGivenObj(CFRExec.actionTakenFalseHolder,i.actionElementId+"~"+n,i))))}},correctEntityMapForSalutation:function(e){if(e!==CFRExec.OPERATIONCONSTANT.EDIT){if(void 0===CFRExec.relatedEntityMap.FIRSTNAME){var t=$.extend({},CFRExec.relatedEntityMap.LASTNAME),a={},r=t.nameInfo;void 0!==r&&(t.defaultvalue=r.lastname,a.defaultvalue=r.firstname,a.colname="FIRSTNAME",a.type="Text",CFRExec.relatedEntityMap.LASTNAME=t,CFRExec.relatedEntityMap.FIRSTNAME=a)}}else if(void 0===CFRExec.relatedEntityMap.SALUTATION&&void 0!==CFRExec.relatedEntityMap.FIRSTNAME){var i=$.extend({},CFRExec.relatedEntityMap.FIRSTNAME.salDataObj),n={};n.defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING,void 0!==i["data-old-value"]&&(n.defaultvalue=i["data-old-value"]),n.colname=i["data-colname"],n.type="Pick List",CFRExec.relatedEntityMap[n.colname]=n}},convertCurrencyToHomeCurrencyIfRequired:function(e,t){var a=t;if(a!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING){if(!$.isEmptyObject(Crm.userDetails.CURRENCY_DETAILS)&&void 0!==CFRExec.relatedEntityMap.CURRENCYISOCODE&&void 0!==CFRExec.relatedEntityMap[e]&&"Currency"===CFRExec.relatedEntityMap[e].type&&CFRExec.relatedEntityMap.CURRENCYISOCODE.defaultvalue!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING){var r=CFRExec.relatedEntityMap.CURRENCYISOCODE.defaultvalue,i=Crm.userDetails.CURRENCY_DETAILS[r].er;return a=parseFloat(a)/parseFloat(i)}return parseFloat(a)}return a},getCompareResult:function(e,t,a,r,i,n,l){var o=null;switch("U"===t&&"-1"===i&&(i=Crm.userDetails.USER_ID),t){case CFRExec.DATATYPE.NUMBER:a=Search.reverseFormatNumber(a),a=CFRExec.convertCurrencyToHomeCurrencyIfRequired(e,a),o=CFRExec.evalNumberComparision(a,r,i);break;case CFRExec.DATATYPE.USER:o=!("isn't"===r&&!CFRExec.evalTextComparision(a,r,i,l))&&CFRExec.evalTextComparision(a,r,i);break;case CFRExec.DATATYPE.DATE:o=CFRExec.evalDateComparision(a,r,i,n,CFRExec.DATATYPE.DATE);break;case CFRExec.DATATYPE.DATETIME:o=CFRExec.evalDateComparision(a,r,i,n,CFRExec.DATATYPE.DATETIME);break;case CFRExec.DATATYPE.BOOLEAN:o=CFRExec.evalBooleanComparision(a,i);break;case CFRExec.DATATYPE.MXN:o=CFRExec.evalMxNComparision(a,i);break;case CFRExec.DATATYPE.PICKLIST:case CFRExec.DATATYPE.TEXT:var s=!1;r===CFRExec.TEXTCOMPARATOR.ISNT&&(s=!0);for(var d=i.length,c=0;c<d;c++)if("isn't"===r){if(!CFRExec.evalTextComparision(a,r,i[c],l)){s=!1;break}}else if("doesn't contain"===r){if(!CFRExec.evalTextComparision(a,r,i[c],l)){s=!1;break}s=!0}else if(CFRExec.evalTextComparision(a,r,i[c],l)){s=!0;break}o=s}return o},handleBusinessCardFields:function(){for(var e=$("#bcWraperDiv").find(".bcCardDetail tbody").find('td[id^="headerlabel"]'),t=$("#preHTMLContainer"),a=e.length,r=[],i=[],n=0;n<a;n++){var l=e.eq(n),o=l.attr("id");r[n]={},r[n].columnVal=o.substring(o.indexOf("_")+1),r[n].fieldDiv=t.find("#"+CFRExec.getElemId(CFRExec.OPERATIONCONSTANT.VIEW,r[n].columnVal)),r[n].fieldDivD=r[n].fieldDiv.css("display"),r[n].fieldDivCD=r[n].fieldDiv.closest("[id^=secDiv_]").css("display"),i[n]={},i[n].dom=l.closest("tr"),i[n].columnVal=i[n].dom.find("#header_"+r[n].columnVal),i[n].HcolumnVal=i[n].dom.find("#headerlabel_"+r[n].columnVal)}for(n=0;n<a;n++)r[n].fieldDiv.length>0&&("none"!==r[n].fieldDivD&&"none"!==r[n].fieldDivCD?void 0===r[n].fieldDiv.attr("onmouseover")&&(i[n].columnVal.removeAttr("onmouseover"),i[n].HcolumnVal.removeAttr("onmouseover")):i[n].dom.hide())},evalBooleanComparision:function(e,t){return e===t},evalMxNComparision:function(e,t){return t===CFRExec.COMMONCOMPARATOR.EMPTY&&""===e||t===CFRExec.COMMONCOMPARATOR.NOTEMPTY&&""!==e},evalNumberComparision:function(e,t,a){if(e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING||isNaN(e)){if(e=CFRExec.CONSTANTFORSTRING.EMPTYSTRING,a!==CFRExec.COMMONCOMPARATOR.EMPTY&&a!==CFRExec.COMMONCOMPARATOR.NOTEMPTY)return!1}else e=parseFloat(e);var r=null;if(a===CFRExec.COMMONCOMPARATOR.EMPTY)r=e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else if(a===CFRExec.COMMONCOMPARATOR.NOTEMPTY)r=e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else switch("between"!=t&&"not between"!=t&&(a=parseFloat(a)),t){case CFRExec.NUMBERCOMPARATOR.EQUAL:r=e==a;break;case CFRExec.NUMBERCOMPARATOR.NOTEQUAL:r=e!=a;break;case CFRExec.NUMBERCOMPARATOR.LESSTHAN:r=e<a;break;case CFRExec.NUMBERCOMPARATOR.LESSTHANEQUAL:r=e<=a;break;case CFRExec.NUMBERCOMPARATOR.GREATERTHAN:r=e>a;break;case CFRExec.NUMBERCOMPARATOR.GREATERTHANEQUAL:r=e>=a;break;case CFRExec.NUMBERCOMPARATOR.BETWEEN:r=e>=parseFloat(a[0])&&e<=parseFloat(a[1]);break;case CFRExec.NUMBERCOMPARATOR.NOTBETWEEN:r=!(e>=parseFloat(a[0])&&e<=parseFloat(a[1]));break;default:r=e===a}return r},evalTextComparision:function(e,t,a,r){var i=null;if(e=e&&"string"==typeof e?e.trim():"",a===CFRExec.COMMONCOMPARATOR.EMPTY)i=e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else if(a===CFRExec.COMMONCOMPARATOR.NOTEMPTY)i=e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else switch(a=a.trim(),0===r&&(e=e.toLowerCase(),a=a.toLowerCase()),t){case CFRExec.TEXTCOMPARATOR.IS:i=e===a;break;case CFRExec.TEXTCOMPARATOR.ISNT:i=e!==a;break;case CFRExec.TEXTCOMPARATOR.CONTAINS:i=-1!==e.indexOf(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.DOESNTCONTAINS:i=-1===e.indexOf(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.STARTSWITH:i=e.startsWith(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.ENDSWITH:i=e.endsWith(a.replace(/\*/g,""));break;default:i=e===a}return i},compareDateObj:function(e,t,a){var r=null;switch(a){case CFRExec.DATETIMECOMPARATOR.IS:r=e.getTime()-t[0].getTime()==0;break;case CFRExec.DATETIMECOMPARATOR.ISNT:r=e.getTime()-t[0].getTime()!=0;break;case CFRExec.DATETIMECOMPARATOR.ISBEFORE:r=e.getTime()-t[0].getTime()<0;break;case CFRExec.DATETIMECOMPARATOR.ISAFTER:r=e.getTime()-t[0].getTime()>0;break;case CFRExec.DATETIMECOMPARATOR.BETWEEN:r=e.getTime()-t[0].getTime()>=0&&e.getTime()-t[1].getTime()<=0;break;case CFRExec.DATETIMECOMPARATOR.NOTBETWEEN:r=e.getTime()-t[0].getTime()<0&&e.getTime()-t[1].getTime()>0;break;case"near by":break;default:r=e.getTime()-t[0].getTime()==0}return r},evalDateComparision:function(e,t,a,r,i){return a[0]===CFRExec.COMMONCOMPARATOR.EMPTY?e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING:a[0]===CFRExec.COMMONCOMPARATOR.NOTEMPTY?e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING:e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?"isn't"===t:i===CFRExec.DATATYPE.DATE?CFRExec.compareDateObj(new Date(e),CFRExec.getCompareDateObjWithTime(a,t,!0),t):CFRExec.compareDateObj(new Date(e),CFRExec.getCompareDateObjWithTime(void 0===r?CFRExec.getBrowserCompatibleDateTime(a):CFRExec.getBrowserCompatibleDateTime(r),t,void 0===r),t)},getBrowserCompatibleDateTime:function(e){for(var t=new Array,a=e.length,r=0;r<a;r++){var i=e[r].split(" "),n=i[0].split("-"),l=i[1].substring(0,i[1].indexOf(".")).split(":");t.push(new Date(n[0],n[1]-1,n[2],l[0],l[1],l[2]))}return t},getCompareDateObjWithTime:function(e,t,a){var r=[],i=new Date(e[0]);if(!0===a&&i.setHours(0,0,0,0),r.push(i),"between"===t||"not between"===t){var n=new Date(e[1]);!0===a&&n.setHours(0,0,0,0),r.push(n)}return r},getDateObjectFromDateTimeStr:function(e,t){var a=[];if("HH:mm"===Crm.userDetails.TIME_FORMAT)a=t.split(":");else{var r=t.substring(t.indexOf(" ")+1,t.length);(a=t.substring(0,t.indexOf(" ")).split(":"))[0]=Utils.convertTimeTo24HoursFormat(parseInt(a[0]),r)}return Utils.getDateObject(e,{hrs:a[0],mins:a[1]})},hideSectionIfEmpty:function(e){if("Events"!==CFRExec.formRuleModule&&e!==CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var t=null,a=null;e===CFRExec.OPERATIONCONSTANT.EDIT?(t=$("#preHTMLContainer_"+CFRExec.formRuleModule),a=".tabDivCreate"):e===CFRExec.OPERATIONCONSTANT.VIEW?(t=$("#preHTMLContainer"),a=".tabDiv"):e===CFRExec.OPERATIONCONSTANT.PRINT&&(t=$($("#pdfPreviewFrame")[0].contentDocument).find("#preHTMLContainer"),a=".rowTR");for(var r=t.find("."+e+"ParentSection:visible").not(".subformParentSection"),i=r.length,n=0;n<i;n++){var l=$(r[n]);if(0===l.find(a+":visible").length&&0==l.find(".subFrmLayout").length){if("PriceBooks"===CFRExec.formRuleModule&&l.find("#pricingList").length>0&&(a=".tabdiv",e===CFRExec.OPERATIONCONSTANT.VIEW&&l.find(a+":visible").length>0))continue;l.data("nofield",!0).hide()}}}},getValue:function(e,t,a){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(t));var r=CFRExec.relatedEntityMap[e].defaultvalue;if(void 0!==r&&r!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING||(r=CFRExec.CONSTANTFORSTRING.EMPTYSTRING),"picklist"===a&&"Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection||"Appointments"==CFRExec.formRuleModule&&"APPOINTMENTLOCATION"==e&&"view"!==t){var i=$("#Crm_"+CFRExec.formRuleModule+"_"+e);r=i.length?i.val():""}else"B"===a&&r===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?r="false":"picklist"===a&&"-None-"===r?r=CFRExec.CONSTANTFORSTRING.EMPTYSTRING:"picklist"===a&&""===r&&"edit"===t?r=$("#Crm_"+CFRExec.formRuleModule+"_"+e).find("option").val():"U"===a?r=CFRExec.relatedEntityMap[e].defaultid:"SERVICEID"==e&&"Appointments"==CFRExec.formRuleModule?CFRExec.relatedEntityMap[e].defaultid&&CFRExec.relatedEntityMap[e].defaultvalue&&""!=CFRExec.relatedEntityMap[e].defaultvalue?r=CFRExec.relatedEntityMap[e].defaultid:($("div#checkDuplicateEventAlert").remove(),r=""):"SEID"===e&&CFRExec.relatedEntityMap[e]&&"132"===CFRExec.relatedEntityMap[e].uitype&&CFRExec.relatedEntityMap[e].defaultid&&CFRExec.relatedEntityMap[e].defaultvalue1&&""!==CFRExec.relatedEntityMap[e].defaultvalue1&&CFRExec.relatedEntityMap[e].defaultvalue2&&""!==CFRExec.relatedEntityMap[e].defaultvalue2&&(r=CFRExec.relatedEntityMap[e].defaultid);return r},setValue:function(e,t,a){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(a));var r=CFRExec.relatedEntityMap[e];if(r){var i=!1;if("STAGE"===e&&(i=!0),t===CFRExec.CONSTANTFORSTRING.EMPTYSTRING)i&&void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=t),CFRExec.relatedEntityMap[e].defaultvalue=t,"4"!==r.uitype&&"5"!==r.uitype&&"6"!==r.uitype&&"7"!==r.uitype&&"9"!==r.uitype&&"10"!==r.uitype&&"12"!==r.uitype&&"13"!==r.uitype&&"15"!==r.uitype&&"133"!==r.uitype||(CFRExec.relatedEntityMap[e].defaultid=CFRExec.CONSTANTFORSTRING.EMPTYSTRING);else if("none"===t&&i)CFRExec.relatedEntityMap[e].defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING,void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING);else{switch(r.type){case"DateTime":if(l=Utils.getDateInUserDatePattern(crmCalendar.getDateObjectFromGivenDateString(t))){var n=t.substring(l.length+1,t.length);CFRExec.relatedEntityMap[e].defaultvalue=CFRExec.getDateObjectFromDateTimeStr(l,n)+CFRExec.CONSTANTFORSTRING.EMPTYSTRING,CFRExec.relatedEntityMap[e].dateVal=l,CFRExec.relatedEntityMap[e].timeVal=n}break;case"Date":var l=crmCalendar.getDateObjectFromGivenDateString(t,Crm.userDetails.DATE_PATTERN);CFRExec.relatedEntityMap[e].defaultvalue=l+CFRExec.CONSTANTFORSTRING.EMPTYSTRING,CFRExec.relatedEntityMap[e].dateVal=t;break;case"Lookup":var o=t.indexOf("#"),s=t.substring(0,o),d=t.substring(o+1,t.length);CFRExec.relatedEntityMap[e].defaultvalue=d,CFRExec.relatedEntityMap[e].defaultid=s;break;case"Currency":case"Boolean":CFRExec.relatedEntityMap[e].defaultvalue="null"===d?CFRExec.CONSTANTFORSTRING.EMPTYSTRING:t;break;default:CFRExec.relatedEntityMap[e].defaultvalue=t}i&&void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=parseInt(t))}}},getElemId:function(e,t,a){switch(e){case CFRExec.OPERATIONCONSTANT.EDIT:case CFRExec.OPERATIONCONSTANT.QUICK_CREATE:return CFRExec.formRuleModule+"_fldRow_"+t;case CFRExec.OPERATIONCONSTANT.VIEW:var r=null;return r="Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection?CFRExec.formRuleModule+"_fldRow_"+t:"mouseArea__"+t,a&&(r+=".agrFld"),r;case CFRExec.OPERATIONCONSTANT.PRINT:return"rowTR_"+t;default:return t}},evalBooleanExpression:function(e){for(var t=[],a=[],r=(e=e.replace(/true/g,"1").replace(/false/g,"0")).length,i=0;i<r;i++){var n=e[i];if("("===n)t.push(n);else if("1"===n||"0"===n)a.push(n);else if("&"===n){"("===(l=t.pop())||"|"===l?t.push(l):a.push(l),t.push(n)}else if("|"===n){var l;"("===(l=t.pop())?t.push(l):a.push(l),t.push(n)}else if(")"===n)for(var o=t.pop();"("!==o;)a.push(o),o=t.pop()}for(o=t.pop();void 0!==o&&"("!==o;)a.push(t),o=t.pop();return CFRExec.evalPostFixExpression(a)},evalPostFixExpression:function(e){for(var t=[],a=e.length,r=0;r<a;r++){var i=e[r];if("1"===i||"0"===i)t.push(i);else if("&"===i){var n=t.pop(),l=t.pop();"1"===n&&"1"===l?t.push("1"):t.push("0")}else if("|"===i){n=t.pop(),l=t.pop();"1"===n||"1"===l?t.push("1"):t.push("0")}}return"1"===t.pop()},showHideRequestedSection:function(e,t,a,r){if(void 0!==CFRExec.relatedEntityMap[a]){for(var i=CFRExec.relatedEntityMap[a].FL,n=i.length,l=0;l<n;l++)void 0!==i[l]&&CFRExec.workOnDom&&(r?CFRExec.LayoutRuleHiddenElem.pushUniqValues(i[l]):CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(i[l]),CFRExec.handleBusinessCardVisibility(i[l],!r));var o=$L("#multipleFieldsEditPop");if(o.length>0&&CFRExec.OPERATIONCONSTANT.VIEW===t&&"undefined"!=typeof ProcessFlow&&ProcessFlow.OPTIONAL_LR_ENABLED){var s=$L("#bpsaveasdraft"),d=o.find(".bpLRSectionContainer"),c=o.find(".bpLayoutRuleFldsContainer");if(r&&void 0!==CFRExec.actionTakenFalseHolder[a+"~2"]){var m=CFRExec.actionTakenFalseHolder[a+"~2"].actionElementId,u=d.find(".bpLR"+$.escapeSelector(m));u.length>0&&u.e[0].remove();for(var C=0;C<n;C++){var p=i[C];(R=c.find("."+p)).length>0&&void 0!==R.e[0]&&R.e[0].remove()}}else if(!r&&void 0!==CFRExec.actionTakenTrueHolder[a+"~2"]){m=CFRExec.actionTakenTrueHolder[a+"~2"].actionElementId;var f=$L("#"+$.escapeSelector(m)+" .contHeadInfo").text();d.removeClass("hide");var g=d.find(".bpLR"+$.escapeSelector(m));0===g.length&&(d.append($L('<div class="crm-medium-large-font-size crmBaseColor sum crm-font-bold p0 bpLRSectHeader bpLR'+m+'">'+$ESAPI.encoder().encodeForHTML(f)+"</div>").e[0]),g=$L(".bpLR"+$.escapeSelector(m)));for(C=0;C<n;C++){p=i[C];var R=c.find("."+p);if(void 0!==p){var E=$L("#"+CFRExec.formRuleModule+"_fldRow_"+p),v=E.length;if(0===v){var T=CFRExec.getFieldRow(p);$L(T).addClass("bpLRshow bpLRshowSect "+m+" crm-font-regular"),void 0!==T&&ProcessFlow.isValidLRFieldUIType(CFRExec.relatedEntityMap[p].uitype,p)&&g.append(T)}else if(v>0&&R.length>0){T=CFRExec.getFieldRow(p);$L(T).addClass("bpLRshow bpLRshowSect "+m+" crm-font-regular"),E.find(".newmandatory").length>0&&$L(T).find(".labelTabCreate").addClass("newmandatory"),void 0!==T&&ProcessFlow.isValidLRFieldUIType(CFRExec.relatedEntityMap[p].uitype,p)&&g.append(T),R.e[0].remove()}}}0===g.children().length&&g.e[0].remove()}0===o.find(".LR").length?s.attr("lt-prop-disabled",!1):s.attr("lt-prop-disabled",!0)}if(CFRExec.workOnDom){a=a.replace(/ |'/g,"_");r?e.find("[id='"+a+"']").hide():e.find("[id='"+a+"']").show()}}},getContainerDiv:function(e){if(e===CFRExec.OPERATIONCONSTANT.VIEW)return"Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection?$("#serviceAjaxEditFields"):"Events"===CFRExec.formRuleModule?$("#eventBCViewDiv"):$("#preHTMLContainer");if(e===CFRExec.OPERATIONCONSTANT.PRINT){var t=$("#pdfPreviewFrame")[0],a=$(t.contentDocument);return"Events"===CFRExec.formRuleModule?a.find("#eventBCViewDiv"):a.find("#preHTMLContainer")}if(e===CFRExec.OPERATIONCONSTANT.EDIT)return $("#preHTMLContainer_"+CFRExec.formRuleModule);if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var r=CFRExec.QCObj;return $("#"+(r.containerDiv?r.containerDiv:"searchCreateDiv"))}},getCurrentLayoutId:function(e){return e===CFRExec.OPERATIONCONSTANT.VIEW||e===CFRExec.OPERATIONCONSTANT.LIST?"undefined"!=typeof returnJson&&returnJson&&returnJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.PRINT?parent.returnJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.EDIT?window[CFRExec.formRuleModule].createEditJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?CFRExec.getContainerDiv(e).find('[name="layoutId"]').val():void 0},getRelatedEntityMap:function(e){if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){if(CFRExec.QCObj)if(CFRExec.QCObj&&qcObj.relatedEntityMap)return qcObj.relatedEntityMap;return{}}var t=null,a=null;if(e!==CFRExec.OPERATIONCONSTANT.VIEW&&e!==CFRExec.OPERATIONCONSTANT.LIST||!returnJson?e===CFRExec.OPERATIONCONSTANT.PRINT?(t=parent.returnJson.entityMapJson,void 0!==parent.returnJson[CFRExec.formRuleModule].section&&(a=parent.returnJson[CFRExec.formRuleModule].section)):e===CFRExec.OPERATIONCONSTANT.EDIT&&(t=objectUtils.cloneObject(window[CFRExec.formRuleModule].createEditJson.entityMapJson),void 0!==window[CFRExec.formRuleModule].createEditJson[CFRExec.formRuleModule].section&&(a=window[CFRExec.formRuleModule].createEditJson[CFRExec.formRuleModule].section)):(t=objectUtils.cloneObject(returnJson.entityMapJson),void 0!==returnJson[CFRExec.formRuleModule]&&void 0!==returnJson[CFRExec.formRuleModule].section&&(a=returnJson[CFRExec.formRuleModule].section)),"Potentials"===CFRExec.formRuleModule&&t){var r=t.STAGE.defaultvalue;void 0!==t.PROBABILITY&&r!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING&&(t.PROBABILITY.defaultvalue=parseInt(r))}if(void 0!==a)for(var i=a.length,n=0;n<i;n++){var l=[],o={},s=a[n];if(void 0!==s.FL){for(var d=s.FL.length,c=0;c<d;c++)void 0!==s.FL[c].colname&&("221"===s.FL[c].uitype&&(t[s.FL[c].colname].popup="true"),l.push(s.FL[c].colname));o.FL=l,o.id=s.name.replace(/ /g,"_"),t["secDiv_"+o.id]=o}}return t},valChangesNeedsLayoutRuleEval:function(e){return CFRExec.holdFormRule()&&CFRExec.isColTriggerLayoutRule(e)},isColTriggerLayoutRule:function(e){return-1!==CFRExec.LayoutRuleConditionInvolvedElem.indexOf(e)||"STAGE"===e&&-1!==CFRExec.LayoutRuleConditionInvolvedElem.indexOf("PROBABILITY")},holdFormRule:function(){return!validationUtils.isEmpty(CFRExec.CFRules)},evalAjaxEditForLayoutRule:function(e,t,a,r,i){if(CFRExec.holdFormRule()){var n=CFRExec.OPERATIONCONSTANT.VIEW;void 0!==CFRExec.formRuleModule&&"Calls"!==CFRExec.formRuleModule||(CFRExec.formRuleModule=e),0!=Object.keys(CFRExec.relatedEntityMap).length&&"Calls"!==e||(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(n)),CFRExec.ajaxEditedFields=[],CFRExec.ajaxEditedFields.push(t),CFRExec.fieldVsValue={},CFRExec.manateFldVsValue={},CFRExec.setValue(t,a,n),CFRExec.ajaxEditHaltedFieldColName=t,CFRExec.promptIfMandatory=!0,CFRExec.ajaxEditHaltNeeded=!1,void 0!==r?CFRExec.evalRules(n,!0,i):CFRExec.evalRules(n,!1,i);var l=$("#multipleFieldsEditPop").is(":visible"),o=$("#closedWon").is(":visible");return l||o||!1!==CFRExec.ajaxEditHaltNeeded||(CFRExec.relatedEntityMap={}),CFRExec.ajaxEditHaltNeeded}return!1},isLayoutRuleHiddenElem:function(e){return-1!==CFRExec.LayoutRuleHiddenElem.indexOf(e)},interceptSaveMandatoryFields:async function(){if(!CScriptLib)return CFRExec.saveMandatoryFields();{const e={};$("#multipleFieldsEditPop").find("[cscript-tag]").each(((t,a)=>{var r=$(a).attr("cscript-tag");r.startsWith("__")||(e[r]=DetailViewHandler.mandatory_form_read(r))}));if(!0===await CScript.Engine.Global.dispatchIEvent("onBeforeMandatoryFormSave",void 0,e))return CFRExec.saveMandatoryFields()}},saveMandatoryFields:function(){for(var e=[],t=CFRExec.getWorkingContainer().find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']").not("input[id$='_TimeOption']").filter(":visible"),a=t.length,r=0;r<a;r++){var i=t.eq(r);i.is(":visible")&&e.push(i.attr("id"))}if(Crm.validateEntityAndShowErrorMsg(e,CFRExec.formRuleModule,!0)){var n=t.length;for(r=0;r<n;r++){var l=$(t.eq(r)).data("colname");CFRExec.setValue(l,CFRExec.getInputedValue($(t.eq(r))),CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.ajaxEditedFields.push(l)}CFRExec.promptIfMandatory=!0,CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),!1===CFRExec.ajaxEditHaltNeeded&&new Promise((function(e){e(CVRExec.validateRulesForLayoutRule(CFRExec.ajaxEditedFields,CFRExec.haltStateParams,CFRExec.formRuleModule))})).then((function(e){e&&CFRExec.saveFieldsFinally()}))}},executeLayoutRulesForVR:function(e){CFRExec.formRuleModule=e;for(var t=$("#VRAjaxEdit").find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-user-wrapper[id^=Crm_],crm-richtext-component[id^='Crm_']").not("input[id$='_TimeOption']"),a=t.length,r=0;r<a;r++){var i=$(t[r]).data("colname");CFRExec.setValue(i,CFRExec.getInputedValue($(t[r])),CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.ajaxEditedFields.push(i)}return CFRExec.fromVR=!0,CFRExec.promptIfMandatory=!0,CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),CFRExec.promptIfMandatory=!0,!CFRExec.ajaxEditHaltNeeded},getInputedValue:function(e){var t=CFRExec.CONSTANTFORSTRING.EMPTYSTRING;switch(e.data("contentType")){case"Multiselect Pick List":for(var a=e.find("option"),r=!1,i=a.length,n=0;n<i;n++)!0===a[n].selected&&(r?t=t+";"+a.eq(n).val():(t=a.eq(n).val(),r=!0));break;case"Lookup":t=e.data("id")+"#"+e.val();break;case"User Lookup":t=e.data("id");break;case"DateTime":t=e.val()+" "+$("#"+e.attr("id")+"_TimeOption").val();break;case"Boolean":"on"===(t=e.val())&&(t=e.is(":checked")?"true":"false");break;default:t=e.val()}if(556===parseInt(e.data("uitype"))){var l=e.find("crm-image-upload-create");if(void 0!==l[0])return l[0].component.data.imageData}return 3!==parseInt(e.data("uitype"))&&110!==parseInt(e.data("uitype"))||"CRUX-TEXT-AREA-COMPONENT"!==e[0].tagName||(t=e[0].component.getValue()),250===parseInt(e.data("uitype"))&&(t=e[0].component.getValue()),t},saveFieldsFinally:function(e){if(!1===validationUtils.isEmpty(CFRExec.haltStateParams)){var t=null,a=null,r=1,i={};for(var n in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(n)&&(t="columnName"+r,a="fieldValue"+r,CFRExec.haltStateParams[t]=n,CFRExec.haltStateParams[a]=Crm.requestParamWithColname[n],i[n]=Crm.requestParamWithColname[n],r++);var l=CFRExec.haltStateParams.check;if(delete CFRExec.haltStateParams.check,e&&(CFRExec.haltStateParams.$validation_rule_action=e),"processFlow"===l.type)(o={}).module=CFRExec.haltStateParams.module,o.transitionRelId=CFRExec.haltStateParams.transitionRelId,o.moduleid=CFRExec.haltStateParams.moduleid,o.duringFields=JSON.stringify({ChildModuleFields:i}),e&&(o.$validation_rule_action=e),ProcessFlow.saveFields(CFRExec.haltStateParams.module,o,CFRExec.haltStateParams.moduleid),CFRExec.hideWorkingContainer();else"StageView"===l.type?(new crmRequestPool).doAjax1("/crm/v2/",(function(e){if("STAGE"!==CFRExec.haltStateParams.columnName){if("saveDenied"===crmListView.updateStageSuccess(CFRExec.haltStateParams.moduleid,CFRExec.haltStateParams.module,l.valId,l.prevStageId,e))return void(CFRExec.haltStateParams.check=l)}else{var t,a=CFRExec.haltStateParams.fieldValue,r=CFRExec.relatedEntityMap[CFRExec.haltStateParams.columnName].sysRefName;if(e.recordAPInputJson&&e.recordAPInputJson[r])for(var i=e.recordAPInputJson[r],n=customViewObject.stageBoards.length,o=0;o<n;o++)if(customViewObject.stageBoards[o].label===i){a=customViewObject.stageBoards[o].id,t=CFRExec.haltStateParams.fieldValue;break}if("saveDenied"===crmListView.updateStageSuccess(CFRExec.haltStateParams.moduleid,CFRExec.haltStateParams.module,a,l.prevStageId,e,"lrMandatory",t))return void(CFRExec.haltStateParams.check=l)}CFRExec.hideWorkingContainer()}),CFRExec.haltStateParams,(function(){renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),CFRExec.hideWorkingContainer()})):"closeTask"===l.type&&CFRExec.saveGivenFields(CFRExec.haltStateParams,l.module,l.id,l.from,l.url)}else{var o=CFRExec.retriveParamsToUpdate();e&&(o.$validation_rule_action=e);var s=$("#mouseArea__"+o.columnName).data("params"),d=s?s.uitype:Crm.userDetails.isSubformNewComponentEnabled&&"true"===returnJson.entityMapJson[o.columnName].isaggrfield?returnJson.entityMapJson[o.columnName].uitype:null;if(444!=d&&445!=d||CFRExec.changeMxNFieldValueParam(o),2===detailView.isApproved){var c=Lyte.registeredMixins.approvalprocess.constructPayloadFromDetailViewTemplate(o,o.module);return void Lyte.registeredMixins.approvalprocess.saveRecordWithApprovalResponse(businessCardJson.hidden.APPROVALBUTTONS,c,"LRMandatoryFields")}CFRExec.saveGivenFields(o,detailView.currentModule,detailView.entityId,"detailspage")}},changeMxNFieldValueParam:function(e){var t=$("#mouseArea__"+e.columnName).data("params"),a=t.sysRefName;a=-1!=a.indexOf(".")?a.replace(".","__"):a;var r=t.uitype,i=[],n=e.fieldValue;if(445===parseInt(r))var l=$("#mouseArea__"+e.columnName).data("params").selectedAPIJson;444===parseInt(r)&&(l=[],-1!=n.indexOf("all")&&(i[0]={},i[0]._delete="all"));var o=n.split("-"),s=o[0].split(","),d=s.length;(f={}).api_name=a;var c,m=moduleRecordMapping[e.module].fields.filterBy(f)[0];c=444===parseInt(r)?m.multiselectlookup.connectedlookup_apiname:m.multiuserlookup.connectedlookup_apiname;var u=0,C=l.length;if(""!=o[0])for(var p=0;p<d;p++){var f;(f={}).id=s[p];for(var g=!1,R=0;R<C;R++)if(l[R][c].id===s[p]){g=!0;break}g||(i[u]={},i[u][c]=f,u++)}if(2==o.length){d=(s=o[1].split(",")).length;for(p=0;p<d;p++){let e={},t=multiLookupsView.LinkingRecordIds;t&&(e.id=t[s[p]]);let a=!1;for(R=0;R<C;R++)if(l[R][c].id===s[p]){i[u]={},i[u].id=l[R].id,i[u]._delete="null",u++,a=!0;break}a||void 0===e.id||(i[u]={},i[u]=e,i[u]._delete="null",u++)}}e.fieldValue=i,e.filterQueryId=!0},saveGivenFields:function(e,t,a,r,i){var n=e.columnName,l=$L("#mandatorySave");l.addClass("disabled eventNone"),(new crmRequestPool).doAjax1("/crm/v2.2/",(function(o){Crm.VR&&delete Crm.VR,l.removeClass("disabled eventNone"),null!=o.data&&null!=o.data[0]&&null!=o.data[0].details&&null!=o.data[0].details.affected_data&&(detailView.affectedData=o.data[0].details.affected_data);var s=null,d=null,c=null,m=o.responseJSON?o.responseJSON:o;if("string"==typeof o&&(s=o.split("AJAX::::"),d=trim(s[1]),c=s[2],c=revertSplChrs(c)),o.responseJSON){if("MANDATORY_NOT_FOUND"===m.code||m.data&&"MANDATORY_NOT_FOUND"===m.data[0].code)return commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[cm_fl.data("label")]),cm_fl),void CFRExec.hideWorkingContainer();if("NO_PERMISSION"===m.code||m.data&&"RECORD_IN_BLUEPRINT"===m.data[0].code||m.data&&"CANNOT_PERFORM_ACTION"===m.data[0].code||m.data&&"MAPPING_MISMATCH"===m.data[0].code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void CFRExec.hideWorkingContainer();if(m.data&&"NOT_ALLOWED"===m.data[0].code)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.alert.can.not.edit.email"));if("Internal Server Error"===m.message||"INVALID_DATA"===m.data[0].code)return renderingUtils.displayPermissionDenied(null,null,m.message),void CFRExec.hideWorkingContainer();if("FILTER_CRITERIA_NOT_SATISFIED"===m.code||m.data&&"FILTER_CRITERIA_NOT_SATISFIED"===m.data[0].code){let e={},a=returnJson.entityMapJson;const r=m.data[0].details.api_name;let i="",l="",o="";for(let e in a)a[e].sysRefName===r&&(i=a[e].displaylabel,l=a[e].colname,o=a[e].lookupmodule);return e.FIELDLABEL=i,e.MODULE=t,commonUtils.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",moduleRecordMapping[o].singular_label),$("#Crm_"+t+"_"+l),t),void(n===l&&CFRExec.cancelPopupNdClearParamHistory())}if("duplicate data"===m.data[0].message){var u,C={},p=m.data[0].details.duplicate_record,f=returnJson.entityMapJson,g=m.data[0].details.api_name,R="",E="";for(var v in f)f[v].sysRefName===g&&(R=f[v].displaylabel,E=f[v].colname,u="true"===f[v].isaggrfield||!0===f[v].isaggrfield);C.FIELDLABEL=R,C.OWNERNAME=p.Owner.name,C.MODULE=t,C.RECORDS={},C.COUNT=p.more_records?2:1,C.ZUID=p.Owner.zuid,delete p.Owner;var T=[],F={};if(F.ENTITYID=p.id,delete p.id,Object.keys(p).length>1){var h=Crm.userDetails.NAME_FORMAT;h=h.split(",");var y=[];h.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),p[e]&&y.push(p[e])})),F.ENTITYNAME=y.join(" "),F.ENTITYNAMEFORPOPOVER=y.join(" ")}else for(var _ in p)F.ENTITYNAME=p[_],F.ENTITYNAMEFORPOPOVER=p[_];if(T.push(F),C.RECORDS=T,u&&Crm.userDetails.isSubformNewComponentEnabled){var x=$L("#"+g)[0];if(x)return p.id=F.ENTITYID,x.setData("cxPropErrorYield",!0),$L(x).closest("crm-detail-view-subform")[0].component.checkDuplicateVal(m,x.getData("cxPropField")),x.setData("cxPropErrorMessage",commonUtils.getDuplicateErrorMsg(C,!1,!0)),void(n===E&&CFRExec.cancelPopupNdClearParamHistory())}var O=commonUtils.getDuplicateErrorMsg(C,!1);return commonUtils.showErrorMsg(O,$("#Crm_"+t+"_"+E),t),void(n===E&&CFRExec.cancelPopupNdClearParamHistory())}if("DUPLICATE_LINKING_DATA"===m.data[0].code){var N=m.data[0].details.duplicate_record,I=N.id,A=N.Name,b=I18n.getMsg("crm.linking.module.duplicate.warning",[$ESAPI.encoder().encodeForHTML(t),$ESAPI.encoder().encodeForHTML(I),$ESAPI.encoder().encodeForHTML(A),$ESAPI.encoder().encodeForHTML(Crm.getCrmBasePath())]);return renderingUtils.showCustomAlert(b,"",!0),commonUtils.hideDuplicateErrorMsg("viewentityform"),itsonview=!0,void CFRExec.hideWorkingContainer()}}if(!(s=o)||!s.data)return renderingUtils.displayPermissionDenied(null,null,m.message),void CFRExec.hideWorkingContainer();if(d="SUCCESS"===s.data[0].code?"true":"false",c=s.outputValue,c=revertSplChrs(c),"true"===d){switch(r){case"relatedList":if(!Crm.userDetails.isRelatedListLyteEnabled){var S=Crm.isActivitySplitDone?"CALLSPERSONALITY;EVENTSPERSONALITY;TASKSPERSONALITY;CALLSHISTORYPERSONALITY;EVENTSHISTORYPERSONALITY;TASKSHISTORYPERSONALITY":"ACTIVITYPERSONALITY;ACTIVITYHISTORYPERSONALITY";crmRelatedList.ajaxReq({pname:S,module:t,id:a},null,!Crm.isActivitySplitDone)}Lyte.triggerEvent("related_list",{module:"Activities"}),Lyte.triggerEvent("relatedList",{module:"Tasks"}),!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder();break;case"detailspage":if(Crm.userDetails.isSubformNewComponentEnabled&&returnJson.entityMapJson[e.columnName].isaggrfield&&o&&o.recordAPInputJson){var M={},V=moduleRecordMapping[t].fields;Object.keys(o.recordAPInputJson).forEach((function(e){var t=V.filterBy({api_name:e})[0];t&&t.subform&&500!==t.ui_type&&(M[e]=o.recordAPInputJson[e])})),Object.keys(M).length>0&&(M.id=a,store.pushPayload(moduleRecordMapping[t].id,M),store.peekRecord(moduleRecordMapping[t].id,a).$.persist())}if(CFRExec.relatedEntityMap={},CFRExec.promptIfMandatory=!1,"Tasks"===t){var w=$("#completedTask").find("#completedValue").text();if(c.includes("Status")||c.includes("undefined"))for(var P=c.split("||"),D=P.length,L=0;L<D;L++){var k=P[L].split("##");if("Status"===k[0]||"undefined"===k[0]){$("#cvlist_"+a).find("#lp_Status").text(k[1]).attr("title",k[1]);break}}returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.STATUS&&detailView.replaceDataParams("STATUS",w),reloadCurrentEntityView(a,t,(function(){CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0),$("#followup").show()}))}else{if("Events"===t){var U=$("#formRuleMandatoryFields").find(".activitesColor");if(U.length>0){var j=U.css("background-color"),H=$("#detailView_"+a).find(".activitesColor");H.length>0?H.css("background-color",j):$("#cvlist_"+a).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+a+'" style="background: '+Events.rgbtohex(j)+'"></span>')}}reloadCurrentEntityView(a,t,(function(){CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0)}))}break;case"kanbanview":"Tasks"===t&&Crm.renderDVLyteFlow(t)&&"detail"===Lyte.Router.getRouteInstance().routeName&&Lyte.triggerEvent("detail_view_listener_"+$L("crm-detail-view")[0].component.getData("unique_listener_id"),{componentsToBeReloaded:["all_components"]}),$("#recordid_"+a).find('[class="seperatorLine"]').hide(),$("#listViewClose_"+a).hide();break;case"dashboard":var J=objectUtils.URL(i).getParams();CrmDashboard.loadDashboards(void 0,void 0,{clickId:"loadHomePage",currentOption:"20",dashletId:J.dashletId,layoutId:J.layoutId,module:"Tasks"});break;case CFRExec.OPERATIONCONSTANT.LIST:$("#tab_Activities").trigger("click")}if("Potentials"===t&&e&&e.subject&&e.description&&businessCardJson.userInRole.notesPermission)if("string"==typeof o){var B=s.slice(-1);$L("crux-note")[0]&&"detail"===Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.isRelatedListLyteEnabled?(store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})}))):Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,B,!1,$("#note_subject"),$("#noteContextTxt"))}else{(J={}).Note_Title=e.subject,J.Note_Content=e.description,J.Parent_Id=e.moduleid,J.se_module=e.module;var q={};(T=[]).push(J),q.data=T;var W={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(W["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:"/crm/v2/Notes",type:"POST",data:JSON.stringify(q),headers:W,contentType:"application/json",success:function(t){var a={};a.noteTitle=$ESAPI.encoder().encodeForHTML(e.subject),a.noteContent=$ESAPI.encoder().encodeForHTML(e.description),a.relModuleName=J.se_module,a.isEditAllowed=!0,a.createdDate="now",a.modifiedDate="now",a.mainEntId=J.Parent_Id,a.nId=t.data[0].details.id,a.isDelAllowed=!0,a.noteContentWithRegex=$ESAPI.encoder().encodeForHTML(e.description),a.modiName=t.data[0].details.Modified_By.name,a.seId=void 0===J.se_moduleid?J.Parent_Id:J.se_moduleid,a.dispModuleName=void 0===returnJson[J.se_module].rpModuleName?J.se_module:returnJson[J.se_module].rpModuleName,a.i18nModName=void 0===returnJson[J.se_module].rpModuleName?J.se_module:returnJson[J.se_module].rpModuleName,a.mainEntityName=returnJson[J.se_module].entityName,a.CONTACTSURL=Crm.userDetails.contactServerUrl+"/file";var r=new Date(t.data[0].details.Created_Time);a.createdDateFull=Utils.convertDateToGivenPattern("M d",r)+" "+Utils.getTimeInUserFormat(r,!0);var i=new Date(t.data[0].details.Modified_Time);a.modifiedDateFull=Utils.convertDateToGivenPattern("M d",i)+" "+Utils.getTimeInUserFormat(i,!0),a.modifiedZuid=Crm.userDetails.ZUID,a.clientPortalName=void 0!==window.clientPortalName?window.clientPortalName:"",a.clientPortalUrlContext="portal",a.isSharedToClient=!!$("#sharetoclient").prop("checked"),$L("crux-note")[0]&&"detail"===Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.isRelatedListLyteEnabled?(store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})}))):Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,a,!1,$("#note_subject"),$("#noteContextTxt"))}})}CFRExec.hideWorkingContainer(),CFRExec.promptIfMandatory=!1}else"false"===d?(renderingUtils.showCustomAlert("Error:"+s.data[0].message),CFRExec.promptIfMandatory=!1):(renderingUtils.showCustomAlert("Invalid response!!!!"),CFRExec.promptIfMandatory=!1)}),e,(function(){l.removeClass("disabled eventNone"),renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),CFRExec.hideWorkingContainer()}))},cancelPopupNdClearParamHistory:function(){$("#formRuleMandatoryFields").hide(),renderingUtils.removeFreezeLayer(),CFRExec.relatedEntityMap={},CFRExec.haltStageChange({})},retriveParamsToUpdate:function(){var e={},t=null;e.columnName=CFRExec.ajaxEditHaltedFieldColName;var a=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].uitype;if("786"===a||"14"===a||"30"===a||"333"===a?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].dateVal+" "+CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].timeVal:"24"===a||"202"===a?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].dateVal:"Lookup"===CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].type?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultid:e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultvalue,""!==e.fieldValue||"Lookup"!==CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].type||"ACCOUNTID"!==e.columnName&&"PARENTACCOUNTID"!==e.columnName||"4"!==a&&"133"!==a||(e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultvalue,e.uitype=a),"Tasks"===detailView.currentModule&&"STATUS"===e.columnName&&detailView.taskStatusMap.Completed==e.fieldValue){var r=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof r&&(r="true"===r),r||($("#showDontAskOption").prop("checked")&&(e.isDontAskAgainChecked=!0),$("#notifyOwnerOption").prop("checked")&&(e.isNotifyOwnerChecked=!0))}var i=1;for(var n in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(n)&&(t="fieldValue"+i,"uitype"+i,e["columnName"+i]=n,CFRExec.relatedEntityMap[n]&&["133","55","221"].contains(CFRExec.relatedEntityMap[n].uitype)&&(e.filterQueryId="true"),e[t]=Crm.requestParamWithColname[n],i++);if(e.moduleid=returnJson[CFRExec.formRuleModule].entityid,e.module=detailView.currentModule,Crm.userDetails.clientLoggerNeedAccount){var l={type:"custom event"};l.message=JSON.stringify(e),murphy.addCustomTracking(l),murphy.error(new Error("Deal record update details formrule"))}return e[csrfParamName]=csrfToken,e},getIndexForTab:function(e,t){return e&&t&&(e.includes("Lookup")||e.includes("Owner")||e.includes("Handler")?t+=4:t++),t},performCancelMandatory:function(){if(CFRExec.hideWorkingContainer(),!0==!validationUtils.isEmpty(CFRExec.haltStateParams)){CFRExec.haltStateParams.check&&"StageView"===CFRExec.haltStateParams.check.type?crmListView.updateStageError(CFRExec.haltStateParams.fieldValue,CFRExec.haltStateParams.check.prevStageId):CFRExec.haltStateParams.check&&"processFlow"===CFRExec.haltStateParams.check.type&&$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone"),CFRExec.relatedEntityMap={};var e=CFRExec.haltStateParams.check&&("closeTask"===CFRExec.haltStateParams.check.type&&"detailspage"===CFRExec.haltStateParams.check.from||"processFlow"===CFRExec.haltStateParams.check.type);delete CFRExec.haltStateParams,e&&CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0)}else $("#saveCancelSpan").find('a[name="button__'+CFRExec.ajaxEditHaltedFieldColName+'"]').trigger("click"),"STAGE"===CFRExec.ajaxEditHaltedFieldColName&&$("crm-stage-detailview").length>0&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-detail-view-utils.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent()})),CFRExec.relatedEntityMap={},CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0);if(CFRExec.revertPotentials&&(cancelPotentialPopup(),CFRExec.revertPotentials=!1),$("#formRuleMandatoryFields").remove(),Crm.userDetails.isSubformDetailViewOperationsSupportedForInv&&Crm.isInventoryModule(CFRExec.formRuleModule)){var t=store.peekRecord(moduleRecordMapping[CFRExec.formRuleModule].id,returnJson[CFRExec.formRuleModule].entityid),a=t?t.$.getDirtyAttributes():[];if(a.length>0)for(var r=moduleRecordMapping[CFRExec.formRuleModule].fields,i=r.length,n=0;n<i;n++){var l=r[n],o=l.column_name;if(a.indexOf(l.api_name)>-1&&("TAX"===o||"DISCOUNT"===o)){t.$.rollBack();break}}}},haltStageChange:function(e){CFRExec.haltStateParams=objectUtils.cloneObject(e)},getTaskCompletedOptionLabel:function(e){if(0===Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(e)),CFRExec.relatedEntityMap.STATUS)for(var t=CFRExec.relatedEntityMap.STATUS.picklistmap,a=t.length,r=0;r<a;r++)if("Completed"===t[r].systemvalue)return t[r].uservalue;return"Completed"},moveToTempHolder:function(){CFRExec.tempHolder={},CFRExec.tempHolder.oldJson="undefined"!=typeof returnJson?returnJson:null,CFRExec.tempHolder.oldResJson=CFRExec.oldResJson,CFRExec.tempHolder.module=CFRExec.formRuleModule},initFromTempHolder:function(){returnJson=CFRExec.tempHolder.oldJson,CFRExec.init(CFRExec.tempHolder.oldResJson,CFRExec.tempHolder.module,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.tempHolder={}},moveToTempHold:function(){CFRExec.tempHold={},CFRExec.tempHold.oldResJson=CFRExec.oldResJson,CFRExec.tempHold.formRuleModule=CFRExec.formRuleModule},tabIndexingForFields:function(e,t){var a,r,i=t,n=$(e).find(".textField"),l=$(e).find(".select2-selection");if(r=n.attr("data-content-type")){var o=$(e).find("select");if(o.length>0&&(l.length>0?(l.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i),a=l,Crm.userDetails.isAccessibilityConfigSupported&&n.attr("tabindex","0")):(o.attr("tabindex",i),thirdPartyUtils.bindSelect2($(e).find(".selNone")),i=CFRExec.getIndexForTab("select",i),a=o)),r.includes("Lookup")){if(e&&n.attr("data-content-type").includes("Lookup")){var s=$(e).find("input , img");$.each(s,(function(e){var t=$(s[e]);t.attr("tabindex",i),i=CFRExec.getIndexForTab("children",i),Crm.userDetails.isAccessibilityConfigSupported&&t.attr("tabindex","0")}))}}else n.attr("tabindex",i),i=CFRExec.getIndexForTab(r,i),a=n}else{var d=$(e).find(".select2-search__field"),c=$(e).find("input"),m=$(e).find(".select"),u=$(e).find("crm-user-wrapper"),C=$(e).find("img");if(l.length>0)d.length>0?(d.attr("tabindex",i),a=d):(l.attr("tabindex",i),a=l),i=CFRExec.getIndexForTab("select",i);else if(m.length>0)if($(e).find(".cNfileUpladBtn").length>0){var p=$(e).find(".fileUploadLabel");p.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i),a=p}else m.length>0&&(m.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i),a=m);else u.length>0?(C.attr("tabindex",i),u.attr("tab-index",i),i=CFRExec.getIndexForTab("fileUpload",i),a=C):c.length>0&&(c.attr("tabindex",i),i=CFRExec.getIndexForTab("input",i),a=c)}return Crm.userDetails.isAccessibilityConfigSupported&&a.attr("tabindex","0"),i},setTabindexForHiddenFields:function(e){if(e.find("[tabindex]").length>0)for(var t=$(e).find("[tabindex]").length,a=0;a<t;a++){var r=$(e).find("[tabindex]")[a];r.setAttribute("tabindex",-1),Crm.userDetails.isAccessibilityConfigSupported&&Lyte.Service.getInjected("globalAccessibilityServices").getVariable("standardNavigationOrder")&&r.setAttribute("tabindex","0")}},setHaltedFieldLabel:function(e){CFRExec.ajaxEditHaltedFieldColName=e},getFormRuleDataParams:function(){var e={};return CFRExec.manateFldVsValue&&(e.manateFldVsValue=CFRExec.manateFldVsValue),CFRExec.fieldVsValue&&(e.fieldVsValue=CFRExec.fieldVsValue),e.mandatoryInputNeededElem=CFRExec.mandatoryInputNeededElem,e.lrMandatoryElem=CFRExec.lrMandatoryElem,e.LayoutRuleHiddenElem=CFRExec.LayoutRuleHiddenElem,e}},CVRExec=function(){try{var e,t,a,r=!0,i=!0,n=[],l=[36,77,143,144,145],o=["between","not_between","greater_equal","greater_than","less_equal","less_than","not_equal","equal"];function s(e,t,a,r,n){if(i&&(i=!1),"[object Array]"!==Object.prototype.toString.call(t))return d(!1,e,t,a,r,n);if(1===t.length)return d(!1,e,t[0],a,r,n);if(3===t.length){var l=s(e,t[0],a,r,n),o=t[1],c=!1;return("and"===o&&l||"or"===o&&!l)&&(c=s(e,t[2],a,r,n)),"and"===o?l&&c:l||c}}function d(t,a,n,s,d,c){var u,C,p,f=!1,g=n.column_name;"view"!==a||"FIRSTNAME"!==n.column_name&&"SALUTATION"!==n.column_name?"SALUTATION"===n.column_name&&(g="LASTNAME"):g="LASTNAME";var R=!1;d&&(null!==s?R=s===g:Crm.VR&&(Crm.VR.ajaxEditFailedFields&&Crm.VR.ajaxEditFailedFields.contains(g)||Crm.VR.ajaxEditFieldLabel&&Crm.VR.ajaxEditFieldLabel===g)&&(R=!0));var E=!0;c&&!R&&Crm.VR&&void 0!==Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(g)&&(R=!0),(c&&Crm.VR&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(g)||Crm.VR&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(g))&&(R=!0,E=!1);var v=_(R&&"print"!==a?"edit":a,g),T=null,F=null,h=!1;if(E)if(c&&Crm.VR&&(void 0===Crm.VR.globalAjaxEditedFields||void 0!==Crm.VR.globalAjaxEditedFields&&!Crm.VR.globalAjaxEditedFields.contains(g))){T=N(g);var y=Crm.VR.entityDetails.entityMapJson[g];y&&/\b(5|4|6|7|9|10|12|13|15|132|133|135|136)\b/.test(y.uitype+"")&&"object"==typeof T&&T.name&&(T=T.name)}else d&&!R&&null===s&&Crm.VR&&Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(g)&&(T=Crm.VR.ajaxEditFailedFieldValues[g]);var x=$("#"+v),O=Crm.userDetails.isSubformNewComponentEnabled&&0===x.length?store.peekRecord("field",n.field_id):void 0,I=!1;O&&O.subform&&(v=n.api_name?n.api_name:n.field,x=$L("#"+v),I=!0);var A=!1;if(void 0!==Crm.VR&&null!==Crm.VR){if(Crm.VR.IsQuickCreate){if("Tasks"===e&&"SUBJECT"===g)v="task_subject",x=$("#"+v);else if(0===x.length){var b=$("."+v);1===b.length&&(x=b)}"U"===n.data_type&&(x=x.next()),CFRExec.LayoutRuleHiddenElem&&!CFRExec.LayoutRuleHiddenElem.contains(g)&&Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(g)&&(A=!0)}if(Crm.VR.fromSC){if(u=$L("crm-convert-deal-fields")[0].component,"REASON_FOR_LOSS"===n.column_name&&u.getData("hideReasonForLoss"))return!1;p=void 0!==(C=u.getFieldsIndex("column_name",n.column_name))?$L("#component_"+C):null,x=void 0!==C?p.e.component:null}}if(CFRExec.LayoutRuleHiddenElem&&!CFRExec.LayoutRuleHiddenElem.contains(g)){var S="view"===a&&"detail"===Lyte.Router.getRouteInstance().routeName?$("#showHideDetail"):null;null===S||S.hasClass("hideDetailArrow")||!d||1!==x.length||x.is(":visible")||(A=!0)}if(!(Crm.VR&&Crm.VR.fromSC&&null!==x||null!==x&&x.length>0&&(x.is(":visible")||A)||null!==T))return!1;var M=null;if(null===T){if(R&&"view"===a||"edit"===a)if(Crm.VR&&Crm.VR.fromSC)T=void 0===x.getValue()?"":x.getValue(),"lookup"===x.getData("moduledataUicomp.data_type")&&(T=JSON.parse(T).name),T&&("D"===n.data_type&&(T=Utils.convertUsrtoDefaultDatePattern(T)),"U"===n.data_type&&(T=T.id));else if("B"===n.data_type)T=x.is(":checked");else if("U"===n.data_type)""===(T=x.data().id)&&(T=x[0]&&x[0].dataset?x[0].dataset.id:"");else if("DT"===n.data_type){if(T=x.val(),!0===Crm.isCalendarSchedule){var V="[name="+v+"minute]";M=$("[name="+v+"hour]").val()+":"+$(V).val()}else Crm.VR&&Crm.VR.fromSC||(M=$("#"+v+"_TimeOption").val());if(!M&&Crm.VR)if(Crm.VR.IsSearchCreate){var w=v+"_dateTime",P=$("."+w);Crm.VR.IsQuickCreate&&0==P.length&&(P=$("#"+w)),M=P.val()+" "+("HH:mm"===Crm.userDetails.TIME_FORMAT?"":$("[id='property("+g+"ampm)']").val())}else Crm.VR.IsQuickCreate?M=$("#"+g+"dateTime").val()+("HH:mm"===Crm.userDetails.TIME_FORMAT?"":" "+$("[id='property("+g+"ampm)']").val()):Crm.VR.fromSC&&(M=$("."+g+"_timefrmhour").val()+":"+$("."+g+"_timefrmminute").val()+("HH:mm"===Crm.userDetails.TIME_FORMAT?"":" "+$("."+g+"_timefrmampm").val()))}else T=Crm.calendar_booking?x[0].component.getValue():I&&x[0]?x[0].getData("cxPropValue"):x.val(),33===n.ui_type&&(T=commonUtils.getValue(x)),void 0!==Crm.VR&&null!==Crm.VR&&"STAGE"===n.column_name&&Crm.VR.fromSC&&(T=x.find("option:selected").text()),"D"===n.data_type&&T&&(T=Utils.convertUsrtoDefaultDatePattern(T));else if("FIRSTNAME"===n.column_name)T=x.data("params").nameInfo.firstname;else if("LASTNAME"===n.column_name)T=x.data("params").nameInfo.lastname;else if("SALUTATION"===n.column_name)T=x.data("params").nameInfo.salutation;else if(I&&x[0])T=x[0].getData("cxPropValue");else{var D=x.data("params");T=void 0!==D.plainValue?D.plainValue:D.defaultvalue,"35"!==n.ui_type&&"33"!==n.ui_type&&35!==n.ui_type&&33!==n.ui_type||(D.dbPhoneValue?T=D.dbPhoneValue:Crm.isCalendarSchedule||(T=commonUtils.getPlainPhoneNo(T))),"U"!==n.data_type||"User Lookup"!==D.type&&"221"!==D.uitype||(T=D.defaultid)}"STAGE"===n.column_name&&T.indexOf(":")>-1&&"Deals"===n.module&&(F=T,T=Crm.getDealsStageValue(T),h=!0)}if("${EMPTY}"!==n.value&&"${NOTEMPTY}"!==n.value&&T&&""!==T&&"N"===n.data_type&&Crm.userDetails.BASE_CURRENCY&&""!==Crm.userDetails.BASE_CURRENCY&&l.contains(n.ui_type)){var L=function(e,t){var a=_(t,"CURRENCYISOCODE",e),r=$("#"+a);if(r&&0===r.length){var i=$("[id='property(Currency)']");i&&i.length>0&&(r=i)}return r}(e,a);if(L&&L.length>0||c){var k=L.val();"view"===a&&""===k?k=L.data("params").defaultvalue:c&&(k=N("CURRENCYISOCODE")),F=T,T=function(e,t){if(t){if(Crm.userDetails.BASE_CURRENCY===t)return e;var a=Crm.userDetails.CURRENCY_DETAILS,r=e/parseFloat(a[t].er),i=parseFloat(a[Crm.userDetails.BASE_CURRENCY].er),n=parseInt(a[Crm.userDetails.BASE_CURRENCY].decimals);e=commonUtils.roundNumber(r*i,n)}return e}(T,k),null!==F&&F!==T&&(h=!0)}}var U=n.compareStr;if(""===U)switch(n.comparator){case"contains":U="contains";break;case"not_contains":U="doesn't contain";break;case"starts_with":U="starts with";break;case"ends_with":U="ends with"}var j=(k=n.value).length,H=!1;if("T"===n.data_type){if("[object Array]"!==Object.prototype.toString.call(n.value)&&(k=n.value.split(",")),"${EMPTY}"!==n.value&&"${NOTEMPTY}"!==n.value)if(T){if(t){var J=function(e,t){var a=[!1];if(o.contains(t)&&e){for(var r=e.length,i=null,n=[],l=0;l<r;l++)"string"==typeof(i=e[l])&&-1!==i.indexOf("${NOC")&&(i=i.trim(),n[l]=parseInt(i.substring(5,i.lastIndexOf("}"))));a[0]=n.length>0,a[1]=n}return a}(k,n.comparator);J[0]&&(H=!0,f=function(e,t,a){if(e){var i=!1,n=e.length;switch(a){case"between":i=n>=t[0]&&n<=t[1];break;case"not_between":i=!(n>=t[0]&&n<=t[1]);break;case"greater_equal":i=n>=t[0];break;case"greater_than":i=n>t[0];break;case"less_equal":i=n<=t[0];break;case"less_than":i=n<t[0];break;case"not_equal":i=n!==t[0];break;case"equal":i=n===t[0];break;default:i=!1}return i===r}return!1}(T,J[1],n.comparator))}}else H=!0,f=!1}else if("U"===n.data_type){if(H=!0,T=T||"",Array.isArray(k)&&j)for(var B=0;B<j&&!(f=CFRExec.getCompareResult(null,n.data_type,T,U,k[B],null,0));B++);else f=CFRExec.getCompareResult(null,n.data_type,T,U,k,null,0);t&&(f=f===r)}else if("picklist"===n.data_type){if("${EMPTY}"===n.value||"${NOTEMPTY}"===n.value||T||(H=!0,f=!1),T&&"-None-"===T&&(T=""),"[object Array]"!==Object.prototype.toString.call(n.value)&&(k=n.value.split(",")),"STAGE"===n.column_name&&("${OPEN}"===n.value||"${CLOSEDWON}"===n.value||"${CLOSEDLOST}"===n.value)){var q=Crm.VR&&Crm.VR.fromSC?x.data.cxPropField[u.data.layoutId].pick_list_values:x.data("values"),W="html",Y="fcCategory";!q&&d&&(q=returnJson.entityMapJson.STAGE.val,W="content",Y="fccategory");var G=null;if(Crm.VR&&Crm.VR.fromSC){if(q){var Q=q.length;for(B=0;B<Q;B++)if(q[B].display_value===x.data.displayValue[0]){G=q[B].deal_category;break}}}else Crm.VR&&Crm.VR.IsQuickCreate&&(G=x.find("option:selected").attr("fctype"));if(q)for(Q=q.length,B=0;B<Q;B++)if(q[B][W]===T){G=q[B][Y];break}"Pipeline"===G||"Open"===G?T="${OPEN}":"Closed"===G||"Closed Won"===G?T="${CLOSEDWON}":"Omitted"!==G&&"Closed Lost"!==G||(T="${CLOSEDLOST}")}}else if("D"===n.data_type){"${EMPTY}"===n.value||"${NOTEMPTY}"===n.value||T||(H=!0,f=!1),"not between"!==U&&"between"!==U&&(k=n.value.split(",")),j=k.length;for(B=0;B<j;B++)if("${EMPTY}"!==k[B]&&"${NOTEMPTY}"!==k[B]){var z=new Date(k[B]);z.setHours(0,0,0,0),k[B]=Utils.convertUsrtoDefaultDatePattern(z)}M=void 0}else if("DT"===n.data_type){var K=Utils.getTimezoneOffset()/60;"not between"!==U&&"between"!==U&&(k=n.value.split(",")),j=k.length;for(B=0;B<j;B++)if("${EMPTY}"!==k[B]&&"${NOTEMPTY}"!==k[B]){var X=new Date(k[B]),Z=X.getTime()+6e4*X.getTimezoneOffset();k[B]=new Date(Z-36e5*K)}null!=M&&T?T=m(T,M):null===M&&T&&(T=new Date(T)),H=!0,f=function(e,t,a){var n=!1;if("${EMPTY}"===t[0])n=""===e;else if("${NOTEMPTY}"===t[0])n=""!==e;else{if(!e)return!1;switch(a){case"is":default:n=e.getTime()-t[0].getTime()==0;break;case"isn't":n=e.getTime()-t[0].getTime()!=0}}i&&(n=n===r);return n}(T,k,U)}else"B"===n.data_type&&T?(H=!0,f=(T=!0===T||"true"===T.toLowerCase())===k,t&&(f=f===r)):"N"===n.data_type&&(H=!0,f=function(e,t,a,n){e=Search.reverseFormatNumber(e),n&&(a=Search.reverseFormatNumber(a,t,n.separator,"ValRules"));if(""===e||isNaN(e)){if("${EMPTY}"!==a&&"${NOTEMPTY}"!==a)return!1;e=""}else e=parseFloat(e);var l=null;if("${EMPTY}"===a)l=""===e;else if("${NOTEMPTY}"===a)l=""!==e;else switch("between"!==t&&"not between"!==t&&(a=parseFloat(a)),t){case"=":default:l=e===a;break;case"!=":l=e!==a;break;case"<":l=e<a;break;case"<=":l=e<=a;break;case">":l=e>a;break;case">=":l=e>=a;break;case"between":l=e>=parseFloat(a[0])&&e<=parseFloat(a[1]);break;case"not between":l=!(e>=parseFloat(a[0])&&e<=parseFloat(a[1]))}i&&(l=l===r);return l}(T,U,k,n));return H||(f=CFRExec.getCompareResult(null,n.data_type,T,U,k,M,0),t&&(f=f===r)),d&&R&&null===s&&(Crm.VR.ajaxEditFailedFieldValues||(Crm.VR.ajaxEditFailedFieldValues={}),Crm.VR.ajaxEditFailedFieldValues[n.column_name]=h?F:T),f}function c(t,a,r,i,n,l,o,s,d){var c=null,u=r.column_name;"view"!=a||"FIRSTNAME"!=r.column_name&&"SALUTATION"!=r.column_name||(u="LASTNAME"),Crm.VR&&(Crm.VR.IsSearchCreate||Crm.VR.IsQuickCreate)||"SALUTATION"!=r.column_name||(u="LASTNAME");var C=!1;n&&(null!=i?C=i==u:Crm.VR&&(Crm.VR.ajaxEditFailedFields&&Crm.VR.ajaxEditFailedFields.contains(u)||Crm.VR.ajaxEditFieldLabel&&Crm.VR.ajaxEditFieldLabel==u)&&(C=!0));var p=!0;l&&!C&&null!=Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(u)&&(C=!0),(l&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(u)||Crm.VR&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(u))&&(C=!0,p=!1);var f=s||_(C&&"print"!=a?"edit":a,u,o);p&&(l&&(null==Crm.VR.globalAjaxEditedFields||null!=Crm.VR.globalAjaxEditedFields&&!Crm.VR.globalAjaxEditedFields.contains(u))?c=d&&d.issubformfield?I(d):N(u):n&&!C&&null==i&&Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(u)&&(c=Crm.VR.ajaxEditFailedFieldValues[u]));var g=$("#"+f),R=!1;Crm.userDetails.isSubformNewComponentEnabled&&Crm.VR&&Crm.VR.entityDetails&&Crm.VR.entityDetails.entityMapJson&&Crm.VR.entityDetails.entityMapJson[u]&&("true"===Crm.VR.entityDetails.entityMapJson[u].isaggrfield||!0===Crm.VR.entityDetails.entityMapJson[u].isaggrfield)&&(R=!0,g=(g=document.querySelector("#"+Crm.VR.entityDetails.entityMapJson[u].sysRefName))?g.component:null),null==c&&(c=d&&d.issubformfield?I(d):null);var E=!1;if(void 0!==Crm.VR&&null!=Crm.VR){if(Crm.VR.IsQuickCreate&&"Tasks"==e&&"SUBJECT"==u)f="task_subject",g=$("#"+f);else if(Crm.VR.IsQuickCreate&&0==g.length){var v=$("."+f);1==v.length&&(g=v)}if(CFRExec.LayoutRuleHiddenElem&&!CFRExec.LayoutRuleHiddenElem.contains(u)&&Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(u)&&(E=!0),null!=Crm.VR.fromSC&&Crm.VR.fromSC){var T=$L("crm-convert-deal-fields")[0].component.getFieldsIndex("column_name",r.column_name),F=void 0!==T?$L("#component_"+T):null;g=void 0!==T?F.e.component:null}}if(CFRExec.LayoutRuleHiddenElem&&!CFRExec.LayoutRuleHiddenElem.contains(u)){var h="view"===a&&"detail"===Lyte.Router.getRouteInstance().routeName?$("#showHideDetail"):null;null===h||h.hasClass("hideDetailArrow")||!n||1!==g.length||g.is(":visible")||(E=!0)}var y=!1;if("Calls"!==o||!isNewCallView||"SEID"!==u&&"CONTACTID"!==u||(y=!0),g&&g.length>0&&(g.is(":visible")||E||y)||null!==g||null!==c){var x=null;if(null==c){if(C&&"view"==a||"edit"==a)if(Crm.VR&&Crm.VR.fromSC)c=g.getValue(),"D"===r.data_type&&c&&(c=Utils.convertUsrtoDefaultDatePattern(c)),24!==r.uitype&&202!==r.uitype||!c||(c="en_GB"===Crm.userDetails.COUNTRY_LOCALE?Utils.convertUsrtoDefaultDatePattern(c,!1):Utils.convertUsrtoDefaultDatePattern(c,!0));else if(300==r.uitype||301==r.uitype)c=g.is(":checked");else if(14==r.uitype||333==r.uitype||786==r.uitype||30==r.uitype){if(c=g.val(),!0===Crm.isCalendarSchedule){var O="[name = "+f+"minute]";x=$("[name="+f+"hour]").val()+":"+$(O).val()}else Crm.VR&&Crm.VR.fromSC||(x=$("#"+f+"_TimeOption").val());if((null==x||""==x)&&void 0!==Crm.VR&&null!=Crm.VR)if(Crm.VR.IsSearchCreate){var A=f+"_dateTime",b=$("."+A);Crm.VR.IsQuickCreate&&0==b.length&&(b=$("#"+A)),null==(S=$("[id='property("+u+"ampm)']").val())&&(S=""),x=b.val()+" "+S}else if(Crm.VR.IsQuickCreate){var S;null==(S=$("[id='property("+u+"ampm)']").val())&&(S=""),x=$("#"+u+"dateTime").val()+" "+S}else Crm.VR.fromSC&&(x=$("."+u+"_timefrmhour").val()+":"+$("."+u+"_timefrmminute").val()+("HH:mm"===Crm.userDetails.TIME_FORMAT?"":" "+$("."+u+"_timefrmampm").val()));null!=c&&""!=c&&null!=x&&""!=x&&(c=m(c,x))}else if(/\b(5|4|6|7|9|10|12|13|15|132|133|135|136)\b/.test(r.uitype+"")){var M=g.data("id");M&&!isNaN(M)&&g.val()&&((c={}).name=g.val(),c.id=M)}else c=g.val(),void 0!==Crm.VR&&null!=Crm.VR&&"STAGE"==r.column_name&&null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(c=g.find("option:selected").text().replace(/[\r\n\t]/g,"")),24!=r.uitype&&202!=r.uitype||!c||(c="en_GB"===Crm.userDetails.COUNTRY_LOCALE?Utils.convertUsrtoDefaultDatePattern(c,!1):Utils.convertUsrtoDefaultDatePattern(c,!0));else if("FIRSTNAME"==r.column_name)c=g.data("params").nameInfo.firstname;else if("LASTNAME"==r.column_name)c=g.data("params").nameInfo.lastname;else if("SALUTATION"==r.column_name)c=g.data("params").nameInfo.salutation;else if(c=R?g.getValue():null!=g.data("params").plainValue?g.data("params").plainValue:g.data("params").defaultvalue,/\b(5|4|6|8|7|9|10|12|13|15|132|133|135|221|136)\b/.test(r.uitype+"")){c="";var V=g.data("params");V.defaultid&&!isNaN(V.defaultid)&&V.defaultvalue&&((c={}).name=V.defaultvalue,c.id=V.defaultid)}"STAGE"==r.column_name&&c.indexOf(":")>-1&&("Deals"==o||"Potentials"==o)&&(c=Crm.getDealsStageValue(c))}}return"32"!=r.uitype&&"38"!=r.uitype&&"52"!=r.uitype||(c=Search.reverseFormatNumber(c)),c}function m(e,t){var a=[];if("HH:mm"===Crm.userDetails.TIME_FORMAT)a=t.split(":");else{var r=t.substring(t.indexOf(" ")+1,t.length);(a=t.substring(0,t.indexOf(" ")).split(":"))[0]=Utils.convertTimeTo24HoursFormat(parseInt(a[0]),r)}return Utils.getDateObject(e,{hrs:a[0],mins:a[1]})}function u(e){var t=e.length;if(0===t)return!0;for(var a=0;a<t;a++)if(Crm.VR.fieldsInPopup.contains(e[a]))return!0;return!1}function C(l,o,m,C,g,R,F,x){var O=$(".fieldVerified");O.length&&O.remove(),_cruxUtils.removeCustomMessage();var N=$L("crm-validation-alert"),I=N.length;I>0&&!F&&(Crm.VR&&Crm.VR.IsQuickCreate&&Crm.VR.IsSearchCreate&&(I=(N=$L("#createEntityForm crm-validation-alert")).length),I>0&&N.empty());var A=$L("crm-validation-rule-error");A[0]&&(Crm.VR&&(Crm.VR.fromSC||Crm.VR.fromMC)||R)&&A.empty();var S=$(".vr_err_verify_container .vr_err_cont");S[0]&&!F&&(Crm.VR&&Crm.VR.IsQuickCreate&&Crm.VR.IsSearchCreate&&(S=$("#createEntityForm .vr_err_verify_container .vr_err_cont")),S[0]&&(S.remove(),commonUtils.setErrVerifyContHeightToParent(!1,!1,!1)));var V=!1;if(void 0===Crm.validationRuleJSONData||void 0===Crm.validationRuleJSONData[o]||void 0===Crm.validationRuleJSONData[o].validation_rules)return!0;C&&(Crm.VR||(Crm.VR={}),Crm.VR.ajaxEditFailedFields||(Crm.VR.ajaxEditFailedFields=[]),Crm.VR.globalAjaxEditedFields||(Crm.VR.globalAjaxEditedFields=[]),Crm.VR.ajaxEditFieldLabel||null===m||(Crm.VR.ajaxEditFieldLabel=m)),e=o;var w=void 0!==Crm.VR&&!0===Crm.VR.stagePopUp;if(Crm.userDetails.ValidationAlertPreference){var P=networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient),D=networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),L=P.concat(D);L=L.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM)),Lyte.injectResources(L,void 0,(function(){}))}var k,U=!0,j=!Crm.userDetails.ValidationAlertPreference,H=Crm.validationRuleJSONData[o].validation_rules,J=void 0!==Crm.userDetails&&(void 0!==Crm.userDetails.CVRFuncExecuteForAllFields&&Crm.userDetails.CVRFuncExecuteForAllFields),B=H.length,q=[],W={},Y=!1,G=null,Q=[],z=!1,K=!Crm.userDetails.ValidationAlertPreference,X=[],Z=$("#selMoreFields"),ee=$("#formRuleMandatoryFields"),te=[],ae=0;if("view"===l&&"detail"===Lyte.Router.getRouteInstance().routeName&&(G=$("#showHideDetail")),F)for(var re=0;re<B;re++){if((se=H[re]).field.column_name===m){var ie=H[re];(H=[]).push(ie),B=H.length;break}}var ne=Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().routeName:"create";if(Crm.VR&&Crm.VR.fromSC){k=$L("crm-convert-deal-fields")[0].component;var le={},oe=$L("crm-mass-convert")[0];Crm.VR.fromMC&&oe?le=oe.component:(Crm.VR.fromMC=!1,le=$L("crm-convert-lead")[0].component),le.setData("isVRError",!1)}for(re=0;re<B;re++){j=!Crm.userDetails.ValidationAlertPreference;var se,de,ce,me,ue=(se=H[re]).field,Ce=!1;Ce=null!=(Ce=se.associated_function&&J)&&Ce,Crm.VR&&Crm.VR.fromSC&&(me=void 0!==(de=k.getFieldsIndex("api_name",ue.api_name))?$L("#component_"+de):null,ce=void 0!==de?me.e.component:null);var pe=!1;if(C&&null!==m){var fe=se.participatingFields;if("REPORTINGTOCONTACTID"!==m&&!fe.contains(m)&&!Ce)continue;if("view"===l&&"FIRSTNAME"===ue.column_name)continue;m!==ue.column_name&&(pe=!0)}if(R&&Crm.VR&&Crm.VR.fieldsInPopup){if(!Crm.VR.ajaxEditFieldLabel&&!u(se.participatingFields)&&!Ce)continue;if(Crm.VR.ajaxEditFieldLabel&&!se.participatingFields.contains(Crm.VR.ajaxEditFieldLabel)&&Crm.VR.ajaxEditFieldLabel!==ue.column_name&&!u(se.participatingFields)&&!Ce)continue}var ge=_(l,ue.column_name),Re=!1,Ee=!1,ve=!1;"view"!==l||"FIRSTNAME"!==ue.column_name&&"SALUTATION"!==ue.column_name||(ge=_("view","LASTNAME"));var Te=$("#"+ge),Fe=!1,he=Crm.userDetails.isSubformNewComponentEnabled&&0===Te.length?store.peekRecord("field",ue.id):void 0;if(he&&he.subform&&"detail"===Lyte.Router.getRouteInstance().routeName&&(ge=ue.api_name?ue.api_name:ue.field,Te=$L("#"+ge),Fe=!0),Fe||!Te.data("skipWhileSubmit")){if(void 0!==Crm.VR&&null!==Crm.VR){if(Crm.VR.IsQuickCreate){if("Tasks"===e&&"SUBJECT"===ue.column_name)ge="task_subject",Te=$("#"+ge);else if(0===Te.length){1===(lt=$("."+ge)).length&&(Te=lt)}CFRExec.LayoutRuleHiddenElem&&!CFRExec.LayoutRuleHiddenElem.contains(ue.column_name)&&Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(ue.column_name)&&(ve=!0)}Crm.VR.fromSC&&(ge=Crm.VR.SC_fieldsMap[ue.column_name],Te=ce)}var ye=l===CFRExec.OPERATIONCONSTANT.VIEW&&"detail"===Lyte.Router.getRouteInstance().routeName&&"undefined"!=typeof businessCardJson&&businessCardJson&&businessCardJson.isEditRestricted&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&!(detailView.changedBCJson.recordLockingDetails.fieldIds&&detailView.changedBCJson.recordLockingDetails.fieldIds.contains(ue.id));if(g&&Crm.VR&&!0===Crm.VR.rL_closetask&&Crm.VR.entityDetails){if(!Crm.VR.entityDetails.entityMapJson||!Crm.VR.entityDetails.entityMapJson[ue.column_name])continue;if(null!==(_e=Crm.VR.entityDetails.entityMapJson[ue.column_name].readonly)&&(!0===_e||"true"===_e))continue;if(ye)continue}else if(null!==Te&&Te.length>0){var _e=void 0!==Te.data("readonly")?Te.data("readonly"):void 0!==Te.data("params")?Te.data("params").readonly:null;if(!Fe||null!==_e&&_e||(_e=!!Te[0].component.data.cxPropField&&Te[0].component.data.cxPropField.read_only),null!==_e&&(!0===_e||"true"===_e))continue;if(ye)continue}else if(g&&Crm.VR&&Crm.VR.entityDetails){if(!Crm.VR.entityDetails.entityMapJson||!Crm.VR.entityDetails.entityMapJson[ue.column_name])continue;if(null!==(_e=Crm.VR.entityDetails.entityMapJson[ue.column_name].readonly)&&(!0===_e||"true"===_e))continue;if(ye)continue}if(null===G||G.hasClass("hideDetailArrow")||!C||1!==Te.length||Te.is(":visible")||(null!==m&&m===ue.column_name&&(ge=_("edit",ue.column_name),Te=$("#"+ge)),Re=!0),Crm.VR&&Crm.VR.IsQuickCreate){var xe=null!==Te?Te.data():{};xe&&221===xe.uitype&&(Re=Ee=Te.next().is(":visible"))}if(Crm.VR&&Crm.VR.fromSC&&null!==Te||null!==Te&&1===Te.length&&(Te.is(":visible")||ve||Ee)||Re||g){if(ee.is(":visible")){var Oe=ee.find("#"+_("edit",ue.column_name));if(Oe.length>0&&!Oe.is(":visible"))continue}if(se.associated_function){var Ne=se.associated_function.id,Ie={};Ie.column_name=se.field.column_name,Ie.uitype=se.field.ui_type,Ie.value=c(0,l,Ie,m,C,g,o),Ie.api_name=se.field.api_name,Ie.field_label=se.field.field_label,Ie.id=Ne,(void 0!==Ie.value||J)&&(te[ae++]=Ie);continue}var Ae,be=se.conditions,Se=be.length,Me=!1,Ve=$("#Calendar");"Tasks"===e&&"SUBJECT"===ue.column_name&&(Ae=$("#task_subject")),r=!se.execution_type||"failure"!==se.execution_type;for(var we=0;we<Se;we++){var Pe=be[we],De=Pe.primary_condition;De.separator=se.field.separator,Fe&&(De.api_name=ue.api_name?ue.api_name:ue.field),i=!0;var Le=!0===Crm.isCalendarSchedule&&Pe.alert_type&&"allow_by_alert"===Pe.alert_type;if(d(!0,l,De,m,C,g)&&!Le){var $e="B"===De.data_type,ke=Pe.sub_conditions,Ue=ke.length,je={};if(0===Ue){if(pe)if(void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference)if(je=$("#"+_(l,ue.column_name)),"allow_by_alert"!==Pe.alert_type||x){j=!0,K=!0;qe=[];void 0===Pe.alert_preference||"on_primary_field"===Pe.alert_preference?(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Pe.alert,targetField:je,targetFieldId:ue.id,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type,query_id:Pe.id}),W[ue.column_name]=qe):"top_of_page"===Pe.alert_preference&&(W.hasOwnProperty("TopOfPage")&&(qe=W.TopOfPage),qe.push(Pe.alert),W.TopOfPage=qe)}else{Ye=!0;if(!(We=!(m!==ue.column_name)))for(Ge=Crm.valFeatureSpecinfo?Crm.valFeatureSpecinfo.length:0,Qe=0;Qe<Ge;Qe++)if(Crm.valFeatureSpecinfo[Qe].query_id===Pe.id){Ye=!1,U=!0;break}if(!We&&!Ye)break;Q.push({message:Pe.alert,targetField:je.length>0?je:ue,targetFieldId:void 0!==ue.field_id?ue.field_id:ue.id,fieldLabel:ue.field_label,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type,taskClose:g,query_id:Pe.id})}else W[ue.column_name]=Pe.alert;else if(!C||C&&null!==m&&m===ue.column_name&&!t){var He=!0,Je=!1,Be=!1;if(je=$("#"+_("edit",ue.column_name)),void 0!==Crm.VR){if(Crm.VR.IsQuickCreate)if("Tasks"===e&&("SUBJECT"===ue.column_name&&(je=Ae),void 0!==Pe.alert_preference&&"on_primary_field"!==Pe.alert_preference||Y||!Crm.VR.quickCreateMoreFields||!Crm.VR.quickCreateMoreFields.contains(ue.column_name)||($("form[name='"+Crm.VR.formName+"']").find(Z).trigger("click"),Y=!0,He=!1)),0===je.length)1===(lt=$("."+_("edit",ue.column_name))).length&&(je=lt,Je=!0),"U"===De.data_type&&(je=je.next());Crm.VR.fromSC&&(je=ce,Be=!0)}if(Crm.calendar_booking&&"allow_by_alert"!==Pe.alert_type)Crm.calendar_booking.current_validating_field_error=Pe.alert;else if(!0===Crm.isCalendarSchedule)calendarScheduleForm.showErrorMsg(Pe.alert,Te,o,Te.data().uitype);else if(Crm.VR&&Crm.VR.fromSC){void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference?Q.push({message:Pe.alert,targetField:je,targetFieldId:De.field_id,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type,query_id:Pe.id}):je.setData("cxPropErrorMessage",$ESAPI.encoder().encodeForHTML(Pe.alert)),0===(ot=null===(ot=null)?0:ot)&&me[0].scrollIntoView()}else void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference?void 0===Pe.alert_preference||"on_primary_field"===Pe.alert_preference?(v($ESAPI.encoder().encodeForHTML(Pe.alert),je,e,Be,Je,$e,C),V=!0,K=!0,j=!0):"top_of_page"===Pe.alert_preference?(X.push(Pe.alert),K=!0,j=!0):"allow_by_alert"!==Pe.alert_type||x||Q.push({message:Pe.alert,targetField:je,targetFieldId:De.field_id,fieldLabel:De.field_label,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type,query_id:Pe.id}):commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(Pe.alert),je,e,Be,Je,$e);He&&(!Crm.VR||Crm.VR&&!Crm.VR.fromSC)&&je.focus(),"DT"!==De.data_type&&"D"===De.data_type||Ve.hide()}else if(void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference)if(je=$("#"+_("edit",ue.column_name)),0===Object.keys(je).length&&(je=$("#"+_("view",ue.column_name))),"allow_by_alert"!==Pe.alert_type||x){K=!0,j=!0;var qe=[];void 0===Pe.alert_preference||"on_primary_field"===Pe.alert_preference?(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Pe.alert,targetField:je,targetFieldId:ue.id,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type}),W[ue.column_name]=qe):"top_of_page"===Pe.alert_preference&&(!g||w||R?(W.hasOwnProperty("TopOfPage")&&(qe=W.TopOfPage),qe.push(Pe.alert),W.TopOfPage=qe):(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Pe.alert,targetField:je,targetFieldId:ue.id,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type}),W[ue.column_name]=qe))}else{var We=!1,Ye=!0;if(Crm.VR.ajaxEditFieldLabel===ue.column_name&&(We=!0),Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(ue.column_name)&&(We=!0),!We)for(var Ge=Crm.valFeatureSpecinfo?Crm.valFeatureSpecinfo.length:0,Qe=0;Qe<Ge;Qe++)if(Crm.valFeatureSpecinfo[Qe].query_id===Pe.id){Ye=!1,U=!0;break}Ye&&Q.push({message:Pe.alert,targetField:je.length>0?je:ue,targetFieldId:void 0!==ue.field_id?ue.field_id:ue.id,fieldLabel:ue.field_label,alert_preference:Pe.alert_preference,alert_type:Pe.alert_type,taskClose:g,nPriField:!0,query_id:Pe.id})}else W[ue.column_name]=Pe.alert;(!Crm.userDetails.ValidationAlertPreference||void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference&&(0!==Object.keys(W).length||0!==Q.length||0!==X.length||V))&&(U=!1,Me=!0)}else for(var ze=0;ze<Ue;ze++){var Ke=ke[ze],Xe=!0===Crm.isCalendarSchedule&&Ke.alert_type&&"allow_by_alert"===Ke.alert_type,Ze=Ke.criteria;if(void 0===Ze||void 0!==Ze&&s(l,Ze,m,C,g)&&!Xe){if(pe)if(void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference)if(je=$("#"+_("view",ue.column_name)),"allow_by_alert"!==Ke.alert_type||x){j=!0,K=!0;qe=[];void 0===Ke.alert_preference||"on_primary_field"===Ke.alert_preference?(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Ke.alert,targetField:ue.column_name,targetFieldId:ue.id,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type}),W[ue.column_name]=qe):"top_of_page"===Ke.alert_preference&&(W.hasOwnProperty("TopOfPage")&&(qe=W.TopOfPage),qe.push(Ke.alert),W.TopOfPage=qe)}else{var et=Ke.criteria.length,tt=[];if(et)for(var at=0;at<et;at++)Ke.criteria[at].field&&tt.push(Ke.criteria[at].column_name);else tt.push(Ke.criteria.column_name);for(var rt=tt.length,it=(Ye=!0,0);it<rt&&Ye;it++){var nt=tt[it];if(We=!(m!==nt)){Ye=!0;break}for(Ge=Crm.valFeatureSpecinfo?Crm.valFeatureSpecinfo.length:0,Qe=0;Qe<Ge;Qe++)if(Crm.valFeatureSpecinfo[Qe].query_id===Ke.id){Ye=!1;break}}(We||Ye)&&Q.push({message:Ke.alert,targetField:je.length>0?je:ue,targetFieldId:ue.id,fieldLabel:ue.field_label,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type,taskClose:g,query_id:Ke.id})}else W[ue.column_name]=Ke.alert;else if(!C||C&&null!==m&&m===ue.column_name&&!t){He=!0,Je=!1,Be=!1;if(je=$("#"+_("edit",ue.column_name)),void 0!==Crm.VR){var lt;if(Crm.VR.IsQuickCreate)if("Tasks"===e&&("SUBJECT"===ue.column_name&&(je=Ae),void 0!==Ke.alert_preference&&"on_primary_field"!==Ke.alert_preference||Y||!Crm.VR.quickCreateMoreFields||!Crm.VR.quickCreateMoreFields.contains(ue.column_name)||($("form[name='"+Crm.VR.formName+"']").find(Z).trigger("click"),Y=!0,He=!1)),0===je.length)1===(lt=$("."+_("edit",ue.column_name))).length&&(je=lt,Je=!0),"U"===De.data_type&&(je=je.next());Crm.VR.fromSC&&(je=ce,Be=!0)}if(!0===Crm.isCalendarSchedule&&"allow_by_alert"!==Ke.alert_type)calendarScheduleForm.showErrorMsg(Ke.alert,Te,o,Te.data().uitype);else if(Crm.VR&&Crm.VR.fromSC){var ot;void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference?Q.push({message:Ke.alert,targetField:je,targetFieldId:De.field_id,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type,query_id:Ke.id}):je.setData("cxPropErrorMessage",$ESAPI.encoder().encodeForHTML(Ke.alert)),0===(ot=null===(ot=null)?0:ot)&&me[0].scrollIntoView()}else void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference?void 0===Ke.alert_preference||"on_primary_field"===Ke.alert_preference?(v($ESAPI.encoder().encodeForHTML(Ke.alert),je,e,Be,Je,$e,C),V=!0,K=!0,j=!0):"top_of_page"===Ke.alert_preference?(X.push(Ke.alert),K=!0,j=!0):"allow_by_alert"!==Ke.alert_type||x||Q.push({message:Ke.alert,targetField:je.length>0?je:De,targetFieldId:void 0!==De.field_id?De.field_id:De.id,fieldLabel:De.field_label,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type,taskClose:g,query_id:Ke.id}):commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(Ke.alert),je,e,Be,Je,$e);Crm.VR&&Crm.VR.fromSC||!He||je.focus(),"DT"!==De.data_type&&"D"===De.data_type||Ve.hide()}else if(void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference)if(je=$("#"+_("edit",ue.column_name)),validationUtils.isEmpty(je)&&(je=$("#"+_(l,ue.column_name))),"allow_by_alert"!==Ke.alert_type||x){j=!0,K=!0;var qe=[];void 0===Ke.alert_preference||"on_primary_field"===Ke.alert_preference?(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Ke.alert,targetField:ue.column_name,targetFieldId:ue.id,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type}),W[ue.column_name]=qe):"top_of_page"===Ke.alert_preference&&(!g||w||R?(W.hasOwnProperty("TopOfPage")&&(qe=W.TopOfPage),qe.push(Ke.alert),W.TopOfPage=qe):(W.hasOwnProperty(ue.column_name)&&(qe=W[ue.column_name]),qe.push({message:Ke.alert,targetField:ue.column_name,targetFieldId:ue.id,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type}),W[ue.column_name]=qe))}else{var Ye=!0,We=!1;if(Crm.VR.ajaxEditFieldLabel===ue.column_name&&(We=!0),Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(ue.column_name)&&(We=!0),!We)for(var Ge=Crm.valFeatureSpecinfo?Crm.valFeatureSpecinfo.length:0,Qe=0;Qe<Ge;Qe++)if(Crm.valFeatureSpecinfo[Qe].query_id===Ke.id){Ye=!1,U=!0;break}Ye&&Q.push({message:Ke.alert,targetField:je,targetFieldId:void 0!==ue.field_id?ue.field_id:ue.id,fieldLabel:ue.field_label,alert_preference:Ke.alert_preference,alert_type:Ke.alert_type,taskClose:g,nPriField:!0,query_id:Ke.id})}else W[ue.column_name]=Ke.alert;if((!Crm.userDetails.ValidationAlertPreference||void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference&&(0!==Object.keys(W).length||0!==Q.length||0!==X.length||V))&&(U=!1,Me=!0),(void 0===Crm.userDetails.ValidationAlertPreference||!Crm.userDetails.ValidationAlertPreference)&&void 0!==Ze)break}}}else Crm.VR&&Crm.VR.fromSC&&ce.setData("cxPropErrorMessage","");if(Me){if(pe||C&&null===m&&j)q.contains(ue.column_name)||q.push(ue.column_name),Crm.VR&&!Crm.VR.ajaxEditFailedFields.contains(ue.column_name)&&Crm.VR.ajaxEditFailedFields.push(ue.column_name),Crm.VR&&!Crm.VR.globalAjaxEditedFields.contains(ue.column_name)&&Crm.VR.globalAjaxEditedFields.push(ue.column_name);else if(K&&t){if(!0==!validationUtils.isEmpty(a)&&a&&a.check&&"Stage"==a.fieldLabel&&"DetailStageView"===a.check.type&&CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0),a=void 0,delete Crm.VR,void 0===Crm.userDetails.ValidationAlertPreference||!Crm.userDetails.ValidationAlertPreference){var st={};return st[ue.column_name]=W[ue.column_name],M(st,!1),U}z=!0}if(void 0===Crm.userDetails.ValidationAlertPreference||!Crm.userDetails.ValidationAlertPreference)break}else C&&null===m&&(Crm.VR.ajaxEditFailedFields&&Crm.VR.ajaxEditFailedFields.contains(ue.column_name)&&Crm.VR.ajaxEditFailedFields.splice(Crm.VR.ajaxEditFailedFields.indexOf(ue.column_name),1),q&&q.contains(ue.column_name)&&q.splice(q.indexOf(ue.column_name),1))}}}}if(z&&0!==Object.keys(W).length)return M(W,!0),!1;if(X.length>0&&E(X,!!Crm.VR&&Crm.VR.IsQuickCreate,ne,o),Q.length>0&&void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference){var dt=T(Q,o);Crm.VR&&Crm.VR.fromSC?(Crm.VR.fromMC&&(dt.isFromMC=!0),le.setData("valRuleData",dt),le.setData("valRuleFieldIds",n),le.setData("layoutData",k),le.setData("isVRError",!0)):K||(g&&renderingUtils.removeFreezeLayer(),Crm.VR&&(Crm.VR.saveValObject="Tasks"===o||"Potentials"===o?Crm.VR.saveValObject?Crm.VR.saveValObject:Crm.VR:Crm.VR.saveValObject),Lyte.Component.render("crm-validation-alert",{alertDetails:dt,fieldIds:n,fromPopup:R,stageClose:w,module:o,saveValObject:Crm.VR?Crm.VR.saveValObject:void 0,isVRError:!0},"canvas"===ne||"crm-calendar"===ne||"create"===ne||"clone"===ne||"begin"===ne||"list"===ne||"kanban"===ne||g||"edit"===ne||"Calls"===o||"Events"===o||"Appointments"===o?"#show.bodycontainer":"#detailViewButtonLayerMainTable"))}var ct=!0;if(window&&void 0!==o&&window[o]&&"Potentials"==window[o].moduleName&&Crm.requestParam&&"CloseFromEdit"===Crm.requestParam.type&&("edit"===window[o].currentStatus||"create"===window[o].currentStatus||"clone"===window[o].currentStatus)){var mt=$("#Crm_Potentials_STAGE");mt.val()&&"Closed Lost"===mt.find("option:selected").attr("data-fctype")&&(ct=!1)}if(ae>0&&!0!==Crm.isCalendarSchedule&&ct){var ut={};if(C){var Ct=returnJson?returnJson.entityMapJson:Crm.VR&&Crm.VR.entityDetails?Crm.VR.entityDetails.entityMapJson:null;if((!0===Crm.VR.lookup_unassign||Crm.VR.rL_closetask)&&(Ct=Crm.VR.entityDetails.entityMapJson),Ct){var pt=CFRExec&&CFRExec.haltStateParams.check&&"processFlow"===CFRExec.haltStateParams.check.type;for(var ft in Ct)if(!ft.startsWith("ATTACHMENTID")&&"LAYOUTID"!=ft&&"MODIFIEDBY"!=ft&&"SMCREATORID"!=ft&&"TAGMODULEREFID"!=ft&&"REMINDAT"!=ft){var gt,Rt=Ct[ft],Et={column_name:Rt.colname,uitype:Rt.uitype,isFieldSupported:!1};gt=y(gt=pt&&ProcessFlow&&ProcessFlow.currentTransitionDetails&&ProcessFlow.currentTransitionDetails.ProcessFieldId===Rt.fieldid?CFRExec.haltStateParams.fieldValue:13!=Rt.showtype||"Recency"!=Rt.sysRefName&&"Frequency"!=Rt.sysRefName&&"Monetary"!=Rt.sysRefName&&"Segment_Label"!=Rt.sysRefName?c(0,l,Et,m,C,g,o):Rt.defaultvalue,Rt.uitype,Et),Et.isFieldSupported&&(ut[Rt.sysRefName]=gt)}if(Crm.userDetails.ValidationRuleSupportInSubform){var vt=window[o].moduleName,Tt=returnJson[vt];if((!0===Crm.VR.lookup_unassign||Crm.VR.rL_closetask)&&(Tt=Crm.VR.entityDetails[vt]),!!Tt.subforms)for(var Ft=Tt.subforms.section,ht=Ft.length,yt=0;yt<ht;yt++){for(var _t=Ft[yt].FL,xt=Ft[yt].subFormName,Ot=_t.length,Nt=Crm.userDetails.MODULE_LIST[xt].api_name,It=[],At=0;At<Ot;At++){for(var bt=_t[At],St=bt.length,Mt={},Vt={},wt=!1,Pt=0;Pt<St;Pt++){var Dt=p(bt[Pt].colname,bt[Pt],pt,ProcessFlow,l,C,g,xt,m);F=Dt.fldValue;Dt.info.isFieldSupported&&(Vt[bt[Pt].sysRefName]=F,!wt&&(F&&"Boolean"!==bt[Pt].type||"Boolean"==bt[Pt].type&&"false"!==F)&&(wt=!0))}wt&&(Mt=Vt),Object.keys(Mt).length>0&&(Mt.id=bt[0].LINKINGMODULE_ID,It[At]=Mt)}ut[Nt]=It}}}}else if(void 0!==Crm.VR&&null!=Crm.VR&&null!=Crm.VR.fromSC&&Crm.VR.fromSC)for(var Lt in Crm.VR.SC_fieldsUIMap){var $t={isFieldSupported:!1};Xt=y(Xt=c(0,l,Crm.VR.SC_fieldsUIMap[Lt],m,C,g,o),Crm.VR.SC_fieldsUIMap[Lt].uitype,$t),$t.isFieldSupported&&(ut[Lt]=Xt)}else if(void 0!==Crm.VR&&null!=Crm.VR&&(Crm.VR.IsSearchCreate||Crm.VR.IsQuickCreate))for(var kt in Crm.VR.quickCreateAllFields){$t={isFieldSupported:!1};Xt=y(Xt=c(0,l,Crm.VR.quickCreateAllFields[kt],m,C,g,o),Crm.VR.quickCreateAllFields[kt].uitype,$t),$t.isFieldSupported&&!Crm.VR.quickCreateAllFields[kt].isEncField&&(ut[kt]=Xt)}else{var Ut=Crm.fieldsObj[o].length;for(re=0;re<Ut;re++)if(!Crm.fieldsObj[o][re].endsWith("SALUTATION")&&!Crm.fieldsObj[o][re].endsWith("PHOTO_FILEID")){var jt=(Kt=$("#"+Crm.fieldsObj[o][re])).attr("data-uitype");kt=Kt.attr("data-sysrefname");Xt=y(Xt=c(0,l,$t={column_name:Kt.attr("data-colname"),uitype:jt,isFieldSupported:!1},m,C,g,o),jt,$t),$t.isFieldSupported&&(ut[kt]=Xt)}if(Crm.userDetails.ValidationRuleSupportInSubform){var Ht=crmTab.tabVsSubTabs[o];if(Ht){var Jt=crmTab.tabVsSubTabs[o].length;for(we=0;we<Jt;we++){var Bt=[],qt="",Wt=o+"_"+Ht[we],Yt=Crm.fieldsObj[Wt].length,Gt=$("#subform_"+Ht[we]).find("tbody tr").length;for(ze=1;ze<=Gt;ze++){var Qt={};for(Vt={},wt=!1,re=0;re<Yt;re++)if(!Crm.fieldsObj[Wt][re].endsWith("SALUTATION")&&!Crm.fieldsObj[Wt][re].endsWith("PHOTO_FILEID")){var zt=Crm.fieldsObj[Wt][re]+"_"+ze,Kt=$("#"+zt);""===qt&&(qt=Kt.data("subformdisplaylabel"));var Xt;jt=Kt.attr("data-uitype"),kt=Kt.attr("data-sysrefname");Xt=y(Xt=c(0,l,$t={column_name:Kt.attr("data-colname"),uitype:jt,isFieldSupported:!1},m,C,g,Wt,zt),jt,$t),$t.isFieldSupported&&(Vt[kt]=Xt,!wt&&(Xt&&"Boolean"!==Kt.attr("type")||"Boolean"==Kt.attr("type")&&"false"!==Xt)&&(wt=!0))}wt&&(Qt=Vt),Object.keys(Qt).length>0&&(Bt[ze-1]=Qt)}ut[Crm.userDetails.MODULE_LIST[qt].api_name]=Bt}}}}"Tasks"!==o&&"Events"!==o&&"Calls"!==o||!(ut.Who_Id&&!ut.What_Id||ut.What_Id&&!ut.$se_module)||function(e,t,a){if(t){var r=returnJson?returnJson.entityMapJson:Crm.VR&&Crm.VR.entityDetails?Crm.VR.entityDetails.entityMapJson:null;if(r&&e.What_Id&&r.SEID){var i=r.SEID.lookupmodule;i?e.$se_module=i:delete e.What_Id}}else if(void 0!==Crm.VR&&null!=Crm.VR&&(Crm.VR.IsSearchCreate||Crm.VR.IsQuickCreate))"Tasks"===a&&h("leContModSel","modsel",e);else if("Events"===a){var n=$("#Crm_Events_CONTACTID_select").val();if(n&&"None"!==n){var l=$("#Crm_Events_SEID_label_select"),o=null;l.is(":visible")&&(o=l.val()),"Contacts"===n?(e.Who_Id||delete e.Who_Id,e.What_Id&&o?e.$se_module=o:delete e.What_Id):"Others"===n?(o&&e.What_Id?e.$se_module=o:delete e.What_Id,delete e.Who_Id):(e.What_Id=e.Who_Id,e.What_Id?e.$se_module=n:delete e.What_Id,delete e.Who_Id)}}else"Tasks"===a?h("Crm_Tasks_CONTACTID_WhoId_select","Crm_Tasks_SEID_label_select",e):"Calls"===a&&h("Crm_Calls_CONTACTID_WhoId_select","Crm_Calls_SEID_select",e)}(ut,C,o);var Zt={};Zt["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken;var ea=te.length;for(re=0;re<ea;re++)void 0!==Crm.VR&&null!=Crm.VR&&null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(te[re].isconvert=!0),Ce&&""==te[re].value||(ut[te[re].api_name]=y(te[re].value,te[re].uitype)),te[re].record=ut;if(window.clientPortalName){Zt["X-CRMPORTAL"]=window.clientPortalName}var ta=window[o].currentStatus;"edit"!==ta&&"view"!==ta||!te[0].record||Crm.VR&&Crm.VR.IsQuickCreate||(te[0].record.id=window[o].entityId);var aa={functions:te};return new Promise((function(e){(new crmRequestPool).initiate({action:"/crm/v2/functions/actions/execute",data:JSON.stringify(aa),type:"POST",headers:Zt,success:function(t){t&&t.functions&&(U=b(o,t.functions,te,C,m)&&U),e(U)}})})).then((function(t){return K?f(t,o,q,W,C):(t&&(e=void 0),t)}))}return K?f(U,o,q,W,C):(U&&(e=void 0),U)}function p(e,t,a,r,i,n,l,o,s){var d,m=t,u={column_name:m.colname,uitype:m.uitype,isFieldSupported:!1};if(!e.startsWith("ATTACHMENTID")&&"LAYOUTID"!==e&&"MODIFIEDBY"!==e&&"SMCREATORID"!==e&&"SMOWNERID"!==e&&"TAGMODULEREFID"!==e){if(a&&r&&r.currentTransitionDetails&&r.currentTransitionDetails.ProcessFieldId===m.fieldid)d=CFRExec.haltStateParams.fieldValue;else if(13!==m.showtype||"Recency"!==m.sysRefName&&"Frequency"!==m.sysRefName&&"Monetary"!==m.sysRefName&&"Segment_Label"!==m.sysRefName)if("ITEMDESCRIPTION"===m.colname){d=$("#subform_value_ITEMDESCRIPTION").length>0?c(0,i,u,s,n,l,o,void 0,t):""}else d=c(0,i,u,s,n,l,o,void 0,t);else d=m.defaultvalue;d=y(d,m.uitype,u)}return{fldValue:d,info:u}}function f(t,a,r,i,n){return t?e=void 0:(!0!==Crm.isCalendarSchedule&&Crm.trackSpotLightAction("Validation Rules - Records Invoked",{Module:a}),n&&function(t,a,r){var i=t.length;if(i>0){$(".select2-container").eq(0).parent().find("select").select2("close");for(var n=[],l=[],o=JSON.stringify(Crm.VR.entityDetails?Crm.VR.entityDetails.entityMapJson:returnJson.entityMapJson),s=JSON.parse(o),d=0;d<i;d++){var c=s[t[d]];if(void 0!==Crm.VR&&void 0!==Crm.VR.ajaxEditFailedFieldValues&&void 0!==Crm.VR.ajaxEditFailedFieldValues[t[d]]&&(c.defaultvalue=Crm.VR.ajaxEditFailedFieldValues[t[d]],"133"===c.uitype||"221"===c.uitype)){var m="#"+_("edit",t[d],r);if(m=$(m),0!==Object.keys(m).length){var u=m.data();c.defaultid=u?u.id:null}if("221"===c.uitype){var C=store.peekRecord("user",c.defaultid);c.defaultvalue=C?C.full_name:C}}if(("true"===c.isaggrfield||!0===c.isaggrfield)&&Crm.userDetails.isSubformNewComponentEnabled){var p=$L("#"+c.sysRefName)[0];p&&(c.dataObj?c.dataObj["data-old-value"]=c.defaultvalue=p.component.data.cxPropValue:c.defaultvalue=p.component.data.cxPropValue)}var f=crmTemplate.createFieldRow(returnJson.layout_jsonarrayObj.sysLayoutId,r,void 0,c,void 0,!0);n.push(f),l.push(t[d])}var g=!1,R=$("#closedWon");Crm.VR&&R&&R.length&&R.is(":visible")&&"crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route&&(Crm.VR.stagePopUp=!0);var E=void 0!==Crm.VR&&!0===Crm.VR.stagePopUp,T=E?R:$("#formRuleMandatoryFields");if(!E&&T&&T.length&&T.is(":visible")&&(g=!0),!E&&!g){T=$("#VRAjaxEdit");var F={};if(F.message=I18n.getMsg("crm.lr.heading.details.required"),!T||T&&0===T.length){var h=$(Handlebars.templates.ValidationRuleAjaxEditFailure(F));$("#show").prepend(h),T=$("#VRAjaxEdit")}else $("#vr_fol_otherdetails").hide(),$("#dv_field_info_header").text(F.message)}var y=T.find(".fieldsContainer");i=n.length;var x=!1;for(d=0;d<i;d++){var O=_("edit",l[d],r),N=y.find("#"+O);if((!N||N&&!N.length>0)&&y.append(n[d]),null!==a[l[d]]||null!==a.TopOfPage){if(N=y.find("#"+O),void 0!==Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.ValidationAlertPreference){if(a.TopOfPage&&null!==a.TopOfPage&&!x&&(x=!0,v(a.TopOfPage,N,e,!1,!1,!1,!1,!1,l[d],"crm-validation-alert",!1,E)),a[l[d]]&&null!==a[l[d]]){var I={};Lyte.objectUtils(I,"add",l[d],a[l[d]]),v(I,N,e,!1,!1,!1,!1,!1,l[d],"crm-validation-rule-error",!1,E)}}else commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(a[l[d]]),N,e);if(N.length>0){var A=N.data().uitype;null!=A&&"333"!=A&&"30"!=A&&"201"!=A&&"786"!=A&&"14"!=A&&N.focus()}}}if(!g&&!E){var b=$("#cm_per_desc");1===i?T.find(b).text(I18n.getMsg("crm.vr.ajax.edit.failed.subfield.single.field")):T.find(b).text(I18n.getMsg("crm.vr.ajax.edit.failed.subfield.multiple.fields"))}var S=T.find("select");S&&S.length&&thirdPartyUtils.bindSelect2(S),E||g||(crmui.showPopup("VRAjaxEdit",!0),commonUtils.setErrVerifyContHeightToParent("#VRAjaxEdit",!1,!1))}}(r,i,a)),F(!1),t}function g(e){if(e){let t=$(e).find(".vr_verifyBtn");t.length>0&&t.eq(0).addClass("vr_verifyBtn_disabled"),commonUtils.setErrVerifyContHeightToParent(e,!1,!1)}else $(".vr_verifyBtn").toArray().forEach((function(e){$(e).addClass("vr_verifyBtn_disabled")}))}function R(e){let t=$(e).find(".vr_verifyBtn.vr_verifyBtn_disabled");t.length>0&&t.eq(0).removeClass("vr_verifyBtn_disabled"),commonUtils.setErrVerifyContHeightToParent(e,!1,!1)}function E(e,t,a,r){commonUtils.setErrVerifyContHeightToParent(!1,!1,!1);var i="Calls"===r&&0!==$("#createEditCallHeader:visible").length||"Events"===r&&0!==$(".contHeadInfo.eventHeaderStyle:visible").length;if(t){var n="createEntityForm";if(Crm.VR&&Crm.VR.IsQuickCreate&&!Crm.VR.IsSearchCreate){var l;switch(r){case"Tasks":l="#ctiapi_module_head_msg_Task";break;case"Potentials":l="#ctiapi_module_head_msg_Deal";break;case"Contacts":l="#ctiapi_module_head_msg_Contact";break;case"Leads":l="#ctiapi_module_head_msg_Lead";break;case"Calls":l="#ctiapi_module_head_msg_Call"}l&&Lyte.Component.render("crm-validation-alert",{alertTOPMsg:e,alertTOPBool:!0,isDetReq:!0,popoverDirection:"bottomLeft"},l)}else $("#"+n+".cvpadding .dvTitle #crm-validation-alert").remove(),Lyte.Component.render("crm-validation-alert",{alertTOPMsg:e,alertTOPBool:!0,isDetReq:!0,isCQC:!0,popoverDirection:"bottomLeft"},"#"+n+" .cvpadding .dvTitle")}else if("begin"===a||"list"===a||i||"create"===a||"edit"===a||"clone"===a){var o=$(".valTopAlertCheck_f").length,s=!(o>0)||"none"===getComputedStyle($L("#createFixedButtonDiv")[0]).display;$(".valTopAlertCheck #crm-validation-alert").remove(),Lyte.Component.render("crm-validation-alert",{alertTOPMsg:e,alertTOPBool:!0,isDetReq:!0,closedCustData:o>0?"scroll":"no-scroll",closedPop:s,popoverDirection:"bottomLeft"},"begin"===a||"list"===a||i?"Calls"===r?"#createEditCallHeader":"Events"===r?".contHeadInfo.eventHeaderStyle":".contHeadInfo":".valTopAlertCheck"),o>0&&($L(".valTopAlertCheck crm-validation-alert #vr_topErrBtn").attr("id","vr_topErrBtn1"),$L(".valTopAlertCheck crm-validation-alert lyte-popover")[0].ltProp("originElem","#vr_topErrBtn1"),Lyte.Component.render("crm-validation-alert",{alertTOPMsg:e,alertTOPBool:!0,isDetReq:!0,closedPop:!s,closedCustData:"scroll",popoverDirection:"bottomLeft"},".valTopAlertCheck_f"))}else Lyte.registeredMixins["crm-validationrule-utils"].displayTopErrorMessage(e,!0)}function v(e,t,a,r,i,n,l,o,s,d,c,m){c&&(t=t.$node?t.$node.parentElement:t);var u=(t=$(t)).closest("crm-detail-view-subform").length>0,C=t.closest("#isQuickCreate").length>0,p=t.closest(".noNewInputStyleEle").length>0||t.closest("#qcFieldsContent"),f=t.closest(".newInputStyleEle").length>0,g=t.closest("#businesscardDtls").length>0;let R=t.closest("#formRuleMandatoryFields").length>0,E=t.closest("#VRAjaxEdit").length>0,v=t.closest(".tabDivCreate"),T=t.closest("#closedWon").length>0;var F=t.closest("tr"),h=t.closest("div"),y=t.parent();let _=$(".tabDiv.focusEleField").find(".vr_err_verify_container").eq(0);if(g&&(commonUtils.setErrVerifyContHeightToParent("#businesscardDtls",!1,!1),_=$(".labelVal.focusEleField").find(".vr_err_verify_container").eq(0)),C&&(commonUtils.setErrVerifyContHeightToParent("#isQuickCreate",!1,!1),_=y.find(".vr_err_verify_container").eq(0)),(p||f)&&(commonUtils.setErrVerifyContHeightToParent("#qcFieldsContent,.noNewInputStyleEle,.newInputStyleEle",!1,!1),_=v.eq(0).find(".vr_err_verify_container").eq(0)),R&&commonUtils.setErrVerifyContHeightToParent("#formRuleMandatoryFields",!1,!1),E&&commonUtils.setErrVerifyContHeightToParent("#VRAjaxEdit",!1,!1),T&&commonUtils.setErrVerifyContHeightToParent("#closedWon",!1,!1),g||C||p||f||R||E||T||commonUtils.setErrVerifyContHeightToParent(!1,!1,!1),0===_.length){let e=t.closest(".vr_mBAdded").eq(0).find(".vr_err_verify_container");e.length>0?_=e.eq(0):(_=$("<span>"),_.addClass("dIB vr_err_verify_container wbBreakWord"))}if(c){let a=document.createElement("div");$(a).addClass("mB10 canvasPriErrBullet").append(e);var x=y.find(".canvasPrimaryErrorDiv");if(x.length>0)x.eq(0).append(a);else{var O=document.createElement("div");u?($(O).css({"max-width":t.width()}).addClass("canvasPrimaryErrorDiv crm-extra-small-font-size crmNegativeColor mL2 pR15 wbBreakWord"),0===y.find(".vr_err_verify_container").length&&$(O).addClass("mT5")):$(O).css({"max-width":t.width()}).addClass("canvasPrimaryErrorDiv pA crm-extra-small-font-size crmNegativeColor mT5 mL2 pR15 wbBreakWord"),$(O).append(a),y.append(O),x=y.find(".canvasPrimaryErrorDiv")}let r=y.find(".canvasPrimaryErrorDiv .canvasPriErrBullet");r.length>1&&r.addClass("crmErrorBullet mB8");let i=x.eq(0);if(t.closest(".modalWrapper.verifyStageDetails").length>0){let e=i.closest("lyte-tr").find("lyte-td"),t=e.eq(1).innerWidth();e.eq(0).addClass("vaTB top9"),e.eq(1).css({width:t}),i.removeClass("pA")}else u||y.parent().addClass("vr_mBAdded").css({"margin-bottom":i.innerHeight()})}else{var N=t.closest(".tabDiv,.tabDivCreate,.customDatefield");g&&(N=t.closest(".tabdiv")),0===N.length&&(N=t);O=document.createElement("div");var I="none",A="#VRAjaxEdit #dv_field_info_header";if(y.length>0&&(I=y.innerWidth()-5),void 0!==d){let a=R&&f;if(a&&(A="#formRuleMandatoryFields .pp-header"),"crm-validation-rule-error"===d){let r,i=t.closest(".labelValCreate"),n=v;r=m?i.find(".vr_err_verify_container"):n.find(".vr_err_verify_container"),r.remove();O=document.createElement("div");$(O).attr("id","detReqPrimaryPlaceholder"),i.append(_).parent().addClass("errorFieldP"),_.append(O),Lyte.Component.render(d,{alertDetails:e,fieldId:s},O),m?(commonUtils.setErrVerifyContHeightToParent(i,!1,!1),commonUtils.setErrVerifyContHeightToParent(y,!1,!1)):a?commonUtils.setErrVerifyContHeightToParent(n,!1,!1):commonUtils.setErrVerifyContHeightToParent(n,!0,!1)}if("crm-validation-alert"===d){if(a){let e=document.createElement("span");$(e).addClass("dIB fromLR_DR_top"),$(A).append(e),A+=" .fromLR_DR_top"}Lyte.Component.render(d,{alertTOPMsg:e,alertTOPBool:!0,isDetReq:!0,popoverDirection:"bottomLeft"},m?"#closedWon #crmVrTopErrBtnContainer":A)}}else{var b=document.createElement("span");$(b).html(e),$(b).attr({class:"mT1 dIB mB8 vr_errBulletTemp crmNegativeColor"}),$(O).attr({class:"vr_priErrItem wsNormal"}),$(O).append(b);var S=$("#errorMsg_"+t.attr("id"));if(0===S.length){var M=document.createElement("div");if(C?$(M).css({"max-width":I}).attr({class:"crm-small-font-size w100_per lh15 vr_err_cont",id:"errorMsg_"+t.attr("id"),onclick:"event.stopPropagation()"}):$(M).attr({class:"crm-small-font-size w100_per lh15 vr_err_cont crmNegativeColor",id:"errorMsg_"+t.attr("id"),onclick:"event.stopPropagation()"}),_.append(M),$(M).append(O),"Events"===a&&$("#saveEventsBtn").removeAttr("disabled"),N.length)N.addClass("errorFieldP");else if(t.closest(".aggFldTabl").length)F.addClass("errorFieldP");else if(!0===r){F.addClass("form_err_fld"),(t.hasClass("cvFilter")?h:F).parent().append(_),_.append(M)}var V=t.parents("span"),w=V.attr("id");if(w&&-1!==w.indexOf("header")){var P=V.closest("td");$(M).removeClass("errorMsgDesc"),t.addClass("errorHighlight"),P.eq(0).append(_),_.append(M)}else{var D=t.closest(".labelValCreate,.labelValTwo,.validErrMsg,.FValue.uploadDoc");if(0===D.length&&n&&(D=t.closest(".tabDiv,.tabDivCreate").find(".labelValCreate")),0===D.length&&(D=t.find("td"),$(M).css("position","relative")),$("#multipleFieldsEditPop").length>0){if(!0===D.hasClass("labelValCreate"))D.parent().append(_).parent().addClass("form_err_fld");else{var L=D.find(".labelValCreate");L.length>0?L.parent().append(_).parent().addClass("form_err_fld"):D.parent().append(_).parent().addClass("form_err_fld")}_.append(M)}else if(t.attr("id")&&t.attr("id").includes("ATTACHMENTID")&&Lyte.registeredMixins["crm-create-init-mixin"].checkLyteConvertionSupport(a)&&"hidden"!==t.attr("type"))y.append(_),_.append(M),D.parent().addClass("form_err_fld");else{let e=t.closest(".tabDivCreate.errorFieldP");if(e.length>0){let t=e.eq(0).find(".vr_err_verify_container");t.length>0?t.eq(0).append(_).parent().addClass("form_err_fld"):D.append(_).addClass("form_err_fld")}else D.append(_).parent().addClass("form_err_fld");if(_.append(M),l)commonUtils.setErrVerifyContHeightToParent(D.parent(),!1,!1);else if(C)commonUtils.setErrVerifyContHeightToParent(D,!1,!1);else if(!m){let e=D.parent();f&&(e=D),commonUtils.setErrVerifyContHeightToParent(e,!0,!1)}}o&&crmTemplate.setSubformFocusBlurEvent(D),"coborgName"===a&&(t.closest(".labelValCreate").parent().append(_),_.append(M))}}else _.find(".vr_err_cont").append(O),l?commonUtils.setErrVerifyContHeightToParent(S.parent().parent(),!1,!1):C?commonUtils.setErrVerifyContHeightToParent(_.parent(),!1,!1):commonUtils.setErrVerifyContHeightToParent(_.parent(),!0,!1);let i=$("#businesscardDtls tr.errorFieldP td.labelVal");if(i.length>0){$("#businesscardDtls tr.errorFieldP .vr_err_verify_container").eq(0).addClass("pA").css({width:"100%"}),commonUtils.setErrVerifyContHeightToParent(i.eq(0),!1,!1)}let s=$(".vr_priErrItem");s.length>1&&s.toArray().forEach((function(e){$(e).parent().find(".vr_priErrItem").length>1&&$(e).find(".vr_errBulletTemp.mB8.crmNegativeColor").eq(0).removeClass("crmNegativeColor").addClass("crmErrorBullet")})),p||f&&!C||0!==t.closest(".newPopupStyleEle.showPpTop").length||commonUtils.setErrVerifyContHeightToParent(!1,!1,!1),t=null}}}function T(e,t){var a={};return n=[],e.forEach((function(e){var t=[];Lyte.arrayUtils(t,"push",e),a&&a.hasOwnProperty(e.targetFieldId)?(t=a[e.targetFieldId],Lyte.arrayUtils(t,"push",e),a[e.targetFieldId]=t):(Lyte.arrayUtils(n,"push",e.targetFieldId),Lyte.objectUtils(a,"add",e.targetFieldId,t))})),Lyte.objectUtils(a,"add","isFromSC",!!Crm.VR&&Crm.VR.fromSC),Lyte.objectUtils(a,"add","isFromQC",!!Crm.VR&&Crm.VR.IsQuickCreate),Lyte.objectUtils(a,"add","isFromDet",!Crm.VR||!Crm.VR.fromSC),Lyte.objectUtils(a,"add","isFromNC",CVRExec.isNC),Lyte.objectUtils(a,"add","module",t),a}function F(e){t=e}function h(e,t,a){var r=$("#"+e).val();if(r)if("Contacts"!==r)a.What_Id=a.Who_Id,a.$se_module=r,delete a.Who_Id;else if(a.What_Id){var i=$("#"+t).val();i?a.$se_module=i:delete a.What_Id}}function y(e,t,a){if((Crm.userDetails.VALIDATION_RULE_CF_LOOKUPSUPPORT||Crm.userDetails.ValidationAlertPreference)&&/\b(5|4|6|8|7|9|10|12|13|15|132|133|135|136|221)\b/.test(t+""))return a&&(a.isFieldSupported=!0),e||"";switch(t){case 3:case 4:case 5:case 6:case 7:case 9:case 10:case 12:case 13:case 15:case 116:case 117:case 123:case 133:case 200:case 208:case 209:case 444:case 20:case 39:case 51:case 55:case 77:case 96:case 99:case 100:case 110:case 111:case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":case"12":case"13":case"15":case"20":case"39":case"51":case"55":case"77":case"96":case"99":case"100":case"111":case"110":case"116":case"117":case"123":case"133":case"200":case"208":case"209":case"221":case"444":case"556":case"555":case"66":return a&&(a.isFieldSupported=!1),"";case"24":case 24:case"202":case 202:if(a&&(a.isFieldSupported=!0),!e)return"";var r=new Date(e),i="";return i=$.datepicker.formatDate("yy-mm-dd",r);case"14":case 14:case"30":case 30:case"333":case 333:case"786":case 786:if(a&&(a.isFieldSupported=!0),!e)return"";r=new Date(e),i="";return i=$.datepicker.formatDate("yy-mm-ddT",r),i+=Utils.formatTimeVal(r.getHours())+":"+Utils.formatTimeVal(r.getMinutes())+":"+Utils.formatTimeVal(r.getSeconds()),Crm&&Crm.userDetails.TIME_ZONE&&(i+=Crm.userDetails.TIME_ZONE.replace(".",":")),i;case"300":case 300:case"301":case 301:return a&&(a.isFieldSupported=!0),("true"===e||"1"===e||1==e)+"";case"33":case 33:return a&&(a.isFieldSupported=!0),e?commonUtils.getPlainPhoneNo(e):"";default:return a&&(a.isFieldSupported=!0),e?e.trim():""}}function _(t,a,r){if(void 0!==e&&void 0===r||(e=r),"edit"===t){if(!0===Crm.isCalendarSchedule||Crm.calendar_booking)return Crm.calendar_booking?Crm.calendar_booking.current_validating_ele_id:a;var i="Crm_"+e+"_"+a;if(void 0!==Crm.VR&&Crm.VR.IsQuickCreate&&Crm.VR.IsSearchCreate){var n="createEntityForm #"+i;0==$("#"+n).length&&(n="createEntityForm ."+i),i=n}return i}return"view"===t?"mouseArea__"+a:"print"===t?"rowTR_"+a:void 0}function x(e,t,r,i,n){(new crmRequestPool).doAjax1("/crm/v2/",(function(e){a=void 0;var l=null,o=null,s=null;if(null!=(e=e.responseJSON?e.responseJSON:e).data&&null!=e.data[0]&&null!=e.data[0].details&&null!=e.data[0].details.affected_data&&(detailView.affectedData=e.data[0].details.affected_data,detailView.affectedData[1]="OtherThanGlobalAndFieldEdit"),"string"==typeof e)l=e,o=trim(l[1]),s=l[2],s=revertSplChrs(s);else{if(e.data&&"duplicate data"===e.data[0].message){var d={},c=e.data[0].details.duplicate_record,m=returnJson.entityMapJson,u=e.data[0].details.api_name,C="",p="";for(var f in m)m[f].sysRefName===u&&(C=m[f].displaylabel,p=m[f].colname);d.FIELDLABEL=C,d.OWNERNAME=c.Owner.name,d.MODULE=t,d.RECORDS={},d.COUNT=1,d.ZUID=c.Owner.zuid,delete c.Owner;var g=[],R={};if(R.ENTITYID=c.id,delete c.id,Object.keys(c).length>1){var E=Crm.userDetails.NAME_FORMAT;E=E.split(",");var v=[];E.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),c[e]&&v.push(c[e])})),R.ENTITYNAME=v.join(" "),R.ENTITYNAMEFORPOPOVER=v.join(" ")}else for(var T in c)R.ENTITYNAME=c[T],R.ENTITYNAMEFORPOPOVER=c[T];g.push(R),d.RECORDS=g;var F=commonUtils.getDuplicateErrorMsg(d,!1);return commonUtils.showErrorMsg(F,$("#Crm_"+t+"_"+p),t),commonUtils.showHideLoadingDiv(),void(primaryField===p&&CFRExec.cancelPopupNdClearParamHistory())}if(e.data&&e.data[0]&&"FILTER_CRITERIA_NOT_SATISFIED"===e.data[0].code){m=returnJson.entityMapJson,u=e.data[0].details.api_name,C="",p="";for(var f in m)if(m[f].sysRefName===u){C=m[f].displaylabel,p=m[f].colname;break}var h=(I=$("#Crm_"+t+"_"+p)).data("lookupModule");let a=221===I.data("uitype")?I18n.getMsg("crm.user.text"):moduleRecordMapping[h].singular_label;const r=$("#VRAjaxEdit");return null!=r&&r.length&&r.is(":visible")&&!r.children("#"+I.attr("id").length)&&crmui.hidePopup("VRAjaxEdit"),commonUtils.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",a),I,t),void commonUtils.showHideLoadingDiv()}if("DUPLICATE_LINKING_DATA"===e.data[0].code){var y=e.data[0].details.duplicate_record,_=y.id,x=y.Name,O=I18n.getMsg("crm.linking.module.duplicate.warning",[$ESAPI.encoder().encodeForHTML(t),$ESAPI.encoder().encodeForHTML(_),$ESAPI.encoder().encodeForHTML(x),$ESAPI.encoder().encodeForHTML(Crm.getCrmBasePath())]);return renderingUtils.showCustomAlert(O,"",!0),commonUtils.hideDuplicateErrorMsg("viewentityform"),void(itsonview=!0)}if("INVALID_DATA"===e.data[0].code){m=returnJson.entityMapJson,u=e.data[0].details.api_name,C="",p="";for(var f in m)if(m[f].sysRefName===u){C=m[f].displaylabel,p=m[f].colname;break}var N,I=$("#Crm_"+t+"_"+p);return N="Non Subordinate User Found"===e.data[0].message?I18n.getMsg("crm.record.creation.userlookup.alert.manage.subordinate.user"):I18n.getMsg("crm.field.valid.check",C),commonUtils.showErrorMsg(N,I,t),void commonUtils.showHideLoadingDiv()}if("NOT_ALLOWED"===e.data[0].code){m=returnJson.entityMapJson,u=e.data[0].details.api_name,C="",p="";for(var f in m)if(m[f].sysRefName===u){C=m[f].displaylabel,p=m[f].colname;break}I=$("#Crm_"+t+"_"+p);if("A portal user with the same phone number already exists."===e.data[0].message)return N=I18n.getMsg("custmr.prtl.phone.already.used"),commonUtils.showErrorMsg(N,I,t),void commonUtils.showHideLoadingDiv();if("A portal user with same email address already exists."===e.data[0].message)return N=I18n.getMsg("custmr.prtl.email.already.used"),commonUtils.showErrorMsg(N,I,t),void commonUtils.showHideLoadingDiv()}o="success"===(l=e).data[0].status}if(o){if(function(e,t,a){if(Crm.userDetails.isSubformNewComponentEnabled&&Crm.VR&&Crm.VR.entityDetails&&Crm.VR.entityDetails.entityMapJson&&e&&e.recordAPInputJson){var r={},i=moduleRecordMapping[t].fields;Object.keys(e.recordAPInputJson).forEach((function(t){var a=i.filterBy({api_name:t})[0];a&&a.subform&&500!==a.ui_type&&(r[t]=e.recordAPInputJson[t])})),Object.keys(r).length>0&&(r.id=a,store.pushPayload(moduleRecordMapping[t].id,r),store.peekRecord(moduleRecordMapping[t].id,a).$.persist())}}(l,t,r),"relatedList"===i)Crm.userDetails.isRelatedListLyteEnabled||crmRelatedList.ajaxReq({pname:Crm.isActivitySplitDone?"TASKSPERSONALITY;TASKSHISTORYPERSONALITY":"ACTIVITYPERSONALITY;ACTIVITYHISTORYPERSONALITY",module:t,id:r}),Lyte.triggerEvent("related_list",{module:"Activities"});else if("detailView"===i||"DetailStageView"===i)reloadCurrentEntityView(r,t);else if("detailspage"===i){if(CFRExec.relatedEntityMap={},"Tasks"===t){var A=$("#completedValue").text();returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.STATUS&&detailView.replaceDataParams("STATUS",A)}reloadCurrentEntityView(r,t)}else if("kanbanview"===i)Lyte.Router.getRouteInstance().refresh();else if("list"===i)crmListView.reloadCurrentListView();else if("dashboard"===i){var b=objectUtils.URL(n).getParams();CrmDashboard.loadDashboards(void 0,void 0,{clickId:"loadHomePage",currentOption:"20",dashletId:b.dashletId,layoutId:b.layoutId,module:"Tasks"})}crmui.hidePopup("VRAjaxEdit"),$("#VRAjaxEdit").find(".fieldsContainer").empty(),delete Crm.VR}else if(o)renderingUtils.showCustomAlert("Invalid response!!!!");else if("start datetime of the event should be greater than the end datetime"===e.data[0].message)s=I18n.getMsg("crm.import.error.event.invalid.start.time"),renderingUtils.showCustomAlert(s,"",!1);else{if("RECORD_LOCKED"===e.data[0].code)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.record.locking.permission.denied"));renderingUtils.showCustomAlert("Error:"+s)}}),e,(function(){renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),crmui.hidePopup("VRAjaxEdit"),$("#VRAjaxEdit").find(".fieldsContainer").empty(),a=void 0,delete Crm.VR}))}function O(e,t){var a={};a.columnName=Crm.VR.ajaxEditFieldLabel,a.fieldValue=Crm.requestParamWithColname[Crm.VR.ajaxEditFieldLabel];var r=1;if(Crm.userDetails.isSubformNewComponentEnabled){if("true"===returnJson.entityMapJson[a.columnName].isaggrfield||!0===returnJson.entityMapJson[a.columnName].isaggrfield){var i=$L("#"+returnJson.entityMapJson[a.columnName].sysRefName)[0];i&&(a.fieldValue=i.getData("cxPropValue"))}var n=store.peekRecord(moduleRecordMapping[e].id,returnJson[e].entityid);(n?n.$.getDirtyAttributes():[]).forEach((function(t){var i=moduleRecordMapping[e].fields.filterBy({api_name:t})[0];if(Crm.VR.ajaxEditFieldLabel!=i.column_name&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson[i.column_name]&&("true"===returnJson.entityMapJson[i.column_name].isaggrfield||!0===returnJson.entityMapJson[i.column_name].isaggrfield)){var n=$L("#"+t)[0];n&&(a["columnName"+r]=i.column_name,a["fieldValue"+r]=n.getData("cxPropValue"),r++)}}))}var l=returnJson.entityMapJson[a.columnName].uitype;if(4==l){var o=Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam();a.fieldValue=$("#Crm_"+o+"_"+a.columnName).val()}if(133===l||"133"===l){var s=JSON.parse(JSON.stringify(document.getElementById("mouseArea__"+a.columnName))),d=Object.keys(s)[0];s[d].params&&s[d].params.filterQueryId&&(a.filterQueryId=s[d].params.filterQueryId)}for(var c in!a.fieldValue&&301!==l&&"301"!==l&&e&&"Potentials"===e&&Crm.VR.ajaxEditFieldLabelValue&&(a.fieldValue=Crm.VR.ajaxEditFieldLabelValue),Crm.VR.entityID&&(a.entityID=Crm.VR.entityID),S(e,Crm.VR.ajaxEditFieldLabel,a),delete Crm.requestParamWithColname[Crm.VR.ajaxEditFieldLabel],Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(c)&&(a["columnName"+r]=c,a["fieldValue"+r]=Crm.requestParamWithColname[c],r++,S(e,c,a));return a.moduleid=t,a.module=e,a[csrfParamName]=csrfToken,a}function N(e){var t=Crm.VR.entityDetails.entityMapJson[e];if(!t)return null;if(/\b(5|4|6|7|9|10|12|13|15|132|133|135|136)\b/.test(t.uitype+"")){if(t.defaultid&&!isNaN(t.defaultid)&&t.defaultvalue){var a={};return a.name=t.defaultvalue,a.id=t.defaultid,a}return""}return t.defaultvalue}function I(e){if(!e)return null;if(/\b(5|4|6|7|9|10|12|13|15|132|133|135|136)\b/.test(e.uitype+"")){if(e.defaultid&&!isNaN(e.defaultid)&&e.defaultvalue){var t={};return t.name=e.defaultvalue,t.id=e.defaultid,t}return""}return e.defaultvalue}function A(e){a=objectUtils.cloneObject(e)}function b(t,r,i,n,l){e=t;var o,s,d=!0,c={},m=!1,u={},C=!1,p=$("#task_subject"),g=[],R=[],E=0,v=!1,T=null;Crm.VR&&Crm.VR.fromSC&&(T=$L("crm-convert-deal-fields")[0].component);try{for(var F=r.length,h=0;h<F;h++){var y=r[h];if("success"==y.status&&y.details){var _="string"==typeof y.details.output?JSON.parse(y.details.output.replace(/'/g,'"')):y.details.output;if(!_.status){d=!1,v=!0;break}if("success"!=_.status){if(!n||n&&null!==l&&l===i[h].column_name){var x=CVRExec.getElemId("edit",i[h].column_name,t);if(c=$("#"+x),void 0!==Crm.VR){if(Crm.VR.IsQuickCreate&&"Tasks"==e){if("SUBJECT"==i[h].column_name)c=p;else if(0===c.length){var O=$("."+x);1===O.length&&(c=O,o=!0)}!m&&Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(i[h].column_name)&&($("form[name='"+Crm.VR.formName+"']").find("#selMoreFields").trigger("click"),m=!0,s=!0)}if(null!=Crm.VR.fromSC&&Crm.VR.fromSC){var N=void 0!==(A=T.getFieldsIndex("column_name",i[h].column_name))?$L("#component_"+A):null;c=void 0!==A?N.e.component:null,s=!0}}if(0==c.length)"STAGE"==i[h].column_name&&(C=!0),u[i[h].field_label]=_.message.substring(0,100);else if(Crm.VR&&Crm.VR.fromSC){c.setData("cxPropErrorMessage",$ESAPI.encoder().encodeForHTML(_.message.substring(0,100)));var I=null;0===(I=null===I?0:I)&&N[0].scrollIntoView()}else commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(_.message.substring(0,100)),c,t,s,o,"checkbox"==c.attr("type")),c.focus()}else!0===Crm.VR.lookup_unassign?u[i[h].field_label]=_.message.substring(0,100):(g[E++]=i[h].column_name,R[i[h].column_name]=_.message.substring(0,100),n&&null===l&&(Crm.VR.ajaxEditFailedFieldValues||(Crm.VR.ajaxEditFailedFieldValues={}),Crm.VR.ajaxEditFailedFieldValues[i[h].column_name]=i[h].value));d=!1}else if(Crm.VR&&Crm.VR.fromSC){var A;N=void 0!==(A=T.getFieldsIndex("column_name",i[h].column_name))?$L("#component_"+A):null;(void 0!==A?N.e.component:null).setData("cxPropErrorMessage","")}}else if("INTERNAL_ERROR"==y.code||"INVALID_DATA"==y.code){d=!1,v=!0;break}}}catch(e){v=!0,d=!1}if(v)$("#newRelatedListPopUpDiv").css("z-index","1000").html('<div class="crm-heading-font-size p30  alignLeft"><div class="crm-font-bold crm-heading-font-size">'+I18n.getMsg("crm.validation.rule.function.error.heading")+'</div><div class="crm-subheading-font-size mB10 mT10 crm-font-regular">'+I18n.getMsg("crm.validation.rule.function.error.title")+'</div><ul class="m0 bottom0 cutomfunctionalert"><li>'+I18n.getMsg("crm.validation.rule.function.error1")+"</li><li>"+I18n.getMsg("crm.validation.rule.function.error2")+'</li></ul> <br><div class="aligncenter"><input type="button" id="custom_alert_button" class="primarybtn" value="'+I18n.getMsg("crm.mb.newversion.msg4")+'" onclick="crmui.hidePopup(\'newRelatedListPopUpDiv\')"></div></div>',null,!0),crmui.showPopup("newRelatedListPopUpDiv");else if(!validationUtils.isEmpty(u)&&!v)return C&&a&&a.check&&"DetailStageView"==a.check.type&&detailView.stageClickHandler($('li[data-stageid="'+CVRExec.prevStage+'"]')),M(u,!1),d;return f(d,t,g,R,n)}function S(e,t,a){if("Tasks"==e&&"STATUS"==t){var r=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof r&&(r="true"===r),r||($("#showDontAskOption").prop("checked")&&(a.isDontAskAgainChecked=!0),$("#notifyOwnerOption").prop("checked")&&(a.isNotifyOwnerChecked=!0))}}function M(e,t){t&&(e.valAlertPref=t),$("#newRelatedListPopUpDiv").removeClass("w860").css("width","30%").html(Handlebars.templates.validationRuleError(e)),crmui.showPopup("newRelatedListPopUpDiv")}return{evalRules:C,showValidationAlertOnErrorNew:b,getElemId:_,errorCallbackFunc:T,cancelAjaxEditPopup:function(){if(!0==!validationUtils.isEmpty(a))"StageView"===a.check.type?crmListView.updateStageError(a.check.valId,a.check.prevStageId):a&&a.check&&"Stage"==a.fieldLabel&&"DetailStageView"===a.check.type&&detailView.stageClickHandler($('li[data-stageid="'+CVRExec.prevStage+'"]'));else if(Crm.VR&&Crm.VR.ajaxEditFieldLabel){$("#saveCancelSpan").find('a[name="button__'+Crm.VR.ajaxEditFieldLabel+'"]').trigger("click")}CFRExec.revertPotentials&&(cancelPotentialPopup(),CFRExec.revertPotentials=!1),a=void 0,crmui.hidePopup("VRAjaxEdit"),$("#formRuleMandatoryFields:visible").length&&setTimeout((function(){renderingUtils.freezeBackground()}),410);var e=$("#VRAjaxEdit");e.find(".fieldsContainer").empty(),delete Crm.VR;var t=$("crm-detailview-canvas")[0];void 0!==t&&($(".moveLookupPopBackToFreezeAjax").removeClass("moveLookupPopBackToFreezeAjax"),t.component.ajaxCancel()),e.find("#vr_fol_otherdetails").length>0&&CFRExec.performCancelMandatory(),$L("#changeOwnerPopUp").length>0&&($L("#topBandPopup").removeClass("moveTopbandBackToTheFreeze"),closeownernamedialog(),changeOwner.trackChangeOwnerCancel())},saveAjaxEditPopup:function(){commonUtils.setErrVerifyContHeightToParent("#VRAjaxEdit",!1,!0);var t=$("#VRAjaxEdit");t.find(".vr_err_verify_container #detReqPrimaryPlaceholder").remove();var r=!1,i={};if(!1===validationUtils.isEmpty(a)&&("closeTask"!==(i=a).check.type&&"StageView"!==i.check.type&&"DetailStageView"!==i.check.type||(r=!0)),!Crm.VR&&(Crm.VR={},Crm.oldVR)){var n=Crm.oldVR.ajaxEditFieldLabel;Crm.VR.ajaxEditFieldLabel=n,Crm.VR.entityDetails={},Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson?objectUtils.cloneObject(returnJson.entityMapJson):returnJson.entityMapJson}Crm.VR.fieldsInPopup||(Crm.VR.fieldsInPopup=[]);for(var l=[],o=t.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm_']").not("input[id$='_TimeOption']"),s=t.find("#vr_fol_otherdetails").length>0,d=o.length,c=0;c<d;c++){var m=$(o[c]);l.push(m.attr("id")),Crm.VR.fieldsInPopup.push(m.data("colname"))}!r&&detailView.currentModule&&l.push("Crm_"+detailView.currentModule+"_"+Crm.VR.ajaxEditFieldLabel);var u=Crm.validateEntityAndShowErrorMsg(l,e||detailView.currentModule,!0);u&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e||detailView.currentModule))&&void 0!==CFRExec&&!(u=CFRExec.executeLayoutRulesForVR(e||detailView.currentModule))&&s&&Crm.validateEntityAndShowErrorMsg(l,e||detailView.currentModule,!0),u&&u&&(r||"Events"!==detailView.currentModule||(r=Crm.VR.ajaxEditFieldLabel&&""!==Crm.VR.ajaxEditFieldLabel&&Crm.VR.fieldsInPopup.contains(Crm.VR.ajaxEditFieldLabel)),new Promise((function(t){t(C("view",e||detailView.currentModule,null,!0,r,!0))})).then((function(r){if(r)if(!1===validationUtils.isEmpty(a)){var i=null,n=1;for(var l in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(l)&&(i="fieldValue"+n,a["columnName"+n]=l,a[i]=Crm.requestParamWithColname[l],n++);var o=a.check;delete a.check,"StageView"===o.type?(new crmRequestPool).doAjax1("/crm/v2/",(function(r){"saveDenied"!==("STAGE"!==a.columnName?crmListView.updateStageSuccess(a.moduleid,e||detailView.currentModule,o.valId,o.prevStageId,r):crmListView.updateStageSuccess(a.moduleid,e||detailView.currentModule,a.fieldValue,o.prevStageId,r))?(crmui.hidePopup("VRAjaxEdit"),t.find(".fieldsContainer").empty(),a=void 0,delete Crm.VR):a.check=o}),a,(function(){renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),crmui.hidePopup("VRAjaxEdit"),t.find(".fieldsContainer").empty(),a=void 0,delete Crm.VR})):"closeTask"!==o.type&&"DetailStageView"!==o.type||("closeTask"===o.type&&S(o.module,"STATUS",a),x(a,o.module,o.id,o.from,o.url))}else{var s=detailView.currentModule,d=returnJson[s].entityid,c=O(s,d),m=$L("#changeOwnerPopUp"),u=$L("#topBandPopup"),C=$L("#otherRecommendationZiaIconBC"),p=(C=C.is(":visible")?$L("crm-zia-reasoning-popover"):C).is(":visible");if(m.is(":visible")||p){var f=c.module,g={},R={},E=$("#mouseArea__"+c.columnName).data("params");if("STATUS"===c.columnName&&"Tasks"===f)g.Status=c.fieldValue;else if("DUEDATE"===c.columnName)g.Due_Date=apiDateFormat(c.fieldValue);else if(void 0===E&&"AMOUNT"===c.columnName)g.Amount=c.fieldValue;else if(void 0===E)g[customViewObject.stageSysRefName]=Crm.getDealsStageValue(c.fieldValue);else{V=-1!==(V=E.sysRefName).indexOf(".")?V.replace(".","__"):V;var v=E.uitype;if(g[V]=c.fieldValue,24===parseInt(v)||202===parseInt(v))g[V]=""===c.fieldValue?c.fieldValue:apiDateFormat(c.fieldValue);else if(786===parseInt(v)||333===parseInt(v)||14===parseInt(v))g[V]=""===c.fieldValue?c.fieldValue:apiDateTimeFormat(c.fieldValue);else if(21!==parseInt(v)&&"Stage"===V&&c.fieldValue.split(":").length>1){var T=c.fieldValue.indexOf(":");g[V]=c.fieldValue.substring(T+1)}else if(100===parseInt(v)||96===parseInt(v)){for(var F=[],h=(P=c.fieldValue.split(";")).length,y=0;y<h;y++)F.push(P[y]);g[V]=F}else 300!==parseInt(v)&&301!==parseInt(v)||(g[V]="true"===c.fieldValue)}var _=Object.keys(c).length,N=new RegExp("CustomModule\\d+_Name");for(y=1;y<_;y++){var I="columnName"+y.toString(),A="fieldValue"+y.toString();c.hasOwnProperty(I)&&c.hasOwnProperty(A)&&(A.split(":")&&A.split(":").length>1&&(c[A]=c[A].split[1]),R[c[I]]=c[A])}for(var b in R){var M=$("#mouseArea__"+b).data("params"),V="";v="";if(void 0===M){var w=$("#Crm_"+f+"_"+b);V=-1!==(V=w.data("sysrefname")).indexOf(".")?V.replace(".","__"):V,v=w.data("uitype")}else V=-1!==(V=M.sysRefName).indexOf(".")?V.replace(".","__"):V,v=M.uitype;if("Stage"===V&&R[b].split(":").length>1){T=R[b].indexOf(":");g[V]=R[b].substring(T+1)}else if(24===parseInt(v)||202===parseInt(v))g[V]=""===c.fieldValue?c.fieldValue:apiDateFormat(R[b]);else if(786===parseInt(v)||333===parseInt(v)||14===parseInt(v))g[V]=""===c.fieldValue?c.fieldValue:apiDateTimeFormat(R[b]);else if(100===parseInt(v)||96===parseInt(v)){var P;for(F=[],h=(P=R[b].split(";")).length,y=0;y<h;y++)F.push(P[y]);""===R[b]&&(F=""),g[V]=F}else 1===parseInt(v)&&N.test(V)?g.Name=R[b]:300===parseInt(v)||301===parseInt(v)?g[V]="true"===R[b]||"false"!==R[b]&&R[b]:g[V]=R[b]}var D={folOwnerAjaxVal:g};p?(C[0].component.setData("ajaxEditOwnerValue",D),C[0].component.setData("onSave",!0)):m[0].component.ajaxEditOwnerValue=D,crmui.hidePopup("VRAjaxEdit"),u.removeClass("moveTopbandBackToTheFreeze")}else{if(2===detailView.isApproved){var L=Lyte.registeredMixins.approvalprocess.constructPayloadFromDetailViewTemplate(c,s);return void Lyte.registeredMixins.approvalprocess.saveRecordWithApprovalResponse(businessCardJson.hidden.APPROVALBUTTONS,L,"FOL")}x(c,s,d,"detailView",null)}}})))},fieldVerify:function(e,t,a){var r;event.stopPropagation();var i=$(".fieldVerified");i.length&&i.remove();var n=!0;if(a){Crm.VR=Crm.VR?Crm.VR:{},"Events"===e||"Tasks"===e||"Calls"===e||Crm.VR.IsQuickCreate&&!Crm.VR.IsSearchCreate&&"Potentials"===e||(Crm.VR.IsQuickCreate=void 0===Crm.VR.IsQuickCreate||Crm.VR.IsQuickCreate,Crm.VR.IsSearchCreate=void 0===Crm.VR.IsSearchCreate||Crm.VR.IsSearchCreate);var l,o=[],s=[],d=[],c="#"+_("edit",t,e),m=$(c);if(m.length>0?l=m?m[0].name:"":(c=document.getElementById(e+"_fldRow_"+t),l=$(c)?$(c)[0].name:""),l&&""!==l&&Crm.VR.fieldNames)for(var u=Crm.VR.fieldNames?Crm.VR.fieldNames:window.fieldname,p=Crm.VR.fieldDataType?Crm.VR.fieldDataType:window.fieldname,f=Crm.VR.fieldLabel?Crm.VR.fieldLabel:window.fielddatatype,E=u.length,v=0;v<E;v++)l===u[v]&&(o.push(u[v]),s.push(p[v]),d.push(f[v]));Crm.VR.IsQuickCreate&&!Crm.VR.IsSearchCreate?validationUtils.formValidate(Crm.VR.formName,o,d,s):n="Events"!==e?validationUtils.formValidate("createEntityForm",o,d,s,"inline",!0):Crm.validateEntityAndShowErrorMsg(["Crm_"+e+"_"+t],e,!1,event,!1,void 0,!1,void 0,!0)}else n=Crm.validateEntityAndShowErrorMsg(["Crm_"+e+"_"+t],e,!1);if(a){if((r=$("#"+_("edit",t,e)).parent().parent()).find(".errMsg").remove(),n){var T=r.find(".form_err_msg");T&&T.length>0&&T.remove()}commonUtils.setErrVerifyContHeightToParent(!1,!1,!1),0===(r=r.find(".vr_err_verify_container").eq(0)).length&&(r=$("#"+e+"_fldRow_"+t).find(".vr_err_verify_container").eq(0));var F=r.find(".vr_err_cont");F[0]&&F.remove(),"Tasks"!==e&&"Events"!==e&&"Calls"!==e&&"Services"!==e&&"Appointments"!==e&&(Crm.VR=Crm.VR?Crm.VR:{})}if(n){if($("#Crm_"+e+"_"+t).closest(".tabdiv").removeClass("errorFieldP"),!a){var h=$("#"+_("edit",t,e)).parents("span").attr("id");r=h&&-1!==h.indexOf("header")?"#header_"+t:"#"+_("view",t),r+=" .vr_err_verify_container"}r=$(r);var y=document.createElement("div");$(y).attr({id:"fieldVerified",class:"fieldVerified dIF aiCenter vaM"});let i=document.createElement("crmutil-icon");$(i).attr({"icon-name":"tick-filled-md","icon-class":"zcicn-tick-filled-md zcicn_green "});let n=document.createElement("span");$(n).text(I18n.getMsg("crm.validation.rule.verifying3")),$(n).attr({class:"crm-small-font-size mL4"}),$(y).append(n),r.append(y);let l=r.parent();g(l);let o=r.closest(".errorFieldP");o&&o.removeClass("errorFieldP");let s=r.closest(".form_err_fld");s&&s.removeClass("form_err_fld"),(a?C("edit",e,t,!1,!1,!1,!0):C("view",e,t,!0,!1,!1,!0))?($(n).empty(),$(n).attr({class:"crmGreenColor crm-small-font-size mL4"}),$(n).text(I18n.getMsg("verified")),$(y).append(i,n),r.append(y),g(l),l.closest(".newBusinessCardView").length||l.closest(".detailViewContainer").length?l.closest(".editModeEnable").length?R(l):g(l):R(l)):($(y).empty(),R(l))}else commonUtils.setErrVerifyContHeightToParent(!1,!1,!1),$("#Crm_"+e+"_"+t).closest(".tabdiv").addClass("errorFieldP")},subFormFieldVerify:function(e,t){var a=$(".fieldVerified");a.length&&a.remove();var r=$(".canvasPrimaryErrorDiv");r.length&&r.remove();var i=Lyte.registeredMixins["crm-detailcanvas-utils"],n=function(e,t,a,r,n,l){var o,s=$(".fieldVerified");s.length>0&&(o=s[0].children[0]),$(o).empty(),0===t.length?($(o).attr({class:"crmGreenColor crm-small-font-size mL4"}),$(o).text(I18n.getMsg("verified")),$(m).append(u,o)):s.length>0&&s.remove(),i.HandlindValidationRuleErrorforAjaxEdit(e,t,a,r,n,l)}.bind(i),l=$L("crux-subform")[0].component,o=l.getData("cxPropContent"),s=$L("#"+t,l.$node).eq(0),d=$L("crm-detail-view-subform")[0].component;d.setData("currentEditedField",s[0]),d.getData("isLyteDVRender")&&d.setData("vr_exec_result",void 0);var c=s.parent().parent();c=c.find(".vr_err_verify_container");var m=document.createElement("div");$(m).attr({id:"fieldVerified",class:"fieldVerified dIF aiCenter vaM"});let u=document.createElement("crmutil-icon");$(u).attr({"icon-name":"tick-filled-md","icon-class":"zcicn-tick-filled-md zcicn_green "});let C=document.createElement("span");$(C).text(I18n.getMsg("crm.validation.rule.verifying3")),$(C).attr({class:"crm-small-font-size mL4"}),$(m).append(C),c.append(m),s[0].component.validate()?i.executeValidationRuleforAjaxEdit(o,d,void 0,n,!0,!0,e):(a=$(".fieldVerified")).length>0&&a.remove()},emptyErrorData:function(){_cruxUtils.removeCustomMessage();var e=$L("crm-validation-alert");e.length>0&&e.empty();var t=$L("crm-validation-rule-error");t[0]&&t.empty();var a=$(".vr_err_verify_container .vr_err_cont");a[0]&&(a.remove(),commonUtils.setErrVerifyContHeightToParent(!1,!1,!1))},removeVerifyBtn:g,showVerifyBtn:R,allowByAlertSavePopup:function(e){if(!1===validationUtils.isEmpty(a)){var t=a.check;if("kanbanview"!==t.from&&"list"!==t.from||"closeTask"!==t.type){var r=null,i=1;for(var n in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(n)&&(r="fieldValue"+i,a["columnName"+i]=n,a[r]=Crm.requestParamWithColname[n],i++);a.$validation_rule_action=e}delete a.check,"StageView"===t.type?(new crmRequestPool).doAjax1("/crm/v2/",(function(e){"STAGE"!==a.columnName?crmListView.updateStageSuccess(a.moduleid,t.valId,t.prevStageId,e):crmListView.updateStageSuccess(a.moduleid,a.fieldValue,t.prevStageId,e),crmui.hidePopup("VRAjaxEdit"),mainDiv.find(".fieldsContainer").empty(),a=void 0,delete Crm.VR}),a,(function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("game.common.error")}}),crmui.hidePopup("VRAjaxEdit"),mainDiv.find(".fieldsContainer").empty(),a=void 0,delete Crm.VR})):"closeTask"!==t.type&&"DetailStageView"!==t.type||("closeTask"===t.type&&(S(t.module,"STATUS",a),delete a.fieldValue1),x(a,t.module,t.id,t.from,t.url))}else{var l=detailView.currentModule,o=returnJson[l].entityid,s=O(l,o);s.$validation_rule_action=e;var d=$L("#changeOwnerPopUp");if(d.is(":visible")){var c=s.module,m={},u={},C=$("#mouseArea__"+s.columnName).data("params");if("STATUS"===s.columnName&&"Tasks"===c)m.Status=s.fieldValue;else if("DUEDATE"===s.columnName)m.Due_Date=apiDateFormat(s.fieldValue);else if(void 0===C&&"AMOUNT"===s.columnName)m.Amount=s.fieldValue;else if(void 0===C)m[customViewObject.stageSysRefName]=Crm.getDealsStageValue(s.fieldValue);else{N=-1!==(N=C.sysRefName).indexOf(".")?N.replace(".","__"):N;var p=C.uitype;if(m[N]=s.fieldValue,24===parseInt(p)||202===parseInt(p))m[N]=""===s.fieldValue?s.fieldValue:apiDateFormat(s.fieldValue);else if(786===parseInt(p)||333===parseInt(p)||14===parseInt(p))m[N]=""===s.fieldValue?s.fieldValue:apiDateTimeFormat(s.fieldValue);else if(21!==parseInt(p)&&"Stage"===N&&s.fieldValue.split(":").length>1){var f=s.fieldValue.indexOf(":");m[N]=s.fieldValue.substring(f+1)}else if(100===parseInt(p)||96===parseInt(p)){for(var g=[],R=(A=s.fieldValue.split(";")).length,E=0;E<R;E++)g.push(A[E]);m[N]=g}else 300!==parseInt(p)&&301!==parseInt(p)||(m[N]="true"===s.fieldValue)}var v=Object.keys(s).length,T=new RegExp("CustomModule\\d+_Name");for(E=1;E<v;E++){var F="columnName"+E.toString(),h="fieldValue"+E.toString();s.hasOwnProperty(F)&&s.hasOwnProperty(h)&&(h.split(":")&&h.split(":").length>1&&(s[h]=s[h].split[1]),u[s[F]]=s[h])}for(var y in u){var _=$("#mouseArea__"+y).data("params"),N="";p="";if(void 0===_){var I=$("#Crm_"+c+"_"+y);N=-1!==(N=I.data("sysrefname")).indexOf(".")?N.replace(".","__"):N,p=I.data("uitype")}else N=-1!==(N=_.sysRefName).indexOf(".")?N.replace(".","__"):N,p=_.uitype;if("Stage"===N&&u[y].split(":").length>1){f=u[y].indexOf(":");m[N]=u[y].substring(f+1)}else if(24===parseInt(p)||202===parseInt(p))m[N]=""===s.fieldValue?s.fieldValue:apiDateFormat(u[y]);else if(786===parseInt(p)||333===parseInt(p)||14===parseInt(p))m[N]=""===s.fieldValue?s.fieldValue:apiDateTimeFormat(u[y]);else if(100===parseInt(p)||96===parseInt(p)){var A;for(g=[],R=(A=u[y].split(";")).length,E=0;E<R;E++)g.push(A[E]);""===u[y]&&(g=""),m[N]=g}else 1===parseInt(p)&&T.test(N)?m.Name=u[y]:300===parseInt(p)||301===parseInt(p)?m[N]="true"===u[y]||"false"!==u[y]&&u[y]:m[N]=u[y]}var b={folOwnerAjaxVal:m};d[0].component.ajaxEditOwnerValue=b}else{if(2===detailView.isApproved){var M=Lyte.registeredMixins.approvalprocess.constructPayloadFromDetailViewTemplate(s,l);return void Lyte.registeredMixins.approvalprocess.saveRecordWithApprovalResponse(businessCardJson.hidden.APPROVALBUTTONS,M,"VR")}x(s,l,o,"detailView",null)}}},validateRulesForLayoutRule:function(e,t,r){Crm.VR||(Crm.VR={}),Crm.VR.fieldsInPopup=[],Crm.VR.entityDetails||(Crm.VR.entityDetails={}),Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson?objectUtils.cloneObject(returnJson.entityMapJson):returnJson.entityMapJson,t&&t.columnName&&t.check&&"StageView"===t.check.type&&t.check.newStageBoardValue&&CVRExec.storeStageValue(t.check.newStageBoardValue,t.columnName),Crm.VR.ajaxEditFieldLabel&&e&&e.contains(Crm.VR.ajaxEditFieldLabel)&&e.splice(e.indexOf(Crm.VR.ajaxEditFieldLabel),1),Crm.VR.ajaxEditFailedFields||(Crm.VR.ajaxEditFailedFields=[]);for(var i=e.length,n=0;n<i;n++)Crm.VR.ajaxEditFailedFields.push(e[n]),Crm.VR.fieldsInPopup.push(e[n]);if(r&&"Potentials"===r&&a&&a.check&&"DetailStageView"===a.check.type){var l=a.fieldValue;return l&&l.indexOf(":")>-1&&(l=Crm.getDealsStageValue(l)),CVRExec.storeStageValue(l),new Promise((function(e){e(C("view","Potentials",null,!0,!0,!0))}))}var o=!1;if(!1===validationUtils.isEmpty(t)){A(t);var s=a.check&&a.check.type?a.check.type:"";if("closeTask"===s)o=!0,CVRExec.getTaskCompletedUserValue();else{if("DetailStageView"===s)return new Promise((function(e){e(C("view","Potentials",null,!0,!0,!0))}));if("StageView"===s)return new Promise((function(e){e(C("view",a.module,null,!0,!0,!0))}))}}var d=o?"Tasks":detailView.currentModule;return new Promise((function(e){e(C("view",d,null,!0,o,!0))}))},getTaskCompletedUserValue:function(){if(Crm.VR&&Crm.VR.entityDetails&&Crm.VR.entityDetails.entityMapJson&&Crm.VR.entityDetails.entityMapJson.STATUS){for(var e=Crm.VR.entityDetails.entityMapJson.STATUS.picklistmap,t=e.length,a=0;a<t;a++)if("Completed"===e[a].systemvalue)return Crm.VR.entityDetails.entityMapJson.STATUS.defaultvalue=e[a].uservalue,e[a].uservalue;Crm.VR.entityDetails.entityMapJson.STATUS.defaultvalue="Completed"}return"Completed"},getFieldVal:N,showAlertTopMsg:E,showAlertPrefMsg:v,storeCachedParams:A,storeStageValue:function(e,t){t?Crm.VR.entityDetails.entityMapJson[t].defaultvalue=e:Crm.VR.entityDetails.entityMapJson.STAGE.defaultvalue=e},validateRulesForStagePopUpSave:function(e){if(e)return!0;Crm.VR||(Crm.VR={}),Crm.VR.fieldsInPopup=[],Crm.VR.stagePopUp=!0,Crm.VR.entityDetails=returnJson?objectUtils.cloneObject(returnJson):returnJson,Crm.VR.ajaxEditFailedFields||(Crm.VR.ajaxEditFailedFields=[]);for(var t=$("#closedWon").find(".labelValCreate :input[id^='Crm_']").not("input[id$='_TimeOption']"),a=t.length,r=0;r<a;r++){var i=$(t[r]);Crm.VR.fieldsInPopup.push(i.data("colname"))}return new Promise((function(e){e(C("view","Potentials",null,!0,!0,!0))}))},setAjaxEditPrimaryField:F,hideAlertPopup:function(){crmui.hidePopup("newRelatedListPopUpDiv"),$("#newRelatedListPopUpDiv").css("width","").addClass("w860"),validationUtils.isEmpty(a)||"StageView"!==a.check.type||crmListView.updateStageError(a.check.valId,a.check.prevStageId),F(!1),delete Crm.VR},saveValuesAndReloadEntityDetails:x}}catch(e){$("#jsexception").html("").text("exception occured in CrmValidationRuleExecution js file"+e)}}();$(document).ready((function(){window.addEventListener?window.addEventListener("storage",(function(){var e=localStorage.getItem("closeReminder");if(e){localStorage.removeItem("closeReminder");var t=e.split("_")[1];"object"==typeof Events&&Events.closeReminderPop(t,!0)}}),!1):window.attachEvent("onstorage",(function(){var e=localStorage.getItem("closeReminder");if(e){localStorage.removeItem("closeReminder");var t=e.split("_")[1];"object"==typeof Events&&Events.closeReminderPop(t,!0)}}),!1),document.addEventListener("click",popUpListener,!0);for(var e=0;e<document.forms.length;e++)document.forms[e].submitted=!0;"object"==typeof Crm&&(Crm.massOperationWorkflowLimit||(Crm.massOperationWorkflowLimit=1e3),Crm.massOperationUserThreadLimit=501,Crm.massOperationTotalLimit||(Crm.massOperationTotalLimit=5e4)),scrollConst=125,Math.sign||(Math.sign=function(e){return(e>0)-(e<0)||+e})}));var wfForm={wf_chosen_open:void 0,currElemFoc:void 0,elem:void 0,dupErrorDetails:void 0,checkMultiSelVal:function(e){var t=$(e).find(".chosen-results");function a(t){t.show(),$(e).find(".dvnoprof").remove(),0===t.find("li.active-result").length&&t.hide().parent().append($("<div/>").addClass("crm-font-regular aligncenter dvnoprof boxsizeBB").text("No results found"))}$(e).find(".search-field input").off("keydown").on("keydown",(function(){a($(this).find(".chosen-results"))})),a(t)},inputfieldFocus:function(){$(".wf_form_focus").find("tr:eq(0) td:eq(1) input").focus()},initFormClick:function(){var e=$(".wf_form_focus");e.find("textarea").each((function(){!function(e){var t=e.outerWidth(),a=18,r=$("#span_tarea");if(r.length<=0){var i=$("<span>"),n=e.css("font-size");i.attr({id:"span_tarea",class:"dIB newgraybtn"}).css({visiblity:"hidden","font-size":n,"word-break":"break-word"}),$("body").append(i),r=i}r.text(e.val());var l=parseInt(r.outerHeight()/18)*a;r.css({width:t}),l>72?e.css({height:"72px"}):e.css({height:l})}($(this))})),e.find("input, textarea, select").on("focus",(function(e){renderingUtils.stopEvent(e);var t=$(this),a=t.outerWidth()+10;if(t.closest("div").hasClass("chosen-search"))return!1;if(!t.closest("tr").hasClass("wf_no_focus")){var r=t.css("font-size");$(".wf_form_focus").find("tr").find("td").removeClass("wf_setFocus");var i=t.closest("td");if(i.hasClass("wf_setFocus")&&i.removeClass("wf_setFocus").removeAttr("onblur"),"textarea"===t.prop("tagName").toLowerCase()){var n=$("#span_tarea");if(0==n.length){var l=$("<span>");l.attr({id:"span_tarea",class:"dIB newgraybtn"}).css({visiblity:"hidden","font-size":r}),$("body").append(l),n.css({visibility:"hidden"}),n.css("width",a)}t.off("keypress paste").on("paste keypress",(function(e){var t=$(this);if("keypress"==e.type){var a=$("#span_tarea");a.text(t.val());var r=18*parseInt(a.outerHeight()/18);r>72?t.css({height:"72px"}):t.css({height:r})}else"paste"==e.type&&t.css({height:"72px"})}))}i.addClass("wf_setFocus"),t.hasClass("qcInputModulation")||t.attr("onblur","wfForm.removeFocus(this,'form',event)")}})),e.find("tr").off("click").on("click",(function(e){var t,a=$(this);if(a.hasClass("wf_foc_cb")){var r=a.data("cbtd");(o=a.find("td").eq(r).find("input:checkbox")).triggerHandler("click"),o.is(":checked")?o.prop("checked",!1):o.prop("checked",!0)}else if(!a.hasClass("wf_no_focus")){t=a.find("td").eq(1);var i=renderingUtils.getTargetElem(e),n=$(i).hasClass("wf_requiredMark")||$(i).hasClass("wf_form_lab"),l="TD"==$(i).prop("tagName");if(!t.hasClass("wf_moreInp")&&(n||l))for(var o,s=(o=t.find("input,textarea,.newSelect")).length,d=0;d<s;d++){var c=o.prop("tagName"),m=o.attr("type");if(!o.eq(d).is(":disabled")&&"INPUT"==c&&"hidden"!=m)return void(o=o.eq(d)).focus();if(!o.eq(d).is(":disabled")&&"TEXTAREA"==c)return void(o=o.eq(d)).focus();if(o.eq(d).hasClass("newSelect")&&!o.eq(d).find("select").is(":disabled"))return o=o.eq(d),$("body").trigger("click"),sE(),void o.find("select").select2("open")}}}))},removeFocus:function(e,t,a){var r=$(e);"criteria"===t?r.removeAttr("onblur").closest("td").removeClass("wf_setFocus"):($(".wf_form_focus").find("tr").find("td").removeClass("wf_setFocus").removeAttr("onblur"),"textarea"===r.prop("tagName").toLowerCase()&&(0==r.val().length&&r.css({height:18}),$("#span_tarea").remove())),window.hasOwnProperty("module")&&this.prevalidate(e,a,module)},prevalidate:function(e,t,a){if(this.isPrevalidateNeeded(t)){var r=e.dataset.sysrefname,i=store.peekAll("field").filter((e=>e.api_name===r&&e.module&&a===e.module[0].module_name))[0],n=this;if(i&&void 0!==i.unique.casesensitive){var l=void 0!==t.target&&void 0!==t.target.value?t.target.value:void 0;if(void 0!==l)if(""!==l){var o={};o[r]=l;var s=[];s.push(o);var d={data:s};store.triggerAction("entity","pre_validate",{version:"2.2",module:moduleApiMapping[a]},null,"POST",d).then(function(e){if("DUPLICATE_DATA"===e.data[0].code){var t=$(this);n.setDuplicateError(e.data[0],n,t,i)}else{t=$(this);$(document.getElementById("errorMsg_"+t.attr("id"))).remove(),t.closest("tr").removeClass("form_err_fld")}}.bind(e))}else{var c=$(document.getElementById(a+"_fldRow_"+i.column_name));$(document.getElementById("errorMsg_Crm_"+a+"_"+i.column_name)).remove(),c.closest("tr").removeClass("form_err_fld")}}}},isPrevalidateNeeded:function(e){if(e&&e.relatedTarget&&null!==e.relatedTarget){if(e.relatedTarget&&"BUTTON"===e.relatedTarget.nodeName&&("save"===e.relatedTarget.name||"saveAndNew"===e.relatedTarget.name||"cancel"===e.relatedTarget.name))return!1;if(e.relatedTarget&&"INPUT"===e.relatedTarget.nodeName&&("Save"===e.relatedTarget.value||"Save and Associate"===e.relatedTarget.name||"Cancel"===e.relatedTarget.name))return!1;if(this.data&&"wizards"===this.data.globalData.formType&&e.relatedTarget.dataset.zcqa&&null!==e.relatedTarget.dataset.zcqa.match("button"))return!1}return!0},setDuplicateError:function(e,t,a,r){var i={isError:!0,duplicateFdetails:{}};i.duplicateFdetails.id=e.details&&e.details.duplicate_record?e.details.duplicate_record.id:void 0,i.duplicateFdetails.detailsFromserver=e.details,i.duplicateFdetails.key=e.details.api_name,i.duplicateFdetails.dupFieldLabel=n,i.duplicateFdetails.modLabel=null!=moduleRecordMapping[e.details.duplicate_record.module.api_name]?moduleRecordMapping[e.details.duplicate_record.module.api_name].singular_label:moduleRecordMapping[module].singular_label,i.duplicateFdetails.moduleN=null!=moduleRecordMapping[e.details.duplicate_record.module.api_name]?moduleRecordMapping[e.details.duplicate_record.module.api_name].api_name:moduleRecordMapping[module].api_name,i.duplicateFdetails.modPluLabel=null!=moduleRecordMapping[e.details.duplicate_record.module.api_name]?moduleRecordMapping[e.details.duplicate_record.module.api_name].plural_label:moduleRecordMapping[module].plural_label;var n=r.field_label,l="",o="",s="",d=null!=moduleRecordMapping[e.details.duplicate_record.module.api_name]?e.details.duplicate_record.module.api_name:module,c=e.details.duplicate_record.id;if(o=Crm.userDetails.MODULE_LIST[d].plural_label?Crm.userDetails.MODULE_LIST[d].plural_label:Crm.userDetails.MODULE_LIST[d].pluralLabel,s=Crm.userDetails.MODULE_LIST[d].singular_label?Crm.userDetails.MODULE_LIST[d].singular_label:Crm.userDetails.MODULE_LIST[d].singularLabel,e.details&&e.details.more_records&&Crm.userDetails.permissions["Crm_Implied_Merge_"+d])l=I18n.getMsg("crm.duplicate.value.not.allowed")+" "+I18n.getMsg("crm.duplicate.value.available.multiple",[void 0!==moduleRecordMapping[e.details.duplicate_record.module.api_name]?moduleRecordMapping[e.details.duplicate_record.module.api_name].singular_label.toLowerCase():moduleRecordMapping[module].singular_label.toLowerCase(),n]),i.more_records=!0,l=$ESAPI.encoder().encodeForHTML(l),l+='<link-to lt-prop-target="_blank" lt-prop-route="crm.tab.module.entity.find-and-merge" lt-prop-qp=\'{"findDupFldName" :"'+$ESAPI.encoder().encodeForHTML(n)+"\"}'    lt-prop-dp='[\""+d+'","'+c+"\"]'>"+I18n.getMsg("crm.label.module.merge",I18n.getMsg($ESAPI.encoder().encodeForHTML(o)))+"</link-to>";else{l=I18n.getMsg("crm.duplicate.value.not.allowed")+" "+I18n.getMsg("crm.duplicate.value.available",[void 0!==moduleRecordMapping[e.details.duplicate_record.module.api_name]?moduleRecordMapping[e.details.duplicate_record.module.api_name].singular_label.toLowerCase():moduleRecordMapping[module].singular_label.toLowerCase(),n]);var m=Crm.getCrmBasePath()+"/EntityInfo.do?module="+d+"&id="+c;m=networkUtils.getPortalURL(m),l=$ESAPI.encoder().encodeForHTML(l),this.dupErrorDetails=i,l+=" <a data-zcqa='viewExistingRecord' class='viewExistingRecordQuickInfo' id='viewExistingRecordQuickInfo"+e.details.api_name+"' onmouseleave=\"Crm.dontHideQuickInfoPop(event);\" onmouseenter=\"wfForm.showDuplicateRecordDetail(this)\" rel='noopener noreferrer' target='_blank' href='"+m+"'>"+I18n.getMsg("crm.view.record",I18n.getMsg($ESAPI.encoder().encodeForHTML(s)))+"</a>"}commonUtils.showErrorMsg(l,a,module,!0)},showDuplicateRecordDetail:function(e){var t=this.dupErrorDetails;if(t.duplicateFdetails&&t.duplicateFdetails.detailsFromserver&&t.duplicateFdetails.detailsFromserver.duplicate_record){var a=t.duplicateFdetails.detailsFromserver.duplicate_record,r=moduleRecordMapping[t.duplicateFdetails.moduleN]?moduleRecordMapping[t.duplicateFdetails.moduleN].id:moduleRecordMapping[module].id,i=store.peekRecord("module",r).display_field,n=e.id;n=n.replace("viewExistingRecordQuickInfo","");var l=store.peekRecord(r,a.id),o="null";l?(o="Full_Name"==i.api_name&&l.Salutation?l.Salutation+" "+l[i.api_name]:l[i.api_name],Crm.showExistingEmailQuickInfo(o,a.Owner.name,a.Owner.zuid,t.duplicateFdetails.modLabel,n,e,!0)):store.findRecord(r,a.id,{approved:"both",converted:"both"}).then((function(r){o=r[0]?"Full_Name"==i.api_name&&r[0].Salutation?r[0].Salutation+" "+r[0][i.api_name]:r[0][i.api_name]:o,Crm.showExistingEmailQuickInfo(o,a.Owner.name,a.Owner.zuid,t.duplicateFdetails.modLabel,n,e,!0)}),(function(){Crm.showExistingEmailQuickInfo(o,a.Owner.name,a.Owner.zuid,t.duplicateFdetails.modLabel,n,e,!0)}))}},chosen_show:function(e){null!=e?thirdPartyUtils.bindSelect2($("#"+e).find(".newSelect").find("select")):(thirdPartyUtils.bindSelect2($(".newSelect").find("select")),thirdPartyUtils.bindSelect2($(".wf_chosen_ui").find("select"))),thirdPartyUtils.bindSelect2($(".zcrm-modal").find("select"))},setSltVal:function(e){var t=0;t=$(e).attr("data-chosenlen")?$(e).data("chosenlen"):35;var a=$(e).find("option:selected"),r=a.data("val"),i=$(e).closest(".wf_chosen_ui"),n=i.find(".sltSetVal");void 0===r&&(r=a.text()),n.text(r),"None"===r||"HH"===r||"MM"===r?n.addClass("color_None"):n.removeClass("color_None"),r.length>t?i.addClass("wf_chosen_hover"):i.removeClass("wf_chosen_hover");var l=$("#pb_transitionAction_form").length>0,o=$("#aPfldUpdate").length>0,s=$(e),d=s.children("option:selected").eq(0),c=d.attr("data-colorcode")?d.attr("data-colorcode"):"",m=$L("#potentialFields tr#reason_for_loss");d&&"Closed Lost"===d.attr("fctype")?m.length>0&&m.removeClass("dN"):d&&void 0!==d.attr("fctype")&&m.length>0&&m.addClass("dN");var u=s.data("from"),C="";if(l){C="selectWFupdatecolorcode";var p=$("#selectWFupdatecolorcode")}else if(o)if(C="selectWFupdatecolorcode",e.id.startsWith("Approval"))p=$("#ApprovalfieldLabletd"+e.id.slice(19)).find("#selectWFupdatecolorcode");else p=$("#fieldLabletd"+e.id.slice(11)).find("#selectWFupdatecolorcode");else if("leadConvert"===u){C="selectColorComponent-"+s.data("fieldid");p=$("#"+C)}else{p=$("#selectWFupdatecolorcode");C="selectWFupdatecolorcode"}if(c){p.remove();var f=null;s.data("colorcode",c),(g=s.parent().parent()).addClass("colorEnabledPicklist"),"-None-"===a.value||""===a.value?g.addClass("colorEnabledPKNone"):(g.removeClass("colorEnabledPKNone"),f=l?$('<span class="dIB activitesColor" data-zcqa="colorcode_selectWFupdatecolorcode" id="selectWFupdatecolorcode" style="background:'+c+'"></span>'):$('<span class="dIB activitesColor" data-zcqa="wfform_colorcode_'+s.data("fieldid")+'" id="'+C+'" style="background:'+c+'"></span>')),null!==f&&f.insertBefore(s)}else if(p&&p.length>0){var g;p.remove(),(g=s.parent().parent()).addClass("colorEnabledPKNone")}else{var R=$(e).parent(),E=void 0!==R?R.parent():void 0;void 0!==E&&E.removeClass("colorEnabledPicklist")}},setOprSel:function(e,t,a,r){renderingUtils.stopEvent();var i=$(e).find(".cus_cb_inp");if(a&&"and"==r&&i.is(":checked"))Search.patternConditionChangedValue="";else if(!a||"or"!=r||i.is(":checked")){var n=$("#match"+t);if(n.find("option").prop("selected",!1),i.is(":checked")?(n.find("[value='or']").prop("selected","selected"),a&&$("#condition_inp"+t).prop("checked",!1)):(n.find("[value='and']").prop("selected","selected"),a&&$("#condition_inp"+t).prop("checked",!0)),!a){var l="";-1!=t.indexOf("_")&&(l=t.substring(t.indexOf("_"))),Search.changeOprValPattern("match"+t,l)}}else Search.patternConditionChangedValue=""},setOprSel_new:function(e,t,a,r){window.event&&renderingUtils.stopEvent();var i=$(e).find(".cus_cb_inp"),n=i.is(":checked");if(!(a&&"and"==r&&n||"or"==r&&!n)){var l=n?"or":"and",o=$(e).parent().find(".searchMatch");o.val(l),a?i.prop("checked",!n):Search.changeOprValPattern_new(o,t)}},focusInp:function(e,t,a){$("#"+t+a).focus().attr("onblur","wfForm.removeFocus(this,'criteria')"),$("#searchcriteria"+a).find("#wf_field_type_td").addClass("wf_setFocus")}};function reInviteAlert(e){if(e)return getObj("email").value!=getObj("oldEmail").value?getObj("reInvite").value=!0:getObj("reInvite").value=!1,!0}function showFreezeMessage(e){if("crm.store.thanks"==e.trim()&&(e="<fmt:message key='crm.store.thanks'/>"),""!=e.trim()){renderingUtils.freezeBackground(),$(getObj("freezeMessageContiner")).empty(),getObj("freezeMessageContiner").innerHTML=e;var t=getObj("freezeMessageDiv");t.style.top="381px",t.style.position="absolute",t.style.zIndex="30",t.style.display="block",mailsetCenter("freezeMessageDiv")}}function addArrElem(e,t,a){if(a){var r=!1;for(i=0;i<e.length;i++)if(e[i]==t){r=!0;break}r||(e[e.length]=t)}else e[e.length]=t}function removeArrElem(e,t){for(i=0;i<e.length;i++)if(e[i]==t){e.splice(i,1);break}}function arrayContains(e,t,a){if(e)for(var r=0;r<e.length;r++)if("id"==a){if(e[r].id===t)return!0}else if(e[r]===t)return!0;return!1}function showURLinPopup(e,t,a,r,i,n,l,o,s,d,c){var m=$("#popUpDIV");if((m.addClass("ppTop"),l)&&!window.confirm(I18n.getMsg("crm.image.delete.confirm")))return!1;e.includes("wfDelugePop")&&m.addClass("wfFuncConfig");var u=getElemById("wfDelugeLoadDIV");u&&(u.style.display=""),void 0===t&&(t="600px"),void 0===a&&(a="400px");var C=void 0,p=void 0,f=Lyte.registeredMixins["crm-deluge"];if(f&&f.inputData&&"workflow"===f.inputData.featureType)C=f.inputData.module,p=f.inputData.relatedModule;else if($("#Orchbuilder").length>0)C=Lyte.registeredMixins.orchestration_action.getCurrentModuleName(AutomationActionsHelper.currenctActionInstance.isTransition),p=store.peekRecord("module",Lyte.registeredMixins.orchestration_action.getProcessData().id).module_name;else if($("#kioskConnectBuilder").length>0){var g=$L("crm-kiosk-builder")[0].component;C=g.module,p=g.relatedModule}else C=$L("crm-pathfinder-builder-touchpointswrap").length>0?AutomationActionsHelper.currenctActionInstance.module:$("#createProcessContainer").length>0?ProcessBuilder.Process.Module:document.querySelector("crm-wizard-builder")?wizardTransitionHandler.Transition.Module:$L("crm-cc-actions").length>0?ccCrmActions.module:CustomRelatedListObj.getCurrentPageDetails("module");var R=Lyte.Router.getRouteInstance().parent.routeName;"workflow-deluge"===R&&(C=$("#module").val()),"undefined"!=typeof wfdeluge&&wfdeluge&&wfdeluge.isAutomationFeatureRoute(R)&&(customFunctionsObj.category=customFunctionsObj.isFrom="automation"),"review-process"===R?C=$L("crm-reviewprocess-createconfig").e[0].getData("tabName"):"approval-process"===R&&(C=$("#module").val()),customFunctionsObj.module=C,customFunctionsObj.relatedModule=p,"undefined"!=typeof wfmergefield&&wfmergefield.setActionType("Deluge");var E=null;c&&(E=c),s&&(E?E+="&"+csrfParamName+"="+encodeURIComponent(csrfToken):E=csrfParamName+"="+encodeURIComponent(csrfToken)),C&&""!=C&&moduleRecordMapping[C]&&(E?E+="&module="+C+"&reqType=ajax":E="module="+C+"&reqType=ajax",p&&(E+="&relatedModule="+p)),"newRelatedListPopUpDiv"===d&&($(d).removeClass("p30"),$(d).css({padding:"0px"}));var v=d?getElemById(d):getElemById("popUpDIV"),T=new getHTTPObject;T.open("POST",e,!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.onreadystatechange=function(){if(4==T.readyState){var r=$("#crl_customfunction_list");if(T.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(T);$(v).empty(),$L("crm-cc-actions").length>0&&$(getElemById("newRelatedListPopUpDiv")).empty(),v.innerHTML=T.responseText,r.is(":visible")&&(r.find(".wf_form_UI").addClass("wf_form_focus"),select2ChangesInFields(r),wfForm.initFormClick()),v.style.width=t,v.style.height=a,-1!=e.search("viewFuncCode")&&(v.style.maxWidth="1200px"),$("#postYrReq").length>0&&(v.style.height="",v.style.maxHeight=a),getObj("wfModule"),crmui.showPopup({id:"popUpDIV",escToClose:!1}),manipulateScriptElems(v),e.indexOf(Crm.getCrmBasePath()+"/WorkFlowDeluge.do?step=createCustomFunctionInZohoCreator")>-1&&"true"==CustomButtonJSObjectInit.isDRE&&CustomButtonJSObjectInit.setDelugeDivHeight("true"),"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1),o&&(getElemById("publishSuccMsg").style.display="",$("#publishSuccMsg").fadeOut(4e3)),document.title=I18n.getMsg("crm.title.general",[I18n.getMsg(I18n.getMsg("crm.inactive.prewarning.custom.functions"),Crm.partnerName),Crm.partnerName])}},T.send(E)}function closeURLPopup(){if(ccCrmActions&&ccCrmActions.module)ccCrmActions.cancelAction();else{var e=$("#popUpDIV");if("block"===$("#popUpDIV").css("display")){crmui.hidePopup("popUpDIV");var t=$L("crm-kiosk-builder");t.length>0&&(t[0].setData("isKioskStateClicked",!1),($L("#kioskDisconnectedCompConnect").length>0||$L("crm-kiosk-disconnected-components-popup").length>0)&&($L("#popUpDIV").removeClass("kioskActionPopZInd"),$L("#FreezeLayer").removeClass("kioskLeftPanActionZInd"))),crmui.transSupport?$("#popUpDIV").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(e){$("#popUpDIV").removeClass("ppTop wfFuncConfig"),$("#popUpDIV").empty(),$("#popUpDIV").off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")})):(renderingUtils.removeFreezeLayer(),e.removeClass("ppTop wfFuncConfig"),$("#popUpDIV").empty())}else crmui.hidePopup("newRelatedListPopUpDiv");(getObj("isapproval")||getObj("wfModule")||$(".pb_associated_deluge").length>0||getObj("rpFunctionsList"))&&"undefined"!=typeof delugepopupId&&delugepopupId?(crmui.showPopup(delugepopupId),delugepopupId=null):$L("#workflowActions").length>0&&void 0!==wfdeluge.renderListView&&wfdeluge.renderListView&&(Lyte.registeredMixins["crm-deluge"].viewFunctionToListview(),wfdeluge.renderListView=void 0),"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1)}}function createApprovalProcess(e,t){var a=$("#modOpt option:selected").val();loadUrl(e,t+"&module="+a)}function statusChange(e){var t=csrfParamName+"="+encodeURIComponent(csrfToken);if($(e).hasClass("Act")){var a=Crm.getCrmBasePath()+"/approvalProcess.do?action=isAPAssociated&processId="+$(e).closest("tr").attr("id");mR(a,(function(a){var r=(a=JSON.parse(a)).orchestration_used;if(r)showAPDeleteDenyPopUp(r);else{var i=I18n.getMsg(a.record_used?"crm.confirm.deactivate.approval.processes1":"crm.confirm.deactivate.approval.processes");confirmDeactivePopForAP(e,i,"doDeactivateAP","doDeactivateAP",[!0,e,t],[!1,e,t])}}))}else{var r=Crm.getCrmBasePath()+"/approvalProcess.do?action=updateStatus&processId="+$(e).closest("tr").attr("id")+"&status=active";mR(r,(function(t){"limitExceeded"==(t=JSON.parse(t)).status?alert(I18n.getMsg("crm.approval.process.active.limit",t.limitCnt)):($(e).find(".InactiveStatus").hide(),$(e).find(".activeStatus").show(),$(e).removeClass("inAct"),$(e).addClass("Act"))}),t)}}function confirmDeactivePopForAP(e,t,a,r,i,n){var l=$("#deactivePopup");if(l.removeClass("popInListView popInDetailView"),$(e).closest("div").data("sch"))return crmui.showPopup("deActivateWarnDIV"),void $(e).closest("tr").addClass("wf_activeRow");if(Crm.userDetails.RTL_ENABLED){var o=crmui.getOffset(e);o.left=o.left-$(e).outerWidth()/2-40,renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:"0.15"}).show(),l.css({position:"absolute",left:o.left,top:o.top+33}).addClass("scalePopOne").show()}else{var s=crmui.getOffset(e),d=$L("#setup_new_ContentDiv").scrollTop(),c=l.outerHeight();renderingUtils.windowHeight-(s.top+55)<c?(l.addClass("shownTop"),s.left=$(window).width()-s.left-$(e).outerWidth()/2-l.outerWidth()/4,renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:"0.15"}).show(),l.css({position:"absolute",right:s.left,top:s.top+d-c-60,left:""}).addClass("scalePopOne popInListView").show()):(l.removeClass("shownTop"),s.left=$(window).width()-s.left-$(e).outerWidth()/2-l.outerWidth()/4,renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:"0.15"}).show(),l.css({position:"absolute",right:s.left,top:s.top+d-15,left:""}).addClass("scalePopOne popInListView").show())}l.find(".crm-base-font-size.crmBaseColor.crm-font-regular.vaM.infoCont").html(t),$("#wfDeactivateBtn").off("click").click((function(){executeFunctionByName(a,window,i),closeDeactivePopForAP(l)})),$("#wfDeactivateCancelBtn").off("click").click((function(){executeFunctionByName(r,window,n),closeDeactivePopForAP(l)})),$("#wfDeactivateBtnDiv").addClass("alignRight"),$(e).closest("tr").addClass("wf_activeRow")}function closeDeactivePopForAP(e){e.hide().removeClass("scalePopOne"),renderingUtils.removeFreezeLayer(),e.hide()}function executeFunctionByName(e,t,a){for(var r=e.split("."),i=r.pop(),n=0;n<r.length;n++)t=t[r[n]];return t[i].apply(t,a)}function doDeactivateAP(e,t,a){if(renderingUtils.stopEvent(),1==e){$(t).find(".activeStatus").hide(),$(t).find(".InactiveStatus").show(),$(t).removeClass("Act"),$(t).addClass("inAct");var r=Crm.getCrmBasePath()+"/approvalProcess.do?action=updateStatus&processId="+$(t).closest("tr").attr("id")+"&status=deactive";mR(r,(function(e){}),a)}else $(t).find(".InactiveStatus").hide(),$(t).find(".activeStatus").show(),$(t).removeClass("inAct"),$(t).addClass("Act");$(t).closest("tr").removeClass("wf_activeRow")}function showAPDeleteDenyPopUp(e){var t=Handlebars.templates.deleteFieldWarningPopup();$("#deleteFieldWarning").html(t),renderAutomationDenyPopComp(e,void 0,void 0,"#automationdiv"),$("#delfldhd").html(I18n.getMsg("crm.automation.cannot.delete.text",[I18n.getMsg("crm.mass.actions.approval.process")])),$("#deleteInfo1").html(I18n.getMsg("crm.ap.webform.delete.info",[I18n.getMsg("crm.mass.actions.approval.process")])),crmui.showPopup("deletefield")}function deleteApprovalProcess(e){var t=csrfParamName+"="+encodeURIComponent(csrfToken),a=Crm.getCrmBasePath()+"/approvalProcess.do?action=isAPAssociated&processId="+e;mR(a,(function(a){var r=null,i=(a=JSON.parse(a)).orchestration_used;i?showAPDeleteDenyPopUp(i):(r=1==a.record_used?I18n.getMsg("crm.confirm.delete.approval.processes1"):I18n.getMsg("crm.confirm.delete.approval.processes"),showDeletePopup(r,"crm.button.yes.delete","","",""),$("#deletepopup").find("#deleteButton").click((function(){hideAnimatePopup("deletepopup");var a=Crm.getCrmBasePath()+"/approvalProcess.do?action=deleteApprovalProcess&processId="+e;mR(a,(function(t){$("#"+e).remove(),$("#approvalListDIV tr").size()<=1&&$("#approvalProcess").length>0&&$("#approvalProcess")[0].click(),renderingUtils.removeFreezeLayer()}),t)})))}))}function selArwHov(e){$(e).prev().find("i").css("background-position","-246px -397px")}function selArwOut(e){$(e).prev().find("i").css("background-position","-246px -385px")}function applyMasterToolTip(){$(".masterTooltip").hover((function(){var e=$(this).attr("title");$(this).data("tipText",e).removeAttr("title"),$('<p class="mstooltip"></p>').text(e).appendTo("body").fadeIn("300")}),(function(){$(this).attr("title",$(this).data("tipText")),$(".mstooltip").remove()})).mousemove((function(e){var t=e.pageX+5,a=e.pageY+5;$(".mstooltip").css({top:a,left:t})}))}function setZiaVisionPageHeight(){var e,t,a,r,i=$("#setup_new_ContentDiv"),n=i.height(),l=$(".setupleftmenutable");if($("crm-ziavision-viewpage").length)e="auto",r=!1;else if($("crm-ziavision-creationpage").length)e="hidden",a=$(".newValidationRulePage"),t=n,r=!1;else if($("crm-ziavision-summarypage").length)e="hidden",a=$(".imgValidationSummaryPage"),t=n,r=!1;else if($("crm-vision-training-page").length){var o=renderingUtils.windowHeight-$(".imgValidationTrainingPage").offset().top-46,s=o-$L(".visionSummaryHeader").innerHeight()-8+"px";$L(".imgValidationTrainingPage").height(o),$L("#vision_trainingTab")[0].ltProp("height",s)}i.css("overflow",e),null!=a&&a.css("height",t),r?l.addClass("visionApprovalTable"):l.removeClass("visionApprovalTable")}$.fn.moreOption=function(){this.click((function(){sE()})),this.mouseover((function(){sE();var e=$(this),t=(crmui.getOffset(e),$(e).position().top),a=$(e).position().left;e.addClass("showMoreHvr");var r=e.closest("td").find(".more-opt-list");r.on("mouseenter",(function(){var t;t=e,$(t).addClass("showMoreHvr")})),r.on("mouseleave",(function(){!function(e,t){$(e).hide(),$(t).removeClass("showMoreHvr")}(this,e)})),r.find("li").on("click",(function(){$("#more-opt-list").hide()})),Crm.userDetails.RTL_ENABLED?r.css({right:a+35,top:t-10}).show():r.css({left:a+35,top:t-10}).show()})),this.mouseout((function(){$(this).removeClass("showMoreHvr"),setTimeout((function(){$(".more-opt-list").hide()}),100)}))};var mP={saveNewStage:function(e){e.disabled=!0,0!=$(".activePipeline").length?document.querySelector("crm-multipipelines").component.executeMethod("saveNewStage",e):document.querySelector("crm-create-pipeline").component.executeMethod("saveNewStage",e)},closeStageProbMap:function(){crmui.hidePopup("pA_state_picklistpopup"),Crm.client_tracking("Stage - Cancel Click"),0==$(".activePipeline").length&&$("#createNewPipelinePop")[0].ltProp("show",!0)}},automationActionAssociateRule={showWarning:function(e){var t=!0,a=$L("crm-action-associatedrules-component");if(void 0!==a[0]&&a[0].component.getData("isAcceptToUpdate"))void 0!==a[0]&&a[0].component.setData("isAcceptToUpdate",!1);else{if(commonUtils.showHideLoadingDiv(!0),Lyte.Component.registeredComponents["crm-action-associatedrules-component"])void 0!==a[0]?(a[0].component.setData(e),a[0].component.executeMethod("fetchAssociatedRules")):Lyte.Component.render("crm-action-associatedrules-component",e,"#result");else{var r=networkUtils.returnDependencyFiles(["crm-action-associatedrules-component.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles(["crm-action-associatedrules-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(r,void 0,(function(){Lyte.Component.render("crm-action-associatedrules-component",e,"#result")}))}t=!1}return t}},CrmTags=CrmTags||{};CrmTags.previousname="",CrmTags.mergeTagid="",CrmTags.deleteTagId="",CrmTags.mergedTagid="",CrmTags.mergeTagOldName="",CrmTags.mergeTagName="",CrmTags.mergeTagMainName="",CrmTags.usedNames=[],CrmTags.newTags=[],CrmTags.moduleName="",CrmTags.isTagsCreated=!1,CrmTags.recordCount="-1",CrmTags.colorArray=["#F17574","#F48435","#E7A826","#FEDA62","#A8C026","#63C57E","#1DB9B4","#57B1FD","#879BFC","#D297EE","#FD87BD","#969696","#658BA8","#B88562","#A35164"],CrmTags.month=["January","February","March","April","May","June","July","August","September","October","November","December"],CrmTags.shortMonth=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CrmTags.configuredArea={},CrmTags.updatedName="",CrmTags.tableObj={Leads:"CrmLeadDetails",Contacts:"CrmContactDetails",Accounts:"CrmAccount",Potentials:"CrmPotential",Deals:"CrmPotential",Quotes:"CrmQuote",Calls:"CrmActivity",Events:"CrmActivity",Tasks:"CrmActivity",Campaigns:"CrmCampaign",Cases:"CrmCase",PriceBooks:"CrmPriceBooks",Vendors:"CrmVendors",Products:"CrmProducts",Solutions:"CrmSolution",SalesOrders:"CrmSalesOrder",PurchaseOrders:"CrmPurchaseOrder",Invoices:"CrmInvoice",Services:"CrmServiceDetails",Appointments:"CrmAppointmentDetails",Bundles:"CrmBundles"},CrmTags.usedTagCount=0,CrmTags.editionLimit=0,CrmTags.currentModule=null,CrmTags.editTagTr=null,CrmTags.isFromActivityModule=null,CrmTags.init=function(){CrmTags.previousname="",CrmTags.mergeTagid="",CrmTags.deleteTagId="",CrmTags.mergedTagid="",CrmTags.mergeTagOldName="",CrmTags.mergeTagMainName="",CrmTags.moduleName="",CrmTags.mergeTagName="",CrmTags.recordCount="-1",CrmTags.updatedName="",Crm.isActivitySplitDone&&CrmTags.tableObj&&(CrmTags.tableObj.Tasks="CrmTask",CrmTags.tableObj.Calls="CrmCall",CrmTags.tableObj.Events="CrmEvent"),null!==CrmTags.editTagTr&&(CrmTags.editTagTr=null)},CrmTags.handleCancel=function(e){crmui.hidePopup(e),CrmTags.init()},CrmTags.showPopup=function(e){Crm.trackSpotLightAction("Tagging - Manage Tags Add New Tag Click",{Module:CrmTags.currentModule}),crmui.showPop(e);var t=$("#"+e);$("#addTag").val("").focus(),$("#addedElements").empty(),t.find(".addedTags").click((function(){$("#addTag").focus()}))},CrmTags.handleManagePopup=function(e){switch(e){case"cancel":crmui.hidePopup("addtagManagePop"),CrmTags.newTags=[],$("#addTag").val(""),$("#addedElements").html(""),Crm.trackSpotLightAction("Tagging - Manage Tags Cancel");break;case"save":var t=$("#addedElements .createdTag"),a=$("#addtagManagePop .addTag"),r=a.val(),i=CrmTags.editionLimit,n=CrmTags.usedNames.length+CrmTags.newTags.length;if(n>i)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),I18n.getMsg("crm.label.small.tags"),!1),a.focus(),!1;if(0===t.length&&(!r||""===r))return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.enter.one.name"),I18n.getMsg("crm.label.small.tags"),!1),a.focus(),!1;if(""!==r){if((r=r.trim()).length<1)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.invalid.tag.name"),"",!1),a.focus(),!1;if(!CrmTags.checkCharacter(r))return a.focus(),!1;if(r.length>25)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.max.len.reached"),I18n.getMsg("crm.label.small.tags"),!1),a.focus(),!1;if(!CrmTags.checkNames(r))return renderingUtils.showCustomAlert(I18n.getMsg("crm.label.tag.exists"),I18n.getMsg("crm.label.small.tags"),!1),a.focus(),!1;if(n+1>i||CrmTags.newTags.length+1>100)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),I18n.getMsg("crm.label.small.tags"),!1),a.focus(),!1}var l=[],o={},s=CrmTags.currentModule;if(t&&t.length>0)for(var d=t.length,c=0;c<d;c++){var m=t.eq(c).text();if(m.length>25)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.max.len.reached"),I18n.getMsg("crm.label.small.tags"),!1),!1;(o={}).name=m,l.push(o)}r&&""!==r&&((o={}).name=r,l.push(o));var u={};u.tags=l;JSON.stringify(u);var C=new crmRequestPool,p={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};C.initiate({action:"/crm/v2/settings/tags?module="+moduleRecordMapping[s].api_name+"&manage="+!0,type:"post",data:JSON.stringify(u),headers:p,success:function(e){store.unloadAll("tag"),crmui.hidePopup("addtagManagePop"),$("#addTag").val(""),$("#addedElements").html(""),CrmTags.moduleName=s,CrmTags.validateSymbol(e),CrmTags.showSuccessMsgAndContructRows(e),CrmTags.init(),CrmTags.newTags=[],crmTab.deleteFromCache(s)},error:function(){crmui.hidePopup("addtagManagePop"),renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.unable.to.process"),I18n.getMsg("crm.label.small.tags"),!1),CrmTags.init(),CrmTags.newTags=[]}}),Crm.trackSpotLightAction("Tagging - Manage Tags Save",{Module:s,Count:l.length})}},CrmTags.saveNewTags=function(e){var t=$("#addTag"),a=t.val(),r=e.keyCode;if(a&&a.length>25)return setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.max.length"),I18n.getMsg("crm.label.small.tags"),!1)}),100),!1;if((188===r&&"<"===e.key||190===r&&">"===e.key)&&e.preventDefault(),a||188!==r||e.preventDefault(),13!==r&&188!==r||""===a){if(188===r&&""===a)e.preventDefault();else if(8===r&&""===a){var i=$("#addedElements .createdTag").last();t.val(i.attr("data-id")).focus(),i.find("b").trigger("click")}}else{if(a=a.trim(),!CrmTags.checkCharacter(a))return setTimeout((function(){t.val(a).focus()}),100),!1;if(a.length<1)return setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.invalid.tag.name"),"",!1)}),100),e.preventDefault(),!1;var n=CrmTags.editionLimit;if(CrmTags.usedNames.length+CrmTags.newTags.length>=n||CrmTags.newTags.length>=100)return setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),I18n.getMsg("crm.label.small.tags"),!1)}),100),e.preventDefault(),!1;if(CrmTags.checkNames(a)){t.val("").focus();var l=$("#addedElements"),o=$("<span></span",{class:"createdTag fL crm-small-font-size dIB pT1 pR5 pB1 pL5 br_border1 br2 mT7 mL5 crmBaseColor","data-id":a,text:a}).appendTo(l);$("<b></b>",{class:"ico-close-small dIB cP m0 mL4 svgIcons",onClick:"CrmTags.closeThis(this)"}).appendTo(o),l.removeClass("dN"),CrmTags.newTags.push(a)}else setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.label.tag.exists"),"",!1)}),100);e.preventDefault()}},CrmTags.checkNames=function(e){for(var t=CrmTags.newTags.length,a=0;a<t;a++)if(CrmTags.newTags[a].toLowerCase()===e.toLowerCase())return!1;t=CrmTags.usedNames.length;for(a=0;a<t;a++)if(CrmTags.usedNames[a].toLowerCase()===e.toLowerCase())return!1;return!0},CrmTags.showSuccessMsgAndContructRows=function(e){for(var t=e.tags,a=!1,r=!1,i=!1,n=0,l={},o=t.length,s=$("#tableRow tbody"),d=0;d<o;d++)"symbols are not allowed"===t[d].message&&(i=!0),t[d].message.indexOf("tags created successfully")>-1?((l={}).details=CrmTags.processData(t[d].details),l.details.modulename=CrmTags.moduleName,l.addClass=!0,s.append(Handlebars.templates.manageTags(l)),n++):t[d].code.indexOf("LICENSE_LIMIT_EXCEEDED")>-1?(r=!0,a=!0):a=!0;if(a)i||renderingUtils.showCustomAlert(I18n.getMsg("crm.tags.add.unsuccessful"),"",!1),r&&$("#custom_alert_button").unbind("click").one("click",(function(){hideAnimatePopup("custom_alert_popup"),Utils.windowLocationReload()}));else{crmui.showMsgBand("success",I18n.getMsg("crm.tags.manage.page.added.successfully"),"4000","");var c=$(".tagline");c.is(":visible")||($("#blank_state").hide(),$(".tagline_blank").hide(),c.show(),$(".setupsearchicon").parent("div").show(),$("#customLinkFirstBtn").parent("div").show(),$("#tableRow").show())}var m=$("#usedTagCountLabel"),u=parseInt(m.text())+n;CrmTags.usedTagCount=u,m.text(u),CrmTags.bindorUnbindEvents("add"),CrmTags.scrollTable(),CrmTags.scrollToNewTag()},CrmTags.scrollToNewTag=function(){var e=$("#manageTagsBody").find(".indiTag").first().offset().top;$("#tableContent").animate({scrollTop:e},1e3),setTimeout((function(){$("#manageTagsBody .indiTag").removeClass("newTr")}),1e3)},CrmTags.bindorUnbindEvents=function(e){var t=parseInt(CrmTags.editionLimit),a=parseInt(CrmTags.usedTagCount),r=$("#customLinkFirstBtn");"add"===e||"show"===e?a>=t?r.addClass("disableTag").on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.tag.edition.limit.exceeded"),!1,"right",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})).removeAttr("onclick"):r.hasClass("disableTag")&&(r.removeClass("disableTag").on("click",(function(){CrmTags.showPopup("addtagManagePop")})),r.off("mouseover").off("mouseout")):"delete"===e&&a<t&&(r.removeClass("disableTag").on("click",(function(){CrmTags.showPopup("addtagManagePop")})),r.off("mouseover").off("mouseout"))},CrmTags.updateTagRow=function(e,t){var a=e.tags;if(a[0].message.indexOf("tags updated successfully")>-1||a[0].message.indexOf("tags merged successfully")>-1){var r=a[0].details;r.name=void 0!==t?CrmTags.updatedName:CrmTags.mergeTagMainName,r=CrmTags.processData(r);var i=null;void 0===t?(i=$("tr#"+CrmTags.mergedTagid),CrmTags.usedNames.contains(CrmTags.mergeTagOldName)&&CrmTags.usedNames.splice(CrmTags.usedNames.indexOf(CrmTags.mergeTagOldName),1)):(i=$(t).closest("tr"),CrmTags.usedNames.contains(CrmTags.mergeTagOldName)&&CrmTags.usedNames.splice(CrmTags.usedNames.indexOf(CrmTags.mergeTagOldName),1)),i.attr("id",r.id),i.find(".manageTagAnchor").text(r.name).show(),i.find("input").hide();var n=i.find("div.modifiedUser"),l=n.find("img");l&&l.length>0?i.find("img").attr("src",r.modified_by.img_src):($("<img>",{src:r.modified_by.img_src}).appendTo(n),n.find("i").remove());var o=i.find("td.moduleName");o.find("span.modtime").text(r.modified_time),o.find("div.toolTip span").text(r.modified_by.tooltip),i.find(".editInfo").slideUp(),i.find(".tagEditSave").removeClass("dIB").addClass("dN").attr("data-pos","0"),i.find(".tagEditDel").removeClass("dN"),a[0].message.indexOf("tags updated successfully")>-1&&crmui.showMsgBand("success",I18n.getMsg("crm.tags.manage.page.updated.successfully"),"4000","")}else renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"),I18n.getMsg("crm.label.small.tags"),!1)},CrmTags.closeThis=function(e){var t=$(e).closest("span");CrmTags.newTags.contains(t.text())&&CrmTags.newTags.splice(CrmTags.newTags.indexOf(t.text()),1),t.remove()},CrmTags.mergeTag=function(){var e=[],t={},a={},r=CrmTags.currentModule;t.conflict_id=CrmTags.mergedTagid,e.push(t),a.tags=e;var i=new crmRequestPool,n="/crm/v2/settings/tags/"+CrmTags.mergeTagid+"/actions/merge",l={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};i.initiate({action:n,type:"post",headers:l,data:JSON.stringify(a),success:function(e){if("object"==typeof e)if(e.tags[0].status.indexOf("success")>-1){$("#"+CrmTags.mergeTagid).remove(),CrmTags.updateTagRow(e,void 0),crmui.hidePopup("MergeOption"),crmui.showMsgBand("success",I18n.getMsg("crm.tags.merged.successfully"),"4000","");var t=$("#usedTagCountLabel"),a=parseInt(t.text())-1;CrmTags.usedTagCount=a,t.text(a),CrmTags.bindorUnbindEvents("delete"),Crm.trackSpotLightAction("Tagging - Manage Tags Merged",{Module:CrmTags.currentModule}),store.unloadAll("tag")}else e.tags[0].code.indexOf("INVALID_DATA")>-1?(crmui.hidePopup("deleteOption"),renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"),I18n.getMsg("crm.label.small.tags"),!1),CrmTags.init()):e.tags[0].code.indexOf("NO_PERMISSION")>-1&&(crmui.hidePopup("deleteOption"),renderingUtils.displayPermissionDenied(),renderingUtils.freezeBackground());CrmTags.init(),crmTab.deleteFromCache(r)},error:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"),I18n.getMsg("crm.label.small.tags"),!1),CrmTags.init()}})},CrmTags.doDelete=function(){var e=new crmRequestPool,t="/crm/v2/settings/tags/"+CrmTags.deleteTagId,a={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};e.initiate({action:t,type:"delete",headers:a,success:function(e){var t=e.tags[0];if(crmui.hidePopup("deleteOption"),t.status.indexOf("success")>-1){var a=$("tr#"+CrmTags.deleteTagId);CrmTags.usedNames.splice(CrmTags.usedNames.indexOf(a.find("td .manageTagAnchor").text()),1),a.hide("slow").remove();var r=$("#usedTagCountLabel"),i=parseInt(r.text())-1;CrmTags.usedTagCount=i,r.text(i),CrmTags.bindorUnbindEvents("delete"),crmui.showMsgBand("success",I18n.getMsg("crm.tags.deleted.successfully"),"2500","");var n=$(".tagline");n.is(":visible")&&"0"===i&&($("#blank_state").show(),$(".tagline_blank").show(),n.hide(),$(".setupsearchicon").parent("div").hide(),$("#customLinkFirstBtn").parent("div").hide(),tableRowObj.hide()),crmTab.deleteFromCache(CrmTags.currentModule)}else crmui.showMsgBand("error",I18n.getMsg("crm.tags.delete.unsuccessful"),"4000","");CrmTags.init(),Crm.trackSpotLightAction("Tagging - Manage Tags Deleted",{Module:CrmTags.currentModule}),store.unloadAll("tag")},error:function(e){CrmTags.deleteTagId="",crmui.hidePopup("deleteOption"),e&&e.responseJSON&&e.responseJSON.message&&e.responseJSON.message.indexOf("permission denied")>-1?(renderingUtils.displayPermissionDenied(e),renderingUtils.freezeBackground()):renderingUtils.showCustomAlert(I18n.getMsg("crm.unable.to.process.request"),I18n.getMsg("crm.label.small.tags"),!1),CrmTags.init()}})},CrmTags.processData=function(e){var t=Crm.getUserDetailsMap();if(e.modified_by){var a=t[e.modified_by.id];a&&(e.modified_by.img_src=a.avatar)}CrmTags.usedNames.contains(e.name)||CrmTags.usedNames.push(e.name);var r,i,n,l,o=null,s=null,d=null;return(d=(s=e.modified_time).substring(s.length-6).split(":"))[0].substring(0,1),d[1]=parseInt(d[1]),r=(o=new Date(s.substr(0,s.length-6))).getMonth(),i=o.getDate(),n=o.getFullYear(),l=Utils.getTimeStringWithAmPm(o),e.modified_time=I18n.getMsg(CrmTags.month[r])+" "+i+" , "+n,"HH:mm"!==Crm.userDetails.TIME_FORMAT?e.modified_by.tooltip=I18n.getMsg("crm.label.tags.modified.tooltip2",[e.modified_by.name,I18n.getMsg(CrmTags.shortMonth[r]),i,n,l.hrs,l.mins,l.meridiem]):e.modified_by.tooltip=I18n.getMsg("crm.label.tags.modified.tooltip1",[e.modified_by.name,I18n.getMsg(CrmTags.shortMonth[r]),i,n,l.hrs,l.mins]),e},CrmTags.processSelector=function(e){var t="wfAddTags"===e?"wfAddTagsDiv":"tagConfig";"bluePrint_AddtagSelect"===e?t="bluePrintAddTagsDiv":"detailViewSelect"===e&&(t="tagui");var a=I18n.getMsg("crm.tags.separate.info");"tagui"===t||"bluePrintAddTagsDiv"===t||"wfAddTagsDiv"===t?a=I18n.getMsg("crm.label.listView.add.tags.info"):"importTagFieldId"===e&&(a="");var r=$("#"+e),i=$("#"+t),n=r,l=Crm.userDetails.RTL_ENABLED?"rtl":"ltr";r.select2({dir:l,tags:!0,tokenSeparators:[","],placeholder:a,closeOnSelect:!1,createTag:function(e){var t=$(".select2-results__options");t.show();var a=$.trim(e.term);return""===a?null:(a&&(a=(a=a.substr(0,25)).replace("<",""),n.find("input.select2-search__field").val(a)),","===a?($("input.select2-search__field").val("").focus,t.hide(),null):CrmTags.checkExistingNames(a,!1,!1,!0)?{id:a,text:$ESAPI.encoder().encodeForHTML(a),tagName:a,newTag:!0}:(t.find("span.crm-extra-small-font-size").hide(),null))},templateResult:function(e){return e.newTag?"<span class='crmNotFoundColor mR5 crm-extra-small-font-size'>"+I18n.getMsg("crm.label.tag.new")+"</span><span id='select2NewTagSpan'>"+e.text+"</span>":(e.tagName=e.text,$ESAPI.encoder().encodeForHTML(e.text))},escapeMarkup:function(e){return e}}).on("select2:open",(function(){$("#maindiv").css({overflow:"hidden"})})).on("select2:close",(function(){var e=$("#maindiv");e.css({overflow:"auto"}),e.off("scroll")})).on("select2:select",(function(a){var r=$("#"+t);if("tagui"===t||"wfAddTagsDiv"===t){var i=a.params.data.tagName;if(i&&i.length>25)return r.find('li.select2-selection__choice[title="'+i+'"]').find("span").trigger("click"),setTimeout((function(){r.find(".select2-search__field").val(i)}),0),!1;"tagui"===t&&($("#tagInputButtonsDiv").find(".saveButton").removeAttr("disabled").addClass("cP").removeClass("cA").css("opacity","1"),detailView.changeMarginForSelect2()),n.select2("close"),n.select2("open")}if("bluePrint_AddtagSelect"===e&&($("#bluePrintTagActionSave").removeAttr("disabled"),n.select2("close"),n.select2("open")),a.params.data.newTag&&!CrmTags.clientJSON.newlyAdded.contains(a.params.data.id)?CrmTags.clientJSON.newlyAdded.push(a.params.data.id):a.params.data.newTag||CrmTags.clientJSON.selectedIds.contains(a.params.data.id)||CrmTags.clientJSON.selectedIds.push(a.params.data.id),CrmTags.checkTagEditionAndRecordLimitCount(a.params.data.newTag,e,CrmTags.clientJSON.tagUsedCount,!1,!1,"tagui"!==t&&"bluePrintAddTagsDiv"!==t))CrmTags.checkCharacter(a.params.data.tagName)?(delete CrmTags.clientJSON.inputVal,r.find(".select2-search__field").val("").focus()):(CrmTags.clientJSON.inputVal1=CrmTags.clientJSON.inputVal,CrmTags.find(r.find("li.select2-selection__choice"),a.params.data.text).find("span").trigger("click"),CrmTags.clientJSON.inputVal=CrmTags.clientJSON.inputVal1,a.params.data.newTag&&setTimeout((function(){r.find(".select2-search__field").val(CrmTags.clientJSON.inputVal)}),0),r.find(".select2-search__field").focus());else if(CrmTags.clientJSON.inputVal1=CrmTags.clientJSON.inputVal,"tagui"!==t&&"bluePrintAddTagsDiv"!==t&&"tagConfig"!==t||!CrmTags.clientJSON.alertType)null!=CrmTags.find(r.find("li.select2-selection__choice"),a.params.data.text)&&(CrmTags.find(r.find("li.select2-selection__choice"),a.params.data.text).find("span").trigger("click"),CrmTags.clientJSON.inputVal=CrmTags.clientJSON.inputVal1,a.params.data.newTag&&setTimeout((function(){r.find(".select2-search__field").val(CrmTags.clientJSON.inputVal)}),200),r.find(".select2-search__field").focus());else if(setTimeout((function(){var e,r=$("#"+t);e="tagConfig"===t?$("li.select2-selection__choice"):r.find("li.select2-selection__choice"),CrmTags.find(e,a.params.data.text).find("span").trigger("click")}),150),"editionCount"===CrmTags.clientJSON.alertType)var l=setTimeout((function(){r.find(".select2-search__field").val(CrmTags.clientJSON.inputVal1),renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),"",!1),$("#custom_alert_button").unbind("click").one("click",(function(){var e=$("#"+t);hideAnimatePopup("custom_alert_popup"),e.find(".select2-search__field").focus()})),clearTimeout(l)}),250);else l=setTimeout((function(){r.find(".select2-search__field").val(CrmTags.clientJSON.inputVal1),renderingUtils.showCustomAlert(I18n.getMsg("crm.tags.records.limit.reached",CrmTags.clientJSON.alertType.split("::")[1]),"",!1),$("#custom_alert_button").unbind("click").one("click",(function(){var e=$("#"+t);hideAnimatePopup("custom_alert_popup"),e.find(".select2-search__field").focus()})),clearTimeout(l)}),250);CrmTags.focusOutEvent(null,o),"wfAddTags"===e&&wfTags.checkTagsRemove("AddTags",n,!1)})).on("select2:unselect",(function(a){"tagui"===t&&($("#tagInputButtonsDiv").find(".saveButton").removeAttr("disabled").addClass("cP").removeClass("cA").css("opacity","1"),detailView.changeMarginForSelect2()),CrmTags.clientJSON.inputVal="","bluePrint_AddtagSelect"===e&&($("#bluePrintTagActionSave").removeAttr("disabled"),n.next("span.select2-container").find("input.select2-search__field").removeAttr("placeHolder")),"wfAddTags"===e&&wfTags.checkTagsRemove("AddTags",n,!0),CrmTags.clientJSON.newlyAdded.contains(a.params.data.tagName)?(CrmTags.clientJSON.newlyAdded.splice(CrmTags.clientJSON.newlyAdded.indexOf(a.params.data.tagName),1),CrmTags.clientJSON.inputVal=a.params.data.tagName):CrmTags.clientJSON.selectedIds.contains(a.params.data.id)&&CrmTags.clientJSON.selectedIds.splice(CrmTags.clientJSON.selectedIds.indexOf(a.params.data.id),1),n.select2("close"),n.select2("open")}));var o=n.next("span.select2-container").find("input.select2-search__field");"bluePrint_AddtagSelect"===e&&o.removeAttr("placeHolder"),o.attr({onkeydown:"CrmTags.checkTagInputVal(event,'"+t+"',false)",onkeyup:"CrmTags.onkeyupevent('"+t+"')",onfocusout:"CrmTags.focusOutEvent(event,this)",maxlength:26}),o.focusin((function(){CrmTags.clientJSON.inputVal=""})),o.addClass("mL5"),"tagConfig"===t&&o.css("width","190px"),i.find("span.select2").css("width","100px")},CrmTags.focusOutEvent=function(e,t){$(t).val(CrmTags.clientJSON.inputVal)},CrmTags.onkeyupevent=function(e){var t=$("#"+e).find("input.select2-search__field").val();CrmTags.clientJSON.inputVal=t},CrmTags.checkTagInputVal=function(e,t,a){var r=$(".detailView_tag_Select .select2-selection__rendered .select2-selection__choice").length,i=null;i=a?$(t).val():$("#"+t).find("input.select2-search__field").val();var n=e.keyCode;if((188===n&&"<"===e.key||190===n&&">"===e.key)&&e.preventDefault(),i||188!==n||e.preventDefault(),!i&&13===n&&r<=0)return e.preventDefault(),!1;if(a)188===n&&e.preventDefault();else{if(i)switch(n){case 188:CrmTags.checkCharacter(i)||e.preventDefault(),CrmTags.checkExistingNames(i,!1,!1,!0)||e.preventDefault();break;case 8:case 39:case 37:break;default:i.length>=25&&e.preventDefault()}"tagui"===t&&($("#tagInputButtonsDiv").find(".saveButton").removeAttr("disabled").addClass("cP").removeClass("cA").css("opacity","1"),13===n&&""===i&&($("#detailViewSelect").select2("close"),detailView.saveTagtoRecord(),CrmTags.clientJSON.inputVal=""))}},CrmTags.checkAndPopulateNewlyAdded=function(e){var t=$("#"+e).find(".select2-search__field"),a=t.val();if(t&&""!==a){if(-1!==(a=a.trim()).indexOf(","))return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.name.invalid.char",r),"",!1),!1;if(a.length<1)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.invalid.tag.name",r),"",!1),!1;if(!CrmTags.checkCharacter(a))return!1;var r=0;customViewObject.tagRecordLimit?r=customViewObject.tagRecordLimit:CrmTags.clientJSON.recordTagCount&&(r=parseInt(CrmTags.clientJSON.recordTagCount));var i=0;if(CrmTags.clientJSON.selectedIds&&(i=CrmTags.clientJSON.selectedIds.length),CrmTags.clientJSON.newlyAdded&&(i+=CrmTags.clientJSON.newlyAdded.length),i>=r)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tags.records.limit.reached",r),"",!1),!1;if(CrmTags.checkExistingNames(a,!1,!1,!0,!0)){var n=0;CrmTags.clientJSON.names?n=CrmTags.clientJSON.names.length:CrmTags.clientJSON.tagUsedCount&&(n=parseInt(CrmTags.clientJSON.tagUsedCount)),CrmTags.clientJSON.newlyAdded&&(n+=CrmTags.clientJSON.newlyAdded.length);var l=0;if(customViewObject.tagLimit?l=customViewObject.tagLimit:CrmTags.clientJSON.editionCount&&(l=parseInt(CrmTags.clientJSON.editionCount)),n>=l)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),"",!1),!1;CrmTags.clientJSON.newlyAdded.push(a)}else{var o=CrmTags.clientJSON.existingNameVsIdMap[a.toLowerCase()];void 0!==o&&(CrmTags.clientJSON.selectedIds.contains(o)||CrmTags.clientJSON.selectedIds.push(o))}}return!0},CrmTags.getRefIdJSONArray=function(e){var t=[],a=CrmTags.clientJSON.value,r=0,i=null,n=[];if(null!==e){var l=CrmTags.clientJSON.nameVsId;r=e.length;for(var o=0;o<r;o++)null!==l[i=e[o]&&null==e[o].id?e[o].toLowerCase():e[o].name.toLowerCase()]&&t.push(l[i])}r=a.length;for(o=0;o<r;o++)i=a[o],t.contains(i)&&n.push(i);r=t.length;for(o=0;o<r;o++)i=t[o],n.contains(i)||n.push(i);return n},CrmTags.getDBFormatValue=function(e){var t="";if(e){t="||";for(var a=e.length,r=0;r<a;r++)t+=e[r]+"||"}return t},CrmTags.scrollTable=function(){var e=renderingUtils.windowHeight,t=$("#tableContent"),a=t.offset(),r=$(".createLayout"),i=r.offset().top,n=$("#wmstoolbar"),l=n.length?n.outerHeight():28,o=e-a.top;t.css("max-height",+o-l+"px"),r.css({"max-height":e-i-l,"box-sizing":"border-box"})},CrmTags.checkPermissions=function(e){var t="Crm_Implied_Tags_";return t+="Deals"===e?"Potentials":e,!Crm.userDetails.permissions||void 0!==Crm.userDetails.permissions[t]&&(void 0===Crm.userDetails.permissions[t]||!1!==Crm.userDetails.permissions[t])},CrmTags.checkCharacter=function(e,t){if(null!==e&&-1===e.indexOf(",")&&-1===e.indexOf(">")&&-1===e.indexOf("<")){for(var a=["`","~","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}","|","\\",'"',"'",":",";","?","/",",","."],r=e.length,i=0,n=a.length,l=0;l<n;l++)e.indexOf(a[l])>=0&&(i+=e.split(a[l]).length-1);return!(r>0&&i>=r)||(setTimeout((function(){!t&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters"))}),200),!1)}return!t&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.need.alphanumeric.characters")),!1},CrmTags.checkExistingNames=function(e,t,a,r,i){var n=[];CrmTags.clientJSON.nameVsId?n=Object.keys(CrmTags.clientJSON.nameVsId):CrmTags.clientJSON.names&&(n=CrmTags.clientJSON.names);if((!a||r)&&e&&n){e=e.toLowerCase();for(var l=n.length,o=0;o<l;o++)if(n[o]&&n[o]===e)return t&&renderingUtils.showCustomAlert(I18n.getMsg("crm.label.tag.exists"),"",!1),!1}if(n=CrmTags.clientJSON.newlyAdded,(a||r)&&e&&n){e=e.toLowerCase();for(l=n.length,o=0;o<l;o++)if(n[o].toLowerCase()===e)return(t||i)&&renderingUtils.showCustomAlert(I18n.getMsg("crm.label.tag.exists"),"",!1),!1}return!0},CrmTags.checkTagEditionAndRecordLimitCount=function(e,t,a,r,i,n){if(r){l=0;if(CrmTags.clientJSON.newlyAdded&&(l+=CrmTags.clientJSON.newlyAdded.length),CrmTags.clientJSON.selectedIds&&(l+=CrmTags.clientJSON.selectedIds.length),l>=CrmTags.clientJSON.recordTagCount)return setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tags.records.limit.reached",CrmTags.clientJSON.recordTagCount),"",!1)}),200),!1;if(e){a=0;if(CrmTags.clientJSON.existingTags&&(a+=Object.keys(CrmTags.clientJSON.existingTags).length),CrmTags.clientJSON.newlyAdded&&(a+=CrmTags.clientJSON.newlyAdded.length),a>=CrmTags.clientJSON.limit)return setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),"",!1)}),200),!1}return!0}a=parseInt(a);var l=0,o=0;customViewObject.tagRecordLimit?o=customViewObject.tagRecordLimit:CrmTags.clientJSON.recordTagCount&&(o=parseInt(CrmTags.clientJSON.recordTagCount));var s=$("#"+t).val();if(s&&(l=s.length),l>o||i&&l>=o)return"importTagFieldId"==t&&l>=o?CrmTags.clientJSON.alertType="recordCount::"+o:n?setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tags.records.limit.reached",o),"",!1)}),200):CrmTags.clientJSON.alertType="recordCount::"+o,!1;var d=void 0!==t&&"addTagsSel"!=t&&"tagImport"!==t&&"wfAddTags"!==t&&"tagWebform"!==t&&"bluePrint_AddtagSelect"!==t&&"importTagFieldId"!=t&&"detailViewSelect"!==t;CrmTags.clientJSON.names&&d?a+=CrmTags.clientJSON.names.length:CrmTags.clientJSON.newlyAdded&&(a+=CrmTags.clientJSON.newlyAdded.length);var c=0;return customViewObject.tagLimit?c=customViewObject.tagLimit:CrmTags.clientJSON.editionCount&&(c=parseInt(CrmTags.clientJSON.editionCount)),!(d&&a>=c||!d&&a>c)||!e||(n?setTimeout((function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.edition.limit.exceeded"),"",!1)}),200):CrmTags.clientJSON.alertType="editionCount",!1)},CrmTags.renderTagUtilityDiv=function(){var e=$("<div></div>",{id:"tagPopups"});return e.html(Handlebars.templates.tagsPopUpUtility()),$("div#show").append(e),e},CrmTags.doListViewOperations=function(){var e=$("#maximumReach");(!e||!e.length>0)&&CrmTags.renderTagUtilityDiv(),customViewObject.isTagFieldVisible?"Activities"===customViewObject.module&&crmListView.arrangeTagActivityFilters():($("#manageTagOp").remove(),$("#manageTagsLink").remove()),customViewObject.isScrollNeeded&&!0===customViewObject.isScrollNeeded&&(customViewObject.shownTagFilter&&setTimeout((function(){$("#"+customViewObject.shownTagFilter).show(),$("#activityRelTo").show()}),50),$("#lv_filter_scroll").animate({scrollTop:0},10))},CrmTags.getCommaSeparatedValue=function(e){for(var t="",a=e.length,r=0;r<a;r++)t+=e[r],r<e.length-1&&(t+=",");return t},CrmTags.getTagNames=function(e){var t=CrmTags.clientJSON.existingNames,a="";if(void 0===t||0===t.length)return a;for(var r=e.length,i=0;i<r;i++)t.contains(e[i])&&(a+=e[i],i<r-1&&(a+=","));return a},CrmTags.checkAndChangeMouseEvents=function(e){var t=isSandboxAcc&&"true"==isSandboxAcc;(Crm.userDetails.ISROMODE||!CrmTags.clientJSON.permission||t)&&(t&&e.attr({onmouseover:"crmui.toolTip_show(this, 'left','"+I18n.getMsg("crm.tags.sandbox.not.supported")+"')",onmouseout:"crmui.toolTip_hide()"}),CrmTags.clientJSON.permission||CrmTags.clientJSON.isWaitingForApproval||e.attr({onmouseover:"crmui.toolTip_show(this, 'left','"+I18n.getMsg("crm.tags.detailview.create.no.permission.msg")+"')",onmouseout:"crmui.toolTip_hide()"}),CrmTags.clientJSON.isInReview&&!CrmTags.clientJSON.isWaitingForApproval&&e.attr({onmouseover:"crmui.toolTip_show(this, 'left','"+I18n.getMsg("crm.reviewprocess.detailview.create.no.permission.msg")+"')",onmouseout:"crmui.toolTip_hide()"}),Crm.userDetails.ISROMODE?e.find("a").removeAttr("onclick").css("cursor","not-allowed"):e.find("a").removeAttr("onclick"))},CrmTags.getTagsArray=function(e){if(e){for(var t=CrmTags.clientJSON.value,a=[],r=t.length,i=0;i<r;i++)null===t[i]||""===t[i]||a.contains(t[i])||a.push(t[i]);return a}},CrmTags.unbindSelectEvent=function(e){var t=$("#"+e);return t.off("select2:select").off("select2:unselect").off("paste"),t.empty(),t},CrmTags.populateOptions=function(e,t,a){for(var r={},i="",n=[],l=a.length,o=CrmTags.clientJSON.existingTags,s=0;s<l;s++){if(null!==o[i=a[s]])$("<option></option>",{text:o[i],value:o[i],id:i}).appendTo(t).attr("selected","selected"),CrmTags.clientJSON.selectedIds.push(o[i]),n.push(i)}l=e.length;for(s=0;s<l;s++)i=(r=e[s]).id,n.contains(i)||$("<option></option>",{text:r.name,value:o[i],id:i}).appendTo(t)},CrmTags.processTagValueAndGetArray=function(e,t){e=CrmTags.getTagsArray(!0);for(var a=[],r={},i=[],n=Crm.jsonSelectValues[t].TAGMODULEREFID,l=n.length,o=0;o<l;o++)i.push(n[o].id);for(var s=e.length,d=0;d<s;d++)r=e[d],i.contains(r)&&a.push(r);return CrmTags.clientJSON.value=a,a},CrmTags.getPostDataForTagsCreation=function(){for(var e=[],t={},a=CrmTags.clientJSON.newlyAdded.length,r=0;r<a;r++)null!==CrmTags.clientJSON.newlyAdded[r]&&CrmTags.clientJSON.newlyAdded[r].length>0&&((t={}).name=CrmTags.clientJSON.newlyAdded[r],e.push(t));var i={};return i.tags=e,JSON.stringify(i)},CrmTags.populateTagsObjectsAfterCreation=function(e,t){for(var a=e.tags,r=a.length,i=null,n=null,l=0;l<r;l++)if(a[l].message.indexOf("tags created successfully")>-1){var o=a[l].details;i=o.name,n=o.id,CrmTags.clientJSON.names.contains(i.toLowerCase())||(CrmTags.clientJSON.names.push(i.toLowerCase()),CrmTags.clientJSON.existingTags[n]=i,CrmTags.clientJSON.existingNameVsIdMap[i.toLowerCase()]=n,CrmTags.clientJSON.selectedIds.push(i),CrmTags.clientJSON.existingNames.push(i),t&&CrmTags.clientJSON.tagIds.push(n))}if(CrmTags.isOrchestration){var s=$L("crm-orchestration-builder").e[0].component;Crm.trackSpotLightAction("Tagging - Workflow Tags Create",{Module:s.currentStateData.module,Count:r})}else CrmTags.isProcessFlow?Crm.trackSpotLightAction("Tagging - ProcessFlow Tags Create",{Module:Lyte.registeredMixins.kiosk_action.module,Count:r}):t?Crm.trackSpotLightAction("Tagging - Workflow Tags Create",{Module:module,Count:r}):Crm.trackSpotLightAction("Tagging - Blueprint Tags Create",{Module:ProcessBuilder.Transition.Module,Count:r})},CrmTags.getTagLinkUrl=function(e,t){var a={};e.tag_name=e.tag_name?e.tag_name:e.name,a=CrmTags.tableObj?CrmTags.tableObj:{Leads:"CrmLeadDetails",Contacts:"CrmContactDetails",Accounts:"CrmAccount",Potentials:"CrmPotential",Deals:"CrmPotential",Quotes:"CrmQuote",Calls:"CrmActivity",Events:"CrmActivity",Tasks:"CrmActivity",Campaigns:"CrmCampaign",Cases:"CrmCase",PriceBooks:"CrmPriceBooks",Vendors:"CrmVendors",Products:"CrmProducts",Solutions:"CrmSolution",SalesOrders:"CrmSalesOrder",PurchaseOrders:"CrmPurchaseOrder",Invoices:"CrmInvoice",Services:"CrmServiceDetails",Appointments:"CrmAppointmentDetails",Bundles:"CrmBundles"},Crm.isActivitySplitDone&&(a.Tasks="CrmTask",a.Calls="CrmCall",a.Events="CrmEvent");var r={field:{}};r.field.id="",r.field.api_name="Tag",r.comparator="equal",r.value=[{id:e.tagId,name:e.tag_name}];var i,n=t;return!t||"Tasks"!==t&&"Calls"!==t&&"Events"!==t||Crm.isActivitySplitDone||(r={group_operator:"AND",group:[r,{comparator:"equal",field:{api_name:"Activity_Type"},value:t}]},t="Activities"),"Deals"===n&&(t=n="Potentials"),"Meetings"===n&&(t=n="Events"),i=void 0!==moduleRecordMapping[t].custom_view&&void 0!==moduleRecordMapping[t].custom_view.id?moduleRecordMapping[t].custom_view.id:moduleRecordMapping[t].cvid,Lyte.Router.getURL({route:"crm.tab.module.custom-view.list",dynamicParams:[t,i],queryParams:{filters:JSON.stringify(r)}})},CrmTags.getSortedTagNamesArray=function(e){var t=[];if(e)for(var a=e.length,r=0;r<a;r++)t.push(e[r]);return t},CrmTags.validateSymbol=function(e){for(var t=!1,a=e.tags.length,r=0;r<a;r++)"symbols are not allowed"===e.tags[r].message&&(t=!0);t&&renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.name.invalid.emoji"),"",!1)},CrmTags.validateSymbol=function(e){for(var t=!1,a=e.tags.length,r=0;r<a;r++)"symbols are not allowed"===e.tags[r].message&&(t=!0);t&&renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.name.invalid.emoji"),"",!1)},CrmTags.find=function(e,t){for(var a=e.length,r=0;r<a;r++)if(e[r].getAttribute("title")==t)return $(e[r])},CrmTags.gettagname=function(e,t){var a=e.lastIndexOf("#");return-1===a&&"tagname"===t?e.replace("null",""):"tagname"===t?e.substring(0,a):e.substring(a)},CrmTags.tooltip_tagcc=function(e){if(void 0===e)return"";var t="";if(!(e.includes(",")||Array.isArray(e)))return e;for(var a,r=(a=Array.isArray(e)?e:e.split(",")).length,i=0;i<r;i++)-1!==a[i].lastIndexOf("#")&&(t=""===t?a[i].substring(0,a[i].lastIndexOf("#")):t+","+a[i].substring(0,a[i].lastIndexOf("#")));return t},CrmTags.gettagsbp=function(e,t,a,r,i){r=!0===r||"true"===r,store.unloadAll("tag"),store.findAll("tag",{module:e,fromPage:"view"}).then((function(n){for(var l=n.length,o={},s={},d={},c=[],m=[],u=[],C=[],p=0;p<l;p++){if(void 0!==(T=n[p].name)){var f=n[p].color_code,g=n[p].id,R={};R.name=T,R.color_code=f,R.id=g,c.push(R),s[g]=f,d[g]=T,o[T]=g,m.push(T)}}var E=0;-1!==t.indexOf(",")?E=(t=t.split(",")).length:void 0!==t&&"null"!==t&&t.length>0&&(E=1);for(p=0;p<E;p++){var v=null,T=d[v=1===E?t:t[p]],F=s[v];void 0!==T&&C.push({name:T,color_code:F,id:v})}var h=0;-1!==a.indexOf(",")?h=(a=a.split(",")).length:void 0!==a&&"null"!==a&&a.length>0&&(h=1);for(p=0;p<h;p++){v=null,F=s[v=1!==h?a[p]:a],T=d[v],v=a[p];void 0!==T&&u.push({name:T,color_code:F,id:v})}var y=n.$.meta.record_limit,_=n.$.meta.allowed_count;Lyte.Component.render("crm-tag-bp",{module:e,tagoptions:c,tagnames:m,selectedaddtag:u,selectedremovetag:C,recordLimit:y,moduleLimit:_,tagnamevstagid:o,isOverwrite:r,disable:r,allowNewTags:!0},i)}))};