store.registerModel("crm_social_interaction",{}),store.registerAdapter("crm_social_interaction",{namespace:"crm/v2/Social/brands/brand_id/",buildURL:function(e,t,r,a,s,o,n){return s=s.replace(e,"interactions"),n&&n.brand_id&&(s=s.replace("brand_id",n.brand_id)),s}}),store.registerSerializer("crm_social_interaction",{payloadKey:function(){return"interactions"},normalizeResponse:function(e,t,r){var a=r;a&&($.each(a.data,(function(e,t){t.id||("twitter"===t.network&&t.interaction_info||"facebook"===t.network&&t.interaction_info)&&(t.id=t.interaction_info.id)})),r={interactions:Lyte.registeredMixins["crm-social-tab"].processFeeds(a.data),meta:a});return r},extractMeta:function(e){if(e.meta)return e.meta}}),store.registerModel("crm_social_post",{user:Lyte.attr("object")},{actions:{like:{},retweet:{},deleteposts:{},deleteComments:{},replyComment:{},composePost:{}}}),store.registerAdapter("crm_social_post",{namespace:"crm/v2/Social/brands/brand_id/network/",buildURL:function(e,t,r,a,s,o,n){return s=s.replace(e,"posts"),n&&n.streams?(s=s.replace("/brands","").replace("brand_id",n.network).replace("network",n.accountId),n.tweetId&&(s=s.replace("posts/","posts/"+n.tweetId+"/"))):"composePost"===o?s=(s=s.replace("brand_id",n.brandid).replace("network/","")).replace("/actions/composePost",""):n&&(s=s.replace("brand_id",n.brand_id).replace("network",n.network),n.cursor&&(s=s+"&cursor="+encodeURIComponent(n.cursor)),n.like?s+=n.like:n.deletePosts?s=s.replace("actions/deleteposts",n.post_id):n.deleteComments?s=s.replace("actions/deleteComments",n.post_id+"/comments/"+n.comment_id):n.postComments?s=s+"/"+n.post_id+"/comments":n.createTicket&&(s=(s=s.replace("Social","social").replace("posts/",""))+"createticket/"+n.post_id)),"action"!==t||n.streams||"like"!==o&&"retweet"!==o||(s=s.replace("actions",n.post_id)),s},methodForRequest:function(e,t,r,a,s){return"like"===s||"retweet"===s?a.method:"deleteposts"===s||"deleteComments"===s?"DELETE":e},processRequest:function(e,t,r,a,s,o,n,i){return"replyComment"===s.actionName?(i=s.url,new Promise((function(e){networkUtils.sendxhr(i,"POST",s.headers,s.fdata).then((function(t){e(t.response)}))}))):void 0}}),store.registerSerializer("crm_social_post",{payloadKey:function(){return"posts"},serialize:function(e,t,r,a){if(a.postComments||a.composePost||a.message){var s=new FormData;return s.append("message",a.message),a.networks&&s.append("networks",a.networks),a.file&&s.append("file",a.file),s}},normalizeResponse:function(e,t,r){var a=r.posts||r.users||r.comments,s=Lyte.registeredMixins["crm-social-tab"];Array.isArray(a)?r={posts:s.processPosts(a).data,meta:r.offset}:r={posts:s.processPosts(a.data).data,meta:{cursor:a.cursor}};return r},extractMeta:function(e){if(e.meta)return e.meta}}),store.registerModel("crm_social_message",{receiver_id:Lyte.attr("string"),message:Lyte.attr("string")}),store.registerAdapter("crm_social_message",{namespace:"crm/v2/Social/brands/brand_id/network",buildURL:function(e,t,r,a,s,o,n){return s=s.replace(e,"message"),n&&!n.personal&&(s=s.replace("brand_id",n.brand_id).replace("network",n.network)),"create"===t&&n&&n.personal?s=(s=s.replace("brands/brand_id/network",n.network+"/"+n.account_id)).replace("message","messages"):"create"===t&&(s=s+"/"+n.id),n.thread_id&&(s=s+"/"+n.thread_id),s=s.replace("message/","messages/")}}),store.registerSerializer("crm_social_message",{payloadKey:function(){return"messages"},normalizeResponse:function(e,t,r){var a=r.messages;if(a){var s=Lyte.registeredMixins["crm-social-integration"];if(!a.data&&a[0])a[0].id||(a[0].id=Math.floor(1e7*Math.random())+1),r={messages:s.processMessageDetail(new Array(a[0].data)).data,meta:a.cursor};else r={messages:s.processMessageDetail(a.data).data,meta:a.cursor}}return r},extractMeta:function(e){if(e.meta)return e.meta},serialize:function(e,t,r,a){if(a.fData){var s=a.fData,o=new FormData;return s.content?o.append("content",s.content):(o.append("message",s.message),s.networks&&o.append("networks",s.networks),s.file&&o.append("file",s.file),s.fileName&&o.append("fileName",s.fileName),s.receiver_id&&o.append("receiver_id",s.receiver_id)),o}return t}},{mixins:["crm-social-integraion"]});
