store.registerModel("assignment_threshold",{id:Lyte.attr("string",{primaryKey:!0}),record_period:Lyte.attr("string"),module:{id:Lyte.attr("string"),api_name:Lyte.attr("string")},default_assignee:{id:Lyte.attr("string"),name:Lyte.attr("string")},exclude_criteria:Lyte.attr("object"),backlog_criteria:Lyte.attr("object"),backlog_period_count:Lyte.attr("number"),restrict_to:Lyte.hasMany("assignment_threshold_userdetails",{serialize:"record"}),latest_restrict:Lyte.attr("array"),active:Lyte.attr("boolean"),created_time:Lyte.attr("string"),created_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},modified_time:Lyte.attr("string"),modified_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},filters:Lyte.attr("object"),allocation_process:Lyte.attr("object")}),store.registerAdapter("assignment_threshold",{namespace:"crm/v5/settings/automation",buildURL:function(e,t,s,r,o,i,n){return o=o.replace("assignment_threshold","assignment_thresholds"),("updateRecord"===t||"createRecord"===t||"deleteRecord"===t)&&n&&n.module&&(o+="?module="+n.module),o},methodForRequest:function(e){return"PATCH"===e?"PUT":e}},{mixins:["crm-assignment-threshold-common"]}),store.registerSerializer("assignment_threshold",{serialize:function(e,t){if("createRecord"===e){t.assignment_threshold.backlog_period_count&&(t.assignment_threshold.backlog={criteria:t.assignment_threshold.backlog_criteria,records_creation_before:{unit:t.assignment_threshold.backlog_period_count,period:"days"}}),delete t.assignment_threshold.backlog_criteria,delete t.assignment_threshold.backlog_period_count;for(var s=t.assignment_threshold.restrict_to.length?t.assignment_threshold.restrict_to.length:0,r=0;r<s;r++)delete t.assignment_threshold.restrict_to[r].pk;var o=this.getRecordPeriodName(t.assignment_threshold.record_period);t.assignment_threshold.record_period=o,delete t.assignment_threshold.id;for(r=0;r<s;r++){(i=t.assignment_threshold.restrict_to[r]).id&&(i.user={id:i.id}),delete i.id,delete i.name,delete i.email,delete i.zuid,delete i.default_assignee,"string"==typeof i.record_allow_count&&(i.record_allow_count=parseInt(i.record_allow_count)),null===i.backlog_allow_count?delete i.backlog_allow_count:"string"==typeof i.backlog_allow_count&&(""===i.backlog_allow_count.trim()?delete i.backlog_allow_count:i.backlog_allow_count=parseInt(i.backlog_allow_count)),i.type="user",delete i.record_assigned_count,delete i.backlog_count,delete i.pk}delete t.assignment_threshold.id}if("updateRecord"===e&&t.assignment_threshold){if(t.assignment_threshold.backlog_criteria&&(t.assignment_threshold.backlog_criteria._delete?(t.assignment_threshold.backlog={},t.assignment_threshold.backlog._delete=!0):t.assignment_threshold.backlog={criteria:t.assignment_threshold.backlog_criteria,records_creation_before:{unit:t.assignment_threshold.backlog_period_count,period:"days"}},delete t.assignment_threshold.backlog_criteria,delete t.assignment_threshold.backlog_period_count),t.assignment_threshold.latest_restrict&&(t.assignment_threshold.restrict_to=t.assignment_threshold.latest_restrict,delete t.assignment_threshold.latest_restrict),t.assignment_threshold.restrict_to){t.assignment_threshold||(t.assignment_threshold={});for(s=t.assignment_threshold.restrict_to?t.assignment_threshold.restrict_to.length:0,r=0;r<s;r++){var i;(i=t.assignment_threshold.restrict_to[r]).id&&(i.user={id:i.id}),delete i.id,delete i.name,delete i.email,delete i.zuid,"string"==typeof i.record_allow_count&&(i.record_allow_count=parseInt(i.record_allow_count)),"string"==typeof i.backlog_allow_count&&(i.backlog_allow_count=parseInt(i.backlog_allow_count)),i._delete&&(i._delete=null),i.type="user",delete i.record_assigned_count,delete i.backlog_count,delete i.pk,delete i.default_assignee,delete i.restriction_id}}if(t.assignment_threshold){if(t.assignment_threshold.record_period){o=t.assignment_threshold.record_period;t.assignment_threshold.record_period=this.getRecordPeriodName(o)}if(t.assignment_threshold.backlog_period){var n=t.assignment_threshold.backlog_period;n&&(t.assignment_threshold.backlog_period=n.toLowerCase())}}}return t.assignment_thresholds=[t.assignment_threshold],delete t.assignment_threshold,t},normalizeResponse:function(e,t,s,r,o,i,n,a){if(("updateRecord"===t||"createRecord"===t)&&o>=200&&o<300){s.assignment_thresholds||(s.assignment_thresholds={});var l=s.assignment_thresholds[0].details.id,d=store.peekRecord("assignment_threshold",r).restrict_to,_=[],h=d?d.length:0;(b=s.assignment_thresholds[0].backlog)&&b.criteria&&(s.assignment_thresholds[0].backlog_criteria=b.criteria,s.assignment_thresholds[0].backlog_period_count=b.records_creation_before.unit);for(var c=0;c<h;c++){var g=d[c].pk;_.push({pk:g})}s.assignment_thresholds={id:l},_.length>0&&(s.assignment_thresholds.restrict_to=_),"createRecord"===t&&this.appendThresholdModuleConfigCount(n.module,1)}if("deleteRecord"===t&&o>=200&&o<300&&this.appendThresholdModuleConfigCount(a.module,-1),("findAll"===t||"findRecord"===t)&&200===o){var m="crm.settings.section.assignment-thresholds.edit-assignment-thresholds"===Lyte.Router.getRouteInstance().transition.info.route,u=!0;"findAll"===t&&m&&(u=!1),"findAll"!==t||n.filters||n.status||(n.module?this.setThresholdModuleConfigCount(n.module,0):this.resetThresholdModuleConfigCount());var f=s&&s.assignment_thresholds?s.assignment_thresholds.length:0;for(c=0;c<f;c++){var p=s.assignment_thresholds[c].module;this.saveModuleObj(p,p.api_name),"findAll"!==t||n.filters||n.status||this.appendThresholdModuleConfigCount(p.api_name,1);var b,y=s.assignment_thresholds[c].record_period;if(y&&(s.assignment_thresholds[c].record_period=this.getRecordPeriodKey(y)),s.assignment_thresholds[c].created_time=Utils.getDateInUsrViewFormat(new Date(s.assignment_thresholds[c].created_time)),s.assignment_thresholds[c].modified_time){var k=new CrmDate(s.assignment_thresholds[c].modified_time);s.assignment_thresholds[c].modified_date=k.getDateInPattern("MMM DD, YYYY")}(b=s.assignment_thresholds[c].backlog)&&b.records_creation_before&&(s.assignment_thresholds[c].backlog_criteria=b.criteria,s.assignment_thresholds[c].backlog_period_count=b.records_creation_before.unit)}var L=[];for(c=0;c<f;c++){var v=s.assignment_thresholds[c].restrict_to;s.assignment_thresholds[c].restrict_to=v;var R=s.assignment_thresholds[c].id,w=s.assignment_thresholds[c].module.api_name,C=s.assignment_thresholds[c].restrict_to?s.assignment_thresholds[c].restrict_to.length:0;if(u)for(var M=0;M<C;M++){var z=s.assignment_thresholds[c].restrict_to[M];z.name=z.user.name,z.id=z.user.id,L.push(z.id),z.email=z.user.email,z.zuid=z.user.zuid,z.restriction_id=R,z.pk=w+""+z.id}}"findRecord"===t&&(this.makeUserAPIRequest(L),s.assignment_thresholds=s.assignment_thresholds[0],s.assignment_thresholds.total_count=s.info.total_count)}if(o&&204===o){"findAll"!==t||n.filters||n.status||(n.module?this.setThresholdModuleConfigCount(n.module,0):this.resetThresholdModuleConfigCount());var A={};return A[e]={},A}return s},payloadKey:function(){return"assignment_thresholds"}},{mixins:["crm-assignment-threshold-common"]}),store.registerModel("assignment_threshold_userdetails",{pk:Lyte.attr("string",{primaryKey:!0}),id:Lyte.attr("string"),name:Lyte.attr("string"),role:Lyte.attr("string"),email:Lyte.attr("string"),type:Lyte.attr("string"),backlog_allow_count:Lyte.attr("string"),record_allow_count:Lyte.attr("number"),record_assigned_count:Lyte.attr("number"),backlog_count:Lyte.attr("number"),default_assignee:Lyte.attr("boolean"),_delete:Lyte.attr("boolean"),module:Lyte.attr("string"),restriction_id:Lyte.belongsTo("assignment_threshold")}),store.registerAdapter("assignment_threshold_userdetails",{namespace:"crm/v2.1/settings/automation/assignment_thresholds/",buildURL:function(e,t,s,r,o,i,n){return"findAll"===t&&n&&n.getAllUsers&&n.restrictionId&&(o=o.replace("assignment_threshold_userdetails",n.restrictionId+"/restrict_to")),o}}),store.registerSerializer("assignment_threshold_userdetails",{normalizeResponse:function(e,t,s,r,o,i,n){if("findAll"===t&&200===o){if(s.restrict_to&&n&&n.module)for(var a=n.module,l=[],d=s.restrict_to.length,_=0;_<d;_++){var h=s.restrict_to[_];h.name=h.user.name,h.id=h.user.id,l.push(h.user.id),h.email=h.user.email,h.zuid=h.user.zuid,h.role=h.user.role?h.user.role.name:null,h.pk=a+""+h.id}return s.restrict_to}if(o&&"204"===o){var c={};return c[e]={},c}return s}},{mixins:["crm-assignment-threshold-common"]});
