Lyte.Component.register("crm-social-integ-outer-template",{_template:'<template tag-name="crm-social-integ-outer-template"> <div class="socInContain" id="socInContain"> <div class="socInContain_main pR"> <div class="intractStart pR" id="intractStart"> <div class="intStartDet pA"> <div class="socialIllustration socInteractionHome mAuto mB20"></div> <div class="aligncenter crmNotFoundColor crm-base-font-size pT5 {{if(started,\'\',\'dN\')}}">{{getI18n("crm.social.integ.perm.start1")}}</div> <template is="if" value="{{permitted}}"><template case="true"> <div class="aligncenter crmBaseColor crm-heading-font-size intractStartTop">{{getI18n("crm.social.integ.perm.social1")}}</div> <div class="aligncenter crmNotFoundColor crm-base-font-size pT5">{{getI18n("crm.social.integ.perm.start1")}}</div> <div class="aligncenter mT10"> <span class="socialImg socAsssNwIcon socAssoTwIcon cP mR5 dIB readOnlyMode" data-zcqa="twitter_add" onclick="{{action(\'addAccounts\',\'twitter\',1)}}"></span> <span class="socialImg socAsssNwIcon socAssoFbIcon cP mR5 dIB readOnlyMode" data-zcqa="facebook_add" onclick="{{action(\'addAccounts\',\'facebook\',2)}}"></span> </div> </template><template case="false"> <div class="aligncenter crmBaseColor crm-heading-font-size intractStartTop {{if(started,\'dN\',\'\')}}">{{getI18n("crm.social.integ.noperm1")}}</div> </template></template> </div> </div> <div id="intract_profiles" class="intract_profiles oH dN"> <div id="socAssociateNws" class="hInherit"> <div class="socAssoNwList fL"> <div id="twitter_leftpanel" class="socAssociatedTw socialProfile"> <template is="if" value="{{twitter}}"><template case="true"> <div class="flexAlignCenter"> <span class="socCirImgLoad"></span> <div class="socTxtLd mL8"> <div class="socImgTextLoading mB10"></div> <div class="socImgTextLoading w65_per"></div> </div> </div> </template><template case="false"> <div class="cP readOnlyMode accessibility-route-elem" data-zcqa="twitter_add" onclick="{{action(\'addAccounts\',\'twitter\',1)}}"> <span class="socialImg socAsssNwIcon socAssoTwOp5Icon dIB"></span> <span class="dIB vaM crm-base-font-size crmNotFoundColor dB mL8" tabindex="0" lt-prop-aria-keydown="true" role="link" aria-label="{{getI18n(&quot;crm.social.button.associate&quot;)}} Twitter">{{getI18n("crm.social.button.associate")}} Twitter</span> </div> </template></template> </div> <div id="facebook_leftpanel" class="socAssociatedFb socialProfile"> <template is="if" value="{{facebook}}"><template case="true"> <div class="flexAlignCenter"> <span class="socCirImgLoad"></span> <div class="socTxtLd mL8"> <div class="socImgTextLoading mB10"></div> <div class="socImgTextLoading w65_per"></div> </div> </div> </template><template case="false"> <div class="cP readOnlyMode accessibility-route-elem" data-zcqa="facebook_add" onclick="{{action(\'addAccounts\',\'facebook\',2)}}"> <span class="socialImg socAsssNwIcon socAssoFbOp5Icon dIB"></span> <span class="dIB vaM crm-base-font-size crmNotFoundColor dB mL8" lt-prop-aria-keydown="true" role="link" tabindex="0" aria-label="{{getI18n(&quot;crm.social.button.associate&quot;)}} Facebook">{{getI18n("crm.social.button.associate")}} Facebook</span> </div> </template></template> <div class="socFbApiInfoOuter dN"> <div class="mB15"> <span class="socialImg socAsssNwIcon socAssoFbIcon dIB"></span><span class="vaM mL10">Facebook</span> </div> <div class="socFbApiInfo aligncenter mT10"> <span class="zcrm_svgIcons socWarningTriIcon dIB mB5"></span> <p class="crmNotFoundColor crm-small-font-size lh18">{{getI18n("crm.leftpanel.facebook.error")}}</p> </div> </div> </div> </div> <div class="socNwSuggList fL {{if(interaction,\'dN\',\'\')}}"> <div id="twitter_infobox" class="socAssoTwList dN"> <div class="socAssoTwTitleSearch clearFix"> <template is="if" value="{{fbAssociated}}"><template case="true"> <span class="zcrm_svgIcons fL socbacktoIcon socialBackToInter mR8 mT5 cP dN" onclick="{{action(\'viewInteractions\',this)}}"></span> </template></template> <span class="fL crm-font-regular crm-subheading-font-size mT3">{{getI18n("crm.social.integ.results.from",\'X\')}}</span> <div class="w45_per fR pR"> <lyte-input class="socAssoSearchInput w100_per" lt-prop-type="text" lt-prop-direction="horizontal" lt-prop-appearance="flat" lt-prop-maxlength="10000" autocomplete="off" lt-prop-id="twitter_searchbox" data-zcqa="twitter_searchbox" onkeyup="{{action(\'searchProfiles\',this,\'twitter\',event)}}" lt-prop-placeholder="{{getI18n(\'crm.social.search.profiles\')}}"></lyte-input> <span class="zcrm_svgIcons socAssoSearchIcn pA top10 right10 op6 cP" onclick="{{action(\'getSearchInfo\',\'twitter\')}}"></span> </div> </div> <div id="twitter_rightpanel" class="socTwSearch pR"> <crm-social-interaction-loading></crm-social-interaction-loading> </div> </div> <div id="facebook_infobox" class="socAssoFbList dN"> <div id="facebook_rightpanel" class="socFbSearch pR"> <crm-social-interaction-loading></crm-social-interaction-loading> </div> </div> </div> <div id="socIntMessage" class="socIntMessage fL {{if(showStreams,\'pR\',\'\')}}"> <template is="if" value="{{showStreams}}"><template case="true"> <div id="socStreams" class="socStreams " style="width:100%;right:0px"> <div class="socStreamFilter pA w100_per"> <div id="socStreamTw" data-zcqa="twitter_streams" class="pB15 pL5 pR5 crm-font-regular crmNotFoundColor fs crm-base-font-size sel mR15 dN vaM cP" onclick="{{action(\'onClick\',\'twitter\',event)}}"><span class="socAsssNwIcon socAssoTwIcon dIB vaM mR5"></span><span class="dIB vaM">{{twitter_name}}</span></div> <div id="socStreamFb" data-zcqa="facebook_streams" class="maxW30per pB15 pL5 pR5 crm-font-regular crmNotFoundColor fs crm-base-font-size dN vaM mR15 cP" onclick="{{action(\'onClick\',\'facebook\',event)}}"><span class="socAsssNwIcon socAssoFbIcon dIB vaM mR5"></span><span class="socStreamUname ellipsistext dIB vaM">{{facebook_name}}</span></div> </div> <div class="socStreamFeeds w100_per"> <div class="socStreamTwFeeds dN" data-attr="Tw"></div> <div class="socStreamFbFeeds dN" data-attr="Fb"></div> </div> </div> </template><template case="false"> <div id="socIntMsgDiv" class="socIntMsgDiv"> <template is="if" value="{{new_social}}"><template case="true"> <lyte-tabs id="socialInteractionNew" class="lyteOuterTab socDetailTabs" lt-prop-hover="lyteOuterTabHover" lt-prop-height="540px" lt-prop-width="100%"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="crmNestedOuterTabHead socDetailTabHead pR profileIds"> <lyte-tab-title lt-prop-id="socInteractions" type="interactions" class="socDetTabTitle crm-font-regular crm-base-font-size" onclick="{{action(\'processEntityDetail\',this,\'related_list\')}}">{{getI18n("crm.nsocial.int.head")}}</lyte-tab-title> <lyte-tab-title lt-prop-id="socMessages" type="messages" class="socDetTabTitle crm-font-regular crm-base-font-size" onclick="{{action(\'processEntityDetail\',this,\'related_list\')}}">{{getI18n("Message")}}</lyte-tab-title> <div class="socDetTitleRightEle pR10 flexAlignCenter fg1 jcFlextEnd"> <div class="socFilDropDown flexAlignCenter mR20"> <span class="dIB vaM crmNotFoundColor">Filter By:</span> <span id="socFilterByBrands" class="socFilList flexAlignCenter mL5 cP pR" onclick="{{action(\'socFilDropDownList\')}}"> <lyte-text id="socSelectedBrand" class="selectedBrand maxW130 crmEllipticText dIB" value="{{brands[0].id}}" lt-prop-value="{{brands[0].name}}"></lyte-text> <span class="zcrm_svgIcons socFilNwArrow mL5 mT2"></span> </span> </div> <div class="socFilNw flexAlignCenter mR20"> <span class="crmNotFoundColor">{{getI18n("crm.button.mass.show")}}: </span> <span id="socChooseNw" class="socFilTwSel flexAlignCenter mL5 pR cP" data-zcqa="social_network_filter" onclick="{{action(\'socFilNwLists\')}}"> <span class="socFilAll vaM mR5 dIB">{{getI18n("crm.label.all")}}</span> <span class="socialImg socAsssNwIcon socAssoTwIcon dN"></span> <span class="socialImg socAsssNwIcon socAssoFbIcon dN"></span> <span class="zcrm_svgIcons socFilNwArrow mL5 mT2"></span> </span> </div> <lyte-button id="social_streams_button" lt-prop-size="small" lt-prop-class="outlineprimary" onclick="{{action(\'getStreams\',new_social)}}"> <template is="registerYield" yield-name="text">{{getI18n("crm.nsocial.stream")}}</template> </lyte-button> </div> </lyte-tab-head> <lyte-tab-body class="borderNone oH"> <lyte-tab-content id="socInteractions" class="hInherit bg_white"> <div class="socIntSection hInherit socInteractionDetAll pR"></div> </lyte-tab-content> <lyte-tab-content id="socMessages" class="hInherit bg_white"> <div class="socMsgSection hInherit socMessagesDetAll pR dN"></div> </lyte-tab-content> </lyte-tab-body> </template> </lyte-tabs> </template></template> </div> </template></template> <div id="socIntDetView" class="socIntDetView pR hInherit dN"></div> <div id="socMsgDetView" class="socMsgDetView pR dN hInherit"></div> </div> <div class="cBoth"></div> </div> </div> </div> </div> <lyte-popover lt-prop-origin-elem="#socChooseNw" lt-prop-wrapper-class="socDetFilterPop" lt-prop-show="{{lbind(showFilterNetwork)}}" lt-prop-width="auto" lt-prop-height="auto" lt-prop-content-padding="5px 10px" lt-prop-placement="bottomRight" lt-prop-duration="100" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-scrollable="true" lt-prop-prevent-focus="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div id="socFilNwLists"> <ul class="socChooseNwLists m0 p0 clearFix"> <li class="socDetNwFilterLi"><span class="dIB vaM crm-base-font-size crm-font-bold crmNotFoundColor cP mT1 mR5 socDetNwFilterAll selectedNetwork" data-zcqa="social_network_filter_all" data-attr="All" network="all" onclick="{{action(\'socNwFilter\',this,\'all\',new_social)}}">{{getI18n("crm.label.all")}}</span></li> <li id="twitter_integ_filter" class="socDetNwFilterLi networkClass {{if(twAssociated,\'\',\'dN\')}}"><span data-zcqa="social_network_filter_twitter" class="socialImg socAsssNwIcon socAssoTwIcon dIB" network="twitter" data-attr="Tw" onclick="{{action(\'socNwFilter\',this,\'twitter\',new_social)}}"></span></li> <li id="facebook_integ_filter" class="socDetNwFilterLi networkClass {{if(fbAssociated,\'\',\'dN\')}}"><span data-zcqa="social_network_filter_facecbook" class="socialImg socAsssNwIcon socAssoFbIcon dIB" data-attr="Fb" network="facebook" onclick="{{action(\'socNwFilter\',this,\'facebook\',new_social)}}"></span></li> </ul> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-origin-elem="#socFilterByBrands" lt-prop-wrapper-class="socDetFilterPop" lt-prop-show="{{lbind(showFilterBrands)}}" lt-prop-width="190px" lt-prop-max-height="190px" lt-prop-content-padding="5px 0" lt-prop-placement="bottomRight" lt-prop-duration="100" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-scrollable="true" lt-prop-prevent-focus="true" on-before-show="{{method(\'setCurrentBrandName\')}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <template is="for" items="{{brands}}" item="brand" index="index"> <lyte-radiobutton class="socRadioBtn socDetBrandFilterRadio socAddLead socAddAs dB mR0 socFilterBrandsRadio" lt-prop-type="primary" lt-prop-name="socFilterBrands" lt-prop-label="{{brand.name}}" lt-prop-value="{{brand.id}}" on-checked="{{method(\'connectionBrandChange\',this,brand.id)}}" lt-prop-checked="{{if(ifEquals(index,0),\'true\',\'false\')}}"></lyte-radiobutton> </template> </lyte-popover-content> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1,1,1,1,3]},{type:"text",position:[1,1,1,1,3,0]},{type:"attr",position:[1,1,1,1,5]},{type:"if",position:[1,1,1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"text",position:[3,0]},{type:"attr",position:[5,1]},{type:"attr",position:[5,3]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,3,1,1,1,1]},{type:"if",position:[1,1,3,1,1,1,1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[1,1,3,1,1,3,1]},{type:"if",position:[1,1,3,1,1,3,1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"text",position:[1,1,3,1,1,3,3,3,3,0]},{type:"attr",position:[1,1,3,1,3]},{type:"attr",position:[1,1,3,1,3,1,1,1]},{type:"if",position:[1,1,3,1,3,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"text",position:[1,1,3,1,3,1,1,3,0]},{type:"attr",position:[1,1,3,1,3,1,1,5,1]},{type:"componentDynamic",position:[1,1,3,1,3,1,1,5,1]},{type:"attr",position:[1,1,3,1,3,1,1,5,3]},{type:"componentDynamic",position:[1,1,3,1,3,1,3,1]},{type:"componentDynamic",position:[1,1,3,1,3,3,1,1]},{type:"attr",position:[1,1,3,1,5]},{type:"attr",position:[1,1,3,1,5,1]},{type:"if",position:[1,1,3,1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,1,0]},{type:"attr",position:[1,1,3]},{type:"text",position:[1,1,3,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1,3]},{type:"attr",position:[1,5,1,3,1]},{type:"componentDynamic",position:[1,5,1,3,1]},{type:"text",position:[1,5,3,1,0]},{type:"attr",position:[1,5,3,3]},{type:"text",position:[1,5,3,3,1,0]},{type:"attr",position:[1,5,5]},{type:"registerYield",position:[1,5,5,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,5]},{type:"componentDynamic",position:[1]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1,1,0]},{type:"text",position:[1,1,1,1,0,0]},{type:"attr",position:[1,1,1,3]},{type:"attr",position:[1,1,1,3,0]},{type:"attr",position:[1,1,1,5]},{type:"attr",position:[1,1,1,5,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]}],_observedAttributes:["brands","facebook","new_social","showStreams","twitter","permitted","login","module","id","streamsOnly","pingsEnabled","source","record_id","SOCIALPROFILES","SOCIALPROFILES_BY_BRANDS","entity_info","first_name","last_name","entity_name","entity_id","started","interaction","dontHighlightSearch","personalReauthAcc","personalAcc","brandPages","accIdVsPerm","allAccounts","integPermission","socialAdmin","showFilterBrands","showFilterNetwork","marking_id","currentBrandId"],data:function(){return{brands:Lyte.attr("array"),facebook:Lyte.attr("boolean"),new_social:Lyte.attr("boolean"),showStreams:Lyte.attr("boolean",{default:!1}),twitter:Lyte.attr("boolean"),permitted:Lyte.attr("boolean"),login:Lyte.attr("boolean"),module:Lyte.attr("string"),id:Lyte.attr("string"),streamsOnly:Lyte.attr("boolean"),pingsEnabled:Lyte.attr("boolean"),source:Lyte.attr("string"),record_id:Lyte.attr("string"),SOCIALPROFILES:Lyte.attr("object"),SOCIALPROFILES_BY_BRANDS:Lyte.attr("object"),entity_info:Lyte.attr("object"),first_name:Lyte.attr("string"),last_name:Lyte.attr("string"),entity_name:Lyte.attr("string"),entity_id:Lyte.attr("string"),started:Lyte.attr("boolean"),interaction:Lyte.attr("boolean"),dontHighlightSearch:Lyte.attr("boolean"),personalReauthAcc:Lyte.attr("array"),personalAcc:Lyte.attr("array"),brandPages:Lyte.attr("array"),accIdVsPerm:Lyte.attr("array"),allAccounts:Lyte.attr("array"),integPermission:Lyte.attr("boolean"),socialAdmin:Lyte.attr("boolean"),showFilterBrands:Lyte.attr("boolean",{default:!1}),showFilterNetwork:Lyte.attr("boolean",{default:!0}),marking_id:Lyte.attr("string"),currentBrandId:Lyte.attr("string",{default:""})}},init:function(){"canvas"===this.getData("source")&&this.processSocialData()},fireRequest:function(t){},renderPersonalAccounts:function(t,e){if(Crm.userDetails.isSandbox&&"true"===localStorage.getItem("social_inprogress_"+Crm.userDetails.ZGID))crmui.showMsgBand("error",I18n.getMsg("Zoho Social deployment in progress, please check after deployment is completed."),3e3);else{var s=[];t.showStreams=!t.pingsEnabled;var o=t.brands?t.brands:this.data.brands;if(t.new_social&&$.each(o,(function(t,e){$.each(e.accounts,(function(t,o){if(o.brand.id===e.id)return s.push(e),!1}))})),t.started=!1,s[0]?t.brands=s:(t.login=!0,t.integPermission?t.permitted=!0:t.permitted=!1),$L("#interactions_loading").hide(),"canvas"!==e)Lyte.Component.render("crm-social-integ-outer-template",t,"[ddname=SOCIALPERSONALITY]").setData("showFilterNetwork",!1);else this.setData(t),this.setData("showStreams",!1),this.setData("showFilterNetwork",!1);(s[0]||t.personalAcc)&&($L("#intract_profiles").removeClass("dN"),$L("#intractStart").addClass("dN")),$L(".socTwSearch, .socFbSearch, .socGpSearch").on("scroll",$L.debounce((function(){var t=$L(this);t.scrollTop()>20?t.prev().addClass("scrollShadow"):t.prev().removeClass("scrollShadow")}),300)),this.getAllNetworkInfos();var a=this.getAllAccountsByCriteria("twitter",void 0,3,1),i=[];$.each(a,(function(t,e){1===e.status&&i.push(e.id)})),i.length>0&&(this.showDMSection(i),this.showTweetSection()),(this.data.SOCIALPROFILES?this.data.SOCIALPROFILES.twitter:void 0)||$("#social_streams_button").hide()}},getAllNetworkInfos:function(){var t,e,s=this.data.entity_info?this.data.entity_info.first_name:this.data.first_name;t="canvas"===this.getData("source")?s?s+" "+(this.data.entity_info?this.data.entity_info.last_name:this.data.last_name):this.data.entity_info?this.data.entity_info.last_name:this.data.last_name:$L("#entityName").val();var o=null;"undefined"!=typeof returnJson&&void 0!==returnJson.entMetaData&&(o=returnJson.entMetaData.saltName),o&&(t=t.replace(o,"")),t=t.trim(),this.data.entity_name=t;var a=[];e="canvas"===this.getData("source")?this.data.SOCIALPROFILES.twitter?this.data.SOCIALPROFILES.twitter:"null":$L("#twProfile").val();var i=$L("#subvalue_TWITTER").text();if("null"!==e&&null!==this.getFirstAccountIdByNetwork("twitter"))this.setData("dontHighlightSearch",!0),a.push(e),this.getProfileInfo("twitter",e);else if(""!==i.trim()&&null!==this.getFirstAccountIdByNetwork("twitter"))this.getProfileInfo("twitter",void 0,i);else{this.getSearchInfo("twitter",t,!0),$L("#twitter_searchbox").val(t)}"null"!==(e="canvas"===this.getData("source")?this.data.SOCIALPROFILES.facebook?this.data.SOCIALPROFILES.facebook:"null":$L("#fbProfile").val())&&null!==this.getFirstAccountIdByNetwork("facebook")?(this.setData("dontHighlightSearch",!0),this.getProfileInfo("facebook",e),a.push(e)):(this.getSearchInfo("facebook",t,"user"),$L("#facebook_searchbox").val(t)),"null"===e&&null!==this.getFirstAccountIdByNetwork("facebook")&&$L(".socAssociatedFb").removeClass(),this.data.SOCIALPROFILES&&(this.data.SOCIALPROFILES.twitter||this.data.SOCIALPROFILES.facebook)&&(this.setData("interaction",!0),this.fetchSocialInteractions("all",a.toString()))},getProfileInfo:function(t,e,s,o){if(Crm.userDetails.isSandbox&&"true"===localStorage.getItem("social_inprogress_"+Crm.userDetails.ZGID))crmui.showMsgBand("error",I18n.getMsg("crm.social.deployment.inprogress"),3e3);else{var a=this.getFirstAccountIdByNetwork(t);if(null!==a){var i={network:t,account_id:a,profile_id:e,screenName:s,iscanvasview:o,marking_id:this.data.marking_id},r={network:t,accountId:a};if(void 0!==e)r.profileId=e;else{if(void 0===s)return;var n="Crm_Implied_Edit_"+$L("#module").val();if(!Crm.userDetails.permissions[n]){var c,l=$L("#entityName").val();return"undefined"!=typeof returnJson&&void 0!==returnJson.entMetaData&&(c=returnJson.entMetaData.saltName),c&&(l=l.replace(c,"")),l=l.trim(),void this.getSearchInfo("twitter",l)}s=(s=s.replace(/[^0-9a-z_]/gi,"").trim()).substring(0,15),r.screenName=s}var d=this;store.triggerAction("account","getProfileInfo",r).then((function(t){d.processProfileInfo(i,t)}),(function(t){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(t.response?JSON.parse(t.response):t,"processProfileInfo")}))}}},getSearchInfo:function(t,e,s,o){var a;!0===s&&(a=!0,s=void 0);var i=$L("#"+t+"_searchbox"),r=this.getFirstAccountIdByNetwork(t);if("facebook"!==t)if(void 0===e&&(e=i.val()),e||"twitter"!==t||(e=this.getEntityName()),""!==(e=e.trim())||a){p={network:t,query:e,type:s,cursor:o};var n={network:t,accountId:r,search:"search"},c={query:e};if(s&&(c.type=s),void 0!==o){var l=$L("#"+t+"_search_more");l.find(".showmoreIcon").hide(),l.find(".showmoreLoadIcon").removeClass("dN"),c.offset=o}if(null!==r){if(void 0===o)$L("#"+t+"_leftpanel").empty(),Lyte.Component.render("crm-social-post-loading",{index:[1]},"#"+t+"_leftpanel"),$L("#"+t+"_rightpanel").empty(),Lyte.Component.render("crm-social-post-loading",{index:[1,2,3,4,5],post:!0},"#"+t+"_rightpanel");var d=this;app.store.makeRequest("triggerAction","account","getProfileInfo",n,c).then((function(e){(d.processSearchInfo(p,e),a)&&($L("#"+t+"_rightpanel").empty(),$L("crm-related-list-view")[0].component.getData("isSocialRL")&&i.focus(),i.val(""))}),(function(t){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(t.response?JSON.parse(t.response):t)}))}}else i.focus();else{var p={network:t};this.processSearchInfo(p,{profiles:[],displayNetwork:"Facebook"})}},processSearchInfo:function(t,e){void 0===t.cursor&&this.changeSuggestionLeftPanel(t.network,objectUtils.getLength(e.profiles)),e.network=t.network,e.query=t.query,e.type=t.type,$L("#"+t.network+"_searchbox").val(e.query),void 0===t.cursor?(e.showEmpty=!0,$L("#"+t.network+"_rightpanel").empty()):$L("#"+t.network+"_search_more").empty(),Lyte.Component.render("crm-social-search-info",e,"#"+t.network+"_rightpanel"),this.getData("dontHighlightSearch")||void 0!==t.cursor||this.changeLeftPanel(void 0,t.network)},changeSuggestionLeftPanel:function(t,e){if(null!==this.getFirstAccountIdByNetwork(t)){var s={};switch(s.display_network=t,t){case"twitter":s.display_class="socAssoTw",s.icon="socAssoTwIcon";break;case"facebook":s.display_class="socAssoFb",s.icon="socAssoFbIcon"}s.network=t,s.count=e;var o="#"+t+"_leftpanel";$L(o).empty(),$L(o).length>0&&Lyte.Component.render("crm-social-network-suggest-left",s,o)}},changeLeftPanel:function(t,e){$L(".socTwSearch, .socFbSearch, .socGpSearch").scrollTop(0),"canvas"===Lyte.Router.getRouteInstance().routeName&&$L(".socialActiveInfo").addClass("dN").removeClass("socialActiveInfo");var s=$L("#"+e+"_infobox");s.parent().show(),s.removeClass("dN").addClass("socialActiveInfo"),thirdPartyUtils.titleForEllipsis(".socSearchName"),$L("#socIntMessage").css("display","none")},getEntityName:function(){return $L("crm-detailview-content")[0].component.data.entity_name.trim()},fetchSocialInteractions:function(t,e,s,o){var a=$L("#socFilNwLists");t=t||a.find(".selectedNetwork").attr("network");this.updateSocialObj();var i=this.getProfileIdsForNetwork(t,c);if(i){$L(".profileIds").attr("ids",i);var r=this.data,n=$L(".socialBackToInter"),c=r.networkVsBrandId[this.data.twitter?"twitter":"facebook"]?r.networkVsBrandId[this.data.twitter?"twitter":"facebook"]:r.brands[0].id;$L(".selectedBrand").attr("value",c);var l={profile_ids:e||i};if("all"===t){var d=a.find("li span"),p=$L(".socIntSection .socIntList");$L(".socFilTwSel > span:not(.socFilNwArrow)").addClass("dN").removeClass("dIB"),d.removeClass("op5"),p.show(),$L(".socFilAll").addClass("dIB").removeClass("dN")}var m=$L("#social_int_cursor");if(void 0!==o){l.cursor=o,$L("#social_int_more").empty(),$L("#social_int_more_loading").css("display","inline-block");var f={name:"div",attr:{class:"h20 mT10 mB10"},child:[{name:"img",attr:{src:networkUtils.getImageUrl("social_loading.gif",ResourceConstants.CRM)}}]};$L(m.children().eq(0)).html(renderingUtils.createHTML(f))}else{$L("#intract_pings").html(renderingUtils.createHTML({name:"div",attr:{id:"ks_loading_new",class:"aligncenter socialImg socLoadingIcon",style:"cursor: default;top: 40%;left: 40%;position: absolute;"}}))}$L("#socSelectedBrand").text(r.brandIdVsDetails[c].name);var h={brand_id:c,cursor:o,profile_ids:e,place_type:"related_list",element:"socInteractionDetAll"},u=Lyte.registeredMixins["crm-social-tab"];store.findAll("crm_social_interaction",l,void 0,void 0,{brand_id:c}).then((function(t){t||(t={}),u.renderInteractions(h,t),n.removeClass("dN").addClass("dIB")}),(function(t){u.handleErrorCase(JSON.parse(t.response))}))}},updateSocialObj:function(){var t,e={},s=$L("#fbProfile").val();return"null"!==s&&""!==s&&(e.facebook=s),"null"!==(t="canvas"===this.getData("source")?this.data.SOCIALPROFILES.twitter:$L("#twProfile").val())&&""!==t&&(e.twitter=t),$L("[name='socialobj']").val(JSON.stringify(e)),e},socNwFilter:function(t,e,s,o){t=$L(t);$L(".selectedNetwork").removeClass("selectedNetwork"),t.addClass("selectedNetwork");var a=t.attr("data-attr"),i=$L(".socChooseNwLists"),r=i.find(".socDetNwFilterLi span"),n=$L("#socChooseNw");n.find("span:not(.socFilNwArrow)").addClass("dN").removeClass("dIB");var c=Lyte.registeredMixins["crm-social-tab"];if(s){o||(o=$L(".selectedBrand").attr("value"));var l=i.find(".selectedNetwork").attr("network"),d=this.getProfileIdsForNetwork(l,o);if($L(".profileIds").attr("ids",d),null!==d){var p=$L(".socInteractionDetAll");p.empty(),$L(".socMessagesDetAll").empty(),p.is(":visible")?c.getInteractions(void 0,o,null,void 0,d,"related_list","socInteractionDetAll"):c.getMessagesByProfile(void 0,o,null,d,"related_list")}else{var m=document.createElement("crm-social-posts-new");m.setData({});var f=$L(".socInteractionDetAll");f[0]&&(f[0].innerHTML=""),f.append(m)}$L(".socialBackToInter").removeClass("dN").addClass("dIB")}else this.fetchSocialInteractions(e);"All"===t.attr("data-attr")?(n.find(".socFilAll").removeClass("dN").addClass("dIB"),r.removeClass("op5"),$L(".socFilAll").addClass("dIB").removeClass("dN")):(n.find(".socAsso"+a+"Icon").addClass("dIB").removeClass("dN"),r.addClass("op5"),i.find("li .socAsso"+a+"Icon").removeClass("op5"),$L(".socIntSection").find(".socInt"+a+"List").show()),this.setData("showFilterNetwork",!1)},getProfileIdsForNetwork:function(t,e){var s,o=null;return"canvas"===this.getData("source")?s=this.data.SOCIALPROFILES?this.data.SOCIALPROFILES:this.data.SOCIALPROFILES_BY_BRANDS:(s=JSON.parse($L("#socialobj").val()))||(s=this.data.SOCIALPROFILES_BY_BRANDS?this.data.SOCIALPROFILES_BY_BRANDS:this.data.SOCIALPROFILES),s&&(void 0===s.facebook||"all"!==t&&"facebook"!==t||(o=s.facebook),void 0===s.twitter||"all"!==t&&"twitter"!==t||(o=null!==o?o+","+s.twitter:s.twitter)),o},getNetworkStreams:function(t){$L(".socStreamFeeds").scrollTop(0);var e,s,o=null,a=null;"canvas"===this.data.source?(e=this.data.SOCIALPROFILES.twitter,s=this.data.SOCIALPROFILES.facebook):(e=$L("#twProfile").val(),s=$L("#fbProfile").val());var i=document.createElement("crm-social-post-loading");i.setData({index:[1,2,3,4,5],post:!0}),!e||"all"!==t&&"twitter"!==t||null===this.getFirstAccountIdByNetwork("twitter")?!s||"all"!==t&&"facebook"!==t||null===this.getFirstAccountIdByNetwork("facebook")||(o=$L(".socStreamFbFeeds"),a=$L("#socStreamFb"),0===o.children().length&&this.getPosts(void 0,"facebook",s,void 0,void 0,"streams")):(o=$L(".socStreamTwFeeds"),a=$L("#socStreamTw"),0===o.children().length&&(this.getPosts(void 0,"twitter",e,void 0,void 0,"streams"),o.append(i))),thirdPartyUtils.titleForEllipsis(".socStreamUname"),$L(".socStreamTwFeeds").fadeOut(),$L(".socStreamFilter").find(".sel").removeClass("sel"),null!==o&&(o.fadeIn(),a.addClass("sel")),thirdPartyUtils.titleForEllipsis(".socStreamName")},getNetworkDetailsForStreams:function(){var t={};return this.data.SOCIALPROFILES&&this.data.SOCIALPROFILES.twitter&&(t.twitter=!0,t.twitter_name=$L("#twitter_screen_name").text()),this.data.SOCIALPROFILES&&this.data.SOCIALPROFILES.facebook&&(t.facebook=!0,t.facebook_name=$L("#facebook_name").text()),t.entityName=$L("#entityName").val(),t.entityName=t.entityName.trim(),t},getPosts:function(t,e,s,o,a,i){if(void 0!==t&&(t=$L(t)),a||(a=this.getFirstAccountIdByNetwork(e)),a){var r={profile_id:s},n={network:e,accountId:a,streams:!0};o&&(r.offset=o,this.showMoreLoading(t));var c={network:e,account_id:a,profileId:s,cursor:o,place_type:i,currentEle:t},l=this;"twitter"===e&&store.findAll("crm_social_post",r,void 0,void 0,n).then((function(t){l.processPosts(c,t)}),(function(t){Lyte.registeredMixins["crm-social-tab"].handleErrorCase(t.response?JSON.parse(t.response):t)}))}},processPosts:function(t,e){this.showMoreRemove(t.currentEle);var s=store.peekAll("social_related_list")[0],o={};e&&(o={posts:{data:e,offset:e.$?e.$.meta:void 0}});var a=this;if("twitter"===t.network){var i=this.getAllAccountsByCriteria("twitter",void 0,3,1);$.each(o.posts.data,(function(t,e){a.processTwitterEntities(e)})),objectUtils.getLength(i)>1&&(o.moreTw=!0)}else if("facebook"===t.network){i=this.getAllAccountsByCriteria("facebook",void 0,3,1);objectUtils.getLength(i)>1&&(o.moreTw=!0)}o.account_id=t.account_id,o.profileId=t.profileId,o.place_type=t.place_type,o.info=s.allAccounts[o.account_id],this.renderPosts(t,o)},renderPosts:function(t,e){if("twitter"===t.network){var s=document.createElement("crm-twitter-posts");e.data=e.posts.data;var o=$L(".socStreamTwFeeds");void 0===t.cursor?(e.showEmpty=!0,o[0]&&(o[0].innerHTML="")):$L("#twitterposts_cursor").empty(),s.setData(e),o.append(s),o.removeClass("dN")}thirdPartyUtils.titleForEllipsis(".socStreamName")},stopEvent:function(t){t&&(t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation())},actions:{processEntityDetail:function(t,e){var s=Lyte.registeredMixins["crm-social-tab"],o="",a=$L("socAssoTwIcon").hasClass("dN"),i=$L("socAssoFbIcon").hasClass("dN");if(this.data.SOCIALPROFILES&&this.data.SOCIALPROFILES.twitter&&i)o=this.data.SOCIALPROFILES.twitter;else if(this.data.SOCIALPROFILES&&this.data.SOCIALPROFILES.facebook&&a)o=""!==o?o+","+this.data.SOCIALPROFILES.facebook:this.data.SOCIALPROFILES.facebook;else{var r=$L(".socChooseNwLists"),n=$L(".selectedBrand").attr("value"),c=r.find(".selectedNetwork").attr("network");o=this.getProfileIdsForNetwork(c,n),$L(".profileIds").attr("ids",o)}s.processEntityDetail(t,e,o)},socFilDropDownList:function(){this.setData("showFilterBrands",!0)},addAccounts:function(t){this.stopEvent(event);var e=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/");this.data.socialAdmin?this.data.new_social?networkUtils.openUrl(e+"extensions/social/brands"):networkUtils.openUrl(e+"extensions/social/"+t):this.data.integPermission&&networkUtils.openUrl(e+"personal-settings")},viewInteractions:function(t){t=$L(t);$L("#socAssociateNws .socNwSuggList").hide(),$L("#socIntMessage").show()},searchProfiles:function(t,e,s){if("facebook"!==e){var o,a=$L(t)[0].ltProp("value");if(void 0!==s&&void 0!==s.keyCode){if(13!==s.keyCode)return;this.getSearchInfo(e,a,o,void 0)}else void 0!==s&&this.getSearchInfo(e,a,o,s)}},socNwFilter:function(t,e,s){this.socNwFilter(t,e,s)},socFilNwLists:function(t){this.setData("showFilterNetwork",!0)},getStreams:function(t){sE(event);var e=$L("#show");e.addClass("pR"),$L(".zc-scrollTop").css("z-index","20");var s=this.getNetworkDetailsForStreams(),o=$L("crm-social-streams-outer");if(o&&o.length>0)o[0].component.setData("renderSocialStreams",!0);else{s.new_social=t;var a=document.createElement("crm-social-streams-outer");s.renderSocialStreams=!0,a.setData(s),e.append(a),thirdPartyUtils.titleForEllipsis(".socStreamTitleName, .socStreamFilterName"),this.getNetworkStreams("all")}},getSearchInfo:function(t){this.getSearchInfo(t)}},methods:{connectionBrandChange:function(t,e){var s=$L(".selectedBrand"),o=$L(t).attr("value");o||(o=e),s.attr("value",o);var a=null,i=store.peekAll("social_related_list")[0];$.each(i.brands,(function(t,e){if(e.id===o)return a=e.name,!1})),$L(".socInteractionDetAll").empty(),$L(".socMessagesDetAll").empty(),s.html($ESAPI.encoder().encodeForHTML(a)),thirdPartyUtils.titleForEllipsis(".selectedBrand");var r=$L("#socFilNwLists");this.socNwFilter(r.find(".socDetNwFilterAll"),"All",i.new_social,o),this.setData("showFilterBrands",!1),this.setData("currentBrandId",o)},setCurrentBrandName:function(){if(""===this.data.currentBrandId&&this.data.networkVsBrandId){var t=this.data.networkVsBrandId[this.data.twitter?"twitter":"facebook"]?this.data.networkVsBrandId[this.data.twitter?"twitter":"facebook"]:this.data.brands[0].id;$L(".socDetBrandFilterRadio").each((function(){this.ltProp("value")!==t||this.ltProp("checked",!0)}))}}},processSocialInteraction:function(){var t=this.getData("module"),e=this.getData("record_id");return this.data.entity_id=e,app.store.makeRequest("findAll","social_related_list",void 0,void 0,void 0,{source:"canvas",module:t,entityId:e})},processSocialData:function(){var t=this.data.module,e=this.data.record_id,s=this;this.processSocialInteraction().then((function(o){var a,i=networkUtils.returnDependencyFiles(["crm-social-common-mixins.js","social_related_list_store.js","crm-social-helper.js","social_related_list_store.js","crm-social-related-list-common.js","crm-social-integ-outer-template.js","crm-social-common-models.js","crm-social-setup-models.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM),n=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT).concat(networkUtils.returnDependencyFiles(["crm-social-common.css"],ResourceConstants.CRMClient));if(Crm.userDetails.RTL_ENABLED){var c=networkUtils.returnDependencyFiles(["crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);a=r.concat(n).concat(c).concat(i)}else a=r.concat(n).concat(i);Lyte.injectResources(a,void 0,(function(){0===$L("crm-social-integ-outer-template").length?Lyte.Component.render("crm-social-integ-outer-template",{module:t,id:e},"[ddname=SOCIALPERSONALITY]"):(o.brandParent=[],o.personalAcc=[],o.accIdVsPerm=[],o.networkVsBrandId=[],o.brandIdVsDetails=[],$.each(o.accounts,(function(t,e){"brand"===e.type&&e.status<=1&&!o.networkVsBrandId[e.network]?(o.brandParent[e.network]=e.id,o.networkVsBrandId[e.network]=e.brand?e.brand.id:void 0):"Personal"===e.type&&e.status<=1&&(o.personalAcc[e.network]=e.id),o.accIdVsPerm[e.id]=e.perm_type})),void 0!==o.brands&&$.each(o.brands,(function(t,e){e.accounts&&e.accounts.length>0&&(o.brandIdVsDetails[e.id]=e)})),o.module=t,o.record_id=e,store.unloadAll("social_related_list"),store.pushPayload("social_related_list",Object.assign({},o)),s.processPersonalAccounts(void 0,o,!1,"canvas"))}))}))},showMoreLoading:function(t){var e=t.closest(".showmoreNew");e.find(".showmoreNewLink").addClass("dN"),e.find(".showmoreLoadingImg").removeClass("dN")},showMoreRemove:function(t){var e=$L(".showmoreNew");t&&(e=t.closest(".showmoreNew")),e&&e.length>0&&e[0].remove()}},{mixins:["crm-social-integration","crm-social-tab"]});
