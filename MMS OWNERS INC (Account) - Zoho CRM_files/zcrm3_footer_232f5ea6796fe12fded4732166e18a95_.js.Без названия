var clienttab={browserTabId:Date.now()+"",ismaster:!1,isslave:!1,incall:!1,showAlertBeforeUnload:!1,listener:function(){window.addEventListener("storage",(function(e){null!==e.key&&("MasterTabId"===e.key&&null==localStorage.getItem("MasterTabId")&&(null!=localStorage.getItem("SlaveTabId")?localStorage.getItem("SlaveTabId")==clienttab.browserTabId:clienttab.isslave)?(clienttab.ismaster=!0,localStorage.setItem("MasterTabId",clienttab.browserTabId),localStorage.removeItem("SlaveTabId"),CTIAPI.makeConnection(),clienttab.isslave=!1):clienttab.ismaster||"SlaveTabId"!==e.key||null!=localStorage.getItem("SlaveTabId")?clienttab.ismaster||"SlaveTabId"!==e.key||null==localStorage.getItem("SlaveTabId")||e.newValue==clienttab.browserTabId?"MasterTabId"===e.key&&e.oldValue==clienttab.browserTabId?(clienttab.incall||(CTIAPI.destroyConnection(),clienttab.ismaster=!1),clienttab.isslave=!0,localStorage.setItem("SlaveTabId",clienttab.browserTabId)):e.key.includes("call")&&CTIAPI.trigger_event(e):clienttab.isslave=!1:(localStorage.setItem("SlaveTabId",clienttab.browserTabId),clienttab.isslave=!0))}))},tabinitializer:function(){try{"inbound"==localStorage.getItem("incall")||"outbound"==localStorage.getItem("incall")?(localStorage.setItem("SlaveTabId",clienttab.browserTabId),clienttab.isslave=!0):(localStorage.setItem("MasterTabId",clienttab.browserTabId),clienttab.ismaster=!0),window.addEventListener("unload",(function(){clienttab.ismaster?(null==localStorage.getItem("MasterTabId")&&localStorage.setItem("MasterTabId","0"),localStorage.removeItem("MasterTabId")):clienttab.isslave&&(null==localStorage.getItem("SlaveTabId")&&localStorage.setItem("SlaveTabId","0"),localStorage.removeItem("SlaveTabId")),clienttab.incall&&localStorage.removeItem("incall")})),window.onbeforeunload=function(){if(clienttab.incall||clienttab.showAlertBeforeUnload)return""},clienttab.listener()}catch(e){clienttab.ismaster=!0,murphy.error(e)}}};notifyParentWindow=function(e){var t=e.messageType;if(validationUtils.isNotEmpty(t)&&-1!==Object.keys(messageTypeVsAllowedParentDomains).indexOf(t)){var a=commonUtils.getHeadLessCallbackCode();validationUtils.isNotEmpty(a)&&(e.callbackcode=a);var n,i=messageTypeVsAllowedParentDomains[t],o=i.length;try{n=window.parent.location.href}catch(e){n=document.referrer}for(var r=!1,s=0;s<o;s++){var l=i[s];if(n.startsWith(l)){e=JSON.stringify(e),window.parent.postMessage(e,l),r=!0;break}}!r&&n.startsWith(window.location.origin)&&(e=JSON.stringify(e),window.parent.postMessage(e,window.location.origin))}},notifyChildWindow=function(e){var t=e.messageType;if(validationUtils.isNotEmpty(t)&&-1!==Object.keys(messageTypeVsAllowedParentDomains).indexOf(t)){var a;a=e.featurename?document.getElementsByClassName("childwindow"+e.featurename)[0]:document.getElementById("childwindow_"+e.iframeId);for(var n=!1,i=messageTypeVsAllowedParentDomains[t],o=i.length,r=0;r<o;r++){var s=i[r];if(a&&a.src.startsWith(s)){e=JSON.stringify(e),a.contentWindow.postMessage(e,s),n=!0;break}}!n&&a&&a.src.startsWith(window.location.origin)&&(e=JSON.stringify(e),a.contentWindow.postMessage(e,window.location.origin))}},window.addEventListener("message",(function(e){var t;if((t=e&&"string"==typeof e.data&&validationUtils.IsJsonString(e.data)?JSON.parse(e.data):e&&e.data)&&validationUtils.isJson(t)&&"undefined"!=typeof inputtableMessageTypeVsDetails&&-1!==Object.keys(inputtableMessageTypeVsDetails).indexOf(t.messageType)){if(-1===inputtableMessageTypeVsDetails[t.messageType].allowedDomains.indexOf(e.origin)&&window.location.origin!==e.origin)return;switch(t.messageType){case"fields-value-collector":ctiApiNotifier.saveCallFieldsParamFromFrame(t),WindowsCommunicator.hideChildWindow("callfieldspopup_"+t.callbackcode);break;case"cancel-operation":WindowsCommunicator.hideAllChildWindows("callnotifypopup");break;case"crm-followup-create":ctiApiNotifier.followupListner(t,!0),WindowsCommunicator.hideAllChildWindows("callnotifypopup");break;case"error":ctiApiNotifier.handleFieldsCollectorError(t),WindowsCommunicator.closeAllChildWindows("callnotifypopup");break;case"get-pbcall-info":var a={};"getCallBackParam"===t.action&&(a={data:ctiApiNotifier.getCallBackparam(),action:"setCallBackParam"}),WindowsCommunicator.notifyChild("set-pbcall-info",a,"callnotifypopup");break;case"update-pbcall-info":"updateCallBackParam"===t.action&&(ctiApiNotifier.updateCallBackparam(t.data,t.callbackcode),WindowsCommunicator.hideAllChildWindows("callnotifypopup"));break;case"set-pbcall-info":"setCallBackParam"===t.action&&Calls.resolveWindowsCommunication(t.data);break;case"switch-router-instance":WindowsCommunicator.routerTransition(t.routerData)}}}),!1),window.addEventListener("storage",(function(e,t){switch(e.key){case"call-popup-remove-callfields-link":t=localStorage.getItem(e.key),ctiApiNotifier.removeCallFieldslink(t);break;case"call-popup-update-callfields-data":var a=localStorage.getObject(e.key);ctiApiNotifier.updateCallFieldsData(a);break;case"get-call-back-param":if(t=localStorage.getObject(e.key),!Crm.isHeadless&&t&&(clienttab.isslave||localStorage.getItem("incall")&&clienttab.master)){var n={id:t.id,callBackParam:ctiApiNotifier.getCallBackparam(),followUpData:ctiApiNotifier.followUpData,durationData:{min:$("#ctiapi_calltimer_min").text(),sec:$("#ctiapi_calltimer_sec").text(),Minute:CTIAPI.CallTimer.Minute,Second:CTIAPI.CallTimer.Second,callStartedTimeInMilliSeconds:CTIAPI.CallTimer.callStartedTimeInMilliSeconds,callPausedTimeInMilliSeconds:CTIAPI.CallTimer.callPausedTimeInMilliSeconds},tabId:t.tabId};localStorage.setObject("set-call-back-param",n),setTimeout((function(){localStorage.removeItem("get-call-back-param")}),0)}break;case"set-call-back-param":t=localStorage.getObject(e.key),!Crm.isHeadless&&t&&clienttab.browserTabId===t.tabId&&(ctiApiNotifier.setCallPopupData(t),setTimeout((function(){localStorage.removeItem("set-call-back-param")}),0));break;case"imNotificationMessage":var i=document.querySelector("crm-msg-push-notify");i&&i.setData("removeAll",!0)}}));var WindowsCommunicator={messageTemplate:{getSuccessMsgJson:function(){return{message:"success",status:"saved"}},getCancelledMsgJson:function(){return{message:"close"}},getErrorMsgJson:function(e){return{message:"error",Details:e}},getFieldsCollectorSuccessMsg:function(e){return{message:"success",status:"not_saved",Details:e}},getSuccessMsgWithEntityInfo:function(e){return{message:"success",status:"saved",Details:{module:e.module,recordid:e.id,recordname:e.name}}},getSuccessMsgForFollowUp:function(e){var t=e.module,a=null;-1!==["Events","Tasks","Calls"].indexOf(e.module)&&(t="Activities",a=e.module);var n=Utils.getCurrentDomain()+Crm.getCrmBasePath()+"/tab/"+t+"/"+e.id;return a&&(n=n+"?sub_module="+a),{message:"success",status:"saved",RecordName:e.name,Details:{module:e.module,recordid:e.id,recordname:e.name,recordurl:n}}},getActionMessage:function(e){return{data:e.data,action:e.action}},getUpdateActionMessage:function(e){return{message:"success",data:e.data,action:e.action}},getSwitchRouterInstanceData:function(e){return{routerData:e.routerData}}},notifyParent:function(e,t,a){if(Crm.isHeadless){var n;switch(e){case"fields-value-collector":n=WindowsCommunicator.messageTemplate.getFieldsCollectorSuccessMsg(a);break;case"crm-quick-create":case"crm-associate-search":n=WindowsCommunicator.messageTemplate.getSuccessMsgWithEntityInfo(t);break;case"crm-followup-create":n=WindowsCommunicator.messageTemplate.getSuccessMsgForFollowUp(t);break;case"cancel-operation":n=WindowsCommunicator.messageTemplate.getCancelledMsgJson();break;case"error":n=WindowsCommunicator.messageTemplate.getErrorMsgJson(a);break;case"get-pbcall-info":n=WindowsCommunicator.messageTemplate.getActionMessage(a);break;case"update-pbcall-info":n=WindowsCommunicator.messageTemplate.getUpdateActionMessage(a)}n.messageType=e,notifyParentWindow(n)}},notifyChild:function(e,t,a){var n;switch(e){case"set-pbcall-info":n=WindowsCommunicator.messageTemplate.getActionMessage(t);break;case"switch-router-instance":n=WindowsCommunicator.messageTemplate.getSwitchRouterInstanceData(t)}n.featurename=a,n.messageType=e,notifyChildWindow(n)},notifyOtherTabs:function(e,t){"string"==typeof t?localStorage.setItem(e,t):localStorage.setObject(e,t)},createChildWindow:function(e,t,a){var n=$("#childwindow_"+t.removeSpecialChars());if(n.length>0)n.show();else{var i=document.createElement("iframe");i.setAttribute("src",e),i.setAttribute("id","childwindow_"+t.removeSpecialChars()),i.setAttribute("class","childwindow"+a),i.setAttribute("name","childwindow"),i.style.cssText="border-width:0px; position:fixed; z-index:400; top:0; left:0; width:100%; height:100%;",i.style.visibility="hidden",document.body.appendChild(i),commonUtils.showHideLoadingDiv(!0),i.onload=function(){commonUtils.showHideLoadingDiv(),e.startsWith("/crm")&&$(i.contentDocument.getElementsByTagName("body")[0]).css("background-color","transparent"),i.style.visibility="visible"}}},reopenChildWindow:function(e){var t=$("#childwindow_"+e.removeSpecialChars());return t.length>0&&(t.show(),!0)},hideChildWindow:function(e){$("#childwindow_"+e.removeSpecialChars()).hide()},hideAllChildWindows:function(e){$(".childwindow"+e).hide()},closeAllChildWindows:function(e){$(".childwindow"+e).remove()},switchRouterInstance:function(e,t,a,n){var i=$(".childwindow"+a);i.length<1&&e&&t&&a?this.createChildWindow(e,t,a):(this.notifyChild("switch-router-instance",{routerData:n},a),i.show())},routerTransition:function(e){Lyte.Router.checkIfSameRoute(Lyte.Router.getRouteInstance().transition.info,e)?Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0}):e&&Lyte.Router.replaceWith(e)}},crmPopupUtils={getPrimaryButton:function(e,t,a){return crmPopupUtils.getButtonJson("primarybtn",e,!1,t,a)},getOkButton:function(e,t){return crmPopupUtils.getButtonJson("newgraybtn",I18n.getMsg("crm.button.ok"),!1,e,t)},getCancelButton:function(e,t){return crmPopupUtils.getButtonJson("newgraybtn",I18n.getMsg("crm.button.cancel"),!1,e,t)},getRedButton:function(e,t,a){return crmPopupUtils.getButtonJson("redbtn",e,!1,t,a)},getButtonJson:function(e,t,a,n,i){var o={};return o.class_type=e,o.value=t,o.disabled=a,o.click_text=n,o.attributes=i,o},getHeader:function(e,t,a,n,i){var o={};return o.id=e,o.title=t,o.subtext=a,o.width=n,o.classes=i,o},getFooter:function(e,t){var a={};return a.alignment=e,a.buttons=t,a},getPopUpJson:function(e,t,a){var n={};return n.header=e,n.body=t,n.footer=a,n},removePopup:function(e){renderingUtils.removeFreezeLayer(),$("body").find("#"+e).remove()},showPopup:function(e,t){$("body").append(Handlebars.templates.PopupLayout(t)),crmui.showPopup(e)},hidePopup:function(e){crmui.hidePopup(e)}},eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"==eventMethod?"onmessage":"message";eventer(messageEvent,(function(e){var t=RebrandLinkUtil.getProperty("index_zoho_url");if(t&&t.includes(e.origin)&&e.data.score){var a=e.data,n="https://"+RebrandLinkUtil.getProperty("CRMURL")+"/crm/v2/npssurvey";networkUtils.setCsrfParam(a),$.ajax({type:"POST",url:n,data:e.data})}}),!1),function(){var e=["translate","translateX","translateY","translateZ","scale","scaleX","scaleY","scaleZ","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],t={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#12AA67",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},a=["background","background-color","stroke","border-color","border-bottom-color","border-left-color","border-right-color","border-top-color","color"];this.animate=function(){this.settings={version:"v2.0",element:"",easing:"linear",duration:1e3,elasticity:200,delay:0,stagger:0,transformOrigin:"center",autoPlay:!1,pause:!1,repeat:1,repeatIndex:1,reverse:!1,start:!1,process:!1,complete:!1},this.options=arguments[0];var e=h(this.options);this.options.reverse&&(e=(e=Object.keys(e).map((function(t){return e[t]}))).reverse());this.element=g(e,this.options),this.cssProperty=p(this.options,this.settings),this.eachCSSProp=f(this.element,this.settings,this.cssProperty),this.tween=s(this.eachCSSProp)},animate.prototype.pause=function(){this.tween.forEach((function(e){e.pause=!0,e.from=e.val,e.duration=e.newDuration}))},animate.prototype.seek=function(e){this.progressBar=document.querySelectorAll(e),$(".sliderBar").draggable({axis:"x",containment:"parent"})},animate.prototype.reset=function(){this.tween.forEach((function(e){e.element.style.transformOrigin=null,e.pause=!0;var t=e.element;"css"===e.type?t.style[e.name]=e.from+e.unit:"transform"===e.type?t.style[e.type]=e.name+"("+e.from+e.unit+")":"color"===e.type&&(t.style[e.name]="rgb("+e.from.r+", "+e.from.g+", "+e.from.b+")")}))},animate.prototype.play=function(){var e=this,t=this.tween,a={tArray:[],tVal:[],isCompleted:!1,isStart:!1};t.forEach((function(t){if(t.pause=!1,"transform"===t.type){var i=t.element;if(null==i.style.transform){var o=["-webkit-","-moz-","-ms-"];for(var r in o)void 0!==i.style[o[r]+"transform"]&&(t.prefix=o[r],i.style[t.prefix+"transformOrigin"]=t.transformOrigin)}else t.element.style.transformOrigin=t.transformOrigin,t.prefix=""}t.pause||(t.currentTime=(new Date).getTime()),n(e,t,a)}))};var n=function(e,t,a){var n=t.delay+t.duration;t.start&&!a.isStart&&t.start.call(),a.isStart=!0,window.requestAnimationFrame((function i(){var o=r(t,t.currentTime,t.delay,t.duration,t.easing,t.elasticity);t.ease=o[0];var s=o[1];return t.newDuration=t.duration-s,t.newFrom=t.val,t.pause?(window.cancelAnimationFrame(i),void(t.pause=!1)):(e.seekBar(t,t.ease,a),n<=s?(window.cancelAnimationFrame(i),t.complete&&!a.isCompleted&&t.complete.call(),void(a.isCompleted=!0)):void window.requestAnimationFrame(i))}))};animate.prototype.seekBar=function(e,t,a){var n=a.tArray,i=a.tVal;if("css"===e.type)e.val=e.from+t*(e.to-e.from),e.element.style[e.name]=e.val+""+e.unit;else if("color"===e.type){var o=parseInt(e.from.r+t*(e.to.r-e.from.r)),r=parseInt(e.from.g+t*(e.to.g-e.from.g)),s=parseInt(e.from.b+t*(e.to.b-e.from.b));e.val="rgb("+o+", "+r+", "+s+")",e.element.style[e.name]=e.val}else if("transform"===e.type){var l,d=e.from+t*(e.to-e.from);e.val=d,!I(n,e.name)&&n.push(e.name),d=e.name+"("+d+e.unit+")",i[n.indexOf(e.name)]=d,l=(l=i.join()).replace(/,/g," "),e.element.style[e.prefix+""+e.type]=l}return d};var i,o,r=function(e,t,a,n,i,o){var r=Date.now()-t,s=Math.min(Math.max(r-a,0),n)/n;return[C[i](s,o),r]},s=function(e){var t=[];return e.forEach((function(e){switch(e.type){case"css":e=m(e);break;case"color":e=d(e);break;case"transform":e=l(e)}t.push(e)})),t},l=function(e){var t=e.values;if(R.array(t)){var a=e.name.indexOf("scale")?R.number(t[0])?"px":y(t[0]):"";e=c(e,parseInt(t[0],10),parseInt(t[1],10),a)}else if(R.object(t))if(R.array(t.value)){a=e.name.indexOf("scale")?R.number(t.value[0])?"px":y(t.value[0]):"";e=c(e,t.value[0],t.value[1],a)}else{a=e.name.indexOf("scale")?R.number(t.value)?"px":y(t.value):"";e=c(e,0,parseInt(t.value,10),a)}else{a=e.name.indexOf("scale")?R.number(t)?"px":y(t):"";e=c(e,0,parseInt(t,10),a)}return e},d=function(e){var t=e.values;return e=R.array(t)?c(e,T(t[0]),T(t[1])):R.object(t)?R.array(t.value)?c(e,T(t.value[0]),T(t.value[1])):c(e,T(u(e.element,e.name)),T(t.value)):c(e,T(u(e.element,e.name)),T(t))},m=function(e){var t=e.values;if(R.array(t)){var a=e.name.indexOf("opacity")?R.number(t[0])?"px":y(t[0]):"";e=c(e,parseInt(t[0],10),parseInt(t[1],10),a)}else if(R.object(t))if(R.array(t.value)){a=e.name.indexOf("opacity")?R.number(t.value[0])?"px":y(t.value[0]):"";e=c(e,t.value[0],t.value[1],R.number(t.value[0])?"px":y(t.value[0]))}else{var n=parseInt(u(e.element,e.name),10);a=e.name.indexOf("opacity")?R.number(t.value)?"px":y(t.value):"";e=c(e,n,parseInt(t.value,10),a)}else{n=parseInt(u(e.element,e.name),10),a=e.name.indexOf("opacity")?R.number(t)?"px":y(t):"";e=c(e,n,parseInt(t,10),a)}return e},c=function(e,t,a,n){return e.from=t,e.to=a,!R.undefined(n)&&(e.unit=n),e},u=function(e,t){var a;return t in e.style&&(a=getComputedStyle(e).getPropertyValue(w.camelCase(t))||"0"),a},p=function(e,t){var a={};return Object.keys(e).forEach((function(n){t.hasOwnProperty(n)?t[n]=e[n]:a[n]=e[n]})),e.reverse?t.reverseState=!0:t.reverseState=!1,a},f=function(e,t,a){var n=[];return e.forEach((function(e){Object.keys(a).forEach((function(i){var o=b.object(t),r=a[i];v(o,i,e.target),o.values=r,o.currentTime=0,o.name=i,o.element=e.target,o.duration=R.undefined(r.duration)?t.duration:r.duration,o.easing=R.undefined(r.easing)?t.easing:r.easing,o.elasticity=R.undefined(r.elasticity)?t.elasticity:r.elasticity;var s=R.undefined(r.delay)?t.delay:r.delay;o.delay=R.number(e.stagger)?e.stagger+s:s,n.push(o)}))})),n},v=function(t,n){return I(e,n)?(t.type="transform",t):I(a,n)?t.type="color":t.type="css"},h=function(e){var t=e.element;return"string"==typeof t?document.querySelectorAll(t):t.length?t:[t]},g=function(e,t){for(var a=[],n=e.length,i=0;i<n;i++){var o={};o.target=e[i],o.id=i,o.stagger=i*t.stagger,a.push(o)}return a},C=(i={},o={Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e,t){if(0===e||1===e)return e;var a=1-Math.min(t,998)/1e3,n=e/1-1,i=a/(2*Math.PI)*Math.asin(1);return-Math.pow(2,10*n)*Math.sin((n-i)*(2*Math.PI)/a)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){return 1/Math.pow(4,-1)-7.5625*Math.pow(NaN-e,2)}},["Quad","Cubic","Quart","Quint","Expo"].forEach((function(e,t){o[e]=function(e){return Math.pow(e,t+2)}})),Object.keys(o).forEach((function(e){var t=o[e];i["easeIn"+e]=t,i["easeOut"+e]=function(e,a){return 1-t(1-e,a)},i["easeInOut"+e]=function(e,a){return e<.5?t(2*e,a)/2:1-t(-2*e+2,a)/2}})),i.linear=function(e){return e},i),b={object:function(e){var t={};return Object.keys(e).forEach((function(a){t[a]=e[a]})),t}},w={camelCase:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},array:function(e){return R.array(e)?e:e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e]}},y=function(e){return/([\+\-]?[0-9|auto\.]+)(%|px|pt|em|rem|in|cm|mm|ex|pc|vw|vh|deg)?/.exec(e)[2]},I=function(e,t){return e.some((function(e){return e===t}))},L=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}},T=function(e){if(t.hasOwnProperty(e))return L(t[e]);if(R.rgb(e)){var a=e.match(/\d+/g);return{r:parseInt(a[0]),g:parseInt(a[1]),b:parseInt(a[2])}}return R.rgba(e)?e:R.hex(e)?L(e):void 0},R={array:function(e){return Array.isArray(e)},string:function(e){return"string"==typeof e},object:function(e){return"object"==typeof e},undefined:function(e){return void 0===e},number:function(e){return!isNaN(e)},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},rgba:function(e){return/^rgba/.test(e)},hsl:function(e){return/^hsl/.test(e)},color:function(e){return t.hasOwnProperty(e)||R.hex(e)||R.rgb(e)||R.rgba(e)||R.hsl(e)}}}();var crmSchedulerNotification={fiveSecondsMinimize:null,permenentRemove:null,rollupModule:void 0,rollupStatus:void 0,initDiv:function(e){if(0==$("#schedulerNotificationPopup").length){var t='<div id="schedulerNotificationPopup" class="pFixed schedularProgress-pop schedularOpen"><div class="schedularPop-Header"><h2 class="crm-subheading-font-size pT7 pR10 pB7 pL18 crm-font-regular">';t+=I18n.getMsg(e),t+='<a href="javascript:;" class="dB fR minimizeSchedularPop pR mT5" onclick="crmSchedulerNotification.minimizeSchedularPopup();"></a></h2></div><ul class="m0 pL20 pR20 scheduledList"></ul>',$("body").append(t)}},minimizeSchedularPopup:function(){$("#schedulerNotificationPopup").removeClass("schedularOpen"),$("#MultiOperationSchedular").find(".crm-wms-icon").addClass("insideBar"),crmSchedulerNotification.checkingStatus()},addOrUpdateStatus:function(e,t){crmui.fromCloseOther||crmui.closeOtherWMSBars("scheduler"),$("#MultiOperationSchedular").removeClass("dN"),this.initDiv(t);var a=$("#picklist_pop_"+e.id),n=$("#schedulerNotificationPopup"),i=n.find("ul");if(0==a.length?(clearTimeout(crmSchedulerNotification.fiveSecondsMinimize),crmSchedulerNotification.minimizeSchedular(),clearTimeout(crmSchedulerNotification.permenentRemove),i.append('<li class="m0 p20 scheduledDataList picklistReplaceList" id ="picklist_pop_'+e.id+'">'),a=$("#picklist_pop_"+e.id),n.addClass("schedularOpen")):(clearTimeout(crmSchedulerNotification.fiveSecondsMinimize),a.empty(),clearTimeout(crmSchedulerNotification.permenentRemove),crmSchedulerNotification.permenentRemovePop(),0!==$("#shareProgress").length&&$("#shareContactPopup").remove()),a.append(Handlebars.templates.crmSchedulerNotification(e)),n.addClass("schedularOpen"),n.find("li").length>3){var o=renderingUtils.windowHeight/4*3;i.css("max-height",o).addClass("oA")}crmui.WMSBarOpened(n[0])},minimizeSchedular:function(){crmSchedulerNotification.fiveSecondsMinimize=setTimeout((function(){$("#schedulerNotificationPopup").removeClass("schedularOpen")}),5e3)},permenentRemovePop:function(){clearTimeout(crmSchedulerNotification.permenentRemove),0===$(".progressBarAnime").length&&(crmSchedulerNotification.permenentRemove=setTimeout((function(){$("#schedulerNotificationPopup").removeClass("schedularOpen",(function(){var e=$("#schedulerNotificationPopup");e.find("ul").empty(),e.remove()})),$("#MultiOperationSchedular").addClass("dN")}),15e3))},checkingStatus:function(){$("scheduledDataList").each((function(){$(this).find("div").hasClass("progressBarAnime")?clearTimeout(crmSchedulerNotification.fiveSecondsMinimize):(clearTimeout(crmSchedulerNotification.permenentRemove),crmSchedulerNotification.permenentRemovePop())}))},hideInSchedularBar:function(e){crmui.fromCloseOther||crmui.closeOtherWMSBars("scheduler");var t=$(e);t.hasClass("insideBar")?($("#schedulerNotificationPopup").addClass("schedularOpen"),t.removeClass("insideBar")):($("#schedulerNotificationPopup").removeClass("schedularOpen"),t.addClass("insideBar")),clearTimeout(crmSchedulerNotification.fiveSecondsMinimize),clearTimeout(crmSchedulerNotification.permenentRemove),crmSchedulerNotification.permenentRemovePop(),crmui.WMSBarOpened($L("#schedulerNotificationPopup")[0])},stopRemove:function(){clearTimeout(crmSchedulerNotification.permenentRemove)},hideRecordNotification:function(e){var t=$("#picklist_pop_"+e),a=$("#schedulerNotificationPopup");a.find("li").length<=1?(a.removeClass("schedularOpen",(function(){a.remove()})),$("#MultiOperationSchedular").addClass("dN")):t.length>0&&t.slideUp().remove()}};!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).crmSchedulerNotification=e({1:function(e,t,a,n,i){var o;return' <div class="picklist_progress progressBarAnime"> <p class="pB20 pR pL8">'+(null!=(o=e.lambda(null!=t?t.message:t,t))?o:"")+'</p> <div class="pR progBarWarp"> <div class="progBarWheel"> </div> </div> </div> '},3:function(e,t,a,n,i){var o,r=null!=t?t:{};return' <div class="schedularMsg wbBreakWord"> <p class="pB5 pL10 '+(null!=(o=a.ifCond.call(r,null!=t?t.status:t,"=","success",{name:"ifCond",hash:{},fn:e.program(4,i,0),inverse:e.program(6,i,0),data:i}))?o:"")+' pR"> '+(null!=(o=e.lambda(null!=t?t.message:t,t))?o:"")+" </p> "+(null!=(o=a.if.call(r,null!=t?t.link:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))?o:"")+" </div> "},4:function(e,t,a,n,i){return"succesIcoSchedular"},6:function(e,t,a,n,i){return"failedIcoSchedular"},8:function(e,t,a,n,i){var o;return" "+(null!=(o=a.if.call(null!=t?t:{},null!=t?t.canvasid:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.program(11,i,0),data:i}))?o:"")+" "},9:function(e,t,a,n,i){var o=e.lambda,r=e.escapeExpression;return' <link-to onclick="crmSchedulerNotification.stopRemove()" lt-prop-route="crm.tab.module.entity.canvas" lt-prop-dp=\'["'+r(o(null!=t?t.module:t,t))+'","'+r(o(null!=t?t.id:t,t))+'","'+r(o(null!=t?t.canvasid:t,t))+'"]\' lt-prop-qp=\'{"showShared":"true"}\' lt-prop-class="crm-small-font-size mL2 pL10 tdUnderline viewInfoTbl"> '+r(a.getI18n.call(null!=t?t:{},null!=t?t.linkMsg:t,{name:"getI18n",hash:{},data:i}))+" </link-to> "},11:function(e,t,a,n,i){var o=e.lambda,r=e.escapeExpression;return' <link-to onclick="crmSchedulerNotification.stopRemove()" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+r(o(null!=t?t.module:t,t))+'","'+r(o(null!=t?t.id:t,t))+'"]\' lt-prop-qp=\'{"showShared":"true"}\' lt-prop-class="crm-small-font-size mL2 pL10 tdUnderline viewInfoTbl"> '+r(a.getI18n.call(null!=t?t:{},null!=t?t.linkMsg:t,{name:"getI18n",hash:{},data:i}))+" </link-to> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var o;return(null!=(o=a.ifCond.call(null!=t?t:{},null!=t?t.status:t,"=","progress",{name:"ifCond",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))?o:"")+" "},useData:!0})}();var CPMF={getClientPortalUserLocaleInfo:function(){var e=networkUtils.returnDependencyFiles(["crm-user-edit-popup.js","modal-scroll-box-shadow.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-user-setup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=e.concat(t).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portaluser")],ResourceConstants.CRM));Lyte.injectResources(a,void 0,(function(){Lyte.Component.render("crm-user-locale-edit-popup",{},"body"),$("crm-user-locale-edit-popup")[0].setData("cxPropShowUserLocalePopup",!0)}))},removeUserPopUp:function(){$L("crm-user-locale-edit-popup")[0].remove()}},crmNavig={fromKanbanView:!1,fetchComplete:void 0,EOAindex:void 0,entityDetails:{},customViewKey:void 0,recentListViewUrl:void 0,listOfBuffers:[],NAVIGCACHEOBJ:{},parseCurrentListView:function(e){setTimeout((function(){if(!Crm.isHeadless){var t,a,n=crmListView.getObject(),i=n&&!0===(n.isStageView||n.isPredictView),o=[];if(crmNavig.customViewKey&&crmNavig[crmNavig.customViewKey]&&!e&&(crmNavig[crmNavig.customViewKey].recordId=[]),crmNavig.recentListViewUrl=crmHistory.getState().url,e||i){a=(r=$("li").filter((function(){return this.id.match(/^detailView_[0-9]+$/)}))).length;for(s=0;s<a;s++)o[s]=$(r[s])}else{var r;a=(r=$("tr").filter((function(){return this.id.match(/^[0-9]+$/)}))).length;for(var s=0;s<a;s++)o[s]=$(r[s])}for(var l=0;a&&l<a;l++){var d,m=o[l];d=e||i?m.attr("id").split("detailView_")[1]:m.attr("id"),t=JSON.parse(m.find("a[data-cid=detailView][id$="+d+"]").attr("data-params")||"null"),null!=n&&n.isCustomizedView&&(t=JSON.parse(m.attr("data-params")||"null")),null==t&&(m.find("[lt-prop-id=listView_"+d+"]").attr("lt-prop-td")?t=JSON.parse(m.find("[lt-prop-id=listView_"+d+"]").attr("lt-prop-td")):m.find("[lt-prop-id=homePage_"+d+"]").attr("lt-prop-td")&&(t=JSON.parse(m.find("[lt-prop-id=homePage_"+d+"]").attr("lt-prop-td"))),null==t&&(t=JSON.parse(m.find("[data-cid=detailView][id$="+m.attr("id").split("detailView_")[1]+"]").attr("data-params")||"null")));try{null==t&&m.attr("data-params")&&(t=JSON.parse(m.attr("data-params"))),t&&"null"!==t&&t.recordNum&&(crmNavig.customViewKey=t.cvid&&null!==t.cvid&&"null"!==t.cvid?t.cvid:t.module,crmNavig.customViewKey=i?crmNavig.customViewKey+"#"+$("#listView_"+t.id).closest("div.sv_each_stage").attr("id"):crmNavig.customViewKey,crmNavig[crmNavig.customViewKey]||(crmNavig[crmNavig.customViewKey]={recordId:[],currentOption:$("#currentOption")[0]?parseInt($("#currentOption")[0].value):10},crmNavig.listOfBuffers.push(crmNavig.customViewKey)),crmNavig[crmNavig.customViewKey].recordId[t.recordNum]={id:t.id,module:t.module})}catch(e){}}try{!$("#lastSortOrderId").length>0&&(crmNavig.entityDetails={previousCVName:$("input[name= previousCVName]")[0].value,searchCr:$("#searchCr")[0].value,OnSelect:$("input[name= OnSelect]")[0].value,PreviousUnParsedViewName:$("input[name= PreviousUnParsedViewName]")[0].value,sortTaskColumnString:$("input[name=sortTaskColumnString]")[0].value,sortTaskOrderString:$("input[name= sortTaskOrderString]")[0].value,sortEventColumnString:$("input[name=sortEventColumnString]")[0].value,sortEventOrderString:$("input[name= sortEventOrderString]")[0].value})}catch(e){}}}),200)},parseGlobalSearchList:function(e){var t,a=[],n=void 0;crmNavig.recentListViewUrl=crmHistory.getState().url;var i=$("[id=ajax_"+e+"]").find("tr[id^="+e+"_]").filter((function(){return this.id.match(/[0-9]+$/)}));t=i.length;for(var o=0;o<t;o++)a[o]=$(i[o]);for(var r=0;t&&r<t;r++){var s=a[r];n=JSON.parse(s.find("a[data-cid=detailView][id$="+s.attr("id").split("_")[1]+"]").attr("data-params")||"null");try{n&&"null"!==n&&n.recordNum&&(crmNavig[e]||(crmNavig[e]={recordId:[],currentOption:$("#currentOption")[0]?parseInt($("#currentOption")[0].value):10},crmNavig.listOfBuffers.push(e)),crmNavig[e].recordId.push({id:n.id,module:n.module}))}catch(e){}}try{!$("#lastSortOrderId").length>0&&(crmNavig.entityDetails={previousCVName:$("input[name= previousCVName]")[0].value,searchCr:$("#searchCr")[0].value,OnSelect:$("input[name= OnSelect]")[0].value,PreviousUnParsedViewName:$("input[name= PreviousUnParsedViewName]")[0].value,sortTaskColumnString:$("input[name=sortTaskColumnString]")[0].value,sortTaskOrderString:$("input[name= sortTaskOrderString]")[0].value,sortEventColumnString:$("input[name=sortEventColumnString]")[0].value,sortEventOrderString:$("input[name= sortEventOrderString]")[0].value})}catch(e){}},updateDataParamValue:function(e,t,a){var n=JSON.parse($("[id="+e+"]").attr("data-params")||"null");n[t]=a,$("[id="+e+"]").attr("data-params",JSON.stringify(n))},getRecordNumToId:function(e,t){if(crmNavig[t])for(var a=1;a<crmNavig[t].recordId.length;a++)if(crmNavig[t].recordId[a]&&crmNavig[t].recordId[a].id===e)return a;return-1},navigateRecord:function(e,t,a){var n=t?$(t).attr("data-params"):a,i=t?$(t).attr("data-cid"):a.clickId,o=n?"object"==typeof n?n:JSON.parse(n):{},r=$("input[name=fromIndex]"),s=$("input[name=toIndex]"),l=r.length?parseInt(r[0].value):o.fromIndex,d=s.length?parseInt(s[0].value):o.toIndex,m=parseInt(o.recordNum),c=(o.cvid?o.cvid:$("input[name=cvid]")[0].value,parseInt(d)-parseInt(l)+1),u=$("#id").val();"NavNext"===i?(parseInt(m)>=parseInt(d)&&(l=parseInt(d)+1,d=parseInt(d)+c),!o.fromDel&&"true"!==o.fromDel&&(m=parseInt(m)+1)):"NavPrevious"===i&&(parseInt(m)<=l&&(l=parseInt(l)-c,d=parseInt(d)-c),m=parseInt(m)-1);var p=$(t);return p.hasClass("disabled")||(p.addClass("disabled"),p.attr("disabled"," disabled"),crmNavig.processObjectNew(l,d,u,o,i,m)),!1},triggerFetch:function(e,t,a,n,i,o,r){var s=parseInt(t)-parseInt(e)+1,l=n.module;if("Activities"===l&&$("#cvRangeValue").length&&(s=parseInt($("#cvRangeValue").val())),"NavNext"===i?a=parseInt(a)+1:"NavPrevious"===i&&(a=parseInt(a)-1),a>=1&&crmNavig[crmNavig.customViewKey]&&("true"===n.fromDel&&!crmNavig[crmNavig.customViewKey].recordId[t]||!crmNavig[crmNavig.customViewKey].recordId[a]&&"EOA"!==crmNavig[crmNavig.customViewKey].recordId[a]||a>=t||a<=e)&&"Activities"===l){if(a<=e&&a>1?(e=parseInt(e)-s,t=parseInt(t)-s):a>1&&(e=a,t+=s),!crmNavig[crmNavig.customViewKey].recordId[t]){crmNavig.recentListViewUrl=crmNavig.recentListViewUrl?crmNavig.recentListViewUrl:crmHistory.getState().url;var d=crmNavig.recentListViewUrl;(m=crmNavig.fetchNextSetUrl(e,t,d,n.module,n))&&crmNavig.fetchNextSet(m,e,t,l,o,r)}}else if(crmNavig[crmNavig.customViewKey]&&"EOA"!==crmNavig[crmNavig.customViewKey].recordId[a]&&a&&(null===crmNavig[crmNavig.customViewKey].recordId[a]||void 0===crmNavig[crmNavig.customViewKey].recordId[a]||"true"===n.trigg)&&a>1){a<=e?(e=parseInt(e)-s,t=parseInt(t)-s):a!==t&&(e=a,t+=s),crmNavig.recentListViewUrl=crmNavig.recentListViewUrl?crmNavig.recentListViewUrl:crmHistory.getState().url;var m;d=crmNavig.recentListViewUrl;(m=crmNavig.fetchNextSetUrl(e,t,d,n.module,n))&&crmNavig.fetchNextSet(m,e,t,l,o,r)}else o&&o.call()},processObjectNew:function(e,t,a,n,i,o,r){var s;s="Activities"===Crm.activityGrp[n.module]&&void 0!==Lyte.Router.getRouteInstance().parent&&void 0!==Lyte.Router.getRouteInstance().parent.parent&&"Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()?"Activities":n.module,(a=crmNavig[crmNavig.customViewKey].recordId[o]?crmNavig[crmNavig.customViewKey].recordId[o].id:void 0)&&(n.module=crmNavig[crmNavig.customViewKey].recordId[o].module);var l="";"true"!==n.fromDel||"NavPrevious"===i?l="&FROM_INDEX="+encodeURIComponent(e)+"&TO_INDEX="+encodeURIComponent(t):"NavNext"===i&&(l="&FROM_INDEX="+$("input[name = fromIndex]")[0].value+"&TO_INDEX="+$("input[name = toIndex]")[0].value);var d=Crm.getCrmBasePath()+"/ShowEntityInfo.do?nav=true&id="+encodeURIComponent(a)+"&module="+encodeURIComponent(n.module)+"&recordNum="+encodeURIComponent(o)+"&navig=true&lookback=true"+l;if(n.cvid&&(d=d+"&cvid="+n.cvid),Crm.userDetails.templatingEnabled&&(d+="&CTEnabledInClient=true"),getObj("pfrom")&&(n.pfrom=getObj("pfrom").value),n.pfrom&&(d+="&pfrom="+n.pfrom),!0===crmConstants.clientTemplatingSupported[n.module]&&(d+="&format=json"),n.stageId&&(d+="&stageId="+n.stageId),o<1)if("EOA"!==crmNavig[crmNavig.customViewKey].recordId[1]){var m='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.alert.heading.cannot.access.record",I18n.getMsg(moduleRecordMapping[s].singular_label))+'</h2></div><div class="mT10">'+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg(moduleRecordMapping[s].singular_label))+'</div></div><br class="cBoth"><div class="alignRight mT20"><input type="button" class="newgraybtn" value="'+I18n.getMsg("crm.label.backToModule",I18n.getMsg(s))+'" onclick="hide(\'popupnew\');renderingUtils.removeFreezeLayer();crmHistory.backOneLevel();document.getElementById(\'popupnew\').style.zIndex=30;"><input type="button" class="newgraybtn" value="'+I18n.getMsg("Close")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(m),crmNavig.setNavigButtonState(1)}else crmHistory.backOneLevel();else if(a){var c="NavNext"===i,u=$("input[name=fromIndex]"),p=$("input[name=toIndex]"),f=u.length?parseInt(u[0].value):n.fromIndex,v=p.length?parseInt(p[0].value):n.toIndex,h=document.getElementById("cvid");if("Activities"===s||"Tasks"===s||"Events"===s||"Calls"===s){var g=$("#recordNum"),C=g.length?g[0].value:parseInt(n.recordNum);if(!featuresAvailable.NEXTGENUI_ENABLED&&(parseInt(C)<e||parseInt(C)>t)&&"true"!==n.fromDel||"true"===n.fromDel&&(parseInt(C)<=f&&!c||parseInt(C)>v&&c))if(crmNavig[crmNavig.customViewKey].rpURl){var b=networkUtils.parseUrl(crmNavig[crmNavig.customViewKey].rpURl),w=parseInt($("#cvRangeValue").val()),y=objectUtils.cloneObject(n);("true"!==n.fromDel||parseInt(o)>v||parseInt(o)<f)&&("NavNext"===i?(f=parseInt(v)+1,v=parseInt(v)+w):(f=parseInt(f)-w,v=parseInt(v)-w)),delete y.fromIndex,delete y.toIndex,y.FROM_INDEX=encodeURIComponent(f),y.TO_INDEX=encodeURIComponent(v),y.forRp="true",y.cvid=encodeURIComponent(b.params.cvid),y.pfrom=y.cvid&&null!==y.cvid&&"null"!==y.cvid&&"undefined"!==y.cvid?"cv":"gsearch";for(var I=y.FROM_INDEX,L="cv"===y.pfrom?y.cvid:$("#module")[0].value,T=[];crmNavig[L].recordId[I]&&I<=parseInt(y.TO_INDEX);)T.push(crmNavig[L].recordId[I].id),I++;var R={seIds:T.toString()};y.loadNextEntity="true",delete y.backOneLevel;d=networkUtils.constructUrl(Crm.getCrmBasePath()+"/"+b.action+".do",y);(new crmRequestPool).initiate({type:"GET",url:d,data:R,dataType:"text",success:function(e){placeRes(e,void 0,d,n,o)}})}else{(new crmRequestPool).initiate({type:"GET",url:Crm.getCrmBasePath()+"/RelActCV.do?pfrom=cv&cvid="+$("#cvid")[0].value+"&FROM_INDEX="+e+"&TO_INDEX="+t,dataType:"text",success:function(e){Lyte.injectResources(networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","calls-cvcard.js","crux-lookupfilter-component.js","crux-column-list.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient),void 0,(function(){placeRes(e,void 0,d)}))}})}else{o=parseInt(C);"true"!=n.fromDel&&(c?o++:o--),"Activities"===s?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Activities",a],queryParams:{sub_module:n.module}}).data={fromDetailView:!0,navig:"true",recordNum:o,FROM_INDEX:e,TO_INDEX:t,cvid:n.cvid?n.cvid:h.value,stageId:n.stageId,fromActivityListView:"true",fromDel:n.fromDel}:n.fromActSubModuleListView||["Calls","Tasks","Meetings","Events"].contains(n.module)?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n.module,a]}).data={fromDetailView:!0,navig:"true",recordNum:o,FROM_INDEX:e,TO_INDEX:t,cvid:n.cvid?n.cvid:h.value,stageId:n.stageId,fromActSubModuleListView:"true",fromDel:n.fromDel}:Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:[n.module,a]}).data={fromDetailView:!0,navig:"true",recordNum:o,FROM_INDEX:e,TO_INDEX:t,cvid:n.cvid?n.cvid:h.value,stageId:n.stageId,fromActSubModuleListView:"true",fromDel:n.fromDel}}r&&r.call()}else{if("true"!=n.fromDel){o=parseInt(n&&n.recordNum?n.recordNum:$("#recordNum")[0].value);c?o++:o--}"Messages"===s?Lyte.Router.transitionTo({route:"crm.tab.messages.view",dynamicParams:[a]}).data={recordNum:o}:(Lyte.Router.transitionTo({route:"crm.tab.module.entity",dynamicParams:[n.module,a]}).data={navig:"true",recordNum:o,FROM_INDEX:e,TO_INDEX:t,cvid:n.cvid?n.cvid:h.value,stageId:n.stageId,fromDel:n.fromDel},isRelatedListLoaded=!0)}}else if("true"===n.fromDel){var N={};(N=crmHistory.getCurrentStateData()).fromDel="true",N.clickId="NavPrevious",crmNavig[crmNavig.customViewKey].recordId[o]="EOA",o&&(N.recordNum=o),crmNavig.navigateRecord(void 0,void 0,N)}else{m='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.alert.heading.cannot.access.record",I18n.getMsg(moduleRecordMapping[s].singular_label))+'</h2></div><div class="mT10">'+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg(moduleRecordMapping[s].singular_label))+'</div></div><br class="cBoth"><div class="alignRight mT20"><input type="button" class="newgraybtn" value="'+I18n.getMsg("crm.label.backToModule",I18n.getMsg(s))+'" onclick="hide(\'popupnew\');renderingUtils.removeFreezeLayer();crmHistory.backOneLevel();document.getElementById(\'popupnew\').style.zIndex=30;"><input type="button" class="newgraybtn" value="'+I18n.getMsg("Close")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(m),crmNavig.setNavigButtonState(o-1)}},setNavigButtonState:function(e){var t=parseInt(e),a=crmNavig.customViewKey,n=$("#detailPrevious"),i=$("#detailNext"),o=$("#module").length>0?$("#module")[0].value:"";if(a&&window[o]&&"view"==window[o].currentStatus&&crmNavig[a]){var r=crmNavig[a].recordId[t-1],s=crmNavig[a].recordId[t+1];!r||"EOA"===r||"object"==typeof r&&0==Object.keys(r).length?n.attr("class","prev-dv disabled").removeAttr("data-cid"):(i.css("display","inline-block"),n.attr({class:"prev-dv accessibility-route-elem","data-cid":"NavPrevious"}).css("display","inline-block")),!s||"EOA"===s||"object"==typeof s&&0==Object.keys(s).length?i.attr("class","next-dv disabled").removeAttr("data-cid"):(i.attr({class:"next-dv accessibility-route-elem","data-cid":"NavNext"}).css("display","inline-block"),n.css("display","inline-block")),s&&"EOA"!==s||r&&"EOA"!==r||(i.hide(),n.hide(),$("#navigtd").css("width","30px !important"))}else i.hide(),n.hide(),$("#navigtd").css("width","30px !important")},fetchNextSetUrl:function(e,t,a,n,i,o){var r=n,s=networkUtils.parseUrl(decodeURIComponent(a));s.params&&["CustomizedView","CardView","TableView"].indexOf(s.params.viewType)>=0&&delete s.params.viewType;var l=s.action,d=a.indexOf(n)>-1&&s.params?s.params:{},m="NavigateByRecords";for(var c in d)d[c]=decodeURIComponent(d[c]);if(d.fromDV="true",-1!==a.indexOf("GlobalSearch")){var u=-1!==crmNavig.recentListViewUrl.indexOf("userOption")?"true":"false",p={fromIndex:e,toIndex:t,isNavigate:"true",fileName:Crm.getCrmBasePath()+"/GSearch.do",totalRecords:10,userOption:u,sModules:n};$L.extend(p,d),d["mod_"+n]="true","true"===o&&(d.forRp="true",delete d.fromDV)}else if(-1!==a.indexOf("Home")){p={};p={fromIndex:e,toIndex:t,fileName:Crm.getCrmBasePath()+"/HomePageLayout.do",mod:!0,dashletId:i.cvid?i.cvid:crmHistory.getState().data.cvid,module:r,layoutId:i.layoutId?i.layoutId:crmHistory.getState().data.layoutId},$L.extend(d,p)}else if(-1!==a.indexOf("ViewPipeline")){p={OnSelect:"true",isParent:"true",actiontype:"viewPipeline",frmidx:e,toIdx:t,module:r,rangeValue:parseInt(t)-parseInt(e)+1,currentOption:parseInt(t)-parseInt(e)+1,fileName:Crm.getCrmBasePath()+"/ViewPipeline.do?mod=true"};$L.extend(p,d),d.ownerId=i.ownerId&&"null"!==i.ownerId&&null!==i.ownerId?i.ownerId:crmHistory.getState().data.ownerId,d.roleId=i.roleId?i.roleId:crmHistory.getState().data.roleId}else if("MassUpdate"===l||"MassDeleted"===l||"MassTransfer"===l||"MassConvert"===l){if(d.fromIndex=e,d.toIndex=t,"MassUpdate"===l?d.actiontype="mass_update":"MassDeleted"===l?d.actiontype="mass_delete":"MassConvert"===l?d.actiontype="mass_convert":"MassTransfer"===l&&(d.actiontype="mass_transfer"),d.searchDetails){var f=JSON.parse(d.searchDetails);d.rowCount=f.length;for(var v=0;v<f.length;v++){var h=f[v];d["searchfield"+(v+1)]=h.text,d["searchfieldtype"+(v+1)]=h.type,d["match"+(v+1)]=h.match,"T"===h.type?(d["searchtext"+(v+1)]=h.value,d["textcondition"+(v+1)]=h.ptn):"U"===h.type?(d["searchuser"+(v+1)]=h.value,d["temp_searchuser"+(v+1)]=h.temp_value,d["usercondition"+(v+1)]=h.ptn):"CML"===h.type?(d["searchcampcv"+(v+1)]=h.value,d["temp_searchcampcv"+(v+1)]=h.temp_value,d["campcvcondition"+(v+1)]=h.ptn):"C"===h.type?(d["searchusercv"+(v+1)]=h.value,d["usercvcondition"+(v+1)]=h.ptn):"B"===h.type?(d["searchboolean"+(v+1)]=h.value,d["booleancondition"+(v+1)]=h.ptn):"N"===h.type?(d["searchnum"+(v+1)]=h.value,d["numcondition"+(v+1)]=h.ptn):"D"===h.type?(d["searchdate"+(v+1)]=h.value,d["datecondition"+(v+1)]=h.ptn):"DT"===h.type&&(d["searchdatedate"+(v+1)]=h.value,d["datetimecondition"+(v+1)]=h.ptn,d["searchsthour"+(v+1)]=h.sthour,d["searchstminute"+(v+1)]=h.stminute,d["searchstampm"+(v+1)]=h.stampm,d["searchetminute"+(v+1)]=h.endminute,d["searchenddate"+(v+1)]=h.enddate,d["searchethour"+(v+1)]=h.endhour,d["searchetampm"+(v+1)]=h.endampm)}}else d.rowCount=1;d&&d.fromIndex&&d.toIndex&&(m="NavigateByRecords",d.fileName=Crm.getCrmBasePath()+"/MassRecords.do?mod=true"),delete d.searchDetails,delete d.calleeObj,delete d.backOneLevel,delete d.clickId;var g=new crmRequestPool,C=JSON.parse(JSON.stringify(d));(Crm.isPageLoad||Crm.isFromBack)&&d.operation_mode&&(delete C.operation_mode,delete C.fromIndex,delete C.toIndex,delete C.currentOption,g.initiate({action:Crm.getCrmBasePath()+"/MassRecords.do",data:C,success:function(e){$("#show").html(e),C.rowCount>=1||C.searchfieldtype1?(Search.setValues("create",C),Search.rowcnt=C.rowCount):(Search.setDefaultValues("create",void 0,void 0,void 0,void 0,!0),Search.rowcnt=1)}}),g.addUp({action:Crm.getCrmBasePath()+"/"+m+".do",data:d,success:function(e){$("#massResult").html(e)}}))}else{if(d.changeOption=!0,d.search_letter&&(d.searchletter=d.search_letter,delete d.search_letter),(d.searchDetails||d.searchletter&&""!==d.searchletter||1!==d.fromIndex)&&delete d.changeOption,d&&e&&t&&(d.fromIndex=e,d.toIndex=t,d.fileName=Crm.approvalActions[l]?Crm.approvalActions[l]:Crm.getCrmBasePath()+"/ShowSelectedCustomView.do",d.mod=!0),d.module=r,"Activities"===Crm.activityGrp[r]&&void 0!==Lyte.Router.getRouteInstance().parent&&void 0!==Lyte.Router.getRouteInstance().parent.parent&&"Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()&&(d.module="Activities"),"Chat"===d.module||"Documents"===d.module)return void Utils.windowLocationHref(Crm.getCrmBasePath()+"/ShowDetails.do?module="+d.module);if(delete d.sortOrderString,delete d.sortColumnString,d.searchDetails){f=JSON.parse(d.searchDetails);for(var b=0;b<f.length;b++){h=f[b];d["advSearch_text_"+(b+1)]=h.text?h.text:"",d["advSearch_select_"+(b+1)]=h.ptn,d["advSearch_name_"+(b+1)]=h.name,h.hr&&(d["advSearch_DT_hour"+(b+1)]=h.hr),h.min&&(d["advSearch_DT_minute"+(b+1)]=h.min),h.ampm&&(d["advSearch_DT_ampm"+(b+1)]=h.ampm)}delete d.searchDetails,d.advSearchCnt=b,d.searchField="All",d.advSearchEnable=!0}if("true"!==$("#iskanbanview").val()&&(crmListView.getFilterParams(d),(d.filters||d.cross_filters)&&(d.isNewFilter=!0)),"true"===o&&(d.forRp="true",delete d.fromDV),i.stageId&&"undefined"!==i.stageId&&(d.stageId=i.stageId,!d.fileName))return}var w=Crm.getCrmBasePath()+"/"+m+".do";v=0;for(var c in delete d.per_page,delete d.page,delete d.sort_order,delete d.sort_by,delete d.sub_module,d)/\b(calleeObj|clickId)\b/.test(c)||void 0!==d[c]&&(w+=0===v?"?":"&",w+=c+"="+encodeURIComponent(d[c]),v++);return w},fetchNextSet:function(e,t,a,n,i,o){var r=new Promise((function(n){e+="&isload=true",crmNavig.fetchComplete=void 0,$.ajax({type:"POST",url:e,success:function(e){for(var o=t,r=a-t+1,s=t;s<a;s++)crmNavig[crmNavig.customViewKey].recordId[s]=void 0;if(e.length<=0){crmNavig[crmNavig.customViewKey].noFurtherRecords="true";for(s=o;s<=parseInt(a)+1;s++)crmNavig[crmNavig.customViewKey].recordId[s]="EOA";crmNavig.EOAindex=o}for(s=0;s<r;s++){var l=e[s]?e[s].split(":::"):void 0;l?(crmNavig[crmNavig.customViewKey].recordId[o]={},crmNavig[crmNavig.customViewKey].recordId[o].id=l[0],crmNavig[crmNavig.customViewKey].recordId[o].module=l[1]?l[1]:$("#module")[0]?$("#module")[0].value:crmListView.getObject().module):crmNavig[crmNavig.customViewKey].recordId[o]="EOA",o++}i&&i.call(),crmNavig.fetchComplete="true";var d=$("#recordNum").length>0?$("#recordNum")[0].value:void 0;d&&crmNavig.setNavigButtonState(d),n()},error:function(){n()}})}));o&&(o.navigationPromise=r)},removeFeaturCacheObj:function(e){delete crmNavig.NAVIGCACHEOBJ[e]},removeFeatureModuleCacheObj:function(e,t){jQuery.isEmptyObject(crmNavig.NAVIGCACHEOBJ[e])||jQuery.isEmptyObject(crmNavig.NAVIGCACHEOBJ[e][t])||delete crmNavig.NAVIGCACHEOBJ[e][t]},checkForNavigReq:function(e,t,a,n,i,o,r){var s=a+"_"+n;return crmNavig.NAVIGCACHEOBJ[e]&&crmNavig.NAVIGCACHEOBJ[e][t]&&crmNavig.NAVIGCACHEOBJ[e][t][s]&&!r?(o(crmNavig.NAVIGCACHEOBJ[e][t][s]),!1):(i(),!0)},assignNavigCacheData:function(e,t,a,n,i){var o=a+"_"+n;jQuery.isEmptyObject(crmNavig.NAVIGCACHEOBJ[e])?crmNavig.NAVIGCACHEOBJ[e]={}:crmNavig.NAVIGCACHEOBJ[e],jQuery.isEmptyObject(crmNavig.NAVIGCACHEOBJ[e][t])?crmNavig.NAVIGCACHEOBJ[e][t]={}:crmNavig.NAVIGCACHEOBJ[e][t],crmNavig.NAVIGCACHEOBJ[e][t][o]=i}};!function(){function e(t){var a=e.modules[t];if(!a)throw new Error('failed to require "'+t+'"');return"exports"in a||"function"!=typeof a.definition||(a.client=a.component=!0,a.definition.call(this,a.exports={},a),delete a.definition),a.exports}e.modules={},e.register=function(t,a){e.modules[t]={definition:a}},e.define=function(t,a){e.modules[t]={exports:a}},e.register("component~emitter@1.1.2",(function(e,t){function a(e){if(e)return function(e){for(var t in a.prototype)e[t]=a.prototype[t];return e}(e)}t.exports=a,a.prototype.on=a.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},a.prototype.once=function(e,t){var a=this;function n(){a.off(e,n),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var a,n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++)if((a=n[i])===t||a.fn===t){n.splice(i,1);break}return this},a.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),a=this._callbacks[e];if(a)for(var n=0,i=(a=a.slice(0)).length;n<i;++n)a[n].apply(this,t);return this},a.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},a.prototype.hasListeners=function(e){return!!this.listeners(e).length}})),e.register("dropzone",(function(t,a){a.exports=e("dropzone/lib/dropzone.js")})),e.register("dropzone/lib/dropzone.js",(function(t,a){(function(){var t,n,i,o,r,s,l,d,m={}.hasOwnProperty,c=[].slice;n="undefined"!=typeof Emitter&&null!==Emitter?Emitter:e("component~emitter@1.1.2"),l=function(){},t=function(e){var t;function a(e,n){var i,o,r;if(this.element=e,this.version=a.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(a.instances.push(this),this.element.dropzone=this,i=null!=(r=a.optionsForElement(this.element))?r:{},this.options=t({},this.defaultOptions,i,null!=n?n:{}),this.options.forceFallback||!a.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(o=this.getExistingFallback())&&o.parentNode&&o.parentNode.removeChild(o),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=a.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=a.getElements(this.options.clickable,"clickable")),this.init()}return function(e,t){for(var a in t)m.call(t,a)&&(e[a]=t[a]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,e),a.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached"],a.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:100,thumbnailHeight:100,maxFiles:null,params:{},clickable:!1,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!1,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,dictDefaultMessage:I18n.getMsg("crm.feed.dropfiles"),dictFallbackMessage:I18n.getMsg("crm.feed.dropzone.browser.notsupport"),dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:I18n.getMsg("crm.mailmerge.filesize",4),dictInvalidFileType:I18n.getMsg("crm.feed.dropzone.filetype.message"),dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:I18n.getMsg("crm.feed.dropzone.cancel.upload"),dictCancelUploadConfirmation:I18n.getMsg("crm.feed.dropzone.upload.makesure"),dictRemoveFile:I18n.getMsg("crm.feed.dropzone.removefile"),dictRemoveFileConfirmation:null,dictMaxFilesExceeded:I18n.getMsg("crm.feed.dropzone.file.limit.message"),accept:function(e,t){return t()},init:function(){return l},forceFallback:!1,fallback:function(){var e,t,n,i,o,r;for(this.element.className=this.element.className+" dz-browser-not-supported",i=0,o=(r=this.element.getElementsByTagName("div")).length;i<o;i++)e=r[i],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=a.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),(n=t.getElementsByTagName("span")[0])&&(n.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,a,n;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},a=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=a*t.optHeight:null==t.optHeight&&(t.optHeight=1/a*t.optWidth),n=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):a>n?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*n):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/n),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:l,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:l,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,n,i,o,r,s,l,d,m,c,u,p,f;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=a.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),i=0,s=(m=e.previewElement.querySelectorAll("[data-dz-name]")).length;i<s;i++)m[i].textContent=e.name;for(o=0,l=(c=e.previewElement.querySelectorAll("[data-dz-size]")).length;o<l;o++)c[o].innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=a.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),f=this,t=function(t){return t.preventDefault(),t.stopPropagation(),e.status===a.UPLOADING?a.confirm(f.options.dictCancelUploadConfirmation,(function(){return f.removeFile(e)})):f.options.dictRemoveFileConfirmation?a.confirm(f.options.dictRemoveFileConfirmation,(function(){return f.removeFile(e)})):f.removeFile(e)},p=[],r=0,d=(u=e.previewElement.querySelectorAll("[data-dz-remove]")).length;r<d;r++)n=u[r],p.push(n.addEventListener("click",t));return p}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var a,n,i,o,r;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),e.previewElement.classList.add("dz-image-preview"),r=[],n=0,i=(o=e.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;n<i;n++)(a=o[n]).alt=e.name,r.push(a.src=t);return r}},error:function(e,t){var a,n,i,o,r;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),r=[],n=0,i=(o=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;n<i;n++)a=o[n],r.push(a.textContent=t);return r}},errormultiple:l,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:l,uploadprogress:function(e,t,a){var n,i,o,r,s;if(e.previewElement){for(s=[],i=0,o=(r=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;i<o;i++)n=r[i],s.push(n.style.width=t+"%");return s}},totaluploadprogress:l,sending:l,sendingmultiple:l,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:l,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:l,complete:function(e){if(e._removeLink)return e._removeLink.textContent=this.options.dictRemoveFile},completemultiple:l,maxfilesexceeded:l,maxfilesreached:l,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-details">\n    <div class="dz-filename"><span data-dz-name></span></div>\n    <div class="dz-size" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-success-mark"><span></span></div>\n  <div class="dz-error-mark"><span></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n</div>'},t=function(){var e,t,a,n,i,o,r;for(n=arguments[0],o=0,r=(a=2<=arguments.length?c.call(arguments,1):[]).length;o<r;o++)for(e in t=a[o])i=t[e],n[e]=i;return n},a.prototype.getAcceptedFiles=function(){var e,t,a,n,i;for(i=[],t=0,a=(n=this.files).length;t<a;t++)(e=n[t]).accepted&&i.push(e);return i},a.prototype.getRejectedFiles=function(){var e,t,a,n,i;for(i=[],t=0,a=(n=this.files).length;t<a;t++)(e=n[t]).accepted||i.push(e);return i},a.prototype.getFilesWithStatus=function(e){var t,a,n,i,o;for(o=[],a=0,n=(i=this.files).length;a<n;a++)(t=i[a]).status===e&&o.push(t);return o},a.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(a.QUEUED)},a.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(a.UPLOADING)},a.prototype.getActiveFiles=function(){var e,t,n,i,o;for(o=[],t=0,n=(i=this.files).length;t<n;t++)(e=i[t]).status!==a.UPLOADING&&e.status!==a.QUEUED||o.push(e);return o},a.prototype.init=function(){var e,t,n,i,o,r,s,l;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(a.createElement('<div id="dropzonediv" style="display:none" class="dz-default dz-message"><span style="display:none">'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(l=this,n=function(){return l.hiddenFileInput&&document.body.removeChild(l.hiddenFileInput),l.hiddenFileInput=document.createElement("input"),l.hiddenFileInput.setAttribute("type","file"),(null==l.options.maxFiles||l.options.maxFiles>1)&&l.hiddenFileInput.setAttribute("multiple","multiple"),l.hiddenFileInput.className="dz-hidden-input",null!=l.options.acceptedFiles&&l.hiddenFileInput.setAttribute("accept",l.options.acceptedFiles),l.hiddenFileInput.style.visibility="hidden",l.hiddenFileInput.style.position="absolute",l.hiddenFileInput.style.top="0",l.hiddenFileInput.style.left="200px",l.hiddenFileInput.style.height="0",l.hiddenFileInput.style.width="0",document.body.appendChild(l.hiddenFileInput),l.hiddenFileInput.addEventListener("change",(function(){var e,t,a,i;if((t=l.hiddenFileInput.files).length)for(a=0,i=t.length;a<i;a++)e=t[a],l.addFile(e);return n()}))},n()),this.URL=null!=(r=window.URL)?r:window.webkitURL,i=0,o=(s=this.events).length;i<o;i++)e=s[i],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){if(0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length)return setTimeout((function(){return e.emit("queuecomplete")}),0)}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(a){return t(a),e.emit("dragenter",a)}}(this),dragover:function(e){return function(a){var n;try{n=a.dataTransfer.effectAllowed}catch(e){}return a.dataTransfer.dropEffect="move"===n||"linkMove"===n?"move":"copy",t(a),e.emit("dragover",a)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(a){return t(a),e.drop(a)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(n){if(t!==e.element||n.target===e.element||a.elementInside(n.target,e.element.querySelector(".dz-message")))return e.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},a.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,a.instances.splice(a.instances.indexOf(this),1)},a.prototype.updateTotalUploadProgress=function(){var e,t,a,n,i,o,r;if(a=0,t=0,this.getActiveFiles().length){for(i=0,o=(r=this.getActiveFiles()).length;i<o;i++)a+=(e=r[i]).upload.bytesSent,t+=e.upload.total;n=100*a/t}else n=100;return this.emit("totaluploadprogress",n,t,a)},a.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?e:"")},a.prototype.getFallbackForm=function(){var e,t,n,i;return(e=this.getExistingFallback())?e:(n='<div class="dz-fallback">',this.options.dictFallbackText&&(n+="<p>"+this.options.dictFallbackText+"</p>"),n+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=a.createElement(n),"FORM"!==this.element.tagName?(i=a.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(t):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=i?i:t)},a.prototype.getExistingFallback=function(){var e,t,a,n,i,o;for(t=function(e){var t,a,n;for(a=0,n=e.length;a<n;a++)if(t=e[a],/(^| )fallback($| )/.test(t.className))return t},n=0,i=(o=["div","form"]).length;n<i;n++)if(a=o[n],e=t(this.element.getElementsByTagName(a)))return e},a.prototype.setupEventListeners=function(){var e,t,a,n,i,o,r;for(r=[],n=0,i=(o=this.listeners).length;n<i;n++)e=o[n],r.push(function(){var n,i;for(t in i=[],n=e.events)a=n[t],i.push(e.element.addEventListener(t,a,!1));return i}());return r},a.prototype.removeEventListeners=function(){var e,t,a,n,i,o,r;for(r=[],n=0,i=(o=this.listeners).length;n<i;n++)e=o[n],r.push(function(){var n,i;for(t in i=[],n=e.events)a=n[t],i.push(e.element.removeEventListener(t,a,!1));return i}());return r},a.prototype.disable=function(){var e,t,a,n,i;for(this.clickableElements.forEach((function(e){return e.classList.remove("dz-clickable")})),this.removeEventListeners(),i=[],t=0,a=(n=this.files).length;t<a;t++)e=n[t],i.push(this.cancelUpload(e));return i},a.prototype.enable=function(){return this.clickableElements.forEach((function(e){return e.classList.add("dz-clickable")})),this.setupEventListeners()},a.prototype.filesize=function(e){var t;return e>=109951162777.6?(e/=109951162777.6,t="TB"):e>=107374182.4?(e/=107374182.4,t="GB"):e>=104857.6?(e/=104857.6,t="MB"):e>=102.4?(e/=102.4,t="KB"):(e*=10,t="b"),"<strong>"+Math.round(e)/10+"</strong> "+t},a.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},a.prototype.drop=function(e){var t,a;e.dataTransfer&&(this.emit("drop",e),(t=e.dataTransfer.files).length&&((a=e.dataTransfer.items)&&a.length&&null!=a[0].webkitGetAsEntry?this._addFilesFromItems(a):this.handleFiles(t)))},a.prototype.paste=function(e){var t,a;if(null!=(null!=e&&null!=(a=e.clipboardData)?a.items:void 0))return this.emit("paste",e),(t=e.clipboardData.items).length?this._addFilesFromItems(t):void 0},a.prototype.handleFiles=function(e){var t,a,n,i;for(i=[],a=0,n=e.length;a<n;a++)t=e[a],i.push(this.addFile(t));return i},a.prototype._addFilesFromItems=function(e){var t,a,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)null!=(a=e[n]).webkitGetAsEntry&&(t=a.webkitGetAsEntry())?t.isFile?o.push(this.addFile(a.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=a.getAsFile&&(null==a.kind||"file"===a.kind)?o.push(this.addFile(a.getAsFile())):o.push(void 0);return o},a.prototype._addFilesFromDirectory=function(e,t){var a,n,i;return a=e.createReader(),i=this,n=function(e){var a,n,o;for(n=0,o=e.length;n<o;n++)(a=e[n]).isFile?a.file((function(e){if(!i.options.ignoreHiddenFiles||"."!==e.name.substring(0,1))return e.fullPath=t+"/"+e.name,i.addFile(e)})):a.isDirectory&&i._addFilesFromDirectory(a,t+"/"+a.name)},a.readEntries(n,(function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0}))},a.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?(alert(this.options.dictFileTooBig),this.removeFile(e)):a.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(alert(this.options.dictMaxFilesExceeded),this.removeFile(e)):this.options.accept.call(this,e,t):(alert(this.options.dictInvalidFileType),this.removeFile(e))},a.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=a.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,(t=this,function(a){return a?(e.accepted=!1,t._errorProcessing([e],a)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}));var t},a.prototype.enqueueFiles=function(e){var t,a,n;for(a=0,n=e.length;a<n;a++)t=e[a],this.enqueueFile(t);return null},a.prototype.enqueueFile=function(e){if(e.status!==a.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=a.QUEUED,this.options.autoProcessQueue)return setTimeout((t=this,function(){return t.processQueue()}),0);var t},a.prototype._thumbnailQueue=[],a.prototype._processingThumbnail=!1,a.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout((t=this,function(){return t._processThumbnailQueue()}),0);var t},a.prototype._processThumbnailQueue=function(){var e;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),(e=this,function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}))},a.prototype.removeFile=function(e){if(e.status===a.UPLOADING&&this.cancelUpload(e),this.files=d(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},a.prototype.removeAllFiles=function(e){var t,n,i,o;for(null==e&&(e=!1),n=0,i=(o=this.files.slice()).length;n<i;n++)((t=o[n]).status!==a.UPLOADING||e)&&this.removeFile(t);return null},a.prototype.createThumbnail=function(e,t){var a,n;return(a=new FileReader).onload=(n=this,function(){var i;return(i=document.createElement("img")).onload=function(){var a,o,r,l,d,m,c,u;if(e.width=i.width,e.height=i.height,null==(r=n.options.resize.call(n,e)).trgWidth&&(r.trgWidth=r.optWidth),null==r.trgHeight&&(r.trgHeight=r.optHeight),o=(a=document.createElement("canvas")).getContext("2d"),a.width=r.trgWidth,a.height=r.trgHeight,s(o,i,null!=(d=r.srcX)?d:0,null!=(m=r.srcY)?m:0,r.srcWidth,r.srcHeight,null!=(c=r.trgX)?c:0,null!=(u=r.trgY)?u:0,r.trgWidth,r.trgHeight),l=a.toDataURL("image/png"),n.emit("thumbnail",e,l),null!=t)return t()},i.src=a.result}),a.readAsDataURL(e)},a.prototype.processQueue=function(){var e,t,a,n;if(t=this.options.parallelUploads,e=a=this.getUploadingFiles().length,!(a>=t)&&(n=this.getQueuedFiles()).length>0){if(this.options.uploadMultiple)return this.processFiles(n.slice(0,t-a));for(;e<t;){if(!n.length)return;this.processFile(n.shift()),e++}}},a.prototype.processFile=function(e){return this.processFiles([e])},a.prototype.processFiles=function(e){var t,n,i;for(n=0,i=e.length;n<i;n++)(t=e[n]).processing=!0,t.status=a.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},a.prototype._getFilesWithXhr=function(e){var t;return function(){var a,n,i,o;for(o=[],a=0,n=(i=this.files).length;a<n;a++)(t=i[a]).xhr===e&&o.push(t);return o}.call(this)},a.prototype.cancelUpload=function(e){var t,n,i,o,r,s,l;if(e.status===a.UPLOADING){for(i=0,r=(n=this._getFilesWithXhr(e.xhr)).length;i<r;i++)(t=n[i]).status=a.CANCELED;for(e.xhr.abort(),o=0,s=n.length;o<s;o++)t=n[o],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",n)}else(l=e.status)!==a.ADDED&&l!==a.QUEUED||(e.status=a.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},a.prototype.uploadFile=function(e){return this.uploadFiles([e])},a.prototype.uploadFiles=function(e){var n,i,o,r,s,l,d,m,c,u,p,f,v,h,g,C,b,w,y,I,L,T,R,$,N,P,O,k,A,S,M,E;for(C=new XMLHttpRequest,b=0,L=e.length;b<L;b++)(n=e[b]).xhr=C;for(r in C.open(this.options.method,this.options.url,!0),C.withCredentials=!!this.options.withCredentials,v=null,E=this,o=function(){var t,a,i;for(i=[],t=0,a=e.length;t<a;t++)n=e[t],i.push(E._errorProcessing(e,v||E.options.dictResponseError.replace("{{statusCode}}",C.status),C));return i},h=function(t){return function(a){var i,o,r,s,l,d,m,c,u;if(null!=a)for(o=100*a.loaded/a.total,r=0,d=e.length;r<d;r++)(n=e[r]).upload={progress:o,total:a.total,bytesSent:a.loaded};else{for(i=!0,o=100,s=0,m=e.length;s<m;s++)100===(n=e[s]).upload.progress&&n.upload.bytesSent===n.upload.total||(i=!1),n.upload.progress=o,n.upload.bytesSent=n.upload.total;if(i)return}for(u=[],l=0,c=e.length;l<c;l++)n=e[l],u.push(t.emit("uploadprogress",n,o,n.upload.bytesSent));return u}}(this),C.onload=function(t){return function(n){var i;if(e[0].status!==a.CANCELED&&4===C.readyState){if("success"!=(v=C.responseText)?e.length>1?alert(I18n.getMsg("crm.security.virus.alert.many")):alert(I18n.getMsg("crm.security.virus.alert.one")):document.getElementById("feed_status").value="",C.getResponseHeader("content-type")&&~C.getResponseHeader("content-type").indexOf("application/json"))try{v=JSON.parse(v)}catch(e){n=e,v="Invalid JSON response from server."}return h(),200<=(i=C.status)&&i<300?t._finished(e,v,n):o()}}}(this),C.onerror=function(){if(e[0].status!==a.CANCELED)return o()},(null!=(P=C.upload)?P:C).onprogress=h,l={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&t(l,this.options.headers),l)s=l[r],C.setRequestHeader(r,s);if(i=new FormData,this.options.params)for(p in O=this.options.params)g=O[p],i.append(p,g);for(w=0,T=e.length;w<T;w++)n=e[w],this.emit("sending",n,C,i);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,C,i),"FORM"===this.element.tagName)for(y=0,R=(k=this.element.querySelectorAll("input, textarea, select, button")).length;y<R;y++)if(c=(m=k[y]).getAttribute("name"),u=m.getAttribute("type"),null!=c)if("SELECT"===m.tagName&&m.hasAttribute("multiple"))for(I=0,$=(A=m.options).length;I<$;I++)(f=A[I]).selected&&i.append(c,f.value);else(!u||"checkbox"!==(S=u.toLowerCase())&&"radio"!==S||m.checked)&&i.append(c,m.value);for(d=N=0,M=e.length-1;0<=M?N<=M:N>=M;d=0<=M?++N:--N)i.append(this._getParamName(d),e[d],e[d].name);try{return C.send(i)}catch(t){e.length>1?alert(I18n.getMsg("crm.security.virus.alert.many")):alert(I18n.getMsg("crm.security.virus.alert.one"))}},a.prototype._finished=function(e,t,n){var i,o,r;for(o=0,r=e.length;o<r;o++)(i=e[o]).status=a.SUCCESS,this.emit("success",i,t,n),this.emit("complete",i);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},a.prototype._errorProcessing=function(e,t,n){var i,o,r;for(o=0,r=e.length;o<r;o++)(i=e[o]).status=a.ERROR,this.emit("error",i,t,n),this.emit("complete",i);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},a}(n),t.version="3.10.2",t.options={},t.optionsForElement=function(e){return e.getAttribute("id")?t.options[i(e.getAttribute("id"))]:void 0},t.instances=[],t.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},t.autoDiscover=!0,t.discover=function(){var e,a,n,i,o,r;for(document.querySelectorAll?n=document.querySelectorAll(".dropzone"):(n=[],e=function(e){var t,a,i,o;for(o=[],a=0,i=e.length;a<i;a++)t=e[a],/(^| )dropzone($| )/.test(t.className)?o.push(n.push(t)):o.push(void 0);return o},e(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))),r=[],i=0,o=n.length;i<o;i++)a=n[i],!1!==t.optionsForElement(a)?r.push(new t(a)):r.push(void 0);return r},t.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],t.isBrowserSupported=function(){var e,a,n,i;if(e=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(a=0,n=(i=t.blacklistedBrowsers).length;a<n;a++)i[a].test(navigator.userAgent)&&(e=!1);else e=!1;else e=!1;return e},d=function(e,t){var a,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)(a=e[n])!==t&&o.push(a);return o},i=function(e){return e.replace(/[\-_](\w)/g,(function(e){return e.charAt(1).toUpperCase()}))},t.createElement=function(e){var t;return(t=document.createElement("div")).innerHTML=e,t.childNodes[0]},t.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},t.getElement=function(e,t){var a;if("string"==typeof e?a=document.querySelector(e):null!=e.nodeType&&(a=e),null==a)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return a},t.getElements=function(e,t){var a,n,i,o,r,s,l;if(e instanceof Array){n=[];try{for(i=0,r=e.length;i<r;i++)a=e[i],n.push(this.getElement(a,t))}catch(e){e,n=null}}else if("string"==typeof e)for(n=[],o=0,s=(l=document.querySelectorAll(e)).length;o<s;o++)a=l[o],n.push(a);else null!=e.nodeType&&(n=[e]);if(null==n||!n.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return n},t.confirm=function(e,t,a){return window.confirm(e)?t():null!=a?a():void 0},t.isValidFile=function(e,t){var a,n,i,o,r;if(!t)return!0;for(t=t.split(","),a=(n=e.type).replace(/\/.*$/,""),o=0,r=t.length;o<r;o++)if("."===(i=(i=t[o]).trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(i.toLowerCase(),e.name.length-i.length))return!0}else if(/\/\*$/.test(i)){if(a===i.replace(/\/.*$/,""))return!0}else if(n===i)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(e){return this.each((function(){return new t(this,e)}))}),null!=a?a.exports=t:window.Dropzone=t,t.ADDED="added",t.QUEUED="queued",t.ACCEPTED=t.QUEUED,t.UPLOADING="uploading",t.PROCESSING=t.UPLOADING,t.CANCELED="canceled",t.ERROR="error",t.SUCCESS="success",r=function(e){var t,a,n,i,o,r,s,l;for(e.naturalWidth,o=e.naturalHeight,(t=document.createElement("canvas")).width=1,t.height=o,(a=t.getContext("2d")).drawImage(e,0,0),n=a.getImageData(0,0,1,o).data,l=0,i=o,r=o;r>l;)0===n[4*(r-1)+3]?i=r:l=r,r=i+l>>1;return 0===(s=r/o)?1:s},s=function(e,t,a,n,i,o,s,l,d,m){var c;return c=r(t),e.drawImage(t,a,n,i,o,s,l,d,m/c)},o=function(e,t){var a,n,i,o,r,s,l,d,m;if(i=!1,m=!0,n=e.document,d=n.documentElement,a=n.addEventListener?"addEventListener":"attachEvent",l=n.addEventListener?"removeEventListener":"detachEvent",s=n.addEventListener?"":"on",o=function(a){if("readystatechange"!==a.type||"complete"===n.readyState)return("load"===a.type?e:n)[l](s+a.type,o,!1),!i&&(i=!0)?t.call(e,a.type||a):void 0},r=function(){try{d.doScroll("left")}catch(e){return e,void setTimeout(r,50)}return o("poll")},"complete"!==n.readyState){if(n.createEventObject&&d.doScroll){try{m=!e.frameElement}catch(e){}m&&r()}return n[a](s+"DOMContentLoaded",o,!1),n[a](s+"readystatechange",o,!1),e[a](s+"load",o,!1)}},t._autoDiscoverFunction=function(){if(t.autoDiscover)return t.discover()},o(window,t._autoDiscoverFunction)}).call(this)})),"object"==typeof exports?module.exports=e("dropzone"):"function"==typeof define&&define.amd?define([],(function(){return e("dropzone")})):this.Dropzone=e("dropzone")}();var template1={storeCurEl:"",associateEl:"",isSearch:!1,keepFocus:!1,callback:"",templateIdentifier:"",isTemplateComponent:!1,inventory:!1,editorType:"",lastSearchStr:"",featureName:"",popToClose:"",popzindex:"",leftListText:"",noimagesrc:"",unLimitedTemplate:!1,isTemplatePreview:!1,templatePresent:!0,templatesperpage:100,previousliObj:"",mailmergeAvail:!1,inventoryavail:!1,count:0,attachLimit:0,viewEmailTemplateId:"",crmurl:"",tempOnboard:!1,clearTourTime:0,isTemplateEditorEnabled:!1,lastclickedEditorObj:void 0,currLocation:"",tempEditorOnboard:!1,invEditorOnboard:!1,mergeTagInProductTable:!1,mergeTagInSubformTable:!1,mergeTagInGetRecordTable:!1,curSubformTableModule:void 0,formsIntegEnabled:!1,isSurveyEnabled:!1,isCrmCampaignMail:!1,relatedModule:"",orchestrationMergeFields:"",selectedFields:[],moduleFieldsListDom:"",removeInlineImgOnload:!0,mobileViewScrollTop:0,desktopViewScrollTop:0,mobileViewScrollLeft:0,desktopViewScrollLeft:0,isResponsiveTemplateShow:!1,eventName:"",setlistViewPage:function(){var e=renderingUtils.windowHeight,t=$("#nTTemplateListDIV"),a=t.offset().top,n=$(".tempRight"),i=$(".leftCtnTemp"),o=n.offset().top,r=$(".folderStructure"),s=$("#foldSholder"),l=$(".bottomSettingsbar"),d=r.offset().top,m=l.outerHeight(),c=$(".tempOnBoard_three").offset(),u=c.left-25,p=c.top-15,f=$(".templateMsgOnboard"),v=f.innerHeight();n.length>0&&i.length>0&&i.is(":visible")&&i.height(e-Math.round(o+32+14));var h=$("#templatePreviewSection");r.length>0&&s.length>0&&r.is(":visible")&&r.length>0&&l.length>0&&(s.height(e-Math.round(d+m+26+25)),thirdPartyUtils.unbindPerfectScroll("#foldSholder"),thirdPartyUtils.bindPerfectScroll("#foldSholder"),s.addClass("oH"));var g=$(".folderListCtn");n.length>0&&g.length>0&&g.is(":visible")&&g.height(e-Math.round(o+32+14)),$(".tempLW").length>0&&template.refreshListScroll(),f.is(":visible")&&($(".pulse_dot3").css({left:u,top:p}),1==$(".tempScreenView3").length&&f.css({left:u+11,top:p-(v-11)})),$("#tempCtnArea").length>0&&h.length>0&&t.length>0&&h.css({height:e-(Math.round(a)+44),top:a})},listViewScroll:function(){$L("#tempctnList").scrollTop()>0?$(".tempTableHead").addClass("nTHeadShadow"):$(".tempTableHead").removeClass("nTHeadShadow"),template.checkDocumentBottom()&&template.templatePresent&&(template.templatePresent=!1,template.loadNextTemplates())},listViewPreviewFrameHt:function(){var e=$("#previewIframe"),t=$("#mtpwheader").outerHeight()+$("#nTpFoot").outerHeight();t?e.css({height:renderingUtils.windowHeight-Math.round(e.offset().top+t)}):e.css({height:renderingUtils.windowHeight-Math.round(e.offset().top+30)})},listViewScroll:function(){$L("#tempctnList").scrollTop()>0?$(".tempTableHead").addClass("nTHeadShadow"):$(".tempTableHead").removeClass("nTHeadShadow"),template.checkDocumentBottom()&&template.templatePresent&&(template.templatePresent=!1,template.loadNextTemplates())},checkDocumentBottom:function(){var e=$L("#tempctnList");return e.scrollTop()+e.innerHeight()+80>=e[0].scrollHeight},tempCtnAreaScroll:function(){$(".templateCtnArea").length>0&&($("#templatePreviewSection .tempCtnArea").offset().top>$(".templateInner").offset().top?$("#templatePreviewSection .pwheader").addClass("nTHeadShadow"):$("#templatePreviewSection .pwheader").removeClass("nTHeadShadow"))},nTSearchTempFocus:function(e){if(!template.isTemplateComponent){var t=$(e);""!==t.val()||t.hasClass("w240")?t.removeClass("w240"):t.addClass("w240")}},nTSearchTempBlur:function(e){if(!template.isTemplateComponent){var t=$(e);""!==t.val()||t.hasClass("selectNearSearch")?t.addClass("w240"):t.removeClass("w240")}},showComp_PreviewTemplate:function(e){$(".templistSection").addClass("previewAdded");var t=Crm.getCrmBasePath()+"/Template.do?step=previewTemplate",a=csrfParamName+"="+encodeURIComponent(csrfToken),n=$(e).closest("tr").attr("templateId");a+="&templateId="+encodeURIComponent(n),a+="&from=templateComponent",a+="&inventory="+template.inventory,template.templatePostCall("comp_previewTemplate",t,a)},tableCtnOver:function(e){if(!$(e).hasClass("cCheckSel")){$(e).find(".tdbottom").css("display","none");var t=$(e).prev();t.find(".tdbottom").css("display","none"),$(e).find(".rightLabel,.tempPreview,.tempPreviewNew").removeClass("vH"),$(e).addClass("selectedRow"),t.addClass("beforeSelected")}},tableCtnOut:function(e){!0!==$(e).find('input[type="checkbox"]').is(":checked")&&$(e).find(".rightLabel").addClass("vH"),$(e).find(".tdbottom").css("display","");var t=$(e).prev();t.find(".tdbottom").css("display",""),$(e).find(".tempPreview,.tempPreviewNew").addClass("vH"),$(e).removeClass("selectedRow"),t.removeClass("beforeSelected")},editPreviewNew:function(e){var t=$L("#templatePreviewDIV");t.length>0&&t.removeClass("templatePreviewDIVZInd");var a=$L("#freezeBackGround");a.length>0&&a.removeClass("freezeBackGroundZInd");var n=$(e).closest("tr").attr("templateid");void 0===n&&(n=$(e).parent().attr("templateId"));if(template.isTemplateComponent||Crm.trackSpotLightAction("Template - Edit Template"),template.isTemplateComponent||template.isTemplatePreview){var i=Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=email&step=editEmailTemplate&emailTemplateId="+n;template.inventory&&(i=Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=inventory&step=editInventoryTemplate&emailTemplateId="+n),template.isTemplatePreview?template.compClosePreviewPop():template.hideAnimatePopup("templatePreviewDIV"),openNewTab(i,"template")}else{template.removePreviewHistory(),template.inventory?Lyte.Router.transitionTo({route:"crm.settings.section.crm-templates",queryParams:{type:"inventory",step:"edit",templateId:n}}):Lyte.Router.transitionTo({route:"crm.settings.section.crm-templates",queryParams:{type:"email",step:"edit",templateId:n}});var o="crm.templates.email.templates";template.inventory&&(o="crm.label.inventory.template"),document.title=I18n.getMsg("crm.title.general",[I18n.getMsg(o,Crm.partnerName),Crm.partnerName])}thirdPartyUtils.bindSelect2("#selectFolders"),$(".tempAnimated").removeClass("tempAnimated"),$(".w0Imp").removeClass("w0Imp")},searchInAllFolders:function(e){var t=$("#nTSearchTemp");if(e&&(t.val(""),$("#nTcloseIcon").css("display","none"),template.lastSearchStr=""),e||!e&&""!==t.val().trim()){if(template.isTemplateComponent){var a=$("#nTfolderOptions");a.val(a.find("option").eq(0).val()),thirdPartyUtils.bindSelect2("#nTfolderOptions")}else{var n=$("#folderSortable"),i=n.find("li");i.removeClass("selectedFolder"),n.find("li a").addClass("crmBaseColor"),$(i.eq(0)).addClass("selectedFolder").find("a").removeClass("crmBaseColor")}if(!template.isTemplateComponent){var o=$("#folderSortable .selectedFolder").attr("folderId"),r=$("#templatemodules").val();"All Modules"===r&&(r=void 0),"All Templates"===o&&(o=void 0);var s="crm.templates.email.templates";template.inventory&&(s="crm.label.inventory.template"),document.title=I18n.getMsg("crm.title.general",[I18n.getMsg(s,Crm.partnerName),Crm.partnerName])}template.searchTemplate(t[0],template.lastSearchStr,!0)}},showTemplate:function(e,t){""!==$(t).val()?$("#nTcloseIcon").css("display",""):$("#nTcloseIcon").css("display","none");var a=t.value;setTimeout((function(){template.searchTemplate(t,a)}),500)},searchTemplate:function(e,t,a){if(t===e.value&&(a||t!==template.lastSearchStr)&&(a||""!==template.lastSearchStr.trim()||""!==t.trim())){if(template.lastSearchStr=e.value,t===template.lastSearchStr){var n=void 0;n=template.isTemplateComponent?$("#nTfolderOptions").val():$("#folderSortable .selectedFolder").attr("folderId");var i="true"===$("#consentTemplatesOnly").val(),o=$("#templatemodules").val(),r=Crm.getCrmBasePath()+"/Template.do?step=searchEmailTemplates",s=csrfParamName+"="+encodeURIComponent(csrfToken),l=$L("email-notification");("undefined"!=typeof automationActions&&null!==automationActions.isBulkEmail&&automationActions.isBulkEmail||l&&l[0]&&l[0].component.data.isBulkEmail)&&(s+="&skiptemplatesnames="+encodeURIComponent("consent_linked,unsubscribe_linked,zurvey_linked")),n&&(s+="&selectedfolder="+encodeURIComponent(n)),s+="&selectedmodule="+encodeURIComponent(o),""!==e.value.trim()&&(s+="&searchText="+encodeURIComponent(e.value)),s+="&inventory="+template.inventory,i&&(s+="&consentTemplatesOnly=true"),s+=template.addFilterTagsParams(),""!==template.relatedModule&&(s+="&relatedModule="+encodeURIComponent(template.relatedModule)),template.isTemplateComponent||""===e.value||"All Templates"!==n&&"Favorite"!==n&&"SharedWithMe"!==n&&"CreatedByMe"!==n&&"Associated"!==n?template.isSearch=!1:template.isSearch=!0;var d={};template.isTemplateComponent&&(s+="&from=templateComponent",a&&""===$("#nTSearchTemp").val().trim()&&(d.isRefresh=!0)),template.templatePostCall("search",r,s,d)}$("#nTsearchResults").html("'"+$ESAPI.encoder().encodeForHTML(t)+"'")}},closeSearchResults:function(){$("#searchMoreDIV").css("display","none"),template.refreshListScroll()},refreshListScroll:function(){var e=$("#tempctnList");e.height(renderingUtils.windowHeight-Math.round(e.offset().top+32+16)),thirdPartyUtils.unbindPerfectScroll("#tempctnList"),thirdPartyUtils.bindPerfectScroll("#tempctnList",{wheelSpeed:1,preventOnEnd:!1,preventHorizontal:!1}),e.addClass("oH"),thirdPartyUtils.bindPerfectScrollUpdate("#tempctnList")},refreshTemplatesList:function(){template.searchInAllFolders(!0)},loadNextTemplates:function(){var e=void 0;e=template.isTemplateComponent?$("#nTfolderOptions").val():$("#folderSortable .selectedFolder").attr("folderId");var t=$("#templatemodules").val(),a="true"===$("#consentTemplatesOnly").val(),n=Crm.getCrmBasePath()+"/Template.do?step=loadNextTemplates",i=csrfParamName+"="+encodeURIComponent(csrfToken),o=$L("email-notification");("undefined"!=typeof automationActions&&null!==automationActions.isBulkEmail&&automationActions.isBulkEmail||o&&o[0]&&o[0].component.data.isBulkEmail)&&(i+="&skiptemplatesnames="+encodeURIComponent("consent_linked,unsubscribe_linked,zurvey_linked")),e&&(i+="&selectedfolder="+encodeURIComponent(e)),i+="&selectedmodule="+encodeURIComponent(t),a&&(i+="&consentTemplatesOnly=true"),i+=template.addFilterTagsParams();var r=$("#nTSearchTemp").val();if(""!==r.trim()&&(i+="&searchText="+encodeURIComponent(r)),i+="&inventory="+template.inventory,template.isTemplateComponent){(d=$("#sortByNameComp")).hasClass("sortTDesc")?i+="&sort=desc_name":d.hasClass("sortTAsc")&&(i+="&sort=asc_name")}else{var s=$("#OrderByModified"),l=$("#OrderByUsage"),d=$("#OrderByName");s.find(".dArwNewUpOn").hasClass("dArwNewUpOff")&&!s.find(".dArwNewDownOn").hasClass("dArwNewDownOff")?i+="&sort=desc_modified":s.find(".dArwNewDownOn").hasClass("dArwNewDownOff")&&!s.find(".dArwNewUpOn").hasClass("dArwNewUpOff")?i+="&sort=asc_modified":l.find(".dArwNewUpOn").hasClass("dArwNewUpOff")&&!l.find(".dArwNewDownOn").hasClass("dArwNewDownOff")?i+="&sort=desc_usage":l.find(".dArwNewDownOn").hasClass("dArwNewDownOff")&&!l.find(".dArwNewUpOn").hasClass("dArwNewUpOff")?i+="&sort=asc_usage":d.find(".dArwNewUpOn").hasClass("dArwNewUpOff")&&!d.find(".dArwNewDownOn").hasClass("dArwNewDownOff")?i+="&sort=desc_name":d.find(".dArwNewDownOn").hasClass("dArwNewDownOff")&&!d.find(".dArwNewUpOn").hasClass("dArwNewUpOff")&&(i+="&sort=asc_name")}template.isTemplateComponent&&(i+="&from=templateComponent");var m=(template.isTemplateComponent?$(".chTempTable"):$(".tempTableCtn")).find("tr");i+="&fromIndex="+(parseInt(m.length)+1),template.templatePostCall("loadNextTemplates",n,i)},setWhiteFreezeLayer:function(){$("#freezeBackGround").css({opacity:"0.2",backgroundColor:"var(--freezeLayerBg)"})},titleForEllipsis:function(e){$(e).off("mouseenter").on("mouseenter",(function(){var e=$(this);e.removeAttr("title"),this.offsetWidth<Math.floor(this.scrollWidth)&&this.offsetWidth!==Math.floor(this.scrollWidth)&&e.attr("title",$.trim(e.text()))}))},listTemplatesByFolder:function(){var e=$("#nTfolderOptions").val(),t=$("#templatemodules").val(),a="true"===$("#consentTemplatesOnly").val(),n=Crm.getCrmBasePath()+"/Template.do?step=getTemplatesList",i=csrfParamName+"="+encodeURIComponent(csrfToken),o=$L("email-notification");("undefined"!=typeof automationActions&&null!==automationActions.isBulkEmail&&automationActions.isBulkEmail||o&&o[0]&&o[0].component.data.isBulkEmail)&&(i+="&skiptemplatesnames="+encodeURIComponent("consent_linked,unsubscribe_linked,zurvey_linked")),e&&(i+="&selectedfolder="+encodeURIComponent(e)),i+="&selectedmodule="+encodeURIComponent(t),i+="&from=templateComponent",i+="&inventory="+template.inventory,i+="&consentTemplatesOnly="+a,i+=template.addFilterTagsParams();var r=$("#parentModule").val();validationUtils.isNotEmpty(r)&&(i+="&parentModule="+r),template.templatePostCall("templatelist",n,i),$("#nTSearchTemp").val(""),$("#nTcloseIcon").css("display","none"),template.lastSearchStr="",template.isSearch=!1},makeFavorite:function(e){var t;t=!$(e).hasClass("selectedFav");var a=void 0;a=template.isTemplateComponent?$("#nTfolderOptions").val():$("#folderSortable .selectedFolder").attr("folderId");var n={};n.selectedfolder=a,n.isfavorite=t,n.currElem=$(e);var i=$(e).closest("tr");n.selectedRow=i;var o=Crm.getCrmBasePath()+"/Template.do?step=makeFavorite",r=csrfParamName+"="+encodeURIComponent(csrfToken);r+="&inventory="+template.inventory,r+="&isFavorite="+encodeURIComponent(t),r+="&emailTemplateId="+encodeURIComponent(i.attr("templateid")),template.templatePostCall("favorite",o,r,n)},makeFavoriteFont:function(e,t){var a=$(e),n=!0;n=!a.hasClass("selectedFav");var i={};i.isfavorite=n,i.currElem=a,i.selectedFont=t;var o=Crm.getCrmBasePath()+"/Template.do?step=makeFavoriteFont",r=csrfParamName+"="+encodeURIComponent(csrfToken);r+="&inventory="+template.inventory,r+="&isFavoriteFont="+encodeURIComponent(n),r+="&selectedFont="+encodeURIComponent(i.selectedFont),template.templatePostCall("favoriteFont",o,r,i)},closePreview:function(e,t){$("#tabSection").css("opacity","1");var a=$L("#templatePreviewDIV");a.length>0&&a.removeClass("templatePreviewDIVZInd");var n=$L("#freezeBackGround");if(n.length>0&&n.removeClass("freezeBackGroundZInd"),template.isTemplateComponent||"comp_preview"===t||"preview"===t)"preview"!==t?(template.hideAnimatePopup("templatePreviewDIV"),$(".templistSection").removeClass("previewAdded")):(template.isTemplateComponent||template.isTemplatePreview||template.restoreEditorselection(),template.compCloseComponentPop());else{var i=$(".tempTableCtn");if($("#tempctnList").add(i.find("tr td").eq(0)).css("width",""),i.removeClass("tdhide"),$(".tempAnimated").removeClass("tempAnimated"),$("#nTattachArea").removeClass("tempAnimated"),$(".leftCtnPreview").hide(),"closeEdit"!==t&&$(".templistSection").hasClass("previewAdded")){if($(".tempTable").find("tbody").find("tr").removeClass("selectedRow beforeSelected cSelect cbefSelect cCheckSel"),"tempCheckHeader"!==e.attr("id")){var o=e.closest("tr");o.addClass("cSelect"),o.prev().addClass("beforeSelected cbefSelect")}}else"closeEdit"===t&&i.find("tbody").find("tr").removeClass("selectedRow beforeSelected cSelect cbefSelect cCheckSel");template.removePreviewHistory(),setTimeout((function(){template.setlistViewPage()}),400),$(".templistSection").removeClass("previewAdded");var r=$(".tempLeft, .setupleftmenutd, #setup_new_leftmenuDiv");r.add(".leftCtnTemp").css("display","").removeClass("w0Imp"),$(".bottomSettingsbar").clearQueue().stop(!0).fadeIn(700),r.add(".moduleSection,.moveDeleteSection,#tabSection").css("display",""),$("#nTTemplateListDIV #templatePreviewSection #templatePreviewSectionContent").html("")}var s=$("#result #searchMoreDIV");s.length>0&&""!==$("#result #nTSearchTemp").val()&&s.css("display",""),$(".mm-main-container").is(":visible")&&($L("#followUppopup").is(":visible")||$L("#templateComponentDIV").is(":visible")||$("#freezeBackGround").hide()),0===$("#nTTemplateListDIV").length&&1===$("#emailEntityComposepopup").length&&(Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()?EmailUtil.hideEditorFreezeLayer():renderingUtils.removeFreezeLayer())},mtAtachOpen:function(){var e=$(".mailtempAttach");template.isTemplatePreview||template.isTemplateComponent?e.css({top:$("#tempCtnArea").position().top}):e.css({top:$("#tempCtnArea").offset().top-5}),$(".previewPageTabOuter").find("ul").slideUp(100),e.slideDown(300)},mtAtachClose:function(){var e=$(".mailtempAttach");e.length>0&&e.slideUp()},compCreateNewTemplate:function(){var e={type:"email",step:"new",module:$("#templatemodules").val(),fromComponent:"true"};""!==template.relatedModule&&(e.relatedModule=template.relatedModule),template.inventory&&(e.type="inventory"),template.isTemplateEditorEnabled&&(e.step="showGallery"),$("#templateRefreshLink").css("display","");var t=Lyte.Router.getURL({route:"crm.settings.section.crm-templates",queryParams:e,dynamicParams:[]});openNewTab(t,"template")},selectTemplate:function(e,t){var a=$(e),n=a.closest("tr"),i=null,o=document.getElementById("emailTemplateId");null!==o&&(o.classList.value=""),e.classList.contains("zurvey_linked")&&null!==o&&o.classList.add("zurvey_linked"),e.classList.contains("unsubscribe_linked")&&null!==o&&o.classList.add("unsubscribe_linked"),e.classList.contains("consent_linked")&&null!==o&&o.classList.add("consent_linked"),i="followup"===t?$("#followUppopup #"+template.templateIdentifier):$("#"+template.templateIdentifier);var r=template.featureName;if("Macro_Dtl"===r&&(r="Macro"),i.length>0||"Macro"===r){var s;s="preview"!==t?n.attr("templateId"):a.attr("templateId"),i.val(s),i.attr("encid",s);var l,d=i.siblings(".templateName").find("a");if("preview"!==t?(l=a.find(".comp_nTtempName").text().trim(),d.attr("class","choosedtemplateName"),d.html($ESAPI.encoder().encodeForHTML(l))):d.html($ESAPI.encoder().encodeForHTML(a.attr("templateName"))),template.titleForEllipsis(d),d.attr({onclick:"template.showTemplatePreview('"+s+"','"+r+"','"+template.popToClose+"');return false",href:Crm.getCrmBasePath()+"/settings/templates?type=email&templateId="+s}),i.siblings(".clearTemplate").css("display",""),template.compCloseComponentPop(),void 0!==template.callback&&""!==template.callback)if("LyteTriggerEvent"===template.callback)Lyte.triggerEvent("emailTemplateListener",{id:s,name:l});else new Function(template.callback)();""!==template.eventName&&Lyte.triggerEvent(template.eventName,l,s);var m=$("#mailServerTypeDiv_comp1"),c=$("#mailServerTypeDiv_comp2");if("WebForm"===template.featureName){c.addClass("hide"),m.removeClass("hide");var u=m.find("#crmMailServerType");m.find("#smtpMailServerType").is(":checked")||u.is(":checked")||u.click()}else if("WebFormAck"===template.featureName){m.addClass("hide"),c.removeClass("hide");var p=c.find("#crmMailServerType");c.find("#smtpMailServerType").is(":checked")||p.is(":checked")||p.click()}else"AutoResponse"===template.featureName&&(m.removeClass("hide"),m.show());if("WorkFlowAlert"!==template.featureName&&"ProcessFlow"!==template.featureName&&"wizard"!==template.featureName&&"ApprovalProcess"!==template.featureName){if($("."+template.templateIdentifier+"_fromTR").css("display",""),"none"===$("."+template.templateIdentifier+"_replyLink").css("display")){$("."+template.templateIdentifier+"_replyTR").css("display","");var f=$("."+template.templateIdentifier+"_replyType");if("4"===f.val()){var v=f.siblings(".otherEmailWarning"),h=[];h[0]=v.attr("replyToDueDays");var g=i.find("option:selected").text().trim();h[1]=Crm.getCrmBasePath()+"/ShowSetup.do?action=orgEmail&tab=general&subTab=orgEmail&email="+g,h[2]=$ESAPI.encoder().encodeForHTML(g),h[3]=Crm.appName;var C=I18n.getMsg("crm.template.other.emails.warning.msg.new",h);"false"===v.attr("orgEmailAvail").trim()&&(C=I18n.getMsg("crm.template.other.emails.warning.msg_free.new",h)),v.find(".otherEmailWarningMsg").html(C),v.css("display","")}}if("ConsentMail"===template.featureName||"MassMail"===template.featureName||"reminderToOwner"===template.featureName){var b=$(".snd_btn");b.removeClass("parOpacity"),"ConsentMail"===template.featureName?b.attr("onclick",'sendQuickMail("true")'):template.isCrmCampaignMail?b.attr("onclick","sendQuickMail(false, true)"):b.attr("onclick","sendQuickMail()")}if("ConsentMail"===template.featureName||"MassMail"===template.featureName||"MassMail_Tool"===template.featureName){var w=n.find(".comptemplateFromAddress"),y=n.find(".comptemplateReplyAddress"),I=w.attr("fromAddress"),L=w.attr("fromEmail"),T=w.attr("fromType"),R=y.attr("replyAddress"),N=y.attr("replyEmail"),P=y.attr("replyType");template.addFromReplyToAddressFromTemplate(I,L,T,R,N,P)}}null===r||!r.toLowerCase().includes("autoresponder")&&"WebFormAck"!==r&&"AutoResponse"!==r&&"MassMail"!==r&&"WebForm"!==r&&"MassMail_unification"!==r&&"Macro"!==r&&"ConsentMail"!==r||Lyte.registeredMixins["crm-email-auth-util"].setReplyToDropAfterTemplateSelect(template.featureName)}},addFromReplyToAddressFromTemplate:function(e,t,a,n,i,o){var r=$("#fromAddress"),s=$("#fromType"),l=$("#replyToAddress"),d=$("#replyType");(r.find(".templateAddress").remove(),l.find(".templateAddress").remove(),""!==e&&"$(Record.Owner.Email)"!==e.trim()&&"$(Current.User.Email)"!==e.trim())&&$("<optgroup class='templateAddress' label='"+I18n.getMsg("crm.template.template.emails")+"'><option value='"+e+"' type='"+a+"'>"+$ESAPI.encoder().encodeForHTML(t)+"</option></optgroup>").appendTo(r);""!==n&&$("<optgroup class='templateAddress' label='"+I18n.getMsg("crm.template.template.emails")+"'><option value='"+n+"' type='"+o+"'>"+$ESAPI.encoder().encodeForHTML(i)+"</option></optgroup>").appendTo(l);null===r.val()&&(r.find("option").eq(0).prop("selected",!0),s.val("0")),null===l.val()&&(l.val(""),d.val("")),r.next(".select2").remove(),thirdPartyUtils.bindSelect2(r,{minimumResultsForSearch:1/0}),l.next(".select2").remove(),thirdPartyUtils.bindSelect2(l,{minimumResultsForSearch:1/0})},selectAddress:function(e,t,a,n,i,o){var r=$("#fromAddress"),s=$("#fromType"),l=$("#replyToAddress"),d=$("#replyType");r.val(e),s.val(t),l.val(a),d.val(n);var m=$("#smtpFromAddress");m.length>0&&m.val(i);var c=$("#smtpReplytoAddress");c.length>0&&c.val(o),null===r.val()&&(r.find("option").eq(0).prop("selected",!0),s.val("0")),null===m.val()&&m.find("option").eq(0).prop("selected",!0),null===l.val()&&(l.val(""),d.val("")),null===c.val()&&c.val(""),r.next(".select2").remove(),thirdPartyUtils.bindSelect2(r,{minimumResultsForSearch:1/0}),m.length>0&&(m.next(".select2").remove(),thirdPartyUtils.bindSelect2(m,{minimumResultsForSearch:1/0}),c.next(".select2").remove(),thirdPartyUtils.bindSelect2(c,{minimumResultsForSearch:1/0})),l.next(".select2").remove(),thirdPartyUtils.bindSelect2(l,{minimumResultsForSearch:1/0}),""===l.val()&&($("#replyToTR").css("display","none"),$("#replyToLink").css("display","")),""===c.val()&&($("#smtpReplytoTR").css("display","none"),$("#smtpReplyToLink").css("display",""))},setFromAddress:function(e){if("CRM"===$(e).val())$(".smtpAddressPopWin").addClass("hide"),$(".defaultTemplateEmailLoader").removeClass("hide");else{var t=$("#smtpFromAddress"),a=$("#smtpReplytoAddress");a.val(a.val()),t.val(t.val()),$("#mailServerTypeDiv_comp1").hasClass("hide")?$("#smtpAddressPopWin_comp2").removeClass("hide").show():$("#smtpAddressPopWin_comp1").removeClass("hide").show(),$(".emailTemplateId_replyLink").show(),$(".defaultTemplateEmailLoader").addClass("hide"),$("[name=webtoleadForm]").html()||$(".smtpAddressPopWin").removeClass("hide");var n=$(e).attr("purpose");if(n){var i=$("#smtpReplytoTR_"+n);i.hasClass("hide")||"none"===i.css("display")?$("#smtpReplyToLink_"+n).removeClass("hide").css("display",""):$("#smtpReplyToLink_"+n).addClass("hide")}t.length>0&&(t.next(".select2").remove(),thirdPartyUtils.bindSelect2(t,{minimumResultsForSearch:1/0}),a.next(".select2").remove(),thirdPartyUtils.bindSelect2(a,{minimumResultsForSearch:1/0})),""===a.val()&&($("#smtpReplytoTR").css("display","none"),$("#smtpReplyToLink").css("display",""))}},showServerDetails:function(){$("#mailServerTypeDiv").removeClass("hide")},compCloseComponentPop:function(){"Macro"!==template.featureName&&"ConsentMail"!==template.featureName&&"MassMail"!==template.featureName&&"reminderToOwner"!==template.featureName&&"AutoResponder_Pop"!==template.featureName&&"WebForm"!==template.featureName&&"ApprovalProcess"!==template.featureName&&"ApprovalProcess_RE1"!==template.featureName&&"ApprovalProcess_RE2"!==template.featureName&&"viewTemplate_fz"!==template.featureName?template.hideAnimatePopup("templateComponentDIV",!0):template.hideAnimatePopup("templateComponentDIV"),template.hideAnimatePopup("templatePreviewDIV"),$(document.body).css("overflow","auto"),""!==template.popToClose&&""!==template.popzindex&&$("#"+template.popToClose).css("z-index",template.popzindex),$("#templateComponentDIV,#templatePreviewDIV").empty()},compClosePreviewPop:function(){"Macro"!==template.featureName&&"ConsentMail"!==template.featureName&&"MassMail"!==template.featureName&&"reminderToOwner"!==template.featureName&&"AutoResponder_Pop"!==template.featureName&&"WebFormNotify"!==template.featureName&&"WebForm"!==template.featureName&&"WebFormAck"!==template.featureName&&"ApprovalProcess"!==template.featureName&&"ApprovalProcess_RE1"!==template.featureName&&"ApprovalProcess_RE2"!==template.featureName&&"viewTemplate_fz"!==template.featureName?template.hideAnimatePopup("templatePreviewDIV",!0):template.hideAnimatePopup("templatePreviewDIV"),$(document.body).css("overflow","auto"),""!==template.popToClose&&""!==template.popzindex&&$("#"+template.popToClose).css("z-index",template.popzindex)},newshowtt:function(e,t,a){var n=renderingUtils.windowHeight,i=$(e),o=$(e).outerHeight(),r=i.height(),s=i.attr("overtext"),l=$(".tooltip-temp"),d=$("#templatePreviewDIV").offset().left,m=i.offset().left,c=i.offset().top,u=i.innerHeight(),p=i.outerHeight(),f=i.outerWidth(),v=$("#emailEditor").offset().top;l.html($ESAPI.encoder().encodeForHTML(s));var h=l.outerHeight(),g=l.outerWidth();if(l.removeClass("ddHelpTTcen_top ddToolEditor sIqWrap w400"),"center"===t&&void 0===a)if($(e).closest("div").has(".prevActBtn")){if(l.text().length<=20)var C=m-d;else C=m-d-l.innerWidth();var b=c+o+6;l.show()}else C=m+11-g/2,b=c+o+6;else if("left"===t&&void 0===a)C=m+11,b=c+o+10;else if("right"===t&&"bottom"===a){C=m-l.innerWidth()/2,b=c+o+17;var w=n-($("#wmschatbar").outerHeight()+17);l.removeClass("bottomTip"),isChatEnabled&&b+28>=w&&(l.addClass("bottomTip"),b=c-37),l.removeClass("TTcen_top TTcen_bot TTcen_left"),l.addClass("TTright_bot")}else if("center"===t&&"top"===a){C=m+11-g/2,b=c-(o+h-2);l.removeClass("TTright_bot TTcen_bot TTcen_left"),l.addClass("TTcen_top")}else if("center"===t&&"bottom"===a){C=m+15-g/2;if(!0===isChatEnabled)if(n-28<=(b=c+(h+u+28))){var b=c-h-16;l.removeClass("TTright_bot TTcen_bot TTcen_left"),l.addClass("TTcen_top")}else b=c+(h+u)+3,i.hasClass("sIq")&&(b=c+40+(h+u),C=m+3-g/2,l.addClass("sIqWrap w400")),l.removeClass("TTright_bot TTcen_top TTcen_left"),l.addClass("TTcen_bot");else if(n<=(b=c+h+u)){b=c-h-16;l.removeClass("TTright_bot TTcen_bot TTcen_left"),l.addClass("TTcen_top")}else{b=c+(h+u)+3;l.removeClass("TTright_bot TTcen_top TTcen_left"),l.addClass("TTcen_bot")}}else if("left"===t&&"bottom"===a){C=m,b=c+(h+u);if("galback"===i.attr("id")){b=c+(r+7);l.addClass("TTleft_top")}else b=c+(h+u);l.removeClass("TTright_bot TTcen_top TTcen_left TTcen_bot TTleft_top")}else if("center"===t&&"bottomMD"===a){C=m-g/2+16,b=c+(h+u-8);l.removeClass("TTright_bot TTcen_top TTcen_left"),l.addClass("TTcen_bot")}else if("center"===t&&"left"===a){C=m-(g+10),b=c+h/2;l.removeClass("TTright_bot TTcen_top TTcen_top"),l.addClass("TTcen_left")}else if("center"===t&&"leftAsso"===a){C=m-(g+10),b=c+h/2-7;l.removeClass("TTright_bot TTcen_top TTcen_top"),l.addClass("TTcen_left")}else if("center"===t&&"top1"===a){C=m+15-g/2,b=c-h-6;l.removeClass("TTright_bot TTcen_bot TTcen_left"),l.addClass("TTcen_top")}if(i.hasClass("nTascWrap")&&$(".associatePopup").is(":visible"))l.hide();else if(i.closest("#templateTakeTourEdit").length>0){l.removeClass("TTright_bot TTcen_bot TTcen_left"),l.addClass("TTcen_top ddToolEditor");var y=c+v-(h/2+p/2+10);C=m+f/2-g/2;i.hasClass("tHelp")?l.addClass("ddHelpTTcen_top"):l.removeClass("ddHelpTTcen_top"),l.css({top:y+"px",left:C+"px"}).clearQueue().stop().delay(500).fadeIn()}else l.css({top:b+"px",left:C+"px"}).clearQueue().stop().delay(500).fadeIn()},newhidett:function(){$(".tooltip-temp").clearQueue().stop().delay(100).hide()},setCustomTab:function(e){$("#nTcustominnerTab").remove();var t="";t+='<table id="nTcustominnerTab" class="w100_per" cellspacing="0" cellpadding="0">',t+="<tbody>",t+="<tr>",t+='<td class="pL25 pR20  crm-heading-font-size crmBaseColor mT5" id="mailTemp" style="width: 10%;white-space: nowrap;">'+I18n.getMsg("crm.label.templates")+"</td>",t+='<td class="w90_per">',t+='<div class="oH" style="height: 60px;">',t+='<div id="tabSection" style="overflow: hidden;padding: 13px 0;">',t+='<div class="fL mT3">',t+='<ul class="m0 p0 nTTabClass oH secondaryTabNewView" id="nTTabClass">',t+="<li class='m0 p0 fL' id='emailTemplates' data-zcqa='custom_email' data-permission='true' >",t+="<link-to lt-prop-route='crm.settings.section.crm-templates' lt-prop-qp='{\"type\" : \"email\" }'>"+I18n.getMsg("Email")+"</link-to></li>",template.inventoryAvail?t+="<li class='m0 p0 fL' id='inventoryTemplates' data-zcqa='custom_inventory' data-permission='true'>":t+="<li style='pointer-events:none;opacity:0.2' class='m0 p0 fL' id='inventoryTemplates' data-zcqa='custom_inventory' data-permission='true'>",t+="<link-to lt-prop-route='crm.settings.section.crm-templates' lt-prop-qp='{\"type\" : \"inventory\" }'>"+I18n.getMsg("Inventory")+"</link-to></li>",template.mailmergeAvail?t+="<li class='m0 p0 fL' id='mailmergeTemplates'  data-zcqa='custom_mailmerge'  data-permission='true'>":t+="<li style='pointer-events:none;opacity:0.2' class='m0 p0 fL' id='mailmergeTemplates'  data-zcqa='custom_mailmerge'  data-permission='true' >",t+="<link-to lt-prop-route='crm.settings.section.crm-templates' lt-prop-qp='{\"type\" : \"mail-merge\" }' lt-prop-custom><a>"+I18n.getMsg("crm.mail.merge")+"</a></link-to></li>",t+="</ul>",t+="</div>",t+="</div>",t+="</div>",t+="</td>",t+="</tr>",t+="</tbody>",t+="</table>";var a=$(t);$("#setupInnerLinks").hide(),$("#result").prepend(a),"email"===e?$("#emailTemplates").addClass("seltab"):"inventory"===e?$("#inventoryTemplates").addClass("seltab"):"mailmerge"===e&&$("#mailmergeTemplates").addClass("seltab")},showEmptyTemplateMsg:function(){var e=void 0,t=void 0;if(template.isTemplateComponent?(e=$(".chTempTable"),t=$("#nTfolderOptions").val()):(e=$(".tempTableCtn"),t=$("#folderSortable .selectedFolder").attr("folderId")),e.find("tr").length<=0){$("#searchMoreDIV").css("display","none");var a="<div  class='crm-heading-font-size crmNotFoundColor pT40 aligncenter'>";a+="<div class='emptyTemplatesMsg'>",a+="</div>",a+="<div class='crm-small-font-size pT8 crm-font-regular searchInAllFolders' style='display:none'><a class='cP' onclick='template.searchInAllFolders()'>"+I18n.getMsg("crm.template.listview.search.empty.msg")+"</a></div>",a+="</div>",$("#tempctnList").html(a),""!==$("#nTSearchTemp").val().trim()?("All Templates"!==t&&$(".searchInAllFolders").css("display",""),$(".emptyTemplatesMsg").html(I18n.getMsg("crm.template.listview.search.no.results"))):template.inventory?$(".emptyTemplatesMsg").html(I18n.getMsg("crm.template.listview.no.inv.templates.msg")):$(".emptyTemplatesMsg").html(I18n.getMsg("crm.template.listview.no.templates.msg"))}},convertAsSysRefName:function(e){var t=template.mergefields;return CrmConvertMergeFields.convertMergeFieldsAsRequiredFormat(e,mergeFieldsConstants.fromlabel_to_api,t,!1,!1)},showEmailAnalyticsDetails:function(e){var t=Crm.getCrmBasePath()+"/Template.do?step=emailTrackingDetails",a=csrfParamName+"="+encodeURIComponent(csrfToken);a+="&templateId="+encodeURIComponent($(e).attr("templateId")),template.templatePostCall("emailTrackingDetails",t,a)},closeSearch:function(e,t){$(e).hide(),template.isTemplateComponent?$("#"+t).val("").keyup():$("#"+t).val("").removeClass("w240").keyup()},showAnimatePopup:function(e,t){setTimeout((function(){$("#"+e).show()}),10),t&&renderingUtils.showFreezeLayer(),setTimeout((function(){var t=$L("#"+e);t.addClass("zcrm-show"),"templateAlertsPop"===e&&$("#templateAlertsPop").is(":visible")&&$("#freezeBackGround").removeAttr("onclick"),crmui.modalZIndex("nonLyte",t[0],"open")}),300)},hideAnimatePopup:function(e,t){t&&(Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()&&e&&"templateComponentDIV"===e?EmailUtil.hideEditorFreezeLayer():renderingUtils.hideFreezeLayer());var a=$("#"+e),n=a.height(),i=$("#freezeBackGround");if("templateAlertsPop"===e&&(template.restoreEditorselection(!0),i[0].setAttribute("onclick","javascript:sE(event);")),$("#followUppopup").is(":visible")&&i.show(),"nTcancelPop"!==e&&"nTbackToGalleyPop"!==e&&"nTEmailAnalyticsDIV"!==e||template.restoreEditorselection(),$("#nTsaveBtn").removeClass("pEvents"),a.css({top:"-"+2*n+"px"}),setTimeout((function(){$(".zcrm-show").removeClass("freezeEvt"),a.removeClass("zcrm-show").css({top:"0px",display:"none"}).width("")}),200),Crm.userDetails.isKeyboardShortcutsEnabled){var o=Lyte.registeredMixins["crm-keyboard-shortcutsmixin"];o.routeChange&&Crm.userDetails.isKeyboardShortcutsEnabled&&event.target.className.includes("newPopupCloseIcon")&&(o.routeChange=!1,o.moduleData={})}crmui.modalZIndex("nonLyte",a[0],"close")},ascdsc:function(e){var t=!0;if(template.isTemplateComponent){var a=$("#sortByNameComp");a.removeClass("sortTName"),a.hasClass("sortTAsc")?(a.removeClass("sortTAsc"),a.addClass("sortTDesc"),t=!1):a.hasClass("sortTDesc")?(a.addClass("sortTAsc"),a.removeClass("sortTDesc"),t=!0):(a.addClass("sortTAsc"),t=!0)}else{var n=$(".ascdsc");0===n.index(e)?(n.eq(1).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(1).find(".dArwNewDownOn").addClass("dArwNewDownOff"),n.eq(2).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(2).find(".dArwNewDownOn").addClass("dArwNewDownOff")):1===n.index(e)?(n.eq(0).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(0).find(".dArwNewDownOn").addClass("dArwNewDownOff"),n.eq(2).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(2).find(".dArwNewDownOn").addClass("dArwNewDownOff")):(n.eq(0).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(0).find(".dArwNewDownOn").addClass("dArwNewDownOff"),n.eq(1).find(".dArwNewUpOn").addClass("dArwNewUpOff"),n.eq(1).find(".dArwNewDownOn").addClass("dArwNewDownOff"));var i=$(e).find(".dArwNewUpOn");i.hasClass("dArwNewUpOff")?(i.removeClass("dArwNewUpOff"),$(e).find(".dArwNewDownOn").addClass("dArwNewDownOff"),t=!0):($(e).find(".dArwNewDownOn").removeClass("dArwNewDownOff"),i.addClass("dArwNewUpOff"),t=!1)}var o=void 0;o=template.isTemplateComponent?$("#nTfolderOptions").val():$("#folderSortable .selectedFolder").attr("folderId");var r=$("#templatemodules").val(),s="true"===$("#consentTemplatesOnly").val(),l=Crm.getCrmBasePath()+"/Template.do?step=sortTemplatesList",d=csrfParamName+"="+encodeURIComponent(csrfToken),m=$L("email-notification");("undefined"!=typeof automationActions&&null!==automationActions.isBulkEmail&&automationActions.isBulkEmail||m&&m[0]&&m[0].component.data.isBulkEmail)&&(d+="&skiptemplatesnames="+encodeURIComponent("consent_linked,unsubscribe_linked,zurvey_linked")),d+="&inventory="+template.inventory,s&&(d+="&consentTemplatesOnly=true"),d+=template.addFilterTagsParams(),"OrderByModified"===e.id?d+=t?"&sort=asc_modified":"&sort=desc_modified":"OrderByUsage"===e.id?d+=t?"&sort=asc_usage":"&sort=desc_usage":"OrderByName"!==e.id&&"sortByNameComp"!==e.id||(d+=t?"&sort=asc_name":"&sort=desc_name"),template.isTemplateComponent&&(d+="&from=templateComponent"),o&&(d+="&selectedfolder="+encodeURIComponent(o)),d+="&selectedmodule="+encodeURIComponent(r);var c=$("#nTSearchTemp").val();""!==c.trim()&&(d+="&searchText="+encodeURIComponent(c)),template.templatePostCall("ascdsc",l,d)},templatePostCall:function(e,t,a,n,i){var o=new crmRequestPool;commonUtils.showHideLoadingDiv(!0),o.initiate({action:t,type:"POST",data:a,success:function(t){if(commonUtils.showHideLoadingDiv(!1),"templatelist"===e||"search"===e||"loadNextTemplates"===e||"ascdsc"===e){if("templatelist"===e||"search"===e)if(template.isTemplateComponent)$("#sortByNameComp").removeClass("sortTAsc sortTDesc").addClass("sortTName");else{var a=$("#OrderByModified"),o=$("#OrderByUsage"),r=a.find(".dArwNewUpOn");r.hasClass("dArwNewUpOff")||r.addClass("dArwNewUpOff");var s=a.find(".dArwNewDownOn");s.hasClass("dArwNewDownOff")||s.addClass("dArwNewDownOff");var l=o.find(".dArwNewUpOn");l.hasClass("dArwNewUpOff")||l.addClass("dArwNewUpOff");var d=o.find(".dArwNewDownOn");d.hasClass("dArwNewDownOff")||d.addClass("dArwNewDownOff");var m=$("#OrderByName"),c=m.find(".dArwNewUpOn");c.hasClass("dArwNewUpOff")||c.addClass("dArwNewUpOff");var u=m.find(".dArwNewDownOn");u.hasClass("dArwNewDownOff")||u.addClass("dArwNewDownOff")}if("loadNextTemplates"!==e){var p=!0,f=$(t).find("tr").length;f<1&&(p=!1),f<template.templatesperpage?template.templatePresent=!1:template.templatePresent=!0;var v=$L("#tempctnList");v.html(t);var h=void 0;if(template.isTemplateComponent)h=$("#nTfolderOptions").val();else(L=$("#tempCheckHeader")).attr("checked",!1),template.listChecked(L),h=$("#folderSortable .selectedFolder").attr("folderId");var g=$("#searchMoreDIV");g.css("display","none");var C=$("#nTSearchTemp");C.length>0&&""!==C.val().trim()&&p?(g.css("display",""),"All Templates"===h?$(".searchAllLink").css("display","none"):$(".searchAllLink").css("display","")):!p&&C.length>0&&""!==C.val().trim()&&("All Templates"!==h&&$(".searchInAllFolders").css("display",""),$(".emptyTemplatesMsg").html(I18n.getMsg("crm.template.listview.search.no.results")));var b=$("#templateRefreshLink");template.isTemplateComponent&&b.is(":visible")&&void 0!==n&&n.isRefresh&&b.css("display","none"),template.refreshListScroll(),v.scrollTop(0),$("#nTTemplateListDIV").find(".nteditIcon").on("click",(function(){template.editPreviewNew(this)}))}else{var w=document.createElement("div"),y=document.createElement("table"),I=document.createElement("tbody");y.appendChild(I),w.appendChild(y),$(I).html(t),$(w).find("tr").length<template.templatesperpage?template.templatePresent=!1:template.templatePresent=!0;var L=$("#tempCheckHeader");if(!template.isTemplateComponent&&(L.is(":checked")||""!==template.viewEmailTemplateId))for(var T=$(w).find("tr"),R=T.length,N=0;N<R;N++){var P=$(T.eq(N));L.is(":checked")&&"1"===P.attr("category")&&(P.find('input[type="checkbox"]').attr("checked",!0).addClass("selected"),P.find(".rightLabel").removeClass("vH"),P.addClass("cCheckSel")),""!==template.viewEmailTemplateId&&P.attr("templateId")===template.viewEmailTemplateId&&P.remove()}if((template.isTemplateComponent?$(".chTempTable"):$(".tempTableCtn")).find("tbody").append($(y).find("tbody").html()),!template.isTemplateComponent){var O=$('.tempTableCtn input[type="checkbox"]:checked').length;1===O?$("#selectedTemp").html(O+" "+I18n.getMsg("crm.template.listview.selected.msg1")):$("#selectedTemp").html(O+" "+I18n.getMsg("crm.template.listview.selected.msg2"))}$(w).remove(),template.templatePresent||template.showEmptyTemplateMsg()}"undefined"!=typeof loadListTemplateActions&&loadListTemplateActions()}else if("favorite"===e){var k=n.isfavorite;h=void 0;h=template.isTemplateComponent?$("#nTfolderOptions").val():$("#folderSortable .selectedFolder").attr("folderId");var A=n.selectedfolder,S=n.currElem;if(A===h&&(S.hasClass("selectedFav")?S.removeClass("selectedFav"):S.addClass("selectedFav"),"Favorite"===A&&!k)){if(!template.isTemplateComponent){var M=n.selectedRow.find('input[type="checkbox"]');M.is(":checked")&&(M.attr("checked",!1),template.listChecked(M))}var E=!1;if(n.selectedRow.nextAll("tr").length<10&&(E=!0),n.selectedRow.remove(),!template.isTemplateComponent&&$('.tempTableCtn input[type="checkbox"]:checked').length<=0)(L=$("#tempCheckHeader")).attr("checked",!1),template.listChecked(L);E&&template.templatePresent?(template.templatePresent=!1,template.loadNextTemplates()):template.templatePresent||template.showEmptyTemplateMsg()}}else if("favoriteFont"===e){var D;S=n.currElem;(D="htmlEditor"==template.editorType?S.parents("#ze_fontfamily").find("li").find("span"):S.parents("#zpfontnameDD").find("li").find("span")).removeClass("selectedFav dIB"),D.addClass("dN");k=n.isfavorite;var F="Arial, Helvetica, sans-serif";if(template.inventory?"htmlEditor"===template.editorType&&(F="times new roman,times,serif"):"htmlEditor"===template.editorType&&(F="Verdana,arial,Helvetica,sans-serif"),k?(S.removeClass("dN"),S.addClass("selectedFav dIB"),F="htmlEditor"===template.editorType?S.parent().attr("fntnme"):S.prev().attr("fntface")):(S.removeClass("selectedFav dIB"),S.addClass("dN")),"dragdropEditor"===template.editorType){var x=$("iframe[name=emailEditor]").contents();if(!template.inventory)x.find("#contentOuter").css({"font-family":F});x.find("#contentInner").css({"font-family":F})}else{(x=$("iframe[name=emailEditor]").contents().find(".ze_area").contents().find(".ze_body")).css({"font-family":F})}}else if("comp_previewTemplate"===e){if(0===(j=$("#templatePreviewDIV")).length){var _=document.createElement("div");_.setAttribute("id","templatePreviewDIV"),_.setAttribute("class","nTpop zcrm-modal zcrm-effect w980"),document.body.appendChild(_),j=$("#templatePreviewDIV")}var U,B=$L("crm-macro-ce")[0];B&&B.component&&j.css({"z-index":"10002"}),!template.inventory&&t.indexOf("</head>")>-1&&(U=t.substring(t.indexOf("<head>"),t.indexOf("</head>")+7),t=t.replace(U,"")),j.html(t),"sendMail"===template.featureName&&$(".nteditIcon").css("display","none"),template.showAnimatePopup("templatePreviewDIV"),setTimeout((function(){U&&($("iframe[id=previewIframe]").contents().find("head").html(U),$("iframe[id=mobileframe]").contents().find("head").html(U))}),410)}else if("emailTrackingDetails"===e){var j;if(0===(j=$("#templateAnalyticsDIV")).length){var z=document.createElement("div");z.setAttribute("id","templateAnalyticsDIV"),z.setAttribute("class","nTpop zcrm-modal zcrm-effect w740"),document.body.appendChild(z),j=$("#templateAnalyticsDIV")}var V=$L("crm-macro-ce")[0];V&&V.component&&j.css({"z-index":"10002"}),j.html(t),($(".mm-main-container").length||$("#showMassMail").length)&&j.css({"z-index":"250"}),template.showAnimatePopup("templateAnalyticsDIV")}else template.templatePostCallActions(e,n,t,i)}})},showTemplatePreview:function(e,t,a,n,i){commonUtils.showHideLoadingDiv(!0);var o=Crm.getCrmBasePath()+"/Template.do?step=previewTemplate";"WorkFlowAlert"===t&&(template.relatedModule=template.getRelatedModule(t)),"email_notifications"===t&&Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldRelModule&&(template.relatedModule=Lyte.registeredMixins["crm-automation-actions"].automation.mergefieldRelModule);var r=csrfParamName+"="+encodeURIComponent(csrfToken);n?(o=Crm.getCrmBasePath()+"/Template.do?step=galleryTemplatePreview",r+="&templateName="+encodeURIComponent(i.templateName),r+="&module="+encodeURIComponent(i.module),r+="&selectedcategory="+encodeURIComponent(i.category),r+="&inventory="+template.inventory,!template.inventory&&i.editorJson&&(r+="&templateJSON="+encodeURIComponent(i.editorJson))):"zeeditor"===t||"zceditor"===t?(o=Crm.getCrmBasePath()+"/Template.do?step=editorTemplatePreview",r+="&content="+encodeURIComponent(i.content),r+="&editorMode="+encodeURIComponent(i.editorMode),r+="&templateName="+encodeURIComponent(i.templateName),r+="&subject="+encodeURIComponent(i.subject),r+="&inventory="+template.inventory,r+="&from="+t,i.emailfooter&&(r+="&emailfooter="+encodeURIComponent(i.emailfooter)),"dragdropEditor"===template.editorType&&!template.inventory&&i.editorJson&&(r+="&templateJSON="+encodeURIComponent(i.editorJson)),"zceditor"===t&&template.inventory&&(r+="&headerFooterInfo="+encodeURIComponent(i.headerFooterInfo),r+="&pageInfo="+encodeURIComponent(i.pageInfo))):(r+="&templateId="+e,r+="&from=templatePreview",template.isCCTemplatePreview&&(r+="&source=CommandCenterService")),(new crmRequestPool).initiate({action:o,type:"POST",data:r,success:function(e){if(commonUtils.showHideLoadingDiv(!1),template.featureName=t,""!==a){template.popToClose=a;var n=$("#"+a);template.popzindex=n.css("z-index"),""!==template.popzindex&&n.css("z-index","20")}var i,o=$("#templatePreviewDIV");if(!template.inventory&&e.indexOf("</head>")>-1&&(i=e.substring(e.indexOf("<head>"),e.indexOf("</head>")+7),e=e.replace(i,"")),0===o.length){var r=document.createElement("div");r.setAttribute("id","templatePreviewDIV"),r.setAttribute("class","nTpop zcrm-modal zcrm-effect w980"),document.body.appendChild(r),o=$("#templatePreviewDIV")}o.html(e),"Macro"===t&&o.css("z-index","350"),"sendMail"===t&&$(".nteditIcon").css("display","none"),"Macro"!==t&&"ConsentMail"!==t&&"MassMail"!==t&&"reminderToOwner"!==t&&"AutoResponder_Pop"!==t&&"WebFormNotify"!==t&&"WebForm"!==t&&"WebFormAck"!==t&&"ApprovalProcess"!==t&&"ApprovalProcess_RE1"!==t&&"ApprovalProcess_RE2"!==t&&"viewTemplate_fz"!==t?setTimeout((function(){Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()?(template.showAnimatePopup("templatePreviewDIV",!1),EmailUtil.showEditorFreezeLayer()):(template.showAnimatePopup("templatePreviewDIV",!0),template.setWhiteFreezeLayer(),($L("#kioskDisconnectedCompConnect").length>0||$L("crm-kiosk-disconnected-components-popup").length>0)&&($L("#templatePreviewDIV").addClass("templatePreviewDIVZInd"),$L("#freezeBackGround").addClass("freezeBackGroundZInd")))}),400):setTimeout((function(){template.showAnimatePopup("templatePreviewDIV")}),400),setTimeout((function(){i&&($("iframe[id=previewIframe]").contents().find("head").html(i),$("iframe[id=mobileframe]").contents().find("head").html(i))}),200)},error:function(){Crm.ignoreAjaxError=!0,commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied()}})},showTemplateList:function(e,t,a,n,i,o,r,s,l,d){var m;commonUtils.showHideLoadingDiv(!0);var c=null!=o&&""!==o&&("true"===o||!0===o);"Macro"!==e&&"Macro_Dtl"!==e||(i=$("#module").val()),"WorkFlowAlert"===e&&(i=$("#alertModule").val(),template.relatedModule=template.getRelatedModule(e)),"email_notification"===e?(i.relatedModule&&(template.relatedModule=i.relatedModule),i=i.module):"wizard"===e?i=document.querySelector("crm-wizard-builder").component.data.primaryModule.module_name:"ProcessFlow"===e?i=ProcessBuilder.Transition.Module:"MassMailSch"===e&&(i=$("#modList").val());var u=Crm.getCrmBasePath()+"/Template.do?step=showAllTemplates",p=csrfParamName+"="+encodeURIComponent(csrfToken);""!==i&&"null"!==i&&(p+="&module="+encodeURIComponent(i)),p+="&from=templateComponent",""!==template.relatedModule&&(p+="&relatedModule="+encodeURIComponent(template.relatedModule)),validationUtils.isEmptyString(r)||(p+="&fltrTagKey="+r,validationUtils.isEmptyString(s)||(p+="&fltrTagValue="+s)),validationUtils.isEmptyString(l)||(p+="&surveyName="+$ESAPI.encoder().encodeForURL(l)),c&&(p+="&consentTemplatesOnly=true");var f=$L("email-notification");("undefined"!=typeof automationActions&&null!==automationActions.isBulkEmail&&automationActions.isBulkEmail||f&&f[0]&&f[0].component.data.isBulkEmail)&&(p+="&skiptemplatesnames="+encodeURIComponent("consent_linked,unsubscribe_linked,zurvey_linked"));var v=$("#parentModule").val();validationUtils.isNotEmpty(v)&&(p+="&parentModule="+v),(new crmRequestPool).initiate({action:u,type:"POST",data:p,success:function(o){var r;commonUtils.showHideLoadingDiv(!1),""!==n&&(r=$("#"+n),m=r.css("z-index"));var s=$("#templateComponentDIV");if(0===s.length){var l=document.createElement("div");l.setAttribute("id","templateComponentDIV"),l.setAttribute("class","nTpop selectTemplate zcrm-modal zcrm-effect w740"),document.body.appendChild(l),s=$("#templateComponentDIV")}s.html(o),"wizard"===e&&s.css({"z-index":"10001"}),"Macro_Dtl"===e&&s.css({"z-index":"10001"}),template.callback=a,template.templateIdentifier=t,template.isTemplateComponent=!0,template.featureName=e,template.isCrmCampaignMail=d,"sendMail"===e&&"Reports"!==i&&$("#createNewTempCompBtn").css("display","none"),""!==n&&(template.popToClose=n,template.popzindex=m),"Macro"!==e&&"ConsentMail"!==e&&"MassMail"!==e&&"reminderToOwner"!==e&&"AutoResponder_Pop"!==e&&"WebForm"!==e&&"ApprovalProcess"!==e&&"ApprovalProcess_RE1"!==e&&"ApprovalProcess_RE2"!==e?Crm.userDetails.isNewEditor&&EmailLaunchUtil.isComposeActive()?(template.showAnimatePopup("templateComponentDIV",!1),EmailUtil.showEditorFreezeLayer()):(template.showAnimatePopup("templateComponentDIV",!0),$("#freezeBackGround").css({"background-color":"var(--freezeLayerBg)"})):template.showAnimatePopup("templateComponentDIV"),setTimeout((function(){$("#nTSearchTemp").focus()}),350);var c=$("#nTfolderOptions");c.next(".select2").remove(),thirdPartyUtils.bindSelect2(c)}})},getRelatedModule:function(e){var t,a;if("WorkFlowAlert"===e&&(a=$("#alertModule").val(),"undefined"!=typeof wfmergefield)){if(wfmergefield.setActionType("EmailNotification"),(t=wfmergefield.getRelatedModule())&&t.indexOf("Orchestration")>-1)return t;if("CRMCCActions"===t)return window.process.draft_variables.details.forEach((e=>{e.module.name.indexOf("Orchestration")>-1&&(t=e.module.name)})),t}return a&&(t=t!=a?t:void 0),t||""},clearTemplate:function(e,t){var a=$("#"+e),n=a.siblings(".templateName").find("a");a.val(""),n.text(""),n.attr("onclick","return false"),n.attr("href","javascript:void(0)"),a.siblings(".clearTemplate").css("display","none"),$("."+e+"_fromTR").css("display","none");var i=$("."+e+"_replyTR");(i.css("display","none"),i.siblings(".otherEmailWarning").css("display","none"),void 0!==t)&&new Function(t)();$("#mailServerTypeDiv_comp1").addClass("hide"),$("#mailServerTypeDiv_comp2").addClass("hide")},showReplyTo:function(e,t){$(e).css("display","none");var a=$("#"+t);a.css("display",""),a.removeClass("hide")},setAddressType:function(e,t){var a=$(e).find("option:selected"),n=a.attr("type");if($(e).hasClass(t+"_from"))$("."+t+"_fromType").val(n),template.setEmailDelDetails(e);else{$("."+t+"_replyType").val(n);var i=$(e).closest("tr").siblings(".otherEmailWarning");if("4"===n){var o=[];o[0]=i.attr("replyToDueDays"),o[1]=Crm.getCrmBasePath()+"/ShowSetup.do?action=orgEmail&tab=general&subTab=orgEmail&email="+a.text().trim(),o[2]=a.text().trim(),o[3]=Crm.appName;var r=I18n.getMsg("crm.template.other.emails.warning.msg.new",o);"false"===i.attr("orgEmailAvail").trim()&&(r=I18n.getMsg("crm.template.other.emails.warning.msg_free.new",o)),i.find(".otherEmailWarningMsg").html(r),i.css("display","")}else i.css("display","none")}},setEmailDelDetails:function(e){var t=$(e).find("option:selected"),a=t.text(),n=t.attr("type");"1"===n?a=t.attr("email"):"3"===n&&(a=t.val());var i="autoResponder",o=$L("#dynamicreplyToLink"),r=$L("#dynamicreplyToAddress"),s=$("#dynamicfromAddress");$(".Macro_container").length>0?(i="macro",s=$L("#fromAddress"),o=$L("#replyToLink"),r=$L("#replyToAddress")):"pop_fromAddress"===$(e).attr("id")?(i="autoResponder_Pop",s=$("#pop_fromAddress"),o=$L("#pop_replyToLink"),r=$L("#pop_replyToAddress")):"fromAddress"===$(e).attr("id")&&(i="autoResponder_rules",s=$L("#fromAddress"),o=$L("#replyToLink"),r=$L("#replyToAddress")),Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy(s,a,i,o,r)},removeEventBindings:function(){window.removeEventListener("beforeunload",template.windowonunload),document.removeEventListener("keydown",template.documentonkeydown),"undefined"!=typeof editor&&(editor=void 0)},validateTemplateNameSubject:function(){var e=$("#templateName"),t=$("#templateAlertsPop").find(".tempalertmsg"),a=$("#tempSuNamVal");if(""===e.val().trim())return t.text(I18n.getMsg("crm.template.name.empty.check")),a.val("templateName"),template.showAnimatePopup("templateAlertsPop",!0),!1;var n=getClrTxtPtnResChars(e.val()).join(", ");if(""!==n)return t.text(I18n.getMsg("crm.clearTextPattern.validationFail.alert",[I18n.getMsg("crm.label.name"),n])),a.val("templateName"),template.showAnimatePopup("templateAlertsPop",!0),!1;if(e.val().length>e.attr("maxlength"))return t.text(I18n.getMsg("crm.template.editor.name.len.check",e.attr("maxlength"))),a.val("templateName"),template.showAnimatePopup("templateAlertsPop",!0),!1;if(!template.inventory){var i=$("#templateSubject"),o=i.text().trim();if(""===o)return t.text(I18n.getMsg("crm.template.subject.empty.check")),a.val("templateSubject"),template.showAnimatePopup("templateAlertsPop",!0),!1;if(o.length>i.attr("maxlength"))return t.text(I18n.getMsg("crm.template.editor.sub.len.check",i.attr("maxlength"))),a.val("templateSubject"),template.showAnimatePopup("templateAlertsPop",!0),!1}var r=template.getEditorContent(),s=template.oldContentLength(),l=commonUtils.formatDecimalValue(template.contentlength,0);if(r.length>template.contentlength&&r.length>s)return t.text(I18n.getMsg("crm.template.email.content",l)),a.val(""),template.showAnimatePopup("templateAlertsPop",!0),!1;if(-1!==r.indexOf("${ConsentForm.")&&r.indexOf("${ConsentForm.")!==r.lastIndexOf("${ConsentForm."))return t.text(I18n.getMsg("crm.ConsentForm.linklimit.template")),a.val(""),template.showAnimatePopup("templateAlertsPop",!0),!1;if(template.checkIfUsedTwice("${userSignature}",r))return t.text(I18n.getMsg("crm.template.content.signature.valid")),a.val(""),template.showAnimatePopup("templateAlertsPop",!0),!1;if(template.checkIfUsedTwice("${Unsubscribe",r))return t.text(I18n.getMsg("crm.unsubscription.linklimit.template")),a.val(""),template.showAnimatePopup("templateAlertsPop",!0),!1;if(-1===r.indexOf("${Unsubscribe")&&template.mandateUnsubLink&&"email"===Lyte.Router.getRouteInstance().getQueryParams().type){var d=$("#templateUnsubLinkAlertsPop");return t=d.find(".tempalertmsg"),d.find(".headerMsg").text(I18n.getMsg("crm.email.preference.mandatory.unsublink.header")),t.text(I18n.getMsg("crm.email.preference.mandatory.unsublink.message")),template.showAnimatePopup("templateUnsubLinkAlertsPop",!0),!1}if(template.emailFooterEnabled&&template.email_footers.content&&"htmlEditor"===template.editorType&&"richtext"===editor.mode&&(template.addFooter=-1!==r.search(/class\s*=\s*('|")emailfooter\1/),!template.addFooter&&template.email_footers.preference)){var m=I18n.getMsg(Crm.userDetails.IS_ADMIN?"crm.email.footer.mandatory.admin":"crm.email.footer.mandatory.nonadmin");return parent.crmui.showMsgBand("error",m,3e3),!1}return!0},checkIfUsedTwice:function(e,t){let a=!1;try{if(template.emailFooterEnabled&&!template.addfooter&&"dragdropEditor"===template.editorType){let e=template.email_footers.content?t.indexOf('class="emailfooter"'):t.length;t=t.slice(0,e)}const n=t.indexOf(e);a=-1!==n&&n!==t.lastIndexOf(e)}catch(e){murphy.error(e),a=!1}return a},showVerisonHistoryChart:function(e,t){var a=0;0!==t.chartCount2&&(a=parseInt(t.chartCount1)/(1*parseInt(t.chartCount2))*100,a=parseFloat(a.toFixed(1))),$(e).highcharts({chart:{type:"pie",height:"185",width:"185",marginTop:"0"},title:{text:"<div style='font-size:var(--crm-subheading-font-size);color: var(--baseColor);font-weight: bold;'>"+t.chartType+"</div>",align:"center",y:10,style:{fontSize:"16px",fontWeight:"bold"}},plotOptions:{pie:{startAngle:0,dataLabels:{enabled:!1},enableMouseTracking:!1},series:{dataLabels:{formatter:function(){if(this.key===t.chartLabel)return this.percentage+"%"},style:{color:"var(--baseColor)",fontSize:"14px",fontWeight:"bold"},verticalAlign:"middle",enabled:!0,distance:-36}}},subtitle:{text:"<span style='font-size: var(--crm-small-font-size);color: #999999;margin-right: 3px;white-space: nowrap;'>"+t.allVersionPerc+" on all versions </span><div style='color: var(--baseColor);text-align:center;font-size: var(--crm-small-font-size);'>"+t.chartLabel+" : "+t.subtitlecount+"</div>",align:"center",useHTML:!0,verticalAlign:"bottom",y:-10,x:0,style:{color:"var(--baseColor)",fontSize:"12px"}},credits:{enabled:!1},series:[{size:"50%",innerSize:"78%",data:[{name:t.chartLabel,y:a,color:t.chartLabelColor},{name:"option2",y:100-a,color:"var(--notfoundColor)"}]}]})},showVerisonHistoryZChart:function(e,t){networkUtils.returnDependencyFiles(["CrmChartUtil.js"],ResourceConstants.CRM);var a=0;0!==t.chartCount2&&(a=parseInt(t.chartCount1)/(1*parseInt(t.chartCount2))*100,a=parseFloat(a.toFixed(1)));var n=document.getElementById(e);n.style.width="185px",n.style.height="185px";var i={legend:{enabled:!1,colors:[t.chartLabelColor,"#cccccc"]},chart:{plot:{plotoptions:{pie:{innerRadius:"78%",events:{enabled:"false"}}}}},tooltip:{enabled:!1},metadata:{axes:{x:[0],y:[[1]],tooltip:[0,1]},columns:[{dataindex:0,columnname:"StatsLabel",datatype:"ordinal"},{dataindex:1,columnname:"option2",datatype:"numeric"}]},seriesdata:{chartdata:[{type:"pie",data:[[[t.chartLabel,a],["option2",100-a]]]}]},canvas:{title:{text:t.chartType,hAlign:"center",fontSize:16,fontWeight:"normal",fontColor:"var(--baseColor)",marginTop:5},subtitle:{show:!0,text:t.allVersionPerc+" on all versions",x:35,y:142,fontColor:"#999999"},border:{show:!1}},notes:{enabled:!0,chartValues:[{x:80,y:85,type:"customNote"}],options:{customNote:{htmlEl:"<div style='border-radius:10px;background-color:var(--bg_white);text-align:center;font-size:14px'>"+t.allVersionPerc+"</div>"}}},credits:{enabled:!0,hAlign:"center",vAlign:"bottom",text:t.chartLabel+" : "+t.subtitlecount,fontColor:"var(--baseColor)",fontSize:13}};setTimeout((function(){try{CrmChartUtil.renderChart(n,i)}catch(e){murphy.error(e)}}),400)},addFilterTagsParams:function(){var e=$("#fltrTagKey").val(),t=$("#fltrTagValue").val(),a="";if(validationUtils.isEmptyString(e)||(a+="&fltrTagKey="+e,validationUtils.isEmptyString(t)||(a+="&fltrTagValue="+t)),"ZSURVEY"===e){var n=$("#surveyName").val();a+="&surveyName="+$ESAPI.encoder().encodeForURL(n)}return a},setAttributesForInlineImg:function(e,t){e&&(e.setAttribute("src",e.getAttribute("origsrc")),t?e.setAttribute("onload",'parent.template.onLoadInlineImg(this,"'+t+'")'):"htmlEditor"===template.editorType?e.setAttribute("onload","parent.parent.template.onLoadInlineImg(this)"):e.setAttribute("onload","parent.template.onLoadInlineImg(this)"),e.removeAttribute("origsrc"))},onLoadInlineImg:function(e,t){e.removeAttribute("onload");var a=template.getInlineImgs("[origsrc]");(a=a[0])?template.setAttributesForInlineImg(a,t):template.removeOnLoadForInlineImg()},removeOnLoadForInlineImg:function(){if(template.removeInlineImgOnload){template.removeInlineImgOnload=!1;for(var e=template.getInlineImgs("img"),t=e.length,a=0;a<t;a++){var n=e[a],i=n.getAttribute("onload");i&&i.includes("onLoadInlineImg")&&n.removeAttribute("onload")}}},getInlineImgs:function(e){var t,a=$("iframe[id=previewIframe]");if(a.length>0)t=a.contents().find(e);else if("htmlEditor"===template.editorType&&editor){var n=$("iframe[name=emailEditor]").contents().find("#ze_htmlview");t=n.is(":visible")?n.find("iframe").contents().find(e):editor.doc.querySelectorAll(e)}else if("dragdropEditor"===template.editorType){var i=$("iframe[name=emailEditor]");i.length>0&&(t=i.contents().find(e))}return t},triggerInlineImgReqs:function(e,t){var a=6,n=e.getElementsByTagName("img"),i=n.length;i<=10&&(a=i);for(var o=0;o<a;o++){var r=n[o];r.hasAttribute("origsrc")&&template.setAttributesForInlineImg(r,t)}template.removeInlineImgOnload=!0},replaceInlineImgs:function(e,t){var a=e;void 0===t&&(t=!1);for(var n,i=template.noimagesrc.trim().replace(template.noimagesrc.trim().substring(template.noimagesrc.trim().indexOf("zc-noimage")+10),""),o=new RegExp(/(<img([^>]*).*?>)/g);n=o.exec(e);){var r=n[1],s=null;if(t)(l=new RegExp(/origsrc=\\?"([^\\"]+)\\?"/).exec(r))&&l.length>0&&(s=(s=r.replace(template.noimagesrc,l[1])).replace(" "+l[0],""));else if(!r.includes("origsrc")){var l;if((l=new RegExp(/src=\\?"([^\\"]+)\\?"/).exec(r))&&l.length>0&&!l[1].includes(i)){var d=l[0].replace(l[1],template.noimagesrc);s=r.replace(l[0],d+" orig"+l[0])}}s&&(a=a.replace(r,s))}return a},addRemoveConentEditable:function(){$("#previewIframe").contents().find(".sandboxDiffChanges").attr("contentEditable",!0),setTimeout((function(){$("#previewIframe").contents().find(".sandboxDiffChanges").removeAttr("contentEditable")}),500)},templatesE1:function(e){if(!e)e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},showMobilePreview:function(e){var t=$("#editor_desktopframe"),a=$("#editor_mobileframe"),n=$L("iframe[id=previewIframe]").contents().find("body");template.desktopViewScrollTop=n.scrollTop(),template.desktopViewScrollLeft=n.scrollLeft();var i=n.html(),o=$L("iframe[id=mobileframe]").contents().find("body");$(".editor_deskMobIcon").removeClass("active"),$(e).addClass("active"),template.setDesktopPreviewDefault(),a.hasClass("rendered")||o.addClass("mobileframebody").html(i);var r=$("#previewIframe").css("height"),s=$("#mobileframe");if(s.css("height",r),t.css("display","none"),a.css("display","block"),$("#mob_scrollingDiv").css("height",s.contents().find("body")[0].scrollHeight),o.scrollTop(template.mobileViewScrollTop),o.scrollLeft(template.mobileViewScrollLeft),nTloadFrame(s,!1,!0),a.removeClass("rendered").addClass("rendered"),template.isResponsiveTemplateShow){var l=$("#nT_respInfoWrap");l.removeClass("dN"),l.addClass("dF")}},showDesktopPreview:function(e){var t=$("#editor_mobileframe"),a=$("#editor_desktopframe"),n=$("iframe[id=mobileframe]").contents().find(".mobileframebody"),i=$L("iframe[id=previewIframe]").contents(),o=i.find(".desktopframebody");$(".editor_deskMobIcon").removeClass("active"),$(e).addClass("active"),template.setDesktopPreviewDefault(),i.find("body").addClass("desktopframebody"),template.mobileViewScrollTop=n.scrollTop(),template.mobileViewScrollLeft=n.scrollLeft(),t.css("display","none"),a.css("display","block"),o.scrollTop(template.desktopViewScrollTop),o.scrollLeft(template.desktopViewScrollLeft),$("#nT_respInfoWrap").addClass("dN")},setDesktopPreviewDefault:function(){var e=$(".editor_deskMobIcon.active"),t=e.outerWidth()-2,a=e.outerHeight()-2,n=e.position().left;$(".editor_tabAnim").css({width:t,height:a,left:n})}},template=template?Object.assign(template1,template):template1;template1={};var tkvajaxEdit=!1,tkvMoreAction=0,size=0,iskvFollowupTask=!1,iskvFollowupEdit=!1,ActivityMoreInfoContent="",TaskKanbanView={setkanbanTaskHt:function(){var e="",t="",a=$("#taskKanbanViewContainer"),n=$(".centerContainerfooter"),i=a.height();if(null!=i){var o=$("#kanbanTaskDetailctn"),r=$(".kanbanTaskDetailRightContainer"),s=$("#kanbanTaskDetailRightCtn");t=r.height();e=a.outerHeight()-n.outerHeight();o.height(e),s.height(t)}else a.addClass("kanbanDetailview_rewamp")},setlayoutHt:function(e){$("#spacerDiv_Btm").hide();var t=$("#taskKanbanViewContainer");if(t.length){var a=renderingUtils.windowHeight,n=t.offset().top;setTaskBoxHt1=a-(n+32),t.css("height",setTaskBoxHt1),$(".kvtlistbgheader").height(setTaskBoxHt1-11),$(e).each((function(){getScrollparentEl=$(this).closest(".innerdivCtn").attr("id"),scrollEl=$(this).attr("id"),document.getElementById(scrollEl).scrollHeight=document.getElementById(getScrollparentEl).scrollHeight;var e="#"+scrollEl;thirdPartyUtils.bindPerfectScrollUpdate(e)})),Crm.userDetails.detailView_newUI,$(e).outerHeight(setTaskBoxHt1-72),TaskKanbanView.setKvDetailslayout(setTaskBoxHt1)}var i=$("#cvlist");i.length&&!i.hasClass("noPerfectScroll")&&thirdPartyUtils.bindPerfectScroll("#cvlist",{wheelSpeed:1})},setCalenderScroll:function(e,t){void 0!==(t=t)&&$("#"+e).on("scroll",(function(){var a=$("#Calendar");if(void 0!==a)if(a.css("top",parseInt(t.replace("px",""))-$L("#"+e).scrollTop()+"px"),parseInt($("#Calendar").css("top").replace("px",""))<=129)$("#Calendar").css("display","none");else{var n=document.getElementById("textbox_Due Date");void 0!==n&&"none"!==n.parentNode.style.display&&$("#Calendar").css("display","block")}}))},changeowner:0,mailconvtitle:!0,editperm:!0,entityId:0,tkvListWidth:"",KvListItemClickCount:0,kvrecordid:0,centerCtnWidthBefore:"",centerCtnWidthAfter:"",noteId:"",noteEdit:0,setKvDetailslayout:function(e){var t=$("#taskKanbanViewContainer");TaskKanbanView.tkvListWidth=(t.outerWidth()-25)/4;var a=$(".kvtlistbgheader"),n=$(".kvtlistbgheader .kvtlistbg"),i=renderingUtils.windowWidth-350;if(0===TaskKanbanView.KvListItemClickCount?(n.css("width",TaskKanbanView.tkvListWidth-8+"px"),a.outerWidth(TaskKanbanView.tkvListWidth-7),$(".kanbanList_activities").width(TaskKanbanView.tkvListWidth-21),$("#kventitydetailspage").css({width:i-3,height:e+"px",left:$("#taskKanbanViewContainer").outerWidth()+12+"px"}),$("#cvEditSave").css({width:3*$(".kvtlistbgheader").outerWidth()+6+"px",height:e+"px"})):(1===$(".leftheaderBack:visible").length&&(i=renderingUtils.windowWidth-351),$("#kventitydetailspage").css({width:i-1,height:e+"px",left:$("#taskKanbanViewContainer").outerWidth()+12+"px"}),$("#cvEditSave").css("height",e+"px"),title=$(".editCVtitle").outerHeight()+$(".editCVfooter").outerHeight(),$("#cvEditSave").find(".preHTMLContainer").height($("#cvEditSave").height()-(title+30)),n.css("width",TaskKanbanView.tkvListWidth-4+"px")),a.length>1){if(1===$(".leftheaderBack:visible").length){t.addClass("kanbanDetailview_rewamp");var o=$(".kanbanDetailview_rewamp").find(".leftContainerctn");TaskKanbanView.tkvListWidth=350,thirdPartyUtils.bindPerfectScroll(o),o.css("height",e-49)}else $(".kanban_activities_rewamp").removeClass("kanbanDetailview_rewamp");"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&$(".notasks").addClass("notask_crmplus")}else{$(".kanban_activities_rewamp").addClass("kanbanDetailview_rewamp");o=$(".kanbanDetailview_rewamp").find(".leftContainerctn");a.outerWidth(TaskKanbanView.tkvListWidth-5),a.height(e),TaskKanbanView.tkvListWidth=350,n.css("width",TaskKanbanView.tkvListWidth-5+"px"),thirdPartyUtils.bindPerfectScroll(o),o.css("height",e-49)}}},taskDetailsview={},globalfieldlabel="";taskDetailsview.setComposeWindow=function(){mailCtnloaded=$("#etUserDetailsWrpper").length,wH=$(window).height(),wW=$(window).width();var e=$("#show");showH=e.height(),showW=e.width(),$("#mailcompose").css("width",(showW-60)/1.3),$("#mailcompose").css("height",showH-60);var t=$("#mailcompose");if(popW=t.outerWidth(),popH=t.outerHeight(),t.css("left",(wW-popW)/2),$("#mailcompose").css("top","15px"),0!==mailCtnloaded){var a=$("#mailcompose");if(selectNewLook=$("#etUserDetailsWrpper .selectNewLook"),ze_area=$(".ze_area").attr("class"),void 0===ze_area)var n=setInterval((function(){var e=$(".ze_area");ze_area=e.attr("class"),void 0!==ze_area&&(iframeHt=a.height()-($("#etUserDetailsWrpper").outerHeight()+$("#ceContenteditOptionsCtn").outerHeight()),$("#emailEditor").removeAttr("height"),e.css("height",iframeHt-30),clearInterval(n))}),400);else iframeHt=a.height()-($("#etUserDetailsWrpper").outerHeight()+$("#ceContenteditOptionsCtn").outerHeight()),$(".ze_area").removeAttr("height"),$(".ze_area").css("height",iframeHt-30)}};var attachON=!0,calenderTargetElKv=null,mailtreeStructure="",cv={init:function(){taskDetailsview.setComposeWindow()}};$((function(){cv.init()}));var CustomRelatedListObj={};function customRelatedListSubmit(){$("[name='rlContentChngd']").val("true");var e=getObj("relatedListNameTemp"),t=!1;if(""==e.value.trim())return alert(I18n.getMsg("crm.customRL.JSAlert.NameRequired")),e.focus(),t=!0,$("[name='rlContentChngd']").val("false"),!1;if(""!=e.value.trim()){if(t=!CustomRelatedListObj.validateRLName("relatedListNameTemp"))return alert(I18n.getMsg("crm.customRL.JSAlert.NoSplCharsInName")),e.focus(),$("[name='rlContentChngd']").val("false"),!1;if(t=validateFieldLength(e.value.trim(),"50"))return crmui.showMsgBand("error",I18n.getMsg("crm.label.newrelatedlist.relatedlistname.lengthexceeded","50"),"3000"),e.focus(),$("[name='rlContentChngd']").val("false"),!1}if(!t){getObj("relatedListName").value=e.value.trim();var a="",n="",i="",o="";try{for(var r=getObj("idxCount")?getObj("idxCount").value:1,s=1;s<r;s++){var l=$("#entityParamName"+s)[0].innerText,d=$("#confparamValue_"+s);if("entity"===d.attr("type")){var m=d.find(".mergespan").attr("value");"automation"!==customFunctionsObj.isFrom&&(m=m.split("&&&")[0]),""!==l&&(a+=","+l,n+=","+m)}else{if(""===(m=d[0].attributes.hasOwnProperty("placeholder")&&"true"===d[0].attributes.getNamedItem("placeholder").value?"":d[0].textContent))return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.enterParamValue"),"3000"),!1;""!==l&&(i+=","+l,o+=","+m)}}}catch(e){alert(e)}return getObj("entParamName").value=a,getObj("entParamVal").value=n,getObj("custParamName").value=i,getObj("custParamVal").value=o,!0}}CustomRelatedListObj.fromModuleBuilder=!1,CustomRelatedListObj.TYPE={CUSTOM_FUNCTION:"custom_function",CREATOR:"creator",WIDGET:"widget"},CustomRelatedListObj.PERMISSION_NAME="Crm_Implied_Customize_Zoho_CRM",CustomRelatedListObj.PERSONALITY_NAME="RELATEDLISTPERSONALITY",CustomRelatedListObj.currentRLId=null,CustomRelatedListObj.currentAction=null,CustomRelatedListObj.operateRLFromCanvas=function(e,t){var a=$L(featuresAvailable.NEXTGENUI_ENABLED?"crm-left-menu-modules":"crm-tab").e[0].component.data.previouslySelectedModule;CustomRelatedListObj.doCustomRleatedList(e,t,a)},CustomRelatedListObj.resetCustomRelatedListData=function(){CustomRelatedListObj.currentRLId=null,CustomRelatedListObj.currentAction=null},CustomRelatedListObj.reloadRL=function(e){var t=$L("#"+e+"_customRL");0!=t.length&&(CustomRelatedListObj.changeStatusOfRefreshIcon(e,!0),t[0].component.setData("resp_data",void 0),t[0].component.executeMethod("reloadRelatedList"))},CustomRelatedListObj.checkForCanvasMode=function(){return 0!=$L("crm-custom-rl").length},CustomRelatedListObj.changeStatusOfRefreshIcon=function(e,t){var a=$L("#customRLRef_"+e);0!=a.length&&(null==t?a.hasClass("ref_complete")?a.removeClass("ref_complete").addClass("ref_loading"):a.removeClass("ref_loading").addClass("ref_complete"):t?a.removeClass("ref_complete").addClass("ref_loading"):a.removeClass("ref_loading").addClass("ref_complete"))},CustomRelatedListObj.executeMethod=function(e,t){const a=CustomRelatedListObj.getCurrentPageDetails("module");return Crm.renderDVLyteFlow(a)?t():e()},CustomRelatedListObj.addNewRelatedList=function(e){CustomRelatedListObj.downloadRLFunctionFiles((function(){customFunctionsObj.isFrom="relatedlist","none"==$("#topBandPopup").css("display")&&$("[name='rlContentChngd']").length>0&&$("[name='rlContentChngd']").val("false"),"none"==$("#topBandPopup").css("display")&&commonUtils.showHideLoadingDiv(!0);var t=CustomRelatedListObj.executeMethod((function(){var t;CustomRelatedListObj.fromModuleBuilder?t=CrmPageLayout.module:"undefined"!=typeof detailView&&(t=detailView.currentModule);!t&&e&&(t=e.module);return t}),(function(){var t=CustomRelatedListObj.fromModuleBuilder?CrmPageLayout.module:e&&e.module;t||(t=CustomRelatedListObj.getCurrentPageDetails("module"));return t})),a=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addNewRelatedList&module="+t;CustomRelatedListObj.fromModuleBuilder&&(a+="&fromModuleBuilder=true",Crm.trackSpotLightAction("Add new RelatedList",{place:"ModuleBuilder"}),Crm.client_tracking("Add new RelatedList",{place:"ModuleBuilder"})),mR(a,(function(e){$("#topBandPopup").html(e),"none"==$("#topBandPopup").css("display")&&(commonUtils.showHideLoadingDiv(),showAnimatePopup("topBandPopup"),renderingUtils.freezeBackground(),$("#thirdPartyRowTag").on("click",(function(){$("#thirdPartyRowTag").off("click")})))}))}))},CustomRelatedListObj.listCustomFunctions=function(e){if(("undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1),e)&&"widget"===JSON.parse(e).buttonType)return void CustomRelatedListObj.listWidgets();hideAnimatePopup("topBandPopup");var t="deluge";customFunctionsObj.listCustomFunctions("relatedlist",t),$("#cfLanguagesListDD").val(t)},CustomRelatedListObj.addCreatorRecord=function(e){var t=CustomRelatedListObj.getCurrentPageDetails("module"),a=CustomRelatedListObj.getCurrentPageDetails("entityId"),n=Crm.getCrmBasePath()+"/CustomRelatedList.do",i="action=addCreatorRecord&listRelationId="+e+"&module="+t+"&entityId="+a+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(n,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",$("#creatorRecordFrame").css({"max-height":"calc(100vh - 200px)"}),showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}),i)},CustomRelatedListObj.editCreatorRecord=function(e,t){var a=CustomRelatedListObj.getCurrentPageDetails("module"),n=CustomRelatedListObj.getCurrentPageDetails("entityId"),i=Crm.getCrmBasePath()+"/CustomRelatedList.do",o="action=editCreatorRecord&recordId="+e+"&listRelationId="+t+"&module="+a+"&entityId="+n+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,showAnimatePopup("topBandPopup"),setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",$("#creatorRecordFrame").css({"max-height":"calc(100vh - 200px)"}),EvalInnerScript($("#topBandPopup").get(0))}),o)},CustomRelatedListObj.togglerelatedlistmenu=function(e,t,a){hideMenu(e);var n="customRelatedListMenuDiv"+a,i=document.getElementById(n);"hide"!=t&&"none"==i.style.display?(i.style.display="block",$("#rlDropDown_"+a).css("visibility","visible"),$("#rlDropDown_"+a).removeClass("newRlEdit"),$("#rlDropDown_"+a).addClass("selectRlEdit")):(i.style.display="none",$("#rlDropDown_"+a).removeClass("selectRlEdit"),$("#rlDropDown_"+a).addClass("newRlEdit")),sE(e)},CustomRelatedListObj.showDeleteCustomFunctionAlertDiv=function(e){renderingUtils.freezeBackground();var t="<div class='p30 crm-base-font-size'>"+I18n.getMsg("crm.label.newrelatedlist.customfunction.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomFunction(\""+e+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='crmui.hidePopup(\"lookupdiv\")'></div>";$("#lookupdiv").html(t),$("#lookupdiv").css("zIndex",10002),$("#FreezeLayer").css("zIndex",10001),mailsetCenter("lookupdiv"),$("#lookupdiv").show()},CustomRelatedListObj.showCreatorRecord=function(e,t){var a=CustomRelatedListObj.getCurrentPageDetails("module"),n=CustomRelatedListObj.getCurrentPageDetails("entityId"),i=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCreatorRecord&recordId="+e+"&listRelationId="+t+"&module="+a+"&entityId="+n;mR(i,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,showAnimatePopup("topBandPopup"),setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.openFunction=function(e,t,a,n){var i=CustomRelatedListObj.getCurrentPageDetails("module"),o=$("[name="+("workflowLinkId_"+e)+"]").val(),r="";customFunctionsObj.langauge="deluge",customFunctionsObj.category="relatedlist";var s=a+"_insDiv";getObj(s)&&(r=getObj(s).value);var l=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionInfo&workflowLinkId="+o+"&currentModule="+i+"&frm="+t+"&install="+r;mR(l,(function(e){if("true"==n){var t=$("#newRelatedListPopUpDiv");$("#crl_customfunction_list").hide();var a=$("#newRelatedListPopUpDiv");t.hide().removeClass().addClass("newpopup p30 w770 newPopupStyleEle"),a.html(e),a.css("zIndex",200),commonUtils.showHideLoadingDiv(),a.css({padding:"0px",width:"1000px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),t.show()}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.loadCustomRelatedListFunction=function(e,t,a,n){null==n&&(n="deluge"),"install"==t&&$("input[name='installButton']").prop("disabled",!0);var i=CustomRelatedListObj.getCurrentPageDetails("module"),o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomFunctionParams&workflowLinkId="+e+"&currentModule="+i+"&condition="+t+"&functionName="+encodeURIComponent(a)+"&language="+n;mR(o,(function(e){if("funcNameDuplicated"==e)alert(I18n.getMsg("crm.label.newrelatedlist.functionname.duplicate")),$("input[name='installButton']").prop("disabled",!1);else if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded")),"install"==t&&$("input[name='installButton']").prop("disabled",!1);else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var a=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",a)),renderingUtils.removeFreezeLayer(),"install"==t&&$("input[name='installButton']").prop("disabled",!1)}else{$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,crmui.hidePopup("newRelatedListPopUpDiv",!0),showAnimatePopup("topBandPopup");var n=0,i=$(".confParamRow").length;for(n=0;n<i;n++)ZohoDRE.addPlaceholder(n+1);renderingUtils.freezeBackground()}}))},CustomRelatedListObj.getInfoToPublishCustomFunction=function(e,t){var a=Crm.getCrmBasePath()+"/CustomRelatedList.do";mR(a,(function(e){$("#topBandPopup").html(e)}),"action=getInfoToPublishCustomFunction&workflowLinkId="+e+"&functionName="+t)},CustomRelatedListObj.removeRelatedListBottonMargin=function(e,t){e===CustomRelatedListObj.TYPE.WIDGET&&$("#RelList_RELATEDLISTPERSONALITY_"+t).removeClass("mB20")},CustomRelatedListObj.loadCreatorFunctionEdit=function(e,t,a){var n=$("[name='module']").val();!n&&CustomRelatedListObj.fromModuleBuilder&&(n=CrmPageLayout.module);var i=$("[name='relatedlistId']").val();if(null==i&&(i=0),!$("#relatedListNameTemp").val())return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NameRequired"),3e3),!1;if(!CustomRelatedListObj.validateRLName("relatedListNameTemp"))return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NoSplCharsInName"),3e3),!1;if(customFunctionsObj.listRelationId=i,"update"==t)var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionDelugeEditor&module="+n+"&workflowLinkId="+e+"&condition=update&listRelationId="+i;else o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionDelugeEditor&module="+n+"&workflowLinkId="+e+"&listRelationId="+i;if("true"==a){for(var r=$(".confParamRow").length,s="",l="",d=1;d<=r;d++){var m=$("#confparamValue_"+d),c=$("#entityParamName"+d),u=0===c.length?$("#customParamName"+d)[0].innerText:c[0].innerText;if("entity"===m.attr("type")){var p=m.find(".mergespan").attr("value");"automation"!==customFunctionsObj.isFrom&&(p=p.split("&&&")[0]),s=""===s?u+"="+p:s+","+u+"="+p}else{p=m[0].textContent;l=m.attr("placeholder")?u+"=":""==l?u+"="+p:l+","+u+"="+p}}o=o+"&crlEntityParams="+encodeURIComponent(s)+"&crlCustomParams="+encodeURIComponent(l)+"&relatedListName="+$("#relatedListNameTemp").val()}o=o+"&language="+$("#language").val(),mR(o,(function(e){$("#freezeBackGround").hide(),$("#topBandPopup").hide(),customFunctionsObj.listrelationid=i;var t=[],a=[];if((e=JSON.parse(e)).entityParams)for(var n=(s=e.entityParams.split(",")).length,o=0;o<n;o++){var r=s[o];(l={}).name=r.split("=")[0],l.value=r.split("=")[1],t.push(l)}if(e.customParams){var s;for(n=(s=e.customParams.split(",")).length,o=0;o<n;o++){var l;r=s[o];(l={}).name=r.split("=")[0],l.value=r.split("=")[1],a.push(l)}}customFunctionsObj.renderEditorView(JSON.stringify(e),t,a)}))},CustomRelatedListObj.listGallery=function(){if($("#existingFunctionList, #existingCFBottom").hide(),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("creator",usernameNotNeeded)){hideAnimatePopup("topBandPopup");commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.addNewRelatedList()}),"creator")}else{var e=CustomRelatedListObj.getCurrentPageDetails("module"),t=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=listGallery&module="+e;mR(t,(function(e){$("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv()}))}},CustomRelatedListObj.addArgument=function(){var e=$("[name='index']").val(),t="clonedargument-tr"+e,a=$("#argument-body"),n=$("#dummyargument-tr"),i=n.clone();i.attr("id",t),a.append(i,n),i.show();var o="#clonedargument-tr"+e+" input",r="#clonedargument-tr"+e+" select";$(o).attr("id","argumentName"+e),$(o).attr("name","argumentName"+e),$(r).attr("id","argumentType"+e),$(r).attr("name","argumentType"+e),$(r).next(".select2").remove(),thirdPartyUtils.bindSelect2($(r));var s=parseInt(e)+1;$("[name='index']").val(s)},CustomRelatedListObj.deleteArgument=function(e){$(e).parent().parent().remove();var t=$("[name='index']").val();$("[name='index']").val(--t)},CustomRelatedListObj.loadCustomViews=function(){var e=$("#creatorFieldsSelect0").find(":selected").val(),t=$("#entityParamVal").find(":selected").val();"-1"!=e&&"-1"!=t?($("#viewAndFieldsDiv").css("visibility","visible"),loadViewsOfSelectedForm()):($("#viewAndFieldsDiv").css("visibility","hidden"),$("#columnSelectDiv").html(""))},CustomRelatedListObj.addCustomFunction=function(e){customFunctionsObj.constructCFBodyDiv(),$("#createfunctionpopdiv").html(""),crmui.hidePopup("newRelatedListPopUpDiv"),Lyte.Component.render("crm-createfunction-pop",{formdata:{name:"",description:"",category:"cf_select",language:customFunctionsObj.language,type:"editor"},disableNextBtn:!1,from:"relatedlist"},"#createfunctionpopdiv"),document.querySelector("#createNewFunction").ltProp("show",!0)},CustomRelatedListObj.deleteCustomRelatedList=function(e,t){$("[name='rlContentChngd']").val("true");var a=Crm.getCrmBasePath()+"/CustomRelatedList.do",n="action=delRelatedList&listRelationId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+t;mR(a,(function(t){$("#lookupdiv").empty(),getObj("lookupdiv").style.display="none",renderingUtils.removeFreezeLayer(),CustomRelatedListObj.fromModuleBuilder?$("#unUsedRelatedListsHolder").find("[relid='RL_"+e+"']").remove():(CustomRelatedListObj.currentAction="DELETE",CustomRelatedListObj.currentRLId=e,reloadRelatedList()),Crm.userDetails.MPL_MIGRATION_COMPLETED&&$("#customRelListDelPop").remove(),store.unloadRecord("related_list",e)}),n)},CustomRelatedListObj.saveNewCreatorFunction=function(e){$("input[name='saveCreatorFunCButton']").prop("disabled",!0);var t=$("[name='functionName']").val(),a=$("#custom_rl_name").val(),n=CustomRelatedListObj.getCurrentPageDetails("module"),i=$("#isDRE").val(),o=1;if(""==a)alert(I18n.getMsg("Related List Name cannot be empty")),$("#custom_rl_name").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(""==t)alert(I18n.getMsg("crm.label.newrelatedlist.functionempty")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var r=CustomRelatedListObj.validateCustomRelatedListField(t,"name");if(r)alert(I18n.getMsg("crm.label.newrelatedlist.functionname.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(r=validateIsNumberAsFirstChar(t))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.number")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(r=validateFieldLength(t,100))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.lengthexceeded")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(r=validateForForeignLanguage(t))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.foreignlanguage.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var s=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=validateCustomFunctionName&functionName="+t+"&relatedListName="+a+"&module="+n;mR(s,(function(e){if("Related List Name is duplicated"==e)return alert("Related List Name already exists"),$("#relatedListName").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if("true"==e)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.functionname.duplicate")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;var n=$("[name='description']").val();if(r=validateFieldLength(n,2500))alert(I18n.getMsg("crm.label.description.exceeded")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var s="",l="",d=$("[name='index']").val();if($("#argument-body tr input").each((function(e){if(e>=d)return $("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if(""==$(this).val()&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;var t=CustomRelatedListObj.validateCustomRelatedListField($(this).val());if(t&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty.error")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if((t=validateIsNumberAsFirstChar($(this).val()))&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty.number")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if((t=validateForForeignLanguage($(this).val()))&&-1!=o)o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.foreignlanguage.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{if((t=validateFieldLength($(this).val(),100))&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.lengthexceeded")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;s=0==e?$(this).val():s+"#sargn#"+$(this).val()}})),1==o){var m=s.split("#sargn#");m=m.sort();for(var c=new Array,u=0;u<m.length-1;u+=1)m[u+1]==m[0]&&c.push(m[0]);if(c.length>0)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.duplicate")),!1}if(1==o){$("#argument-body tr select").each((function(e){if(e>=d)return!1;l=0==e?$(this).val():l+"#sargt#"+$(this).val()}));var p=$("[name='module']").val(),f=($("[name='id']").val(),Crm.getCrmBasePath()+"/CustomRelatedList.do"),v="action=createCustomFunctionInZohoCreator&module="+p+"&functionName="+t+"&argName="+encodeURIComponent(s)+"&argType="+encodeURIComponent(l)+"&desc="+encodeURIComponent(n)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&relatedListName="+a;mR(f,(function(e){if("true"==i){var t=$("#newRelatedListPopUpDiv");t.hide().removeClass().addClass("newpopup p30 w770 newPopupStyleEle"),t.html(e),t.css("zIndex",200),t.css({padding:"0px",width:"1000px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),t.show()}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),getObj("funcEditFrame").width="850px",getObj("funcEditFrame").height="500px",EvalInnerScript($("#topBandPopup").get(0));commonUtils.showHideLoadingDiv()}),v)}}}))}}},CustomRelatedListObj.showGalleryFunctionDesc=function(e,t,a){var n=CustomRelatedListObj.getCurrentPageDetails("module"),i=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionInfo&workflowLinkId="+e+"&currentModule="+n+"&frm=gallery&install="+a;mR(i,(function(e){$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.addCustomAppAsRL=function(e,t){var a=CustomRelatedListObj.getCurrentPageDetails("module"),n=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showFormsAndViewsOfAnCustomApp&module="+a+"&appLinkName="+e+"&appName="+t;CustomRelatedListObj.fromModuleBuilder&&(n+="&fromModuleBuilder=true"),mR(n,(function(e){"NoForms"==e?alert(I18n.getMsg("crm.newrelatedlist.label.customApps.noMappingField")):($("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv())}))},CustomRelatedListObj.deleteCustomFunction=function(e){var t=CustomRelatedListObj.getCurrentPageDetails("module"),a=Crm.getCrmBasePath()+"/CustomRelatedList.do",n="action=deleteCustomFunction&module="+t+"&workflowLinkId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(a,(function(e){$("#lookupdiv").hide(),CustomRelatedListObj.listCustomFunctions(),crmui.hidePopup("lookupdiv")}),n)},CustomRelatedListObj.viewCustomFunctionScript=function(e,t,a){var n=Crm.getCrmBasePath()+"/CustomRelatedList.do";mR(n,(function(e){$("#topBandPopup").html(e)}),"action=viewCustomFunctionScript&workflowLinkId="+e+"&functionName="+t+"&isInstalled="+a)},CustomRelatedListObj.publishCustomFunction=function(e,t,a,n){void 0===a&&(a=null),void 0===n&&(n=null);var i=$("[name='functionName']").val().trim();if(""==i)renderingUtils.displayErrorDiv("functionName","Name","crm.label.customfunction.publishgallery.functionNameempty"),$("[name='functionName']").focus();else{var o=getClrTxtPtnResChars(i);if(""!=o)functionNameErrorMsg=I18n.getMsg("crm.label.customfunction.publishgallery.functionName.error")+" "+o,alert(functionNameErrorMsg),$("[name='functionName']").focus();else if(validateFieldLength(i,100))renderingUtils.displayErrorDiv("functionName","Name","crm.label.newrelatedlist.functionname.lengthexceeded"),$("[name='functionName']").focus();else{var r=$("[name='funcDescription']").val().trim();if(""==r)renderingUtils.displayErrorDiv("functionDescription","Description","crm.label.customfunction.publishgallery.descriptionempty"),$("[name='funcDescription']").focus();else if(validateFieldLength(r,2500))renderingUtils.displayErrorDiv("functionDescription","Description","crm.label.description.exceeded"),$("[name='funcDescription']").focus();else{var s=$("[name='authorName']").val().trim();if(""==s)renderingUtils.displayErrorDiv("authorName","Name","crm.label.customfunction.publishgallery.authorNameempty"),$("[name='authorName']").focus();else if(""!=(o=getClrTxtPtnResChars(s)))authorNameErrorMsg=I18n.getMsg("crm.label.customfunction.publishgallery.authorName.error")+" "+o,alert(authorNameErrorMsg),$("[name='authorName']").focus();else if(validateFieldLength(s,100))renderingUtils.displayErrorDiv("authorName","Name","crm.label.customfunction.publishgallery.authorname.lengthexceeded"),$("[name='authorName']").focus();else{renderingUtils.freezeBackground();var l="<div><div class='crm-heading-font-size br_top_dotted_white br_bottom_dotted_border4 pB5'>"+I18n.getMsg("crm.label.confirmation")+"</div><br/><ul type='disc'><li class=pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message1")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message2")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message3")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message4")+"</li></ul><br/><div class='mT15'><input type='button' value='"+I18n.getMsg("crm.button.customfunction.publish.message.understand")+"'class='primarybtn' onclick='CustomRelatedListObj.publishCustomFunctionToGallery(\""+e+'", '+t+', "'+a+'", "'+n+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='crmui.hidePopup(\"lookupdiv\")'></div></div>";$("#lookupdiv").html(l),$("#lookupdiv").css("zIndex",1e4),crmui.showPopup("lookupdiv")}}}}},CustomRelatedListObj.publishCustomFunctionToGallery=function(e,t,a,n){functionName=$("[name='functionName']").val().trim(),authorName=$("[name='authorName']").val().trim(),desc=$("[name='funcDescription']").val().trim();var i=Crm.getCrmBasePath()+"/CustomRelatedList.do",o="action=publishCustomFunctionToGallery&functionDisplayName="+functionName+"&authorName="+authorName+"&workflowLinkId="+e+"&description="+encodeURIComponent(desc)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+(t?"&isWorkFlow=true":"");mR(i,(function(e){t?(showURLinPopup(Crm.getCrmBasePath()+"/WorkFlowDeluge.do?step=newWFDeluge1&fromSource="+a+"&relatedModule="+n,"800px","auto",void 0,void 0,!0,!1,!0),crmui.hidePopup("lookupdiv")):(CustomRelatedListObj.listCustomFunctions(),crmui.hidePopup("lookupdiv"))}),o)},CustomRelatedListObj.showDeleteCreatorRecordAlertDiv=function(e,t){renderingUtils.freezeBackground();var a="<div class='p30 crm-base-font-size'>"+I18n.getMsg("crm.label.newrelatedlist.customapp.creatorrecord.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCreatorRecord(\""+e+'", "'+t+"\" )'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='hide(\"lookupdiv\"),renderingUtils.removeFreezeLayer()'></div>";$("#lookupdiv").html(a),mailsetCenter("lookupdiv"),$("#lookupdiv").show()},CustomRelatedListObj.constructRelListData=function(e,t){const a={},n=store.peekAll("related_list").find((t=>t.id===e));return a.id=e,a.label=n&&n.name||"",a.associated_feature_type="widget",a.associated_feature_resource=t&&Object.keys(t).length?{name:t.NAME,api_name:t.API_NAME,id:t.ID}:{},a},CustomRelatedListObj.deleteCreatorRecord=function(e,t){var a=Crm.getCrmBasePath()+"/CustomRelatedList.do",n=CustomRelatedListObj.getCurrentPageDetails("module"),i="action=deleteCreatorRecord&recordId="+e+"&listRelationId="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+n,o=$("[name='id']").val();mR(a,(function(e){hide("lookupdiv"),0!=e.indexOf("success")&&alert(I18n.getMsg(e)),CustomRelatedListObj.checkForCanvasMode()||Crm.renderDVLyteFlow(n)?CustomRelatedListObj.reloadRL(t):CustomRelatedListObj.connectToCustomRelatedList(n,t,o)}),i),renderingUtils.removeFreezeLayer()},CustomRelatedListObj.connectToCustomRelatedList=function(e,t,a){if(("undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("RelatedList",t):void 0)||null==usernameNeeded||"boolean"!=typeof usernameNeeded||1!=usernameNeeded||-1!=jQuery.inArray("creator",usernameNotNeeded)){var n=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomRelatedListRecords&module="+e+"&listRelationId="+t+"&entityId="+a,i="#customRelatedListDiv_"+t;if(0!=$(i).length){var o="<table border='0' width='95%' cellspacing='0' cellpadding='0' align='center' class='norec'> <tbody><tr> <td class='p15'><center><img height='20' src='"+networkUtils.getImageUrl("moreloading1_lightmode.gif",ResourceConstants.CRM)+"' data-image-mode='true'></center></td> </tr> </tbody></table>";$(i).html(o)}mR(n,(function(e){0!=$(i).length?($(i).html(e),$("#newleft_"+t).length&&populateRLCount(t,!0)):getOpenerObj(t)&&($(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=""+e)}),"",(function(){var e="<table border='0' width='100%' cellspacing='0' cellpadding='0' align='center' class='norec'><tbody><tr><td align='center'><div class='pR30'>"+I18n.getMsg("crm.label.xmlparseError")+"</div></td></tr></tbody></table>";0!=$(i).length?$(i).html(e):getOpenerObj(t)&&($(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=""+e)}),"false")}else{commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.connectToCustomRelatedListAsCallback(e,t,a)}),"creator")}},CustomRelatedListObj.listCreatorApps=function(){var e=CustomRelatedListObj.getCurrentPageDetails("module"),t=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=listCreatorApps&module="+e;mR(t,(function(e){if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded"));else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",t))}else $("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv()}))},CustomRelatedListObj.saveCustomRelatedList=function(e){$("#language").val(customFunctionsObj.language);var t=$(e);return CustomRelatedListObj.fromModuleBuilder&&t.find("input[name='fromModuleBuilder']").length<=0?t.append("<input type='hidden' name='fromModuleBuilder' value='true'>"):!CustomRelatedListObj.fromModuleBuilder&&t.find("input[name='fromModuleBuilder']").length>0&&t.find("input[name='fromModuleBuilder']").remove(),"true"===Crm.userDetails.MPL_MIGRATION_COMPLETED&&!CustomRelatedListObj.fromModuleBuilder&&null!=$("#entityID").val()&&t.find("input[name='entityId']").length<=0&&t.append("<input type='hidden' name='entityId' value='"+$("#entityID").val()+"'>"),UpdateDetails(["customRelatedListSubmit"],e,"","",(function(t){if(CustomRelatedListObj.currentAction=CustomRelatedListObj.currentRLId?"UPDATE":"CREATE",CustomRelatedListObj.checkForCanvasMode()&&null!=CustomRelatedListObj.currentRLId){var a=$("#relatedListName").val(),n=$L(".customRLName_"+CustomRelatedListObj.currentRLId);n.length>0&&n.text(a),hideAnimatePopup("topBandPopup",!0),renderingUtils.removeFreezeLayer(),CustomRelatedListObj.reloadRL(CustomRelatedListObj.currentRLId),reloadRelatedList()}else if(CustomRelatedListObj.fromModuleBuilder)hideAnimatePopup("topBandPopup"),renderingUtils.removeFreezeLayer(),CMB.showCustomRelatedList(t);else{a=$("#relatedListName").val();reloadRelatedList();var i=$("#clType").val();let n=e.querySelector("#luxCompName");!t&&n&&n.value&&crmui.showMsgBand("success",I18n.getMsg("crm.label.relatedlist.save.success"),3e3),setTimeout((function(){CustomRelatedListObj.showRLSuccessDiv(a,i)}),2e3),$L("#topBandPopup").scrollTo({axis:"y",duration:1e3,offset:-50})}}))},CustomRelatedListObj.saveCustomAppAsRLCallback=function(e){if(CustomRelatedListObj.currentAction=CustomRelatedListObj.currentRLId?"UPDATE":"CREATE",CustomRelatedListObj.checkForCanvasMode()&&null!=CustomRelatedListObj.currentRLId){var t=$("#relatedListTemp").val(),a=$L(".customRLName_"+CustomRelatedListObj.currentRLId);a.length>0&&a.text(t),CustomRelatedListObj.reloadRL(CustomRelatedListObj.currentRLId),hideAnimatePopup("topBandPopup",!0),renderingUtils.removeFreezeLayer(),reloadRelatedList()}else CustomRelatedListObj.fromModuleBuilder?(hideAnimatePopup("topBandPopup"),renderingUtils.removeFreezeLayer(),CMB.showCustomRelatedList(e)):(reloadRelatedList(),$L("#topBandPopup").scrollTo({axis:"y",duration:1e3,offset:-50}))},CustomRelatedListObj.loadCustomFunctionInCallBack=function(e,t,a,n){var i=$("[name='module']",parent.document).val();if("edit"!=t){var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomFunctionParams&workflowLinkId="+e+"&currentModule="+i+"&condition="+t+"&functionName="+a;mR(o,(function(e){$("#topBandPopup").empty(),$("#topBandPopup",parent.document)[0].innerHTML=e,EvalInnerScript($("#topBandPopup").get(0))}))}else{var r=n.substr(n.indexOf("_")+1,n.length);o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=editCustomRelatedList&module="+i+"&listRelationId="+r;mR(o,(function(e){$("#topBandPopup").empty(),$("#topBandPopup",parent.document)[0].innerHTML=e,EvalInnerScript($("#topBandPopup").get(0))}))}},CustomRelatedListObj.connectToCustomRelatedListAsCallback=function(e,t,a){reloadRelatedList(""),CustomRelatedListObj.connectToCustomRelatedList(e,t,a)},CustomRelatedListObj.addNewCustomFuntion=function(){renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(!0),setDivWidthHeight("topBandPopup");var e=$("[name='modulelist']").val(),t=Crm.getCrmBasePath()+"/CustomButton.do?step=createNewButtonFunction&module="+e;mR(t,(function(e){if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded"));else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",t))}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.doCustomRleatedList=function(e,t,a){CustomRelatedListObj.downloadRLFunctionFiles((function(){customFunctionsObj.isFrom="relatedlist";var a=e.substr(e.indexOf("_")+1,e.length),n=CustomRelatedListObj.getCurrentPageDetails("module"),i=CustomRelatedListObj.getCurrentPageDetails("entityId");if($("#customRelatedListMenuDiv"+a).hide(),Crm.userDetails.isRelatedListLyteEnabled||$("#rlDropDown_"+a).css("visibility","hidden"),!n&&CustomRelatedListObj.fromModuleBuilder&&(n=CrmPageLayout.module),"edit"==t)if(CustomRelatedListObj.currentRLId=a,null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("creator",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.doCustomRleatedList(e,t)}),"creator")}else{commonUtils.showHideLoadingDiv(!0);var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=editCustomRelatedList&module="+n+"&listRelationId="+a;CustomRelatedListObj.fromModuleBuilder&&(o+="&fromModuleBuilder=true"),mR(o,(function(e){$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),renderingUtils.freezeBackground(),commonUtils.showHideLoadingDiv(),EvalInnerScript($("#topBandPopup").get(0))}))}else if("hide"==t){o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=hideRelatedList&module="+n+"&listRelationId="+a+"&entityId="+i;var r=csrfParamName+"="+encodeURIComponent(csrfToken);mR(o,(function(e){Crm.userDetails.isRelatedListLyteEnabled?(Crm.renderDVLyteFlow(n)&&(CustomRelatedListObj.currentRLId=a,CustomRelatedListObj.currentAction="HIDE"),document.getElementById("relatedList"+a).remove(),document.getElementById("newleft_"+a).remove()):reloadRelatedList("reload")}),r)}else"reorder"==t?showCustomizePopup("RelatedList",n):"del"==t&&Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_customRelatedListDeletePop.js"],ResourceConstants.CRM)).then((function(){if(Crm.userDetails.MPL_MIGRATION_COMPLETED){var e=CustomRelatedListObj.fromModuleBuilder,t={};t.listrelationId=a,t.module=n,t.isFromModuleBuilder=e,t.layoutId=e?CrmPageLayout.layoutId:CustomRelatedListObj.getCurrentPageDetails("layoutId");var i=Crm.getCrmBasePath()+"/CustomRelatedList.do",o={action:"validateDeleteCustomRL"};o.cfInfoJson=JSON.stringify(t),o[csrfParamName]=encodeURIComponent(csrfToken),mR(i,(function(e){renderingUtils.freezeBackground();var t=JSON.parse(e),i=$(Handlebars.templates.relatedListDeletePop()),o=i.find("#flddelmsg");if(i.find("#WrngTitle").text(I18n.getMsg("crm.label.relatedlist.delete.popup.heading",t.label)),o.html(""),t.layoutIds){for(var r=t.layoutIds,s="<b>"+r[0]+"</b>",l=r.length,d=1;d<l-1;d++)s=s+", <b>"+r[d]+"</b>";l>2?s=s+", "+I18n.getMsg("crm.label.lowercase.and")+" <b>"+r[r.length-1]+"</b>":l>1&&(s=s+" "+I18n.getMsg("crm.label.lowercase.and")+" <b>"+r[r.length-1]+"</b>"),o.append("<p>"+I18n.getMsg("crm.label.relatedlist.delete.popup.desc.msg",s)+"</p>")}o.append("<p>"+I18n.getMsg("crm.label.relatedlist.delete.popup.desc",s)+"</p>"),i.find(".redbtn").val(I18n.getMsg("crm.button.yes.delete.it")).attr("onclick",'CustomRelatedListObj.deleteCustomRelatedList("'+a+'","'+n+'")'),i.find(".newgraybtn").val(I18n.getMsg("crm.label.auto.enrich.deactivate.confirm.no")).attr("onclick","CustomRelatedListObj.closeRLDeleteAlartPopup()"),$("body").append(i)}),o)}else{renderingUtils.freezeBackground();var r="<div class='p30 crm-base-font-size delRelateListPop'>"+I18n.getMsg("crm.label.newrelatedlist.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomRelatedList(\""+a+'","'+n+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='CustomRelatedListObj.closeWarningMessage(\"lookupdiv\")'></div>";$("#lookupdiv").html(r),mailsetCenter("lookupdiv"),$("#lookupdiv").css("zIndex",10001),$("#lookupdiv").show()}}))}))},CustomRelatedListObj.closeRLDeleteAlartPopup=function(){$("#customRelListDelPop").remove(),renderingUtils.removeFreezeLayer()},CustomRelatedListObj.validateCustomRelatedListField=function(e,t){var a=!1;return"name"!=t?a=validateFields(e):(a=isFieldEmpty(e))||(a=validateSplCharInNameFields(e)),a||(a=validateWhiteSpace(e)),a},CustomRelatedListObj.checkSpecialChar=function(e){var t,a=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","?",":","<",">",":",".",",","$","=","/");for(t=0;t<a.length;t++)if(e.indexOf(a[t])>=0)return!0;return!1},CustomRelatedListObj.showRLSuccessDiv=function(e,t){"edit"?($("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.updated")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$("#DefaultRLSuccessMsg").hide()}),2e3)):($("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.added")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$("#DefaultRLSuccessMsg").hide()}),2e3))},CustomRelatedListObj.closeCreatorRecordDiv=function(e,t,a){hideAnimatePopup("topBandPopup"),CustomRelatedListObj.checkForCanvasMode()||Crm.renderDVLyteFlow(e)?CustomRelatedListObj.reloadRL(t):CustomRelatedListObj.connectToCustomRelatedList(e,t,a)},CustomRelatedListObj.deleteCustomRLFromCustomApps=function(e,t,a){var n=Crm.getCrmBasePath()+"/CustomRelatedList.do",i="action=delRelatedList&listRelationId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(n,(function(){CrmCreatorCustomAppObj.showCustomAppsToRelatedList(t,a),CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv("lookupdiv")}),i)},CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv=function(e){getObj(e).style.display="none",$("#FreezeLayer").css("zIndex",30)},CustomRelatedListObj.showDeleteCustomRLFromCustomAppsAlertDiv=function(e,t,a){renderingUtils.freezeBackground();var n="<div class='p30 crm-base-font-size'>"+I18n.getMsg("crm.label.newrelatedlist.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomRLFromCustomApps(\""+e+'","'+t+'","'+a+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv(\"lookupdiv\")'></div>";$("#lookupdiv").html(n).css("zIndex",10002).show(),$("#FreezeLayer").css("zIndex",10001),mailsetCenter("lookupdiv")},CustomRelatedListObj.closeEditURL=function(){getObj("creatorFormDiv").style.display="none",$("#creatorFormDiv").empty();var e=$("#FreezeLayer");e.length>0?e.remove():Utils.windowLocationReload()},CustomRelatedListObj.closeWarningMessage=function(e){getObj(e).style.display="none",renderingUtils.removeFreezeLayer()},CustomRelatedListObj.openWarningMessage=function(e,t,a){if(getObj("deleteTabName").value=t,"deleteTabGroup"==e)hideMenu(),showDeletePopup(I18n.getMsg("crm.tabgroup.deleteWarning"),"crm.button.delete","","",a);else{if(renderingUtils.freezeBackground(),"deActivateCreator"==e)var n="CreatorDeactivationWarningDiv";else if("deleteCreatorTab"==e)n="CreatorDeleteCreatorWarningDiv";else if("creatorEditForm"==e)n="CreatorFormEditWarningDiv";else if("createCreatorAcc"==e)n="CreateCreatorAccWarningDiv";getObj(n).style.display="block",getObj(n).style.zIndex=10001,"deActivateCreator"!=e&&"deleteCreatorTab"!=e&&"createCreatorAcc"!=e||mailsetCenter(n)}},CustomRelatedListObj.cancelOperationInCustomFunction=function(){crmui.hidePopup("newRelatedListPopUpDiv"),$("#addCustomFunctionForm").hide(),renderingUtils.removeFreezeLayer(),$("#freezeBackGround").hide(),"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1)},CustomRelatedListObj.updateDRECustomFunction=function(e,t,a,n,i,o,r,s,l,d,m){var c={action:"updateDRECustomFunction"};c.functionName=e,c.functionDescription=t,c.workFlowLinkId=a,c.functionScript=n,c[csrfParamName]=encodeURIComponent(csrfToken),c.entityParamName=i,c.entityParamVal=o,c.customParamName=r,c.customParamVal=s,c.module=$("#module").val(),l||(l=0),c.listRelationId=l,c.relatedListName=$("#relatedListNameTemp").val();var u=customFunctionsObj.language;c.language=u,m&&(c.commitMessage=m);var p=new crmRequestPool,f=Crm.getCrmBasePath()+"/CustomRelatedList.do";p.initiate({data:c,action:f,success:function(e){if($(".functionBtn").removeClass("inActiveSec"),$(".clickSave").removeClass("inActiveSec"),(e=JSON.parse(e)).dreResponse){if(customFunctionsObj.delugeEditor.v2&&"deluge"===customFunctionsObj.language)return void d(e);var t=$("crm-function-editor")[0];t.component.setData("error",""),t.component.setData("output",""),t.component.setData("info",""),$(".functionoutputCont").addClass("hide"),$(".cusFunctOutputCont").hasClass("openCusFunctOutputCont")||$(".ouputToggleHook").click(),$(".errorSaveTagClass").removeClass("hide"),$(".successTagClass").addClass("hide");var a=JSON.parse(e.dreResponse),n=a.errorMessage;return a.lineNumber&&(n=n+" Line Number: "+a.lineNumber),t.component.setData("error",n),!1}if(CustomRelatedListObj&&CustomRelatedListObj.fromModuleBuilder?$("#customizeModuleDiv").show():CustomRelatedListObj.checkForCanvasMode()?$("#show").css("display","block"):($("#show").css("display","block"),$("#BodyContent").css("display","block")),customFunctionsObj.removeEditor(),$("#tabLayer").show(),$L(".nextGenUILeftMenu").show(),ZohoDRE.resetRequestData(),0==l||"null"==l){var i=Handlebars.templates.CustomRelatedListName(e),o=$("#newRelatedListPopUpDiv");o.hide().removeClass().addClass("newpopup p30 w770 newInputStyleEle newPopupStyleEle"),o.html(i),o.css("zIndex",200),commonUtils.showHideLoadingDiv(),o.css({padding:"0px",width:"600px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1})}else crmui.showMsgBand("success",I18n.getMsg("crm.label.relatedlist.save.success"),1e3),crmui.hidePopup("newRelatedListPopUpDiv"),$("#addCustomFunctionForm").hide(),CustomRelatedListObj&&CustomRelatedListObj.fromModuleBuilder?(renderingUtils.hideFreezeLayer(),renderingUtils.removeFreezeLayer()):CustomRelatedListObj.checkForCanvasMode()?(CustomRelatedListObj.reloadRL(l),reloadRelatedList("reload")):(l&&(CustomRelatedListObj.currentRLId=l),CustomRelatedListObj.currentAction=l?"UPDATE":"CREATE",reloadRelatedList("reload"));customFunctionsObj.listRelationId=null},error:function(){d&&d()}})},CustomRelatedListObj.saveNewCustomRelatedList=function(e){var t=$("#crlRelatedListName").val();if(null!=t&&(t=t.trim()),""==t||!t.length)return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NameRequired"),"2000"),!1;if(!CustomRelatedListObj.validateRLName())return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NoSplCharsInName"),"2000"),!1;var a=CustomRelatedListObj.fromModuleBuilder,n=CustomRelatedListObj.getCurrentPageDetails("module");if(a&&(CMB.usedLabels.relatedlistlabels[n].contains(t.toLowerCase())||["abm"].contains(t.toLowerCase())))return crmui.showMsgBand("error",I18n.getMsg("crm.mb.relatedlist.label.dplk"),"2000"),!1;var i=JSON.parse(e);i.relatedListName=t,i.module=n,i.isFromModuleBuilder=a;let o=CustomRelatedListObj.getCurrentPageDetails("layoutId");a?i.layoutId=CrmPageLayout.layoutId:o&&(i.layoutId=o);var r=Crm.getCrmBasePath()+"/CustomRelatedList.do",s={action:"saveDRECustomRelatedList"};s.cfInfoJson=JSON.stringify(i),s[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({data:s,action:r,success:function(e){if(e&&e.toString().indexOf("CUSTOM_RELATED_LIST_ERROR")>-1){const t=JSON.parse(e).CUSTOM_RELATED_LIST_ERROR;return crmui.showMsgBand("error",t,"2000"),!1}if("DUPLICATED"==e)return crmui.showMsgBand("error",I18n.getMsg("crm.mb.relatedlist.label.dplk"),"2000"),!1;if("RESTRICTED_LABEL"===e)return crmui.showMsgBand("error",I18n.getMsg("crm.mb.import.relatedlist.label.sykw"),"2000"),!1;if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];return crmui.showMsgBand("error",I18n.getMsg("crm.label.newrelatedlist.exceeded",t),"2000"),!1}if(a){var n=JSON.parse(e);CMB.showCustomRelatedList(n)}crmui.showMsgBand("success",I18n.getMsg("crm.label.relatedlist.save.success"),1e3),$("#addCustomFunctionForm").hide(),a?(renderingUtils.hideFreezeLayer(),renderingUtils.removeFreezeLayer()):(CustomRelatedListObj.currentAction="CREATE","widget"===i.type||"lux_component"===i.type?Utils.windowLocationHref(window.location.href):reloadRelatedList("reload")),$("#newRelatedListPopUpDiv").hide()}})},CustomRelatedListObj.isDetailViewLyteCompPresent=function(){return!!$L("crm-detail-view").length},CustomRelatedListObj.getCurrentDetailViewComp=function(){let e=$L("crm-detail-view");return e.length&&(e=e[0].component.data),e},CustomRelatedListObj.getCurrentPageDetails=function(e){let t=CustomRelatedListObj.getCurrentDetailViewComp();const a=function(){return CustomRelatedListObj.fromModuleBuilder?CrmPageLayout.layoutId:"undefined"!=typeof detailView&&"undefined"!=typeof returnJson&&returnJson.layout_jsonarrayObj&&returnJson.layout_jsonarrayObj.currLayoutId},n=function(){return CustomRelatedListObj.fromModuleBuilder?CrmPageLayout.layoutId:t&&t.layoutId},i=()=>$L("#id").val(),o=()=>t&&t.entityId,r=()=>$L("#cvid").val(),s=()=>t&&t.moduleData.cvid,l={module:()=>CustomRelatedListObj.isDetailViewLyteCompPresent()?t&&t.module:CustomRelatedListObj.fromModuleBuilder?CrmPageLayout.module:function(){var e;return CustomRelatedListObj.fromModuleBuilder?CrmPageLayout.module:"undefined"!=typeof detailView?detailView.currentModule:e||$L("#module").val()}(),layoutId:()=>CustomRelatedListObj.executeMethod(a,n),entityId:()=>CustomRelatedListObj.executeMethod(i,o),cvId:()=>CustomRelatedListObj.executeMethod(r,s)};return e?l[e]&&l[e].call(this):void 0},CustomRelatedListObj.listWidgets=function(){hideAnimatePopup("topBandPopup");const e=CustomRelatedListObj.getCurrentPageDetails("module");Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-widget-container.js","lyte-fileupload.js","crux-form-component.js","crm-widget-data-store.js","crm-help-link.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("widgets")],ResourceConstants.CRM)),void 0,(function(){Lyte.registeredMixins["crm-widget-utils"].loadWidgetListViewPopup("RELATED_LIST",void 0,e)}))},CustomRelatedListObj.listComponents=function(){hideAnimatePopup("topBandPopup"),luxComponentObject.listLuxComponents("relatedlist")},CustomRelatedListObj.saveWidgetInfo=function(e){CustomRelatedListObj.saveComponentInfo(e,"widget")},CustomRelatedListObj.addLuxComponent=function(){$("#createfunctionpopdiv").html(""),crmui.hidePopup("newRelatedListPopUpDiv");const e=networkUtils.returnDependencyFiles(["crm-lux-bundle.js","crm-lux-mixins.js","crm-lux-helpers.js","crm-help-link.js","lyte-progressbar.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["lux/crm-lux-container.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("lux")],ResourceConstants.CRM);Lyte.injectResources(e.concat(t).concat(a),void 0,(function(){Lyte.registeredMixins["crm-lux-utils"].showComponentsForm({category:"components",isListView:!0,mode:"create"})}))},CustomRelatedListObj.loadCustomRelatedListLuxComponents=function(e,t){let a=$("input[name='installButton']");"install"===e&&a.prop("disabled",!0);var n=detailView.currentModule;!n&&CustomRelatedListObj.fromModuleBuilder&&(n=CrmPageLayout.module);var i=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getLuxComponentParams&currentModule="+n+"&condition="+e+"&luxCompName="+encodeURIComponent(t.name)+"&luxCompId="+t.id;mR(i,(function(t){if("funcNameDuplicated"===t)a.prop("disabled",!1);else if("customRelatedListIncreasedCountExceeded"===t&&"install"===e)a.prop("disabled",!1);else if(-1!==t.toString().indexOf("customRelatedListCountExceeded"))renderingUtils.removeFreezeLayer(),"install"===e&&a.prop("disabled",!1);else{let e=$("#topBandPopup");e.empty(),e[0].innerHTML=t,crmui.hidePopup("newRelatedListPopUpDiv",!0),showAnimatePopup("topBandPopup");var n=0,i=$(".confParamRow").length;for(n=0;n<i;n++)ZohoDRE.addPlaceholder(n+1);renderingUtils.freezeBackground()}}))},CustomRelatedListObj.saveComponentInfo=function(e,t){if(t&&e){var a=store.peekRecord("widget"===t?"widgets":"lux",e);CustomRelatedListObj.compInfo={},CustomRelatedListObj.compInfo.id=e,CustomRelatedListObj.compInfo.name=a.name,CustomRelatedListObj.compInfo.api_name=a.api_name,CustomRelatedListObj.compInfo.description=a.description,CustomRelatedListObj.compInfo.type=t,Handlebars.registerPartial("CustomRelatedListName",Handlebars.templates.CustomRelatedListName);var n=Handlebars.templates.CustomRelatedListName(CustomRelatedListObj.compInfo),i=$("#newRelatedListPopUpDiv");i.addClass("newpopup p30 newInputStyleEle newPopupStyleEle"),i.html(n),i.css("zIndex",200),i.find("td:first").remove(),commonUtils.showHideLoadingDiv(),i.css({padding:"0px"}),crmui.showPopup("newRelatedListPopUpDiv")}},CustomRelatedListObj.validateRLName=function(e){var t=$("#crlRelatedListName").val();e&&(t=$("#"+e).val());var a=["`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","?",":","<",">","=",",","-","$",".","/"],n=a.length,i=0;for(i=0;i<n;i++)if(t.indexOf(a[i])>=0)return!1;return!0},CustomRelatedListObj.downloadRLFunctionFiles=function(e){networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],(function(){var t=networkUtils.returnDependencyFiles(["custom-function-editor.js","reviewprocess.js","crm-function-components-wrapper.js","crm-functions-helper.js","crux-form-component.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient)));var n=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient),i=t.concat(a).concat(n);Lyte.injectResources(i,void 0,(function(){e()}))}),!1)},CustomRelatedListObj.showFullScreen=function(){var e=document.getElementById("creatorRecordFrame");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()};