Lyte.Component.register("crm-field-update",{_template:'<template tag-name="crm-field-update"> <lyte-modal lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-show="{{lbind(showModal)}}" lt-prop-show-close-button="false" lt-prop-wrapper-class="massUpdateModalWrapper" on-close="{{method(\'onCloseModal\')}}" lt-prop-prevent-focus="true" on-resize="{{method(&quot;resizeModal&quot;)}}" on-before-close="{{method(&quot;removeEleFocus&quot;)}}" on-before-show="{{method(&quot;removeEleFocus&quot;)}}" lt-prop-close-on-escape="{{closeOnEscape}}" lt-prop-allow-multiple="true" lt-prop-max-width="750px" on-show="{{method(\'onModalShow\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="mass-update-header"> {{getI18n(\'crm.module.mass.update\')}} </lyte-modal-header> <lyte-modal-content class="mass-update-content"> <div class="divTable"> <div class="divTableTr"> <div class="divTableTd borderNone"> <crux-dropdown cx-prop-zcqa="massupdate_selectField" cx-prop-no-result-message="{{getI18n(\'crm.label.no.options.found\')}}" cx-prop-options="{{fields}}" class="w100_per dIB vaM" on-show="{{method(\'onshow\')}}" cx-prop-user-value="field_label" cx-prop-selected="{{cxSelected}}" cx-prop-system-value="id" on-option-select="{{method(\'onFieldChange\')}}"></crux-dropdown></div> <div class="divTableTd borderNone"> <form name="massUpdateForm" onsubmit="{{action(\'onFormSubmit\')}}"> <template is="if" value="{{hideElement}}"><template case="true"> <lyte-input id="disbaleInput" lt-prop-type="text" class="vaM dIB" lt-prop-width="285px" lt-prop-disabled="true" lt-prop-appearance="box"> </lyte-input> </template><template case="false"><template is="if" value="{{expHandlers(element,\'==\',&quot;lookup&quot;)}}"><template case="true"> <crux-lookup-component cx-prop-from="create" class="mUpdateCruxLookupComp" id="elementComponent" cx-prop-type="single" cx-prop-field="{{selectedField}}" cx-prop-module="{{module}}" on-show-lookup="{{method(\'showLookup\')}}" fetch-module-data="{{method(\'fetchLookupModule\')}}" fetch-records="{{method(\'fetchLookupRecords\')}}" cx-prop-maxlength="{{selectedField.length}}" cx-prop-zcqa="{{if(expHandlers(selectedField.api_name,\'==\',\'Campaign_Source\'),\'massUpdate_CampaignLkp\',concat(dataZcqa,\'_MassUpdate_Value\'))}}" cx-prop-img-zcqa="lookup_img_MassUpdate_CampaignLkp" cx-prop-icon-class="Campaigns-small" cx-prop-input-id="mULookup_{{selectedField.id}}" cx-prop-autocomplete="false"> </crux-lookup-component> </template><template case="false"><template is="if" value="{{expHandlers(element,\'==\',\'pipeline\')}}"><template case="true"> <crux-dropdown cx-prop-type="multi" cx-prop-mandatory="true" cx-prop-zcqa="pl_MUPipeline" id="fieldUpdatepipelineDropdown" cx-prop-options="{{pipelineData}}" cx-prop-user-value="display_value" cx-prop-system-value="id" on-option-select="{{method(\'onPipelineChange\')}}" cx-prop-disabled="{{disableSaveBtn}}"></crux-dropdown> </template><template case="false"><template is="if" value="{{showComp}}"><template case="true"> <template is="component" cx-prop-do-not-skip-first-value="true" cx-prop-clear-error-message="false" class="vaM w100_per {{if(ifEquals(element,\'boolean\'),\'pT8 pB8\',\'\')}}" cx-prop-id="massUpdateEleComp" lt-prop-width="285px" cx-prop-create-yield="true" cx-prop-picklist-values="{{picklistValues}}" fetch-module-data="{{method(\'fetchLookupModule\')}}" fetch-records="{{method(\'fetchLookupRecords\')}}" cx-prop-display-currency="false" cx-prop-appearance="box" cx-prop-zcqa="{{concat(dataZcqa,\'_MassUpdate_Value\')}}" cx-prop-is-color-code-enabled="{{selectedField.enable_colour_code}}" cx-prop-maxlength="{{selectedField.length}}" id="elementComponent" component-name="crux-{{element}}-component" cx-prop-icon-class="Campaigns-small" cx-prop-from="create" cx-prop-module="{{module}}" cx-prop-dont-show-disabled-layouts="true" cx-prop-field="{{selectedField}}" cx-prop-value="{{selectedVal}}" lt-prop-title="{{selectedVal}}" cx-prop-layouts="{{cxLayouts}}" on-value-change="{{method(\'elementValueChange\')}}" cx-prop-type="{{if(multiPicklist,\'multiple\',\'single\')}}" cx-prop-disabled="{{disableSaveBtn}}" cx-prop-filterable="false" cx-prop-show-close-icon="true" cx-prop-width="285px"></template> </template></template></template></template></template></template></template></template> </form> </div> <template is="if" value="{{pipelineError}}"><template case="true"> <span class="form_err_msg alter_err_pos">{{getI18n(\'crm.massupdate.pipeline.msg\')}}</span> </template></template> </div> <template is="if" value="{{expHandlers(showPicklistOptions,\'&amp;&amp;\',multiPicklist)}}"><template case="true"> <div class="picklistOptions"> <lyte-radiobutton lt-prop-type="primary" data-zcqa="multiselect-overwrite" lt-prop-checked="{{lbind(picklistOption.option1)}}" lt-prop-name="primary" lt-prop-value="true" lt-prop-label="{{getI18n(\'crm.import.duplicates.overwrite\')}}" lt-prop-disabled="{{disableSaveBtn}}"> </lyte-radiobutton> <lyte-radiobutton lt-prop-type="primary" data-zcqa="multiselect-add" lt-prop-checked="{{lbind(picklistOption.option2)}}" lt-prop-name="primary" lt-prop-value="false" lt-prop-label="{{getI18n(\'crm.import.duplicates.append\')}}" lt-prop-disabled="{{disableSaveBtn}}"> </lyte-radiobutton> </div> </template></template> <template is="if" value="{{showPipeline}}"><template case="true"> <div class="divTableTr"> <div class="divTableTd alignRight borderNone w200 vaM"> <div class="vaM"><span class="mR15">{{getI18n(\'Pipeline\')}}</span></div></div> <div class="divTableTd borderNone"> <crux-dropdown cx-prop-zcqa="pl_MUPipeline" id="fieldUpdatepipelineDropdown" cx-prop-options="{{pipelineData}}" class="w100_per dIB vaM mandatoryField" cx-prop-user-value="display_value" cx-prop-system-value="id" on-option-select="{{method(\'onPipelineChange\')}}" cx-prop-disabled="{{disableSaveBtn}}"></crux-dropdown> </div> <template is="if" value="{{pipelineError}}"><template case="true"> <span class="form_err_msg alter_err_pos">{{getI18n(\'crm.massupdate.pipeline.msg\')}}</span> </template></template> </div> </template></template> <template is="if" value="{{showStage}}"><template case="true"> <div class="divTableTr {{if(disabledStage,\'op5\',\'\')}}"> <div class="divTableTd borderNone alignRight w200 vaM"> <div class="vaM"><span class="mR15">{{getI18n(\'Stage\')}}</span></div></div> <div class="divTableTd borderNone"> <crux-picklist-component cx-prop-zcqa="pl_MUStage" cx-prop-from="create" cx-prop-module="{{module}}" cx-prop-value="{{lbind(stageSelected)}}" cx-prop-type="single" cx-prop-is-color-code-enabled="{{StageColorEnable}}" cx-prop-field="{{stageField}}" cx-prop-disabled="{{disableSaveBtn}}" id="stageDropdown" cx-prop-picklist-values="{{stageData}}" class="w100_per dIB vaM" on-value-change="{{method(\'onStageChange\')}}" cx-prop-appearance="box"></crux-picklist-component> </div> <template is="if" value="{{stageError}}"><template case="true"> <span class="form_err_msg alter_err_pos">{{getI18n(\'crm.massupdate.stage.msg\')}}</span> </template></template> </div> </template></template> </div> <template is="if" value="{{pipelineStageInfo}}"><template case="true"> <p class="pipelineStageInfo pR pL20 flexAlignCenter mT5"> <span class="crm-small-font-size mT3">{{pipelineStageInfo}}</span> </p> </template></template> <template is="if" value="{{reasonForLossStageInfo}}"><template case="true"> <p class="pipelineStageInfo pR pL20 flexAlignCenter mT5"> <span class="crm-small-font-size mT3">{{reasonForLossStageInfo}}</span> </p> </template></template> </lyte-modal-content> <lyte-modal-footer class="mass-update-footer"> <lyte-button onclick="{{action(\'onCancel\')}}" lt-prop-class="newgraybtn" lt-prop-disabled="{{disableCancelBtn}}" data-zcqa="link_WfDelete_Cancel"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-class="primarybtn" lt-prop-appearance="primary" onclick="{{action(\'onUpdate\')}}" lt-prop-disabled="{{disableSaveBtn}}" data-zcqa="btn_MassUpdate_Save"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.update\')}} </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1,1,1]},{type:"componentDynamic",position:[3,1,1,1,1]},{type:"attr",position:[3,1,1,3,1]},{type:"attr",position:[3,1,1,3,1,1]},{type:"if",position:[3,1,1,3,1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"component",position:[1],dynamicNodes:[]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,1,5]},{type:"if",position:[3,1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]}]}},default:{}},{type:"attr",position:[3,1,5]},{type:"if",position:[3,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,0,0]},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,7]},{type:"if",position:[3,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1,0,0]},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["module","fields","showPicklistOptions","hideElement","picklistOption","selectedField","element","pipelineData","showComp","cxSelected","disabledStage","closeOnEscape","picklistValues","StageColorEnable","stageField","cxLayouts","singularLookupModName","stageSelected","pipelineStageInfo","reasonForLossStageInfo","showModal","disableSaveBtn","disableCancelBtn"],data:function(){return{module:Lyte.attr("string"),fields:Lyte.attr("array"),showPicklistOptions:Lyte.attr("boolean",{default:!1}),hideElement:Lyte.attr("boolean",{default:!0}),picklistOption:Lyte.attr("object",{default:{option1:!0,option2:!1}}),selectedField:Lyte.attr("object"),element:Lyte.attr("string",{default:"txt"}),pipelineData:Lyte.attr("array",{default:[]}),showComp:Lyte.attr("boolean",{default:!0}),cxSelected:Lyte.attr("string"),disabledStage:Lyte.attr("boolean",{default:!0}),closeOnEscape:Lyte.attr("boolean",{default:!1}),picklistValues:Lyte.attr("array"),StageColorEnable:Lyte.attr("boolean",{default:!1}),stageField:Lyte.attr("object"),cxLayouts:Lyte.attr("array"),singularLookupModName:Lyte.attr("string"),stageSelected:Lyte.attr("string",{default:"Select Stage"}),pipelineStageInfo:Lyte.attr("string"),reasonForLossStageInfo:Lyte.attr("string"),showModal:Lyte.attr("boolean",{default:!1}),disableSaveBtn:Lyte.attr("boolean",{default:!0}),disableCancelBtn:Lyte.attr("boolean",{default:!1})}},init:function(){this.$node.show=function(e,t,a){store.unloadAll("pipeline"),customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Clicked",{Module:this.getData("module")}),e&&e.selectedIds&&this.setData("selectedIds",e.selectedIds);var o=e.fields;o.sort(((e,t)=>e.field_label.localeCompare(t.field_label))).unshift({field_label:I18n.getMsg("crm.multiselect.massupdate.select"),id:"-1"}),this.setData("cxSelected","-1"),this.setData("fields",o),this.setData("selectedField",o[0]),this.component.successFn=t,this.component.failurFn=a,this.querySelector("lyte-modal").ltProp("show",!0)}},methods:{onshow:function(e,t){var a=$L("lyte-input",t.childComp)[0];a&&a.focus()},removeEleFocus:function(e){if("Potentials"===this.data.module&&e&&27===e.keyCode){if($L("#searchCreateDiv")[0])return cancelCreateFromLookup(!0,null),!1;var t=$L("crm-entity-lookup")[0],a=t||null;return $L("#entityLookupdiv")[0]?(hideLookupPopupDiv(),!1):!a||!a.getData("ltPropShow")||(a.setData("ltPropShow",!1),!1)}document.activeElement.blur()},onFieldChange:function(e,t){var a=this;this.setData("reasonForLossStageInfo",void 0);var o=this.$node.querySelector("lyte-modal").component.childComp;if(t!==this.data.selectedField.id)if(this.setData("stageData",[{display_value:I18n.getMsg("crm.massupdate.select.stage"),colour_code:null,actual_value:"-None-",id:"-1",zcqa:"pl_MUStage_None"}]),this.resetValue(),"-1"!==t){this.setData({showComp:!1,selectedVal:void 0,disableSaveBtn:!1});var s,i,r=Object.assign(store.peekRecord("field",t),{system_mandatory:!1});switch(this.checkMandatory(r),this.setData("selectedField",r),this.setData("multiPicklist",!1),this.getData("selectedField").data_type){case"email":s="email",i="txt";break;case"phone":s="phone",i="txt";break;case"text":case"textarea":case"autonumber":s="text",i="txt";break;case"website":s="website",i="txt";break;case"currency":case"double":case"integer":case"bigint":s="number",i="txt";break;case"datetime":s="date-time",i="txt";break;case"date":s="date",i="txt";break;case"boolean":s="boolean",i="chk";break;case"picklist":s="picklist",i="select";break;case"userlookup":s="user",i="userlookup";break;case"lookup":s="lookup",i="select",this.setData("singularLookupModName",moduleRecordMapping[r.lookup.module.api_name].singular_label);break;case"multiselectpicklist":this.setData("multiPicklist",!0),s="picklist",i="select",Lyte.objectUtils(this.data.picklistOption,"add","option1",!0),Lyte.objectUtils(this.data.picklistOption,"add","option2",!1)}if("Layout"===this.getData("selectedField").api_name)s="layout",i="select",n=(n=moduleRecordMapping[this.data.module].layouts).filter((e=>"active"===e.status&&("crm"===e.source||"platform_plugin"===e.source||"marketplace_plugin"===e.source)&&e.profiles.find((e=>e.name===Crm.userDetails.PROFILE_NAME)))),this.setData({selectedVal:{layouts:n[0]},cxLayouts:n}),this.prevLayoutId=void 0,this.executeMethod("elementValueChange",n[0]);if("Potentials"===this.data.module&&("Pipeline"===this.getData("selectedField").api_name&&(s="pipeline",this.prevSelPipeline=-1),"Stage"===this.getData("selectedField").api_name&&this.onStageChangeFn(),"Reason_For_Loss__s"===this.getData("selectedField").api_name&&this.setData("reasonForLossStageInfo",I18n.getMsg("crm.rflMassUpd.msg"))),"picklist"===s||"multiselectpicklist"===r.data_type){var l,n,d=[],c=this.data.module,p=(n=moduleRecordMapping[c].layouts).length,m=n.filter((function(e){return"active"===e.status||"hidden"===e.status})),u=m.length;if(u>1&&"picklist"===r.data_type&&"Stage"!==this.data.selectedField.api_name){var g={picklistsData:store.findAll("field",{module:moduleApiMapping[c],data_type:"picklist"},!1,!1,{apiVersion:"2.2"}),api_name:this.data.selectedField.api_name};commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises(g).then((function(e){commonUtils.showHideLoadingDiv(!1);var t=[];e.picklistsData.field.forEach((function(e){e.api_name===g.api_name&&t.push(...e.pick_list_values)}));for(var o=[],s=0;s<u;s++)if(r[m[s].id]&&r[m[s].id].pick_list_values){var i=r[m[s].id].pick_list_values;(l=i.filter((function(e){return"used"===e.type&&-1===o.map((e=>e.actual_value)).indexOf(e.actual_value)}))).length&&o.push(...l)}var n=(t=t.filter((function(e){return-1!==o.map((e=>e.actual_value)).indexOf(e.actual_value)}))).map((e=>e.actual_value)).indexOf("-None-");if(n>-1){var d=t[n];t.splice(n,1)}var c=t;d&&c.unshift(d),a.setData("picklistValues",c),a.setData("selectedVal",void 0!==c[0]?c[0].actual_value:void 0)}))}else{d=[];if(-1===["Activities","Calls","Tasks","Events"].indexOf(c)){for(var h=0;h<p;h++)if(("active"===n[h].status||"hidden"===n[h].status)&&r[n[h].id]&&r[n[h].id].pick_list_values){var f=r[n[h].id].pick_list_values;(l="Stage"===this.data.selectedField.api_name?f.filter((function(e){return-1===d.map((e=>e.actual_value)).indexOf(e.actual_value)})):f.filter((function(e){return"used"===e.type&&-1===d.map((e=>e.actual_value)).indexOf(e.actual_value)}))).length&&d.push(...l)}}else d="Activities"===c?r.pick_list_values:r[n[0].id].pick_list_values;var y=d.map((e=>e.actual_value)).indexOf("-None-");if(y>-1){var v=d[y];d.splice(y,1)}var _=d;v&&_.unshift(v),this.setData("picklistValues",_),"multiselectpicklist"!==r.data_type&&this.setData("selectedVal",void 0!==_[0]?_[0].display_value:void 0)}}if(this.setData("element",s),this.setData("showComp",!0),this.setData("dataZcqa",i),"pipeline"===s){var D=this,w={};moduleRecordMapping.Deals.layouts.forEach((function(e){w[e.name]=store.findAll("pipeline",{layout_id:e.id})})),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises(w).then((function(e){commonUtils.showHideLoadingDiv(!1),D.setData("pipelineData",[{display_value:I18n.getMsg("crm.massupdate.select.pipeline"),id:"-1",zcqa:"pl_MUPipeline_None"}]),Object.keys(e).forEach((function(t){if(0===e[t].length)delete e[t];else{e[t][0].pick_list_values.forEach((function(e){e.zcqa="pl_MUPipeline_"+e.id})),e[t]=e[t][0].pick_list_values;var a={};a[t]=e[t],Lyte.arrayUtils(D.data.pipelineData,"push",a)}}));var t=D.data.fields.find((function(e){return"Stage"===e.api_name}));D.setData({stageField:t,StageColorEnable:t.colour_code_enabled,hideElement:!1,showStage:!0,disabledStage:!0,stageSelected:I18n.getMsg("crm.massupdate.select.stage")})}))}else this.setData("hideElement",!1);if("date"===s||"date-time"===s){var b=o.querySelector("#elementComponent"),M=$L(b).find("lyte-input");M.focus(),M.click()}}else this.setData("selectedField",{field_label:I18n.getMsg("crm.multiselect.massupdate.select"),id:"-1"}),this.setData("disableSaveBtn",!0),this.setData("hideElement",!0);if("user"===s){var C=o.querySelector("#massUpdateEleComp");C.setData("cxPropNoUserLabel",I18n.getMsg("None"));let e=this.getData("module");void 0!==moduleRecordMapping[e]&&"team_based"===moduleRecordMapping[e].access_type&&C.setData("cxPropQueryParam",{include_lite_users:!0})}this.setData("closeOnEscape",!0)},elementValueChange:function(e){if("multiselectpicklist"===this.getData("selectedField").data_type)0!==e.length?this.setData("showPicklistOptions",!0):this.setData("showPicklistOptions",!1);else if("Layout"===this.data.selectedField.api_name&&Crm.userDetails.isMultiPipelineActivated&&"Potentials"===this.data.module&&this.prevLayoutId!==e.id){this.prevLayoutId=e.id;var t=e.id,a=this;a.setData("showPipeline",!1),a.setData("showStage",!1),commonUtils.showHideLoadingDiv(!0),store.findAll("pipeline",{layout_id:t}).then((function(e){if(e.length){a.setData("pipelineData",[]),e[0].pick_list_values.forEach((function(e){e.zcqa="pl_MUPipeline_"+e.id})),Lyte.arrayUtils(a.data.pipelineData,"push",e[0].pick_list_values);var t=a.data.fields.find((function(e){return"Stage"===e.api_name}));a.setData({stageField:t,StageColorEnable:!1,showPipeline:!0,showStage:!0,stageError:!1,stageSelected:I18n.getMsg("crm.massupdate.select.stage")}),a.onPipelineChangeFn(a.data.pipelineData[0].id)}commonUtils.showHideLoadingDiv(!1)}))}"Potentials"===this.data.module&&("Pipeline"===this.data.selectedField.api_name?this.onPipelineChangeFn(e.id):"Stage"===this.data.selectedField.api_name?this.onStageChangeFn(e.id):"Reason_For_Loss__s"===this.data.selectedField.api_name&&this.setData("reasonForLossStageInfo",I18n.getMsg("crm.rflMassUpd.msg")))},fetchLookupRecords:function(e,t){return store.findAll(e,t)},fetchLookupModule:function(e){return store.findRecord("module",e).then((function(e){return e[0]}))},onPipelineChange:function(e,t){this.prevSelPipeline!==t&&(this.prevSelPipeline=t,this.onPipelineChangeFn(t))},onStageChange:function(e){this.onStageChangeFn(e)},onModalShow:function(){var e=this.$node.querySelector("lyte-modal").component.childComp.querySelector("#disbaleInput");e&&e.classList.add("crmBoxInput"),$L("body")[0].focus(),this.setData("closeOnEscape",!1)},onCloseModal:function(){this.closeModal()},resizeModal:function(){for(var e=document.querySelectorAll("lyte-dropdown"),t=e.length,a=0;a<t;a++)e[a].ltProp("isOpen")&&e[a].resetPosition()},showLookup:function(){var e=this.data.selectedField;showLookUp("mULookup_"+this.data.selectedField.id,"elementComponent",e.field_label,e.lookup.module.api_name)}},actions:{onUpdate:function(){this.setData("disableSaveBtn",!0),this.setData("disableCancelBtn",!0),this.updateFn()},onCancel:function(){customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Cancel",{Module:this.getData("module")}),this.setData("showModal",!1)},onFormSubmit:function(){[CrmField.UITYPES.SINGLE_LINE,CrmField.UITYPES.TEXT_FIELD,CrmField.UITYPES.WEBSITE,CrmField.UITYPES.PHONE,CrmField.UITYPES.FAX,CrmField.UITYPES.SKYPE_FIELD,CrmField.UITYPES.PERCENT,CrmField.UITYPES.DATE,CrmField.UITYPES.DATE_LONG,CrmField.UITYPES.DATETIME,CrmField.UITYPES.DATE_TIME2,CrmField.UITYPES.LONG_DATE_TIME,CrmField.UITYPES.EMAIL,CrmField.UITYPES.NUMERIC_FIELD,CrmField.UITYPES.LONG_INTEGER,CrmField.UITYPES.CURRENCY,CrmField.UITYPES.DECIMAL,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,CrmField.UITYPES.CURRENCY_ROUND_OFF].contains(this.data.selectedField.ui_type)&&(this.setData("disableSaveBtn",!0),this.setData("disableCancelBtn",!0),this.updateFn()),event.preventDefault()}},updateFn:function(){customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Confirmed",{Module:this.getData("module")});var e,t=this.$node.querySelector("lyte-modal").component.childComp;if("pipeline"===this.data.element||"Layout"===this.data.selectedField.api_name&&this.data.showPipeline){var a,o;if(!(a=t.querySelector("#fieldUpdatepipelineDropdown").cxProp("selected"))||"-1"===a)return this.setData("pipelineError",!0),this.setData("disableSaveBtn",!1),void this.setData("disableCancelBtn",!1);if(!(o=t.querySelector("#stageDropdown").cxProp("value"))||"Select Stage"===o)return this.setData("stageError",!0),this.setData("disableSaveBtn",!1),void this.setData("disableCancelBtn",!1);if("layout"===this.data.element){var s=t.querySelector("#massUpdateEleComp");$L(s).attr("lt-prop-disabled",!0)}e=!0}"pipeline"!==this.data.element&&(e=(s=t.querySelector("#elementComponent").component).validate());if(e){var i;if("pipeline"===this.data.element)i=a;else{if("lookup"===this.data.element){var r=$("#mULookup_"+this.data.selectedField.id);i={id:r.data("id"),name:r.val()}}else i=s.getValue();"date"===this.data.selectedField.data_type&&i?i=apiDateFormat(i,!0):i&&"Products"===this.data.module&&"Tax"===this.data.selectedField.api_name?i=(i=this.data.picklistValues.filter((function(e){return-1!==i.indexOf(e.actual_value)}))).map((function(e){return{id:e.id}})):i?i&&"Bundles"===this.data.module&&"Tax"===this.data.selectedField.api_name&&(i=i.map((e=>({id:null,value:e})))):i=""}if("multiselectpicklist"===this.data.selectedField.data_type&&0===i.length)return s.setData("cxPropErrorMessage",I18n.getMsg("crm.alert.multiselect.picklist.empty.message")),this.setData("disableSaveBtn",!1),void this.setData("disableCancelBtn",!1);var l={},n={};if("pipeline"===this.data.element?l.Stage=this.data.stageData.filter((function(e){return e.display_value===o}))[0].id:"Layout"===this.data.selectedField.api_name&&this.data.showPipeline&&(l.Pipeline=a,l.Stage=o),l[this.getData("selectedField").api_name]=i,n.data=[].concat(l),this.getData("selectedIds"))n.ids=this.getData("selectedIds");else if(customViewObject.doMassActioninScheduler?n.cvid=customViewObject.cvId:n.ids=customViewObject.selectedIds,customViewObject.doMassActioninScheduler&&moduleRecordMapping[this.getData("module")].territory){n.territory={include_child:!!moduleRecordMapping[this.getData("module")].territory.subordinates&&moduleRecordMapping.Deals.territory.subordinates};var d=moduleRecordMapping[this.getData("module")].territory.id;"0"!==d&&(n.territory.id=d)}"multiselectpicklist"===this.getData("selectedField").data_type&&(n.over_write=this.getData("picklistOption").option1);var c=this,p=crmListView.getObject().totalCount?crmListView.getObject().totalCount:moduleRecordMapping[this.getData("module")].selected_count;if(customViewObject.doMassActioninScheduler&&p>Crm.massOperationWorkflowLimit&&"org_based"===moduleRecordMapping[this.getData("module")].access_type){c=this;var m=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id);commonUtils.showHideLoadingDiv(!0),m.$.triggerAction("get_automated_configured_features",{type:"GET"},{record_action:"update"}).then((function(e){commonUtils.showHideLoadingDiv();var t="";e&&e.automated_configured_features.forEach((function(e){t=e.execute&&"workflow"===e.feature.api_name?I18n.getMsg("crm.mass.actions.workflow.rules"):t,t=e.execute&&"approval_processes"===e.feature.api_name?""===t?I18n.getMsg("crm.mass.actions.approval.process"):t+" & "+I18n.getMsg("crm.mass.actions.approval.process"):t,t=e.execute&&"cadences"===e.feature.api_name?""===t?I18n.getMsg("crm.setup.system.cadences"):t+" & "+I18n.getMsg("crm.setup.system.cadences"):t})),""!==t?(c.setData("showModal",!1),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.mass.actions.rules.alert.content",t),ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",cxPropZcqa:"link_WfDelete_Cancel"},{type:"accept",text:I18n.getMsg("crm.mass.actions.ok.proceed"),appearance:"primary",cxPropZcqa:"btn_MassUpdate_Save"}]},accept:function(){Crm.trackSpotLightAction("Mass Scheduler - Mass Update WorkFlow OK Proceed",{Module:c.getData("module")}),c.updateFunction(n)},reject:function(){Crm.trackSpotLightAction("Mass Scheduler - Mass Update WorkFlow Cancel",{Module:c.getData("module")})}})):c.updateFunction(n)}),(function(e){403===e.status||401===e.status?renderingUtils.displayPermissionDenied():(_cruxUtils.showCustomMessage({id:"",params:{ltPropType:"failure",ltPropMessage:I18n.getMsg("crm.delete.error"),ltPropDuration:"3000"}}),c.setData("showModal",!1))}))}else this.updateFunction(n)}else this.setData("disableSaveBtn",!1),this.setData("disableCancelBtn",!1)},checkMandatory:function(e){var t=!1,a=e.layouts?e.layouts.length:0;if(a)for(var o=0;o<a;o++){var s=e[e.layouts[o].id];if(s&&s.required){t=!0;break}}e.required=t},updateFunction:function(e){var t=this,a=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id);commonUtils.showHideLoadingDiv(!0),a.$.triggerAction("mass_update",e).then((function(e){t.mUpdateResData=e;var a=e.data[0].details;if(isWFSchedulerUser()&&a.isWFScheduler){t.setData("disableSaveBtn",!0);var o=e.data.length,s=a.wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(s),detailView.isMassupdatePopupLoading=!0;var i=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(o);automationActionsNotificationScheduler.massUpdateOffloadTimeout=setTimeout((function(){detailView.isMassupdatePopupLoading&&(detailView.isMassupdatePopupLoading=!1,t.setData("showModal",!1),automationActionsNotificationScheduler.showNotificationInProgress(s,void 0,o),"crm.tab.module.actions.mass-tools"===Lyte.Router.getRouteInstance().transition.info.route?t.successFn(e,!0,"update"):t.handleUpdateSuccess(e,t,(function(e){e.clearSelection(),e.reloadCurrentView(t.getData("module"))}))&&t.reloadCurrentView(t.getData("module")))}),i)}else if(commonUtils.showHideLoadingDiv(),t.setData("showModal",!1),t.successFn)t.successFn(e,!0,"update");else if("ALREADY_SCHEDULED"===e.data[0].code)_cruxUtils.showCustomMessage({id:"info",params:{ltPropType:"success",ltPropClass:"massToolMsgBox",ltPropMessage:I18n.getMsg("crm.mass.actions.cv.running"),ltPropDuration:"4000"}});else if(customViewObject.doMassActioninScheduler)_cruxUtils.showCustomMessage({id:"massUpdate",params:{ltPropType:"success",ltPropClass:"massToolMsgBox",ltPropMessage:I18n.getMsg("crm.mass.actions.mass.update.job")+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"),ltPropDuration:"4000"}}),t.$node.querySelector("lyte-modal").ltProp("show",!1),t.clearSelection();else{t.handleUpdateSuccess(e,t,(function(e){e.clearSelection(),e.reloadCurrentView(t.getData("module"))}))&&t.reloadCurrentView(t.getData("module"))}}),(function(e){commonUtils.showHideLoadingDiv();var a=JSON.parse(e.response);if(a&&a.data&&a.data[0]&&"INVALID_DATA"===a.data[0].code&&Object.keys(a.data[0].details).length){var o=a.data[0].details,s=Object.keys(o).find((e=>"maximum_length"===e||"maximum_decimal_place"===e)),i=t.$node.querySelector("lyte-modal").component.childComp.querySelector("#elementComponent"),r=i?i.component:void 0;if(s){var l=o[s];return r.setData("cxPropErrorMessage",I18n.getMsg("crm.field.character.limit.exceed",l)),t.setData("disableSaveBtn",!1),void t.setData("disableCancelBtn",!1)}if("date"===o.expected_data_type||"datetime"===o.expected_data_type)return r.setData("cxPropErrorMessage",I18n.getMsg("crm.field.valid.check",t.data.selectedField.field_label)),t.setData("disableSaveBtn",!1),void t.setData("disableCancelBtn",!1);if("id"===o.api_name)return r.setData("cxPropErrorMessage",I18n.getMsg("crm.field.valid.check",t.data.selectedField.field_label)),t.setData("disableSaveBtn",!1),void t.setData("disableCancelBtn",!1)}if(t.setData("showModal",!1),t.failurFn)t.failurFn(e);else if(403===e.status||401===e.status)renderingUtils.displayPermissionDenied();else if(customViewObject.doMassActioninScheduler){var n=I18n.getMsg("crm.mass.actions.update"),d=I18n.getMsg("crm.mass.actions.scheduled.fail",[n]);_cruxUtils.showCustomMessage({id:"massUpdate",params:{ltPropType:"error",ltPropMessage:d,ltPropDuration:"4000"}}),t.clearSelection()}else if(400===e.status){t.handleUpdateErrors(e,t)&&t.reloadCurrentView(t.getData("module"))}}))},onPipelineChangeFn:function(e){var t;(this.setData("pipelineError",!1),this.setData("stageData",[]),this.setData("stageData",[{display_value:I18n.getMsg("crm.massupdate.select.stage"),colour_code:null,actual_value:"-None-",id:"-1",zcqa:"pl_MUStage_None"}]),this.setData("stageSelected",I18n.getMsg("crm.massupdate.select.stage")),"-1"!==e)?(this.data.pipelineData.forEach((function(a){a.hasOwnProperty("id")?a.id===e&&(t=a):Object.values(a)[0].forEach((function(a){a.id===e&&(t=a)}))})),this.setData("disabledStage",!1),t.maps.forEach((function(e){e.zcqa="pl_MUStage_"+e.actual_value})),Lyte.arrayUtils(this.data.stageData,"push",t.maps)):(this.setData("disabledStage",!0),this.$node.querySelector("lyte-modal").component.childComp.querySelector("#stageDropdown").cxProp("selected","-1"),this.setData("pipelineStageInfo",void 0));this.setData("stageError",!1)},setAlphabetical:function(e){var t="display_value";return e.sort((function(e,a){var o=e[t].toUpperCase(),s=a[t].toUpperCase();return o<s?-1:o>s?1:0})),e},onStageChangeFn:function(e){this.setData("stageError",!1),e!==I18n.getMsg("crm.massupdate.select.stage")&&"Layout"!==this.data.selectedField.api_name?"Pipeline"===this.data.selectedField.api_name?this.setData("pipelineStageInfo",I18n.getMsg("crm.massupdate.pipeline.info")):this.setData("pipelineStageInfo",I18n.getMsg("crm.massupdate.stage.info")):this.setData("pipelineStageInfo",void 0)},closeModal:function(){var e=this.$node.querySelector("lyte-modal").component.childComp;e&&e.querySelector("crux-dropdown").cxProp("selected","-1"),this.setData("hideElement",!0),this.resetValue()},resetValue:function(){this.setData("showPicklistOptions",!1),this.setData("showPipeline",!1),this.setData("showStage",!1),this.setData("pipelineStageInfo",void 0),this.setData("stageError",!1),this.setData("pipelineError",!1),this.setData("disableCancelBtn",!1),this.setData("reasonForLossStageInfo",void 0)}},{mixins:["crm-view-utils","crm-mass-action-mixin"]}),Lyte.Component.register("crm-record-delete",{_template:'<template tag-name="crm-record-delete"> <lyte-alert lt-prop-yield="true" lt-prop-wrapper-class="massToolAlert" lt-prop-prevent-focus="true" on-show="{{method(\'bindEvent\')}}" lt-prop-show-close-button="false" lt-prop-button-position="center" lt-prop-buttons="{{alertButton}}" on-accept="{{method(\'deleteRecords\')}}" lt-prop-top="0px" lt-prop-animation="slideDown"> <template is="registerYield" yield-name="alert"> <template is="if" value="{{expHandlers(fromQuickActionsMenu,\'&amp;&amp;\',recordName)}}"><template case="true"> <lyte-alert-header class="crm-heading-font-size aligncenter">{{getI18n(\'crm.warning.delete.record\',recordName)}}</lyte-alert-header> </template><template case="false"> <lyte-alert-header class="alertHeader"> <template is="if" value="{{messageContent}}"><template case="true"> {{messageContent}} </template><template case="false"><template is="if" value="{{expHandlers(selectedRecords.length,\'===\',1)}}"><template case="true"> {{getI18n(\'crm.warning.move.to.trash.singular\')}} </template><template case="false"> {{getI18n(\'crm.warning.move.to.trash\')}} </template></template></template></template> </lyte-alert-header> </template></template> <lyte-alert-content class="alertContent"> <template is="if" value="{{relatedRecordNote}}"><template case="true"> <div class="lv_delPopupNotes dIB"><b>{{getI18n(\'crm.note\')}}</b> {{relatedRecordNote}}</div> </template></template> <template is="if" value="{{showNotifyOwner}}"><template case="true"> <lyte-checkbox class="mT5" on-changed="{{method(\'notifyCheckbox\')}}" lt-prop-label="{{getI18n(\'crm.form.owner.notification\')}}"></lyte-checkbox> </template></template> </lyte-alert-content> <lyte-alert-footer class="alertFooter right"> <lyte-button onclick="{{action(\'onCancel\')}}" lt-prop-class="newgraybtn" data-zcqa="PupHome_cancelbtn"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.cancel\')}}</template> </lyte-button> <lyte-button lt-prop-appearance="failure" onclick="{{action(\'deleteRecords\')}}" data-zcqa="PupHome_button_deletebtn" class="record_delete_button"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.label.delete\')}}</template> </lyte-button> <template is="if" value="{{showNotifyOwner}}"><template case="true"> (<lyte-checkbox class="mT5" on-changed="{{method(\'dontShowCheckbox\')}}" lt-prop-label="{{getI18n(\'crm.zohosocial.never.show\')}}"></lyte-checkbox>) </template></template>  </lyte-alert-footer></template> </lyte-alert> <lyte-messagebox lt-prop-yield="true" lt-prop-type="warning" lt-prop-transition="{&quot;animation&quot; : &quot;slideFromTop&quot;}" lt-prop-duration="4000"> <template is="registerYield" yield-name="messageboxYield"> {{encodeHTML(alertMsg)}} </template> </lyte-messagebox> <template is="if" value="{{showWarningPopup}}"><template case="true"> <crm-delete-warning-popup header="{{heading}}" info1="{{info1}}" info2="{{info2}}" skip-button="{{skipAndDeleteBtn}}" details-yield="true" info1-yield="true" on-close="{{method(\'onCancelPopup\')}}" on-skip="{{method(\'onSkipPopup\')}}"> <template is="registerYield" yield-name="info1Yield"> <div id="deleteInfo2" class="crm-font-regular fontSmooth crm-small-font-size crmLabelColor dIB mT20">{{encodeHTML(info1)}}</div> </template> <template is="registerYield" yield-name="detailsYield"> <div id="deleteDetails" class="mT20 p15 infoCont" data-zcqa="campaigns_delete_warning"> <div class="denyHead crm-font-regular mT10" id="{{actionName}}_id"> <template is="if" value="{{expHandlers(transitionData.orchestration.length,\'>=\',1)}}"><template case="true"> <span class="dIB pB5"> {{getI18n(\'crm.setup.system.orchestration\')}} &gt; {{getI18n(\'crm.auditlog.transition\')}} </span> <ul> <template is="for" items="{{transitionData.orchestration}}" item="item" index="index"> <li class="p3 mT2 mB2" data-zcqa="{{item.id}}_id"> <a target="_blank" rel="noopener noreferrer" href="{{item.url}}"> {{item.name}} ( {{item.name}} &gt; {{item.rule.name}} ) </a> </li> </template> </ul> </template></template> <template is="if" value="{{expHandlers(transitionData.pathfinder.length,\'>=\',1)}}"><template case="true"> <span class="crmBaseColor dIB pB5"> {{getI18n(\'crm.setup.system.pathfinder\')}} &gt; {{getI18n(\'pf.touchpoints\')}} </span> <ul> <template is="for" items="{{transitionData.pathfinder}}" item="item" index="index"> <li class="p3 mT2 mB2" data-zcqa="{{item.id}}_id"> <a target="_blank" rel="noopener noreferrer" href="{{concat(getCrmBasePath(),\'/settings/commandcenter/path-finder/\',item.id,\'/view\')}}"> {{item.name}} &gt; {{item.rule.name}} </a> </li> </template> </ul> </template></template> </div> </div> </template> </crm-delete-warning-popup> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0,0]},{type:"text",position:[1,2]}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3]},{type:"attr",position:[5,5]},{type:"if",position:[5,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"registerYield",position:[1,3],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3]},{type:"attr",position:[3,1]},{type:"for",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]},{type:"text",position:[1,1,3]},{type:"text",position:[1,1,5]}]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3]},{type:"attr",position:[3,1]},{type:"for",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]},{type:"text",position:[1,1,3]}]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["alertButton","module","selectedIds","relatedRecordNote","alertMsg","associatedIds","skipAndDeleteBtn","transitionData","info1","info2","heading","selectedRecords","showWarningPopup","fromQuickActionsMenu","recordName","messageContent"],data:function(){return{alertButton:Lyte.attr("array",{default:[{type:"reject",text:I18n.getMsg("crm.button.cancel"),"data-zcqa":"PupHome_cancelbtn"},{type:"accept",text:I18n.getMsg("crm.button.move.to.trash"),appearance:"failure","data-zcqa":"PupHome_button_deletebtn"}]}),module:Lyte.attr("string"),selectedIds:Lyte.attr("array"),relatedRecordNote:Lyte.attr("string"),alertMsg:Lyte.attr("string"),associatedIds:Lyte.attr("array"),skipAndDeleteBtn:Lyte.attr("boolean",{default:!1}),transitionData:Lyte.attr("object"),info1:Lyte.attr("string"),info2:Lyte.attr("string"),heading:Lyte.attr("string"),selectedRecords:Lyte.attr("array"),showWarningPopup:Lyte.attr("boolean",{default:!1}),fromQuickActionsMenu:Lyte.attr("boolean",{default:!1}),recordName:Lyte.attr("string"),messageContent:Lyte.attr("string")}},init:function(){this.$node.show=function(e,t,a){if(Crm.userDetails.permissions["Crm_Implied_Delete_"+this.getData("module")]){if(customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Delete Clicked",{Module:this.getData("module")}),e&&e.selectedIds&&this.setData("selectedIds",e.selectedIds),this.setData("fromQuickActionsMenu",!1),this.setData("recordName",void 0),customViewObject.fromQuickActionsMenu){this.setData("fromQuickActionsMenu",!0);var o=customViewObject.selectedIdForQuickAction[0],s=customViewObject.body.filter((function(e){return e.id===o}));s=s[0],this.setData("recordName",s[crmConstants.moduleDisplayField[this.getData("module")][0]])}this.component.from=e?e.from:void 0,this.component.successFn=t,this.component.failurFn=a,e&&e.ids&&e.ids.length&&this.setData("selectedRecords",e.ids),this.setData("showNotifyOwner","mass_tools"===this.component.from&&localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID)&&("Accounts"===this.getData("module")||"Contacts"===this.getData("module"))&&(crmTab.isBooksIntegrated()||crmTab.isInvoiceIntegrated())),this.querySelector("lyte-alert").ltProp("show",!0)}else _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:I18n.getMsg("crm.security.error"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"center"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg").style="color:#E20000"}})};var e=isRelatedRecordsModule(this.data.module)?I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(this.data.module)):"";this.setData("relatedRecordNote",e)},actions:{deleteRecords:function(){this.deleteRecords()},onCancel:function(){customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Delete Cancel",{Module:this.getData("module")}),this.$node.querySelector("lyte-alert").ltProp("show",!1),customViewObject.fromQuickActionsMenu&&(customViewObject.selectedIdForQuickAction=[],customViewObject.fromQuickActionsMenu=!1)}},methods:{bindEvent:function(){var e=$L(".massToolAlert");if(e[0]){var t=this;e[0].setAttribute("tabindex","0"),e.find(".record_delete_button")[0].focus(),e[0].addEventListener("keydown",(function(){13===event.keyCode&&t.deleteRecords()}))}},notifyCheckbox:function(e){this.notifyOwner=e.checked},dontShowCheckbox:function(e){e.checked?localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0):localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,null)},onCancelPopup:function(){var e=Lyte.Router.getRouteInstance();"list"===e.routeName?this.reloadCurrentView(this.getData("module")):"mass-tools"===e.routeName&&this.selectAllEntity(!0)},onSkipPopup:function(){var e=this.getData("associatedIds"),t=(this.getData("selectedIds")?this.data.selectedIds:customViewObject.selectedIds?customViewObject.selectedIds:[]).filter((function(t){return-1===e.indexOf(t)}));this.deleteRecord({ids:t})}},deleteRecords:function(){var e={};if(this.getData("selectedIds"))e.ids=this.getData("selectedIds");else{if(customViewObject.doMassActioninScheduler?e.cvid=customViewObject.cvId:e.ids=customViewObject.fromQuickActionsMenu?customViewObject.selectedIdForQuickAction:customViewObject.selectedIds,customViewObject.doMassActioninScheduler&&moduleRecordMapping[this.getData("module")].territory){e.territory={include_child:!!moduleRecordMapping[this.getData("module")].territory.subordinates&&moduleRecordMapping.Deals.territory.subordinates};var t=moduleRecordMapping[this.getData("module")].territory.id;"0"!==t&&(e.territory.id=t)}if(customViewObject.doMassActioninScheduler&&"Visits"===this.getData("module")){var a=customViewObject.screenName;e.portalName=a}}customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Delete Confirmed",{Module:this.getData("module")});var o=crmListView.getObject().totalCount?crmListView.getObject().totalCount:moduleRecordMapping[this.getData("module")].id,s=this,i=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id);customViewObject.doMassActioninScheduler&&o>Crm.massOperationWorkflowLimit&&"org_based"===moduleRecordMapping[this.getData("module")].access_type?(commonUtils.showHideLoadingDiv(!0),i.$.triggerAction("get_automated_configured_features",{type:"GET"},{record_action:"delete"}).then((function(t){commonUtils.showHideLoadingDiv();var a="";t&&t.automated_configured_features.forEach((function(e){a=e.execute&&"workflow"===e.feature.api_name?I18n.getMsg("crm.mass.actions.workflow.rules"):a,a=e.execute&&"approval_processes"===e.feature.api_name?""===a?I18n.getMsg("crm.mass.actions.approval.process"):a+" & "+I18n.getMsg("crm.mass.actions.approval.process"):a})),""!==a?_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.mass.actions.rules.alert.content",a),ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",cxPropZcqa:"link_WfDelete_Cancel"},{type:"accept",text:I18n.getMsg("crm.mass.actions.ok.proceed"),appearance:"primary",cxPropZcqa:"btn_MassUpdate_Save"}]},accept:function(){Crm.trackSpotLightAction("Mass Scheduler - Delete WorkFlow OK Proceed",{Module:s.getData("module")}),s.deleteRecord(e)},reject:function(){Crm.trackSpotLightAction("Mass Scheduler - Delete WorkFlow Cancel",{Module:s.getData("module")})}}):s.deleteRecord(e)}))):customViewObject.doMassActioninScheduler||"Campaigns"!==this.data.module?this.deleteRecord(e):i.$.triggerAction("associations",{type:"GET"},{ids:e.ids.join(",")}).then((function(t){var a=[],o=[],i={orchestration:[],pathfinder:[]};t.association.forEach((function(e){if(e.associated_places.length>0){var t=store.peekRecord(moduleRecordMapping.Campaigns.id,e.id).Campaign_Name;o.push(e.id),a.push(t),e.associated_places.forEach((function(e){var t=e.resource,a=e.type;e.details.rule.forEach((function(e){t.rule=e,"pathfinder"===a?i.pathfinder.push(objectUtils.cloneObject_new(t)):(crmTab.isABMCCAvailable&&crmTab.isABMConfigured&&Lyte.registeredMixins.orchestration.isAbmOrchestration(t.id,store.peekAll("orchestration_process"))?t.url=Crm.getCrmBasePath()+"/abm/orchestrations/journey-builder/"+t.id:t.url=Crm.getCrmBasePath()+"/settings/commandcenter/journey-builder/"+t.id,i.orchestration.push(objectUtils.cloneObject_new(t)))}))}))}})),a.length?Lyte.injectResources(networkUtils.returnDependencyFiles("crm-delete-warning-popup.js",ResourceConstants.CRMClient),void 0,(function(){o.length!==s.getData("selectedIds")&&(s.setData("associatedIds",o),s.setData("skipAndDeleteBtn",!0)),s.setData("transitionData",i),s.setData("heading",I18n.getMsg("crm.automation.cannot.delete.text",[I18n.getMsg("crm.campaign.few")])),s.setData("info2",I18n.getMsg("orch.bulk.delete.denypop")),s.setData("info1",I18n.getMsg("crm.campaign.delete.bulk",$ESAPI.encoder().encodeForHTML(a.join(",")))),s.setData("showWarningPopup",!0),s.$node.querySelector("crm-delete-warning-popup").show()})):s.deleteRecord(e)}))},deleteRecord:function(e){var t=this,a=e&&e.ids?e.ids:[],o={},s=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id);commonUtils.showHideLoadingDiv(!0),1===a.length&&"mass_tools"!==this.data.from?o.deleteRec=s.$.triggerAction("single_record_delete",{id:e.ids[0],module:s.api_name}):o.deleteRec=s.$.triggerAction("mass_delete",e),Lyte.resolvePromises(o).then((function(e){e=e.deleteRec,t.$node.querySelector("lyte-alert").ltProp("show",!1),commonUtils.showHideLoadingDiv();try{if($L("#etComposePanel").length>0&&e&&e.data)for(var o=e.data.length,s=0;s<o;s++)e.data[s].details&&e.data[s].details.id&&EmailComposeUtil.closeTabAtDeleteRecords([e.data[s].details.id],void 0,void 0,!0)}catch(e){murphy.error(e)}if(overLayForSelectAllClick(!1),"ALREADY_SCHEDULED"===e.data[0].code)_cruxUtils.showCustomMessage({id:"info",params:{ltPropType:"success",ltPropClass:"massToolMsgBox",ltPropMessage:I18n.getMsg("crm.mass.actions.cv.running"),ltPropDuration:"4000"}});else if(customViewObject.doMassActioninScheduler)_cruxUtils.showCustomMessage({id:"massDelete",params:{ltPropType:"success",ltPropClass:"massToolMsgBox",ltPropMessage:I18n.getMsg("crm.mass.actions.mass.delete.job")+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"),ltPropDuration:"4000"}}),t.clearSelection();else{a.forEach((function(e){var t=$L("#recentItemImg_"+e,"#rItemDataDiv");t.length&&t[0].remove()}));var i=!1,r=0,l=0,n=0;e.data.forEach((function(e){"The product cannot be deleted as it is involved in inventory record"===e.message||"The product cannot be deleted as it is involved in inventory record or product configurator or price rule"===e.message||"The product cannot be deleted as it is involved in inventory record or in a Bundle"===e.message?l++:"Sorry, you cannot perform this operation as the record is locked."===e.message?n++:"SUCCESS"===e.code&&r++}));var d=e.data.length-(l+n+r);if(r===e.data.length){_cruxUtils.showCustomMessage({id:"massDelete",params:{ltPropType:"success",ltPropClass:"massToolMsgBox",ltPropMessage:I18n.getMsg("crm.masstool.delete.success"),ltPropDuration:"4000"}}),t.handleSuccessFn(e,r);var c=$L("crm-list-view-modal")[0];if(c){Lyte.Router.getRouteInstance().refresh().data={reloadAll:!0},c.component.executeMethod("closePopUp")}return}if(l&&n||d){var p=d+n+l;i=I18n.getMsg("crm.massdelete.bulk.failure",[r,p])}else d||(i=l?"Products"===moduleRecordMapping[t.getData("module")].module_name?I18n.getMsg("crm.cannot.delete.cpq.product.reason.partial.msg.new",[r,l]):I18n.getMsg("crm.cannot.delete.cpq.record.reason.partial.msg",[r,l]):I18n.getMsg("crm.massdelete.bulk.lock.failure",[r,n]));var m=e;_cruxUtils.showCustomAlert({id:"massDeleteLockMixed",params:{ltPropWrapperClass:"massDeleteAlert",ltPropContentAlign:"center",ltPropCloseOnEscape:!1,ltPropButtonPosition:"center",ltPropSecondaryMessage:i,ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"primary",cxPropZcqa:"massDeleteLockMixed"}],ltPropButtonPosition:"center"},accept:function(){t.handleSuccessFn(m,r)}})}}),(function(e){if(commonUtils.showHideLoadingDiv(),customViewObject.fromQuickActionsMenu&&(customViewObject.selectedIdForQuickAction=[],customViewObject.fromQuickActionsMenu=!1),t.$node.querySelector("lyte-alert").ltProp("show",!1),t.failurFn)t.failurFn(e);else if(403===e.status||401===e.status)renderingUtils.displayPermissionDenied();else{t.handleDeleteErrors(e,t)&&t.reloadCurrentView(t.getData("module"))}}))},handleSuccessFn:function(e,t){var a=Lyte.Router.getRouteInstance();if(this.successFn)this.successFn(e,!0,"delete");else if("global-search"===a.routeName||"list"===a.routeName||"canvas"===a.routeName||"kanban"===a.routeName)if(t=customViewObject.fromQuickActionsMenu?1:t,(customViewObject.totalCount%customViewObject.currentOption===t||t===customViewObject.currentOption)&&customViewObject.totalCount>customViewObject.currentOption){var o=customViewObject.totalCount-t;crmTab.deleteFromCache(customViewObject.module),this.hideCVbtns();var s=Math.round(o/customViewObject.currentOption);0===Math.round(o%customViewObject.currentOption)&&a.getQueryParams().page===s+1?a.setQueryParams("page",s):this.reloadCurrentView(this.getData("module"))}else if("global-search"===a.routeName){var i=$L("crm-global-search-refine")[0].component;i.methods.deleteRecordsReloadView(i,a,this.getData("module"))}else this.reloadCurrentView(this.getData("module"))}},{mixins:["crm-view-utils","crm-mass-action-mixin"]}),Lyte.Component.register("crm-change-owner",{_template:'<template tag-name="crm-change-owner"> <lyte-modal id="changeOwner" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" on-resize="{{method(&quot;resizeModal&quot;)}}" on-show="{{method(\'onShowPopup\')}}" on-before-show="{{method(\'beforeModalOpens\')}}" on-close="{{method(\'closeOwnerPopup\')}}" lt-prop-show-close-button="false" lt-prop-wrapper-class="ChangeownerModal" lt-prop-allow-multiple="true" lt-prop-width="560px"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="changeowerHead"> <template is="if" value="{{expHandlers(expHandlers(from,\'!=\',\'mass_tool_from\'),\'&amp;&amp;\',expHandlers(from,\'!=\',\'mass_tool_to\'))}}"><template case="true"> {{getI18n(\'crm.profile.tool.changeowner\')}} </template><template case="false"> {{getI18n(\'crm.permission.select.owner\')}} </template></template> </lyte-modal-header> <lyte-modal-content> <div class="changeowner-container"> <div class="changeowner-formwrap"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(from,\'===\',&quot;lead_convert&quot;),\'||\',expHandlers(from,\'===\',&quot;massconvert&quot;)),\'||\',expHandlers(from,\'===\',&quot;workflowconvert&quot;)),\'||\',expHandlers(from,\'===\',&quot;mass_lead_convert&quot;)),\'||\',expHandlers(from,\'===\',&quot;quotes_massconvert&quot;))}}"><template case="true"> <span class="changeowner-formlabel">{{getI18n("crm.label.chooseOwner")}}</span> </template><template case="false"><template is="if" value="{{expHandlers(from,\'===\',&quot;edit&quot;)}}"><template case="true"> <span class="changeowner-formlabel"> {{fieldlabel}}</span> </template><template case="false"> <span class="changeowner-formlabel">{{getI18n("crm.module.owner",pluralLabel)}}</span> </template></template></template></template> <template is="if" value="{{expHandlers(isTeamModule,\'&amp;&amp;\',expHandlers(from,\'!=\',\'mass_tool_from\'))}}"><template case="true"> <crux-user-component cx-prop-forced-fetch="{{isModuleChanged}}" cx-prop-img-zcqa="{{concat(\'img_lookup_changeOwner_\',if(from,from,\'listview\'))}}" cx-prop-custom-request="true" on-custom-request="{{method(\'filterTeamModuleUsers\')}}" cx-prop-tab-index="0" cx-prop-return-full-object-on-get="true" cx-prop-filter-selected="{{filterValue}}" cx-prop-filterable="{{userFilterable}}" cx-prop-title="{{getI18n(\'crm.tpi.ctiapi.label.selectsupportrep\')}}" cx-prop-exclude="{{excludeUserIds}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-placeholder="{{getI18n(\'crm.tpi.ctiapi.label.selectsupportrep\')}}" cx-prop-zcqa="OwnerNameShowLookUp" cx-prop-class="crmBoxUserDropdown" cx-prop-value="{{selectedValue}}" on-value-change="{{method(\'onUserSelected\')}}" cx-prop-from="create" class="changeowner-formvalue" cx-prop-is-subordinate="{{isSubordinateListing}}"></crux-user-component> </template><template case="false"> <crux-user-component id="owner_SMOWNERID" cx-prop-forced-fetch="{{isModuleChanged}}" cx-prop-img-zcqa="{{concat(\'img_lookup_changeOwner_\',if(from,from,\'listview\'))}}" cx-prop-tab-index="0" cx-prop-return-full-object-on-get="true" cx-prop-filter-selected="{{filterValue}}" cx-prop-user-search-criteria="{{profileCriteria}}" cx-prop-query-param="{{profilefilter}}" cx-prop-filterable="{{userFilterable}}" cx-prop-title="{{getI18n(\'crm.tpi.ctiapi.label.selectsupportrep\')}}" cx-prop-exclude="{{excludeUserIds}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-placeholder="{{getI18n(\'crm.tpi.ctiapi.label.selectsupportrep\')}}" cx-prop-zcqa="OwnerNameShowLookUp" cx-prop-class="crmBoxUserDropdown" cx-prop-value="{{selectedValue}}" on-value-change="{{method(\'onUserSelected\')}}" cx-prop-from="create" class="changeowner-formvalue" cx-prop-is-subordinate="{{isSubordinateListing}}"></crux-user-component> </template></template> </div> <template is="if" value="{{userSelected}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(from,\'===\',&quot;caseOwner&quot;),\'||\',expHandlers(from,\'===\',&quot;convert&quot;)),\'||\',expHandlers(from,\'===\',&quot;dealconvert&quot;)),\'||\',expHandlers(from,\'===\',&quot;massconvert&quot;)),\'||\',expHandlers(from,\'===\',&quot;workflowconvert&quot;)),\'!\'),\'&amp;&amp;\',showAssignmentThreshold)}}"><template case="true"> <div class="changeowner-formwrap"> <span class="changeowner-formlabel"></span> <crm-threshold-checkbox-option id="applyRestrictionOption{{approvalRuleIndx}}" class="addRestriction emailLabel" checked="{{applyRestriction}}" module="{{module}}" source="{{from}}" owner-name="{{selectedUser.full_name}}" is-from-change-owner="true"></crm-threshold-checkbox-option> </div> </template></template> <div class="changeowner-formwrap"> <span class="changeowner-formlabel"></span> <div> <template is="if" value="{{expHandlers(isResctrictUsr,\'||\',restrictLeadConvertUser)}}"><template case="true"> <crm-threshold-grant module-name="{{restrictionmodule}}" source="{{restrictionFeature}}" rs-grant-style="{{thresholdStyle}}"></crm-threshold-grant> </template></template> <template is="if" value="{{expHandlers(expHandlers(restrictLeadConvertUser,\'!\'),\'&amp;&amp;\',showEmailNotification)}}"><template case="true"> <lyte-checkbox data-zcqa="emailChangeOwner" class="changeowner-formvalue {{if(expHandlers(expHandlers(source,\'===\',\'macro\'),\'||\',expHandlers(source,\'===\',\'blueprint\')),\'pB10\',\'pT0\')}}" lt-prop-yield="true" lt-prop-checked="{{lbind(notifyChangeOwner)}}" lt-prop-id="changeOwnerCheckBox"> <template is="registerYield" yield-name="yield"> <span class="emailLabel">{{getI18n(\'crm.changeOwner.notification.mail\'," ")}}<span class="dII crm-font-bold vaT">{{selectedUser.full_name}}</span></span> </template> </lyte-checkbox> </template></template> </div> </div> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(from,\'!=\',\'edit\'),\'||\',expHandlers(relatedListArray.length,\'>\',0)),\'&amp;&amp;\',expHandlers(itemsArray.length,\'>\',0)),\'&amp;&amp;\',expHandlers(isLiteUser,\'!\'))}}"><template case="true"> <div class="changeowner-formwrap"> <label class="changeowner-formlabel">{{getI18n(\'crm.change.owner.transfer.related\')}}<span id="transferRelIcon" class="transferRelIcon mL10" onmouseenter="{{action(\'showHoverCard\')}}"><crmutil-icon icon-name="info-rounded" icon-class="zcicn-info-rounded zcicn_grey mT2"></crmutil-icon></span></label> <div class="changeowner-formvalue"> <lyte-dropdown id="relatedlistDropdown" lt-prop-disable-item-tooltip="true" lt-prop-disabled-list="{{disableRelList}}" lt-prop-type="multisearch" data-zcqa="owner_related_list_drop" lt-prop-selected="{{lbind(selectedItemsArray)}}" lt-prop-placeholder="{{lbind(relplaceholder)}}" lt-prop-box-class="changeOwnerDropdown" on-add="{{method(\'onRelatedCheck\',\'add\')}}" on-remove="{{method(\'onRelatedCheck\',\'remove\')}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <template is="for" items="{{itemsArray}}" item="item" index="index"> <template is="if" value="{{expHandlers(expHandlers(from,\'!=\',\'edit\'),\'||\',contains(relatedListArray,item.value))}}"><template case="true"> <lyte-drop-item data-zcqa="{{item.value}}" data-value="{{item.value}}" lt-prop-title="{{item.tooltip}}" lt-prop-tooltip-config="{&quot;position&quot; : &quot;botton&quot;, &quot;appearance&quot; : &quot;box&quot;}">{{item.label}}</lyte-drop-item> </template></template> </template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> </div> </template></template> </template></template> </div> <template is="if" value="{{expHandlers(userSelected,\'&amp;&amp;\',expHandlers(module,\'==\',&quot;Calls&quot;))}}"><template case="true"> <div>{{getI18n(\'crm.changeowner.calls.msg\')}}</div> </template></template> <template is="if" value="{{expHandlers(expHandlers(userSelected,\'&amp;&amp;\',expHandlers(module,\'==\',&quot;Events&quot;)),\'&amp;&amp;\',isMBMsg)}}"><template case="true"> <div class="crmWarningSection">{{getI18n(\'changeOwner.events.online.meeting\')}}</div> </template></template> <lyte-hovercard lt-prop-show="{{lbind(showHoverCard)}}" lt-prop-origin-elem="#transferRelIcon" lt-prop-popover-wrapper-class="changeOwnerNotification" lt-prop-class="changeOwnerTooltip" lt-prop-placement="bottom" class="changeOwnerHovercard" lt-prop-type="box"> <template is="registerYield" yield-name="hoverCardYield"> <lyte-hovercard-content> <div class="changeOwnerhovercardContent">{{unescape(getI18n(\'crm.change.owner.related.owner\',encodeHTML(pluralLabel)))}} {{getI18n(\'crm.label.lowercase.to\')}} <span class="crm-font-bold crm-base-font-size">{{selectedUser.full_name}}</span></div> </lyte-hovercard-content> </template> </lyte-hovercard> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button onclick="{{action(\'onCancel\')}}" data-zcqa="link_OwnerLookup_Cancel"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'onChangeOwner\')}}" lt-prop-disabled="{{negate(showButton)}}" data-zcqa="btn_OwnerLookup_Ok" class="changeOwner_save_btn"> <template is="registerYield" yield-name="text"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(from,\'!=\',\'mass_tool_from\'),\'&amp;&amp;\',expHandlers(from,\'!=\',\'mass_tool_to\')),\'&amp;&amp;\',expHandlers(from,\'!=\',\'edit\'))}}"><template case="true"> {{getI18n(\'crm.button.change.owner\')}} </template><template case="false"> {{getI18n(\'crm.button.done\')}} </template></template> </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1,1]},{type:"if",position:[3,1,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,1,3]},{type:"if",position:[3,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1,3]}]}},default:{}},{type:"attr",position:[3,3,1]},{type:"if",position:[3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,3,3]},{type:"if",position:[3,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"text",position:[1,2,0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,1,2]},{type:"componentDynamic",position:[1,1,2,0]},{type:"attr",position:[1,3,1]},{type:"registerYield",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,7]},{type:"registerYield",position:[3,7,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"text",position:[1,1,2]},{type:"text",position:[1,1,4,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,7]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["module","itemsArray","notifyChangeOwner","pluralLabel","fieldlabel","selectedUser","fullSelectedUserObj","userSelected","selectedRelated","showButton","relatedListArray","excludeUserIds","userFilterable","ownerData","selectedValue","isResctrictUsr","singularLabel","selectedItemsArray","showHoverCard","relatedModPerm","disableRelList","profilefilter","from","profileCriteria","filterValue","fullSelectedUserObj","filterOptions","isSubordinateListing","selectedRecordId","macroIndex","applyRestriction","approvalRuleIndx","restrictLeadConvertUser","showAssignmentThreshold","restrictionmodule","noEmailNotificationModule","showEmailNotification","fieldIdFol","isFolAvailable","ajaxEditOwnerValue","thresholdStyle","isFolOwnerError","folErrorObject","detailViewUniqueId","isBluePrintOwnerChanged","isBluePrintRRChanged","restrictionFeature","isTeamModule","relplaceholder","fieldObject","isLiteUser","isMBMsg","type","isModuleChanged"],data:function(){return{module:Lyte.attr("string"),itemsArray:Lyte.attr("array",{default:[void 0!==moduleRecordMapping.Calls&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Calls.plural_label),value:"Calls",checked:!1,api_name:moduleRecordMapping.Calls.api_name},void 0!==moduleRecordMapping.Tasks&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Tasks.plural_label),value:"Tasks",checked:!1,api_name:moduleRecordMapping.Tasks.api_name},void 0!==moduleRecordMapping.Events&&{label:I18n.getMsg("crm.right.open.module",Events.getModuleName(!1,!0)),value:"Events",checked:!1,api_name:moduleRecordMapping.Events.api_name}]}),notifyChangeOwner:Lyte.attr("boolean",{default:!1}),pluralLabel:Lyte.attr("string"),fieldlabel:Lyte.attr("string"),selectedUser:Lyte.attr("object",{default:{}}),fullSelectedUserObj:Lyte.attr("object",{default:{}}),userSelected:Lyte.attr("boolean",{default:!1}),selectedRelated:Lyte.attr("array",{default:[]}),showButton:Lyte.attr("boolean",{default:!1}),relatedListArray:Lyte.attr("array",{default:[]}),excludeUserIds:Lyte.attr("array",{default:[]}),userFilterable:Lyte.attr("boolean",{default:!1}),ownerData:Lyte.attr("object",{default:{}}),selectedValue:Lyte.attr("object"),isResctrictUsr:Lyte.attr("boolean",{default:!1}),singularLabel:Lyte.attr("string"),selectedItemsArray:Lyte.attr("array",{default:[]}),showHoverCard:Lyte.attr("boolean",{default:!1}),relatedModPerm:Lyte.attr("object",{default:{}}),disableRelList:Lyte.attr("array",{default:[]}),profilefilter:Lyte.attr("object",{default:{}}),from:Lyte.attr("string"),profileCriteria:Lyte.attr("string"),filterValue:Lyte.attr("string"),fullSelectedUserObj:Lyte.attr("object"),filterOptions:Lyte.attr("array",{default:[{id:"AllUsers",category:I18n.getMsg("crm.label.all")},{id:"ActiveUsers",category:I18n.getMsg("crm.label.status")},{id:"DeactiveUsers",category:I18n.getMsg("crm.label.user.status.inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("crm.user.component.unconfirmed")},{id:"DeletedUsers",category:I18n.getMsg("crm.label.deleted")}]}),isSubordinateListing:Lyte.attr("boolean",{default:!1}),selectedRecordId:Lyte.attr("array",{default:[]}),macroIndex:Lyte.attr("string"),applyRestriction:Lyte.attr("boolean",{default:!0}),approvalRuleIndx:Lyte.attr("string",{default:""}),restrictLeadConvertUser:Lyte.attr("boolean",{default:!1}),showAssignmentThreshold:Lyte.attr("boolean",{default:!0}),restrictionmodule:Lyte.attr("string"),noEmailNotificationModule:Lyte.attr("array",{default:["quotes_massconvert","lead_convert","workflowconvert","mass_lead_convert","dealconvert","caseEscalationOwner","caseOwner"]}),showEmailNotification:Lyte.attr("boolean",{default:!0}),fieldIdFol:Lyte.attr("string"),isFolAvailable:Lyte.attr("boolean",{default:!1}),ajaxEditOwnerValue:Lyte.attr("object",{default:{}}),thresholdStyle:Lyte.attr("string",{default:"margin-bottom: 10px !important;"}),isFolOwnerError:Lyte.attr("boolean",{default:!1}),folErrorObject:Lyte.attr("object"),detailViewUniqueId:Lyte.attr("string",{default:""}),isBluePrintOwnerChanged:Lyte.attr("boolean",{default:!0}),isBluePrintRRChanged:Lyte.attr("boolean",{default:!1}),restrictionFeature:Lyte.attr("string",{default:""}),isTeamModule:Lyte.attr("boolean",{default:!1}),relplaceholder:Lyte.attr("string",{default:I18n.getMsg("crm.change.owner.select.items")}),fieldObject:Lyte.attr("object"),isLiteUser:Lyte.attr("boolean",{default:!1}),isMBMsg:Lyte.attr("boolean",{default:Crm.userDetails.MEETING_BRIDGE_ENABLED}),type:Lyte.attr("string"),isModuleChanged:Lyte.attr("boolean",{default:!0})}},init:function(){this.$node.show=function(e,t,a){customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Mass Owner Clicked",{Module:this.getData("module")}),this.setData("restrictionmodule",this.getData("module")),e&&e.selectedIds&&this.setData("selectedIds",e.selectedIds),e&&e.selected_user?(this.setData("selectedUser",{full_name:e.selected_user.name,id:e.selected_user.id}),"macro"===e.from?this.setData("fullSelectedUserObj",{id:e.selected_user.id,name:e.selected_user.name,profile:e.selected_user.profile}):this.setData("fullSelectedUserObj",{id:e.selected_user.id,name:e.selected_user.name}),this.setData("selectedValue",e.selected_user),this.setData("userSelected",!0),this.setData("showButton",!0),this.setData("isBluePrintOwnerChanged",!1),"true"===e.selected_user.notify&&this.setData("notifyChangeOwner",!0)):(this.setData("selectedValue",void 0),this.setData("selectedUser",{}),this.setData("userSelected",!1));var o,s=!1;if(this.component.successFn=t,this.component.failurFn=a,this.setData("from",e&&e.from),"macro"===this.getData("from"))var i=objectUtils.getMatchedKey(moduleApiMapping,this.getData("module")),r=moduleRecordMapping[i];else r="lead_convert"===this.getData("from")?moduleRecordMapping.Contacts:moduleRecordMapping[this.getData("module")];if(this.setData("isTeamModule","team_based"===r.access_type),e&&e.relatedListArray&&this.setData("relatedListArray",e.relatedListArray),"mass_tool_from"!==this.getData("from")){var l=this;store.triggerAction("profile","get_assigned",{from:"changeowner"},"","POST",{get_assigned:{feature:"module",related_entity_id:r.id,page:"1",per_page:"200"}}).then((function(t){if(t&&t.profiles&&t.profiles.length>0){var a=t.profiles.map((e=>e.id)),o=[{comparator:"in",field:"profile.id",value:a}],s="(profile:in:"+a+")";if(e.userCriteria){var i=JSON.parse(e.userCriteria);o.push("and"),o=o.concat(i)}e.userSearchcriteria&&(s=s+"and("+e.userSearchcriteria+")"),l.setData("profilefilter",{filters:o}),l.setData("profileCriteria",s),l.setData("filterValue","ActiveUsers");var r=$L("crm-change-owner").length>0;r&&!$L("#changeOwner")[0].component.getData("ltPropShow")?l.querySelector("lyte-modal").ltProp("show",!0):r||l.querySelector("lyte-modal").ltProp("show",!0)}}))}else this.setData("profilefilter",{}),this.setData("profileCriteria",void 0),this.setData("filterValue","AllUsers");if("mass_tool_from"===this.getData("from")&&this.getData("isTeamModule")&&this.setData("profilefilter",{type__s:"Regular User,Lite User"}),"macro"===this.getData("from")){var n=e.macro_index.replace("Macro_FieldValue_Users_","");this.setData("macroIndex",n)}if("dealconvert"===this.getData("from")&&"Deals"!==this.getData("module")&&void 0!==moduleRecordMapping.Deals&&this.setData("module",moduleRecordMapping.Deals.api_name),"detail_view"===this.getData("from")?this.setData("pluralLabel",r.singular_label):this.setData("pluralLabel",r.plural_label),"edit"===this.getData("from")&&this.setData("fieldlabel",store.peekAll("field").find((e=>"Owner"===e.api_name&&e.module[0].api_name===moduleRecordMapping[this.getData("module")].api_name)).field_label),this.setData("singularLabel",r.singular_label),this.setData("isResctrictUsr",!1),this.setData("userFilterable","mass_tool_from"===this.getData("from")),this.setData("excludeUserIds",[]),"mass_tool_from"===this.getData("from")&&this.querySelector("lyte-modal").ltProp("show",!0),this.component.data.ownerData.owner_config_state&&(o=this.component.data.ownerData.owner_config_state[0],"macro"===this.getData("from"))){var d=this.getData("selectedItemsArray");if(d){if(d.length>0)for(var c in o)d.includes(c)||(o[c]=!1);if(0===d.length&&e.selected_user)for(var c in o)o[c]=!1}}this.setData("itemsArray",[void 0!==moduleRecordMapping.Calls&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Calls.plural_label),value:"Calls",checked:!!o&&o.Calls,api_name:moduleRecordMapping.Calls.api_name},void 0!==moduleRecordMapping.Tasks&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Tasks.plural_label),value:"Tasks",checked:!!o&&o.Tasks,api_name:moduleRecordMapping.Tasks.api_name},void 0!==moduleRecordMapping.Events&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Events.plural_label),value:"Events",checked:!!o&&o.Events,api_name:moduleRecordMapping.Events.api_name}]),"Accounts"===this.component.data.module&&Lyte.arrayUtils(void 0!==moduleRecordMapping.Potentials&&this.component.data.itemsArray,"push",[{label:moduleRecordMapping.Contacts.plural_label,value:"Contacts",checked:!!o&&o.Contacts,api_name:moduleRecordMapping.Contacts.api_name},void 0!==moduleRecordMapping.Potentials&&{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Potentials.plural_label),value:"Potentials",checked:!!o&&o.Deals,api_name:moduleRecordMapping.Potentials.api_name}]),"Contacts"===this.component.data.module&&void 0!==moduleRecordMapping.Potentials&&Lyte.arrayUtils(this.component.data.itemsArray,"push",{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Potentials.plural_label),value:"Potentials",checked:!!o&&o.Deals,api_name:moduleRecordMapping.Potentials.api_name}),(-1!==["Activities","Calls","Events","Tasks","PriceBooks"].indexOf(this.component.data.module)||void 0!==this.component.data.from&&(this.component.data.from.startsWith("approve_")||"caseEscalationOwner"===this.getData("from")||"dealconvert"===this.getData("from")))&&this.setData("itemsArray",[]);let p=this.component.data.itemsArray.filter(Boolean);if(this.setData("itemsArray",p),e&&e.selected_user&&e.selected_user.related_records){this.setData("selectedItemsArray",e.selected_user.related_records);var m=this.component.data.itemsArray.filter((t=>e.selected_user.related_records.includes(t.api_name)||"Deals"===t.api_name&&e.selected_user.related_records.includes("Potentials")));this.setData("selectedRelated",m);var u=$L("#relatedlistDropdown")[0];void 0!==u&&0===e.selected_user.related_records.length?u.setData("ltPropPlaceholder",I18n.getMsg("crm.change.owner.select.items")):void 0!==u&&e.selected_user.related_records.length>0&&u.setData("ltPropPlaceholder",""),s=!0}e&&e.selected_user&&void 0!==e.selected_user.notify&&this.setData("notifyChangeOwner",e.selected_user.notify),s||(this.component.data.itemsArray.forEach(function(e){e.checked&&(Lyte.arrayUtils(this.getData("selectedRelated"),"push",e),Lyte.arrayUtils(this.getData("selectedItemsArray"),"push",e.value))}.bind(this)),"macro"!==e.from&&this.setData("notifyChangeOwner",!!o&&o.notify)),e&&e.isAssignmentRestricted&&this.setData("applyRestriction",e.isAssignmentRestricted),"mass_tool_from"===this.component.data.from||"edit"===this.component.data.from||customViewObject.doMassActioninScheduler||this.component.getPermissionRemovedMod(),e&&e.ids&&(this.setData("selectedRecordId","[]"),Lyte.arrayUtils(this.getData("selectedRecordId"),"push",e.ids)),"detail_view"!==this.getData("from")&&"lead_convert"!==this.getData("from")&&"quickAction"!==this.getData("from")&&"canvas_detail_view"!==this.getData("from")||(this.setData("itemsArray",[]),this.setData("selectedRelated",[]),this.setData("selectedItemsArray",[]),this.component.getRelatedListDetailView(o,e.old_owner_id)),void 0!==this.component.data.from&&(this.getData("noEmailNotificationModule").includes(this.getData("from"))||this.getData("from").startsWith("approve_")||e&&e.isDraft)&&this.setData("showEmailNotification",!1),"canvas_detail_view"!==this.component.data.from&&"detail_view"!==this.component.data.from||(this.setData("fieldIdFol",e.old_owner_id),this.component.checkFolAvailable(),customViewObject.selectedIds=[e.ids]),this.component.addRemovePlaceholder(),"detail_view"===this.getData("from")&&Crm.userDetails.DETAIL_VIEW_LYTE&&(this.setData("detailViewUniqueId",e.unique_id),this.setData("isMBMsg",!1)),e&&e.type&&this.setData("type",e.type)}},methods:{filterTeamModuleUsers:function(){var e=arguments;return new Promise(function(t,a){var o={feature:"tab_users",related_entity_id:moduleRecordMapping[this.getData("module")].id,page:e[1].page,per_page:e[1].per_page,type:"ActiveUsers",include_lite_users:!0};"search"===e[1]&&(o.search={criteria:e[2].criteria},o.page=e[2].page,o.per_page=e[2].per_page),store.triggerAction("user_associations","get_assigned",o).then(function(e){e.users=e.get_assigned,delete e.get_assigned,t(e)}.bind(this),(function(){a()}))}.bind(this))},onUserSelected:function(e){this.setData("selectedUser",{id:e.id,full_name:e.full_name,image:e.image_link}),this.setData("fullSelectedUserObj",e),customViewObject.doMassActioninScheduler||"mass_tool_from"===this.getData("from")||(this.restrictionCheck(e),this.setData("userSelected",!0)),customViewObject.doMassActioninScheduler||"mass_tool_from"===this.data.from||"edit"===this.data.from?this.setData("showButton",!0):this.fetchRelatedModProfiles(e),this.addRemovePlaceholder();var t=this.getData("from");"canvas_detail_view"!==t&&"detail_view"!==t||!this.getData("isFolAvailable")||this.showFOlPopup(e,void 0,t),"blueprint"!==this.getData("from")&&"workflowconvert"!==this.getData("from")&&"macro"!==this.getData("from")||this.setData("isBluePrintOwnerChanged")||this.setData("isBluePrintOwnerChanged",!0),"Team User"===e.profile.name?(this.setData("isLiteUser",!0),this.setData("selectedRelated",[]),this.setData("selectedItemsArray",[])):this.setData("isLiteUser",!1)},resizeModal:function(){for(var e=document.querySelectorAll("lyte-dropdown"),t=e.length,a=0;a<t;a++)e[a].ltProp("isOpen")&&e[a].resetPosition()},onShowPopup:function(){if(this.bindKeyEvent=function(e){var t=$L("#relatedlistDropdown")[0],a=$L("crm-detailview-canvas")[0],o=$L(".changeowner-formvalue crux-user-lookup")[0],s=void 0!==a&&a.component.data.showAjaxPop,i=void 0!==t&&t.component.data.ltPropIsOpen,r=void 0!==o&&o.component.data.cxPropShow;13===e.keyCode&&(!this.data.showButton||i||s||r||$L(".changeOwner_save_btn")[0].click())}.bind(this),"detail_view"===this.getData("from")&&Crm.userDetails.DETAIL_VIEW_LYTE){var e=$L("crm-detail-view")[0].component.data.record.Owner;$L(".changeowner-container crux-user-lookup")[0].setData("cxPropSelectedId",e.id)}window.addEventListener("keydown",this.bindKeyEvent,!0)},onRelatedCheck:function(e,t,a,o,s){var i=this.getData("itemsArray"),r=i.map((function(e){return e.value})).indexOf(a);if("add"===e)i[r].checked=!0,Lyte.arrayUtils(this.getData("selectedRelated"),"push",i[r]);else{var l=this.getData("selectedRelated");i[r].checked=!1;var n=l.map((function(e){return e.value})).indexOf(a);Lyte.arrayUtils(this.getData("selectedRelated"),"removeAt",n),s.$node.ltProp("isOpen")||s.$node.toggle()}this.getData("selectedRelated").length>0?$L("#relatedlistDropdown")[0].setData("ltPropPlaceholder",""):0===this.getData("selectedRelated").length&&$L("#relatedlistDropdown")[0].setData("ltPropPlaceholder",I18n.getMsg("crm.change.owner.select.items")),"blueprint"!==this.getData("from")&&"workflowconvert"!==this.getData("from")||this.setData("isBluePrintRRChanged",!0)},closeOwnerPopup:function(){var e=this.$node.querySelector("lyte-modal");this.setData("userSelected",!1);var t=e.component.childComp.querySelector("crux-user-dropdown");t.cxProp("selectedUser",{}),t.cxProp("selected",void 0);var a=e.component.childComp.querySelector("crux-user-component");a.cxProp("value",void 0),a.setData("selectedUser",{}),this.setData({selectedValue:void 0,showButton:!1,selectedRelated:[],disableRelList:[]});var o=this.data.itemsArray.length;this.setData("notifyChangeOwner",!1),this.setData("applyRestriction",!0);for(var s=0;s<o;s++)Lyte.objectUtils(this.data.itemsArray[s],"add","checked",!1);!e||"mass_tool_from"!==this.data.from&&"mass_tool_to"!==this.data.from||$L("crm-change-owner")[0].remove(),window.removeEventListener("keydown",this.bindKeyEvent,!0)},beforeModalOpens:function(){if(this.getData("isTeamModule")){var e=networkUtils.returnDependencyFiles(["crm-userassociations-datastore.js"],ResourceConstants.CRMClient);Lyte.injectResources(e,void 0)}}},actions:{onChangeOwner:function(){if(Object.keys(this.data.selectedUser).length){var e=this;if("macro"===this.getData("from"))var t=objectUtils.getMatchedKey(moduleApiMapping,e.getData("module")),a=store.peekRecord("module",moduleRecordMapping[t].id);else a=store.peekRecord("module",moduleRecordMapping[e.getData("module")].id);var o=(w=e.getData("fullSelectedUserObj")).id,s=w.name,i=w.profile;if("lead_convert"!==this.getData("from"))if("macro"!==this.getData("from"))if("mass_lead_convert"!==this.getData("from")){if(void 0!==this.getData("from")&&this.getData("from").startsWith("approve_"))return this.handleChangeOwnerFromApprovalWeb(e.getData("fullSelectedUserObj").id),void e.closeModal();if("blueprint"!==this.getData("from"))if("workflowconvert"!==this.getData("from"))if("caseOwner"!==this.getData("from")){if("caseEscalationOwner"===this.getData("from"))return $("#escUserName").val(s),$("#escUserId").val(o),void e.closeModal();if("quotes_massconvert"!==this.getData("from"))if(customViewObject.doMassActioninScheduler||"mass_tool_from"===this.getData("from")){var r={owner:{id:this.getData("selectedUser").id},cvid:customViewObject.cvId};if(moduleRecordMapping[this.getData("module")].territory){r.territory={include_child:!!moduleRecordMapping[this.getData("module")].territory.subordinates&&moduleRecordMapping.Deals.territory.subordinates};var l=moduleRecordMapping[this.getData("module")].territory.id;"0"!==l&&(r.territory.id=l)}if("mass_tool_from"===this.getData("from"))r.owner=this.getData("selectedUser"),e.successFn&&e.successFn(r,e.getData("from")),this.closeModal();else{customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Confirmed",{Module:e.getData("module")});var n=crmListView.getObject().totalCount?crmListView.getObject().totalCount:moduleRecordMapping[this.getData("module")].id;customViewObject.doMassActioninScheduler&&n>Crm.massOperationWorkflowLimit&&"org_based"===moduleRecordMapping[this.getData("module")].access_type?(this.closeModal(),commonUtils.showHideLoadingDiv(!0),a.$.triggerAction("get_automated_configured_features",{type:"GET"},{record_action:"update"}).then((function(t){e.getOwnerfig=!1,commonUtils.showHideLoadingDiv();var a="";t&&t.automated_configured_features.forEach((function(e){a=e.execute&&"workflow"===e.feature.api_name?I18n.getMsg("crm.mass.actions.workflow.rules"):a,a=e.execute&&"approval_processes"===e.feature.api_name?""===a?I18n.getMsg("crm.mass.actions.approval.process"):a+" & "+I18n.getMsg("crm.mass.actions.approval.process"):a})),""!==a?_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"massToolAlert",ltPropContentAlign:"center",ltPropButtonPosition:"center",ltPropPrimaryMessage:I18n.getMsg("crm.mass.actions.rules.alert.content",a),ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",cxPropZcqa:"link_WfDelete_Cancel"},{type:"accept",text:I18n.getMsg("crm.mass.actions.ok.proceed"),appearance:"primary",cxPropZcqa:"btn_MassUpdate_Save"}]},accept:function(){Crm.trackSpotLightAction("Mass Scheduler - Change Owner WorkFlow OK Proceed",{Module:e.getData("module")}),e.changeOwner(r)},reject:function(){Crm.trackSpotLightAction("Mass Scheduler - Change Owner WorkFlow Cancel",{Module:e.getData("module")})}}):e.changeOwner(r)}),(function(t){403===t.status||401===t.status?renderingUtils.displayPermissionDenied():(_cruxUtils.showCustomMessage({id:"massChangeOwner",params:{ltPropType:"failure",ltPropMessage:I18n.getMsg("crm.delete.error"),ltPropDuration:"3000"}}),e.closeModal())}))):this.changeOwner(r)}}else{var d;if(0===this.getData("selectedRelated").length)d={notify:this.getData("notifyChangeOwner")};else{var c=this.checkRelatedListPermission();if(!c[0])return!1;this.relatedV=c[1],d={notify:this.getData("notifyChangeOwner"),related_modules:c[1]}}if("mass_tool_to"===this.getData("from")||"edit"===this.getData("from")){if(d.owner=this.getData("selectedUser"),e.successFn){e.successFn(d,e.getData("from"));var p=$("#assignmentRestriction");null!==p&&p.length>0&&(e&&!0===e.getData("isResctrictUsr")?p.removeClass("dN"):p.addClass("dN"))}this.closeModal()}else{customViewObject&&customViewObject.selectedIds&&(d.ids=Lyte.deepCopyObject(customViewObject.fromQuickActionsMenu?customViewObject.selectedIdForQuickAction:customViewObject.selectedIds)),d.owner={id:this.getData("selectedUser").id},commonUtils.showHideLoadingDiv(!0);var m={};m={};"detail_view"===this.getData("from")||"quickAction"===this.getData("from")||"canvas_detail_view"===this.getData("from")?(m.bulkChange=!0,m.from="for_single_record",m.record_id=this.getData("selectedRecordId")[0],m.action_type="change_owner",validationUtils.isEmpty(e.getData("ajaxEditOwnerValue"))||(m.record_update_data=e.getData("ajaxEditOwnerValue").folOwnerAjaxVal)):m.bulkChange=!0;const t=Lyte.Router.getRouteInstance().transition.info.route;if(["crm.tab.module.entity.canvas","crm.tab.module.entity.detail"].includes(t)){var u=$(".changeOwner_save_btn .lyte-button");if(u.length&&u.attr("disabled",!0),window.CScriptLib){if("crm.tab.module.entity.canvas"===t)CanvasDetailPageHandler.intercept_owner_field(o).then((function(){e.handleChangeOwnerAction(a,m,d,e)}),(function(){}));else{const t=$L(".ChangeownerModal crux-user-component")[0],{id:o,name:s,email:i}=t&&t.getData("cxPropUserRecord");o?CScript.Engine.Global.dispatchIEvent("onBeforeUpdate",store.peekAll("field").find((e=>"Owner"===e.api_name&&e.module[0].api_name===moduleRecordMapping[this.getData("module")].api_name)).id,{id:o,name:s,email:i}).then((function(t){!0===t&&e.handleChangeOwnerAction(a,m,d,e)})):e.handleChangeOwnerAction(a,m,d,e)}e.closeModal(),commonUtils.showHideLoadingDiv()}else e.handleChangeOwnerAction(a,m,d,e)}else e.handleChangeOwnerAction(a,m,d,e)}}else{if(e.checkRelatedListPermission()[0]){for(h="",f=(D=e.getData("selectedRelated")).length,y=0;y<f;y+=1)h+=D[y].value+",";h=h.replace(/.$/,""),$("#convertownerName").text(s),$("#convertOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#relatedRecords").val(h),$("#convertownerId").val(o),changeOwner.handleMassActionOk(),e.closeModal()}}}else{if(e.checkRelatedListPermission()[0]){for(h="",f=(D=e.getData("selectedRelated")).length,y=0;y<f;y+=1)h+=D[y].value+",";h=h.replace(/.$/,""),$("#ownerName").val(s),$("#ownerId").val(o),$("#cases_relatedRecords").val(h),e.closeModal()}}else{let t=[];if((_=this.getData("isBluePrintOwnerChanged"))&&(t=e.checkRelatedListPermission()),_&&t[0]||e.getData("isBluePrintRRChanged")){for(var g=e.getData("selectedRelated"),h="",f=g.length,y=0;y<f;y+=1)h+=g[y].value+",";if(h=h.replace(/.$/,""),Crm.userDetails.isNewConvertUIEnabled){var v=$L("crm-convert-action").e[0];v.setData("ownerId",o),v.setData("ownerName",s),v.component.relatedRecords=h}else $("#convertownerName").text(s),$("#defaultOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#convertownerId").val(o),$("#relatedRecords").val(h);e.closeModal()}else _||e.closeModal()}else{var _;let t=[];if((_=this.getData("isBluePrintOwnerChanged"))&&(t=e.checkRelatedListPermission()),_&&t[0]||this.getData("isBluePrintRRChanged")){for(var D=e.getData("selectedRelated"),w=e.getData("selectedUser"),h="",f=D.length,y=0;y<f;y+=1)void 0!==D[y].value?h+=D[y].value+",":h+=D[y]+",";h=h.replace(/.$/,"");var b=$L("#relatedRecordsText"),M=$L("#arCheckbox").e;$("#fieldValue1").val(w.full_name),$("#ownerId").val(w.id),$("#relatedRecords").val(h),$("#notify").val(e.getData("notifyChangeOwner")),$("#isAssignmentRestricted").val(void 0!==M&&M.checked),b.text(""),""!==h&&(b.text(I18n.getMsg("crm.change.owner.relatedRecordsText",e.getRelatedRecordsText(h,w.full_name))),b.show()),e.closeModal()}else _||e.closeModal()}}else{if(e.checkRelatedListPermission()[0]){for(var h="",f=(D=e.getData("selectedRelated")).length,y=0;y<f;y+=1)h+=D[y].api_name+",";h=h.replace(/.$/,"");var C=$L("crm-mass-convert")[0].component;C.setData("salesmanid",o),C.setData("relatedRecords",h),C.setData("ownerName",s),C.executeMethod("executeOwnerUpdateAction"),e.closeModal()}}else a.$.triggerAction("owner_config_state",{type:"GET"},{feature_name:"change_owner"}).then((function(){var t=e.getData("isBluePrintOwnerChanged");let a=[];a=e.checkRelatedListPermission();for(var r=e.getData("selectedRelated"),l="",n=r.length,d=0;d<n;d+=1)l+=r[d].value+",";if(l=l.replace(/.$/,""),t&&a[0]){var c=e.getData("macroIndex"),p=e.getData("notifyChangeOwner").toString(),m=$L(".changeowner_ownerField_"+c),u=void 0!==m[0]?m:$L("#Macro_userLookup");u.length>1&&Lyte.arrayUtils(u,"splice",1,u.length-1),$L(".textinmacro.noneclass").hide(),u.show(),u.find("#macro_ownerNameSpan").hide();var g=u.find("#macro_ownerName");g.text(""),g.text(s).show(),g.attr("data-params",'{"USERID":"'+o+'"}'),u.find("#macro_relatedRec").val(l),u.find("#macro_notifyOwner").val(p);var h=$L("#arCheckbox").e;u.find("#macro_applyRestriction").val(void 0!==h&&h.checked);var f=(void 0!==h&&h.checked).toString(),y=u.find("#relatedRecordsTxt");y.text("");var v="";""!==l&&(y.text(I18n.getMsg("crm.change.owner.relatedRecordsText",e.getRelatedRecordsText(l,s))),v=I18n.getMsg("crm.change.owner.relatedRecordsText",e.getRelatedRecordsText(l,s)));var _=y.outerHeight();$L(".relatedRecordsTxt").closest(".Macro_droplistupdate").css({"margin-bottom":_}),Lyte.triggerEvent("macroLyte_changeOwner",{userId:o,userName:s,relatedRecords:r,notify:p,displayMessage:v,applyRestriction:f,profile:i}),e.closeModal()}else if(a[0]){f=(void 0!==(h=$L("#arCheckbox").e)&&h.checked).toString(),p=e.getData("notifyChangeOwner").toString(),v="";""!==l&&(v=I18n.getMsg("crm.change.owner.relatedRecordsText",e.getRelatedRecordsText(l,e.getData("selectedUser").full_name))),Lyte.triggerEvent("macroLyte_changeOwner",{userId:o,userName:e.getData("selectedUser").full_name,relatedRecords:r,notify:p,displayMessage:v,applyRestriction:f,profile:i}),e.closeModal()}}),(function(t){403===t.status&&renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1),e.closeModal()}));else a.$.triggerAction("owner_config_state",{type:"GET"},{feature_name:"change_owner"}).then((function(){if(e.checkRelatedListPermission()[0]){$L("#assignedto")[0].ltProp("value",e.getData("fullSelectedUserObj").full_name);for(var t=$L("crm-convert-lead")[0].component,a=e.getData("selectedRelated"),s="",i=a.length,r=0;r<i;r+=1)s+=a[r].api_name+",";return s=s.replace(/.$/,""),t.setData("relatedRecords",s),t.setData("SalesManId",o),t.addRestrictionMsgOnConvertPage(o,null,"checkAll"),t.executeMethod("enableNotifyChkbx"),void e.closeModal()}}),(function(t){403===t.status&&renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1),e.closeModal()}))}},onCancel:function(){customViewObject.doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Cancel",{Module:this.getData("module")}),this.closeModal()},showHoverCard:function(){this.setData("showHoverCard",!0)}},restrictionCheck:function(e){var t=this.getData("module"),a=this;if("macro"===this.getData("from"))var o=objectUtils.getMatchedKey(moduleApiMapping,t),s=moduleRecordMapping[o].id;else s=moduleRecordMapping[t].id;if(Crm.isRestrictionEnabled&&this.isValidRestrictionModule(t)){if("lead_convert"!==this.getData("from")&&"mass_lead_convert"!==this.getData("from")&&"workflowconvert"!==this.getData("from")){var i={actionName:"permit_threshold",owner_id:e.id};store.triggerAction(s,"permit_threshold",i).then((function(e){e&&e.permit_threshold&&e.permit_threshold.allow?a.setData("isResctrictUsr",!1):a.setData("isResctrictUsr",!0)}),(function(){a.setData("isResctrictUsr",!1)}))}"lead_convert"===this.getData("from")?this.addRestrictionMessage(null,e.id,null,"convert"):"mass_lead_convert"===this.getData("from")&&this.addRestrictionMessage(null,e.id,null,"massconvert")}},handleChangeOwnerSuccess:function(){var e=this.response,t=this;if(commonUtils.showHideLoadingDiv(),"CANNOT_PERFORM_ACTION"===e.data[0].code&&"no permission to change owner on this record"===e.data[0].message)renderingUtils.displayPermissionDenied();else{var a,o=0,s=0;if(e.data.forEach((function(e){"Sorry, you cannot perform this operation as the record is locked."===e.message||"record under merge is locked"===e.message?s++:o++})),s>0&&(0===o?_cruxUtils.showCustomMessage({id:"massChangeOwnerLock",params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.transfer.record.lock.failure"),ltPropDuration:"3000"}}):_cruxUtils.showCustomAlert({id:"massChangeOwnerLockMixed",params:{ltPropWrapperClass:"massToolAlert",ltPropContentAlign:"center",ltPropCloseOnEscape:!1,ltPropButtonPosition:"center",ltPropSecondaryMessage:I18n.getMsg("crm.masstransfer.lock.failure",[o,s]),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"primary",cxPropZcqa:"massChangeOwnerLockMixed"}],ltPropButtonPosition:"center"},accept:function(){t.clearSelection(),t.reloadCurrentView(t.getData("module"))}})),this.relatedV&&this.relatedV.length&&o>0){var i={};i.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),i.id="progress",i.status="progress",crmSchedulerNotification.addOrUpdateStatus(i,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title")),a=I18n.getMsg("crm.changeOwner.prgress")}else a=I18n.getMsg("crm.massupdate.updatedsuccesfully");overLayForSelectAllClick(!1),s||(_cruxUtils.showCustomMessage({id:"massChangeOwner",params:{ltPropType:"success",ltPropMessage:a,ltPropDuration:"3000"}}),this.reloadCurrentView(this.getData("module"))),"detail_view"===t.getData("from")&&Crm.userDetails.DETAIL_VIEW_LYTE?store.findRecord(moduleRecordMapping[t.getData("module")].id,t.getData("selectedRecordId")[0]).then((function(e){if(t.closeModal(),t.getOwnerfig=!1,t.relatedV=[],e&&e[0]){Lyte.triggerEvent("detail_view_listener_"+t.getData("detailViewUniqueId"),{componentsToBeReloaded:["all_components"]});var a=$L("crm-detail-view")[0],o=a.component.data.blueprint_exec_info;o&&o.blueprint&&a.refreshProcessLayer(e[0])}else{var s=$L("#show");Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-permission-error.js"],ResourceConstants.CRMClient),void 0,(function(){s.empty(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName,isEntityPresence:-1},"#show")}))}})):(t.closeModal(),t.getOwnerfig=!1,t.relatedV=[])}},changeOwner:function(e){var t=this,a=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id);commonUtils.showHideLoadingDiv(!0),a.$.triggerAction("mass_change_owner",e).then((function(){commonUtils.showHideLoadingDiv(),_cruxUtils.showCustomMessage({id:"massChangeOwner",params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.mass.actions.mass.transfer.job")+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"),ltPropDuration:"3000"}}),t.successFn&&t.successFn(),t.closeModal(),overLayForSelectAllClick(!1),t.reloadCurrentView(t.getData("module"))}),(function(e){commonUtils.showHideLoadingDiv(),t.failurFn?t.failurFn(e):403===e.status||401===e.status?renderingUtils.displayPermissionDenied():(t.reloadCurrentView(t.getData("module")),overLayForSelectAllClick(!1),t.closeModal())}))},closeModal:function(){var e=this.$node.querySelector("lyte-modal");customViewObject.fromQuickActionsMenu&&(customViewObject.selectedIdForQuickAction=[],customViewObject.fromQuickActionsMenu=!1);var t=e.component.childComp.querySelector("crux-user-dropdown");void 0!==t&&(t.component.setData("cxPropValue",{}),this.setData("selectedRelated",[]),this.setData("selectedItemsArray",[]),this.setData("relatedModPerm",{}),e.ltProp("show",!1))},getPermissionRemovedMod:function(){var e=store.peekRecord("user",Crm.userDetails.USER_ID).profile.id;"macro"===this.getData("from")&&Object.keys(this.getData("selectedUser")).length>0&&(e=this.getData("fullSelectedUserObj").profile.id);var t=this.getData("relatedModPerm"),a=this.getData("itemsArray").map((e=>"Crm_Implied_View_"+e.api_name)),o=this.getData("itemsArray"),s=a.length;t[e]={};for(var i=0;i<s;i++){var r="Crm_Implied_View_Deals"===a[i]?Crm.userDetails.permissions.Crm_Implied_View_Potentials&&moduleRecordMapping.Potentials.visible:Crm.userDetails.permissions[a[i]]&&moduleRecordMapping[this.data.itemsArray[i].api_name].visible;if(t[e][o[i].api_name]=void 0!==r&&r,r){var l,n=this.getData("type"),d="Crm_Implied_View_Deals"===a[i];l="change_owner"===n?d?"Crm_Implied_Change_Owner_Potentials":"Crm_Implied_Change_Owner_"+this.data.itemsArray[i].api_name:d?"Crm_Implied_Mass_Transfer_Potentials":"Crm_Implied_Mass_Transfer_"+this.data.itemsArray[i].api_name,r=Crm.userDetails.permissions[l]}if(!r){this.data.itemsArray[i].tooltip=I18n.getMsg("crm.changeOwner.noPermission."+this.data.itemsArray[i].api_name.toLowerCase());var c="Deals"===this.data.itemsArray[i].api_name?"Potentials":this.data.itemsArray[i].api_name;Lyte.arrayUtils(this.data.disableRelList,"push",c);var p=this.data.selectedItemsArray.indexOf(c);if(-1!==p){Lyte.arrayUtils(this.data.selectedItemsArray,"removeAt",p,1);let e=this.data.selectedRelated.findIndex((e=>e.value===c));Lyte.arrayUtils(this.data.selectedRelated,"removeAt",e,1)}}}this.addRemovePlaceholder(),this.setData("relatedModPerm",t)},checkRelatedListPermission:function(){for(var e=[],t=this.getData("selectedRelated").length,a=this.data.fullSelectedUserObj.profile.id,o=[],s=this.getData("relatedModPerm"),i=0;i<t;i++)"edit"===this.data.from||s&&s[a][this.getData("selectedRelated")[i].api_name]?e.push({api_name:this.getData("selectedRelated")[i].api_name}):o.push(moduleRecordMapping[this.data.selectedRelated[i].value].plural_label);if(o.length){if(o.length>1)var r=o.pop(),l=o.join(",").concat(" "+I18n.getMsg("crm.label.lowercase.and")+" "+r);else l=o[0];return _cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"massToolAlert",ltPropContentAlign:"center",ltPropButtonPosition:"center",ltPropPrimaryMessage:I18n.getMsg("crm.change.owner.permission.alert",[this.data.selectedUser.full_name,l]),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"primary"}],ltPropButtonPosition:"center"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg")}}),[!1]}return[!0,e]},checkFolAvailable:function(){var e=this;store.findAll("field",{module:moduleRecordMapping[this.data.module].api_name,include_inner_details:"lookup.query_details.criteria"}).then((function(t){for(var a=t.filter((function(e){return e.association_details})),o=t.filter((function(e){return 8===e.ui_type})),s=a.length,i=0;i<s;i++){a[i].association_details.lookup_field.id===o[0].id&&e.setData({fieldIdFol:o[0].id,isFolAvailable:!0,fieldObject:o[0]})}}))},showFOlPopup:function(e,t,a){var o=$L(".zcanvas_zcdefaultcontd"),s=$L("#createEntityForm"),i="Crm_Implied_Edit_"+this.data.module;if(Crm.userDetails.permissions[i])if(o.is(":visible")&&!s.is(":visible")){var r=$L("crm-detailview-canvas")[0].component,l=this;t?r.executeMethod("setFolValueUserLookup",e,l.data,e):store.findAll("dummy",null,!1,!1,{url:"crm/v2/users/"+e.id}).then((function(t){r.executeMethod("setFolValueUserLookup",t.users[0],l.data,e)}))}else if("detail_view"===a){var n=$L("#header_SMOWNERID"),d=(n.length>0?n:$L("#value_SMOWNERID")).closest("crm-detailview-fields")[0].component,c=$L("#owner_SMOWNERID");(c=c[0].component).setData("cxPropField",this.getData("fieldObject")),d.performUserSelect(e,this.getData("fieldObject"),a,this.getData("detailViewUniqueId"))}else this.folUserRefFields(e)},getRelatedRecordsText:function(e,t){var a=[];return e=(e=(e=(e=(e=(e=e.replace("Tasks",I18n.getMsg("crm.right.open.module",moduleRecordMapping.Tasks.plural_label))).replace("Calls",I18n.getMsg("crm.right.open.module",moduleRecordMapping.Calls.plural_label))).replace("Events",I18n.getMsg("crm.right.open.module",Events.getModuleName(!1,!0)))).replace("Contacts",I18n.getMsg("crm.right.open.module",moduleRecordMapping.Contacts.plural_label))).replace("Potentials",I18n.getMsg("crm.right.open.module",moduleRecordMapping.Deals.plural_label))).replace(/,/g,", "),a[0]=e,a[1]=t,a},getRelatedListDetailView:function(e,t){var a,o=this;void 0===a?store.findAll("related_list",{module:moduleRecordMapping[this.getData("module")].api_name},!1,!1,{apiVersion:"3"}).then((function(s){a=s,o.getRelList(a,e,t)})):o.getRelList(a,e,t)},handleChangeOwnerAction:function(e,t,a,o){e.$.triggerAction("change_owner",t,void 0,void 0,a).then((function(e){var t=e.data[0].details;if(o.response=e,isWFSchedulerUser()&&t.isWFScheduler){o.setData("showButton",!1);var a=e.data.length,s=1===a&&"canvas_detail_view"===o.getData("from");s&&(detailView.isSingleRecordChangeOwnerPopupLoading=!0);var i=t.wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(i);var r=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(a);return commonUtils.showHideLoadingDiv(!0),void(automationActionsNotificationScheduler.changeOwnerOffloadTimeout=setTimeout((function(){if(s&&detailView.isSingleRecordChangeOwnerPopupLoading||!s){detailView.isSingleRecordChangeOwnerPopupLoading=!1;var e=$L("crm-change-owner");if(!e||!e.find("lyte-modal")[0].getData("ltPropShow"))return;automationActionsNotificationScheduler.showNotificationInProgress(i,void 0,a),o.handleChangeOwnerSuccess()}}),r))}o.handleChangeOwnerSuccess()}),(function(e){commonUtils.showHideLoadingDiv();var t=JSON.parse(e.response).data?JSON.parse(e.response).data[0]:JSON.parse(e.response);if(403===e.status||400===e.status)return"INVALID_DATA"===t.code&&o.getData("isFolAvailable")&&"canvas_detail_view"===o.getData("from")?(o.setData("isFolOwnerError",!0),o.setData("folErrorObject",t),commonUtils.showHideLoadingDiv(),o.showFOlPopup(o.getData("selectedUser"),!0),void o.setData("isFolOwnerError",!1)):void("NO_PERMISSION"===t.code||"CANNOT_PERFORM_ACTION"===t.code&&"no permission to change owner on this record"===t.message?(o.closeModal(),renderingUtils.displayPermissionDenied()):"Sorry, you cannot perform this operation as the record is locked."===t.message||"record under merge is locked"===t.message?(_cruxUtils.showCustomMessage({id:"massChangeOwnerLock",params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.transfer.record.lock.failure"),ltPropDuration:"3000"}}),o.closeModal()):"Transferee does not have permission to the module"===t.message?_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"massToolAlert",ltPropContentAlign:"center",ltPropCloseOnEscape:!1,ltPropButtonPosition:"center",ltPropPrimaryMessage:I18n.getMsg("crm.change.owner.permission.alert",[o.data.selectedUser.full_name,moduleRecordMapping[o.data.module].plural_label]),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"primary"}],ltPropButtonPosition:"center"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg")}}):"the id given seems to be invalid"===t.message?_cruxUtils.showCustomMessage({id:"",params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.masstransfer.record.failure"),ltPropDuration:"4000"}}):"Only open records are allowed"===t.message?_cruxUtils.showCustomMessage({id:"massChangeOwner",params:{ltPropType:"failure",ltPropMessage:I18n.getMsg("crm.delete.error"),ltPropDuration:"3000"}}):"The user to whom you are trying to transfer the records is not a subordinate."===t.message?_cruxUtils.showCustomMessage({id:"",params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.change.owner.permission.Manage_Subordinate_Alert"),ltPropDuration:"4000"}}):_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"massToolAlert",ltPropCloseOnEscape:!1,ltPropContentAlign:"center",ltPropButtonPosition:"center",ltPropPrimaryMessage:I18n.getMsg("crm.alert.select.active.user"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok.got.it"),appearance:"primary"}],ltPropButtonPosition:"center"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg")}}));401===e.status?renderingUtils.displayPermissionDenied():(_cruxUtils.showCustomMessage({id:"massChangeOwner",params:{ltPropType:"failure",ltPropMessage:I18n.getMsg("crm.delete.error"),ltPropDuration:"3000"}}),o.reloadCurrentView(o.getData("module"))),o.closeModal()}))},handleChangeOwnerFromApprovalWeb:function(e){var t="",a=document.forms.namedItem("approvalForm"),o=a.elements.idlist.value,s=a.elements.startIndex.value,i=a.elements.endIndex.value,r=a.elements.approvalModule.value,l=document.forms.namedItem("approvalForm1"),n=l.elements.actionName.value,d=l.elements.showDuplicates.value;return d||(d=0),t=Crm.getCrmBasePath()+"/ConfirmApproval.do?idlist="+o+"&startIndex="+s+"&endIndex="+i+"&assignOwner="+e+"&approvalModule="+r+"&isfromApproval=yes","Contacts"===r?t=Crm.getCrmBasePath()+"/ConfirmContactApproval.do?idlist="+o+"&startIndex="+s+"&endIndex="+i+"&assignOwner="+e+"&approvalModule="+r+"&isfromApproval=yes":"Cases"===r?t=Crm.getCrmBasePath()+"/ConfirmCaseApproval.do?idlist="+o+"&startIndex="+s+"&endIndex="+i+"&assignOwner="+e+"&approvalModule="+r+"&isfromApproval=yes":-1!==r.indexOf("CustomModule")&&(t=Crm.getCrmBasePath()+"/WebRecordConfirmApproval.do?idlist="+o+"&startIndex="+s+"&endIndex="+i+"&assignOwner="+e+"&approvalModule="+r+"&isfromApproval=yes"),t=t+"&actionName="+n+"&showDuplicates="+d,document.deleteForm.action=t,document.deleteForm.method="post",doAjaxUpdateForm("show",document.deleteForm),closeownernamedialog(),!1},getRelList:function(e,t,a){for(var o=["Events","Tasks","Calls","Deals","Contacts"],s=[],i=[],r=moduleRecordMapping[this.getData("module")].api_name,l=this.getData("selectedRecordId")[0],n=this,d=e.related_list.length,c=0;c<d;c+=1){var p=e.related_list[c];if(o.includes(p.api_name)&&void 0!==t[p.api_name]){var m={related_list:{}};m.related_list.id=p.id,m.related_list.api_name=p.api_name,m.id=p.id,s.push(m),i.push(m)}}let u=store.peekAll("get_related_records_count"),g=!1;var h=[];if(void 0!==u&&"detail_view"===n.getData("from")?i.forEach((function(e){let t=u.find((t=>t.id===e.related_list.id));t?h.push(t):g=!0})):g=!0,g){var f={get_related_records_count:i};store.findAll("dummy",{},!1,!1,{url:"/crm/v4/"+r+"/"+l+"/actions/get_related_records_count",method:"POST",payLoad:JSON.stringify(f)}).then((function(e){var o=e.dummy.get_related_records_count;n.addRelatedRecordData(o,s),n.getRelatedlist(s,t,a,r,l,n)}),(function(){n.getRelatedlist(s,t,a,r,l,n)}))}else n.addRelatedRecordData(h,s),n.getRelatedlist(s,t,a,r,l,n)},addRelatedRecordData:function(e,t){for(var a=e.length,o=0;o<a;o+=1)if(0===e[o].count)for(var s=t,i=s.length,r=0;r<i;r+=1)if(e[o].related_list.id===s[r].id){Lyte.arrayUtils(t,"removeObjects",t[r]);break}},addRemovePlaceholder:function(){this.getData("selectedRelated").length>0?this.setData("relplaceholder",""):this.setData("relplaceholder",I18n.getMsg("crm.change.owner.select.items"))},addRestrictionMessage:function(e,t,a,o){var s=this;if(this.setData("restrictLeadConvertUser",!1),"convert"===o){var i=$L("crm-convert-lead")[0].component;if(null===t)return;var r=[];(null===i.getData("accountid")||""===i.getData("accountid"))&&i.getData("companyAvailable")&&moduleRecordMapping.Accounts.visible&&r.push("Accounts"),null!==i.getData("contactid")&&""!==i.getData("contactid")||r.push("Contacts"),i.getData("createDeal")&&r.push("Deals");var l=$("#assignmentRestriction"),n=$("#assgRest_ConvertDeal_tr"),d=document.getElementById("assRestGrant_ConvertLead");"dealCreate"===o&&(l=$("#assignmentRestriction_ConvertDeal"),n.hasClass("dN"),d=document.getElementById("assRestGrant_ConvertDeal"),i.getData("createDeal")&&r.push("Deals")),l.hasClass("dN"),d&&("dealCreate"===o?(d.setData("source","dealCreate"),d.setData("moduleName","Deals"),i.getData("createDeal")&&r.push("Deals")):(d.setData("source","convert"),d.setData("moduleName",""))),r.forEach((function(e){s.getRestrictionInfo(e,t).then((function(e){!1===e.allow&&(s.setData("restrictLeadConvertUser",!0),"dealCreate"===o&&assgRest_ConvertDeal_tr&&n.removeClass("dN"))}))}))}else if("massconvert"===o){var c=["Contacts","Accounts"],p=$L("#potentialsCheckBox");p.length>0&&p[0].checked&&c.push("Deals"),s.setData("restrictionFeature","convert"),c.forEach((function(e){s.getRestrictionInfo(e,t).then((function(t){!1===t.allow&&(s.setData("restrictionmodule",e),s.setData("restrictLeadConvertUser",!0),"dealCreate"===o&&assgRest_ConvertDeal_tr&&n.removeClass("dN"))}))}))}},getRestrictionInfo:function(e,t,a){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,a)},getRelatedlist:function(e,t,a,o,s,i){var r=e.length,l=[];if(r>0){for(var n=0;n<r;n+=1){var d={};d.sub_request_id=""+(n+1),d.method="POST",d.uri="/crm/v2.2/"+o+"/bulk",d.params={relatedId:s,relationId:e[n].id,filters:{field:{api_name:"Owner"},comparator:"equal",value:a},per_page:"1"},l.push(d)}if(l.length>1){var c={rollback_on_fail:!0,concurrent_execution:!1,__composite_requests:l};store.findAll("dummy",null,!1,!1,{url:"/crm/v3/__composite_requests",payLoad:JSON.stringify(c),method:"POST"}).then((function(a){var o=a.dummy.__composite_requests;void 0!==o&&o.length>0&&i.setRelatedListDetailView(o,e,t)}))}else store.findAll("dummy",l[0].params,!1,!1,{url:"/crm/v2.2/"+o+"/bulk",method:"POST"}).then((function(a){var o=a.dummy.data;void 0!==o&&o.length>0&&i.setRelatedListDetailView(o,e,t)}))}},setRelatedListDetailView:function(e,t,a){for(var o=void 0!==e?e.length:0,s=this,i=0;i<o;i+=1)if(void 0!==e[i].Owner||200===e[i].details.response.status_code)switch(t[i].related_list.api_name){case"Events":Lyte.arrayUtils(s.data.itemsArray,"push",{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Events.plural_label),value:"Events",checked:!!a&&a.Events,api_name:moduleRecordMapping.Events.api_name});break;case"Calls":Lyte.arrayUtils(s.data.itemsArray,"push",{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Calls.plural_label),value:"Calls",checked:!!a&&a.Calls,api_name:moduleRecordMapping.Calls.api_name});break;case"Tasks":Lyte.arrayUtils(s.data.itemsArray,"push",{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Tasks.plural_label),value:"Tasks",checked:!!a&&a.Tasks,api_name:moduleRecordMapping.Tasks.api_name});break;case"Deals":Lyte.arrayUtils(s.data.itemsArray,"push",{label:I18n.getMsg("crm.right.open.module",moduleRecordMapping.Potentials.plural_label),value:"Potentials",checked:!!a&&a.Deals,api_name:moduleRecordMapping.Potentials.api_name});break;case"Contacts":Lyte.arrayUtils(s.data.itemsArray,"push",{label:moduleRecordMapping.Contacts.plural_label,value:"Contacts",checked:!!a&&a.Contacts,api_name:moduleRecordMapping.Contacts.api_name});break;default:continue}s.data.itemsArray.forEach(function(e){e.checked&&(Lyte.arrayUtils(s.getData("selectedRelated"),"push",e),Lyte.arrayUtils(s.getData("selectedItemsArray"),"push",e.value))}.bind(this)),s.getPermissionRemovedMod(),s.addRemovePlaceholder()},fetchRelatedModProfiles:function(e){if(void 0!==e&&void 0!==e.profile.id){var t=e.profile.id,a=this.getData("relatedModPerm");if(a[t])this.setData("showButton",!0);else{this.setData("showButton",!1);var o=this.getData("itemsArray").map((e=>"Crm_Implied_View_"+e.api_name)),s=this;commonUtils.showHideLoadingDiv(!0),store.findRecord("profile",t).then((function(e){var i=e.permissions_details.filter((function(e){return-1!==o.indexOf(e.name)})),r=i.length;a[t]={};for(var l=0;l<r;l++)a[t][i[l].module.api_name]=i[l].enabled;s.setData("showButton",!0),s.setData("relatedModPerm",a),commonUtils.showHideLoadingDiv(!1)}))}}else this.setData("showButton",!1)}},{mixins:["crm-view-utils","crm-assignment-threshold-common"]});
