Lyte.Component.register("crm-customview-dropdown",{_template:'<template class="customViewComp" tag-name="crm-customview-dropdown"> <crux-customview-dropdown cx-prop-customview-category="{{customViewCatList}}" cx-prop-module="{{moduleApi}}" cx-prop-selected="{{cvSelected}}" cx-prop-favorite-option="{{favoriteOption}}" cx-prop-button-class="{{buttonClass}}" cx-prop-class="{{class}}" on-customview-select="{{method(\'onSelectCV\')}}" on-change-favorites="{{method(\'onChangeFavoriteItems\')}}" on-customview-reorder="{{method(\'onReorderFavorites\')}}" on-before-customview-render="{{method(\'beforeCustomViewRendering\')}}" cx-prop-no-result="{{getI18n(\'crm.label.nomatching.views\')}}" cx-prop-footer-yield="true" cx-prop-callback-delay="3000" cx-prop-zcqa="SelectedOption" cx-prop-prefix-yield="{{showCvAnomalyDd}}" on-before-customview-select="{{method(\'beforeSelectOption\')}}" cx-prop-tabindex="{{tabIndex}}" on-before-show="{{method(\'onBeforeShow\')}}"> <lyte-event-listener event-name="showAnomalyInDD" on-fire="{{action(\'updatedCVAnomalyData\')}}"> <template is="if" value="{{footerNeeded}}"><template case="true"><template is="registerYield" yield-name="cxCV_Footer"> <div id="createView" class="cvCreateViewLink"> <template is="if" value="{{isEdit(customViewObject.dispCvName,&quot;Create&quot;,&quot;listview&quot;)}}"><template case="true"> <link-to lt-prop-route="crm.settings.section.custom-view.create-custom-view" lt-prop-qp="{&quot;module&quot;:&quot;{{module}}&quot;}" lt-prop-class="cP dB dropFooterList" class="dB" data-zcqa="dash_contact_createView" lt-prop-tabindex="0">{{getI18n("crm.label.customview.create")}}</link-to> </template><template case="false"> <span class="pT6 pB6 dB createlink crmNotFoundColor createlinkgray">{{getI18n("crm.label.customview.create")}}</span> </template></template> </div> </template></template></template> <template is="registerYield" class="dB pR" yield-name="cxSelectedCustomview"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(showCvAnomalyDd,\'&amp;&amp;\',cvAnomaly),\'&amp;&amp;\',expHandlers(cvAnomaly.noAnomaly,\'!\')),\'&amp;&amp;\',expHandlers(cvAnomaly.cv_id,\'===\',cvItem.id))}}"><template case="true"> <crmutil-icon data-zcqa="cvAnomalyListViewChildIcon" lt-prop-title="{{getI18n(\'crm.zia.anomaly.cv.notification.title\')}}" class="cP anomalyIconHover anomalyIconHoverInsideDropdown mL10 mR10 pR" icon-name="anomalyalert" icon-class="zcicn-anomalyalert zcicn_red zi1" onclick="{{action(\'openCVAnomaly\')}}"></crmutil-icon> </template></template> </template> </lyte-event-listener></crux-customview-dropdown> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[0],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}]}},default:{}},{type:"registerYield",position:[1,1,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}],_observedAttributes:["customViewName","customViewList","module","excludeCustomViewList","excludeStartsWithCustomViewList","items","dataFetched","cvId","routePath","transitionTarget","feature","class","moduleApi","footerNeeded","cscriptChecks","favKey","tabIndex","reorderFavList","dataTabIndex","customViewCatList","favoriteOption","buttonClass","cvSelected","cvAnomaly","showCvAnomalyDd"],data:function(){return{customViewName:Lyte.attr("string",{default:""}),customViewList:Lyte.attr("array",{default:[]}),module:Lyte.attr("string",{default:""}),excludeCustomViewList:Lyte.attr("array",{default:[]}),excludeStartsWithCustomViewList:Lyte.attr("array",{default:[]}),items:Lyte.attr("object",{default:{}}),dataFetched:Lyte.attr("boolean",{default:!1}),cvId:Lyte.attr("string",{default:""}),routePath:Lyte.attr("string",{default:""}),transitionTarget:Lyte.attr("string",{default:""}),feature:Lyte.attr("string",{default:""}),class:Lyte.attr("string",{default:""}),moduleApi:Lyte.attr("string",{default:""}),footerNeeded:Lyte.attr("boolean",{default:!1}),cscriptChecks:Lyte.attr("object",{default:{}}),favKey:Lyte.attr("string",{default:""}),tabIndex:Lyte.attr("string",{default:"0"}),reorderFavList:Lyte.attr("boolean",{default:!1}),dataTabIndex:Lyte.attr("string"),customViewCatList:Lyte.attr("array",{default:[]}),favoriteOption:Lyte.attr("boolean",{default:!1}),buttonClass:Lyte.attr("string",{default:""}),cvSelected:Lyte.attr("object",{default:{}}),cvAnomaly:Lyte.attr("object",{default:{}}),showCvAnomalyDd:Lyte.attr("boolean",{default:!1})}},init:function(){var e=Lyte.Router.getRouteInstance();this.setData("transitionTarget",e.transition.target);var t=this.getData("transitionTarget"),o=this.getData("cvId"),a=this.getData("module"),i={},r=this.data.customViewName;let s={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("Created By Me"),cxAccordionName:"Created_By_Me",cxViews:[],cxParams:{scope:"created_by_me"}},c={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("Shared With Me"),cxAccordionName:"Shared_With_Me",cxViews:[],cxParams:{scope:"shared_with_me"}},n={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("Public Views"),cxAccordionName:"Public_Views",cxViews:[],cxParams:{scope:"public_views"}},l={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("Other User's Views"),cxAccordionName:"Other_Users_Views",cxViews:[],cxParams:{scope:"other_users_views"}};var d=[s,c,n];Crm.userDetails.IS_ADMIN&&d.push(l);let p={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("Favorites"),cxAccordionName:"cxFavorites",cxViews:[],cxParams:{favourite:!0},cxSortable:!1,cxPreventClosing:!0};t=this.getData("transitionTarget"),a=this.getData("module");if(("crm.tab.module.custom-view"===this.getData("routePath")||"Visits"===a&&"crm.tab.module.begin"===t)&&(this.setData("favoriteOption",!0),p.cxSortable=!0),Crm.userDetails.CLIENT_ACCOUNT&&Crm.userDetails.PORTALS_CRITERIA_BASED_AUTHORIZATION_ENABLED?d=[c]:d.unshift(p),this.setData("customViewCatList",d),!o)if("custom-view"===e.parent.routeName)o=e.parent.getDynamicParam();else if("crm.tab.module.begin"===t&&"Visits"===a){var u=e.transition.response;o=u?u.cvid:""}o||-1===["crm.tab.module.begin","crm.settings.edit-home-customization","crm.settings.create-home-customization","crm.settings.section.autoresponders.edit-autoresponder","crm.settings.section.old-territory-assign"].indexOf(t)||(r=I18n.getMsg("crm.select")),i.id=o,i.display_value=r,"cadences"===this.getData("feature")&&(i.display_value=I18n.getMsg("crm.series.select.cv")),this.setData("cvSelected",i),a&&this.setData("moduleApi",moduleRecordMapping[a].api_name),this.setData("cvId",o),("crm.tab.module.custom-view"===this.getData("routePath")||"crm.tab.module.begin"===t&&"Visits"===a&&o)&&this.setData("footerNeeded",!0),"Activities"==a&&Crm.isActivitySplitDone&&this.setData("footerNeeded",!1),Crm.userDetails.CLIENT_ACCOUNT&&this.setData("footerNeeded",!1);var m=this.getData("cvAnomaly");m&&0!==Object.keys(m).length&&!m.noAnomaly&&this.setData("showCvAnomaly",!0)},moduleObserver:function(){this.setData("cvId","");var e=document.querySelector("#cvid");e&&e.setAttribute("value",this.getData("cvId")),this.setData("dropdownOpened",!1),this.init()}.observes("module"),actions:{updatedCVAnomalyData:function(e){e&&0!==Object.keys(e).length&&!e.noAnomaly&&this.setData("showCvAnomalyDd",!0)},openCVAnomaly:function(){this.preventClose=!0,this.openAnomalyDetails(this.getData("cvAnomaly"),moduleRecordMapping[this.getData("module")],"cv_anomaly_result_container","list"),this.setData("showCvAnomalyDd",!1)}},methods:{onBeforeShow:function(e){var t=!1;if(e.customview.filter((e=>!e.dataFetched)).length>0)t=!0;else if(this.getData("cscriptChecks").hasOwnProperty("restricted")&&this.getData("cscriptChecks").restricted.length>0){var o=this.getData("cscriptChecks").restricted;for(var a of e.customview)if(a.cxViews.filter((e=>o.indexOf(e.id)>-1))){t=!0;break}}return{fetchCustomViewData:t}},beforeSelectOption:function(){if(this.preventClose)return delete this.preventClose,!1},onReorderFavorites:function(e){let t=e.reorderedCVList.map((e=>e.id)),o={module:this.data.moduleApi,ids:t.toString()};store.triggerAction("custom_view","favourite",o)},onChangeFavoriteItems:function(e){var t=e.starredCV.join(),o=e.unStarredCV.join(),a=this.getData("moduleApi"),i={};let r=this.$node.querySelector("crux-customview-dropdown");if(t){var s={module:a,ids:t,isDelete:!1};i.starredCV=store.triggerAction("custom_view","favourite",s).then(function(){r.addCustomview("cxFavorites",e.starredCV)}.bind(this),function(){r.addCustomview("cxFavorites",e.starredCV)}.bind(this))}if(o){s={module:a,ids:o,isDelete:!0};i.unStarredCV=store.triggerAction("custom_view","favourite",s).then(function(){r.removeCustomview("cxFavorites",e.unStarredCV)}.bind(this),function(){r.removeCustomview("cxFavorites",e.unStarredCV)}.bind(this))}return i},onSelectCV:function(e){if(this.getMethods("onSelectCustomView"))return this.executeMethod("onSelectCustomView",e);let t=e.selected,o=t.id;if(Crm.client_tracking("Custom View - Custom View Changed",{module:this.getData("module")}),CScriptLib&&"crm.tab.module.custom-view.list"===this.getData("transitionTarget"))CScript.Engine.Global.dispatchIEvent("onBeforeCustomViewChange",null,{id:o,name:t.name}).then((e=>{if(!0===e){this.setData("cvId",o);var t=this.getData("transitionTarget"),a=this.getData("routePath"),i=this.getData("module");if(a){var r=Lyte.Router.getRouteInstance(),s=[i,o];r.transitionTo({route:t,dynamicParams:s}).data={reloadAll:!0}}else"crm.tab.messages.custom-view.list"===t&&"Messages"===i&&(this.setData("customViewName",store.peekRecord("custom_view",o).display_value),Lyte.Router.getRouteInstance().transitionTo("crm.tab.messages.custom-view.list",o))}}));else{this.setData("cvId",o);var a=this.getData("transitionTarget"),i=this.getData("routePath"),r=this.getData("module");if(i){var s=Lyte.Router.getRouteInstance(),c=[r,o],n={};"crm.tab.module.custom-view.canvas"===s.transition.info.route&&(c.push(s.transition.info.dynamicParams[2]),n.viewType=store.peekRecord("canvasview",s.transition.info.dynamicParams[2]).view_type),"crm.tab.module.begin"===a&&"Visits"!==r&&"Home"!==r&&(a="crm.tab.module.custom-view.list"),s.transitionTo({route:a,dynamicParams:c,queryParams:n}).data={reloadAll:!0}}else if("crm.settings.section.old-territory-assign"===a)document.querySelector("#cvid").setAttribute("value",o),Territory.getCvRecords();else if("crm.settings.section.autoresponders.create-autoresponder"===a||"crm.settings.section.autoresponders.edit-autoresponder"===a)this.getData("isNoneNeeded")?(document.querySelector("#WKCustomCV_"+this.getData("dayNo")).setAttribute("value","None"===o?"":o),this.setData("customViewName","None"===o?I18n.getMsg("crm.label.picklist.none"):store.peekRecord("custom_view",o).display_value)):(document.querySelector("#cvId").setAttribute("value",o),this.setData("customViewName",store.peekRecord("custom_view",o).display_value));else if("crm.tab.module.begin"===a&&"Visits"!==r||"crm.tab.module.begin"===a&&"Visits"===r&&!this.getData("footerNeeded")){document.querySelector("#cvid").setAttribute("value",o),this.setData("customViewName",store.peekRecord("custom_view",o).display_value);var l=document.querySelector("#tabDivCreateComponent");"none"===l.style.display&&(l.style.display="block",l.querySelector("#layoutName").focus())}else"crm.settings.edit-home-customization"===a||"crm.settings.create-home-customization"===a?(document.querySelector("#cvid").setAttribute("value",o),this.setData("customViewName",store.peekRecord("custom_view",o).display_value)):"crm.tab.messages.custom-view.list"===a&&"Messages"===r&&(this.setData("customViewName",store.peekRecord("custom_view",o).display_value),Lyte.Router.getRouteInstance().transitionTo("crm.tab.messages.custom-view.list",o))}},beforeCustomViewRendering:function(e){var t=e.customViews?e.customViews:[],o=this.data.excludeCustomViewList;if(this.getData("cscriptChecks").hasOwnProperty("restricted")&&this.getData("cscriptChecks").restricted.length>0){var a=this.getData("cscriptChecks").restricted;t=t.filter((function(e){return a.indexOf(e.id)<0}))}return t=(t=t.filter(function(e){return o.indexOf(e.system_name)<0}.bind(this))).filter(function(e){var t=!0;return this.getData("excludeStartsWithCustomViewList").forEach((function(o){null===e.system_name||0!==e.system_name.indexOf(o)||(t=!1)})),t}.bind(this))}}},{mixins:["crm-view-utils","cv-anomaly-utils"]}),Lyte.Component.register("crux-customview-dropdown",{_template:'<template tag-name="crux-customview-dropdown"> <lyte-dropdown class=" cxCV_DropDown {{cxPropClass}}" lt-prop-disabled="{{cxPropDisabled}}" lt-prop-yield="true" lt-prop-freeze="{{cxPropFreeze}}" lt-prop-selected="{{cxPropSelected.id}}" on-before-show="{{method(\'beforeOpenDropBox\')}}" on-show="{{method(\'onOpenDropBox\')}}" on-hide="{{method(\'onCloseDropBox\')}}" on-before-hide="{{method(\'beforeDropBoxClose\')}}" data-zcqa="{{cxPropZcqa}}" lt-prop-animate="true" lt-prop-dynamic="true" lt-prop-scope="{{cxPropScope}}" lt-prop-tabindex="{{cxPropTabindex}}" lt-prop-active-element="{{if(showSearchBox,\'.cxCV_SearchBoxInput\',\'.lyteDummyEventContainer\')}}" lt-prop-include-button-in-focus-loop="{{if(showSearchBox,\'.cxCV_SearchBoxInput\',\'.lyteDummyEventContainer\')}}" lt-prop-allow-focusable-elements="true"> <template is="registerYield" yield-name="yield"> <lyte-drop-button data-zcqa="cxCVButton" id="cxCV_DropButton" class="{{cxPropButtonClass}}"> <template is="if" value="{{cxPropButtonYield}}"><template case="true"> <lyte-yield yield-name="cxCV_ButtonYield"></lyte-yield> </template><template case="false"> <span class="cxCvDropdown"><lyte-text lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottom&quot;, &quot;appearance&quot;: &quot;box&quot;}" lt-prop-tooltip-class="lvTooltipClass" lt-prop-value="{{cxPropSelected[cxPropDisplayLabel]}}"></lyte-text></span> <lyte-icon class="dropdown"></lyte-icon> </template></template> </lyte-drop-button> <lyte-drop-box data-zcqa="cxCV_DropBox" id="cxCV_DropBox" class="cxCvDropBox cxCV_DropBox cxCV_DropBox_{{cxPropClass}} {{cxPropClass}}"> <template is="if" value="{{showSearchBox}}"><template case="true"><lyte-drop-header> <lyte-input id="cxCV_SearchBox" lt-prop-class="cxCV_SearchBoxInput" lt-prop-placeholder="{{cruxGetI18n(\'crm.globalsearch.search.title\')}}" lt-prop-autofocus="true" lt-prop-type="search" data-zcqa="CVSearchBox" lt-prop-appearance="box" oninput="{{action(\'searchCustomView\',this)}}" on-clear="{{method(\'clearSearch\')}}" lt-prop-close-icon="\'true"> </lyte-input> </lyte-drop-header></template></template> <lyte-drop-body data-zcqa="cxCV_DropBody" class="cxCvDropBody cxCV_DropDownBody" onscroll="{{action(\'scrollFun\',this,event)}}"> <template is="if" value="{{isDataFetched}}"><template case="true"><div class="cxCvDropBoxAccordion" id="accordionContainer"> <lyte-accordion lt-prop-exclusive="false" lt-prop-duration="0.2s" lt-prop-dynamic="true" on-before-close="{{method(&quot;beforeAccClosing&quot;)}}" on-before-open="{{method(&quot;beforeOpenAccItem&quot;)}}" on-open="{{method(&quot;onOpenAccItem&quot;)}}" on-changed="{{method(&quot;onAccStateChange&quot;)}}"> <template is="registerYield" yield-name="yield"> <template is="for" items="{{renderCustomviewCatList}}" item="customViewGrp" index="index"> <template is="if" value="{{expHandlers(expHandlers(customViewGrp.cxViews.length,\'||\',expHandlers(customViewGrp.showAccordion,\'&amp;&amp;\',expHandlers(customViewGrp.dataFetched,\'!\'))),\'||\',customViewGrp.cxDisabled)}}"><template case="true"><lyte-accordion-item data-zcqa="cxCV_{{customViewGrp.cxAccordionName}}_item" cx-accordion-item="{{customViewGrp.cxAccordionName}}" class="{{checkAccordionStats(customViewGrp.cxDisabled,index)}} cxCV_AccItem_{{customViewGrp.cxAccordionName}} cxCVAccordionItem {{customViewGrp.cxAccordionClass}} {{if(customViewGrp.cxDisabled,\'cxCvDisabledAccItem\',\'\')}}"> <lyte-accordion-header data-cv-category="{{customViewGrp.cxAccordionLabel}}" class="cxCV_AccHeader cxCV_AccHeader_{{customViewGrp.cxAccordionName}}"> <lyte-icon class="cxCvAccordionArw"></lyte-icon> <span lt-prop-title="{{customViewGrp.cxTitle}}">{{customViewGrp.cxAccordionLabel}}</span> </lyte-accordion-header> <lyte-accordion-body cxaccordionname="{{customViewGrp.cxAccordionName}}" class="{{customViewGrp.cxAccordionName}} cxCV_{{customViewGrp.cxAccordionName}}_body {{if(customViewGrp.cxSortable,expHandlers(\'cxSortableContainer cxCV_Sortable_\',\'+\',customViewGrp.cxAccordionName),\'\')}}"> <template is="if" value="{{expHandlers(customViewGrp.cxViews.length,\'!\')}}"><template case="true"><div class="cxNoResultStyle" id="cxCatNoatch"><span>{{cxPropNoResult}}</span></div></template></template> <template is="for" items="{{customViewGrp.cxViews}}" item="cvItem" index="ind"> <template is="if" value="{{cvItem.showLoading}}"><template case="true"><lyte-drop-item class="cxCvHorizontalLoading"> <div class="cxDotLoaderWrap"> <div class="cxDotBullet cxDotLoader1"></div> <div class="cxDotBullet cxDotLoader2"></div> <div class="cxDotBullet cxDotLoader3"></div> <div class="cxDotBullet cxDotLoader4"></div> </div> </lyte-drop-item></template><template case="false"><lyte-drop-item data-zcqa="cxCV_Item_{{cvItem[cxPropDisplayLabel]}}" id="cxCV_Item_{{cvItem.id}}" selected="{{setSelected(customViewGrp,favoriteCVList,cvItem,cxPropSelected.id)}}" data-value="{{cvItem.id}}" class="cxCV_DropDownItem cxCV_{{customViewGrp.cxAccordionName}}_item {{if(favoriteCVList[cvItem.id],\'cxStarFavorited\',\'\')}} " onclick="{{action(\'selectCVItem\',cvItem)}}"> <template is="if" value="{{favoriteCVList[cvItem.id]}}"><template case="true"><span class="cxStarWrap"> <span class="cxStar {{if(cvItem.cxStarred,\'cxStarSelected\',\'cxStarEmpty\')}}" data-zcqa="cxCV_DisableStar" onclick="{{action(\'starCVItem\',event,cvItem,customViewGrp,\'remove\')}}"></span> </span></template></template> <template is="if" value="{{expHandlers(cxPropFavoriteOption,\'&amp;&amp;\',expHandlers(favoriteCVList[cvItem.id],\'!\'))}}"><template case="true"><span class="cxStarWrap"> <span data-zcqa="cxCV_EnableStar" class="cxStar {{if(cvItem.cxStarred,\'cxStarSelected\',\'cxStarEmpty\')}}" onclick="{{action(\'starCVItem\',event,cvItem,customViewGrp,\'add\')}}"></span> </span></template></template> <div class="cxFlex cxAlignItemCenter"> <lyte-text class="cbViews" lt-prop-value="{{cvItem[cxPropDisplayLabel]}}"></lyte-text> <template is="if" value="{{cxPropPrefixYield}}"><template case="true"><lyte-yield class="cxDIB cxCVPrefixYieldWrapper" cv-item="{{cvItem}}" yield-name="cxSelectedCustomview"></lyte-yield></template></template> </div> </lyte-drop-item></template></template> </template> </lyte-accordion-body> </lyte-accordion-item></template></template> </template> </template> </lyte-accordion> </div></template><template case="false"><div class="cxDotLoaderWrap"> <div class="cxDotBullet cxDotLoader1"></div> <div class="cxDotBullet cxDotLoader2"></div> <div class="cxDotBullet cxDotLoader3"></div> <div class="cxDotBullet cxDotLoader4"></div> </div></template></template> <template is="if" value="{{expHandlers(isDataFetched,\'&amp;&amp;\',expHandlers(totalCVRecords,\'==\',0))}}"><template case="true"><div class="cxNoResultStyle" id="nomatch"><span>{{cxPropNoResult}}</span></div></template></template> </lyte-drop-body> <template is="if" value="{{cxPropFooterYield}}"><template case="true"> <lyte-drop-footer> <lyte-yield yield-name="cxCV_Footer"></lyte-yield> </lyte-drop-footer> </template></template> </lyte-drop-box> </template> </lyte-dropdown> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"insertYield",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[3,3]},{type:"attr",position:[3,3,1]},{type:"if",position:[3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"registerYield",position:[0,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"attr",position:[0,1]},{type:"componentDynamic",position:[0,1,1]},{type:"attr",position:[0,1,3]},{type:"text",position:[0,1,3,0]},{type:"componentDynamic",position:[0,1]},{type:"attr",position:[0,3]},{type:"attr",position:[0,3,1]},{type:"if",position:[0,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[0,0,0]}]}},default:{}},{type:"attr",position:[0,3,3]},{type:"for",position:[0,3,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"attr",position:[0,1]},{type:"if",position:[0,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]}]}},default:{}},{type:"attr",position:[0,3]},{type:"if",position:[0,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]}]}},default:{}},{type:"attr",position:[0,5,1]},{type:"componentDynamic",position:[0,5,1]},{type:"attr",position:[0,5,3]},{type:"if",position:[0,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"insertYield",position:[0]}]}},default:{}},{type:"componentDynamic",position:[0]}]}},default:{}}]},{type:"componentDynamic",position:[0,3]},{type:"componentDynamic",position:[0]}]}},default:{}}]}]},{type:"componentDynamic",position:[0,1]}]},false:{dynamicNodes:[]}},default:{}},{type:"attr",position:[3,3,3]},{type:"if",position:[3,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[0,0,0]}]}},default:{}},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"insertYield",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["cxPropModule","cxPropModelName","cxPropCustomviewCategory","cxPropQueryParams","cxPropSelected","cxPropDisplayLabel","cxPropFreeze","cxPropDisabled","cxPropZcqa","cxPropClass","cxPropButtonClass","cxPropFavoriteOption","cxPropMaxFavorite","cxPropButtonYield","cxPropFooterYield","cxPropNoResult","favoriteCVList","isDataFetched","showSearchBox","searchInProgress","totalCVRecords","customviewCatList","cxPropCallbackDelay","renderCustomviewCatList","favoriteCategory","cxPropPrefixYield","cxPropScope","cxPropTabindex"],data:function(){return{cxPropModule:Lyte.attr("string",{default:""}),cxPropModelName:Lyte.attr("string",{default:"custom_view"}),cxPropCustomviewCategory:Lyte.attr("array",{default:[]}),cxPropQueryParams:Lyte.attr("object",{default:{}}),cxPropSelected:Lyte.attr("object",{default:{}}),cxPropDisplayLabel:Lyte.attr("string",{default:"display_value"}),cxPropFreeze:Lyte.attr("boolean",{default:!1}),cxPropDisabled:Lyte.attr("boolean",{default:!1}),cxPropZcqa:Lyte.attr("string",{default:""}),cxPropClass:Lyte.attr("string",{default:"Customview_DD"}),cxPropButtonClass:Lyte.attr("string",{default:""}),cxPropFavoriteOption:Lyte.attr("boolean",{default:!1}),cxPropMaxFavorite:Lyte.attr("number",{default:10}),cxPropButtonYield:Lyte.attr("boolean",{default:!1}),cxPropFooterYield:Lyte.attr("boolean",{default:!1}),cxPropNoResult:Lyte.attr("string",{default:_cruxUtils.getI18n("crm.label.no.options.found")}),favoriteCVList:Lyte.attr("object",{default:{}}),isDataFetched:Lyte.attr("boolean",{default:!1}),showSearchBox:Lyte.attr("boolean",{default:!1}),searchInProgress:Lyte.attr("boolean",{default:!1}),totalCVRecords:Lyte.attr("number",{default:0}),customviewCatList:Lyte.attr("array",{default:[]}),cxPropCallbackDelay:Lyte.attr("number"),renderCustomviewCatList:Lyte.attr("array",{default:[]}),favoriteCategory:Lyte.attr("object",{default:{}}),cxPropPrefixYield:Lyte.attr("boolean",{default:!1}),cxPropScope:Lyte.attr("string",{default:""}),cxPropTabindex:Lyte.attr("number",{default:0})}},constructInitialValues:function(e){var t=JSON.parse(JSON.stringify(this.data.cxPropCustomviewCategory)),o=0;for(var a of t)"cxFavorites"==a.cxAccordionName&&this.setData("favoriteCategory",a),a.cxViews&&a.cxViews.length&&"init"==e&&(a.preventApiRequest=!0,a.initialDataAvailable=!0,a.initialData=a.cxViews.slice(0)),a.cxViews=a.cxViews?a.cxViews:[],a.cxParams=a.cxParams?a.cxParams:{},a.dataFetched=!1,a.cxSequenceNumber=o++;this.setData("customviewCatList",t)},init:function(){this.searchObj={oldSearchValue:"",currentSearchValue:""},this.fetchCustomViewData=!0,this.starredCV=[],this.unStarredCV=[],this.constructInitialValues("init"),this.$node.addCustomview=function(e,t,o){if(e&&t){var a=this.getData("cxPropModelName"),i=this.getData("renderCustomviewCatList").filter((function(t){return t.cxAccordionName==e}))[0];i||(i=this.getData("customviewCatList").filter((function(t){return t.cxAccordionName==e}))[0],i.cxViews=[],Lyte.arrayUtils(this.getData("renderCustomviewCatList"),"insertAt",0,i)),delete i.doDataSearch,delete i.initialDataAvailable;var r,s=[];t=t.constructor==Array?t:[t];for(var c=0;c<t.length;c++)(r=t[c].constructor==String?store.peekRecord(a,t[c]):t[c])&&s.push(r);if(o&&"cxFavorites"==e)for(var n of s)Lyte.objectUtils(n,"delete","cxStarred");else Lyte.arrayUtils(i.cxViews,"concat",s);"cxFavorites"==e&&this.component.constructFavoriteObj(i.cxViews),this.component.setSortable()}},this.$node.removeCustomview=function(e,t,o){if(e&&t){var a,i=this.getData("cxPropModelName"),r=[];t=t.constructor==Array?t:[t];for(var s=0;s<t.length;s++)(a=t[s].constructor==String?store.peekRecord(i,t[s]):t[s])&&r.push(a);var c=this.getData("renderCustomviewCatList").filter((function(t){return t.cxAccordionName==e}))[0];if(c&&r.length){if(delete c.doDataSearch,delete c.initialDataAvailable,o)for(var n of r)Lyte.objectUtils(n,"add","cxStarred",!0);else{var l=c.cxViews.map((function(e){return e.id}));for(var n of r){var d=l.indexOf(n.id);d>-1&&(l.splice(d,1),Lyte.objectUtils(c.cxViews[d],"delete","cxStarred"),Lyte.arrayUtils(c.cxViews,"removeAt",d))}}var p=this.getData("cxPropSelected.id");if(p&&r.filter((e=>e.id==p))[0]){var u=$L("#cxCV_Item_"+p)[0];u&&u.setAttribute("selected","true")}"cxFavorites"==e&&this.component.setSortable(),this.component.setSortable()}}};var e=this.data.cxPropDisplayLabel;if(!this.data.cxPropButtonYield&&!this.data.cxPropSelected[e])if(this.data.cxPropSelected.id){var t=store.peekRecord(this.data.cxPropModelName,this.data.cxPropSelected.id);t?Lyte.objectUtils(this.data.cxPropSelected,"add",e,t[e]):store.findRecord(this.data.cxPropModelName,this.data.cxPropSelected.id,{module:this.data.cxPropModule}).then(function(t){Lyte.objectUtils(this.data.cxPropSelected,"add",e,Lyte.isRecord(t)?t[e]:t[0][e])}.bind(this))}else Lyte.objectUtils(this.data.cxPropSelected,"add",e,_cruxUtils.getI18n("crm.select")),this.fetchData(void 0,{},"setSelected")},moduleObserver:function(){this.init()}.observes("cxPropModule"),didConnect:function(){this._setHeightForCVDropdown=this.setHeightForCVDropdown.bind(this),window.addEventListener("resize",this._setHeightForCVDropdown,!0),this.setHeightForCVDropdown(),this.lyteDropdown=this.$node.querySelector("lyte-dropdown"),this.$node.open=function(){this.lyteDropdown.open()}.bind(this),this.$node.close=function(){this.lyteDropdown.close()}.bind(this),this.$node.toggle=function(){this.lyteDropdown.toggle()}.bind(this)},setHeightForCVDropdown:function(){let e=$L(".cxCvDropBody")[0],t=$L(".cxCV_DropDown")[0],o=t.clientHeight,a=t.getBoundingClientRect().top,i=0;t&&(i=window.innerHeight-(o+a+200)),e.style.maxHeight=i+"px"},didDestroy:function(){window.removeEventListener("resize",this._setHeightForCVDropdown,!0),this.checkCallBackFn()},checkCallBackFn:function(){this.starCVDebounceTime&&(clearTimeout(this.starCVDebounceTime),this.triggerCallBack("onChangeFavorites"),delete this.starCVDebounceTime),this.reoderDebounceTime&&(clearTimeout(this.reoderDebounceTime),this.triggerCallBack("onCustomviewReorder",this.reorderCallbackData),delete this.reoderDebounceTime)},actions:{searchCustomView:$L.debounce((function(e){this.searchObj.currentSearchValue=e.ltProp("value");var t=this.searchObj.currentSearchValue;if(!(t&&t.length<2)){var o,a=""!==this.searchObj.oldSearchValue&&this.searchObj.currentSearchValue.startsWith(this.searchObj.oldSearchValue),i=[],r=this.data.customviewCatList,s=[];for(var c of(a&&(r=this.data.renderCustomviewCatList),r)){var n=!(0!=c.initialDataAvailable&&!c.cxDisabled);if(c.cxDisabled&&!t&&s.push(c),!n)if(c.doDataSearch||a&&c.cxViews.length&&c.dataFetched){if(c.moreData.more_records){i.push(c);continue}o=c.cxViews.concat(c.cvNextData);var l=(o=c.doDataSearch?c.initialData:o).filter((function(e){return-1!==e.display_value.toLowerCase().indexOf(t.toLowerCase())}));c.skipRequest=!0,c.cvNextData=l.splice(20,l.length),c.cxViews=l,c.cxViews.length&&t&&s.push(c),i.push(c)}else(void 0===c.initialDataAvailable||c.initialDataAvailable)&&i.push(c)}if(i.length){var d,p={};if(delete this.searchObj.searchCriteria,t){d="search";var u={field:{api_name:"Display_Name"},comparator:"contains",value:t};this.getMethods("onConstructSearchCriteria")&&(u=this.executeMethod("onConstructSearchCriteria",{searchValue:t})),p.filters=u,this.searchObj.searchCriteria=p}this.searchObj.oldSearchValue=t,this.fetchData(i,p,d,s)}else s.length&&(this.setData("renderCustomviewCatList",s),this.setSortable())}}),500),selectCVItem:function(e){if(this.getMethods("onBeforeCustomviewSelect")&&0==this.executeMethod("onBeforeCustomviewSelect",{selected:e}))return this.preventClosing=!0,!1;if(this.setData("cxPropSelected",e),this.getMethods("onCustomviewSelect"))return this.executeMethod("onCustomviewSelect",{selected:e})},starCVItem:function(e,t,o,a){if(this.data.cxPropFavoriteOption){e.stopPropagation();e.target;if("remove"==a)this.unStarredCV.includes(t.id)?(this.unStarredCV=this.unStarredCV.filter((function(e){return e!==t.id})),Lyte.objectUtils(t,"add","cxStarred",!0)):(this.unStarredCV.push(t.id),Lyte.objectUtils(t,"delete","cxStarred"));else{var i=Object.keys(this.data.favoriteCVList).length;this.starredCV.length+i<this.getData("cxPropMaxFavorite")?this.starredCV.includes(t.id)?(this.starredCV=this.starredCV.filter((function(e){return e!==t.id})),Lyte.objectUtils(t,"delete","cxStarred")):(this.starredCV.push(t.id),Lyte.objectUtils(t,"add","cxStarred",!0)):_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.alert.favorite.reached.maxlimit",this.getData("cxPropMaxFavorite")),ltPropType:"warning"}})}clearTimeout(this.starCVDebounceTime),this.starCVDebounceTime=setTimeout(function(){delete this.starCVDebounceTime,this.triggerCallBack("onChangeFavorites")}.bind(this),this.data.cxPropCallbackDelay)}},scrollFun:function(e,t){$L.fastdom.measure(function(){var e,t=document.getElementsByClassName("cxCV_DropDownBody")[0];for(var o of this.data.renderCustomviewCatList)if((o.cvNextData.length||o.moreData.more_records)&&(e=t.getElementsByClassName("cxCV_AccItem_"+o.cxAccordionName)[0])&&e.classList.contains("lyteAccordionActive")){var a=t.getBoundingClientRect().bottom;if(e.getBoundingClientRect().bottom-a<200){$L.fastdom.mutate(function(){if(o.cvNextData.length){var e=o.cvNextData.splice(0,20);Lyte.arrayUtils(o.cxViews,"push",e)}else if(o.moreData.more_records){var t=this;if(!t.dataFetchingProcess){t.dataFetchingProcess=!0,this.toggleScroll();var a={page:o.moreData.page+1};this.fetchCVData(o,a,!1,"scroll").then((function(){t.toggleScroll(),delete t.dataFetchingProcess}))}}}.bind(this));break}}}.bind(this))}},methods:{clearSearch:function(e,t){this.actions.searchCustomView.call(this,t)},onAccStateChange:function(){this.renderFirstSetofCV(50)},beforeOpenAccItem:function(e,t){var o=t.getAttribute("cx-accordion-item");if(this.data.renderCustomviewCatList.filter((function(e){return e.cxAccordionName==o}))[0].cxDisabled)return!1},onOpenAccItem:function(e,t){var o=t.getAttribute("cx-accordion-item"),a=this.data.renderCustomviewCatList.filter((function(e){return e.cxAccordionName==o}))[0];if(!a.dataFetched){var i,r=void 0;this.searchObj.searchCriteria&&(i=this.searchObj.searchCriteria,r="search"),this.fetchCVData(a,i,void 0,r)}},beforeAccClosing:function(e,t){var o=t.getAttribute("cx-accordion-item");if(this.data.renderCustomviewCatList.filter((function(e){return e.cxAccordionName==o}))[0].cxPreventClosing)return!1},beforeDropBoxClose:function(e){return this.preventClosing?(delete this.preventClosing,!1):!$L(".cxAlertWrapper")[0]&&void 0},onCloseDropBox:function(){var e=$L("#cxCV_SearchBox")[0];e&&e.ltProp("value")&&(e.ltProp("value",""),delete this.searchObj.searchCriteria,this.fetchCustomViewData=!0),this.fetchCustomViewData&&(this.constructInitialValues(),this.fetchData()),this.checkCallBackFn()},beforeOpenDropBox:function(){if(this.getMethods("onBeforeShow")){var e=this.executeMethod("onBeforeShow",{customview:this.data.customviewCatList});if(!1===e)return e;e&&e.constructor===Object&&e.fetchCustomViewData&&(this.fetchCustomViewData=e.fetchCustomViewData)}this.data.isDataFetched&&!this.fetchCustomViewData||(this.fetchData(),this.fetchCustomViewData=!1),this.setHeightForCVDropdown()},onOpenDropBox:function(){document.querySelector(".cxCV_DropDownBody").scrollTop=0;var e=$L(".cxCV_SearchBoxInput")[0];e&&e.focus(),this.getMethods("onShow")&&this.executeMethod("onShow",{customview:this.data.customviewCatList});for(var t,o=$L(".cxCVAccordionItem"),a=o.length,i=0;i<a;i++)(t=$L(o[i])).hasClass("lyteAccordionActive")||t.click()}},fetchData:function(e,t={},o,a=[]){var i=this,r=!1;e=e||i.data.customviewCatList,i.setData("isDataFetched",!1),i.setData("totalCVRecords",0);for(var s,c=e.length,n=[],l={},d="search"==o?2:3,p=0,u=0;u<c;u++)(s=e[u]).cxDisabled?a.push(s):s.skipRequest?(i.setData("totalCVRecords",i.data.totalCVRecords+s.cxViews.length),delete s.skipRequest):(s.dataFetched=!1,p<d||s.preventApiRequest?(l.unloadCustomview=!s.preventApiRequest&&void 0===i.unloadCustomview&&0==u,t.page=1,t.customData=l,p+=1,n[u]=i.fetchCVData(s,t,!0,o)):(s.cxViews=[],s.showAccordion=!0,s.cxViews.push({showLoading:!0})));Lyte.resolvePromises(n).then((function(){for(var s,c,n,l=e.length,d=0;d<l;d++)if(c=e[d],n=a.filter((e=>e.cxAccordionName==c.cxAccordionName))[0],c.cxViews.length)n||a.push(c),s=!s&&c.dataFetched&&c.cxViews[0]&&!c.cxViews[0].showLoading?c.cxViews[0]:s;else if(n&&!c.cxDisabled){var p=a.findIndex((function(e){return e.cxAccordionName==c.cxAccordionName}));a.splice(p,1)}r=i.data.totalCVRecords>10;var u=e.filter((e=>!e.dataFetched));if(s)e.length>3&&(r=!0);else if(u.length)return i.unloadCustomview=!1,i.fetchData(u,t,o,a);if("setSelected"==o&&i.setData("cxPropSelected",s),a.sort((function(e,t){return e.cxSequenceNumber-t.cxSequenceNumber})),i.getMethods("onBeforeRender")){var m=i.executeMethod("onBeforeRender",{cvCategory:a});m&&m.length&&(a=m)}i.setData("renderCustomviewCatList",a),i.setData("isDataFetched",!0),i.fetchNextSet(u),i.renderFirstSetofCV(50),i.setSortable(),r&&(i.setData("showSearchBox",!0),$L(".cxCV_SearchBoxInput")[0].focus())}))},fetchCVData:function(e,t={},o=!1,a){t.module=this.data.cxPropModule,t.page=t.page?t.page:1,t.per_page=200;var i,r=t.customData?t.customData:{unloadCustomview:!1},s=this;return delete t.customData,e.cxParams=e.cxParams?e.cxParams:{},i={...t,...this.data.cxPropQueryParams,...e.cxParams},e.queryParams=i,e.preventApiRequest?new Promise((function(t){s.postRequestProcess(e.cxViews,e,o,a),t()})):store.findAll(this.data.cxPropModelName,i,!0,!0,r).then((function(t){s.postRequestProcess(t,e,o,a)}))},postRequestProcess:function(e,t,o=!1,a){var i=e?e.slice(0):[];t.moreData={},o&&(Lyte.objectUtils(t,"add","cxViews",[]),t.cvNextData=[]),"search"!==a&&"scroll"!==a&&(t.initialDataAvailable=!(!i||!i.length),t.initialData=i&&i.length?i.slice(0):[],t.doDataSearch=!!t.initialDataAvailable,e&&e.$&&e.$.meta&&(t.doDataSearch=!e.$.meta.more_records)),Lyte.objectUtils(t,"add","dataFetched",!0);var r=t.cxViews[t.cxViews.length-1];if(r&&r.showLoading&&Lyte.arrayUtils(t.cxViews,"removeAt",t.cxViews.length-1,1),i&&i.length){if(this.getMethods("onBeforeCustomviewRender")){var s=this.executeMethod("onBeforeCustomviewRender",{cvCategory:t,customViews:i});void 0!==typeof s&&(i=s,"search"!==a&&"scroll"!==a&&(t.initialDataAvailable=!(!i||!i.length),t.initialData=i&&i.length?i.slice(0):[]))}this.setData("totalCVRecords",this.data.totalCVRecords+i.length),t.cvNextData=i.splice(20,i.length),Lyte.arrayUtils(t.cxViews,"push",i),t.moreData={},e.$&&e.$.meta&&(t.moreData=e.$.meta),"cxFavorites"==t.cxAccordionName&&this.constructFavoriteObj(t.cxViews)}},constructFavoriteObj:function(e){var t={};for(var o of e)Lyte.objectUtils(o,"add","cxStarred",!0),t[o.id]=o;this.setData("favoriteCVList",t)},setSortable:function(){dataJson=this.data.renderCustomviewCatList;var e=dataJson.length,t=0,o=this;for(t=0;t<e;t++)if(cvCategory=dataJson[t],cvCategory.cxSortable&&cvCategory.cxViews&&cvCategory.cxViews.length>1){var a=document.querySelector(".cxCV_DropDownBody .cxCV_Sortable_"+cvCategory.cxAccordionName);$L(a).sortable({omitRestricted:!0,containment:"parent",preventDefault:{mousedown:!1,mousemove:!0},onDrop:function(e,t,a,i,r,s){var c=t.getAttribute("cxAccordionName"),n=o.data.renderCustomviewCatList.filter((function(e){return e.cxAccordionName==c}))[0],l=Lyte.arrayUtils(n.cxViews,"removeAt",i,1)[0];Lyte.arrayUtils(n.cxViews,"insertAt",r,l),clearTimeout(o.reoderDebounceTime),o.reorderCallbackData={reorderedCVList:n.cxViews},o.setSortable(),o.reoderDebounceTime=setTimeout((function(){delete o.reoderDebounceTime,o.triggerCallBack("onCustomviewReorder",o.reorderCallbackData)}),o.data.cxPropCallbackDelay)},restrict:".cxStar"})}},triggerCallBack:function(e,t={}){if(this.getMethods(e)){if("onChangeFavorites"==e){t.starredCV=this.starredCV,t.unStarredCV=this.unStarredCV,t.favoriteData=this.data.customviewCatList.filter((e=>"cxFavorites"==e.cxAccordionName))[0];var o=[],a=[];if(this.starredCV.length)for(var i of this.starredCV)o.push(store.peekRecord(this.getData("cxPropModelName"),i));if(this.unStarredCV.length)for(var i of this.unStarredCV)a.push(store.peekRecord(this.getData("cxPropModelName"),i))}t.customviewCategoryList=this.data.customviewCatList,this.executeMethod(e,t),store.clearCachedQuery(this.data.cxPropModelName),this.fetchCustomViewData=!0,this.starredCV=[],this.unStarredCV=[]}},toggleScroll:function(){var e=$L(".cxCV_DropDownBody");e.hasClass("oHidden")?e.removeClass("oHidden"):e.addClass("oHidden")},fetchNextSet:function(e=[]){if(e.length)for(var t,o,a=e.length,i=0;i<a;i++)t=e[i],o=$L(".cxCV_AccItem_"+t.cxAccordionName)[0],this.methods.onOpenAccItem.call(this,{},o)},renderFirstSetofCV:function(e){for(var t,o,a=this.data.renderCustomviewCatList,i=a.length,r=document.getElementsByClassName("cxCV_DropDownBody")[0],s=0;s<i;s++){if(e<=0)return;if(t=a[s],(o=r.getElementsByClassName("cxCV_AccItem_"+t.cxAccordionName)[0])&&o.classList.contains("lyteAccordionActive")&&(e-=t.cxViews.length)>0&&t.cvNextData&&t.cvNextData.length){let o=t.cvNextData.splice(0,e);e-=o.length,Lyte.arrayUtils(t.cxViews,"push",o)}}}}),Lyte.Component.registerHelper("setSelected",(function(e,t,o,a){if(o.id==a){if("cxFavorites"==e.cxAccordionName)return"true";if(!t[a])return"true"}return!1})),Lyte.Component.registerHelper("checkAccordionStats",(function(e,t){return!e&&t<=2?"lyteAccordionActive":""}));
