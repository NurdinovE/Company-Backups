function slide(){this.freq=1,this.speed=4,this.up=function(e){if(null!==e&&"object"!=typeof e){var t=document.getElementById(e);if(null===t)return;this.hideObj=t}else this.hideObj=e;this.shrinkHeight=this.hideObj.offsetHeight,this.shrink(),-1!==this.expandTimer&&this.showObj.id===this.hideObj.id&&(clearTimeout(this.expandTimer),this.shrinkHeight=this.exHeight-this.speed)},this.down=function(e){if(null!==e&&"object"!=typeof e){var t=document.getElementById(e);if(null===t)return;this.showObj=t}else this.showObj=e;this.exHeight="0",this.showObj.style.display="block",this.showObj.style.height="0px",-1!==this.shrinkTimer&&this.showObj.id===this.hideObj.id&&(clearTimeout(this.shrinkTimer),this.exHeight=this.shrinkHeight-this.speed);this.expand()},this.expand=function(){if(this.exHeight=parseInt(this.exHeight)+this.speed,null===this.showObj)return;if(this.showObj.style.height=this.exHeight+"px",parseInt(this.exHeight)>=this.maxHeight)return clearTimeout(this.expandTimer),this.expandTimer="-1",this.exHeight=this.minHeight,void this.finish("expand");this.expandTimer=setTimeout((function(){this.objName}),this.freq)},this.shrink=shrink,this.finish=finish,this.finishExpandWith=finishExpandWith,this.finishShrinkWith=finishShrinkWith,this.setSpeed=setSpeed,this.setHeightParams=setHeightParams,this.maxHeight="50",this.minHeight="0",this.exHeight=this.minHeight,this.shrinkHeight=this.maxHeight,this.expandTimer=-1,this.shrinkTimer=-1,this.showObj,this.hideObj,this.finishExp="",this.finishShrink="",this.objName,this.setObjName=setObjName}function shrink(){if(this.shrinkHeight=parseInt(this.shrinkHeight)-this.speed,null!==this.hideObj){if(parseInt(this.shrinkHeight)<=this.minHeight)return clearTimeout(this.shrinkTimer),this.shrinkTimer="-1",this.shrinkHeight=this.maxHeight,this.hideObj.style.height=this.minHeight+"px",void this.finish("shrink");this.hideObj.style.height=this.shrinkHeight+"px",this.shrinkTimer=setTimeout((function(){this.objName}),this.freq)}}function setHeightParams(e,t,i,o){void 0!==e&&(this.minHeight=e),void 0!==t&&(this.maxHeight=t),void 0!==i&&(this.exHeight=i),void 0!==o&&(this.shrinkHeight=o)}function finishExpandWith(e){this.finishExp=e}function finishShrinkWith(e){this.finishShrink=""+e}function finish(e){"expand"===e?""!==this.finishExp&&(setTimeout((function(){this.finishExp}),0),this.finishExp=""):""!==this.finishShrink&&(setTimeout((function(){this.finishShrink}),0),this.finishShrink="")}function setSpeed(e){this.speed=e}function setObjName(e){this.objName=e}"undefined"==typeof Collaboration&&(Collaboration=function(){}),Collaboration.handleUserList=function(e,t){},Collaboration.handleMessage=function(e,t,i,o,n){},Collaboration.handlePresence=function(e,t,i,o,n){},Collaboration.join=function(e){WebMessanger.joinCollab(e)},Collaboration.handleServiceMessage=function(e){$("#browser1").removeClass("dN"),$("#br12").html(e.msg)},Collaboration.quit=function(e){WebMessanger.quit(e)},Collaboration.serverup=function(){if(crmConstants.WMS_STATUS=1,document.getElementById("activeChatId")){var e=document.getElementById("activeChatId").value,t=Crm.getCrmBasePath()+"/Chat.do?mode=activateChat&loadChatId="+e;mR(t)}"object"==typeof CrmTracking&&CrmTracking.handleServerUp()},Collaboration.serverdown=function(){crmConstants.WMS_STATUS=0,"object"==typeof CrmTracking&&CrmTracking.updateNetWorkState()},Collaboration.handleZohoMessage=function(e,t,i,o,n,s,r,a,l,c,d,u){},Collaboration.handleCustomMessage=function(e){if("COPY_CUST_REQUEST_RECIEVED"===e.type&&e.zgid.toString()===Crm.userDetails.ZGID.toString()&&(store.clearCachedQuery("copy-customization-history",{type:"import",status:"customer_action_pending"}),store.findAll("copy-customization-history",{type:"import",status:"customer_action_pending"},null,null,{type:"CUSTOMER_ACTION_PENDING"}).then((function(e){if(e.length>0){var t=$L("crm-copy-customization-home")[0];t.setData("hasRequest",!0),t.component.setData("historyList",e)}}))),"COPY_CUST_STATUS_UPDATE"===e.type&&e.zgid.toString()===Crm.userDetails.ZGID.toString()&&(store.clearCachedQuery("copy-customization-history",{type:"export",status:"sender"}),store.findAll("copy-customization-history",{type:"export",status:"sender"},null,null,{type:"SENDER"}).then((function(e){var t=$L("crm-copy-customization-home")[0];void 0===e?(t.setData("hasSentCC",!1),t.component.setData("sentCCList",e)):e.length>0&&(t.setData("hasSentCC",!0),t.component.setData("sentCCList",e))}))),"COPY_CUST_CRM_FREEZE"===e.type&&e.zgid.toString()===Crm.userDetails.ZGID.toString()&&Utils.windowLocationReload(),"COPY_CUST_CRM_ERROR"===e.type&&e.zgid.toString()===Crm.userDetails.ZGID.toString()){var t=Lyte.Router.getURL("crm.settings.section.copy-customization-new");Utils.windowLocationHref(t)}if("mscalendar"===e||"mscontact"===e||"mstask"===e)return store.unloadAll(e),void store.findAll(e).then((t=>{$("crm-ms-container")[0].component.setData(e,t[0])}));if("outlook"!=$("#rightPanelSource").val()&&Crm.isWMSNotifictionForCurrentOrg(e)&&(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.gamification")||e.hasOwnProperty("gnType"))){if("disable_sandbox_brand_import"===e.action){var i=[];Lyte.resolvePromises({organization:networkUtils.lyteInitiateRequest("/crm/v2/organizations","GET",{params:{env_type:"sandbox"}},!1)}).then((function(e){var t=e.organization,o=new Date,n={};$.each(t.organizations,(function(e,t){i.push(t.id)}));for(var s=i.length,r=0;r<s;r++)n.sandbox_brand_import_available=!1,n.expiry=o.getTime()+12e4,localStorage.setItem(i[r],JSON.stringify(n));"index-brands"!==Lyte.Router.getRouteInstance().routeName&&"index-permissions"!==Lyte.Router.getRouteInstance().routeName&&"social-lead-gen"!==Lyte.Router.getRouteInstance().routeName||Utils.windowLocationReload()}))}if("disable_prod_brand_import"===e.action){var n=new Date,s={prod_brand_import_available:!1};s.expiry=n.getTime()+12e4,localStorage.setItem(Crm.userDetails.ZGID,JSON.stringify(s)),"index-brands"!==Lyte.Router.getRouteInstance().routeName&&"index-permissions"!==Lyte.Router.getRouteInstance().routeName&&"social-lead-gen"!==Lyte.Router.getRouteInstance().routeName||Utils.windowLocationReload()}if("deployment_success"===e.action||"deployment_failed"===e.action){if("sandbox"===Lyte.Router.getRouteInstance().routeName||"sandbox-list"===Lyte.Router.getRouteInstance().routeName||"sandbox-detail"===Lyte.Router.getRouteInstance().routeName)return void localStorage.setItem("socialDeployed_"+Crm.userDetails.ZGID,!1);if("deployment_success"===e.action){var r=networkUtils.returnDependencyFiles(["crm-social-sandbox-deployment.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SandboxIntegrationSupport")],ResourceConstants.CRM),l=networkUtils.returnDependencyFiles(["crm-social-sandbox-deployment.css"],ResourceConstants.CRMClient),c=r.concat(a).concat(l);Lyte.injectResources(c,void 0,(function(){Lyte.Component.render("crm-social-sandbox-deployment-success-pop",{deployCompletedModal:!0,deploymentSuccess:!0},"body"),localStorage.setItem("socialDeployed_"+Crm.userDetails.ZGID,!1)}))}else"deployment_failed"===e.action&&Lyte.injectResources(c,void 0,(function(){Lyte.Component.render("crm-social-sandbox-deployment-success-pop",{deployCompletedModal:!0,deploymentSuccess:!1},"body"),localStorage.setItem("socialDeployed_"+Crm.userDetails.ZGID,!1)}))}if("social_deployment_inprogress"===e.action&&localStorage.setItem("social_inprogress_"+e.zgid,!0),"social_deployment_completed"===e.action&&localStorage.setItem("social_inprogress_"+e.zgid,!1),e.tabsUsedInWizards)Crm.userDetails.tabsUsedInWizards=e.tabsUsedInWizards;else{if("available_menu"===e.type)Crm.userDetails.available_menu=e.available_menu;else{if("territory_cache_clear"===e.type&&!$L("crm-territory-hierarchy").length&&!$L("crm-territory-rules").length){if(store.unloadAll("territory"),(Wi=$L("crm-assign-territory-detail-view"))&&Wi[0]){var d=(Wi=Wi[0]).component.getData("seid"),u=Wi.component.getData("module");store.findAll(moduleRecordMapping[u].id,{ids:d,approved:"both"},!1,!1).then((function(t){var i={},o=moduleRecordMapping[u].id;i="Potentials"===e.module?t[o][0].Territory:t[o][0].Territories,Collaboration.handleTerritoryUpdateInDetailView(t[o][0].id,u,i)}))}return}if("territory_settings_cache_clear"===e.type){store.unloadAll("territory_configuration"),null!=(di=e.message)&&(At=JSON.parse(di)).tm_enabled&&(Crm.userDetails.TMENABLED=At.tm_enabled)}else{if("entity_territory_assign"===e.type)return void(1===Crm.userDetails.TMENABLED&&setTimeout((function(){var t=Lyte.Router.getRouteInstance().transition.info,i=t.dynamicParams[1],o=t.dynamicParams[0],n=store.peekRecord(moduleRecordMapping[e.module].id,i);if(("crm.tab.module.entity.canvas"===t.route||"crm.tab.module.entity.detail"===t.route)&&e.module===o&&e.record_Id===i){var s=$L("crm-assign-territory-detail-view");s&&s[0]&&(s=s[0],Collaboration.handleTerritoryUpdateInDetailView(i,o,e.territories))}"manual_assign_remove"===e.trigger_source&&(o=e.module,n?Collaboration.handleTerritoryWMSPopup(n,o):(store.model[moduleRecordMapping[o].id]||store.registerModel(moduleRecordMapping[o].id,{},{extends:"entity"}),store.findRecord(moduleRecordMapping[o].id,e.record_Id).then((function(e){e&&e[0]&&Collaboration.handleTerritoryWMSPopup(e[0],o)}))))}),500));if("bulk_operation_based_on_filter"===e.type){var m=networkUtils.returnDependencyFiles(["crm-recyclebin-notification-popup.js"],ResourceConstants.CRMClient),p=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recyclebin")],ResourceConstants.CRM);m=m.concat(p),Lyte.injectResources(m,void 0,(function(){var t=$L("crm-recyclebin-notification-popup");0===t.length&&t.push(Lyte.Component.render("crm-recyclebin-notification-popup",{},"body")),t[0].component.setData("showNotificationPopup",!0),t[0].component.setData("status",e.status),t[0].component.setData("operation",e.operation)}))}}}if("API_CREDITS_LIMIT_REACHED"===e.type){var g=networkUtils.returnDependencyFiles(["api-usage-wms-msg.js"],ResourceConstants.CRMClient);g=(g=g.concat(networkUtils.returnDependencyFiles(["api-usage-wms-msg.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom-api-usage-inproduct-notification")],ResourceConstants.CRM)),Lyte.injectResources(g,void 0,(function(){Lyte.Component.render("api-usage-wms-msg",{usagePercentage:e.message},document.body)}))}if("storage_limit_reached"===e.type){var f=networkUtils.returnDependencyFiles(["datastorage.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")],ResourceConstants.CRM);c=f.concat(h).concat(y);Lyte.injectResources(c,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"wms"},"#mics_tipDiv")}))}else if("refresh_storage"===e.type)Crm.userDetails.isStorageLimitReached=e.isLimitExceed,Crm.userDetails.data_storage=e.storage_details;else if("refresh_storage_rb"===e.type)Crm.userDetails.isStorageLimitReached=e.isLimitExceed,Crm.userDetails.data_storage=e.storage_details,_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.entity.update.success","Data storage")}});else if("storage_limit_reached_for_current_user"===e.type){f=networkUtils.returnDependencyFiles(["datastorage.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")],ResourceConstants.CRM),c=f.concat(h).concat(y);Lyte.injectResources(c,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"Sheet"},"#mics_tipDiv")}))}if("ScoreCalculation"===e.type)ct=(ct=(ct=networkUtils.returnDependencyFiles(["scoring_notification.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringnotification")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["scoring_notification.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(ct=ct.concat(networkUtils.returnDependencyFiles(["scoring_notification_rtl.css"],ResourceConstants.CRMClient))),Lyte.injectResources(ct,void 0,(function(){var t=JSON.parse(e.message),i=I18n.getMsg("score.updated.text",[t.totalCount,moduleRecordMapping[t.moduleLabel].plural_label]);Lyte.Component.render("crm-score-notification",{title:I18n.getMsg("score.completed.notificaition"),message:i,showModal:!0},"body")}));if("Cadences"===e.type){y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("serieswms")],ResourceConstants.CRM);Lyte.injectResources(y,void 0,(function(){document.querySelector("#crmLyteMsgBox").ltProp({type:"info",message:I18n.getMsg("crm.series.deletion.wms.pop",""),show:!0,duration:"5000"})}))}else"ScoringRule_Cache_Clear"===e.type&&Lyte.Router.getRouteInstance().transition.info.route.includes("crm.tab.module")&&store.unloadAll("scoring_rule");if("gcalsync_notification"===e.type&&document.querySelector("lyte-messagebox").ltProp({type:"info",message:I18n.getMsg("crm.gcal.sync.paused",""),show:!0,duration:"5000"}),"deactivated"==e.type){var v="object"==typeof e.userids?e.userids:JSON.parse(e.userids);Search.bulkJsonUpdate(v,"DISABLED"),$("[name='ownerNameLookup']").each((function(){$(this),$(this).attr("id");for(var e=$(this).data("fieldname"),t=$(this).find("ul").find('span[name="ownerType"]'),i=$(this).find("ul").find('span[name="ownerType"]').length,o=0;o<v.length;o++){var n=v[o];if(i){var s=document.getElementById(e+"_"+n);$("#"+e+"_"+n).remove(),$(t).eq(1).after(s),Search.assignClick(e,n)}else $("#"+e+"_"+n).remove()}if(i){var r=$(t).eq(1).nextAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(t).eq(1).after(r)}}))}else if("workdrive_enabled"===e.type){if(!Crm.isWMSNotifictionForCurrentOrg(e))return;if(!e)return;if(null!==Lyte.Router.getRouteInstance().parent.getDynamicParam()&&"Documents"===Lyte.Router.getRouteInstance().parent.getDynamicParam()){var C=document.querySelector("crm-content-libraries").component;C.processAndLoadContentLibraryPage.call(C),store.findAll("workdrive-conf")}else null!==Lyte.Router.getRouteInstance()&&"storage"===Lyte.Router.getRouteInstance().routeName&&(crmui.showMsgBand("success",I18n.getMsg("crm.workdrive.integ.success"),3e3),Utils.windowLocationReload(!0))}else if("wd_attachments_upload"===e.type){var w=$L("#"+e.uploadId).find(".dz-error-message")[0];if("D9222"===e.statusCode&&w.setAttribute("lt-prop-title","Sorry, you can't upload files as you have been restricted to do so. Please contact your administrator."),"D9211"===e.statusCode&&w.setAttribute("lt-prop-title","Sorry, you can't upload files as your organization has exceeded its maximum limit. Please contact your administrator."),"D9221"===e.statusCode&&w.setAttribute("lt-prop-title","Sorry, you can't upload files as you have exceeded the maximum limit available allocated for you. Please contact your administrator."),!Crm.isWMSNotifictionForCurrentOrg(e))return;if(e.module&&"LiveDesk"===e.module&&networkUtils.loadFeatureScripts(["zohocrm_visitshome.js"],["CrmTracking.js","CrmTrackingTemplates.js"],(function(){CrmTracking.handleVisit(e),crmNTCWms.updateEntityStatus()}),"object"==typeof CrmTracking),!e)return;"string"==typeof e&&(e=JSON.parse(e));var b=null;for(var _ in e){var M;if(e.hasOwnProperty(_))if((M=e[_])&&"string"==typeof M&&M.startsWith("BATCH_")){b=M;break}}if(b){var A=$("#"+b).data(b);A&&A(e)}}else if("Lookupvalue_update"===e.type||"mxnclonescheduler"===e.type)setTimeout((function(){var t=e.seType,i=(Crm.moduleInfo[t].singularLabel,"<li class='m0 p20'><span class='crmLabelColor'>"+e.msg+"</span></li>"),o=$("#ztinotifier").find("#mxnclonewmsmsg");if(o.length>0){var n=o.find("ul"),s=n.find("li");s.length>5&&s[5].remove(),n.prepend(i)}else{var r="<div class='pickListCont dIB bg_white newPopup bottom_30 right0 mergeduplicaterecord' id='mxnclonewmsmsg' style='width:500px'>"+("<div class='crm-subheading-font-size  crm-font-regular pR fontSmooth crmWhiteColor dField-notifier-header'>"+e.msgtitle+"<span class='pA dIB svgIconsImg migCardClose ico-close-white-small2 cP' onclick='$(\"#mxnclonewmsmsg\").remove();'></span></div>")+("<div id='mergecomplete' style='max-height:500px; overflow:auto;'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'>"+i+"</ul></div></div></div>");Notifier.construct(r)}if($("#ztinotifier").css({width:"475"}),Notifier.slider.setHeightParams(0,105,0,0),Notifier.slider.down("ztinotifier"),detailView&&detailView.entityId&&detailView.entityId===e.entityid)if(Crm.userDetails.isRelatedListLyteEnabled)Lyte.triggerEvent("relatedList",{id:e.relid});else{var a={};a.id=e.entityid,a.rid=e.relid,a.actModule=e.parentmodule,a.module=e.parentmodule,a.actId=e.entityid,a.pname=crmRelatedList.EachModuleData[e.relid]?crmRelatedList.EachModuleData[e.relid].name:void 0,a.isSortRequest=!1,Lyte.triggerEvent("relatedList",{id:a.rid}),crmRelatedList.ajaxReq(a)}}),2e3);else if("MXN_LEAD_CONVERT_ERROR"===e.type){for(var I="<div class='pickListCont dIB bg_white newPopup bottom_30 right0 mergeduplicaterecord' id='mxnclonewmsmsg' style='width:500px'>",L="<div class='crm-subheading-font-size  crm-font-regular pR fontSmooth crmWhiteColor dField-notifier-header'>MXNField cannot be converted<span class='pA dIB svgIconsImg migCardClose ico-close-white-small2 cP' onclick='$(\"#mxnclonewmsmsg\").remove();'></span></div>",R="",k=e.error,S=k.length,T=0;T<S;T++)R=R+'<br><div class="w100_per p10"><div class="w50_per fL p10 crmLabelColor" style="text-align: center;">'+k[T].module_label+'</div><span class="primarybtn" onclick="multiLookupsView.LinkingModuleExport(\''+k[T].module_sysrefname+"','"+k[T].ids+"')\">Export</span></div>";var D=I+L+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'><li class='m0 p20'><span class='crmLabelColor'>Some of the MXNField records cannot be coverted and the corrosponding records can be exported below</span>"+R+"</li></ul></div></div></div>");Notifier.construct(D)}else if("MXN_LEAD_CONVERT"===e.type){if(Crm.userDetails.isRelatedListLyteEnabled)for(T=0;T<E;T++)Lyte.triggerEvent("relatedList",{id:N[T]});else if(void 0!==crmRelatedList){var P={},N=e.relid.split(";"),E=N.length,x="";for(T=0;T<E;T++)void 0!==crmRelatedList.EachModuleData[N[T]]&&(x=x+crmRelatedList.EachModuleData[N[T]].name+";");P.pname=x,P.id=crmRelatedList.EntityId,P.module=crmRelatedList.Module,""!==x&&crmRelatedList.ajaxReq(P)}}else if("Mass_Transfer_Scheduler"===e.type){u=e.seType;var F=Crm.moduleInfo[u].translatedSingularLabel;D=(I="<div class='pickListCont dIB bg_white newPopup bottom_30 right0 mergeduplicaterecord' id='pickListCont'>")+(L="<div class='crm-subheading-font-size  crm-font-regular pR fontSmooth crmWhiteColor dField-notifier-header'>"+I18n.getMsg("crm.permission.mass.transfer.headerMsg",F)+"<span class='notifier-minimize-icon cP pA dIB right30 top0 p5' onclick='$(\"#pickListCont\").hide();'></span></div>")+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'><li class='m0 p20'><span class='crmLabelColor'>"+I18n.getMsg("crm.permission.mass.transfer.completed.msg")+"</span></li></ul></div></div></div>");Notifier.construct(D);var U=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,U,0,0),Notifier.slider.down("ztinotifier")}else if("UF_SCHEDULER_PROGRESS"===e.type){var O=$L("#wmsstatusbar")[0];if(O&&!O.querySelector("#uqProgressIconDiv"))(Ei=document.createElement("td")).setAttribute("id","uqProgressIconDiv"),Ei.setAttribute("class","pR"),(xi=document.createElement("div")).setAttribute("class","cP pR crm-wms-icon pT5 w40"),xi.setAttribute("onclick","cruxSchedularPopup.showOrHideSchedularPopup('uniqueFieldPopup')"),(Fi=document.createElement("span")).setAttribute("class","svgIcons encProgressIcon activeProgress dIB"),xi.append(Fi),Ei.append(xi),O.querySelector("tr").prepend(Ei);(Yi=networkUtils.returnDependencyFiles(["crux-schedular-notification.js"],ResourceConstants.CRMClient)).pushUniqValues(networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)[0]),Lyte.injectResources(Yi,void 0,(function(){var t=[],i={},o="uniqueFieldPopup",n=$ESAPI.encoder().encodeForHTML(e.module);i.cxMessageYield=!0,i.cxAddMessage=!0,i.cxStatus="progress",i.cxMessage=I18n.getMsg("crm.unique.field.progress.message",n),i.cxClass="uniquePopupMsg_"+e.id,t.push(i);var s=document.getElementsByClassName("uniqueFieldPopup");null!=s&&s.length>0?_cruxUtils.showSchedularNotification({params:{cxPropHeader:I18n.getMsg("crm.unique.field.progress.headerMessage"),cxPropMessage:t,cxPropPreventCloseOnTimeout:!0,cxPropShowMinimizeIcon:!0,cxPropClass:"uniqueFieldPopup",cxPropPreventCloseOnTimeout:!0},cxRemoveNotification:!1,cxAddMessage:!0,onClose:function(e,t){cruxSchedularPopup.closeOrMinimizePopup(o,O,t,e)}}):_cruxUtils.showSchedularNotification({params:{cxPropHeader:I18n.getMsg("crm.unique.field.progress.headerMessage"),cxPropMessage:t,cxPropPreventCloseOnTimeout:!0,cxPropShowMinimizeIcon:!0,cxPropClass:"uniqueFieldPopup",cxPropPreventCloseOnTimeout:!0},cxRemoveNotification:!1,onClose:function(e,t){cruxSchedularPopup.closeOrMinimizePopup(o,O,t,e)}})}))}else if("UF_SCHEDULER"===e.type){D=(I="<div class='pickListCont dIB bg_white newPopup bottom_30 right0 mergeduplicaterecord' id='pickListCont' style='width:300px'>")+(L="<div class='crm-subheading-font-size crm-font-regular pR fontSmooth crmWhiteColor dField-notifier-header'>"+I18n.getMsg("crm.unique.field.progress.headerMessage")+"<span class='whiteCloseIcon ico-close-white-small2 pA dIB svgIcons right10  top13 cP' onclick='$(\"#pickListCont\").hide();'></span></div>")+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'><li class='m0 p20'><span class='crmLabelColor'>"+I18n.getMsg("crm.unique.field.restricted.message")+"</span></li></ul></div></div></div>"),U=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,U,0,0),Notifier.slider.down("ztinotifier"),Notifier.construct(D)}else if("UF_SCHEDULER_SUCCESS"===e.type){(Yi=networkUtils.returnDependencyFiles(["crux-schedular-notification.js"],ResourceConstants.CRMClient)).pushUniqValues(networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)[0]),Lyte.injectResources(Yi,void 0,(function(){var t,i,o,n=[],s={},r=e.successCount,a=e.totalCount,l=$ESAPI.encoder().encodeForHTML(e.module),c=$ESAPI.encoder().encodeForHTML(e.successFieldLabel),d=$ESAPI.encoder().encodeForHTML(e.failureFieldLabel);0===r?(o=I18n.getMsg("crm.unique.field.partially.success.message",[r,a,l]),t="failure",i="zcicn-cssIcons zcicn_red_mask zcicncss-warning-rounded"):r===a?(o=I18n.getMsg("crm.unique.field.success.message",[l]),t="Completed",i="zcicncss-tickrounded zcicn-cssIcons zcicn_lightGreen_mask"):(o=I18n.getMsg("crm.unique.field.partially.success.message",[r,a,l]),t="Completed",i="zcicncss-warning-triangle zcicn-cssIcons zcicn_sandal_mask mT2");var u="viewInfo_"+e.id,m="viewInfoDataUq_"+e.id,p="<div class='mT10 crmLinkColor tdUnderline cP'><a href='javascript:void(0)' id = '"+u+"' onclick='$(\"#"+m+'").show();$("#'+u+'").hide();$L("#cruxSchedularPopup lyte-modal")[0].alignModal()\'>View Info</a></div>';if(null!==d&&null===c)o=o+p+("<div class='br6 br_border3 mT10 p12 uf_infoSection crm-extra-small-font-size' id = '"+m+"'style='display: none;'><div class='crmLabelColor'>"+I18n.getMsg("crm.unique.field.failed.headerMessage")+"</div><div class='mT5'>"+d+"</div></div>");else if(null===d&&null!==c){o=o+p+("<div class='br6 br_border3 mT10 p12 uf_infoSection crm-extra-small-font-size' id = '"+m+"' style='display: none;'><div class='crmLabelColor'>"+I18n.getMsg("crm.unique.field.success.headerMessage")+"</div><div class='mT5'>"+c+"</div></div>")}else{o=o+p+("<div class='br6 br_border3 mT10 p12 uf_infoSection crm-extra-small-font-size' id = '"+m+"' style='display: none;'><div class='crmLabelColor'>"+I18n.getMsg("crm.unique.field.success.headerMessage")+"</div><div class='mT10'>"+c+"</div><div class='mT10 crmLabelColor'>"+I18n.getMsg("crm.unique.field.failed.headerMessage")+"</div><div class='mT10 crmNegativeColor'>"+d+"</div></div>")}var g=o,f="uniquePopupMsg_"+e.id;s.cxStatus=t,s.cxIconClass=i,s.cxMessageYield=!0,s.cxAddMessage=!0,s.cxMessage=g,s.cxIcon=!0,s.cxCloseIconClass="zcicncss-close-rounded zcicn-cssIcons";var h=_cruxUtils.getSchedularNotificationData().filter((e=>"uniqueFieldPopup"===e.class))[0];if(h)for(var y=h.messages,v=y.length,C=0;C<v;C++){y[C].cxClass===f&&(Lyte.arrayUtils(y,"insertAt",C+1,s),Lyte.arrayUtils(y,"removeAt",C,1))}else{var w=$L("#wmsstatusbar")[0];if(w&&!w.querySelector("#uqProgressIconDiv")){var b=document.createElement("td");b.setAttribute("id","uqProgressIconDiv"),b.setAttribute("class","pR");var _=document.createElement("div");_.setAttribute("class","cP pR crm-wms-icon pT5 w40"),_.setAttribute("onclick","cruxSchedularPopup.showOrHideSchedularPopup('uniqueFieldPopup')");var M=document.createElement("span");M.setAttribute("class","svgIcons encProgressIcon activeProgress dIB"),_.append(M),b.append(_),w.querySelector("tr").prepend(b)}n.push(s),_cruxUtils.showSchedularNotification({params:{cxPropHeader:I18n.getMsg("crm.unique.field.progress.headerMessage"),cxPropMessage:n,cxPropPreventCloseOnTimeout:!0,cxPropShowMinimizeIcon:!0,cxPropClass:"uniqueFieldPopup",cxPropPreventCloseOnTimeout:!0},cxRemoveNotification:!1,cxAddMessage:!0,onClose:function(e,t){cruxSchedularPopup.closeOrMinimizePopup("uniqueFieldPopup",w,t,e)}})}}))}else if("delete"===e.type){var j=e.id;if(void 0!==InfoForDisplay){var B=JSON.parse(InfoForDisplay);for(T=0;T<B.length;T++)B[T].id==j&&B.splice(T,1);InfoForDisplay=JSON.stringify(B)}if(void 0!==InfoForDisplayWithLiteUsers){var z=(B=JSON.parse(InfoForDisplayWithLiteUsers)).length;for(T=0;T<z;T++)B[T].id===j&&B.splice(T,1);InfoForDisplayWithLiteUsers=JSON.stringify(B)}Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){$(this).attr("id");var e=$(this).data("fieldname");$("#"+e+"_"+j).remove()}))}else if("activated"==e.type){v="object"==typeof e.userids?e.userids:JSON.parse(e.userids);Search.bulkJsonUpdate(v,"ACTIVE"),$("[name='ownerNameLookup']").each((function(){for(var e=$(this),t=($(this).attr("id"),$(this).data("fieldname")),i=$(this).find("ul").find('span[name="ownerType"]'),o=$(this).find("ul").find('span[name="ownerType"]').length,n=0;n<v.length;n++){var s=v[n],r=document.getElementById(t+"_"+s);if(o)$("#"+t+"_"+s).remove(),$(i).eq(1).before(r),Search.assignClick(t,s);else{var a=JSON.parse(InfoForDisplay),l=Search.getJsonObj(a,s),c=l[0].plainName+","+l[0].email,d="<li class='active-result' name='single-select' id="+t+"_"+s+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(c)+"' data-id="+s+" style='vertical-align:bottom;margin-top:7px;'><img src="+l[0].avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(l[0].plainName)+"</span> <span class='crmNotFoundColor' style='vertical-align:bottom; margin-left: -42px;'>"+$ESAPI.encoder().encodeForHTML(l[0].email)+"</span></li>";$(this).find("ul").append(d)}}if(o){var u=$(i).eq(1).prevAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(i).eq(1).before(u)}else{u=$(e).find("ul li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(this).find("ul").find("li").remove(),$(this).find("ul").append(u),Search.assignClick(t)}}))}else if("edit"==e.type){j=e.id;var V=Crm.userDetails.NAME_FORMAT,H=e.email;if(V.indexOf("First")<V.indexOf("Last"))var J=(0==e.firstName.length?"":e.firstName+" ")+e.lastName;else J=(0==e.lastName.length?"":e.lastName+" ")+e.firstName;var W=J+","+e.email;if(void 0!==InfoForDisplay){for(B=JSON.parse(InfoForDisplay),T=0;T<B.length;T++)if(B[T].id==j){B[T].plainName=J,B[T].name=J,B[T].firstName=e.firstName,B[T].lastName=e.lastName;break}InfoForDisplay=JSON.stringify(B)}if(void 0!==InfoForDisplayWithLiteUsers){for(z=(B=JSON.parse(InfoForDisplayWithLiteUsers)).length,T=0;T<z;T++)if(B[T].id===j){B[T].plainName=J,B[T].name=J,B[T].firstName=e.firstName,B[T].lastName=e.lastName;break}InfoForDisplayWithLiteUsers=JSON.stringify(B)}Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){$(this).attr("id");var e=$(this).data("fieldname");$("#"+e+"_"+j).attr("username",W),$("#"+e+"_"+j).find("span").eq(0).html($ESAPI.encoder().encodeForHTML(J)),$("#"+e+"_"+j).find("span").eq(1).html($ESAPI.encoder().encodeForHTML(H))})),null!=e.TIME_ZONE&&Crm.userDetails.USER_ID==j&&(Crm.userDetails.TIME_ZONE=e.TIME_ZONE),null!=e.time_zone&&Crm.userDetails.USER_ID==j&&(Crm.userDetails.USER_TIME_ZONE=e.time_zone,Crm.userDetails.TIME_ZONE=e.offset)}else if("massmailStatsReport"==e.type){(Co=window.location.pathname)===Crm.getCrmBasePath()+"/ViewMassMail.do"&&MassMailUnificationUtil.reLoadPageForStatsUpdate()}else if("user"==e.type){var K=e.isLiteUser;if(void 0!==InfoForDisplay&&!K)(B=JSON.parse(InfoForDisplay)).push(e),InfoForDisplay=JSON.stringify(B);if(void 0!==InfoForDisplayWithLiteUsers&&K)(B=JSON.parse(InfoForDisplayWithLiteUsers)).push(e),InfoForDisplayWithLiteUsers=JSON.stringify(B);Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){var t=$(this).attr("id"),i=Crm.userDetails.NAME_FORMAT;if(i.indexOf("First")<i.indexOf("Last"))var o=(0==e.firstName.length?"":e.firstName+" ")+e.lastName;else o=(0==e.lastName.length?"":e.lastName+" ")+e.firstName;var n=o+","+e.email,s=$(this).find("ul").find('span[name="ownerType"]'),r=$("#"+t).find("ul").find('span[name="ownerType"]').length,a=$(this).data("fieldname"),l="<li class='active-result' name='single-select' id="+a+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom;margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='crmNotFoundColor' style='vertical-align:bottom; margin-left: -42px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>";e.id;if(r){var c;$(s).eq(1).before("<li class='active-result' name='single-select' id="+a+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom; margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='crmNotFoundColor' style='vertical-align:bottom; margin-left:-86px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>");for(var d=$(s).eq(1).prevAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1})),u=0;u<d.length;u++){var m=a+"_"+e.id;if($(d[u]).attr("id")===m){$("#"+a+"_"+e.id).remove();break}}c=u;var p=$(s).eq(1).prevAll("li").length;$(s).eq(1).prevAll("li").eq(p-c).after("<li class='active-result' name='multi-select' id="+a+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom; margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='crmNotFoundColor' style='vertical-align:bottom; margin-left:-86px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>"),Search.assignClick(a,e.id)}else{$(this).find("ul").append(l);var g;for(d=$(this).find("ul li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1})),u=0;u<d.length;u++){m=a+"_"+e.id;if($(d[u]).attr("id")===m){$("#"+a+"_"+e.id).remove();break}}g=u,$(this).find("ul").find("li").eq(g-1).after(l),Search.assignClick(a,e.id)}}))}else if("manualEnrollment"===e.type||"manualUnenrollment"===e.type){ct=(ct=(ct=networkUtils.returnDependencyFiles(["scoring_notification.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CadenceOffloadWMSNotification")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["scoring_notification.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(ct=ct.concat(networkUtils.returnDependencyFiles(["scoring_notification_rtl.css"],ResourceConstants.CRMClient))),Lyte.injectResources(ct,void 0,(function(){var t="crm.entity.enrolled",i="crm.title.enrollment";"manualUnenrollment"===e.type&&(t="crm.entity.unenrolled",i="crm.title.unenrollment"),Lyte.Component.render("crm-score-notification",{title:I18n.getMsg(i),message:I18n.getMsg(t),showModal:!0},"body")}))}else if("ZRFieldUpdated"===e.type||"ZRFieldUpdateFailed"===e.type||"ZRFieldUpdateFailed_MinRecords"===e.type||"ZRFieldUpdateFailed_SingleUser"===e.type){var q=Lyte.Router.getRouteInstance().routeName,G=$L("crm-assignmentrules-zia-reasoning")[0];if("zia-reasoning"===q){if(Lyte.Router.getRouteInstance().getQueryParams().module!==e.module)return;G.setData("showMessageBox",!1);var Z="error";D=I18n.getMsg("crm.ziareasoning.fields.update.failure");switch(G.setData("updated_module",void 0),G.setData("isSuccess",!1),e.type){case"ZRFieldUpdated":D=I18n.getMsg("crm.ziareasoning.model.generation.success"),Z="success",G.setData("isSuccess",!0),G.setData("updated_module",e.module);break;case"ZRFieldUpdateFailed_MinRecords":D=I18n.getMsg("crm.ziareasoning.min.records.unreached.failure");break;default:D=I18n.getMsg("crm.ziareasoning.fields.update.failure")}G.setData("messageType",Z),G.setData("message",D),G.setData("showMessageBox",!0),"ZRFieldUpdated"!==e.type&&setTimeout((function(){G.setData("showMessageBox",!1),Lyte.Router.getRouteInstance().refresh()}),3e3)}}else if("updateChatUserAndChannelList"===e.type)"undefined"!=typeof chatIntegration&&(chatIntegration.userList=e.users,chatIntegration.channelsList=e.channels);else if("dontShowTaskClosePopup"===e.type)Crm.handleDontShowTaskClosePopup();else if("emailParser"===e.type)networkUtils.loadFeatureScripts(["zohocrm_emailParser.js"],(function(){mailparser.loadContentViaEmail(e.Content)}));else if("UserLayout"===e.type){var Y=$L(".cxUserAddEditModal");Y&&Y.is(":visible")&&(Y.find(".lyteModal").scrollTop(0),$("#cxUserLayoutRefLnk").show())}else if("WorkFlow"===e.type){var X=e.jobId,Q=!0,ee=e.isPageRefreshingNeeded,te=e.isProcessFlow,ie=$L("crm-change-owner"),oe=!(!(ie[0]&&ie.find("lyte-modal")[0].getData("ltPropShow"))||"entity"!==Lyte.Router.getRouteInstance().parent.routeName||"canvas"!==Lyte.Router.getRouteInstance().routeName),ne=!1,se=Crm.renderDVLyteFlow(u,!0),re=Lyte.Router.getRouteInstance().transition.info;if(se&&!e.isBulkWorkFlow){po="crm.tab.module.entity.canvas"===re.route?$L("crm-detailview-canvas")[0]:$L("crm-detail-view")[0];var ae=Lyte.registeredMixins["crm-detailview-common-utils"];void 0!==po?ae.doSingleRecordWFKafkaHandling(e,X):setTimeout((function(){ae.doSingleRecordWFKafkaHandling(e,X)}),1e3)}else if(void 0===detailView&&window&&window.detailView&&(detailView=window.detailView),detailView.refreshInWms)Q=!1,null!=detailView.prevModule&&detailView.prevModule==detailView.currentModule||detailView.singleRecordLyteOffloading||detailView.approvalCaseOffloading||detailView.refreshCanvasView||ee?(detailView.approvalCaseOffloading&&(detailView.approvalCaseOffloading=!1),Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):detailView.refreshPageForSingleRecordWorkFlow(e)):(detailView.refreshInWms=!1,clearTimeout(automationActionsNotificationScheduler.singleRecordOffloadTimeout));else if(oe&&detailView.isSingleRecordChangeOwnerPopupLoading)detailView.isSingleRecordChangeOwnerPopupLoading=!1,Q=!1,ne=!0,Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):detailView.callLyteRefresh();else if(e.entityId==detailView.entityId&&ee&&!e.isBulkWorkFlow)detailView.singleRecordLyteOffloading||!te?(te||(detailView.isRecordConverted=!0),Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):detailView.callLyteRefresh(),detailView.singleRecordLyteOffloading=!1):te&&$("#pb_processButtonLayerInner").length>0?Handlebars.templates.ProcessPreviewPop?Lyte.injectResources([networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM)],void 0,(function(){ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray)})):Lyte.injectResources([networkUtils.returnDependencyFiles(["transitionButtonLayer.js","processPreviewPop.js","zohocrm_ProcessFlow.js"],ResourceConstants.CRM)[0]],void 0,(function(){ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray)})):Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):reloadCurrentEntityView(detailView.entityId,detailView.currentModule);else if(e.isBulkWorkFlow&&(detailView.isMassupdatePopupLoading||$L("#updateConsenttype").length>0||$("#macroFieldUpdate").length>0||$("#changeOwnerForm").length>0||oe||ee)){detailView.isMassupdatePopupLoading&&(detailView.isMassupdatePopupLoading=!1),refreshPageForBulkWorkFlowScheduler(e);var le=$L("crm-field-update")[0],ce=ie[0];if(le&&le.getData("showModal"))if((Tt=le.component).setData("showModal",!1),"crm.tab.module.actions.mass-tools"===Lyte.Router.getRouteInstance().transition.info.route)$L("crm-mass-tools")[0].component.onComplete(Tt.mUpdateResData,!0,"update");else{Lyte.registeredMixins["crm-mass-action-mixin"].handleUpdateSuccess(Tt.mUpdateResData,Tt,(function(e){e.clearSelection(),e.reloadCurrentView(Tt.getData("module"))}))&&Lyte.registeredMixins["crm-view-utils"].reloadCurrentView(Tt.getData("module")),clearTimeout(automationActionsNotificationScheduler.massUpdateOffloadTimeout)}else ce&&$L("lyte-modal",ce)[0].getData("ltPropShow")&&(ce.component.handleChangeOwnerSuccess(),clearTimeout(automationActionsNotificationScheduler.changeOwnerOffloadTimeout));Q=!1}if(ee&&!ne&&(Q=!0),!se)if(-1!==(ro=detailView.currWFOffloadingJobIds.indexOf(X))&&(detailView.currWFOffloadingJobIds.splice(ro,1),0===detailView.currWFOffloadingJobIds.length&&Q)){$("#automationSchNotificationPopup").remove();var de=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("automationActionsNotification")],ResourceConstants.CRM);Lyte.injectResources(de,void 0,(function(){var e={};e.message=I18n.getMsg("crm.automation.workflow.notification.completed.message"),e.status="success",automationActionsNotificationScheduler.addOrUpdateWFPopupStatus(e,I18n.getMsg("crm.automation.workflow.notification.completed.title"))}))}}else if("updateRollupSummary"===e.type&&null!=Lyte.registeredMixins["crm-detail-view-utils"])Lyte.registeredMixins["crm-detail-view-utils"].refreshRollupSummary(e.module,e.entityId,e.updatedFields);else if("autoEnrich"===e.type){let t=e.response?e.response:null;if("scrapy_callback"===e.enrich_type){const e=t&&t.status?t.status:null,i=Lyte.registeredMixins["enrichment-utils"];let o=$L("crm-data-enrichment")[0];if(o=o&&o.component?o.component:void 0,o&&i&&t.id&&t.id===store.peekAll("zia_data_enrichment")[0].id)if("COMPLETED"===e){let e=i.flattenObjectWithParent(i.parseEnrichResponse(t.enriched_data));Object.keys(e).forEach((function(i){"id"===i?t.data_id=e[i]:t[i]=e[i]})),delete t.enriched_data,o.setData({enriched_data:t,enrichRunning:!1})}else o.setData({enriched_data:null,enrichRunning:!1})}else if("people_extension"===e.enrich_type){const e=store.peekRecord("data_enrichment_count","1");e&&e.$.set("people_enrichment",t.status);const i=store.peekAll("data_enrichment");i&&i.filter((e=>"personal"===e.type)).forEach((e=>e.$.set("status",t.status)))}}else if("datamodel"===e.type){let t=$L("crm-data-model")[0];if(t)t.setData("generation_in_progress",!1),e.data_model?(t.setData("is_model_generated",!0),t.setData("url",e.data_model[0].url)):t.setData("is_model_generated",!1);else if(e.show_popup&&e.data_model&&e.data_model[0].url){let t=networkUtils.returnDependencyFiles(["crux-schedular-notification.js"],ResourceConstants.CRMClient);t.pushUniqValues(networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)[0]),Lyte.injectResources(t,void 0,(function(){let t=I18n.getMsg("crm.datamodel.generation.completed.message")+" <br> <br>"+I18n.getMsg("crm.datamodel.pushnotify.toviewupdate"),i=I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.setup.system.datamodel");e=e=[{cxMessage:t,cxStatus:"success",cxMessageYield:!0,cxPropPreventCloseOnTimeout:!0}],_cruxUtils.showSchedularNotification({params:{cxPropHeader:i,cxPropMessage:e,cxPropClass:"aligncenter",cxPropPreventCloseOnTimeout:!0}})}))}null!==localStorage.getItem("datamodel_generated_user_id")&&localStorage.removeItem("datamodel_generated_user_id")}else if("recyclebin_range"===e.type)Crm.userDetails.CUSTOMIZE_INFO?Crm.userDetails.CUSTOMIZE_INFO.recyclebin_range=e.customize_info.recyclebin_range:Crm.userDetails.CUSTOMIZE_INFO=e.customize_info;else if("businessHoursStatus"===e.type&&"Enabled"===e.response){Crm.userDetails.isBusinessHoursCreated=!0;var ue=document.getElementById("showBHPopup");ue&&ue.ltProp("show",!1)}else if("OrgTimeZoneUpdate"===e.type)Crm.userDetails.ORGTIME_ZONE=e.ORGTIME_ZONE;else{if("zsurveyCampaign"===e.type){let t=Lyte.Router.getRouteInstance(),i=t&&t.transition&&t.transition.info&&t.transition.info.dynamicParams||{};if("detail"===t.routeName&&Crm.renderDVLyteFlow(i[0])){let t=$L("crm-detailview-content")[0].component||{},o=(t&&t.data&&t.data.surveyDetails&&t.data.surveyDetails.isSurveyEnabled||!1)&&t.data.record&&t.data.record||"";if((e&&e.campaignIds||[]).indexOf(o.id)>-1){let t=store.peekRecord(moduleRecordMapping[i[0]].id,i[1]);t[e.fieldApiName]=e.newValue,store.pushPayload(moduleRecordMapping[i[0]].id,t);let o=$L("crm-detail-view")[0].component.data.unique_listener_id;Lyte.triggerEvent("detail_view_listener_".concat(o),{update_recordReference:!0})}}else{var me=$('form[name="viewentityform"]').find("#module");me.length>0&&"Campaigns"===me.val()&&returnJson&&returnJson.Campaigns&&5===returnJson.Campaigns.CAMPAIGN_TYPE&&e.surveyId===returnJson.Campaigns.surveyId&&1===returnJson.Campaigns.surveyEnabled&&networkUtils.loadFeatureScripts(["zsurvey_home-min.js"],(function(){ZSurvey.handleSurveyWMSMessage(e)}))}return}if("crossorgnotification"===e.type)return void(Lyte.Router.getRouteInstance("crm.settings.section.extensions.zoho-extensions.crossorg")&&Lyte.Router.getRouteInstance().refresh());if("ZiaSmartPrompt"===e.type)Crm.userDetails.IS_SMART_PROMPT_AVAILABLE=e.status,Crm.userDetails.SMART_PROMPT_ACTIVE_LLM=e.activeLLM,void 0!==store.modelFor("smart_prompt_setup")&&"update"===e.method&&store.findAll("smart_prompt_setup");else if("ZiaRecordSummary"===e.type){var pe=e.status;Lyte.triggerEvent("ziaRecordSummaryEventHandler",{status:pe})}else if("ZiaDID"===e.type&&Lyte.Router.getRouteInstance("crm.settings.section.zia.vision.duplicate-image-detection")&&0!==Object.keys(Lyte.Router.getRouteInstance("crm.settings.section.zia.vision.duplicate-image-detection")).length)Lyte.Router.getRouteInstance().refresh();else if("ZiaCallAnalytics"===e.type||"ZiaCallTransaction"===e.type){if("ZiaCallTransaction"===e.type&&"update"===e.method){let t=$L("crm-zia-call-transcription")[0];t&&(moduleRecordMapping.Calls.isCallTranscriptionEnable=e.status,t.component.init())}void 0!==store.modelFor("zia_call_analytics_config")&&"update"===e.method&&store.findAll("zia_call_analytics_config",{type:"call_analytics",category:2}).then((function(){let e=$L("crm-zia-call-analytics")[0];e&&(0!==store.peekAll("zia_call_analytics_config").filter((e=>"call_analytics"!==e.type&&!0===e.enabled)).length&&store.unloadRecord("zia-insights",e.component.getData("entityId")),e.component.init())}))}else if("Similarity"===e.type){var ge=Lyte.Router.getRouteInstance("crm.settings.section.zia.similarity.list"),fe=Lyte.Router.getRouteInstance("crm.settings.section.zia.similarity.view");if(ge&&"DELETE"===e.method&&store.unloadRecord("similarity",e.config_id),fe){var he=fe.getDynamicParam();if("DELETE"===e.method){store.unloadRecord("similarity",e.config_id);var ye=$L("crm-similarity-detailedview")[0],ve=!1;ye&&(ve=ye.getData("isDeleteInProgress")),he===e.config_id&&!1===ve&&(Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")})}"PUT"===e.method&&store.findRecord("similarity",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)}))}}else{if("Recommendation"===e.type){var Ce=Lyte.Router.getRouteInstance("crm.settings.section.zia.recommendation.view"),we=Lyte.Router.getRouteInstance("crm.settings.section.zia.recommendation.index"),be=Lyte.Router.getRouteInstance("crm.tab.module.custom-view.list");if(we&&"delete"===e.method&&store.unloadRecord("recommendations",e.id),Ce){var _e=Ce.getDynamicParam();"delete"===e.method&&(store.unloadRecord("recommendations",e.id),_e===e.id&&(Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}))}if(moduleRecordMapping[e.api_name]&&(moduleRecordMapping[e.api_name].isRecommendationsEnable=e.isRecommendationsEnable,moduleRecordMapping[e.api_name].recommendationsDetailsJson&&(moduleRecordMapping[e.api_name].recommendationsDetailsJson.suggestion_type=e.suggestion_type)),be&&e.method&&("POST"===e.method||"PUT"===e.method)){var Me=e.api_name;if(moduleRecordMapping&&moduleRecordMapping[Me]){if(be.currentModel&&moduleApiMapping[be.currentModel.module]===Me){var Ae=$L("#customFilter")[0];!1===e.isRecommendationsEnable&&Ae&&Ae.setData("special_field",Ae.getData("special_field").filter((function(e){return"Recommendation"!==e.api_name})))}moduleRecordMapping[Me].isRecommendationsEnable=e.isRecommendationsEnable,moduleRecordMapping[Me].recommendationsDetailsJson.suggestion_type=e.suggestion_type;var Ie=$L("#option_Recommendation")[0];if(Ie){var Le=e.suggestion_type,Re={};Le.first_buy&&Le.first_buy.enabled?Re.FirstTime={system:"FirstTime",display:Le.first_buy.label}:Re.FirstTime=void 0,Le.customer_also_bought&&Le.customer_also_bought.enabled?Re.Dependent={system:"Dependent",display:Le.customer_also_bought.label}:Re.Dependent=void 0,Le.frequently_bought_together&&Le.frequently_bought_together.enabled?Re.Bundle={system:"Bundle",display:Le.frequently_bought_together.label}:Re.Bundle=void 0,Le.rebuy&&Le.rebuy.enabled?Re.Repeat={system:"Repeat",display:Le.rebuy.label}:Re.Repeat=void 0,Le.next_buy&&Le.next_buy.enabled?Re.Sequence={system:"Sequence",display:Le.next_buy.label}:Re.Sequence=void 0,Ie.setData("recommendationBasedOnOption",Re)}store.findRecord("recommendations",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)})),Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0})}}return void(e.config_id&&(we||Ce||be)&&store.findRecord("recommendations",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)})))}if("Best_Time_To_Contact"===e.type){var ke=e.modules.length;for(T=0;T<ke;T++)moduleRecordMapping[e.modules[T]].best_time_data||(moduleRecordMapping[e.modules[T]].best_time_data={}),"isBestTimeEnabled"in e&&(moduleRecordMapping[e.modules[T]].best_time_data.isBestTimeEnabled=e.isBestTimeEnabled),"isBestTimeEnabledMail"in e&&(moduleRecordMapping[e.modules[T]].best_time_data.isBestTimeEnabledMail=e.isBestTimeEnabledMail),"isBestTimeEnabledCall"in e&&(moduleRecordMapping[e.modules[T]].best_time_data.isBestTimeEnabledCall=e.isBestTimeEnabledCall)}else if("prediction_smart_filter"===e.type){var Se=e.predictionFilterData[0],Te=moduleRecordMapping[e.module].prediction_details;if(moduleRecordMapping[e.module].isPredictionEnabled=!0,Te){E=Te.length;var De=!1;for(T=0;T<E;T++)Te[T]&&Te[T].id&&Se&&Se.id&&Te[T].id===Se.id&&(De=!0);De||moduleRecordMapping[e.module].prediction_details.push(Se)}else moduleRecordMapping[e.module].prediction_details=[],moduleRecordMapping[e.module].prediction_details.push(Se)}else if("Next_best_action"===e.type){var Pe=document.querySelector("crm-nba-detail-page"),$e=document.querySelector("crm-nba-canvas-detail-page"),Ne=e.module?["Deals","Potentials"].contains(e.module)?"Potentials":e.module:"Potentials",Ee=null!==$e&&$e.component.getData("record").id===e.recordId||"undefined"!=typeof returnJson&&void 0!==returnJson&&returnJson[Ne]&&returnJson[Ne].entityid===e.recordId,xe=$("#nbaDetails");if(Pe&&Ee&&xe){var Fe=e.time;if($L.moment(Fe).toDate()-($L.moment().toDate().getTime()+6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE))<=0)Pe.component.setData("is_nba_available",!1);else{var Ue={},Oe={type:"next_best_action"},je={};je.id=e.id,je.feature="nbx",je.mentioned_info=void 0;var Be={Calls:{action:"call",prefix:"Make a"},Events:{action:"meeting",prefix:"Arrange a"},Emails:{action:"email",prefix:"Send an"}},ze={},Ve=e.action;ze.via=Ve,ze.action_prefix=Be[Ve].prefix,ze.action=Be[Ve].action,ze.time=Fe,ze.time_prefix="with in",je.action_details=ze;var He=e.trigerAction;if(He){(Oi={}).type=He.type,"stage_change"===Oi.type?Oi.stage_info={from_stage:He.old_id,to_stage:He.entity.id}:Oi[Oi.type.toLowerCase()]=He.entity;var Je={};Je.time=He.time,Je.action=Oi,je.suggested_due_to=Je}else je.suggested_due_to=void 0;Oe.suggestion=je,Ue.next_best_action=Pe.component.getData("next_best_action"),Ue.output=Oe,Lyte.injectResources(networkUtils.returnDependencyFiles(["zia/nbx/crm-nba-mixins.js"],ResourceConstants.CRMClient),void 0,(function(){var t=Lyte.registeredMixins["crm-nba-utils"].getSuggestionData(Ue,Ne);Pe.component.setData("next_best_action",t.next_best_action),Pe.component.setData("is_nba_available",t.is_nba_available),Pe.component.setData("suggestion",t.suggestion),Pe.component.setData("duration",t.duration),Pe.component.setData("module",t.module),Pe.component.setData("currentmodule",Ne);var i="Leads"===Ne?"Leads":"Potentials";Pe.component.setData("currentrecord",null!==$e&&$e.component.getData("record").id===e.recordId?$e.component.getData("record"):{id:returnJson[i].entityid,name:returnJson[i].entityName}),Pe.component.setData("mentioneddetails",t.mentioned_details),Pe.component.setData("trigerobj",t.triger_obj),xe.show()}))}}}else if("ZiaVision"===e.type){var We=[];We.concat(networkUtils.returnDependencyFiles(["ziavision-notification-popup.js"],ResourceConstants.CRMClient)),Lyte.injectResources(We,void 0,(function(){Lyte.Component.render("crm-ziavision-notification-popup",{deletionMsg:e.message,title:e.title,visionName:e.vision_name},"body");var t=$L("crm-ziavision-notification-popup")[0];t.component.setData("classData","pFixed schedularProgress-pop schedularOpen"),t.component.setData("isMinimized",!1)}))}else if("Exluded_Entities"===e.type)Lyte.triggerEvent("ExcludedEntitiesCrossTabListener",e);else if("Competitor_Alert"===e.type)"meta_populate"===e.operation&&e.competitor_mention&&e.competitor_mention.length>0?e.competitor_mention.forEach((e=>{!e||"Leads"!==e.module&&"Contacts"!==e.module||(moduleRecordMapping[e.module].isCompetitorMentionEnabled=e.isCompetitorMentionEnabled,moduleRecordMapping[e.module].competitor_mention_details=e.competitor_mention_details)})):Lyte.triggerEvent("CompetitorAlertCrossTabListener",e);else if("VOC"===e.type){if("re_enable"===e.operation||"enable"===e.operation){let e=$L("crm-analytics-container")[0];e&&e.setData("vocLink","tab")}else if("component_computation_complete"===e.operation){let t=function(e){var t=document.getElementById("chartData_"+e);t&&t.component.executeMethod("renderVocComponentAct")};Lyte.injectResources(null,void 0,t(e.payload.componentIds))}else if("computation_complete"===e.operation||"computation_failure"===e.operation||"periodic_computation_complete"===e.operation||"configuration_delete_complete"===e.operation||"resync_migration_complete"===e.operation||"resync_migration_init"===e.operation){var Ke=networkUtils.returnDependencyFiles(["voc-common-store.js","voc-home.js","voc-dashboard-store.js","voc-component-store.js"],ResourceConstants.CRMClient),qe=networkUtils.returnDependencyFiles(["voc-home.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),Ge=Ke.concat(qe).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocnotification")],ResourceConstants.CRM)),Ze=e.id,Ye=$L("crm-voc-dashboard-header"),Xe=function(){moduleRecordMapping["Voice Of Customer"]||moduleRecordMapping["Voice of the Customer"]||store.findAll("module").then((function(){crmTab.reloadTabMenu()}));let t,i={computation_complete:"voc.computation.complete.notification.content",computation_failure:"voc.computation.complete.notification.failure.content",periodic_computation_complete:"voc.periodic.computation.notification.content",configuration_delete_complete:"voc.configuration.delete.notification.content"};var n=document.getElementsByTagName("crm-voc-wms-notification")[0];if("computation_complete"===e.operation||"computation_failure"===e.operation)(store.peekRecord("voc_dashboard",Ze)?Promise.resolve(store.peekRecord("voc_dashboard",Ze)):store.findRecord("voc_dashboard",Ze)).then((function(t){var o=I18n.getMsg(t.name?t.name:t[0].name),s={id:Ze,name:o,msgKey:i[e.operation]};if(Ye[0]&&Ze===Ye[0].component.data.dashboard.id)Ye[0].setData("computationMsgHeaderLiteral","computation_complete"===e.operation?Ye[0].component.data.isFromOtherFeature?"voc.compute.complete.popup.heading":"voc.compute.complete.heading":"voc.compute.fail.heading"),Ye[0].setData("computationStatus","computation_complete"===e.operation?"computation_complete":"computation_fail"),getElemById("crmvocdashboardcomputationinfo").component.executeMethod("updateComputationStatus","computation_complete"===e.operation?"computation_complete":"computation_fail",Ye[0].component.data.computationMsgHeaderLiteral,Ye[0].component.data.dashboard);else if(n){var r=(n=n.component).getData("dashboards"),a=[s].concat(r.filter((function(e){return e.id!==s.id})));validationUtils.isEmpty(r)&&Lyte.arrayUtils(n.getData("notificationTypes"),"push",e.operation),n.setData({dashboards:a})}else Lyte.Component.render("crm-voc-wms-notification",{dashboards:[s],notificationTypes:[e.operation]},"#basic");Lyte.triggerEvent("reloadDashboard",Ze,"manual")}));else if("configuration_delete_complete"===e.operation)if(t=renderingUtils.getPluralLabel(Ze),n){var s=n.getData("configurations"),r=[{module:t,key:i[e.operation]}].concat(s);validationUtils.isEmpty(s)&&Lyte.arrayUtils(n.getData("notificationTypes"),"push",e.operation),n.setData({configurations:r})}else Lyte.Component.render("crm-voc-wms-notification",{configurations:[{module:t,key:i[e.operation]}],notificationTypes:[e.operation]},"#basic");else if("resync_migration_complete"===e.operation||"resync_migration_init"===e.operation){if(e.payload&&e.payload.modules){e.payload.length=Object.keys(e.payload.modules).length;var a=[],l=0;for(o in e.payload.modules)a[l++]=o;e.payload.val=a}n?(Lyte.arrayUtils(n.getData("notificationTypes"),"push",e.operation),n.setData({notificationTypes:n.getData("notificationTypes"),payload:e.payload})):Lyte.Component.render("crm-voc-wms-notification",{notificationTypes:[e.operation],payload:e.payload},"#basic")}else{var c;if(n)(c=n.getData("msgKeys"))[e.operation]=i[e.operation],Lyte.arrayUtils(n.getData("notificationTypes"),"push",e.operation),n.setData({msgKeys:c,configModule:t});else(c={})[e.operation]=i[e.operation],Lyte.Component.render("crm-voc-wms-notification",{msgKeys:c,notificationTypes:[e.operation]},"#basic");Lyte.triggerEvent("reloadDashboard",Ze,"periodic")}};Lyte.injectResources(Ye[0]&&Ze===Ye[0].component.data.dashboard.id?null:Ge,void 0,Xe)}}else if("ZohoDesk"===e.type){var Qe=JSON.parse(e.message),et=(Z=Qe.msgType,Qe.value);switch(Z){case"crossOrgAlreadyIntegrated":"desk"!==Lyte.Router.getRouteInstance().routeName&&"Zoho Desk"!==Lyte.Router.getRouteInstance().currentModel.crossorg_name||desk.crossOrgAlreadyIntegratedAlert();break;case"isEnabled":Crm.userDetails.zDeskIntegration.isEnabled="true"===et;break;case"portalName":Crm.userDetails.zDeskIntegration.portalName=et;break;case"ticketModName":Crm.userDetails.zDeskIntegration.ticketModName=et}}else if("Circuits"===e.type){var tt=JSON.parse(e.message);switch(Z=tt.msgType){case"accountStatus":var it=tt.status;switch(Crm.userDetails.hasOwnProperty("Circuits")||(Crm.userDetails.Circuits={}),it){case"enable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!0,Lyte.triggerEvent("cirMain_disableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!0}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!0),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!0),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!0});break;case"disable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!1;f=networkUtils.returnDependencyFiles(["crm-wms-pop.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],ResourceConstants.CRM),c=f.concat(h).concat(y);Lyte.injectResources(c,void 0,(function(){$L("#crmWmsPopBox").length||Lyte.Component.render("crm-wms-pop",{},"#lookupdiv"),Lyte.triggerEvent("crmWmsPop_setData",{headerContent:I18n.getMsg("crm.circuits.wms.header",Crm.brandName),bodyContent:I18n.getMsg("crm.circuits.wms.body",I18n.getMsg("crm.social.crm")),isCookieHandleNeeded:!0,cookieName:"circuits_account_disable",cookieExpiry:864e5,showCancel:!1,showSuccess:!1}),Lyte.triggerEvent("crmWmsPop_openPop"),Lyte.triggerEvent("cirMain_enableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!1}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!1),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!1),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!1})}))}case"CircuitsPermission":Crm.userDetails.permissions||(Crm.userDetails.permissions={}),Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access=!!tt.status&&tt.status;break;case"initializeCircuitsClient":if(!tt.data)break;if(Crm.userDetails.Circuits||(Crm.userDetails.Circuits={}),tt.data.integration_done_by&&(Crm.userDetails.Circuits.integration_done_by=tt.data.integration_done_by),tt.data.paymentInfo&&(Crm.userDetails.Circuits.paymentInfo=tt.data.paymentInfo),tt.data.isCurrentPortalActive)switch(Crm.userDetails.Circuits.isCurrentPortalActive=tt.data.isCurrentPortalActive,it=Crm.userDetails.Circuits.isCurrentPortalActive){case"enable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!0,Lyte.triggerEvent("cirMain_disableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!0}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!0),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!0),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!0});break;case"disable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!1;f=networkUtils.returnDependencyFiles(["crm-wms-pop.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],ResourceConstants.CRM),c=f.concat(h).concat(y);Lyte.injectResources(c,void 0,(function(){$L("#crmWmsPopBox").length||Lyte.Component.render("crm-wms-pop",{},"#lookupdiv"),Lyte.triggerEvent("crmWmsPop_setData",{headerContent:I18n.getMsg("crm.circuits.wms.header",Crm.brandName),bodyContent:I18n.getMsg("crm.circuits.wms.body",I18n.getMsg("crm.social.crm")),isCookieHandleNeeded:!0,cookieName:"circuits_account_disable",cookieExpiry:864e5,showCancel:!1,showSuccess:!1}),Lyte.triggerEvent("crmWmsPop_openPop"),Lyte.triggerEvent("cirMain_enableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!1}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!1),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!1),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!1})}))}}}else{if("enableCallsNewView"===e.type){var ot=networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],ResourceConstants.CRM);return void Lyte.injectResources(ot,void 0,(function(){isNewCallView=!0;try{void 0!==Crm.userDetails.VALIDATIONRULEAVAILABLE&&!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&void 0!==Crm.userDetails.LRINVOLVEDMODULES&&Crm.userDetails.LRINVOLVEDMODULES.push("Calls")}catch(e){try{murphy.error(e)}catch(e){}}}))}"sms_notification"===e.type?Lyte.triggerEvent("wms_notify_sms_notification",e):"ReasonForLoss"===e.type&&(Crm.userDetails.ReasonForLoss=!0)}}}u=e.module;if(e.date=(new Date).getTime(),e.hasOwnProperty("gnType")){if("motivator_notifications"===e.gnType){var nt=JSON.parse(e.motivator_msg),st=[];st=st.concat(networkUtils.returnDependencyFiles(["gamescope-helpers.js"],ResourceConstants.CRMClient)),Lyte.injectResources(st,void 0,(function(){Lyte.Component.registeredHelpers.motivatorNotficationsHandler(nt)}))}if("true"===Crm.userDetails.isMotivatorEnabled){if("game_status"===e.gnType)setTimeout((function(){"crm.gamification.game.index"===Lyte.Router.getRouteInstance().transition.info.route&&(Lyte.Router.getRouteInstance().refresh().data=Lyte.Router.getRouteInstance().transition.data)}),5e3);else if("tv_channel"===e.gnType){var rt=store.peekAll("motivator_live_components");if(rt&&rt.length){var at=rt[0].id.split("_")[0],lt=e.values[at];lt&&lt.forEach((e=>{rt.filter((t=>t.id.includes(at+"_"+e))).forEach((e=>{store.unloadRecord("motivator_live_components",e.id)}))}))}}else if("dashboard_edit"===e.gnType||"rule_edit"===e.gnType||"target_edit"===e.gnType||"game_edit"===e.gnType||"team_edit"===e.gnType){var ct,dt=e.id;if("rule_edit"===e.gnType?(store.findRecord("game_rule",dt),store.findAll("target")):"target_edit"===e.gnType?store.findRecord("target",dt):"team_edit"===e.gnType&&store.findRecord("game_team",dt),(ct=store.peekAll("motivator_live_components"))&&ct.length){var ut=[];ct.forEach((e=>{ut.push(e.id)})),ut.forEach((e=>{store.unloadRecord("motivator_live_components",e)}))}}else if("dark_theme_disable"===e.gnType||"dark_theme_enable"===e.gnType){var mt=$L("gamescope-index")[0];mt&&mt.component.executeMethod("onThemeChange")}}else GameLoad.loadMainJsAndExecute((function(){document.hasFocus()&&GameLoad.loadData((function(){Gamification.handleWMSMessage(e)}))}))}else if("CustomModuleCreated"!==u&&"LinkingModuleCreated"!==u)if("MPL_MIGRATION"!=u)if("imMessageNotification"===u)Lyte.triggerEvent("crmMsgNewMsg",e);else if("ZTI"==u)ztiNotifier.ztiCallNotification(e);else if("zia_voice"===u)ziaskills.pushReminder("object"==typeof e?e:JSON.parse(e));else if("DINOTIFICATION"!==u||Crm.userDetails.CLIENT_ACCOUNT)if("ROUTINEMSG"===u)Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-zianotification-helper"].notifyOnWmsForRM()}));else if("CTIAPI"===u)networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){ctiApiNotifier.ctiApiNotification(e)}));else if("CALLS_PREFERENCES"===u&&Calls.handleWmsMessage)Calls.handleWmsMessage(e);else if("CALLPOPUP_NOTIFICATIONS"===u)ctiApiNotifier.notifyCallPopup(e);else if("eventMeetingOAuthSuccess"===u)Events.eventMeetingOAuthSuccess(e);else if("MeetingTokenCreation"===u)Events.meetingTokenCreation(e);else if("eventMeetingOAuthFailure"===u)Events.eventMeetingOAuthFailure(e);else if("eventMeetingReAuthorize"===u)Events.eventMeetingReAuthorize(e);else if("showMeetingAuthorizationPopUp"===u)Events.showMeetingAuthorizationPopUp(e.toolName,void 0,!0,e.isCalendarBooking);else if("populateMeetingSiteUrl"==u)Events&&(Events.meetingSiteUrl=e.meetingSiteUrl);else if("eventMeetingAuthorize"===u)null!=Events.startMeetingWindowObject&&Events.startMeetingWindowObject.close(),Events.showMeetingAuthorizationPopUp(e.toolName,null);else if("meetingBridgeEnabled"===u)Crm.userDetails.MEETING_BRIDGE_ENABLED=!0,Events.loadMeetingbridge();else if("loadMeetingBridgeAuthPop"===u)Events.callAuthorization(e.providerName,e.alertType,e.providerID);else if("reinitSetupJSON"===u)globalSetpJson=e.setupjson,"crm.settings.index"==Lyte.Router.getRouteInstance()._objPath&&$("crm-setup")[0].component.init();else if("RELOAD"===u)$("#loginlaterId").hide(),localStorage.setItem("pb_login_later_enabled",!1),$("#phonebridge_popup_container").hide(),$(".freezeLayer").hide(),$("html").css("overflow","auto"),$("#protocol").attr("value",e.protocol),networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"]),"undefined"!=typeof ctiApiConfig&&ctiApiConfig.destroyProviderData(),-1!==window.location.search.indexOf("settings/telephony")&&Utils.windowLocationReload();else if("WidgetAction"===u)"install"===e.action?(networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"]),"undefined"!=typeof ctiApiConfig&&ctiApiConfig.destroyProviderData(),isTelephonyWidgetInstalled=!0):isTelephonyWidgetInstalled=!1,-1!==window.location.search.indexOf("settings/telephony")&&Utils.windowLocationReload();else if("OauthToken"===u)$("#oauthtable").hide(),$("#oauthresponse").show(),$("#oauthtoken").val(e.token),$("#mainapitable").show(),$("#calltable").show(),$("#apiresponsetable").show(),$("#apicalltable").show();else if("vendorToken"===u)$("#vendorTokenLink").hide();else if("vendorTokenError"===u)ctiApiNotifier.showErrorStatus(e,!1);else if("intermediateprocess"===u)ctiApiNotifier.intermediateCallProcess(e);else if("reminder"===u)createReminder1(e,!0);else if("CallReminder"===u)CallReminder.handleCustomMessage(e);else if("TwilioCallActions"===u)TwilioCalls.handleCustomMessage(e);else if("Twiliodialpad"===u)void 0!==twiOutgoingConn.sendDigits&&"outbound"===e.CALL_TYPE?twiOutgoingConn.sendDigits(e.digit):void 0!==twiIncomingConn.sendDigits&&"inbound"===e.CALL_TYPE&&twiIncomingConn.sendDigits(e.digit);else if("TwilioConfigAction"===u)networkUtils.loadFeatureScripts(["zohocrm_twilio_conf.js"],(function(){TwilioConf.handleCustomMessage(e)}));else if("showRecentMails"!==u||Crm.userDetails.IMAP_STATUS)if("crmEmail"==u){var pt=document.getElementById("newMailCount");void 0!==e.newMailCount&&pt&&(Crm.userDetails.isAccessibilityConfigSupported&&Lyte.Service.getInjected("globalAccessibilityServices").flashEnable(),"none"==pt.style.display||$(pt).hasClass("dN")?(pt.style.display="block",pt.innerHTML=e.newMailCount,crmplusImplTriggerActions("setNotificationCount",["mailbox",e.newMailCount])):(pt.innerHTML=parseInt(pt.innerHTML)+e.newMailCount,crmplusImplTriggerActions("setNotificationCount",["mailbox",parseInt(pt.innerHTML)+e.newMailCount])))}else if("Tasks"==u&&"Locking_Configuration"!==e.type&&"Record_Locking"!==e.type||"Events"==u&&"Picklist_Actions"!=e.action||"Appointments"==u)Activities.isRequestSent||Activities.showHideRemainder(),setTimeout((function(){try{e=crmBstTime.populateActivityReminderBestTime(e);var t=Activities.currentDiv(e);if(Activities.reminderList=Activities.reminderList+e.activityId+";",$("li[id="+e.activityId+"]").length>0){var i=$("li[id="+e.activityId+"]").closest("ul");$("li[id="+e.activityId+"]").remove(),i.children().length<3&&i.remove(),Activities.reminderCount--}if(0==$(".remainderList").length&&$("#reminderContent").html(""),$("#currentEvt").length>0){i=$("li[id=currentEvt]").closest("ul");$("li[id=currentEvt]").after(t)}else t='<ul class="remainderList"><li id="currentEvt" class="dayseparation mL15 crm-font-bold"><span class="daytext">'+I18n.getMsg("crm.Now")+'</span><span class="seperator-line"></span></li>'+t+'<li class="menu_sep" style="border: none"></li></ul>',$("#reminderContent").prepend(t);if(""!==Activities.reminderCount&&(Activities.reminderCount++,$("#notificationCount").html().indexOf("+")>-1?$("#notificationCount").html(Activities.reminderCount+"+").show():$("#notificationCount").html(Activities.reminderCount).show(),Activities.notifyCountToCrmPlusFrame(Activities.reminderCount)),Activities.showHideReminderDetail(),$("li[id="+e.activityId+"]").addClass("remainderactive").data("details",e),Activities.showMoreDetails($("li[id="+e.activityId+"]"),"currentReminder"),"Events"===u&&Events.reminderNotificationEnabled&&window.Notification){var o={clickUrl:Crm.getCrmBasePath()+"/EntityInfo.do?module=Events&id="+e.activityId,id:e.activityId+""};CrmReminderNotification.show(Events.reminderNotificationImgUrl,e.TITLEVALFEED,"",o)}}catch(e){try{console.log(e)}catch(e){}}}),10);else if("zccampaign"==u){D=e.message;Notifier.construct(D);U=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,U,0,0),Notifier.slider.down("ztinotifier")}else if("rollupSummaryCF"===u){D={status:e.status,id:e.mod,message:I18n.getMsg("crm.rollup.scheduler.status."+e.status,moduleRecordMapping[e.mod].plural_label,e.fieldLabel,e.supportMail)};void 0!==crmSchedulerNotification.rollupModule&&crmSchedulerNotification.rollupModule===e.mod?e.status!==crmSchedulerNotification.rollupStatus&&(crmSchedulerNotification.rollupStatus=e.status,crmSchedulerNotification.addOrUpdateStatus(D,I18n.getMsg("crm.rollup.scheduler.status"))):(crmSchedulerNotification.rollupModule=e.mod,crmSchedulerNotification.rollupStatus=e.status,crmSchedulerNotification.addOrUpdateStatus(D,I18n.getMsg("crm.rollup.scheduler.status")))}else if("autoNumberCF"===u){D=e.message;Notifier.construct(D);U=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,U,0,0),Notifier.slider.down("ztinotifier")}else if("Encryption"===u||"RollupSch"===u){var gt=!1;if("Encryption"===u?(Encryption.showEncryptionPop(e),gt=!(!e.type||"Rollup Summary"!==e.type||"Success"!==e.status&&"Failure"!==e.status)):gt=!0,gt&&("undefined"!=typeof CMB&&CMB&&CMB.rollupFieldIdVsSchedularCompletionStatus&&delete CMB.rollupFieldIdVsSchedularCompletionStatus[e.fieldId],"view-layout"===Lyte.Router.getRouteInstance().routeName)){var ft=$L("[copyof='NE"+e.fieldId+"']");ft.length>0&&ft.find(".permanentdeleteicon").removeClass("cD disPermDelIcon").removeAttr("mbtooltip")}}else if("Record Accessibility"===u)showRecordAccess(e);else if("ExportReport"==u||"DownloadVCard"==u){var ht=e.message;ht.IsDeleteLink?crmReports.clearAPopupDiv(ht.UniqueID):crmReports.showStatusBasedResult(ht)}else if("portalChange"==u){var yt=e.new_portal,vt=e.old_portal,Ct=location.href,wt=e.modifiedBy,bt=Crm&&Crm.userDetails?Crm.userDetails.ZUID:void 0;-1!=Ct.indexOf("/"+vt+"/")&&yt&&wt!=bt&&(window.crmNewPortal=yt,Crm.showURLChangeAlert(!0,e.suffix)),"true"==isSandboxAcc&&$("html,body").removeClass("eventNone")}else if("permissionChange"==u){var _t=e.enabledPermissions,Mt=e.disabledPermissions;let t,i=_t.length,o=Mt.length;for(t=0;t<i;t++){let e=_t[t];Crm.userDetails.permissions[e]=!0}for(t=0;t<o;t++){let e=Mt[t];Crm.userDetails.permissions[e]=void 0}}else if("teamModulePermissionChange"===u){try{var At=JSON.parse(sessionStorage.getItem("draftDetails")),It=e.moduleName;if(At){for(var[_,M]of Object.entries(At)){(lo=M.split(":")[1])===It&&delete At[_]}sessionStorage.setItem("draftDetails",JSON.stringify(At))}}catch(e){murphy.error(e)}Object.entries(e.permissions).map((e=>{let t=1===e[1];t&&!Crm.userDetails.permissions[e[0]]?Crm.userDetails.permissions[e[0]]=t:!t&&Crm.userDetails.permissions[e[0]]&&delete Crm.userDetails.permissions[e[0]]}))}else if("domainMapping"===u)"deactivate"===e.status&&Crm.userDetails.IS_ADMIN&&!Crm.isCustomDomainURLRequest||_cruxUtils.showCustomAlert({params:{ltPropType:"info",ltPropPrimaryMessage:I18n.getMsg("cd.wmspop.title"),ltPropSecondaryMessage:102==e.environment?I18n.getMsg("cd.wmspop.logout.msg"):I18n.getMsg("cd.wmspop.refresh.msg"),"lt-prop-close-on-escape":"false",ltPropButtons:[{type:"accept",appearance:"primary",text:I18n.getMsg("cd.wmspop.refresh.btn"),cxPropZcqa:"zcdm_domain_change_refresh"}]},accept:function(){var t=e.domain_name,i=Crm.clientPortalName;if("102"==e.environment){var o="/accounts/p/"+Crm.userDetails.CLIENT_PORTAL_ID+"/logout?servicename="+RebrandLinkUtil.getProperties().CRMSERVICENAME+"&serviceurl="+t+"/portal/"+i+"/crm/login.sas";logoutCall(o)}else null===t&&""===t.trim()||(window.location=t.concat(window.location.pathname).concat(window.location.search))}});else if("clientPortalRename"===u&&"success"===e.status&&Crm.userDetails.CLIENT_ACCOUNT)_cruxUtils.showCustomAlert({params:{ltPropType:"info",ltPropPrimaryMessage:I18n.getMsg("clinet.portal.name.update"),ltPropSecondaryMessage:I18n.getMsg("clinet.portal.name.update.wmspopup.refresh.msg"),"lt-prop-close-on-escape":"false",ltPropButtons:[{type:"accept",appearance:"primary",text:I18n.getMsg("cd.wmspop.refresh.btn"),cxPropZcqa:"zcdm_domain_change_refresh"}]},accept:function(){var t=e.serviceUrl,i="/accounts/p/"+Crm.userDetails.CLIENT_PORTAL_ID+"/logout?servicename="+RebrandLinkUtil.getProperties().CRMSERVICENAME+"&serviceurl="+t;logoutCall(i)}});else if(e.ACTION==="EXPORT_"+e.USERID)crmExportWMSMsg.showMessageBasedResult(e);else if("REPORTS_MIGRATION"===e.ACTION){var Lt=e.PROCESS;if(6===e.STATUS){var Rt=document.querySelector("crm-report-wms-pop");Rt&&(Rt=Rt.component).$node.remove()}else{f=networkUtils.returnDependencyFiles(["crm-report-wms-pop.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],ResourceConstants.CRMClient),y=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")],ResourceConstants.CRM),c=f.concat(h).concat(y);Lyte.injectResources(c,void 0,(function(){if(!$L("#crmReportWmsPopBox").length){var e=document.querySelector("crm-report-wms-pop"),t=I18n.getMsg("crm.report.upgrade.report.status"),i="NEW"===Lt?I18n.getMsg("crm.report.upgrade.success.new.version"):I18n.getMsg("crm.report.upgrade.success.old.version"),o=I18n.getMsg("crm.button.close"),n=I18n.getMsg("crm.mb.label.try.now");e?(e.setData("headerContent",t),e.setData("bodyContent",i),e.setData("cancelText",o),e.setData("successText",n),e.setData("isCookieHandleNeeded",!1),e.setData("cookieName",void 0),e.setData("cookieExpiry",void 0)):e=Lyte.Component.render("crm-report-wms-pop",{headerContent:t,bodyContent:i,cancelText:o,successText:n,isCookieHandleNeeded:!1,cookieName:void 0,cookieExpiry:void 0},"#reportlookupdiv")}Lyte.triggerEvent("crmReportWmsPop_openPop"),localStorage.setItem("reports_migration",Lt);var s=I18n.getMsg("crm.report.upgrade.tooltip.message.success1"),r=I18n.getMsg("crm.report.upgrade.tooltip.message.success2");if("NEW"===Lt){crmReports.tooltipMsgHeading=s,crmReports.tooltipMsgContent=r,crmReports.updatedTimeMsg="",crmReports.showMigrateTooltip();var a=document.querySelector("crm-new-reports-popup");a&&(a.setData("tooltipMsgHeading",s),a.setData("tooltipMsgContent",r),a.setData("updatedTimeMsg",""))}else{var l=document.querySelector("crm-reports-container");l&&(l.setData("toolTipMsgHeading",s),l.setData("toolTipMsgContent",r),l.setData("toolTipTimeMsg",""))}}))}}else if("transferAndDelete_Actions"===e.action)Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-userdelete-notification.js"],ResourceConstants.CRMClient),void 0,(function(){var t=I18n.getMsg("crm.delete.user.transfer_delete.scheduler.title");transDelUserScheduler.addOrUpdateUserSchedulerStatus(e,t)}));else if(Crm.userDetails.isStaticSubFormEnabled&&"staticSubform_Actions"===e.action)Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-static-subform-notification.js"],ResourceConstants.CRMClient),void 0,(function(){var t=I18n.getMsg("crm.delete.user.transfer_delete.scheduler.title");staticSubFormScheduler.addOrUpdateStaticSubformSchedulerStatus(e,t)}));else if("onboardingNotifyWMS"===e.action)Crm.userDetails.PROFILE_POPUP&&("OnboardingCompletion"===e.task?("true"!==window.isCrmPlusUser&&"true"!==window.isZohoOneUser||void 0===Crm.userDetails.PROFILE_POPUP?($L("crm-profile-menu")[0].component.setData({cardPopup:!1}),$L(".cob_quickSetupMaxModal")[0].setData("ltPropShow",!1),1===$L(".cob_confirmAlert").length&&document.querySelector(".cob_confirmAlert").ltProp("show",!1)):$L("crm-getting-start")[0]&&document.getElementById("getStarted").remove(),Crm.userDetails.PROFILE_POPUP=void 0,Crm.userDetails.RIGHT_PANEL_POPUP=void 0,"crm.tab.module.begin"===Lyte.Router.getRouteInstance().transition.info.route&&"Home"===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]&&Lyte.Router.getRouteInstance().refresh()):"SandboxPipelineDeployment"===e.task?$L("crm-profile-menu")[0].component.actions.featureMarkCompletion("deals"):"UnCheckPipelineCompletion"===e.task&&$L("crm-profile-menu")[0].component.setData("features.deals.featureStatus","Yet to Complete"));else if("groupDeletion_Actions"===e.action)Lyte.injectResources(networkUtils.returnDependencyFiles(["DelUsersGroup.js"],ResourceConstants.CRMClient),void 0,(function(){var t=I18n.getMsg("crm.setup.editor.delgroup.header");Lyte.registeredMixins.DelUsersGroup.addOrUpdateUserSchedulerStatus(e,t)}));else if("Picklist_Actions"===e.action)networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("globalpicklist")],(function(){var t=e.jobId;if(void 0===getObj("rls-contSharStaLoad-pop")){$("body").append(Handlebars.templates.PicklistReplaceValue(e));var i=$("<td>"),o=$("<div>");o.attr({class:"schedularProgress-icon svgIcons cP pR",onclick:"crmExportWMSMsg.showHidePicklistSchedulerDiv();"}),i.append(o),$("#wmsstatusbar .crm-chatBarIcons tbody tr").prepend(i),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3)}if(2===e.status){var n=$(Handlebars.templates.PicklistReplaceValue(e)).find(".picklistReplaceList").clone();$("#rls-contSharStaLoad-pop .scheduleListRLS").append(n),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3),clearTimeout(crmExportWMSMsg.closeAll)}else 5!==e.status&&4!==e.status||($("#picklist_pop_"+t).find(".picklist_progress").remove(),$("#rls-contSharStaLoad-pop").find("#picklist_pop_"+t).append(Handlebars.templates.picklistReplaceCompletedNotification(e)),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3),0===$("#rls-contSharStaLoad-pop").find("picklist_progress").length&&(clearTimeout(crmExportWMSMsg.closeAll),crmExportWMSMsg.clearAllreplace()))}));else if("Mass_Convert"===e.type){var kt=networkUtils.returnDependencyFiles(["crm-mass-convert-notify.js"],ResourceConstants.CRMClient),St=document.querySelector("crm-mass-convert-notify");if(St){var Tt=St.component;Lyte.registeredMixins["crm-mass-convert-notify"].initilization(e,Tt)}else kt=(kt=kt.concat(networkUtils.returnDependencyFiles(["crm-mass-convert-notify.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("crm_mass_convert_notify"),ResourceConstants.CRM)),Lyte.injectResources(kt,void 0,(function(){Lyte.registeredMixins["crm-mass-convert-notify"].initilization(e)}))}else if("IMAP"===u)void 0!==e.MAIL_COUNT?($("#newMailCount").html(e.MAIL_COUNT).show(),document.title="("+e.MAIL_COUNT+")"+originaltitle,crmplusImplTriggerActions("setNotificationCount",["mailbox",e.MAIL_COUNT])):"undefined"!=typeof CrmIMAP&&CrmIMAP.handleWmsMessage(e);else if("NotificationCenter"===u)Crm.userDetails.isAccessibilityConfigSupported&&Lyte.Service.getInjected("globalAccessibilityServices").flashEnable(),crmNTCWms.handleMessage(e);else if("Social"===u){if(e.settings)if(e.social_tab)if(e.added||e.updated||e.errorCode||e.deleted){var Dt=$L("crm-social-setup-brand-details");Dt&&Dt.length>0&&(Dt=Dt[0].component).handleAddAccount(e);var Pt=Lyte.registeredMixins["crm-social-notification"];void 0!==Pt&&Pt.handleAddAccount(e)}else{var $t=e.brid?e.brid:"",Nt=e.errorCode?e.errorCode:"",Et=e.account_id?e.account_id:"";if(e.twitter){if($(".comm_twitter").hasClass("sel"))crmSocialSetup.triggerSetup("#sub_twitter",Nt,"",$t);else if("none"!==$("#reauth_alert").css("display")){if($L("#reauth_"+$t+"_twitter").remove(),crmSocial.reloadFeeds(),0===$L("#reauth_accounts").children().length)(xt=$L("crm-social-account-reauth"))&&xt.length>0&&xt[0].remove(),$L(".reauthDot").removeClass("follow_dot");else $L(".reauthDot").addClass("follow_dot")}}else if(e.facebook)if($(".comm_facebook").hasClass("sel"))crmSocialSetup.triggerSetup("#sub_facebook",Nt,Et,$t);else if("none"!==$("#reauth_alert").css("display")){var xt;if($L("#reauth_"+$t+"_facebook").remove(),crmSocial.reloadFeeds(),0===$L("#reauth_accounts").children().length)(xt=$L("crm-social-account-reauth"))&&xt.length>0&&xt[0].remove(),$L(".reauthDot").removeClass("follow_dot");else $L(".reauthDot").addClass("follow_dot")}}else if(e.social_integ)if($("#entity_search_container").length>0&&"0px"===$("#entity_search_container").css("left"))e.twitter?crmSocialEntity.postAuthenticationHandling("twitter"):e.facebook?crmSocialEntity.postAuthenticationHandling("facebook"):e.googleplus&&crmSocialEntity.postAuthenticationHandling("googleplus");else if("undefined"==typeof crmSocialInteg||$("#userDetailView").is(":visible")){if($("#userDetailView").is(":visible"))if(e.twitter)if(e.reauth)$("#twitter_account").find(".reauth").remove();else{var Ft=$("#twitter_account");Ft.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("crmLinkColor fs crm-small-font-size cP"),Ft.append('<span id="twitter_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vH cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'twitter\',\''+e.account_id+"')\"></span>")}else if(e.facebook)if(e.reauth)$("#facebook_account").find(".reauth").remove();else{var Ut=$("#facebook_account");Ut.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("crmLinkColor fs crm-small-font-size cP"),Ut.append('<span id="facebook_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vH cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'facebook\')"></span>')}else if(e.googleplus)if(e.reauth)$("#googleplus_account").find(".reauth").remove();else{var Ot=$("#googleplus_account");Ot.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("crmLinkColor fs crm-small-font-size cP"),Ot.append('<span id="googleplus_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vH cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'googleplus\')"></span>')}}else crmSocialInteg.getPersonalAccounts();else e.errorCode&&"10001"===e.errorCode&&crmui.showMsgBand("error",I18n.getMsg("crm.social.setup.reauth.error",$ESAPI.encoder().encodeForHTML(e.account_id)),3e3);else if($("#social_parent_div").length>0)crmSocialNotification.handleWMSNotification(e);else if($("#socialDashboard").length>0){var jt=Lyte.registeredMixins["crm-social-notification"];void 0!==jt&&jt.processWMSNotification(e)}else if(e.linked_in){commonUtils.showHideLoadingDiv(!0);var Bt=$L("sales-navigator");Bt&&Bt.length?Bt[0].component.loadSalesNavigatorRelatedList():SalesNavigator.loadSalesNavigatorRelatedList()}}else if("Sandbox"===u){($L("crm-sandbox-list").length>0||!Crm.isMultiSandboxEnabled)&&("AddDeveloper"===e.fromPage?(sandbox.getSandboxCountSummary(),"true"===e.issuccess&&crmui.showMsgBand("success",I18n.getMsg(e.msgContent),1e4)):sandbox.syncStatusInListPage(e));var zt="",Vt=e.sandboxId,Ht=!1;if("sandbox-detail"===(oo=Lyte.Router.getRouteInstance()).routeName&&oo.currentModel&&oo.currentModel.currentSandbox&&(zt=oo.currentModel.currentSandbox.id,Ht=!0),zt&&Vt&&zt===Vt&&($(".sBoxCtn").length>0||$(".creationAnimation").length>0)||Ht)if("datapop"===e.fromPage)sandbox.viewSandboxChanges(void 0,e);else{if("false"===e.issuccess){var Jt=e.sandboxId;store.deleteRecord("sandbox",Jt)}sandbox.viewSandboxChanges((function(){if("true"==e.issuccess)crmui.showMsgBand("success",I18n.getMsg(e.msgContent),1e4),CScriptLib&&Lyte.registeredMixins["crm-cscript-global-mixin"].cscriptChangesPostSandboxDeployment();else if($("#sandboxMsgDiv").removeClass("successMsg").addClass("failureMsg"),"Create"===e.fromPage){var t=I18n.getMsg(e.msgContent,[e.toAddr,e.supportMail]);crmui.showMsgBand("error",t,1e4)}else if("Deployment"===e.fromPage){let t=networkUtils.returnDependencyFiles(["crm-sandbox-deployment-failure-modal.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("accessibility")],ResourceConstants.CRM));let i=networkUtils.returnDependencyFiles(["crm-sandbox-deployment-failure-modal.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);Lyte.injectResources(t.concat(i),void 0,(function(){let t={showModal:!0,failedChangeItems:e.failed_changes};Lyte.Component.render("crm-sandbox-deployment-failure-modal",t,"body")}))}}),e,void 0,zt)}}else if("RecycleBin"===u){m=networkUtils.returnDependencyFiles(["crm-recyclebin-notification-popup.js"],ResourceConstants.CRMClient);Lyte.injectResources(m,void 0,(function(){var t=$L("crm-recyclebin-notification-popup");0==t.length&&t.push(Lyte.Component.render("crm-recyclebin-notification-popup",{},"body")),t[0].component.setData("showNotificationPopup",!0),t[0].component.setData("status",e.status),t[0].component.setData("operation",e.operation)}))}else if("PORTALS"===u){if(!document.querySelector("#portalsWMSIcon")){var Wt=$('<td id="portalsWMSIcon">'),Kt=$("<div>");Kt.attr({class:"schedularProgress-icon svgIcons cP pR",onclick:"crmExportWMSMsg.showHideSchedulerNotificationModal();"}),Wt.append(Kt),$("#wmsstatusbar .crm-chatBarIcons tbody tr").prepend(Wt)}var qt=networkUtils.returnDependencyFiles(["crm-scheduler-notification.js"],ResourceConstants.CRMClient),Gt=networkUtils.returnDependencyFiles(["crm-scheduler-notification.css"],ResourceConstants.CRMClient);Crm.userDetails.RTL_ENABLED&&(Gt=networkUtils.returnDependencyFiles(["crm-scheduler-notification-rtl.css"],ResourceConstants.CRMClient));var Zt=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Portals")],ResourceConstants.CRM);qt=qt.concat(Gt).concat(Zt),Lyte.injectResources(qt,void 0,(function(){var t={},i=document.querySelector("crm-scheduler-notification-modal");At={},i&&(At=i.component.data,i.remove()),At.jobIds&&!At.jobIds.contains(e.jobid)?At.jobIds.push(e.jobid):At.jobIds||(At.jobIds=[],At.jobIds.push(e.jobid));var o=At.modelData?At.modelData:{};if(t.showModal=!0,At.id="portalsSchedulerNotifier",At.removePopUpOnClose=!(At.jobIds.length>1),At.showModal=!0,At.title=Crm.userDetails.CLIENT_PORTAL_INVITATION_FIELD?I18n.getMsg("custmr.prtl.act.ntfn.title"):I18n.getMsg("custmr.prtl.bulk.act.ntfn.title"),"Bulk_Invite"===e.operation||"Bulk_User_Status_Change"===e.operation){var n=null,s=null,r="In_Progress"===e.status,a=0,l={successCount:0,totalCount:0},c={successCount:0,totalCount:0},d=!1,u=$ESAPI.encoder().encodeForHTML(e.user_type_name);if(u="ClientPortal"===u?I18n.getMsg(u):u,e.user_type_name=u,!r)switch(e.operation){case"Bulk_Invite":s=(n=e.response?e.response.response:e.response)?n.length:0;for(var m=0;m<s;m++){var p=n[m],g=Object.keys(p);200!==(f=parseInt(p[g[0]][1]))&&1005!==f||a++}break;case"Bulk_User_Status_Change":s=(n=e.response?e.response.users:e.response)?n.length:0;for(m=0;m<s;m++){var f;p=n[m],g=Object.keys(p);1021===(f=parseInt(p[g[0]].code))||1037===f?(a++,l.successCount++):1023===f&&(a++,c.successCount++),1037===f&&(d=!0),"activate"===p[g[0]].type?l.totalCount++:c.totalCount++}}switch(e.operation){case"Bulk_Invite":var h=a===s&&"SUCCESS"===e.status?0:0===a||"FAILED"===e.status?1:2,y=!r&&e.response?e.response.inviteType:"";t.message=r?I18n.getMsg("custmr.prtl.scheduler.progress.title"):2===h?I18n.getMsg("custmr.prtl.invite.success.count",[a,s,u]):0===h?"invite"===y?I18n.getMsg("custmr.prtl.success.bulk.invite",[a,u]):I18n.getMsg("custmr.prtl.success.bulk.reinvite",[a,u]):"invite"===y?u?I18n.getMsg("custmr.prtl.failure.bulk.invite",[s,u]):I18n.getMsg("custmr.prtl.failure.bulk.invite.on.usertype.deletion",[s]):I18n.getMsg("custmr.prtl.failure.bulk.reinvite",[s,u]),t.message2=r||1===h?"":I18n.getMsg("custmr.prtl.scheduler.refresh.message"),t.iconClass=2===h?"zcrm_svgIcons cpT_warningTick":0===h?"zcrm_svgIcons cpT_sucessTick":"zcrm_svgIcons cpT_failedTick",t.inProgress=r,r||0===h||"SUCCESS"!==e.status||(t.anchorTag={},t.anchorTag.id="viewFailures",t.anchorTag.datazcqa="viewFailures",t.anchorTag.onClickArguments={},t.anchorTag.onClickArguments.msg=e,t.anchorTag.title=I18n.getMsg("custmr.prtl.invitees.failed"),t.anchorTag.action_name="showFailedInvitees");break;case"Bulk_User_Status_Change":h=a===s&&"SUCCESS"===e.status?0:0===a||"FAILED"===e.status?1:2;if(t.message=r?I18n.getMsg("custmr.prtl.chngsts.scheduler.progress.title"):"",!r){var v=0!==l.totalCount?0===l.successCount?d?I18n.getMsg("custmr.prtl.chngsts.failure.count.gnt.accss",[l.totalCount]):I18n.getMsg("custmr.prtl.failed.bulk.chngsts.actv",[l.totalCount]):l.totalCount!==l.successCount?d?I18n.getMsg("custmr.prtl.chngsts.partial.count.gnt.accss",[l.totalCount]):I18n.getMsg("custmr.prtl.chngsts.success.count.actv",[l.successCount,l.totalCount]):d?I18n.getMsg("custmr.prtl.chngsts.success.count.gnt.accss",[l.totalCount]):I18n.getMsg("custmr.prtl.success.bulk.chngsts.actv",[l.successCount]):"",C=0!==c.totalCount?0===c.successCount?I18n.getMsg("custmr.prtl.failed.bulk.chngsts.deactv",[c.totalCount]):c.totalCount!==c.successCount?I18n.getMsg("custmr.prtl.chngsts.success.count.deactv",[c.successCount,c.totalCount]):I18n.getMsg("custmr.prtl.success.bulk.chngsts.deactv",[c.successCount]):"";t.message+=""!==C&&""!==v?v+" and "+C.toLowerCase():""!==v?v:C,e.modalTitle=0!==l.totalCount&&0!==c.totalCount?I18n.getMsg("custmr.prtl.failed.chngsts.list",e.user_type_name):0!==l.totalCount?I18n.getMsg("custmr.prtl.failed.chngsts.list.actv",e.user_type_name):I18n.getMsg("custmr.prtl.failed.chngsts.list.deactv",e.user_type_name)}t.message2=r||1===h?"":I18n.getMsg("custmr.prtl.scheduler.refresh.message"),t.iconClass=2===h?"zcrm_svgIcons cpT_warningTick":0===h?"zcrm_svgIcons cpT_sucessTick":"zcrm_svgIcons cpT_failedTick",t.inProgress=r,r||0===h||"SUCCESS"!==e.status||(t.anchorTag={},t.anchorTag.id="viewFailures",t.anchorTag.datazcqa="viewFailures",t.anchorTag.onClickArguments={},t.anchorTag.onClickArguments.msg=e,t.anchorTag.title=I18n.getMsg("custmr.prtl.failed.chngsts"),t.anchorTag.action_name="showFailedStatusChange")}o?o[e.jobid]=t:(o={})[e.jobid]=t,At.modelData=o,Lyte.Component.render("crm-scheduler-notification-modal",At,"body")}else if("enable_portal_SMS"===e.operation){var w=e=>{o.enablePortalSMS=e,At.modelData=o,Lyte.Component.render("crm-scheduler-notification-modal",At,"body")};SMS.API.PUT.enablePortal(e.portal_id).then((function(){t.message=I18n.getMsg("custmr.prtl.enable.portal.sms.success.msg"),t.message2=I18n.getMsg("custmr.prtl.enable.portal.sms.success.msg2"),t.iconClass="zcrm_svgIcons cpT_sucessTick",w(t)}),(function(e){t.message="PORTAL_ALREADY_AVAILABLE"===e.code?I18n.getMsg("custmr.prtl.enable.portal.sms.success.msg"):I18n.getMsg("custmr.prtl.enable.portal.sms.failed.msg"),t.message2="PORTAL_ALREADY_AVAILABLE"===e.code?I18n.getMsg("custmr.prtl.enable.portal.sms.success.msg2"):I18n.getMsg("please.contact.support"),t.iconClass="PORTAL_ALREADY_AVAILABLE"===e.code?"zcrm_svgIcons cpT_sucessTick":"zcrm_svgIcons cpT_failedTick",w(t)}))}}))}else if("Subscription"===u&&$("#SubscriptionExpiryDiv").size())Utils.windowLocationReload();else if("ResetBellCount"===e.type)crmNTCWms.resetBellCount();else if("UpdateSignalsCount"===e.type)crmNTCWms.updateSignalsCount(e);else if("UpdateSignalsCountInIFrame"===e.type)SalesSignalsWrapper.isSignalIFrameOpen&&SalesSignalsWrapper.updateSignalsCount();else if("markSignalAsRead"===e.type)crmNTCWms.markAsRead(e);else if("markAllSignalAsRead"===e.type)crmNTCWms.markAllAsRead();else if("AnomalyProgress"===u||"pitch"===u){if(Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().transition&&"crm.tab.newDashboards.index.view"===Lyte.Router.getRouteInstance().transition.target)0!==$("#"+e.id).length?Lyte.registeredMixins["crm-dashboard-utils"].renderChart(e.dashboard_id,e.id):"pitch"===u&&Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]===e.dashboard_id&&Lyte.Router.getRouteInstance().refresh();else if("undefined"!=typeof CrmAnalytics)if(0!=$("#"+e.id).length)CrmAnalytics.loadComponentData(e.id,e.dashboard_id);else if("pitch"===u){var Yt=$("#"+e.dashboard_id);0!==Yt.length&&Yt.hasClass("opSel")&&Yt.removeClass("opSel").trigger("click")}}else if("Record_Locking"===e.type){if("entity"===Lyte.Router.getRouteInstance().routeName?(ei=Lyte.Router.getRouteInstance().getDynamicParam(),ti=Lyte.Router.getRouteInstance().parent.getDynamicParam()):"detail"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().routeName||(ei=Lyte.Router.getRouteInstance().parent.getDynamicParam(),ti=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()),ei&&ti&&ti==e.module&&ei==e.entityId)if("detail"!==Lyte.Router.getRouteInstance().routeName&&"entity"!==Lyte.Router.getRouteInstance().routeName||Crm.getCanvasId(moduleRecordMapping[ti].id,ei))"canvas"!==Lyte.Router.getRouteInstance().routeName&&"entity"!==Lyte.Router.getRouteInstance().routeName||(Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?(Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),detailView.currentModule=ti):Lyte.Router.getRouteInstance().refresh());else if(crmTab.deleteFromCache(ti),Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&(Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),detailView.currentModule=ti),Crm.renderDVLyteFlow(ti)){var Xt=$L("crm-detail-view");if(store.pushPayload(moduleRecordMapping[ti].id,{id:ei,Locked__s:e.isLocked}),Crm.isDVRefreshForLock&&Xt&&Xt[0]&&Xt[0].component){var Qt=Xt[0].component.data.unique_listener_id;Lyte.triggerEvent("detail_view_listener_"+Qt,{componentsToBeReloaded:["all_components"]})}else{(oi={}).currentEntityId=ei,oi.currentModule=ti,Crm.DVRefreshData=oi}}else{if(Crm.isDVRefreshForLock)reloadCurrentEntityView(ei,ti);else(oi={}).currentEntityId=ei,oi.currentModule=ti,Crm.DVRefreshData=oi}}else if("cpq_tab_refresh"===e.type){var ei,ti;if("entity"===Lyte.Router.getRouteInstance().routeName?(ei=Lyte.Router.getRouteInstance().getDynamicParam(),ti=Lyte.Router.getRouteInstance().parent.getDynamicParam()):"detail"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().routeName||(ei=Lyte.Router.getRouteInstance().parent.getDynamicParam(),ti=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()),ei&&ti&&ti===e.module&&ei===e.entityId)if(store.unloadAll("cpq_logs"),"detail"!==Lyte.Router.getRouteInstance().routeName&&"entity"!==Lyte.Router.getRouteInstance().routeName||Crm.getCanvasId(moduleRecordMapping[ti].id,ei))"canvas"!==Lyte.Router.getRouteInstance().routeName&&"entity"!==Lyte.Router.getRouteInstance().routeName||(Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?(Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),detailView.currentModule=ti):Lyte.Router.getRouteInstance().refresh());else if(Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution())Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),detailView.currentModule=ti;else if(Crm.renderDVLyteFlow(ti)){var ii=$L("crm-detail-view");if(Crm.isDVRefreshForLock&&ii&&ii[0]&&ii[0].component){Qt=ii[0].component.data.unique_listener_id;Lyte.triggerEvent("detail_view_listener_"+Qt,{componentsToBeReloaded:["all_components"],triggerCPQAPIS:!0})}else{(oi={}).currentEntityId=ei,oi.currentModule=ti,oi.triggerCPQAPIS=!0,Crm.DVRefreshData=oi}}else{var oi;if(Crm.isDVRefreshForLock)reloadCurrentEntityView(ei,ti);else(oi={}).currentEntityId=ei,oi.currentModule=ti,Crm.DVRefreshData=oi}}else if("Locking_Configuration"===e.type){var ni=networkUtils.returnDependencyFiles(["crm-lock-rule-wms-notify.js","crm-lock-rule-list.js"],ResourceConstants.CRMClient);ni=(ni=ni.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-lock-rule-wms-notify.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var si=$L("#wmsstatusbar"),ri=$L("#LockingProgressIconDiv"),ai=si.find("tr");if($L("#recordLockingConfigWMS").css({bottom:"26px"}).show(),ai.find(ri).length<=0){var li=$("<td style='border-left: 1px solid #ddd;' id='ruleProcess'><div class='vaM pR h30' style='padding: 5px; display: table-cell; bottom: 0px; top: -1px; border-top: 1px solid #fff;'><div id='LockingProgressIconDiv' data-zcqa='recordLockRuleProgressIcon' class='recordLockRuleProgressIcon cP pR activeProgress'  onclick='recordLockingConfigNotification.showLockingRuleProgressDiv()' onmouseover='' data-title='Locking Rule'></div></div></td>");ai[0].prepend(li[0]);var ci=$L("#touricon");($L("#wldpop").length>0||ci.length>0)&&$L("#massProgress").css({"border-right":"1px solid #ddd"}),ci.length>0&&ci.parent().find("span").css({"padding-left":"10px"})}Lyte.injectResources(ni,void 0,(function(){if(!document.querySelector("crm-lock-rule-list")){var t={displayModule:moduleRecordMapping[e.module].plural_label};Lyte.Component.render("crm-lock-rule-list",t,"#recordLockingConfigWMS")}var i=document.querySelector(".section_"+e.module);if(i&&document.querySelector(".noProgress_"+e.module)&&(i.remove(),i=null),!i||0!==e.status){t={rule:e};Lyte.Component.render("crm-lock-rule-wms-module",t,"#LockRuleRenderSection")}}))}else if("MassOperationProgress"===u){var di=e.message;if(!0===(At=JSON.parse(di)).neglect_storage_criteria&&2===At.actionType&&5===At.status&&(Crm.userDetails.data_storage.isAnyCleanupProcessRunning=!1),("1"==At.actionType||"2"==At.actionType||"3"==At.actionType)&&At.moduleLabel==customViewObject.module)if(5===At.status||4===At.status){customViewObject.showSelectAll=!0,customViewObject.doMassActioninScheduler=void 0;var ui=moduleRecordMapping[customViewObject.module].actions;if(ui&&ui.length){var mi=ui.findIndex((function(e){return"hideSelectAllRecords"==e.name}));-1!=mi&&moduleRecordMapping[customViewObject.module].actions.splice(mi,1)}}else customViewObject.showSelectAll=!1;massActionNotification.showMassOperationProgress(At)}else if("Convert_Lead_Scheduler"===e.type){var pi=networkUtils.returnDependencyFiles(["crm-convert-notify.js"],ResourceConstants.CRMClient);pi=(pi=pi.concat(networkUtils.returnDependencyFiles(["crm-convert-notify.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("convertNotify")],ResourceConstants.CRM)),Lyte.injectResources(pi,void 0,(function(){var t=e;if(t.module="Leads",t.singular_module=moduleRecordMapping.Leads.singular_label,null===document.getElementById("convertSchedulerNotificationPopup")){var i={module:"Leads"};i.singular_module=moduleRecordMapping.Leads.singular_label,i.status="initial",i.jobId=t.jobId,Lyte.Component.render("crm-convert-notify",i,"body")}var o=document.getElementById("convertSchedulerNotificationPopup"),n=document.getElementById("picklist_pop_"+t.jobId),s=o.getElementsByTagName("ul");if(null===n){var r=document.createElement("li");r.id="picklist_pop_"+t.jobId,r.classList.add("m0","p20","scheduledDataList","picklistReplaceList"),s[0].appendChild(r),n=document.getElementById("picklist_pop_"+t.jobId)}else n.innerHTML="";t.details&&t.details.duplicate_record&&document.querySelector("crm-convert-notify").component.getDuplicateErrorMsg(t,t.details);var a=document.createElement("crm-convert-notify");if(a.setData(Object.assign({},t)),n.append(a),o.getElementsByTagName("li").length>3){var l=renderingUtils.windowHeight/4*3;s.css("max-height",l).classList.add("oA")}}))}else if("financesuite"===u)ZInvoice.pushNotifyCx(e.action);else if("button_notify"===u)CustomButtonJSObjectInit.buttonWMSNotification(e.data);else if("function_limit_reach"===u){Ke=networkUtils.returnDependencyFiles(["custom-function-notification.js"],ResourceConstants.CRMClient),qe=networkUtils.returnDependencyFiles(["custom-function-notification.css"],ResourceConstants.CRMClient),Xe=function(){Lyte.Component.render("crm-function-limit-notification",{content:e.data},"#basic")};Lyte.injectResources(Ke.concat(qe),void 0,Xe)}else if("zanalytics-integration"===u){if("notify"===Oi){var gi="crm-zanalytics-notify",fi=(Ke=networkUtils.returnDependencyFiles([gi+".js"],ResourceConstants.CRMClient),qe=networkUtils.returnDependencyFiles([gi+".css"],ResourceConstants.CRMClient),I18n.getMsg("crm.zanalytics.enable.msg")),hi=I18n.getMsg("crm.zanalytics.enable.link"),yi=I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.reports.integ.advanced.new",Crm.appName);Xe=function(){Lyte.Component.render(gi,{content:fi,title:yi,clickhere:hi},"#zAdvAnalyticNotify")};Lyte.injectResources(Ke.concat(qe),void 0,Xe)}}else if("failure_functions"===u)CustomButtonJSObjectInit.pushNotifyCx(e.action);else if("undefined"==typeof migrate||"migrationUploadComplete"!==u&&"migrationModuleCompleteNotification"!==u&&"migrationFileNotSupported"!==u&&"migrationDuplicateFileNotSupported"!==u&&"updateMigrationProgressForFile"!==u&&"migrationUploadVirusCallBack"!==u&&"migrationAborted"!==u&&"migrationAfterCompleteNotification"!==u&&"migrationInitiated"!==u&&"migrationApiAborted"!==u&&"routeToComplete"!==u&&("rollback"!==u||"Migration"!==e.type&&"Module"!==e.type)&&"sampleDataMigrationInitiated"!==u){if("migrationUploadComplete"===u||"migrationModuleCompleteNotification"===u||"migrationFileNotSupported"===u||"migrationDuplicateFileNotSupported"===u||"updateMigrationProgressForFile"===u||"migrationUploadVirusCallBack"===u||"migrationAborted"===u||"migrationAfterCompleteNotification"===u||"migrationInitiated"===u||"migrationApiAborted"===u||"routeToComplete"===u||"rollback"===u&&("Migration"===e.type||"Module"===e.type)||"sampleDataMigrationInitiated"===u){var vi;Co=window.location.pathname,wo=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/migration");(vi=e.sourcesystem?e.sourcesystem:e.message?e.message.source_system:"")&&""!==vi.trim()&&(vi=vi.toLowerCase());var Ci={};if(Ci.sourceSystem=vi,Ci.id=e.message?e.message.id:e.id?e.id:e.migrationId?e.migrationId:null,"sample"===vi&&globalSetpJson){var wi="object"==typeof globalSetpJson?globalSetpJson:JSON.parse(globalSetpJson);if("migrationAfterCompleteNotification"===u){for(bi in wi)if(void 0!==wi[bi]["Data Administration"]){wi[bi]["Data Administration"][0].array[2].array[0].setupShow=!0,wi[bi]["Data Administration"][0].array[2].array[0].migrationId=e.migrationId;break}}else if("rollback"===u){var bi;for(bi in wi)if(void 0!==wi[bi]["Data Administration"]){wi[bi]["Data Administration"][0].array[2].array[0].setupShow=!1;break}globalSetpJson=wi}}networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("datamigration")],(function(){if(Co.startsWith(wo)||"sampleDataMigrationInitiated"!==u&&"migrationUploadComplete"!==u&&"migrationAfterCompleteNotification"!==u&&"migrationAborted"!==u&&"rollback"!==u)Lyte.injectResources(networkUtils.returnDependencyFiles(["migration-util.js"],ResourceConstants.CRMClient),void 0,(function(){var t=document.querySelector("crm-dm-wizard-steps");t?Lyte.registeredMixins["migration-util"].handleWmSMessages.call(t.component,u,e,Ci):Lyte.registeredMixins["migration-util"].handleWmSMessages(u,e,Ci)})),e.message&&e.message.resource&&e.message.resource[0]&&"Users"===e.message.resource[0].module&&$L("crm-profile-menu")[0].component.actions.featureMarkCompletion("teamInvite");else{var t="",i=I18n.getMsg("crm.migration.label.DataMigration");switch(u){case"migrationUploadComplete":t=I18n.getMsg("crm.migration.extraction.complete");break;case"migrationAfterCompleteNotification":if(t=I18n.getMsg("crm.migration.complete.wms.msg"),"sample"===vi)t=I18n.getMsg("cob.sampledata.migration.completed"),i=I18n.getMsg("cob.sampledata.population"),Crm.trackSpotLightAction("COB BlankPage - Sample Data Completed"),Crm.client_tracking("COB BlankPage - Sample Data Completed");else{let t=$L("crm-profile-menu")[0];t.component.actions.featureMarkCompletion("migrateData"),"Users"===e.message.resource[0].module&&t.component.actions.featureMarkCompletion("teamInvite")}break;case"migrationAborted":t=I18n.getMsg("crm.migration.aborted.wms.msg");break;case"rollback":if("sample"===vi)Crm.client_tracking("COB BlankPage - Sample Data InProgress"),t=I18n.getMsg("crm.sampledata.rollback.wms.msg"),i=I18n.getMsg("crm.sampledata.rollback.wms.title"),crmTab.cacheObj={};else{var o=e.moduleName;if("others"===vi.toLowerCase())vi="crm.migrate.other.crm";var n=I18n.getMsg(vi);moduleRecordMapping[e.moduleName]&&(o=I18n.getMsg(moduleRecordMapping[e.moduleName].plural_label)),t="Module"===e.type?I18n.getMsg("crm.migration.rollback.module.wms.msg",[o,I18n.getMsg(vi)]):I18n.getMsg("crm.migration.rollback.wms.msg",n)}break;case"sampleDataMigrationInitiated":i=I18n.getMsg("cob.sampledata.population"),t=I18n.getMsg("cob.sample.data.population.progress"),Crm.trackSpotLightAction("COB BlankPage - Sample Data InProgress")}Ci.content=t,Ci.title=i,$("#IMPORTNOTIFICATIONPOP1").is(":visible")&&importHistory&&importHistory.closeSuccessContainer($("#IMPORTNOTIFICATIONPOP1 .migCardClose")),Lyte.injectResources(networkUtils.returnDependencyFiles(["migration-util.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["migration-util"].handleWmSMessages(u,e,Ci)}))}}))}else if("importCompleted"===u||"rollback"===u&&"Import"===e.type){At=e;networkUtils.loadFeatureScripts(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],(function(){"importCompleted"===u&&(customViewObject.module!==At.moduleName&&crmTab.deleteFromCache(At.moduleName),customViewObject.module==At.moduleName&&(customViewObject.clearonImportCompletion=!0)),"CLEARPOPUP"!==At.status&&$("#mig_notification").is(":visible")||importHistory.showCommonMsg(At)})),"translation"===e.feature&&store.findAll("module").then((function(){crmTab.reloadTabMenu()}))}else if("backupCompleted"===u){At=e;var _i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("databackup")],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-data-backup.js","crm-backup-store.js"],ResourceConstants.CRMClient)),Mi=networkUtils.returnDependencyFiles(["crm-data-backup.css"],ResourceConstants.CRMClient);_i=_i.concat(Mi),void 0===Lyte.registeredMixins["crm-backup-util"]?Lyte.injectResources(_i,void 0,(function(){Lyte.registeredMixins["crm-backup-util"].showCommonMsg(At)})):Lyte.registeredMixins["crm-backup-util"].showCommonMsg(At)}else if("exportCompleted"===u){At=e,_i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cruxnotification")],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles(["crm-export.js","crux-schedular-notification.js"],ResourceConstants.CRMClient)),Mi=networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);_i=_i.concat(Mi),void 0===Lyte.registeredMixins["crm-export-util"]?Lyte.injectResources(_i,void 0,(function(){Lyte.registeredMixins["crm-export-util"].showCommonMsg(At)})):Lyte.registeredMixins["crm-export-util"].showCommonMsg(At)}else if("Locking_Information"===u){if(e.lock_modules){for(var Ai=[],Ii=e.lock_modules.length,Li=0;Li<Ii;Li++)Ai.push(e.lock_modules[Li]);Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES=Ai}e.updated_module&&store.clearCachedQuery("record_locking_configurations",{module:e.updated_module}),e.isRefreshSetupHold&&"undefined"!=typeof CML&&(CML.lockingConfigSupportedModules=void 0,CML.setLockingConfigSupportedModules())}else if("Subform_Permissions"===u)store.findRecord("module",moduleRecordMapping[e.subformModuleName].id,void 0,void 0,!0,{getMeta:!0}).then((function(){}),(function(t){var i=t.responseText?JSON.parse(t.responseText):"";i&&"NO_PERMISSION"===i.code&&"permission denied"===i.message&&(moduleRecordMapping[e.subformModuleName].viewable=!1,moduleRecordMapping[e.subformModuleName].creatable=!1,moduleRecordMapping[e.subformModuleName].editable=!1,moduleRecordMapping[e.subformModuleName].deletable=!1)}));else if("layoutrule"===u){Ai=[];Crm.userDetails.LR_updated_mods||(Crm.userDetails.LR_updated_mods=[]);for(Li=0;Li<e.lrinvolvedmodules.length;Li++)Ai.push(e.lrinvolvedmodules[Li]);e.currentLRModule?Crm.userDetails.LR_updated_mods.push(e.currentLRModule):Crm.userDetails.LR_updated_mods=Ai,Crm.userDetails.LRINVOLVEDMODULES=Ai}else if("wizardLayoutRule"===u){var Ri=[],ki=e.wlrinvolvedmodules.length;for(Li=0;Li<ki;Li++)Ri.push(e.wlrinvolvedmodules[Li]);Crm.userDetails.WLRINVOLVEDMODULES=Ri}else if("validation_rule"===u){if(Crm.userDetails.VRINVOLVEDMODULES||(Crm.userDetails.VRINVOLVEDMODULES=[]),Crm.userDetails.VR_updated_mods||(Crm.userDetails.VR_updated_mods=[]),e.vr_created_modules){var Si=e.vr_created_modules.length;for(Li=0;Li<Si;Li++)Crm.userDetails.VRINVOLVEDMODULES.contains(e.vr_created_modules[Li])||Crm.userDetails.VRINVOLVEDMODULES.push(e.vr_created_modules[Li]),Crm.userDetails.VR_updated_mods.contains(e.vr_created_modules[Li])||Crm.userDetails.VR_updated_mods.push(e.vr_created_modules[Li])}if(e.vr_lookupcreated_modules)for(Si=e.vr_lookupcreated_modules.length,Li=0;Li<Si;Li++)Crm.userDetails.LOOKUPVRINVOLVEDMODULES.contains(e.vr_lookupcreated_modules[Li])||Crm.userDetails.LOOKUPVRINVOLVEDMODULES.push(e.vr_lookupcreated_modules[Li]);if(e.vr_funcCreated_modules)for(Si=e.vr_funcCreated_modules.length,Li=0;Li<Si;Li++)Crm.userDetails.VRFUNCINVOLVEDMODULES.contains(e.vr_funcCreated_modules[Li])||Crm.userDetails.VRFUNCINVOLVEDMODULES.push(e.vr_funcCreated_modules[Li])}else if("TranslationImportProgress"===u){di=e.message,At=null;void 0!==di&&(At=JSON.parse(di));var Ti=$("<div>");Ti.attr({id:"TranslationImportProgressDiv",class:"rItemIconDropDown from-footer pT30 pR20 pB30 pL20 crm-base-font-size crmBaseColor crm-font-regular",Style:"width: 430px;z-index:1001"}),$("body").append(Ti),null!==At?$("#TranslationImportProgressDiv").html("<div class='mL70'>"+I18n.getMsg("crm.translation.import.status.info",[At.email])+"</div>").show():networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("translation")],(function(){$("#TranslationImportProgressDiv").html("<div class='mL70'>"+I18n.getMsg("crm.sandbox.translation.import.status.info")+"</div>").show()})),setTimeout((function(){$("#TranslationImportProgressDiv").hide()}),5e3),commonUtils.showHideLoadingDiv(!1)}else if("TranslationImportDeployment"===u){var Di=$("<div>");Di.attr({id:"Division",class:"w500 pL25 pR30 pB12 pT25 newPopup",Style:"top:0;left:35%;height:auto;width:500px;z-index:1001"}),$("body").append(Di),networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("translation")],(function(){var e=I18n.getMsg("crm.translation.sandbox.import.popup.header"),t=I18n.getMsg("crm.translation.sandbox.import.popup.new.button"),i='<div class="yellowNotesDeployChanges">'+I18n.getMsg("crm.translation.sandbox.import.popup.translation"),o='<ul class="deploymentSuccessItems"><li class="deploymentSuccessList">'+I18n.getMsg("crm.translation.sandbox.import.popup.content1"),n='</li><li class="deploymentSuccessList">'+I18n.getMsg("crm.translation.sandbox.import.popup.content2")+"</li></ul></div>";!(window.location.href.indexOf("sandbox/deployments-logs")>-1)&&window.location.href.indexOf("sandbox/")>-1&&($("#Division").html(e+i+o+n+t).show(),sandbox.translationFileDeploy=!0)}));var Pi=$L("crm-sandbox-details")[0];Pi&&Pi.component&&Pi.component.setData("showDeploymentProgressBar",!1)}else if("Stickies"===u){var $i=$L("crm-sticky-container");$i.length?$i[0].component.executeMethod("handleCustomMessage",e):wmsBarInfo.isNotClientPortalUser&&Crm.userDetails.stickiesRemainderCount>0&&($("#sticky-notification-count").text(Crm.userDetails.stickiesRemainderCount).show(),isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["stickynotes",Crm.userDetails.stickiesRemainderCount]))}else if("updateHoldStatus"===e.type)ctiApiNotifier.holdNotify();else if("bestTimeReminder"===u)crmBstTime.showReminderPushNotification(e);else if("dismissBestTimeReminder"===u)crmBstTime.dismissReminderPushNotificaiton(e);else if("MultiCurrency"===u){if(Crm.userDetails.CURRENCY_DETAILS=e.currencyDetailsJSON,e.isMCEnabled&&(Crm.userDetails.IS_MULTI_CURRENCY_ENABLED=e.isMCEnabled),e.baseCurrency&&(Crm.userDetails.BASE_CURRENCY=e.baseCurrency),e.needToUpdateDefaultCurrencyDet){Crm.userDetails.defaultOrgCurrency=e.defaultOrgCurrency,Crm.userDetails.defaultRoundOff=e.defaultRoundOff,Crm.userDetails.defaultCurrencyISOCode=e.defaultCurrencyISOCode,Crm.userDetails.defaultCurrencyName=e.defaultCurrencyName;var Ni={};Ni.format=e.defaultCurrencyFormat,Ni.symbol=e.defaultOrgCurrency,Ni.defaultRoundOff=e.defaultRoundOff,Crm.userDetails.DEFAULT_ORG_CURRENCY=Ni}}else if("Multicurrency_Activation_Scheduler"===e.type){var Ei,xi,Fi,Ui=$L("#wmsstatusbar")[0];if(Ui&&!Ui.querySelector("#multiCurrencySchedulerProgressIcon"))(Ei=document.createElement("td")).setAttribute("id","multiCurrencySchedulerProgressIcon"),Ei.setAttribute("class","pR"),(xi=document.createElement("div")).setAttribute("class","cP pR crm-wms-icon pT5 w40"),xi.setAttribute("onclick","crmExportWMSMsg.showHideMcActivationSchedulerNotificationModal()"),(Fi=document.createElement("span")).setAttribute("class","svgIcons encProgressIcon activeProgress dIB"),xi.append(Fi),Ei.append(xi),Ui.querySelector("tr").prepend(Ei);var Oi,ji=[],Bi={},zi="progress"===(Oi=e.action);Bi.cxMessage=zi?I18n.getMsg("crm.multi.currency.activation.inprogress"):"success"===Oi?I18n.getMsg("crm.currency.activation.success"):I18n.getMsg("crm.currency.activation.failure",RebrandLinkUtil.getProperty("SUPPORTMAILID")),zi?Bi.cxStatus=Oi:(Bi.cxMessageYield="failure"===Oi,Bi.cxIcon=!0,Bi.cxIconClass="success"===Oi?"zcicncss-tickrounded zcicn-cssIcons zcicn_green_mask":"zcicncss-warning-rounded zcicn-cssIcons zcicn_red_mask"),ji.push(Bi),_cruxUtils.showSchedularNotification({params:{cxPropHeader:I18n.getMsg("crm.currency.activation"),cxPropMessage:ji,cxPropPreventCloseOnTimeout:!0,cxPropShowMinimizeIcon:!0},onClose:function(e,t){e=Ui.querySelector("#multiCurrencySchedulerProgressIcon");"close"===t&&e&&e.remove()}})}else if("recordLevelSharing"===u){Bi=JSON.parse(e.message),$ESAPI.encoder().encodeForHTMLAttribute(Bi.module);"success"===Bi.status&&(Bi.linkMsg="crm.schedules.viewCusInfo",Bi.link=!0),store.findRecord(moduleRecordMapping[Bi.module].id,Bi.id).then((function(e){Crm.getCanvasId(moduleRecordMapping[Bi.module].id,Bi.id)&&(Bi.canvasid=Crm.getCanvasId(moduleRecordMapping[Bi.module].id,Bi.id)),crmSchedulerNotification.addOrUpdateStatus(Bi,I18n.getMsg("crm.rls.popup.title"))}),(function(){crmSchedulerNotification.addOrUpdateStatus(Bi,I18n.getMsg("crm.rls.popup.title"))}))}else if("Data Sharing rules"===u){Bi=JSON.parse(e.message);if(Crm.userDetails.isDataSharingLyteEnabled){var Vi,Hi,Ji,Wi;if("success"===Bi.status||"error"===Bi.status)if(void 0!==(Wi=$L("crm-sharing-rules-list")[0])){var Ki=Wi.getData("visibleModules");ro=Object.keys(Ki).filter((e=>Ki[e].module.id===Bi.id))[0];var qi=Wi.getData("sharingRulesSummary");Hi=Object.keys(qi).filter((e=>qi[e].module.id===Bi.id))[0],Vi=Ki[ro],Ji=qi[Hi],Vi&&Wi.getData("visibleModules").length>ro&&(Vi.rule_computation_status=!1,Lyte.arrayUtils(Wi.getData("visibleModules"),"replaceAt",ro,Vi)),Ji&&qi.length>Hi&&(Ji.rule_computation_status=!1,Lyte.arrayUtils(Wi.getData("sharingRulesSummary"),"replaceAt",Hi,Ji));var Gi=Wi.getData("sharingRulesList")[Lyte.Component.registeredHelpers.getModuleApiNameByTabId(Bi.id)],Zi=Wi.getData("filterModule");Gi||"all_modules"!==Zi||void 0===ro||Lyte.arrayUtils(Wi.getData("visibleModules"),"removeAt",ro)}const t=Lyte.registeredMixins["crm-data-sharing-mixin"];var Yi;(Yi=networkUtils.returnDependencyFiles(["crux-schedular-notification.js"],ResourceConstants.CRMClient)).pushUniqValues(networkUtils.returnDependencyFiles(["crux-schedular-notification-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)[0]),Lyte.injectResources(Yi,void 0,(function(){t.addOrUpdateSchedulerStatusinCrux(Bi,"crm.security.sharing.rules.popup.title",e.rulesDetails)}))}else{var Xi=["sharingRulesRecalculate_"+Bi.module,"sharingRulesNew_"+Bi.module],Qi=Xi.length;if("success"===Bi.status||"error"===Bi.status){var eo=$(".sharingRuleEditActions_"+Bi.module),to=$(".sharingRuleDeleteActions_"+Bi.module),io=[];for(E=eo.length,T=0;T<E;T++)io[T]=eo.eq(T).data("ruleid"),crmui.hideTooltip(),eo.eq(T).removeClass("disableSharing").removeAttr("onmouseenter onmouseleave").attr("href","javascript:editShareRule('"+io[T]+"','"+Bi.module+"')"),to.eq(T).removeClass("disableSharing").removeAttr("onmouseenter onmouseleave").attr({href:"javascript:delShareRule('"+io[T]+"','"+Bi.module+"')",onclick:"return window.confirm('"+I18n.getMsg("crm.label.confirm.message.del.data.sharing.rule",Bi.singular_label)+"')"});for(T=0;T<Qi;T++)$("#"+Xi[T]).removeClass("disabled").removeAttr("onmouseenter onmouseleave"),crmui.hideTooltip();$("#"+Xi[0]).attr({onclick:"UserModule.showSharingRulePopUp('"+Bi.id+"','"+Bi.displayModuleName+"')"}),$("#"+Xi[1]).attr("onclick","newSharingRule('"+Bi.module+"')")}$ESAPI.encoder().encodeForHTMLAttribute(Bi.module);dsNotificationScheduler.addOrUpdateSchedulerStatus(Bi,I18n.getMsg("crm.security.sharing.rules.popup.title"),e.rulesDetails)}}else if("PFExtInstallTask"===e.type)try{"undefined"==typeof PluginNotification?networkUtils.loadFeatureScripts(["pluginNotification-lib.js"],(function(){PluginNotification.handlePluginDetailPageNotification(e)})):PluginNotification.handlePluginDetailPageNotification(e)}catch(e){try{murphy.error(e)}catch(e){}}else if("relatedRecordChangeOwner"===u){if((Bi=JSON.parse(e.message)).action&&"AutomationProcess"!=Bi.action){$ESAPI.encoder().encodeForHTMLAttribute(Bi.module);$("#picklist_pop_progress").remove(),crmSchedulerNotification.addOrUpdateStatus(Bi,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}}else if("UserDatePattern"===u)Crm.userDetails.DATE_PATTERN=e.DatePattern;else if("data-storage"===u){var oo;"storage"===(oo=Lyte.Router.getRouteInstance()).routeName&&"file"!==oo.getQueryParams().type&&oo.refresh({refreshTemplate:!0})}else if("profileDeletion"===u){Bi=JSON.parse(e.message);crmSchedulerNotification.addOrUpdateStatus(Bi,I18n.getMsg("crm.profile.transfer.delete.status"))}else if("roleDeletion"===u){Bi=JSON.parse(e.message);crmSchedulerNotification.addOrUpdateStatus(Bi,I18n.getMsg("crm.role.transfer.delete.status"))}else if("Custom_record_sharing"===u)crmSchedulerNotification.addOrUpdateStatus(e,e.header);else if("FieldUpdateOperationProgress"===u){j="entity"===Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().getDynamicParam():Lyte.Router.getRouteInstance().parent.getDynamicParam();var no=JSON.parse(e.message);if(j===no.entityID&&"id"!==j){re=Lyte.Router.getRouteInstance().transition.info;var so=$("crm-detailview-canvas")[0];if("crm.tab.module.entity.canvas"===re.route){var ro,ao=so?so.component:void 0,lo=re.dynamicParams[0],co=re.dynamicParams[1];if(no&&no.updateJsonObj&&no.updateJsonObj.LAYOUTID&&no.layOutId)crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex&&(ro=crmNavig[crmNavig.customViewKey].recordId.map((function(e){return e.id})).indexOf(Lyte.Router.getRouteInstance().parent.getDynamicParam())),Crm.getCanvasId(moduleRecordMapping[lo].id,co,no.layOutId)?Lyte.Router.replaceWith({route:"crm.tab.module.entity.canvas",dynamicParams:[lo,j,Crm.getCanvasId(moduleRecordMapping[lo].id,co,no.layOutId)]}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:ro,cvid:customViewObject.cvId,fromDel:!1,navig:!0}:Lyte.Router.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[lo,j]}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:ro,cvid:customViewObject.cvId,fromDel:!1,navig:!0};if(((mo=no.jArray)?mo.length:0)>0&&so)app.store.makeRequest("findRecord",moduleRecordMapping[lo].id,co,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}).then((function(e){ao.data&&(ao.setData("record",objectUtils.cloneObject(e[0])),Lyte.registeredMixins["crm-detailcanvas-utils"].executelayoutRuleforCurrentRec(),Lyte.registeredMixins["crm-detailcanvas-utils"].validatingCanvasRule(moduleApiMapping[so.getData("module")],e[0]))}))}if(Crm.renderDVLyteFlow(no.module,!0))Collaboration.doFieldUpdateHighlight(no,re);else{detailView.mergeJSon(detailView.dateTimeFormat,no.dateTimeFormat),detailView.mergeJSon(detailView.updateMap,no.updateJsonObj),detailView.mergeJSon(detailView.columnVsUpdateDetails,no.columnVsUpdateDetails),detailView.mergeJSon(detailView.unprocessedValueMap,no.unprocessedValuesJsonObj),detailView.mergeJSon(detailView.updatedColumnNameWithValue,no.updatedColumnNameWithValue),detailView.mergeJSon(detailView.currency,no.updatelookupJsonObj),detailView.mergeJSon(detailView.cfDatefield,no.cfDatefield),detailView.entityID=no.entityID,detailView.phoneField=no.phoneField,detailView.mergeJSon(detailView.hreFJson,no.hreFJson),detailView.fieldUpdateJson=detailView.fieldUpdateJson.concat(no.jArray),detailView.FieldUpdateAvailable=!0,detailView.mergeJSon(detailView.currency,no.currency),detailView.Currmodule=no.module,!Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()||(detailView.isPopShown=!0),Lyte.registeredMixins.kiosk_execute&&(Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&no.isKioskRefresh&&(no.isKioskRefresh.isBluePrint||no.isKioskRefresh.isCommandCenter||no.isKioskRefresh.isWaitingForApproval||no.isKioskRefresh.isLocked||no.isKioskRefresh.isConverted)&&Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0));var uo=!1;null!=re&&null!=re.queryParams&&"Tasks"==re.queryParams.sub_module&&"Activities"==detailView.Currmodule&&(uo="create"==window.Tasks.currentStatus),uo=document.domain.indexOf("localzoho.com")>0,setTimeout((function(){detailView.updateField(),detailView.body=no.scoreBody,detailView.layoutId=no.layOutId,setTimeout((function(){detailView.updateScoreField()}),1e3)}),uo?3e3:2e3)}}}else if("DelugeAvilable"===u){no=JSON.parse(e.message);"undefined"==typeof detailView&&window&&window.detailView&&(detailView=window.detailView),"object"==typeof detailView&&(detailView.isDelugeAvailable=no.isDeleugeAvailable)}else if("delugeFieldUpdate"===u){j=Lyte.Router.getRouteInstance().parent.getDynamicParam(),no=JSON.parse(e.message);if(j===no.entityID&&"id"!==j){if("crm.tab.module.entity.canvas"===(re=Lyte.Router.getRouteInstance().transition.info).route){var mo;ao=(so=$("crm-detailview-canvas")[0])?so.component:void 0,lo=re.dynamicParams[0],co=re.dynamicParams[1];if(((mo=no.delugefiledUpdateArray)?mo.length:0)>0&&ao)app.store.makeRequest("findRecord",moduleRecordMapping[lo].id,co,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}).then((function(e){ao.setData("record",objectUtils.cloneObject(e[0])),Lyte.registeredMixins["crm-detailcanvas-utils"].executelayoutRuleforCurrentRec(),Lyte.registeredMixins["crm-detailcanvas-utils"].validatingCanvasRule(moduleApiMapping[so.getData("module")],e[0])}))}if(Crm.renderDVLyteFlow(no.module,!0)){var po,go=(po="crm.tab.module.entity.canvas"===re.route?$L("crm-detailview-canvas")[0]:$L("crm-detail-view")[0]).component;(ae=Lyte.registeredMixins["crm-detailview-common-utils"]).constructFieldUpdateHighlightValues(no,go)}else void 0===detailView&&window&&window.detailView&&(detailView=window.detailView),detailView.mergeJSon(detailView.dateTimeFormat,no.dateTimeFormat),detailView.fieldUpdateJson=detailView.fieldUpdateJson.concat(no.delugefiledUpdateArray),detailView.mergeJSon(detailView.updateMap,no.updateJsonObj),detailView.mergeJSon(detailView.columnVsUpdateDetails,no.columnVsUpdateDetails),detailView.mergeJSon(detailView.unprocessedValueMap,no.unprocessedValuesJsonObj),detailView.mergeJSon(detailView.cfDatefield,no.cfDatefield),detailView.mergeJSon(detailView.updatedColumnNameWithValue,no.updatedColumnNameWithValue),detailView.phoneField=no.phoneField,detailView.mergeJSon(detailView.hreFJson,no.hreFJson),detailView.Currmodule=no.module,detailView.updateSourceFrom=u,detailView.entityID=no.entityID,detailView.isBlueprintRefreshAfterCf=no.isBlueprintRefreshAfterCf,!Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()||(detailView.isPopShown=!0),Lyte.registeredMixins.kiosk_execute&&(Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&no.isKioskRefresh&&(no.isKioskRefresh.isBluePrint||no.isKioskRefresh.isCommandCenter||no.isKioskRefresh.isWaitingForApproval||no.isKioskRefresh.isLocked||no.isKioskRefresh.isConverted)&&Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0),Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0))}}else if("MasConvert"===u)no=JSON.parse(e.message);else if("Forecast"===u){var fo=Lyte.Router.getRouteInstance();if("Forecast_Create"===e.type){At=e.message.split("::::");"crm.tab.newForecasts.create"!==fo.transition.target&&"crm.tab.newForecasts.clone"!==fo.transition.target||At[0]!==fo.currentModel.record.Forecast_Group.Forecast_Group_Name||At[1]!==fo.currentModel.record.Period_Name.id?"crm.tab.newForecasts.bread-crum"!==fo.transition.target&&"crm.tab.newForecasts.list"!==fo.transition.target||!$("#"+At[2]).length||fo.refresh():Lyte.Router.transitionTo({route:"crm.tab.newForecasts.view",dynamicParams:[At[2]]}).data={fromCreate:!0}}else if("Forecast_Refresh"===e.type&&"crm.tab.newForecasts.view"===fo.transition.target&&e.message===fo.getDynamicParam()){At={reloadAll:!0};fo.refresh().data=At}else"list"===fo.routeName&&fo.getPredictionData({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:e.forecast_id}).then((function(){for(var t=$L("crm-forecast-list-table"),i=t.length,o=0;o<i;o++){t[o].getData("forecasts").filter((function(t){return t.id===e.forecast_id||t.baseId===e.forecast_id})).forEach((function(e){var t=fo.filterPredictedData(e._parent_item_ids?store.peekRecord("forecast_data",e._parent_item_ids[0]):e.forecast_data);t&&Lyte.objectUtils(e.Forecast_result,"add","predicted_data",{amount:null!==t.Amount?t.Amount:t.Quantity,currency:null!==t.Amount?t.Amount.toString():t.Quantity.toString()})}))}}))}else if("Territory"===u&&"territory_cache_clear"!==e.type){var ho=e,yo=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("territoryOnDemandKeys")],ResourceConstants.CRM);Lyte.injectResources(yo,void 0,(function(){var e=ho.message.status,t=Lyte.Globals;if("Territory_Hierarchy_create"===ho.type){if(Crm.userDetails.TMENABLED="success"===e?1:0,"crm.settings.section.territories.index-territories"===Lyte.Router.getRouteInstance().transition.target){var i=$L("crm-territories-get-started")[0];"success"===e?(t.set("territory_role_migration_status",void 0),store.unloadAll("territory_configuration"),store.findAll("territory_configuration",{},{},!0,{version:"v5",method:"GET"}).then((function(){i.component.setData("territoryStatus",1),store.findAll("territory",{},{},!0,{makeRequest:!0,version:"v2.2"}).then((function(e){var t=[].concat(e[0]);Lyte.Component.render("crm-territory-hierarchy",{orgTerrId:e[0].id,orgTerrWithChild:t,orgTerrWithChildForDelete:objectUtils.deepClone(t,[],[],!0)},"#result"),i.component.setData("showRoleMigrationStartLoader",!1);var o=$L("#tab_usersPermi_territoryRules")[0];o&&o.setAttribute("style","{'display' : 'block'}");var n=$L("#tab_usersPermi_assignTerritory")[0];n&&n.setAttribute("style","{'display' : 'block'}"),crmLayout.Resize.Setup()}))}))):"error"===e&&(t.set("territory_role_migration_status","FAILED"),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:ho.message.details,ltPropShowCloseButton:!1,ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.reports.integ.okay"),appearance:"default"}]},accept:function(){Lyte.Router.getRouteInstance().refresh()}}))}else"error"===e&&t.set("territory_role_migration_status","FAILED");var o={status:e,message:("success"===e?I18n.getMsg("crm.territory.migartion.completed"):I18n.getMsg("crm.territory.migration.failed"))+"<span class='dB mT10 crmLabelColor wbBreakWord'>"+I18n.getMsg("crm.territory.initiated.by",$ESAPI.encoder().encodeForHTML(void 0!==i?i.getData("initiatedBy"):Crm.userDetails.DISPLAY_NAME))+"</span>"};crmSchedulerNotification.addOrUpdateStatus(o,I18n.getMsg("crm.territory.role.hierarchy.to.territory.hierarchy"))}else if("Territory_Run_Rules"===ho.type){Crm.userDetails.isTMRunRuleInProgress=!1;i=$L("crm-assign-territories")[0];var n={status:e,message:("success"===e?I18n.getMsg("crm.territory.rules.assignment.completed"):I18n.getMsg("crm.territory.rules.assignment.failed"))+"<span class='dB mT10 crmLabelColor wbBreakWord'>"+I18n.getMsg("crm.territory.initiated.by",$ESAPI.encoder().encodeForHTML(void 0!==i?i.getData("initiatedBy"):Crm.userDetails.DISPLAY_NAME))+"</span>"};crmSchedulerNotification.addOrUpdateStatus(n,I18n.getMsg("crm.territory.schedule.mail.subject.completed.rule",$ESAPI.encoder().encodeForHTML(moduleRecordMapping[ho.assigning_module].plural_label)))}else if("Territory_Assignment_for_Custom_Modules"===ho.type){var s="";switch(e){case"started":s="crm.territory.assignment.process.started",e="progress";break;case"success":s="crm.territory.assignment.process.completed";break;case"failure":s="crm.territory.assignment.process.failed"}n={status:e,message:I18n.getMsg(s)+"<span class='dB mT10 crmLabelColor wbBreakWord'>"+I18n.getMsg("crm.territory.assignment.initiated.via.initiated.by",$ESAPI.encoder().encodeForHTML(ho.scheduledBy))+"</span>"};crmSchedulerNotification.addOrUpdateStatus(n,I18n.getMsg("crm.territory.assignment.for.module",moduleRecordMapping[ho.assigning_module].plural_label))}}))}else if("widgetDataRefresh"===u){if((At=e.data).hasOwnProperty("component")&&(void 0===Crm.refWidAssocComp&&(Crm.refWidAssocComp={}),"custom_button"===At.component))Crm.refWidAssocComp={custom_button:!0}}else if("liteUserCountUpdate"===u)Crm.userDetails.LITE_USERS_COUNT=e.count;else if(u===moduleApiMapping.CalendarBookings&&Lyte.registeredMixins["crm-calendar-booking-mixin"])Lyte.registeredMixins["crm-calendar-booking-mixin"].processWmsApiRequest(e);else if("NewForecastMigration"===u&&Lyte.Router.getRouteInstance().transition.target.includes("crm.tab.forecast"))location.reload();else if("Global_Picklist_Delete"===e.action)networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("globalpicklist")],(function(){if(5===e.status||4===e.status){var t=$ESAPI.encoder().encodeForHTMLAttribute(e.fieldlabel),i={};if(5===e.status){i.message=I18n.getMsg("globalfield.delete.notification.success.msg",t);var o=$L("crm-globalfield-list")[0];if(o){for(var n=o.component.data,s=n.deleteInProgress,r=n.deleteInProgress.length,a=0;a<r;a++)e.id===s[a].id&&(Lyte.arrayUtils(s,"removeAt",a,1),r--);var l=n.globalFieldList?n.globalFieldList.length:0;l+r<n.globalpickMaxLimit?(o.component.setData("showCreateButton",!0),o.component.setData("isCreateSlotAvail",!0)):l<n.globalpickMaxLimit&&(o.component.setData("showCreateButton",!0),o.component.setData("isCreateSlotAvail",!1)),Lyte.Router.getRouteInstance("crm.settings.section.globalpicklists")&&Lyte.Router.getRouteInstance().refresh()}i.status="success"}else 4===e.status&&(i.message=I18n.getMsg("globalfield.delete.notification.error.msg",t),"fieldupdate"===e.type&&(i.message=I18n.getMsg("globalfield.delete.notification.fieldupdate.error.msg",t)),i.status="failure");crmSchedulerNotification.addOrUpdateStatus(i,I18n.getMsg("globalfield.delete.scheduler.popup.title"))}}));else if("function_failure_notify"===u){Ke=networkUtils.returnDependencyFiles(["crm-function-failure-notification.js"],ResourceConstants.CRMClient),Xe=function(){Lyte.Component.render("crm-function-failure-notification",{data:e.data},"#basic")};Lyte.injectResources(Ke,void 0,Xe)}else if("ActionCompliance"===e.type){var vo=$("crm-mass-tools");vo.length>0&&vo[0].component.setData("consent_modules",""!==e.consent_modules?e.consent_modules:[])}}else{var Co=window.location.pathname,wo=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/migration");void 0!==e.sourcesystem&&"sample"==e.sourcesystem.toLowerCase()?($("#mig_notification .titleFromToLogo").removeClass("dIB").addClass("dN"),networkUtils.loadFeatureScripts(["zohocrm_import.js",networkUtils.getI18nJSUrl("import"),networkUtils.getI18nJSUrl("datamigration")],(function(){if(globalSetpJson){var t="object"==typeof globalSetpJson?globalSetpJson:JSON.parse(globalSetpJson);if("migrationAfterCompleteNotification"===u){for(i in t)if(null!=t[i]["Data Administration"]){t[i]["Data Administration"][0].array[2].array[0].setupShow=!0,t[i]["Data Administration"][0].array[2].array[0].migrationId=e.migrationId;break}globalSetpJson=t}else if("rollback"===u){var i;for(i in t)if(null!=t[i]["Data Administration"]){t[i]["Data Administration"][0].array[2].array[0].setupShow=!1;break}globalSetpJson=t}}$("#mig_notification .titleFromToLogo").removeClass("dIB").addClass("dN")}),"object"==typeof Import)):$("#mig_notification .titleFromToLogo").removeClass("dN").addClass("dIB"),networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("datamigration"),networkUtils.getI18nJSUrl("import")],(function(){if(Co.startsWith(wo)||"sampleDataMigrationInitiated"!==u&&"migrationUploadComplete"!==u&&"migrationAfterCompleteNotification"!==u&&"migrationAborted"!==u&&"rollback"!==u)"undefined"!=typeof migrate&&migrate.handleWmSMessages(u,e);else{if(e.migrationId&&"rollback"!=u&&(wo+="/"+e.migrationId),e.migrationID&&"rollback"!=u&&(wo+="/"+e.migrationID),e.sourcesystem){var t=$("#mig_notification .fromSrc"),i=$("#migZohoCrmLogo");switch(i.addClass("dN"),t.removeClass("dN contactManagerLogo logo-crm logo-sf migOtherZohoLogo highRiseLogo pipeDriveLogo inSightlyLogo hubspotlogo logo-msdynamics maximizerCrmLogo"),e.sourcesystem.toLowerCase()){case"salesforce":t.addClass("logo-sf");break;case"msdynamics":t.addClass("logo-msdynamics");break;case"zoho":t.removeClass("dIB").addClass("dN"),i.removeClass("dN");break;case"highrise":t.addClass("highRiselogo");break;case"pipedrive":t.addClass("pipeDriveLogo");break;case"hubspot":t.addClass("hubspotlogo");break;case"insightly":t.addClass("inSightlyLogo");break;case"zcontactmanager":case"zohocontactmanager":t.addClass("contactManagerLogo");break;case"others":t.addClass("migOtherZohoLogo");break;case"maximizer":t.addClass("maximizerCrmLogo");break;case"zohobigin":t.addClass("migLogoBigin")}}var o="";if("migrationUploadComplete"===u)o=I18n.getMsg("crm.migration.extraction.complete");else if("migrationAfterCompleteNotification"===u)o=I18n.getMsg("crm.migration.complete.wms.msg"),"sample"==e.sourcesystem.toLowerCase()&&(o=I18n.getMsg("cob.sampledata.migration.completed"),$("#migCardTitleLabel").text(I18n.getMsg("cob.sampledata.population")),Crm.trackSpotLightAction("COB BlankPage - Sample Data Completed"),Crm.client_tracking("COB BlankPage - Sample Data Completed"));else if("migrationAborted"===u)o=I18n.getMsg("crm.migration.aborted.wms.msg");else if("sample"!=e.sourcesystem.toLowerCase()||"updateMigrationProgressForFile"!==u&&"sampleDataMigrationInitiated"!==u){if("rollback"===u)if("sample"==e.sourcesystem.toLowerCase())o=I18n.getMsg("crm.sampledata.rollback.wms.msg"),$("#migCardTitleLabel").text(I18n.getMsg("crm.sampledata.rollback.wms.title")),crmTab.cacheObj={};else{var n=e.moduleName,s=e.sourcesystem.toLowerCase();if("others"===s)s="crm.migrate.other.crm";var r=I18n.getMsg(s);moduleRecordMapping[e.moduleName]&&(n=I18n.getMsg(moduleRecordMapping[e.moduleName].plural_label)),o="Module"===e.type?I18n.getMsg("crm.migration.rollback.module.wms.msg",[n,r]):I18n.getMsg("crm.migration.rollback.wms.msg",r)}}else $("#migCardTitleLabel").text(I18n.getMsg("cob.sampledata.population")),o=I18n.getMsg("cob.sample.data.population.progress"),Crm.trackSpotLightAction("COB BlankPage - Sample Data InProgress"),Crm.client_tracking("COB BlankPage - Sample Data InProgress");var a=$("#mig_notification");if(a.find("#migShowBtnText, #migShowLinkText").addClass("dN"),"sample"!=e.sourcesystem.toLowerCase()){var l;if("rollback"!==u)(l=a.find("#migShowBtnText")).removeClass("dN"),l.attr("onclick","$('#mig_notification').css({bottom:'-100%'});window.open('"+wo+"');");else(l=a.find("#migShowLinkText")).removeClass("migCardLink dN"),l.css({cursor:"default"});l.text(o)}else{var c=a.find("#migShowLinkText");c.addClass("crmBaseColor").removeClass("migCardLink"),c.closest("div").eq(0).removeClass("cP"),c.text(o).removeClass("dN")}$("#IMPORTNOTIFICATIONPOP1").is(":visible")&&importHistory&&importHistory.closeSuccessContainer($("#IMPORTNOTIFICATIONPOP1 .migCardClose")),a.css({bottom:"28px",transition:"bottom 1s ease"}).show()}}))}else document.getElementById("unreadMailIds").value=e.idlist,"none"==document.getElementById("newMailCount").style.display||$("#newMailCount").hasClass("dN")?(document.getElementById("newMailCount").style.display="block",document.getElementById("newMailCount").innerHTML=e.newMailCount):document.getElementById("newMailCount").innerHTML=parseInt(document.getElementById("newMailCount").innerHTML)+e.newMailCount,document.title="("+document.getElementById("newMailCount").innerHTML+")"+originaltitle,document.getElementById("recentMailsDiv")&&"none"!=document.getElementById("rmListViewDiv").style.display&&showRecentMails(),crmplusImplTriggerActions("setNotificationCount",["mailbox",e.newMailCount]);else{var bo=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("PresentationNotification"),networkUtils.getI18nJSUrl("PredictionWmsNotification")],ResourceConstants.CRM),_o=(f=networkUtils.returnDependencyFiles(["crm-zianotification-mixin.js"],ResourceConstants.CRMClient)).concat(bo);Lyte.injectResources(_o,void 0,(function(){Lyte.registeredMixins["crm-zianotification-helper"].notifyOnWms(e.notificationJson)}))}else Crm.userDetails.MPL_MIGRATION_COMPLETED=e.isMigrationCompleted;else e.deployedFromSandbox?Crm.updatePermission(e.Moduledata):Crm.moduleInfo="object"==typeof e.Moduledata?e.Moduledata:JSON.parse(e.Moduledata)}}},Collaboration.handleTerritoryUpdateInDetailView=function(e,t,i){var o=moduleRecordMapping[t].id,n=$L("crm-assign-territory-detail-view")[0].component;if("Potentials"===t?store.pushPayload(o,{id:e,Territory:i}):store.pushPayload(o,{id:e,Territories:i}),n.getData("isDetailViewRevamp")){var s=$L("crm-detail-view")[0].component;s.setData("record",store.peekRecord(o,e)),s.setData("record_changed",!0)}n.init()},Collaboration.handleTerritoryWMSPopup=function(e,t){Lyte.injectResources(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignterritory")],ResourceConstants.CRM)).then((function(){var i=crmConstants.moduleDisplayField[t]?crmConstants.moduleDisplayField[t][0]:"Name";e=e[i];var o={status:"success",message:I18n.getMsg("crm.territory.update.success.message",[moduleRecordMapping[t].singular_label,$ESAPI.encoder().encodeForHTML(e)])};crmSchedulerNotification.addOrUpdateStatus(o,I18n.getMsg("crm.territory.update"))}))},Collaboration.handleCrossProductMessage=function(e,t){if(Crm.isWMSNotifictionForCurrentOrg(t)&&("CA"===e&&t&&t.fromEditorSave&&Lyte.triggerEvent("ZCTemplateSave",t.zcampaignid),t.module&&"LiveDesk"==t.module&&networkUtils.loadFeatureScripts(["zohocrm_visitshome.js"],(function(){CrmTracking.handleVisit(t),crmNTCWms.updateEntityStatus()})),t)){"string"==typeof t&&(t=JSON.parse(t));var i=null;for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];if(n&&"string"==typeof n&&n.startsWith("BATCH_")){i=n;break}}if(i){var s=$("#"+i).data(i);s&&s(t)}}},Collaboration.onConnect=function(){},Collaboration.openURL=function(e,t,i,o){return!0},Collaboration.handleCollabAdd=function(e,t,i,o,n){},Collaboration.handleCollabDelete=function(e,t,i,o,n){},Collaboration.handleUserAdd=function(e,t){},Collaboration.handleUserDeleted=function(e,t){},Collaboration.doFieldUpdateHighlight=function(e,t){var i=setTimeout((function(){var o;if(o="crm.tab.module.entity.canvas"===t.route?$L("crm-detailview-canvas")[0]:$L("crm-detail-view")[0]){clearTimeout(i);var n=o.component;Lyte.registeredMixins["crm-detailview-common-utils"].constructFieldUpdateHighlightValues(e,n)}else t=Lyte.Router.getRouteInstance().transition.info,Collaboration.doFieldUpdateHighlight(e,t)}),1e3)},Collaboration.isKioskCompAvail=function(){var e=$L("crm-kiosk-screen-output");return!!(e&&e.length>0)},Collaboration.handleIsOnline=function(e){},Collaboration.goOffline=function(){},Collaboration.wmsOffline=function(){};var Notifier={slider:new slide,statusQueue:new Array,notifiertimer:null,notify:function(e){var t=document.getElementById("ztinotifier");if(Notifier.slider.setObjName("slider"),"block"!==t.style.display){t.style.display="block";try{t.style.zIndex=WindowHandler.zoom+5}catch(e){}Notifier.construct(e);Notifier.slider.setHeightParams(0,105,0,0),Notifier.slider.down("ztinotifier")}else Notifier.statusQueue.push(e)},close:function(){Notifier.slider.setObjName("slider"),"block"===document.getElementById("ztinotifier").style.display&&(Notifier.slider.finishShrinkWith("Notifier.hide()"),Notifier.slider.up("ztinotifier"))},clear:function(){null!==Notifier.notifiertimer&&void 0!==Notifier.notifiertimer&&(clearTimeout(Notifier.notifiertimer),Notifier.close())},hide:function(){if(document.getElementById("ztinotifier").style.display="none",Notifier.statusQueue.length>0){var e=Notifier.statusQueue.splice(0,1);Notifier.notify(e)}},construct:function(e){var t=document.getElementById("ztinotifier");$(t).empty(),t.innerHTML=e}},ztiNotifier={ztiCallNotification:function(e){var t=e.calltype;Notifier.close();var i='<table width="95%" cellpadding="0" cellspacing="0" style="background-color: #fff7dd;border: 1px solid #f8a300; padding-bottom:5px; padding-left:5px; font-size: var(--crm-extra-medium-font-size);"><tr><td style="text-align:right;"><span style="font-weight:bold; cursor:pointer;" onClick="Notifier.close()" title="Close">[X]</span></td></tr><tr><td style="padding-right:5px;"><div  style="margin-right:15px;"><div style="float:left;"><img src="'+networkUtils.getImageUrl("phone_zti.gif",ResourceConstants.CRM)+'" align="absbottom" /></div><div style="float:right;"></div>',o=e.opr,n=e.isContact,s=Crm.getCrmBasePath()+"/ShowEntityInfo.do?module="+e.crmmodule+"&id="+e.id+"&isload=true";if(!0===n||"true"===n){var r="",a="";"null"===e.callthru&&null===e.callthru||void 0===e.callthru||(a=t&&"incoming"===t?'<div><label style="text-align:left; margin-left:20px;"> '+e.callthru+" : </label><b>"+e.fromNumber+"</b></div>":'<div><label style="text-align:left; margin-left:20px;"> '+e.callthru+" : </label><b>"+e.toNumber+"</b></div>"),"null"===e.email&&null===e.email||void 0===e.email||""===e.email||(r='<div><label style="text-align:left; margin-left:20px;">Email : </label><b>'+e.email+"</b></div>"),"newcall"===o&&"incoming"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a></b></div>"+r+a:"newcall"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Calling </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a></b></div>"+r+a:"handlenewcall"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a></b></div>"+r+a:"callconnected"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Call Connected to </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a></b></div>"+r+a:"callended"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call to </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a> is Ended</b></div>"+r+a:"callended"===o&&"incoming"===t&&(i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call from </label><b><a href="'+s+'" target="_blank">'+e.entityName+"</a> is Ended</b></div>"+r+a),i+='<div style="margin-left:20px"><b><a target="_blank" href="'+(Crm.getCrmBasePath()+"/Create.do?module=Calls&id="+e.id+"&relmodule="+e.crmmodule+"&pop=pop&calltype="+t)+'">Log the Call.</a></b></div>',i+="</div>"}else"newcall"===o?i+="outgoing"===t?'<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Outgoing call to <b>'+e.toNumber+"</b></div>":'<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from <b>'+e.fromNumber+"</b></div>":"handlenewcall"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from <b>'+e.fromNumber+"</b></div>":"callconnected"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Call Connected to </label><b>'+e.toNumber+"</b></div>":"callended"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call to </label><b>'+e.toNumber+" is Ended</b></div>":"callended"===o&&"incoming"===t&&(i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call from </label><b>'+e.fromNumber+" is Ended</b></div>"),i+="</div>";i+="</td></tr></table>",Notifier.notify(i)}},_acsop=/opera|opera 5|opera\/5/i.test(navigator.userAgent),_acsie=!_acsop&&/msie/i.test(navigator.userAgent),_acsextn=".acs",_acscontext="/crm",AcsApi={NotificationTypes:{ALL:1,ATMENTIONED:2,FLAGGED:3,PROJECTBASED:4}},AcsCallBack={};if(null==AcsResource)var AcsResource={};function Activity(e){this._jobj=e;var t=e.comments;if(this.comments=new Array,null!=t)for(var i=void 0!==window[this._jobj.prd].Comment,o=t.length-1;o>=0;o--)i?this.comments.push(new window[this._jobj.prd].Comment(new Comment(t[o]))):this.comments.push(new Comment(t[o]));this.getAOwner=function(){return this._jobj.aowner},this.getLAOwner=function(){return this._jobj.laowner},this.getASUsers=function(){return this._jobj.asusers},this.getCFUsers=function(){return this._jobj.cfusers},this.getLAType=function(){return this._jobj.latype},this.getLATitle=function(e,t){if(null!=this._jobj.latitle)return AcsApi.localizeI18NString(this._jobj.latitle,this._jobj.prd,e,t)},this.getPrd=function(){return this._jobj.prd},this.getAccFrom=function(){return this._jobj.accFrom},this.isAccFromMobile=function(){return null!=this._jobj.accFrom&&("IOS"==this._jobj.accFrom||"AND"==this._jobj.accFrom)},this.isPrivate=function(){return this._jobj.private},this.getFDK=function(){return this._jobj.fdk},this.getSkey=function(){return this._jobj.skey},this.getTitle=function(e,t){return AcsApi.localizeI18NString(this._jobj.title,this._jobj.prd,e,t)},this.getType=function(){return this._jobj.type},this.getContent=function(){return this._jobj.contents},this.getTime=function(){return this._jobj.time},this.getTotalComments=function(){return this._jobj.tccount},this.getPoll=function(){return this._jobj.poll},this.getPollResult=function(){return this._jobj.pollresult},this.hasLikes=function(){try{return null!=this._jobj.poll.LIKE.like}catch(e){return!1}},this.getLikesCount=function(){try{return this._jobj.pollresult.LIKE.like}catch(e){}return 0},this.getComments=function(){return this.comments},this.getCMore=function(){return this._jobj.cmore},this.getAdditionalProperty=function(e){return this._jobj["ap_"+e]},this.getAdditionalPropertyStartsWith=function(e){var t={};for(var i in this._jobj)0==i.indexOf("ap_"+e)&&(t[i.replace("ap_","")]=this._jobj[i]);return t}}function ACSActivityException(e,t){this._prd=e,this._err=t,this.getErrorTitle=function(){if(null!=this._err.title)return AcsApi.localizeI18NString(this._err.title,this._prd)},this.getErrorMessage=function(){if(null!=this._err.message)return AcsApi.localizeI18NString(this._err.message,this._prd)},this.getAdditionalProperty=function(e){return this._err["ap_"+e]}}function Comment(e){this._cmt=e,this.getType=function(){return this._cmt.type},this.getAccFrom=function(){return this._cmt.accFrom},this.isAccFromMobile=function(){return null!=this._cmt.accFrom&&("IOS"==this._cmt.accFrom||"AND"==this._cmt.accFrom)},this.getCkey=function(){return this._cmt.ckey},this.getCFDK=function(){return this._cmt.cfdk},this.getAt=function(){return this._cmt.at},this.getContent=function(){return this._cmt.contents},this.getPostedBy=function(){return this._cmt.by},this.getAdditionalProperty=function(e){return this._cmt["ap."+e]}}function UnsNotification(e,t){this.prd=t,this._ntfn=e,this.getType=function(){return this._ntfn.type},this.getActionOwner=function(){return this._ntfn.aowner},this.getRepeatCount=function(){return this._ntfn.repCount},this.getRepeatUsers=function(){return this._ntfn.repUsers},this.getTime=function(){return this._ntfn.time},this.getSublist=function(){for(var e=this._ntfn.sublist||[],t=[],i=0,o=e.length;i<o;i++)t.push(new UnsNotification(e[i],this.prd));return t},this.isNew=function(){return null!=this._ntfn.isNew&&this._ntfn.isNew},this.getAccFrom=function(){return this._ntfn.accFrom},this.isAccFromMobile=function(){return null!=this._ntfn.accFrom&&("IOS"==this._ntfn.accFrom||"AND"==this._ntfn.accFrom)},this.getInfo=function(e,t){return AcsApi.localizeI18NString(this._ntfn.info,this.prd,e,t)},this.getAdditionalProperty=function(e){return this._ntfn["ap_"+e]},this.getSkey=function(){return this._ntfn.skey},this.getProperty=function(e){return this._ntfn[this.getType()+"."+e]}}function PollResult(e){this._presult=e,this.getFDK=function(){return this._presult.fdk},this.getType=function(){return this._presult.type},this.getPrd=function(){return this._presult.prd},this.getPollName=function(){return this._presult.poll},this.getVotes=function(){return this._presult.votes}}function AcsConnect(){}AcsApi.isMobile=function(){try{if(navigator&&navigator.userAgent)return navigator.userAgent.match(/iphone|ipod|iphone/i)||navigator.userAgent.match(/Android/i)}catch(e){return!1}},AcsApi.init=function(e,t,i){AcsApi.renderProgressive=!0,AcsApi.viewlist=new Object,AcsResource.init(),AcsApi.prd=e,AcsApi.csrfParam=t,AcsApi.csrfCookieName=i,AcsApi.isMobile()&&(AcsApi.renderProgressive=!1)},AcsApi.getCSRF=function(){return AcsApi.csrfParam+"="+AcsUtil.Cookie.getCustomCookie(AcsApi.csrfCookieName)},AcsApi.getCkey=function(){return null!=AcsApi.ckey||null!=AcsUtil.getPrd()&&(AcsApi.ckey=AcsUtil.getPrd()+"_DNFY"),AcsApi.ckey},AcsApi.handleServerUP=function(){for(viewKey in AcsDesktopNotification.isOwner()&&AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),AcsUtil.getRawSid(),1e4),AcsApi.viewlist)AcsApi.autoCorrect(viewKey);try{window[AcsApi.prd].onAcsConnect()}catch(e){}},AcsApi.handleServerDown=function(){try{window[AcsApi.prd].onAcsDisconnect()}catch(e){}},AcsApi.initStream=function(e,t,i){var o="viewkey="+encodeURIComponent(t),n={viewkey:t,prd:e};null!=i&&(o=o+"&count="+i),AcsApi.renderProgressive?(o+="&progressive=true",AcsConnect.httpProgressive("initprogressivestream",_acscontext+"/viewdata"+_acsextn,o,n)):AcsConnect.httpPost("initstream",_acscontext+"/viewdata"+_acsextn,o,n)},AcsApi.getComments=function(e,t,i,o,n,s){var r="viewkey="+encodeURIComponent(e)+"&skey="+encodeURIComponent(t)+"&fdk="+encodeURIComponent(i)+"&cmore="+encodeURIComponent(o),a={viewkey:e,skey:t,fdk:i,cmore:o,satt:s};null!=n&&(r=r+"&count="+n),AcsConnect.httpPost("getcomments",_acscontext+"/getcomment"+_acsextn,r,a)},AcsApi.showMore=function(e,t,i){if(null==AcsApi.viewlist[t])throw new Error("ViewKey not initialized, Call initStream");var o=AcsApi.viewlist[t].morekey;if(null==o)throw new Error("No data available in the server for this view Key");var n="viewkey="+encodeURIComponent(t)+"&morekey="+encodeURIComponent(o);null!=i&&(n=n+"&count="+i);var s={viewkey:t,prd:e};AcsApi.renderProgressive?(n+="&progressive=true",AcsConnect.httpProgressive("showmoreprogressive",_acscontext+"/smdata"+_acsextn,n,s)):AcsConnect.httpPost("showmore",_acscontext+"/smdata"+_acsextn,n,s)},AcsApi.isMoreAvailable=function(e){try{return null!=AcsApi.viewlist[e].morekey}catch(e){return!0}},AcsApi.autoCorrect=function(e){if(null!=e){var t=AcsApi.viewlist[e].skey;if(null!=t){var i="viewkey="+encodeURIComponent(e)+"&skey="+encodeURIComponent(t)+"&count=25",o={viewkey:e,prd:AcsApi.viewlist[e].prd};AcsConnect.httpPost("autocorrect",_acscontext+"/autocorrect"+_acsextn,i,o)}}},AcsApi.timeline=function(e,t,i,o,n,s,r){if(null!=t){var a="viewkey="+encodeURIComponent(t)+"&count="+i,l={viewkey:t,prd:e,name:o};null!=n&&(a=a+"&start="+n,l.start=n),null!=s&&(a=a+"&end="+s,l.end=s),null!=r&&(a=a+"&skey="+encodeURIComponent(r)),AcsConnect.httpPost("timeline",_acscontext+"/timeline"+_acsextn,a,l)}},AcsApi.getBadgeCount=function(e,t){if(null!=e){var i="nfchannel="+encodeURIComponent(e),o={};null!=t&&(o.smsg=t),AcsConnect.httpPost("getbadge",_acscontext+"/getbadge"+_acsextn,i,o)}},AcsApi.getCrossProductBadgeCount=function(e){var t={};null!=e&&(t.smsg=e),AcsConnect.httpPost("getcpnbadge",_acscontext+"/getcpnbadge"+_acsextn,"nfchannel=CPN",t)},AcsApi.getNotificationList=function(e,t,i,o,n,s,r,a){if(null!=e){null==t&&(t="30");var l="nfchannel="+encodeURIComponent(e)+"&count="+t,c=!1,d=!1,u=!1,m={};o&&(m.renderType=o),null!=i&&(m.renderType="more",l=l+"&morekey="+encodeURIComponent(i),null!=n&&(l=l+"&lbrtime="+n)),null!=s&&(l=l+"&sublist="+s),r==AcsApi.NotificationTypes.ATMENTIONED?c=!0:r==AcsApi.NotificationTypes.FLAGGED?d=!0:r==AcsApi.NotificationTypes.PROJECTBASED&&(u=!0),l=l+"&ismentioned="+c+"&isflaged="+d+"&isscoped="+u,null!=a&&(l=l+"&scope="+a),AcsConnect.httpPost("getntfnlist",_acscontext+"/getntfnlist"+_acsextn,l,m)}},AcsApi.getUnReadNotificationList=function(e,t,i,o,n,s,r,a){if(null!=e){null==t&&(t="30");var l="nfchannel="+encodeURIComponent(e)+"&count="+t,c=!1,d=!1,u=!1,m={};o&&(m.renderType=o),null!=i&&(m.renderType="more",l=l+"&morekey="+encodeURIComponent(i),null!=n&&(l=l+"&lbrtime="+n)),null!=s&&(l=l+"&sublist="+s),r==AcsApi.NotificationTypes.ATMENTIONED?c=!0:r==AcsApi.NotificationTypes.FLAGGED?d=!0:r==AcsApi.NotificationTypes.PROJECTBASED&&(u=!0),l=l+"&ismentioned="+c+"&isflaged="+d+"&isscoped="+u+"&isunread="+!0,null!=a&&(l=l+"&scope="+a),AcsConnect.httpPost("getntfnlist",_acscontext+"/getntfnlist"+_acsextn,l,m)}},AcsApi.resetBadgeCount=function(e){if(null!=e){var t="nfchannel="+encodeURIComponent(e);AcsConnect.httpPost("resetbadge",_acscontext+"/resetbadge"+_acsextn,t)}},AcsApi.invoke=function(e,t,i,o,n,s,r){var a={viewkey:t,prd:e,fdk:i,type:o,action:n};if(null!=r){r.action=_acscontext+"/invoke"+_acsextn,r.target="acsif_"+i;var l,c=document.createElement("IFRAME");for(var d in c.name="acsif_"+i,c.style.display="none",c.onload=function(){AcsConnect.handleHttpPost("invoke",this.contentWindow.document.body.innerHTML,a)},a.restype="html",a){var u=document.createElement("INPUT");u.type="hidden",u.name=d,u.value=a[d],r.appendChild(u)}r.appendChild(c),(l=document.createElement("INPUT")).type="hidden",l.name="data",l.value=JSON.stringify(s),r.appendChild(l),(l=document.createElement("INPUT")).type="hidden",l.name=AcsApi.csrfParam,l.value=AcsUtil.Cookie.getCustomCookie(AcsApi.csrfCookieName),r.appendChild(l),r.submit()}else{var m="restype=json&type="+o+"&fdk="+encodeURIComponent(i)+"&action="+n+"&data="+encodeURIComponent(JSON.stringify(s));AcsConnect.httpPost("invoke",_acscontext+"/invoke"+_acsextn,m,a)}},AcsApi.handlePush=function(e,t){var i=t.module,o=t.uns,n=t.cpn;if(null!=o)if(o.ntfn)try{var s=new UnsNotification(o.ntfn,o.prd);AcsCallBack.handleNotification(o.prd,o.badgeCount,s)}catch(e){}else AcsCallBack.handleNotification(o.prd,o.badgeCount);if(null!=n)try{AcsCallBack.handleCrossProductNotification(n.prd,n.origin,n.badgeCount)}catch(e){}if("acs"==i)for(var r in t.viewlist)AcsCallBack.handlePushActivity(r,t.viewlist[r],t.activity);else if("poll"==i)try{for(var r in AcsCallBack.handlePushPollResult(void 0,void 0,t.pollresult),t.viewlist)AcsCallBack.handlePushPollResult(r,t.viewlist[r],t.pollresult)}catch(e){}else if("delete"==i)for(var r in t.viewlist)AcsCallBack.handlePushDelete(r,t.viewlist[r],t.deldetails)},AcsApi.handleCallBack=function(e,t,i){try{switch(e){case"initstream":AcsCallBack.handleInitStream(i.prd,i.viewkey,t.skey,t.morekey,t.sno,t.list);break;case"showmore":AcsCallBack.handleShowMore(i.prd,i.viewkey,t.morekey,t.list);break;case"autocorrect":AcsCallBack.handleAutoCorrect(i.prd,i.viewkey,t.skey,t.sno,t.list,t.reset,t.morekey);break;case"timeline":AcsCallBack.handleTimeline(i.prd,i.viewkey,i.name,i.start,i.end,t.list,t.morekey);break;case"getbadge":AcsCallBack.handleNotification(t.prd,t.uns,void 0,i.smsg);break;case"getcpnbadge":for(c in t.cpn)AcsCallBack.handleCrossProductNotification(t.prd,t.cpn[c].origin,t.cpn[c],i.smsg);break;case"getntfnlist":AcsCallBack.handleNotificationList(t.prd,t.ntfnlist,t.nfchannel,t.ntfnbadge,i.renderType,t.reset,t.morekey,t.lbrtime,t.ntfntype,t.isunread);break;case"resetbadge":AcsCallBack.handleNotification(t.prd,t.uns);break;case"invoke":AcsCallBack.handleInvoke(i.viewkey,i.prd,i.fdk,i.type,i.action,t);break;case"getcomments":AcsCallBack.handleGetComments(i.viewkey,t.fdk,t.cmore,t.prd,t.type,t.comments,t.tccount,i.satt)}}catch(e){throw e}},AcsApi.handleCallBackError=function(e,t,i){try{var o=new ACSActivityException(i.prd,t);if("invoke"===e)AcsCallBack.handleInvokeError(i.viewkey,i.prd,i.fdk,i.type,i.action,o)}catch(e){throw e}},AcsApi.handleProgressiveCallBack=function(e,t,i,o,n){try{switch(i){case"initprogressivestream":if("chunk"==t){var s=o;AcsCallBack.handleInitProgressiveStream(e,n.prd,n.viewkey,s.chunk,s.data)}else if("full"==t)for(var r=0;r<o.length;r++){s=o[r];AcsCallBack.handleInitProgressiveStream(0==r,n.prd,n.viewkey,s.chunk,s.data)}break;case"showmoreprogressive":if("chunk"==t){s=o;AcsCallBack.handleShowMoreProgressive(e,n.prd,n.viewkey,s.chunk,s.data)}else if("full"==t)for(r=0;r<o.length;r++){s=o[r];AcsCallBack.handleShowMoreProgressive(0==r,n.prd,n.viewkey,s.chunk,s.data)}}}catch(e){throw e}},AcsApi.localizeString=function(e,t){return AcsResource.getRealValue(e,t)},AcsApi.localizeI18NString=function(e,t,i,o){try{i=null==i?"":i;var n=!0;null!=o&&1==o&&(n=!1);var s=e;"string"==typeof e&&(s=JSON.parse(e));var r=s.iprops,a=new Array,l=0;for(d in r)if("object"==typeof r[d]){var c=r[d].defaultvalue;if(n){var u=window[t].I18NString.getString(r[d].type,r[d].props);""!=u&&null!=u&&(c=u)}a[l++]=c}return AcsResource.getRealValue(s.istr+i,a)}catch(e){}return e},AcsApi.setLocale=function(e,t){AcsResource.fetchResource(e,t)},AcsCallBack.handleInitProgressiveStream=function(e,t,i,o,n){if(e)try{window[t]._View.init(i)}catch(e){}if(null!=o)if("seq"==o)try{var s=new Activity(n),r=void 0!==window[s.getPrd()].Activity?new(window[s.getPrd()].Activity)(s):s;window[s.getPrd()][s.getType()].render("initstream",i,r,!0)}catch(e){}else if("meta"==o){var a={morekey:n.morekey,skey:n.skey,sno:n.sno,prd:t};if(AcsApi.viewlist[i]=a,"0"==n.size){try{window[t]._View.nodata(i)}catch(e){}return}try{window[t]._View.completed(i,n.size)}catch(e){}}},AcsCallBack.handleInitStream=function(e,t,i,o,n,s){var r={morekey:o,skey:i,sno:n,prd:e};AcsApi.viewlist[t]=r;try{window[e]._View.init(t)}catch(e){}if(0!=s.length){for(var a=0;a<s.length;a++)try{var l=new Activity(s[a]),c=void 0!==window[l.getPrd()].Activity?new(window[l.getPrd()].Activity)(l):l;window[l.getPrd()][l.getType()].render("initstream",t,c,!0)}catch(e){}try{window[e]._View.completed(t,s.length)}catch(e){}}else try{window[e]._View.nodata(t)}catch(e){}},AcsCallBack.handleGetComments=function(e,t,i,o,n,s,r,a){for(var l=new Array,c=void 0!==window[o].Comment,d=s.length-1;d>=0;d--)c?l.push(new window[o].Comment(new Comment(s[d]))):l.push(new Comment(s[d]));window[o][n].renderComments(e,t,i,l,r,a)},AcsCallBack.handleShowMoreProgressive=function(e,t,i,o,n){if(e)try{window[t]._View.initShowMore(i)}catch(e){}if(null!=o)if("seq"==o)try{var s=new Activity(n),r=void 0!==window[s.getPrd()].Activity?new(window[s.getPrd()].Activity)(s):s;window[s.getPrd()][s.getType()].render("showmore",i,r,!0)}catch(e){}else if("meta"==o){AcsApi.viewlist[i].morekey=n.morekey;try{window[t]._View.completedShowMore(i,n.size)}catch(e){}}},AcsCallBack.handleShowMore=function(e,t,i,o){AcsApi.viewlist[t].morekey=i;try{window[e]._View.initShowMore(t)}catch(e){}for(var n=0;n<o.length;n++)try{var s=new Activity(o[n]),r=void 0!==window[s.getPrd()].Activity?new(window[s.getPrd()].Activity)(s):s;window[s.getPrd()][s.getType()].render("showmore",t,r,!0)}catch(e){}try{window[e]._View.completedShowMore(t,o.length)}catch(e){}},AcsCallBack.handleAutoCorrect=function(e,t,i,o,n,s,r){if(AcsApi.viewlist[t].skey!=i||AcsApi.viewlist[t].sno!=o){if("true"==s)try{window[e]._View.init(t)}catch(e){}AcsApi.viewlist[t].skey=i,AcsApi.viewlist[t].sno=o,r&&(AcsApi.viewlist[t].morekey=r);for(var a=n.length-1;a>=0;a--)try{var l=new Activity(n[a]),c=void 0!==window[l.getPrd()].Activity?new(window[l.getPrd()].Activity)(l):l;window[l.getPrd()][l.getType()].render("autocorrect",t,c,!1)}catch(e){}}},AcsCallBack.handleTimeline=function(e,t,i,o,n,s,r){for(var a=new Array,l=0;l<s.length;l++)try{var c=new Activity(s[l]),d=void 0!==window[c.getPrd()].Activity?new(window[c.getPrd()].Activity)(c):c;a.push(d)}catch(e){}try{window[e]._View.renderTimeline(t,i,o,n,a,r)}catch(e){}},AcsCallBack.handleCrossProductNotification=function(e,t,i){try{window[e].Uns.handleCrossProductBadge(t,i)}catch(e){console.log(e)}},AcsCallBack.handleNotification=function(e,t,i,o){try{if(window[e].Uns.handleBadge(t,o,i),null!=i){if(null==AcsUtil.getPrd()||null==AcsUtil.getRawSid())return;var n=AcsUtil.Cookie.get(AcsApi.getCkey());""!=n&&n!=AcsUtil.getRawSid()||(window[e].Uns.handleDesktopNotification(i),AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),AcsUtil.getRawSid(),1e4))}}catch(e){}},AcsCallBack.handleNotificationList=function(e,t,i,o,n,s,r,a,l,c){try{if(s&&1==s)try{window[e]._View.initNotification(i)}catch(e){}for(var d=new Array,u=0;u<t.length;u++)d.push(new UnsNotification(t[u],e));"new"==n&&(d=d.reverse()),c&&"true"==c?window[e].Uns.renderNotificationList(n,d,i,o,r,a,l,c):window[e].Uns.renderNotificationList(n,d,i,o,r,a,l)}catch(e){}},AcsCallBack.handleInvoke=function(e,t,i,o,n,s){try{window[t][o].handleAction(e,n,i,s)}catch(e){}},AcsCallBack.handleInvokeError=function(e,t,i,o,n,s){try{window[t][o].handleActionError(e,n,i,s)}catch(e){}},AcsCallBack.handlePushActivity=function(e,t,i){try{var o=new Activity(i),n=void 0!==window[o.getPrd()].Activity?new(window[o.getPrd()].Activity)(o):o;if(window[o.getPrd()][o.getType()].renderNotification(e,n,!0),null==AcsApi.viewlist[e])return;if(AcsApi.viewlist[e].sno<t-1)return void AcsApi.autoCorrect(e);AcsApi.viewlist[e].skey=n.skey,AcsApi.viewlist[e].sno=t,window[o.getPrd()][o.getType()].render("push",e,n,!1)}catch(e){}},AcsCallBack.handlePushPollResult=function(e,t,i){if(null==e||null!=AcsApi.viewlist[e]){null!=e&&null!=t&&(AcsApi.viewlist[e].sno=t);var o=new PollResult(i);try{window[o.getPrd()][o.getType()].updatePoll(e,o)}catch(e){}}},AcsCallBack.handlePushDelete=function(e,t,i){if(null!=AcsApi.viewlist[e]){AcsApi.viewlist[e].sno=t;try{window[i.prd][i.type].handleDelete(i.deltype,e,i.fdk,i.cfdk)}catch(e){}}},AcsResource.init=function(){null==AcsResource.resourceobject&&(AcsResource.resourceobject=new Object)},AcsResource.fetchResource=function(e,t){var i="lang="+e;null!=t&&""!=t&&(i+="&rebrand="+t);var o=AcsConnect.syncHttpPost(_acscontext+"/getresource"+_acsextn,i),n=JSON.parse(o);null!=n[0].objString&&null!=n[0].objString?AcsResource.resourceobject=JSON.parse(n[0].objString):AcsResource.resourceobject=n[0].objString},AcsResource.getRealValue=function(e,t){try{var i="";if(null==this.resourceobject[""+e]||null==this.resourceobject[""+e])try{i=null==opener.AcsResource.resourceobject[""+e]||null==opener.AcsResource.resourceobject[""+e]?e:opener.AcsResource.resourceobject[e]}catch(t){i=e}else i=this.resourceobject[e];return i=i.replace(/_/g," "),null==t||0==t.length?i:i=AcsResource.replaceParams(i,t)}catch(e){}try{return e.replace(/_/g," ")}catch(e){return""}},AcsResource.replaceParams=function(e,t){for(var i=0;i<t.length;i++){var o=t[i],n=new RegExp("\\$"+(i+1),"g");e=e.replace(n,o)}return e},AcsConnect.getRequest=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e},AcsConnect.httpPost=function(e,t,i,o){var n=AcsConnect.getRequest();n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var s=AcsApi.getCSRF();i=i?i+"&"+s:s,n.send(i),n.onreadystatechange=function(){4==n.readyState&&AcsConnect.handleHttpPost(e,n.responseText,o)}},AcsConnect.httpProgressive=function(e,t,i,o){(new Date).getTime();var n=AcsConnect.getRequest();n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var s=AcsApi.getCSRF();i=i?i+"&"+s:s,n.send(i);var r=0;n.onreadystatechange=function(){if(3==n.readyState){var t="[]";try{for((i=n.responseText).lastIndexOf(",")==i.length-1&&(i=i.substring(0,i.length-1)),t=JSON.parse("["+i+"]");r<t.length;)AcsApi.handleProgressiveCallBack(0==r,"chunk",e,t[r],o),r++}catch(e){}}else if(4==n.readyState)try{var i;(i=n.responseText).lastIndexOf(",")==i.length-1&&(i=i.substring(0,i.length-1)),t=JSON.parse("["+i+"]");try{for(;r<t.length;)AcsApi.handleProgressiveCallBack(0==r,"chunk",e,t[r],o),r++}catch(i){AcsApi.handleProgressiveCallBack(!0,"full",e,t,o)}}catch(e){}}},AcsConnect.syncHttpPost=function(e,t){var i=AcsConnect.getRequest();i.open("POST",e,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.setRequestHeader("Content-length",t.length),i.setRequestHeader("Connection","close");var o=AcsApi.getCSRF();if(t=t?t+"&"+o:o,i.send(t),200==i.status)return i.responseText},AcsConnect.handleHttpPost=function(e,t,i){try{var o;"error"==(o=JSON.parse(t))[0].objType?AcsApi.handleCallBackError(e,o[0].objString,i):AcsApi.handleCallBack(e,o[0].objString,i)}catch(e){}},AcsDesktopNotification={},AcsDesktopNotification.hasOwnerAssigned=!1,AcsDesktopNotification.setOwnerCookie=function(e,t,i){AcsDesktopNotification.hasOwnerAssigned=!0,AcsUtil.Cookie.set(e,t,i)},AcsDesktopNotification.init=function(){_acsie?document.attachEvent("onclick",AcsDesktopNotification.reqPerm):document.addEventListener("click",AcsDesktopNotification.reqPerm,!0),AcsDesktopNotification.syncOwner()},AcsDesktopNotification.reqPerm=function(){try{"webkitNotifications"in window?0!=window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission():"Notification"in window&&"granted"!==Notification.permission&&Notification.requestPermission()}catch(e){}},AcsDesktopNotification.show=function(e,t,i,o,n,s){try{try{AcsDesktopNotification.close()}catch(e){}"webkitNotifications"in window?(AcsDesktopNotification.nobj=window.webkitNotifications.createNotification(e,t,i),AcsDesktopNotification.nobj.show()):"Notification"in window&&(AcsDesktopNotification.nobj=new Notification(t,{dir:"auto",body:i,tag:"acs",icon:e})),AcsDesktopNotification.nobj.onclick=function(){try{window.focus(),void 0!==s&&window[n].Uns.handleNotificationClick(s),AcsDesktopNotification.close()}catch(e){}},AcsDesktopNotification.closetimer=setTimeout((function(){AcsDesktopNotification.close()}),1e3*o)}catch(e){}},AcsDesktopNotification.close=function(){try{clearTimeout(AcsDesktopNotification.closetimer),"webkitNotifications"in window?AcsDesktopNotification.nobj.cancel():"Notification"in window&&AcsDesktopNotification.nobj.close()}catch(e){}},AcsDesktopNotification.syncOwner=function(){if(setTimeout((function(){AcsDesktopNotification.syncOwner()}),4e3),this.isOwner()){var e=AcsUtil.Cookie.get(AcsApi.getCkey());AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),e,1e4)}},AcsDesktopNotification.isOwner=function(){try{if(!AcsDesktopNotification.hasOwnerAssigned)return!0;if(null==AcsUtil.getPrd()||null==AcsUtil.getRawSid())return!1;var e=AcsUtil.Cookie.get(AcsApi.getCkey());return""!=e&&e==AcsUtil.getRawSid()}catch(e){return!1}},_acsie?window.attachEvent("onbeforeunload",(function(){AcsUtil.Cookie.remove(AcsApi.getCkey())})):window.addEventListener("onbeforeunload",(function(){AcsUtil.Cookie.remove(AcsApi.getCkey())}));var globalparam,AcsUtil={getPrd:function(){return"undefined"!=typeof WebMessanger?WebMessanger.getPrd():WmsLite.prd},getRawSid:function(){return"undefined"!=typeof WebMessanger?WebMessanger.getRawSid():WmsLite.rsid},Cookie:{get:function(e){if(null!=AcsUtil.getPrd()){e=AcsUtil.getPrd()+e;var t=document.cookie.indexOf(e),i=document.cookie.length,o=null;if(-1!=t){var n=t+e.length;-1!=(o=document.cookie.substr(n+1,i)).indexOf(";")&&(o=o.substring(0,o.indexOf(";")))}return o&&decodeURIComponent(o)||""}},set:function(e,t,i){if(void 0!==t&&void 0!==e&&null!=AcsUtil.getPrd()){e=AcsUtil.getPrd()+e;var o=new Date;return null!=i&&""!=i||(i=2592e6),o.setTime(o.getTime()+i),document.cookie=e+"= "+encodeURIComponent(t)+";expires= "+o.toGMTString()+";path= /",!0}},getCustomCookie:function(e){for(var t=document.cookie.split("; "),i=0;i<t.length;i++){var o=t[i].split("=");if(o[0]===e)return o[1]}return""},remove:function(e){var t=AcsUtil.Cookie.get(e);if(t){e=AcsUtil.getPrd()+e;var i=new Date;document.cookie=e+"=;expires= "+i.toGMTString()+"; path= /"}return t}}},CRM={},CrmAcs={},isShowMore=!0,withAttach=!1,attachLimit=20,fileCount=0,viewKey=Crm.userDetails.feedsViewKey;CrmAcs.fetchResource=function(){if(null==AcsResource.resourceobject){var e=Crm.getCrmBasePath()+"/Pulse.do?action=getAcsResource";(new crmRequestPool).initiate({action:e,type:"GET",success:function(e){AcsResource.resourceobject=e}})}}(),CRM.commonFeedAction=function(){this.render=function(e,t,i,o){displayFeedsAndComments(e,t,i,o),commonUtils.showHideLoadingDiv(),$("#feeds_loading").hide();var n=$("#showOneFeed");$("#feedpopupnew").is(":visible")&&setPerfectScrollBar("feedpopupnew","feedpopupnew_inner"),n.is(":visible")&&setPerfectScrollBar("showOneFeed")},this.renderComments=function(e,t,i,o,n,s){displayComments(e,t,i,o,n,s);var r=$("#showOneFeed"),a=$("#feedpopupnew");r.is(":visible")&&setPerfectScrollBar("showOneFeed"),a.is(":visible")&&setPerfectScrollBar("feedpopupnew","feedpopupnew_inner")},this.updatePoll=function(e,t){},this.invokeAction=function(e,t,i,o,n){var s="CR";void 0!==RebrandLinkUtil.getProperty("WMS_PRDID")&&(s=RebrandLinkUtil.getProperty("WMS_PRDID")),AcsApi.invoke(s,e,i,this.moduleName,t,o,n),fileCount=0},this.handleAction=function(e,t,i,o){o&&"Success"==o&&"DeleteComment"==t&&window.getElemById(i)&&window.getElemById(i).remove()},this.handleActionError=function(e,t,i,o){},this.handleDelete=function(e,t,i,o){"activity"===e?$("div[id='"+i+"']").remove():"comment"===e&&$("div[id='"+o+"']").remove()},this.renderNotification=function(e,t,i){$("#showOneFeed").is(":visible")&&(t.isFromNotification="true"),displayFeedsAndComments("push",e,t,!1),commonUtils.showHideLoadingDiv()}},CRM.Leads=new CRM.commonFeedAction,CRM.Leads.moduleName="Leads",CRM.Accounts=new CRM.commonFeedAction,CRM.Accounts.moduleName="Accounts",CRM.Contacts=new CRM.commonFeedAction,CRM.Contacts.moduleName="Contacts",CRM.Potentials=new CRM.commonFeedAction,CRM.Potentials.moduleName="Potentials",CRM.Tasks=new CRM.commonFeedAction,CRM.Tasks.moduleName="Tasks",CRM.Events=new CRM.commonFeedAction,CRM.Events.moduleName="Events",CRM.Calls=new CRM.commonFeedAction,CRM.Calls.moduleName="Calls",CRM.PurchaseOrders=new CRM.commonFeedAction,CRM.PurchaseOrders.moduleName="PurchaseOrders",CRM.Quotes=new CRM.commonFeedAction,CRM.Quotes.moduleName="Quotes",CRM.SalesOrders=new CRM.commonFeedAction,CRM.SalesOrders.moduleName="SalesOrders",CRM.Invoices=new CRM.commonFeedAction,CRM.Invoices.moduleName="Invoices",CRM.PriceBooks=new CRM.commonFeedAction,CRM.PriceBooks.moduleName="PriceBooks",CRM.Products=new CRM.commonFeedAction,CRM.Products.moduleName="Products",CRM.Cases=new CRM.commonFeedAction,CRM.Cases.moduleName="Cases",CRM.Status=new CRM.commonFeedAction,CRM.Status.moduleName="Status",CRM.Info=new CRM.commonFeedAction,CRM.Info.moduleName="Info",CRM.Campaigns=new CRM.commonFeedAction,CRM.Campaigns.moduleName="Campaigns",CRM.Vendors=new CRM.commonFeedAction,CRM.Vendors.moduleName="Vendors",CRM.Solutions=new CRM.commonFeedAction,CRM.Solutions.moduleName="Solutions",CRM.Motivator=new CRM.commonFeedAction,CRM.Motivator.moduleName="Motivator",CRM.Share=new CRM.commonFeedAction,CRM.Share.moduleName="Share",CRM.Services=new CRM.commonFeedAction,CRM.Services.moduleName="Services",CRM.Appointments=new CRM.commonFeedAction,CRM.Appointments.moduleName="Appointments",CRM.Bundles=new CRM.commonFeedAction,CRM.Bundles.moduleName="Bundles";for(var i=1;i<=500;i++)CRM["CustomModule"+i]=new CRM.commonFeedAction,CRM["CustomModule"+i].moduleName="CustomModule"+i;function fetchMoreNotificationList(){$L("#notificationList").scrollTop()+$("#notificationList").outerHeight()>=$("#notificationList")[0].scrollHeight&&AcsApi.getNotificationList("UNS",10,CRM.notificationLastElementKey,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID)}function getUNSNotificationList(){void 0===Handlebars.templates.FeedsEntryTemplate&&loadFeedJS(),"undefined"==typeof crmLookupBusinessCard&&networkUtils.loadFeatureScripts(["zohocrm_lookupBusinessCard.js"],(function(){})),commonUtils.showHideLoadingDiv(!0),void 0===InfoForDisplayWithLiteUsers?loadDataForDisplayAndMentions(!1,!0,!1,!0,(function(){AcsApi.getNotificationList("UNS",50,void 0,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID)}),!0):AcsApi.getNotificationList("UNS",50,void 0,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID),$("#notificationList").empty(),featuresAvailable.NEXTGENUI_ENABLED||renderingUtils.hideFreezeLayer()}function getTimelineData(e){$("#feed_loading").show();var t,i,o=new Date;"yesterday"===e?(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1),i=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1,24,0,0),$("#timeLineTitle").html("<span class='crmLabelColor feedtitle'> /&nbsp;</span>"+I18n.getMsg("Yesterday"))):"lastweek"===e?(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-o.getDay()-7),i=new Date(o.getFullYear(),o.getMonth(),o.getDate()-o.getDay()),$("#timeLineTitle").html("<span class='crmLabelColor feedtitle'> /&nbsp;</span>"+I18n.getMsg("Last Week"))):"thismonth"===e?(t=new Date(o.getFullYear(),o.getMonth()),i=new Date(o.getFullYear(),o.getMonth()+1),$("#timeLineTitle").html("<span class='crmLabelColor feedtitle'> /&nbsp;</span>"+I18n.getMsg("Current Month"))):"lastmonth"===e&&(t=new Date(o.getFullYear(),o.getMonth()-1),i=new Date(o.getFullYear(),o.getMonth()),$("#timeLineTitle").html("<span class='crmLabelColor feedtitle'> /&nbsp;</span>"+I18n.getMsg("Last Month"))),$("#feedscontainer_timeline").html(""),viewKey==userFeedsPageKey&&$("#feedTitle").html('<a href="javascript:;" class="crmNotFoundColor feedtitle" onclick="CrmAcs.fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+"</a> "),$("#moduleTitle").removeClass("crmBaseColor"),$("#moduleTitle").addClass("crmNotFoundColor"),AcsApi.timeline("CRM",viewKey,10,e,t.getTime(),i.getTime())}function displayFeedsAndComments(e,t,i,o){var n=$("#showOneFeed"),s=$("#feedpopupnew");if(($("#feedParentDiv").is(":visible")||n.is(":visible"))&&viewKey===t){$(".feed_blankstate").hide(),$(".feedtitle").show(),$("#noData").hide(),i.viewKey=viewKey,i.portalRole=CrmAcs.portalRole,i.isActivitySplitDone=!!Crm.isActivitySplitDone;var r=Handlebars.templates.FeedsEntryTemplate,a=void 0!==i.entityModule&&!["Info","Status","Share"].includes(i.entityModule)&&!(void 0!==moduleRecordMapping[i.entityModule]&&"team_based"===moduleRecordMapping[i.entityModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+i.entityModule]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1;a&&(delete i.latitle,delete i.comments,delete i.cmore),i.hasNotePer=!a;var l=r(i),c=!0,d="",u=$("#feedParentDiv").is(":visible");if(Crm.userDetails.ZUID!==i.laowner||"push"!==e&&"autocorrect"!==e||!u&&!n.is(":visible")){if("push"===e||"autocorrect"===e){var m="Status"==i.entityModule?i.statusId:i.entityId,p=document.getElementById("note_"+m);p&&(d=p.value),""!==d?($("div[id='"+i.fdk+"'].feedbox").replaceWith(l),c=!1,p.value=d):s.is(":hidden")&&n.is(":hidden")&&$("div[id='"+i.fdk+"']").remove()}}else if($("div[id='"+i.fdk+"']").length>0){for(var g=$("div[id='"+i.fdk+"'].feedbox"),f=g.length,h=0;h<f;h++){var y=new DOMParser,v=g[h].parentElement;if("showOneFeed_inner"==v.getAttribute("id")){i.isFromNotification="true";var C=r(i);C=y.parseFromString(C,"text/html"),v.replaceChild(C.body.children[0],g[h])}else delete i.isFromNotification,l=r(i),l=y.parseFromString(l,"text/html"),v.replaceChild(l.body.children[0],g[h])}n.is(":visible")?n.find(".feedMassActionDiv").show():s.is(":visible")&&s.find(".feedMassActionDiv").show(),c=!1}if(c)if(o)$("#feedscontainer").append(l);else{let e=$L("#"+i.fdk);e.length>0?e.html(l):$("#feedscontainer").prepend(l),$L("#showOneFeed").length>0&&$("#showOneFeed #"+i.fdk).html(l)}$("a.imageGallery").colorbox({photo:!0})}}function displayComments(e,t,i,o,n,s){if(viewKey===e&&(void 0===o[0].associateModule||["Info","Status","Share"].includes(o[0].associateModule)||(void 0!==moduleRecordMapping[o[0].associateModule]&&"team_based"===moduleRecordMapping[o[0].associateModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+o[0].associateModule]:Crm.userDetails.permissions.Crm_Implied_View_Notes))){var r=(0,Handlebars.templates.FeedsComment)({comments:o,totalCount:n});$(CRM.feedGetCommentsObject).closest(".cmoreCmt_Container").replaceWith(r),$("a.imageGallery").colorbox({photo:!0})}}function bindMentions(e,t){$(".chatBgWraper").removeClass("openNotes");var i=$(e).closest(".feed_newpost_textarea_bg");i.addClass("openNotes"),$(e).closest(".chatBgWraper").addClass("openNotes"),$("feedButtonLayer").show(),i.find("#feed_status").addClass("feed_statusHset");var o=!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users,n=$L("#"+t);n.hasClass("lyteMentionsAdded")||(Notes.idForMentions=t,n.cruxMention({textboxSelector:"#"+t,queryParam:{include_lite_users:!0},existingMentions:Notes.mentionedTagsData,cxPropContent:function(e){"transitionNotes"==Notes.idForMentions?Notes.transNoteContent=e:"noteContentTxt"==Notes.idForMentions?(Notes.noteContent=e,Notes.mentionedTagsData=[],Notes.setMentionsTagData(!0)):"feed_status"==Notes.idForMentions?Notes.feedsContent=e:"CallNotes"===Notes.idForMentions?Notes.callNotesContent=e:Notes.feedCommentsContent=e,(["transitionNotes","noteContentTxt","feed_status","CallNotes"].includes(Notes.idForMentions)||Notes.idForMentions.includes("note_")||Notes.idForMentions.includes("feed_"))&&o&&(this.queryParam.user_type="subordinate_users")}}),n.addClass("lyteMentionsAdded"),$(".lyteMIWrapper").css("width","100%"),"CallNotes"===t&&$("#CallNotesDiv").find(".lyteMIWrapper").css("width","102%"),"transitionNotes"==t&&$(".lyteMentionsInnerDiv").css("color","transparent"),"noteContentTxt"!=t&&"feed_status"!=t&&Notes.mentionedCommentIds.push(t)),n.focus()}function showMentionedName(e,t){(t=null!=t&&1==t)&&(e=(e=(e=e.replace("&#x5b;","[")).replace("&#x23;","#")).replace("&#x5d;","]"));var o=new RegExp("crm[[aA-zZ]*#[0-9]*#[0-9]*]crm","gi"),n=e.match(o),s=JSON.parse(InfoForDisplayWithLiteUsers),r=!0;if(n)for(i=0;i<n.length;i++){var a=e.indexOf(n[i])+n[i].length;i!=n.length-1&&","!=e[a]&&","!=e[a+1]||(r=!1);for(var l=n[i].indexOf("#"),c=(a=n[i].lastIndexOf("#"),n[i].slice(l+1,a)),d=c,u=0;u<s.length;u++)if(s[u].id===c){if("user"==s[u].type){var m=s[u].firstName,p=s[u].lastName;d=getFormattedName(m,p,null);break}d=s[u].name,t&&(d=s[u].plainName);break}d=r?$.trim(d)+",":$.trim(d),e=null!=t&&1==t?e.replace(n[i],d):e.replace(n[i],"<a href=javascript:; class='feedbluetxt'>"+$ESAPI.encoder().encodeForHTML(d)+"</a>")}return e}function addFeedStatus(){var e=Notes.feedsContent,t=escapeHtml(e);if(e&&(e.length>2e3||t.length>2e3)){(o=[])[0]="2000",o[1]=I18n.getMsg("Status");var i=I18n.getMsg("crm.message.limit.exceed",o);return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:i}}),this.event.stopImmediatePropagation(),!1}var o="actionType=Status&content="+encodeURIComponent(e),n=$("#direct_msg").prop("checked");if(n&&$("#groupSelect").show(),o=o+"&isDirect="+n,groupStatus&&(o=o+"&groupId="+groupId),""!==e&&!withAttach){var s=o+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(){$("textarea[id='feed_status']").val(""),$("#direct_msg").prop("checked",!1),Notes.destroyMentionsComponent("feed_status"),Notes.feedsContent=""}),s)}globalparam=o}function getNameByZuid(e){for(var t=JSON.parse(InfoForDisplayWithLiteUsers),i=I18n.getMsg("crm.label.deleted.users"),o=0;o<t.length;o++)if(t[o].zuid===e){if("user"==t[o].type){var n=t[o].firstName,s=t[o].lastName;i=getFormattedName(n,s,null);break}i=t[o].name,isFromNotes&&(i=t[o].plainName);break}return i}function createShowOneFeedDiv(){if($("#showOneFeed").length<=0){var e=document.createElement("div"),t=renderingUtils.windowHeight,i=renderingUtils.tabLayerOuterHeight()+renderingUtils.tabLayerTop(),o=$L("#wmstoolbar"),n=t-(36+(o&&o.length>0?o.innerHeight():28)+i);$(e).attr({id:"showOneFeed",style:"display: none;height: "+n+"; overflow-y : auto;",onClick:"sE(event)"});var s=document.createElement("div");$(s).attr({id:"showOneFeed_inner"}),e.append(s),$("#show").append(e)}}function showOneFeedAndComments(e,t,i){if(createShowOneFeedDiv(),"deleted"!==JSON.parse(e).resultstatus&&"unauthorised"!==JSON.parse(e).resultstatus){var o=new Activity(JSON.parse(e));o=new CRM.Activity(o);var n=Handlebars.templates.FeedsEntryTemplate,s=void 0!==o.entityModule&&!["Info","Status","Share"].includes(o.entityModule)&&!(void 0!==moduleRecordMapping[o.entityModule]&&"team_based"===moduleRecordMapping[o.entityModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+o.entityModule]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1;s&&(delete o.comments,delete o.latitle,delete o.cmore),o.hasNotePer=!s;var r=n(o),a=$("#showOneFeed"),l=$("#notificationscontainer"),c=renderingUtils.tabLayerOuterHeight(),d=renderingUtils.windowHeight,u=renderingUtils.tabLayerOuterHeight()+renderingUtils.tabLayerTop(),m=$L("#wmstoolbar"),p=d-(36+(m&&m.length>0?m.innerHeight():28)+u);a.css({width:"calc(100% - 48%)",padding:"18px",top:c,height:p}),$("#showOneFeed_inner").html(r),a.show(),$("a.imageGallery").colorbox({photo:!0}),setPerfectScrollBar("showOneFeed")}else{if("deleted"===JSON.parse(e).resultstatus)r="<div class='p30'>"+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg("crm.feed.tab.name"))+"</div>";else r="<div class='p30 wbBreakWord lh20'>"+I18n.getMsg("crm.contact.hierarchy.business_card_permission_error")+"</div>";a=$L("#showOneFeed");var g=(l=$L("#notificationscontainer")).position().right-(a.width()+2),f=l.position().top;a.css({width:"calc(100% - 52%)",padding:"18px",right:g,top:f}),$L("#showOneFeed_inner").html(r),a.show(),setPerfectScrollBar("showOneFeed")}a.css({zIndex:l.css("zIndex")})}function attachForComment(e){fileCount=0,$("div[id='addAttachment_"+e+"']").show()}function hideAttach(e){fileCount=0,$("#tkvMoreFiles").html(""),$("#attachcrmKVFiles").removeClass("hide"),$("#attachcrmKVMoreFiles").addClass("hide"),$("div[id='addAttachment_"+e+"']").hide(),$("form[id='form_"+e+"']")[0].reset()}function addNoteFromFeed(e,t,i,o,n){var s=$(o).closest(".feedcontentdiv").find("textarea").prop("id"),r=Notes.feedCommentsContent;if(!((void 0!==moduleRecordMapping[t]&&"team_based"===moduleRecordMapping[t].access_type?Crm.userDetails.permissions["Crm_Implied_Create_Notes_"+t]:Crm.userDetails.permissions.Crm_Implied_Create_Notes)||!1)&&!["Info","Status","Share"].includes(t))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.feeds.note.add.nopermission")}}),!1;var a=escapeHtml(r);if(r&&("Status"!==t&&r.length>32e3||("Status"===t||"Info"===t)&&(r.length>2e3||a.length>2e3))){var l=[];l[0]="Status"===t||"Info"===t?"2000":"32000",l[1]=I18n.getMsg("crm.ln.lable.comment");var c=I18n.getMsg("crm.message.limit.exceed",l);return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:c}}),!1}var d=r;if(""===d&&"Status"!==t&&"Info"!==t)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.feeds.note.not.empty")}}),!1;if(""===d&&("Status"===t||"Info"===t)&&""===$(n).find("div[id='addAttachment_"+i+"']").find("input[name='thefile']").val())return!1;var u=d,m={},p=n;m.ASSOCIATEID=e,m.ASSOCIATETYPE=t,m.MESSAGE=u,m.PMODULE=t,m.PPID=e,CRM[t].invokeAction(viewKey,"Comment",i,m,p),commonUtils.showHideLoadingDiv(!0),Notes.destroyMentionsComponent(s),Notes.mentionedTagsData=[],Notes.feedCommentsContent="",p.reset()}function deleteComment(e,t,i,o){var n={};if(n.ID=t,n.PARENTMODULE=i,n.BY=o,!((void 0!==moduleRecordMapping[i]&&"team_based"===moduleRecordMapping[i].access_type?Crm.userDetails.permissions["Crm_Implied_Delete_Notes_"+i]:Crm.userDetails.permissions.Crm_Implied_Delete_Notes)||!1)&&"Status"!==i)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error")}}),!1;CRM[i].invokeAction(viewKey,"DeleteComment",e,n),$(".feed_newpost_textarea_bg").removeClass("openNotes")}function deleteStatus(e,t){$("#feedpopupnew").is(":visible")&&(hide("feedpopupnew"),$("#feedpopupnew").css({width:"auto",height:"auto"}),renderingUtils.removeFreezeLayer());var i={};i.BY=t,CRM.Status.invokeAction(viewKey,"DeleteStatus",e,i)}function feedGetComments(e,t,i,o,n,s,r){CRM.feedGetCommentsObject=r,AcsApi.getComments(e,t,i,"",n,"")}function showFeedComment(e,t){var i=$(t).closest(".feedcontentdiv");i.find("textarea[id='note_"+e+"']").focus(),i.find(".feedButtonLayer").slideDown(),i.find(".feedButtonLayer").animate({height:"100%"}),$("#showOneFeed").is(":visible")&&setPerfectScrollBar("showOneFeed")}function showStatus(){var e=$("#save_status_div");$("#feedDropzone").addClass("attachzone"),$("#dropzonePreview").show(),e.height()<265&&(e.animate({height:"40px"}),e.show())}function directMsgSpan(){$("#feed_status").on("change paste keyup",(function(){-1==$("#feed_status").val().indexOf("@")&&($("#direct_msg_span").hide(),$("#direct_msg").prop("checked",!1)),groupStatus||-1===$("#feed_status").val().indexOf("@")||$("#direct_msg_span").show()})),$("#direct_msg").click((function(){$(this).prop("checked")?($("#optionalWall").val("orgwall"),$("#groupSelect").hide(),groupId=null,groupStatus=!1,$("#groupUsers").html("")):0==$(this).prop("checked")&&$("#groupSelect").show()}))}function hideDirect(){$("#direct_msg_span").hide(),$("#direct_msg").prop("checked",!1)}CRM.Uns={handleBadge:function(e,t){var i=void 0!==e.CNS?parseInt(e.CNS):0;0!==i?"prefetch"!==t&&($("#newMailCount").is(":visible")||$("#newMailCount").show(),$("#newMailCount").html(i),document.getElementById("recentMailsDiv")&&"none"!==document.getElementById("rmListViewDiv").style.display&&showRecentMails(),document.title="("+$("#newMailCount").html()+") "+originaltitle,Crm.userDetails.isAccessibilityConfigSupported&&Lyte.Service.getInjected("globalAccessibilityServices").flashEnable()):void 0!==e.CNS&&0===i&&(hidemessage(),$("#newMailCount").hide());var o="UNS@"+Crm.userDetails.ZGID;if(void 0!==e[o]&&parseInt(crmNTCGlobal.feeds_count)<parseInt(e[o])){var n=parseInt(e[o])-parseInt(crmNTCGlobal.feeds_count);crmNTCGlobal.feeds_count=e[o],parseInt(crmNTCGlobal.live_global_notifications_count)>0?crmNTCGlobal.live_global_notifications_count=parseInt(crmNTCGlobal.live_global_notifications_count)+parseInt(n):crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.feeds_count,Crm.userDetails.isAccessibilityConfigSupported&&Lyte.Service.getInjected("globalAccessibilityServices").flashEnable()}else if(void 0!==e[o]&&parseInt(crmNTCGlobal.feeds_count)>parseInt(e[o])){var s=parseInt(crmNTCGlobal.feeds_count)-parseInt(e[o]);crmNTCGlobal.feeds_count=e[o],parseInt(crmNTCGlobal.live_global_notifications_count)>0?crmNTCGlobal.live_global_notifications_count=parseInt(crmNTCGlobal.live_global_notifications_count)-parseInt(s):crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.feeds_count}crmNTCGlobal.updateNotificationCount()},handleDesktopNotification:function(e){},renderNotificationList:function(e,t,i,o,n){for(var s=Handlebars.templates.FeedsNotificationList,r="",a=0;a<t.length;a++){CRM.processInfoData(t[a],!1);var l=t[a].getInfo();if(void 0!==l){var c="";void 0!==t[a].getActionOwner()&&(c=t[a].getActionOwner().split(":")[0]);let e=+t[a].getTime();e&&(e=$L.moment(e).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A")));var d=t[a].getSkey(),u=t[a].getProperty("fdk"),m=t[a].getProperty("type");const i=void 0!==t[a]._ntfn.isread&&t[a]._ntfn.isread;var p=!JSON.parse(i);r+=s({title:l,laOwnerId:c,time:e,feedFdk:u,feedType:m,repCount:t[a].getRepeatCount(),repUsers:t[a].getRepeatUsers(),isNew:p,sKey:d,hasNotePerm:t[a].getRepeatCount()&&(["Info","Status","Share"].includes(m)||(void 0!==moduleRecordMapping[m]&&"team_based"===moduleRecordMapping[m].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+m]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1),ntfnImgUrl:c?appendTimeToImgSrc(crmConstants.contactsPhotoURL+"/file?ID="+c+"&fs=thumb"):appendTimeToImgSrc(crmConstants.contactsPhotoURL+"/file?ID="+Crm.userDetails.ZUID+"&fs=thumb")})}}$("#tabLayer");var g=parseInt(renderingUtils.tabLayerOuterHeight())+renderingUtils.tabLayerTop();$("body").hasClass("zcrmInsideCRMPlus")&&(g=0),$("#notificationscontainer").css({top:g,height:$(window).height()-(g+$("#wmstoolbar").outerHeight())}).addClass("open"),$(".notifiactionIcon").addClass("notifiactionIconH"),$("#notifications").css({height:$(window).height()-(45+$("#wmstoolbar").outerHeight()+$("#notificationscontainer .notificationtitle").outerHeight())}),commonUtils.showHideLoadingDiv(),""===r&&(r='<div class="p30 feedsEmptyEle"><span class="feedss-emptyIcon zcrm_svgIcons"></span><p class="w90_per aligncenter m0Auto signal-on-board-text">'+I18n.getMsg("crm.feed.no")+"</p><div>");var f=$("#notificationList");"more"==e?f.find("#feedsContain").append(r):CRM.notificationLastElementKey!==n?f.append('<div id="feedsContain">'+r+"</div>").addClass("pR oH"):f.html('<div id="feedsContain">'+r+"</div>").addClass("pR oH");var h=$("#notificationscontainer").outerHeight()-($("#nc-tabs-menu").outerHeight()+30);if(f.css("max-height",h),setPerfScrollBar("notificationList"),void 0!==n){var y=$("#notificationList");CRM.notificationLastElementKey=n,y.on("scroll",$L.debounce((function(){fetchMoreNotificationList()}),100))}else $("#notificationList").off("scroll")}},CRM.onAcsConnect=function(){AcsApi.getBadgeCount("UNS")},CRM.processInfoData=function(e,t){if(e){var i,o=e._jobj||e._ntfn;if(o&&"Info"===o[t?"type":"Feed.type"])if(i=t?o.title&&o.title.iprops:o.info&&o.info.iprops)for(var n=i.length,s=0;s<n;s++)i[s].defaultvalue&&(i[s].defaultvalue=$ESAPI.encoder().encodeForHTML(i[s].defaultvalue))}},CRM.Activity=function(e){var t=$("#showOneFeed");if($("#feedParentDiv").is(":visible")||t.length>0){if(this.prd=e.getPrd(),this.fdk=e.getFDK(),this.latype=e.getLAType(),this.cmore=e.getCMore(),this.skey=e.getSkey(),this.viewKey=viewKey,CrmAcs.portalRole=e.getAdditionalProperty("PORTAL_ROLE_NAME"),CRM.processInfoData(e,!0),this.title=e.getTitle(),this.entityName=e.getContent(),this.type=e.getType(),this.aowner=e.getAOwner().split(":")[0],void 0!==e.getLAOwner()?this.laowner=e.getLAOwner().split(":")[0]:this.laowner=this.aowner,this.actTime=e.getAdditionalProperty("ActivityTime"),this.actTime&&(this.time=$L.moment(this.actTime).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"))),this.parentModule=e.getAdditionalProperty("ParentModule"),"Status"===this.type)this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)),this.statusTime=e.getAdditionalProperty("StatusTime"),this.SystemFeed=e.getAdditionalProperty("SystemFeed"),this.statusTime&&(this.time=$L.moment(this.statusTime).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"))),Crm.userDetails.ZUID===this.aowner&&(this.canDelete=!0),(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(this.attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.statusId=e.getAdditionalProperty("statusId");else if("Info"===this.type){this.massUpdatedEntities="",this.massUpdatedParentEntities="",this.massUpdatedChildEntity="",this.massChildEntitiesGroup="",this.entityName="",this.i18NParentModName=e.getAdditionalProperty("I18NParentModName"),this.infoTime=e.getAdditionalProperty("InfoTime"),this.infoTime&&(this.time=$L.moment(this.infoTime).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"))),this.updatedEntities=e.getAdditionalProperty("UpdatedEntities");var i=0,o=!1,n={childModules:[]},s={};this.operation=e.getAdditionalProperty("Operation");for(var r=0;r<this.updatedEntities.length;r++)this.updatedEntities[r].ENTITYMODULE===this.parentModule?("delete"===this.operation?this.entityName=this.updatedEntities[r].ENTITYNAME:this.entityName=CRM.I18NString.getString("ENTITY",this.updatedEntities[r]),0===i&&"delete"===this.operation?this.massUpdatedParentEntities+="<div class='crm-small-font-size crm-font-bold crmLabelColor'>"+I18n.getMsg("crm.feed.entity.follow.own",I18n.getMsg(this.updatedEntities[r].I8NMODULENAME))+"</div>"+this.entityName:this.massUpdatedParentEntities+=this.entityName,i+=1):(n.childModules.contains(this.updatedEntities[r].ENTITYMODULE)?o=!1:(n.childModules.push(this.updatedEntities[r].ENTITYMODULE),o=!0),this.massUpdatedChildEntity+=o?"<div class='mT15 crm-small-font-size crm-font-bold crmLabelColor'>"+I18n.getMsg("crm.feed.entity.follow.own",I18n.getMsg(this.updatedEntities[r].I8NMODULENAME))+"</div>"+this.updatedEntities[r].ENTITYNAME:this.updatedEntities[r].ENTITYNAME,void 0!==s[this.updatedEntities[r].ENTITYMODULE]?s[this.updatedEntities[r].ENTITYMODULE]=s[this.updatedEntities[r].ENTITYMODULE]+this.massUpdatedChildEntity:s[this.updatedEntities[r].ENTITYMODULE]=this.massUpdatedChildEntity,this.massUpdatedChildEntity="");for(var a=0;a<n.childModules.length;a++)this.massChildEntitiesGroup+=s[n.childModules[a]];this.massUpdatedParentEntities.length<1&&(this.massUpdatedParentEntities="<div class='mT15 crm-small-font-size crm-font-bold crmLabelColor'>"+I18n.getMsg("crm.feed.entity.follow.own",this.i18NParentModName)+"</div>"+I18n.getMsg("crm.feed.no.parent.involve")),this.statusContent=this.massUpdatedParentEntities+this.massChildEntitiesGroup}else if("Motivator"===this.type){if(this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)),this.statusTime=e.getAdditionalProperty("StatusTime"),this.SystemFeed=e.getAdditionalProperty("SystemFeed"),this.statusTime&&(this.time=$L.moment(this.statusTime).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"))),(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(this.attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.contentKey=e.getAdditionalProperty("contentKey"),this.contentParams=e.getAdditionalProperty("contentParams"),this.contentKey){for(r=0;r<this.contentParams.length;r++)this.contentParams[r]=I18n.getMsg(this.contentParams[r]);this.statusContent=I18n.getMsg(this.contentKey,this.contentParams)}}else"Share"===this.type&&(this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)));this.accessfrom=e.getAccFrom(),this.totalcomments=e.getTotalComments(),this.comments=e.getComments(),this.latitle=e.getLATitle(),this.asusers=e.getASUsers(),this.cfusers=e.getCFUsers(),this.totalcomments&&(this.viewAllCmtLabel=I18n.getMsg("crm.feed.display.all.comment",this.totalcomments.toString())),this.entityId=e.getAdditionalProperty("EntityId"),this.entityModule=e.getAdditionalProperty("EntityModule"),this.parentId=e.getAdditionalProperty("ParentId"),this.isFromNotification=e._jobj.isFromNotification,this.aOwnerZuid=e.getAdditionalProperty("AOwnerZuid"),this.aOwnerName=e.getAdditionalProperty("aOwnerName");e.getAdditionalProperty("EntityModule");"true"!==this.SystemFeed&&this.aowner?this.actImgUrl=appendTimeToImgSrc(crmConstants.contactsPhotoURL+"/file?ID="+this.aowner+"&fs=thumb"):this.actImgUrl=appendTimeToImgSrc(crmConstants.contactsPhotoURL+"/file?ID="+Crm.userDetails.ZUID+"&fs=thumb")}},CrmAcs.seeMoreComment=function(e,t,i){if(!((void 0!==moduleRecordMapping[i]&&"team_based"===moduleRecordMapping[i].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+i]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error")}}),!1;var o="/crm/v2/Notes/"+t,n=networkUtils.lyteInitiateRequest(o,"GET"),s="";n.then((function(t){commonUtils.showHideLoadingDiv(),s=t.data[0].Note_Content,$("#"+e+" #feedsComment #feedsCommentContent").html(findReplaceURLWithinContent(showMentionedName(escapeHtml(s)))),$("#"+e+" #feedsComment #feedsCommentButtonLayer").hide(),document.getElementById("showOneFeed")&&($("#showOneFeed #"+e+"  #feedsComment #feedsCommentContent").html(findReplaceURLWithinContent(showMentionedName(escapeHtml(s)))),$("#showOneFeed #"+e+"  #feedsComment #feedsCommentButtonLayer").hide())}),(function(e){if(e){var t=[];t[0]=I18n.getMsg("crm.record.not.accessible");var i=I18n.getMsg("crm.record.not.accessible.message2",t),o=I18n.getMsg("crm.trial.contact.adminstrator");_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:i+o}})}}))},CRM.Comment=function(e){var t=$("#showOneFeed");if($("#feedParentDiv").is(":visible")||t.length>0){this.cmtPortalRole=e.getAdditionalProperty("PORTAL_ROLE_NAME"),this.ckey=e.getCkey(),this.cfdk=e.getCFDK(),this.type=e.getType(),this.associateModule=e.getAdditionalProperty("AssociateModule"),this.SMore=e.getAdditionalProperty("SMore"),this.content=e.getContent();var i=["Info","Status","Share"];this.content.length>2e3&&!i.includes(this.associateModule)&&"true"!==this.SMore&&(this.SMore=!0,this.content=e.getContent().substring(0,2e3)),this.SMore&&(this.content=this.content+"..."),this.content=findReplaceURLWithinContent(showMentionedName(this.content)),this.by=e.getPostedBy().split(":")[0],this.at=e.getAt(),this.accessfrom=e.getAccFrom(),this.cmtTime=e.getAdditionalProperty("CommentTime"),this.cmtTime&&(this.time=$L.moment(this.cmtTime).timezone(Crm.userDetails.USER_TIME_ZONE).i18N(Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"))),this.aOwnerZuid=e.getAdditionalProperty("AOwnerZuid"),this.associateId=e.getAdditionalProperty("AssociateId"),this.notesId=e.getAdditionalProperty("NotesId");var o=e.getAdditionalProperty("USERTYPE");this.aOwnerName="4"===o?e.getAdditionalProperty("AOWNERUSERNAME"):getNameByZuid(this.by).trim(),this.Latitude=e.getAdditionalProperty("Latitude"),this.Longitude=e.getAdditionalProperty("Longitude"),this.Address=e.getAdditionalProperty("Address"),Crm.userDetails.ZUID!==this.by||this.Address||(this.canDelete=!0);var n=(void 0!==moduleRecordMapping[this.associateModule]&&"team_based"===moduleRecordMapping[this.associateModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Attachments_"+this.associateModule]:Crm.userDetails.permissions.Crm_Implied_View_Attachments)||!1;i=["Info","Status","Share"];(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(i.includes(this.associateModule)||n)&&(this.cmt_attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.cmt_attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.commentId=e.getAdditionalProperty("commentId"),this.cmtImgUrl=appendTimeToImgSrc(crmConstants.contactsPhotoURL+"/file?ID="+this.by+"&fs=thumb")}},CRM.I18NString={getString:function(e,t){switch(e){case"USER":var i=t.AOWNERZUID,o=t.AOWNERUSERID,n="4"===t.USERTYPE?t.USERNAME:getNameByZuid(i),s=void 0!==CrmAcs.portalRole?$ESAPI.encoder().encodeForHTML(I18n.getMsg(CrmAcs.portalRole)):"",r="<a href="+Crm.getCrmBasePath()+"/settings/users/"+o+' target=_blank class="feedowner">'+$ESAPI.encoder().encodeForHTML(n)+"</a> ";return s&&(r=r+'<span class="dIB pL5 pR5 mR3 portal_roll_name boxBB lh20 h20">'+s+"</span>"),r;case"USER_NOLINK":i=t.AOWNERZUID,n="4"===t.USERTYPE?t.USERNAME:getNameByZuid(i);return $ESAPI.encoder().encodeForHTML(n);case"ENTITY":var a=t.ENTITYID,l=t.ENTITYMODULE,c=t.ENTITYNAME,d="";"Activities"==l?d=t.ENTITYSUBMODULE:Crm.isActivitySplitDone||"Activities"!=Crm.activityGrp[l]||(d=l,l="Activities");var u=""!==d?d:l;return'<a class=\'feedslinkClr\' target=\'_blank\' onmouseenter="crmLookupBusinessCard.showLookupDetails(this)" onmouseout="crmui.hideTooltip()" data-params=\'{"module":"'+u+'","id":"'+a+'"}\' onclick="Crm.trackSpotLightAction(\'Lookup Click\');" href="'+Crm.getCrmBasePath()+"/tab/"+u+"/"+a+'">'+$ESAPI.encoder().encodeForHTML(c)+"</a>";case"MODULE":if(t.MODULENAME){let e=store.peekAll("module").filterBy({actual_singular_label:t.MODULENAME})[0];return $ESAPI.encoder().encodeForHTML(null!=e?e.singular_label:t.MODULENAME)}return t.ENTITYMODULE?$ESAPI.encoder().encodeForHTML(moduleRecordMapping[t.ENTITYMODULE].plural_label):$ESAPI.encoder().encodeForHTML(I18n.getMsg(t.MODULENAME));case"PARAMI18N":return I18n.getMsg(t.PARAM)}}},CRM._View={init:function(e){isShowMore=!0,$(".feed_blankstate").hide(),$(".feedtitle").show()},nodata:function(e){$(".feed_blankstate").hide(),$(".feedtitle").show();var t='<div id ="noData" class="w100_per feedsGrayclr aligncenter">'+I18n.getMsg("crm.data.not.available")+"</div>";$("#feedscontainer").append(t),isShowMore=!1,$("#feeds_loading").hide()},completed:function(e,t){isShowMore=!(t<25)},completedShowMore:function(e,t){isShowMore=!(t<25),isShowMoreReqSent=!1},renderTimeline:function(e,t,i,o,n,s){if($("#feeds_loading").hide(),n.length<=0){var r='<div class="w100_per feedsGrayclr aligncenter">'+I18n.getMsg("crm.data.not.available")+"</div>";$("#feedscontainer_timeline").append(r),$("#feedscontainer").hide(),$("#feedscontainer_timeline").show()}for(var a=0;a<n.length;a++)try{var l=n[a],c=Handlebars.templates.FeedsEntryTemplate,d=void 0!==l.entityModule&&!["Info","Status","Share"].includes(l.entityModule)&&!(void 0!==moduleRecordMapping[l.entityModule]&&"team_based"===moduleRecordMapping[l.entityModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+l.entityModule]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1;d&&(delete l.comments,delete l.latitle,delete l.cmore),l.hasNotePer=!d;r=c(l);$("#feedscontainer_timeline").append(r),$("#feedscontainer").hide(),$("#feedscontainer_timeline").show(),$("a.imageGallery").colorbox({photo:!0})}catch(e){}if(void 0!==s){r="<div onclick=\"AcsApi.timeline('CRM','"+e+"',15,'"+t+"','"+i+"','"+o+"','"+s+"'); this.style.display='none';\" id='more_"+t+"' class='aligncenter mT20 cP'>"+I18n.getMsg("crm.nsocial.tab.view.more")+"</div>";$("#feedscontainer_timeline").append(r)}}},CrmAcs.getOneFeed=function(e,t,i,o,n){if(n){var s=$(".eachnotification");s.removeAttr("clicked style"),s.removeClass("notifiSelectFeed"),$(n).attr("clicked",!0),$(n).addClass("notifiSelectFeed")}Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-global-search.js"],ResourceConstants.CRMClient));var r="actionType=getOneFeed&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&fdk="+encodeURIComponent(e)+"&module="+t+"&sKey="+encodeURIComponent(i);if(mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(i){var s=JSON.parse(i);s.isFromNotification="true",showOneFeedAndComments(i=JSON.stringify(s),t,n),JSON.parse(o)&&$("#feedsContain #"+e).removeClass("unread_true").addClass("unread_false")}),r),featuresAvailable.NEXTGENUI_ENABLED){var a=$L(".ts-fxd-sc");a&&a.length>0&&a.hasClass("lftmnu-fxd-ntfn")&&a.removeClass("lftmnu-fxd-ntfn")}else renderingUtils.showFreezeLayer()};var groupStatus,groupId,dateObj=-1;function getDateInUserTZ(e){return new Date(e-new Date(e).getTimezoneOffset())}function getUtcDateObj(e){var t=new Date(e),i=t.getTime(),o=6e4*t.getTimezoneOffset();return new Date(i+o)}function getDay(e){dateObj=new Date(Number(e)),curDateObj=new Date,dateObj=getDateInUserTZ(e);var t=getWeekDay(dateObj.getDay()),i=dateObj.getDate(),o=dateObj.getMonth(),n=dateObj.getFullYear(),s=curDateObj.getDate(),r=curDateObj.getMonth(),a=curDateObj.getFullYear(),l=new Array(31,28,31,30,31,30,31,31,30,31,30,31)[o],c=!1,d=!1,u=!1;if(n===a){if(o===r)s<i+7&&(c=!0,i===s?d=!0:i===s-1&&(u=!0));else if(o===r-1){l-i+s<7&&(c=!0,i===l&&1===s&&(u=!0))}}else if(n===a-1){if(11===o)l-i+s<7&&(c=!0,31===i&&1===s&&(u=!0))}return t=!0===c?!0===d?getHoursandMin("",!0):!0===u?I18n.getMsg("Yesterday")+" "+I18n.getMsg("crm.label.lowercase.at")+" "+getHoursandMin("",!0):t+" "+I18n.getMsg("crm.label.lowercase.at")+" "+getHoursandMin("",!0):getMonth(o)+" "+i+" "+(n!==a?", "+n:"")}function feedShowBulkRecords(e){if(!$("#notificationscontainer").hasClass("open")&&$("#feedpopupnew").is(":hidden")){var t,i;i=$(e).offset(),createShowOneFeedDiv(),t="<div class='SocialArrow'></div><div class='feedMassActionInnerDiv'>"+$(e).closest(".whichhappend").next().next().html()+"</div>",$("#showOneFeed_inner").html(t);var o=$("#showOneFeed");o.addClass("newpopup"),o.css({display:"block",width:"300px",padding:"15px",left:i.left,top:i.top+25})}}function setFeedTextAreaHeight(e){var t=$(e),i=e.scrollHeight,o=i>35?i:"";$("#showOneFeed").is(":visible")&&setPerfectScrollBar("showOneFeed"),t.css("cssText","height:"+o+"px !important;")}function hidefeedButtonLayer(e,t){var i=$(e).closest(".feedButtonLayer"),o=i.parent().find("textarea"),n=$L(e).closest("#commentsDiv").find("textarea").prop("id"),s=Notes.feedsContent;if(s&&s.length>2e3&&"cancel"!==t)return!1;Notes.destroyMentionsComponent(n),Notes.mentionedTagsData=[],Notes.feedsContent="",Notes.feedCommentsContent="",o.val(""),i.hide(),$("#feed_status").removeClass("feed_statusHset"),setFeedTextAreaHeight(o)}function callEditGroup(e){getAllGroup(e,!1)}function getAllGroup(e,t){var i;return i={sources_count:{id:e}},Lyte.resolvePromises({groupCount:app.store.makeRequest("triggerAction","user_group","sources_count",i)}).then((function(i){if(!1===$L.isEmptyObject(i.groupCount)&&!1===t)networkUtils.openUrl(window.location.origin+Crm.getCrmBasePath()+"/settings/groups/"+e,"_blank");else{if(!1===$L.isEmptyObject(i.groupCount)&&!0===t)return;if(!0===$L.isEmptyObject(i.groupCount)&&!0===t)return void _cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:I18n.getMsg("crm.usergroup.deleted.refresh.message"),ltPropDuration:"3000",ltPropShow:!0}});_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.label.group.notavailable"),ltPropDuration:"3000",ltPropShow:!0}})}}))}function showHideModuleFilter(e){e?($("#groupSelect").hide(),$("#feedModuleFilter").hide()):($("#feedModuleFilter").show(),$("#groupSelect").show())}function showFeedDeleteActionMenu(e){var t=$(".feedDeleteAction"),i=$(".feedboxDelete"),o=$(e).closest(".feedbox");i.removeClass("feedboxdeleteActive"),t.is(":visible")||i.removeClass("feedboxdeleteActive"),t.css({display:"none"}),o.find(".feedDeleteAction").css({display:""}),$(e).addClass("feedboxdeleteActive"),$(".feed_newpost_textarea_bg").removeClass("openNotes")}function findReplaceURLWithinContent(e){if(e){return e.replace(/((https?|ftp)(:|&#x3a;)(\/\/|&#x2f;&#x2f;))((www\.){0,1}[a-zA-Z0-9-_]+(\.[a-z0-9]+)+)((:|&#x3a;)[0-9]*(\.[a-z0-9]+)*)*(((\/|&#x2f;)[^\s]*)*)|www\.([a-zA-Z0-9-_]+(\.[a-z0-9]+)+)((:|&#x3a;)[0-9]*(\.[a-z0-9]+)*)*(((\/|&#x2f;)[^\s]*)*)/g,(function(e){var t="";return-1===e.indexOf("http")&&-1===e.indexOf("ftp")&&(t="//"),'<a class="link" rel="noopener noreferrer" href="'+t+$ESAPI.encoder().encodeForHTMLAttribute(e)+'" target="_blank">'+$ESAPI.encoder().encodeForHTML(e)+"</a>"}))}return""}function hideDropzone(){$(".feedsViewPage .feed_newpost_textarea_bg").removeClass("openNotes"),$("#feedDropzone").removeClass("attachzone"),$("#dropzonediv").hide(),$("#dropzonePreview").hide()}function searchMember(){var e=$("#memSearch").val().trim().toLowerCase(),t=$("#memberName.isactive,.issearch");currSechExtMatCnt=0;for(var i=0;i<t.length;i++){var o=t[i],n=o.innerHTML.toLowerCase();""==e||-1!=n.indexOf(e)?($(o).addClass("isactive").removeClass("issearch").show(),$(o).parent().show(),$(o).parent().siblings().show(),n.trim()===e&&currSechExtMatCnt++):($(o).removeClass("isactive").addClass("issearch").hide(),$(o).parent().hide(),$(o).parent().siblings().hide())}setPerfectScrollBar("feed_member_popup_outer","feed_member_popup_inner")}function groupChange(){var e=$("#optionalWall").val(),t=$("#optionalWall option:selected").text();"orgwall"==e?($("#groupUsers").html(""),groupStatus=!1):(groupStatus=!0,groupId=e,getZuidsForGroupId(e,t))}function setPerfectScrollBar(e,t){var i=$("#"+e);if(1==i.length){i.perfectScrollbar("destroy");var o=i[0].scrollHeight;$("#"+t).css({height:"1px"}),$("#"+t).css({height:"auto"}),$("#"+t).css({height:o}),i.css({overflow:"hidden"}),i.perfectScrollbar()}}function setPerfScrollBar(e,t){var i=$("#"+e);if(1==i.length){i.perfectScrollbar("destroy");var o=i[0].scrollHeight+10;$("#"+t).css({height:o}),i.css({overflow:"hidden"}),i.perfectScrollbar()}}function feedIEAttachment(e){return withAttach=!1,checkAttachFile(null,null,"status",null,e,!0),$("#form_status")[0].setAttribute("action",Crm.getCrmBasePath()+"/feedFileAttach.do?"+globalparam),withAttach&&$("#form_status").submit(),fileCount=0,$("#addAttachment_status").html($("#addAttachment_duplicate").html()),!0}function oneFeedFromMail(e){if("deleted"!==e.resultstatus&&"unauthorised"!==e.resultstatus){var t=new Activity(e);t=new CRM.Activity(t);var i=Handlebars.templates.FeedsEntryTemplate,o=void 0!==t.entityModule&&!["Info","Status","Share"].includes(t.entityModule)&&!(void 0!==moduleRecordMapping[t.entityModule]&&"team_based"===moduleRecordMapping[t.entityModule].access_type?Crm.userDetails.permissions["Crm_Implied_View_Notes_"+t.entityModule]:Crm.userDetails.permissions.Crm_Implied_View_Notes)||!1;o&&(delete t.comments,delete t.latitle,delete t.cmore),t.hasNotePer=!o,s="<div class='p30 feedsmailEle' onclick='sE()'><div class='feedsEmailcloseEle' onclick=hide('feedpopupnew');renderingUtils.removeFreezeLayer()><crmutil-icon icon-name='close-9' icon-class='zcicn-close-9 crmBaseIcon zcicn16'></crmutil-icon></div>"+(s=i(t))+"</div>",$("#feedpopupnew").html(s),$("#feedpopupnew a.imageGallery").colorbox({photo:!0}),$("#feedpopupnew").show(),$("#feedpopupnew").find(".feedMassActionDiv").show();var n=$(window).height();$("#feedpopupnew").css({width:"700px",height:n-100,overflow:"auto"}),renderingUtils.freezeBackground(),mailsetCenter("feedpopupnew"),$("#feedpopupnew").click((function(){sE()})),setPerfectScrollBar("feedpopupnew","feedpopupnew_inner")}else{if("deleted"===e.resultstatus)var s="<div class='p30'>"+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg("crm.feed.tab.name"))+"</div>";else s="<div class='p30 wbBreakWord lh20'>"+I18n.getMsg("crm.contact.hierarchy.business_card_permission_error")+"</div>";s="<div class='p30' onclick='sE()'><div class='feedsEmailcloseEle' onclick=hide('feedpopupnew');renderingUtils.removeFreezeLayer()><crmutil-icon icon-name='close-9' icon-class='zcicn-close-9 crmBaseIcon zcicn16'></crmutil-icon></div>"+s+"</div>",$("#feedpopupnew").html(s),$("#feedpopupnew").show(),renderingUtils.freezeBackground(),mailsetCenter("feedpopupnew"),$("#feedpopupnew").click((function(){sE()}))}}function setfFeedsGroupContainerHeight(){$("#feedsGroupContainer").length>0&&setPerfectScrollBar("feedsGroupContainer_inner")}function setFeedFollowUp(){var e=$(window).height()-$("#feedParentDiv").offset().top;$("#feedParentDiv").css({width:$(".topdivcontainer").width()+"px","min-height":"auto","margin-bottom":"0px",overflow:"hidden"}),$("#pulseInfoWrap").css({height:e+"px"}),thirdPartyUtils.unbindPerfectScroll("#pulseInfoWrap"),thirdPartyUtils.bindPerfectScroll("#pulseInfoWrap",{wheelSpeed:1,preventOnEnd:!1,preventHorizontal:!1})}function showPulseInfoDiv(e){$(".feedGroupBg").hide(),$("#groupUsers").hide(),$("#feedsviewKeyId").hide(),$("#pulseInfoWrap").show(),$(".feedLeftMenu").removeClass("feedselect"),$(".feedlItems li").removeClass("feedselect"),$(e).addClass("feedselect")}function hidePulseInfoDiv(){$("#feedsviewKeyId").show(),$("#pulseInfoWrap").hide()}function hideAttachError(){$("#showErrorMsg").html("")}function checkAttachFile(e,t,o,n,s,r){if($(s).find("div[id='addAttachment_"+o+"']").find("#attachcrmKVFiles").is(":visible")&&!r)return addNoteFromFeed(e,t,o,n,s),!0;if($(s).find("div[id='addAttachment_"+o+"']").find("#attachcrmKVFiles").is(":visible")&&r)return addFeedStatus(),!0;var a;"[object Array]"===Object.prototype.toString.call($(s)[0].thefile)?(a=$(s)[0].thefile.length,alert(a)):a=$(s)[0].thefile.length;var l=0;if(0===(a-=1)){if(""==trimBoth($(s)[0].thefile[0].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;if("application/x-ms-dos-executable"==(c=$(s)[0].thefile[0].files[0].type))return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;l+=$(s)[0].thefile[0].files[0].size}for(i=0;i<a;i++){if(""==trimBoth($(s)[0].thefile[i].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;var c;if("application/x-ms-dos-executable"==(c=$(s)[0].thefile[i].files[0].type)||"application/x-msdownload"==c)return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;l+=$(s)[0].thefile[i].files[0].size}if(l>1024*attachLimit*1024){var d=[];return d[0]=attachLimit,alert(I18n.getMsg("crm.attach.restriction.relatedlist",d)),!1}return r?(withAttach=!0,addFeedStatus()):addNoteFromFeed(e,t,o,n,s),!0}function remove(e){var t=getObj("tb"+e);getObj("contenttab").removeChild(t),getObj("attachMore").style.display="block";for(var i=e+1;i<fileCount;i++)getObj("tb"+i).id="tb"+(i-1),getObj("del"+i).setAttribute("href","javascript:remove("+(i-1)+")"),getObj("del"+i).id="del"+(i-1);fileCount--}function initDropZone(){Dropzone.options.feedDropzone={autoProcessQueue:!1,previewsContainer:".dropzone-previews",uploadMultiple:!0,parallelUploads:5,url:"dummy",maxFiles:5,uploadMultiple:!0,maxFilesize:4,paramName:"file",addRemoveLinks:!0,clickable:"#dropzonePreview",init:function(){var e=this;$("#save_status").click((function(t){t.preventDefault(),t.stopPropagation(),e.processQueue()})),this.on("addedfile",(function(e){withAttach=!0,$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:40px !important")})),this.on("reset",(function(e){withAttach=!1,$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:40px")})),this.on("processingmultiple",(function(e){this.options.url=Crm.getCrmBasePath()+"/feedFileAttach.do?"+globalparam,globalparam=""})),this.on("successmultiple",(function(t){document.getElementById("feed_status").value="",e.removeAllFiles(),$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:0px")})),$("#cancel_status").click((function(){withAttach=!1,e.removeAllFiles(),$("#save_status_div").hide()})),this.on("drop",(function(e){$("#feedDropzone").addClass("attachzone"),$("#dropzonePreview").show()}))}},Dropzone.discover()}function changeModuleFeedAutoFollow(e){var t=Crm.getCrmBasePath()+"/AutoFollowUp.do",i=new crmRequestPool,o={action:"newFollowUp",module:e,mode:"changeMod"};i.initiate({action:t,data:o,type:"GET",success:function(t){var i=getElemById("critDiv");$(i).empty(),i.innerHTML=t,EvalInnerScript(i);var o=getElemById("module_whom");if(null!=o){var n=I18n.getMsg(moduleRecordMapping[e].plural_label);$(o).empty(),o.innerHTML=I18n.getMsg("crm.feeds.follow.module.whom",$ESAPI.encoder().encodeForHTML(n))}},error:function(){}})}function loadFeedJS(){networkUtils.loadFeatureScripts(["zohocrm_feedsTemplate.js"],(function(){}))}function showFeedPreference(){var e=Crm.getCrmBasePath()+"/AutoFollowUp.do";(new crmRequestPool).initiate({action:e,data:{action:"getFeedPreference"},dataType:"json",success:function(e){Crm.isActivitySplitDone&&(e.isActivitySplitDone=!0);var t=(0,Handlebars.templates.FeedsPreference)(e);$("#feedsPreferenceDiv").html(t),crmui.showPopup("feedsPreferenceDiv");var i=document.querySelectorAll(".feed_pref_info")[0].offsetHeight,o=document.querySelectorAll(".feeds_advInfo")[0].offsetHeight,n=document.querySelectorAll(".feedsPreference_pp_content")[0].offsetHeight-o-i;$(".feeds_content").css({"max-height":n+"px"}),applyShadowFeedPreference()}})}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/\\/g,"&quot;").replace(/\\/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function applyShadowFeedPreference(){var e=document.getElementById("feedsModulePreferenceDiv"),t=e.scrollHeight,i=e.offsetHeight,o=e.scrollTop;o>0?$(e).css("box-shadow","inset 0 14px 6px -14px rgba(0, 0, 0, 0.2)"):$(e).css("box-shadow","none"),t<=Math.round(i+o)?$("#automatedFeedsUpdate").css("box-shadow","none"):$("#automatedFeedsUpdate").css("box-shadow","0px -14px 6px -14px rgba(0, 0, 0, 0.2)")}function updateFeedPreference(){var e=new crmRequestPool,t="";$("#feedsModulePreferenceDiv input:checked").each((function(){t=t+this.value+";"}));var i="";$("#feedsModulePreferenceDiv input:checkbox:not(:checked)").each((function(){i=i+this.value+";"}));var o=!0;$("#automatedFeedsUpdate input:checkbox").is(":checked")||(o=!1);var n="&";n=(n=n+csrfParamName+"="+encodeURIComponent(csrfToken)+"&")+"sellist="+encodeURIComponent(t)+"&unsellist="+encodeURIComponent(i)+"&isAutomatedEnabled="+encodeURIComponent(o);var s=Crm.getCrmBasePath()+"/AutoFollowUp.do?action=updateFeedPreference";e.initiate({action:s,data:n,dataType:"json",success:function(e){}}),crmui.hidePopup("feedsPreferenceDiv")}getWeekDay=function(e){return new Array(I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday"))[e]},getMonth=function(e){return new Array(I18n.getMsg("January"),I18n.getMsg("February"),I18n.getMsg("March"),I18n.getMsg("April"),I18n.getMsg("May"),I18n.getMsg("June"),I18n.getMsg("July"),I18n.getMsg("August"),I18n.getMsg("September"),I18n.getMsg("October"),I18n.getMsg("November"),I18n.getMsg("December"))[e]},getHoursandMin=function(e,t){var i=dateObj;void 0!==e&&""!==e&&(i=new Date(Number(e)));var o=i.getHours(),n=i.getMinutes(),s="";return"hh:mm a"==Crm.userDetails.TIME_FORMAT?(s+=o>12?o-12:0===o?"12":o,s+=(n<10?":0":":")+n,!1!==t&&(s+=o>=12?" "+I18n.getMsg("PM"):" "+I18n.getMsg("AM"))):(o<10&&(o="0"+o),n<10&&(n="0"+n),s=o+":"+n),s},CrmAcs.fetchFeeds=function(e,t,i,o,n,s,r){""!==i&&getAllGroup(i,!0),$("#feedContainerDiv").removeClass("p0").removeAttr("style"),$("#feedParentDiv").css({height:"auto","margin-bottom":"20px"}),$(".feedsViewPage").removeClass("oH"),$("#feedsFollowUpCtn").hide(),$(".feedsHelp").show(),hidePulseInfoDiv(),$("#feeds_loading").show(),$(".feedGroupBg").show(),(r||n)&&$(".feedselect").removeClass("feedselect"),$("#feedContainerDiv").removeClass("p0"),$(o).addClass("feedselect"),e==userFeedsPageKey?($("#feedTitle").text(I18n.getMsg("crm.feeds.userwall.title")),$("#feedModuleFilter").children(".svalue").find("#value").html(I18n.getMsg("crm.label.all"))):""!=t&&n?$("#feedTitle").html('<a href="javascript:;" class="crmNotFoundColor feedtitle" onclick="CrmAcs.fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+'</a><span class="crmLabelColor feedtitle"> /&nbsp;</span><a id="moduleTitle" class="crmBaseColor feedtitle" href="javascript:;" onclick="CrmAcs.fetchFeeds(\''+e+"','"+$ESAPI.encoder().encodeForHTML($ESAPI.encoder().encodeForJavaScript(t))+"','',this,true,false);\">"+$ESAPI.encoder().encodeForHTML(t)+"</a>"):""==t||n||($("#feedTitle").html('<a href="javascript:;" class="crmNotFoundColor feedtitle" onclick="CrmAcs.fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+'</a><span class="crmLabelColor feedtitle"> /&nbsp;</span><a id="moduleTitle" class="crmBaseColor feedtitle" href="javascript:;" onclick="CrmAcs.fetchFeeds(\''+e+"','"+escape(unescape(t))+"','',this,false,true);\">"+$ESAPI.encoder().encodeForHTML(unescape(t))+"</a>"),$("#feedModuleFilter").children(".svalue").find("#value").html(I18n.getMsg("crm.label.all"))),$("#timeLineTitle").html(""),""==t||n?$("#feed_status").attr("placeholder",I18n.getMsg("crm.feed.share.something")):$("#feed_status").attr("placeholder",I18n.getMsg("crm.feed.share.something.to")+" '"+unescape(t)+"'"),void 0!==i&&""!=i?($("#direct_msg").prop("checked",!0),$("#direct_msg_span").hide(),groupStatus=!0,groupId=i):groupChange(),viewKey=e,$("#feedscontainer").html(""),void 0===InfoForDisplayWithLiteUsers?loadDataForDisplayAndMentions(!1,!0,!1,!0,(function(){AcsApi.initStream("CRM",viewKey,25)}),!0):AcsApi.initStream("CRM",viewKey,25),showHideModuleFilter(s),$("#feedscontainer_timeline").html(""),$("#feedscontainer_timeline").hide(),$("#feedscontainer").show(),$("#value").html(I18n.getMsg("crm.Now"))},CrmAcs.addTkvFile=function(e,t,i){if(!((void 0!==moduleRecordMapping[i]&&"team_based"===moduleRecordMapping[i].access_type?Crm.userDetails.permissions["Crm_Implied_Create_Attachments_"+i]:Crm.userDetails.permissions.Crm_Implied_Create_Attachments)||!1)&&!["Info","Status","Share"].includes(i))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.feeds.attachment.add.nopermission")}}),!1;$(e.form).find("div[id='addAttachment_"+t+"']").find("#addAttachmentCtnNewFeeds").addClass("show");var o=document.createElement("input"),n=$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop")[0];o.setAttribute("type","file"),o.setAttribute("name","thefile"),o.setAttribute("style","background: none;top: 7px;height: 20px;"),o.setAttribute("class","smFile filekv0"),o.onchange=function(){hideAttachError(),CrmAcs.addTkvFile(this,t,i)},n.appendChild(o);var s=$.trim($(e).val()).replace(/^.*[\\\/]/,""),r=$("<div>",{class:"tkvFileName flexAlignCenter"});if(null!=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount]){null!=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount].files[0]&&(fileSizeEx=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount].files[0].size);var a=1e3,l=["Bytes","KB","MB","GB","TB"];if(0===fileSizeEx)return"0 Bytes";var c=parseInt(Math.floor(Math.log(fileSizeEx)/Math.log(a)),10);(fileSizeEx/Math.pow(a,c)).toPrecision(3);fileSize="- ("+(fileSizeEx/Math.pow(a,c)).toPrecision(3)+" "+l[c]+")";$("<span>",{class:"fL kanbanviewImages tkvAttachmentDoc"});var d=$("<span>",{class:"flNameSize mR10",html:$ESAPI.encoder().encodeForHTML(s)+" "+fileSize}),u=$("<span>",{class:"cP"}),m=$("<crmutil-icon>",{"icon-class":"zcicn-delete-md zcicn12 crmBaseIcon","icon-name":"delete-line"});u.click((function(){closeEl=$(this),closeEl.parent(".tkvFileName").remove(),--fileCount>0?($(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").addClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").removeClass("hide")):($("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("show"),$("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").addClass("hide"),$("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").removeClass("hide")),fileCount<=4&&$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").show(),-1===fileCount&&(fileCount=0),$(e).remove()})),fileCount>0?$(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"):$(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").addClass("hide"),fileCount<=4&&$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").show(),r.append(d),r.append(u),u.append(m),$(e.form).find("div[id='addAttachment_"+t+"']").find("#tkvMoreFiles").append(r)}return++fileCount>0&&($(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").addClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").removeClass("hide")),fileCount>4?($(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").hide(),!1):void 0},CrmAcs.showNewCreateGroupFromFeed=function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Groups){var e=document.getElementById("grps_createGroupPop");e&&(e.ltProp("offset",{top:"0",left:"center"}),e.ltProp("transition",{animation:"slideFromTop",duration:"0.4"}),e.ltProp({show:!0}),$L("#grps_groupNameInpBox")[0].cxProp("value",""),$L("#grps_txtAreaDesc")[0].cxProp("value",""))}else renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},CrmAcs.showElem=function(e){var t=$("#"+e);t.length>0&&t.slideToggle();var i=$("#entParamImg");i.hasClass("tw-arwup")?i.removeClass("tw-arwup"):i.addClass("tw-arwup")},$("body").click((function(e){var t=$("#feed_status");if(t.length){var i=e.target;$(i).parents(".feedDropzonetd").length>0&&!$(i).hasClass("bt-mediumnewgraybtn")?t.closest(".feed_newpost_textarea_bg").addClass("openNotes"):t.closest(".feed_newpost_textarea_bg").removeClass("openNotes")}})),org.owasp.esapi.ESAPI.initialize();var Telephony=function(){};Telephony.providerNameList=[],Telephony.usermailList=[],Telephony.currentCtikey="",Telephony.url=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",Telephony.countryData={},Telephony.saveKeyValue=function(){var e=$("#zpbkeyname").val(),t=$("#zpbkeyval").val(),i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o="action=saveKeyValue&keyname="+encodeURIComponent(e)+"&keyvalue="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:i,type:"POST",data:o,success:function(e){"success"===e?($("#zpbkeyname").val(""),$("#zpbkeyval").val(""),Telephony.showLoading("Keys Added Successfully","success")):Telephony.showLoading("There was an error..","failure"),Telephony.hideLoading()},error:function(e){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.assignActions=function(){$("#tabs").tabs({select:function(e,t){var i=t.index;$(t.tab).text();3==i&&Telephony.showProviderList($("#providerSelectList"))}}),$("#tabs-1 #search").on("keyup",(function(e){$("#showMoreData").hide(),Telephony.searchProviders($(this))})),$("#tabs-4 #provSearchList").on("keyup",(function(e){Telephony.searchProviderNameInProviderOrder($(this))})),$("#tabs-3 #providerNameforCount").on("keyup",(function(e){Telephony.searchProviderNameInPhoneNumberCountTab($(this))})),$("#tab1").on("click",(function(){Telephony.getAllProvidersList()})),$("#tab12").on("click",(function(){Telephony.getAllWidgetsList()})),$("#tab3").on("click",(function(){Telephony.getPhonenumberCountDetails()})),$("#tab8").on("click",(function(){Telephony.configurePBX()}))},Telephony.getPhonenumberCountDetails=function(){$("#tabs-3 tr.dummyclass").remove();var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showPhonenumbersCount&"+csrfParamName+"="+encodeURIComponent(csrfToken);Telephony.showLoading("Loading..","loading"),$.ajax({url:e,type:"POST",data:t,success:function(e){var t=JSON.parse(e);if("FAILURE"===t.result)Telephony.showLoading("Failure","failure");else{var i=t.numbercount,o=t.accountcount,n=JSON.parse(i),s=JSON.parse(o);$.each(n,(function(e,t){var i="";i+="<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' class='dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",i+="<td class='rowSpan'>"+t+"</td>",i+="<td class='rowSpan'>"+s[$ESAPI.encoder().encodeForJavaScript(e)]+"</td>",i+="</tr>",$("#countContent").append(i)}))}},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.searchProviderNameInPhoneNumberCountTab=function(e){var t=$.trim($(e).val().toLowerCase());if(t.length>0)$.each($("#tabs-3 tr.dummyclass"),(function(){var e=$(this).data("infokey")+"";-1!=$.trim(e.toLowerCase()).indexOf(t)?$(this).show():$(this).hide(),$("#countRow tr.dummyclass:visible").length>0?$("#countRow #norecord").closest("tr").remove():($("#countRow #norecord").closest("tr").remove(),$("div #countRow").append("<tr><td colspan='10'><div id='norecord' style='text-align:center;width:100%;padding: 50px 0 0 0;font-weight: bold;font-size: large;'> No records present</div></td></tr>"))}));else $("#countRow #norecord").closest("tr").remove(),$("#tabs-3 tr.dummyclass").show()},Telephony.searchProviders=function(e){$("#norecord").text(""),$("#dataRow tr:first").show();var t=$.trim($(e).val().toLowerCase());if(t.length>0){$.each($("#tabs-1 td.bridgeName"),(function(e){var i=$.trim($(this).html().toLowerCase()),o=$.trim($(this).closest("td").next("td").html().toLowerCase());-1!=i.indexOf(t)||-1!=o.indexOf(t)?$(this).closest("tr").show():$(this).closest("tr").hide()}));$("#dataRow tr:visible").length<=1?($("#norecord").text("No records present"),$("#dataRow tr:first").hide()):($("#norecord").text(""),$("#dataRow tr:first").show())}else $("#norecord").text(""),$("#tabs-1 tr").show()},Telephony.searchProviderNameInProviderOrder=function(e){var t=$.trim($(e).val().toLowerCase());if(t.length>0)$.each($("#tabs-4 tr.dummyclass"),(function(){var e=$(this).data("infokey")+"";-1!=$.trim(e.toLowerCase()).indexOf(t)?$(this).show():$(this).hide(),$("#provOrderRow tr.dummyclass:visible").length>0?$("#provOrderRow #norecord").closest("tr").remove():($("#provOrderRow #norecord").closest("tr").remove(),$("#provOrderRow").append("<tr><td colspan='10'><div id='norecord' style='text-align:center;width:100%;padding: 50px 0 0 0;font-weight: bold;font-size: large;'> No records present</div></td></tr>"))}));else $("#provOrderRow #norecord").closest("tr").remove(),$("#tabs-4 tr.dummyclass").show()},Telephony.getCustomerDetails=function(){var e=$("#customervalue").val(),t=$("#customervaluetype").val(),i=$("#ticketvalue").val(),o=$("#tickettype").val(),n=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",s="action=getCustomerDetails&customervalue="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&customervaluetype="+encodeURIComponent(t)+"&tickettype="+encodeURIComponent(o)+"&ticketvalue="+encodeURIComponent(i);Telephony.showLoading("Loading..","loading"),$.ajax({url:n,type:"POST",data:s,success:function(t){var i=JSON.parse(t);if($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #zgidDetailsNoRecord, #topzgidcontent, #phonenumberFromRedis, #accountConf, #detailinRedis, #agentTab").hide(),$("#portalDetailsDiv tr.dummyclass,div.dummyclass,#phonenumberFromRedis tr.dummyclass,#accountConf tr.dummyclass,#detailinRedis tr.dummyclass").remove(),$("#zgidofmail").text(""),"SUCCESS"===i.result)if(i.hasOwnProperty("phonedet")){var o=i.phonedet,n="<tr class='rowSpan dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(o.ctiname)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(""+o.zgid)+"</td></tr>";$("#phonenumberFromRedis table").append(n),$("#phonenumberFromRedis").show(),i.custzgid!=e?($("#zgidofmail").text(i.custzgid),$("#topzgidcontent").show()):$("#topzgidcontent").hide(),"ZTI"===i.comment?(document.getElementById("revokeZTIBtn").setAttribute("onclick","Telephony.revokeZTIDisabledGroup("+i.custzgid+")"),$("#revokeZTISpan").show()):"phonebridge"===i.comment&&(document.getElementById("revokeBtn").setAttribute("onclick","Telephony.revokeTelephony("+i.custzgid+")"),$("#revokeBtnSpan").show())}else if(i.hasOwnProperty("redisval")){var s=i.redisval,r="";$.each(s,(function(e,t){"authtoken"!=e&&(r+="<tr class='dummyclass'>",r+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>",r+="</tr>")})),$("#detailinRedis table").append(r),$("#detailinRedis").show()}else{if(i.hasOwnProperty("accountInfo")){var a=i.accountInfo,l="<tr style='background:#eee;' class='dummyclass'>",c="<tr class='dummyclass'>";$.each(a,(function(e,t){"authtoken"!=e&&""!=t&&(l+="<th class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</th>",c+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>")}));var d=(l+="</tr>")+(c+="</tr>");$("#accountConf table").append(d),$("#accountConf").show()}if(i.custzgid!=e?($("#zgidofmail").text(i.custzgid),$("#topzgidcontent").show()):$("#topzgidcontent").hide(),i.hasOwnProperty("providername")&&(i.providername.length<15?$("#zgidProviderName").text($ESAPI.encoder().encodeForHTML(i.providername)):($("#zgidProviderName").text($ESAPI.encoder().encodeForHTML(i.providername.substring(0,12)+"...")),$("#zgidProviderName").attr("title",$ESAPI.encoder().encodeForHTML(i.providername)))),$("#topInfo #totalUsers").text("0"),i.hasOwnProperty("users")){var u="",m=i.users,p=0;"twilio"===i.providername&&($.each(m,(function(e,t){p++,Telephony.usermailList.push(e),u+="<tr class='dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t.mailid)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",u+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t.status)+"</td></tr>",Telephony.usermailList[e]=t.mailid})),$("#userRow #twilioProvider").show(),$("#userRow #otherProviders").hide()),$("#userRow").append(u),$("#topInfo #totalUsers").text(p),$("#agentTab").show()}if(i.hasOwnProperty("ctinumber")){$("#phoneDetails").show();var g=i.ctinumber,f=0;$.each(g,(function(e,t){var i=e,o="";f++;var n="<h3 style='text-decoration:underline;width:150px;'>"+$ESAPI.encoder().encodeForHTML(i)+"</h3>",s="<div style='width:95%;'><table id='ivrdetails"+f+"' style='width:95%;border-collapse: collapse;border-spacing: 0;border-color: var(--notfoundColor);font-family: sans-serif;font-size: var(--crm-small-font-size);color: #434D5F;margin-left:40px;margin-bottom:10px'>",r="<table style='width:95%;border-collapse: collapse;border-spacing: 0;border-color: var(--notfoundColor);font-family: sans-serif;font-size: var(--crm-small-font-size);color: #434D5F;margin-left:40px;padding-bottom:2%'><tbody>";r+="<tr style='background:#eee'><th class='rowHeaderSpan'>Key</th><th class='rowHeaderSpan'>Value</th></tr>";$.each(t,(function(e,t){if("ivrdetails"===e)o=t;else{var i="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>";r+="<tr>"+i+"</tr>"}})),n+=s+"</table>",n+=r+="</tbody></table></div>",$("#portalDetailsDiv #accordion ").append(n).show(),""!=o&&Telephony.formIVRNextLevelDetail(o,f,0,1,1)})),$("#portalDetailsDiv #accordion").accordion({heightStyle:"content",collapsible:!0,autoHeight:!0,active:!1})}else $("#phoneDetails").hide();"ZTI"===i.comment?(document.getElementById("revokeZTIBtn").setAttribute("onclick","Telephony.revokeZTIDisabledGroup("+i.custzgid+")"),$("#revokeZTISpan").show()):"phonebridge"===i.comment&&(document.getElementById("revokeBtn").setAttribute("onclick","Telephony.revokeTelephony("+i.custzgid+")"),$("#revokeBtnSpan").show()),$("#agentDetails").show(),$("#topInfo, #portalDetailsDiv").show(),$("#zgidDetailsNoRecord").hide()}else $("#revokeBtnSpan, #topInfo, #portalDetailsDiv").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),$("#zgidDetailsNoRecord").text("No such Account/Phone Number"),$("#revokeZTISpan, #zgidDetailsNoRecord").show();Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.formIVRNextLevelDetail=function(e,t,i,o,n){var s="";try{s=JSON.parse(e)}catch(t){s=$(e).attr("details"),s=JSON.parse(s)}t=t||$(e).attr("num"),n=n||$(e).attr("preconfig")||$(e).attr("config");var r="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' style='background:#eee;'><th colspan='3' class='rowHeaderSpan'> LEVEL "+$ESAPI.encoder().encodeForHTML(""+o)+"</th></tr>";r+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' style='background:#eee;'><th class='rowHeaderSpan'>IVR Extn</th><th class='rowHeaderSpan'>IVR Msg</th><th class='rowHeaderSpan'>Action</th></tr>";var a=0;$.each(s,(function(e,i){if("0"!=e){if(r+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(i.presskey)+"</td>",r+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(i.menu)+"</td>","user"===i.actiontype){var s=i.action.salesReps;r+="<td class='rowSpan'>";for(var l=0;l<s.length;l++)r+=s[l]+"("+Telephony.usermailList[s[l]]+")  ";r+="</td>"}else if("ivr"===i.actiontype){a++;var c=n+""+a,d=o+1;r+="<td class='rowSpan ivrConfLink' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+c)+"' details='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(i.action))+"' num='"+t+"' onclick='Telephony.formIVRNextLevelDetail(this, "+t+", "+o+", "+d+", "+c+")'>Click for Next Level IVR</td>"}r+="</tr>"}}));var l=(n=""+n).slice(0,-1);r+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' preconfig='"+$ESAPI.encoder().encodeForHTMLAttribute(""+l)+"' class='ivrConfLink'><td colspan='3' class='rowSpan' level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' num='"+$ESAPI.encoder().encodeForHTMLAttribute(""+t)+"' onClick='Telephony.displayIVRLevelInfo("+i+", "+l+", "+t+")'>Click for Prev Level</td></tr>",Telephony.displayIVRLevelInfo(o,n,t,r)},Telephony.displayIVRLevelInfo=function(e,t,i,o){$("#ivrdetails"+i+" tr").hide(),0===$("#ivrdetails"+i+" tr[level='"+e+"'][config='"+t+"']").length&&$("#ivrdetails"+i).append(o).show(),$("#ivrdetails"+i+" tr[level='"+e+"'][config='"+t+"']").show()},Telephony.getAllProvidersList=function(){Telephony.showLoading("Loading ...","loading");var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showProviders&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){$("#norecord").text(""),$("#dataRow .dummyclass").remove();var t=JSON.parse(e),i=0;$.each(t,(function(e,t){var o="";i++;var n=JSON.parse(t),s=n.params,r="<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' data-infoData='"+$ESAPI.encoder().encodeForHTMLAttribute(t)+'\' class="dummyclass ">';r+="<td class='rowSpan bridgeName' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",Telephony.providerNameList.push(e),void 0!==s&&($.each(s,(function(e,t){n[$ESAPI.encoder().encodeForJavaScript(e)]=t})),delete n.params),void 0!==n.displayctiname?(r+="<td class='rowSpan displaybridgename' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.displayctiname)+"</td>",delete n.displayctiname):r+="<td class='rowSpan'>-</td>";var a="";void 0!==n.ctikey?(a+="<div><span style='float:left;'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" class='info-btn admintoolbtn' type='button' onclick='Telephony.sendKeytoProvider(this)' id='keyMailButton' value='Send PBKey'/></span></div></td>",delete n.ctikey):a+="</td>",void 0!==n.apitype?(r+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.apitype)+"</td>",n.apitype,delete n.apitype):r+="<td class='rowSpan'>-</td>",void 0!==n.betaaccesszgids?(r+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.betaaccesszgids)+"</td>",o=n.betaaccesszgids,delete n.betaaccesszgids):r+="<td class='rowSpan'>-</td>";r+="<td class='rowSpan' style='word-wrap:break-word' ><div id='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n))+"' style='text-align:center; text-decoration: underline;cursor: pointer;' onclick='Telephony.showMore(this)'>More</div></td>",r+="<td colspan='2' class='rowSpan' style='word-wrap:break-word'><div><span style='float:left;'><input class='info-btn admintoolbtn' style='width:70px' type='button' onclick='Telephony.editProvider(this)' id='editButton' value='Edit'/></span> <span style='float:left; padding-left:4px'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" style='width:70px' class='delete-btn admintoolbtn' type='button' value='Delete' onclick='Telephony.deleteProvider(this)'/></span></div>",r+=a,r+="</tr>","*"===o?$("#dataRow tbody#content").prepend(r):$("#dataRow tbody#content").append(r)})),$("#totalProviders").text(i),0===i?($("#norecord").append("No records present"),$("#dataRow tr:first").hide()):($("#norecord").text(""),$("#dataRow tr:first").show()),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.sendKeytoProvider=function(e){var t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i=$(e).attr("pbName");void 0===i&&(i=e);var o="action=sendPbkeytoProvider&sendtoprovider="+i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);1==confirm("Are you sure want to send the phonebridge key to the provider?")&&$.ajax({url:t,type:"POST",data:o,success:function(e){"SUCCESS"===JSON.parse(e).result?Telephony.showLoading("PhoneBridge key has been sent to the provider!","success"):Telephony.showLoading("Mail sending failed!","failure"),Telephony.hideLoading()}})},Telephony.showMore=function(e,t){$(".someMoreInfo").remove();var i=$(e).attr("id"),o=JSON.parse(i),n="";if($.each(o,(function(e,t){t=$ESAPI.encoder().encodeForHTML(""+t),n+="<tr class='someMoreInfo'><th style='width:20%;background: #eee;border: 1px solid #dbdbdb; color: var(--baseColor); padding: 6px; font-weight: bold;'>"+$ESAPI.encoder().encodeForHTML(""+e)+"</th><td style='width:30%;word-wrap: break-word;background: white;border: 1px solid #dbdbdb;padding:6px;'><span id='pbName'>"+t+"</span></td></tr>"})),void 0===o.callstate){t?$("#popupWidgetTable tbody").append(n):$("#popupTable tbody").append(n);var s=$(e).position();t?$("#showMoreWidgetData").css({left:s.left-420,top:s.top+20}).show():$("#showMoreData").css({left:s.left-420,top:s.top+20}).show()}else{$("#popupCallTable tbody").append(n);s=$(e).position();$("#showMoreCallData").css({left:s.left-420,top:s.top+20}).show()}},Telephony.closeEditPopup=function(e){e?($("#editWidgetForm").html(""),$("#editWidgetFormDiv").hide()):($("#editForm").html(""),$("#editFormDiv").hide()),$("#addProvidersForm").attr("action","add"),Telephony.updateNewViewEnabled()},Telephony.showProviderList=function(e){$(e).children("option").remove(),$.each(Telephony.providerNameList,(function(t,i){var o=i;$(e).append("<option>"+$ESAPI.encoder().encoderForHTML(o)+"</option>")}))},Telephony.editProvider=function(e,t){$("#addProvidersForm").attr("action","update");var i="#tabs-2",o="#editForm",n="#editFormDiv";t&&(i="#tabs-11",o="#editWidgetForm",n="#editWidgetFormDiv");var s=$(i).html(),r=$(o),a=$(n);r.html(s),a.show(),a.find("#addProviderBand").hide(),a.find("#addProvidersForm span:first").css({width:"48%",height:"460px"}),a.find("#addProvidersForm span:last").css({height:"460px"});var l=$(e).closest("tr").data("infodata"),c=$(e).closest("tr").data("infokey"),d="";if(null!=l.params&&(d=l.params),t)r.find("input#widgetName").val(c),r.find("input#widgetName").prop("disabled",!0),r.find("input#widgetDisplayName").val(c),r.find("input#widgetTitle").val(l.providerTitle),r.find("input#widgetLogoName").val(l.providerLogoName),r.find("input#widgetSubTitle").val(l.providerSubTitle),r.find("input#widgetSubTitleKey").val(l.subTitleKey),r.find("input#widgetShortContent").val(l.shortContent),r.find("input#widgetShortContentKey").val(l.shortContentKey),r.find("input#widgetLongContent").val(l.longContent),r.find("input#widgetLongContentKey").val(l.longContentKey),r.find("input#widgetDescription").val(l.description),r.find("input#widgetDescriptionKey").val(l.descriptionKey),r.find("input#widgetImageDetails").attr("value",l.imageDetails),r.find("input#widgetShortContentEnabled").val(l.shortContentEnabled),r.find("input#widgetShortContentKeyEnabled").val(l.shortContentKeyEnabled),r.find("input#widgetLongContentEnabled").val(l.longContentEnabled),r.find("input#widgetLongContentKeyEnabled").val(l.longContentKeyEnabled),r.find("input#widgetImageDetailsEnabled").attr("value",l.imageDetailsEnabled),r.find("input#widgetLogoClass").val(l.logoClass),r.find("input#widgetIconClass").val(l.iconClass),r.find("input#widgetEnableLink").val(l.enableLink),r.find("input#widgetDisableLink").val(l.enableLink);else{var u=l.apitype;l.apiUrl;if($("#isNewViewEnabled").prop("disabled",!1),"type2"===u)r.find("select#addctiapitype option:first").attr({selected:"selected"}),r.find("#type2_1_parameters").hide(),r.find("#type2_parameters").show(),r.find("#type4_parameters").hide(),r.find("input#type2click2callurl").val(d.click2callurl),r.find("input#type2answerurl").val(d.answerurl),r.find("input#type2hungupurl").val(d.hungupurl),r.find("input#ctiKey").val(l.ctikey),Telephony.currentCtikey=l.ctikey;else if("type2.1"===u)r.find("select#addctiapitype option:eq(1)").prop("selected",!0),r.find("#type2_1_parameters").show(),r.find("#type2_parameters").hide(),r.find("#type4_parameters").hide(),r.find("input[name='zohoservicename']").val(d.zohoservicename),r.find("input[name='zohoauthtoken']").val(d.authtoken),r.find("input[name='tpiauthtoken']").val(d.tpiauthtoken),r.find("input[name='ctinumber']").val(d.ctinumber),r.find("input[name='custnumber']").val(d.custnumber),r.find("input[name='ctiagentref']").val(d.ctiagentref),r.find("input[name='agentlist']").val(d.agents),r.find("input[name='callbackparam']").val(d.callbackparam),r.find("input[name='phonenumber']").val(d.phoneNumber),r.find("input[name='encryptedvalue']").val(d.encryptedvalue),r.find("input[name='validateauthtokenurl']").val(d.validateauthtokenurl),r.find("input[name='validatephonenumberurl']").val(d.validatephonenumberurl),r.find("input[name='addauthtokenurl']").val(d.addauthtokenurl),r.find("input[name='click2callurl']").val(d.click2callurl),r.find("input[name='answerurl']").val(d.answerurl),r.find("input[name='hungupurl']").val(d.hungupurl),r.find("input#ctiKey").val(l.ctikey),Telephony.currentCtikey=l.ctikey;else if(u.startsWith("type3"))r.find("select#addctiapitype option:eq(2)").attr({selected:"selected"}),r.find("input[name='zohoclientid']").val(l.zohoclientid),$("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").show(),r.find("input[name='others']").val(l.others);else if("type4"===u){if(r.find("select#addctiapitype option:eq(3)").attr({selected:"selected"}),r.find("#type2_1_parameters").hide(),r.find("#type2_parameters").hide(),r.find("#type4_parameters").show(),r.find("input#type4click2callurl").val(d.click2callurl),r.find("input#type4answerurl").val(d.answerurl),r.find("input#type4hungupurl").val(d.hungupurl),r.find("input#type4muteurl").val(d.muteurl),r.find("input#type4holdurl").val(d.holdurl),r.find("input#type4unmuteurl").val(d.unmuteurl),r.find("input#type4unholdurl").val(d.unholdurl),r.find("input#type4keypressurl").val(d.keypressurl),r.find("input#client_id").val(l.client_id),r.find("input#client_secret").val(l.client_secret),r.find("input#redirect_url").val(l.redirecturl),r.find("input#setuplink").val(l.setuplink),r.find("input#helpdoc").val(l.setupdoc),r.find("input#testapprov").val(l.testaccountapproved),r.find("input#testnotapprov").val(l.testaccountnotapproved),$("#paramtypeselect").val(l.authorizationtype),$("#pbxtype").val(l.pbxtype),void 0!==l.adddevtag){var m="true"===l.adddevtag.trim();r.find("#devTag").prop("checked",m)}var p="true"===l.ispbxavailable.trim();r.find("#pbxavailable").prop("checked",p),r.find("#iscontenttypejson").prop("checked",l.iscontenttypejson),r.find("#isproxyconnection").prop("checked",l.isproxyconnection),"true"==l.protocolsupport&&(r.find("#protocolsupport").prop("checked",!0),$("#protocol").show(),r.find("#protocolname").val(l.protocol)),$("#isNewViewEnabled").prop({checked:!0,disabled:!0}),"1"==l.oauthsupport&&($("#vendoroauthtype").val(l.vendoroauthtype),r.find("#vendoroauth").prop("checked",!0),r.find("#vendor_clientid").show(),r.find("#vendor_clientsecret").show(),r.find("#vendoroauthtyperow").show(),r.find("#oauthcode").show(),r.find("#oauthtoken").show(),r.find("#paramtype").show(),r.find("#paramname").show(),r.find("#scope").show(),r.find("input#oauthcodeurl").val(l.oauthcodeurl),r.find("input#oauthtokenurl").val(l.oauthtokenurl),r.find("input#vendor_client_id").val(l.vendor_client_id),r.find("input#vendor_client_secret").val(l.vendor_client_secret),r.find("input#vendor_scope").val(l.vendor_scope),r.find("input#paramnamevalue").val(l.name))}else"phonebridge"===u&&r.find("select#addctiapitype option:eq(5)").attr({selected:"selected"});if(r.find("select#addctiapitype").prop("disabled",!0),r.find("input#addbetazgids").val(l.betaaccesszgids),r.find("input#providerName").val(c),r.find("input#providerDisplayName").val(l.displayctiname),r.find("input#keygenratedemail").val(l.keygenratedemail),r.find("input#allowedCountries").attr("value",l.allowedCountries),r.find("#ctikeyrow").hide(),r.find("input#providerTitle").val(l.providerTitle),r.find("input#providerLogoName").val(l.providerLogoName),r.find("input#providerSubTitle").val(l.providerSubTitle),r.find("input#subTitleKey").val(l.subTitleKey),r.find("input#shortContent").val(l.shortContent),r.find("input#shortContentKey").val(l.shortContentKey),r.find("input#longContent").val(l.longContent),r.find("input#longContentKey").val(l.longContentKey),r.find("input#description").val(l.description),r.find("input#descriptionKey").val(l.descriptionKey),r.find("input#imageDetails").attr("value",l.imageDetails),r.find("input#shortContentEnabled").val(l.shortContentEnabled),r.find("input#shortContentKeyEnabled").val(l.shortContentKeyEnabled),r.find("input#longContentEnabled").val(l.longContentEnabled),r.find("input#longContentKeyEnabled").val(l.longContentKeyEnabled),r.find("input#imageDetailsEnabled").attr("value",l.imageDetailsEnabled),r.find("input#helpName").val(l.helpName),r.find("input#helpLink").val(l.helpLink),r.find("input#newUserHelp").val(l.newUserHelp),r.find("input#logoClass").val(l.logoClass),r.find("input#iconClass").val(l.iconClass),r.find("input#enableLink").val(l.enableLink),void 0!==l.addbetatag){var g="true"===l.addbetatag.trim();r.find("input#addBetaTag").prop("checked",g)}if(void 0!==l.isNew){var f="true"===l.isNew.trim();r.find("input#isNew").prop("checked",f)}if(void 0!==l.isNewViewEnabled){var h="true"===l.isNewViewEnabled.trim();r.find("input#isNewViewEnabled").prop("checked",h)}}},Telephony.showLoading=function(e,t){"loading"===t?($("#progressmsg").text(e),$("#progressBar").show()):("success"===t?$("#alertdiv span").removeClass("telephonyerrorInfo").addClass("successAlert"):"failure"===t&&$("#alertdiv span").removeClass("successAlert").addClass("telephonyerrorInfo"),$("#alertdiv span").text(e).show())},Telephony.hideLoading=function(){setTimeout((function(){$("#progressBar").hide()}),1500),setTimeout((function(){$("#alertdiv span").hide()}),1e4)},Telephony.selectCtiApiType=function(){var e=$("#addctiapitype option:selected").attr("value");$("#isNewViewEnabled").prop("disabled",!1),"type2.1"===e?($("#type2_1_parameters").show(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").hide()):"type2"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").show(),$("#type4_parameters").hide(),$("#type3_parameters").hide()):"type4"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").show(),$("#type3_parameters").hide(),$("#isNewViewEnabled").prop({checked:!0,disabled:!0})):"type3"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").show()):$("#type2_1_parameters, #type2_parameters, #type4_parameters, #type3_parameters").hide()},Telephony.addProvider=function(){Telephony.showLoading("In progress..","loading");var e,t=$("#addProvidersForm").attr("action"),i=(e="update"===t?$("#editForm select:visible, #editForm input:visible"):$("#addProvidersForm input:visible,select:visible")).filter("input"),o=e.filter("select"),n="action=addProvider&mode="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.each(i,(function(){var e=$(this).attr("name");if("ctiKey"!=e){var t="";"text"==$(this).attr("type")&&(t=$(this).val(),n+="&"+e+"="+encodeURIComponent(t))}})),n+="&ctiKey="+$("input#ctiKey").val();var s="";$("input#addBetaTag").is(":checked")&&(s="on"),n+="&addBetaTag="+s;var r="";$("input#isNew").is(":checked")&&(r="on"),n+="&isNew="+r;var a="";if($("input#isNewViewEnabled").is(":checked")&&(a="on"),n+="&isNewViewEnabled="+a,$.each(o,(function(){var e=$(this).attr("name"),t=$(this).children("option:selected").val();n+="&"+e+"="+t})),"type4"===$("#addctiapitype").val()){if($("#vendoroauth").prop("checked")){var l=$("#oauthcodeurl").val(),c=$("#oauthtokenurl").val(),d=$("#paramnamevalue").val(),u=$("#vendor_client_id").val(),m=$("#vendor_client_secret").val();if($("#headerintokenrequest").prop("checked")&&(n+="&headerintokenrequest=true"),""===l||""===c||""===d||""===u||""===m)return alert("please fill all the values"),!1}$("#protocolsupport").prop("checked")?n+="&protocolsupport=true":n+="&protocolsupport=false",$("#vendoroauth").prop("checked")?n+="&vendoroauth=1":n+="&vendoroauth=0",$("#devTag").prop("checked")?n+="&adddevtag=true":n+="&adddevtag=false",$("#pbxavailable").prop("checked")?n+="&ispbxavailable=true":n+="&ispbxavailable=false",$("#iscontenttypejson").prop("checked")?n+="&iscontenttypejson=true":n+="&iscontenttypejson=false",$("#isproxyconnection").prop("checked")?n+="&isproxyconnection=true":n+="&isproxyconnection=false"}var p=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";$.ajax({url:p,type:"POST",data:n,success:function(e){var i=JSON.parse(e);"update"===t&&Telephony.closeEditPopup(),"SUCCESS"===i.result?(Telephony.getAllProvidersList(),"add"===i.action?Telephony.showLoading("Data added successfully","success"):Telephony.showLoading("Data updated successfully","success"),Telephony.hideLoading(),$("#addProvidersForm input[type='text']:visible, #ctikeymsg").val(""),$("#addBetaTag").prop("checked",!1),$("#isNew").prop("checked",!1),Telephony.updateNewViewEnabled()):Telephony.showLoading("Failed to add- "+i.result,"failure"),Telephony.hideLoading()},fail:function(){Telephony.showLoading("Cannot add - Please check your inputs!!","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure"),Telephony.hideLoading()}}),Telephony.hideLoading()},Telephony.deleteProvider=function(e,t){var i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o=$(e).attr("pbName");void 0===o&&(o=e);var n="action=removeProvider&rmproviderName="+o+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);t&&(n+="&iswidget=true"),1==confirm("Are you sure want to delete this Provider ?")&&($.ajax({url:i,type:"POST",data:n,success:function(t){if("SUCCESS"===JSON.parse(t).result){$(e).closest("tr").remove();var i=parseInt($("#totalProviders").html())-1;$("#totalProviders").text(i),Telephony.showLoading("Data deleted successfully","success"),Telephony.hideLoading()}},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading())},Telephony.revokeZTIDisabledGroup=function(e){var t="action=revokeZTIDisabledGroup&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";1==confirm("Are you sure want to delete this group ?")&&($.ajax({url:i,type:"POST",data:t,success:function(e){"SUCCESS"===JSON.parse(e).result?($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #portalDetailsDiv, #zgidDetailsNoRecord").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),Telephony.showLoading("Data deleted successfully","success")):(Telephony.showLoading("Please check your input","failure"),$("#revokeZTISpan").hide(),$("#zgidDetailsNoRecord").text(""),$("#zgidDetailsNoRecord").text("No such account"))},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading())},Telephony.revokeTelephony=function(e){var t=$("#customervalue").val(),i=$("#customervaluetype").val(),o="action=revokeTelephony&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);"phonenumber"===i&&(o+="&phoneNumber="+encodeURIComponent(t));var n=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";1==confirm("Are you sure want to revoke telephony for this User ?")&&($.ajax({url:n,type:"POST",data:o,success:function(e){"SUCCESS"===e?($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #portalDetailsDiv, #zgidDetailsNoRecord").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),$("#tabs-5 #zgidDet").text(""),Telephony.showLoading("Data deleted successfully","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading())},Telephony.updateNewViewEnabled=function(){"type4"===$("#addctiapitype").val()?$("#isNewViewEnabled").prop({checked:!0,disabled:!0}):$("#isNewViewEnabled").prop("checked",!1)},Telephony.clearAllFields=function(){$("#addProvidersForm input[type='text']").val("")},Telephony.configurePBX=function(){var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=getType2AndType4Providers&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){if("success"===e.status){var t=e.providers,o="<option value=''>-select-</option>";for(i=0;i<t.length;i++)o=o+"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(t[i])+"'>"+$ESAPI.encoder().encodeForHTML(t[i])+"</option>";$("#pbxnameSelect").html(o),$("#tabs-8").show()}else Telephony.showLoading("Sorry - action failed","failure");Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.enablePBXAction=function(){var e=$("#zgidtoenable").val(),t="false";$("#sendemail").prop("checked")&&(t="true");var i=$("#pbxnameSelect option:selected").val(),o=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",n="action=enablePBX&zgid="+encodeURIComponent(e)+"&pbxname="+i+"&sendemail="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:o,type:"POST",data:n,success:function(e){"success"===e?($("#zgidtoenable").val(""),$("#pbxnameSelect option:first").attr({selected:"selected"}),Telephony.showLoading("Enabled for the given user(s)","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.disablePBXAction=function(){var e=$("#zgidtodisable").val(),t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i="action=disablePBX&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:t,type:"POST",data:i,success:function(e){"success"===e?($("#zgidtodisable").val(""),Telephony.showLoading("Disabled for the given user(s)","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(){f,Telephony.showLoading("There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.getCountryStats=function(){var e=[],t=($("#countryList").find(":selected").each((function(t,i){e.push($(i).text())})),e.filter((function(e){return!Telephony.countryData[e]}))),i={action:"getCountryDetails",countryList:JSON.stringify(t)};$(".countryVsProvider, .countryCode").remove(),t.length>=1?$.getJSON(Telephony.url,i,(function(t){$.each(t,(function(e,t){Telephony.countryData[e]=t})),Telephony.showCountryStats(e)})):Telephony.showCountryStats(e)},Telephony.showCountryStats=function(e){var t=$(".header");$.each(e,(function(e,i){var o=Telephony.countryData[i];t.append('<th class="rowHeaderSpan countryCode">'+i+"</th>"),$(".providers").each((function(e,t){$elem=$(t);var i=$elem.attr("id");$elem.append('<td align="center" class="rowClass countryVsProvider">'+Telephony.getCount(o[i+"_activeUser"])+" | "+Telephony.getCount(o[i+"_overallUser"])+" | "+Telephony.getCount(o[i+"_activeOrg"])+" | "+Telephony.getCount(o[i+"_overallOrg"])+"</td>")}))})),$("#countNotes").show()},Telephony.getCount=function(e){return e||0},Telephony.toggleBetaProviders=function(){$(".betaAccess").toggle()},Telephony.sendStatsMail=function(){var e={action:"sendStatsMail"};networkUtils.setCsrfParam(e),$.ajax({url:Telephony.url,type:"POST",data:e,success:function(e){"success"===e&&alert("Mail Sent Successfully")},error:function(){alert("An Error has occured. Please Try again")}})},Telephony.addWidget=function(){Telephony.showLoading("In progress..","loading");var e=$("#addProvidersForm").attr("action"),t=$("#addProvidersForm input:visible,select:visible"),i=t.filter("input"),o=(t.filter("select"),"action=addWidget&mode="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken));$.each(i,(function(){var e=$(this).attr("name"),t="";"text"==$(this).attr("type")&&(t=$(this).val(),o+="&"+e+"="+encodeURIComponent(t))}));var n=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";$.ajax({url:n,type:"POST",data:o,success:function(t){var i=JSON.parse(t);"update"===e&&Telephony.closeEditPopup(),"SUCCESS"===i.result?(Telephony.getAllProvidersList(),"add"===i.action?Telephony.showLoading("Data added successfully","success"):Telephony.showLoading("Data updated successfully","success"),Telephony.hideLoading(),$("#addProvidersForm input[type='text']:visible, #ctikeymsg").val(""),$("#addBetaTag").prop("checked",!1),$("#isNew").prop("checked",!1),Telephony.updateNewViewEnabled()):Telephony.showLoading("Failed to add- "+i.result,"failure"),Telephony.hideLoading()},fail:function(){Telephony.showLoading("Cannot add - Please check your inputs!!","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure"),Telephony.hideLoading()}}),Telephony.hideLoading()},Telephony.getAllWidgetsList=function(){Telephony.showLoading("Loading ...","loading");var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showWidgets&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){$("#noWidgetRecord").text(""),$("#widgetDataRow .dummyclass").remove();var t=JSON.parse(e),i=0;$.each(t,(function(e,t){i++;var o=JSON.parse(t),n=(o.params,"<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' data-infoData='"+$ESAPI.encoder().encodeForHTMLAttribute(t)+'\' class="dummyclass ">');n+="<td class='rowSpan bridgeName' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",Telephony.providerNameList.push(e),void 0!==o.enableLink?(n+="<td class='rowSpan displaybridgename' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(o.enableLink)+"</td>",delete o.enableLink):n+="<td class='rowSpan'>https://pbx.com/enablelink</td>",void 0!==o.disableLink?(n+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(o.disableLink)+"</td>",o.disableLink,delete o.disableLink):n+="<td class='rowSpan'>https://pbx.com/diablelink</td>";n+="<td class='rowSpan' style='word-wrap:break-word' ><div id='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(o))+"' style='text-align:center; text-decoration: underline;cursor: pointer;' onclick='Telephony.showMore(this,true)'>More</div></td>",n+="<td colspan='2' class='rowSpan' style='word-wrap:break-word'><div><span style='float:left;'><input class='info-btn admintoolbtn' style='width:70px' type='button' onclick='Telephony.editProvider(this,true)' id='editButton' value='Edit'/></span> <span style='float:left; padding-left:4px'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" style='width:70px' class='delete-btn admintoolbtn' type='button' value='Delete' onclick='Telephony.deleteProvider(this,true)'/></span></div>",n+="</tr>",$("#widgetDataRow tbody#widgetContent").append(n)})),$("#totalWidgets").text(i),0===i?($("#noWidgetRecord").append("No records present"),$("#widgetDataRow tr:first").hide()):($("#noWidgetRecord").text(""),$("#widgetDataRow tr:first").show()),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.manageDeveloperStatus=function(e,t){if(null==t&&(t=$("#developerzgid").val()),$("#developerdata tr").remove(),validationUtils.isEmpty(t))Telephony.showLoading("Please provide Valid ZGID","failure"),Telephony.hideLoading();else{var i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o="action=manageDeveloperStatus&operation="+e+"&developerzgid="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:i,type:"POST",data:o,dataType:"json",success:function(e){if("success"===e.status)if($("#developerzgid").val(""),"view"===e.operation){var t="";t+="<tr class='dummyclass'>",t+="<td class='rowSpan'>"+e.developerStatus+"</td>","false"===e.developerStatus?t+="<td class='rowSpan'><input type='button' value='Enable Developer Access' class='greenbtn mL0 pL10 pR10' onclick='Telephony.manageDeveloperStatus(\"add\","+e.developerzgid+");'/></td></tr>":t+="<td class='rowSpan'><input type='button' value='Revoke Developer Access' class='redbtn mL0 pL10 pR10' onclick='Telephony.manageDeveloperStatus(\"delete\",,"+e.developerzgid+");'/></td></tr>",$("#developerdata").append(t)}else"add"===e.operation?Telephony.showLoading("Developer Status given successfully","success"):"delete"===e.operation&&Telephony.showLoading("Developer Status revoked successfully","success");else"invalid_user"===e.errorCode?Telephony.showLoading(e.developerzgid+" does not have a Zoho Account ","failure"):"invalid_crm_user"===e.errorCode?Telephony.showLoading(e.developerzgid+" does not have a Zoho CRM Account ","failure"):Telephony.showLoading("There was an error.. Please refresh your page and try again!!","failure");Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()}},Telephony.enablePhonebridgeFeature=function(){var e=$("#zgid_trial").val();if(e){var t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i="action=enablefeaturetrail&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:t,type:"POST",data:i,success:function(e){"success"===JSON.parse(e).status?(Telephony.showLoading("Telephony feature enabled","success"),Telephony.hideLoading()):(Telephony.showLoading("Invalid ZGID","failure"),Telephony.hideLoading())}})}};