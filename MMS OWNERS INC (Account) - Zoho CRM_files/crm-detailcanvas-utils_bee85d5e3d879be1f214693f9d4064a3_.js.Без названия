lyteDomObj.prototype.getviewport=function(){for(var e=$L(),t=$L(window),i=t.scrollTop(),a=i+t.height(),n=this.length,r=0;r<n;r++){var o=$L(this.eq(r)),s=o.offset().top,l=o.height();s<=a&&s+l>=i&&(e=e.add(o))}return e};var canvasDetailView={restrictedLinks:[],cscriptFieldAttribs:{},cscriptButtonAttribs:{},uiElementIdAttribs:{}},reinitCscriptDV=function(){canvasDetailView&&(canvasDetailView.cscriptFieldAttribs={},canvasDetailView.cscriptButtonAttribs={},canvasDetailView.uiElementIdAttribs={},canvasDetailView.restrictedLinks=[],canvasDetailView.cscriptOnloadTriggered=!1)};Lyte.Mixin.register("crm-detailcanvas-utils",{canvasInfoCount:{},isSectionMigrationNeed:!1,isLazyLoad:!0,requestedRule:[],ListCardComp:[],deletedRule:[],maincompname:void 0,ruledelete:!1,CanvasIdVsCanvasComp:{},CompVsRule:{},themefontmap:{styleValue:{LatoBold:"b",LatoRegular:"r",LatoSemiBold:"s"}},context_selector_mapping:Crm.userDetails.timelineRevamp?{table_row:"lyte-tr",table_link:"lyte-td a",table_column:"lyte-tr lyte-td",table_head:"lyte-th",notes_title:".cruxNotesList .cxNoteTitleSpan",notes_link:".cruxNotesList .cxNotesModuleRecordName, #summarizeNotes",notes_separator:".cruxNotesLi",notes_content:".cruxNotesList .notesAddedContent",notes_footer:".cruxNotesList .notesOtherActionDetails .cxNotesGreyColor",timeline_date:".tl_canvas_auditedDate",timeline_time:".tl_canvas_auditedTime",timeline_content:".tl_canvas_content,.tl_canvas_content p,.tl_canvas_content span",timeline_link:"link-to a,.TimeLineHighTxt",timeline_old_value:".tl_canvas_oldValue",timeline_new_value:".tl_canvas_newValue",timeline_owner_field:".tl_canvas_footer .tl_canvas_ownerField",timeline_footer:".tl_canvas_footer span,.tl_canvas_footer p",blueprint_title:".zcm-bp-state-title",blueprint_content:".zcm-bp-state-content",blueprint_link:".zcm-bp-transition",checklist_title:".zcm-checklist-title",checklist_content:".zcm-checklist-name",checklist_icon:".zcm-checklist-icon-container",checklist_separator:".zcm-checklist-container",commentinfo_content:".zcm-commentinfo-content",commentinfo_footer:".zcm-commentinfo-date",commentinfo_separator:".zcm-commentinfo-fields-container",segmentation_title:".zcm-segment-title",segmentation_value:".zcm-segment-field-value",segmentation_score_value:".zcm-segment-score",segmentation_label:".zcm-segment-field-label",segmentation_score:".zcm-segment-score-container",segmentation_header:".zcm-segment-title-container",segmentaiton_separator:".zcm-segment-content-container",attachment_title:".zcm-attachment-title",attachment_username:".zcm-attachment-username",attachment_separator:".zcm-attachment-container",pdetail_header:".zcm-pdetail-header-container",pdetail_range_label:".zcm-pdetail-range-label",pdetail_discount_label:".zcm-pdetail-discount-label",pdetail_separator:".zcm-pdetail-data-container",pdetail_range:".zcm-pdetail-range",pdetail_discount:".zcm-pdetail-discount",stage_name:".zc-mobile-stage-name",stage_amount:".zc-mobile-stage-amount",email_filter_title:".zcm-email-filter-title",email_filter_icon:".zcm-email-filter-icon",email_username:".zcm-email-username",email_subject:".zcm-email-subject",email_time:".zcm-email-time",email_separator:".zcm-email-content-container",email_header:".zcm-email-filter-container",plhistory_primary_circle:".zcm-picklist-steps-circle.zcm-primary-cirlce",plhistory_date:".zcm-picklist-date",plhistory_month:".zcm-picklist-month",plhistory_vline:".zcm-picklist-steps-vline",plhistory_circle:".zcm-picklist-steps-circle",plhistory_value:".zcm-picklist-value",plhistory_username:".zcm-picklist-username",plhistory_duration:".zcm-picklist-duration-container",plhistory_year_wrapper:".zcm-picklist-year",plhistory_year:".zcm-picklist-year-text",subform_header:".zcm-subform-column",subform_header_text:".zcm-subform-column-text",subform_row:".zcm-subform-row",subform_normal_cell:".zcm-subform-normal-cell",subform_aggregate_field_label:".zcm-subform-subtable-label",subform_aggregate_field_value:".zcm-subform-subtable-value",zcm_note_title:".zcm-note-title",zcm_note_separator:".zcm-note-separator",zcm_note_footer:".zcm-note-footer",button:".subFrmAggTablWrapper button,.pdAddRow button,.subFrmAggTablWrapper #guidedSellingDropDownButton",value:"value"}:{table_row:"lyte-tr",table_link:"lyte-td a",table_column:"lyte-tr lyte-td",table_head:"lyte-th",notes_title:".cruxNotesList .cxNoteTitleSpan",notes_link:".cruxNotesList .cxNotesModuleRecordName, #summarizeNotes",notes_separator:".cruxNotesLi",notes_content:".cruxNotesList .notesAddedContent",notes_footer:".cruxNotesList .notesOtherActionDetails .cxNotesGreyColor",timeline_date:".timeLineHistDate",timeline_time:".timeLineHistTime",timeline_content:".timeLineHistCont,.timeline_added.Notes span pre,.timeLineHistCont div,.timeLineHistCont span",timeline_link:"link-to a,.TimeLineHighTxt",timeline_old_value:".tl_from",timeline_new_value:".tl_to",timeline_owner_field:'span[purpose="showUserBC"]',timeline_footer:".tl_dat,.tl_by",blueprint_title:".zcm-bp-state-title",blueprint_content:".zcm-bp-state-content",blueprint_link:".zcm-bp-transition",checklist_title:".zcm-checklist-title",checklist_content:".zcm-checklist-name",checklist_icon:".zcm-checklist-icon-container",checklist_separator:".zcm-checklist-container",commentinfo_content:".zcm-commentinfo-content",commentinfo_footer:".zcm-commentinfo-date",commentinfo_separator:".zcm-commentinfo-fields-container",segmentation_title:".zcm-segment-title",segmentation_value:".zcm-segment-field-value",segmentation_score_value:".zcm-segment-score",segmentation_label:".zcm-segment-field-label",segmentation_score:".zcm-segment-score-container",segmentation_header:".zcm-segment-title-container",segmentaiton_separator:".zcm-segment-content-container",attachment_title:".zcm-attachment-title",attachment_username:".zcm-attachment-username",attachment_separator:".zcm-attachment-container",pdetail_header:".zcm-pdetail-header-container",pdetail_range_label:".zcm-pdetail-range-label",pdetail_discount_label:".zcm-pdetail-discount-label",pdetail_separator:".zcm-pdetail-data-container",pdetail_range:".zcm-pdetail-range",pdetail_discount:".zcm-pdetail-discount",stage_name:".zc-mobile-stage-name",stage_amount:".zc-mobile-stage-amount",email_filter_title:".zcm-email-filter-title",email_filter_icon:".zcm-email-filter-icon",email_username:".zcm-email-username",email_subject:".zcm-email-subject",email_time:".zcm-email-time",email_separator:".zcm-email-content-container",email_header:".zcm-email-filter-container",plhistory_primary_circle:".zcm-picklist-steps-circle.zcm-primary-cirlce",plhistory_date:".zcm-picklist-date",plhistory_month:".zcm-picklist-month",plhistory_vline:".zcm-picklist-steps-vline",plhistory_circle:".zcm-picklist-steps-circle",plhistory_value:".zcm-picklist-value",plhistory_username:".zcm-picklist-username",plhistory_duration:".zcm-picklist-duration-container",plhistory_year_wrapper:".zcm-picklist-year",plhistory_year:".zcm-picklist-year-text",subform_header:".zcm-subform-column",subform_header_text:".zcm-subform-column-text",subform_row:".zcm-subform-row",subform_normal_cell:".zcm-subform-normal-cell",subform_aggregate_field_label:".zcm-subform-subtable-label",subform_aggregate_field_value:".zcm-subform-subtable-value",zcm_note_title:".zcm-note-title",zcm_note_separator:".zcm-note-separator",zcm_note_footer:".zcm-note-footer",button:".subFrmAggTablWrapper button,.pdAddRow button,.subFrmAggTablWrapper #guidedSellingDropDownButton",value:"value"},context_old_selector_mapping:{".cruxNotesList .moduleRecordName":".cruxNotesList .cxNotesModuleRecordName, #summarizeNotes",".cruxNotesList .notesOtherActionDetails .notesgray":".cruxNotesList .notesOtherActionDetails .cxNotesGreyColor",".timeLineHistCont,.timeline_added.Notes span pre":".timeLineHistCont,.timeline_added.Notes span pre,.timeLineHistCont div,.timeLineHistCont span"},cscript_action_mapping:{edit_record:"edit",clone_record:"clone",convert_record:"convert",send_mail:"send_mail",delete_record:"delete",mail_merge:"mail_merge",schedule_online_meeting:"scheduleonlinemeeting",client_portal_invite:"inviteClientPortal",previous_record:"previous_record",next_record:"next_record",page_back:"back",print_preview:"print_preview",share_via_slack:"slack",share_via_cisco:"cisco",share_via_cliq:"cliq"},cscript_create_action_mapping:{record_save:"save",record_save_and_new:"saveandnew",record_cancel:"cancel",copy_address:"copyaddress"},lazyloadexclude:["stage_navigator","blueprint","abm","competitor_mentions"],LRuleManField:[],layoutRuleShowFld:[],layoutRuleShowSections:[],layoutRuleSubformSections:[],revlayoutRuleShowFld:[],revlayoutRuleShowSections:[],revlayoutRuleSubformSections:[],customLruleFieldsArr:[],revLRuleManField:[],lRuleSubformSections:[],RpHiddenFldId:[],RpPermissionLessFldId:[],ajaxLookupFldId:void 0,blueprintFldId:void 0,isBluePrintTrans:!1,showStage:!0,supportedUITypesForFieldClick:!0,canvas_rl_list:[],visionApprovals:[],isImageModified:{},relListIdsinView:[],relListCountObject:{},right_panel_info:{},visitFldColumn:["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"],staticButtons:["canvas_button_group"],staticComponents:["timeline","journeys","sales_summary","data_privacy","stage_navigator","followers","blueprint","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","pathfinders","segmentation","best_time","prediction","churn_prediction","zia_score","recommendation","similarity","competitor_mentions","Activities","Activities_History","Entity_Scores__s","next_best_action","abm","series","kiosk","right_panel","participants","recordings","availability_information","service_members","meeting_invitation","custom_link_rl"],staticRlMapping:["Activities","Activities_History","Entity_Scores__s"],staticRelViewableComp:["Notes","Attachments"],static_sub_type_relatedlist:["kiosk"],portalSupportedStaticComp:["data_privacy","stage_navigator","Activities","Activities_History"],recordCountDisableRL:["Notes","Emails","timeline","sales_summary","data_privacy","stage_navigator","followers","blueprint","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","pathfinders","segmentation","best_time","prediction","churn_prediction","zia_score","recommendation","similarity","competitor_mentions","Activities","Activities_History","Entity_Scores__s","next_best_action","abm","subform","Social","Visits_Zoho_Livedesk","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Polls","Questions_and_Answers","Zoho_Support","zohoshowtime__Zoho_ShowTime","Forecasts","Desk","Data_Subject_Requests","Consents","Wizard_Text_Comp","Wizard_Widget_Comp"],canvasRuleUnsupportComp:["timeline","journeys","sales_summary","data_privacy","stage_navigator","followers","blueprint","Activities","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","pathfinders","segmentation","best_time","prediction","churn_prediction","zia_score","recommendation","similarity","competitor_mentions","Notes","Attachments","next_best_action","Social","Visits_Zoho_Livedesk","Competitors","CheckLists","Stage_History","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Polls","Questions_and_Answers","Child_Campaigns","Zoho_Support","Emails","EmailSentiment","Visits","Activities","Appointments_History__s","Open_Appointments__s",,"Data_Subject_Requests","Consents","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","DealHistory","messages__s","Forecasts","abm","Approvals"],mobileUnsupportComp:{relatedlist:["Stage_History","Contact_Roles","Campaigns","Social","Visits_Zoho_Livedesk","Competitors","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Polls","Questions_and_Answers","Child_Campaigns","Zoho_Support","LinkedIn Sales Navigator","Entity_Scores__s","messages__s","Circuit_Executions","Open_Appointments__s","Appointments_History__s","zia_score","Voice_of_the_Customer__s","Entity_Cadences__s"],action:["send_mail","edit","clone","delete","print_preview","back","convert","exportpdf"],fields:["444","556","209","250"]},moduleVsFieldNames:{Deals:["Deal_Name","Stage","Closing_Date","Amount"],Leads:["Last_Name","Lead_Source","Lead_Status"],Accounts:["Account_Name","Owner"],Contacts:["Record_Image","Last_Name","Email"],Products:["Product_Name","Unit_Price","Manufacturer","Product_Active"],Calls:["Subject","Call_Duration","Call_Start_Time"],Tasks:["Subject","Priority","Status","Owner"],Events:["Event_Title","Start_DateTime","Check_In_Time"],Events_History:["Event_Title","Start_DateTime","Check_In_Time"],Meetings:["Event_Title","Start_DateTime","Check_In_Time"],Invited_Events:["Event_Title","Start_DateTime","Owner","End_DateTime","Status"],Price_Books:["Price_Book_Name","Pricing_Model","Active"],Quotes:["Subject","Grand_Total","Quote_Stage"],Sales_Orders:["Subject","Status","Grand_Total"],Purchase_Orders:["Subject","Status","Grand_Total"],Invoices:["Subject","Status","Grand_Total"],Cases:["Subject","Case_Origin","Status","\t"],Solutions:["Solution_Title","Status"],MemberAccounts:["Account_Name","Owner"],Vendors:["Vendor_Name","Email","Record_Image"],ReportingContacts:["Record_Image","Last_Name","Account_Name"],CustomModule:["Name","Owner"]},integ_comp:["Social","Visits_Zoho_Livedesk","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Zoho_Support","Emails","LinkedIn_Sales_Navigator","Circuit_Executions","Voice_of_Customer__s","Voice_of_the_Customer__s"],getCompNamefromId:function(e){for(var t="",i=e.length,a=0;a<i;a++)t=t.concat((10+parseInt(e[a])).toString(36));return"canvas-"+t+"-view"},componentvsEditionCheck(e){var t=Crm.userDetails.LICENSE_TYPE,i={orchestrations:["S","Y","R","P"],pathfinders:["S","Y","R","P"],best_time:["S","Y","R","P"],churn_prediction:["S","Y","R","P"],zia_score:["S","Y","R","P"],prediction:["S","Y","R","P"],competitor_mentions:["S","Y","R","P"]};return!(i[e]&&i[e].indexOf(t)>-1)},getReviewProcessFields:function(e){var t=[];if(e){if(e.length>0&&"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var i=Lyte.registeredMixins["crm-detailcanvas-utils"],a=i.revlayoutRuleShowFld;i.RpHiddenFldId=e.filter((function(e){var t=!1,n=store.peekRecord("field",e.id);return i.revlayoutRuleShowSections.includes(n.section[0].name)&&(t=!0),n.visible&&(a.includes(e.id)||t)}));var n=[];i.RpHiddenFldId.filter((function(e){n.push(e.id)})),i.RpHiddenFldId=n;var r=[];e.filter((function(e){store.peekRecord("field",e.id).visible||r.push(e.id)})),i.RpPermissionLessFldId=r,e=a&&e.filter((function(e){return!a.includes(e.id)&&store.peekRecord("field",e.id).visible}))}for(var o=e,s=o.length,l=0;l<s;l++){if(o[l].hasOwnProperty("subform_records"))for(var d=o[l].subform_records,c=d.length,u=0;u<c;u++)for(var m=d[u].process_fields,p=m.length,v=0;v<p;v++){var f=m[v];t.push(f.id)}t.push(o[l].id)}return t}return t},RelListActionsPreProcess:function(e){for(var t=[],i=e[0].children,a=i.length,n=0;n<a;n++){var r=i[n],o=r.children[0],s="dummyDiv"===r.type?"dummyDiv"===(o&&o.type)?o.children[0]:o:r,l=s.datatype?s.id:null;null!==l&&t.push(l)}return t},RelListTitleProcess:function(e,t,i,a,n,r,o){for(var s=t.length,l="",d=null,c=0;c<s;c++)"relatedlist"===t[c].type&&t[c].id&&(l=t[c].id),t[c].details&&(d=t[c].details);var u=e.children||[],m=u.length,p=store.peekRecord("related_list",l),v=["Activities_History","Activities","availability_information","participants","custom_link_rl"].indexOf(l)>-1&&Crm.isActivitySplitDone;if(n||p&&p.visible||v)for(c=0;c<m;c++){var f,_=u[c],h=_.children[0];if("dummyDiv"!==(f=Crm.userDetails.CANVAS_PARSER_REVAMP?_:"dummyDiv"===_.type?"dummyDiv"===(h&&h.type)?h.children[0]:h:_).type){if("Static Text"===f.theme&&f.ui.value.class&&f.ui.value.class.indexOf("zc_disabled")>-1){if(v){P='<span id="RL_dataCount_'+l+'" data-zcqa="canvasCnt_'+l+'"></span>';for(var g,y=store.peekAll("related_list"),b=y.length,C=0;C<b;C++){if((x=y[C]).api_name===l){g=x.display_label;break}}if(g&&(f.ui.value.value=g),f.ui.value.value=f.ui.value.value+P,"availability_information"===l){f.ui.value.value=f.ui.value.value+'<span class="zcstatic-unavailability-text  red1"> &nbsp;-&nbsp; </span>',f.ui.value.class+=" zc-relatedlist-title-availability_information"}p={id:l}}else{var L=this.labelPreProcess(p,{module:i,entityData:{id:a}});f.ui.value.value=L}if(!f.ui.value.zcode&&p)if(p.display_label)f.ui.value.zcode={name:p.display_label+"-title"};else if(p.id){var R;R="Activities"===p.id||"Activities_History"===p.id?"Activities"===p.id?I18n.getMsg("crm.label.open.activities",I18n.getMsg("Activities")):I18n.getMsg("crm.label.closed.activities",I18n.getMsg("Activities")):p.id,f.ui.value.zcode={name:R+"-title"}}}if(v&&(p={id:l}),"action"===f.type){if(clientPortalName){u.splice(c,1),c--,m=u.length;continue}if(0===f.id.indexOf("moreRLActions")){var w=this.RelListActionsPreProcess(t);f.includedActions=w}f.value=this.getRelListButton(p,f,i)}}else this.RelListTitleProcess(_,t,i,a,!0)}else{var x=store.peekRecord(moduleRecordMapping[i].id,a),I=store.peekRecord("field",l),S=u[0]&&"dummyDiv"===u[0].type?"dummyDiv"===(u[0].children[0]&&u[0].children[0].type)?u[0].children[0].children[0]:u[0].children[0]:u[0];if("stage_navigator"===l&&("Potentials"===i||"Deals"===i)&&x&&x.$process_flow&&m>0){Crm.canvasStageName=this.data.components.filter((function(e){return e.name===l}))[0].display_label;var D=Lyte.registeredMixins["crm-detailcanvas-utils"],z=D.showStage,M=D.isBluePrintTrans;S.ui.value.class.indexOf("zc_disabled")>-1&&((z||M)&&M&&!clientPortalName?S.ui.value.value=I18n.getMsg("crm.label.cf.blueprint"):S.ui.value.value=I18n.getMsg("Stage"))}else if("stage_navigator"===l&&("Potentials"===i||"Deals"===i)&&m>0&&S.ui.value.class.indexOf("zc_disabled")>-1)S.ui.value.value=I18n.getMsg("Stage");else if(I&&("subform"===I.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===I.data_type||"Product_Details"===I.api_name||"Pricing_Details"===I.api_name)&&m>0&&S.ui.value.class.indexOf("zc_disabled")>-1){"form_create"!==r&&"form_edit"!==r&&"form_clone"!==r||!I.required||(S.ui.value.class=S.ui.value.class+" zc_mandatorysubform");var k=I.section.filter((function(e){return e.layout&&e.layout.id===o}))[0];if(("subform"===I.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===I.data_type)&&k&&k.properties&&k.properties.tooltip){var A=k.properties.tooltip;S.ui.value.value="form_create"===r||"form_edit"===r||"form_clone"===r?I.field_label+'<i class="mL10 dIF zcicon zcanvas icon-Icon_Info_outline zcanvas-input-icon1 zcanvas-input-icon-label zcanvas_icon_nochange" lt-prop-title="'+A.value+'" lt-prop-tooltip-class="toolTClass" lt-prop-tooltip-config=\'{"position":"topright","margin" : "5","hidedelay" : "250"}\'></i>':I.field_label+'<i class="mL10 dIF" lt-prop-title="'+A.value+'" lt-prop-tooltip-class="toolTClass" lt-prop-tooltip-config=\'{"position":"topright","margin" : "5","hidedelay" : "250"}\'><crmutil-icon icon-name="info-rounded" icon-class="zcicn-info-rounded crmBaseIcon "></crmutil-icon></i>'}else S.ui.value.value=I.field_label}else{var F=[];if(this.data.components)if("form_create"!==r&&"form_edit"!==r&&"form_clone"!==r||!this.data.components.components)F=this.data.components.filter((function(e){return e.name===l}));else var F=this.data.components.components.filter((function(e){return e.name===l}));if(F.length&&m>0){var P='<span id="RL_dataCount_'+l+'" data-zcqa="canvasCnt_'+l+'"></span>';S.ui.value.value=S.ui.value.class.indexOf("zc_disabled")>-1?F[0].display_label+P:S.ui.value.value}d&&d.id&&d.connection_id&&(S.ui.value.value="<span> {{extensionmeta.canvas_datahub."+zutils.replaceDotWithUnderScore(d.connection_id)+".label}} </span>")}}},labelPreProcess:function(e,t,i){var a=this.countAndRefreshIconHandler(e);if(i)return $ESAPI.encoder().encodeForHTML(e.display_label);var n=e.api_name,r=e.type;if("custom_function"===r)return'<span class="customRLName_'+e.id.toString()+'" data-zcqa="customRLName_'+e.id.toString()+'">'+$ESAPI.encoder().encodeForHTML(e.display_label)+'</span><span id="customRLCount_'+e.id.toString()+'" data-zcqa="customRLCount_'+e.id.toString()+'" style="height: 10px; padding: 2px 5px; background-color: rgb(224, 224, 224); border-radius: 2px; line-height: 12px; text-align: center; font-size: 12px; cursor: auto;" class="mL8 dIB hide"></span><div id=\'customRLRef_'+e.id.toString()+'\'data-zcqa="refresh_customRLRef" class="mL10 tb_small_loader vaM" onclick="javascript:CustomRelatedListObj.reloadRL(\''+e.id.toString()+'\');"><span class="ld_init"/><span class="ld_process"/></div>';if("custom_related_list"===r)return $ESAPI.encoder().encodeForHTML(e.display_label);switch(n){case"Zoho_Finance":case"Zoho_Books":case"Zoho_Invoice":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL5 dIB lh14 vaT cP scale9 mT1" id="zinvoiceRef" onclick="javascript:ZInvoice.loadRL(\'ZINVOICEPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Expense":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL5 dIB lh14 vaT cP scale9 mT1" id="zExpenseRefresh" onclick="javascript:ZInvoice.loadRL(\'ZEXPENSEPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Subscriptions":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL5 dIB lh14 vaT cP scale9 mT1" id="zSubscriptionsRefresh" onclick="javascript:ZInvoice.loadRL(\'ZSUBSCRIPTIONSPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Survey":return'<crm-zsurvey-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-zsurvey-rl-label>';case"Zoho_Support":return'<crm-zdesk-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-zdesk-rl-label>';case"Circuit_Executions":return'<crm-circuits-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-circuits-rl-label>';default:return'<lyte-text id="label_'+e.id+'" class="rl_name" lt-prop-value = "'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></lyte-text>'+a}},relatedListDataCnt:function(e,t,i,a){Crm.userDetails.isRLCountSupportedForCanvas&&(a=Lyte.registeredMixins["crm-detailcanvas-utils"].relListCountObject[t]);0!=e.relRecords.length&&"showPreviousRel"!==i.nav_type&&Lyte.triggerEvent("relatedListCount",{id:t,api_name:e.module[0]?e.module[0].api_name:e.module.api_name,more_records:e.relRecords.info&&e.relRecords.info.more_records,per_page:e.relRecords.info&&e.relRecords.info.per_page,page:e.relRecords.info&&e.relRecords.info.page,count:e.relRecords.info&&e.relRecords.info.count,format:"template",rlcount:a})},tabHandler:function(e){if(e){Lyte.Component.viewPortSettings.executePendingViewPortElements();var t=e.attr("data-tab");if(t){var i=document.querySelector(t+" crm-stage-history");if(i){var a=i.component;setTimeout((function(){a.setWidthForStagesParent.bind(a)()}),100)}var n=$L("crm-zia-score-result"),r=$("#ziascorechart");n.length&&r.length&&n[0].component.scoreChart()}}Lyte.registeredMixins["crm-detailcanvas-utils"].scrollhandler()},tabrefresh:function(e){for(var t=zclayout.prototype.layouts["Tab Layout"],i=e.find(".zctabview:not(.zcrefreshedlayout)"),a=i.length,n=0;n<a;n++){t.refreshlayout(i.eq(n),this.tabHandler);var r=Lyte.Router.getRouteInstance().transition.data;r&&r.canvasActiveTabs&&r.canvasActiveTabs[i.eq(n).attr("id")]&&i.eq(n).children(".zc-tablist-container").find(".zc-tabs .zctablist"+r.canvasActiveTabs[i.eq(n).attr("id")].replace("#","")).click(),this.setactivetab(i)}},setactivetab:function(e){for(var t=e.find(".zc-tabs"),i=t.length,a=[],n=0;n<i;n++){var r=$L(t[n]).children(".tab.active.zc-hideable-tab");r&&r.length&&!r.is(":visible")&&a.push({newnode:this.findalternativetab(r[0]),active:r})}a.map((function(e){if(e.newnode){e.active.removeClass("active");var t=e.active.attr("data-tab");document.querySelector(t).style.display="none",e.newnode.addClass("active");var i=e.newnode.attr("data-tab");document.querySelector(i).style.display="block"}}))},findalternativetab:function(e){for(var t=e.parentElement,i=$L(t).children(".tab"),a=-1,n=i.length,r=0;r<n;r++)i[r]===e[0]&&(a=r);for(r=a+1;r<n;r++){var o=i.eq(r);if(o&&o.length&&(!o.hasClass("zc-hideable-tab")||o.is(":visible")))return o}for(r=a-1;r>=0;r--){var s=i.eq(r);if(s&&s.length&&(!s.hasClass("zc-hideable-tab")||s.is(":visible")))return s}t.closest(".zctabview").closest(".row").addClass("zcanvas_forced_hidden")},populateActiveActions:function(e,t){for(var i=e.children,a=i?i.length:0,n=0;n<a;n++)"action"===i[n].type&&t.push(i[n].id),this.populateActiveActions(i[n],t)},handleLockedRecord:function(e){var t={allowed_fields:[],fieldIds:[],recordDtl:{LockedReason:""},isLocked:!1,restricted_actions:[],restricted_communications:[],restricted_custom_buttons:[]},i=this.getData("locking_configuration"),a=this.getData("lockedRecordDetails")?this.getData("lockedRecordDetails").data:void 0,n=this.getData("record"),r=this.getData("entityDetails"),o="Pending for Review"===n.$review||"Rejected"===n.$review||"Pending for ReReview"===n.$review||"Review in Progress"===n.$review,s=this.data.moduleData.fields.filter((function(e){return"ISLOCKED"===e.column_name}))[0];if(s=s?s.api_name:s,t.lockedFieldApiName=s,n&&r&&["2","7","13","10"].indexOf(r.isApproved)<0&&!n.$stop_processing&&i&&!o){var l=Crm.userDetails.permissions["Crm_Implied_Lock_"+e],d=l;l=l&&["12","3","8"].indexOf(r.isApproved)<0;var c,u,m,p,v=a?a.length:0,f=[],_=[],h=[],g=[],y=!1;n&&n.Locked__s&&(l=!1,m=n.$locked_for_me);var b=this.getData("lockingInfoFields");b&&b.length&&(b=b.filter((function(e){return"Lock_Source__s"===e.api_name}))),b=b&&b[0]?b[0].pick_list_values:void 0;for(var C=i.length,L=0;L<C;L++){var R=i[L];if("automatic"!==R.lock_type&&(p=!0),a&&v){var w=a.filter((function(e){return e.Record_Locking_Configuration_Id__s===R.id}));if(w&&w.length){if(m){var x=!0;if("all_profiles"!==R.locked_for)for(var I=R.lock_excluded_profiles?R.lock_excluded_profiles.length:0,S=0;S<I;S++){if(R.lock_excluded_profiles[S].name===Crm.userDetails.PROFILE_NAME){x=!1;break}g.push(R.id)}x&&g.push(R.id)}for(var D=0;D<v;D++){var z=w[D],M=b?b.filter((function(e){return e.display_value===z.Lock_Source__s})):void 0;"Automatic"===(M=M&&M[0]?M[0].actual_value:void 0)?(u="automatic",h.push(R)):"Manual"===M&&"automatic"!==u&&(u="manual","orchestration"===R.feature_type?(y=!0,_.push(R)):"record_locking"!==R.feature_type&&"find_and_merge"!==R.feature_type||y||f.push(R))}}}}if(this.setData("isLockAllowed",l&&p),u){c="automatic"===u?h:"manual"===u&&y?_:f;var k=[];if(t.isLocked=!0,c&&c.length){var A=!0;for(L=0;L<v;L++){var F=c.filter((function(e){return e.id===a[L].Record_Locking_Configuration_Id__s}));if(F){if(F=F[0],m&&!g.contains(F.id))continue;if(F.excluded_fields=F.excluded_fields?F.excluded_fields:[],A&&(t.allowed_fields=F.excluded_fields,t.recordDtl.Locked_Time=a[L].Locked_Time__s,A=!1),t.allowed_fields=t.allowed_fields.intersection(F.excluded_fields),m){F.restricted_actions&&(t.restricted_actions=Array.from(new Set(t.restricted_actions.concat(F.restricted_actions)))),F.restricted_communications&&(t.restricted_communications=Array.from(new Set(t.restricted_communications.concat(F.restricted_communications))));var P=F.restricted_custom_buttons?F.restricted_custom_buttons.map((e=>e.id)):[];t.restricted_custom_buttons=Array.from(new Set(t.restricted_custom_buttons.concat(P)))}if($L.moment(t.recordDtl.Locked_Time).toDate()>$L.moment(a[L].Locked_Time__s).toDate()&&(t.recordDtl.Locked_Time=a[L].Locked_Time__s),"manual"===lockType&&"find_and_merge"===a[L].Feature_Type__s)t.recordDtl.lock_type="manual",t.recordDtl.LockedReason=a[L].Locked_Reason__s,t.recordDtl.feature_type=a[L].Feature_Type__s;else if("manual"===lockType)t.recordDtl.lock_type="manual",t.recordDtl.LockedBy=a[L].Locked_By__s?a[L].Locked_By__s.name:void 0,t.recordDtl.LockedReason=a[L].Locked_Reason__s,t.recordDtl.id=a[L].id,t.isUnLock=Crm.userDetails.IS_ADMIN||a[L].Locked_By__s.id===Crm.userDetails.USER_ID;else if("automatic"===u){t.recordDtl.lock_type="automatic";var E=F.locking_rules.filter((function(e){return e.id===a[L].Record_Locking_Rule_Id__s}));E&&E[0]&&k.push(E[0].name)}}}var O=m&&t.restricted_actions.contains("update");t.fieldIds=[];var T=t.allowed_fields?t.allowed_fields.length:0;t.fieldNames=T>0?"":"-";for(var $=0;$<T;$++){var N=store.peekRecord("field",t.allowed_fields[$].id);N&&(O&&t.fieldIds.push(N.id),t.fieldNames+=N.field_label,T-1!==$&&(t.fieldNames+=", "))}var V=k.length;t.recordDtl.Locked_Time=Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(t.recordDtl.Locked_Time)),V>0&&(t.recordDtl.LockedReason=k),t.canViewDetails=!Crm.userDetails.CLIENT_ACCOUNT,t.isLockedForMe=m,t.lockToolPerm=d}}}this.setData("recordLockingDetails",t)},fetchRelatedListData:function(e,t,i,a,n,r){return new Promise(function(o,s){var l,d,c=store.peekRecord("related_list",i),u=$L("crm-detailview-canvas")[0];"MobileDetailView"===(u?u.getData("feature"):void 0)&&(a.per_page=3),l=c.module?c.module.id:moduleRecordMapping[e].id;var m=this.constructRelatedListQP(l);if(d=Crm.userDetails.isSubformNewComponentEnabled?l===moduleRecordMapping[e].id?store.peekRecord("module",l):app.store.makeRequest("findRecord","module",l,void 0,void 0,!0,m):null!==m&&0===Object.keys(m).length?store.peekRecord("module",l):app.store.makeRequest("findRecord","module",l,void 0,void 0,!0,m),c.connectedmodule){var p=moduleRecordMapping[c.connectedmodule].id,v=this.constructRelatedListQP(p),f={relatedId:t,relationId:c.id,per_page:a.per_page,page:a.page,formatted_currency:!0,approved:"both",approval_state:"approved,approval_process_pending,approval_process_rejected"},_=this;Lyte.resolvePromises({module:d,linkModule:app.store.makeRequest("findRecord","module",p,void 0,void 0,!0,v)}).then((function(l){var d=l;Lyte.resolvePromises({relListRec:app.store.makeRequest("findRecord","related_list",i,{module:moduleApiMapping[e]},!0)}).then(function(l){if(n&&l&&l.relListRec[0]&&l.relListRec[0].customize_sort&&l.relListRec[0].sort_order&&l.relListRec[0].sort_by&&l.relListRec[0].fields){f.sort_order=c.sort_order,f.sort_by=c.sort_by.api_name;for(var u,m=l.relListRec[0].fields,p="",v=_.getData("connectedModuleFields"),h=v.length,g=[],y=0;y<h;y++)(u=store.peekRecord("field",v[y]))&&g.push(u.api_name);var b=m.length;for(p="",y=0;y<b;y++)p+=m[y].api_name+",";p+=_.getConnectedModuleApiName(c.api_name)+".id,",p+=g.join(","),f.fields=p}Lyte.resolvePromises({relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,f,void 0,!1):[]}).then(function(t){var n=moduleRecordMapping[e].id;d.relRecords=t.relRecords;var l=d.relRecords[n];if(_.relatedListDataCnt(d,i,a,r),!l||!l.length)return d.relRecords=[],void o(d);var u=c.module.id;d.meta=d.relRecords.info,d.relRecords=store.pushPayload(u,l);for(var m=moduleRecordMapping[c.connectedmodule].id,p=store.peekRecord("module",m),v=_.getConnectedModuleApiName(c.api_name),f=d&&d.relRecords?d.relRecords.length:0,h=[],g={},y=0;y<f;y++){var b=d.relRecords[y],C=b[v].id;b[v].module=c.connectedmodule,h.push(C),g[C]=b}_.fetchRelatedModuleRecordsById(p,h,g).then((function(){o(d)})).catch((function(e){s(e)}))}.bind(_)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}))}else if("Campaigns"!==c.api_name||"Leads"!==e&&"Contacts"!==e)if("Contact_Roles"===c.api_name){g="DealContactRole",f={relatedId:t,relationId:c.id,per_page:a.per_page,page:a.page,formatted_currency:!0,approved:"both",approval_state:"approved,approval_process_pending,approval_process_rejected"},_=this;Lyte.resolvePromises({module:d,contactRoles:app.store.makeRequest("findAll","contact_role")}).then(function(n){var l=n;Lyte.resolvePromises({relListRec:app.store.makeRequest("findRecord","related_list",i,{module:moduleApiMapping[e]},!0)}).then(function(n){n&&n.relListRec[0]&&n.relListRec[0].customize_sort&&n.relListRec[0].sort_order&&n.relListRec[0].sort_by&&(f.sort_order=c.sort_order,f.sort_by=c.sort_by.api_name),Lyte.resolvePromises({relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,f,void 0,!1):[]}).then(function(t){var n=["Full_Name","Account_Name","Phone","Email"],s=l.module.fields?l.module.fields:l.module[0].fields,d=s.length,u=[];l.relRecords=t.relRecords,_.relatedListDataCnt(l,i,a,r);for(var m=0;m<d;m++){var p=s[m];n.indexOf(p.api_name)>=0&&u.push(p)}var v=moduleRecordMapping[e].id,f=l.relRecords[v],h=c.module.id;f&&f.length>0?(l.meta=l.relRecords.info,l.relRecords=store.pushPayload(h,f)):l.relRecords=[];var y=["Role"];Lyte.resolvePromises({cr1:app.store.makeRequest("findAll","field",{module:g}),cr2:app.store.makeRequest("findAll","field",{module:"Contacts"})}).then((function(e){for(var t=e.cr1,i=t.length,a=0;a<i;a++){var n=t[a];y.indexOf(n.api_name)>=0&&(store.pushPayload("field",n),u.push(n))}Lyte.arrayUtils(u,"concat",e.cr2),l.contactRoleFields=u,o(l)}),(function(){o(l)}))}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}else{var h={relatedId:t,relationId:c.id,per_page:a.per_page,page:a.page,formatted_currency:!0};"Calls_History"===c.api_name||"Calls"===c.api_name?(h.sort_by="Call_Start_Time",h.sort_order="Calls"===c.api_name?"asc":"desc"):"Tasks"===c.api_name?(h.sort_by="Due_Date",h.sort_order="asc"):"Tasks_History"===c.api_name?(h.sort_by="Closed_Time",h.sort_order="desc"):"Events_History"!==c.api_name&&"Events"!==c.api_name||(h.sort_by="Start_DateTime",h.sort_order="Events"===c.api_name?"asc":"desc"),h.approved="both",h.approval_state="approved,approval_process_pending,approval_process_rejected","Visits_Zoho_Livedesk"===c.api_name&&this.getData&&"All Portals"!==this.getData("salesiqPortal")&&(h.filters=JSON.stringify({comparator:"equal",value:this.getData("salesiqPortal"),field:{api_name:"Portal_Name"}})),"picklist_tracker"===c.action&&(m.type="GET");_=this;Lyte.resolvePromises({module:d,fields:"Invited_Events"===c.api_name?app.store.makeRequest("findAll","field",{module:"Activities"}):[]}).then(function(t){var l=t;Lyte.resolvePromises({relListRec:app.store.makeRequest("findRecord","related_list",i,{module:moduleApiMapping[e]},!0)}).then(function(d){d&&d.relListRec[0]&&d.relListRec[0].customize_sort&&d.relListRec[0].sort_order&&d.relListRec[0].sort_by?(h.sort_order=d.relListRec[0].sort_order,h.sort_by=d.relListRec[0].sort_by.api_name):d&&d.relListRec[0]&&"picklist_tracker"===d.relListRec[0].action&&d.relListRec[0].customize_sort&&!d.relListRec[0].sort_order&&!d.relListRec[0].sort_by&&(h.sort_order="desc",h.sort_by="Modified_Time");var u="crm/"+(!c.module||"Events"!==c.module.api_name&&"Tasks"!==c.module.api_name&&"Calls"!==c.module.api_name?"v2.2":"v3")+"/"+moduleRecordMapping[e].api_name+"/bulk";m.url=u,m.method="POST",app.store.makeRequest("findAll","dummy",h,void 0,!1,m).then(function(s){var d=s.dummy.data;moduleRecordMapping[e].id;l.relRecords=s.dummy;var u=c.module.id;if(_.relatedListDataCnt(l,i,a,r),d&&d.length>0)if(t.meta=t.relRecords.info,n)t.relRecords=store.pushPayload(u,d);else{var m=store.pushPayload(u,d),p=[];m.filter((function(e){p.push(e.$.toJSON())})),t.relRecords=p}else t.relRecords=[];o(l)}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}else{var g="Campaign_"+e+"_Members",f={relatedId:t,relationId:c.id,per_page:a.per_page,page:a.page,formatted_currency:!0,approved:"both",approval_state:"approved,approval_process_pending,approval_process_rejected"},_=this;Lyte.resolvePromises({module:d,campaignFields:app.store.makeRequest("findAll","field",{module:g})}).then(function(n){var l=n;Lyte.resolvePromises({relListRec:app.store.makeRequest("findRecord","related_list",i,{module:moduleApiMapping[e]},!0)}).then(function(n){n&&n.relListRec[0]&&n.relListRec[0].customize_sort&&n.relListRec[0].sort_order&&n.relListRec[0].sort_by&&(f.sort_order=c.sort_order,f.sort_by=c.sort_by.api_name),Lyte.resolvePromises({relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,f,void 0,!1):[]}).then(function(t){var n=moduleRecordMapping[e].id;l.relRecords=t.relRecords;var s=l.relRecords[n],d=c.module.id;_.relatedListDataCnt(l,i,a,r),s&&s.length>0?(l.meta=l.relRecords.info,l.relRecords=store.pushPayload(d,s)):l.relRecords=[];for(var u=l.campaignFields,m=u.length,p=l.module.fields?l.module.fields:l.module[0].fields,v=p.map((function(e){return e.id})),f=0;f<m;f++){var h=u[f];if("Member_Status"===h.api_name){var g=store.peekRecord("field",h.id);if(!g){store.pushPayload("field",h),p.push(h),(l.module.related_list_properties?l.module.related_list_properties:l.module[0].related_list_properties).fields.push({api_name:h.api_name,field_label:h.field_label,id:h.id,ui_type:h.ui_type});break}if(v.indexOf(g.id)<0){p.push(h);break}}}o(l)}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}.bind(this)).catch((function(e){s(e)}))}}.bind(this))},constructRelatedListQP:function(e){var t=store.peekRecord("module",e),i={allowMultiple:!0};return t&&t.related_list_properties&&!t.fields?(t.fields=[],t.related_list_properties={},i.getOnlyMeta=!0):t&&t.fields&&!t.related_list_properties?(t.fields=[],i.getOnlyMeta=!0):!t||t.related_list_properties||t.fields||(t.related_list_properties={},i.getOnlyMeta=!1),i},loadRecordImage:function(){var e=$("[data-cvsrc]"),t=e.length;if(t)for(var i=0;i<t;i++){var a=e.eq(i);" N/A "===a.attr("data-fileid")?emptyImgRemove(a):a.attr("src",a.attr("data-cvsrc")),a.removeAttr("data-cvsrc")}},processRelListObj:function(e,t,i,a,n,r,o,s){var l=r?r.id:null;if(r&&r.nomapping)return e;var d=null;if(l){var c=store.peekRecord("related_list",l),u=c.module.id;d=store.peekRecord("module",u).module_name}var m=null;c&&c.connectedmodule&&(m=this.getConnectedModuleApiName(c.api_name)),"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName&&"import"!==Lyte.Router.getRouteInstance().routeName||(t=void 0===t?{}:t);for(var p=e.children||[],v=p.length,f=(S=$L("crm-detailview-oldeditor")[0])&&S.getData("feature")?S.getData("feature"):"DetailView",_=$L("crm-detailview-canvas-gallery")[0],h=0;h<v;h++){var g=p[h].type,y={record:t,compId:p[h].id};if("dummyDiv"!==g){var b={};if("field"===g){var C;if(p[h].id?C=p[h].id:a&&(C=a.shift()),!C)return e;if(p[h].custom_field&&(!p[h].id&&"profileimage"===p[h].datatype&&C.indexOf("_profileimage")<0?p[h].id=C+"_profileimage":C=p[h].id&&p[h].id.replace("_profileimage","")),!(b=store.peekRecord("field",C))||!o&&250===b.ui_type){p.splice(h,1),h--,v=p.length;continue}var L={relatedListModule:d,connectedModName:m};if(p[h].custom_field){C=p[h].id;var R=b.module&&b.module[0]?b.module[0].module_name:null;"Activities"===R&&"MobileDetailView"===f&&(R=b.sub_module&&b.sub_module.api_name?b.sub_module.api_name:R),y.compId=C,y.module=R,y.comptype=p[h].datatype,y.compObj=p[h],y.custom_field=!0,y.relatedListObj=L;var w=new CrmDetailViewHandler(y);p[h].value=w.getHTML(),p[h].label=$ESAPI.encoder().encodeForHTMLAttribute(b.field_label+" "+I18n.getMsg("crm.label.image"))}else{var x=!!["create","edit","clone","import"].includes(Lyte.Router.getRouteInstance().routeName),I=Lyte.registeredMixins["crm-detailview-canvas-utils"];if(!!I&&I.getmetadata().fromDVGallery&&_&&(x=!0),x){var S;f=(S=$L("crm-detailview-oldeditor")[0])&&S.getData("feature")?S.getData("feature"):"DetailView"}var D=Lyte.registeredMixins["crm-canvas-core-construct-component"].constructCruxComponentForCanvas(C,i,x?t:null,!0,o?void 0:L,x,void 0,void 0,f);if(x?p[h].value=null==D?" N/A ":D:(p[h].value=null==D?" - ":D,p[h].ui&&p[h].ui.value&&(p[h].ui.value.class||(p[h].ui.value.class=""),p[h].ui.value.class+=" canvasselectablefield canvas-element-apiname-"+b.api_name)),!x&&["Tasks","Calls"].indexOf(i)>=0&&["CONTACTID","SEID","SMOWNERID"].indexOf(b.column_name)>=0)if(x){var z=store.peekAll(moduleRecordMapping[i].id);p[h].label=Lyte.registeredMixins["crm-detailcanvas-utils"].constructFldName(b.id,i,z&&z.length&&z[0])}else p[h].label="{{getLabelForField('"+b.id+"',module,record)}}";else p[h].label=$ESAPI.encoder().encodeForHTMLAttribute(b.field_label);if(Crm.userDetails.DV_MANDATORY_FIELD_ASTERIX_SYMBOL){var M="pR crmNegativeColor mandate_ast_"+b.column_name+"_header";b.required||(M+=" dN"),p[h].label="<span id='mandate_ast_"+b.column_name+"_header' class='"+M+"'>*</span> "+p[h].label}if(null===l&&b&&!s){var k=b.tooltip,A="";k&&"Info Icon"===k.name&&(A=x?'<span class="icon_roundinfo mL5 vaM"></span>':'<span data-zcqa="zc_ajxFld_'+b.id+'" id="zc_ajax_info_icon_'+b.id+'" lt-prop-title="'+$ESAPI.encoder().encodeForHTMLAttribute(k.value)+'" lt-prop-tooltip-config={"position":"top"} class="icon_roundinfo mL5 cP vaM"></span>'),p[h].label+=A}}p[h].id=C,p[h].zcvalue=p[h].value,p[h].zclabel=p[h].label,p[h].zcqaval=b.field_label,p[h].zcanvasId=n&&p[h].zcanvasId?p[h].zcanvasId:zutils.getRandomId(),p[h].dataHolder=!0,p[h].connectedModName=m,"picklist"===b.data_type&&this.removePicklistprops(p[h],e),delete p[h].details}else if("component"===g||"custom_column"===g)p[h].zcanvasId=n&&p[h].zcanvasId?p[h].zcanvasId:zutils.getRandomId(),"event_status"===p[h].static_id&&(p[h].ui.value.value=Lyte.registeredMixins["crm-canvas-mobile-utils"].getEventsStatusValue(u,t.id)),p[h].zcvalue=p[h].value;else if("action"===g){y.module=i,y.comptype=p[h].id;w=new CrmDetailViewHandler(y);p[h].value=w.getHTML(),p[h].zcvalue=p[h].value}else if("link"===g){y.module=i,y.comptype=g,y.compObj=store.peekRecord("custom_link",p[h].id);w=new CrmDetailViewHandler(y);p[h].value=w.getHTML(),p[h].zcvalue=p[h].value}if(p[h].zctype=b.data_type||g,p[h].custom_field&&(p[h].zctype="profileimage"),("text-area"==p[h].zctype||"textarea"==p[h].zctype)&&p[h].ui.value&&"string"==typeof p[h].ui.value.class)if(p[h].ui.value.class.indexOf("zctextarea")>-1){var F=p[h].ui.value.class.split(" ");F=$u.uniq(F),p[h].ui.value.class=F.join(" ")}else p[h].ui.value.class+=" zctextarea";this.processRelListObj(p[h],t,i,a,n,r||m,o,s)}else this.processRelListObj(p[h],t,i,a,n,r,o,s)}return e},getConnectedModuleApiName:function(e){var t=store.peekAll("field").filterBy({data_type:"multiselectlookup"}).filter((function(t){return t.multiselectlookup.api_name===e}))[0];return t&&t.multiselectlookup&&t.multiselectlookup.connectedlookup_apiname},getRelListButton:function(e,t,i){var a=t.id,n=[];e&&e.actions&&(n=e.actions);var r={module:i,compId:e.id},o=new CrmDetailViewHandler(r);if(o){var s=o.getCanvasActions();s.length&&(n=objectUtils.cloneObject_new(n.concat(s)))}if(0===a.indexOf("moreRLActions")){var l,d=n,c=t.includedActions;return(l=e.module?e.module.api_name:e.api_name)||(l=e.id),d=d&&d.filter((e=>!(e&&e.hasOwnProperty("showaction")&&!e.showaction))),t.label="canvas_moreoptions_"+l,"<crm-more-component id='id_"+e.id+"' module ='"+l+"'  main-module ='"+i+"' data-zcqa=\"relatedList_MoreButton_"+l+'" type="relatedList" rel-list-id=\''+e.id+"' include-array='"+JSON.stringify(d).replace(/'/g,"\\")+"' exclude-array='"+JSON.stringify(c).replace(/'/g,"\\")+"'></crm-more-component>"}for(var u=n||[],m=u.length,p=0;p<m;p++)if(u[p]["data-cid"]==a){if(u[p].hasOwnProperty("showaction")&&!u[p].showaction){t.spliceElement=!0;continue}t.label=u[p].label;var v=!1,f=Lyte.Router.getRouteInstance().currentModel.record;return!f||"Activities"===e.api_name&&"Tasks"===e.api_name&&"Events"===e.api_name&&"Calls"===e.api_name||"rejected"!==f.$review&&"Review in Progress"!==f.$review&&"Pending for Review"!==f.$review&&"Pending for ReReview"!==f.$review||(t.ui.value.class=t.ui.value.class.concat(" eventNone"),v=!0),"Edit All"===u[p].label?'<lyte-button lt-prop-disabled="'+v+'" onclick ={{action("executeRelatedListAction",\''+u[p]["data-cid"]+"','"+e.id+"')}} data-relid=\""+e.id+'" id="zcDetail_Edit_'+e.id+'" data-zcqa="'+u[p].data_zcqa+'" lt-prop-appearance="default-success"><template is="registerYield" yield-name="text">'+u[p].label+"</template></lyte-button>":'<lyte-button lt-prop-disabled="'+v+'" onclick ={{action("executeRelatedListAction",\''+u[p]["data-cid"]+"','"+e.id+"')}} data-relid=\""+e.id+'" id="zcDetail_'+u[p].label+"_"+e.id+'" data-zcqa="'+u[p].data_zcqa+'" lt-prop-appearance="default-success"><template is="registerYield" yield-name="text">'+u[p].label+"</template></lyte-button>"}},registerComponent:function(e,t,i,a,n,r,o,s,l){if(Customization.dropCache&&Lyte.Component.unregisterComponent(t),!Lyte.Component.registeredComponents[t]){var d=$(e),c=r&&r.children&&r.children[1]&&store.peekRecord("related_list",r.children[1].id);r&&r.children&&r.children[1]&&("stage_navigator"===r.children[1].id||"blueprint"===r.children[1].id)?d.addClass('{{showOrHideStageAndBp(record.id, module, "'+r.hidetab+'","'+r.children[1].id+'")}}'):c&&"CHECKLISTSPERSONALITY"===c.personality_name?d.addClass('{{showOrHideCheckList("'+r.isTabComp+'","'+c.personality_name+'")}}'):r&&r.hidden&&!r.isSplit?(d.addClass("zcanvas_contd_hidden"),r.hidetab&&d.addClass("zcanvas_tab_hidden")):d.removeClass("zcanvas_contd_hidden zcanvas_tab_hidden"),r&&r.hidden&&r.isSplit&&d.addClass("eventNone"),n&&r&&r.label&&d.attr("data-zcqa",r.label);var u=d.outerHTML();if(o&&o.replace&&(u=u.replaceAll(o.replace.from,o.replace.to)),s&&Lyte.registeredMixins["crm-formview-mixin"]&&Lyte.registeredMixins["crm-formview-mixin"].isRootComp){var m=window.isCanvasSandboxDiff?$("crm-canvas-dynamic-preview")[1]:$("crm-canvas-dynamic-preview")[0];if(r=m&&m.component){r.setData("comp_name",t);var p=Lyte.registeredMixins["crm-formview-mixin"].dynamicCompList,v=Lyte.registeredMixins["crm-formview-mixin"].dynamicCompList.indexOf(t);-1!==v&&p.splice(v,1)}Lyte.registeredMixins["crm-formview-mixin"].isRootComp=!1}u="<template tag-name='"+t+"' >"+u+"</template>";var f=document.createElement("div");f.innerHTML=u,LyteComponent.lyteComponentsDiv.append(f.firstElementChild),s?this.registerCanvasFormComp(t,s,{mixins:["lyte-table-utils","crm-formview-mixin","crm-create-mixin","crux-textautocomplete-options","crm-canvas-core-construct-component"]}):this.registerCanvasComp(t,n,o&&o.compdef?o.compdef:null),this.canvasIDvsCompMapping(t)}},registerCanvasFormComp:function(e,t,i){Lyte.Component.register(e,t,i)},registerCanvasComp:function(e,t,i){var a={data:function(){return{record_list:Lyte.attr("array"),module:Lyte.attr("string"),originalRecord:Lyte.attr("object"),moduleObj:Lyte.attr("object"),record:Lyte.attr("object"),rellistId:Lyte.attr("string"),records:Lyte.attr("object"),entityDetails:Lyte.attr("object"),layoutId:Lyte.attr("string"),lazyload:Lyte.attr("boolean"),isLoading:Lyte.attr("boolean",{default:!1}),displayField:Lyte.attr("object",{default:crmConstants.moduleDisplayField}),fromRecord:Lyte.attr("object"),mainmodulerule:Lyte.attr("string"),relatedmodulerule:Lyte.attr("string"),canvas_rules:Lyte.attr("array",{default:[]}),featureName:Lyte.attr("string"),viewType:Lyte.attr("string"),textFormat:Lyte.attr("string"),actualheight:Lyte.attr("string"),extension:Lyte.attr("object",{default:{}}),extensionmeta:Lyte.attr("object",{default:{}}),featuresStatus:Lyte.attr("object"),showCallNowButton:Lyte.attr("boolean",{default:!1}),imageuploadFieldIds:Lyte.attr("array",{default:[]}),fieldarray:Lyte.attr("array",{hideAttr:!0,default:[]})}},parentRuleObserver:function(){$(this.$node).addClass(this.data.relatedmodulerule)}.observes("mainmodulerule"),loadingstatechange:function(e){e&&!e.newValue&&($L(this.$node).removeClass("zcanvas_not_rendered").removeAttr("style"),this.handleHeightDrop())}.observes("isLoading"),handleHeightDrop:function(){var e=this.$node.firstElementChild.offsetHeight,t=parseInt(this.getData("actualheight"));if(t&&t/2.5>e){var i=Lyte.registeredMixins["crm-detailcanvas-utils"];i.runListLoading&&i.runListLoading(),i._trackAjax("fromHandleHeightDrop")}},didConnect:function(){if("ListView"===this.data.featureName&&this.data.record){var e=$L(this.$node);if("CardView"!==this.data.viewType&&"CustomizedView"!==this.data.viewType||e.find(".canvasmultimodulelookup:not(.zc_nonempty)").closest(".zc-system-field").addClass("hide"),"CardView"===this.data.viewType&&this.data.canvas_rules&&this.data.canvas_rules.length){for(var i=this.data.canvas_rules.length,a=[],n=[],r=0;r<i;r++){if((o=store.peekRecord("canvas_rule",this.data.canvas_rules[r].id))&&(!o||"inactive"!==o.status))(m=Lyte.registeredMixins["crm-create-mixin"].checkCriteriaMatchForCanvas(o.criteria,this.data.record,Lyte.registeredMixins["crm-create-mixin"]))?a.push(o.zcid):n.push(o.zcid)}e.addClass(a.join(" ")).removeClass(n.join(" ")),Lyte.registeredMixins["crm-detailcanvas-utils"].expandcombinedcriteria(e)}}else{e=$L(this.$node);!Lyte.registeredMixins["crm-detailcanvas-utils"].isListViewPage()&&Lyte.registeredMixins["crm-detailcanvas-utils"].executingLayoutRule(e);a=[],n=[];var o,s,l=this.data.canvas_rules.length,d=[];if(this.data.record)for(r=0;r<l;r++)if((o=store.peekRecord("canvas_rule",this.data.canvas_rules[r].id))&&(!o||"inactive"!==o.status))if(this.data.rellistId&&moduleApiMapping[Lyte.registeredMixins["crm-detailcanvas-utils"].getModuleNameFromRelatedlistId(this.data.rellistId)]===moduleApiMapping[this.data.module]){if(s=this.data.record,"multiselectlookup"===(p=store.peekRecord("related_list",this.data.rellistId)).type){var c=Lyte.registeredMixins["crm-detailcanvas-utils"].getConnectedModuleApiName(p.api_name),u=this.data.record[c];s=store.peekRecord(moduleRecordMapping[u.module].id,u.id)}(m=Lyte.registeredMixins["crm-create-mixin"].checkCriteriaMatchForCanvas(o.criteria,s,Lyte.registeredMixins["crm-create-mixin"]))?a.push(o.zcid):n.push(o.zcid)}else{s=moduleApiMapping[this.data.module]!==o.module.api_name?this.data.record:this.data.fromRecord;var m,p=store.peekRecord("related_list",this.data.rellistId);if(moduleApiMapping[this.data.module]!==o.module.api_name&&p&&"multiselectlookup"===p.type){c=Lyte.registeredMixins["crm-detailcanvas-utils"].getConnectedModuleApiName(p.api_name),u=this.data.record[c];s=store.peekRecord(moduleRecordMapping[u.module].id,u.id)}(m=Lyte.registeredMixins["crm-create-mixin"].checkCriteriaMatchForCanvas(o.criteria,s,Lyte.registeredMixins["crm-create-mixin"]))&&moduleApiMapping[this.data.module]!==o.module.api_name?a.push(o.zcid):n.push(o.zcid),m&&moduleApiMapping[this.data.module]===o.module.api_name&&d.push(o.zcid)}e.addClass(a.join(" ")).removeClass(n.join(" ")),this.setData("relatedmodulerule",a.join(" "));var v=$("crm-detailview-canvas");v.addClass(d.join(" ")),Lyte.registeredMixins["crm-detailcanvas-utils"].expandcombinedcriteria(e),Lyte.registeredMixins["crm-detailcanvas-utils"].expandcombinedcriteria(v);var f=$("template.zcanvas_not_rendered[component-name="+this.$node.tagName.toLowerCase()+"]");e.find("crm-stage-history").each((function(){var e=$(this);e&&e.length&&e.is(":visible")&&e[0].component.setWidthForStagesParent()})),e.find(".zc_meeting_status").each((function(e,t){if(!t.getData("ltPropShow")){var i=$L(t).parents(".zcanvas-field:not(.zc-propagated)");i.length&&i.addClass("dNImp")}}));var _=e.find("crm-zia-score-result"),h=$("#ziascorechart");_.length&&h.length&&_[0].component.scoreChart(),t||(e.removeClass("zcanvas_not_rendered"),e.removeAttr("style"),f.removeClass("zcanvas_not_rendered"),f.removeAttr("style")),$L.fastdom.measure(function(){Lyte.registeredMixins["crm-detailcanvas-utils"].tabrefresh($(this.$node))}.bind(this)),$L.fastdom.measure(function(){Lyte.registeredMixins["crm-detailcanvas-utils"].tabrefresh($(this.$node))}.bind(this)),e.find(".zcanvas_tab_hidden").each((function(){var e=$(this).closest(".zc-tab-content"),t="#"+e.attr("id"),i=$(".tab[data-tab="+t+"]");i.addClass("zcanvas_contd_hidden"),e.addClass("zcanvas_contd_hidden");for(var a=i.closest('.zclayout[data-layoutname="Tab Layout"]')[0].getElementsByTagName("LI"),n=a.length,r=0;r<n;r++){var o=a[r];if(!$(o).hasClass("zcanvas_contd_hidden")){$(o).click();break}}}))}this.bindProbagateClickActions(e);var g=this.$node.children;if(this.$node&&g&&g.length&&g[0].classList.contains("zcanvas_contd_hidden")){var y=this.$node.parentElement;Crm.userDetails.CANVAS_VIEWPORT_ENABLE?y.classList.add("zcanvas_contd_hidden"):this.$node.classList.add("zcanvas_contd_hidden")}},bindProbagateClickActions:function(e){e.find("button , #backArrowDV").each(function(e,t){var i=$L(t).parents(".zcanvas-field:not(.zc-propagated)");if(i.length){i.click(this.propagateclick).addClass("zc-propagated zcpImp");var a=i.find("crm-more-component");if(a.length){var n=zutils.getRandomId();i.addClass(n),a[0].setData("menuorigin","."+n),"true"==a[0].getData("disabled")&&("relatedList"===a[0].getData("type")?i.addClass("zcanvas-tool-disable"):i.addClass("zcanvas-morebtn-disable"))}var r=i.find("button[disabled]:not(.zcmanualtoolipbtn)"),o=i.find("call-button-new");if(o.length){let e=zutils.getRandomId();i.addClass(e),o[0].setData("menuorigin","."+e)}var s=i[0]&&i[0].querySelectorAll("lyte-button")[0];s&&i.attr({onmouseover:"Lyte.registeredMixins['crm-detailcanvas-utils'].checkButtonStatus(this)",onmouseout:"newhidett()"});var l=s&&s.getAttribute("lt-prop-type");r.length&&l&&l.length&&"removeButton"===l&&$L(i).addClass("dNImp")}}.bind(this))},propagateclick:function(e){var t=$L(e.target),i=t.closest("button");i.length||(i=t.closest("#backArrowDV"));var a=i.closest("crm-more-component"),n=i.closest("call-button-new");if(!i.length&&!t.hasClass("cscript-canvas-disable-np")){var r=t.not("button").closest(".zcanvas-field").find("button:not([disabled]) , #backArrowDV");if(a=r.closest("crm-more-component"),n=r.closest("call-button-new"),r.click(),a.length||n.length)return!0}if(e.stopPropagation(),a.length||n.length)return!1},handleMouseActions:function(e,t){var i=$L("crm-detailview-canvas")[0],a=this.getData("record"),n=i?i.getData("recordLockingDetails"):void 0,r=!a.$editable&&n&&n.isLockedForMe,o={},s=Lyte.registeredMixins["crm-detailcanvas-utils"].showEditIcon(this.getData("record"),this.getData("module"),Lyte.Router.getRouteInstance().currentModel,r,o),l=null,d=Lyte.registeredMixins["crm-detailcanvas-utils"],c=Lyte.registeredMixins["crm-detailview-common-utils"];if(d.supportedUITypesForFieldClick=!0,e&&e.classList.contains("zcanvas-holder")){var u=e.parentElement;l=u.classList.contains("zcanvas-table-row-field")?u:null;var m=e.querySelector(".zcanvas-value-container").children;m[0]&&(e=m[0])}else e&&e.classList.contains("zcanvas-value-container")&&(e=e.children[0]);var p=$(t.target);if("click"!==t.type||!p.hasClass("zc-ajax-edit")&&!p.hasClass("zcanvas-label")&&p.closest(".canvas_fld").length){if("CRM-OWNER-FIELD"===e.tagName&&"mouseenter"===t.type&&i.component.data.ziaOwnerRecommendationEnabled&&e.component&&"assigned_by_zia"===e.component.data.zia_owner_assignment){var v=$L("crm-zor-popup")[0];v&&(v.setData("originElement",".ownerField_"+e.component.data.ownerFieldCount),v.setData("showZORPop",!0))}"click"===t.type&&"CRM-TAG"===e.tagName&&p.hasClass("zcanvas-label")&&(s?this.throwEvent("mouseActions",e,t.type,l,!1):d.throwErrorPopup());var f=Lyte.Router.getRouteInstance().currentModel.entityDetails;if(a.$editable&&("approval_process_pending"===a.$approval_state||"approval_process_rejected"===a.$approval_state)&&(2===f.EditFieldsType||1===f.EditFieldsType)){var _=f.ApprovalProcessEditFields,h=e.component;2===f.EditFieldsType&&h&&h.getData("cxPropField")&&h.getData("cxPropField").id&&!h.getData("cxPropField").read_only&&(s=_.contains(h.getData("cxPropField").id))}if(s){if(e.classList.contains("uitype_556")){if(r&&(!n.fieldIds||!n.fieldIds.contains(e.component.getData("cxPropField.id"))))return;return void(e.component.getData("cxPropField.read_only")||this.throwEvent("mouseActions",e,t.type,l,!1))}if(e.component&&e.component.getData("cxPropField")&&e.component.getData("cxPropField").id){var g=store.peekRecord("field",e.component.getData("cxPropField").id),y=$("crm-detailview-canvas")[0].component.data.layoutId;if("click"===t.type&&!$(t.target).hasClass("zcanvas-label")&&([133,444,555,209,1,209].indexOf(g.ui_type)>-1||"CRUX-LOOKUP-COMPONENT"===e.tagName)&&([133,1].indexOf(g.ui_type)<0||a[g.api_name]&&"CRUX-LOOKUP-COMPONENT"===e.tagName)&&(d.supportedUITypesForFieldClick=!1),g.id!==d.blueprintFldId&&$L("crux-picklist-component").removeAttr("lt-prop-title lt-prop-tooltip-config"),r="ownerlookup"===g.data_type?a.$locked_for_me&&n&&n.restricted_actions&&n.restricted_actions.contains("change_owner"):r&&!(n.fieldIds&&n.fieldIds.contains(g.id)))return void(g.id===d.blueprintFldId||250===g.ui_type?(250===g.ui_type&&e.component.setData("cxPropIsEditable",!1),this.throwEvent("mouseActions",e,t.type,l,!0,250===g.ui_type)):"click"===t.type&&d.throwErrorPopup(I18n.getMsg("crm.massconvert.consent.locked")));if("Stage"!==g.api_name&&g[y]&&g[y].pick_list_values&&g[y].pick_list_values[0].maps&&0!==g[y].pick_list_values[0].maps.filter((function(e){return store.peekRecord("field",e.id)})).length)return void("click"===t.type&&d.throwErrorPopup());if(!g.read_only||"Closing_Date"!==g.api_name&&"Reporting_To"!==g.api_name){if("Contacts"===this.getData("module")&&"Reporting_To"===g.api_name&&!this.getData("record").Account_Name)return void("click"===t.type&&d.throwErrorPopup())}else this.throwEvent("mouseActions",e,t.type,l,!0);if("SHAREDTO"===g.column_name&&999===g.ui_type&&("Territories"===g.api_name||"Territory"===g.api_name))if((C=e.component)&&C.getData("canassign")&&!C.getData("isLiteUser"))return void this.throwEvent("mouseActions",e,t.type,l,!1);if("Services"===this.getData("module")||"Appointments"===this.getData("module")||this.getData("record")&&this.getData("record").$approved||!this.getData("record").$approved&&"Owner"===g.api_name||"approval_process_rejected"===this.getData("record").$approval_state||"approval_process_pending"===this.getData("record").$approval_state)return"Layout"===g.api_name&&"Rejected"===this.getData("record").$review?($(e).addClass("zc_cursor_nodrop"),void("click"===t.type&&d.throwErrorPopup())):"Owner"!==g.api_name&&"Voice_Recording__s"!==g.api_name&&"From_Number__s"!==g.api_name&&"To_Number__s"!==g.api_name||"Calls"!==this.getData("module")||Lyte.registeredMixins["crm-detailview-common-utils"].isAjaxEditableField(g.id,this.getData("module"),this.getData("record"))?"Appointments"===this.getData("module")&&["Service_Name","Appointment_Start_Time","Address"].indexOf(g.api_name)>=0?void this.throwEvent("mouseActions",e,t.type,l,!0):("Layout"===g.api_name&&(b=c.layoutEditPermissionCheck(this.getData("module"),this.getData("record"))),"Layout"===g.api_name&&!b||-1!==d.visitFldColumn.indexOf(g.column_name)||d.blueprintFldId&&d.blueprintFldId===g.id||g.read_only||"Expected_Revenue"===g.api_name||"Handler"===g.api_name||"Layout"===g.api_name&&this.getData("record").$process_flow||"ownerlookup"===g.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")]?void this.throwEvent("mouseActions",e,t.type,l,!0,250===g.ui_type):void this.throwEvent("mouseActions",e,t.type,l,!1,250===g.ui_type)):void this.throwEvent("mouseActions",e,t.type,l,!0)}}else{if(e.component&&e.component.getData("cxPropField")&&e.component.getData("cxPropField").id){var b,C;g=store.peekRecord("field",e.component.getData("cxPropField").id),y=$("crm-detailview-canvas")[0].component.data.layoutId;if("Layout"===g.api_name&&(b=c.layoutEditPermissionCheck(this.getData("module"),this.getData("record"))),"Layout"===g.api_name&&!b||-1!==d.visitFldColumn.indexOf(g.column_name)||d.blueprintFldId&&d.blueprintFldId===g.id||g.read_only||"Expected_Revenue"===g.api_name||"Handler"===g.api_name||"Layout"===g.api_name&&this.getData("record").$process_flow||"ownerlookup"===g.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")])return void this.throwEvent("mouseActions",e,t.type,l,!0);if("ownerlookup"===g.data_type){if(a.$stop_processing||a.$locked_for_me&&n&&n.restricted_actions&&n.restricted_actions.contains("change_owner"))return void("click"===t.type&&d.throwErrorPopup());if("read_only"===a.$sharing_permission)return void this.throwEvent("mouseActions",e,t.type,l,!0);if(Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")])return void this.throwEvent("mouseActions",e,t.type,l,!1)}if("SHAREDTO"===g.column_name&&999===g.ui_type&&("Territories"===g.api_name||"Territory"===g.api_name))if((C=e.component)&&C.getData("canassign")&&!C.getData("isRecLocked")&&!C.getData("isLiteUser"))return void this.throwEvent("mouseActions",e,t.type,l,!1);if(("approval_process_pending"===a.$approval_state||"approval_process_rejected"===a.$approval_state)&&1!==f.EditFieldsType)return 250===g.ui_type&&e.component.setData("cxPropIsEditable",!1),void this.throwEvent("mouseActions",e,t.type,l,!0,250===g.ui_type)}"click"===t.type&&d.throwErrorPopup(o.errMsg)}}},actions:{customActiondispatcher:function(e,t,i,a){if("click"===t.type){var n;if(this.getData("rellistId")){var r=store.peekRecord("related_list",this.getData("rellistId"));r&&(n={module:r.module})}else{var o=this.getData("module");if(o){var s=moduleRecordMapping[o];s&&(n={module:{api_name:s.apiMapping,id:s.id}})}}var l=a||this.getData("record");l&&l.id&&n&&(n.records=[{id:l.id}]),CScriptLib&&CScript.Engine.Global.dispatchEvent("onClick",i,n)}},throwEventToModuleRoute:function(e,t,i,a,n,r){"canvas_button_group"===n&&(n=r);var o=this.getData("record");if(o=o&&o.id?store.peekRecord(moduleRecordMapping[this.getData("module")].id,o.id):store.peekRecord(moduleRecordMapping[this.getData("module")].id,i),["customButton","deleteEntity","follow","inviteClientPortal","reviewHistory"].indexOf(e)>=0){if("customButton"===e){var s="ListView"===this.data.featureName?"eachRecord":"viewEntity";return CustomButtonJSObjectInit.execute(n,s,i,"",t)}if("deleteEntity"===e){if(!Crm.userDetails.permissions["Crm_Implied_Delete_"+t])return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();var l=this.getData("entityDetails");Lyte.registeredMixins["crm-detailcanvas-utils"].deleteEntity(t,i,o,l)}else if("follow"===e)o.$.triggerAction("follow",{type:o.$followed?"DELETE":"PUT"}).then((function(){o.$.set("$followed",!o.$followed),$L("crm-detailview-canvas")[0].component.setData("record",objectUtils.cloneObject(o)),o.$.save().then((function(){Lyte.triggerEvent("followersList",{record:o,entityId:i,module:t})}))}));else if("inviteClientPortal"===e){var d=$L("#clientPortalPrefButton"),c={top:d.offset().top+d.outerHeight()+"px",left:d.offset().left+"px"};$L("#portalUsrPreferenceDD").css(c).show()}else"reviewHistory"===e&&Lyte.registeredMixins["crm-detailcanvas-utils"].showHistory(this,t,i)}else Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(e,t,i,a,o,r)},refreshingrelatedlist:function(e,t){(t=$L(document.querySelectorAll("#"+t))).removeClass("ref_complete").addClass("ref_loading peNone"),Lyte.triggerEvent("relatedList",{id:e,refreshTemplate:!0})},handleMouseActions:function(e,t){document.querySelector("crm-detailview-canvas").component.getData("isSandboxSeeDiff")||"click"===t.type&&("A"===t.target.tagName||$(t.target).closest("a").length)||("click"===t.type?setTimeout(function(){window.getSelection().toString().length>0||this.handleMouseActions(e,t)}.bind(this),150):this.handleMouseActions&&this.handleMouseActions(e,t))},handleColumnHover:function(e){if("independent"===e.getAttribute("data-component-mode")){var t=e.closest("crm-related-list-canvas");t&&t.component.setData("selectedColoumn",e.id)}else $L("crm-list-view-canvas")[0].component.setData("columnId",e.id)},handleeditButton:function(){var e=document.querySelector("crm-detailview-canvas");e&&e.component.handleeditButtonMethod.bind(e.component)()},handlemouseovereditbutton:function(){$L("crm-detailview-canvas")[0]&&Lyte.registeredMixins["crm-canvas-common-utils"].handlemouseovereditbuttonCallBack()},handleCopyButton:function(e){Lyte.registeredMixins["crm-detailview-common-utils"].copyLink(e)},handleRecordNavigation:function(e,t){var i=getSelection().toString(),a=$L("crm-list-view-canvas")[0];if(!i&&a){var n=a.component.getData("module_info");Lyte.registeredMixins["crm-detailcanvas-utils"].recordNavigation(e,t,"view",n)}},onMouseEnter:function(e,t){this.getData("viewType");$("#crm-list-view-canvas-row-"+e.id).addClass("highlights")},onMouseLeave:function(e,t){this.getData("viewType");$("#crm-list-view-canvas-row-"+e.id).removeClass("highlights")},moreEvent:function(e,t){var i=this.getData("module"),a=this.getData("record"),n=this.getData("record").id;a=store.peekRecord(moduleRecordMapping[i].id,n);var r=moduleRecordMapping[i].singular_label;if(["send_mail","mail_merge","add_related_list","share","folow","print_preview","exportpdf","cliq","slack","cisco","google_chat","microsoft_teams","sendDM"].indexOf(e)>=0){var o=e.replace(/_(.)/g,(function(e,t){return t.toUpperCase()}));"google_chat"===e&&(o="google_chat"),"microsoft_teams"===e&&(o="microsoft_teams"),Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(o,i,n,r,a,event)}else if(["edit","convert","findandmerge","clone"].indexOf(e)>=0){Lyte.Router.transitionTo({route:{edit:"crm.tab.module.entity.edit",convert:"crm.tab.module.entity.convert",findandmerge:"crm.tab.module.entity.find-and-merge",clone:"crm.tab.module.entity.clone"}[e],dynamicParams:[i,n]})}else if("lock"===e){var s=$L("crm-detail-view-locking-details")[0].component;s.actions.showRecordLockingPopup(i,n,!1,void 0,s)}else if("scheduleonlinemeeting"===e)Lyte.registeredMixins["crm-detail-view-utils"].scheduleOnlineMeeting(this.data.record.id,this.data.module);else if("meetnow"===e)Lyte.registeredMixins["crm-detail-view-utils"].startCrmMeeting();else if("follow"===e)this.actions.throwEventToModuleRoute.call(this,"follow");else if("delete"===e){if(!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Delete_"+i))return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();var l=this.getData("entityDetails");Lyte.registeredMixins["crm-detailcanvas-utils"].deleteEntity(i,n,a,l)}else if("reviewHistory"===e)i=moduleRecordMapping[i].api_name,Lyte.registeredMixins["crm-detailcanvas-utils"].showHistory(this,i,n);else if("inviteClientPortal"===e){var d=(l=this.getData("entityDetails")).clientPortal?l.clientPortal:{};d.sendClientInvitation?CPMF.getClientPortalProfilesRelatedToPersonalityModule(i,n,"invite"):d.sendClientReInvitation&&CPMF.getClientPortalProfilesRelatedToPersonalityModule(i,n,"reinvite",d.userTypeId)}else["mark_as_completed","reschedule_call","cancel_call","send_mail_related_mod","start_meeting","send_recordings","export_event","event_invitation","join_meeting","cancel_event","mark_as_temporarily_unavail","manage_unavailability","mark_as_notinuse","mark_as_available","reschedule_appointment","cancel_appointment","no_redirect_edit","no_redirect_clone","rescheduled_appointment_history","close_task","add_job_sheet","create_client_script"].indexOf(e)>=0&&Lyte.registeredMixins["crm-detailcanvas-utils"].triggerBtnAction(e,n,i,a,t.$node,event);return!1},executeRelatedListAction:function(e,t){var i=this.getData("record"),a=this.getData("module");if(e&&e.indexOf("Canvas_Custom")>-1){var n=new CrmDetailViewHandler({module:a,compId:t});if(n){var r=n.getCanvasActions().filter((function(t){return t["data-cid"]===e}));if(r&&r.length){var o=r[0];if("component"===o.customactiontype){var s=this.$node;if(s&&s.querySelector&&o.actionprop){var l=s.querySelector(o.actionprop.component);if(l&&l.component&&l.component[o.actionprop.method])l.component[o.actionprop.method].bind(l.component)();else if(l&&l.component&&l.component.actions[o.actionprop.method]){var d=o.actionprop.customData?o.actionprop.customData.params[0]:void 0;l.component.actions[o.actionprop.method].bind(l.component)(d)}}}}}}e&&"un-EnrollSeries"===e&&(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].seriesSelectedids=this.getRLComponent().component.getData("seriesRecordIds"):crmRelatedList.seriesSelectedids=this.getRLComponent().component.getData("seriesRecordIds")),!Crm.canvasScroll&&e.indexOf("new")>-1&&(Crm.canvasScroll=this.$node.id);var c=store.peekRecord("related_list",t);return Lyte.registeredMixins["crm-detail-view-utils"].executeRelatedListActions(e,c,a,i,event),!1},onAttachMenuClose:function(e){this.setData("attachLinkMenuOpen",!1),$L("#attachLinks_"+e,this.$node)[0].classList.add("vH")},attachLinksOpen:function(){this.setData("attachLinkMenuOpen",!0)},invitedEventsDrop:function(e,t){switch(e){case"edit":Crm.editEntity(event,void 0,{module:"Events",id:t.id,reqFrom:"detailView",from:"relatedlist_new"}),event.preventDefault();break;case"delete":Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(t,2,"Events");break;case"disassociate":$L("crm-detailview-footer")[0].component.removeParticipant(this.getData("fromRecord")[crmConstants.moduleDisplayField[this.getData("module")][0]],t,this.data.fromRecord)}},showHideRelatedFields:function(e,t,i,a){if(this.throwEvent("mouseActions",i.target),"mouseleave"===i.type)return crmui.hideTooltip(),!0;if(!(i&&i.target&&i.target.classList.contains("cscript-canvas-maskedfield")||"CRUX-LOOKUP-COMPONENT"!==i.target.nodeName)){var n=this.getData("record");n||(n=store.peekRecord(moduleRecordMapping[this.getData("module")].id,a));var r=store.peekRecord("field",t),o=r.api_name,s=n[o],l={};if("Who_Id"!==o&&"What_Id"!==o||((s=(s=this.getValForWhatOrWhoIdFlds(n,o))&&JSON.parse(s))&&"Who_Id"===o&&!n[o]&&n.What_Id?(o="What_Id",l.module=n.$se_module):s&&"What_Id"===o&&(l.module=n.$se_module)),s){var d=$(i.target);"Appointments"===e&&"Appointment_For"===r.api_name&&(l.module=s.module.api_name),l.module||(l.module="multi_module_lookup"===r.data_type?n[r.api_name].module.api_name:r.lookup.module.api_name),s&&(l.id=s.id,store.peekAll("module").forEach((function(e){e.api_name==l.module&&(l.module=e.module_name)})),crmLookupBusinessCard.showingSide="showOnRight",renderingUtils.windowWidth/2<d.offset().left&&(crmLookupBusinessCard.showingSide="showOnLeft"),d.offset().left<400&&d[0].getBoundingClientRect().right>renderingUtils.windowWidth-400&&(crmLookupBusinessCard.showingSide="showOnBottom"),l&&l.module&&l.id&&setTimeout((function(){d.is(":hover")&&crmLookupBusinessCard.getRecordJSon(l.module,l.id,d)}),950))}}}},methods:{multiLineFieldShowLess:function(e){var t=e&&e.$node&&e.$node.querySelector(".cxTextareaShowMore");t&&($L(t).offset().top<(featuresAvailable&&featuresAvailable.NEXTGENUI_ENABLED?0:50)&&t.scrollIntoView())},cruxFileUploadShowPreview:function(e){Lyte.registeredMixins["crm-uploadfields-mixin"].showPreviewImpl(e)},throwEventToRoute:function(e,t){var i=t||{};this.throwEvent("throwEventToRoute",e,i)},openZiaVisionPopup:function(e,t){var i=moduleRecordMapping[module.value].fields.filterBy({column_name:e.component.data.cxPropField.column_name})[0];return Lyte.registeredMixins["crm-uploadfields-mixin"].openFeaturePopup(t.id,t.state,!1,!0,i.id,module.value,entityId.value,i.api_name)},onPreviewClose:function(e){if(this.isImageModified[e.component.data.cxPropId]){let e=document.querySelector("crm-detailview-canvas");e&&e.component.handleeditButtonMethod.bind(e.component)()}},onImageCompRendered:function(e){let t=document.querySelector("crm-detailview-canvas").component.getData("getThumbnailDataMap"),i=e.component.getData("cxPropField");Lyte.registeredMixins["crm-uploadfields-mixin"].updateThumbnailBasedOnSrc(t,e,i,e.component.getData("recordId"),!0)},onImageChange:function(e){this.isImageModified[e.component.data.cxPropId]=!0},onCropSuccess:function(e,t,i){return this.isImageModified[e.component.data.cxPropId]=!0,Lyte.registeredMixins["crm-uploadfields-mixin"].onCropSuccess(t,i)},showNoteCnt:function(e){var t=e&&e.$node&&e.$node.getAttribute("relid"),i=e&&e.data&&e.data.allNotesCount,a=$("#RL_dataCount_"+t);if(i){$(a.eq(0)).text(i),a.css({cursor:"auto",padding:" 2px 5px",color:"#14161D",display:"inline-block","text-align":"center","font-size":"1.2rem","margin-left":"8px",background:"#D2E2FE","border-radius":"7px","min- width":"12px","line-height":"normal",height:"auto"})}else a.hide()},onNotesRequestError:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.creator.error.access"),ltPropType:"error"}})},updateTimelinebasedOnNotes:function(e){if(Lyte.triggerEvent("NotesTimeline"),e&&e.tagName&&"crm-notes"===e.tagName.toLowerCase()){var t=$(e)&&$(e).find("crux-note");e=t&&t[0]&&t[0].component}else e=e&&e.component;this.methods.showNoteCnt(e)},checkingDisabledorNot:function(e){return!e||!e.$converted},setFilterQueryId:function(){if(Crm.userDetails.isLookupFilterEnabled&&this.getData("moduledataUicomp.lookup.query_details")&&this.getData("moduledataUicomp.lookup.query_details.query_id")&&(this.setData("defaultUserQueryParams",{query_id:this.getData("moduledataUicomp.lookup.query_details.query_id")}),Crm.userDetails.isDynamicLookupFilterEnabled)){var e={};this.iterateGroupFieldsAndGetFieldValuesFromRecordData(this.getData("moduledataUicomp.lookup.query_details.criteria"),this.getData("dataBind"),e,this.getData("moduledataUicomp").module[0].fields,this.getData("moduledataUicomp").module[0].module_name),e=JSON.stringify(e),this.setData("childData",e);var t=this.getData("defaultUserQueryParams");t.child_data=this.data.childData,this.setData("defaultUserQueryParams",t)}}},_observedAttributes:["module","record","showCallNowButton","fieldarray","records","rellistId","entityDetails","layoutId","isLoading","displayField","fromRecord","mainmodulerule","relatedmodulerule","canvas_rules","actualheight","featureName","viewType","imageuploadFieldIds","extensionmeta","extension","featuresStatus"]};i&&i(a),Lyte.Component.register(e,a,{mixins:["lyte-table-utils","crm-formview-mixin","crm-detailcanvas-utils"]})},showEditIcon:function(e,t,i,a,n){t="Deals"===t?"Potentials":t;store.peekRecord("module",moduleRecordMapping[t].id).editable;var r=["Services","Appointments"];if(!n)n={};let o=!1;if("crm.settings.section.modules.module.canvas.create"===Lyte.Router.getRouteInstance().transition.info.route?o=!1:e&&r.indexOf(t)<0&&("Review in Progress"===e.$review||"Pending for Review"===e.$review||"Pending for ReReview"===e.$review)?(n.errMsg=I18n.getMsg("crm.canvas.ajax.field.error.process",I18n.getMsg("crm.label.cf.review_process")),o=!1):e&&"merge_pending"===e.$approval_state?(n.errMsg=I18n.getMsg("crm.canvas.ajax.field.error.process",I18n.getMsg("crm.label.approval.process.list")),o=!1):e&&(e.$stop_processing||!e.$editable&&!a)?(r.indexOf(t)<0&&"approved"!==e.$approval_state?n.errMsg=I18n.getMsg("crm.canvas.ajax.field.error.process",I18n.getMsg("crm.label.approval.process.list")):n.errMsg=I18n.getMsg("crm.record.edit.denied"),o=!1):Crm.userDetails.permissions["Crm_Implied_Edit_"+t]?e&&"read_only"===e.$sharing_permission||i&&i.entityDetails&&i.entityDetails.editActionRestricted?(n.errMsg=I18n.getMsg("crm.record.edit.denied"),o=!1):o=!0:(n.errMsg=I18n.getMsg("crm.record.edit.denied"),o=!1),!o){let e=$L("crux-image-component");if(e&&e.length){let t=e.length;for(let i=0;i<t;i++)e[i].setData("cxPropReadonly",!0)}n.errMsg=I18n.getMsg("crm.record.edit.denied")}return o},recordNavigation:function(e,t,i,a){if(e.target&&(e.target.closest("crux-lookup-component")||e.target.closest(".zcanvas-datatable-header")||e.target.classList.contains("moreCount")||e.target.closest(".zccbutton")||!e.target.classList.contains("zcclink")&&e.target.closest(".zcclink")))return!1;if("edit"===i)return Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[a.module_name,t.id]}).data={recordNum:t.recnum},e.stopPropagation(),!1;var n={recordNum:t.recnum,cvid:a.custom_view.id};"Calls"!==a.module_name&&"Events"!==a.module_name&&"Tasks"!==a.module_name||(n.fromActSubModuleListView=!0,n.fromActivityListView=!0);var r=Crm.getCanvasId(moduleRecordMapping[a.module_name].id,t.id);r?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[a.module_name,t.id,r]}).data=n:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[a.module_name,t.id]}).data=n},showPermissionErrorMsgPopup:function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:I18n.getMsg("crm.security.error"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right",ltPropWrapperClass:"crm-canvas-delete-alert"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg").style="color:#E20000"}})},showHistory:function(e,t,i){var a=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")],ResourceConstants.CRM));Lyte.injectResources(a,void 0,(function(){var e=$L("crm-reviewprocess-reviewpop").e;if(e.length>0&&e[0].remove(),t){var a={};a.module=t,a.recordId=i,a.recordHistory=!0,store.findRecord("reviewprocesspop",i,void 0,void 0,!1,a).then((function(e){var a=[];e&&e.reviewprocesspop&&(a=e.reviewprocesspop.history),Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:t,entityId:i,recordHistory:a},"#detailViewButtonLayerMainTable"),$L("#rPhistoryPop").e.ltProp({wrapperClass:"reviewPopWrapper",show:!0,showCloseButton:!0,"lt-prop-close-on-escape":!0})}))}else Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:t,entityId:i,recordHistory:[]},"#detailViewButtonLayerMainTable"),$L("#rPhistoryPop").e.ltProp({wrapperClass:"reviewPopWrapper",show:!0,showCloseButton:!0,"lt-prop-close-on-escape":!0})}))},deleteEntity:function(e,t,i,a){if(("Accounts"===e||"Contacts"===e)&&a.zbCustomModuleObj&&a.zbCustomModuleObj.isZBCustomModuleEnabled){var n=[t],r=moduleRecordMapping[e].singular_label;ZInvoice.fetchAssociatedIds(e,n,(function(t){if(t.length>0){var a=[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"default"}],n=I18n.getMsg("crm.cannot.delete.account.contact.header",r),o=I18n.getMsg("crm.cannot.delete.account.contact.singular",r.toLowerCase()),s=$L("#detailViewUtilAlert"),l={ltPropPrimaryMessage:n,ltPropSecondaryMessage:o,ltPropButtons:a,id:"detailViewUtilAlert",ltpropWrapperClass:"dv_Alert",ltPropShowCloseButton:!1};0===s.length?s.push(Lyte.Component.render("lyte-alert",l,"body")):s[0].setData(l),s[0].ltProp("show",!0)}else Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(i,2,e,null,null,null,!0)}))}else{if(Lyte.Router.getRouteInstance().currentModel.entityDetails.showAddForCPUser)return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(i,2,e,null,null,null,!0)}},getCruxName:function(e,t){var i={556:"image",555:"fileupload",99:"text-area",444:"multiselectlookup"},a="text";return 20===e&&"autonumber"===t?a="number":crmConstants.defaultUiTypeToCruxMapping[e]?a=crmConstants.defaultUiTypeToCruxMapping[e]:i[e]&&(a=i[e]),a},unregisterCanvasComponents:function(e){var t=store.peekRecord("canvasview",e),i=this.getCanvasComponentsArr(t);i.push(e);for(var a=i.length,n=0;n<a;n++){var r=this.getCompNamefromId(i[n]);Lyte.Component.registeredComponents[r]&&Lyte.Component.unregisterComponent(r)}},getCanvasComponentsArr:function(e){var t=[];return this.populateCanvasComponents(e,t),t},populateCanvasComponents:function(e,t){"component"===e.type&&"Custom Layout"===e.theme&&t.push(e.id),"relatedlist"===e.type&&"Custom Layout"===e.theme&&t.push(e.componentid);for(var i=e.children?e.children.length:0,a=0;a<i;a++)this.populateCanvasComponents(e.children[a],t)},unregisterComponent:function(e){Lyte.Component.registeredComponents[e]&&Lyte.Component.unregisterComponent(e)},registerRelatedModuleModel:function(e){return new Promise((function(t){if(!store.model[moduleRecordMapping[e].id])return app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,void 0,void 0,!0,{getOnlyMeta:!1,allowMultiple:!0}).then((function(e){t(e)}));t(!0)}))},fetchRelatedModuleRecordsById:function(e,t,i){return new Promise((function(a,n){var r=t?t.join(","):"";""===r&&a([]);var o="/crm/v2.1/"+e.api_name,s={params:{ids:r,approved:"both"}};"Bundles__s"===e.api_name&&(o=Crm.changeBundlesApiVersion(o,"v2.2")),networkUtils.lyteInitiateRequest(o,"GET",s,!0).then((function(t){for(var n=t.data,r=n.length,o=0;o<r;o++){var s=n[o];s.parentCompId=i[s.id].id,s.isTemplate=!0,store.pushPayload(moduleRecordMapping[e.module_name].id,s)}a(t)})).catch((function(e){n(e)}))}))},fetchRelatedModuleRecords:function(e,t){var i=this;return new Promise((function(a){return i.registerRelatedModuleModel(e).then((function(){var i=store.peekRecord(moduleRecordMapping[e].id,t);if(!i)return app.store.makeRequest("findRecord",moduleRecordMapping[e].id,t).then((function(e){a(e)}));a(i)}))}))},contextchangehandler:function(e,t){var i=this.main.selectedfields.closest(".zcanvas-static-editor"),a=i.data("zcanvas"),n=Lyte.registeredMixins["crm-detailcanvas-utils"],r=n.getReversedSelector(e.selector);this.main.config&&this.main.config.oncontextchangehandler&&this.main.config.oncontextchangehandler(n,r),a.contextstyles[r]||(a.contextstyles[r]={});var o=objectUtils.cloneObject_new(a.contextstyles);if("padding"===e.actionproperty&&(t.style["pading-top"]||t.style["padding-right"]||t.style["padding-left"]||t.style["padding-bottom"])){["padding-top","padding-right","padding-bottom","padding-left"].forEach((function(i){var n=zutils.getCompressionMapping("stylekey",i);a.contextstyles[e.selector][n]=zutils.getCompressionMapping("stylevalue",t.style[i])}))}else{var s=zutils.getCompressionMapping("stylekey",e.actionproperty);a.contextstyles[r][s]=zutils.getCompressionMapping("stylevalue",t.style[e.actionproperty])}this.main.config.oncontextualstylebeforeappend&&this.main.config.oncontextualstylebeforeappend(a,e,t);var l=objectUtils.cloneObject_new(a.contextstyles);i.find("style").remove(),i.append(zcanvasrelatedList.getStyleElement(a.contextstyles,i.attr("id"))),undoredomanager.push({action:"callback",node:"#"+i.attr("id"),previous:o,current:l,callback:function(e,t){var i=$(e.node),a=i.data("zcanvas");i.find("style").remove(),"undo"==t?(i.append(zcanvasrelatedList.getStyleElement(e.previous,i.attr("id"))),a.contextstyles=objectUtils.cloneObject_new(e.previous)):(i.append(zcanvasrelatedList.getStyleElement(e.current,i.attr("id"))),a.contextstyles=objectUtils.cloneObject_new(e.current))}})},preProcessMoreComponent:function(){var e=this.getData("components"),t=this.getData("includedActions"),i=[],a=["morebutton","navigate","back","meeting_status"],n=[];this.getData("record").$approved||(n=["edit","delete","mail_merge","macro","findandmerge"]);var r=[];Crm.calPreferences.MEETINGPREFDETAILS||(r=["meetnow","scheduleonlinemeeting"]);for(var o=e.length,s=0;s<o;s++){var l=e[s];"action"===l.type&&a.indexOf(l.name)<0&&t.indexOf(l.name)<0&&n.indexOf(l.name)<0&&r.indexOf(l.name)<0&&l.comp_available&&(clientPortalName?["edit","clone","delete","reviewHistory"].includes(l.name)&&i.push({name:l.display_label,label:l.name,data_zcqa:l.data_zcqa}):i.push({name:l.display_label,label:l.name,data_zcqa:l.data_zcqa}))}this.setData("moreActions",i)},getPickListValues:function(e){var t=this.getData("record"),i=this.getData("dependencyMaps"),a=this.getData("childParentDepMap")[e];if(!a)return!1;var n=t[a]?t[a]:"-None-";return i[a][n][e]},constructRPFldsJson:function(e,t){var i={total:0,approved:0,rejected:0},a=t.review.process_fields;if(a&&a.length>0&&"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var n=Lyte.registeredMixins["crm-detailcanvas-utils"],r=n.revlayoutRuleShowFld;a=a.filter((function(e){var t=!0,i=store.peekRecord("field",e.id);return n.revlayoutRuleShowSections.includes(i.section[0].name)&&(t=!1),i.visible&&!r.includes(e.id)&&t}))}for(var o=a.length,s=this.constructReviewProcessFldMap(a),l=this.getData("module"),d=this.getData("record"),c=[],u=[],m=[],p=0;p<o;p++){var v=a[p],f=v.id;if(v.subform_records){if(v.subform_records.length>0){for(var _=v.api_name,h=v.id,g=v.subform_records,y=g.length,b={},C=this.getSubformRecordsMap(d[_]),L=0;L<y;L++)for(var R=g[L],w=R.process_fields,x=w.length,I=R.id,S=C[I],D=0;D<x;D++){var z=w[D],M=z.id,k=store.peekRecord("field",M),A={id:k.id,field_label:k.field_label,sys_name:k.api_name},F=k.id;E=(E=Crm.renderDVLyteFlow(l)&&Crm.userDetails.isSubformNewComponentEnabled||!Crm.renderDVLyteFlow(l)?Lyte.registeredMixins["crm-canvas-core-construct-component"].constructCruxComponentForCanvas(F,l,S,!0):"")||"-",A.fieldHtml=E,A.subform={subformApiName:_,subformRecordId:I,subformId:h},A.review_status=z.status,i.total++,"Rejected"===z.status?i.rejected++:"Approved"===z.status&&i.approved++;var P=store.peekRecord("field",A.subform.subformId).display_label;u.indexOf(A.subform.subformApiName)<0&&(u.push(A.subform.subformApiName),b.subform=[],b.subformname=P),b.subform.push(A)}m.push(b)}}else{var E,O=store.peekRecord("field",f),T={id:O.id,field_label:$ESAPI.encoder().encodeForHTMLAttribute(O.field_label),sys_name:O.api_name},$={};if(Crm.moduleInfo.Leads&&($.Leads=Crm.moduleInfo.Leads.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME")),Crm.moduleInfo.Contacts&&($.Contacts=Crm.moduleInfo.Contacts.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME")),"Last_Name"===O.api_name){var N=store.peekAll("field").filter((function(e){return e.module&&e.module[0]&&e.module[0].module_name===l&&"Full_Name"===e.api_name}))[0],V=N.id;T.id=V,T.field_label=$ESAPI.encoder().encodeForHTMLAttribute($[N.module[0].module_name])}E=(E=(_=s[f].subform_apiname)?Crm.renderDVLyteFlow(l)&&Crm.userDetails.isSubformNewComponentEnabled||!Crm.renderDVLyteFlow(l)?Lyte.registeredMixins["crm-canvas-core-construct-component"].constructCruxComponentForCanvas(f,l,d[_],!0):"":Lyte.registeredMixins["crm-canvas-core-construct-component"].constructCruxComponentForCanvas(T.id,l,d))||"-",T.id=f,T.fieldHtml=E,T.review_status=s[f].status,i.total++,"Rejected"===T.review_status?i.rejected++:"Approved"===T.review_status&&i.approved++,O&&O.tooltip&&"Info Icon"===O.tooltip.name&&(T.field_label+='<span data-zcqa="zc_ajxFld_'+O.id+'" id="zc_ajax_info_icon_'+O.id+'" lt-prop-title="'+$ESAPI.encoder().encodeForHTMLAttribute(O.tooltip.value)+'" lt-prop-tooltip-config={"position":"top"} class="icon_roundinfo mL5 cP vaM"></span>'),c.push(T)}}return c=c.concat(m),this.getData("fromOldDetailView")||this.setReviewStatusCount(i),c},setReviewStatusCount:function(e){this.setData("rpFldsLength",e.total),this.setData("fieldsToReview",e.total),this.setData("approvedFields",e.approved),this.setData("rejectedFields",e.rejected),this.setData("reviewedFields",e.approved+e.rejected),this.setData("recordReviewed",e.total===e.approved+e.rejected)},getSubformRecordsMap:function(e){for(var t={},i=e?e.length:0,a=0;a<i;a++){var n=e[a];t[n.id]=n}return t},constructReviewProcessFldMap:function(e){var t={};return e.map((function(e){return e.hasOwnProperty("subform_records")||(t[e.id]={api_name:e.api_name,status:e.status}),null})),t},selectionchange:function(e){for(var t=e.length,i=0;i<t;i++){var a=e.eq(i);if(a.hasClass("zc-tab-container")&&(a=a.closest(".zctablayout")),a.hasClass("ui-resizable"))for(var n=a.css(["border-left","border-right","border-top","border-bottom"]),r=a.children(".ui-resizable-handle"),o=a.find(".zc-add-canvas"),s=r.length,l=a.innerHeight(),d=a.outerHeight(),c=0;c<s;c++){var u={};r.eq(c).hasClass("ui-resizable-e")?(u.height="inherit",u.top=-(parseInt(n["border-top"])+5),u.right=-(parseInt(n["border-right"])+5)):r.eq(c).hasClass("ui-resizable-w")?(u.height="inherit",u.top=-(parseInt(n["border-top"])+5),u.left=-(parseInt(n["border-left"])+5)):r.eq(c).hasClass("ui-resizable-n")?(u.width="inherit",u.top=-(parseInt(n["border-top"])+5),u.left=-(parseInt(n["border-left"])+5)):r.eq(c).hasClass("ui-resizable-s")?("auto"!=a.get(0).style.height&&""!=a.get(0).style.height||a.height(d),u.width="inherit",u.bottom=-(parseInt(n["border-bottom"])+5),u.left=-(parseInt(n["border-left"])+5)):r.eq(c).hasClass("ui-resizable-nw")?(u.left=-(parseInt(n["border-left"])+5),u.top=-(parseInt(n["border-top"])+5)):r.eq(c).hasClass("ui-resizable-ne")?(u.top=-(parseInt(n["border-top"])+5),u.right=-(parseInt(n["border-right"])+5)):r.eq(c).hasClass("ui-resizable-sw")?(u.left=-(parseInt(n["border-left"])+5),u.bottom=-(parseInt(n["border-bottom"])+5)):r.eq(c).hasClass("ui-resizable-se")?(u.right=-(parseInt(n["border-right"])+5),u.bottom=-(parseInt(n["border-bottom"])+5)):o&&(u.top=l+parseInt(n["border-bottom"])+zutils.getCanvasDimension(25),o.css(u)),r.eq(c).css(u)}}},updateAsyncprop:function(e,t){if(e&&e.fieldContainer){var i=$(e.fieldContainer).data("zcdatamap");i&&i[e.id]&&(i[e.id].async=t)}},loadResourceOnDemand:function(e,t){e.asyncloader=new Promise((function(i){var a=objectUtils.cloneObject_new(e.asyncresources);if(a&&a.length){var n=a;Lyte.injectResources(n).then((function(){e.async=!1,t&&Lyte.registeredMixins["crm-detailcanvas-utils"].updateAsyncprop(e,!1),i(e)}))}else e.async=!1,t&&Lyte.registeredMixins["crm-detailcanvas-utils"].updateAsyncprop(e,!1),i(e)}))},debouncescroll:function(){var e,t=this.scrollhandler;return function(){var i=this,a=arguments,n=function(){e=null,t.apply(i,a)};clearTimeout(e),e=setTimeout(n,150)}},scrollhandler:function(){var e=".zcanvas_lyte_component.zcanvas_not_rendered:not(template):visible,.fieldupdate-highlight",t=document.querySelector("crm-detailview-canvas"),i=!1,a=!1,n=!1,r=Lyte.registeredMixins["crm-detailcanvas-utils"];t&&("MobileDetailView"===t.component.data.feature&&(e=".zcanvas_lyte_component.zcanvas_not_rendered:not(template),.fieldupdate-highlight"),i=r.isSandboxDiffPage,a=r.isProdDiffPage,n=t.component.data.viewType),i?e="#sandboxObj_sandboxChanges .zcanvas_lyte_component.zcanvas_not_rendered:not(template):visible,.fieldupdate-highlight":a&&(e="#parentObj_sandboxChanges .zcanvas_lyte_component.zcanvas_not_rendered:not(template):visible,.fieldupdate-highlight");var o=$L(e).getviewport(),s=o.length;if(r.isWizardView()){var l=$L("crm-canvas-form")[0].component.data,d=l.layoutId||Lyte.Router.getRouteInstance().transition.info.queryParams.layoutId;(Lyte.registeredMixins["crm-wizard-execution"]||{}).wizardViewDidConnect(),Lyte.registeredMixins["crm-formview-mixin"].initForm(l.record,l.moduleObj,d,l.form_type,null,null,!0,!0),$L(".zc-tabindex-configured").length&&$L(".lcreate-t-contents").find("lyte-dropdown,lyte-button").each((function(){this.ltProp("tabindex",1)}))}if(Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()){var c,u=(c=$L("crm-canvas-form")[0].component).getData("moduleObj"),m=c.getData("record"),p=c.getData("form_type");d=c.getData("layoutId");setTimeout(function(){Lyte.registeredMixins["crm-formview-mixin"].initForm(m,u,d,p,null,null,!0,!0)}.bind(this),100)}else i||a||"preview"===n||(Lyte.registeredMixins["crm-detailcanvas-utils"].executeLRsubform(),Lyte.registeredMixins["crm-detailcanvas-utils"].executeLRSections());for(var v=0;v<s;v++){if($(o[v]).hasClass("fieldupdate-highlight"))setTimeout((function(e){e.removeClass("fieldupdate-highlight")}),1e4,$(o[v]));else o[v].setData("lazyload",!0),o[v]&&o[v].getData&&!o[v].getData("isLoading")&&(o[v].classList.remove("zcanvas_not_rendered"),o[v].removeAttribute("style"))}if(Crm.userDetails.CANVAS_TABINDEX_ENABLE&&(r.isWizardView()||r.isFormViewCommonCheck())&&$L(".zc-tabindex-configured").length&&(c=$L("crm-canvas-form")[0]).getData("isPageLoaded")){var f=c.getData("moduleObj");(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&!Crm.userDetails.LRINVOLVEDMODULES.includes(f.api_name))&&setTimeout((function(){Lyte.registeredMixins["crm-formview-mixin"].setTabIndexForCanvasFormFields()}),100)}},getRelListIdsfromViewJson:function(e,t){for(var i,a=e&&e.children||[],n=a.length,r=0;r<n;r++)if("component"===(i=a[r]).type&&!0===i.related_list){var o=i&&i.children&&i.children[1]&&i.children[1].id,s=store.peekRecord("related_list",o);isNaN(o)||t.contains(o)||!s||"combined_view"===s.type||t.push(i.children[1].id)}else if("component"!==i.type||!i.tab_relatedlist_id||isNaN(i.tab_relatedlist_id)||t.contains(i.tab_relatedlist_id))this.getRelListIdsfromViewJson(i,t);else{(s=store.peekRecord("related_list",i.tab_relatedlist_id))&&"combined_view"!==s.type&&t.push(i.tab_relatedlist_id)}Lyte.registeredMixins["crm-detailcanvas-utils"].relListIdsinView=t},triggerRLCountAPI:function(e,t,i){var a=Lyte.registeredMixins["crm-detailcanvas-utils"];let n=[];i.forEach((e=>{n.push({related_list:{id:e}})})),n.length&&a.triggerCntAPI(e,t,n)},triggerCntAPI:function(e,t,i){var a=Crm.userDetails.RLBatchLimitPerRLCountAPI,n=i.splice(0,a),r=Lyte.registeredMixins["crm-detailcanvas-utils"];store.triggerAction("dummy","rlCount",{url:"/crm/v4/"+e+"/"+t+"/actions/get_related_records_count",method:"POST",payLoad:{get_related_records_count:n}},null,"POST").then((function(a){var n=a.get_related_records_count;if(n)for(var o=n.length,s=0;s<o;s++)if(n[s].related_list){var l={};r.relListCountObject[n[s].related_list.id]=n[s].count,l[n[s].related_list.id]=n[s].count,r.handleCountforRL(l)}i.length>0&&r.triggerCntAPI(e,t,i)}))},handleCountforRL:function(e){for(var t in e){var i=t,a=e[t],n={cursor:"auto",padding:"2px 5px",color:"#14161D",display:"inline-block","text-align":"center","font-size":"1.2rem","margin-left":"8px",background:"#D2E2FE","border-radius":"7px","min-width":"12px"," line-height":"normal",height:"auto"},r=$L("crm-detailview-canvas").find("#RL_dataCount_"+i);if(a){for(var o=r.length,s=0;s<o;s++){var l=$(r[s]);if(l.closest(".zc-rl-tab").length)l.css(n),l.text(a);else if(l.closest(".zc-tab-container").length){if(l.closest(".zc-tabrl-container").length)continue;l.css(n),l.text(a)}else l.css(n),l.text(a);var d=$L(document.querySelectorAll("#relList_"+I18n.getMsg("Edit")+"_"+i));d.length>0&&d[s]&&(d[s].style.display="block")}r.css("display","inline-block")}else void 0!==a&&0!==a||r.css("display","none")}},countAndRefreshIconHandler:function(e){var t="",i=e.id;return this.canvasInfoCount&&this.canvasInfoCount[i]>=1?this.canvasInfoCount[i]++:this.canvasInfoCount[i]=1,t='<span id="RL_dataCount_'+e.id+'" data-zcqa="canvasCnt_'+e.id+'" rl-count="'+this.canvasInfoCount[e.id]+'"></span>',e&&e.api_name&&"Notes"!==e.api_name&&"Social"!==e.api_name&&"CheckLists"!==e.api_name&&"custom_related_list"!==e.type&&"Zoho_Support"!==e.api_name&&"Entity_Scores__s"!==e.api_name&&"Voice_of_Customer__s"!==e.api_name&&"Voice_of_the_Customer__s"!==e.api_name&&(t+=' <div id="fetch_'+e.id+'" data-zcqa="refresh_'+e.display_label+"\" onClick=\"{{action('refreshingrelatedlist','"+e.id+"','fetch_"+e.id+'\')}}" class="mL10 tb_small_loader vaM"  ><span class="ld_init"></span><span class="ld_process"></span></div>'),t},getAvailableModulesByFeatureForPrediction:function(){var e=["Visits","Forecasts","Services","Appointments","Tasks","Calls","Events"],t=["default","custom"],i=["crm"],a=this,n=[];return store.peekAll("module").filter((function(r){if(!0===r.presence_sub_menu&&!0===r.visible&&t.indexOf(r.generated_type)>-1&&i.indexOf(r.source)>-1&&e.indexOf(r.module_name)<0&&a.moduleOccurenceCount(n,r)<2)return r}))},moduleOccurenceCount:function(e,t){return e.filter((function(e){return e===t.module_name})).length},transformdatatocriteria:function(e){if(!e)return[];var t=["profileimage","fileupload","owner","multiselectpicklist","multiselectlookup","subform","static_subform"];return e=e.filter((function(e){if(e&&!(t.indexOf(e.data_type)>-1))return!0}))},getModuleNameFromRelatedlistId:function(e){var t=store.peekRecord("related_list",e);if(t&&t.module)return"Email_Sentiment"===t.api_name?"EmailSentiment":t.connectedmodule?t.connectedmodule:t.module.id&&store.peekRecord("module",t.module.id)?store.peekRecord("module",t.module.id).module_name:void 0},getCriteriaToJsonArray:function(e){var t=[];return e&&e.forEach((function(e){var i=e.$&&e.$.toJSON?e.$.toJSON():e;t.push(i)})),t},criteriaref:{},expandcombinedcriteria:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var i in t.criteriaref){for(var a=i.split("_and_"),n=a.length,r=!0,o=0;o<n;o++)r&&(r=e.hasClass(a[o]));r&&e.addClass(t.criteriaref[i])}},getcombinedzcid:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];return e.indexOf("_and_")>-1?(t.criteriaref[e]||(t.criteriaref[e]=zutils.getRandomId()),t.criteriaref[e]):e},criteriaswithcase:function(e,t,i){for(var a=Lyte.registeredMixins["crm-detailcanvas-utils"],n=a.stylekeys(t||{}),r=["default","active","hover"],o=n.filter((function(e){return!r.contains(e)&&e.indexOf("_mousestate_")<0})),s=o.indexOf(i),l=e.split(" "),d=l[0],c=l[1]||"",u=0;u<s;u++){var m=o[u].split("_child_"),p=m[0]||"",v=m[1]||"";if(p){var f=a.getcombinedzcid(p);d.indexOf(f)<0&&c.indexOf(f)<0&&(d+=":not(."+f+")")}if(v){f=a.getcombinedzcid(v);d.indexOf(f)<0&&c.indexOf(f)<0&&(c+=":not(."+f+")")}}return d+c},renderfromqueue:function(e,t,i,a){if(zutils.trivialqueue&&zutils.trivialqueue.length||zutils.renderingqueue&&zutils.renderingqueue.length||zutils.priorityqueue&&zutils.priorityqueue.length){var n=zutils.priorityqueue&&zutils.priorityqueue.length?zutils.priorityqueue.shift():zutils.renderingqueue&&zutils.renderingqueue.length?zutils.renderingqueue.shift():zutils.trivialqueue&&zutils.trivialqueue.length?zutils.trivialqueue.shift():null;if(n){var r=canvasOutput.html(void 0,n.json,!0);n.callback.bind(this)(r,n.src,n.json,t)}setTimeout(function(){this.renderfromqueue(e,t,i,a)}.bind(this),1)}else{Customization.dropCache=!1;var o=Lyte.registeredMixins["crm-detailcanvas-utils"];o.initializeLazyLoad();var s=document.querySelector("crm-detailview-canvas")||document.querySelector("crm-canvas-form"),l=o.isSandboxDiffPage,d=o.isProdDiffPage;if((l||d)&&(s=l?document.querySelector("#sandboxObj_sandboxChanges crm-detailview-canvas"):d?document.querySelector("#parentObj_sandboxChanges crm-detailview-canvas"):s),o.maincompname&&(s&&s.component.setData("comp_name",o.maincompname),o.maincompname=void 0,o.ruledelete=!1),s&&!s.getData("isPageLoaded"))s.querySelector(".zc-page-component")&&s.setData("isPageLoaded",!0),s.component.onPageLoaded.bind(s.component)();if(Crm.userDetails.isRLCountSupportedForCanvas){var c=o.relListCountObject;if(c)for(const e in c){const t=c[e];var u={};u[e]=t,o.handleCountforRL(u)}}if(l||d){var m;m=d?{isProdDiffLoaded:!0}:l?{isSandboxDiffLoaded:!0}:{},sandbox.viewDetailviewCanvasSandboxDiffPage(sandbox.CanvasconfigType,sandbox.canvasSandboxConfigId,sandbox.canvasParentConfigId,sandbox.Canvasmodule,sandbox.canvasSandboxLayoutId,sandbox.canvasParentRootId,m)}var p=Lyte.Router.getRouteInstance();if(p.transition&&p.transition&&p.transition.info&&p.transition.info.fragment&&"string"==typeof p.transition.info.fragment&&p.transition.info.fragment.indexOf("anchor_")>-1){var v=p.transition.info.fragment.slice(p.transition.info.fragment.indexOf("anchor_")+"anchor_".length,p.transition.info.fragment.length);if(v&&s){var f=s.getData("systemIdMap");if(f&&f[v]){var _=$L(".canvas-tab-element-id-"+f[v]);_.is(":visible")&&_.click()}}}e()}},stylekeys:function(e){var t=[],i=Object.keys(e||{});return t=i.filter((function(t){return e[t].$inherited})),i.filter((function(t){return!e[t].$inherited})).sort((function(t,i){return(e[t].$order||0)-(e[i].$order||0)})).concat(t.sort((function(t,i){return(e[t].$order||0)+(e[t].$inheriance_level||0)-((e[i].$order||0)+(e[i].$inheriance_level||0))})))},removeCanvasRuleAllFields:function(e){if(e&&e.datastyle&&(e.datastyle.canvas_rules=[],e.datastyle&&e.datastyle.value&&(Object.keys(e.datastyle.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.style[t]})),e.datastyle.value.tablestyles))){for(var t in e.datastyle.value.tablestyles.fields)e.datastyle.value.tablestyles.fields[t].field&&Object.keys(e.datastyle.value.tablestyles.fields[t].field.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(i){delete e.datastyle.value.tablestyles.fields[t].field.style[i]})),e.datastyle.value.tablestyles.fields[t].holder&&Object.keys(e.datastyle.value.tablestyles.fields[t].holder.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(i){delete e.datastyle.value.tablestyles.fields[t].holder.style[i]})),e.datastyle.value.tablestyles.fields[t].label&&Object.keys(e.datastyle.value.tablestyles.fields[t].label.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(i){delete e.datastyle.value.tablestyles.fields[t].label.style[i]})),e.datastyle.value.tablestyles.fields[t].value&&Object.keys(e.datastyle.value.tablestyles.fields[t].value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(i){delete e.datastyle.value.tablestyles.fields[t].value.style[i]}));if(e.datastyle.value.tablestyles.rows)for(var i=e.datastyle.value.tablestyles.rows.length,a=0;a<i;a++)Object.keys(e.datastyle.value.tablestyles.rows[a].value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.tablestyles.rows[a].value.style[t]}));e.datastyle.value.tablestyles.table&&Object.keys(e.datastyle.value.tablestyles.table.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.tablestyles.table.style[t]}))}e&&e.sectionstyle&&e.sectionstyle.value&&Object.keys(e.sectionstyle.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.sectionstyle.value.style[t]})),e&&e.titlesection&&e.titlesection.ui&&e.titlesection.ui.value&&Object.keys(e.titlesection.ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.titlesection.ui.value.style[t]}));for(var n=e.titlesection.children,r=n.length,o=0;o<r;o++)Object.keys(n[o].ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(e){delete n[o].ui.value.style[e]}))},removeCanvasRuleinJson:function(e){if(e.ui.field&&e.ui.field.style&&Object.keys(e.ui.field.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.field.style[t]})),e.ui.holder&&e.ui.holder.style&&Object.keys(e.ui.holder.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.holder.style[t]})),e.ui.label&&e.ui.label.style&&Object.keys(e.ui.label.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.label.style[t]})),e.ui.value&&e.ui.value.style&&(Object.keys(e.ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.style[t]})),e.ui.value.layoutstyle&&e.ui.value.layoutstyle.editor&&(Object.keys(e.ui.value.layoutstyle).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.layoutstyle[t]})),Object.keys(e.ui.value.layoutstyle.editor).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.layoutstyle.editor[t]})))),e.ui.image&&e.ui.image.style&&Object.keys(e.ui.image.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.image.style[t]})),e.ui.canvas_rules&&(e.ui.canvas_rules=[]),e.ui.allfieldstabstyle)for(var t in e.ui.allfieldstabstyle)this.removeCanvasRuleAllFields(e.ui.allfieldstabstyle[t])},traversingComponents:function(e){var t=e.children||[],i=t.length;e&&this.removeCanvasRuleinJson(e);for(var a=0;a<i;a++)this.traversingComponents(t[a])},updatingRuleData:function(e){store.modelFor("canvas_rule")&&store.peekRecord("canvas_rule",e)&&store.findRecord("canvas_rule",e)},RequestingcanvasruleinBuilder:function(e){var t=$L("crm-detailview-oldeditor")[0].component,i=t.getData("criterias")||[];!e||this.requestedRule.includes(e)||this.canvasRuleUnsupportComp.includes(e)||0!==i.filter((function(t){return t.module.api_name===e})).length||(this.requestedRule.push(e),store.findAll("canvas_rule",{module:e}).then((function(e){var a=Lyte.registeredMixins["crm-detailcanvas-utils"].getCriteriaToJsonArray(e);Lyte.arrayUtils(i,"concat",a),t.setData("criterias",i)})))},checkdeletedRule:function(e,t,i){if(e){for(var a,n,r=e.length,o=!1,s=Lyte.registeredMixins["crm-detailcanvas-utils"],l=0;l<r;l++)if(a=e[l].id,s.deletedRule.includes(a))i&&(s.CompVsRule[i]?s.CompVsRule[i].includes(a)||(n=!0,s.CompVsRule[i].push(a)):(n=!0,s.CompVsRule[i]=[],s.CompVsRule[i].push(a)));else if(!store.peekRecord("canvas_rule",a)||store.peekRecord("canvas_rule",a)&&"inactive"===store.peekRecord("canvas_rule",a).status){for(var l in this.criteriaref)l.includes(a)&&delete this.criteriaref[l];s.deletedRule.push(a),s.ruledelete=!0,o=!0,i&&(s.CompVsRule[i]?s.CompVsRule[i].includes(a)||(n=!0,s.CompVsRule[i].push(a)):(n=!0,s.CompVsRule[i]=[],s.CompVsRule[i].push(a)))}if(t&&o&&!i?s.unregisterCanvasView(t):i&&(n||o)&&Lyte.Component.registeredComponents[i]&&(this.CanvasIdVsCanvasComp[t].removeFirstOccurenceOfElement(i),Lyte.Component.unregisterComponent(i)),o){var d=s.ListCardComp.length;for(l=0;l<d;l++)Lyte.Component.registeredComponents[s.ListCardComp[l]]&&Lyte.Component.unregisterComponent(s.ListCardComp[l])}}},splitstate:function(e){var t={hasmousestate:!1,main_:[],sub_:[]},i=e.indexOf("_mousestate_");i>-1&&(t.hasmousestate=!0,e=e.slice(0,i));var a=e.split("_child_"),n=a[0],r=a[1]||"";return t.main_=n.split("_and_").filter((function(e){return e})),t.sub_=r.split("_and_").filter((function(e){return e})),t},processdeletedrules:function(e){for(var t=Object.keys(e),i=t.length,a=0;a<i;a++){var n=t[a],r=n;if(!(n.indexOf("zcanvas_")<0)){for(var o=this.splitstate(n),s=o.main_.length,l=o.sub_.length,d=!1,c=0;c<s;c++){this.deletedRule.contains(o.main_[c].replace("zcanvas_",""))&&(r=r.replace(o.main_[c],""),d=!0)}for(c=0;c<l;c++){this.deletedRule.contains(o.sub_[c].replace("zcanvas_",""))&&(r=r.replace(o.sub_[c],""),d=!0)}if(d){var u=this.splitstate(r),m="",p=u.main_.length,v=u.sub_.length;for(c=0;c<p;c++)m+=u.main_[c],p-1!==c&&(m+="_and_");if(v){m&&(m+="_child_");for(c=0;c<v;c++)m+=u.sub_[c],v-1!==c&&(m+="_and_")}if(u.hasmousestate){var f=r.slice(r.indexOf("_mousestate_"),r.length);m&&(m+=f)}m&&!e[m]&&(e[m]=zutils.zcopyobj2(e[n])),delete e[n]}}}},handledeletion:function(e){if(e&&e.ui&&this.deletedRule&&this.deletedRule.length){if(e.ui.value&&e.ui.value.style&&this.processdeletedrules(e.ui.value.style),e.ui.value&&e.ui.value.tabstyle&&this.processdeletedrules(e.ui.value.tabstyle),e.ui.field&&e.ui.field.style&&this.processdeletedrules(e.ui.field.style),e.ui.holder&&e.ui.holder.style&&this.processdeletedrules(e.ui.holder.style),e.ui.icon&&e.ui.icon.style&&this.processdeletedrules(e.ui.icon.style),e.ui.label&&e.ui.label.style&&this.processdeletedrules(e.ui.label.style),e.ui.value&&e.ui.value.layoutstyle&&this.processdeletedrules(e.ui.value.layoutstyle),e.ui.value&&e.ui.value.layoutstyle)for(var t=["container","editor"],i=t.length,a=0;a<i;a++)e.ui.value.layoutstyle[t[a]]&&this.processdeletedrules(e.ui.value.layoutstyle[t[a]]);if(e.ui.allfieldstabstyle)for(var n in e.ui.allfieldstabstyle){var r=e.ui.allfieldstabstyle[n];for(var o in r)if("titlesection"===o){this.handledeletion(r[o]);for(var s=r[o].children||[],l=s.length,d=0;d<l;d++)this.handledeletion(s[d])}else this.handledeletion({ui:r[o]})}if(e.ui.value&&e.ui.value.tablestyles)for(var c in e.ui.value.tablestyles)if("fields"===c){var u=e.ui.value.tablestyles[c];for(var a in u)this.handledeletion({ui:u[a]})}else if("rows"===c){var m=e.ui.value.tablestyles[c],p=m.length;for(a=0;a<p;a++)this.handledeletion({ui:m[a]})}else"table"===c&&this.handledeletion({ui:{value:e.ui.value.tablestyles[c]}})}},getTableStylescompression:function(e,t,i,a,n){var r=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var o in e)if("fields"===o){var s=e[o];for(var l in s)r.compressioncallback({ui:s[l]},t,i,a,n)}else if("rows"===o){var d=e[o],c=d.length;for(l=0;l<c;l++)r.compressioncallback({ui:d[l]},t,i,a,n)}else"table"===o&&r.compressioncallback({ui:{value:e[o]}},t,i,a,n)},getAllfieldStylecompression:function(e,t,i,a,n){var r=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var o in e)for(var s in e[o])if("titlesection"===s){r.compressioncallback(e[o][s],t,i,a,n);for(var l=e[o][s].children,d=l.length,c=0;c<d;c++)r.compressioncallback(l[c],t,i,a,n)}else r.compressioncallback({ui:e[o][s]},t,i,a,n)},compressioncallback:function(e,t,i,a,n){var r=["default","active","hover","focus"],o=Lyte.registeredMixins["crm-detailcanvas-utils"];if(e&&e.ui)for(var s in e.ui)if("allfieldstabstyle"===s&&(o.getAllfieldStylecompression(e.ui[s],t,i,a,n),o.splitAllFields(e)),"value"===s&&e.ui[s].tablestyles&&o.getTableStylescompression(e.ui[s].tablestyles,t,i,a,n),"value"===s&&e.ui[s].position&&"number"==typeof e.ui[s].position.current_index&&delete e.ui[s].position.current_index,e.ui[s]&&(e.ui[s].style||a)){var l=a||e.ui[s].style;e:for(var d in l){if(!(r.indexOf(d)>-1)){if(i){delete e.ui[s].style[d];continue e}if(n&&e.ui[s].style[d].$inherited)continue;if(!(d.startsWith("error")||d.startsWith("disabled")||d.startsWith("mandatory"))){var c="_mousestate_",u=d.indexOf(c);if(u>-1){var m=d.length,p=c.length;d=d.slice(u+p,m)}}var v=d.indexOf("child")>-1,f=[],_=[d];v&&(_=d.split("_child_"));for(var h=_.length,g=0;g<h;g++){var y=_[g];y.indexOf("and")>-1?f=f.concat(y.split("_and_")):f.push(y)}f.length||d&&d.indexOf("zcanvas")>-1&&f.push(d);var b=f.length;for(g=0;g<b;g++)t?t.push(f[g]):zutils.evalcriteria&&zutils.evalcriteria.push(f[g])}"holder"!==s&&"field"!==s||(e.ui[s].style[d]&&e.ui[s].style[d]._hide_?(e.ui.value.style[d]||(e.ui.value.style[d]={}),e.ui.value.style[d]._hide_="true"):e.ui[s].style[d]&&e.ui[s].style[d]._show_&&(e.ui.value.style[d]||(e.ui.value.style[d]={}),e.ui.value.style[d]._show_="true"))}}},colorPersistance:function(){if(Crm.canvasUsedColors){Crm.canvasUsedColors=$u.uniq(Crm.canvasUsedColors);var e=document.getElementById("zcanvascolorpicker");if(e){for(var t=e.getData("ltPropUsedColorsList"),i=t?t.length:0,a=Crm.canvasUsedColors.length-1,n=0;n<i;n++){var r=Crm.canvasUsedColors[a-n];r&&(t[n]=r)}e.setData("ltPropUsedColorsList",t)}delete Crm.canvasUsedColors}},FieldsFilterForCanvasRule:function(e){for(var t=[],i=["Data_Source"],a=e.length,n=0;n<a;n++){var r=e[n].module&&e[n].module[0]&&e[n].module[0].api_name;r=r&&moduleApiVsNameMapping[r],(i=this.isFromCanvasActivityEnabledModule(r)?this.isActivitySupportedField(e[n],r)?i:i.concat(e[n].api_name):i).indexOf(e[n].api_name)>-1||e[n].subform||17===e[n].show_type||"multi_module_lookup"===e[n].data_type||t.push(e[n])}return t},unregisterCanvasView:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var t in e.CanvasIdVsCanvasComp){var i=e.CanvasIdVsCanvasComp[t]?e.CanvasIdVsCanvasComp[t]:[];e.dropCompBasedOnCanvasID(i),e.CanvasIdVsCanvasComp[t]&&(e.CanvasIdVsCanvasComp[t]=[])}},dropCompBasedOnCanvasID:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];e.filter((function(e){Lyte.Component.registeredComponents[e]&&(Lyte.Component.unregisterComponent(e),delete t.CompVsRule[e])}))},canvasIDvsCompMapping:function(e){var t=Lyte.Router.getRouteInstance().getDynamicParam();if(t){var i=this.CanvasIdVsCanvasComp[t];i&&!i.includes(e)&&i.push(e)}},preProcessFieldValue:function(e,t,i){var a=i||e&&e[t.api_name];if(96===t.ui_type)a=null==a?[]:a.split(";");else if("multiselectpicklist"===t.data_type){if(!!Lyte.Router.getRouteInstance().getQueryParams().wizardId&&$L("crm-canvas-form").length)return a;a=void 0===a||""===a||null===a?[]:a.split("; ")}else if("multiuserlookup"===t.data_type)void 0===a&&((a={}).users=[]);else if(a&&"phone"===t.data_type&&"en_US"===Crm.userDetails.COUNTRY_LOCALE&&a.startsWith("(")&&a.includes(")"))a=a.replace(/[^a-zA-Z0-9]/g,"");else if(!a&&"picklist"===t.data_type&&"Stage"===t.api_name&&t.pick_list_values.length)a=t.pick_list_values[0].display_value,e[t.api_name]=a;else{if(Crm.userDetails.isSubformNewComponentEnabled&&t.subform&&-1===[116,117].indexOf(t.ui_type)&&null===a)return"";if(void 0===a)return""}return a},postProcessFieldValue:function(e,t,i){if(null!==e||33!==t.ui_type&&35!==t.ui_type||(e=""),void 0===e)return e;if(96===t.ui_type)e=e.length?e.join(";"):void 0;else{if("picklist"===t.data_type&&("-None-"===e||""===e))return;if("multiselectpicklist"===t.data_type)e=e.join("; ");else if("datetime"===t.data_type)e=this.getUserDateTimeFormatFromServerFormat(e);else if("multiuserlookup"===t.data_type){var a=store.peekRecord("field",t.id).multiuserlookup.connectedlookup_apiname,n=[];i[t.api_name]&&i[t.api_name].users.filter((function(e){n.push(e[a].id)}));var r=[],o={},s=[],l=e.length;if(l>0){for(var d=0;d<l;d++)o[a]=e[d],r.push(e[d].id),s.push(o),o={};(e={}).users=s}else e=void 0;n.length===r.length&&$u.intersection(n,r).length===n.length&&(e=i[t.api_name])}else 33===t.ui_type&&(e=(e=(e=(e=(e=e.replace(/[\u202c]/g,"")).replace(/[,](?!.)/,"")).replace(/\s{2,}/g," ")).replace(/\s-/g,"-")).replace(/-\s/g,"-"))}return"string"==typeof e&&(e=e.trim(),-1!==[1,11,27,127,62].indexOf(t.ui_type)&&(e=renderingUtils.removeMultiSpacestoSingleSpace(e))),e},getUserDateTimeFormatFromServerFormat:function(e){if(e&&"string"==typeof e&&e.match("T")){var t=(e=e.replace(/[+-]\d{2}:\d{2}/,"")).split("-"),i=new Date(t[0],t[1]-1,t[2].split("T")[0]),a=(e=e.split("T"))[1]?e[1].split(":"):"";a&&(i.setHours(a[0]),i.setMinutes(a[1]));var n=Utils.getDateTimeInUserFormat(i,!0),r=n.slice(0,3);return n.replace(r,I18n.getMsg(r))}return e},checkFieldVisiblityforLayoutRule:function(e,t){var i=!1;if(e.filter((function(e){store.peekRecord("field",e.showFldId).visible&&(i=!0)})),i)return!0;var a=Lyte.Router.getRouteInstance().currentModel.layoutId,n=store.peekRecord("layout",a);(n=n.sections.filter((function(e){return t.includes(e.name)}))).filter((function(e){e.fields.filter((function(e){store.peekRecord("field",e.id).visible&&(i=!0)}))}));var r=Lyte.registeredMixins["crm-detailcanvas-utils"],o=store.peekAll("field").filter((function(e){return r.revlayoutRuleSubformSections.includes(e.id)}));return store.peekAll("field").filter((function(e){return r.lRuleSubformSections.includes(e.id)})).length>0?i=!0:o.length>0&&(i=!1),!!i},setCustomLruleShowFields:function(e){var t=store.peekAll("layout_rule");if(t.length>0){var i=t.filter((function(e){return"custom"===e.generated_type}));i&&i.length>0&&i.forEach((function(t){t.queries&&t.queries.forEach((function(t){var i=t.actions;i&&i.length&&i.forEach((function(t){"Show_Fields"===t.type&&t.fields.forEach((function(t){e.customLruleFieldsArr.push(t.id)}))}))}))}))}},executeLayoutRuleforAjaxEdit:function(e,t){var i,a=Lyte.registeredMixins["crm-detailcanvas-utils"],n=t.data.isNewSubformUI,r=["Tasks","Calls","Events","Services__s","Appointments__s"];i="crm.tab.module.create.canvas"===Lyte.Router.getRouteInstance().transition.info.route?t.getData("moduleObj"):t.getData("moduleData"),n&&(i=t.getData("module_info"));var o=store.peekAll("layout_rule"),s=t.getData("layoutId");o.length>0&&o.forEach((function(a){if(a.layout&&(a.layout.id?a.layout.id:a.layout)===s){var n=i.fields.filter((function(e){return e.id===a.primary_field.id}))[0];n&&n.visible&&(r.indexOf(i.api_name)&&"default"===a.generated_type||n.view_type.edit)&&t.handleOneLayoutRule(t,a.queries,e)}})),a.handleFldSecVisiblityforLayoutRule(a),a.setCustomLruleShowFields(a),a.checkFieldVisiblityforLayoutRule(a.layoutRuleShowFld,a.layoutRuleShowSections)&&a.customLruleFieldsArr.length?!Crm.userDetails.CANVAS_SPECIAL_HANDLING_ORG&&$("#showFldPopup").removeClass("dNImp"):($("#showFldPopup").addClass("dNImp"),this.setData&&this.setData("showPopup",!1))},handleOneLayoutRule:function(e,t,i){var a=[];t&&t.forEach((function(t){t.actions&&t.actions.length>0&&a.push(t.actions),e.handleOneLayoutRuleQuery(e,t,i)}))},handleOneLayoutRuleQuery:function(e,t,i){var a=t.criteria;if(t.actions&&t.actions.length){var n=e.checkCriteriaMatch(a,i,void 0,void 0,e,void 0,void 0,void 0,!0);void 0===n&&(n=!1),e.triggerLayoutRuleActions(e,t,i,n)}},triggerLayoutRuleActions:function(e,t,i,a){t.actions&&t.actions.slice().reverse().forEach((function(t){switch(t.type){case"Mandatory_Fields":case"Show_Fields":t.fields&&t.fields.forEach((function(n){e.handleLayoutRuleActions(t.type,t,n,i,e,a)}));break;case"Show_Sections":t.sections&&t.sections.forEach((function(n){e.handleLayoutRuleActions(t.type,t,n,i,e,a)}));break;case"Show_Subforms":t.subforms&&t.subforms.forEach((function(n){e.handleLayoutRuleActions(t.type,t,n,i,e,a)}))}}))},handleLayoutRuleActions:function(e,t,i,a,n,r){var o,s=Lyte.registeredMixins["crm-detailcanvas-utils"],l=store.peekRecord("layout",n.getData("layoutId"));if(l=l.sections,"Show_Sections"===t.type){var d=l.filter((function(e){if(e.type&&"used"===e.type)return e.name===i}));o=d[0]}else"Show_Subforms"===t.type?l.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){e.api_name===i&&(o=e)}))})):l.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){if(e.id===i.id)return o=e,e}))}));if(o){var c=o;switch(e){case"Mandatory_Fields":var u,m=n.getData("recordLockingDetails"),p=m&&m.isLockedForMe&&m.restricted_actions&&m.restricted_actions.contains("update")&&!(m.fieldIds&&m.fieldIds.contains(o.id));if("First_Name"===o.api_name&&("Leads"===o.module[0].api_name||"Contacts"===o.module[0].api_name))break;if(p)break;u="userlookup"===o.data_type?!a[o.api_name]:this.checkComparator(a[o.api_name],"${EMPTY}","equal",a,o.api_name,void 0,void 0,void 0,this,!0);var v=8!==c.ui_type&&a&&a.$approval_state&&("approval_process_pending"===a.$approval_state||"approval_process_rejected"===a.$approval_state)&&a.$editable&&Lyte.registeredMixins.approvalprocess.restrictFieldsConfiguredInAPFromDetailView(c,a,n.getData("entityDetails"),c.id);r&&!s.LRuleManField.includes(c.id)&&u&&o.visible&&c.id!==s.blueprintFldId&&!v&&s.LRuleManField.push({targetFieldId:c.id}),r&&!s.LRuleManField.includes(c.id)&&c.id!==s.blueprintFldId&&s.revLRuleManField.push({targetFieldId:c.id});break;case"Show_Fields":if("First_Name"===o.api_name&&("Leads"===o.module[0].api_name||"Contacts"===o.module[0].api_name))break;var f=!!s.layoutRuleShowFld.filter((function(e){return e.showFldId===c.id})).length,_=s.revlayoutRuleShowFld.includes(c.id),h=s.revlayoutRuleShowSections.includes(o.section[0].name);h&&(r=!1),f||_?!r||f||h||s.suffleLRfields(s,c,!0):(r&&s.layoutRuleShowFld.push({showFldId:c.id}),r||s.revlayoutRuleShowFld.push(c.id));break;case"Show_Sections":var g=s.layoutRuleShowSections.includes(c.name),y=s.revlayoutRuleShowSections.includes(c.name);g||y?r&&!g&&s.suffleLRsections(s,c.name,!0):(r&&s.layoutRuleShowSections.push(c.name),r||s.revlayoutRuleShowSections.push(c.name));break;case"Show_Subforms":var b=!!s.layoutRuleSubformSections.filter((function(e){return e.subformId===c.id})).length,C=!1;if(r&&!b){s.layoutRuleSubformSections.push({subformId:c.id}),s.lRuleSubformSections.push(c.id);var L=s.revlayoutRuleSubformSections.indexOf(c.id);-1!==L&&s.revlayoutRuleSubformSections.splice(L,1),C=!0}var R=s.revlayoutRuleSubformSections.indexOf(c.id)>=0,w=s.lRuleSubformSections.indexOf(c.id)>=0;if(r||R||w||(s.revlayoutRuleSubformSections.push(c.id),C=!0),C){var x=$L("#"+c.id).closest(".zcanvassection");this.handlingShowOrhideFld(x,r)}}}},handlingShowOrhideFld:function(e,t){var i=e.length;if(i)for(var a=0;a<i;a++)t?e.removeClass("hide"):e.addClass("hide")},onlyABAPresent:function(e){var t=e.length;if(t){for(var i=0;i<t;i++){if("stop_saving_records"===e[i].alert_preference)return!1}return!0}return!1},executeValidationRuleforAjaxEdit:function(e,t,i,a,n,r,o){var s=t.data.layoutId,l=t.data.currentInstObjKey,d=[],c=t;if(Crm.userDetails.isSubformNewComponentEnabled&&"canvas"===Lyte.Router.getRouteInstance().routeName){var u=$L("crm-canvas-ajaxeditpopup")[0].component;c=u.data.subformComp?u.data.subformComp:c,u.setData("subformComp",void 0)}var m=c.data.isNewSubformUI,p=t.getData("moduleData.fields");m&&c.data.module_info&&(p=c.data.module_info.fields);var v=Lyte.registeredMixins["crm-detailcanvas-utils"];t.setData("vrPassed",!1);var f={},_=t.getData("valFeatureSpecinfo"),h={};store.peekAll("validation_rule").filter((function(e){if(e.layout){f[e.id]=[],h[e.id]=[],f[e.id].push(e.field.api_name),h[e.id].push(e.field.api_name);for(var t=e.conditions?e.conditions.length:0,i=0;i<t;i++)if(e.conditions[i].sub_conditions)for(var a=e.conditions[i].sub_conditions.length,n=0;n<a;n++)if(e.conditions[i].sub_conditions[n].criteria&&e.conditions[i].sub_conditions[n].criteria.field)f[e.id].push(e.conditions[i].sub_conditions[n].criteria.field.api_name);else if(Array.isArray(e.conditions[i].sub_conditions[n].criteria))for(var r=e.conditions[i].sub_conditions[n].criteria.length,o=0;o<r;o++)e.conditions[i].sub_conditions[n].criteria[o].field&&f[e.id].push(e.conditions[i].sub_conditions[n].criteria[o].field.api_name)}}));var g=Lyte.registeredMixins["crm-detailcanvas-utils"].blueprintFldId;g&&(g=store.peekRecord("field",g).api_name);var y=e.$.getDirtyAttributes();if(m&&n){var b=[];moduleRecordMapping[c.getData("module")].fields.forEach((function(e){e.subform&&b.push(e.api_name)})),b.length>0&&(y=y.filter((function(e){return-1===b.indexOf(e)})))}Crm.canvas&&Crm.canvas.stageStrip&&y.push("Stage"),r&&o&&store.peekAll("validation_rule").filter((function(e){if(e.id==o){var t=e.field.api_name;y.contains(t)||y.push(t)}}));var C=$L("crm-detailview-canvas")[0],L=C?C.getData("recordLockingDetails"):void 0,R=[];if(R=store.peekAll("validation_rule").filter((function(e){var i=!1;return!r&&Crm.userDetails.CVRFuncExecuteForAllFields&&"function"===e.validation_type&&(i=!0),g?e.layout&&e.layout.id===t.data.layoutId&&(i||f[e.id].intersection(y).length>0&&!h[e.id].contains(g)):(!e.layout||e.layout.id===t.data.layoutId)&&(i||f[e.id].intersection(y).length>0)})),r&&o&&(R=R.filter((function(e){return e.id==o}))),R){var w=0,x=R.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return s===t&&e.active&&(!0===e.active||"true"===e.active)&&"function"===e.validation_type})),I=R.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return s===t&&e.active&&(!0===e.active||"true"===e.active)&&"criteria"===e.validation_type}));if(I.length+x.length){var S=[],D=0;x.forEach((function(i){var a=i.field.api_name,n=p.filter((function(e){return e.id===i.field.id}))[0];n[l]&&n[l].errorDetails&&(n[l].errorDetails={}),n[l]&&n[l].aggerrorDetails&&(n[l].aggerrorDetails={});var r=L&&L.isLockedForMe&&L.restricted_actions&&L.restricted_actions.contains("update")&&!(L.fieldIds&&L.fieldIds.contains(n.id));if(n&&n.visible&&n.view_type.edit&&!r){++D;var o={};o.column_name=n.column_name,o.uitype=n.ui_type,void 0===e[a]||""===e[a]?o.value="":o.value=e[a]+"",o.api_name=n.api_name,o.field_label=n.field_label,o.id=i.associated_function.id,o._targetFieldid=n.id,o.record=t.filterValidUITypes(e,"edit",p),S.push(o)}}));var z=D+I.length;D&&(Crm.canvas&&Crm.canvas.stageStrip&&(Crm.canvas.stageValidFunc=!0),t.setData("vrFuncPassed",!0),store.triggerAction(e.$.model._name,"execute",{type:"POST",jsonData:S}).then((function(o){if(o&&o.functions&&t.handleVRFunctionResponse(t.getData("module"),o.functions,S,t,d,!1),z===(w+=D)){if(m)if(c.data.fromOldDetailView){Crm.VR=Crm.VR?Crm.VR:{},Crm.VR.entityDetails=Crm.VR.entityDetails?Crm.VR.entityDetails:{},Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson?objectUtils.cloneObject(returnJson.entityMapJson):returnJson.entityMapJson;var s=CVRExec.showValidationAlertOnErrorNew(c.getData("module"),o.functions,S,!0,n?c.data.subformField.column_name:c.data.currentEditedField.component.data.cxPropField.column_name);i(e,s)}else C.setData("ajaxEditFld",n?c.data.subformField:c.data.currentEditedField.component.data.cxPropField),a(e,d,void 0,void 0,void 0,c);else a(e,d);if(r||Crm.canvas&&(!Crm.canvas||Crm.canvas.stageStrip)){if(Crm.canvas&&Crm.canvas.stageData&&!(t.getData("vrPassed")||d.length>0)){$L("crm-stage-verify-popup")[0].component.sendStageChange(Crm.canvas.stageData)}}else{var l=v.onlyABAPresent(d);i(e,!(d.length>0||t.getData("vrPassed")),m?l:void 0)}}}),(function(){m?a(e,d,void 0,void 0,void 0,c):a(e,d)}))),I.forEach((function(o){var s,u;if(o.field){s=o.field.api_name,u=o.field.id;var f=p.filter((function(e){return e.id===u}))[0];delete f[l].isSecVal,f[l]&&f[l].errorDetails&&(f[l].errorDetails={}),f[l]&&f[l].aggerrorDetails&&(f[l].aggerrorDetails={});var h=L&&L.isLockedForMe&&L.restricted_actions&&L.restricted_actions.contains("update")&&!(L.fieldIds&&L.fieldIds.contains(f.id)),g=m&&f&&!f.view_type.view&&c.data.fromOldDetailView,b=store.peekRecord("field",u);!(b&&m&&c.isInventoryModule()&&["DISCOUNT","TAX"].indexOf(b.column_name)>-1&&c.data.currentEditedField.component.data.cxPropField.id!==u)&&!g&&f.visible&&f.view_type.edit&&o.conditions&&!h&&o.conditions.forEach((function(i){f[l].isSecVal||t.handleValidationRuleCondition(i,s,o.execution_type,t,e,u,d,!1,y,_)}))}if(++w,z===w)if(r&&d.length>0&&t.setData("vrPassed",!0),m?(c.data.fromOldDetailView||c.data.isLyteDVRender||C.setData("ajaxEditFld",n?c.data.subformField:c.data.currentEditedField.component.data.cxPropField),a(e,d,void 0,void 0,void 0,c)):a(e,d),r||Crm.canvas&&(!Crm.canvas||Crm.canvas.stageStrip)){if(Crm.canvas&&Crm.canvas.stageData&&!(t.getData("vrPassed")||d.length>0)){$L("crm-stage-verify-popup")[0].component.sendStageChange(Crm.canvas.stageData)}}else{var R=v.onlyABAPresent(d);i(e,!(d.length>0||t.getData("vrPassed")),m?R:void 0)}})),r||0!==D||0!==I.length||i(e,!(d.length>0||t.getData("vrPassed")))}else r||Crm.canvas&&(!Crm.canvas||Crm.canvas.stageStrip)||i(e,!(d.length>0||t.getData("vrPassed")))}},alertPrefGenerateObject:function(e,t,i,a,n,r,o){var s={},l=[];if(t.forEach((function(e){var t=[],a=i?i.getData("cxPropField"):i;if(a&&a.id===e.targetFieldId)e.targetField=i;else{var n=store.peekRecord("field",e.targetFieldId),r=$L(".fieldupdate_"+n.column_name)[0];if(r){var o=$L("#CanvasAjaxEdit_"+n.id)[0];r=o?o.children[0].component:r.component}else r=(r=$L("#CanvasAjaxEdit_"+n.id)[0])?r.children[0].component:{};e.targetField=r}"on_primary_field"===e.alert_preference&&e.targetField.setData("cxPropErrorMessage"," "),Lyte.arrayUtils(t,"push",e),s&&s.hasOwnProperty(e.targetFieldId)?(t=s[e.targetFieldId],Lyte.arrayUtils(t,"push",e),s[e.targetFieldId]=t):(Lyte.arrayUtils(l,"push",e.targetFieldId),Lyte.objectUtils(s,"add",e.targetFieldId,t))})),Lyte.objectUtils(s,"add","isFromCanvas",!0),!a)return s;Lyte.Component.render("crm-validation-alert",{alertDetails:s,fieldIds:l,module:n,recordData:e,isCanvasStage:r,isNewSubformUI:o,isVRError:!0},".bodycontainer")},HandlindValidationRuleErrorforAjaxEdit:function(e,t,i,a,n,r){if(!r){var o=Lyte.registeredMixins["crm-detailcanvas-utils"];r=o.subformComp,o.subformComp=void 0}var s=r&&r.data.isNewSubformUI,l=Crm.userDetails.ValidationAlertPreference,d=[],c=[],u=$L("crm-validation-alert")[0];u&&u.component&&(u.component.executeMethod("emptyErrorData"),u.remove());var m=$L("crm-validation-rule-error")[0];if(m&&m.remove(),Crm.canvas&&Crm.canvas.stageStrip&&t.length>0&&!Crm.canvas.isVR_Subcondition){Crm.canvas.stageValidation=!0;var p={};return p[t[0].targetField]=t[0].message,$("#newRelatedListPopUpDiv").removeClass("w860").css("width","30%").html(Handlebars.templates.validationRuleError(p)),crmui.showPopup("newRelatedListPopUpDiv"),e.$.getDirtyAttributes().includes("Stage")&&e.$.rollBack(),Crm.canvas&&Crm.canvas.isAdvancedStepClick&&(Crm.canvas={}),!1}if(Crm.canvas&&Crm.canvas.stageStrip&&!Crm.canvas.isVR_Subcondition)return!1;Crm.canvas&&Crm.canvas.stageStrip&&Crm.canvas.isVR_Subcondition&&(Crm.canvas.stageValidation=Crm.canvas&&Crm.canvas.isVR_Subcondition&&t.length>0);var v=$L("#AjaxEditFieldId")[0];s&&(v=r.data.currentEditedField);var f=$L("#changeOwnerPopUp"),_=(o=Lyte.registeredMixins["crm-detailcanvas-utils"],f.length>0?f[0].component.data.fieldIdFol:v?s?v.component.data.cxPropField.id:v.value:void 0);if(!_){var h=moduleRecordMapping.Potentials.fields.filterBy({api_name:"Stage"})[0];_=h.id}var g=s&&"detail"===Lyte.Router.getRouteInstance().routeName?void 0:n?$L("crm-stage-verify-popup")[0].component:$L("crm-canvas-ajaxeditpopup")[0].component;g&&g.getData("valErrorObject")&&g.setData("valErrorObject",null);var y,b=s?$L(v):$L("#AjaxEditComponent"),C=[],L=!1;if(b=b[0],s&&(y=r.isInventoryModule()&&["DISCOUNT","TAX"].indexOf(v.component.data.cxPropField.column_name)>-1),t.length>0&&(t=t.filter((function(e){return!l||"allow_by_alert"!==e.alert_type||(d.push(e),!1)}))),t.length>0)if((s&&(!g||!0!==g.getData("showAjaxPop"))||g&&!0!==g.getData("showAjaxPop"))&&(t=t.filter((function(e){if(_===e.targetFieldId&&b)if(b=s?b.component?b.component:b:b.children?b.children[0].component:b,"layoutRule"!==i){var t=$ESAPI.encoder().encodeForHTMLAttribute(e.message);if(y)crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),4e3),r.data.originalRecord.$.rollBack();else{if(l&&"on_primary_field"===e.alert_preference)return L=!0,(b.children?b.children[0].component:b).setData("cxPropErrorMessage"," "),CVRExec.showAlertPrefMsg(t,b,module,!1,!1,!1,!1,!1,void 0,void 0,!0),!1;if(l&&"top_of_page"===e.alert_preference)return L=!0,Lyte.arrayUtils(C,"push",e.message),!1;l||(b=b.children?b.children[0].component:b).setData("cxPropErrorMessage",t)}}else(b=b.children?b.children[0].component:b).getData("cxPropField").required=!0,b.validate();return _!==e.targetFieldId}))),C.length>0&&CVRExec.showAlertTopMsg(C),(!y||"layoutRule"===i)&&t.length>0&&"canvas"===Lyte.Router.getRouteInstance().routeName){var R=[];t=t.filter((function(e){return R.includes(e.targetFieldId)||R.push(e.targetFieldId),"top_of_page"===e.alert_preference?(c.push(e.message),!0):(e.errMsg=!0,!0)}));var w=n?g.getData("errorFieldsInfo"):g.getData("errorRecord"),x=[];w.filter((function(e,i){x.includes(e.targetFieldId)||(x.push(e.targetFieldId),R.includes(e.targetFieldId)?t.filter((function(t){if(!Customization.fromFocusout&&t.targetFieldId===e.targetFieldId)return w[i].message&&(w[i].message=t.message),t.fldObj=store.peekRecord("field",t.targetFieldId),void Lyte.arrayUtils(w,"replaceAt",i,t)})):e.errMsg=!1)}));var I=R.intersection(x),S=[],D=[];if(t.filter((function(e){I.includes(e.targetFieldId)||(S.length>0&&S.includes(e.targetFieldId)?e.avail=!0:e.avail=!1,D.push(e),I.push(e.targetFieldId)),S.push(e.targetFieldId)})),(D=D.filter((function(e){return e.fldObj=store.peekRecord("field",e.targetFieldId),e.fldObj.visible}))).length>0){var z=D.length;for(let e=0;e<z;e++)D[e].isfol||!D[e].fldObj.read_only&&!D[e].fldObj.field_read_only||(D.splice(e,1),e--,z--);n?Lyte.arrayUtils(g.getData("errorFieldsInfo"),"concat",D):Lyte.arrayUtils(g.getData("errorRecord"),"concat",D)}n||g.setData("showAjaxPop",!0),g.setData("valAlertPref",l),s&&g.setData("subformComp",r),window.CScriptLib&&a&&CScript.Engine.Global.dispatchEvent("onMandatoryFormLoad",null,{apiname:a.api_name,value:e[a.api_name]})}else(!y||"layoutRule"===i)&&s&&t.length>0&&"detail"===Lyte.Router.getRouteInstance().routeName?CVRExec.evalRules("view",r.getData("module"),v.component.data.cxPropField.column_name,!0,!1):s&&r.setData("currentEditedField",void 0);else s&&r.setData("currentEditedField",void 0);if(l&&"layoutRule"!==i&&t.length>0){L=!0;var M=b&&b.children?b.children[0].component:b;g.setData("valErrorObject",o.alertPrefGenerateObject(e,t,M,!1))}if(c.length>0&&(L=!0,Lyte.Component.render("crm-validation-alert",{alertTOPMsg:c,alertTOPBool:!0,isDetReq:!0,popoverDirection:"bottomLeft"},".topMsgError")),l&&"layoutRule"!==i&&!L&&d.length>0){M=s?b:b?b=b.children?b.children[0].component:b:b;o.alertPrefGenerateObject(e,d,M,!0,g?g.getData("moduleData").module_name:r.getData("module"),void 0,s)}},layoutRuleFocusOutHandling:function(e){var t,i=Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck(),a=i?$("crm-canvas-form")[0].component:$("crm-detailview-canvas")[0].component,n=e?$("crm-stage-verify-popup")[0].component:$("crm-canvas-ajaxeditpopup")[0].component,r=i?Lyte.registeredMixins["crm-canvas-view-rules"]:Lyte.registeredMixins["crm-detailcanvas-utils"],o=n.getData("originalRecord"),s=e?n.getData("errorFieldsInfo"):n.getData("errorRecord");if(r.removeFocusForFld(),s.filter((function(e){var t=getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0],i=store.peekRecord("field",e.targetFieldId),a=t.component.data.cxPropValue,n=i.canvasDependencyMap,r=n?n.length:0;if(r>0){for(var o=!1,s=0;s<r;s++)if(n[s].display_value==a){o=!0;break}o||(a=n[0].display_value)}Lyte.registeredMixins["crm-detailcanvas-utils"].getCanvasDependency(i.layouts[0].id,a,i,i.module[0].api_name)})),s.filter((function(e){var i=getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0];i.setData("cxPropErrorMessage","");var a,n,r=store.peekRecord("field",e.targetFieldId);try{a=i.component.getValue()}catch(e){n=!0}"string"==typeof i.component.data.cxPropValue&&(i.component.data.cxPropValue=i.component.data.cxPropValue.trim()),(a&&a.toString().length>0||n)&&!i.component.validate()&&("lookup"!==r.data_type||0===$L("#inputId",i)[0].value.length||i.getData("cxPropValue")||(i.setData("cxPropErrorMessage","custom_error"),i.setData("isError",!0),t=!0))})),t)return r.setFocusForFld(),!1;s.filter((function(e){var t=store.peekRecord("field",e.targetFieldId),i=getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0],a=t.canvasDependencyMap,n=a?a.length:0,s=i.component.data.cxPropValue;if(n>0){for(var l=!1,d=0;d<n;d++)if(a[d].display_value==s){l=!0;break}l||i.component.setData("cxPropValue",a[0].display_value),i.component.setData("cxPropPicklistValues",a)}var c=i.component.getValue();c=r.postProcessFieldValue(c,t,o),Lyte.Component.set(o,t.api_name,c)})),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(n.getData("moduleData").module_name))&&(r.LRuleManField=[],r.revLRuleManField=[],r.executeLayoutRuleforAjaxEdit(o,a),r.LRuleManField.length>0&&(r.subformComp||(r.subformComp=n.data.subformComp),r.HandlindValidationRuleErrorforAjaxEdit(o,r.LRuleManField,"layoutRule",void 0,e)),s.filter((function(e){var t=getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0];if(r.LRuleManField.includes(e.targetFieldId)||r.revLRuleManField.filter((function(t){return t.targetFieldId===e.targetFieldId})).length>0)(i=t.component.getData("cxPropField")).required=!0,t.component.setData("cxPropField",{}),t.component.setData("cxPropField",i);else if(!store.peekRecord("field",e.targetFieldId).required){var i;(i=t.component.getData("cxPropField")).required=!1,t.component.setData("cxPropField",{}),t.component.setData("cxPropField",i)}})),r.setFocusForFld())},removeFocusForFld:function(){$("crm-canvas-ajaxeditpopup")[0].component.getData("errorRecord").filter((function(e){getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0].removeAttribute("onfocusout")}))},setFocusForFld:function(){$("crm-canvas-ajaxeditpopup")[0].component.getData("errorRecord").filter((function(e){var t=getElemById("CanvasAjaxEdit_"+e.targetFieldId).children[0];["text","textarea","email","phone","integer","currency","bigint","double","website"].includes(t.component.data.cxPropField.data_type)&&t.setAttribute("onfocusout","Customization.layoutRuleFocusOutHandling()")}))},canvasDependencyfieldHandling:function(e,t,i){for(var a,n,r,o,s,l,d=(store.peekRecord("layout",e)&&store.peekRecord("layout",e).fields?store.peekRecord("layout",e).fields:[]).filter((function(t){return"picklist"===t.data_type&&t[e].pick_list_values&&t[e].pick_list_values[0].maps.length>0})),c=d.length,u=0;u<c;u++){n=d[u],a=t?void 0===t[n.api_name]?"-None-":t[n.api_name]:"-None-",o=(r=n[e].pick_list_values).length;for(var m=0;m<o;m++)if(r[m].display_value===a){l=r[m].maps.length;for(var p=0;p<l;p++)if((s=this.getFieldByFieldApiNameandModuleApiName(r[m].maps[p].api_name,i))[0]){var v=s[0][e]&&s[0][e].pick_list_values?s[0][e].pick_list_values:s[0].pick_list_values;s[0].canvasDependencyMap=this.getPicklistSortFromMapDependency(v,r[m].maps[p].pick_list_values)}}}},getCanvasDependency:function(e,t,i,a){for(var n,r,o=i[e].pick_list_values,s=o?o.length:0,l=0;l<s;l++)if(o[l].display_value===t){n=o[l].maps.length;for(var d=0;d<n;d++)if((r=this.getFieldByFieldApiNameandModuleApiName(o[l].maps[d].api_name,a))[0]){var c=r[0][e]&&r[0][e].pick_list_values?r[0][e].pick_list_values:r[0].pick_list_values;r[0].canvasDependencyMap=this.getPicklistSortFromMapDependency(c,o[l].maps[d].pick_list_values)}}},getPicklistSortFromMapDependency:function(e,t){var i=[];return e.forEach((function(e){t.forEach((function(t){t.display_value===e.display_value&&i.push(e)}))})),i},getFieldByFieldApiNameandModuleApiName:function(e,t){return store.peekAll("field").filter((function(i){return i.api_name===e&&i.module&&i.module[0].api_name===t}))},validatingCanvasRule:function(e,t){for(var i=store.peekAll("canvas_rule").filter((function(t){return t.module.api_name===e})),a=Lyte.registeredMixins["crm-create-mixin"],n=i.length,r=[],o=[],s=0;s<n;s++)a.checkCriteriaMatchForCanvas(i[s].criteria,t,a)?o.push(i[s].zcid):r.push(i[s].zcid);o.push("zcanvas_zcdefaultcontd");var l,d=$("crm-detailview-canvas");if((this.isFormViewCommonCheck()||this.isWizardView())&&(d=$("crm-canvas-form")),zutils.canvasRuleAffectingLayouts&&zutils.canvasRuleAffectingLayouts.length>0){for(rule of r)if(zutils.canvasRuleAffectingLayouts.indexOf(rule)>-1&&d.hasClass(rule)){l=!0;break}for(rule of o)if(zutils.canvasRuleAffectingLayouts.indexOf(rule)>-1&&!d.hasClass(rule)){l=!0;break}}d.attr("class",""),d.removeClass(r.join(" ")).addClass(o.join(" ")),this.expandcombinedcriteria(d);for(var c=$L("crm-related-list-canvas"),u=c.length,m=d.attr("class"),p=0;p<u;p++)c[p].component.setData("mainmodulerule",m);Lyte.registeredMixins["crm-formview-mixin"]&&Crm.userDetails.CANVAS_TABINDEX_ENABLE&&$L(".zc-tabindex-configured").length&&l&&Lyte.registeredMixins["crm-formview-mixin"].setTabIndexForCanvasFormFields()},getDuplicateErrorMsg:function(e){var t=Crm.userDetails.MODULE_LIST[objectUtils.getMatchedKey(moduleApiMapping,e.duplicate_record.module.api_name)],i=t.singular_label,a=store.peekAll("field").filter((function(t){return t.api_name===e.api_name}))[0].field_label,n=e.duplicate_record.id,r=I18n.getMsg("crm.duplicate.value.not.allowed"),o="viewExistingRecordQuickInfo"+e.api_name;if(!1===e.more_records){r+=" "+I18n.getMsg("crm.duplicate.value.available",[i.toLowerCase(),a]),r=$ESAPI.encoder().encodeForHTML(r);var s=Crm.getCrmBasePath()+"/EntityInfo.do?module="+t.module_name+"&id="+n;s=networkUtils.getPortalURL(s),r+=" <a data-zcqa='viewExistingRecord' class='viewExistingRecordQuickInfo' id='"+o+'\' onmouseleave="Crm.dontHideQuickInfoPop(event);" onmouseenter="Customization.canvasDvRecordPopup(\''+t.module_name+"','"+n+"','"+e.duplicate_record.Owner.zuid+"',this,'"+e.api_name+"')\" rel='noopener noreferrer' target='_blank' href='"+s+"'>"+I18n.getMsg("crm.view.record",I18n.getMsg(i))+"</a>"}else r+=" "+I18n.getMsg("crm.duplicate.value.available.multiple",[i.toLowerCase(),a]),r=$ESAPI.encoder().encodeForHTML(r),r+=' <link-to lt-prop-target="_blank" lt-prop-route="crm.tab.module.entity.find-and-merge" lt-prop-qp=\'{"findDupFldName" :"'+$ESAPI.encoder().encodeForHTML(a)+"\"}'    lt-prop-dp='[\""+t.module_name+'","'+n+"\"]'>"+I18n.getMsg("crm.label.module.merge",I18n.getMsg($ESAPI.encoder().encodeForHTML(t.plural_label)))+"</link-to>";return r},executingLayoutRule:function(e,t){var i=$L(e)[0],a=Lyte.registeredMixins["crm-detailcanvas-utils"],n=e&&e[0]?e[0].component.data.fieldarray:[];if(n.length>0)n.intersection(a.revlayoutRuleShowFld).filter((function(e){var t=store.peekRecord("field",e),n=$L(i).find(".fieldupdate_"+t.column_name).closest(".zcanvas-field ");a.handlingShowOrhideFld(n,!1)}));else if(a.revlayoutRuleShowFld.contains(t)){var r=store.peekRecord("field",t),o=$L(i).find(".fieldupdate_"+r.column_name).closest(".zcanvas-field ");a.handlingShowOrhideFld(o,!1)}var s=$L("crm-detailview-canvas")[0],l=a.isSandboxDiffPage,d=a.isProdDiffPage;if((l||d)&&(s=l?$L("#sandboxObj_sandboxChanges crm-detailview-canvas")[0]:d?$L("#parentObj_sandboxChanges crm-detailview-canvas")[0]:void 0),s){var c=s.component.data.layoutId,u=store.peekRecord("layout",c);u.sections.filter((function(e){return a.revlayoutRuleShowSections.includes(e.name)})).filter((function(e){e.fields.filter((function(e){var t=store.peekRecord("field",e.id);if(u&&u.module&&"Calls"===u.module.api_name&&"DESCRIPTION"===t.column_name&&(a.layoutRuleShowSections.indexOf("Reason For Incoming Call")>=0||a.layoutRuleShowSections.indexOf("Outcome Of Outgoing Call")>=0))return!1;var i=$L(".fieldupdate_"+t.column_name).closest(".zcanvas-field ");a.handlingShowOrhideFld(i,!1)}))}))}},executeLRsubform:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"],t=store.peekAll("field").filter((function(t){return e.revlayoutRuleSubformSections.includes(t.id)}));store.peekAll("field").filter((function(t){return e.lRuleSubformSections.includes(t.id)})).filter((function(t){var i=$L("#"+t.id).closest(".zcanvassection");e.handlingShowOrhideFld(i,!0)})),t.filter((function(t){var i=$L("#"+t.id).closest(".zcanvassection");e.handlingShowOrhideFld(i,!1)}))},executeLRSections:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"],t=$L("crm-detailview-canvas")[0];if(t){var i=store.peekRecord("layout",t.component.data.layoutId),a=(i=i.sections).filter((function(t){if(t.type&&"used"===t.type)return e.revlayoutRuleShowSections.includes(t.name)}));i.filter((function(t){if(t.type&&"used"===t.type)return e.layoutRuleShowSections.includes(t.name)})).filter((function(t){var i=$L(".zc-fieldsectionallfield.section-"+t.uid);e.handlingShowOrhideFld(i,!0)})),a.filter((function(t){var i=$L(".zc-fieldsectionallfield.section-"+t.uid);e.handlingShowOrhideFld(i,!1)}))}},executelayoutRuleforCurrentRec:function(){var e=$L("crm-detailview-canvas")[0];if(e){e=e.component;var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.LRuleManField=[],t.layoutRuleShowFld=[],t.layoutRuleShowSections=[],t.layoutRuleSubformSections=[],t.revlayoutRuleShowFld=[],t.revlayoutRuleShowSections=[],t.revlayoutRuleSubformSections=[],t.revLRuleManField=[],t.lRuleSubformSections=[],t.executeLayoutRuleforAjaxEdit(e.getData("originalRecord"),e)}},tabOnNavigation:function(e,t){var i=e.closest(".zctablayout");i=i.length?i:e.closest(".zctabview");var a=e.children(".zc-tabs");a.length&&$L.fastdom.measure((function(){var e=t||parseInt(a[0].scrollLeft),n=t||parseInt(a[0].scrollTop),r=parseInt(a[0].scrollWidth),o=parseInt(a[0].offsetWidth),s=parseInt(a[0].scrollHeight),l=parseInt(a[0].offsetHeight),d=i.hasClass("zcanvas-vertical-left")||i.hasClass("zcanvas-vertical-right")?n<=0:e<=0,c=i.hasClass("zcanvas-vertical-left")||i.hasClass("zcanvas-vertical-right")?n+l+2>=s:e+o+2>=r;$L.fastdom.mutate((function(){var e=a.closest(".zc-tablist-container"),t=e.children(".zc-tabs-nav");e.children(".zcnavleft")[d?"addClass":"removeClass"]("zc-disabled-tool"),t.find(".zcnavleft")[d?"addClass":"removeClass"]("zc-disabled-tool"),e.children(".zcnavright")[c?"addClass":"removeClass"]("zc-disabled-tool"),t.find(".zcnavright")[c?"addClass":"removeClass"]("zc-disabled-tool")}))}))},removePicklistprops:function(e,t){var i=store.peekRecord("field",e.id),a=["color","background-color","border","border-top","border-bottom","border-left","bottom-right","padding","padding-top","padding-bottom","padding-left","padding-right","border-radius","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"],n=a.length,r=!t||"row"!==t.type;if(i&&i.enable_colour_code&&e.ui&&e.ui.field&&r){var o=e.ui.field.style;for(var s in o)for(var l=0;l<n;l++)delete o[s][a[l]]}},handleStageInTabLayout:function(){for(var e=$L(".zctabview"),t=e.length,i=Lyte.Router.getRouteInstance().currentModel,a=0;a<t;a++)for(var n=e[a].getElementsByTagName("LI"),r=n.length,o=0;o<r;o++)if(n[o].textContent===I18n.getMsg("Stage")||n[o].textContent===I18n.getMsg("crm.label.cf.blueprint"))if(i.record.$process_flow){var s=Lyte.registeredMixins["crm-detailcanvas-utils"],l=s.showStage,d=s.isBluePrintTrans;(l||d)&&d&&!clientPortalName?n[o].textContent=I18n.getMsg("crm.label.cf.blueprint"):n[o].textContent=I18n.getMsg("Stage")}else n[o].textContent=I18n.getMsg("Stage")},fieldInvolvedInZia:function(e,t){for(var i=!1,a=e.$zia_visions.length,n=0;n<a;n++)t===e.$zia_visions[n].field.id&&(i=!0);return i},sectionfieldmappingformobile:function(e){var t={zcanvasId:"#zcanvas_us58qoeplr",type:"component",ui:{value:{position:{start_x:30,start_y:52,end_x:1278,width:"calc(100% - 60px)",height:480,min_top:5},style:{},class:"zclayout-table zcrestricttable zcnochange",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]};t.zcanvasId=zutils.getRandomId();for(var i=e.length,a=0;a<i;a++){var n={type:"row",ui:{value:{position:{start_x:0,start_y:5,end_x:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},r={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",type:"field",ui:{value:{style:{},position:{start_x:0,start_y:0,end_x:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]};r.zcanvasId=zutils.getRandomId(),n.children.push(r),t.children.push(n)}return t.ui.value.position.height=150,t},sectionfieldmapping:function(e){var t={zcanvasId:"#zcanvas_us58qoeplr",type:"component",ui:{value:{position:{start_x:30,start_y:52,end_x:1278,width:"calc(100% - 60px)",height:480,min_top:5},style:{},class:"zclayout-table zcrestricttable zcnochange",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]};t.zcanvasId=zutils.getRandomId();for(var i=Math.round(e.length/2),a=0,n=0;n<i;n++){var r={type:"row",ui:{value:{position:{start_x:0,start_y:5,end_x:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},o={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",type:"field",ui:{value:{style:{},position:{start_x:0,start_y:0,end_x:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]};if(o.zcanvasId=zutils.getRandomId(),r.children.push(o),2*(n+1)<=e.length){var s={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",type:"field",ui:{value:{style:{},position:{start_x:0,start_y:0,end_x:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]};s.zcanvasId=zutils.getRandomId(),r.children.push(s)}else{r.children.push({ui:{value:{class:"zc-table-cell"}},children:[],type:"empty-field"})}t.children.push(r),a+=50}return t.ui.value.position.height=a,t},getVisibleFields:function(e,t){for(var i=[],a=e.length,n=0;n<a;n++){var r=e[n];createStruture.singleshotrender&&(r=store.peekRecord("field",r.id)),r&&("Sales_Cycle_Duration"!==r.api_name&&"Lead_Conversion_Time"!==r.api_name&&"Overall_Sales_Duration"!==r.api_name&&"Data_Processing_Basis_Details"!==r.api_name&&"Unsubscribed_Mode"!==r.api_name&&"Unsubscribed_Time"!==r.api_name&&"Enrich_Status__s"!==r.api_name&&"Last_Enriched_Time__s"!==r.api_name&&"Change_Log_Time__s"!==r.api_name&&"Converted_Deal"!==r.api_name&&"Converted_Account"!==r.api_name&&"Converted_Contact"!==r.api_name&&Lyte.registeredMixins["crm-detailcanvas-utils"].isActivitySupportedField(r,t)&&!1!==r.visible&&!0!==r.hidden&&i.push(r))}return i},sectionview:function(e,t,i){var a,n="MobileDetailView"===i.feature,r=this.getVisibleFields(t,i.module);a=n?this.sectionfieldmappingformobile(r):this.sectionfieldmapping(r);for(var o=r.map((function(e){return e.id})),s=this.processRelListObj(a,i.record,i.module,o,void 0,void 0,!0),l=s.children,d=l.length,c=e.ui.value.tablestyles?e.ui.value.tablestyles:{},u=c.rows||[],m=c.fields||{},p=e.ui.value.tablestyles&&e.ui.value.tablestyles.table&&!$u.isEmpty(e.ui.value.tablestyles.table)?e.ui.value.tablestyles.table:a.ui.value,v=p.position&&p.position.width,f=0;f<d;f++){var _=u[f];_&&(l[f].ui.value.style=_.value.style,l[f].ui.value.system_id=_.value.system_id,this.handledeletion(l[f]));for(var h=(t=l[f].children).length,g=0;g<h;g++){var y=t[g].id;if(m[y]?(t[g].ui=m[y],this.handledeletion(t[g])):t[g].ui=m.commonfield?objectUtils.cloneObject_new(m.commonfield):JSON.parse('{"value":{"style":{},"position":{"start_x":0,"start_y":0,"end_x":625,"width":625,"height":50},"tagname":"DIV","class":"zcanvas-field"},"holder":{"style":{},"tagname":"SPAN","class":""},"field":{"style":{},"tagname":"SPAN","class":""},"label":{"style":{},"tagname":"SPAN","class":""}}'),y){var b=r[r.map((function(e){return e.id})).indexOf(y)];createStruture.singleshotrender||this.addAjaxEditDetails(b,l[f],t[g])}}var C={ui:{value:{style:{default:{flex_direction:"column",display:"flex",margin_right:"0%"}},position:{end_x:1644,depth:1,width:1646,start_y:0,start_x:0,height:50}}},children:[],type:"dummyDiv"},L={ui:{value:{style:{default:{flex_direction:"column",display:"flex",margin_right:"0%"}},position:{end_x:1646,single_cell_width:"",width:1646,start_y:0,start_x:0,height:50},class:["row"]}},children:[{ui:{value:{style:{default:{}},position:{end_x:1644,depth:1,width:1646,start_y:0,start_x:0,height:50}}},children:[],type:"dummyDiv"}],type:"dummyDiv",div_type:"row"};L.children[0].children=[objectUtils.cloneObject(l[f])],C.children=[L],v&&(C.ui.value.position.width=v,C.ui.value.position.end_x=v,L.ui.value.position.width=v,L.ui.value.position.end_x=v,L.children[0].ui.value.position.width=v,L.children[0].ui.value.position.end_x=v),l[f]=C}(C={ui:{value:{style:{default:{"flex-direction":"column",display:"flex","margin-right":"0%"}},position:{end_x:1644,depth:1,width:1646,start_y:0,start_x:0,height:50}}},children:[],type:"dummyDiv"}).children=s.children,a.children=[C],v&&(C.ui.value.position.width=v,C.ui.value.position.end_x=v);var R=zclayout.prototype.layouts["Table Layout"],w=document.createElement("div");return $L(w).attr("id",zutils.getRandomId()).css({"min-height":a.ui.value.position.height,height:"auto"}),w.classList.add("zclayout-table"),a.ui.value.layoutstyle=e.ui.value.tablestyles&&e.ui.value.tablestyles.layoutstyles?e.ui.value.tablestyles.layoutstyles:a.ui.value.layoutstyle,a.ui.value=p,p&&p.style&&Lyte.registeredMixins["crm-detailcanvas-utils"].handleDynamicSectionVisibility(a,p.style),this.handledeletion(a),(w=R.toView(a,w))&&a.ui.value&&a.ui.value.system_id&&$L(w).addClass("canvasselectableelemnt canvas-element-id-"+a.ui.value.system_id),w},getEmptyNodeFromTree:function(e){return e.children.length?this.getEmptyNodeFromTree(e.children[0]):e},handleDynamicSectionVisibility:function(e,t){if(e&&e.ui&&e.ui.value&&e.ui.value.style&&t)for(var i in t){var a=t[i];e.ui.value.style[i]||(e.ui.value.style[i]={}),"true"===a._hide_?e.ui.value.style[i].display="none":"true"===a._show_&&(e.ui.value.style[i].display="flex")}},allFieldFormation:function(e){if(e.children.length&&!e.ui.allfieldstabstyle&&(e=this.extractInfoFromSection_View(e)).children&&e.children.length)return e;var t,i=$L("crm-detailview-canvas-gallery")[0],a=i&&i.component.getData("feature"),n="MobileDetailView"===a?32:60,r="MobileDetailView"===a?0:30;t=i&&i.component.getData("isGalleryVisible")?'{"ui":{"value":{ "class" : "zc-list-component" , "position" : {"min_top" : "30","min_left":"30","width" : '+(e.ui.value.position.width-n)+'} , "style": {"default" : {"overflow":"auto" , "padding_left":'+r+' , "padding_top":'+r+' } } }},"type":"component","theme":"Custom Layout","related_list":true,"children":[{},{"type":"relatedlist","ui":{"value":{"position": {}}},"id":"","theme":"LazyLoad Component","lazyload":true,"children":[]}]}':'{"ui":{"value":{ "class" : "zc-list-component zc-fieldsectionallfield" , "position" : {"min_top" : "30","min_left":"30","width" : '+(e.ui.value.position.width-60)+'} , "style": {"default" : {"overflow":"auto" , "padding_left":"30px" , "padding_top":"30px"} } }},"type":"component","theme":"Custom Layout","related_list":true,"children":[{},{"type":"relatedlist","ui":{"value":{"position": {}}},"id":"","theme":"LazyLoad Component","lazyload":true,"children":[]}]}';var o=JSON.parse('{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex"}},"position":{"end_x":1629,"single_cell_width":"","width":1609,"start_y":10,"start_x":20,"height":2770},"class":["row"]}},"children":[],"type":"dummyDiv","div_type":"row"}');o.ui.value.position.width=e.ui.value.position.width-n,o.ui.value.position.end_x=e.ui.value.position.end_x-n/2;var s=!1,l=document.querySelector("crm-detailview-canvas"),d=Lyte.registeredMixins["crm-detailcanvas-utils"].isSandboxDiffPage,c=Lyte.registeredMixins["crm-detailcanvas-utils"].isProdDiffPage;(d||c)&&(l=d?document.querySelector("#sandboxObj_sandboxChanges crm-detailview-canvas"):c?document.querySelector("#parentObj_sandboxChanges crm-detailview-canvas"):l),l||(l=document.querySelector("crm-detailview-canvas-gallery"),s=!0);var u=l?l.getData("layoutId"):Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],m=store.peekRecord("layout",u),p=m.module.module_name,v='{"zcanvasId":"zcanvas_uh3hggg42hk","ui":{"value":{"tagname":"DIV","style":{},"position":{"end_x":1602,"depth":1,"width":1572,"min_top":11,"start_y":30,"start_x":30,"height":52,"min_left":10},"class":"zcanvas-title-editor"}},"children":[{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex","margin_right":"1px","margin_top":"5px"}},"position":{"end_x":1367,"single_cell_width":"","width":1357,"start_y":11,"start_x":10,"height":22},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"end_x":174,"depth":1,"width":1357,"start_y":11,"start_x":10,"height":22}}},"children":[{"zcanvasId":"zcanvas_9aajo2mw6s8","ui":{"autoheight":false,"value":{"tagname":"DIV","style":{"default":{"background_color":"transparent"}},"position":{"end_x":174,"depth":1,"width":1357,"start_y":11,"start_x":10,"height":22},"class":"zc_disabled zc-system-title","value":"${section.title}"}},"children":[],"type":"component","theme":"Static Text"}],"type":"dummyDiv"}],"type":"dummyDiv","divType":"row"},{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex","margin_right":"11px"}},"position":{"end_x":1473,"single_cell_width":"","start_y":17,"start_x":1368,"height":24},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"end_x":1473,"depth":1,"width":105,"start_y":17,"start_x":1368,"height":24}}},"children":[{"id":"locatemap","datatype":"button","type":"action","zcanvasId":"zcanvas_tbac7l6b0n","value":"<crm-canvas-buttons module_name =\''+p+'\' button_type=\'locatemap\'></crm-canvas-buttons>","ui":{"value":{"style":{"default":{}},"position":{"start_x":1333,"start_y":8,"end_x":1473,"width":140,"height":33,"depth":1},"class":"zcanvas-no-img-default zc-ta-center zccbutton"},"field":{"style":{},"class":""}},"children":[]}],"type":"dummyDiv"}],"type":"dummyDiv","divType":"row"}],"type":"static_content","theme":"Custom Layout"}',f=e.ui.allfieldstabstyle||{};if(m){for(var _=m.sections.filter((function(e){return e.type&&("Events"!==p||!("Event Quick View"===e.name||"Event Additional Information"===e.name||"Event Information"===e.name&&e.fields.filterBy({column_name:"SMCREATORID"}).length))})),h=_.length,g=0;g<h;g++){var y=JSON.parse('{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex","margin_right":"2.3966446%"}},"position":{"end_x":1629,"single_cell_width":"","width":1609,"start_y":10,"start_x":20,"height":2770},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex","margin_bottom":"30px"}},"position":{"end_x":1629,"single_cell_width":"","width":1609,"start_y":10,"start_x":20,"height":1350},"class":["column"]}},"children":[{"ui":{"value":{"style":{"default":{"margin_left":"0%","flex_direction":"column","display":"flex","margin_right":"0%"}},"position":{"end_x":1629,"single_cell_width":"","width":1609,"start_y":10,"start_x":20,"height":1350},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"end_x":1629,"depth":1,"width":1609,"start_y":10,"start_x":20,"height":1350}}},"children":[],"type":"dummyDiv"}],"type":"dummyDiv","div_type":"row"}],"type":"dummyDiv","div_type":"column"}],"type":"dummyDiv","div_type":"row"}'),b=Lyte.registeredMixins["crm-detailcanvas-utils"].getEmptyNodeFromTree(y),C=_[g].fields&&1==_[g].fields.length&&_[g].fields[0].data_type.indexOf("profileimage")>-1,L=_[g].fields&&1==_[g].fields.length&&("Product_Details"===_[g].fields[0].api_name||"Pricing_Details"===_[g].fields[0].api_name),R=_[g].isSubformSection,w=!_[g].fields||0===_[g].fields.length,x=0===_[g].fields.filter((function(e){return e.visible})).length;if(!(C||R||w||L||x)){var I=f[_[g].uid]||{},S=JSON.parse(t);S.zcanvasId=zutils.getRandomId(),S.ui=I.sectionstyle?I.sectionstyle:S.ui,y.ui.value.position.width=S.ui.value.position.width,Lyte.registeredMixins["crm-detailcanvas-utils"].handleDynamicSectionVisibility(y,S.ui.value.style);var D=S.children,z=I.footersection&&Object.keys(I.footersection).length>0||"MobileDetailView"===a,M=Lyte.registeredMixins["crm-detailcanvas-utils"].isLocateMapAvailableForModule(p),k=I&&I.titlesection&&I.titlesection.children&&I.titlesection.children[1]&&Lyte.registeredMixins["crm-detailcanvas-utils"].findComponentNodeOnTreeByCondition(I.titlesection.children[1],{id:"locatemap"});S.ui.value.class&&S.ui.value.class.indexOf("zc-fieldsectionallfield")&&(S.ui.value.class+=" section-"+_[g].uid),_[g].api_name===I18n.getMsg("crm.security.address.informations")&&M&&!k?D[0]=JSON.parse(v):D[0]=I.titlesection?I.titlesection:JSON.parse('{"zcanvasId":"zcanvas_of4y9sszxd","ui":{"value":{"tagname":"DIV","style":{"default":{}},"position":{"end_x":855,"depth":1,"width":825,"min_top":11,"start_y":30,"start_x":30,"height":50,"min_left":10},"class":"zcanvas-title-editor"}},"children":[{"ui":{"value":{"style":{"default":{"flex_direction":"column","display":"flex","margin_right":"82.545456%"}},"position":{"end_x":174,"single_cell_width":"","width":164,"start_y":11,"start_x":10,"height":22},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"end_x":174,"depth":1,"width":164,"start_y":11,"start_x":10,"height":22}}},"children":[{"zcanvasId":"zcanvas_qvm51ys1n1","ui":{"autoheight":false,"value":{"tagname":"DIV","style":{"default":{"background_color":"transparent"}},"position":{"end_x":174,"depth":1,"width":164,"start_y":11,"start_x":10,"height":22},"class":"zc_disabled","value":"${section.title}"}},"children":[],"type":"component","theme":"Static Text","componentid":true}],"type":"dummyDiv"}],"type":"dummyDiv","div_type":"row"}],"type":"static_content","theme":"Custom Layout"}'),D[0].zcanvasId=zutils.getRandomId();var A=this.findComponentNodeOnTreeByCondition(D[0],{classname:"zc_disabled"});if(A||(A=this.findComponentNodeonTree(D[0])),"Address Information"===_[g].api_name&&I&&I.titlesection&&!I.footersection){var F=this.findComponentNodeOnTreeByCondition(I.titlesection,{classname:"zc_disabled"});F&&(A.ui=F.ui),D[0].ui=I.titlesection.ui}if(A&&A.ui&&A.ui.value&&(A.ui.value.value=$ESAPI.encoder().encodeForHTMLAttribute(_[g].display_label)),z){D[2]=I.footersection?I.footersection:JSON.parse('{"ui":{"value":{"style":{},"position":{"start_x":0,"depth":1,"min_left":81,"end_x":281,"start_y":208,"min_top":17,"width":281,"height":50},"class":"zcanvas-footer-editor"}},"children":[{"ui":{"value":{"style":{"default":{"display":"flex","flex_direction":"column","margin_right":"29.537369%"}},"position":{"start_x":81,"single_cell_width":"","end_x":198,"start_y":17,"width":117,"height":18},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"start_x":81,"depth":1,"end_x":198,"start_y":17,"width":117,"height":18}}},"children":[{"ui":{"field":{"style":{},"class":""},"value":{"style":{"default":{"border":"none","padding":"0","background_color":"rgba(255,255,255,0)","color":"rgba(91, 142, 220, 1)","font_size":"14px","border_radius":"0"}},"position":{"start_x":81,"depth":1,"end_x":198,"start_y":17,"width":117,"height":18},"class":"zcanvas-field zcanvas-no-img-default zc-ta-center zccbutton zccrlaction zc-rl-field"}},"children":[],"datatype":"button","id":"viewMore","type":"action"}],"type":"dummyDiv"}],"div_type":"row","type":"dummyDiv"}],"theme":"Custom Layout","type":"static_content"}'),D[2].zcanvasId=zutils.getRandomId();var P=this.findComponentNodeOnTreeByCondition(D[2],{classname:"zccbutton"});P||(P=this.findComponentNodeonTree(D[2])),P&&(P.value=P.zcvalue='<lyte-button onclick ={{action("executeRelatedListAction")}} data-relid="'+_[g].id+'" lt-prop-appearance="default-success" lt-prop-disable="false"><template is="registerYield" yield-name="text">'+I18n.getMsg("crm.nsocial.tab.view.more")+"</template></lyte-button>")}else D.splice(2,1);if(D[1].id=_[g].uid,s)D[1]&&(D[1].ui=I.datastyle?I.datastyle:{value:{position:{}}});else{var E=Lyte.Router.getRouteInstance().getDynamicParam()||Math.random().toString().substr(2,9),O=_[g].uid;D[1].componentid=(O+E.toString()+"11").replace("_","000"),D[1].ui=I.datastyle?I.datastyle:{value:{position:{}}},S.id=(O+E.toString()+"1").replace("_","000"),D[0].id=(O+E.toString()+"10").replace("_","000")}b.children=[S],o.children.push(y)}}e.children.push(o)}return e},extractInfoFromSection:function(e){if(!this.isSectionMigrationNeed)return e;var t=e.children,i=t.length;e.ui.allfieldstabstyle={};for(var a=0;a<i;a++){var n=t[a],r=n.ui,o=n.children;o[0].ui.value.class="zcanvas-title-editor",o[0].type="static_content",o[0].theme="Custom Layout";for(var s={fields:{},layoutstyles:o[1].ui.value.layoutstyle,rows:[],table:o[1].ui.value.style},l=o[1].children,d=l.length,c=0;c<d;c++){s.rows.push(l[c].ui);for(var u=l[c].children,m=u.length,p=0;p<m;p++)s.fields[u[p].id]=u[p].ui}var v=o[1].ui;v.value.tablestyles=s,delete v.value.layoutstyle;var f={sectionstyle:r,titlesection:o[0],datastyle:v};e.ui.allfieldstabstyle[n.section_id]=f}return e.children=[],e},findComponentNodeOnTreeByCondition:function(e,t){return e?e&&t&&t.classname&&e.ui&&e.ui.value&&e.ui.value.class&&e.ui.value.class.indexOf(t.classname)>-1||e&&t&&t.id&&e.id===t.id?e:this.findComponentNodeOnTreeByCondition(e.children[0],t):null},findComponentNodeonTree:function(e){return e?e&&e.componentid?e:this.findComponentNodeonTree(e.children[0]):null},findSectionElementsinTree:function(e){for(var t=e.children,i=t.length,a=[],n=0;n<i;n++)a.push(this.findComponentNodeonTree(t[n]));return a},extractInfoFromSection_View:function(e){if(!this.isSectionMigrationNeed)return e;var t=e.children,i=t.length;e.ui.allfieldstabstyle={};for(var a=0;a<i;a++)for(var n=this.findSectionElementsinTree(t[a]),r=n.length,o=0;o<r;o++){for(var s={sectionstyle:n[o].ui,titlesection:null,datastyle:null},l=n[o].children[0].children,d=l.length,c=0;c<d;c++)for(var u=this.findSectionElementsinTree(l[c]),m=u.length,p=0;p<m;p++)if("Custom Layout"===u[p].theme)u[p].ui.value.class="zcanvas-title-editor",u[p].type="static_content",u[p].theme="Custom Layout",s.titlesection=u[p];else if("Table Layout"===u[p].theme){for(var v={fields:{},layoutstyles:u[p].ui.value.layoutstyle,rows:[],table:u[p].ui.value},f=u[p].children[0].children,_=f.length,h=0;h<_;h++){var g=this.findSectionElementsinTree(f[h]);if(g.length){v.rows.push(g[0].ui);for(var y=g[0].children,b=y.length,C=0;C<b;C++){var L=y[C];v.fields[L.id]=L.ui?L.ui:JSON.parse('{"value":{"style":{},"position":{"startX":0,"startY":0,"endX":625,"width":625,"height":50},"tagname":"DIV","class":"zcanvas-field"},"holder":{"style":{},"tagname":"SPAN","class":""},"field":{"style":{},"tagname":"SPAN","class":""},"label":{"style":{},"tagname":"SPAN","class":""}}')}}}var R=u[p].ui;R.value.tablestyles=v,delete R.value.layoutstyle,s.datastyle=R}e.ui.allfieldstabstyle[n[o].section_id]=s}return e.children=[],e},addAjaxEditDetails:function(e,t,i){var a=e.id,n=Lyte.registeredMixins["crm-detailcanvas-utils"];e.api_name&&i.ui&&i.ui.value&&(i.ui.value.class||(i.ui.value.class=""),i.ui.value.class+=" canvasselectablefield canvas-element-apiname-"+e.api_name,i.ui.value.attr={"data-apiname":e.api_name});var r=i.ui.holder||i.ui.field;if(!n.isSandboxDiffPage&&!n.isProdDiffPage&&Lyte.registeredMixins["crm-canvas-core-construct-component"].isAjaxEditableField(a,!0)&&(r.interactions=[{event:"onmouseenter",handler:"{{action('handleMouseActions',this, event)}}"},{event:"onmouseleave",handler:"{{action('handleMouseActions',this, event)}}"}],i.ui.field)){i.ui.value&&(i.ui.value.class?i.ui.value.class+=" zcanvas-table-row-field":i.ui.value.class="zcanvas-table-row-field",e&&250===e.ui_type&&!i.ui.value.class.includes("zctextarea")&&(i.ui.value.class+=" zctextarea"),t.ui.value&&t.ui.value.position&&t.ui.value.position.height<25&&(i.ui.value.class+=" zcanvas-low-size-row"));var o="";if(i.ui.value&&i.ui.value.class&&i.ui.value.class.indexOf("zctextarea")>-1&&(o="non-center-edit"),i.ui.field&&i.ui.field.style&&i.ui.field.style.default&&i.ui.field.style.default["vertical-align"]){var s=i.ui.field.style.default["vertical-align"];"top"===s?o+=" zc-top-edit-icon":"bottom"===s&&(o+=" zc-bottom-edit-icon")}if(i.ui.field.extrahtml="<span data-zcqa='"+$ESAPI.encoder().encodeForHTML(e.field_label)+"' class='zc-ajax-edit zc-ajax-edit-inner "+o+"' onclick={{action('handleeditButton')}}></span>",Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&this.canvasFieldCheck(this.getData("module"),e.column_name,this.getData("record"),a)){var l=Lyte.registeredMixins["crm-canvas-common-utils"].getSmartPromptIconStr.call(this,e);i.ui.field.extrahtml+=l}"Voice_Recording__s"===e.api_name&&(i.ui.field.extrahtml+='<span class="zc-ajax-copy zc-ajax-copy-inner"  data-zcqa="canvas_ajax_copy_icon"  onclick="{{action(\'handleCopyButton\',record[\'Voice_Recording__s\'])}}"> <crmutil-icon icon-name="copy-clip"  icon-class="zcicn-copy-clip zcicn_blue" lt-prop-title="{{getI18n(\'crm.button.copy\')}}" ></crmutil-icon> </span>')}},ajaxEditHighlight:function(e,t){var i=t?[]:store.peekAll("field"),a=e.length;for(let o=0;o<a;o++){let a=t||i.filter((function(t){return t.api_name===e[o]}))[0];if(a){var n=a.column_name,r=$L(".fieldupdate_"+n);r&&(r.addClass("zc-fieldupdate-highlight"),setTimeout((function(){$L(".zc-fieldupdate-highlight").removeClass("zc-fieldupdate-highlight")}),500))}}},onSpecialCompLoaded:function(e){var t=document.querySelector("crm-detailview-canvas");if(t){var i=t.getData("excludecomps");if(i){for(var a=e.length,n=0;n<a;n++)i[e[n]]=!0;t.setData("excludecomps",i),t.component.onSpecialCompLoadedComp.bind(t.component)()}}},ignoreSystemvalues:function(e){if("object"==typeof e){var t={};for(var i in e)0!==i.indexOf("$")&&(t[i]=e[i]);return t}return e},sanitizeCscriptValue:function(e){if(Array.isArray(e)){for(var t=e.length,i=[],a=0;a<t;a++)i.push(this.sanitizeCscriptValue(e[a]));return i}return"object"==typeof e?this.ignoreSystemvalues(e):e},suffleLRfields:function(e,t,i){var a=!!e.layoutRuleShowFld.filter((function(e){return e.showFldId===t.id})).length,n=e.revlayoutRuleShowFld.includes(t.id);if(i){if(a||e.layoutRuleShowFld.push({showFldId:t.id}),n)for(var r=e.revlayoutRuleShowFld.length,o=0;o<r;o++)e.revlayoutRuleShowFld[o]===t.id&&(e.revlayoutRuleShowFld.splice(o,1),r=e.revlayoutRuleShowFld.length,o--)}else if(n||e.revlayoutRuleShowFld.push(t.id),a)for(r=e.layoutRuleShowFld.length,o=0;o<r;o++)e.layoutRuleShowFld[o].showFldId===t.id&&(e.layoutRuleShowFld.splice(o,1),r=e.layoutRuleShowFld.length,o--)},suffleLRsections:function(e,t,i){var a=e.layoutRuleShowSections.includes(t),n=e.revlayoutRuleShowSections.includes(t);if(i){if(a||e.layoutRuleShowSections.push(t),n)for(var r=e.revlayoutRuleShowSections.length,o=0;o<r;o++)e.revlayoutRuleShowSections[o]===t&&(e.revlayoutRuleShowSections.splice(o,1),r=e.revlayoutRuleShowSections.length,o--)}else if(n||e.revlayoutRuleShowSections.push(t),a)for(r=e.layoutRuleShowSections.length,o=0;o<r;o++)e.layoutRuleShowSections[o]===t&&(e.layoutRuleShowSections.splice(o,1),r=e.layoutRuleShowSections.length,o--)},handleFldSecVisiblityforLayoutRule:function(e){for(var t,i,a,n,r=Lyte.Router.getRouteInstance().currentModel.layoutId,o=$L(".canvas-element-button-id-locatemap"),s=e.layoutRuleShowSections.length,l=0;l<s;l++)if((t=store.peekRecord("layout",r).sections.filter((function(t){return t.name===e.layoutRuleShowSections[l]}))[0])&&t.fields&&t.fields[0]){i=$L(".zc-fieldsectionallfield.section-"+t.uid),e.handlingShowOrhideFld(i,!0),n=t.fields.length;for(var d=0;d<n;d++)e.revlayoutRuleShowFld.includes(t.fields[d].id)||(a=$L(".fieldupdate_"+t.fields[d].column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(a,!0));"Address Information"===t.api_name&&o.length>0&&e.handlingShowOrhideFld(o,!0)}s=e.revlayoutRuleShowSections.length;for(l=0;l<s;l++)if((t=store.peekRecord("layout",r).sections.filter((function(t){return t.name===e.revlayoutRuleShowSections[l]}))[0])&&t.fields&&t.fields[0]){i=$L(".zc-fieldsectionallfield.section-"+t.uid),e.handlingShowOrhideFld(i,!1),n=t.fields.length;for(d=0;d<n;d++)t.layout&&t.layout.module&&"Calls"===t.layout.module.api_name&&"DESCRIPTION"===t.fields[d].column_name&&(e.layoutRuleShowSections.indexOf("Reason For Incoming Call")>=0||e.layoutRuleShowSections.indexOf("Outcome Of Outgoing Call")>=0)||(a=$L(".fieldupdate_"+t.fields[d].column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(a,!1),e.layoutRuleShowFld.filter((function(e){return e.showFldId===t.fields[d].id})).length>0&&e.suffleLRfields(e,t.fields[d],!1));"Address Information"===t.api_name&&o.length>0&&e.handlingShowOrhideFld(o,!1)}s=e.layoutRuleShowFld.length;for(l=0;l<s;l++){if((t=store.peekRecord("field",e.layoutRuleShowFld[l].showFldId))&&!e.revlayoutRuleShowSections.includes(t.section[0].name))if(a=$L(".fieldupdate_"+t.column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(a,!0),0===a.length&&t&&Crm.userDetails.isSubformNewComponentEnabled&&"subform"!==t.data_type&&"static_subform"!==t.data_type&&(t.subform||t.associated_module))(c=Lyte.deepCopyObject(t.view_type)).view=!0,t.$.set("view_type",c)}s=e.revlayoutRuleShowFld.length;for(l=0;l<s;l++){var c;if(t=store.peekRecord("field",e.revlayoutRuleShowFld[l]))if(a=$L(".fieldupdate_"+t.column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(a,!1),0===a.length&&t&&Crm.userDetails.isSubformNewComponentEnabled&&"subform"!==t.data_type&&"static_subform"!==t.data_type&&(t.subform||t.associated_module))(c=Lyte.deepCopyObject(t.view_type)).view=!1,t.$.set("view_type",c)}s=e.LRuleManField.length;for(l=0;l<s;l++)(t=store.peekRecord("field",e.LRuleManField[l].targetFieldId))&&Crm.userDetails.DV_MANDATORY_FIELD_ASTERIX_SYMBOL&&$L(".mandate_ast_"+t.column_name+"_header").addClass("dN"),t&&(e.revlayoutRuleShowSections.includes(t.section[0].name)||e.revlayoutRuleShowFld.includes(e.LRuleManField[l].targetFieldId))&&(e.LRuleManField.splice(l,1),l--,s--);s=e.revLRuleManField.length;for(l=0;l<s;l++)(t=store.peekRecord("field",e.revLRuleManField[l].targetFieldId))&&Crm.userDetails.DV_MANDATORY_FIELD_ASTERIX_SYMBOL&&$L(".mandate_ast_"+t.column_name+"_header").removeClass("dN"),t&&(e.revlayoutRuleShowSections.includes(t.section[0].name)||e.revlayoutRuleShowFld.includes(e.revLRuleManField[l].targetFieldId))&&(e.revLRuleManField.splice(l,1),l--,s--)},_trackAjax:function(e){Crm.client_tracking("CanvasAjaxEditActions - "+e)},_trackAjaxforListView:function(e,t){Crm.client_tracking("CanvasListView ",{viewType:e,action:t})},_trackAjaxforFormView:function(e){Crm.client_tracking("CanvasFormView",{action:e})},_trackAjaxforDetailView:function(e){Crm.client_tracking("CanvasDetailView ",e)},_trackAjaxforDetailView:function(e){Crm.client_tracking("CanvasDetailView ",e)},_trackAjaxforMobileDetailView:function(e){Crm.client_tracking("CanvasMobileDetailView ",e)},_trackAjaxforWizardView:function(e){Crm.client_tracking("CanvasWirardView ",e)},initPageConfigMethods:function(e){if("debounce_load"===e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.runListLoading=$L.debounce(t.scrollhandler,1500)}},splitSectionStyles:function(e){var t=[];if(e.value&&e.value.tablestyles){var i=e.value.tablestyles.fields,a=e.value.tablestyles.rows,n=e.value.tablestyles.layoutstyles,r=e.value.tablestyles.table,o=$("#zcanvas_menu").data("zcdatamap");if(i){var s={ui:{datastylefields:{},value:{}},children:[]};for(var l in i){var d={ui:i[l],children:[]};d.id=l,d.type="field",o&&o[l]&&(d.datatype=o[l].datatype),s.children.push(d)}t.push(s)}if(a){for(var c=a.length,u={ui:{datastylerow:{}},children:[]},m=0;m<c;m++){var p={ui:a[m],children:[]};p.ui.index=m,u.children.push(p)}t.push(u)}if(n){var v={ui:{datastylelayout:{}},children:[]},f={ui:n,children:[]};v.children.push(f),t.push(v)}if(r){var _={ui:{datastyletable:{}},children:[]},h={ui:r,children:[]};_.children.push(h),t.push(_)}}return t},splitAllFields:function(e){var t=["sectionstyle","titlesection","datastyle","footersection"],i=e.ui.allfieldstabstyle,a=t.length,n=Lyte.registeredMixins["crm-detailcanvas-utils"],r=[],o=store.peekAll("section");for(var s in i){var l={ui:{},children:[]};l.id=s,l.type="section";var d=o.filterBy({uid:s})[0],c=void 0!==d?d.api_name:"";l.static_id=c;for(var u=0;u<a;u++){var m={ui:{value:{}},children:[]};"datastyle"!==t[u]?m.ui[t[u]]=i[s][t[u]]:(m.ui.datastyle={},m.children=n.splitSectionStyles(i[s].datastyle)),l.children.push(m)}r.push(l)}e.ui.allfieldstabstyle={},e.children=r},swapSectionStyles:function(e){for(var t={},i=e.children,a=i.length,n=0;n<a;n++){var r=i[n];if(r){var o=r.ui;if(o){if(o.datastylefields){var s={},l=r.children;if(l)for(var d=l.length,c=0;c<d;c++){var u=l[c];s[u.id]=u.ui}t.fields=s}if(o.datastylerow){s=[];var m=r.children;if(m){var p=m.length;for(c=0;c<p;c++){var v=m[c];s.push(v.ui)}}t.rows=s}if(o.datastylelayout){var f=r.children;f&&f.length>0&&(t.layoutstyles=f[0].ui)}if(o.datastyletable){var _=r.children;_&&_.length>0&&(t.table=_[0].ui)}}}}return{value:{tablestyles:t}}},swapAllFields:function(e){for(var t=e.children,i=e.ui.allfieldstabstyle,a=t.length,n=0;n<a;n++){for(var r=t[n],o=r.id,s=r.children,l=s.length,d={},c=0;c<l;c++){var u=s[c],m=u.ui;if(m&&m.sectionstyle&&(d.sectionstyle=m.sectionstyle),m&&m.titlesection&&(d.titlesection=m.titlesection),m&&m.footersection&&(d.footersection=m.footersection),m&&m.datastyle){var p=Lyte.registeredMixins["crm-detailcanvas-utils"];d.datastyle=p.swapSectionStyles(u)}}i[o]=d}e.children=[]},getBgImageURL:function(e,t){var i="";return i=(i="false"===window.isSandboxAcc&&window.isCanvasSandboxDiff?sandbox.orgInfo.crmSandboxOrParentBasePath+"/sandbox/diff":"true"===window.isSandboxAcc&&window.isCanvasProdDiff?sandbox.orgInfo.crmSandboxOrParentBasePath+"/production/diff":crmBasePath)+"/EntityImageAttach.do?actionName=getBackgroundImagesforCanvas&fileId="+e,t&&(i=i+"&size="+t),i},initializeLazyLoad:function(){if(Crm.CanvasBgLoad&&Crm.CanvasBg&&Crm.CanvasBg.diff(Crm.CanvasBgLoad).length<=0)return;for(var e,t=Crm.CanvasBg?Crm.CanvasBg:[],i=(t=t.slice(0)).length>=4?t.length:4,a=Math.ceil(i/4),n=0;n<4;)e=t.splice(0,a),this.initializeImageRequest(e),n++},initializeImageRequest:function(e){if(e.length>0){var t=e.splice(0,1),i=new Image;i.id=t[0],i.url=Lyte.registeredMixins["crm-detailcanvas-utils"].getBgImageURL(t[0]),i.imageIdArray=e,i.onload=function(){var e={};e["--zcanvasbg-"+this.id]="url("+this.url+")",$(":root").css(e),Lyte.registeredMixins["crm-detailcanvas-utils"].initializeImageRequest(this.imageIdArray),Crm.CanvasBgLoad&&!Crm.CanvasBgLoad.includes(this.id)?Crm.CanvasBgLoad.push(this.id):Crm.CanvasBgLoad=[this.id]},i.setAttribute("src",i.url)}},canvasHelpDoc:function(){var e=null;if("fr"===(Crm.userDetails.LOCALE?Crm.userDetails.LOCALE.split("_")[0]:"en"))e="/customize-crm-account/managing-module-views/articles/personnalisation-de-la-page-d%C3%A9tail-de-l-enregistrement-%C3%A0-l-aide-du-concepteur-de-canvas";else e=crmConstants.helpUrl["help.canvas.detail"];return"ListView"===Lyte.Router.getRouteInstance().getQueryParams().feature&&(e=crmConstants.helpUrl["help.canvas.list"]),"FormView"===Lyte.Router.getRouteInstance().getQueryParams().feature?commonUtils.getHelpUrl("help.canvas.form"):crmConstants.helpUrl["help.domain.url"]+e},openSharingPopUp:function(e){var t={};if(1===Crm.userDetails.TMENABLED){t.territory=store.findAll("territory",{filters:{field:{api_name:"reporting_to.id"},value:null,comparator:"equal"}},null,null,{version:"v2.2"})}Lyte.resolvePromises(t).then((function(t){var i={},a=[],n={type:"ActiveUsers",include_lite_users:!0};if(a.push({name:I18n.getMsg("crm.security.public.groups"),model_name:"user_group",idSelector:"id",prefix:"G",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.groups.available")}),a.push({name:I18n.getMsg("crm.security.users"),model_name:"user",idSelector:"id",nameSelector:"full_name",prefix:"U",imageSelector:"image_link",descriptionSelector:"email",pagination:!0,setSearchCriteria:"",cxPropQueryParams:n,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.users.available")}),a.push({name:I18n.getMsg("crm.security.roles"),model_name:"role",idSelector:"id",prefix:"R",nameSelector:"display_label",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.roles.available")}),a.push({name:I18n.getMsg("crm.security.roles.subordinates"),model_name:"role",idSelector:"id",prefix:"RS",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.roles.subordinates.available")}),1===Crm.userDetails.TMENABLED){var r=[];t.territory&&t.territory[0].id&&r.push(t.territory[0].id),a.push({name:I18n.getMsg("crm.territory.territories"),model_name:"territory",idselector:"id",prefix:"T",nameSelector:"name",pagination:!0,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.territory.available"),cxPropExclude:r,cxPropCustomRequest:!0}),a.push({name:I18n.getMsg("crm.label.territories.and.subordinates"),model_name:"territory",idselector:"id",prefix:"TS",nameSelector:"name",pagination:!0,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.territory.subordinates.available"),cxPropExclude:r,cxPropCustomRequest:!0})}i.record=e,i.showSharingModels=a,i.selectedItems={},i.configType="ListView",store.findAll("field",{module:"users"}).then((function(e){if(i.isFirstNameFieldAvailable=!1,e&&null!==e)for(var t=e.length,a=0;a<t;a++)if("first_name"===e[a].api_name){i.isFirstNameFieldAvailable=!0;break}var n=$("#folderSharingTemplate");void 0!==n&&n.length>0&&n[0].remove();var r=Lyte.Component.render("crm-folder-sharing",i,"body");r.id="folderSharingTemplate",r.getElementsByTagName("crux-combo-box")[0].cxProp("show",!0),commonUtils.showHideLoadingDiv(!1)}))}))},isLocateMapAvailableForModule:function(e){return"Leads"===e||"Vendors"===e||"Contacts"===e||"Accounts"===e||"Quotes"===e||"Invoices"===e||"SalesOrders"===e||"PurchaseOrders"===e},getImportErrorMessage:function(e){switch(e){case"INVALID_DATA":return I18n.getMsg("crm.canvas.import.templatekey.invalid");case"ID_ALREADY_DELETED":return I18n.getMsg("crm.canvas.import.templatekey.deleted")}},handleCanvasRulesLimit:function(e,t){store.findAll("features",{api_names:"detailview_canvasrules"}).then((function(i){if(i&&i.length&&t>=i[0].details.limits.total){var a=$L("#criteriamoduleerror"),n=i[0].details.limits.total||Customization.ruleLimit[Crm.userDetails.LICENSE_TYPE];a.text(I18n.getMsg("crm.canvas.rules.limit.exceeded",[n,"Canvas"])),a.css("display","block"),e.toggleSaveButton(!0)}else e.toggleSaveButton(!1)}))},isListViewPage:function(){return!(!Lyte.Router.getRouteInstance()||"listview"!==Lyte.Router.getRouteInstance().routeName&&"custom-view"!==Lyte.Router.getRouteInstance().parent.routeName&&"ListView"!==Lyte.Router.getRouteInstance().getQueryParams().feature)},canvasErrorHandlingforLimit:function(e,t,i){var a=moduleRecordMapping[i].plural_label;return Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)?"ListView"===e?"CustomizedView"===t?I18n.getMsg("crm.canvas.limit.exceed",I18n.getMsg("crm.canvas.custom.viewname")):"CardView"===t?I18n.getMsg("crm.canvas.limit.exceed",I18n.getMsg("crm.canvas.tile.viewname")):I18n.getMsg("crm.canvas.limit.exceed",I18n.getMsg("crm.canvas.table.viewname")):I18n.getMsg("crm.canvas.limit.exceed","Canvas"):"ListView"===e?"CustomizedView"===t?I18n.getMsg("crm.canvas.module.limit.exceed",[I18n.getMsg("crm.canvas.custom.viewname"),a]):"CardView"===t?I18n.getMsg("crm.canvas.module.limit.exceed",[I18n.getMsg("crm.canvas.tile.viewname"),a]):I18n.getMsg("crm.canvas.module.limit.exceed",[I18n.getMsg("crm.canvas.table.viewname"),a]):I18n.getMsg("crm.canvas.module.limit.exceed",["Canvas",a])},getReversedSelector:function(e){e&&Array.isArray(e)&&(e=e.join(","));var t=Lyte.registeredMixins["crm-detailcanvas-utils"],i={};for(var a in t.context_selector_mapping)i[t.context_selector_mapping[a]]=a;return i[e]},convertToHtml:function(e,t){var i="";return i+="<"+$ESAPI.encoder().encodeForHTML(t),Object.keys(e[t]).forEach((a=>{["cx-prop-maxlength","cx-prop-disabled","cx-prop-clear-error-message","cx-prop-is-color-code-enabled","cx-prop-phone-in-user-format","cx-prop-enable-country-code","cx-prop-readonly","cx-prop-prevent-focus-on-error"].includes(a)?i+=" "+$ESAPI.encoder().encodeForHTML(a)+"='"+e[t][a]+"'":i+=" "+$ESAPI.encoder().encodeForHTML(a)+"='"+$ESAPI.encoder().encodeForHTMLAttribute(e[t][a])+"'"})),i+="></"+$ESAPI.encoder().encodeForHTML(t)+">"},isTeamModulehasAccess:function(e){return!e||("team_based"===e.access_type?e.private_profile&&"Admins"===e.private_profile.name||Crm.userDetails.IS_ADMIN:e.viewable&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM)},errorHandling:function(e){var t=JSON.parse(e.responseText);"FEATURE_NOT_SUPPORTED"===t.code?(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.label.cf.error.feature.unsupported"))):"FEATURE_NOT_ENABLED"!==t.code&&"NOT_ALLOWED"!==t.code||(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error")))},updatePageHeightTool:function(e){$("#heighttool .zcanvastoolinput")[0].value=e},filterContextMenuOptions:function(e,t){for(var i=t,a=i.length,n=0;n<a;n++){var r=e.findIndex((function(e){return e.event===i[n]}));e.splice(r,1)}return e},isAllMandatoryFieldsUsedInBuilder:function(){var e=$("#zcanvas_menu"),t=e.data("zcdatamap"),i=e.data("zcanvasMenu"),a=i.config.scopepertype.button?i.config.scopepertype.button:1,n=[],r=["save"];for(id in t)(t[id].required&&t[id].zcscope||"button"===t[id].datatype&&r.includes(t[id].api_name)&&a===t[id].zcscope)&&n.push(id);return 0===n.length},isFormViewCommonCheck:function(){var e=Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().transition&&Lyte.Router.getRouteInstance().transition.info&&Lyte.Router.getRouteInstance().transition.info.route;return"crm.tab.module.create.canvas"===e||"crm.tab.module.entity.edit.canvas"===e||"crm.tab.module.entity.clone.canvas"===e},configureTableComponent:function(e){var t=zclayout.prototype.layouts["Canvas Data Table"];if(t){var i={newcreation:!0,onInstall:!0};e&&e.mode&&(i.mode=e.mode),t.onInstall(i.mode,{headerType:"data_table_header_column"});var a={allowmultiple:!0,nativehover:!0,refreshdataondom:!0,headerType:"data_table_header_column",getMenuData:function(e){var t=e.closest(".zcanvas-static-editor");if(t.length){var i=t.data("zcanvas");if(i&&i.menu&&i.menu.data){if(i.menu.datamap)return i.menu.datamap;var a={};return i.menu.data.map((function(e){a[e.id]=e})),i.menu.datamap=a,a}}},getcolumntype:function(e,t){return e&&"select_edit"===e.id?{classNames:"zcanvas-datatable-static-column",columnWidth:70}:e&&(e.zctype?"profileimage"===e.zctype:"view"===t&&e.id&&store.peekRecord("field",e.id)&&"profileimage"===store.peekRecord("field",e.id).data_type)?{type:"data_table_image",classNames:"zcanvas-datatable-imagefield",columnWidth:50,stopGrow:!0}:null},getListData:function(e,t,i){e.children.map((function(e){e.zcanvasId||(e.zcanvasId=zutils.getRandomId())}));var a=i?null:(t.parent||t.element).closest(".zcanvas-static-editor"),n=[];if(a||i){var r=a.data(),o=i||r.zcanvas,s=r.zcanvasContextualConfig,l=o&&o.details,d=null;if(s&&s.processTemplate&&(d=s.processTemplate),o){for(var c=o.rellistdata||[],u=c.length;u<(l?1:3);)c.push({id:l?"":zutils.getRandomId()}),u++;if(d)for(_=0;_<u;_++){h=d(zutils.zcopyobjExternal(e),c[_],o.menu&&o.menu.data||[],"N/A");n.push(h)}else for(var m=store.peekRecord("related_list",o.id).fields.map((function(e){return e.id})),p=o.relListModId,v=store.peekRecord("module",p),f=v?v.module_name:o.api_name,_=0;_<u;_++){var h=Lyte.registeredMixins["crm-detailcanvas-utils"].processRelListObj(zutils.zcopyobjExternal(e),c[_],f,JSON.parse(JSON.stringify(m)),!0,null,void 0,!0);n.push(h)}}}return n},customColumnConfiguration:function(e,t){var i=t?$(t).closest(".zcanvas-static-editor"):null;if(i){var a=i.attr("id"),n=$(e).find(".ui-droppable");n.data("uiDroppable")&&n.droppable("option","scope",a),$(e).find(".zcanvas-editor").each((function(){var e=$(this).data("zcanvas");e&&e.config&&(e.config.zcdropscope=a),$(this).find(".ui-draggable").draggable("option","scope",a)}))}},static_column:function(e,t,i,a,n){var r=null;if(r=e?{label:"",id:"select_edit",zcanvasId:"select_edit_id"+n,ui:{value:{position:{width:70}}}}:{value:"",id:"select_edit",zcanvasId:"select_edit_id"+n,ui:{}},t&&t.ui)for(var o in t.ui)if(0===o.indexOf("static")){var s=o.replace("static_column_","");r.ui[s]=t.ui[o]}if(e){r.ignore_context_menu=!0;var l=this.constructHeader(r);return l.attr("data-min-width","70"),l}var d=this.constructColumn(r,a,i);return r.ui.column_odd&&(d.data("zctempstate","odd"),d.zccss(r.ui.column_odd.style||{})),r.ui.column_even&&(d.data("zctempstate","even"),d.zccss(r.ui.column_even.style||{})),d.data("zctempstate",null),d},enabledTypes:function(){return["field"]}};t.requestConfig(a)}else murphy.error(new Error("Table Instance Not Downloaded "))},generateDataTableFromJSON:function(e,t){t.independent?Lyte.registeredMixins["crm-canvas-builder-handler-mixin"].initTableSettings({onInstall:!0,mode:"view"}):this.configureTableComponent({mode:"view"});var i=zclayout.prototype.layouts["Canvas Data Table"],a=e.children;if(a&&e&&!e.details&&!e.skipActionColumn){var n={zcanvasId:zutils.getRandomId(),id:"select_edit",children:[],label:'<lyte-yield yield-name="select_edit_icon_select_all" record="{{record}}"></lyte-yield>',value:'<span class="dF flexAlignCenter"><span class="select_edit_icon_id"></span><lyte-yield yield-name="canvas_custom_checkbox"  record="{{record}}"></lyte-yield></span>',ui:{header:{style:{default:{_width_:"100px"}}},value:{fixed:"true",position:{width:100}}}};if(e.ui)for(var r in e.ui)if(0===r.indexOf("static")){var o=r.replace("static_column_","");n.ui[o]=e.ui[r]}n.ui.value.fixed="true",a.unshift(n)}return i.toView(e,null,{wrapper:'<template-canvas-replace is="for" items="{{record_list}}" item="record" index="index"></template-canvas-replace>',structureWrapper:{structure:'<lyte-table-structure class="zcanvas-data-table-structure"></lyte-table-structure>',parent:'<template-canvas-replace is = "registerYield" yield-name = "yield" ></template-canvas-replace>'},tableTag:'<lyte-table id="canvas_data_table" lt-prop-sticky-table = "true" lt-prop-prevent-scrollbar = "true" class="noBorderTable" lt-prop-yield = true></lyte-table>',headTag:"<lyte-thead></lyte-thead>",bodyTag:"<lyte-tbody></lyte-tbody>",headtrTag:'<lyte-tr class="zcanvas-table-row '+t.columnSizedModuleAttr+'"></lyte-tr>',trTag:'<lyte-tr id="crm-list-view-canvas-row-{{record.id}}" onclick="{{action(\'handleRecordNavigation\',event,record)}}" class="zcanvas-table-row zcanvas_zcdefaultcontd '+t.columnSizedModuleAttr+'" canvas-rules="{{canvasRules(canvas_rules , record , this)}}"></lyte-tr>',tdTag:"lyte-td",thTag:'<lyte-th class=""></lyte-th>',headTagComp:"lyte-thead",rowTagComp:"lyte-tr",bodyTagComp:".zcdatatable-body",valueWrap:function(e){if(!e.details){var t=store.peekRecord("field",e.id);if("tag"===e.datatype&&t)return"<crux-tag-component cx-prop-width='"+(e.ui.value.position.width+"px")+"' cx-prop-clip-mode=\"{{isClipText(textFormat)}}\" data-zcqa ='value_"+t.column_name+'\'  class="canvasCruxComponent" cx-Prop-Empty-Value="-" cx-prop-field =\''+JSON.stringify(t.$.toJSON())+'\' cx-prop-value="{{record.Tag}}" ></crux-tag-component>'}return e.value},labelWrap:function(e){var i="zcanvas zcanvas-datatable-header zcanvas-selectable";"field"!==e.type||e.details||"textarea"===store.peekRecord("field",e.id).data_type&&(i="zcanvas zcanvas-datatable-header zcanvas-selectable");return"custom_column"===e.type&&(i="zcanvas zcanvas-datatable-header zcanvas-selectable"),"select_edit"===e.id&&(i+=" zcanvas-datatable-static-column"),'<lyte-text data-component-mode="'+(t&&t.compmode?t.compmode:"")+'"  onmouseover="{{action(\'handleColumnHover\', this )}}"   id="column_'+(t&&t.prefix?t.prefix:"field")+"_"+e.id+'" class=" '+i+e.zcanvasId+'-label">'+(e.label?e.label:e.ui&&e.ui.value&&e.ui.value.name?$ESAPI.encoder().encodeForHTMLAttribute(e.ui.value.name):"")+'</lyte-text><span class="canvasTableSortIcon svgIconsImg"></span>'}})},isWizardView:function(){return Lyte&&Lyte.Router&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().getQueryParams()&&!!Lyte.Router.getRouteInstance().getQueryParams().wizardId&&$L("crm-canvas-form").length},createWizardCompJson:function(e){var t=e.data.wizardtextcompid;e.ui.wizardtext||(e.ui.wizardtext={title:{},content:{}});var i=$(".zcanvas_"+t+"_title"),a=$(".zcanvas_"+t+"_text"),n=jsonCreation.toolinst.getstylebyselector(".zcanvas_"+t+"_title",!1,!0),r=jsonCreation.toolinst.getstylebyselector(".zcanvas_"+t+"_text",!1,!0);e.ui.wizardtext.title.style=n,e.ui.wizardtext.content.style=r;var o=i.data("zcanvasclass");o&&(e.ui.wizardtext.title.class=o);var s=a.data("zcanvasclass");return s&&(e.ui.wizardtext.content.class=s),e},applyWizardCompStyle:function(e,t){var i=t&&t.id;if(i){var a=$(".zcanvas_"+i+"_title"),n=$(".zcanvas_"+i+"_text");a.length&&n.length&&(jsonCreation.toolinst.applyjsontostyle(a,t.ui.wizardtext.title.style),jsonCreation.toolinst.applyjsontostyle(n,t.ui.wizardtext.content.style),t.ui.wizardtext.title.class&&a.addClass(t.ui.wizardtext.title.class).zaddClass(t.ui.wizardtext.title.class),t.ui.wizardtext.content.class&&n.addClass(t.ui.wizardtext.content.class).zaddClass(t.ui.wizardtext.content.class))}},hasWizardButton:function(e){let t=!1,i=store.peekAll("wizard-button");if(i&&i.length){t=!!i.find((function(t){return t.id===e||!!t.resource&&t.resource.id===e}))}return t},getFieldsFromScreen:function(e){let t=[51,66],i=e.segments.filter((e=>"composite"===e.type||"fields"===e.type)).map((e=>e.fields)).flat(1);return i=i.filter((e=>!t.contains(e.ui_type))),i},getSortFieldsFromScreenSegment:function(e){return e.segments.reduce(((e,t,i)=>{if("fields"===t.type||"composite"===t.type){let a=t.fields.reduce(((e,i)=>([51,66].contains(i.ui_type)||(i[t.id].sequence_number%2!=0?e.column1.push(i):e.column2.push(i)),e)),{column1:[],column2:[]});a.column1.sort(((e,i)=>e[t.id].sequence_number-i[t.id].sequence_number)),a.column2.sort(((e,i)=>e[t.id].sequence_number-i[t.id].sequence_number)),e[`segment${i}`]=a}return e}),{})},getSortedFieldsInScreen(e){var t=this.getSortFieldsFromScreenSegment(e),i=[];for(let e in t){var a=t[e].column1||[],n=t[e].column2||[];a.length&&a.forEach((function(e){i.push(e)})),n.length&&n.forEach((function(e){i.push(e)}))}return i},getDefaultFieldSegment:function(e){let t=[51,66];return e.segments.filter((e=>{if("composite"===e.type||"fields"===e.type)return 1!==e.fields.length||!t.contains(e.fields[0].ui_type)}))[0]},isCanvasWizardPreview:function(){var e=$L("crm-canvas-dynamic-preview")[0];return!(!e||!e.component.getData("currView")||"WizardView"!==e.component.getData("currView").feature)},isCanvasWizardBuilder:function(){var e=$L("crm-detailview-oldeditor")[0];return!(!e||"WizardView"!==e.component.data.featureName)},initExtension:function(){zcanvasPluginHandler.updateStatus(!0,"render")},getRLComponent:function(){var e=this.$node,t=e.querySelector("crm-related-list-view-header");return t||e.querySelector("crm-related-list-canvas")},closeInvDiscOrTaxPop:function(e,t,i,a){this.isInventoryModule(t)&&e&&((i=i||$L("crm-create-inventory-popup")[0])&&"DISCOUNT"===e?(i.setData("skipRollBack",a),i.setData("showDiscountpopup",!1)):i&&"TAX"===e&&(i.setData("skipRollBack",a),i.setData("showTaxpopup",!1)))},isInventoryModule:function(e){return"Quotes"===(e=e||this.getData("module"))||"Invoices"===e||"SalesOrders"===e||"PurchaseOrders"===e},getRelatedListIdsFromCanvas:function(e){for(var t=e&&e.children||[],i=t.length,a=0;a<i;a++){"dummyDiv"!==t[a].type?"relatedlist"!==t[a].type?this.getRelatedListIdsFromCanvas(t[a]):this.canvas_rl_list.push(t[a].id):this.getRelatedListIdsFromCanvas(t[a])}},postCreate:function(e){var t=$L("#entityId")[0].value,i=Lyte.Router.getRouteInstance().parent.getDynamicParam(),a=$L("crm-detailview-canvas")[0],n=a?a.component:void 0,r=n?n.data:void 0,o=void 0!==e.fieldUpdateJson?e.fieldUpdateJson:[];o=o.length>0?o.concat(e.jArray):e.jArray,r.fieldUpdateJson=void 0!==r.fieldUpdateJson?r.fieldUpdateJson:o;var s=e?e.module:void 0;if(r.updateMap=void 0!==r.updateMap?r.updateMap:e.updateMap,r.isKioskExecution=void 0!==r.isKioskExecution?r.isKioskExecution:e.isKioskExecution,r.updatedColumnNameWithValue=void 0!==r.updatedColumnNameWithValue?r.updatedColumnNameWithValue:e.updatedColumnNameWithValue,r.columnVsUpdateDetails=void 0!==r.columnVsUpdateDetails?r.columnVsUpdateDetails:e.columnVsUpdateDetails,void 0!==o&&o.length>0&&i===t){var l=Lyte.registeredMixins["crm-detailcanvas-utils"].isPageRefreshReqForWmsUpdate(),d=r.updateMap?r.updateMap:void 0;if(d&&void 0!==d.isWaitingForApproval&&d.isWaitingForApproval&&"approval_process_pending"!==store.peekRecord(moduleRecordMapping[s].id,t).$approval_state)return void(Collaboration.isKioskCompAvail()||r.isKioskExecution?Customization.isKioskRefresh=!0:reloadCurrentEntityView());if(l&&!d.isFromAfterRefresh)return void(Collaboration.isKioskCompAvail()||r.isKioskExecution?Customization.isKioskRefresh=!0:(r.updateMap.isPageRefreshForWmsUpdate=!0,Lyte.registeredMixins["crm-detailview-common-utils"].callLyteRefresh(s)));var c=r.fieldUpdateJson?r.fieldUpdateJson.length:0;return setTimeout((function(e){for(var t=0;t<e;t++)$(".fieldupdate_"+r.fieldUpdateJson[t]).addClass("fieldupdate-highlight");if(Crm.userDetails.isSubformNewComponentEnabled&&moduleRecordMapping[s]&&moduleRecordMapping[s].fields){var i=[];moduleRecordMapping[s].fields.forEach((function(e){e.subform&&500!==e.ui_type&&-1!==r.fieldUpdateJson.indexOf(e.column_name)&&i.push(e.api_name)})),i.length>0&&document.querySelectorAll("crux-subform").forEach((function(e){e.highlightAggregateField(i)}))}$L(".fieldupdate_MODIFIEDTIME").addClass("fieldupdate-highlight"),$L(".fieldupdate_MODIFIEDBY").addClass("fieldupdate-highlight"),setTimeout((function(){$L(".fieldupdate-highlight").removeClass("fieldupdate-highlight")}),3e3),r.fieldUpdateJson=[]}),1e3,c),r.updatedColumnNameWithValue={},!1}},isPageRefreshReqForWmsUpdate:function(){for(var e=!1,t=$L("crm-detailview-canvas")[0],i=t?t.component.data:void 0,a=i.fieldUpdateJson?i.fieldUpdateJson.length:0,n=0;n<a;n++){var r=i.fieldUpdateJson[n],o=store.peekAll("field").filter((function(e){return e&&e.column_name===r}))[0];if(("221"===(o=o?o.ui_type:null)||"8"===o||"208"===o)&&i.columnVsUpdateDetails&&i.columnVsUpdateDetails[r]){e=!0;break}}return e},pageRefreshHandlingForCanvasDetailView:function(){Lyte.registeredMixins["crm-detailcanvas-utils"].pageRefreshHandlingForApprovalTransition()||Lyte.registeredMixins["crm-detailcanvas-utils"].pageRefreshHandlingForLayoutUpdate()},pageRefreshHandlingForApprovalTransition:function(){var e=$L("crm-detailview-canvas")[0],t=e?e.component.data:void 0,i=t?t.updateMap:{};return!(!i||!i.isWaitingForApproval)&&(t.isWaitingForApproval=!1,Lyte.registeredMixins["crm-detailcanvas-utils"].postCreate(),!0)},pageRefreshHandlingForLayoutUpdate:function(){var e=$L("crm-detailview-canvas")[0],t=e?e.component.data:void 0,i=t?t.updateMap:void 0;return!(!i||!i.isPageRefreshForWmsUpdate)&&(t.updateMap.isFromAfterRefresh=!0,t.updateMap.isPageRefreshForWmsUpdate=!1,Lyte.registeredMixins["crm-detailcanvas-utils"].postCreate(),!0)},throwErrorPopup:function(e){var t=document.getElementById("zc_readonly_msg_popover");t&&(t.setData("ltPropOriginElem","#detailcanvascontainer"),t.setData("ltPropShow",!0)),e||(e=I18n.getMsg("crm.canvas.detailpage.readonlyfieldmsg")),$L("crm-detailview-canvas")[0].setData("ajaxErrorPopUpMessage",e)},constructFldName:function(e,t,i){var a=store.peekRecord("field",e),n=a.field_label;if(!i)return n;var r=a.column_name;switch(t){case"Calls":switch(r){case"CONTACTID":n=I18n.getMsg("crm.activities.call.label.fromto");break;case"SEID":n=I18n.getMsg("crm.relatedTo")}break;case"Tasks":switch(r){case"CONTACTID":"Leads"===i.$se_module&&(o=i.$se_module),o&&(n=moduleRecordMapping[o]&&moduleRecordMapping[o].singular_label);break;case"SEID":var o;"Leads"!==i.$se_module&&(o=i.What_Id&&moduleApiVsNameMapping[i.$se_module]),o&&(n=moduleRecordMapping[o]&&moduleRecordMapping[o].singular_label)}}return n},constructFldValue:function(e,t,i){var a=store.peekRecord("field",e),n=a&&a.api_name;if(i&&a&&(i[n]||!(["What_Id","Who_Id"].indexOf(n)<0))){var r=i[n];switch(t){case"Tasks":switch(n){case"Recurring_Activity":r=Activities.convertRecurringPatternToReadableFormat(i[n].RRULE);break;case"Remind_At":r=Activities.convertRemainderPatternIntoReadableFormat(i[n],i);break;case"What_Id":case"Who_Id":r=this.getValForWhatOrWhoIdFlds(i,n)}break;case"Calls":switch(n){case"Reminder":var o=Utils.ISO8601toDateObject(r);r=Utils.getDateTimeInUserFormat(o,!0);break;case"What_Id":case"Who_Id":r=this.getValForWhatOrWhoIdFlds(i,n)}break;case"Events":switch(n){case"Recurring_Activity":r=Activities.convertRecurringPatternToReadableFormat(i[n].RRULE);break;case"What_Id":case"Who_Id":r=this.getValForWhatOrWhoIdFlds(i,n)}break;case"Services":if("Available_Dates"===n){for(var s="",l=i.Available_Dates,d=l.length,c=0;c<d;c++)s+=CrmDateUtils.convertDateToUserPattern(l[c],null,!0),c+1<d&&(s+=", ");r=s}}return r}},getValForWhatOrWhoIdFlds:function(e,t){if(e&&t){var i=e.$se_module,a=t;if("Who_Id"===t&&e[t]?i="Contacts":"Who_Id"===t&&e.What_Id&&"Leads"===i?(i="Leads",a="What_Id"):"What_Id"===t&&"Leads"!==i&&e[t]&&(i=e.$se_module),e[a]&&("What_Id"!==t||"Leads"!==i)){var n=objectUtils.cloneObject(e[a]);return n.module={api_name:i,id:moduleRecordMapping[moduleApiVsNameMapping[i]].id},n&&JSON.stringify(n)}}},setCustomDuration:function(){$("crm-customduration-services").remove(),document.getElementById("serviceDuration").toggle();var e=$L("crm-detailview-canvas")[0].component.getData("originalRecord"),t=$(".crm-cscrpi-selectable-field-Duration").children()[0].component.data,i=t.cxPropPicklistValues;Lyte.Component.render("crm-customduration-services",{serviceDuration:i,dataBind:e,apiName:"Duration",durationCompData:t},"body");var a=$("crm-customduration-services #customTimepopup")[0].component.data;Lyte.Component.set(a,"ltPropOffset",{top:"0px",left:"center"}),Lyte.Component.set(a,"ltPropShow",!0)},getFldVsColumnMap:function(e){var t=store.peekRecord("layout",e);if(t){var i={};return t.sections.forEach((function(e){e.fields.forEach((function(e){i[e.column_name]=[e.id,e.api_name]}))})),i}},triggerBtnAction:function(e,t,i,a,n,r){switch(e){case"create_client_script":var o=$L("crm-detailview-canvas")[0],s=Lyte.registeredMixins["crm-detailcanvas-utils"].page_uuid;if(s){var l=$L("crm-cscript")[0];l&&l.component.setData({cscriptTagShow:!1,available:CScript.Utils.is_cscript_available(),cscriptPaneShow:!0,page_uuid:s})}else Lyte.registeredMixins["crm-cscript-global-mixin"].render_create_popup(void 0,o);break;case"mark_as_completed":"Calls"===i&&Crm.fetchCallDetails("Completed",t),"Appointments"===i&&Lyte.registeredMixins["crm-appointments-mixin"].markascompletedAppointment("Appointment",n,a,"detailView",t);break;case"rescheduled_appointment_history":Lyte.registeredMixins["crm-appointments-mixin"].methods.getRescheduleHistory(t);break;case"reschedule_call":"Calls"===i&&Crm.fetchCallDetails("Scheduled",t,"detailView");break;case"cancel_call":"Calls"===i&&Crm.fetchCallDetails("Cancelled",t,"detailView");break;case"send_mail_related_mod":var d,c;if("Calls"===i)a.Who_Id?(d=a.Who_Id.id,c="Contacts"):a.What_Id&&(d=a.What_Id.id,c=a.$se_module),EntSendMail(c,d,"",moduleRecordMapping[c].singular_label,"","","","",i);break;case"start_meeting":if("start_meeting"===(a.Owner.id===Crm.userDetails.USER_ID?"start_meeting":"join_meeting"))Lyte.registeredMixins["crm-events-mixin"].startMeeting("Detail View",t);else{var u=a.$meeting_details.joinmeeting_url;networkUtils.openUrl(u)}break;case"send_recordings":Events.sharedRecorded(t);break;case"export_event":Lyte.registeredMixins["crm-events-mixin"].exportEvent(t,n,a.Event_Title);break;case"event_invitation":Events.SendMailToParticipant(t,"0");break;case"cancel_event":Events.cancelEvent(t);break;case"mark_as_temporarily_unavail":case"manage_unavailability":case"mark_as_notinuse":store.peekAll("business_hours").length?Lyte.registeredMixins["crm-services-mixin"].renderServiceAvailabilityPopup(t,e):store.findAll("business_hours").then((function(){Lyte.registeredMixins["crm-services-mixin"].renderServiceAvailabilityPopup(t,e)}));break;case"mark_as_available":Lyte.registeredMixins["crm-services-mixin"].submitServiceStatusMark(t,"Available");break;case"reschedule_appointment":Lyte.registeredMixins["crm-appointments-mixin"].setAppointmentStatus("Appointments",r.srcElement,t,a.Service_Name.id);break;case"cancel_appointment":Lyte.registeredMixins["crm-appointments-mixin"].setAppointmentStatus("Appointments",r.srcElement,t);break;case"close_task":var m=a.Owner.id!==Crm.userDetails.USER_ID;crmTasks.showMarkAsCompletedPopup(!0,m,void 0,$L("crm-detailview-canvas")[0].component,!0);break;case"add_job_sheet":Lyte.registeredMixins["crm-appointments-mixin"].showAppointmentSectionPopup(t,a.Job_Sheet_Section__s,"edit","detailView",void 0,"edit",void 0);break;case"no_redirect_edit":if("Appointments"===i){var p=$L("crm-detailview-canvas")[0];Lyte.registeredMixins["crm-canvas-router-utils"].deleteCacheData.call(Lyte.Router.getRouteInstance(),p&&p.getData("viewId"),"currentLayout")}if(["Calls","Events","Appointments"].indexOf(i)>-1)(v={from:"detailView",module:i,calleeObj:"Crm",clickId:"editbtn"}).id=t,Crm.editEntity(r,n,v);break;case"no_redirect_clone":if("Appointments"===i){p=$L("crm-detailview-canvas")[0];Lyte.registeredMixins["crm-canvas-router-utils"].deleteCacheData.call(Lyte.Router.getRouteInstance(),p&&p.getData("viewId"),"currentLayout")}var v;if(["Events","Appointments"].indexOf(i)>-1)(v={from:"detailView",module:i,calleeObj:"Crm",clickId:"clonebtn"}).id=t,"Events"===i&&(v.invitees=a.Participants),Crm.cloneEntity(r,n,v)}},triggerEventForCscriptSaveOrDelete:function(){var e=$L("crm-detailview-canvas")[0],t=e&&e.getData("module"),i=Lyte.registeredMixins["crm-detailcanvas-utils"].getLableForCscriptBtn(t,"view");$L(".canvas-element-button-id-create_client_script crm-canvas-buttons").each((function(e,t){var a=t.getData("compobj");a.display_label=i,t.setData("compobj",a),t.setData("button_label",a.display_label)}))},getLableForCscriptBtn:function(e,t){var i=I18n.getMsg("com.cscript.createclientscript");if(CScriptLib&&"view"===t){const t=Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions();if(CScript.Utils.is_cscript_available()&&Lyte.registeredMixins["crm-cscript-global-mixin"].is_cscript_enabled()&&t.find((t=>t.name===e||t.value===e))){const t=$L("crm-detailview-canvas")[0],a=t&&t.component.data.layoutId,n=t&&t.component.data.viewId,r=store.peekAll("cscript").filter((t=>"module_view_canvas"===t.definition_name&&t.selectors.Module.id===e&&t.selectors.Layout.id===a&&t.selectors.Canvas.id===n)).map((e=>e.uuid));r.length>0?(Lyte.registeredMixins["crm-detailcanvas-utils"].page_uuid=r[0],i=I18n.getMsg("crm.canvas.cscript.managecscript")):Lyte.registeredMixins["crm-detailcanvas-utils"].page_uuid=void 0}}return i},isActivitySupportedField:function(e,t){return!("Tasks"===t&&["SENDNOTIFICATION"].indexOf(e.column_name)>=0||"Calls"===t&&["CALLDURATIONINSEC","SYSTEMCF2"].indexOf(e.column_name)>=0||"Events"===t&&["PARTICIPANTID","SHAREDTO"].indexOf(e.column_name)>=0||"Services"===t&&(["MXNDUMMYCOLUMN_SERVICE","JOBSHEETSECTION"].indexOf(e.column_name)>=0||"Availability Information"===e.section[0].api_name&&"Status"!==e.api_name)||"Appointments"===t&&["JOBSHEETSECTION","ISJOBSHEETCREATED"].indexOf(e.column_name)>=0)},isFromCanvasActivityEnabledModule:function(e){if(!e)return!1;var t=Lyte.Router.getRouteInstance();return!!(t&&(["canvas","canvasrules"].indexOf(t.routeName)>=0||t.parent&&["canvas","canvasrules"].indexOf(t.parent.routeName)>=0)&&["Tasks","Calls","Events","Services","Appointments"].indexOf(e)>-1&&Crm.userDetails.isCanvasActivitySupportEnabled)},processParamsForFollowUpTask:function(e){var t,i,a=Lyte.registeredMixins["crm-detailcanvas-utils"],n=a.getValForWhatOrWhoIdFlds(e,"Who_Id"),r=a.getValForWhatOrWhoIdFlds(e,"What_Id");return n&&(n=JSON.parse(n),(t={}).id=n.id,t.name=n.name,t.record_module=n.module.api_name,t.rel_module=n.module.api_name,t=encodeURIComponent(JSON.stringify(t))),r&&(r=JSON.parse(r),(i={}).id=r.id,i.name=r.name,i.record_module=r.module.api_name,i.rel_module=r.module.api_name,i=encodeURIComponent(JSON.stringify(i))),'Lyte.registeredMixins["crm-detailview-common-utils"].createFollowUpTask("'+t+'","'+i+'")'},getMeetingStatus:function(e,t){var i=$L(".canvas-element-button-id-meeting_status");return e&&e.$event_cancelled?(i.removeClass("dNImp"),I18n.getMsg("crm.event.status.cancel.label")):"view"!==t?I18n.getMsg("crm.cal.status"):void i.addClass("dNImp")},checkButtonStatus:function(e){CrmDetailViewHandler.prototype.disableBtnMsg($(e).find("lyte-button")[0])},updateAffectedSubformAggFlds:function(e,t){var i=[];e.forEach((function(a){let n=moduleRecordMapping[t].fields.filterBy({api_name:a})[0];n&&n.subform&&-1===i.indexOf(n.subform.id)&&(Lyte.triggerEvent("cxSubformUpdated",{cxSubformId:n.subform.id,data:e}),i.push(n.subform.id))}))},invokeCscriptForCanvasDV:function(){try{if("undefined"!=typeof CanvasDetailPageHandler&&"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){canvasDetailView.restrictedLinks.forEach((e=>{CanvasDetailPageHandler.link_disable.call({id:e})}));for(const[,e]of Object.entries(canvasDetailView.cscriptFieldAttribs))for(const[t,i]of Object.entries(e))CanvasDetailPageHandler[t].call(i);for(const[,e]of Object.entries(canvasDetailView.cscriptButtonAttribs))for(const[t,i]of Object.entries(e))CanvasDetailPageHandler[t].call(i);for(const[,e]of Object.entries(canvasDetailView.uiElementIdAttribs))for(const[t,i]of Object.entries(e))CanvasDetailPageHandler[t].call(i)}}catch(e){murphy.error(e)}}},{mixins:["crm-appointments-mixin","crm-services-appointments-mixin"]});
