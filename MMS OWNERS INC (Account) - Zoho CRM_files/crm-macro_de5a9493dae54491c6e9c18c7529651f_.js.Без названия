Lyte.Component.register("crm-macro",{_template:'<template tag-name="crm-macro"> <template is="if" value="{{expHandlers(expHandlers(from,\'===\',&quot;listView&quot;),\'||\',expHandlers(from,\'===\',\'\'))}}"><template case="true"> <lyte-button lt-prop-tabindex="0" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-keydown="true" lt-prop-tab-click="false" continue-propagation="true" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getI18n(&quot;crm.macro.button.label.macro&quot;)}}&quot;,&quot;aria-expanded&quot;:&quot;{{showPopOver}}&quot;,&quot;aria-controls&quot;:&quot;MacroOptions&quot;}" lt-prop-class="macroDropBtn zc-macro mR0" class="pR mL8 macromarginRight lyteDropdownButton" lt-prop-appearance="default" id="macro_{{compId}}" lt-prop-id="macro_{{compId}}_button" data-zcqa="btn_wf_runMacro" onclick="{{action(\'showMacroDropDown\')}}" onkeydown="{{action(\'trapFocusMacro\',event)}}"> <template is="registerYield" yield-name="text"> <span class="zcref_button spanMacroBtn">{{getI18n("crm.macro.button.label.macro")}}</span> </template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-tabindex="0" lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-keydown="true" lt-prop-tab-click="false" continue-propagation="true" lt-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getI18n(&quot;crm.macro.button.label.macro&quot;)}}&quot; , &quot;role&quot; : &quot;combobox&quot; , &quot;aria-haspopup&quot; : &quot;lisbox&quot; , &quot;aria-controls&quot; : &quot;MacroOptions&quot; , &quot;aria-expanded&quot;:&quot;{{showPopOver}}&quot;}" lt-prop-class="macroDropBtn zc-macro mR0" lt-prop-disabled="{{checkButtonStatus(\'macro\',record)}}" lt-prop-appearance="default" class="pR mL8 macromarginRight lyteDropdownButton" id="macro_{{compId}}" lt-prop-id="macro_{{compId}}_button" data-zcqa="btn_wf_runMacro" onmouseover="{{action(\'checkDisableBtn\',this)}}" onmouseout="{{action(\'newhidett\')}}" onclick="{{action(\'showMacroDropDown\')}}" onkeydown="{{action(\'trapFocusMacro\',event)}}"> <template is="registerYield" yield-name="text"> <span class="zcref_button spanMacroBtn">{{getI18n("crm.macro.button.label.macro")}}</span> </template> </lyte-button> </template></template> <lyte-popover on-before-show="{{method(\'initialize\')}}" on-before-close="{{method(\'moreMacroClose\')}}" lt-prop-header-padding="10px" lt-prop-wrapper-class="macropopover" on-show="{{method(&quot;doStuff&quot;)}}" lt-prop-origin-elem="{{originElem}}{{compId}}" lt-prop-class="marcoDropBox" id="divMacro_{{compId}}" lt-prop-duration="0" lt-prop-freeze="false" lt-prop-type="box" lt-prop-show-close-button="false" lt-prop-allow-multiple="false" lt-prop-placement="{{placement}}" lt-prop-show="{{lbind(showPopOver)}}" lt-prop-width="{{width}}"> <template is="registerYield" yield-name="popover"> <template is="if" value="{{expHandlers(macros.length,\'>\',9)}}"><template case="true"> <lyte-popover-header class="macroPop"> <lyte-search tabindex="0" lt-prop-aria-attributes="{&quot;aria-placeholder&quot; : {{getI18n(&quot;crm.globalsearch.search.title&quot;)}}}" lt-prop-id="macroSearchInput" data-zcqa="txt_wf_searchTitle" lt-prop-input="{&quot;inputWrapperClass&quot;:&quot;macroSearchInput&quot;}" id="macroSearchBox" onfocus="{{action(\'onFocusSearch\',event,this)}}" onfocusout="{{action(\'onFocusOutSearch\',event,this)}}" lt-prop-placeholder="{{getI18n(\'crm.globalsearch.search.title\')}}" lt-prop-query-selector="{&quot;scope&quot;:&quot;.macrosearchbody&quot;,&quot;search&quot;:&quot;li:not(.prevent)&quot;, &quot;target&quot; : &quot;li:not(.prevent)&quot;}" style="width:100%" on-search="{{method(&quot;onSearch&quot;)}}" lt-prop-appearance="box"> </lyte-search> </lyte-popover-header> </template></template> <lyte-popover-content> <template is="if" value="{{macros.length}}"><template case="true"> <lyte-keyboard-navigator lt-prop-trigger-click="true" lt-prop-highlighted=".macroChild" lt-prop-children=".macroChild" lt-prop-skip-elements=".lyteSearchHidden" lt-prop-selected="selectedPopItem" lt-prop-if-cycle="true" lt-prop-parent="{{if(expHandlers(macros.length,\'>\',9),\'#macroSearchInput\',\'.macroDropBtn\')}}" lt-prop-scope="#MacroOptions"> <template is="yield" yield-name="keyboard-navigator-content"> <ul class="macrosearchbody {{if(expHandlers(expHandlers(macros.length,\'<\',10),\'&amp;&amp;\',expHandlers(macros.length,\'>\',0)),\'paddingTLNew\',\'\')}}" id="MacroOptions"> <template is="for" items="{{macros}}" item="item" index="index"> <li class="macroChild macrochild{{index}}" data-zcqa="macroExec_{{item.name}}" data-value="{{item.id}}" onclick="{{action(\'hideMacroDropDown\',item.id)}}"><lyte-text lt-prop-value="{{item.name}}"> </lyte-text></li> </template> </ul> </template> </lyte-keyboard-navigator> </template></template> </lyte-popover-content> <template is="if" value="{{expHandlers(permission,\'||\',expHandlers(macros.length,\'>\',0))}}"><template case="true"> <lyte-popover-footer class="{{if(macros.length,\'macroBtop\',\'\')}}"> <ul onclick="{{action(\'closeMacroPopup\')}}" onkeydown="{{action(\'trapFocusMacro\',event)}}" class="mT5 pB5" id="MacroOptionsFooter"> <template is="if" value="{{permission}}"><template case="true"> <li data-zcqa="createMacroBtn" id="createMacroBtn" tabindex="0" lt-prop-aria-keydown="true" role="button" onclick="{{action(\'createMacroClick\')}}" class="createMacroBtnTxt crmLinkColor mT5 macroChild">{{getI18n(\'crm.macro.suggest.createnew.popup.header\')}} {{macroName}}</li> </template></template> <template is="if" value="{{expHandlers(expHandlers(macros.length,\'>\',0),\'&amp;&amp;\',manageShow)}}"><template case="true"> <template is="if" value="{{expHandlers(from,\'&amp;&amp;\',ifEquals(from,\'forecast\'))}}"><template case="true"> <li data-zcqa="mngMacroBtn" id="mngMacroBtn"> <link-to class="macroChild" onclick="{{action(\'manageMacro\')}}" lt-prop-route="crm.settings.section.macro.index" lt-prop-qp="{&quot;module&quot;: &quot;Potentials&quot;}" lt-prop-target="_blank" lt-prop-rel="noopener noreferrer">{{getI18n("crm.macro.label.manage.macro")}}</link-to> </li> </template><template case="false"> <li id="mngMacroBtn" data-zcqa="mngMacroBtn" tabindex="0" lt-prop-aria-keydown="true" role="button" class="crmLinkColor mB5 macroChild accessibility-route-elem" data-cid="showMacro" data-params="{&quot;module&quot;:&quot;{{module}}&quot;,&quot;reqFrom&quot;:&quot;&quot;}">{{getI18n("crm.macro.label.manage.macro")}}</li> </template></template> </template></template> </ul> </lyte-popover-footer> </template></template> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]}]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"text",position:[1,2]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["module","module_api_name","macros","show","flag","manageShow","macroName","permission","from","record","reqforCanvas","compId","moreClickTrack","selectedIds","showPopOver","originElem","isAccessibilityConfigSupported","placement"],data:function(){return{module:Lyte.attr("string"),module_api_name:Lyte.attr("string"),macros:Lyte.attr("array"),show:Lyte.attr("boolean"),flag:Lyte.attr("boolean",{default:!1}),manageShow:Lyte.attr("boolean",{default:!0}),macroName:Lyte.attr("string",{default:""}),permission:Lyte.attr("boolean",{default:!1}),from:Lyte.attr("string",{default:"listView"}),record:Lyte.attr("object"),reqforCanvas:Lyte.attr("boolean",{default:!1}),compId:Lyte.attr("string"),moreClickTrack:Lyte.attr("boolean",{default:!1}),selectedIds:Lyte.attr("array",{default:[]}),showPopOver:Lyte.attr("boolean",{default:!1}),originElem:Lyte.attr("string",{default:"#macro_"}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),placement:Lyte.attr("string",{default:"bottomLeft"})}},methods:{initialize:function(){var e=this,t=e.getData("module"),a=moduleRecordMapping[t].api_name;e.setData("module_api_name",a);var o=e.getData("from");if(!1===e.getData("flag"))return store.findAll("macro",{module:a},"forecast"!==o).then((function(t){e.setData("macros",t),e.setData("flag",!0),document.getElementById("divMacro_"+e.data.compId).ltProp("show",!0)})),!1},onSearch:function(e){0==e.length?(this.setData("show",!0),this.setData("manageShow",!1)):(this.setData("show",!1),this.setData("manageShow",!0));var t=document.getElementById("macroSearchBox"),a=t.querySelector("input").value;t.querySelector(".lyteInputBoxSearch").id="macroFocused",a?this.setData("macroName",'"'+a+'"'):this.setData("macroName","")},doStuff:function(){var e=document.getElementById("macroSearchBox");e&&(e.querySelector("input").focus(),this.$node.constructor._actions.onFocusSearch.call(this))},moreMacroClose:function(e){if(this.getData("moreClickTrack"))return this.setData("moreClickTrack",!1),!1;var t=document.getElementById("macroSearchBox");null!==t&&t.querySelector(".lyteInputBoxSearch").classList.remove("macroFocuseSty")}},actions:{showMacroDropDown:function(){document.getElementById("divMacro_"+this.data.compId).ltProp("show",!0),"forecast"===this.getData("from")&&this.setData("flag",!1);var e=renderingUtils.windowHeight,t=this.$node.querySelector("lyte-popover").component.childComp.querySelector(".macropopover"),a=document.getElementById("macro_"+this.$node.component.data.compId).getBoundingClientRect(),o=e-a.top-a.height-20;t.getElementsByClassName("lytePopover")[0].style.overflow="auto",setTimeout((function(){t.getElementsByClassName("lytePopover")[0].style.maxHeight=o+"px"}),1e3)},hideMacroDropDown:function(e){var t;document.getElementById("divMacro_"+this.data.compId).ltProp("show",!1);var a=this.getData("from");if("listView"===a)t=customViewObject.selectedIds.join(";"),this.setData("from",""),a="";else if("forecast"===a){t=this.getData("selectedIds").join(";"),this.setData("from",""),a=""}else if("detailViewLyte"===a){this.setData("from","detailViewLyte"),a="detailView";var o=$L("#actionsDrpDwn")[0];o.component.removeFreeze(),o.component._close()}this.showMacroExecDialog(e,t,a)},onFocusSearch:function(){document.getElementById("macroSearchBox").querySelector(".lyteInputBoxSearch").classList.add("macroFocuseSty")},onFocusOutSearch:function(){var e=document.getElementById("macroSearchBox").querySelector(".lyteInputBoxSearch");e.classList.remove("macroFocuseSty"),e.id=""},createMacroClick:function(){this.setData("flag",!1),Macro.macrobtn(this.getData("module"))},closeMacroPopup:function(){document.getElementById("divMacro_"+this.data.compId).ltProp("show",!1);var e=$L("#actionsDrpDwn")[0];e&&(e.component.removeFreeze(),e.component._close())},checkDisableBtn:function(e){"forecast"!==this.getData("from")&&CrmDetailViewHandler&&CrmDetailViewHandler.prototype.disableBtnMsg(e)},manageMacro:function(){this.setData("flag",!1)},newhidett:function(){newhidett()},trapFocusMacro:function(e){if(e&&9===e.keyCode&&this.getData("showPopOver")){if(this.getData("macros")&&this.getData("macros").length>9)return;var t=$L("#MacroOptionsFooter").find("li");e.target.id===t.first()[0].id&&e.shiftKey||e.target.id===t.last()[0].id&&!e.shiftKey?($L("#macro_"+this.getData("compId")+"_button").focus(),e.preventDefault()):e.target.id==="macro_"+this.getData("compId")+"_button"&&(e.shiftKey?t.last().focus():t.first().focus(),e.preventDefault())}}},init:function(){var e=Math.random().toString(36).substring(2,15);if(this.setData("compId",e),"detailViewLyte"===this.getData("from")&&store.unloadAll("macro"),1==this.getData("reqforCanvas")){var t=moduleRecordMapping[this.getData("module")].api_name,a=this;store.findAll("macro",{module:t},!0).then((function(e){a.setData("macros",e),a.setData("flag",!0)}))}var o=this.getData("module");this.setData("permission",Crm.userDetails.permissions.Crm_Implied_Create_Activities&&Crm.userDetails.permissions["Crm_Implied_Mass_Email_"+o]&&Crm.userDetails.permissions["Crm_Implied_Mass_Update_"+o])},showMacroExecDialog:function(e,t,a){if(!1===this.getData("permission"))return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("custmr.prtl.permission.denied.error"),ltPropType:"error",ltPropDuration:"3000"}}),!1;var o={module:this.getData("module"),ruleId:e,reqFrom:a},r=new FormData;["module","ruleId","reqFrom"].forEach((function(e){o[e]&&(r.append(e,o[e]),delete o[e])}));var i=store.adapter.application.headersForRequest();networkUtils.sendxhr(Crm.getCrmBasePath()+"/Macro.do?step=showMacroExecDialog","POST",i,r).then(function(o){var r=JSON.parse(o.response),i=document.createElement("textarea");i.innerHTML=r.ruleDetails[1];var s=i.value,n={showPopup:!0,module:this.getData("module"),macroId:e,idList:t,from:a,macroName:s,emailPerm:r.emailPerm,taskPerm:r.taskPerm,updatePerm:r.updatePerm,emailAlertStr:r.alertsAlertStr,emailAlertStr1:r.alertsAlertStr1,emailSize:r.alertsListSize,taskAlertStr:r.tasksAlertStr,taskAlertStr1:r.tasksAlertStr1,taskSize:r.tasksListSize,fieldsAlertStr:r.updatesAlertStr,fieldSize:r.updatesListSize,warningList:r.warningList,warningListSize:r.warningListSize};Lyte.Component.render("crm-macro-execute",n,"body")}.bind(this)).catch(function(){Lyte.Router.getRouteInstance().transition.target.includes("newForecasts")&&setTimeout((function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.migration.general.error"),ltPropWrapperClass:"forecastAlertWrap"}})}),100),this.setData("flag",!1)}.bind(this))}},{mixins:["crm-canvas-helpers"]}),Lyte.Component.register("crm-macro-execute",{_template:'<template tag-name="crm-macro-execute"> <lyte-modal lt-prop-freeze="true" lt-prop-show-close-button="false" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-show="{{lbind(showPopup)}}" lt-prop-max-width="70%"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> {{getI18n(\'crm.macro.execute.label.header\',macroName)}} </lyte-modal-header> <lyte-modal-content class="pB0"> <template is="if" value="{{expHandlers(expHandlers(fieldSize,\'>\',0),\'&amp;&amp;\',expHandlers(updatePerm,\'===\',true))}}"><template case="true"> <div id="macroFieldUpdate" class="pB10 dF aiCenter"> <div class="w4 h4 br4 bg_crmBaseBg pR crm-macro-exec-icon-wrap fShrink0"></div> <div class="pL10 crm-subheading-font-size wbBreakWord"> {{unescape(fieldsAlertStr)}} </div> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(emailSize,\'>\',0),\'&amp;&amp;\',expHandlers(emailPerm,\'===\',true))}}"><template case="true"> <div id="macroAlert" class="pB10 dF aiCenter"> <div class="w4 h4 br4 bg_crmBaseBg pR crm-macro-exec-icon-wrap fShrink0"></div> <div class="pL10 crm-subheading-font-size wbBreakWord"> {{unescape(getI18n(\'crm.macro.execute.sendOneEmail\',emailAlertStr))}} </div> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(taskSize,\'>\',0),\'&amp;&amp;\',expHandlers(taskPerm,\'===\',true))}}"><template case="true"> <div id="macroTask" class="pB10 dF aiCenter"> <div class="w4 h4 br4 bg_crmBaseBg pR crm-macro-exec-icon-wrap fShrink0"></div> <div class="pL10 crm-subheading-font-size wbBreakWord"> <template is="if" value="{{checkStorage}}"><template case="true"> <template is="if" value="{{expHandlers(taskSize,\'>\',1)}}"><template case="true"> {{unescape(getI18n(\'crm.macro.execute.storage.assignManyTasks\',taskAlertStr,taskAlertStr1))}} </template><template case="false"> {{unescape(getI18n(\'crm.macro.execute.storage.assignOneTask\',taskAlertStr))}} </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(taskSize,\'>\',1)}}"><template case="true"> {{unescape(getI18n(\'crm.macro.execute.assignManyTasks\',taskAlertStr,taskAlertStr1))}} </template><template case="false"> {{unescape(getI18n(\'crm.macro.execute.assignOneTask\',taskAlertStr))}} </template></template> </template></template> </div> </div> </template></template> <template is="if" value="{{expHandlers(warningListSize,\'>\',0)}}"><template case="true"> <div id="macroWarning" class="pB5 pT5"> <template is="for" items="{{warningList}}" item="element" index="index"> <div class="mB5 dF aiCenter"> <crmutil-icon icon-name="warning-rounded" icon-class="zcicn-warning-rounded zcicn16 zcicn_sandal" class="crm-macro-exec-icon-wrap fShrink0 pR top2"></crmutil-icon> <div class="pL10 crm-subheading-font-size wbBreakWord"> {{element}} </div> </div> </template> </div> </template></template> </lyte-modal-content> <lyte-modal-footer> <template is="if" value="{{expHandlers(expHandlers(expHandlers(fieldSize,\'!==\',0),\'||\',expHandlers(taskSize,\'!==\',0)),\'||\',expHandlers(emailSize,\'!==\',0))}}"><template case="true"> <lyte-button data-zcqa="btn_wf_cancel" id="macExecCancelBtn" lt-prop-disabled="{{buttonDisablecancel}}" onclick="{{action(\'onCancel\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button data-zcqa="btn_wf_run" id="macExecRunBtn" lt-prop-appearance="primary" lt-prop-class="{{if(buttonDisablecancel,\'crmLoadingBtn\',\'\')}}" lt-prop-disabled="{{buttonDisablerun}}" onclick="{{action(\'executeMacro\')}}"> <template is="registerYield" yield-name="text"> <span class="{{if(buttonDisablecancel,\'vH\',\'\')}}">{{getI18n(\'crm.button.run\')}}</span> <crm-ui-loaders interaction-name="crmButtonLoader"></crm-ui-loaders> </template> </lyte-button> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(fieldSize,\'===\',0),\'&amp;&amp;\',expHandlers(taskSize,\'===\',0)),\'&amp;&amp;\',expHandlers(emailSize,\'===\',0))}}"><template case="true"> <lyte-button data-zcqa="btn_wf_cance" id="macExecCancelBtn" onclick="{{action(\'onCancel\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.nsocial.okay\')}} </template> </lyte-button> </template></template> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,3,1]}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,3,1]}]}},default:{}},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3,7]},{type:"if",position:[3,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1]}]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"attr",position:[5,3]},{type:"if",position:[5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["macroName","from","idList","module","macroId","emailPerm","taskPerm","updatePerm","emailAlertStr","emailAlertStr1","emailSize","taskAlertStr","taskAlertStr1","taskSize","fieldsAlertStr","fieldSize","showPopup","warningList","warningListSize","checkStorage","buttonDisablecancel","buttonDisablerun"],data:function(){return{macroName:Lyte.attr("string"),from:Lyte.attr("string"),idList:Lyte.attr("string"),module:Lyte.attr("string"),macroId:Lyte.attr("string"),emailPerm:Lyte.attr("boolean"),taskPerm:Lyte.attr("boolean"),updatePerm:Lyte.attr("boolean"),emailAlertStr:Lyte.attr("string"),emailAlertStr1:Lyte.attr("string"),emailSize:Lyte.attr("number"),taskAlertStr:Lyte.attr("string"),taskAlertStr1:Lyte.attr("string"),taskSize:Lyte.attr("number"),fieldsAlertStr:Lyte.attr("string"),fieldSize:Lyte.attr("number"),showPopup:Lyte.attr("boolean",{default:!1}),warningList:Lyte.attr("array"),warningListSize:Lyte.attr("number"),checkStorage:Lyte.attr("boolean",{default:Crm.userDetails.isStorageLimitReached}),buttonDisablecancel:Lyte.attr("boolean",{default:!1}),buttonDisablerun:Lyte.attr("boolean",{default:!1})}},init:function(){if(this.removeModal=Lyte.addEventListener("beforeRouteTransition",function(){this.$node.remove()}.bind(this)),"detailView"===this.getData("from")){var e=$L("#id").val();this.setData("idList",e)}if(""===this.getData("idList"))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.macro.alert.selectRecords")}}),void this.$node.remove();!0===this.getData("checkStorage")&&this.getData("fieldSize")<1&&this.getData("emailSize")<1&&this.setData("buttonDisablerun",!0)},didDestroy:function(){Lyte.removeEventListener(this.removeModal)},actions:{onCancel:function(){this.$node.remove()},executeMacro:function(){this.setData({buttonDisablerun:!0,buttonDisablecancel:!0});var e=this.getData("idList");if(void 0===e&&crmListView.getObject()&&"potentialpipeline"!==this.getData("from"))e=crmListView.getObject().selectedIds.join(";");else if(void 0===e&&void 0!==document.TransferWizardForm.chk){var t=document.TransferWizardForm.chk.length;if(e="",void 0===t){if(!document.TransferWizardForm.chk.checked)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.alert.select.one")}}),!1;e=document.TransferWizardForm.chk.value}else if(0!==t){if(0===getNoOfChecked())return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.alert.select.one")}}),!1;for(var a=0;a<t;a++)document.TransferWizardForm.chk[a].checked&&(e=""===e?document.TransferWizardForm.chk[a].value:e+";"+document.TransferWizardForm.chk[a].value)}}var o;(o=e.split(";")).length>500&&(this.$node.remove(),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.listview.maximum.records.alert","500")}}));var r={},i=moduleApiMapping[this.getData("module")];if(o.length>0&&1===o.length)r={module:i,recordId:o[0]};else if(o.length>0){r={module:i,payLoad:{data:[{ids:o}]}}}store.triggerAction("macro","run_macro",r,{macro_id:this.getData("macroId")}).then(function(e){var t=this.getData("from");if(r.hasOwnProperty("payLoad")&&isWFSchedulerUser()&&$L("#macroFieldUpdate").length>0&&"detailView"!==t&&e.meta.workflow_scheduled){var a=Lyte.Router.getRouteInstance().transition.target;if(a&&a.includes("newForecasts")){var o=document.querySelector("crm-forecast-deals-modal");o||(o=document.querySelector("crm-performance-deals-modal")),o&&(setTimeout((function(){o.component.executeMethod("refresh")}),100),this.$node.remove())}var i=e.meta.count,s=e.meta.job_id;detailView.currWFOffloadingJobIds.push(s);var n=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(i);setTimeout((function(){$L("#macroFieldUpdate").length>0&&automationActionsNotificationScheduler.showNotificationInProgress(s,void 0,i)}),n)}else crmTab.deleteFromCache(this.getData("module")),setTimeout(function(){var a=Lyte.Router.getRouteInstance().routeName,o=Lyte.Router.getRouteInstance().transition.target;if("detailView"===t&&"canvas"===a)Lyte.Router.getRouteInstance().refresh();else if(void 0!==t&&"dropDown"!==t&&""!==t&&"potentialpipeline"!==t&&"adwordCampSummary"!==t&&"adwordGroupSummary"!==t)reloadCurrentEntityView();else if("adwordCampSummary"===t||"adwordGroupSummary"===t)this.$node.remove();else if(o.includes("newForecasts")){var i=document.querySelector("crm-forecast-deals-modal");i||(i=document.querySelector("crm-performance-deals-modal")),i&&i.component.executeMethod("refresh")}else if("list"===a||"canvas"===a||"kanban"===a){var s=0;(r.hasOwnProperty("payLoad")?e.data:e.data.data).forEach((function(e){"macro cannot be executed for locked record"===e.message&&s++})),s>0?Crm.showLockedRecordCountPopup("Macro",s):crmListView.reloadCurrentListView()}else""===currCVId&&RefreshDetailsAction(this.getData("module"));this.$node.remove()}.bind(this),4500)}.bind(this)).catch(function(){if(Lyte.Router.getRouteInstance().transition.target.includes("newForecasts")){var e=document.querySelector("crm-forecast-deals-modal");e||(e=document.querySelector("crm-performance-deals-modal")),setTimeout((function(){e&&(e.component.executeMethod("refresh"),_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.migration.general.error"),ltPropWrapperClass:"forecastAlertWrap"}}))}),100)}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.migration.general.error"),ltPropType:"error",ltPropDuration:"3000"}});this.$node.remove()}.bind(this))}},methods:{}});
