Lyte.Component.register("crm-listpage-components",{_template:'<template tag-name="crm-listpage-components"> <lyte-hovercard on-hovercard-show="{{method(\'showArrowCallout\')}}" on-hovercard-hide="{{method(\'closeNoteHoverCard\')}}" id="latestNotewqpopup" lt-prop-popover-wrapper-class="latestNoteRecords" lt-prop-origin-elem=".listView_notesOrgin" lt-prop-max-width="{{noteMaxWidth}}" lt-prop-content-padding="0px 15px 15px" lt-prop-callout="true"> <template is="registerYield" yield-name="hoverCardYield"> <span class="pT15 pR15 pB2 pL15 crm-subheading-font-size crmBaseColor crm-font-bold w100_per dIB">{{getI18n("crm.listpage.recent.notes")}}</span> <lyte-hovercard-content id="noteHoverContent" class="noteHoverContent maxH350 oA {{if(ifEquals(noteMaxWidth,\'600px\'),\'maxW600\',\'maxW700\')}}"> <div class="dF"> <img alt="User Photo" class="fcUserCircleImg dIB vaM mR8" src="{{latestNotesData.imageLink}}"> <div class="dF notesRecordDetailDiv"> <template is="if" value="{{expHandlers(latestNotesData.timelineId,\'!=\',null)}}"><template case="true"> <div data-zcqa="latestNoteTimeLineNote" class="{{if(ifEquals(noteMaxWidth,\'600px\'),\'maxW600\',\'maxW700\')}}"> <crm-timeline-log-notes module="{{currentModule}}" n-id="{{latestNotesData.nId}}" item="{{latestNotesData.timelineLog}}" log-available="{{latestNotesData.logAvailable}}" fromcanvas="true"></crm-timeline-log-notes> </div> </template></template> <template is="if" value="{{latestNotesData.Note_Title}}"><template case="true"> <div id="noteHeader" data-zcqa="latestNoteHeader" class="mB8 crm-subheading-font-size crm-font-bold crmBaseColor">{{latestNotesData.Note_Title}}</div> </template></template> <div id="noteContent" data-zcqa="latestNoteContent"> <template is="if" value="{{expHandlers(latestNotesData.unformattedNoteContent,\'||\',latestNotesData.Note_Content)}}"><template case="true"> <pre class="cxNotesAddedContent notesAddedContent showFullContent noteContent wbBreakWord"><template is="if" value="{{expHandlers(latestNotesData.hasLinks,\'===\',&quot;true&quot;)}}"><template case="true"> {{cruxStringSeg(latestNotesData.unformattedNoteContent,0,latestNotesData.startPos[0])}} <template is="for" items="{{latestNotesData.startPos}}" item="startIndex" index="index"> <template is="if" value="{{expHandlers(index,\'===\',0)}}"><template case="true"> {{unescape(cruxStringSeg(latestNotesData.unformattedNoteContent,latestNotesData.startPos[index],latestNotesData.endPos[index]))}} </template><template case="false"> {{cruxStringSeg(latestNotesData.unformattedNoteContent,cruxGetItemAtIndex(latestNotesData.endPos,expHandlers(index,\'-\',1)),latestNotesData.startPos[index])}} {{unescape(cruxStringSeg(latestNotesData.unformattedNoteContent,latestNotesData.startPos[index],latestNotesData.endPos[index]))}} </template></template> </template> {{cruxStringSeg(latestNotesData.unformattedNoteContent,latestNotesData.lastIndex)}} </template><template case="false"><template is="if" value="{{expHandlers(latestNotesData.hasLinks,\'===\',&quot;false&quot;)}}"><template case="true"> {{latestNotesData.unformattedNoteContent}} </template></template></template></template></pre> </template></template> </div> <div class="mT5 dF w100_per mR10 aiCenter"> <span class="cxNotesModuleName fL" lt-prop-title="{{latestNotesData.moduleSingularLabel}}"> {{latestNotesData.moduleSingularLabel}} </span> <span class="pL5 pR5 fL">-</span> <template is="if" value="{{latestNotesData.Parent_Id.name}}"><template case="true"> <lyte-text lt-prop-title="{{latestNotesData.Parent_Id.name}}" lt-prop-value="{{{{latestNotesData.Parent_Id.name}}}}" class="maxW100"></lyte-text> </template></template> <span class="cxNotesListDot"></span> <span class="pR5 cxNotesGreyColor cxNotesModifiedTimeInfo dF aiCenter jcCenter" data-title="{{latestNotesData.modified_time_full}}" lt-prop-tooltip-config="{&quot;position&quot;: &quot;bottom&quot;, &quot;appearance&quot;: &quot;box&quot;, &quot;margin&quot;: 0, &quot;showdelay&quot;: 0, &quot;hidedelay&quot;: 0, &quot;maxdisplaytime&quot;: 5000 }" lt-prop-title="{{latestNotesData.modified_time_full}}"> <span class="timerIcon-notes mT0 fL mR5"></span> <lyte-text lt-prop-value="{{latestNotesData.modified_time}}"></lyte-text> </span> <span class="pR5 cxNotesGreyColorWithoutHover">{{getI18n(\'crm.label.simply.by\')}}</span> <lyte-text class="pR5 cxNotesGreyColor maxW100" lt-prop-title="{{latestNotesData.Modified_By.name}}" lt-prop-value="{{latestNotesData.Modified_By.name}}"></lyte-text> <template is="if" value="{{expHandlers(isClientPortalUser,\'!\')}}"><template case="true"> <template is="if" value="{{latestNotesData.isPortalUser}}"><template case="true"> <span class="fL pR5 notesgray dIB pL5 mR3 portal_roll_name h20 boxBB crm-base-font-size">{{getI18n("custmr.prtl.user.role")}}</span> </template><template case="false"><template is="if" value="{{latestNotesData.$is_shared_to_client}}"><template case="true"> <lyte-text class="cxNotesGreyColor maxW100" lt-prop-title="{{getI18n(\'custmr.prtl.notes.shrd.with.custmr\')}}" lt-prop-value="{{getI18n(\'custmr.prtl.notes.shrd.with.custmr\')}}"></lyte-text> </template></template></template></template> </template></template> </div> </div> </div> </lyte-hovercard-content> </template> </lyte-hovercard> <lyte-popover id="activitywqpopup" class="{{if(activePopoverHgt,\'290px\',\'hAuto\')}}" lt-prop-show="{{lbind(listPageActivityPopup)}}" lt-prop-freeze="true" lt-prop-allow-multiple="true" on-before-close="{{method(&quot;beforeCloseActivityPopover&quot;)}}" on-close="{{method(&quot;closeActivityPopover&quot;)}}" on-before-show="{{method(&quot;beforePopoverShow&quot;)}}" on-show="{{method(&quot;showActivityPopover&quot;)}}" lt-prop-origin-elem=".listView_activityOrgin" lt-prop-wrapper-class="wq_businesscardTooltip wq_activityPopover wq_listPopover" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="pT15 pR0 pB15 pL0"> <div class="flexAlignCenter pR15 pL20 spaceBetween"> <div class="flexAlignCenter"> <span class="crmHeadingColor m0 mR4 crm-font-bold crm-subheading-font-size">{{getI18n("crm.activity.open")}}</span> <span onclick="{{action(\'onRefreshActivity\')}}" class="icon-hover-effects icon-hover-gray-bg-nb dF jcCenter aiCenter"> <span id="reloadActivity" data-zcqa="refreshActivityData" class="zi2 zcicncss-reload zcicn-cssIcons zcicncss15 zcicn_black_mask ico-scale8 cP"></span> </span> </div> <template is="if" value="{{showActivityQuickCreate}}"><template case="true"> <lyte-button data-zcqa="createActivity" lt-prop-appearance="primary" lt-prop-class="outlineprimary ghostoutlineblue list_createActivity" lt-prop-size="small" class="mR0 {{if(restrictQuickCreate,\'disabled cNotAllowed\',\'wq_list_createActivity quickActivityMenu\')}}" lt-prop-title="{{if(restrictQuickCreate,getI18n(\'crm.creator.error.access\'))}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;bottomright&quot;, &quot;appearance&quot; : &quot;box&quot;}"> <template is="registerYield" yield-name="text">{{getI18n("crm.module.create",getI18n("crm.label.Activity"))}}</template> </lyte-button> </template></template> </div> <lyte-tabs class="lyteOuterTab wq_activityTabs" id="activityTabs" lt-prop="{&quot;height&quot; : &quot;auto&quot; }"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head class="pL7 pR7"> <template is="if" value="{{showChronologicalActivityTab}}"><template case="true"> <lyte-tab-title lt-prop-id="wq_chronologicalTab" data-zcqa="wq_chronologicalTab"> {{getI18n("crm.globalsearch.option.all")}} <span class="dIB crm-extra-small-font-size crm-font-bold pT2 pB2 pL5 pR5 mL5 br_border2 br20 aiCenter boxBB vaBottom wq_lst_activityCount crmHeadingColor"> {{chronologicalCount}} </span> </lyte-tab-title> </template></template> <template is="if" value="{{modulePermissionObj.Tasks.moduleVisibility}}"><template case="true"> <lyte-tab-title lt-prop-id="wq_taskTab" data-zcqa="wq_taskTab"> {{getI18n("Task")}}<span class="dIB crm-extra-small-font-size crm-font-bold pT2 pB2 pL5 pR5 mL5 br_border2 br20 aiCenter boxBB vaBottom wq_lst_activityCount crmHeadingColor">{{tasksCount}} </span> </lyte-tab-title> </template></template> <template is="if" value="{{modulePermissionObj.Events.moduleVisibility}}"><template case="true"> <lyte-tab-title lt-prop-id="wq_eventTab" data-zcqa="wq_eventTab"> {{getI18n("Meeting")}} <span class="dIB crm-extra-small-font-size crm-font-bold pT2 pB2 pL5 pR5 mL5 br_border2 br20 aiCenter boxBB vaBottom wq_lst_activityCount crmHeadingColor">{{eventsCount}} </span> </lyte-tab-title> </template></template> <template is="if" value="{{modulePermissionObj.Calls.moduleVisibility}}"><template case="true"> <lyte-tab-title lt-prop-id="wq_callTab" data-zcqa="wq_callTab"> {{getI18n("Call")}} <span class="dIB crm-extra-small-font-size crm-font-bold pT2 pB2 pL5 pR5 mL5 br_border2 br20 aiCenter boxBB vaBottom wq_lst_activityCount crmHeadingColor">{{callsCount}} </span> </lyte-tab-title> </template></template> <template is="if" value="{{expHandlers(modulePermissionObj.Appointments.moduleVisibility,\'&amp;&amp;\',isAppointment)}}"><template case="true"> <lyte-tab-title lt-prop-id="wq_appointmentTab" data-zcqa="wq_appointmentTab"> {{getI18n(\'Appointment\')}}<span class="dIB crm-extra-small-font-size crm-font-bold pT2 pB2 pL5 pR5 mL5 br_border2 br20 aiCenter boxBB vaBottom wq_lst_activityCount crmHeadingColor">{{appointmentsCount}} </span> </lyte-tab-title> </template></template> </lyte-tab-head> <lyte-tab-body class="wq_activtTabBody boxBB maxH300 minW60"> <template is="if" value="{{showChronologicalActivityTab}}"><template case="true"> <lyte-tab-content id="wq_chronologicalTab" class="h100_per" onscroll="{{action(\'viewMoreActivity\',this)}}"> <template is="if" value="{{showReloadProcess}}"><template case="true"> <div class="flexAlignCenter jcCenter h100_per pR listActivityTabLoader"> <crm-ui-loaders interaction-name="crmCircleLoader"></crm-ui-loaders> </div> </template><template case="false"> <template is="if" value="{{noOpenChronological}}"><template case="true"> <div class="crm-extra-medium-font-size crmNotFoundColor h100_per flexAlignCenter jcCenter">{{getI18n("crm.label.no.open.activities","Activities")}}</div> </template><template case="false"> <template is="for" items="{{activityChronological}}" item="list1" index="indexVal1"> <div class="flexAlignCenter pT9 pB9 wq_lst_activityTask pL20 pR20"> <div class="h34 w34 mR12 br18 dF aiCenter jcCenter wq_lst_activityIcons bg_crmBg4"> <span class="{{if(ifEquals(list1.$module,\'Tasks\'),\'zcicncss-new-tasks\',\'\')}} {{if(ifEquals(list1.$module,\'Events\'),\'zcicncss-new-events\',\'\')}} {{if(ifEquals(list1.$module,\'Calls\'),\'zcicncss-new-calls\',\'\')}} {{if(ifEquals(list1.$module,\'Appointments\'),\'zcicncss-new-appointments\',\'\')}} zcicn-cssIcons"></span> </div> <template is="if" value="{{expHandlers(list1.$module,\'===\',&quot;Tasks&quot;)}}"><template case="true"> <div class="crmBaseColor" data-zcqa="all_{{list1.Subject}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="taskUrl_{{list1.Subject}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{list1.$module}}&quot;,&quot;{{list1.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list1.Subject}}" lt-prop-tooltip-config="{ &quot;position&quot; : &quot;bottom&quot; }"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <template is="if" value="{{list1.Due_Date}}"><template case="true"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list1.Due_Date)}}</span> <span class="dIB radiusCircle"></span> </template></template> <span class="actitivtyDueStatus aiCenter dIF jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list1.Due_Date,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list1.Due_Date)}}"></lyte-text></span> </div> </div> </template><template case="false"><template is="if" value="{{expHandlers(list1.$module,\'===\',&quot;Events&quot;)}}"><template case="true"> <div class="crmLabelColor pR" data-zcqa="all_{{list1.Event_Title}}"> <template is="if" value="{{list1.$colour_code}}"><template case="true"> <span class="dIB w8 h8 pA meetingColorCode" style="background: {{list1.$colour_code}}"></span> </template></template> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="eventUrl_{{list1.Event_Title}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{list1.$module}}&quot;,&quot;{{list1.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list1.Event_Title}}"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list1.Start_DateTime)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list1.Start_DateTime,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list1.Start_DateTime)}}"></lyte-text></span> </div> </div> </template><template case="false"><template is="if" value="{{expHandlers(list1.$module,\'===\',&quot;Calls&quot;)}}"><template case="true"> <div class="crmBaseColor" data-zcqa="all_{{list1.Subject}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="callUrl_{{list1.Subject}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{list1.$module}}&quot;,&quot;{{list1.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list1.Subject}}"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list1.Call_Start_Time)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list1.Call_Start_Time,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list1.Call_Start_Time)}}"></lyte-text></span> </div> </div> </template><template case="false"><template is="if" value="{{expHandlers(list1.$module,\'===\',&quot;Appointments&quot;)}}"><template case="true"> <div class="crmBaseColor" data-zcqa="all_{{list1.Appointment_Name}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="appointmentUrl_{{list1.Appointment_Name}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{list1.$module}}&quot;,&quot;{{list1.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list1.Appointment_Name}}"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list1.Appointment_Start_Time)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list1.Appointment_Start_Time,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list1.Appointment_Start_Time)}}"></lyte-text></span> </div> </div> </template></template></template></template></template></template></template></template> </div> </template> </template></template> </template></template> </lyte-tab-content> </template></template> <template is="if" value="{{modulePermissionObj.Tasks.moduleVisibility}}"><template case="true"> <lyte-tab-content id="wq_taskTab" class="h100_per" onscroll="{{action(\'viewMoreActivity\',this)}}"> <template is="if" value="{{showReloadProcess}}"><template case="true"> <div class="flexAlignCenter jcCenter h100_per pR listActivityTabLoader"> <crm-ui-loaders interaction-name="crmCircleLoader"></crm-ui-loaders> </div> </template><template case="false"> <template is="if" value="{{noOpenTasks}}"><template case="true"> <div class="crm-extra-medium-font-size crmNotFoundColor h100_per flexAlignCenter jcCenter">{{getI18n("crm.label.no.open.activities","Tasks")}}</div> </template><template case="false"> <template is="for" items="{{activityTasks}}" item="list1" index="indexVal1"> <div class="flexAlignCenter pT9 pB9 wq_lst_activityTask pL20 pR20"> <div class="h34 w34 mR12 br18 dF aiCenter jcCenter wq_lst_activityIcons bg_crmBg4"> <span class="zcicncss-new-tasks zcicn-cssIcons"></span> </div> <div class="crmBaseColor" data-zcqa="task_{{list1.Subject}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="taskUrl_{{list1.Subject}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;Tasks&quot;,&quot;{{list1.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list1.Subject}}"></lyte-text> </link-to></span> <div class="flexAlignCenter"> <template is="if" value="{{list1.Due_Date}}"><template case="true"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list1.Due_Date)}}</span> <span class="radiusCircle dIB"></span> </template></template> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list1.Due_Date,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list1.Due_Date)}}"></lyte-text></span> </div> </div> </div> </template> </template></template> </template></template> </lyte-tab-content> </template></template> <template is="if" value="{{modulePermissionObj.Events.moduleVisibility}}"><template case="true"> <lyte-tab-content id="wq_eventTab" class="h100_per" onscroll="{{action(\'viewMoreActivity\',this)}}"> <template is="if" value="{{showReloadProcess}}"><template case="true"> <div class="flexAlignCenter jcCenter h100_per pR listActivityTabLoader"> <crm-ui-loaders interaction-name="crmCircleLoader"></crm-ui-loaders> </div> </template><template case="false"> <template is="if" value="{{noOpenMeetings}}"><template case="true"> <div class="crm-extra-medium-font-size crmNotFoundColor h100_per flexAlignCenter jcCenter">{{getI18n("crm.label.no.open.activities","Meetings")}}</div> </template><template case="false"> <template is="for" items="{{activityEvents}}" item="list2" index="indexVal2"> <div class="flexAlignCenter pT9 pB9 wq_lst_activityTask pL20 pR20"> <div class="h34 w34 mR12 br18 dF aiCenter jcCenter wq_lst_activityIcons bg_crmBg4"> <span class="zcicncss-new-events zcicn-cssIcons"></span> </div> <div class="crmLabelColor pR" data-zcqa="event_{{list2.Event_Title}}"> <template is="if" value="{{list2.$colour_code}}"><template case="true"> <span class="dIB w8 h8 pA meetingColorCode" style="background: {{list2.$colour_code}}"></span> </template></template> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="eventUrl_{{list2.Event_Title}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;Events&quot;,&quot;{{list2.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list2.Event_Title}}"></lyte-text> </link-to></span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list2.Start_DateTime)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list2.Start_DateTime,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list2.Start_DateTime)}}"></lyte-text></span> </div> </div> </div> </template> </template></template> </template></template> </lyte-tab-content> </template></template> <template is="if" value="{{modulePermissionObj.Calls.moduleVisibility}}"><template case="true"> <lyte-tab-content id="wq_callTab" class="h100_per" onscroll="{{action(\'viewMoreActivity\',this)}}"> <template is="if" value="{{showReloadProcess}}"><template case="true"> <div class="flexAlignCenter jcCenter h100_per pR listActivityTabLoader"> <crm-ui-loaders interaction-name="crmCircleLoader"></crm-ui-loaders> </div> </template><template case="false"> <template is="if" value="{{noOpenCalls}}"><template case="true"> <div class="crm-extra-medium-font-size crmNotFoundColor h100_per flexAlignCenter jcCenter">{{getI18n("crm.label.no.open.activities","Calls")}} </div> </template><template case="false"> <template is="for" items="{{activityCalls}}" item="list3" index="indexVal3"> <div class="flexAlignCenter pT9 pB9 wq_lst_activityTask pL20 pR20"> <div class="h34 w34 mR12 br18 dF aiCenter jcCenter wq_lst_activityIcons bg_crmBg4"> <span class="zcicncss-new-calls zcicn-cssIcons"></span> </div> <div class="crmBaseColor" data-zcqa="call_{{list3.Subject}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="callUrl_{{list3.Subject}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;Calls&quot;,&quot;{{list3.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list3.Subject}}"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list3.Call_Start_Time)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list3.Call_Start_Time,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list3.Call_Start_Time)}}"></lyte-text></span> </div> </div> </div> </template> </template></template> </template></template> </lyte-tab-content> </template></template> <template is="if" value="{{modulePermissionObj.Appointments.moduleVisibility}}"><template case="true"> <lyte-tab-content id="wq_appointmentTab" class="h100_per" onscroll="{{action(\'viewMoreActivity\',this)}}"> <template is="if" value="{{showReloadProcess}}"><template case="true"> <div class="flexAlignCenter jcCenter h100_per pR listActivityTabLoader"> <crm-ui-loaders interaction-name="crmCircleLoader"></crm-ui-loaders> </div> </template><template case="false"> <template is="if" value="{{noOpenAppointments}}"><template case="true"> <div class="crm-extra-medium-font-size crmNotFoundColor h100_per flexAlignCenter jcCenter mR10">{{getI18n("crm.label.no.open.activities","Appointments")}}</div> </template><template case="false"> <template is="for" items="{{activityAppointments}}" item="list4" index="indexVal4"> <div class="flexAlignCenter pT9 pB9 wq_lst_activityTask pL20 pR20"> <div class="h34 w34 mR12 br18 dF aiCenter jcCenter wq_lst_activityIcons bg_crmBg4"> <span class="zcicncss-new-appointments zcicn-cssIcons"></span> </div> <div class="crmBaseColor" data-zcqa="appointment_{{list4.Appointment_Name}}"> <span class="dB crm-base-font-size mB5 w280 vaBottom crm-font-semibold" data-zcqa="appointmentUrl_{{list4.Appointment_Name}}"> <link-to lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;Appointments&quot;,&quot;{{list4.id}}&quot;]" lt-prop-class="color333 vam"> <lyte-text lt-prop-tooltip-class="crmWhiteTooltip" lt-prop-value="{{list4.Appointment_Name}}"></lyte-text> </link-to> </span> <div class="flexAlignCenter"> <span class="crm-small-font-size crmLabelColor" data-zcqa="dueDate">{{getUserFormatDate(list4.Appointment_Start_Time)}}</span> <span class="radiusCircle dIB"></span> <span class="actitivtyDueStatus dIF aiCenter jcCenter boxBB br20 pR crm-extra-small-font-size {{getActivityTaskPopupClass(list4.Appointment_Start_Time,\'icon\')}}" data-zcqa="dueStatus"><lyte-text lt-prop-value="{{getActivityTaskPopupMsg(list4.Appointment_Start_Time)}}"></lyte-text></span> </div> </div> </div> </template> </template></template> </template></template> </lyte-tab-content> </template></template> </lyte-tab-body> </template> </lyte-tabs> </lyte-popover-content> </template> </lyte-popover> <lyte-menu id="createActivityMenu" lt-prop-position="down" lt-prop-event="click" lt-prop-yield="true" lt-prop-query=".quickActivityMenu" on-close="{{method(\'onQuickActMenuClose\')}}" on-open="{{method(\'onQuickActMenuOpen\')}}" on-before-open="{{method(\'onQuickActMenuBeforeOpen\')}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="if" value="{{expHandlers(modulePermissionObj.Tasks.creatable,\'&amp;&amp;\',modulePermissionObj.Tasks.moduleVisibility)}}"><template case="true"> <lyte-menu-item onclick="{{action(\'updateOptions\',\'bulktask\')}}" data-zcqa="createTask"><span class="zcicncss-new-tasks zcicn-cssIcons zcicn_black_mask mR8"></span>{{getI18n("crm.module.create","Task")}}</lyte-menu-item> </template></template> <template is="if" value="{{expHandlers(modulePermissionObj.Events.creatable,\'&amp;&amp;\',modulePermissionObj.Events.moduleVisibility)}}"><template case="true"> <lyte-menu-item onclick="{{action(\'moreActionsValue\',\'create_meetings\',this,event)}}" data-zcqa="createEvent" id="moreOptions_{{recordId}}_create_meetings"><span class="zcicncss-new-events zcicn-cssIcons zcicn_black_mask mR8"></span>{{getI18n("crm.module.create","Meeting")}}</lyte-menu-item> </template></template> <template is="if" value="{{expHandlers(modulePermissionObj.Calls.creatable,\'&amp;&amp;\',modulePermissionObj.Calls.moduleVisibility)}}"><template case="true"> <lyte-menu-item data-value="more" data-zcqa="moreOptInQAOpt_create_call" id="qAOptions_{{recordId}}_create_call" onclick="{{action(\'callMenuClick\')}}" onmouseenter="{{action(\'callsMenuOpen\',\'create_call\',this,event)}}" onmouseleave="{{action(\'callsMenuClose\',event)}}" class="cDefault"><span class="zcicncss-new-calls zcicn-cssIcons zcicn_black_mask mR8"></span>{{getI18n("crm.module.create","Call")}}<span class="dIB crmcssBaseIcon zcicn-arrow-solid-right-sm aOptMenuIcon"></span></lyte-menu-item> </template></template> <template is="if" value="{{expHandlers(expHandlers(modulePermissionObj.Appointments.creatable,\'&amp;&amp;\',isAppointment),\'&amp;&amp;\',modulePermissionObj.Appointments.moduleVisibility)}}"><template case="true"> <lyte-menu-item id="Appointments_{{recordId}}" data-zcqa="Detail_createApppointment" onclick="{{action(\'moreActionsValue\',\'create_appointment\',this,event)}}" data-relid="{{recordId}}"><span class="zcicncss-appointments zcicn-cssIcons zcicn_black_mask mR8"></span>{{getI18n("crm.module.create",\'Appointment\')}}</lyte-menu-item> </template></template> </lyte-menu-body> </template> </lyte-menu> <lyte-modal lt-prop-overlap-modal="true" lt-prop-show-close-button="false" id="notesModal" lt-prop-show="{{lbind(showNotesPopup)}}" lt-prop-offset="{&quot;right&quot;:&quot;0&quot;,&quot;top&quot;:&quot;0&quot;}" lt-prop-height="calc(100vh - 28px)" lt-prop-width="851px" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromRight&quot;}" lt-prop-allow-multiple="true" on-close="{{method(\'closeNotesPopup\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-content class="p0 wq_notesContent"> <div id="workqueueNote" class="wq_notesComp"> <span class="lyteModalClose" onclick="{{action(\'closeNoteModal\')}}" data-zcqa="closeNoteModal"></span> <crux-note on-note-added="{{method(\'onNoteAdd\')}}" on-note-deleted="{{method(\'onNoteDelete\')}}" relid="{{notesId}}" cx-prop-prefix-yield="true" cx-prop-forced-fetch="true" cx-prop-note-header-yield="true" cx-prop-module="{{currentModule}}" cx-prop-entity="{{recordObj}}" on-after-render="{{method(\'afterCruxNoteRender\')}}" cx-prop-show-notes-delete="{{cxPropShowNotesDelete}}" cx-prop-show-notes-edit="{{cxPropShowNotesEdit}}" cx-prop-show-add-note="{{cxPropShowAddNote}}"> <template is="registerYield" yield-name="cxNoteHeaderYield"> <div> <div class="crmHeadingColor flexAlignCenter"> <h2 class="p0">{{getI18n(\'crm.label.notes\')}}</h2> <span class="wq_notesSepDot dIB mL10 mR10 w5 h5 br20"></span> <span class="zcicncss-{{smallMod}} zcicn-cssIcons mR10"></span> <span class="crm-extra-medium-font-size crm-font-bold addNoteCalcWidth"> <lyte-text lt-prop-value="{{displayFieldValue}}" class="vaM"></lyte-text> </span> </div> </div> </template> <template is="registerYield" yield-name="cxNotePrefixYield"> <template is="if" value="{{expHandlers(noteData.timelineId,\'!=\',null)}}"><template case="true"> <crm-timeline-log-notes module="{{currentModule}}" n-id="{{noteData.nId}}" item="{{noteData.timelineLog}}" log-available="{{noteData.logAvailable}}" fromcanvas="true"></crm-timeline-log-notes> </template></template> </template> </crux-note> </div> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"attr",position:[3,1,1]},{type:"attr",position:[3,1,3,1]},{type:"if",position:[3,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[3,1,3,3]},{type:"if",position:[3,1,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,1,3,5,1]},{type:"if",position:[3,1,3,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"if",position:[1,0],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"attr",position:[3]},{type:"for",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]}},default:{}}]},{type:"text",position:[5]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,3,7,1]},{type:"text",position:[3,1,3,7,1,1]},{type:"attr",position:[3,1,3,7,5]},{type:"if",position:[3,1,3,7,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1,3,7,9]},{type:"attr",position:[3,1,3,7,9,3]},{type:"componentDynamic",position:[3,1,3,7,9,3]},{type:"text",position:[3,1,3,7,11,0]},{type:"attr",position:[3,1,3,7,13]},{type:"componentDynamic",position:[3,1,3,7,13]},{type:"attr",position:[3,1,3,7,15]},{type:"if",position:[3,1,3,7,15],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"attr",position:[1,1,1,3]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,9]},{type:"if",position:[1,9],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,3,3]},{type:"attr",position:[1,3,3,0]},{type:"componentDynamic",position:[1,3,3,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background: '","list1.$colour_code"]}}}}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"text",position:[1,5,1,0]},{type:"attr",position:[1,5,5]},{type:"attr",position:[1,5,5,0]},{type:"componentDynamic",position:[1,5,5,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1,0]},{type:"attr",position:[1,3,5]},{type:"attr",position:[1,3,5,0]},{type:"componentDynamic",position:[1,3,5,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,3,1,0]},{type:"attr",position:[1,3,5]},{type:"attr",position:[1,3,5,0]},{type:"componentDynamic",position:[1,3,5,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,1,1]},{type:"attr",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"attr",position:[1,3,3,1]},{type:"if",position:[1,3,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,3,3,3]},{type:"attr",position:[1,3,3,3,0]},{type:"componentDynamic",position:[1,3,3,3,0]}]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background: '","list2.$colour_code"]}}}}]}},default:{}},{type:"attr",position:[1,3,3]},{type:"attr",position:[1,3,3,1]},{type:"attr",position:[1,3,3,1,1]},{type:"componentDynamic",position:[1,3,3,1,1]},{type:"componentDynamic",position:[1,3,3,1]},{type:"text",position:[1,3,5,1,0]},{type:"attr",position:[1,3,5,5]},{type:"attr",position:[1,3,5,5,0]},{type:"componentDynamic",position:[1,3,5,5,0]}]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,7]},{type:"if",position:[3,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,1,1]},{type:"attr",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"text",position:[1,3,3,1,0]},{type:"attr",position:[1,3,3,5]},{type:"attr",position:[1,3,3,5,0]},{type:"componentDynamic",position:[1,3,3,5,0]}]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,9]},{type:"if",position:[3,9],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,1,1]},{type:"attr",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"text",position:[1,3,3,1,0]},{type:"attr",position:[1,3,3,5]},{type:"attr",position:[1,3,3,5,0]},{type:"componentDynamic",position:[1,3,3,5,0]}]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"registerYield",position:[1,1,3,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,5]},{type:"attr",position:[1,1,7,1]},{type:"componentDynamic",position:[1,1,7,1]}]},{type:"registerYield",position:[1,1,3,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]}],_observedAttributes:["listPageNoNotePopup","listPageHaveNotePopup","listPageNotesModal","listPageActivityPopup","listPageCreateActivityPopup","listPageBusinessCartPopup","listPageCallNoListPopup","showWQDateTimePopup","convertedWQDateTime","moreNotePopup","recordId","recordObj","contactRecordObj","notesSample","smallMod","moreNotes","moreNotesData","notesMoreSelected","showNotesPopup","notesLoading","leadConvertLoading","showLeadConvertPopup","businesscardData","display_field","currentModule","exactModuleApi","listPageNoActivityPopup","activityRelId","activityLoading","callContactLoading","activitySample","listPageHaveActivityPopup","hasEditPermissionForCalls","isClientPortalUser","activityTasks","activityCalls","activityEvents","activityAppointments","actActionsData","actRecordSelector","noOpenTasks","noOpenMeetings","noOpenCalls","noOpenAppointments","noOpenActivities","noOpenChronological","callsId","meetingsId","tasksId","activityId","activePopoverHgt","showActivityQuickCreate","showChronologicalActivityTab","modulePermissionObj","isAppointment","latestNotesData","showReloadProcess","featureName","showActivityPopup","refreshActivity","initializeNote","cancelNoteReq","cxPropShowNotesDelete","cxPropShowNotesEdit","cxPropShowAddNote","noteMaxWidth","related_lists"],data:function(){return{listPageNoNotePopup:Lyte.attr("boolean",{default:!1}),listPageHaveNotePopup:Lyte.attr("boolean",{default:!1}),listPageNotesModal:Lyte.attr("boolean",{default:!1}),listPageActivityPopup:Lyte.attr("boolean",{default:!1}),listPageCreateActivityPopup:Lyte.attr("boolean",{default:!1}),listPageBusinessCartPopup:Lyte.attr("boolean",{default:!1}),listPageCallNoListPopup:Lyte.attr("boolean",{default:!1}),showWQDateTimePopup:Lyte.attr("boolean",{default:!1}),convertedWQDateTime:Lyte.attr("string"),moreNotePopup:Lyte.attr("boolean",{default:!1}),recordId:Lyte.attr("string"),recordObj:Lyte.attr("object"),contactRecordObj:Lyte.attr("object"),notesSample:Lyte.attr("array"),smallMod:Lyte.attr("string"),moreNotes:Lyte.attr("boolean",{default:!1}),moreNotesData:Lyte.attr("array"),notesMoreSelected:Lyte.attr("array"),showNotesPopup:Lyte.attr("boolean",{default:!1}),notesLoading:Lyte.attr("boolean",{default:!1}),leadConvertLoading:Lyte.attr("boolean",{default:!1}),showLeadConvertPopup:Lyte.attr("boolean",{default:!1}),businesscardData:Lyte.attr("object"),display_field:Lyte.attr("string"),currentModule:Lyte.attr("string"),exactModuleApi:Lyte.attr("string"),listPageNoActivityPopup:Lyte.attr("boolean"),activityRelId:Lyte.attr("string"),activityLoading:Lyte.attr("boolean"),callContactLoading:Lyte.attr("boolean"),activitySample:Lyte.attr("array"),listPageHaveActivityPopup:Lyte.attr("boolean"),hasEditPermissionForCalls:Lyte.attr("boolean",{default:Crm.userDetails.permissions.Crm_Implied_Edit_Calls}),isClientPortalUser:Lyte.attr("boolean",{default:!("undefined"==typeof Crm||!Crm.userDetails.CLIENT_ACCOUNT)&&Crm.userDetails.CLIENT_ACCOUNT}),activityTasks:Lyte.attr("array"),activityCalls:Lyte.attr("array"),activityEvents:Lyte.attr("array"),activityAppointments:Lyte.attr("array"),actActionsData:Lyte.attr("array"),actRecordSelector:Lyte.attr("string"),noOpenTasks:Lyte.attr("boolean",{default:!1}),noOpenMeetings:Lyte.attr("boolean",{default:!1}),noOpenCalls:Lyte.attr("boolean",{default:!1}),noOpenAppointments:Lyte.attr("boolean",{default:!1}),noOpenActivities:Lyte.attr("boolean",{default:!0}),noOpenChronological:Lyte.attr("boolean",{default:!1}),callsId:Lyte.attr("string"),meetingsId:Lyte.attr("string"),tasksId:Lyte.attr("string"),activityId:Lyte.attr("string"),activePopoverHgt:Lyte.attr("boolean",{default:!0}),showActivityQuickCreate:Lyte.attr("boolean",{default:!1}),showChronologicalActivityTab:Lyte.attr("boolean",{default:!1}),modulePermissionObj:Lyte.attr("object"),isAppointment:Lyte.attr("boolean",{default:!1}),latestNotesData:Lyte.attr("object"),showReloadProcess:Lyte.attr("boolean",{default:!1}),featureName:Lyte.attr("string"),showActivityPopup:Lyte.attr("boolean"),refreshActivity:Lyte.attr("boolean",{default:!1}),initializeNote:Lyte.attr("boolean",{default:!1}),cancelNoteReq:Lyte.attr("boolean"),cxPropShowNotesDelete:Lyte.attr("boolean",{default:!0}),cxPropShowNotesEdit:Lyte.attr("boolean",{default:!0}),cxPropShowAddNote:Lyte.attr("boolean",{default:!0}),noteMaxWidth:Lyte.attr("string",{default:"600px"}),related_lists:Lyte.attr("array",{default:[]})}},init:function(){var t=0,e=["Tasks","Calls","Events"];this.getData("isAppointment")&&e.push("Appointments");var a=this.getModulePermissionObj(e);for(var o in this.setData("modulePermissionObj",a),a)a[o].creatable&&(t+=1);0===t&&this.setData("restrictQuickCreate",!0),"CHARTVIEWS"===this.getData("featureName")&&this.setData({cxPropShowNotesDelete:!1,cxPropShowNotesEdit:!1,cxPropShowAddNote:!1})},setQueueComponentActivity:function(t,e){var a=moduleRecordMapping[this.getData("currentModule")].id;switch(t){case"Tasks":e&&e[a]&&e[a].length?(this.setData({noOpenActivities:!1,noOpenTasks:!1,activityTasks:e[a]}),this.getData("recordObj").relatedTask=e):(this.getData("chronologicalCount")>0&&0!==this.getData("recordObj").tasksCount&&this.getData("TasksFetch")&&(this.setData("chronologicalCount",this.getData("chronologicalCount")-this.getData("recordObj").tasksCount),this.getData("recordObj").chronologicalCount=this.getData("chronologicalCount")),this.setData({noOpenTasks:!0,activityTasks:[],tasksCount:0}),this.getData("recordObj").relatedTask=[],this.getData("recordObj").tasksCount=0);break;case"Meetings":e&&e[a]&&e[a].length?(this.setData({noOpenActivities:!1,noOpenMeetings:!1,activityEvents:e[a]}),this.getData("recordObj").relatedMeeting=e):(this.getData("chronologicalCount")>0&&0!==this.getData("recordObj").eventsCount&&this.getData("MeetingsFetch")&&(this.setData("chronologicalCount",this.getData("chronologicalCount")-this.getData("recordObj").eventsCount),this.getData("recordObj").chronologicalCount=this.getData("chronologicalCount")),this.setData({noOpenMeetings:!0,activityEvents:[],eventsCount:0}),this.getData("recordObj").relatedMeeting=[],this.getData("recordObj").eventsCount=0);break;case"Calls":e&&e[a]&&e[a].length?(this.setData({noOpenActivities:!1,noOpenCalls:!1,activityCalls:e[a]}),this.getData("recordObj").relatedCall=e):(this.getData("chronologicalCount")>0&&0!==this.getData("recordObj").callsCount&&this.getData("CallsFetch")&&(this.setData("chronologicalCount",this.getData("chronologicalCount")-this.getData("recordObj").callsCount),this.getData("recordObj").chronologicalCount=this.getData("chronologicalCount")),this.setData({noOpenCalls:!0,activityCalls:[],callsCount:0}),this.getData("recordObj").relatedCall=[],this.getData("recordObj").callsCount=0);break;case"Appointments":e&&e[a]&&e[a].length?(this.setData({noOpenActivities:!1,noOpenAppointments:!1,activityAppointments:e[a]}),this.getData("recordObj").relatedAppointment=e):(this.getData("chronologicalCount")>0&&0!==this.getData("recordObj").appointmentsCount&&this.getData("AppointmentsFetch")&&(this.setData("chronologicalCount",this.getData("chronologicalCount")-this.getData("recordObj").appointmentsCount),this.getData("recordObj").chronologicalCount=this.getData("chronologicalCount")),this.setData({noOpenAppointments:!0,activityAppointments:[],appointmentsCount:0}),this.getData("recordObj").relatedAppointment=[],this.getData("recordObj").appointmentsCount=0);break;case"All":e&&e[a]&&e[a].length>0?(this.setData({activityChronological:e[a],listPageActivityPopup:!0}),this.getData("recordObj").relatedChronological=e):(this.setData({listPageActivityPopup:!0,setQueueComponentActivity:!0,chronologicalCount:0}),this.getData("recordObj").relatedChronological=[],this.getData("recordObj").chronologicalCount=0)}},disableNoteInput(){if(this.getData("cxPropShowAddNote")){var t=this.getData("currentModule"),e="org_based"===moduleRecordMapping[t].access_type,a=Crm.userDetails.permissions[`Crm_Implied_Create_Notes_${t}`],o=$L("crux-note")[0];if(e&&moduleRecordMapping.Notes.creatable||!e&&a)0===o.component.getData("allNotes").length&&(o.openNoteEditor(),$L(".cxNotesTextarea")[0].click());else{(o=(o=$L("crux-note lyte-input[data-zcqa='notesProcess']")[0]).component).setData("ltPropDisabled",!0);var i=document.querySelector(".notesTextInputBoxWrap");i.style.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--formBackgroundDisabled"),i.style.cursor="not-allowed",i.setAttribute("lt-prop-title",I18n.getMsg("crm.creator.error.access"));var s=$L("[data-zcqa='notesAdd']");Array.from(s).forEach((t=>{t.addEventListener("click",(function(t){t.stopImmediatePropagation(),t.preventDefault(),$L("[data-zcqa='notesCancelComment']")[0].click()}),!0),t.setAttribute("lt-prop-title",I18n.getMsg("crm.creator.error.access")),t.classList.add("disabled","cNotAllowed")}))}}},unformatNoteContents:function(t){for(var e=[],a=[],o=[],i=t.length,s=new RegExp("crm[[aA-zZ]*#[0-9]*#[0-9]*]crm","gi"),n=0;n<i;n++)if(t[n]){t[n]=t[n].replace("&#x5b;","["),t[n]=t[n].replace("&#x23;","#"),t[n]=t[n].replace("&#x5d;","]");for(var l=t[n].match(s),r=l?l.length:0,p=0;p<r;p++){var c=l[p].indexOf("#"),d=l[p].lastIndexOf("#"),m=l[p].slice(c+1,d);-1!==l[p].indexOf("user")?e.push(m):-1!==l[p].indexOf("role")?a.push(m):-1!==l[p].indexOf("group")&&o.push(m)}}return this.makeBatchRequest(e,a,o)},makeBatchRequest:function(t,e,a){var o=t.length>0,i=e.length>0,s=a.length>0,n=[];if(o)if(t.length>100)for(var l=t.length,r=0;r<l;r+=100)n.push(store.findAll("user",{type__s:"Regular User,Client Portal User,Lite User",type:"ActiveConfirmedUsers",ids:t.slice(r,r+100).join()}));else n.push(store.findAll("user",{type__s:"Regular User,Client Portal User,Lite User",type:"ActiveConfirmedUsers",ids:t.join()}));return i&&n.push(store.findAll("role",{ids:e.join()})),s&&n.push(store.findAll("user_group",{ids:a.join()})),o||i||s?Lyte.resolvePromises(n):"hasNoMention"},convertTextUrlToLink:function(t){for(var e,a,o,i,s,n,l,r,p,c,d=new RegExp(/((https?|ftps?)(:|&#x3a;)(\/\/|&#x2f;&#x2f;))((www\.){0,1}[a-zA-Z0-9-_]+(\.[a-z0-9]+)+)((:|&#x3a;)[0-9]*(\.[a-z0-9]+)*)*(((\/|&#x2f;)[^\s]*)*)|www\.([a-zA-Z0-9-_]+(\.[a-z0-9]+)+)((:|&#x3a;)[0-9]*(\.[a-z0-9]+)*)*(((\/|&#x2f;)[^\s]*)*)/),m=new RegExp("(https?|ftps?)://"),u="",y=t.split(" "),g=y.length,v=0;v<g;v++){c=(p=y[v].split("\n")).length;for(var h=0;h<c;h++){if(s="","",l=(o=d.exec(p[h]))?o.index:-1,r=o?o[0].length+o.index:0,n=p[h].substring(r>0?r:p[h].length),p[h]=p[h].substring(0,r>0?r:p[h].length),d.test(p[h])){s=p[h].substring(0,l),i=p[h].substring(l,r>0?r:p[h].length);var f=m.exec(p[h]);f=(f?"":"//")+i;var b=document.createElement("a");b.setAttribute("href",f),b.setAttribute("rel","noreferrer noopener"),b.setAttribute("target","_blank"),b.innerText=i,e=s+p[h].replace(p[h],b.outerHTML)+(n||"")}else e=p[h]+(n||"");p[h]=e}a=p.join("\n"),u+=a=0===v?a:" "+a}return u},uniqueReplText1:" cruxNoteAnchorOpen",uniqueReplText2:" cruxNoteAnchorClose",findOccurrencesOfLinks:function(t){for(var e,a,o=new RegExp("<a href=","g"),i=[],s=[],n=0,l=0;(e=o.exec(t))&&(a=e.index,-1===i.indexOf(a));)t.substring(l,a).indexOf(this.uniqueReplText1)>-1&&(a=a-(n+1)*(this.uniqueReplText1.length-"<a ".length)-n*(this.uniqueReplText2.length-"</a>".length)),l=a,i.push(a),n++;var r=new RegExp("</a>","g");for(n=0,l=0;(e=r.exec(t))&&(a=e.index+4,-1===s.indexOf(a));)t.substring(l,a).indexOf(this.uniqueReplText1)>-1&&(a=a-(n+1)*(this.uniqueReplText1.length-"<a ".length)-n*(this.uniqueReplText2.length-"</a>".length)),l=a,s.push(a),n++;return{startPos:i,endPos:s}},formatNoteTime:function(t){for(var e,a,o,i,s=t.length,n=0;n<s;n++){var l=t[n].$se_module;t[n].module=Object.values(moduleRecordMapping).find((t=>t.api_name===l)).module_name,t[n].Parent_Id&&"undefined"!=typeof moduleRecordMapping&&(t[n].moduleSingularLabel=t[n].moduleSingularLabel?t[n].moduleSingularLabel:moduleRecordMapping[t[n].module].singular_label),o=t[n].Modified_Time,e=$L.moment(o).toDate();var r=$L.moment().toDate(),p="",c=Math.floor((r.getTime()-e.getTime())/1e3),d=Math.floor(c/60),m=Math.floor(d/60);if(c<60)p=_cruxUtils.getI18n("crm.lower.now");else if(d<60)p=1===d?_cruxUtils.getI18n("crm.time.min.ago",d):_cruxUtils.getI18n("crm.time.mins.ago",d);else if(m<24)p=1===m?_cruxUtils.getI18n("crm.time.hr.ago",m):_cruxUtils.getI18n("crm.time.hrs.ago",m);else{var u=e.getFullYear(),y=r.getFullYear()-u,g=e.getMonth(),v=e.getDate(),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];p=0===y?_cruxUtils.getI18n(h[g])+" "+v:_cruxUtils.getI18n(h[g])+" "+v+" "+u}if(Lyte.Component.set(t[n],"modified_time",t[n].Created_Time===t[n].Modified_Time?p:_cruxUtils.getI18n.apply(void 0,["crm.label.edited.on"])+" "+p),"undefined"!=typeof CrmDate){i="undefined"!=typeof Crm&&Crm.userDetails.COUNTRY_LOCALE.indexOf("GB")>-1?"dd MMM":"MMM dd";var f=new CrmDate(o);a=f.getDateInPattern(i)+" "+f.getTimeInUserPattern(!1);var b="MMM dd"===i?a.slice(0,3):a.slice(3,6);a=a.replace(b,I18n.getMsg(b))}Lyte.Component.set(t[n],"modified_time_full",t[n].Created_Time===t[n].Modified_Time?a:_cruxUtils.getI18n.apply(void 0,["crm.label.edited.on"])+" "+a)}},processNotesContent:function(t){const e=t.map((t=>t.Note_Content)),a=e.length;this.formatNoteTime(t);const o=this.unformatNoteContents(e);var i=store.peekRecord("user",t[0].Modified_By.id);if(Lyte.Component.set(t[0],"imageLink",i&&i.image_link?i.image_link:"noPhoto"),Lyte.Component.set(t[0],"isPortalUser",i&&"Client Portal User"===i.type__s),o.constructor===Promise)return o.then((()=>{const o=/crm[[aA-zZ]*#[0-9]*#[0-9]*]crm/gi;for(var i=0;i<a;i++){var s="",n="";if(e[i]){e[i]=e[i].replaceAll("<a ",this.uniqueReplText1),e[i]=e[i].replaceAll("</a>",this.uniqueReplText2),e[i]=e[i].replace("&#x5b;","["),e[i]=e[i].replace("&#x23;","#"),e[i]=e[i].replace("&#x5d;","]"),s=e[i].slice(),e[i]=this.convertTextUrlToLink(e[i]);for(var l=e[i].match(o),r=l?l.length:0,p=0;p<r;p++){var c,d=l[p].indexOf("#"),m=l[p].lastIndexOf("#"),u=l[p].slice(d+1,m);-1!==l[p].indexOf("user")?(n=(c=store.peekRecord("user",u))?c.full_name:"",e[i]=e[i].replace(l[p],n?"<a href='javascript:;' class='cxLink'>"+$ESAPI.encoder().encodeForHTML(n)+",</a>":""),s=s.replace(l[p],n?n+",":"")):-1!==l[p].indexOf("role")?(n=(c=store.peekRecord("role",u))?c.name:"",e[i]=e[i].replace(l[p],n?"<a href='javascript:;' class='cxLink'>"+$ESAPI.encoder().encodeForHTML(n)+",</a>":""),s=s.replace(l[p],n?n+",":"")):-1!==l[p].indexOf("group")&&(n=(c=store.peekRecord("user_group",u))?c.name:"",e[i]=e[i].replace(l[p],n?"<a href='javascript:;' class='cxLink'>"+$ESAPI.encoder().encodeForHTML(n)+",</a>":""),s=s.replace(l[p],n?n+",":""))}}var y,g=[],v=[];e[i]&&(g=(y=this.findOccurrencesOfLinks(e[i])).startPos,v=y.endPos,e[i]=e[i].replaceAll(this.uniqueReplText1,"<a "),e[i]=e[i].replaceAll(this.uniqueReplText2,"</a>")),Lyte.Component.set(t[i],{unformattedNoteContent:e[i],actualContent:s,hasLinks:g.length>0?"true":"false",lastIndex:v.length>0?v[v.length-1]:0,endPosIdx:e[i].length,startPos:g,endPos:v})}}));if("hasNoMention"===o){var s,n=[],l=[],r=0;e.forEach(((a,o)=>{a&&(e[o]=this.replaceTagsAndLinks(a),s=this.findOccurrencesOfLinks(e[o]),n=s.startPos,l=s.endPos,r=e[o].length),Lyte.Component.set(t[o],{unformattedNoteContent:e[o],actualContent:"",lastIndex:l.length>0?l[l.length-1]:0,endPosIdx:r,startPos:n,endPos:l,hasLinks:s&&s.startPos.length>0?"true":"false"})}))}},replaceTagsAndLinks:function(t){return t=(t=t.replaceAll("<a ",this.uniqueReplText1)).replaceAll("</a>",this.uniqueReplText2),t=(t=(t=this.convertTextUrlToLink(t)).replaceAll(this.uniqueReplText1,"<a ")).replaceAll(this.uniqueReplText2,"</a>")},getUnavailableUserIds:function(t){const e=(store.peekAll("user")||[]).map((t=>t.id)),a=[];return t.forEach((t=>{const o=t.Owner.id,i=t.Modified_By.id;e.includes(o)||a.includes(o)||a.push(o),e.includes(i)||a.includes(i)||a.push(i)})),a},fetchUnavailableUsers:function(t){const e=[];for(var a=t.length,o=0;o<a;o+=100)e.push(store.findAll("user",{type__s:"Regular User,Client Portal User,Lite User",type:"ActiveConfirmedUsers",ids:t.slice(o,o+100).join()}));return Lyte.resolvePromises(e)},methods:{onNoteAdd:function(){this.setData("isNoteAddDelete",!0)},onNoteDelete:function(){this.setData("isNoteAddDelete",!0)},afterCruxNoteRender:function(t){if(Crm.userDetails.timelineRevamp){var e=this.getData("recordObj").id,a=t.data.allNotes,o=a.map((function(t){return t.Associated_Id__s})).filter((function(t){if(null!==t)return t})),i={};if(o&&o.length>0){var s={field:{api_name:"id"},comparator:"in",value:o};i.filters=s,i.include_inner_details="field_history.field_label,field_history.data_type,field_history.enable_colour_code,field_history.pick_list_values,field_history.actual_value,done_by.type__s,done_by.profile",i.include_timeline_types="signals",i.include="extension,type";var n=moduleRecordMapping[this.getData("currentModule")].id;store.triggerAction(n,"timelines",{recordId:e},i).then(function(e){var o=e.timelines,i={};o&&o.forEach((function(t){var e=t.id;i[e]=t}),i);for(var s=a.length,n=0;n<s;n++){var l=a[n];if(null!==l.Associated_Id__s){var r=i[l.Associated_Id__s];l.timelineId=l.Associated_Id__s,l.nId=l.id,r?(l.timelineLog=r,l.logAvailable=!0):(l.timelineLog=null,l.logAvailable=!1)}else l.timelineLog=null,l.timelineId=null;Lyte.arrayUtils(t.getData("allNotes"),"replaceAt",n,l)}t.setColorBox(),this.disableNoteInput()}.bind(this))}else this.disableNoteInput()}else this.disableNoteInput()},showArrowCallout:function(){$L(".latestNoteRecords").find(".lytePopoverArrowIcon")[0].style.display="block"},closeNoteHoverCard:function(){var t=$L(".showListViewIcons")[0];t&&t.classList.remove("showListViewIcons")},showLastAddedNote:function(t){const e=this,a=moduleRecordMapping[e.getData("currentModule")].api_name;var o="org_based"===moduleRecordMapping[e.getData("currentModule")].access_type,i=Crm.userDetails.permissions[`Crm_Implied_View_Notes_${e.getData("currentModule")}`];if(o&&!moduleRecordMapping.Notes.viewable||!o&&!i)return;const s=e.getData("recordObj"),n=s.id;var l=$L("#notesModal")[0];if(l&&l.component&&!l.component.getData("ltPropShow")){const o=s.lastAddedNote,i={page:1,per_page:1,sort_order:"desc",sort_by:"Created_Time"},r=(t,a)=>{l&&l.component&&!l.component.getData("ltPropShow")&&!$L(".listView_notesOrgin")[0]&&(e.setData("noteMaxWidth","600px"),this.getData("isClientPortalUser")||!a.isPortalUser&&!a.$is_shared_to_client||e.setData("noteMaxWidth","700px"),e.setData("latestNotesData",a),t.classList.add("listView_notesOrgin"),$L("#latestNotewqpopup")[0].component.setData("ltPropShow",!0),t.closest("lyte-exptable-tr").classList.add("showListViewIcons"))},p=(a,o)=>{const i=a[0].Created_By.id;store.findAll("user",{ids:i}).then((i=>{const n=e.getUnavailableUserIds(a);0===n.length?(a[0].imageLink=commonUtils.getPhotoURL(i[0].zuid),s.lastAddedNote=a[0]):o.users=e.fetchUnavailableUsers(n).then((t=>{var e=store.peekRecord("user",a[0].Modified_By.id);Lyte.Component.set(a[0],"isPortalUser",e&&"Client Portal User"===e.type__s),t[0][0]?a[0].imageLink=commonUtils.getPhotoURL(t[0][0].zuid):a[0].imageLink=commonUtils.getPhotoURL(void 0),s.lastAddedNote=a[0]})),Object.keys(o).length>0?Lyte.resolvePromises(o).then((()=>{e.getData("cancelNoteReq")||r(t,a[0])})):e.getData("cancelNoteReq")||r(t,a[0])}))};o?r(t,o):store.findAll("note",i,!1,!0,{module:a,entityId:n}).then((t=>{if(0===t.length)return;const a={};if(Crm.userDetails.timelineRevamp){const o=t.map((t=>t.Associated_Id__s)).filter((t=>null!==t));if(o.length>0){const i={filters:{field:{api_name:"id"},comparator:"in",value:o},include_inner_details:"field_history.field_label,field_history.data_type,field_history.enable_colour_code,field_history.pick_list_values,field_history.actual_value,done_by.type__s,done_by.profile",include_timeline_types:"signals",include:"extension,type"},s=moduleRecordMapping[e.getData("currentModule")].id;a.timeline=store.triggerAction(s,"timelines",{recordId:n},i).then((e=>{const a=e.timelines,o={};a&&a.forEach((t=>o[t.id]=t)),t.forEach((t=>{if(null!==t.Associated_Id__s){const e=o[t.Associated_Id__s];t.timelineId=t.Associated_Id__s,t.nId=t.id,t.timelineLog=e||null,t.logAvailable=!!e}else t.timelineLog=null,t.timelineId=null}))}))}}var o=e.processNotesContent(t);o&&o.constructor===Promise?o.then((function(){p(t,a)})):p(t,a)}))}},clickNotesBadge:function(){this.getData("initializeNote")?$L("#notesModal")[0].component.setData("ltPropReRenderModal",!0):this.setData("initializeNote",!0),this.setData({showNotesPopup:!0,notesLoading:!0,listPageNoNotePopup:!1,listPageHaveNotePopup:!1,notesSample:[],notesMoreSelected:[]});var t=this.getData("currentModule"),e=[];for(var a in this.getData("recordObj"))e.push(a);var o={},i=[];moduleRecordMapping[t].business_card_fields.forEach((function(t){e.includes(t.api_name)||i.push(t.api_name)})),o.fields=i.join(","),o.approved="both",store.findRecord(moduleRecordMapping[this.getData("currentModule")].id,this.getData("recordId"),o,void 0,!0,{}),detailView=detailView||{},detailView.currentModule=t;var s=t.toLowerCase();"deals"===s&&(s="potentials"),"Potentials"===t&&(t="Deals"),"custom"===moduleRecordMapping[t].generated_type&&(s="org_based"===moduleRecordMapping[t].access_type?"new-custommodule":"new-teammodule");var n=this.getData("exactModuleApi"),l=this.getData("businesscardData").data[this.getData("display_field")];this.setData({smallMod:s,exactModuleApi:n,displayFieldValue:l})},clickActivityBadge:function(){var t=this.getData("recordObj").id;this.setData({showReloadProcess:!0,activityLoading:!0,listPageNoActivityPopup:!1,listPageHaveActivityPopup:!1,activitySample:[],activityMoreSelected:[],noOpenActivities:!0,noOpenTasks:!1,noOpenMeetings:!1,noOpenCalls:!1,noOpenAppointments:!1,noOpenChronological:!1});var e=this.getData("recordObj"),a=this.getData("tasksId"),o=this.getData("meetingsId"),i=this.getData("callsId"),s=this.getData("chronologicalId"),n=this.getData("appointmentsId"),l=this.getData("refreshActivity"),r={};let p={relatedId:t,approval_state:"approved,approval_process_pending,approval_process_rejected",approved:"both",per_page:10,page:1};var c=this.getModulePermissionObj(["Tasks","Calls","Events","Appointments"]),d=this.getData("currentModule"),m=moduleRecordMapping[d].id,u=moduleRecordMapping[d].api_name;let y={from:"Chronological"};p.relationId=s,p.type="grouped";var g=[],v=!this.getData("showChronologicalActivityTab")&&e.relatedTask||e.relatedMeeting||e.relatedCall||!!this.getData("isAppointment")&&e.relatedAppointment;if(v&&!1===l){this.setData("showReloadProcess",!1);var h={...void 0!==e.relatedTask&&{Tasks:e.relatedTask},...void 0!==e.relatedMeeting&&{Meetings:e.relatedMeeting},...void 0!==e.relatedCall&&{Calls:e.relatedCall}};for(var f in this.getData("isAppointment")&&e.relatedAppointment&&(h.Appointments=e.relatedAppointment),this.getData("showChronologicalActivityTab")&&(h.All=e.relatedChronological),v&&(this.getMethods("ifActivityAvail")&&this.executeMethod("ifActivityAvail",!0),this.setData({listPageActivityPopup:!0})),h)this.setQueueComponentActivity(f,h[f]),"All"===f&&h[f]&&h[f][m]&&h[f][m].length>0&&this.getMethods("ifActivityAvail")&&this.executeMethod("ifActivityAvail",!0);return void this.setData({tasksCount:e.tasksCount,eventsCount:e.eventsCount,callsCount:e.callsCount,appointmentsCount:e.appointmentsCount,chronologicalCount:e.chronologicalCount,refreshActivity:!1})}if(!1===l){commonUtils.showHideLoadingDiv(!0);["tasksCount","eventsCount","callsCount","appointmentsCount","chronologicalCount"].forEach((t=>this.setData(t,0)))}const b=()=>{commonUtils.showHideLoadingDiv(!1),this.setData("listPageActivityPopup",!0),C();var t=$L(".wq_activtTabBody")[0];t&&(t.style.height="285px")},C=()=>{const s=(t,e,a)=>{e&&a&&(delete p.type,p.relationId=a,r[t.toLowerCase()]=store.findAll(m,p,!1,!1).then((e=>{this.setData(t+"Fetch",!0),this.setQueueComponentActivity(t,e)}),(()=>{this.setData(t+"Fetch",!0),this.setQueueComponentActivity(t,{})})),g.push({related_list:{id:a}})),a||(this.setData(t+"Fetch",!0),this.setQueueComponentActivity(t,{}))};s("Tasks",c.Tasks.moduleVisibility,a),s("Meetings",c.Events.moduleVisibility,o),s("Calls",c.Calls.moduleVisibility,i),c.Appointments&&c.Appointments.moduleVisibility&&n&&this.getData("isAppointment")&&s("Appointments",!0,n),r.rlCount=store.triggerAction("dummy","rlCount",{url:"/crm/v4/"+u+"/"+t+"/actions/get_related_records_count",method:"POST",payLoad:{get_related_records_count:g}},null,"POST").then(function(t){var s=0;t.get_related_records_count.forEach(function(t){if("INVALID_DATA"!==t.code){var l=t.related_list.id;l===a?(t.count=this.getData("TasksFetch")&&this.getData("noOpenTasks")?0:t.count,this.setData("tasksCount",t.count),e.tasksCount=t.count):l===o?(t.count=this.getData("MeetingsFetch")&&this.getData("noOpenMeetings")?0:t.count,this.setData("eventsCount",t.count),e.eventsCount=t.count):l===i?(t.count=this.getData("CallsFetch")&&this.getData("noOpenCalls")?0:t.count,this.setData("callsCount",t.count),e.callsCount=t.count):l===n&&(t.count=this.getData("AppointmentsFetch")&&this.getData("noOpenAppointments")?0:t.count,this.setData("appointmentsCount",t.count),e.appointmentsCount=t.count),s+=t.count}}.bind(this)),s=this.getData("noOpenChronological")?0:s,this.setData("chronologicalCount",s),e.chronologicalCount=s}.bind(this),function(){e.tasksCount=0,e.eventsCount=0,e.callsCount=0,e.appointmentsCount=0,e.chronologicalCount=0,this.setData("chronologicalCount",0)}.bind(this)),Lyte.resolvePromises(r).then(function(){this.setData({showReloadProcess:!1,TasksFetch:!1,MeetingsFetch:!1,CallsFetch:!1,Appointments:!1,refreshActivity:!1})}.bind(this))};if(this.getData("showChronologicalActivityTab"))return store.findAll(m,p,!1,!1,y).then(function(t){delete p.type,e.relatedChronological=t;var a=t[m].length,o=60*a>285?285:60*a,i=$L(".wq_activtTabBody")[0];if(i&&(i.style.height=o+"px"),commonUtils.showHideLoadingDiv(!1),!(t[m].length>0))return e.relatedTask=void 0,e.relatedMeeting=void 0,e.relatedCall=void 0,e.relatedAppointment=void 0,e.$upcoming_activity=void 0,this.getMethods("ifActivityAvail")&&this.executeMethod("ifActivityAvail",!1),this.setData({listPageActivityPopup:!1,showReloadProcess:!1,noOpenChronological:!0}),!1;this.getMethods("ifActivityAvail")&&this.executeMethod("ifActivityAvail",!0),this.setData("noOpenChronological",!1),this.setQueueComponentActivity("All",t),C()}.bind(this),function(){this.setData({noOpenChronological:!0}),b()}.bind(this));b()},onQuickActMenuClose:function(){this.getData("recordObj").$upcoming_activity||$L(".activityBadgeActive").removeClass("activityBadgeActive"),$L("#activitywqpopup")[0].component.getData("ltPropShow")||$L(".listViewRowMenuSelected").removeClass("listViewRowMenuSelected"),this.setData("isActivityMenuActive",!1)},onQuickActMenuOpen:function(){this.setData("isActivityMenuActive",!0)},onQuickActMenuBeforeOpen:function(t,e,a){if(this.getMethods("onBeforeActivityMenuOpen"))return this.executeMethod("onBeforeActivityMenuOpen",t,e,a)},closeNotesPopup:function(){var t=$L("crux-note")[0].component,e=this.getData("recordObj");if(t&&e.noteCount!==t.getData("allNotesCount")){e.count=t.getData("allNotesCount");const a=t=>t.reduce(((t,e)=>{const a=$L.moment(t.Created_Time).toDate();return $L.moment(e.Created_Time).toDate()>a?e:t}));e.lastAddedNote=t.getData("allNotesCount")>0?a(t.getData("allNotes")):null}$L("#latestNotewqpopup")[0].component.setData("ltPropShow",!1),$L(".listViewRowMenuSelected").removeClass("listViewRowMenuSelected"),this.getData("isNoteAddDelete")&&(store.findRecord(moduleRecordMapping[this.getData("currentModule")].id,this.getData("recordId"),{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission",cvid:moduleRecordMapping[this.getData("currentModule")].cvid},void 0,!0,{}).then(function(){var t=$L("crm-list-view")[0].component;t&&t.refreshRecord()}.bind(this)),this.setData("isNoteAddDelete",!1)),this.setData("recordId",void 0)},showActivityPopover:function(){for(var t=$L("lyte-tab-content"),e=t.length,a=0;a<e;a++)t[a].scrollTop=0;this.getData("showChronologicalActivityTab")&&$L("#activityTabs")[0].openTab("wq_chronologicalTab");var o=$L(".wq_activityTabs lyte-tab-head .lyteOuterActiveTab")[0];o.style.width="61px",Crm.userDetails.RTL_ENABLED?o.style.right="15px":o.style.left="15px"},closeActivityPopover:function(){this.setData({activePopoverHgt:!1,activityPopoverActive:!1});var t=$L(".listView_activityOrgin")[0];t&&t.classList.remove("listView_activityOrgin")},beforeCloseActivityPopover:function(){if(this.getData("callMenuClick"))return this.setData("callMenuClick",!1),!1;$L(".activityBadgeActive").removeClass("activityBadgeActive").parents("lyte-exptable-tr").removeClass("listViewRowMenuSelected")},beforePopoverShow:function(){var t=285;if(this.getData("showChronologicalActivityTab")&&(document.getElementById("activityTabs").openTab("wq_chronologicalTab"),this.getData("activityChronological"))){var e=this.getData("activityChronological").length;t=60*e>t||0===e?t:60*e}$L(".wq_activtTabBody")[0].style.height=t+"px"}},actions:{closeNoteModal:function(){$L("#notesModal")[0].component.setData("ltPropShow",!1)},onRefreshActivity:function(){this.setData("refreshActivity",!0),this.executeMethod("clickActivityBadge")},callMenuClick:function(){this.setData("callMenuClick",!0)},viewMoreActivity:function(t){var e=this.getData("recordObj"),a=$L(t),o=a.outerHeight(),i=a.scrollTop();if(a[0].scrollHeight<=o+i&&i>0){let a={approval_state:"approved,approval_process_pending,approval_process_rejected",approved:"both",per_page:10};var s,n,l=t.id,r={};switch(l){case"wq_chronologicalTab":a.type="grouped",s=this.getData("chronologicalId"),n=e.relatedChronological.info,r.from="Chronological";break;case"wq_taskTab":s=this.getData("tasksId"),n=e.relatedTask.info;break;case"wq_eventTab":s=this.getData("meetingsId"),n=e.relatedMeeting.info;break;case"wq_callTab":s=this.getData("callsId"),n=e.relatedCall.info;break;case"wq_appointmentTab":s=this.getData("appointmentsId"),n=e.relatedAppointment.info}if(n&&n.more_records){a.page=n.page+1,a.relatedId=this.getData("recordId"),a.relationId=s;var p=moduleRecordMapping[this.getData("currentModule")].id;store.findAll(p,a,!1,!1,r).then(function(t){var a;if(t[p]){switch(l){case"wq_chronologicalTab":Lyte.arrayUtils(this.getData("activityChronological"),"concat",t[p]),a="relatedChronological";break;case"wq_taskTab":Lyte.arrayUtils(this.getData("activityTasks"),"concat",t[p]),a="relatedTask";break;case"wq_eventTab":Lyte.arrayUtils(this.getData("activityEvents"),"concat",t[p]),a="relatedMeeting";break;case"wq_callTab":Lyte.arrayUtils(this.getData("activityCalls"),"concat",t[p]),a="relatedCall";break;case"wq_appointmentTab":Lyte.arrayUtils(this.getData("activityAppointments"),"concat",t[p]),a="relatedAppointment"}t[p]=e[a][p],e[a]=t}}.bind(this))}}},updateOptions:function(t){crmListView.startIndex[customViewObject.fromIndex]?crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]+1:crmListView.startIndex[customViewObject.fromIndex]=1,customViewObject.selectedIdForQuickAction=[this.getData("recordId")],this.updateActions(t,"quickAction",this.getData("recordId"),null,this.getData("currentModule"))},moreActionsValue:function(t,e,a){this.moreActionsValue(t,e,a,this.getData("entityId"))},callsMenuOpen:function(t,e,a){if("create_call"===t&&isNewCallView)this.moreActionsValue(t,e,a,this.getData("recordId"));else{var o=$L("#manualCallListPopover");o[0]&&o[0].ltProp({show:!1})}},callsMenuClose:function(t){if(!(t.relatedTarget._callee&&"CRM-MANUAL-CALL-LIST"===t.relatedTarget._callee.nodeName||void 0!==t.relatedTarget.className&&-1!==t.relatedTarget.className.indexOf("aOptMenuIcon")||void 0!==t.relatedTarget.id&&-1!==t.relatedTarget.id.indexOf("_create_call")||void 0!==t.fromElement&&-1!==t.fromElement.id.indexOf("_create_call")||void 0!==t.currentTarget.id&&-1!==t.currentTarget.id.indexOf("_create_call"))){var e=$L("#manualCallListPopover");e[0]&&e[0].ltProp({show:!1})}}}},{mixins:["crm-view-utils"]});
