Lyte.Component.register("crm-custom-filter",{_template:'<template tag-name="crm-custom-filter"> <div id="lv_left_filter" role="{{if(filter_status,\'complementary\',\'\')}}" tabindex="-1" lt-prop-landmark="true" lt-prop-landmark-label="{{getI18n(\'crm.landmark.comp\',\'crm.report.wizard.criteria.advFilters\')}}" aria-label="{{getI18n(\'crm.report.wizard.criteria.advFilters\')}}" class="cvLeftPane pR newListOLY {{if(filter_status,\'filterEnableReq\',\'\')}}"> <template is="if" value="{{expHandlers(checkComparison(savedFilters.length,0,\'!=\'),\'&amp;&amp;\',expHandlers(module_info.zia_view,\'!\'))}}"><template case="true"> <div class="pR searchSaveContainer {{if(isSavedFilterStatus,\'dropSavedFilter\',\'\')}}"> <div class="showSaveFilter cvLPHead pB10" onclick="{{action(\'viewSavedFilter\')}}" role="accordion" tabindex="0" aria-labelledby="savedFilters filterCount" aria-controls="listOfSavedFilter"> <span class="savedFilterheader crm-font-bold" id="savedFilters">{{getI18n(\'crm.filter.header.saved.filters\')}}</span><span class="cvFltCnt mL10" data-zcqa="cv_filterCnt" id="filterCount">{{savedFilters.length}}</span> </div> <div id="listOfSavedFilter" class="listOfSavedFilter"> <ul id="savedFilterSort" class="p0 m0 savedItem" role="list"> <template is="for" items="{{savedFilters}}" item="filter" index="index"> <li id="savedItem_{{index}}" class="cvSavedFilterLi {{if(checkComparison(appliedFilterId,filter.id,\'=\'),\'bC\',\'\')}}" onclick="{{action(\'applyCurrentFilter\',filter.id,index,module_info.api_name)}}" tabindex="0" lt-prop-aria-keydown="true" role="listitem" aria-labelledby="filter_{{index}}"> <div class="filterNameLabel flexAlignCenter"> <span class="zcicncss-drag {{if(expHandlers(smartFiltersRevampEnabled,\'&amp;&amp;\',expHandlers(savedFilters.length,\'>\',1)),\'zcicn-cssIcons zcicn_black_mask cMove\',\'\')}} mR10"></span> <lyte-text id="filter_{{index}}" class="crm-base-font-size dIB vaT mR10 crmEllipticText savedFilterText cP" lt-prop-title="{{filter.name}}" lt-prop-tooltip-config="{&quot;showdelay&quot;:600,&quot;appearance&quot;:&quot;box&quot; }" data-zcqa="cv_filterName" lt-prop-value="{{filter.name}}"></lyte-text> <template is="if" value="{{isFilterAvailable}}"><template case="true"> <template is="if" value="{{fetchCountValues}}"><template case="true"> <template is="if" value="{{checkComparison(filter.count,undefined,\'!=\')}}"><template case="true"><template is="if" value="{{checkComparison(filter.count,\'-\',\'!=\')}}"><template case="true"><template is="if" value="{{expHandlers(filter.count,\'>=\',100000)}}"><template case="true"> <span class="cvFltCnt" data-zcqa="cv_filterCnt" title="{{formatDecimalValue(filter.count)}}">99,999+</span> </template><template case="false"> <span class="cvFltCnt" data-zcqa="cv_filterCnt">{{filter.count}}</span> </template></template></template></template></template><template case="false"> <span class="cvFltCnt" data-zcqa="cv_filterCnt"><img src="{{getCrmClientImageUrl(\'moreloadingNew.gif\')}}" alt="loadingimage" width="10px;"></span> </template></template></template></template> <span id="itemMenu_{{index}}" class="savedFilterOption icon-hover-effects pA right8 topcenter cP zi2" filter_id="{{filter.id}}" index="{{index}}" onclick="{{action(\'stop_Prop\')}}" tabindex="0" lt-prop-aria-keydown="true" role="button" aria-label="{{getI18n(\'crm.nsocial.tab.more.options\')}}"><span class="zcicncss-morehr zcicn-cssIcons zcicn_black_mask zi2"></span></span> </template></template> </div> </li> </template> </ul> </div> </div> </template></template> <form name="customViewSmartFilters" onsubmit="{{action(\'preventFromOnSubmit\',event)}}"> <div class="cvFilters pT10"> <crux-smart-filter id="customFilter" cx-prop-is-special-fields="{{isSystemFilterNeeded}}" cx-prop-blocked-reason="{{lbind(isBlockedReason)}}" cx-prop-fields="{{filterFields}}" cx-prop-module-display-field="{{moduleDisplayField}}" cx-prop-search-label="{{I18nDynamicKey(\'crm.label.filter.module\',\'\',module_info.plural_label)}}" cx-prop-search="true" cx-prop-enable-scroll-loading="true" cx-prop-module="{{moduleName}}" class="smartFilter_{{module_info.module_name}} {{if(preventUserAction,\'eventNone\',\'\')}}" cx-prop-prevent-ui-type="{{preventUiType}}" cx-prop-prevent-column-name="{{preventColumnName}}" on-value-change="{{method(\'onValueChange\')}}" on-field-change="{{method(\'onFieldChanged\')}}" cx-prop-boundary="{{setboundary}}" cx-prop-display-as-accord="{{displayAsAccodion}}" cx-prop-new-list-key="{{cxPropNewListKey}}" is-from-modal="false" cx-prop-common-info="{{cxPropCommonInfo}}" cx-prop-group-support="{{isGroupCriteriaNeeded}}" cx-prop-role-support="{{isRolesGroupCriteriaEnabled}}" cx-prop-child-modules="{{supportedRelatedModules}}" cx-prop-child-field-limit="5" cx-prop-related-module-mapping="{{relatedModulesMapping}}" cx-prop-child-field-limit-tooltip="{{getI18n(\'crm.smart.filter.child.fields.limit\',5)}}" cx-prop-related-modules-limit="3" cx-prop-related-modules-limit-msg="{{getI18n(\'crm.smart.filter.related.modules.limit\')}}" cx-prop-related-modules-limit-msg-note="{{getI18n(\'crm.smart.filter.related.modules.limit.note\',3)}}" support-related-modules="{{lbind(supportRelatedModules)}}" set-conditions="{{method(\'setConditions\')}}" cx-prop-aria="{{isAccessibilityConfigSupported}}" on-before-render="{{method(\'onBeforeRender\')}}" cx-prop-cross-filter-translations="{{crossFilterTranslations}}"> </crux-smart-filter> </div> <template is="if" value="{{isApplyFilter}}"><template case="true"> <div class="footerLV footerActionEle"> <lyte-button id="applyBtn" class="mB5 mL0" lt-prop-class="maxW250 toEllipsis oH" lt-prop-appearance="primary" lt-prop-type="submit" onclick="{{action(\'applyFilterSubmit\',module_info.api_name,isFromModal)}}" data-zcqa="dash_listView_submit"><template is="registerYield" yield-name="text">{{getI18n(\'crm.button.apply.filter\')}}</template></lyte-button> <span id="clearBtn" tabindex="0" role="button" lt-prop-aria-keydown="true" aria-label="{{getI18n(\'crm.title.clear.name\')}}" class="clear newgraybtn dIB" onclick="{{action(\'clearAllFilter\',isFromModal,module_info.api_name)}}" cursor="pointer">{{getI18n(\'crm.title.clear.name\')}}</span> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(isSaveFilter,\'&amp;&amp;\',expHandlers(clientAccount,\'!\')),\'&amp;&amp;\',expHandlers(isFromModal,\'!\')),\'&amp;&amp;\',showSaveFilterInCF)}}"><template case="true"> <div class="saveAndCancel newSaveAndCancel footerActionEle"> <lyte-button id="saveBtn" lt-prop-tooltip-config="{&quot;position&quot; : &quot;top&quot;}" lt-prop-disabled="{{if(expHandlers(savedFilters.length,\'>=\',smartFiltersLimit),if(expHandlers(isSameFilterId,\'||\',appliedFilterId),\'false\',\'true\'),\'false\')}}" lt-prop-title="{{if(expHandlers(savedFilters.length,\'>=\',smartFiltersLimit),if(expHandlers(isSameFilterId,\'||\',appliedFilterId),\'\',getI18n(\'crm.warning.filter.limit.exceed.new\',smartFiltersLimit)),\'\')}}" lt-prop-appearance="primary" onclick="{{action(\'saveNewFilter\',module_info.api_name)}}" data-zcqa="dash_listView_save"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.email.save.filter\')}} <template is="if" value="{{appliedFilterId}}"><template case="true"> <span class="dIB downAr filter_savedropdown"></span></template></template> </template> </lyte-button> <span id="cancelBtn" class=" clear newgraybtn" data-zcqa="dash_listView_save_cancel" onclick="{{action(\'cancelAppliedFilter\')}}" cursor="pointer">{{getI18n(\'Cancel\')}}</span> <template is="if" value="{{expHandlers(appliedFilterId,\'&amp;&amp;\',expHandlers(preventSaveFilter,\'!\'))}}"><template case="true"> <lyte-menu id="saveMenu" lt-prop-position="up" lt-prop-yield="true" lt-prop-freeze="false" lt-prop-event="mouseenter" lt-prop-query="#saveBtn" on-menu-click="{{method(\'getMenuSelectItem\')}}" lt-prop-wrapper-class="moreActionListview"> <template is="registerYield" yield-name="yield"> <lyte-menu-body class="newLvDropdown"> <lyte-menu-item class="crm-base-font-size {{if(expHandlers(savedFilters.length,\'>=\',smartFiltersLimit),\'customviewNoHover\')}}" data-value="save_new" lt-prop-title="{{if(expHandlers(savedFilters.length,\'>=\',smartFiltersLimit),getI18n(\'crm.warning.filter.limit.exceed.new\',smartFiltersLimit),\'\')}}" lt-prop-tooltip-config="{ &quot;position&quot; : &quot;right&quot; , &quot;appearance&quot; : &quot;callout&quot; , &quot;maxdisplaytime&quot; : 5000 }" data-zcqa="dash_lv_menu_save_as_new"> <lyte-menu-label class="{{if(expHandlers(savedFilters.length,\'>=\',smartFiltersLimit),\'customViewDisabled\')}}"> {{getI18n(\'crm.button.saveAsNewAndRun\')}} </lyte-menu-label> </lyte-menu-item> <lyte-menu-item class="crm-base-font-size" data-value="save" data-zcqa="dash_lv_menu_save"> <lyte-menu-label> {{getI18n(\'Save\')}} </lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> </template></template> </div> </template></template> </form> <lyte-menu lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-position="down" lt-prop-yield="true" lt-prop-freeze="true" lt-prop-event="click" lt-prop-query=".savedFilterOption" on-menu-click="{{method(\'getMenuSelectItem\')}}" lt-prop-wrapper-class="moreActionListview" on-before-open="{{method(&quot;saveEditOption&quot;)}}" on-close="{{method(&quot;saveEditOptionRemove&quot;)}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body class="newLvDropdown"> <lyte-menu-item data-value="rename" data-zcqa="renamefilter"> <lyte-menu-label id="renamefilter">{{getI18n(\'crm.label.rename\')}}</lyte-menu-label> </lyte-menu-item> <lyte-menu-item data-value="delete" data-zcqa="deletefilter"> <lyte-menu-label id="deletefilter">{{getI18n(\'crm.button.delete\')}}</lyte-menu-label> </lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-modal lt-prop-yield="true" id="saveFilterModel" lt-prop-show="{{lbind(filterModalObj.showNewFilterModal)}}" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-allow-multiple="true" lt-prop-freze="true" lt-prop-show-close-button="false" lt-prop-wrapper-class="saveAndRenameModel newSaveandRenameModel" on-show="{{method(\'inputFocus\')}}"> <template is="registerYield" yield-name="modal"> <form> <lyte-modal-header>{{filterModalObj.currentModelHeader}}</lyte-modal-header> <lyte-modal-content> <crux-form-component> <template is="registerYield" yield-name="cruxFormComponent"> <lyte-input lt-prop-appearance="box" lt-prop-autofocus="true" lt-prop-value="{{lbind(filterModalObj.filterName)}}" lt-prop-maxlength="100" lt-prop-type="text" data-zcqa="SavedFiltername" class="lv_CFilterName crmBoxInput crmFormComponentRow crmSingleField" id="SaveFiltername" lt-prop-label="{{getI18n(\'crm.email.filter.placeholder1\')}}"> </lyte-input> </template> </crux-form-component> </lyte-modal-content> <lyte-modal-footer> <lyte-button id="filterModalCancelBtn" onclick="{{action(\'closeModal\')}}" data-zcqa="modalCancelFilter"> <template is="registerYield" yield-name="text">{{getI18n(\'Cancel\')}}</template> </lyte-button> <lyte-button lt-prop-appearance="primary" lt-prop-class="primarybtn mR0" data-zcqa="modalSaveFilter" id="filterModalSaveBtn" lt-prop-type="submit" onclick="{{action(\'SaveNewAndRenameFilter\',this)}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Save\')}}</template> </lyte-button> </lyte-modal-footer> </form> </template> </lyte-modal> <lyte-modal lt-prop-yield="true" id="deleteFilterModel" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-allow-multiple="true" lt-prop-show="{{lbind(filterModalObj.showDeleteFilterModal)}}" lt-prop-width="600px" lt-prop-freze="false" lt-prop-wrapper-class="deleteModel crmBoxModal" on-show="{{method(\'deleteModalOpen\')}}" on-close="{{method(\'closeDeleteModal\')}}" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <form> <lyte-modal-header class="aligncenter"> {{filterModalObj.currentModelHeader}} </lyte-modal-header> <lyte-modal-content class="aligncenter"> <p class="crm-small-font-size">{{getI18n(\'crm.scoringrule.schedule.heading.note\')}}</p> <div class="dN"> <lyte-input lt-prop-autofocus="true" lt-prop-type="text" lt-prop-direction="horizontal"> </lyte-input> </div> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button data-zcqa="PupHome_cancelbtn" onclick="{{action(\'closeModal\')}}"><template is="registerYield" yield-name="text">{{getI18n("crm.button.cancel")}}</template></lyte-button> <lyte-button id="deleteBtn" lt-prop-appearance="failure" data-zcqa="PupHome_button_deletebtn" lt-prop-type="submit" onclick="{{action(\'deleteSavedFilter\')}}"><template is="registerYield" yield-name="text">{{getI18n(\'crm.button.yes.delete.it\')}}</template></lyte-button> </lyte-modal-footer> </form> </template> </lyte-modal> <lyte-messagebox id="SuccessMsg"></lyte-messagebox> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,2,0]},{type:"attr",position:[1,3,1,1]},{type:"for",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]}]}},default:{}}]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"attr",position:[1,3,3]},{type:"if",position:[1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[1,3,5]},{type:"if",position:[1,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[0]},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,5]},{type:"registerYield",position:[1,5,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,5]},{type:"attr",position:[1,7]},{type:"registerYield",position:[1,7,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"registerYield",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"registerYield",position:[1,5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,1]},{type:"attr",position:[1,5,3]},{type:"registerYield",position:[1,5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,3]},{type:"componentDynamic",position:[1,5]}]},{type:"componentDynamic",position:[1,7]},{type:"attr",position:[1,9]},{type:"registerYield",position:[1,9,1],dynamicNodes:[{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,3,1]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"registerYield",position:[1,5,1,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,1]},{type:"attr",position:[1,5,3]},{type:"registerYield",position:[1,5,3,0],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,3]},{type:"componentDynamic",position:[1,5]}]},{type:"componentDynamic",position:[1,9]},{type:"componentDynamic",position:[1,11]}],_observedAttributes:["module","isApplyFilter","isSaveFilter","allFields","api_name","module_info","abmModuleInfo","cxPropCommonInfo","currentModelName","currentModelHeader","savedFilters","filterCountArray","filterQueryParams","clientAccount","preventUiType","preventColumnName","setboundary","appliedFilterId","moduleDisplayField","isBlockedReason","filterModalObj","isFilterAvailable","preventSaveFilter","fetchCountValues","isRolesGroupCriteriaEnabled","isGroupCriteriaNeeded","preventUserAction","isFromModal","featureName","queryParams","isSavedFilterStatus","displayAsAccodion","cxPropNewListKey","isSystemFilterNeeded","moduleName","applyfiltervisibility","fromCanvasOrKanban","showSaveFilterInCF","filterFields","relatedModules","relatedModulesMapping","supportRelatedModules","supportedRelatedModules","filter_status","modifiedSavedFilters","multiSelectPickListFields","mspfieldsVsinclude","cvCriteriaMSPLCount","filtersOnDrag","originalFiltersList","smartFiltersLimit","smartFiltersRevampEnabled","showSaveFilterBtnOnRefresh","multiSelectRelations","multiSelectListVsRelations","crossFilterTranslations","isAccessibilityConfigSupported","historyTrackingRelations"],data:function(){return{module:Lyte.attr("string"),isApplyFilter:Lyte.attr("boolean",{default:!1}),isSaveFilter:Lyte.attr("boolean",{default:!1}),allFields:Lyte.attr("array"),api_name:Lyte.attr("string"),module_info:Lyte.attr("object"),abmModuleInfo:Lyte.attr("object"),cxPropCommonInfo:Lyte.attr("object",{default:{}}),currentModelName:Lyte.attr("string"),currentModelHeader:Lyte.attr("string"),savedFilters:Lyte.attr("array",{default:[]}),filterCountArray:Lyte.attr("array",{default:[]}),filterQueryParams:Lyte.attr("object"),clientAccount:Lyte.attr("boolean",{default:!(void 0===window.clientPortalName||!window.clientPortalName)}),preventUiType:Lyte.attr("array"),preventColumnName:Lyte.attr("array"),setboundary:Lyte.attr("object",{default:{}}),appliedFilterId:Lyte.attr("string"),moduleDisplayField:Lyte.attr("object",{default:crmConstants.moduleDisplayField}),isBlockedReason:Lyte.attr("boolean"),filterModalObj:Lyte.attr("object",{default:{}}),isFilterAvailable:Lyte.attr("boolean",{default:!0}),preventSaveFilter:Lyte.attr("boolean",{default:!1}),fetchCountValues:Lyte.attr("boolean",{default:Crm.userDetails.fetchCountValues}),isRolesGroupCriteriaEnabled:Lyte.attr("boolean",{default:!!Crm.userDetails.isRolesGroupCriteriaEnabled}),isGroupCriteriaNeeded:Lyte.attr("boolean",{default:!("Free"===Crm.userDetails.EDITION_NAME||!Crm.userDetails.isRolesGroupCriteriaEnabled)}),preventUserAction:Lyte.attr("boolean",{default:!1}),isFromModal:Lyte.attr("boolean",{default:!1}),featureName:Lyte.attr("string"),queryParams:Lyte.attr("object",{default:{}}),isSavedFilterStatus:Lyte.attr("boolean",{default:!0}),displayAsAccodion:Lyte.attr("boolean",{default:!0}),cxPropNewListKey:Lyte.attr("boolean",{default:!0}),isSystemFilterNeeded:Lyte.attr("boolean",{default:!0}),moduleName:Lyte.attr("string",{default:""}),applyfiltervisibility:Lyte.attr("boolean",{default:!1}),fromCanvasOrKanban:Lyte.attr("boolean",{default:!1}),showSaveFilterInCF:Lyte.attr("boolean",{default:!0}),filterFields:Lyte.attr("array",{default:[]}),relatedModules:Lyte.attr("array",{default:[]}),relatedModulesMapping:Lyte.attr("object",{default:{}}),supportRelatedModules:Lyte.attr("boolean",{default:Crm.userDetails.isRelatedModuleFilters}),supportedRelatedModules:Lyte.attr("array",{default:[]}),filter_status:Lyte.attr("boolean",{default:!0}),modifiedSavedFilters:Lyte.attr("object",{default:new Set}),multiSelectPickListFields:Lyte.attr("array",{default:[]}),mspfieldsVsinclude:Lyte.attr("object",{default:new Set}),cvCriteriaMSPLCount:Lyte.attr("number",{default:0}),filtersOnDrag:Lyte.attr("boolean",{default:!1}),originalFiltersList:Lyte.attr("array"),smartFiltersLimit:Lyte.attr("number",{default:Crm.userDetails.smartFiltersLimit?Crm.userDetails.smartFiltersLimit:5}),smartFiltersRevampEnabled:Lyte.attr("boolean",{default:!!Crm.userDetails.smartFiltersRevampEnabled}),showSaveFilterBtnOnRefresh:Lyte.attr("boolean",{default:!0}),multiSelectRelations:Lyte.attr("object",{default:{}}),multiSelectListVsRelations:Lyte.attr("object",{default:{}}),crossFilterTranslations:Lyte.attr("object",{default:{}}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),historyTrackingRelations:Lyte.attr("array",{default:[]})}},init:function(){var e=$L("crm-customview-layer")[0];e&&e.component&&this.setData("showSaveFilterInCF",e.component.data.hideGreyArea),(this.data.isFromModal||this.data.clientAccount)&&this.setData("supportRelatedModules",!1);var t=this.getData("abmModuleInfo"),i=this.getData("module");this.setData("relatedModules",moduleRecordMapping[i]&&moduleRecordMapping[i].relatedModules?moduleRecordMapping[i].relatedModules:[]),this.data.relatedModules&&this.data.relatedModules.length>0&&this.pushChildModulePayloads(this.data.relatedModules),"CustomModule5009"===i&&this.setData("isSystemFilterNeeded",!1),this.setData("preventUiType",[104,66,999,3,123,1234,134,500,555,556,51]),this.setValues(),this.setSavedFilters(),this.resize(),this.setData("filter_status",this.getData("module_info").filter_status),this.reorder(),t&&this.setData("cxPropCommonInfo",{abmModuleInfo:t});var a={};a.crossFilterConditions={opt1:I18n.getMsg("crm.smart.filter.with"),opt2:I18n.getMsg("crm.smart.filter.without")},a.selectField=I18n.getMsg("crm.field.insert"),this.setData("crossFilterTranslations",a)},observeModule:function(){$L("#listOfSavedFilter").slideDown(),this.setData({isApplyFilter:!1,isSaveFilter:!1});var e=$L("crm-customview-layer")[0];e&&e.setData({isApplyFilter:!1,isSaveFilter:!1}),this.setValues(),this.clearSearchFilter()}.observes("module"),setValues:function(){var e=moduleRecordMapping[this.getData("module")].id,t=store.peekRecord("module",e),i=t.fields?t.fields.length:0,a=[];this.setData("moduleName",t.module_name);for(var r=t.access_type&&"team_based"===t.access_type,l=0;l<i;l++)"userlookup"!==t.fields[l].data_type&&"ownerlookup"!==t.fields[l].data_type||(t.fields[l].maxCount=5,r&&(t.fields[l].cxUserProperties={queryParam:{include_lite_users:!0}})),moduleRecordMapping.Services&&t.module_name===moduleRecordMapping.Services.module_name&&"MXNDUMMYCOLUMN_SERVICE"===t.fields[l].column_name&&t.fields[l].multiuserlookup&&(t.fields[l].multiselectlookup=t.fields[l].multiuserlookup),"multiselectpicklist"===t.fields[l].data_type&&(cruxAssets.supportMultiselectFilterOptions&&(t.fields[l].cxForceSetCondition=!0),a.push(t.fields[l].api_name));if(this.isGDPREnabledForModule(t.api_name)){let e=this.getRequiredConsentFieldsColumnNames(t.fields);if(e.length>0){let i=this;store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(a){let r=a.length;for(let i=0;i<r;i++)e.includes(a[i].column_name)&&(t.fields.push(a[i]),e.splice(i,1));i.setData("moduleFields",t.fields.slice(0))}))}else this.setData("moduleFields",t.fields.slice(0))}else this.setData("moduleFields",t.fields.slice(0));var s=t.custom_view.criteria,o=0;a.length&&s&&(o=this.getMSPLFieldsCount(s,a)),this.setData("multiSelectPickListFields",a),this.setData("cvCriteriaMSPLCount",o),this.setData("preventColumnName",this.filterFieldsForSmartFilter(this.data.module,!1)),this.setData("module_info",t),this.setRelatedModulesMapping(this.data.relatedModules),this.setFilterFieldsJson(),this.setData({api_name:t.api_name}),this.isFilterHeight=!1,this.setData("show_filter",t.filter_status),this.setData("showSaved",t.canvas_view||t.kanban_view),this.setData("applyfiltervisibility",!(!t.canvas_view&&"Messages"!==this.data.module));var n=this.getData("module"),d=n.startsWith("CustomModule");Crm.userDetails.seriesFilterEnabled=Crm.seriesEnabled&&Crm.isCadencesRLEnable&&("Leads"===n||"Contacts"===n||"Vendors"===n||d||"Potentials"===n||"Accounts"===n||"Quotes"===n),(this.data.module_info&&this.data.module_info.custom_view&&this.data.module_info.custom_view.system_name&&(this.data.module_info.custom_view.system_name.startsWith("REVIEWPROCESS")||this.data.module_info.custom_view.system_name.startsWith("IMAGEVALIDATION"))||Lyte.Component.registeredHelpers.isTeamModule(n))&&(Crm.userDetails.seriesFilterEnabled=!1)},getMSPLFieldsCount:function(e,t){if(e.group){for(var i=e.group.length,a=0,r=0;r<i;r++)a+=this.getMSPLFieldsCount(e.group[r],t);return a}var l=e.field;return l&&t.contains(l.api_name)&&["include_all","include_any","exclude_all","exclude_any"].contains(e.comparator)?1:0},setFilterFieldsJson:function(){var e,t,i=this.getData("module_info").fields;if(e={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("crm.filter.header.secton.fields"),cxAccordionName:"moduleFields",cxSort:!0,cxClass:""},!this.data.supportRelatedModules)return e.cxFields=i.slice(),void this.setData("filterFields",[e]);t={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("crm.smart.filter.related.modules"),cxAccordionName:"crossFields",cxSort:!0,cxClass:""},e.cxFields=i.slice();var a=[];t.cxFields=this.convertRelModtoFields(this.data.relatedModules.length>0?this.data.relatedModules:this.getData("module_info").relatedModules,a);var r=[e];if(a.length>0){var l={cxAccordion:!0,cxAccordionLabel:I18n.getMsg("crm.smart.filter.subforms"),cxAccordionName:"subFormFields",cxSort:!0,cxClass:""};l.cxFields=a,r.push(l)}t.cxFields.length>0&&r.push(t),this.setData("filterFields",r)},convertRelModtoFields:function(e,t){var i=[];if(!e)return i;for(var a=e.length,r=this,l=this.restrictedChildModulesRelations(this.data.module),s=this.data.module_info.fields.filter((function(e){if(444===e.ui_type)return e})),o=this.data.module_info.api_name,n=[I18n.getMsg("VoC Responses"),I18n.getMsg("VoC Keywords"),I18n.getMsg("VoC Events")],d=0;d<a;d++)if(e[d].api_name&&!r.data.supportedRelatedModules.contains(e[d].api_name)){for(var c=e[d].module.module_name,p=e[d].api_name,m=s.length,u=!1,f=p,y=0;y<m;y++){(h=s[y]).multiselectlookup&&h.multiselectlookup.linking_module&&h.multiselectlookup.linking_module.api_name===e[d].module.api_name&&h.multiselectlookup.lookup_apiname===e[d].field.api_name&&(this.data.multiSelectRelations[f]=h.multiselectlookup,h.multiselectlookup.api_name&&(this.data.multiSelectListVsRelations[h.multiselectlookup.api_name]=f)),h.multiselectlookup&&h.multiselectlookup.connected_module&&h.multiselectlookup.connected_module.api_name===e[d].module.api_name&&h.multiselectlookup.connectedfield_apiname===e[d].field.api_name&&(u=!0,h.multiselectlookup.api_name&&this.data.relatedModulesMapping[h.multiselectlookup.api_name+"__r"]&&(f=h.multiselectlookup.api_name+"__r"))}if(u||c.startsWith("Orchestration")||c.startsWith("PathFinder"))continue;var _=e[d].display_label,v=e[d].module.api_name;if(v&&v.endsWith("Insights__s"))continue;if(moduleRecordMapping[c]&&moduleRecordMapping[c].generated_type&&"field_tracker"===moduleRecordMapping[c].generated_type){var g=this.data.historyTrackingRelations;g.push(p),this.setData("historyTrackingRelations",g);continue}if(!this.restricted_related_modules.contains(c)&&!c.startsWith("ProcessFlow")&&!l.contains(p)&&_&&!this.isRealationToBeSkipped(e[d],r.data.module)){var h={},F=e[d];if(h.api_name=F.api_name,h.moduleApiName=F.module.api_name,h.moduleName=F.module.module_name,h.relationId=F.id,h.data_type="crossModule",h.field_label=F.module.plural_label.toLowerCase()===F.display_label.toLowerCase()?F.module.plural_label:F.module.plural_label+" ("+F.display_label+")",h.filterable=!0,h.visible=!0,h.displayInFilter=!0,h.available_in_user_layout=!0,h.parentModuleLabel=this.data.module_info.plural_label,h.childFields=[],r.data.supportedRelatedModules.push(F.api_name),"subform"===moduleRecordMapping[c].generated_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===moduleRecordMapping[c].generated_type){moduleRecordMapping[c].parent_module&&moduleRecordMapping[c].parent_module.api_name===o&&"Parent_Id"===F.field.api_name&&t.push(h);continue}if(h.api_name.includes("Voc")&&!n.contains(F.module.plural_label))continue;h.api_name.includes("VocResponses")?h.cxTooltipInfo=I18n.getMsg("voc.responses.info"):h.api_name.includes("VocInferences")?h.cxTooltipInfo=I18n.getMsg("voc.inferences.info"):h.api_name.includes("VocEvents")&&(h.cxTooltipInfo=I18n.getMsg("voc.events.info")),i.push(h)}}return i},setRelatedModulesMapping:function(e){for(var t=e.length,i={},a=0;a<t;a++){var r=e[a].api_name;i[r]=e[a].module,i[r].field=e[a].field}this.setData("relatedModulesMapping",i)},fetchCrossFilterModuleFields:function(e){let t=e.length,i=[];for(let a=0;a<t;a++){let t=e[a].relation.api_name,r=this.data.relatedModulesMapping[t]?this.data.relatedModulesMapping[t].module_name:null;if(r&&moduleRecordMapping[r]&&!moduleRecordMapping[r].fields&&this.data.supportedRelatedModules.includes(t)){let e=new Promise((function(e){app.store.makeRequest("findRecord","module",moduleRecordMapping[r].id,void 0,void 0,void 0,{getFields:!0}).then((function(t){e(t[0])}))}));i.push(e)}}return i},setSavedFilters:function(){if(!this.preventFilterCount&&this.getData("fetchCountValues")){this.getData("module_info"),Lyte.Router.getRouteInstance().parent.getDynamicParam();var e=this.getData("savedFilters");e||(this.setData("savedFilters",[]),e=[]),this.setData("filterCountArray",[])}else delete this.preventFilterCount},setFilterHeight:function(){var e=this;!this.isFilterHeight&&this.getData("module_info").filter_status&&setTimeout((function(){e.resize(),e.isFilterHeight=!0}),100)}.observes("filter_status"),toggleFilterbuttons:function(e){var t=$L("crm-customview-layer")[0];"Messages"!==e.data.module&&(e.getData("applyfiltervisibility")&&!this.saveBtn?(e.setData({isApplyFilter:!0}),t&&t.setData({isApplyFilter:!0})):(e.setData({isApplyFilter:!1}),t&&t.setData({isApplyFilter:!1})))},methods:{onBeforeRender:function(e){if(!featuresAvailable.Record_Locking){var t=e.fields.filter((e=>"special_field"===e.cxAccordionName));if(t&&t.length>0){var i=0;t[0].cxFields.each((function(e){"cxFilter_Locked"===e.api_name&&t[0].cxFields.deleteElementAt(i),i++}))}return e.fields}},onValueChange:function(e){if(e&&e.field&&"multiselectpicklist"===e.field.field_data_type){var t,i=e.field,a=e.comp;a&&(t=a.$node.querySelector("lyte-dropdown").ltProp("selected"));var r=this.getData("mspfieldsVsinclude");if("include_all"===t||"include_any"===t||"exclude_all"===t||"exclude_any"===t){Lyte.objectUtils(i,"add","maxCount",crmConstants.include_exclude_values_limit),r.add(a.$node.id);var l=a.$node.querySelector("crux-picklist-component"),s=l.component.getValue();s.splice(5),l.component.setData("cxPropValue",[]),l.component.setData("cxPropValue",s)}else r.delete(a.$node.id),Lyte.objectUtils(i,"add","maxCount",Search.maxValuesForTextCond);this.setData("mspfieldsVsinclude",r)}var o=$L("crm-customview-layer")[0];this.getData("isSaveFilter")&&!this.saveBtn&&(this.setData({isSaveFilter:!1,preventSaveFilter:!1,isApplyFilter:!0}),o&&o.setData({isSaveFilter:!1,preventSaveFilter:!1,isApplyFilter:!0})),this.toggleFilterbuttons(this);var n=document.querySelector("#applyBtn");n&&!this.applyBtnDisbled&&(n.ltProp("disabled",!1),this.setData("preventSaveFilter",!1),o&&o.setData({preventSaveFilter:!1})),this.resize()},onFieldChanged:function(e,t,i,a){var r=this.getData("mspfieldsVsinclude"),l=r.size;if(!t.checked&&l>0){if(t.childField){var s=$(t).closest("crux-smart-filter")[0];s&&s.id&&r.delete("option_"+a.api_name+"_"+a.id+s.id.slice(12))}else a.api_name.endsWith("__r")?r=new Set([...r].filter((e=>!e.endsWith(a.api_name)))):a.api_name&&r.delete("option_"+a.api_name);this.setData("mspfieldsVsinclude",r)}if("multiselectpicklist"===a.data_type&&t&&t.checked&&!t.childField&&t.id){var o=$L("#option"+t.id.slice(5))[0].querySelector("lyte-dropdown");o&&["include_all","include_any","exclude_all","exclude_any"].contains(o.ltProp("selected"))&&r.size+this.getData("cvCriteriaMSPLCount")+1>crmConstants.include_exclude_comparator_limit?o.ltProp("selected","equal"):["include_all","include_any","exclude_all","exclude_any"].contains(o.ltProp("selected"))&&(r.add("option"+t.id.slice(5)),this.setData("mspfieldsVsinclude",r))}var n=this;if(t.checked&&a&&"crossModule"===a.data_type){var d=a.moduleName,c=moduleRecordMapping[d];c&&c.fields&&c.fields.length>0?n.populateChildFields(a,c.fields,d):app.store.makeRequest("findRecord","module",c.id,void 0,void 0,void 0,{getFields:!0}).then((function(e){n.populateChildFields(a,e[0].fields,d)}))}!t.checked&&a&&"crossModule"===a.data_type&&Lyte.Component.set(a,{rendered:!1});var p=$L("crm-customview-layer")[0];i&&i.type||this.getData("isFilterByFieldApplied")?(this.setData("isFilterByFieldApplied",!1),this.setData("preventSaveFilter",!1),p&&p.setData({preventSaveFilter:!1}),delete this.saveBtn,delete this.applyBtnDisbled,this.setData({applyfiltervisibility:!0})):t.checked&&this.setData({applyfiltervisibility:!1});var m=document.querySelector("#applyBtn");if(this.getData("isSaveFilter")&&!this.saveBtn&&(this.setData("isSaveFilter",!1),p&&p.setData("isSaveFilter",!1)),!t.checked&&!this.applyBtnDisbled){var u=Lyte.Router.getRouteInstance(),f=this.data.isFromModal?this.data.queryParams:u.getQueryParams();if(f&&(f.filters||f.cross_filters||f.filter_id&&0===e.length)&&!this.saveBtn)return this.setData("isApplyFilter",!0),p&&p.setData("isApplyFilter",!0),(m=document.querySelector("#applyBtn"))&&m.ltProp("disabled",!1),void this.resize()}if(e.length>0&&!this.applyBtnDisbled)if(this.getData("isApplyFilter")||this.saveBtn)m&&m.ltProp("disabled",!1);else{this.setData("isApplyFilter",!0),p&&p.setData("isApplyFilter",!0);var y=document.querySelector("#applyBtn");y&&y.ltProp("disabled",!1)}else this.saveBtn||this.applyBtnDisbled||t.childField||(this.setData({isApplyFilter:!1,isSaveFilter:!1}),p&&p.setData({isApplyFilter:!1,isSaveFilter:!1}));if(t.closest){var _=t.closest("lyte-accordion-item"),v=t.closest("crux-smart-filter"),g=t.closest(".cxSmartFilterList");if(v&&v.component.data.cxPropChildModuleFields&&(g=void 0),_&&null===_.nextElementSibling&&g&&(null===g.nextElementSibling||null===g.nextElementSibling.nextElementSibling)){var h=$L("#lv_filter_scroll")[0];h.scrollTop=h.scrollHeight}}this.resize()},setConditions:function(e){if(this.data.supportRelatedModules)if(e.field&&e.field.data_type&&["text","website"].includes(e.field.field_data_type)){for(var t=e.condition.length,i=0;i<t;i++)if(e.condition[i].system&&"contains"===e.condition[i].system)return{conditions:e.condition,selected:"contains"}}else if(e.field&&e.field.data_type&&["datetime","date","date_time"].includes(e.field.field_data_type)){var a={display:I18n.getMsg("not between"),system:"not_between"},r={system:"${YESTERDAYMINUS}",display:I18n.getMsg("Till Yesterday")};return e.condition.splice(6,0,a),e.condition.splice(11,0,r),e.conditions}return e.field&&e.field.data_type&&["multiselectpicklist"].includes(e.field.field_data_type)?this.getMultiSelectPicklistConditions(this,e.field,e.comp):e&&"cxFilter_Email_Status"===e.field.api_name&&e.fieldOption&&Crm.userDetails.isEmailsForCasesModuleEnabled&&"Cases"===this.getData("module")?(e.fieldOption=e.fieldOption.filter((e=>"received"!==e.system&&"not_received"!==e.system&&"opened_and_not_replied"!==e.system)),e.field.sent_status=e.field.sent_status.filter((e=>"responded"!==e.api_name&&"opened_and_not_replied"!==e.api_name)),e):e.condition},getMenuSelectItem:function(e){if("save_new"!==e)if("save"!==e){var t=document.querySelector(".savedFilterOption.lyteMenuSelected");if(this.EditFilterindex=t.getAttribute("index"),this.EditOption_filter_id=t.getAttribute("filter_id"),"rename"===e){var i=store.peekRecord("filter",this.EditOption_filter_id).name;Lyte.objectUtils(this.data.filterModalObj,"add",{showNewFilterModal:!0,filterName:i,currentModelName:"Rename Filter",currentModelHeader:I18n.getMsg("crm.filter.rename.label")})}else"delete"===e&&Lyte.objectUtils(this.data.filterModalObj,"add",{showDeleteFilterModal:!0,currentModelName:"Delete Filter",currentModelHeader:I18n.getMsg("crm.warning.delete.filter")})}else var a=this,r=0,l=setInterval((function(){if(a.preventUserAction||a.getData("preventUserAction"))r=100;else{clearInterval(l);var e=crmTab.getFromCache(a.data.module);(e=e||{}).filter_id=a.filter_id;var t=Lyte.Router.getRouteInstance().parent.getDynamicParam(),i=a.getData("api_name"),s=store.peekRecord("filter",a.filter_id);if(e.filters=a.criteria,e.cross_filters=a.cross_filters,e=a.replaceSpecialLookups(e),a.cross_filters&&a.cross_filters.length>0&&a.data.supportRelatedModules)for(var o=a.cross_filters.length,n=0;n<o;n++){var d=a.cross_filters[n];d.relation.api_name.endsWith("__r")||d.relation.type&&"field"===d.relation.type||a.data.historyTrackingRelations.contains(d.relation.api_name)||a.data.supportedRelatedModules.contains(d.relation.api_name)||(d.relation.api_name+="__r"),d.relation.relation&&!d.relation.relation.api_name.endsWith("__r")&&(d.relation.relation.api_name+="__r")}s.$.set({criteria:a.criteria,cross_filters:a.cross_filters}),s.$.save({cvid:t,module:i}).then((function(){a.fetchFilterCount(s),a.setData("isApplyFilter","Messages"===a.data.module),a.setData("isSaveFilter",!1);var e=$L("crm-customview-layer")[0];e&&e.setData({isSaveFilter:!1,isApplyFilter:!1}),document.querySelector("#applyBtn")&&document.querySelector("#applyBtn").ltProp("disabled",!0),a.displayMsg("success",I18n.getMsg("crm.filter.save.msg"))}),(function(e){var t=JSON.parse(e.response);if(s.$.rollBack(),t.filters&&t.filters[0]&&"INVALID_DATA"===t.filters[0].code)renderingUtils.showAlertMsg(I18n.getMsg("crm.filters.permissions.error"));else{if(t.filters&&t.filters[0]&&"INVALID_MODULE"===t.filters[0].code||"NO_PERMISSION"==t.code)return void renderingUtils.displayPermissionDenied();t.filters&&t.filters[0]&&"COMPARATOR_LIMIT_EXCEEDED"===t.filters[0].code?renderingUtils.showAlertMsg(I18n.getMsg("crm.multi.select.field.cv.filter.limit.reached.msg",t.filters[0].details.limit?t.filters[0].details.limit:crmConstants.include_exclude_comparator_limit)):t.filters&&t.filters[0]&&"DEPENDENT_MISMATCH"===t.filters[0].code?renderingUtils.showAlertMsg(I18n.getMsg("crm.multi.select.field.option.limit.reached.heading",t.filters[0].details.maximum_length?t.filters[0].details.maximum_length:crmConstants.include_exclude_values_limit)):renderingUtils.showMsgBox(I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.button.cvfilter")),"error")}}))}}),r);else{if(this.getData("savedFilters").length>=this.getData("smartFiltersLimit"))return;Lyte.objectUtils(this.data.filterModalObj,"add",{currentModelName:"Save Filter",filterName:"",currentModelHeader:I18n.getMsg("crm.email.save.filter"),showNewFilterModal:!0})}},inputFocus:function(){var e=document.querySelector("#SaveFiltername input"),t=$L("#SaveFiltername");renderingUtils.hideLyteErrorMessages(t),$L("#SaveFiltername")[0].ltProp("disabled",!1),"Save Filter"==this.data.filterModalObj.currentModelName&&Lyte.objectUtils(this.data.filterModalObj,"add",{filterName:""}),setTimeout((function(){e.focus()}),100)},deleteModalOpen:function(){$L("#deleteBtn")[0].ltProp("disabled",!1);var e=this;$(document).keydown((function(t){13===t.keyCode&&e.deleteSelectedFilter()}))},closeDeleteModal:function(){this.close()},saveEditOption:function(e,t,i){$L(i).closest(".filterNameLabel").addClass("saveMenuSelected"),t.stopPropagation()},saveEditOptionRemove:function(){$L("#listOfSavedFilter").find(".saveMenuSelected").removeClass("saveMenuSelected")}},actions:{preventFromOnSubmit:function(e){e.preventDefault()},stop_Prop:function(){event.stopPropagation()},viewSavedFilter:function(){var e=this,t=$L("#lv_left_filter");this.getData("isSavedFilterStatus")?this.setData("isSavedFilterStatus",!1):this.setData("isSavedFilterStatus",!0),t.removeClass("oA").addClass("oH"),$L("#listOfSavedFilter").slideToggle((function(){e.resize(),t.removeClass("oH").addClass("oA")}))},applyCurrentFilter:function(e,t,i){var a=Lyte.Router.getRouteInstance().transition;if("crm.tab.module.custom-view.zia"!=Lyte.Router.getRouteInstance().transition.info.route)if(this.data.isFilterAvailable){if(this.data.appliedFilterId){var r=store.peekRecord("filter",this.data.appliedFilterId);r.criteria=r.cross_filters=void 0}Crm.trackSpotLightAction("Saved Filter Click",{Module:i});if(("crm.tab.messages.custom-view.list"===Lyte.Router.getRouteInstance().transition.info.route?moduleRecordMapping.Messages.api_name:moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].api_name)===i){var l=$L("crm-customview-buttons")[0];l&&(l.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1),this.preventUserAction=!0,this.applycriteria(e,t),this.setData({isApplyFilter:!1})}var s=$L("crm-customview-layer")[0];s&&s.setData({isSameFilterId:!0}),this.resize(),this.enableFilterSort()}else renderingUtils.showAlertMsg(I18n.getMsg("crm.filters.incompatible.error.msg"));else(Lyte.Component.registeredHelpers.checkViewAvailability("kanban",this.getData("module_info"),this.getData("clientAccount"))?Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.kanban",dynamicParams:a.info.dynamicParams,queryParams:{filter_id:e}}):Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:a.info.dynamicParams,queryParams:{filter_id:e}})).data={clearCache:!0,clearselectedIds:!0}},applyFilterSubmit:function(e,t){var i="",a=this;if(i="crm.tab.messages.custom-view.list"===Lyte.Router.getRouteInstance().transition.info.route?moduleRecordMapping.Messages.api_name:t?e:moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].api_name,a.getData("cvCriteriaMSPLCount")+a.getData("mspfieldsVsinclude").size>crmConstants.include_exclude_comparator_limit)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.multi.select.field.filter.limit.reached.heading"),ltPropSecondaryMessage:I18n.getMsg("crm.multi.select.field.cv.filter.limit.reached.msg",crmConstants.include_exclude_comparator_limit),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok"),cxPropZcqa:"field_max_limit"}]}}),void document.querySelector("#applyBtn").ltProp("disabled",!0);if(i===e){event.preventDefault(),Crm.trackSpotLightAction("Advance Filters",{Module:this.getData("module")});var r=$L("#customFilter")[0].component.getFilterCriteria(),l={};if(t){Crm.trackSpotLightAction("Advance Filters From Modal",{Module:this.getData("module")});var s=this.data.queryParams;if(r&&r.queryParams){(p=$L("crm-customview-buttons")[0])&&(p.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1);var o={filters:void 0,cross_filters:void 0,filter_id:void 0,page:1,per_page:void 0,sort_order:void 0,sort_by:void 0};if(this.criteria=this.cross_filters=void 0,customViewObject.filter_id=customViewObject.filterId=customViewObject.filters=customViewObject.cross_filters=void 0,r.queryParams.filters&&"PORTALS"===this.getData("featureName")&&this.isEmailNotSupported(r.queryParams.filters))return void crmui.showMsgBand("error",I18n.getMsg("custmr.prtl.filter.notsupported"),5e3);if(r.queryParams.filters&&(customViewObject.filters=r.queryParams.filters,this.criteria=r.queryParams.filters,o.filters=JSON.stringify(r.queryParams.filters),o.on_demand_properties=r.queryParams.on_demand_properties,o.client_portal_invited=r.queryParams.client_portal_invited),r.queryParams.cross_filters&&(customViewObject.cross_filters=r.queryParams.cross_filters,this.cross_filters=r.queryParams.cross_filters,Crm.userDetails.isRelatedModuleFilters?r.queryParams.cross_filters.forEach((function(e){e.relation.api_name.endsWith("__r")||e.relation.type&&"field"===e.relation.type||a.data.historyTrackingRelations.contains(e.relation.api_name)||(e.relation.api_name=a.getRQCompatibleRelationName(a,e.relation.api_name)),e.relation.relation_id&&(e.relation.id=e.relation.relation_id),delete e.relation.relation_id,e.relation.relation&&!e.relation.relation.api_name.endsWith("__r")&&(e.relation.relation.api_name+="__r")})):r.queryParams.cross_filters.forEach((function(e){e.relation.relation_id&&(e.relation.id=e.relation.relation_id),delete e.relation.relation_id})),o.cross_filters=JSON.stringify(r.queryParams.cross_filters)),s.filters===o.filters&&s.cross_filters===o.cross_filters)return;document.querySelector("#applyBtn").ltProp("disabled",!0),l.queryParams=o,this.fetchData(l,e,{clearCache:!0,clearselectedIds:!0},!0,!1,this.getData("featureName"),!0);var n=$L("crm-customview-layer")[0];a.setData({isApplyFilter:!1}),n&&n.setData({isApplyFilter:!1}),this.resize()}else{o={};if(this.data.appliedFilterId&&r.noFieldSelected){document.querySelector("#applyBtn").ltProp("disabled",!1);var d=I18n.getMsg("crm.warning.select.filter");renderingUtils.showAlertMsg(d)}else if(r.lookupLimitExceed)r.lookup_name[0]="####"+r.lookup_name[0],Search.displayLookupExceedsMsg({responseText:r.lookup_name.join(",")});else if(r&&r.noFieldSelected&&s&&s.filters){customViewObject.filters=customViewObject.cross_filters=void 0,o.filter_id=o.filters=o.cross_filters=void 0,document.querySelector("#applyBtn").ltProp("disabled",!0),this.setData({isSaveFilter:!1,isApplyFilter:!1}),(n=$L("crm-customview-layer")[0])&&n.setData({isSaveFilter:!1,isApplyFilter:!1}),this.resize(),l.queryParams=o,this.fetchData(l,e,{clearCache:!0,clearselectedIds:!0},!0,!1,this.data.featureName,!0),setTimeout((function(){a.data&&a.setData({applyfiltervisibility:!0})}),5e3)}else if(r&&r.noFieldSelected){d=I18n.getMsg("crm.warning.select.filter");renderingUtils.showAlertMsg(d)}}}else{Crm.trackSpotLightAction("Advance Filters",{Module:this.getData("module")});var c=Lyte.Router.getRouteInstance();s=c.getQueryParams();if(r&&r.queryParams){var p;(p=$L("crm-customview-buttons")[0])&&(p.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1),(o={filters:void 0,cross_filters:void 0,filter_id:void 0,per_page:void 0,sort_order:void 0,sort_by:void 0}).page="chart"!==c.routeName?1:void 0,this.criteria=this.cross_filters=void 0,customViewObject.filter_id=customViewObject.filterId=customViewObject.filters=customViewObject.cross_filters=void 0,r.queryParams=this.replaceSpecialLookups(r.queryParams),r.queryParams.filters&&(customViewObject.filters=r.queryParams.filters,this.criteria=r.queryParams.filters,o.filters=JSON.stringify(r.queryParams.filters)),r.queryParams.cross_filters&&(customViewObject.cross_filters=r.queryParams.cross_filters,this.cross_filters=r.queryParams.cross_filters,Crm.userDetails.isRelatedModuleFilters?r.queryParams.cross_filters.forEach((function(e){e.relation.api_name.endsWith("__r")||e.relation.type&&"field"===e.relation.type||a.data.historyTrackingRelations.contains(e.relation.api_name)||a.data.supportedRelatedModules.contains(e.relation.api_name)||(e.relation.api_name=a.getRQCompatibleRelationName(a,e.relation.api_name)),e.relation.relation_id&&(e.relation.id=e.relation.relation_id),delete e.relation.relation_id,e.relation.relation&&!e.relation.relation.api_name.endsWith("__r")&&(e.relation.relation.api_name+="__r")})):r.queryParams.cross_filters.forEach((function(e){e.relation.relation_id&&(e.relation.id=e.relation.relation_id),delete e.relation.relation_id})),o.cross_filters=JSON.stringify(r.queryParams.cross_filters));var m=Lyte.Router.getRouteInstance().getQueryParams(),u=!1;m.filters==o.filters&&m.cross_filters==o.cross_filters&&(u=!0),$L(".collapse-view").hide(),"zia"==Lyte.Router.getRouteInstance().routeName&&(r.preventSaveFilter=!0);var f={clearCache:!0,clearselectedIds:!0,isFilterApply:!0};f.layoutId=c.transition.data.layoutId,f.pipeline=c.transition.data.pipeline,c.setQueryParams(o).data=f,u||(this.preventUserAction=!0),(o.filters&&o.filters.includes('"from":"Prediction"')||o.cross_filters&&o.cross_filters.includes("_IsEnd"))&&(r.preventSaveFilter="prediction",Crm.client_tracking("Zia Prediction Builder Field Usage",{"Sub Feature":"Smart filter"}));var y=$L("crm-customview-layer")[0];if(this.data.isFilterAvailable&&(this.getData("savedFilters").length<this.getData("smartFiltersLimit")||this.data.appliedFilterId)&&!r.preventSaveFilter&&!window.clientPortalName)this.setData({isSaveFilter:!0,isApplyFilter:!1}),y&&(c.transition.info.route.includes("kanban")&&!c.errorOnRecordsGet||!c.transition.info.route.includes("kanban")&&!c.lookupLimitExceeded)&&y.setData({isSaveFilter:!0,isApplyFilter:!1});else{this.setData({isApplyFilter:!1,isSaveFilter:!0}),y&&y.setData({isApplyFilter:!1,isSaveFilter:!0});var _=$L("#saveBtn")[0];if("prediction"===r.preventSaveFilter||"PathFinder"===r.preventSaveFilter||"NBX"===r.preventSaveFilter||"competitor_alert"===r.preventSaveFilter||"best_time"===r.preventSaveFilter)return void(_&&(this.setData("preventSaveFilter",!0),y.setData("preventSaveFilter",!0),_.ltProp("disabled",!0),y.setData("preventSaveFilterMsg","PathFinder"===r.preventSaveFilter?I18n.getMsg("pf.prevent.save.filter"):"NBX"===r.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("crm.zia.nba.feature.label")):"best_time"===r.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("crm.best.time.column.label")):"competitor_alert"===r.preventSaveFilter?I18n.getMsg("crm.competitoralert.smart.filter.prevent"):I18n.getMsg("crm.prediction.smartfilter.save.msg"))));if("abm"===r.preventSaveFilter)return this.setData({isSaveFilter:!0,isApplyFilter:!1}),void((_=$L("#saveBtn")[0])&&(this.setData("preventSaveFilter",!0),y.setData("preventSaveFilter",!0),_.ltProp("disabled",!0),y.setData("preventSaveFilterMsg",I18n.getMsg("crm.abm.smart.filter.action.not.supported"))));_&&(_.ltProp("disabled",!0),_.setAttribute("lt-prop-title",I18n.getMsg("crm.warning.filter.limit.exceed.new",this.getData("smartFiltersLimit"))),_.setAttribute("lt-prop-tooltip-config",'{"position" : "right" , "appearance" : "callout" , "maxdisplaytime" : 5000 }'))}this.resize(),setTimeout((function(){a.data&&a.setData({applyfiltervisibility:!0})}),5e3)}else{o={};if(r&&r.dummyFieldSelected){d=I18n.getMsg("crm.warning.select.filter.empty",r.display_label);return void _cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"crmCenterAlert",ltPropPrimaryMessage:d}})}if(this.data.appliedFilterId&&r.noFieldSelected){document.querySelector("#applyBtn").ltProp("disabled",!1);d=I18n.getMsg("crm.warning.select.filter");renderingUtils.showAlertMsg(d)}else if(r.lookupLimitExceed)r.lookup_name[0]="####"+r.lookup_name[0],Search.displayLookupExceedsMsg({responseText:r.lookup_name.join(",")});else if(r&&r.noFieldSelected&&!r.dummyFieldSelected&&s&&(s.filters||s.cross_filters))customViewObject.filters=customViewObject.cross_filters=void 0,o.filter_id=o.filters=o.cross_filters=void 0,c.setQueryParams(o).data={clearCache:!0,clearselectedIds:!0},document.querySelector("#applyBtn").ltProp("disabled",!0);else if(r&&r.noFieldSelected){d=I18n.getMsg("crm.warning.select.filter");_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"crmCenterAlert",ltPropPrimaryMessage:d}})}}}}},clearAllFilter:function(e,t){if(this.setData("preventUserAction",!1),this.preventUserAction=!1,this.data.appliedFilterId){var i=store.peekRecord("filter",this.data.appliedFilterId);i.criteria=i.cross_filters=void 0}this.saveBtn=!1;var a=$L("crm-customview-layer")[0];a&&a.setData({isSameFilterId:!1,applied_filters:void 0,showClearFilter:!1}),this.clearfield(void 0,e,t,!0),$L(".collapse-view").show(),setTimeout((function(){var e=$L("#searchId")[0];e&&e.setValue(e.ltProp("value"))}),50),this.resize(),this.enableFilterSort()},saveNewFilter:function(e){var t="",i=document.querySelector("crm-custom-filter"),a=[],r=[],l=[],s=[],o=[],n=[];if(i.component.cross_filters)for(var d=i.component.cross_filters,c=d.length,p=0;p<c;p++){var m=d[p];if(m.relation&&n.push(m.relation.api_name),m.criteria&&m.criteria.field&&m.criteria.field.id)l.push(m.criteria.field.id),s.push(m.criteria.field.api_name);else if(m.criteria&&m.criteria.group)for(var u=(y=m.criteria.group).length,f=0;f<u;f++){(_=y[f]).field&&(l.push(_.field.id),s.push(_.field.api_name))}}if(i.component.criteria&&i.component.criteria.field)a.push(i.component.criteria.field.id),r.push(i.component.criteria.field.api_name);else if(i.component.criteria&&i.component.criteria.group){var y;for(u=(y=i.component.criteria.group).length,p=0;p<u;p++){var _;(_=y[p]).field&&(a.push(_.field.id),r.push(_.field.api_name))}}var v=moduleRecordMapping[i.component.data.module].fields,g=!1;for(field in v)"object"!=typeof v[field]||-1===a.indexOf(v[field].id)&&-1===r.indexOf(v[field].api_name)||!v[field].formula.dynamic||(o.push(v[field].field_label),g=!0);var h,F=i.component.data.relatedModulesMapping;for(relatedModule in F){var M=F[relatedModule];if(-1!=n.indexOf(relatedModule)&&M.module_name&&moduleRecordMapping[M.module_name]){var b=moduleRecordMapping[M.module_name].fields;for(field in b)if("object"==typeof b[field]&&(-1!==l.indexOf(b[field].id)||-1!==s.indexOf(b[field].api_name))&&b[field].formula.dynamic){if(void 0===h&&i.component.data.relatedModules){h={};for(var S=i.component.data.relatedModules,D=S.length,I=0;I<D;I++){var L=S[I];L.display_label&&(h[L.api_name]=L.display_label)}}o.push((h&&h[relatedModule]?h[relatedModule]:relatedModule)+"."+b[field].field_label),g=!0}}}if(t="crm.tab.messages.custom-view.list"===Lyte.Router.getRouteInstance().transition.info.route?moduleRecordMapping.Messages.api_name:moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].api_name,g){var A=document.querySelector("crm-customview-layer"),C=$L("#saveBtn")[0];this.setData("preventSaveFilter",!0),A.setData("preventSaveFilter",!0),C.ltProp("disabled",!0),A.setData("preventSaveFilterMsg",I18n.getMsg("crm.formula.dynamic.filter.error"));var w=o.map((e=>'"'+e+'"')).join(", ")+" "+I18n.getMsg("crm.formula.dynamic.filter.save.error");_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:w,ltPropWrapperClass:"admc_customAlert"},accept:this.popupClose})}else if(t===e){if(this.data.appliedFilterId)return;Lyte.objectUtils(this.data.filterModalObj,"add",{showNewFilterModal:!0,currentModelName:"Save Filter",currentModelHeader:I18n.getMsg("crm.email.save.filter")})}},SaveNewAndRenameFilter:function(e){event.preventDefault();var t="",i=this.data.filterModalObj.filterName.trim(),a=$L("#SaveFiltername .lyteField");if(renderingUtils.hideLyteErrorMessages(a),t=!0===(t="string"==typeof(t=""===i?I18n.getMsg("crm.workflow.chat.validate.message",I18n.getMsg("crm.email.filter.name")):getClrTxtPtnResChars(i))?t:t.length?I18n.getMsg("crm.clearTextPattern.validationFail.alert.moreThanOneChar",[I18n.getMsg("crm.email.filter.name"),t.join(", ")]):this.isFilterNamePresent(i))?I18n.getMsg("crm.warning.duplicate.filter.name"):t)renderingUtils.showLyteErrorMessage(t,a),$L("#SaveFiltername").focus();else{var r=this;if(e.ltProp("disabled",!0),"Rename Filter"===this.data.filterModalObj.currentModelName){var l,s=Lyte.Router.getRouteInstance().parent.getDynamicParam(),o=this.getData("api_name");if((l=store.peekRecord("filter",this.EditOption_filter_id)).$.set("name",i),!l.$.isDirty())return renderingUtils.showLyteErrorMessage(I18n.getMsg("crm.alert.no.changes"),a),void e.ltProp("disabled",!1);l.$.save({cvid:s,module:o}).then((function(){e.ltProp("disabled",!1),Lyte.objectUtils(r.data.filterModalObj,"add",{showNewFilterModal:!1}),r.displayMsg("success",I18n.getMsg("crm.filter.save.msg")),r.enableFilterSort()}),(function(t){e.ltProp("disabled",!1),l.$.rollBack();var i=JSON.parse(t.response);i.filters&&i.filters[0]&&"A filter with this name already exists"===i.filters[0].message?renderingUtils.showAlertMsg(I18n.getMsg("crm.warning.duplicate.filter.name")):i.filters&&i.filters[0]&&"INVALID_MODULE"===i.filters[0].code||"NO_PERMISSION"==i.code?renderingUtils.displayPermissionDenied():renderingUtils.showAlertMsg(I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.label.filter")))}))}else if("Save Filter"===this.data.filterModalObj.currentModelName){r=this,s=Lyte.Router.getRouteInstance().parent.getDynamicParam(),o=this.getData("api_name");if((l={}).name=i,this.criteria&&(l.criteria=this.criteria),this.cross_filters&&(l.cross_filters=this.cross_filters,this.data.supportRelatedModules))for(var n=l.cross_filters.length,d=0;d<n;d++){var c=l.cross_filters[d];c.relation.api_name.endsWith("__r")||c.relation.type&&"field"===c.relation.type||r.data.historyTrackingRelations.contains(c.relation.api_name)||r.data.supportedRelatedModules.contains(c.relation.api_name)||(c.relation.api_name+="__r"),c.relation.relation&&!c.relation.relation.api_name.endsWith("__r")&&(c.relation.relation.api_name+="__r")}l=this.replaceSpecialLookups(l);var p=store.createRecord("filter",l);store.create("filter",void 0,{cvid:s,module:o}).then((function(t){r.preventFilterCount=!0,e.ltProp("disabled",!1),r.cross_filters=null,r.criteria=null;var i=r.getData("savedFilters");r.filter_id=t.filter.id,crmTab.getFromCache(r.data.module)&&(crmTab.getFromCache(r.data.module).filter_id=r.filter_id),r.setData("appliedFilterId",t.filter.id);var a=$L("crm-customview-layer")[0];a&&a.setData("appliedFilterId",t.filter.id);var l=store.peekAll("filter"),n=Lyte.Router.getRouteInstance("crm.tab.module.custom-view");"messages__s"!==o&&"Messages"!==o||(n=Lyte.Router.getRouteInstance("crm.tab.messages.custom-view.list")),store.clearCachedQuery("filter",{module:r.getData("module"),cvid:s}),0===i.length?(n.currentModel.saved_filters||(murphy.info("\n\n\n No Saved Filter Object = "+n.currentModel.saved_filters),n.currentModel.saved_filters=i),Lyte.arrayUtils(n.currentModel.saved_filters,"push",[store.peekAll("filter").filterBy({id:t.filter.id})[0]])):Lyte.arrayUtils(i,"push",[l.filterBy({id:t.filter.id})[0]]);r.getData("module_info").id;r.fetchFilterCount(store.peekRecord("filter",t.filter.id)),r.index=i.length-1,r.displayMsg("success",I18n.getMsg("crm.filter.save.msg")),r.setData({isSaveFilter:!1,isApplyFilter:"Messages"===r.data.module,applyfiltervisibility:!0}),a&&a.setData({isSaveFilter:!1,isApplyFilter:"Messages"===r.data.module});var d=document.querySelector("#applyBtn");d&&d.ltProp("disabled",!0),Lyte.objectUtils(r.data.filterModalObj,"add",{showNewFilterModal:!1,filterName:""});var c=$L("#listOfSavedFilter");c.scrollTop(c[0].scrollHeight),r.enableFilterSort()}),(function(t){e.ltProp("disabled",!1),p.$.deleteRecord();var i=JSON.parse(t.response);i.filters&&i.filters[0]&&"A filter with this name already exists"===i.filters[0].message?renderingUtils.showAlertMsg(I18n.getMsg("crm.warning.duplicate.filter.name")):"limit reached"===i.message?r.displayMsg("error",I18n.getMsg("crm.warning.filter.limit.exceed.new",i.details.limit)):i.filters&&i.filters[0]&&"INVALID_DATA"===i.filters[0].code&&"The given criteria is not valid as it contains dynamic formula"===i.filters[0].message?renderingUtils.showAlertMsg(I18n.getMsg("crm.formula.dynamic.filter.error")):i.filters&&i.filters[0]&&"INVALID_DATA"===i.filters[0].code?renderingUtils.showAlertMsg(I18n.getMsg("crm.filters.permissions.error")):i.filters&&i.filters[0]&&"COMPARATOR_LIMIT_EXCEEDED"===i.filters[0].code?renderingUtils.showAlertMsg(I18n.getMsg("crm.multi.select.field.cv.filter.limit.reached.msg",i.filters[0].details.limit?i.filters[0].details.limit:crmConstants.include_exclude_comparator_limit)):i.filters&&i.filters[0]&&"DEPENDENT_MISMATCH"===i.filters[0].code?renderingUtils.showAlertMsg(I18n.getMsg("crm.multi.select.field.option.limit.reached.heading",i.filters[0].details.maximum_length?i.filters[0].details.maximum_length:crmConstants.include_exclude_values_limit)):i.filters&&i.filters[0]&&"INVALID_MODULE"===i.filters[0].code||"NO_PERMISSION"==i.code?renderingUtils.displayPermissionDenied():r.displayMsg("error",I18n.getMsg("crm.errorpage.note1"))}))}}},deleteSavedFilter:function(){this.deleteSelectedFilter(),this.enableFilterSort()},cancelAppliedFilter:function(){this.setData("isApplyFilter",!0),document.querySelector("#applyBtn").ltProp("disabled",!0),this.setData("isSaveFilter",!1);var e=$L("crm-customview-layer")[0];e&&e.setData({isApplyFilter:!0,isSaveFilter:!1})},closeModal:function(){this.close()}},isFilterNamePresent:function(e){for(var t=this.getData("savedFilters"),i=t.length,a=0;a<i;a++)if(e.toUpperCase()===t[a].name.toUpperCase())return a!==parseInt(this.EditFilterindex)||"Rename Filter"!==this.data.filterModalObj.currentModelName;return!1},getChildModulesFields:function(e){for(var t=e.length,i=[],a=0;a<t;a++){var r=app.store.makeRequest("findRecord","module",e[a],void 0,void 0,void 0,{getFields:!0});i.push(r)}return i},getCurrentFilter:function(e){var t=Lyte.Router.getRouteInstance().parent.getDynamicParam(),i=this.getData("api_name");return store.findRecord("filter",e,{module:i},!1,!0,{cvid:t,filter_id:e}).then((function(e){return e&&Object.keys(e).length?e[0]:""}),(function(){return""}))},clearSearchFilter:function(){var e=this.$node.querySelector("crux-smart-filter"),t=e.querySelector("#searchId");t.ltProp("value")&&$L.fastdom.mutate((function(){t.setValue("")})),e&&e.component.clearSearchValue(!0)},displayMsg:function(e,t){document.querySelector("#SuccessMsg").ltProp({type:e,show:!0,message:t})},applycriteria:function(e,t){var i=Lyte.Router.getRouteInstance();if(e!=i.getQueryParams().filter_id){this.clearfield(this),crmTab.getFromCache(this.data.module)&&(crmTab.getFromCache(this.data.module).filter_id=e);var a={filter_id:e,filters:void 0,cross_filters:void 0,per_page:void 0,sort_order:void 0,sort_by:void 0};a.page="chart"!==i.routeName?1:void 0;var r={clearCache:!0,clearselectedIds:!0};"kanban"===i.routeName&&(r.kvId=i.transition&&i.transition.data?i.transition.data.kvId:void 0,r.skipUserLvlUpdate=!0,r.skipUserLevelReq=!0),i.setQueryParams(a).data=r}$L("#savedItem_"+t)[0];this.index=t,this.filter_id=e,this.setData("appliedFilterId",e);var l=$L("crm-customview-layer")[0];l&&l.setData("appliedFilterId",e)},deleteSelectedFilter:function(){var e=this,t=$L("#deleteBtn")[0];event.preventDefault(),t.ltProp("disabled",!0);var i=this.EditOption_filter_id,a=this.getData("api_name"),r=Lyte.Router.getRouteInstance().parent.getDynamicParam(),l=store.peekRecord("filter",i);l.$.deleteRecord(),l.$.save({cvid:r,filter_id:i,module:a}).then((function(){t.ltProp("disabled",!1),e.updateAfterDelete(i),e.enableFilterSort()}),(function(a){t.ltProp("disabled",!1);var r=JSON.parse(a.response);r.filters&&r.filters[0]&&"INVALID_DATA"==r.filters[0].code?e.updateAfterDelete(i):(r.filters&&r.filters[0]&&"INVALID_MODULE"==r.filters[0].code||"NO_PERMISSION"==r.code?renderingUtils.displayPermissionDenied():e.displayMsg("error",I18n.getMsg("crm.errorpage.note1")),l.$.rollBack())}))},updateAfterDelete:function(e){var t=this.EditFilterindex,i=this.getData("savedFilters"),a=Lyte.Router.getRouteInstance();if(this.data.appliedFilterId==e){this.index=void 0,this.filter_id=void 0,this.setData("appliedFilterId",void 0);var r=$L("crm-customview-layer")[0];r&&r.setData("appliedFilterId",void 0)}a.getQueryParams().filter_id==e&&this.clearfield(),Lyte.arrayUtils(i,"removeAt",t);for(var l=i.length,s=0;s<l;s++){var o=store.peekRecord("filter",i[s].id);o&&o.$.set("sequence_number",s+1)}this.displayMsg("success",I18n.getMsg("crm.filter.delete.msg")),this.close(),delete this.EditOption_filter_id,delete this.EditFilterindex},clearfield:function(e,t,i,a){e=void 0===e||e,$L("#customFilter")[0].resetFields(),this.filter_id=void 0,this.setData("appliedFilterId",void 0),this.index=null,this.setData("isApplyFilter",!1);var r=$L("crm-customview-layer")[0];r&&r.setData({isApplyFilter:!1,appliedFilterId:void 0}),customViewObject.filterId=customViewObject.filter_id=customViewObject.filters=customViewObject.cross_filters=void 0;var l={filter_id:void 0,filters:void 0,cross_filters:void 0};if(e&&!t){var s=Lyte.Router.getRouteInstance(),o=s.getQueryParams();l={filter_id:void 0,filters:void 0,cross_filters:void 0};(o.filter_id||o.filters||o.cross_filters)&&(l.per_page=l.sort_order=l.sort_by=void 0,l.page="chart"!==s.routeName?1:void 0);var n={clearCache:!0,clearselectedIds:!1,fetchOnlyBody:!0,isFilterApply:!0};n.layoutId=s.transition.data.layoutId,n.pipeline=s.transition.data.pipeline,s.setQueryParams(l).data=n}else if(t){if(a)for(var d in moduleApiMapping)moduleApiMapping.hasOwnProperty(d)&&moduleApiMapping[d]===i&&(i=d);var c={};c.queryParams=l,this.fetchData(c,i,{clearCache:!0,clearselectedIds:!0},!0,!1,this.getData("featureName"))}},close:function(){if("Delete Filter"===this.data.filterModalObj.currentModelName)Lyte.objectUtils(this.data.filterModalObj,"add",{showDeleteFilterModal:!1}),$(document).off("keydown");else if("Save Filter"===this.data.filterModalObj.currentModelName||"Rename Filter"===this.data.filterModalObj.currentModelName){var e=$L("#SaveFiltername");renderingUtils.hideLyteErrorMessages(e),Lyte.objectUtils(this.data.filterModalObj,"add",{filterName:"",showNewFilterModal:!1})}},applyFilterId:function(e){var t=this;this.getCurrentFilter(e).then((function(e){if(e){var i=$L("#customFilter")[0],a=crmTab.getFromCache(t.data.module);a=a||{};var r={},l=!1,s=[];customViewObject.filters=customViewObject.cross_filters=void 0,e&&e.criteria&&(l=!0,r.filters=JSON.parse(JSON.stringify(e.criteria)),a.filters=e.criteria),e&&e.cross_filters&&(l=!0,r.cross_filters=JSON.parse(JSON.stringify(e.cross_filters)),a.cross_filters=e.cross_filters,t.data.supportRelatedModules&&e.cross_filters.forEach((function(e){var i=e.relation.api_name,a=t.data.relatedModulesMapping[i];if(t.data.supportedRelatedModules.includes(i)&&a){var r=moduleRecordMapping[a.module_name];r.fields&&0!==r.fields.length||s.push(r.id)}}))),r=t.changeQueryParamsForRole(r),t.data.supportRelatedModules&&r.cross_filters&&r.cross_filters.length>0&&t.modifyRelationApiName(r.cross_filters),l&&Lyte.resolvePromises(t.getChildModulesFields(s)).then((function(){i.component.setCriteria(r),t.toggleFilterbuttons(t),t.setMspFieldsVsIncludeCrossFilter(t,r.cross_filters,t.getData("multiSelectPickListFields")),t.setMspFieldsVsInclude(t,r.filters,t.getData("multiSelectPickListFields"));var e=$L("#searchId")[0];e&&e.ltProp("value")&&e.setValue(e.ltProp("value")),t.setFilterSummary(),setTimeout((function(){if("Messages"===t.data.module){var e=document.querySelector("#applyBtn");e||(t.setData("isApplyFilter",!0),e=document.querySelector("#applyBtn")),e&&e.ltProp("disabled",!0)}else{t.setData({isApplyFilter:!1});var i=$L("crm-customview-layer")[0];if(i){var a=Lyte.Router.getRouteInstance();a.transition.info.route.includes("kanban")&&!a.errorOnRecordsGet||!a.transition.info.route.includes("kanban")&&!a.lookupLimitExceeded&&!a.hasErrorInFilter?i.setData({isApplyFilter:!1}):(t.setData({isApplyFilter:!0,isSaveFilter:!1}),i.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0))}t.resize()}t.setData({applyfiltervisibility:!0})}),250)})),l||t.setFilterSummary()}else Lyte.Router.getRouteInstance().errorOnRecordsGet||renderingUtils.showMsgBox(I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.button.cvfilter")),"error")}))},applyQueryParams:function(e){var t=this,i=Lyte.Router.getRouteInstance(),a=$L("#customFilter")[0],r=$L("crm-customview-layer")[0];if(e&&e.filter_id&&(i.isRecordFetched||!e.filters&&!e.cross_filters)){$L(".collapse-view").hide();for(var l=this.getData("savedFilters"),s=l.length,o=0;o<s;o++)if(l[o].id==e.filter_id)try{this.applycriteria(e.filter_id,o,!0),this.applyFilterId(e.filter_id)}catch(e){murphy.info("\n\n\n Error while rendering saved filter filter = "+e+"\n")}}else if(e&&(e.filters||e.cross_filters)){if(e.filter_id||customViewObject.filter_id&&this.data.module===customViewObject.module){var n=e.filter_id?e.filter_id:customViewObject.filter_id;this.filter_id=n,i.cachedObj.filter_id=i.currentModel.filter_id=n,this.setData("appliedFilterId",n),r&&r.setData("appliedFilterId",n)}var d=$L("crux-smart-filter")[0];d&&d.getData("appliedFields").length&&d.resetFields();var c={};c.filters=e.filters?JSON.parse(e.filters):e.filters,c.cross_filters=e.cross_filters?JSON.parse(e.cross_filters):e.cross_filters,c=this.changeQueryParamsForRole(c),this.data.supportRelatedModules&&c.cross_filters&&c.cross_filters.length>0&&this.modifyRelationApiName(c.cross_filters),$L(".collapse-view").hide();try{a.component.setCriteria(c),t.toggleFilterbuttons(t)}catch(e){murphy.info("\n\n\n Error while rendering filter = "+e+"\n")}t.setMspFieldsVsIncludeCrossFilter(t,c.cross_filters,t.getData("multiSelectPickListFields")),t.setMspFieldsVsInclude(t,c.filters,t.getData("multiSelectPickListFields")),setTimeout((function(){t.saveBtn||t.applyBtnDisbled?(delete t.saveBtn,delete t.applyBtnDisbled):t.getData("isApplyFilter")&&document.querySelector("#applyBtn").ltProp("disabled",!0),t.setData({applyfiltervisibility:!0})}),300);var p=$L("#searchId")[0];p&&p.ltProp("value")&&p.setValue(p.ltProp("value")),this.setFilterSummary()}t.getData("preventUserAction")&&setTimeout((function(){t.setData("preventUserAction",!1)}),100),this.applyBtnDisbled=!1;var m=t.getPreventSaveFilter(a),u=i.getQueryParams();if(t.showSaveFilterBtnOnRefresh&&(t.setData({isSaveFilter:!0,isApplyFilter:!1}),r&&r.setData({isSaveFilter:!0,isApplyFilter:!1}),u.filters&&(t.criteria=JSON.parse(u.filters)),u.cross_filters&&(t.cross_filters=JSON.parse(u.cross_filters)),t.saveBtn=!0,t.showSaveFilterBtnOnRefresh=!1),!t.data.isFilterAvailable||!(t.getData("savedFilters").length<t.getData("smartFiltersLimit")||t.data.appliedFilterId)||m.preventSaveFilter||window.clientPortalName){var f=$L("#saveBtn")[0];if(f){"prediction"!==m.preventSaveFilter&&"PathFinder"!==m.preventSaveFilter&&"NBX"!==m.preventSaveFilter&&"abm"!==m.preventSaveFilter&&"similarity"!==m.preventSaveFilter&&"recommendation"!==m.preventSaveFilter&&"competitor_alert"!==m.preventSaveFilter&&"best_time"!==m.preventSaveFilter||(t.setData("preventSaveFilter",!0),r.setData("preventSaveFilter",!0));var y=!(t.getData("savedFilters").length<t.getData("smartFiltersLimit")||t.data.appliedFilterId),_="PathFinder"===m.preventSaveFilter?I18n.getMsg("pf.prevent.save.filter"):"NBX"===m.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("crm.zia.nba.feature.label")):"prediction"===m.preventSaveFilter?I18n.getMsg("crm.prediction.smartfilter.save.msg"):"best_time"===m.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("crm.best.time.column.label")):"abm"===m.preventSaveFilter?I18n.getMsg("crm.abm.smart.filter.action.not.supported"):"similarity"===m.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("crm.setup.system.ziasimilarity")):"recommendation"===m.preventSaveFilter?I18n.getMsg("crm.zia.nbx.smartfilter.save.msg",I18n.getMsg("zia.tab.recommendation")):"competitor_alert"===m.preventSaveFilter?I18n.getMsg("crm.competitoralert.smart.filter.prevent"):y?I18n.getMsg("crm.warning.filter.limit.exceed.new",t.getData("smartFiltersLimit")):"";f.ltProp("disabled",!0),r.setData("preventSaveFilterMsg",_),f.setAttribute("lt-prop-tooltip-config",'{"position" : "bottom" , "appearance" : "callout" , "maxdisplaytime" : 5000 }')}}i.transition.info.route.includes("chart")||!i.lookupLimitExceeded&&!i.hasErrorInFilter||(t.setData({isApplyFilter:!0,isSaveFilter:!1}),r.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0))},setMspFieldsVsIncludeCrossFilter:function(e,t,i){if(!t)return!1;for(var a=t.length,r=0;r<a;r++)e.setMspFieldsVsInclude(e,t[r].criteria,i,t[r].relation)},setMspFieldsVsInclude:function(e,t,i,a){if(!t)return!1;if(t.group)for(var r=t.group.length,l=0;l<r;l++)e.setMspFieldsVsInclude(e,t.group[l],i,a);else{var s=t.field?t.field.api_name:t.api_name,o=t.field?t.field.id:t.id;if((s=a&&a.api_name?s+"_"+o+"_"+a.api_name:s)&&i.contains(s)&&["include_all","include_any","exclude_all","exclude_any"].contains(t.comparator)){var n=e.getData("mspfieldsVsinclude");n.add("option_"+s),e.setData("mspfieldsVsinclude",n)}}},getPreventSaveFilter:function(e){for(var t={preventSaveFilter:!1},i=e.getSelectedFields(),a=i.length,r=0;r<a;r++){var l=i[r],s=l,o=l.api_name;s&&s.field_data_type&&s.api_name&&("recommendation"!==s.field_data_type&&"similarity"!==s.field_data_type&&"NBX"!==s.field_data_type||(t.preventSaveFilter=s.field_data_type),"Prediction"===s.field_data_type&&(t.preventSaveFilter="prediction"),"crossfield"!==s.field_data_type||"cxFilter_Likely_to_convert"!==s.api_name&&"cxFilter_Recent_prediction_score"!==s.api_name&&"cxFilter_Records_to_focus"!==s.api_name||(t.preventSaveFilter="prediction"),!o||"Prediction"!==o&&"cxFilter_Prediction_Score"!==o&&"Prediction_Score"!==o||(t.preventSaveFilter="prediction"),"time_to_reach__s"===s.api_name&&(t.preventSaveFilter="PathFinder"),"ABM_Techniques"!==s.api_name&&"ABM_Scores"!==s.api_name&&"cxFilter_Linked_Segment__s"!==s.api_name||(t.preventSaveFilter="abm"),"cxFilter_Competitor_Alert"===s.api_name&&(t.preventSaveFilter="competitor_alert"),o&&"best_time"===o&&(t.preventSaveFilter="best_time"))}return t},operatorGroupTraverse:function(e){if(e.group_operator)for(var t=e.group,i=t.length,a=0;a<i;a++)t[a].group_operator&&this.operatorGroupTraverse(t[a]),t[a].field&&t[a].field.api_name.indexOf(".role")>-1?t[a].comparator+="_role":t[a].field&&t[a].field.api_name.indexOf(".group")>-1&&(t[a].comparator+="_group");else e.field&&(e.field.api_name.indexOf(".role")>-1&&(e.comparator+="_role"),e.field.api_name.indexOf(".group")>-1&&(e.comparator+="_group"))},changeQueryParamsForRole:function(e){if(e&&e.filters&&this.operatorGroupTraverse(e.filters),e&&e.cross_filters)for(var t=e.cross_filters.length,i=0;i<t;i++){var a=e.cross_filters[i];a.relation&&a.relation.relation&&("GroupUserRel__s"===a.relation.relation.api_name||"GroupUserRel__s__r"===a.relation.relation.api_name)&&(a.criteria.comparator+="_group")}return e},observeFilterQuerParams:function(e){var t=$L("crm-customview-layer")[0],i=this.$node.querySelector("crux-smart-filter");if(!(void 0!==e.newValue.filters&&"undefined"!==e.newValue.filters||void 0!==e.newValue.filter_id||void 0!==e.newValue.cross_filters&&"undefined"!==e.newValue.cross_filters)){if(this.setData({isSaveFilter:!1}),t&&t.setData("isSaveFilter",!1),this.data.appliedFilterId&&(this.setData("appliedFilterId",void 0),t&&t.setData("appliedFilterId",void 0)),i&&i.getData("appliedFields").length){this.setData("isApplyFilter",!1),t&&t.setData("isApplyFilter",!1),i.resetFields();var a=$L("#searchId")[0];a&&a.setValue(a.ltProp("value"))}return $L(".collapse-view").show(),this.setFilterSummary(),this.resize(),!1}this.getData("isApplyFilter")&&document.querySelector("#applyBtn").ltProp("disabled")?this.applyBtnDisbled=!0:(this.getData("isSaveFilter")||this.data.isFromModal)&&(this.saveBtn=!0),this.preventUserAction&&(this.preventUserAction=!1,this.setData("preventUserAction",!0)),i&&i.getData().checked.length&&void 0===e.newValue.filter_id&&(i.resetFields(),this.setData({isSaveFilter:!0}),t&&t.setData("isSaveFilter",!0),this.saveBtn=!0),this.applyQueryParams(e.newValue)}.observes("filterQueryParams"),observesSavedFilter:function(){var e=this;this.setSavedFilters(),setTimeout((function(){e.resize()}),100)}.observes("savedFilters.[]"),getMultiSelectPicklistConditions:function(e,t,i){if(Crm.userDetails.multiSelectFilterOptions&&e){var a=e.getData("mspfieldsVsinclude"),r=I18n.getMsg("crm.multi.select.field.filter.limit.reached.tooltip",crmConstants.include_exclude_comparator_limit);return e.getData("featureName")||(r=I18n.getMsg("crm.multi.select.field.cv.filter.limit.reached.tooltip",crmConstants.include_exclude_comparator_limit)),a.size+e.getData("cvCriteriaMSPLCount")>=crmConstants.include_exclude_comparator_limit&&i&&!a.has(i.$node.id)?[{system:"equal",display:I18n.getMsg("is")},{system:"not_equal",display:I18n.getMsg("isn't")},{system:"contains",display:I18n.getMsg("contains")},{system:"not_contains",display:I18n.getMsg("doesn't contain")},{system:"starts_with",display:I18n.getMsg("starts with")},{system:"ends_with",display:I18n.getMsg("ends with")},{system:"include_all",display:I18n.getMsg("includes all"),cxDisabled:!0,cxTitle:r},{system:"include_any",display:I18n.getMsg("include any"),cxDisabled:!0,cxTitle:r},{system:"exclude_all",display:I18n.getMsg("excludes all"),cxDisabled:!0,cxTitle:r},{system:"exclude_any",display:I18n.getMsg("exclude any"),cxDisabled:!0,cxTitle:r},{system:"${EMPTY}",display:I18n.getMsg("is empty")},{system:"${NOTEMPTY}",display:I18n.getMsg("is not empty")}]:[{system:"equal",display:I18n.getMsg("is")},{system:"not_equal",display:I18n.getMsg("isn't")},{system:"contains",display:I18n.getMsg("contains")},{system:"not_contains",display:I18n.getMsg("doesn't contain")},{system:"starts_with",display:I18n.getMsg("starts with")},{system:"ends_with",display:I18n.getMsg("ends with")},{system:"include_all",display:I18n.getMsg("includes all")},{system:"include_any",display:I18n.getMsg("include any")},{system:"exclude_all",display:I18n.getMsg("excludes all")},{system:"exclude_any",display:I18n.getMsg("exclude any")},{system:"${EMPTY}",display:I18n.getMsg("is empty")},{system:"${NOTEMPTY}",display:I18n.getMsg("is not empty")}]}},resize:function(){$L.fastdom.measure(function(){var e,t=0,i=window.pageYOffset,a=$L("#lv_left_filter"),r=$L("#lv_filter_scroll"),l=a[0].getBoundingClientRect().top,s=innerHeight-(l+28)-i;e=this.getData("savedFilters").length?a.find(".searchSaveContainer").outerHeight():0;var o=$L(".filterSearchElement").outerHeight();this.getData("isApplyFilter")&&(t=$L(".footerActionEle").outerHeight()),a.height(s-20),r.height(s-(e+o+10+t+20)),$L.fastdom.mutate(function(){this.setData("setboundary",{top:r[0].getBoundingClientRect().top,bottom:r[0].getBoundingClientRect().bottom})}.bind(this))}.bind(this))},reorder:function(){var e=this.getData("savedFilters");if(this.getData("smartFiltersRevampEnabled")&&e){for(var t=e.length,i=0;i<t-1;i++)for(var a=0;a<t-1-i;a++)if(!e[a].sequence_number&&e[a+1].sequence_number||e[a].sequence_number>e[a+1].sequence_number){var r=e[a];e[a]=e[a+1],e[a+1]=r}this.setData("savedFilters",e);var l=e.map((function(e){return e.id}));this.setData("originalFiltersList",l);for(i=0;i<t;i++)Lyte.arrayUtils(e,"replaceAt",i,e[i])}},updateFilterOrder:function(e){var t=this;store.triggerAction("filter","reorder",e).then((function(){for(var e=t.reOrderFiltersList.length,i=0;i<e;i++){var a=store.peekRecord("filter",t.reOrderFiltersList[i]);a&&a.$.set("sequence_number",i+1)}t.reorder(),t.enableFilterSort()}),(function(){t.enableFilterSort()}))},enableFilterSort:function(){var e=this,t=e.getData("savedFilters").length,i=$L("#savedFilterSort");e.getData("smartFiltersRevampEnabled")&&i&&i.length>0&&t>1&&i.sortable({containment:"parent",onDrag:function(t){t.querySelector(".zcicncss-drag").classList.add("zcicncss-drag-visible"),e.setData("filtersOnDrag",!0)},onDrop:function(t){t.querySelector(".zcicncss-drag").classList.remove("zcicncss-drag-visible");var i=e.getData("modifiedSavedFilters");i.add(t.querySelector("#savedFilterSort .savedFilterOption").getAttribute("filter_id")),e.setData("modifiedSavedFilters",i),e.setData("filtersOnDrag",!1);var a=e.getData("savedFilters"),r=e.getData("originalFiltersList"),l=e.$node.querySelectorAll("#listOfSavedFilter .savedFilterOption").map((function(e){return e.getAttribute("filter_id")})),s=e.constructPayloadForReorder(r,l,1===i.size?i:void 0);if(clearTimeout(e.updateFilterOrdertimeout),0!==s.length){for(var o=store.peekAll("filter")._recMap,n=l.length,d=0;d<n;d++)Lyte.arrayUtils(a,"replaceAt",d,o.get(l[d]));e.enableFilterSort();var c=Lyte.Router.getRouteInstance().parent.getDynamicParam(),p=e.getData("api_name");e.reArrangedFiltersPayload={cvid:c,module:p,filter:s},e.reOrderFiltersList=l,e.updateFilterOrdertimeout=setTimeout((function(){e.updateFilterOrdertimeout=void 0,e.getData("filtersOnDrag")||(i.clear(),e.data&&e.setData("modifiedSavedFilters",i),e.updateFilterOrder(e.reArrangedFiltersPayload))}),4e3)}}})},didDestroy:function(){window.removeEventListener("resize",this._resize,!0),window.removeEventListener("visibilitychange",this._reorderUnloadListener),this.updateFilterOrdertimeout&&(clearTimeout(this.updateFilterOrdertimeout),this.refreshview||this.updateFilterOrder(this.reArrangedFiltersPayload)),this.data.relatedModules&&this.data.relatedModules.length>0&&this.deleteChildModulePayloads(this.data.relatedModules)},filterReorderUnloadListener:function(){var e=this;e.updateFilterOrdertimeout&&e.reArrangedFiltersPayload&&store.triggerAction("filter","reorder",e.reArrangedFiltersPayload)},didConnect:function(){this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize,!0),this._reorderUnloadListener=this.filterReorderUnloadListener.bind(this),window.addEventListener("visibilitychange",this._reorderUnloadListener);var e=this.getData("module_info");e&&e.filter_status&&(this.resize(),this.isFilterHeight=!0);var t=this.data.isFromModal?this.data.queryParams:Lyte.Router.getRouteInstance().getQueryParams();!t||!t.filters&&!t.cross_filters||t.filter_id||customViewObject.filter_id||(this.showSaveFilterBtnOnRefresh=!0);var i=this;t&&t.cross_filters?Lyte.resolvePromises(this.fetchCrossFilterModuleFields(JSON.parse(t.cross_filters))).then((function(){i.applyQueryParams(t)})):this.applyQueryParams(t);var a=$L("#listOfSavedFilter"),r=a.find(".cvSavedFilterLi "),l=r.length;if(r.length>5)for(var s=a[0].scrollHeight,o=5;o<l;o++)if(r[o].classList.contains("bC")){a.scrollTop(s);break}this.enableFilterSort()},modifyRelationApiName:function(e){for(var t=e.length,i=0;i<t;i++){var a=e[i];(a.relation.api_name.endsWith("__r")&&!a.relation.api_name.endsWith("CrmCompetitorMention__r")&&!this.data.supportedRelatedModules.contains(a.relation.api_name)||this.isLinkingMxn2(a))&&(a.relation.api_name=this.data.multiSelectRelations[a.relation.api_name]&&this.data.multiSelectRelations[a.relation.api_name].api_name?this.data.multiSelectRelations[a.relation.api_name].api_name:a.relation.api_name.slice(0,-3))}},isLinkingMxn2:function(e){return!(!this.data.multiSelectRelations[e.relation.api_name]||e.criteria.group||this.data.multiSelectRelations[e.relation.api_name].connectedlookup_apiname!==e.criteria.field.api_name)},populateChildFields:function(e,t,i){if(!(e&&e.childFields&&e.childFields.length>0)){var a=this.restricted_related_field_ui_types,r=this.filterFieldsForSmartFilter(i,!0),l=e.api_name,s=this.data.relatedModulesMapping,o=[];this.data.multiSelectRelations[l]&&o.push(this.data.multiSelectRelations[l].connectedlookup_apiname);for(var n=[],d=this.getData("multiSelectPickListFields"),c=t?t.length:0,p=0;p<c;p++)"multiselectpicklist"===t[p].data_type&&(t[p].cxForceSetCondition=!0,d.push(t[p].api_name+"_"+t[p].id+"_"+e.api_name)),e.moduleName.includes("VocEvents")&&"EVENT"===t[p].column_name&&"Event__s"===t[p].api_name&&1===t[p].ui_type&&(t[p].cxDynamicFilterCriteriaComponent=!0),o.contains(t[p].api_name)||a.contains(t[p].ui_type)||r.contains(t[p].column_name)||t[p].id===s[l].field.id||"What_Id"===t[p].api_name||"Who_Id"===t[p].api_name||13===t[p].show_type&&-1!==["Recency","Frequency","Monetary"].indexOf(t[p].api_name)||n.push(t[p]);n=this.sortArray(n,"field_label"),Lyte.Component.set(e,{childFields:n})}}},{mixins:["crm-view-utils","crm-list-view-modal-util","crm-filter-utils","crm-dataprivacy-mixin"]}),Lyte.Mixin.register("crm-filter-utils",{restricted_related_modules:["Cadences_Followups","Entity_Cadences","Users","WebformUsage","EmailSentiment","Competitors","Competitor Mentions","Google AdWords","GoogleAdsAccount","GoogleAdsAccountHistory","GoogleAdsCampaign","GoogleAdsCampaignHistory","GoogleAdGroup","GoogleAdGroupHistory","GoogleAdwordAd","GoogleAdwordAdHistory","GoogleAdKeyword","GoogleAdKeywordHistory","Forecast Predictions","Forecast Analysis","Forecast Prediction Stats","Messages","MarketingAttributions","Facebook","Twitter","LockingInformation","VocAnswers","VocAnswers1","VocAnswers2","Review Processes","Review Logs"],restricted_relation_api_names:["Visits_Zoho_Livedesk__r","Locking_Information__s__r","Email_Sentiment__r","Entity_Scores__s__r","similarity_whom__r","similarity_user__r","Marketing_Attributions__r","Activities__r","bundle_whom__r","first_buy_whom__r","cross_selling_whom__r","re_buy_whom__r","next_buy_whom__r","Blueprint_Logs__r","Attachments__r"],restricted_field_column_names:["KEYWORDID","ADID","GADCONFIGID","ADGROUPID","VERSION","TOTALTIME","COMMENTCONTENTS","PARTICIPANTID","ISCALLBILLABLE","CHECKINLONGITUDE","CHECKINLATITUDE","PUBLISHED","PRODUCTDETAILS","PREDICTIONSCORE","ACCOUNTCF501","ZCAMPAIGNID","ISCTICALL","BEST_TIME","ISDUPLICATE","ISAPPROVED","CONVERTEDDATE","CONVERTED"],restricted_related_field_column_names:["EMAILTEMPLATEID","FIELDID","ATTACHMENTSIZE","FORECASTID","PATH","TRIGGERID","ORCHESTRATIONID","CONSENTID","NOTECONTENT","LINETAX","PROCESSINGBASIS","SE_STATUS","MESSAGE_ID","DESCRIPTION","FILESIZE","RELATEDID","SETYPE","FROMID","ATTACHMENTSID","BOOKID","BODY","APPROVALPROCESSID"],restricted_related_field_ui_types:[66,1234,500,555,556,444,445,50,51,99,3,132,53,104,123,999,134],Allowed_skip_relations:["Attachments__r","Activities__r"],filterFieldsForSmartFilter:function(e,t){var i=[];if(i=i.concat(this.restricted_field_column_names),"Appointments"===e)i=i.concat(crmConstants.appointmentsHiddenFieldColName);else if("Services"===e)i=i.concat(crmConstants.serviceHiddenFieldColName);else if("Visits"===e)i=i.concat(["SEID","NOOFPAGES"]);else if(crmTab.isOrchestrationModule(e)||this.data.module.indexOf("PathFinder")>-1)i=i.concat(["P_MODULE","PATH","TRIGGERID","ORCHESTRATIONID"]);else if("Messages"===e)i=i.concat(["HASATTACHMENTS","SMCREATORID","CREATEDTIME","SEID","LAST_MESSAGE","MESSAGECHANNELID","MESSAGE_SERVICE","MOBILENUMBER","MODIFIEDBY","MODIFIEDTIME","CONVERSATION_STATUS","SEMODULE"]);else if("Tasks"===e){i=i.concat(["SENDNOTIFICATION","REMINDAT"])}else if(e.includes("VocEvents"))i=i.concat("EVENT_ASSOCIATED_RESPONSE");else if(Crm.isInventoryModule(e)){i=i.concat(["DISCOUNT_TYPE","DISCOUNT_PERCENTAGE"])}var a=moduleRecordMapping[e].id,r=store.peekRecord("module",a),l=crmTab.isOrchestrationModule(e)||e.indexOf("PathFinder")>-1,s=Crm.userDetails.excludeFilterDataTypes?Crm.userDetails.excludeFilterDataTypes:[];return r.fields.filter((function(e){(s.contains(e.data_type)||"id"===e.api_name&&!l||0===e.show_type&&"FULLNAME"!==e.column_name&&"PROCESSINGBASIS"!==e.column_name&&"CONSENTID"!==e.column_name&&"SE_STATUS"!==e.column_name)&&(i=i.concat(e.column_name))})),t&&(i=i.concat(this.restricted_related_field_column_names)),i},isRealationToBeSkipped:function(e,t){var i=!1;return"Data_Subject_Requests__r"!==e.api_name||Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyPrefEnabledModules.contains(t)||(i=!0),i},replaceSpecialLookups:function(e){return e.filters&&(e.filters=JSON.stringify(e.filters),e.filters.includes("What_Id.Name")&&(e.filters=e.filters.replace("What_Id.Name","What_Id")),e.filters.includes("Who_Id.Full_Name")&&(e.filters=e.filters.replace("Who_Id.Full_Name","Who_Id")),e.filters=JSON.parse(e.filters)),e.cross_filters&&(e.cross_filters=JSON.stringify(e.cross_filters),e.cross_filters.includes("What_Id.Name")&&(e.cross_filters=e.cross_filters.replaceAll("What_Id.Name","What_Id")),e.cross_filters.includes("Who_Id.Full_Name")&&(e.cross_filters=e.cross_filters.replaceAll("Who_Id.Full_Name","Who_Id")),e.cross_filters=JSON.parse(e.cross_filters)),e},restrictedChildModulesRelations:function(e){var t=[];switch(e){case"Leads":case"Contacts":t.push("Campaigns__r");break;case"Campaigns":t.push("Leads__r","Contacts__r");break;case"PriceBooks":t.push("Product_Name__r");break;case"Accounts":t.push("Tasks__r","Calls__r","Events__r","Notes__r")}return t=t.concat(this.restricted_relation_api_names)},isEmailNotSupported:function(e){var t=!1;if(e.group){for(var i=e.group.length,a=0;a<i;a++)if(t=this.isEmailNotSupported(e.group[a]))return t}else"Email"!==e.field.api_name||"equal"!==e.comparator&&"not_equal"!==e.comparator||"${EMPTY}"!==e.value&&"${NOTEMPTY}"!==e.value||(t=!0);return t},getRQCompatibleRelationName:function(e,t){return e&&e.data&&e.data.multiSelectListVsRelations[t]?e.data.multiSelectListVsRelations[t]:t+"__r"}});
