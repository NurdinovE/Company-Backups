store.registerModel("pipeline",{id:Lyte.attr("string"),layout_id:Lyte.attr("string"),pick_list_values:Lyte.hasMany("pick_list_values",{serialize:"partial",deepNest:!0})},{actions:{transfer:{},associated:{}}}),store.registerAdapter("pipeline",{namespace:"crm/v2/settings",buildURL:function(e,i,t,l,a,r,s){"updateRecord"!==i&&"createRecord"!==i||"updateRecord"===i&&((p=a.split("/")).deleteElementAt(p.length-1),a=p.join("/"));if("associated"==r){var p=a.split("pipeline");a=p.join("pipeline/"+s.pipeline_id)}return a},methodForRequest:function(e,i,t,l,a){return"associated"==a?"GET":e},parseResponse:function(e,i,t,l,a){return l=this.super(arguments),("findAll"==e||"findRecord"==e)&&l&&l.pipeline&&0!=l.pipeline.length&&(l.pipeline[0].layout_id=a.layout_id),l}}),store.registerSerializer("pipeline",{serialize:function(e,i,t,l,a,r,s){if(this.delete=!1,("updateRecord"===e||"createRecord"===e)&&i.pipeline){var p=i.pipeline;if(i.pipeline=[],i.pipeline.push(p),"updateRecord"===e){var n=p.pick_list_values,d=n.length;if(1===d&&"modified"===n[0].$.partialType&&l.isStageDeleted){for(var o=t.pick_list_values.filterBy({id:n[0].id})[0].maps,u=o.length,c=0;c<u;c++)if(o[c].hasOwnProperty("_delete")){Lyte.arrayUtils(t.pick_list_values.filterBy({id:n[0].id})[0].maps,"removeAt",c,u-c);break}}else 2===d&&(l.isDefaultChanged?Lyte.arrayUtils(n,"removeObjects",n.filter((function(e){return!e.default}))):l.isDefaultDeleted&&Lyte.arrayUtils(n,"removeObjects",n.filter((function(e){return e.default}))));"removed"===n[0].$.partialType&&(this.delete=!0,Lyte.objectUtils(n[0],"add",{maps:[],display_value:store.peekRecord("pick_list_values",n[0].id).display_value,_delete:{permanent:null}})),n[0].display_value=n[0].display_value?n[0].display_value:t.pick_list_values.filterBy({id:n[0].id})[0].display_value}}return"transfer"==s&&(i=l),i},normalizeResponse:function(e,i,t,l,a){return"updateRecord"!==i&&"createRecord"!==i||(t.pipeline=t.pipeline[0],t.pipeline.id=t.pipeline.details.id,t.pipeline.pick_list_values=t.pipeline.details.pick_list_values,this.delete&&(delete t.pipeline.pick_list_values,this.delete=!1)),"findAll"!==i&&"findRecord"!==i||204!==a||(t.pipeline=[]),t},payloadKey:function(e){return e}}),store.registerModel("pick_list_values",{display_value:Lyte.attr("string",{mandatory:!0,validation:"validateName"}),actual_value:Lyte.attr("string"),id:Lyte.attr("string"),maps:Lyte.attr("array",{minLength:1}),default:Lyte.attr("boolean"),pipeline:Lyte.belongsTo("pipeline")}),Lyte.registerValidator("validateName",(function(e,i){return store.setErrorMessages({SPL_CHAR:I18n.getMsg("crm.pipeline.alert.special.character"),MAX_LENGTH:I18n.getMsg("crm.massmail.limit.title")}),splCharCheckNew(i)?!(i.length>120)||"MAX_LENGTH":"SPL_CHAR"}));
