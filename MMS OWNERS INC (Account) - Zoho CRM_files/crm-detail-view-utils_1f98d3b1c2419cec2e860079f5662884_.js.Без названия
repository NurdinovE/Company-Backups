Lyte.Mixin.register("crm-detail-view-utils",{reRenderTimeline:[!1,!1],executeActionButton:function(e,t,i,a,o,n,s){if("sendMail"==e)if(["SalesOrders","Invoices","Quotes","PurchaseOrders"].contains(t))if(o.Contact_Name){if(store.modelFor(moduleRecordMapping.Contacts.id)){if(store.peekRecord(moduleRecordMapping.Contacts.id,o.Contact_Name.id))return void Lyte.registeredMixins["crm-detail-view-utils"].sendMailForInventoryModules(t,o,store.peekRecord(moduleRecordMapping.Contacts.id,o.Contact_Name.id).Email,n,s)}else store.registerModel(moduleRecordMapping.Contacts.id,{},{extends:"entity"});store.findRecord(moduleRecordMapping.Contacts.id,o.Contact_Name.id).then((function(e){Lyte.registeredMixins["crm-detail-view-utils"].sendMailForInventoryModules(t,o,e[0].Email,n,s)}))}else this.sendMailForInventoryModules(t,o,void 0,n,s);else EntSendMail(t,i,"",a);else if("mailMerge"===e){var r=Crm.getCrmBasePath()+"/MailMerge.do?",l=$L("#lookupdiv")[0],d="action=mergeAction&idlist="+i+"&module="+t,c=csrfParamName+"="+encodeURIComponent(csrfToken);r+=d,mR(r,(function(e){l.style.zIndex=30,l.style.width="550px",renderingUtils.freezeBackground(),$(l).empty(),l.innerHTML=e,mailsetCenter("lookupdiv"),JSEvalScript(l),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}),c)}else if("addRelatedList"==e){var m=$("[name='rlContentChngd']"),u=$("#topBandPopup");"none"==u.css("display")&&m.length>0&&m.val("false"),$L.fastdom.mutate((function(){"none"==u.css("display")&&commonUtils.showHideLoadingDiv(!0)}));r=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addNewRelatedList&module="+t;mR(r,(function(e){$L.fastdom.mutate((function(){u.html(e)})),"none"==u.css("display")&&(commonUtils.showHideLoadingDiv(),showAnimatePopup("topBandPopup"),$("#thirdPartyRowTag").on("click",(function(){$("#thirdPartyRowTag").off("click")})))}))}else if("exportpdf"==e)exportPDF(t,i);else if("printPreview"==e)openPrintTemplatePop(i,t);else if("share"==e){if(0==$("#shareContactPopup").length){$("#show").append('<div id="shareContactPopup"></div>');for(var p=moduleRecordMapping[t].profiles,g=[],_=[],L=[],v="(profile:in:",I=p.length,y=0;y<I;y++)"Administrator"!==p[y].name&&(_.push(p[y].id),g.push(p[y].name));var C={};1===_.length?(v="(profile:equals:"+g[0].toString().replace("(","\\(").replace(")","\\)")+")",C.comparator="equal",C.field="profile.id",C.value=_[0]):(C.value=_,C.comparator="in",C.field="profile.id",v=v+g.join(",").replace("(","\\(").replace(")","\\)")+")"),L.push(C),L.push("and");i=detailView.entityId;f=(f=(f=networkUtils.returnDependencyFiles(["crm-detailview-share-modal.js","lyte-hovercard.js","crux-combo-box.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-detailview-share-modal.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recordlevelsharing")],ResourceConstants.CRM)),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({roles:store.findAll("role",null,!1,!0),filesResolved:Lyte.injectResources(f),shareData:store.triggerAction("entity","share",{type:"GET",module:moduleRecordMapping[t].api_name,entityId:i}),moduleInfo:store.peekRecord("module",moduleRecordMapping[t].id),recordInfo:new Promise((function(e){o?e(o):store.findRecord(moduleRecordMapping[t].id,i).then((function(t){e(t[0])}))}))}).then((function(e){commonUtils.showHideLoadingDiv(!1);var a={comparator:"not_equal",field:"role.name"},o=e.roles.filter((function(e){if(!e.reporting_to)return e}))[0];a.value=o.name,L.push(a);var n=[{users:Array.from(new Set([Crm.userDetails.USER_ID,e.recordInfo.Owner.id])),roles:[o.id],groups:[]}],s={type:"SubordinateRoleUsers",role_id:o.id,include_lite_users:!0};Lyte.Component.render("crm-detailview-share-modal",{userCriteria:L,searchCriteria:v,queryParam:s,module:t,entityId:i,shareData:e.shareData,moduleInfo:e.moduleInfo,excludeModel:n,excludeMembers:n,forceFetch:!0},"#shareContactPopup").show(!1)}),(function(e){commonUtils.showHideLoadingDiv(!1);var i=JSON.parse(e.responseText);let a=[{users:Array.from(new Set([Crm.userDetails.USER_ID])),roles:[],groups:[]}];"403"==e.status||"400"==e.status?"Scheduler is running"===i.message?(Lyte.Component.render("crm-detailview-share-modal",{onProcess:!0,module:t,excludeMembers:a,shareData:{}},"#shareContactPopup"),$L("#crm-detailview-share-modal")[0].ltProp("show",!0)):renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.mb.alert.complete.operation.later"),36e4)}))}}else if(["cliq","slack","cisco","google_chat","microsoft_teams"].indexOf(e)>=0)Crm.loadChatIntegrations(void 0,void 0,"record",e,{module:t,id:i});else if("sendDM"===e){var R=Lyte.Router.getRouteInstance().currentModel?Lyte.Router.getRouteInstance().currentModel.entityDetails:void 0;if(R&&!$u.isEmpty(R.socialObj)){var h,f=networkUtils.returnDependencyFiles(["crm-social-related-list.js","crm-social-models.js","crm-social-posts.js","crm-social-post-detail-outer.js","crm-social-common-models.js","crm-social-setup-models.js","crm-social-integration.js","crm-social-tab-rl-common.js","crm-social-post-detail.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient),N=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),P=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")],ResourceConstants.CRM);if(Crm.userDetails.RTL_ENABLED){var A=networkUtils.returnDependencyFiles(["crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);h=f.concat(N).concat(A).concat(P)}else h=f.concat(N).concat(P);Lyte.injectResources(h,void 0,(function(){Lyte.registeredMixins["crm-social-integration"].sendDmInCanvasView(R.socialObj.dm_id,R.socialObj.profile_id,R.socialObj.TWDMInfo,t,i)}))}}},sendMailForInventoryModules:function(e,t,i,a,o){if("PurchaseOrders"==e){var n=t.Contact_Name?t.Contact_Name.id:"",s=t.Vendor_Name?t.Vendor_Name.id:"";if("ContactMailList"==a){if(t.Contact_Name&&!isEmailValidInAssocCont(t.Contact_Name.name,null,i||(o?"":"null"),"Contacts"))return;var r=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(n)+"&vendorId="+encodeURIComponent(s)+"&flag=false&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail"}else r=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(n)+"&vendorId="+encodeURIComponent(s)+"&flag=true&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail";adjustScreenAndOpen(r)}else{n=t.Contact_Name?t.Contact_Name.id:"";if(t.Contact_Name&&!isEmailValidInAssocCont(t.Contact_Name.name,null,i||(o?"":"null"),"Contacts"))return;r=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(n)+"&flag=false&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail";r=networkUtils.getPortalURL(r),adjustScreenAndOpen(r,e)}},getRelatedListMetaData:function(e){return store.peekRecord("related_list",e)},reloadBlueprintComponents:function(e){var t=document.querySelector("crm-blueprint-layer");void 0===e||e.blueprint.transitions.length<=0?Lyte.registeredMixins["crm-detailview-common-utils"].refreshProcessLayer(this.getData("fresh_record")):t&&t.component.executeMethod("setBlueprintData",e,!0)},populateCountAndActions:function(e,t,i,a,o,n,s={},r,l){if(i&&!i.length>0&&!(n&&n.length>0))return r&&s&&(l&&"object"==typeof l||(l={}),l.rlIdVsCount=s,r(l)),s;var d={},c=this;d.module=e,d.entityId=t,a&&a.setData("isCallInProgress",!0),o&&(i=i.filter((e=>!o.includes(e))),n=n.filter((e=>!o.includes(e))));let m=[];let u=$L("crm-related-list")[0];i&&i.length&&(m=i.slice(0,20)),!m.length&&n&&n.length&&(m=n.slice(0,20));let p={},g=[],_={approved:"both",approval_state:"approved,approval_process_pending,approval_process_rejected"};for(const e of m)g.push({related_list:{id:e},params:_});p.get_related_records_count=g,p.get_related_records_count.length?(d.payLoad=p,store.findAll("get_related_records_count",null,!1,void 0,d).then((function(o){if(!o)return void(a&&a.setData("isCallInProgress",!1));var d=$L("#RelatedListLeftPanel")[0];let p=m.length;var g=$L("crm-related-list")[0];let _=100,L={};for(var v=0;v<p;v++){var I=m[v];_+=100;var y,C=c.getRelatedListMetaData(I);if(C){var R=C.actions;R&&R.length>0&&(y=!0)}let e,t,i=d?d.querySelector("#rl_"+I):void 0;if(!i&&u){let a=u.component.data.parentChildRelationDetails;for(let i of Object.keys(a)){e=a[i];for(let a of e)if(a.id===I){t=i;break}if(t)break}i=d.querySelector("#rl_"+t)}let a=i?i.component:void 0;if(a){y&&a.setData("actionAvailable","");var h=store.peekRecord("get_related_records_count",I);let i=store.peekRecord("related_list",I),o="",n="";if(h&&h.count>0&&(o=h.count),n=o,e){let a=0;for(var f of e)f.id===I&&(f.count=o?parseInt(o):0),a+=f.count;0!==a&&(o=a),i.nodata=0===o,L[t]=o}else o?(i.nodata=!1,setTimeout((function(){a.setData("showCircleLoader",!0),setTimeout((function(){a.setData({showCircleLoader:!1,count:o})}),1e3)}),_)):(i.nodata=!0,a.setData("count",o));Lyte.objectUtils(s,"add",I,""===n?0:n)}else if(Crm.userDetails.CLIENT_ACCOUNT){let e="";(h=store.peekRecord("get_related_records_count",I))&&h.count>0&&(e=h.count),Lyte.objectUtils(s,"add",I,""===e?0:e)}}i.length?i=i.filter((e=>!m.includes(e))):n=n.filter((e=>!m.includes(e))),a&&a.setData("isCallInProgress",!1);for(let e in L){let t=L[e],i=d.querySelector("#rl_"+e).component;i&&(t?setTimeout((function(){i.setData("showCircleLoader",!0),setTimeout((function(){i.setData({showCircleLoader:!1,count:t})}),1e3)}),_):i.setData("count",t))}c.populateCountAndActions(e,t,i,a,void 0,n,s,r,l),g&&g.component.setData("idsNeedCount",i)})).catch((function(){a&&a.setData("isCallInProgress",!1)}))):a&&a.setData("isCallInProgress",!1)},addRelatedListToViewPort:function(){let e=$L("crm-related-list-view")[0];e&&setTimeout((function(){e.component.showViewPortRelatedLists()}),1e3)},editLookupRelNew:function(e,t,i,a){var o=JSON.parse('{"fldName":""}');o.fldName=t.id,o.relatedlist=!0,o.lookuprel=!0,multiLookupsView.frameMLJSON(o);var n=multiLookupsView.getParamJson(o.fldName);n.entityId=e.id,n.link="edit",n.relatedlist=!0,n.mlaction="edit";var s=i;n.searchmodule=s,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:n.searchmodule}),n.select=!0,n.linkingmodule=s,n.relid=t.id,n.parentModule=a,multiLookupsView.submitMultiLookupForm("edit",Crm.getCrmBasePath()+"/Search.do","topBandPopup",n)},executeRelatedListActions:function(e,t,i,a,o,n,s,r){var l=null;if(!t||"SURVEYPERSONALITY"!==t.personality_name||"createsurvey"!==e&&"sendsurvey"!==e&&"attendsurvey"!==e){if(t&&t.module){var d=Object.keys(moduleApiMapping).filter((function(e){return moduleApiMapping[e]==t.module.api_name}));d.length&&(d="Deals"==t.module.api_name?d[1]:d[0])}}else l=store.peekRecord("zsurvey_rl",t.personality_name).ACTIONS[0].URL;switch(e){case"addSeries":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].addSeries(i):crmRelatedList.addSeries(i);break;case"un-EnrollSeries":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].unenrollSeries(a,i):crmRelatedList.unenrollSeries(a,i);break;case"attachDocuments":if(featuresAvailable.Attach_TeamDrive&&Crm.userDetails.isWorkdriveConfigured){var c={WDDomainURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),primaryActionCallBack:Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].addAttachmentsFromTeamDrive:crmRelatedList.addAttachmentsFromTeamDrive,countToSelectMaxFiles:10,width:"850px",height:"calc( "+renderingUtils.windowHeight+"px - 3rem - 20px )",disableFolderSelection:!1,canShare:!0,service:"ZohoCRM",showSearch:!0,zsoid:crmZgid};Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"related list"}),c.shareOptions={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0},defaultShare:"teamShare",externalShareTag:"crm_team"};var m=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([m]),Lyte.injectResources([m],void 0,(function(){(new WorkDrive).showResourcePicker(c)}))}else openZDocsLinkDialog(Crm.userDetails.ZGID);break;case"teamDrivePicker":var u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workdrive")]),p=networkUtils.returnDependencyFiles(["zworkdrive-conf-model.js","crm-related-list-wd-attachments.js"],ResourceConstants.CRMClient),g=u.concat(p);Crm.userDetails.isRelatedListLyteEnabled?Lyte.injectResources(g,void 0,function(){this.attachFromCL(r)}.bind(this)):Lyte.injectResources(g,void 0,(function(){crmRelatedList.attachFromCL()}));break;case"attachDesktop":(Q={}).module=i,Q.module=Q.module?Q.module:Lyte.Globals.get("relatedList.module"),Q.entityId=t.fromBlueprint&&!Lyte.Globals.get("relatedList.entityId")?t.entityId:Lyte.Globals.get("relatedList.entityId"),Q.cvid=t.fromBlueprint&&!Lyte.Globals.get("relatedList.entityId")?t.entityId:Lyte.Globals.get("relatedList.entityId"),Crm.userDetails.isRelatedListLyteEnabled?t?showCustomizePopup("Attach",t.personality_name.toLowerCase()+"_"+t.id,void 0,t.fromBlueprint?"bluePrint":"",void 0,void 0,void 0,void 0,void 0,Q):showCustomizePopup("Attach","",void 0,""):showCustomizePopup("Attach",t?t.personality_name.toLowerCase()+"_"+t.id:"",void 0,"",void 0,void 0,void 0,void 0,void 0,Q);break;case"attachZDocs":openForDocs("zdoc",RebrandLinkUtil.properties.docsURL);break;case"attachGDocs":Crm.userDetails.isRelatedListLyteEnabled||"detail"!==Lyte.Router.getRouteInstance().routeName||crmRelatedList.hideAttachDropList();var _=!!s;(Z=window.location.hostname)==RebrandLinkUtil.properties.CRMURL?openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,RebrandLinkUtil.properties.CRMURL,_):openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,Z,_);break;case"cloudPicker":if(Crm.userDetails.isRelatedListLyteEnabled)if($("#multipleFieldsEditPop").is(":visible"))BlueprintAttachment.showCloudPickerDialog();else{var L={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote,onedrive",callback:Lyte.registeredMixins["crm-related-list-utils"].addAttachmentsFromCloudPicker,max_file_selection:5};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(L.cloud_services="gdrive,box,skydrive,onedrive,dropbox"),Crm.userDetails.GOOGLE_SHARED_DRIVE&&(L.cloud_services="gdrive,googleTD,box,skydrive,onedrive"),$L("#bp-exec-popup").is(":visible")&&(L.callback=function(e){document.querySelector("crm-blueprint-exec-attach").component.executeMethod("addCloudPickerAttachments",e)},L.cloud_services=Crm.userDetails.GOOGLE_SHARED_DRIVE?"gdrive":"gdrive,googleTD"),Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-cloud-picker-mixin"].loadCloudPicker(L)}))}else{L={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote,onedrive",callback:crmRelatedList.addAttachmentsFromCloudPicker,max_file_selection:5};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(L.cloud_services="gdrive,box,skydrive,onedrive,dropbox"),Crm.userDetails.GOOGLE_SHARED_DRIVE&&(L.cloud_services="gdrive,googleTD,box,skydrive,onedrive"),Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-cloud-picker-mixin"].loadCloudPicker(L)}))}break;case"attachLink":if(Crm.userDetails.isRelatedListLyteEnabled)if($L("#multipleFieldsEditPop").is(":visible")){var v=Handlebars.templates.LinkAttachPopUp();$L("#topBandPopup").html(v),showAnimatePopup("topBandPopup"),setTimeout((function(){$L("#attachmentUrl").focus()}),100)}else{var I=$L("crm-blueprint-exec-attach");C=networkUtils.returnDependencyFiles(["editlinkurl.js"],ResourceConstants.CRMClient),R=networkUtils.returnDependencyFiles(["linkattachment.css"],ResourceConstants.CRMClient),h=C.concat(R);y=void 0!==moduleRecordMapping[i]&&"team_based"===moduleRecordMapping[i].access_type&&"Requesters"===moduleRecordMapping[i].private_profile.name?moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.parent.getDynamicParam()].api_name:I.is(":visible")?moduleRecordMapping[I[0].getData("module")].api_name:moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()].api_name,Lyte.injectResources(h,void 0,(function(){Lyte.Component.render("crm-linkattachment",{module:y,record:a.id,header:I18n.getMsg("crm.attach.link.from.url")},"#show"),document.getElementById("showLinkUrlPop").ltProp("show",!0)}))}else{var y,C=networkUtils.returnDependencyFiles(["editlinkurl.js"],ResourceConstants.CRMClient),R=networkUtils.returnDependencyFiles(["linkattachment.css"],ResourceConstants.CRMClient),h=C.concat(R);y=void 0!==moduleRecordMapping[i]&&"team_based"===moduleRecordMapping[i].access_type&&"Requesters"===moduleRecordMapping[i].private_profile.name?moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.parent.getDynamicParam()].api_name:moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()].api_name,Lyte.injectResources(h,void 0,(function(){Lyte.Component.render("crm-linkattachment",{module:y,record:a.id,header:I18n.getMsg("crm.attach.link.from.url")},"#show"),document.getElementById("showLinkUrlPop").ltProp("show",!0)}))}break;case"addProducts":case"add":case"addCampaigns":addMultiValue(a.id,i,d,t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,t.id);break;case"addNew":var f={module:d,primid:a.id,primmodule:i,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,fillUpModule:i,entityid:a.id,relmodule:i,entityname:i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]]};if("REPORTINGCONTACTSPERSONALITY"===t.personality_name&&(!a.Account_Name||0===Object.keys(a.Account_Name).length)){var N=Crm.moduleInfo.Contacts.translatedSingularLabel,P=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.new_reporting_contact_error",[N,P]),"7000")}if("true"!=f.isCustLookup){var A=$L("#accountId")[0];if("Accounts"==f.relmodule||"Contacts"==f.relmodule){let e=$L("#id")[0];f.fillUpFieldId=e?e.value:a.id}else A&&(f.fillUpFieldId=A.value)}if(Crm.userDetails.isRelatedListLyteEnabled){var M="crm.tab.module.create";moduleRecordMapping[d]&&"team_based"===moduleRecordMapping[d].access_type&&moduleRecordMapping[d].private_profile&&"Requesters"===moduleRecordMapping[d].private_profile.name&&(M="crm.tab.requesters.module.create"),Lyte.Router.transitionTo({route:M,dynamicParams:[d]}).data=f}else Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[d]}).data=f;break;case"addPotentialsProducts":var E=$("#parentCurrencyISOCode").val(),b=$("#parentExchangeRate").val();addMultiValue(a.id,i,d,t.personality_name.toLowerCase()+"_"+t.id,E,b,t.id);break;case"importListPrice":f={module:d,priceBookId:a.id,step:"1"};Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:f}).data={itsRelatedModule:"true",currStep:"sourceType",parentModule:i,parentId:a.id};break;case"editProducts":editAllValues(a.id,i,d,void 0,void 0,t.id,a.Full_Name);break;case"newTask":case"Canvas_Custom_newTask":if(!t){var w=store.peekAll("related_list").filterBy({personality_name:"TASKSPERSONALITY"});t={personality_name:"TASKSPERSONALITY",id:w[0].id}}selectAction("NewTask",t.personality_name.toLowerCase()+"_"+t.id,i,a.id,o.target,o);break;case"newEvent":case"Canvas_Custom_newEvent":let ie={};ie.record_module=i,ie.id=a.id,ie.name=i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]],Events.globalCreate(o,"relatedlist_new",o.target,void 0,void 0,void 0,void 0,void 0,void 0,ie);break;case"newAppointment":case"Canvas_Custom_newAppointment":if(!t){w=store.peekAll("related_list").filterBy({personality_name:"APPOINTMENTSPERSONALITY"});t={personality_name:"APPOINTMENTSPERSONALITY",id:w[0].id}}switch(Events.appointmentParams={},Events.appointmentParams.listRelationId=t.id,Events.appointmentParams.relEntityId=a.id,Events.appointmentParams.relModuleName=i,i){case"Services":Events.appointmentParams.relEntityName=a.Service_Name;break;case"Contacts":Events.appointmentParams.relEntityName=a.Full_Name;break;default:Events.appointmentParams.relEntityName=a.Name}Events.globalCreate(o,"relatedlist_new","Appointments");break;case"logCall":case"Canvas_Custom_logCall":if(isNewCallView){var S={};S.name=i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]],S.id=a.id,S.module=i;r=t&&"CALLSPERSONALITY"===t.personality_name||Crm.isActivitySplitDone?"relatedlist_new_canvas":"relatedlist_new";Crm.userDetails.isRelatedListLyteEnabled?Crm.globalCreate(o,r,o.target,void 0,void 0,void 0,S,!0):Crm.globalCreate(o,r,o.target)}else{if(!t){w=store.peekAll("related_list").filterBy({personality_name:"CALLSPERSONALITY"});t={personality_name:"CALLSPERSONALITY",id:w[0].id}}selectAction("NewCall",t.personality_name.toLowerCase()+"_"+t.id,i,a.id,o.target,o)}break;case"sendMailEvent":EntSendMail(i,a.id,"",moduleRecordMapping[i].singular_label);break;case"associateMxN":(K=JSON.parse('{"fldName":""}')).fldName=t.mxnfield,K.relatedlist=!0,multiLookupsView.frameMLJSON(K),(z=multiLookupsView.getParamJson(K.fldName)).entityId=a.id,z.parentModule=i,z.relatedlist=!0,z.searchmodule=t.connectedmodule,Crm.trackSpotLightAction("Multi Select Lookup - Add Click",{Module:z.searchmodule}),z.select=!1,z.fldName=t.mxnfield,z.linkingmodule=t.linkingmodule,z.relid=t.id,z.parentModule=i,"canvas"===Lyte.Router.getRouteInstance().routeName&&$L("crm-detailview-canvas")[0].setData("isAjaxEdit",!1),multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",z);break;case"dissociateMxN":(K={}).fldName=t.mxnfield,multiLookupsView.frameMLJSON(K),(z=multiLookupsView.getParamJson(K.fldName)).entityId=a.id,z.link="edit",z.relatedlist=!0,z.searchmodule=t.connectedmodule,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:z.searchmodule}),z.select=!0,z.fldName=t.mxnfield,z.linkingmodule=t.linkingmodule,z.relid=t.id,z.parentModule=i,"canvas"===Lyte.Router.getRouteInstance().routeName&&$L("crm-detailview-canvas")[0].setData("isAjaxEdit",!1),multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",z);break;case"editLookupRel":for(var D=Crm.moduleInfo?Crm.moduleInfo[d].singularLabel:d,T=Crm.userDetails.LOOKUPVRINVOLVEDMODULES,O=[],k=[],U=T?T.length:0,x=0;x<U;x++){var V=T[x].split(":");O.push(V[0]),k.push(V[1])}var J=!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(d),Y=J&&Crm.userDetails.VRFUNCINVOLVEDMODULES.contains(d);if(J&&O.contains(d)&&k.contains(t.id)||Y&&Crm.userDetails.VALIDATION_RULE_CF_LOOKUPSUPPORT&&Crm.userDetails.CVRFuncExecuteForAllFields){var B=null,F=store.peekRecord("module",t.module.id);if(F){var H=F.fields;if(H){var j=H.length;for(x=0;x<j;x++){var G=H[x];if(G.lookup&&G.lookup.id===t.id){B=G.field_label;break}}}}_cruxUtils.showCustomAlert({params:{ltPropType:"info",ltPropYield:!0,ltPropPrimaryMessage:I18n.getMsg("crm.validation.rule.relListRestrictTitle",D),ltPropSecondaryMessage:I18n.getMsg("crm.validation.rule.relListRestrictBody",[D,B]),ltPropButtons:[{type:"accept",appearance:"default",text:"Ok",cxPropZcqa:"button_1"}]}})}else this.editLookupRelNew(a,t,d,i);break;case"associateLookupRel":if("REPORTINGCONTACTSPERSONALITY"===t.personality_name){var q=$("#subvalue_ACCOUNTID");if(!q[0]||q[0]&&""===q[0].text){N=Crm.moduleInfo.Contacts.translatedSingularLabel,P=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.assign_reporting_contact_error",[N,P]),"7000")}}var K,z;(K=JSON.parse('{"fldName":""}')).fldName=t.id,K.relatedlist=!0,K.lookuprel=!0,multiLookupsView.frameMLJSON(K),(z=multiLookupsView.getParamJson(K.fldName)).entityId=a.id,z.parentModule=i,z.relatedlist=!0,z.searchmodule=d,z.lookuprel=!0,z.select=!1,z.linkingmodule=null,z.relid=t.id,z.parentModule=i,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",z);break;case"newPotential":var W="";A=$L("#accountId")[0];if("Accounts"==i||"Contacts"==i){let e=$L("#id")[0];W=e?e.value:a.id}else A?W=A.value:"Potentials"!=i&&"Deals"!=i||!a.Account_Name||(W=a.Account_Name.id);f={module:d,primid:a.id,primmodule:i,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,isCustLookup:!1,entityid:a.id,fillUpModule:i,fillUpFieldId:encodeURIComponent(W),relmodule:i,entityname:i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]]};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Deals"===d?"Potentials":d]}).data=f;break;case"newPotentialForContacts":"NaN"==(f={module:d,primid:a.id,primmodule:i,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,recordNum:$("#recordNum").val(),relmodule:i,fillUpModule:i,entityid:a.id,entityname:i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]]}).recordNum&&(f.recordNum="null"),Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Deals"===d?"Potentials":d]}).data=f;break;case"newCompetitor":if(Crm.renderDVLyteFlow(i)){let e=$L("crm-detail-view")[0].component.data.transitionData;var Z=Crm.getCrmBasePath()+"/potentials/NewCompetitor.do?module=Potentials&title_key=crm.title.create.competitor&returnAnchor="+t.personality_name.toLowerCase()+"_"+t.id+"&id="+a.id+"&cvid="+e.cvid+"&recordNum="+e.recordNum;t.id&&(Z+="&rid="+t.id),commonUtils.openCustomLookup(Z,void 0,"topBandPopup")}else selectAction("Competitor",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,t.id,o);break;case"newProject":(Q={}).module=i,Q.id=a.id,Q.contactEmail=a.Email,a.Account_Name&&(Q.accountid=a.Account_Name.id?a.Account_Name.id:a.id,Q.accountName=a.Account_Name.name?a.Account_Name.name:a.Account_Name),a.Contact_Name&&(Q.ContactID=a.Contact_Name.id),selectAction("Project",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,void 0,o,Q);break;case"newAssociateProject":var Q;(Q={}).module=i,Q.id=a.id,Q.contactEmail=a.Email,a.Account_Name&&(Q.accountid=a.Account_Name.id?a.Account_Name.id:a.id,Q.accountName=a.Account_Name.name?a.Account_Name.name:a.Account_Name),a.Contact_Name&&(Q.ContactID=a.Contact_Name.id),selectAction("Associate Project",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,void 0,o,Q);break;case"importAction":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].importAction(o,o.target):crmRelatedList.importAction(o,o.target);break;case"updateCampaignStatus":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].showCampaignStatusDiv(t.id,n):crmRelatedList.showCampaignStatusDiv(t.id);break;case"importOrgAction":Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].importOrgAction(o,o.target):crmRelatedList.importOrgAction(o,o.target);break;case"hideRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"hide");break;case"reorderRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"reorder");break;case"editRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"edit");break;case"deleteRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"del");break;case"addContactRoles":Crm.userDetails.isRelatedListLyteEnabled&&(Lyte.Globals.set("relatedList.scrollToId",t.id),t.nodata=!1);f={returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,accId:a.Account_Name?a.Account_Name.id:""};Lyte.Router.transitionTo({route:"crm.tab.module.entity.add-contact-role",dynamicParams:["Potentials",a.id],queryParams:f});break;case"editContactRoles":Crm.userDetails.isRelatedListLyteEnabled&&(Lyte.Globals.set("relatedList.scrollToId",t.id),t.nodata=!1);f={returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,accId:a.Account_Name?a.Account_Name.id:""};Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit-contact-role",dynamicParams:["Potentials",a.id],queryParams:f});break;case"createsurvey":Z="http://"+l;networkUtils.openUrl(Z,"_blank");break;case"sendsurvey":case"attendsurvey":var X=null,ee=(f={action:"surveyDetails",from:e,entityId:a.id,module:this.getData("module")},$("crm-zsurvey-rl-actions").attr("ent-id-for-zmail"));ee&&(X=ee,f.entIdForZMail=X);var te=o.target;te.setAttribute("data-params",JSON.stringify(f)),ZSurvey.showSurveyDetails(te);break;case"showMembersListView":Crm.userDetails.isRelatedListLyteEnabled&&CrmCampaignInteg.showMembersListView(o,t);break;case"sendMailToMembers":Crm.userDetails.isRelatedListLyteEnabled&&Lyte.registeredMixins["crm-related-list-utils"].sendNormalMailToMembers(t.id,n);break;case"newCampaignWithMembers":Crm.userDetails.isRelatedListLyteEnabled&&CustomView.showCampSubMenu(o.target,"detailQuickCreate",n,t.id);break;case"addToCampaigns":Crm.userDetails.isRelatedListLyteEnabled&&crmListView.addToCampaigns(o,o.target,n,t.id)}},recordDeletePopup:function(e,t,i,a,o,n,s,r){var l,d,c,m=[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"}],u=moduleRecordMapping[i]?moduleRecordMapping[i].plural_label:i;if(n&&"multiselectlookup"==n.type&&(d=e[store.peekRecord("field",n.mxnfield).api_name]?e[store.peekRecord("field",n.mxnfield).api_name][crmConstants.moduleDisplayField[i][0]]:crmConstants.moduleDisplayField[i]?e[crmConstants.moduleDisplayField[i][0]]:void 0,c=e[store.peekRecord("field",n.mxnfield).api_name]?e[store.peekRecord("field",n.mxnfield).api_name].Name:e.Name,!d&&("PRODUCTS_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name||"BUNDLES_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name)))if(e.hasOwnProperty("Product")&&"PRODUCTS_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name){var p=e.Product;d=p.name?p.name:d}else if(e.hasOwnProperty("Bundle")&&"BUNDLES_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name){var g=e.Bundle;d=g.name?g.name:d}var _=n&&"multiselectlookup"==n.type?i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?c:d:i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?e.Name:e[crmConstants.moduleDisplayField[i][0]],L=a&&(a.indexOf("CustomModule")>-1||a.indexOf("LinkingModule")>-1?o.Name:o[crmConstants.moduleDisplayField[a][0]]);switch(t){case 1:if(Crm.userDetails.isRelatedListLyteEnabled){if("detail"===Lyte.Router.getRouteInstance().routeName){var v=$("#topSectionTitle").find("span:first").map((function(){return $L(this).text()})).get();L=v[0]?v[0].trim():L}l=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[_,moduleRecordMapping[i].singular_label,L,moduleRecordMapping[a].singular_label]),(m=[{type:"accept",text:I18n.getMsg("crm.confirm.deassociate"),appearance:"failure",class:"PupHome_dissociatebtn"}]).push({type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"})}else l=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[_,moduleRecordMapping[i].singular_label,L,moduleRecordMapping[a].singular_label]),m.push({type:"accept",text:I18n.getMsg("crm.confirm.deassociate"),appearance:"failure",class:"PupHome_dissociatebtn"});break;case 2:l=I18n.getMsg("crm.warning.delete.record",_),Crm.userDetails.isRelatedListLyteEnabled?s?(m=[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"}]).push({type:"accept",text:I18n.getMsg("crm.label.delete"),appearance:"failure",class:"PupHome_button_deletebtn"}):(m=[{type:"accept",text:I18n.getMsg("crm.button.move.to.trash"),appearance:"failure",class:"PupHome_button_deletebtn"}]).push({type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"}):m.push({type:"accept",text:I18n.getMsg("crm.label.delete"),appearance:"failure",class:"PupHome_button_deletebtn"});break;case 3:Crm.userDetails.isRelatedListLyteEnabled&&(m=[{type:"accept",text:I18n.getMsg("crm.mb.label.move.to.trash"),appearance:"failure",class:"PupHome_button_deletebtn"}]).push({type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"}),l=I18n.getMsg("crm.warning.deassociateordelete.entity",u),m.push({type:"accept",text:I18n.getMsg("crm.button.dissociate"),appearance:"failure",class:"PupHome_dissociatebtn"}),Crm.userDetails.isRelatedListLyteEnabled||m.push({type:"accept",text:I18n.getMsg("crm.mb.label.move.to.trash"),appearance:"failure",class:"PupHome_button_deletebtn"});break;case 4:m=[{type:"accept",text:I18n.getMsg("crm.only.this.task"),appearance:"failure",class:"PupHome_button_deletebtn"}],l=I18n.getMsg("crm.delete.recurring.task"),m.push({type:"accept",text:I18n.getMsg("crm.all.upcoming.tasks1"),appearance:"failure",class:"PupHome_upcoming_task_deletebtn"}),m.push({type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"});break;case 5:m=[{type:"accept",text:I18n.getMsg("crm.event.rec.del.btn.all",moduleRecordMapping.Events.plural_label),appearance:"failure",class:"PupHome_button_deletebtn"}],l=I18n.getMsg("crm.delete.recurring.meeting",moduleRecordMapping.Events.singular_label),m.push({type:"accept",text:I18n.getMsg("crm.event.rec.del.btn.one",moduleRecordMapping.Events.singular_label),appearance:"failure",class:"PupHome_upcoming_meeting_deletebtn"}),m.push({type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"})}var I=this,y=$L("#detailViewUtilAlert"),C={ltPropPrimaryMessage:"",ltPropContentAlign:"left",ltPropTop:"0px",ltPropHeading:l,ltPropButtons:m,ltPropButtonPosition:"center",id:"detailViewUtilAlert",ltPropWrapperClass:"crmAlert crmAlertContent dv_delRecLytePop",ltPropShowCloseButton:!1};if(s&&(C.ltPropButtonPosition="right"),s&&isRelatedRecordsModule(i)?C.ltPropSecondaryMessage=I18n.getMsg("crm.label.note.bold")+" "+I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(i)):s&&"Tasks"===i&&e.$u_id?(C.ltPropSecondaryMessage=I18n.getMsg("crm.task.remove.recurring"),C.ltPropWrapperClass="crmAlert crmAlertContent",C.ltPropButtonPosition="center"):s&&"Events"===i&&e.Recurring_Activity?(C.ltPropSecondaryMessage=I18n.getMsg("crm.event.rec.del.msg2",moduleRecordMapping.Events.plural_label),C.ltPropWrapperClass="crmAlert crmAlertContent",C.ltPropButtonPosition="center"):C.ltPropSecondaryMessage="",0==y.length?y.push(Lyte.Component.render("lyte-alert",C,"body")):y[0].setData(C),n&&"multiselectlookup"!=n.type&&("custom_lookup"==n.type||Lyte.registeredMixins["crm-detail-view-utils"].customRelatedList(i,a))&&"Competitors"!=n.api_name){var R=Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].api_name==n.module.api_name}))[0];if(null==store.peekRecord("module",moduleRecordMapping[R].id).fields&&R)commonUtils.showHideLoadingDiv(!0),store.findRecord("module",moduleRecordMapping[R].id,void 0,void 0,void 0,{getFields:!0}).then((function(){commonUtils.showHideLoadingDiv(),y[0].ltProp("show",!0)}));else 0==store.peekRecord("module",moduleRecordMapping[R].id).fields.filterBy({data_type:"lookup"}).filter((function(e){return e.lookup.api_name==n.api_name})).length?(commonUtils.showHideLoadingDiv(!0),store.findRecord("module",moduleRecordMapping[R].id,void 0,void 0,void 0,{getFields:!0}).then((function(){commonUtils.showHideLoadingDiv(),y[0].ltProp("show",!0)}))):y[0].ltProp("show",!0)}else y[0].ltProp("show",!0);y[0].setMethods({onShow:function(e){e.childComp.querySelector(".PupHome_cancelbtn").setAttribute("data-zcqa","PupHome_cancelbtn");var t=e.childComp.querySelector(".PupHome_button_deletebtn");t&&t.setAttribute("data-zcqa","PupHome_button_deletebtn");var i=e.childComp.querySelector(".PupHome_upcoming_task_deletebtn");i&&i.setAttribute("data-zcqa","PupHome_upcoming_task_deletebtn");var a=e.childComp.querySelector(".PupHome_dissociatebtn");a&&a.setAttribute("data-zcqa","PupHome_dissociatebtn");var o=e.childComp.querySelector(".dv_delRecLytePop .alertSecondaryMsg");o&&o.textContent&&(o.innerHTML=o.textContent)},onAccept:function(t){if(commonUtils.showHideLoadingDiv(!0),t==I18n.getMsg("crm.confirm.deassociate")||t==I18n.getMsg("crm.button.dissociate"))if("Contact_Roles"==n.api_name){var s=Crm.getCrmBasePath()+"/potentials/deleteContPotRel.do?module=Potentials&whoId="+e.id+"&whatId="+o.id+"&nextStep=relatedlist&isajax=true#"+n.personality_name.toLowerCase()+"_"+n.id;Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].sortRelatedList(s,"",e.id):sortRelatedList(s,"",e.id)}else if("multiselectlookup"==n.type){if("canvas"===Lyte.Router.getRouteInstance().routeName){var l=$L("crm-detailview-canvas")[0].getData("recordLockingDetails");if(l&&l.isLockedForMe&&!(l.fieldIds&&l.fieldIds.contains(n.mxnfield)))return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.record.locking.permission.denied")),!1}if(e=e.isTemplate&&e.parentCompId?store.peekRecord(moduleRecordMapping[n.linkingmodule].id,e.parentCompId):e,n.personality_name&&"PRODUCTS_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name)return void Lyte.registeredMixins["crm-detail-view-utils"].deleteFromBundleProdRelList(e,n);if(n.personality_name&&"BUNDLES_LINKINGMODULEBUNDLERELPERSONALITY"===n.personality_name)return void Lyte.registeredMixins["crm-detail-view-utils"].deleteFromProductBundleRelList(e,n);o=store.peekRecord(moduleRecordMapping[a].id,o.id);var d=store.peekRecord("field",n.mxnfield),c=o[d.api_name].filter((function(t){return t.id===e.id}));c[0]?(c[0]._delete=null,I.disassicateProcess(o,d,a,c,n,i,!0)):store.findRecord(moduleRecordMapping[a].id,o.id,{approved:"both"}).then((function(t){if(t[0]&&t[0][d.api_name]){o=store.peekRecord(moduleRecordMapping[a].id,o.id);var s=t[0][d.api_name].filter((function(t){return t.id===e.id}));s[0]._delete=null,I.disassicateProcess(o,d,a,s,n,i,!0)}}))}else if("custom_lookup"==n.type||Lyte.registeredMixins["crm-detail-view-utils"].customRelatedList(i,a)){if(Crm.userDetails.isRelatedListLyteEnabled&&n&&"custom_lookup"==n.type&&!store.peekRecord(moduleRecordMapping[a].id,o.id))return void renderingUtils.displayPermissionDenied();if("Activities"==i)if(store.addField(moduleRecordMapping.Activities.id,"What_Id","object"),Crm.userDetails.isRelatedListLyteEnabled){var m=store.peekAll("field").filterBy({api_name:"What_Id"})[0];I.disassicateProcess(e,m,i)}else this.disassicateProcess(e,"What_Id",i);else{var u=store.peekRecord("module",moduleRecordMapping[Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].api_name==n.module.api_name}))[0]].id);m=u.fields.filterBy({data_type:"lookup"}).filter((function(e){return"custom_lookup"==n.type?e.lookup.api_name==n.api_name&&e.lookup.module.api_name==moduleApiMapping[a]:e.lookup.module.api_name==moduleApiMapping[a]}))[0];if(!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Edit_"+u.module_name))return renderingUtils.displayPermissionDenied(void 0,(function(){this.cxProp("title",I18n.getMsg("crm.mxnlookup.remove.title",u.plural_label))}),I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[u.singular_label,_,Crm.appName])),void commonUtils.showHideLoadingDiv();if(Crm.userDetails.isRelatedListLyteEnabled&&!e.$editable&&clientPortalName)return void renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[moduleRecordMapping[i].singular_label,"",Crm.appName]));e.Layout&&m[e.Layout.id]?m[e.Layout.id].required?I.showLookupDisassociateError(u.plural_label,m.field_label):0==m[e.Layout.id].required?Crm.userDetails.isRelatedListLyteEnabled?I.disassicateProcess(e,m,i):I.disassicateProcess(e,m.api_name,i):store.findRecord("layout",e.Layout.id,{module:u.api_name}).then((function(){m[e.Layout.id]&&m[e.Layout.id].required?I.showLookupDisassociateError(u.plural_label,m.field_label):Crm.userDetails.isRelatedListLyteEnabled?I.disassicateProcess(e,m,i):I.disassicateProcess(e,m.api_name,i)})):u.layouts&&u.layouts.length&&m[u.layouts[0].id]?m[u.layouts[0].id].required?I.showLookupDisassociateError(u.plural_label,m.field_label):Crm.userDetails.isRelatedListLyteEnabled?I.disassicateProcess(e,m,i):I.disassicateProcess(e,m.api_name,i):store.findAll("layout",{module:u.api_name}).then((function(){m[u.layouts[0].id]&&m[u.layouts[0].id].required?I.showLookupDisassociateError(u.plural_label,m.field_label):Crm.userDetails.isRelatedListLyteEnabled?I.disassicateProcess(e,m,i):I.disassicateProcess(e,m.api_name,i)}))}}else store.findRecord(moduleRecordMapping[a].id,o.id,!1,!1,!1,{type:"DELETE",id:e.id,module:moduleRecordMapping[i].api_name}).then((function(){("canvas"==Lyte.Router.getRouteInstance().routeName||Crm.userDetails.isRelatedListLyteEnabled)&&(Lyte.triggerEvent("relatedList",{module:i,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv())}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{module:i}),commonUtils.showHideLoadingDiv())}));else if(n&&"Competitors"==n.api_name){s=Crm.getCrmBasePath()+"/potentials/DeletingCompetitor.do?competitorid="+e.id+"&nextStep=relatedlist&isajax=true#"+n.personality_name.toLowerCase()+"_"+n.id;Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].sortRelatedList(s,"",e.id):sortRelatedList(s,"",e.id)}else if(n&&"Attachments"===n.api_name)store.findRecord(moduleRecordMapping[a].id,o.id,!1,!1,!1,{type:"DELETE",id:e.id,module:moduleRecordMapping[i].api_name}).then((function(){Lyte.triggerEvent("relatedList",{module:"Attachments",type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():JSON.parse(e.response).data&&"INVALID_DATA"===JSON.parse(e.response).data[0].code?Lyte.triggerEvent("recordDelete",{module:i}):(commonUtils.showHideLoadingDiv(),Lyte.triggerEvent("relatedList",{module:i}))}));else{if(Crm.userDetails.isRelatedListLyteEnabled&&n&&"custom_lookup"==n.type&&!store.peekRecord(moduleRecordMapping[a].id,o.id))return void renderingUtils.displayPermissionDenied();var p;t===I18n.getMsg("crm.all.upcoming.tasks1")&&"Tasks"===i&&e.$u_id&&(p={uid:e.$u_id,instance_id:e.id,delete_all_future_tasks:!0,deleteAllUpcomingTaskFromDetailView:!0}),t===I18n.getMsg("crm.event.rec.del.btn.all",moduleRecordMapping.Events.plural_label)&&"Events"===i&&e.Recurring_Activity&&(p={uid:e.$u_id,instance_id:e.id,delete_all_future_events:!0,deleteAllUpcomingTaskFromDetailView:!0}),e.$.destroyRecord(void 0,p).then((function(){if(Crm.canvasScroll){var t=$("#"+Crm.canvasScroll)[0],a=renderingUtils.findPosY(t),o=$L("#detailcanvascontainer");o.animate({scrollTop:a-o.offset().top-20},{duration:1e3,complete:"complete"})}var n=$L("#cvToIndex");if("Activities"===Crm.activityGrp[i]&&n.length){var s=parseInt(n.val())-1;n.val(s),$L("input[name=toIndex]").val(s)}Crm.canvasScroll=null;var l=!1;if("detail"===Lyte.Router.getRouteInstance().routeName&&r&&"detail_view"===r||"canvas"===Lyte.Router.getRouteInstance().routeName&&$L("crm-detailview-canvas")[0].component.data.record.id===e.id){if(l=!0,r&&"detail_view"===r&&"true"===$("#iskanbanview").val()&&"Tasks"!==i){$("#entitypopup").html(""),$("#tkventityDetails").html("");var d=$("#recordid_"+e.id),c=d.next(),m=d.prev();if(0!==c.length){var u=c.attr("id");document.getElementById(u).click()}else if(0!==m.length){u=m.attr("id");document.getElementById(u).click()}else taskDetailsview.listAnimation("close");return void d.remove()}if(crmNavig[crmNavig.customViewKey]&&crmNavig[crmNavig.customViewKey].recordId){var p=crmNavig[crmNavig.customViewKey].recordId.map((function(e){return e.id})).indexOf(e.id);if(p>0){var g;if(r&&"detail_view"===r&&crmNavig[crmNavig.customViewKey]&&("Activities"===Crm.activityGrp[i]&&updateRecordNumParam(e.id),crmNavig[crmNavig.customViewKey].recordId[p]&&(g=crmNavig[crmNavig.customViewKey].recordId[p].id,"Activities"!==Crm.activityGrp[i]&&$("#detailView_"+g).remove())),crmNavig[[crmNavig.customViewKey]].recordId.splice(p,1),crmNavig[crmNavig.customViewKey].recordId[p]&&"EOA"!=crmNavig[crmNavig.customViewKey].recordId[p])var _=crmNavig[crmNavig.customViewKey].recordId[p];else{_=crmNavig[crmNavig.customViewKey].recordId[p-1];p-=1}if(_&&_.id){store.findRecord(moduleRecordMapping[i].id,_.id).then((function(e){e=null!=e.id?e:e[0];var t=Crm.getCanvasId(moduleRecordMapping[i].id,e.id);if(crmTab.deleteFromCache(i),store.unloadAll(moduleRecordMapping[i].id),t)Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[_.module,e.id,t]}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:p,cvid:crmNavig.customViewKey,fromDel:!0,navig:!0};else{var a={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:p,cvid:crmNavig.customViewKey,fromDel:"true",navig:!0};if(r&&"detail_view"===r&&"Activities"===Crm.activityGrp[_.module]){"Activities"===Crm.activityGrp[_.module]&&("Activities"===_.module||(a.fromActSubModuleListView="true"),a.fromActivityListView="true",a.fromDetailView=!0),g&&$("#detailView_"+g).remove();var o=[],n=moduleRecordMapping[_.module].id;return store.model[n]||store.registerModel(n,{},{extends:"entity"}),store.peekRecord("module",n)||o.push(store.findRecord("module",n)),Lyte.resolvePromises(o).then((function(){return store.findRecord(n,e.id,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0,on_demand_properties:"$client_portal_permission"}).then((function(){Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[_.module,e.id],queryParams:{redirect:"false"},target:"_blank"}).data=a}))}))}Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[_.module,e.id],queryParams:{redirect:"false"},target:"_blank"}).data=a}}))}else{if(r&&"detail_view"===r&&"detail"===Lyte.Router.getRouteInstance().routeName)return void Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[i]});Lyte.triggerEvent("recordDelete",{module:i})}}else{if(r&&"detail_view"===r&&"detail"===Lyte.Router.getRouteInstance().routeName)return void Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[i]});Lyte.triggerEvent("recordDelete",{module:i})}}else{if(r&&"detail_view"===r&&"detail"===Lyte.Router.getRouteInstance().routeName)return void Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[i]});Lyte.triggerEvent("recordDelete",{module:i})}}l||Lyte.triggerEvent("relatedList",{module:i,type:"unassign",record_id:e.id}),r&&"detail_view"===r||commonUtils.showHideLoadingDiv()}),(function(t){if("INVALID_DATA"===JSON.parse(t.response).code&&-1!==["cannot be deleted as it is involved in product configurator or price rule","cannot be deleted as it is involved in inventory record or product configurator or price rule","The product cannot be deleted as it is involved in inventory record","The product cannot be deleted as it is involved in inventory record or in a Bundle"].indexOf(JSON.parse(t.response).message)){var a=window.clientPortalName?I18n.getMsg("crm.cpq.contact.portal.owner"):I18n.getMsg("crm.cpq.cannotdelete.cpqrules.detail",moduleRecordMapping[i].singular_label);if("Products"===i){var o=[moduleRecordMapping.Quotes.singular_label,moduleRecordMapping.SalesOrders.singular_label,moduleRecordMapping.PurchaseOrders.singular_label,moduleRecordMapping.Invoices.singular_label],n=I18n.getMsg("crm.cpq.cannotdelete.rules.detail",[moduleRecordMapping[i].singular_label].concat(o)),s=moduleRecordMapping.Bundles;if(s&&s.singular_label){var r=[moduleRecordMapping.Quotes.plural_label,moduleRecordMapping.SalesOrders.plural_label,moduleRecordMapping.PurchaseOrders.plural_label,moduleRecordMapping.Invoices.plural_label];r.push(s.plural_label),n=I18n.getMsg("crm.bundle.cannotdelete.entity.detail",[moduleRecordMapping[i].singular_label].concat(r))}a=window.clientPortalName?I18n.getMsg("crm.cpq.contact.portal.owner"):n}var l="<div onclick='sE()' class='w500 p20'><div class='fL pL20 w430'><div class='crm-heading-font-size'><h2 style='color:#E20000';>"+(window.clientPortalName?I18n.getMsg("crm.cpq.rec.cannotdel"):I18n.getMsg("crm.cannot.delete.product.detailview",moduleRecordMapping[i].singular_label))+"</h2></div><div class='mT10'>"+a+"</div></div><br class='cBoth'><div  class='alignRight mT20'><input type='button' id='popupok' class='primarybtn' value='"+I18n.getMsg("crm.button.ok")+"' onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(l),e.$.rollBack()}"NO_PERMISSION"===JSON.parse(t.response).code||"CANNOT_DELETE"===JSON.parse(t.response).code?(renderingUtils.displayPermissionDenied(),e.$.rollBack()):t&&t.response&&"RECORD_LOCKED"===JSON.parse(t.response).data[0].code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.record.locking.permission.denied")):JSON.parse(t.response).data&&"INVALID_DATA"===JSON.parse(t.response).data[0].code?Lyte.triggerEvent("recordDelete",{module:i}):(commonUtils.showHideLoadingDiv(),Lyte.triggerEvent("relatedList",{module:i}))}))}}})},customRelatedList:function(e,t){return!("Leads"==t&&"Products"==e||"Leads"==t&&"Campaigns"==e||"Accounts"==t&&"Products"==e||"Contacts"==t&&"Products"==e||"Contacts"==t&&"Campaigns"==e||"Deals"==t&&"Products"==e||"Potentials"==t&&"Products"==e||"Products"==t&&"Leads"==e||"Products"==t&&"Accounts"==e||"Products"==t&&"Contacts"==e||"Products"==t&&"Deals"==e||"Products"==t&&"Potentials"==e||"Products"==t&&"PriceBooks"==e||"Campaigns"==t&&"Leads"==e||"Campaigns"==t&&"Contacts"==e||"PriceBooks"==t&&"Products"==e)},prefetchrecordfornavigation:async function(e){if(!e||!e.recordNum)return!1;e.recordNum=parseInt(e.recordNum);var t={},i=this.getRecordPage(e.recordNum,crmListView.getObject().currentOption);t.toIndex=i*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,t.fileName=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do",t.fromDV=!0,t.mod=!0,t.module=crmListView.getObject().module;var a=0,o=Crm.getCrmBasePath()+"/NavigateByRecords.do";if(crmNavig.fromKanbanView&&(crmListView.getFilterParams(t),(t.filters||t.cross_filters)&&(t.isNewFilter=!0)),crmNavig[crmNavig.customViewKey]&&!crmNavig[crmNavig.customViewKey].recordId[parseInt(e.recordNum)+1]&&(t.toIndex<e.recordNum+1||crmNavig.fromKanbanView)){for(var n in i=this.getRecordPage(e.recordNum+1,crmListView.getObject().currentOption),t.toIndex=i*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,crmNavig.fromKanbanView&&(t.stageId=crmNavig.customViewKey.split("#")[1],t.fromIndex=crmNavig[crmNavig.customViewKey].recordId.length,t.toIndex=t.fromIndex+crmListView.MAX_STAGECARD_CNT-1),t)/\b(calleeObj|clickId)\b/.test(n)||void 0!==t[n]&&(o+=0===a?"?":"&",o+=n+"="+encodeURIComponent(t[n]),a++);await crmNavig.fetchNextSet(o,t.fromIndex,t.toIndex,t.module)}if(crmNavig[crmNavig.customViewKey]&&!crmNavig[crmNavig.customViewKey].recordId[parseInt(e.recordNum)-1]&&!crmNavig.fromKanbanView&&t.fromIndex>e.recordNum-1){for(var n in i=this.getRecordPage(e.recordNum-1,crmListView.getObject().currentOption),t.toIndex=i*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,t)/\b(calleeObj|clickId)\b/.test(n)||void 0!==t[n]&&(o+=0===a?"?":"&",o+=n+"="+encodeURIComponent(t[n]),a++);await crmNavig.fetchNextSet(o,t.fromIndex,t.toIndex,t.module)}},getRecordPage:function(e,t){return parseInt((e-1)/t)+1},showLookupDisassociateError:function(e,t){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:"x",ltPropSecondaryMessage:"x",ltPropType:"info",ltPropButtons:[{type:"accept",text:I18n.getMsg("Ok"),appearance:"default"}]},show:function(i){var a=i.childComp.querySelector(".alertSecondaryMsg");a.innerHTML=I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning1",[e,t,e])+'<div class="mB10"></div>'+I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning2",[e,t]);var o=i.childComp.querySelector(".alertPrimaryMsg");o.innerHTML=I18n.getMsg("crm.mxnlookup.remove.title",e),o.style.textAlign="left",a.style.textAlign="left"}}),commonUtils.showHideLoadingDiv()},disassicateProcess:function(e,t,i,a,o,n,s){if(Crm.userDetails.isRelatedListLyteEnabled||s){var r,l=e.id;r={actual_value:a||null,field:t,moduleInfo:moduleRecordMapping[i],entityData:store.peekRecord(moduleRecordMapping[i].id,e.id),isRelatedListCase:!0,getEntityData:!0,callback:{onSave:function(t,a){if("success"===a){var s=o&&"multiselectlookup"===o.type&&n?n:i;_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.mxnlookup.dissociation.success.msg",[1,moduleRecordMapping[s].singular_label])}});var r={type:"unassign",record_id:e.id};o?r.id=o.id:r.module=i,Lyte.triggerEvent("relatedList",r)}else{var d=JSON.parse(t.response);if(d&&d.data&&d.data[0])"CANNOT_PERFORM_ACTION"===d.data[0].code?multiLookupsView.permissionIssueWarningShow(l,void 0,i,14):"RECORD_LOCKED"===d.data[0].code?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.record.locking.permission.denied")):renderingUtils.displayPermissionDenied(),e.$.rollBack();else if("NO_PERMISSION"===d.code||"INVALID_DATA"===d.code||"NOT_APPROVED"===d.code||"error"===a)renderingUtils.displayPermissionDenied(),e.$.rollBack();else{r={};o?r.id=o.id:r.module=i,Lyte.triggerEvent("relatedList",r)}}commonUtils.showHideLoadingDiv(!1)},onError:function(e){_cruxUtils.showCustomAlert({params:{ltPropHeading:I18n.getMsg("crm.validation.rule.invalid.entry.alertmsg.title"),ltPropSecondaryMessage:e.length?e[0].message:e.message},show:function(e){e.childComp.querySelector(".alertSecondaryMsg").style="color:#E20000"}}),commonUtils.showHideLoadingDiv(!1)}}},commonUtils.showHideLoadingDiv(!0),this.executeLayoutValidationRuleForQuickCreate(r)}else{var d=t;(e=store.pushPayload(moduleRecordMapping[i].id,e.$.toJSON())).$.set(d,null),e.$.save().then((function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.mxnlookup.dissociation.success.msg",[1,moduleRecordMapping[i].singular_label])}}),Lyte.triggerEvent("relatedList",{module:i,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{module:i}),commonUtils.showHideLoadingDiv())}))}},getAttachmentActions:function(e){var t=[],i=Crm.userDetails.ENABLE_DOCS_PICKER_ATTACHMENTS;let a=Lyte.Component.registeredHelpers.showAddRecord("Attachments");return t.push({"data-cid":"attachDesktop",label:I18n.getMsg("crm.attach.upload.file"),zcqa:"Detail_add_a_destop",name:"Upload File",showaction:a}),featuresAvailable&&featuresAvailable.Attach_Zoho_Docs&&featuresAvailable.Zoho_Docs_Intergration&&"false"===isSandboxAcc&&moduleRecordMapping.Documents&&!Crm.userDetails.isWorkdriveConfigured&&t.push({"data-cid":"attachDocuments",label:moduleRecordMapping.Documents.singular_label,zcqa:"Detail_add_a_documents",name:"Document",showaction:a}),featuresAvailable&&featuresAvailable.Attach_TeamDrive&&t.push({"data-cid":"teamDrivePicker",label:I18n.getMsg("crm.label.teamdrive"),zcqa:"Detail_add_a_Zdrivelink",name:"Zoho WorkDrive",showaction:a}),featuresAvailable.Attach_Zoho_Docs&&(featuresAvailable&&featuresAvailable.Attach_Zoho_Docs&&(i&&t.push({"data-cid":"attachZDocs",label:I18n.getMsg("crm.label.addons.zdocs",Crm.brandName),zcqa:"Detail_add_a_zohodocs",name:"Zoho Docs",showaction:a}),"RL_Attachments"!==e&&"FileuploadField"!==e&&"true"===RebrandLinkUtil.properties.GOOGLE_DRIVE_ENABLED&&t.push({"data-cid":"attachGDocs",label:I18n.getMsg("crm.label.addons.gdocs"),zcqa:"Detail_add_a_googledrive",name:"Google Drive",showaction:a})),featuresAvailable&&featuresAvailable.Attach_Google_Docs&&t.push({"data-cid":"cloudPicker",label:I18n.getMsg("crm.attach.cloud.picker"),zcqa:"Detail_add_from_colud",name:"Cloud Picker",showaction:a})),"FileuploadField"!==e&&t.push({"data-cid":"attachLink",label:I18n.getMsg("crm.attach.link.url"),zcqa:"Detail_add_a_link",name:"Link(URL)",showaction:a}),t},getRelatedListActions:function(e,t,i,a){if(Crm.userDetails.isRelatedListLyteEnabled){if(!e.visible&&"ACTIVITYPERSONALITY"!==e.personality_name||["NOTESPERSONALITY","HISTORYPERSONALITY","ZINVOICEPERSONALITY","ZEXPENSEPERSONALITY","ZSUBSCRIPTIONSPERSONALITY"].contains(e.personality_name))return;if(e.actions=[],!(["SERIESPERSONALITY","EMAILSPERSONALITY","ACTIVITYPERSONALITY","ATTACHMENTSPERSONALITY","COMPETITORSPERSONALITY"].includes(e.personality_name)||e.record_operations.edit||e.record_operations.assign||e.record_operations.create||e.record_operations.disassociate))return;N=this.getModuleNameFromRelatedlist(e);if(Crm.userDetails.CLIENT_TYPE===N&&"default"!==e.type&&"custom_lookup"!==e.type&&(Crm.userDetails.CLIENT_TYPE!==N||Crm.userDetails.CLIENT_TYPE!==t)||Crm.userDetails.CLIENT_TYPE===t&&Lyte.Globals.get("relatedList.entityId")!==Crm.userDetails.CLIENT_ID)return;P=!1;!e.mxnfield&&"multiselectlookup"!==e.type&&N&&N.indexOf("CustomModule")>-1&&(P=!0);A=12===e.visibility,M=12===e.visibility;t="Deals"===t?"Potentials":t;var o=store.peekAll("tab_group"),n=o&&o[0]&&o[0].modules?o[0].modules.filterBy({api_name:N}):[],s=e.parent_related_lists&&e.parent_related_lists[0]&&"Connected_Records__s"===e.parent_related_lists[0].api_name;if("ACTIVITYPERSONALITY"===e.personality_name){e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("Task"),"Tasks")),e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("Meeting"),"Events")),e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("Call"),"Calls"));var r=a?a.filter((e=>"APPOINTMENTSPERSONALITY"===e.personality_name)):void 0;moduleRecordMapping.Appointments&&moduleRecordMapping.Appointments.visible&&Crm.userDetails.permissions.Crm_Implied_Create_Appointments&&(r.length>0&&r[0].record_operations.create||!a)&&e.actions.push(this.getActionJson("newAppointment","Detail_createApppointment",I18n.getMsg("Appointment"),"Appointments"))}else if("TASKSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("crm.button.task.new"),"Tasks"));else if("EVENTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("crm.button.event.new",I18n.getMsg("Meeting"),"Events")));else if("CALLSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("crm.button.log.a.call"),"Calls"));else if("EMAILSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("sendMailEvent","newleft__Add_Emails",I18n.getMsg("crm.button.license.sendMail")));else if("SERIESPERSONALITY"!==e.personality_name||(!clientPortalName||n&&n.length)&&void 0!==clientPortalName||Crm.userDetails.LITE.IS_LITE_USER)if(A&&(!e.personality_name.includes("LINKINGMODULE")||"multiselectlookup"!==e.type)||s){var l="POTENTIALSPERSONALITY"===e.personality_name?I18n.getMsg("crm.module.new",moduleRecordMapping.Deals.singular_label):I18n.getMsg("crm.button.new");(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)&&e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,l,N,!0,"associateLookupRel")),(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Edit_"+N]||!clientPortalName)&&e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),clientPortalName&&t===Crm.userDetails.CLIENT_TYPE||Lyte.Globals.get("relatedList.entityId")===Crm.userDetails.CLIENT_ID||Lyte.arrayUtils(e.actions,"insertAt",0,this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign")))}else if("ATTACHMENTSPERSONALITY"===e.personality_name)e.actions=this.getAttachmentActions("RL_Attachments");else if("CAMPAIGNSPERSONALITY"===e.personality_name)M?e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,I18n.getMsg("crm.button.new"),"Campaigns")):e.actions.push(this.getActionJson("addCampaigns","Detail_add_to_campaigns",I18n.getMsg("crm.button.add.product",moduleRecordMapping[N].plural_label)));else if("POTENTIALSPERSONALITY"===e.personality_name&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)){E="";E=M||"Contacts"!==t?"newPotential":"newPotentialForContacts",e.actions.push(this.getActionJson(E,"link_CreateNewPotential",I18n.getMsg("crm.module.new",moduleRecordMapping[N].singular_label),"Potentials"))}else if("REPORTINGCONTACTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Contacts"));else if("CHILDACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Accounts"));else if("COMPETITORSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newCompetitor","link_CreateNewcompetitor",I18n.getMsg("crm.button.new")));else if("CONTACTSROLESPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addContactRoles","link_CreateNewcontactrole",I18n.getMsg("crm.button.add.contact.role",moduleRecordMapping[N].plural_label))),e.actions.push(this.getActionJson("editContactRoles","link_CreateEditcontactrole",I18n.getMsg("crm.edit.all")));else if("PRICEBOOKSPERSONALITY"===e.personality_name)M?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"PriceBooks")):(e.actions.push(this.getActionJson("addProducts","link_CreateNewPbookmodule",I18n.getMsg("crm.add.to.pricebooks",moduleRecordMapping[N].plural_label))),e.actions.push(this.getActionJson("editProducts","link_CreateEditbookmodule",I18n.getMsg("crm.edit.all"))));else if("ACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Accounts"));else if("PRODUCTSPERSONALITY"===e.personality_name){b="PriceBooks"===t,w=0!=Object.keys(Crm.userDetails.CURRENCY_DETAILS).length;M?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Products")):("Vendors"==t?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Products")):w&&"Potentials"===t?e.actions.push(this.getActionJson("addPotentialsProducts","addProdDtVw",I18n.getMsg("crm.add.products",moduleRecordMapping[N].plural_label))):(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)&&e.actions.push(this.getActionJson("addProducts","link_CreateNewProductNopotential",I18n.getMsg("crm.add.products",moduleRecordMapping[N].plural_label))),"PriceBooks"!==t||clientPortalName||e.actions.push(this.getActionJson("importListPrice","List Price",I18n.getMsg("crm.module.import",I18n.getMsg("List Price"),t))),b&&e.actions.push(this.getActionJson("editProducts","Detail_editProdDtVw",I18n.getMsg("crm.edit.all"))))}else if("APPOINTMENTSPERSONALITY"===e.personality_name&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName))e.actions.push(this.getActionJson("newAppointment","Detail_createApppointment",I18n.getMsg("crm.module.new",moduleRecordMapping[N].singular_label),"Appointments"));else if(P)e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),Lyte.arrayUtils(e.actions,"insertAt",0,this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign")));else if("CONTACTSPERSONALITY"!==e.personality_name&&"LEADSPERSONALITY"!==e.personality_name&&"CASESPERSONALITY"!==e.personality_name&&"SALESORDERSPERSONALITY"!==e.personality_name&&"QUOTESPERSONALITY"!==e.personality_name&&"PURCHASEORDERSPERSONALITY"!==e.personality_name&&"INVOICESPERSONALITY"!==e.personality_name&&"SOLUTIONSPERSONALITY"!==e.personality_name&&"VENDORSPERSONALITY"!==e.personality_name&&"VISITSPERSONALITY"!==e.personality_name&&!P||e.personality_name.includes("_LINKINGMODULE"))e.personality_name.includes("_LINKINGMODULE")&&(e.actions.push(this.getActionJson("dissociateMxN",t+"_"+N+"_CreateNew",I18n.getMsg("Edit"))),Lyte.arrayUtils(e.actions,"insertAt",0,this.getActionJson("associateMxN","link_CreateNewProductNopotential",I18n.getMsg("crm.button.assign"),e.linkingmodule)));else if("Contacts"===t&&"Vendors"!==t&&"Visits"!==t&&!P&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName))e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),N));else if("Campaigns"===t){var d,c,m,u,p,g=!1;if(c="showMembersListView",m="link_showMembersListView_"+t+"_"+N,"detail"===Lyte.Router.getRouteInstance().routeName&&(!i||i&&i.from&&"Chronological"===i.from)){var _=$L("crm-related-list-view");i=_&&_.length&&_[0].component&&_[0].component.data.record||i}var L=i.Layout?i.Layout.id:moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.layouts?moduleRecordMapping.Campaigns.layouts[0].id:"",v=L?moduleRecordMapping.Campaigns.layouts.filter((function(e){return e.created_for})):[],I=v.filter((function(e){return e.id===L}));if(I&&I[0]&&!e.linkingmodule&&!Crm.userDetails.LITE.IS_LITE_USER){var y=v.map((function(e){if(e.created_for&&(e.status>=0||"active"===e.status))return e.created_for})),C=!1;switch(I[0].created_for){case"survey":d=I18n.getMsg("crm.survey.label.sendsurvey"),y.includes("survey")||(g=!0,u=I18n.getMsg("crm.zsurvey.send.survey.disabled.brandchange",Crm.integrationsAppName.ZOHO_SURVEY));break;case"webinar":d=I18n.getMsg("crm.label.invite"),y.includes("webinar")||(g=!0,u=I18n.getMsg("zwebinar.send.invitation.disabled.dynamic",Crm.integrationsAppName.ZOHO_WEBINAR));break;case"campaign":if(8!==i.$campaign_type){d=I18n.getMsg("crm.zcampaign.step.recipient.addition");var R=this.getActionJson("importAction","link_import_"+t+"_"+N,I18n.getMsg("crm.zcampaign.import.recipients")),h=$L("crm-zcampaign-detailview-component")[0];y.includes("campaign")?h&&h.component&&h.component.data.campDetails&&h.component.data.campDetails.unfinished_imports&&(R["action-id"]=R["data-cid"],delete R["data-cid"],R.tooltip=I18n.getMsg("crm.zcampaign.import.in.progress",Crm.userDetails.PARTNERBRAND)):(g=!0,u=I18n.getMsg("crm.zcampaign.add.recipients.disabled.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),R["action-id"]=R["data-cid"],delete R["data-cid"],R.tooltip=I18n.getMsg("crm.zcampaign.add.recipients.disabled.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS)),C=!0}break;case"backstage":d=I18n.getMsg("crm.backstage.invite.prospects"),y.includes("backstage")?i&&7!==i.$campaign_type&&(g=!0,u=I18n.getMsg("crm.backstage.event.deleted.dynamic",Crm.integrationsAppName.ZOHO_BACKSTAGE)):(g=!0,u=I18n.getMsg("crm.backstage.invite.prospects.disabled",Crm.integrationsAppName.ZOHO_BACKSTAGE));break;default:d=I18n.getMsg("crm.campaign.addmembers")}8!==i.$campaign_type&&(g?((p=this.getActionJson(c,m,d))["action-id"]=p["data-cid"],delete p["data-cid"],p.tooltip=u,e.actions.push(p)):(e.actions.push(this.getActionJson(c,m,d)),C&&e.actions.push(R)))}else e.linkingmodule||Crm.userDetails.LITE.IS_LITE_USER?(!clientPortalName||n&&n.length)&&void 0!==clientPortalName||Crm.userDetails.LITE.IS_LITE_USER||e.actions.push(this.getActionJson("addNew","link_CreateNew_"+t+"_"+N,I18n.getMsg("crm.button.new"))):(e.actions.push(this.getActionJson("showMembersListView","link_addRecords_"+t+"_"+N,I18n.getMsg("crm.button.add.module",moduleRecordMapping[N].plural_label))),void 0===clientPortalName&&e.actions.push(this.getActionJson("importAction","link_import_"+t+"_"+N,I18n.getMsg("crm.module.import",moduleRecordMapping[N].plural_label))));if(!e.linkingmodule&&!Crm.userDetails.LITE.IS_LITE_USER){if(e.actions.push(this.getActionJson("updateCampaignStatus","link_updateStatus_"+t+"_"+N,I18n.getMsg("crm.button.massupdate.memstatus"))),void 0===clientPortalName){var f=this.getActionJson("sendMailToMembers","link_sendMailToMembers_"+t+"_"+N,I18n.getMsg("crm.campaign.sendmail"));f.showOnMemberSelect=!0,f["action-id"]="sendMailToMembers",featuresAvailable.Mass_Email||(delete f["data-cid"],f.disabled=!0,f.tooltip=I18n.getMsg("crm.sendmail.upgrade")),e.actions.push(f)}e.actions.push(this.getActionJson("newCampaignWithMembers","link_newCampaignWithMembers",I18n.getMsg("crm.label.convert.create.new.module",moduleRecordMapping[t].plural_label))),e.actions.push(this.getActionJson("addToCampaigns","link_copy_Members_"+N,I18n.getMsg(moduleRecordMapping[t].plural_label)))}}else"Potentials"===t&&"Vendors"!==N&&"Contacts"!==N&&"Leads"!==N&&"Solutions"!==N&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)?e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),N)):"Visits"!==N&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)&&e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,I18n.getMsg("crm.button.new")));else Crm.userDetails.permissions.Crm_Implied_Manage_Enroll_Series&&e.actions.push(this.getActionJson("addSeries","Detail_add_to_series",I18n.getMsg("crm.series.related.add.series"))),Crm.userDetails.permissions.Crm_Implied_Manage_UnEnroll_Series&&e.actions.push(this.getActionJson("un-EnrollSeries","Detail_un-enroll_series",I18n.getMsg("crm.series.related.unenroll.from.series")));e.personality_name.includes("_LINKINGMODULE")||"INVITEDEVENTSPERSONALITY"===e.personality_name||"POTSTAGEHISTPERSONALITY"===e.personality_name||e.personality_name.includes("HISTORYPERSONALITY")||e.personality_name.includes("REPORTINGCONTACTSPERSONALITY")||e.personality_name.includes("CHILDCAMPAIGNSPERSONALITY")||"CHILDACCOUNTSPERSONALITY"===e.personality_name||"ATTACHMENTSPERSONALITY"===e.personality_name||"EMAILSPERSONALITY"===e.personality_name||"APPOINTMENTSPERSONALITY"===e.personality_name||"JOBSHEETSPERSONALITY"===e.personality_name||A||"CONTACTSPERSONALITY"===e.personality_name&&"Accounts"===t||"POTENTIALSPERSONALITY"===e.personality_name&&"Contacts"===t||s||(e.record_operations.bulk_edit&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Edit_"+N]||!clientPortalName)&&e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),!e.record_operations.assign||"Campaigns"===t&&"Leads"===N||"Campaigns"===t&&"Contacts"===N||(!(!clientPortalName||clientPortalName&&"default"===e.type&&Crm.userDetails.permissions["Crm_Implied_Edit_"+N])||Lyte.Globals.get("relatedList.entityId")===Crm.userDetails.CLIENT_ID)&&Lyte.Globals.get("relatedList.entityId")||Lyte.arrayUtils(e.actions,"insertAt",0,this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign"))))}else{if(!e.visible&&"ACTIVITYPERSONALITY"!==e.personality_name||["NOTESPERSONALITY","HISTORYPERSONALITY","ZINVOICEPERSONALITY","ZEXPENSEPERSONALITY","ZSUBSCRIPTIONSPERSONALITY"].contains(e.personality_name))return;if(e.actions=[],!("SERIESPERSONALITY"===e.personality_name||"EMAILSPERSONALITY"===e.personality_name||"ACTIVITYPERSONALITY"===e.personality_name||"ATTACHMENTSPERSONALITY"===e.personality_name||"COMPETITORSPERSONALITY"===e.personality_name||e.record_operations.edit||e.record_operations.assign||e.record_operations.create||e.record_operations.disassociate))return;var N=this.getModuleNameFromRelatedlist(e),P=!1;!e.mxnfield&&"multiselectlookup"!==e.type&&N&&N.indexOf("CustomModule")>-1&&(P=!0);var A=12===e.visibility,M=12===e.visibility;if(t="Deals"===t?"Potentials":t,e.personality_name.includes("_LINKINGMODULE")||"INVITEDEVENTSPERSONALITY"===e.personality_name||"POTSTAGEHISTPERSONALITY"===e.personality_name||e.personality_name.includes("HISTORYPERSONALITY")||e.personality_name.includes("REPORTINGCONTACTSPERSONALITY")||e.personality_name.includes("CHILDCAMPAIGNSPERSONALITY")||"CHILDACCOUNTSPERSONALITY"===e.personality_name||"ATTACHMENTSPERSONALITY"===e.personality_name||"EMAILSPERSONALITY"===e.personality_name||"APPOINTMENTSPERSONALITY"===e.personality_name||A||"POTENTIALSPERSONALITY"===e.personality_name&&"Contacts"===t||(e.record_operations.bulk_edit&&e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),e.record_operations.assign&&e.actions.push(this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign")))),"ACTIVITYPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("crm.button.task.new"),"Tasks")),e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("crm.button.event.new",I18n.getMsg("Meeting"),"Events"))),e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("crm.button.log.a.call"),"Calls"));else if("TASKSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("crm.button.task.new"),"Tasks"));else if("EVENTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("crm.button.event.new",I18n.getMsg("Meeting")),"Events"));else if("CALLSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("crm.button.log.a.call"),"Calls"));else if("SERIESPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addSeries","Detail_add_to_series",I18n.getMsg("crm.series.related.add.series"))),e.actions.push(this.getActionJson("un-EnrollSeries","Detail_un-enroll_series",I18n.getMsg("crm.series.related.unenroll.from.series")));else if(!A||e.personality_name.includes("LINKINGMODULE")&&"multiselectlookup"===e.type)if("ATTACHMENTSPERSONALITY"===e.personality_name)e.actions=this.getAttachmentActions("RL_Attachments");else if("CAMPAIGNSPERSONALITY"===e.personality_name)M?e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,I18n.getMsg("crm.button.new"),"Campaigns")):e.actions.push(this.getActionJson("addCampaigns","Detail_add_to_campaigns",I18n.getMsg("crm.button.add.product",moduleRecordMapping[N].plural_label)));else if("POTENTIALSPERSONALITY"===e.personality_name){var E="";E=M||"Contacts"!==t?"newPotential":"newPotentialForContacts",e.actions.push(this.getActionJson(E,"link_CreateNewPotential",I18n.getMsg("crm.module.new",moduleRecordMapping[N].singular_label),"Potentials"))}else if("REPORTINGCONTACTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Contacts"));else if("CHILDACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Accounts"));else if("COMPETITORSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newCompetitor","link_CreateNewcompetitor",I18n.getMsg("crm.button.new")));else if("CONTACTSROLESPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addContactRoles","link_CreateNewcontactrole",I18n.getMsg("crm.button.add.contact.role",moduleRecordMapping[N].plural_label))),e.actions.push(this.getActionJson("editContactRoles","link_CreateEditcontactrole",I18n.getMsg("crm.edit.all")));else if("PRICEBOOKSPERSONALITY"===e.personality_name)M?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"PriceBooks")):(e.actions.push(this.getActionJson("addProducts","link_CreateNewPbookmodule",I18n.getMsg("crm.add.to.pricebooks",moduleRecordMapping[N].plural_label))),e.actions.push(this.getActionJson("editProducts","link_CreateEditbookmodule",I18n.getMsg("crm.edit.all"))));else if("ACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Accounts"));else if("PRODUCTSPERSONALITY"===e.personality_name){var b="PriceBooks"===t,w=0!=Object.keys(Crm.userDetails.CURRENCY_DETAILS).length;M?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Products")):("Vendors"==t?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),"Products")):w&&"Potentials"===t?e.actions.push(this.getActionJson("addPotentialsProducts","addProdDtVw",I18n.getMsg("crm.add.products",moduleRecordMapping[N].plural_label))):e.actions.push(this.getActionJson("addProducts","link_CreateNewPbookmodule",I18n.getMsg("crm.add.products",moduleRecordMapping[N].plural_label))),"PriceBooks"!==t||clientPortalName||e.actions.push(this.getActionJson("importListPrice","List Price",I18n.getMsg("crm.module.import",I18n.getMsg("List Price")),t)),b&&e.actions.push(this.getActionJson("editProducts","Detail_editProdDtVw",I18n.getMsg("crm.edit.all"))))}else"APPOINTMENTSPERSONALITY"===e.personality_name&&(clientPortalName&&Crm.userDetails.permissions["Crm_Implied_Create_"+N]||!clientPortalName)?e.actions.push(this.getActionJson("newAppointment","Detail_createApppointment",I18n.getMsg("crm.module.new",moduleRecordMapping[N].singular_label),"Appointments")):P?(e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign")))):"CONTACTSPERSONALITY"!==e.personality_name&&"LEADSPERSONALITY"!==e.personality_name&&"CASESPERSONALITY"!==e.personality_name&&"SALESORDERSPERSONALITY"!==e.personality_name&&"QUOTESPERSONALITY"!==e.personality_name&&"PURCHASEORDERSPERSONALITY"!==e.personality_name&&"INVOICESPERSONALITY"!==e.personality_name&&"SOLUTIONSPERSONALITY"!==e.personality_name&&"VENDORSPERSONALITY"!==e.personality_name&&!P||e.personality_name.includes("_LINKINGMODULE")?e.personality_name.includes("_LINKINGMODULE")&&(e.actions.push(this.getActionJson("dissociateMxN",t+"_"+N+"_CreateNew",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateMxN","link_CreateNewProductNopotential",I18n.getMsg("crm.button.assign"),e.linkingmodule))):"Contacts"!==t||"Vendors"==t||"Visits"==t||P?"Potentials"===t&&"Vendors"!==N&&"Contacts"!==N&&"Leads"!==N&&"Solutions"!==N?e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),N)):"Visits"!==N&&e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,I18n.getMsg("crm.button.new"),N)):e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+N,I18n.getMsg("crm.button.new"),N));else e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+N,I18n.getMsg("crm.button.new"),N)),e.actions.push(this.getActionJson("editLookupRel",t+"_"+N+"_Edit",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateLookupRel",t+"_"+N+"_Assign",I18n.getMsg("crm.button.assign")))}},getActionJson:function(e,t,i,a,o,n){var s={};return s.data_zcqa=t,s["data-cid"]=e,s.label=i,a&&Crm.userDetails.hideUnauthorizedCreateLink&&(s.showaction=Lyte.Component.registeredHelpers.showAddRecord(a),Crm.userDetails.isRelatedListLyteEnabled&&(s.hasAssignAction=o,o&&(s.assignActionCid=n))),s},getModuleNameFromRelatedlist:function(e){if(e&&e.module)return"Email_Sentiment"==e.api_name?"EmailSentiment":e.connectedmodule?e.connectedmodule:e.module.id&&store.peekRecord("module",e.module.id)?store.peekRecord("module",e.module.id).module_name:void 0},isStandardLookup:function(e){return"default"===e.type&&10===e.visibility&&!["ACTIVITYPERSONALITY","TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","COMPETITORSPERSONALITY","PRODUCTSPERSONALITY","CAMPAIGNSPERSONALITY","PRICEBOOKSPERSONALITY","CONTACTSPERSONALITY","LEADSPERSONALITY","POTENTIALSPERSONALITY","ACCOUNTSPERSONALITY","CONTACTSROLESPERSONALITY"].contains(e.personality_name)},showLayoutPopup:function(e,t,i,a,o){Crm.trackSpotLightAction("MPL - Change Layout From Record Click",{Module:e});var n=networkUtils.returnDependencyFiles(["crm-change-layout.js"],ResourceConstants.CRMClient);commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({filesResolved:Lyte.injectResources(n),moduleInfo:store.findRecord("module",moduleRecordMapping[e].id)}).then((function(){commonUtils.showHideLoadingDiv(!1);var n={};n.currentLayout=t,n.entityId=i,n.module=e,n.cancelListenerId=o;for(var s=Crm.userDetails.PROFILE_ID,r=store.peekRecord("module",moduleRecordMapping[e].id).layouts,l=r.length,d=[],c=[],m=0;m<l;m++){var u=r[m];if("active"===u.status&&"campaign_integration"!==u.source)for(var p=u.profiles,g=p.length,_=0;_<g;_++){if(p[_].id===s){var L={};L.id=u.id,L.name=u.name,L.checked=L.id===t,d.push(L),c.push(u.id);break}}}n.layouts=d,n.chosenlayout=t,n.disableChange=!0,c.contains(t)||(n.chosenlayout=c[0],n.disableChange=!1),(a?$("#canvasPopupDiv"):$("#dv-button-layer")).append('<div id="changeLayoutPopupDiv"></div>');let v=$L("crm-change-layout");0===v.length?Lyte.Component.render("crm-change-layout",n,"#changeLayoutPopupDiv"):v[0].setData(n),$L("#changeLayoutPopup")[0].ltProp({show:!0})}),(function(){commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied()}))},renderStageComponent:function(){var e=$("#stageContain");if(0!==e.length){var t,i="";returnJson.entMetaData.crtdTimeNew&&(t=Utils.getDateInUserDatePattern(new CrmDate(returnJson.entMetaData.crtdTimeNew).dateObject,!0));var a=returnJson.entityMapJson.STAGE,o=a.val,n=o.length,s=returnJson.Potentials.fieldDependency;if(s&&JSON.parse(s).PIPELINE){var r=JSON.parse(s).PIPELINE.STAGE,l=$("#subvalue_PIPELINE").text();if(r&&l){for(var d=r[l],c=d.length,m=[],u=0;u<c;u++)for(var p=d[u],g=0;g<n;g++)p===o[g].content&&m.push(o[g]);var _=m.length;_>0&&(o=m,n=_)}}var L=[],v=[],I=[],y=-1,C=!1,R=!0,h=!1,f=!1;for(g=0;g<n;g++){o[g].selectedStepItem="";var N=null;if("-None-"!==o[g].content){a.colorcode_enabled&&(o[g].colorCode="transparent"===o[g].colorCode?"#ffffff":o[g].colorCode);var P=null;if(o[g].content===a.plainValue){if(o[g].selectedStepItem="stageStepItemSelected",y=h?g-1:g,"Open"===o[g].fctype&&returnJson.entityMapJson.CLOSINGDATE&&returnJson.entityMapJson.CLOSINGDATE.defaultvalue){var A=(new Date-new Date(returnJson.entMetaData.crtdTimeNew))/(new CrmDate(returnJson.entityMapJson.CLOSINGDATE.defaultvalue).dateObject-new Date(returnJson.entMetaData.crtdTimeNew)+864e5)*100;i=A>75||A<0?"stage_redIcon":A>50?"stage_orangeIcon":A>25?"stage_yellowIcon":"stage_greenIcon"}(!returnJson.entityMapJson.CLOSINGDATE||"true"===returnJson.entityMapJson.CLOSINGDATE.readonly||!returnJson.entityMapJson.CLOSINGDATE.defaultvalue||detailView.changedBCJson&&detailView.changedBCJson.hidden&&!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"false"===String(allowEditProf))&&(C=!0,returnJson.entityMapJson.CLOSINGDATE&&returnJson.entityMapJson.CLOSINGDATE.defaultvalue||(R=!1)),P=a.defaultvalue.split(":")[0]+":"+o[g].content}var M=P||o[g].pbty+":"+o[g].content;if("Closed Won"===o[g].fctype){var E={name:o[g].content,val:M,selectedStepItem:o[g].selectedStepItem};N="Closed",a.colorcode_enabled&&(E.colorCode=o[g].colorCode),v.push(E)}else if("Closed Lost"===o[g].fctype){var b={name:o[g].content,val:M,selectedStepItem:o[g].selectedStepItem};N="Omitted",a.colorcode_enabled&&(b.colorCode=o[g].colorCode),I.push(b)}o[g].name&&(a.colorcode_enabled?L.push({name:o[g].content,val:M,fccat:N||o[g].fctype,selectedStepItem:o[g].selectedStepItem,colorCode:o[g].colorCode}):L.push({name:o[g].content,val:M,fccat:N||o[g].fctype,selectedStepItem:o[g].selectedStepItem}))}else h=!0}a.colorcode_enabled&&e.addClass("colorEnableDetailviewStage"),-1===y&&(y=n,y=h?n-1:n,L.push({name:a.plainValue,val:a.defaultvalue,fccat:"",colorCode:a.color_code}));var w=$L("#nbaDetails");w&&"Open"!==L[y].fccat&&w.hide();var S=v.length>0,D=I.length>0,T=S&&D,O="";if(returnJson.Potentials.disableStageNavigator&&(S=!1,D=!1,O=detailView.disableNavigatorMsg),(detailView.changedBCJson&&detailView.changedBCJson.hidden&&!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"false"===String(allowEditProf))&&(f=!0),0===$("crm-stage-detailview").length)Lyte.Component.render("crm-stage-detailview",{stepBigArray:L,closedWonArray:v,closedLostArray:I,closingDate:$("#value_CLOSINGDATE").text(),createdTime:t,selectIndex:y,index:y>=5?y:0,closedWonNeed:S,closedLostNeed:D,tootTip:O,dateICON:i,noDateEdit:C,closingDateNeed:R,noStageEdit:f,thumpsNeed:T},"#stageContain");else{var k=$("#value_CLOSINGDATE").text(),U=$L("crm-stage-detailview").e[0],x=$L(".stageMenuDropdownLyte .stageMenuDropdownLyteItem");U.component.setData("selectIndex",y),U.component.setData("closingDate",k),U.component.setData("dateICON",i),U.component.setData("closedWonArray",v),U.component.setData("closedLostArray",I),U.component.setData("closingDateNeed",R),x.removeClass("stageStepItemSelected"),x.eq(y).addClass("stageStepItemSelected"),setTimeout((function(){Lyte.registeredMixins["crm-detail-view-utils"].scrollStageComponent($L(".stage-step-containerDivParent .stage-step-item.lyteActive"))}),50),$("#stageIndicator_CLOSINGDATE").text(k)}}},scrollStageComponent:function(e){if(e.length>0){var t=e.closest(".stage-step-containerDivParent"),i=e.prev(),a=i.length?i.position().left:e.position().left,o=t.scrollLeft();t.animate({scrollLeft:a+o},1e3),setTimeout((function(){Lyte.registeredMixins["crm-detail-view-utils"].setDisableForNextPrev()}),1050)}},setDisableForNextPrev:function(){var e,t=$L(".stage-step-container-lytestep"),i=$L(".stage-step-containerDivParent");e=Crm.userDetails.RTL_ENABLED?-i.scrollLeft():i.scrollLeft();var a,o=i.outerWidth(),n=t.find(".stage-backward-cont"),s=t.find(".stage-forward-cont"),r=i.find(".stage-step-item"),l=r.length,d=0;for(a=0;a<l;a++)d+=$L(r[a]).outerWidth();d=Math.round(d),e<=0?(s.removeClass("eventNone").addClass("stageRightShadow"),n.addClass("eventNone").removeClass("stageLeftShadow")):d<=e+o+4?(n.removeClass("eventNone").addClass("stageLeftShadow"),s.addClass("eventNone").removeClass("stageRightShadow")):(n.removeClass("eventNone").addClass("stageLeftShadow"),s.removeClass("eventNone").addClass("stageRightShadow"))},setStageStripResize:function(e){if("Potentials"===e){var t=$L("crm-stage-history");t&&t.length&&t[0].component.setWidthForStagesParent()}},isApprovedRecord:function(e){return null==e.$approval||!(0==e.$approved&&0==e.$approval.resubmit||!(e.$approval.resubmit||e.$approved||e.$review)||e.$stop_processing||"Rejected"==e.$review)},deleteFromBundleProdRelList:function(e,t){let i="canvas"===Lyte.Router.getRouteInstance().routeName;var a,o,n=i?$L("crm-detailview-canvas")[0]:$L("crm-related-list-view")[0];if(i)a=n&&n.getData("record")?n.getData("record"):null;else{let e=n&&n.getData("entityId")?n.getData("entityId"):null;a=e?store.peekRecord(moduleRecordMapping.Bundles.id,e):null}if(a&&a.Total_Item_Count&&a.Unique_Item_Count){if(a.Unique_Item_Count<=2)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("bundles.minimum.product.relatedlist.check",["2",moduleRecordMapping.Products.plural_label]));var s=a.id,r=store.peekRecord(moduleRecordMapping.Bundles.id,s);r.$.set("Linked_Products",[{_delete:null,id:e.id}]);var l=a.Unique_Item_Count-1,d=(o=a.Total_Item_Count-e.Product_Quantity,parseFloat(o.toFixed(7)));r.$.save().then((()=>{r.$.set("Total_Item_Count",d),r.$.set("Unique_Item_Count",l),i&&n.setData("originalRecord",objectUtils.cloneObject(a)),Lyte.objectUtils(a,"add","Total_Item_Count",d),Lyte.objectUtils(a,"add","Unique_Item_Count",l),Lyte.triggerEvent("relatedList",{id:t.id,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"===JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{id:t.id}),commonUtils.showHideLoadingDiv())}))}},deleteFromProductBundleRelList:function(e,t){var i=e.id;let a;if("canvas"===Lyte.Router.getRouteInstance().routeName)a=e.hasOwnProperty("Product")&&e.Product.id?e.Product.id:null;else{let e=$L("crm-related-list-view")[0];a=e&&e.getData("entityId")?e.getData("entityId"):null}if(i&&a){var o=store.peekRecord(moduleRecordMapping.Products.id,a);o.$.set("Linked_Bundles",[{_delete:null,id:i}]),o.$.save().then((()=>{Lyte.triggerEvent("relatedList",{id:t.id,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(e=>{var i=JSON.parse(e.response),a=i&&i.data?i.data.first():i;"MINIMUM_DATA_NOT_FOUND"===(a&&a.code?a.code:"PERMISSION_DENIED")&&moduleRecordMapping.Products&&moduleRecordMapping.Products.plural_label?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("bundles.minimum.product.relatedlist.check",["2",moduleRecordMapping.Products.plural_label])):renderingUtils.displayPermissionDenied(),Lyte.triggerEvent("relatedList",{id:t.id}),commonUtils.showHideLoadingDiv()}))}},highLightElement:function(e,t){if(t){if(e)for(var i=e.length,a=0;a<i;a++)$L(".fieldupdate_"+e[a]).addClass("fieldupdate-highlight")}else{if(null!=e){var o=e.length;for(a=0;a<o;a++)$L(e[a]).css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"})}setTimeout((function(){if(null!=e)for(var t=e.length,i=0;i<t;i++)$L(e[i]).css("background-color","transparent")}),5e3)}},refreshRollupSummary:function(e,t,i){var a=Lyte.Router.getRouteInstance().transition.info,o=5e3;e==a.dynamicParams[0]&&t==a.dynamicParams[1]&&(o=2e3),setTimeout((function(){if("crm.tab.module.entity.canvas"==(a=Lyte.Router.getRouteInstance().transition.info).route&&e==a.dynamicParams[0]&&t==a.dynamicParams[1]){if(i.length>0){var o=$L("crm-detailview-canvas")[0].component.getData("record"),n=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(o);store.findRecord(moduleRecordMapping[e].id,detailView.entityId,{approved:"both",converted:"both"}).then((function(o){var s=o[0];s&&s.id&&detailView&&detailView.entityId&&detailView.entityId==s.id&&($L("crm-detailview-canvas")[0].component.setData("record",objectUtils.cloneObject(s)),setTimeout((function(){if("crm.tab.module.entity.canvas"==(a=Lyte.Router.getRouteInstance().transition.info).route&&e==a.dynamicParams[0]&&t==a.dynamicParams[1]&&i){ProcessFlow.refreshButtonLayer(e,t,null,!0);var o=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(s);n!==o?Lyte.Router.getRouteInstance().refresh().data={rollupSummaryFields:i}:Lyte.registeredMixins["crm-detail-view-utils"].highLightElement(i,!0)}}),100))}))}}else if(Crm.renderDVLyteFlow(e)&&("crm.tab.requesters.module.index-module.entity.detail"===a.route||"crm.tab.module.entity.detail"===a.route)&&e===a.dynamicParams[0]&&t===a.dynamicParams[1]&&i.length>0){var s=$L("crm-detail-view")[0].component.getData("record");n=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(s);store.findRecord(moduleRecordMapping[e].id,t,{approved:"both",converted:"both"}).then((function(o){var s=o[0];s&&s.id&&t&&t===s.id&&setTimeout((function(){if(a=Lyte.Router.getRouteInstance().transition.info,i&&"crm.tab.module.entity.detail"===a.route&&e===a.dynamicParams[0]&&t===a.dynamicParams[1]){var o=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(s),r=$L("crm-detail-view")[0].component;if(r&&r.data){var l=r.data.content_json.meta_info.fieldColumnNameMap;if(l){var d=[],c={},m={},u=Math.floor(1e3*Math.random()),p={};for(var g of i)l&&l[g]&&l[g][1]&&(p[l[g][1]]=s[l[g][1]],m[l[g][1]]=" ",c[l[g][1]]=u);if(p.id=s.id,store.pushPayload(moduleRecordMapping[e].id,p),d.push(m),n!==o&&d)Lyte.Router.getRouteInstance().refresh().data={affected_data:d};else if(c){var _=Lyte.registeredMixins["crm-detailview-common-utils"];_.refreshProcessLayer(s),r.setData("tobe_highlighted_fields",c),setTimeout(_.removeHighlightedFields,5e3,u)}}}}}),100)}))}else"crm.tab.requesters.module.index-module.entity.detail"!==a.route&&"crm.tab.module.entity.detail"!==a.route||e!==a.dynamicParams[0]||t!==a.dynamicParams[1]||void 0===detailView||void 0===detailView.dataParamDetails||store.findRecord(moduleRecordMapping[e].id,t,{approved:"both",converted:"both"}).then((function(o){var n=o[0];if(n&&n.id&&detailView&&detailView.entityId&&detailView.entityId==n.id){var s=detailView.dataParamDetails,r=detailView.dataParamDetails.recordInfo,l=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(r),d=o.$.meta.original,c=detailView.dataParamDetails.isoCode,m=!1,u=!1,p=[];Object.keys(s).forEach((function(e){var t=n[e],a=s[e][0],o=s[e][1],r=$("#headervalue_"+a),l=$("#value_"+a);if("isoCode"!==e&&void 0!==d&&void 0!==d[e]&&(t=d[e]),"isoCode"!==e&&i.includes(a)&&l.length>0){if("date"===o&&void 0!==t)t=Utils.getDateInUserDatePattern($L.moment(t).toDate(),!0);else if("datetime"===o&&void 0!==t)t=Utils.getUserDateTimeFormatFromServerFormat(t);else if("currency"===o&&void 0!==t)t=featuresAvailable.MultiCurrency&&void 0!==Crm.userDetails.CURRENCY_DETAILS[c]?currencyUtils.returnValueInDefaultCurrency(c,t,Crm.userDetails.CURRENCY_DETAILS[c].decimals):currencyUtils.returnValueInDefaultCurrency(c,t,s[e][2]);else if(("longinteger"===o||"integer"===o||"decimal"===o)&&t){if(t=t.toString(),JSON.parse(l[0].parentElement.dataset.params).separator){var g=Crm.userDetails.COUNTRY_LOCALE.replace("_","-");"ar-SA"!==g&&"es-PR"!==g&&"bn-BD"!==g&&"ar-AE"!==g&&"ar-KW"!==g||(g="en-US"),t=Intl.NumberFormat(g,{maximumFractionDigits:s[e][2]}).format(t);var _=new Intl.NumberFormat(g).format(1.1).replace(/1/g,""),L=new Intl.NumberFormat(g).format(11111).replace(/1/g,""),v=t.split(L).join(Crm.userDetails.numberSeparators.group);if(1===Search.countCharacters(_,t)){var I=_+"([^"+_+"]*)$";v=v.replace(new RegExp(I),Crm.userDetails.numberSeparators.decimal+"$1")}t=v}}void 0!==r&&r.length>0&&(u=!0,m=!0,r.find("#subvalue_"+a).html(t),p.push("#header_"+a)),void 0!==l&&l.length>0&&(u=!0,m=!0,l.find("#subvalue_"+a).html(t),p.push("#value_"+a))}})),setTimeout((function(){if(("crm.tab.requesters.module.index-module.entity.detail"===(a=Lyte.Router.getRouteInstance().transition.info).route||"crm.tab.module.entity.detail"===a.route)&&e===a.dynamicParams[0]&&t===a.dynamicParams[1]&&!0===m&&!0===u){crmLookupBusinessCard.result=null,ProcessFlow.refreshButtonLayer(e,t,null,!0);var i=Lyte.registeredMixins["crm-detail-view-utils"].isApprovedRecord(n);l!==i?reloadCurrentEntityView(t,e,(function(){Lyte.registeredMixins["crm-detail-view-utils"].highLightElement(p,!1)})):("Timeline"==detailView.currentTabView?detailView.dataParamDetails.isUpdated=!0:refreshFollowDiv(),Lyte.registeredMixins["crm-detail-view-utils"].highLightElement(p,!1))}}),100)}}))}),o)},initializeClientScript:function(){CScriptLib&&(Lyte.Router.getRouteInstance().prevent_cscript_onLoad||(CScript.Engine.Global.Init(),CScript.Engine.Global.dispatchEvent("onLoad")),Lyte.Router.getRouteInstance().prevent_cscript_onLoad=void 0)},openDVOverViewPage:function(e){let t=$L("#dv_content_tabs")[0];t&&t.openTab(e)},startCrmMeeting:function(e,t){$("#meetNow_option").hide(),Events.createSource="relatedlist_meetnow",Events.meetToolsel=void 0!==e?e.name:void 0,Events.globalCreate(event,"relatedlist_meetnow",void 0,void 0,void 0,void 0,void 0,void 0,void 0,t)},scheduleOnlineMeeting:function(e,t,i){Events.scheduleOnlineEvent=!0;let a={rlid:e,rlmodule:t};Events.globalCreate(event,"relatedlist_new",void 0,void 0,void 0,void 0,void 0,void 0,void 0,i,a)}});
