var crmFormulaInit=function(){this.fixedElemsVsIds={"Sub Total":"subTotal",Discount:"txtDiscount",Tax:"txtTax",Adjustment:"txtAdjustment","Grand Total":"grandTotal"},this.fixedIdVsElems={subTotal:"Sub Total",txtDiscount:"Discount",txtTax:"Tax",txtAdjustment:"Adjustment",grandTotal:"Grand Total"},this.formulaArr=[],this.formulaVsFormulaField={},this.formulaVsField={},this.labelVsColMap={},this.fieldVsFormulaMap={},this.formulaeWithoutFields=[],this.subFormVssubFormFields={},this.moduleName,this.decimalFldUITypeArr=[32,34,36,38,39,40,52,77,143,144,145,117],this.formulaFldVsAssumeDefault={},this.formulaFldDomIds=[],this.formulaConditionExpression={},this.aggrArr=[],this.aggrVsAggrField={},this.fieldVsAggrMap={},this.aggrFieldVsAggMap={},this.aggrFieldVsaggrCrt={}};crmFormulaInit.prototype.resetProps=function(){this.formulaArr=[],this.formulaVsFormulaField={},this.formulaVsField={},this.labelVsColMap={},this.fieldVsFormulaMap={},this.formulaFldVsAssumeDefault={},this.formulaFldDomIds=[],this.formulaeWithoutFields=[],this.moduleName=null,this.subFormVssubFormFields={},this.aggrArr=[],this.aggrVsAggrField={},this.fieldVsAggrMap={}},crmFormulaInit.prototype.setupFormulaDependencies=function(e){this.moduleName=e,this.extractFormulaInvolvedFields(e),this.bindFunction()},crmFormulaInit.prototype.executeForNewFormulaExpr=function(){for(var e in this.fieldVsFormulaMap){e=e.substring(2,e.length-1);var t=this.getDomForTag(e);if(t&&1==t.length)for(var a=t.length,r=0;r<a;r++)t[r].trigger("change",{isFormulaChange:!0})}},crmFormulaInit.prototype.handlePriceBookLineItemUpdate=function(e,t,a){var r=$(productDetails.sfFldIdSuffix+"BOOKID_"+e),l=$(productDetails.sfFldIdSuffix+"QUANTITY_"+e),i=$(productDetails.sfFldIdSuffix+"LISTPRICE_"+e),s=$(productDetails.sfFldIdSuffix+"DISCOUNT_"+e);if(Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted)var o=$(productDetails.sfFldIdSuffix+"DISCOUNT_TYPE_"+e),n=$(productDetails.sfFldIdSuffix+"DISCOUNT_PERCENTAGE_"+e);var u=r.val();t?r.attr("pricingDetails",t):a||(t=r.attr("pricingDetails"));var m=t?JSON.parse(t):{},d=objectUtils.getKeys(m).length>0;u&&u.length>0&&!d&&(Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted?(populatePicklist(o,"",!0),n.val("0"),o.val(productDetails.getDiscountTypeUserValueForSystemValue(o,"Price Book")).trigger("change")):s.attr({percentage:0,discType:"fromPb"}),r.removeAttr("pricingDetails"),s.val("0"),s.trigger("change"));var f=l.val(),g=i.val(),p=$(productDetails.sfFldIdSuffix+"TOTAL_"+e);if(p.length>0&&d&&null!==f&&f>0&&void 0!==u&&u.length>0){var c=r.data().subformdisplaylabel,h=p.attr("expression");h=this.replaceFldLabelToValInAmountFormulaExpr(h,e,c);var F=this.convertPricingRangeHtmlToObject(m.pricingRange),D=m.pricingModel,v={};v.pricingRange=F,v.pricingModel=D,v.expression=h,v.subformDisplayLabel=c,v.quantity=f,v.listPrice=g;var I={};I.subFormIndex=e,I.userDetails=Crm.userDetails,I.userDetails.am=I18n.getMsg("AM"),I.userDetails.pm=I18n.getMsg("PM"),I.instance=this,I.priceBookCalObj=v,I.module=productDetails.module,this.formulaWorker.postMessage(I)}},crmFormulaInit.prototype.convertPricingRangeHtmlToObject=function(e){var t=[];e&&$(e).find("tbody tr").each((function(e,a){var r={},l=$(a).find("td"),i=l[0].innerText.trim().split("-"),s=i[0].trim(),o=i[1].trim(),n=l[1].innerText.trim().replace("%","").trim();r.From=s,r.To=o,r.Discount=n,t.push(r)}));return t},crmFormulaInit.prototype.replaceFldLabelToValInAmountFormulaExpr=function(e,t,a,r){if(r){var l=$(productDetails.sfFldIdSuffix+"QUANTITY_"+t);if(l.length>0){var i=l.data("label");e=e.replace("${"+a+"."+i+"}",""+r)}}else for(var s=this.formulaVsField[e],o=s.length,n=0;n<o;n++){var u=(i=s[n]).replace("${","").replace("}","").trim(),m="Crm_"+productDetails.module+"_"+this.labelVsColMap[u]+"_"+t,d=$("#"+m).data();d&&"QUANTITY"!==d.colname&&(e=this.replaceValForFldLabel(u,t,e,this))}return e},crmFormulaInit.prototype.executeformulaeWithoutFields=function(){for(var e=this.formulaeWithoutFields.length,t=0;t<e;t++){var a={};a.formula=this.removeWhiteSpaces(this.formulaeWithoutFields[t]),a.fieldKey=this.formulaeWithoutFields[t],a.userDetails=Crm.userDetails,a.userDetails.am=I18n.getMsg("AM"),a.userDetails.pm=I18n.getMsg("PM"),a.instance=this,this.formulaWorker.postMessage(a)}},$(document).ready((function(){crmFormulaInit.prototype.formulaWorker=new Worker(window.location.protocol+"//"+window.location.host+"/crm/javascript/crmFormulaUtil.js?"+crmConstants.staticVersion),crmFormulaInit.prototype.formulaWorker.onmessage=function(e){if(e.data.isAggregate){var t=$("#"+e.data.destinationField),a=t.data().decimalLength,r=parseFloat(parseFloat(e.data.resFromFormulaWorker).toFixed(a));Crm.userDetails.lineItemFormulaCalcFlow&&objectUtils.getKeys(Crm.userDetails.lineItemFormulaCalcFlow).length>0&&Crm.isInventoryModule(productDetails.module)&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module]&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module].aggrFields[t.data().colname]&&(r=productDetails.getRoundOffValue(r,!0)),isNaN(r)&&(r=""),t.val(r).change()}else if("logPush"!==e.data.response&&"perfEntries"!==e.data.response&&"failedFetch"!==e.data.response){r=e.data.resFromFormulaWorker;var l=e.data.instance,i=e.data.subFormIndex;if(e.data.applyPricebookDiscount){var s=$(productDetails.sfFldIdSuffix+"DISCOUNT_"+i),o=$(productDetails.sfFldIdSuffix+"TOTAL_"+i);if(Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted)var n=$(productDetails.sfFldIdSuffix+"DISCOUNT_TYPE_"+i),u=$(productDetails.sfFldIdSuffix+"DISCOUNT_PERCENTAGE_"+i);var m=o.val();m=m||0,s.val(productDetails.getRoundOff(s,parseFloat(r)));var d=m?r/(m/100):0;return Crm.userDetails.isDiscountFieldEnhancementMigrationCompleted?(populatePicklist(n,"",!0),u.val("0"),n.val(productDetails.getDiscountTypeUserValueForSystemValue(n,"Price Book")).trigger("change")):s.attr({percentage:productDetails.getRoundOffValue(d,!0,9),discType:"fromPb"}),void s.trigger("change")}if(l.formulaVsFormulaField)for(var f=l.formulaVsFormulaField[e.data.fieldKey].length,g=0;g<f;g++){var p=l.formulaVsFormulaField[e.data.fieldKey][g],c=p.split("_")[4];if(!i||!c||c===i)for(var h=$("[id='"+p+"'],[id$='"+p+"_TimeOption']"),F=h.length,D=0;D<F;D++){var v,I=h.eq(D),x=I.data();if("datetime"==x.formulatype||"date"==x.formulatype)if(e.data.assumeDefault)r=(v=e.data.resFromFormulaWorker.split(" ")[0])&&!Utils.isValidDate(Crm.userDetails.DATE_PATTERN,v)?$L.moment(e.data.resFromFormulaWorker).toDate():$L.moment(Utils.convertUsrtoDefaultDatePattern(e.data.resFromFormulaWorker)).toDate(),r="date"==x.formulatype?Utils.getDateInUserDatePattern(r,!1):Utils.getDateTimeInUserFormat(r,!0,"false");else if(""===e.data.resFromFormulaWorker)r="";else r=(v=e.data.resFromFormulaWorker.split(" ")[0])&&!Utils.isValidDate(Crm.userDetails.DATE_PATTERN,v)?new Date(e.data.resFromFormulaWorker):new Date(Utils.convertUsrtoDefaultDatePattern(e.data.resFromFormulaWorker)),r="date"==x.formulatype?Utils.getDateInUserDatePattern(r,!1):Utils.getDateTimeInUserFormat(r,!0,"false");else if("number"==x.formulatype||"currency"==x.formulatype)r=Crm.userDetails.lineItemFormulaCalcFlow&&objectUtils.getKeys(Crm.userDetails.lineItemFormulaCalcFlow).length>0&&Crm.isInventoryModule(productDetails.module)&&(!x.subformdisplaylabel&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module].aggrFields[x.colname]||x.subformdisplaylabel&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module][x.colname])?productDetails.getRoundOffValue(r,!0):parseFloat(parseFloat(r).toFixed(x.decimalLength)),isNaN(r)&&(r="");else if(e.data.fieldKey.startsWith("Datepart"))try{r=CrmDateUtils.convertDateToUserPattern(new Date(e.data.resFromFormulaWorker))}catch(e){murphy.error(e)}I.val(r).change()}}}}})),crmFormulaInit.prototype.constructFieldVsFormulaMap=function(e,t){var a=e,r=a.match(/\${.*?}/g);this.formulaVsField[a]=[];var l=[];if(r)for(var i=r.length,s=0;s<i;s++)l.push(r[s].substring(2,r[s].length-1)),this.fieldVsFormulaMap[r[s]]||(this.fieldVsFormulaMap[r[s]]=[]),-1===this.fieldVsFormulaMap[r[s]].indexOf(t)&&this.fieldVsFormulaMap[r[s]].push(t);else this.formulaeWithoutFields.push(a);this.formulaVsField[a]=l},crmFormulaInit.prototype.extractFormulaInvolvedFields=function(e){var t=window[e].createEditJson?window[e].createEditJson:crmCommonModule.createEditJson;for(x in t.entityMapJson)t.entityMapJson.hasOwnProperty(x)&&(t.entityMapJson[x].subFormTabId?this.labelVsColMap[t.entityMapJson[x].subformdisplaylabel+"."+t.entityMapJson[x].label]=t.entityMapJson[x].subFormTabId+"_"+t.entityMapJson[x].colname:t.entityMapJson[x].isaggrfield&&t.entityMapJson[x].suffixIndex?this.labelVsColMap[e+"."+t.entityMapJson[x].label]=t.entityMapJson[x].suffixIndex+"_"+t.entityMapJson[x].colname:this.labelVsColMap[e+"."+t.entityMapJson[x].label]=t.entityMapJson[x].colname);for(var a=null,r=this.formulaArr.length,l=0;l<r;l++)this.constructFieldVsFormulaMap(this.formulaArr[l],l),Crm.userDetails.DYNAMIC_FORMULA_ENABLED&&this.formulaConditionExpression[this.formulaFldDomIds[l]]&&this.constructFieldVsFormulaMap(this.formulaConditionExpression[this.formulaFldDomIds[l]],l);a=null;var i=this.aggrArr.length;for(l=0;l<i;l++){a={},t=(a=this.aggrArr[l]).match(/\${.*?}/g);if(this.formulaVsField[a]=[],t)for(var s=t.length,o=0;o<s;o++)this.fieldVsAggrMap[t[o]]||(this.fieldVsAggrMap[t[o]]=[]),-1==this.fieldVsAggrMap[t[o]].indexOf(l)&&this.fieldVsAggrMap[t[o]].push(l)}var n=Object.keys(this.aggrFieldVsaggrCrt),u=n.length;for(l=0;l<u;l++){var m=n[l],d=this.aggrFieldVsaggrCrt[m],f=this.aggrArr.indexOf(this.aggrFieldVsAggMap[m]);if((t=d.match(/\${.*?}/g))&&-1!==f)for(s=t.length,o=0;o<s;o++)this.fieldVsAggrMap[t[o]]||(this.fieldVsAggrMap[t[o]]=[]),-1===this.fieldVsAggrMap[t[o]].indexOf(f)&&this.fieldVsAggrMap[t[o]].push(f)}},crmFormulaInit.prototype.getDomForTag=function(e,t){var a=e.match(/\w*\d*\w*\d*\./g)?e.match(/\w*\d*\w*\d*\./g)[0]:null,r=a?e.split(a)[1]:e;a&&(a=a.substring(0,a.length-1)),a=this.moduleName;var l=[],i=null;if(this.labelVsColMap[e]?i="Crm_"+a+"_"+this.labelVsColMap[e]:"Salutation"===r&&(i="#Crm_"+a+"_FIRSTNAME_SALUTATION"),i){var s=null,o=!1,n=[];if(t)o=!0,i+="_"+t;else for(x in this.subFormVssubFormFields)if(-1!==i.indexOf(x)){o=!0;break}if(o)for(var u=(s=$("[id^='"+i+"']").filter((function(){return this.id.match(/_\d+$/g)}))).length,m=0;m<u;m++)i=s[m].id,(n=$("#"+i+"_TimeOption")).length>0&&l.push(n);else s=$("#"+i),(n=$("#"+i+"_TimeOption")).length>0&&l.push(n);return s.length>0&&l.push(s),l}},crmFormulaInit.prototype.bindFunction=function(){for(var e in this.fieldVsFormulaMap){if(e=e.substring(2,e.length-1),(r=this.getDomForTag(e))&&r.length>0)for(var t=r.length,a=0;a<t;a++)r[a].on("change",{self:this},this.executeRespectiveFormula)}for(var e in this.fieldVsAggrMap){var r;if(e=e.substring(2,e.length-1),(r=this.getDomForTag(e))&&r.length>0)for(t=r.length,a=0;a<t;a++)r[a].on("change",{self:this},this.executeRespectiveAggr)}},crmFormulaInit.prototype.getRelatedFormulae=function(e){var t=[];if(this.fieldVsFormulaMap[e])for(var a=this.fieldVsFormulaMap[e].length,r=0;r<a;r++)t.push(this.formulaArr[this.fieldVsFormulaMap[e][r]]);return t},crmFormulaInit.prototype.getRelatedFormulaDomIds=function(e){var t=[];if(this.fieldVsFormulaMap[e])for(var a=this.fieldVsFormulaMap[e].length,r=0;r<a;r++)t.push(this.formulaFldDomIds[this.fieldVsFormulaMap[e][r]]);return t},crmFormulaInit.prototype.getRelatedAggr=function(e){var t=[];if(this.fieldVsAggrMap[e])for(var a=this.fieldVsAggrMap[e].length,r=0;r<a;r++)t.push(this.aggrArr[this.fieldVsAggrMap[e][r]]);return t},crmFormulaInit.prototype.removeWhiteSpaces=function(e){for(var t=!1,a="",r=null,l=e.length,i=0;i<l;i++)if(0!==i&&(r=e[i-1]),"\\"!==r&&"'"==e[i])t=!t,a+=e[i];else if(t||" "==e[i]){if(t){var s=e[i];"("==s?s="\\(":")"==s&&(s="\\)"),a+=s}}else"\\"!==r&&","==e[i]?a+="#&":a+=e[i];return a},crmFormulaInit.prototype.executeRespectiveFormula=function(){var e=arguments[0],t=this,a=$(t),r=e.data.self,l=a.data().label;"SALUTATION"==a.data().colname&&(l="Salutation");var i=null,s=a.data().subformdisplaylabel;if(s){i=a.attr("id").split("_")[4];var o="${"+s+"."+l+"}"}else if(l)o="${"+t.id.split("_")[1]+"."+l+"}";else if(r.fixedIdVsElems[t.id])o="${"+a.data().module+"."+r.fixedIdVsElems[t.id]+"}";var n=r.getRelatedFormulae(o),u=r.getRelatedFormulaDomIds(o),m=[],d=[],f=[],g=[],p=0;void 0!==n&&(p=n.length);for(var c=0;c<p;c++){var h=r.formulaVsField[n[c]],F=n[c],D=u[c];g.push(F),F=r.removeWhiteSpaces(F);var v=0;void 0!==h&&(v=h.length);for(var I=0;I<v;I++){if(void 0===(F=r.replaceValForFldLabel(h[I],i,F,r,r.formulaFldVsAssumeDefault[r.formulaFldDomIds[c]])))return;if(""===F)break}if(void 0!==F&&F.length>0&&(m.push(F),d.push(D)),Crm.userDetails.DYNAMIC_FORMULA_ENABLED){if((F=r.formulaConditionExpression[D])&&(h=r.formulaVsField[F])&&h.length){F=r.removeWhiteSpaces(F),v=h.length;for(I=0;I<v;I++){if(void 0===(F=r.replaceValForFldLabel(h[I],i,F,r,r.formulaFldVsAssumeDefault[r.formulaFldDomIds[c]])))return;if(""===F)break}}f.push(F)}}var x=0;null!==m&&(x=m.length);for(var V=0;V<x;V++){(F={}).domId=d[V],F.assumeDefault=r.formulaFldVsAssumeDefault[d[V]],Crm.userDetails.DYNAMIC_FORMULA_ENABLED&&(F.stopComputeExpression=f[V]),F.formula=m[V],F.fieldKey=g[V],F.userDetails=Crm.userDetails,F.userDetails.am=I18n.getMsg("AM"),F.userDetails.pm=I18n.getMsg("PM"),F.instance=r,F.subFormIndex=i,r.formulaWorker.postMessage(F)}},crmFormulaInit.prototype.replaceValForFldLabel=function(e,t,a,r,l){var i=r.getDomForTag(e,t);if(void 0!==i&&i.length>0){var s="",o=i[0].data().uitype,n=i[0].data().contentType,u="${"+e.replace(/\s/g,"")+"}";a=a.replace(u,"${"+e+"}");if(2==i.length){if(void 0!==i[0].val()&&i[0].val().length>0&&void 0!==i[1].val()&&i[1].val().length>0)if(200==o||786==o||14==o||24==o||202==o||333==o){var m=CrmDateUtils.getDateObjectFromString(i[1].val());s=l||"Invalid Date"!==String(m)?CrmDateUtils.getDateInPattern(m,"MMM D,YYYY")+" "+i[0].val():""}else s=i[0].val()+" "+i[1].val()}else if("checkbox"==i[0].attr("type"))s=i[0].prop("checked")+"";else if("DIV"==i[0].prop("tagName"))s=i[0].find("#ownerNameLookupSpan").text();else if(200==o||786==o||14==o||24==o||202==o||333==o){m=CrmDateUtils.getDateObjectFromString(i[0].val());s=CrmDateUtils.getDateInPattern(m,"MMM D,YYYY")}else s=i[0].val();void 0!==s&&"object"==typeof s&&s.length&&(s=s.join(";")),void 0!==s&&s.length>0&&[36,143,144,145].indexOf(o)<0&&(s=s.replace(/'/g,"\\'").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/,/g,"\\,"),s="STAGE"===i[0].data("colname")&&"none"!==s?Crm.getDealsStageValue(s):s),void 0!==s&&(s=2===o&&"-None-"===s?"":s,s=(32===o||38===o||52===o)&&isNaN(s)?"":s,l||(s=""===s&&$.inArray(o,r.decimalFldUITypeArr)>=0?0:s),isNaN(s)||""===s||(s=Number(s).toString()));var d=a;if(l)s||301===o?a=a.replace("${"+e+"}",""+s):"Date"!==n&&"DateTime"!==n&&(s=[32,34,36,38,39,40,52,77,143,144,145,117].indexOf(o)>=0?0:"",a=a.replace("${"+e+"}",""+s));else{var f=["*","/","%","^"];a=""!==s||"-"!==a.charAt(a.indexOf("${"+e+"}")-1)&&"+"!==a.charAt(a.indexOf("${"+e+"}")-1)?""===s&&(f.contains(a.charAt(a.indexOf("${"+e+"}")-1))||0===a.indexOf("${"+e+"}")&&f.contains(a.charAt(("${"+e+"}").length)))?a.replace("${"+e+"}",null):a.replace("${"+e+"}",""+s):"/"===a.charAt(a.indexOf("${"+e+"}")+("${"+e+"}").length)||"*"===a.charAt(a.indexOf("${"+e+"}")+("${"+e+"}").length)||"%"===a.charAt(a.indexOf("${"+e+"}")+("${"+e+"}").length)||"^"===a.charAt(a.indexOf("${"+e+"}")+("${"+e+"}").length)?a.replace("${"+e+"}",null):a.replace(a.charAt(a.indexOf("${"+e+"}")-1)+"${"+e+"}",s)}if(a===""+s&&"checkbox"!==i[0].attr("type"))return void $("#"+r.formulaVsFormulaField[d][0]).val(s).change()}else a="";return a},crmFormulaInit.prototype.executeRespectiveAggr=function(){var e=arguments[0],t=this,a=$(t),r=e.data.self,l=a.data(),i=l.label,s=null,o=l.subformdisplaylabel;if(o){s=(s=a.attr("id")).substring(0,s.lastIndexOf("_")+1);var n="${"+o+"."+i+"}"}else if(i)n="${"+t.id.split("_")[1]+"."+i+"}";else if(r.fixedIdVsElems[t.id])n="${"+l.module+"."+r.fixedIdVsElems[t.id]+"}";for(var u=r.getRelatedAggr(n),m=$("#multipleFieldsEditPop").is(":visible")?$("#multipleFieldsEditPop *"):$("*"),d=m.filter((function(){return this.id.match(new RegExp("^"+s+"+\\d+$"))})),f=u.length,g=0;g<f;g++){var p=u[g],c=p.substring(0,p.indexOf("(")),h=p.slice((c+"(${"+o).length+1,-2),F="";if(Crm.userDetails.isConditionalAggregateEnabled){var D=parseInt(a.attr("id").split("_")[4]);crmTemplate.subformData[D][i]=a.val();for(var v=(b=r.aggrVsAggrField[p]).length,I=0;I<v;I++){var x={isAgg:!0,fromNL:!0};x.aggrFun=c,x.aggFld=b[I],x.aggrFld=h,x.crtExp=r.aggrFieldVsaggrCrt[b[I]],x.userDetails=Crm.userDetails,x.subformData=crmTemplate.subformData,x.subfromFlds=crmTemplate.subformFldDetails,x.result=F,r.formulaWorker.postMessage(x)}}else{switch(c){case"SUM":case"AVG":var V=d.length;for(I=0;I<V;I++){var M=null;isNaN(d.eq(I).val())||(M=parseFloat(d.eq(I).val())),M&&(F=Number(F)+M),0===M&&(F=Number(F)+M)}if("AVG"==c&&""!==F){var A=d.length;F/=A}break;case"MIN":V=d.length;F=d.eq(0).val();for(I=0;I<V;I++){if(!isNaN(d.eq(I).val()))M=parseFloat(d.eq(I).val());M&&(F>M||0==F)&&(F=M),0===M&&(F=M)}break;case"MAX":V=d.length;F=d.eq(0).val();for(I=0;I<V;I++){if(!isNaN(d.eq(I).val()))M=parseFloat(d.eq(I).val());M&&F<M&&(F=M),0===M&&(F=M)}}var b;for(v=(b=r.aggrVsAggrField[p]).length,I=0;I<v;I++){var C=$("#"+b[I]),y=C.data().decimalLength,T=parseFloat(parseFloat(F).toFixed(y));Crm.userDetails.lineItemFormulaCalcFlow&&objectUtils.getKeys(Crm.userDetails.lineItemFormulaCalcFlow).length>0&&Crm.isInventoryModule(productDetails.module)&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module]&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module].aggrFields[C.data().colname]&&(T=productDetails.getRoundOffValue(F,!0)),isNaN(T)&&(T=""),C.val(T).change()}}}},crmFormulaInit.prototype.executeAggrWithoutFields=function(){for(x in this.fieldVsAggrMap){var e=x.substring(2,x.length-1),t=this.getDomForTag(e);t&&this.executeRespectiveAggr.call(t[0],{data:{self:this}})}};