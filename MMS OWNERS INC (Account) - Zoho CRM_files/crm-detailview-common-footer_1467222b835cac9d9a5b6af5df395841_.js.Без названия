Lyte.Component.register("crm-detailview-footer",{_template:'<template tag-name="crm-detailview-footer"> <template is="if" value="{{expHandlers(expHandlers(module,\'===\',\'Activities\'),\'!\')}}"><template case="true"> <div class="detailsfooter {{if(negate(isCanvas),\'mT20\',\'\')}}" tabindex="-1" lt-prop-landmark-label="{{getI18n(\'crm.landmark.comp\',\'crm.accessibility.record.management\')}}" role="complementary" lt-prop-landmark="true" aria-label="{{getI18n(\'crm.accessibility.record.management\')}}"> <div class="detailsfootercontainer pR20"> <div> <template is="if" value="{{showaddrelatedlist}}"><template case="true"> <div id="newRelatedListDiv" class="p10"> <input type="button" tabindex="{{if(isAccessibilityConfigSupported,\'0\',\'-1\')}}" aria-label="{{getI18n(&quot;crm.label.newCustomRelatedList&quot;)}}" class="primarybtn newbutton mL20" data-zcqa="detail_lead_addrelatedlist" value="{{getI18n(&quot;crm.label.newCustomRelatedList&quot;)}}" onclick="{{action(\'addNewRelatedList\')}}"> <input id="rlContentChngd" type="hidden" name="rlContentChngd" value="false"> </div> </template></template> </div> <template is="if" value="{{expHandlers(expHandlers(canvasAccessible,\'&amp;&amp;\',expHandlers(expHandlers(module,\'!==\',\'Campaigns\'),\'||\',expHandlers(feature,\'===\',\'FormView\'))),\'&amp;&amp;\',expHandlers(hideCanvasOptions,\'!\'))}}"><template case="true"> <div class="detailfooterswitch"> <template is="if" value="{{showCanvasOptions}}"><template case="true"> <div class="vline"></div> <template is="if" value="{{expHandlers(feature,\'===\',\'FormView\')}}"><template case="true"> <span class=" mR20 pR">{{getI18n(\'crm.canvas.create.form.page\')}}</span> </template><template case="false"> <span class=" mR20 pR">{{getI18n(\'crm.canvas.recordviews\')}}</span> </template></template> <template is="if" value="{{expHandlers(isrendered,\'||\',isCanvas)}}"><template case="true"> <crux-dropdown cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-aria-button="{&quot;aria-label&quot; : &quot;{{getI18n(&quot;crm.canvas.recordviews&quot;)}}&quot;}" cx-prop-maxsearch="5" id="detailviewswitch" class="mR20" data-zcqa="canvas_select_dd" on-option-select="{{method(\'viewchange\')}}" cx-prop-selected="{{currentview}}" on-before-show="{{method(\'onBeforeOpenCanvasViewDropdown\')}}" on-show="{{method(\'onOpenCanvasViewDropdown\')}}" cx-prop-options="{{canvasviewDropdown}}" cx-prop-user-value="name" cx-prop-system-value="id" cx-prop-position="up"></crux-dropdown> <div class="vline"></div> </template><template case="false"> <div class="w150"></div> </template></template> <template is="if" value="{{expHandlers(canvasCreate,\'&amp;&amp;\',expHandlers(hideCanvasOptions,\'!\'))}}"><template case="true"><template is="if" value="{{expHandlers(expHandlers(currentview,\'!==\',\'default\'),\'&amp;&amp;\',expHandlers(feature,\'!==\',\'FormView\'))}}"><template case="true"> <lyte-button class="crmLinkColor mR10 pR" data-zcqa="edit_canvas" onclick="{{action(\'editcanvas\',\'crm.settings.section.modules.module.canvas.edit\',module,layout,currentview,entity)}}" lt-prop-tabindex="{{if(isAccessibilityConfigSupported,\'0\',\'-1\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Edit\')}}</template> </lyte-button> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(feature,\'===\',\'FormView\'),\'&amp;&amp;\',expHandlers(currentview,\'!==\',\'default\'))}}"><template case="true"> <lyte-button class="crmLinkColor mR10 pR" data-zcqa="edit_canvas" onclick="{{action(\'editcanvas\',\'crm.settings.canvas.edit\',module,layout,currentview,entity)}}" lt-prop-tabindex="{{if(isAccessibilityConfigSupported,\'0\',\'-1\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Edit\')}}</template> </lyte-button> </template></template></template></template> <template is="if" value="{{isCanvas}}"><template case="true"> <crm-canvas-assignment is-selection-disabled="true" id="canvasbuilderassign" feature="{{feature}}" show="{{lbind(showAssignPopup)}}"></crm-canvas-assignment> <lyte-button class="crmLinkColor mR10 pR" data-zcqa="footer_assign_canvas" onclick="{{action(\'openCanvasAssignment\')}}" lt-prop-tabindex="{{if(isAccessibilityConfigSupported,\'0\',\'-1\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.assignment\',\'Canvas\')}}</template> </lyte-button> </template></template> <template is="if" value="{{expHandlers(viewsCount,\'<\',maxViewLimit)}}"><template case="true"> <lyte-button lt-prop-aria="{{isAccessibilityConfigSupported}}" lt-prop-aria-button="{\'aria-label\' : \'{{getI18n(\'crm.canvas.createcanvaspage\')}}\' }" class="crmLinkColor mR20 pR" data-zcqa="create_canvas" onclick="{{action(\'showGalleryPopup\')}}" lt-prop-tabindex="{{if(isAccessibilityConfigSupported,\'0\',\'-1\')}}"> <template is="if" value="{{expHandlers(feature,\'===\',\'FormView\')}}"><template case="true"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.formview.create\')}}</template> </template><template case="false"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.createcanvaspage\')}}</template> </template></template> </lyte-button> </template></template> <div class="vline"></div> </template></template> </template></template> <template is="if" value="{{expHandlers(currentview,\'!==\',\'default\')}}"><template case="true"> <span><lyte-checkbox data-zcqa="fit_to_screen" lt-prop-name="fixed" lt-prop-checked="true" lt-prop-value="val" lt-prop-id="fixed" lt-prop-label="{{getI18n(\'crm.layout.fit.to.screen\')}}" on-checked="{{method(\'changeTofluid\')}}" on-unchecked="{{method(\'changeTofixed\')}}" id="zcFitscreen"> </lyte-checkbox> </span> </template></template> </div> </template></template> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[]}},default:{}},{type:"attr",position:[7]},{type:"if",position:[7],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"attr",position:[4]},{type:"if",position:[4],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1],dynamicNodes:[{type:"text",position:[0]}]}]},false:{dynamicNodes:[{type:"registerYield",position:[1],dynamicNodes:[{type:"text",position:[0]}]}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}],_observedAttributes:["showaddrelatedlist","module","layout","entity","canvasview","canvasviewDropdown","cscriptconfig","currentview","viewsCount","maxViewLimit","canvasAccessible","canvasCreate","showAssignPopup","isrendered","isCanvas","feature","form_type","viewSwitch","showCanvasOptions","isAccessibilityConfigSupported","cscriptHideValue"],data:function(){return{showaddrelatedlist:Lyte.attr("boolean"),module:Lyte.attr("string"),layout:Lyte.attr("string"),entity:Lyte.attr("string"),canvasview:Lyte.attr("array"),canvasviewDropdown:Lyte.attr("array",{default:[]}),cscriptconfig:Lyte.attr("object",{default:{}}),currentview:Lyte.attr("string",{default:"default"}),viewsCount:Lyte.attr("number"),maxViewLimit:Lyte.attr("number"),canvasAccessible:Lyte.attr("boolean",{default:!0}),canvasCreate:Lyte.attr("boolean",{default:Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM}),showAssignPopup:Lyte.attr("boolean"),isrendered:Lyte.attr("boolean",{default:!1}),isCanvas:Lyte.attr("boolean",{default:!1}),feature:Lyte.attr("string"),form_type:Lyte.attr("string"),viewSwitch:Lyte.attr("boolean",{default:!1}),showCanvasOptions:Lyte.attr("boolean",{default:!("undefined"!=typeof clientPortalName&&Crm.userDetails.CLIENTPORTAL_FOOTER_HIDING)}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),cscriptHideValue:Lyte.attr("string")}},didConnect:function(){if(app&&app.isMenuless||Crm.userDetails.CANVAS_SPECIAL_HANDLING_ORG&&!Crm.userDetails.IS_ADMIN)$(this.$node).addClass("dNImp");else{var t="FormView"===this.getData("feature"),e=t?$(".crm-canvas-forms-container"):$("#detailview"),a=this.getData("layout"),i=this.getData("module");this.isTeamModulehasAccess(moduleRecordMapping[i])&&this.setData("canvasCreate",!0);var o=["Visits","Activities","Tasks","Events","Calls","Services__s","Appointments__s","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"];"DetailView"===this.getData("feature")&&Lyte.arrayUtils(o,"removeObjects",["Tasks","Events","Calls","Services__s","Appointments__s"]);var s=!(o.indexOf(moduleRecordMapping[i].api_name)>0||Crm.userDetails.RTL_ENABLED);if(this.setData("canvasAccessible",s),!store.peekAll("module").filter((function(t){return-1!==o.indexOf(t.api_name)&&t.api_name===moduleRecordMapping[i].api_name})).length){var n=this.getData("canvasview"),r=this.getData("currentview"),l=this.getData("isCanvas"),c=n?n.length:0;this.setData("viewsCount",c);var d=store.peekRecord("canvasview",r),p="FormView"===this.getData("feature")?"FormviewCustomization":"detailview_customization";if(0===c&&d){var m=[];m.push(d),this.setData("canvasviewDropdown",m);var u="DetailView"===this.getData("feature")?"detailview_customization":"FormviewCustomization",y=store.peekRecord("features",u);if(y){var v=y.details.limits.total,f=y.details.used_count.total;this.setData("maxViewLimit",v),this.setData("viewsCount",f)}else this.setData("viewsCount",m.length)}if(d&&d.ui&&d.ui.value){var h=d.ui.value.fixed;e.css({width:d.ui.value.position.width})}if(""==a&&"detail"==Lyte.Router.getRouteInstance().routeName&&returnJson&&returnJson.layout_jsonarrayObj&&returnJson.layout_jsonarrayObj.currLayoutId&&(a=returnJson.layout_jsonarrayObj.currLayoutId,this.setData("layout",a)),!l&&a)store.findAll("features",{api_names:p,module:moduleRecordMapping[i].api_name},!0,!0).then(function(t){var e=t[0]?t[0].details.limits.total:0,a=t[0]?t[0].details.used_count.total:0;this.setData("maxViewLimit",e),this.setData("canvasview",[]),this.setData("viewsCount",a),this.constructDropdownArray(),this.setData("isrendered",!0)}.bind(this));else{var g=this.getData("canvasview"),C=this.getData("viewsCount");this.setData("viewsCount",C||0),g&&a&&(g=g.filter((function(t){return t.layout&&t.layout.id===a})),this.setData("canvasview",g),this.constructDropdownArray())}h?($L("#zcFitscreen").attr("lt-prop-checked",!1),e.removeClass("fluidlayout"),t&&$L(".zc-page-component").removeClass("fluidlayout")):(e.addClass("fluidlayout"),t&&$L(".zc-page-component").addClass("fluidlayout")),"FormView"===this.getData("feature")&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-formview-mixin.js"],ResourceConstants.CRMClient))}}},openCanvasAssignment:function(t){var e=networkUtils.returnDependencyFiles(["crm-canvas-builder.js","user_type.js","crm-detail-view-utils.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-canvas-builder.css"],ResourceConstants.CRMClient);this._track("Assign"),Lyte.injectResources([e,a]).then(function(){var e=document.querySelector("#canvasbuilderassign");if(e){var a=this.getData("layout"),i=this.getData("module"),o=store.peekRecord("module",moduleRecordMapping[i].id),s=o.module_name,n=[{name:o.plural_label,id:o.module_name}],r=o.layouts.filterBy({id:a});e.setData({modules:n,layouts:r,selectedLayout:a}),e.setData("selectedModule",s),e.setData("isfromfooter",t),e.component.updatepopup(e.component,a,!0)}}.bind(this))},hideViews:function(t){var e=$u.clone(this.getData("cscriptconfig").views);if(e){var a=-1;e.map((function(e,i){e.id===t&&(a=i)})),a>-1&&e.splice(a,1),this.setData("canvasviewDropdown",e)}this.setData("cscriptHideValue",t)},actions:{openCanvasAssignment:function(){this.openCanvasAssignment()},editcanvas:function(t,e,a,i,o){this._track("Edit"),Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()?openNewTab(Lyte.Router.getURL(t,i),"canvas","get",{module:e,feature:"FormView",layoutId:a},!0):openNewTab(Lyte.Router.getURL(t,e,a,i),"canvas","get",{id:o,feature:"DetailView"},!0)},showGalleryPopup:function(){store.clearCachedQuery("features");var t=this.getGalleryResources();if("FormView"===this.getData("feature")){var e=this.getData("module"),a=this.getData("layout");Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-form-view-canvas-gallery",{menuType:"all",showGallery:!0,module:e,featureName:"FormView",defaultShrinkMode:!0,inBuilder:!1,layoutId:a,from:"footer"},"#show")}))}else Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-detailview-canvas-gallery",{},"#show")}))},addNewRelatedList:function(){CustomRelatedListObj.addNewRelatedList({module:this.getData("module")})}},getGalleryResources:function(){var t=networkUtils.returnDependencyFiles(["crux-textautocomplete-options.js","crm-footer-gallery.js","crm-detailview-canvas-gallery.js","crm-detailview-canvas-utils.js","crm-canvas-import-button.js","crm-canvasform.js","custom_link_model.js","crm-detailcanvas-utils.js","crm-canvas-listview.js","crm-canvas-core-builder.js","crm-canvas-core.js","crm-formview-mixin.js"],ResourceConstants.CRMClient);return t=(t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")],ResourceConstants.CRM))).concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat(networkUtils.returnDependencyFiles(["crm-canvas-export.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-detailview-canvas-gallery.css"],ResourceConstants.CRMClient))).concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-formview-canvas-gallery.css","crm-listview-canvas-gallery.css","crm-canvas-export.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)}])).concat(networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css"],ResourceConstants.CRMClient)),"FormView"===this.getData("feature")&&(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["canvas-formview-editor.css","crux-boolean-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),"Events"===this.getData("module")&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-detail-view-initial-files.js"],ResourceConstants.CRMClient))),t},createnewcanvas:function(t,e,a,i){openNewTab(Lyte.Router.getURL(t,e,a),"canvas","get",{id:i},!0)},_track:function(t,e){var a=this.getData("isCanvas")?"Customized":"Standard";e||(e={}),e.Module=this.getData("module"),Crm.client_tracking("CanvasDetailPage - "+a+" - "+t,e)},methods:{viewchange:function(t,e){var a=this.getData("module"),i=this.getData("layout"),o=this.getData("entity");if(this.getData("currentview")!==e){if(("FormView"===this.getData("feature")?Lyte.registeredMixins["crm-formview-mixin"].checkRecordModificationStatus():void 0)&&"FormView"===this.getData("feature")){this.setData("viewSwitch",!0);var s=document.querySelector("#layoutSwitch");return s.ltProp("transition",{animation:"slideFromTop",duration:"0"}),s.ltProp("showCloseButton",!1),void s.ltProp("show",!0)}if("FormView"===this.getData("feature")){var n=this.getData("form_type");switch(n||(n="crm.tab.module.create"===Lyte.Router.getRouteInstance().transition.info.route?"form_create":"crm.tab.module.entity.edit"===Lyte.Router.getRouteInstance().transition.info.route?"form_edit":"form_clone"),n){case"form_create":if("default"===e)this.goToFormDefault(a,o,i,n);else{var r="create";this.updateDefaultCanvas(a,o,e,r)}break;case"form_edit":if("default"===e)this.goToFormDefault(a,o,i,n);else{r="edit";o=o||Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),this.updateDefaultCanvas(a,o,e,r)}break;case"form_clone":if("default"===e)this.goToFormDefault(a,o,i,n);else{r="clone";o=o||Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),this.updateDefaultCanvas(a,o,e,r)}}}else if("create"==e){r="crm.settings.section.modules.module.canvas.create";this.createnewcanvas(r,a,i,o),document.getElementById("detailviewswitch").setData("ltPropSelected",this.getData("currentview"))}else"default"==e?this.gotodefault(a,o):this.updateDefaultCanvas(a,o,e)}},changeTofixed:function(){var t="FormView"===this.getData("feature"),e=t?$(".crm-canvas-forms-container"):$("#detailview");t&&$L(".zc-page-component").removeClass("fluidlayout"),e.removeClass("fluidlayout"),this._track("Fixed")},changeTofluid:function(){var t="FormView"===this.getData("feature"),e=t?$(".crm-canvas-forms-container"):$("#detailview");t&&$L(".zc-page-component").addClass("fluidlayout"),e.addClass("fluidlayout"),this._track("Fluid")},onBeforeOpenCanvasViewDropdown:function(){var t=this,e=this.getData("layout");return Lyte.resolvePromises({views:store.findAll("canvasview",{module:moduleRecordMapping[this.getData("module")].api_name,feature:this.getData("feature")},!1,!1)}).then((function(a){var i=a.views.canvasview,o=i?i.length:0,s=t.getData("isCanvas");t.setData("viewsCount",o),i&&e&&(i=i.filter((function(t){return t.layout&&t.layout.id===e})),t.setData("canvasview",i)),s||i||t.setData("canvasview",[]),t.constructDropdownArray(),t.setData("isrendered",!0),t.data.cscriptHideValue&&t.hideViews(t.data.cscriptHideValue),$L("#detailviewswitch").find("lyte-dropdown")[0].resetPosition()}))},onOpenCanvasViewDropdown:function(){var t=this.getData("currentview");this.setData("currentview",void 0),this.setData("currentview",t)}},createnewcanvas:function(t,e,a,i){var o=this.getData("canvasCreate"),s=this.getData("canvasAccessible");this._track("Create"),o&&s&&openNewTab(Lyte.Router.getURL(t,e,a),"canvas","get",{id:i},!0)},editcanvas:function(t,e,a,i,o){var s=this.getData("canvasCreate"),n=this.getData("canvasAccessible");this._track("Edit"),s&&n&&openNewTab(Lyte.Router.getURL(t,e,a,i),"canvas","get",{id:o},!0)},goToFormDefault:function(t,e,a,i){const o=Lyte.Router.getRouteInstance().transition;switch((o.data||(o.data={})).skipDirtyCheck=!0,i){case"form_create":Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[t],queryParams:{layoutId:a,redirect:"false",assignment:"false"}}).data=Lyte.Router.getRouteInstance().transition.data;break;case"form_edit":var s=e||Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit",dynamicParams:[t,s],queryParams:{layoutId:a,redirect:"false"}}).data=Lyte.Router.getRouteInstance().transition.data;break;case"form_clone":s=e||Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();Lyte.Router.transitionTo({route:"crm.tab.module.entity.clone",dynamicParams:[t,s],queryParams:{layoutId:a,redirect:"false"}}).data=Lyte.Router.getRouteInstance().transition.data}},gotodefault:function(t,e){if(crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex)var a=crmNavig[crmNavig.customViewKey].recordId.map((function(t){return t.id})).indexOf(e);this._track("Switch to Default"),a&&a>0?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[t,e],queryParams:{redirect:"false"},target:"_blank"}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:a,cvid:customViewObject.cvId,fromDel:!1,navig:!0}:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[t,e],queryParams:{redirect:"false"},target:"_blank"})},updateDefaultCanvas:function(t,e,a,i){if(this.getData("currentview")!==a)if(this._track("Switch to Canvas"),"FormView"!==this.getData("feature")){var o={recordNum:$("#recordNum").val()},s=Lyte.Router.getRouteInstance().transition.data;s.stageId&&s.cvid&&(o.stageId=s.stageId,o.cvid=s.cvid),Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[t,e,a]}).data=o}else{const o=Lyte.Router.getRouteInstance().transition;switch((o.data||(o.data={})).skipDirtyCheck=!0,i){case"create":Lyte.Router.transitionTo({route:"crm.tab.module.create.canvas",dynamicParams:[t,a],queryParams:{layoutId:this.getData("layout")}}).data=Lyte.Router.getRouteInstance().transition.data;break;case"edit":Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit.canvas",dynamicParams:[t,e,a],queryParams:{layoutId:this.getData("layout")}}).data=Lyte.Router.getRouteInstance().transition.data;break;case"clone":Lyte.Router.transitionTo({route:"crm.tab.module.entity.clone.canvas",dynamicParams:[t,e,a],queryParams:{layoutId:this.getData("layout")}}).data=Lyte.Router.getRouteInstance().transition.data}}},setDropdownvalue:function(){this.getData("currentview")},isTeamModulehasAccess:function(t){return!t||("team_based"===t.access_type?t.private_profile&&"Admins"===t.private_profile.name||Crm.userDetails.IS_ADMIN:t.viewable&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM)},constructDropdownArray:function(){var t=[{"data-value":"default",name:I18n.getMsg("crm.standard.view"),id:"default"}],e=this.getData("canvasview");e=e&&e.length>0?e.filter((function(t){return 1===t.canvas_enabled})):[],t=t.concat(e),this.setData("canvasviewDropdown",t);var a=this.getData("cscriptconfig");a&&(a.views=t)}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Component.register("crm-detail-view-common",{_template:'<template tag-name="crm-detail-view-common"> <lyte-modal id="closeTaskPopup" lt-prop-wrapper-class="crmBoxModal" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-yield="true" lt-prop-show-close-button="false" on-close="{{method(\'onTaskClose\')}}" lt-prop-max-width="650px"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="crm-font-regular w100_per aligncenter"> {{getI18n(\'crm.confirm.close.task\')}} <template is="if" value="{{notifyOwnerCloseTask}}"><template case="true"> <div class="aligncenter"> <lyte-checkbox id="notifyOwnerCloseTaskId" lt-prop-checked="false" lt-prop-id="checkbox" lt-prop-label="{{getI18n(\'crm.form.owner.notification\')}}"></lyte-checkbox> </div> </template></template> </lyte-modal-header> <lyte-modal-footer class="center"> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'closeTask\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.mark.completed\')}} </template> </lyte-button> <lyte-button onclick="{{action(\'cancelTaskPopUp\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <div class="mT10"> ( <lyte-checkbox id="taskPopupCheckBoxId" lt-prop-checked="false" lt-prop-id="checkbox" lt-prop-label="{{getI18n(\'crm.zohosocial.never.show\')}}" on-changed="{{method(\'closeTaskDontShow\')}}"></lyte-checkbox> ) </div> </lyte-modal-footer> </template> </lyte-modal> <lyte-modal id="removeParticipantPopup" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-yield="true" lt-prop-show-close-button="false" lt-prop-max-width="650px"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="crm-font-regular aligncenter w100_per">{{removeParticipantTitle}}</lyte-modal-header> <lyte-modal-footer class="center"> <lyte-button lt-prop-appearance="failure" onclick="{{action(\'removeParticipantButton\')}}" data-zcqa="PupHome_button_notifybtn"> <template is="registerYield" yield-name="text"> {{removeParticipantButtonTitle}} </template> </lyte-button> <template is="if" value="{{showDontNotifyButton}}"><template case="true"> <lyte-button lt-prop-appearance="default" onclick="{{action(\'removeParticipantButton\',expHandlers(1,\'-\'))}}" data-zcqa="PupHome_button_dontnotifybtn"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.event.btn.dnt.notify.part.singular\')}} </template> </lyte-button> </template></template> <span class="crmLinkColor mL5 cP" data-zcqa="PupHome_cancelremovebtn" onclick="{{action(\'cancelParticpant\')}}">{{getI18n(\'crm.button.cancel\')}}</span> </lyte-modal-footer> </template> </lyte-modal> <lyte-menu lt-prop-yield="true" lt-prop-event="click" lt-prop-query="lyte-th.sortRelated > span" on-menu-click="{{method(\'sortRecord\')}}" on-before-open="{{method(\'sortButtonDisplay\')}}" data-zcqa="sort_div" lt-prop-freeze="true"> <template is="registerYield" yield-name="yield"> <lyte-menu-body id="sort_div" class="crmSortMenu"> <template is="for" items="{{sortDetails}}" item="order" index="index"> <lyte-menu-item data-value="{{order}}" data-zcqa="sorting_{{order}}" class="dvsortItemMenu"> <template is="if" value="{{expHandlers(order,\'==\',&quot;unsort&quot;)}}"><template case="true"> <span class="zcicncss-close zcicn-cssIcons"></span> {{getI18n("crm.column.unsort")}} </template><template case="false"> {{getI18n(concat("crm.column.sort.",order))}} </template></template><template is="if" value="{{ifAnyMatch(order,\'=\',\'asc\',order,\'=\',\'desc\')}}"><template case="true"> <span class="zcicncss-arrowasc zcicn-cssIcons {{if(ifEquals(order,\'asc\'),\'\',\'zcicn-rotate-180\')}}"></span> </template></template> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <div id="columnList" style="display:none;position:fixed;z-index:2" onclick="{{action(\'stopEvent\')}}"></div> <div id="viewcontainer"></div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5,1]},{type:"componentDynamic",position:[3,5,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,5]},{type:"text",position:[3,5,0]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[3]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"attr",position:[1,2]},{type:"if",position:[1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]}],_observedAttributes:["sortDetails","sortRelatedId","taskId","recordName","removeParticipantButtonTitle","showDontNotifyButton","dontShowPopup","notifyOwnerCloseTask"],data:function(){return{sortDetails:Lyte.attr("array"),sortRelatedId:Lyte.attr("string"),taskId:Lyte.attr("string"),recordName:Lyte.attr("string"),removeParticipantButtonTitle:Lyte.attr("string"),showDontNotifyButton:Lyte.attr("boolean"),dontShowPopup:Lyte.attr("boolean",!1),notifyOwnerCloseTask:Lyte.attr("boolean",{default:!1})}},init:function(){if(!Crm.userDetails.isRelatedListLyteEnabled){var t=this;["Tasks","Events","Calls","Open_Appointments__s"].forEach((function(e){var a=t.getPersonalityByRelation(e).toLocaleLowerCase();crmRelatedList.personalityArr||(crmRelatedList.personalityArr=a)}))}},methods:{closeTaskDontShow:function(t){this.setData("dontShowPopup",t.checked)},sortButtonDisplay:function(t,e,a){var i=a&&a.parentElement?a.parentElement:void 0;if(i){var o,s;try{if(Crm.userDetails.isRelatedListLyteEnabled){if(this.getData("sortInprogress"))return!1;if(this.sortComp=e.target.closest("crm-related-list-view-header").component,!this.sortComp.data.relatedList.customize_sort)return!1;o=this.sortComp.data.relatedListFields.filter((t=>t.id===i.id))[0];var n=store.peekRecord("field",o.id);if(o=n||o,"Invited_Events"===this.sortComp.getData("relatedList.api_name")&&"Status"===o.api_name||o.crypt&&"encryption"===o.crypt.mode||96===o.ui_type||o.ui_type===CrmFieldConstants.WIZARD||"Appointment_For"===o.api_name||o.ui_type===CrmFieldConstants.TEXTAREA||o.ui_type===CrmFieldConstants.TERRITORY||o.ui_type===CrmFieldConstants.LAYOUT||o.ui_type===CrmFieldConstants.TEXTAREA1||o.ui_type===CrmFieldConstants.TEXT||o.ui_type===CrmFieldConstants.TAGS)return!1;s=this.sortComp.data.sort_by===o.api_name?"asc"===this.sortComp.data.sort_order?["desc","unsort"]:"desc"===this.sortComp.data.sort_order?["asc","unsort"]:["asc","desc"]:["asc","desc"],this.setData("sortDetails",s)}else{if(this.sortComp=e.path.filter((t=>"CRM-RELATED-LIST-VIEW-HEADER"==t.tagName))[0].component,!this.sortComp.data.relatedList.customize_sort)return!1;this.setData("sortDetails",this.sortComp.data.sortDetails),o=this.sortComp.data.relatedListFields.filter((t=>t.id==i.id))[0]}}catch(t){o=store.peekRecord("field",i.id)}return!(o&&(3==o.ui_type||999==o.ui_type||208==o.ui_type||110==o.ui_type||1e3==o.ui_type||209==o.ui_type)||"Visits"==this.getData("module")&&"SEID"==o.column_name||"Dealhistory"==this.getData("relatedModule"))}},sortRecord:function(t){this.setData("sortInprogress",!0),this.sortComp.sortRecord(t,this)},onTaskClose:function(){this.getData("dontShowPopup")&&$L("#taskPopupCheckBoxId").attr("lt-prop-checked",!1)}},actions:{closeTask:function(){this.getData("dontShowPopup")&&localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0);var t=this.closeTaskComp;if(t){$("#deletepopup").css("visibility","visible");var e=Crm.getCrmBasePath()+"/closeTask.do?action=CloseTask&taskid="+t.component.data.record.id+"&&module="+t.component.data.fromModule+"&id="+t.component.data.fromRecord.id+"&nextStep=relatedlist&isajax=true#"+t.component.data.relatedList.personality_name+"_"+t.component.data.relatedList.id;this.data.notifyOwnerCloseTask&&this.$node.querySelector("#closeTaskPopup").component.childComp.querySelector("#notifyOwnerCloseTaskId").ltProp("checked")&&(e+="&isNotifyOwnerChecked="+!0),Crm.userDetails.isRelatedListLyteEnabled?this.sortRelatedList(e,null,t.component.data.record.id,void 0,!0):sortRelatedList(e,null,t.component.data.record.id,void 0,!0)}else this.updateCloseTask();this.$node.querySelector("#closeTaskPopup").ltProp("show",!1),this.closeTaskComp=void 0},cancelTaskPopUp:function(){this.$node.querySelector("#closeTaskPopup").ltProp("show",!1)},removeParticipantButton:function(t){for(var e=Lyte.deepCopyObject(this.data.event.Participants),a=e.length,i=0;i<a;i++)if(e[i].participant==this._record.id){Lyte.arrayUtils(e,"removeAt",i);break}Crm.userDetails.isRelatedListLyteEnabled&&!this.data.event.$.model.fieldList.$delete_send_notification&&store.addField(moduleRecordMapping.Events.id,"$delete_send_notification","boolean"),this.data.event.$.set("Participants",e),this.data.event.$.set("$delete_send_notification",-1!=t),this.data.event.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:"Events"})})),this.$node.querySelector("#removeParticipantPopup").ltProp("show",!1)},cancelParticpant:function(){this.$node.querySelector("#removeParticipantPopup").ltProp("show",!1)}},getPersonalityByRelation:function(t){switch(t){case"Tasks":case"Calls":case"Events":return t.toUpperCase()+"PERSONALITY";case"Tasks_History":case"Events_History":case"Calls_History":return t.replace("_","").toUpperCase()+"PERSONALITY";case"Open_Appointments__s":return"APPOINTMENTSPERSONALITY";case"Appointments_History__s":return"APPOINTMENTSHISTORYPERSONALITY"}},closeTask:function(t,e){this.setData("taskId",t),this.closeTaskComp=e;var a=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof a&&(a="true"===a),a?(e?($("#deletepopup").css("visibility","visible"),Crm.userDetails.isRelatedListLyteEnabled?this.sortRelatedList(Crm.getCrmBasePath()+"/closeTask.do?action=CloseTask&taskid="+e.component.data.record.id+"&&module="+e.component.data.fromModule+"&id="+e.component.data.fromRecord.id+"&nextStep=relatedlist&isajax=true#"+e.component.data.relatedList.personality_name+"_"+e.component.data.relatedList.id,null,e.component.data.record.id):sortRelatedList(Crm.getCrmBasePath()+"/closeTask.do?action=CloseTask&taskid="+e.component.data.record.id+"&&module="+e.component.data.fromModule+"&id="+e.component.data.fromRecord.id+"&nextStep=relatedlist&isajax=true#"+e.component.data.relatedList.personality_name+"_"+e.component.data.relatedList.id,null,e.component.data.record.id)):this.updateCloseTask(),this.closeTaskComp=void 0):(this.setData("notifyOwnerCloseTask",store.peekRecord(moduleRecordMapping.Tasks.id,t)&&store.peekRecord(moduleRecordMapping.Tasks.id,t).Owner.id!==Crm.userDetails.USER_ID),this.$node.querySelector("#closeTaskPopup").ltProp("show",!0))},updateCloseTask:function(){var t,e=store.peekRecord(moduleRecordMapping.Tasks.id,this.getData("taskId")),a=store.peekAll("field").filter((function(t){return"Status"===t.api_name&&t.module&&t.module[0]&&("Activities"===t.module[0].api_name||"Tasks"===t.module[0].api_name)}))[0];if(a){if(t=a.pick_list_values.filter((function(t){return"Completed"===t.actual_value}))[0].display_value,e.$.set("Status",t),e.$.isError)for(var i in e.$.error)e.$.set(i,e[i]);e.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:Crm.isActivitySplitDone?"Tasks":"Activities"})}),(function(){renderingUtils.displayPermissionDenied()}))}else store.findRecord("module",moduleRecordMapping.Tasks.id,void 0,void 0,void 0,{getFields:!0}).then((function(){a=store.peekAll("field").filter((function(t){return"Status"===t.api_name&&t.module&&t.module[0]&&("Activities"===t.module[0].api_name||"Tasks"===t.module[0].api_name)}))[0],t=a.pick_list_values.filter((function(t){return"Completed"===t.actual_value}))[0].display_value,e.$.set("Status",t),e.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:Crm.isActivitySplitDone?"Tasks":"Activities"})}),(function(){renderingUtils.displayPermissionDenied()}))}))},showSortDropdown:function(t){this.sortComp=t,this.setData("sortDetails",t.data.sortDetails)},removeParticipant:function(t,e,a){this.setData("recordName",t),this.setData("event",e),this._record=a,null==store.modelFor(moduleRecordMapping.Events.id).fieldList.Participants&&store.addField(moduleRecordMapping.Events.id,"Participants","array");var i=e.Start_DateTime,o=Crm.userDetails.DATE_PATTERN.toUpperCase(),s=Crm.userDetails.TIME_FORMAT;(i.indexOf("AM")>1||i.indexOf("PM")>1)&&(s=s.replace("a","A")),o+=" "+s,new Date>$L.moment(e.Start_DateTime,o).getDObj()?(this.setData("removeParticipantTitle",I18n.getMsg("crm.label.event.remove.participant.message",[t,e.Event_Title,I18n.getMsg("crm.module.singularLabel.event")])),this.setData("removeParticipantButtonTitle",I18n.getMsg("crm.label.event.remove.participant",t)),this.setData("showDontNotifyButton",!1)):(this.setData("removeParticipantTitle",I18n.getMsg("crm.label.event.remove.alert",[t,e.Event_Title])),this.setData("removeParticipantButtonTitle",I18n.getMsg("crm.event.btn.notify.part.singular")),this.setData("showDontNotifyButton",!0)),this.$node.querySelector("#removeParticipantPopup").ltProp("show",!0)},openColumnList:function(t,e){this.columnComp=t;var a=this,i=e||!1,o=this.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(this.columnComp.data.relatedList.personality_name)?"openActivities_btn":this.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(this.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null,s=$L("crm-column-list"),n="#"+this.columnComp.data.btn_name+"_ul";if(0==s.length){if(null!==o){var r=Crm.userDetails.RTL_ENABLED?"right":"left";s.push(Lyte.Component.render("crm-column-list",{module:t.getData("relatedModule"),placement:r,from:"detailView",relatedList:t.getData("relatedList")},n))}else s.push(Lyte.Component.render("crm-column-list",{module:t.getData("relatedModule"),from:"detailView",relatedList:t.getData("relatedList")},"#columnList"));i=!0}else s[0].setData({module:t.getData("relatedModule"),from:"detailView",relatedList:t.getData("relatedList")});s[0].setMethods({onSaveCustomView:function(t,e){a.columnComp.saveColumnList(t,e)},columnResize:function(t){t&&t.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1);var e=$L("#columnListId");Crm.userDetails.isRelatedListLyteEnabled&&(o=a.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"openActivities_btn":a.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null);var i,s=null===o?$L("#customizeList"+a.columnComp.data.relatedList.id):$L("#"+o);if(window.innerHeight/2+50>s[0].getBoundingClientRect().bottom){i=window.innerHeight-(s[0].getBoundingClientRect().bottom+60);var n=$L("#wmstoolbar");n.outerHeight()&&(i-=n.outerHeight())}else i=s[0].getBoundingClientRect().top-103;var r=30*t.length+80;i>(r=t&&t.length?r:149)&&(i=r),i=i>350?350:i,Crm.userDetails.isRelatedListLyteEnabled&&o&&!$("#customize_error")[0].classList.contains("dN")?e.css({"max-height":i-30}):e.css({"max-height":i})},beforePopoverShow:function(){var t=[];a.columnComp.data.relatedList.fields.forEach((function(e,a){t[a]={},t[a].api_name=e.api_name,t[a].id=e.id})),this.setData({ordered_fields1:this.data.ordered_fields,selected_fields1:t}),this.callcleasrselectedFields&&($L("crux-column-list")[0].component.clearSelectedFields(),this.callcleasrselectedFields=!1);var e=$L("crm-column-list lyte-popover")[0];if(null!==(a.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"openActivities_btn":a.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null)){var i="#"+a.columnComp.data.btn_name+"_ul",o=Crm.userDetails.RTL_ENABLED?"right":"left";e.setData("ltPropOriginElem",i),e.setData("ltPropPlacement",o)}else e.setData("ltPropOriginElem","#customizeList"+a.columnComp.data.relatedList.id);this._resize()},onColumnListResize:function(){var t=$L("#columnListId"),e=a.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"openActivities_btn":a.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(a.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null,i=null===e?$L("#customizeList"+a.columnComp.data.relatedList.id):$L("#"+e),o=$L("#columnListId lyte-menu-item:not(.lyteSearchHidden)");if(o&&o.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1),t.length){var s;if(window.innerHeight/2+50>i[0].getBoundingClientRect().bottom){s=window.innerHeight-(i[0].getBoundingClientRect().bottom+60);var n=$L("#wmstoolbar");n.outerHeight()&&(s-=n.outerHeight())}else s=i[0].getBoundingClientRect().top-80;var r=30*o.length+80;s>(r=o&&o.length>0?r:149)&&(s=r),s=s>350?350:s,e&&!$("#customize_error")[0].classList.contains("dN")?t.css({"max-height":s-30}):t.css({"max-height":s})}var l=$L("crm-column-list lyte-popover")[0];if(l){var c=l.component.childComp.querySelector("lyte-popover-content");$L.fastdom.measure((function(){if(Crm.userDetails.isRelatedListLyteEnabled){var t=c.getBoundingClientRect().width;$L.fastdom.mutate((function(){t&&(c.style.width=t+"px")}))}else{t=c.getBoundingClientRect().width+"px";$L.fastdom.mutate((function(){c.style.width=t}))}}))}},getColumnListFields:function(t,e,i){if(Crm.userDetails.isRelatedListLyteEnabled){var o=a.columnComp.getColumnListData(t);if(o&&i&&"detailView"===i.getData("from")){var s=i.getData("relatedList.fields");o.filter((function(t){if(t.mandatory)if("Name"===t.api_name&&(t.cxPropClass="cxFieldDisabledCursor"),"Leads"===e||"Contacts"===e){var a=moduleRecordMapping[e].fields,i=a.filterBy({api_name:"Last_Name"})[0].id,o=a.filterBy({api_name:"Full_Name"})[0].id,n=s.filter((function(t){return t.id===i})),r=s.filter((function(t){return t.id===o}));t.id!==i&&t.id!==o?t.cxPropClass="cxFieldDisabledCursor":n.length&&r.length||!(n.length&&t.id===i||r.length&&t.id===o)||(t.cxPropClass="cxFieldDisabledCursor")}else t.cxPropClass="cxFieldDisabledCursor"}))}return o}return a.columnComp.getColumnListData(t)}}),i&&s[0].component.callForArrangement(),$L("#newPopup")[0].ltProp("show",!0)}},{mixins:["crm-stop-event","crm-related-list-utils"]});
