Lyte.Component.register("crm-multiuserdd-wrapper",{_template:'<template tag-name="crm-multiuserdd-wrapper"> <template is="if" value="{{isRoleComponent}}"><template case="true"> <crux-role-component cx-prop-zcqa="{{zcqa}}" class="roles_comp" cx-prop-max-count="5" cx-prop-id="_id_{{zcqa}}" cx-prop-logged-in-user-role-required="{{expHandlers(if(ifEquals(roleRequestModel,\'role\'),\'true\',\'false\'),\'&amp;&amp;\',expHandlers(fromTerritory,\'!\'))}}" cx-prop-request-model="{{roleRequestModel}}" cx-prop-show-lookup-icon="false" dropdown-selected="{{lbind(selectedRoles)}}" selected-ids="{{lbind(usersRecord)}}" cx-prop-value="{{lbind(roleRecords)}}"></crux-role-component> </template><template case="false"> <crux-user-dropdown id="userDropdown" cx-prop-query-param="{{queryparam}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-login-user-required="{{liteUserReq}}" cx-prop-zcqa="{{zcqa}}" cx-prop-selected-users="{{lbind(usersRecord)}}" cx-prop-selected="{{lbind(selectedUsers)}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-filter-selected="ActiveUsers" cx-prop-type="multiple" on-user-remove="{{method(&quot;onUserAddOrRemove&quot;)}}" on-user-add="{{method(&quot;onUserAddOrRemove&quot;)}}" cx-prop-is-subordinate="{{isSubordinateListing}}"></crux-user-dropdown> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["selectedIds","selectedUsers","selectedNames","usersRecord","placeholder","fieldId","zcqa","filterable","filterOptions","filterUservalue","filterSystemvalue","queryparam","liteUserDetails","normalUserDetails","liteUserReq","isSubordinateListing","isRoleComponent","roleRequestModel","fromTerritory","roleRecords","selectedRoles"],data:function(){return{selectedIds:Lyte.attr("string"),selectedUsers:Lyte.attr("string"),selectedNames:Lyte.attr("string"),usersRecord:Lyte.attr("array"),placeholder:Lyte.attr("string"),fieldId:Lyte.attr("string"),zcqa:Lyte.attr("string"),filterable:Lyte.attr("boolean",{default:!0}),filterOptions:Lyte.attr("array",{default:[{id:"AllUsers",category:_cruxUtils.getI18n("crm.globalsearch.option.all")},{id:"ActiveUsers",category:_cruxUtils.getI18n("webform.status.Active")},{id:"DeactiveUsers",category:_cruxUtils.getI18n("Inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("crm.user.component.unconfirmed")}]}),filterUservalue:Lyte.attr("string",{default:"category"}),filterSystemvalue:Lyte.attr("string",{default:"id"}),queryparam:Lyte.attr("object",{default:{}}),liteUserDetails:Lyte.attr("array"),normalUserDetails:Lyte.attr("array"),liteUserReq:Lyte.attr("boolean",{default:!0}),isSubordinateListing:Lyte.attr("boolean",{default:!1}),isRoleComponent:Lyte.attr("boolean",{default:!1}),roleRequestModel:Lyte.attr("string",{default:"role"}),fromTerritory:Lyte.attr("boolean",{default:Lyte.Router.getRouteInstance().routeName.includes("territory")}),roleRecords:Lyte.attr("array"),selectedRoles:Lyte.attr("string")}},updateDom:function(e){var t="",a="",i=e.newValue;if(i&&i.length){for(var r=i.length,s=0;s<r;s++){var o=i[s];s>0?(t=t+","+o.full_name,a=a+","+o.id):(t=o.full_name,a=o.id)}this.setData("selectedNames",t),this.setData("selectedIds",a)}}.observes("usersRecord"),methods:{onUserAddOrRemove:function(e,t,a){for(var i="",r="",s=a.length,o=0;o<s;o++){var n=a[o];o>0?(i=i+","+n.full_name,r=r+","+n.id):(i=n.full_name,r=n.id)}this.setData("selectedNames",i),this.setData("selectedIds",r),this.executeMethod("updateSelectedUsers")},updateSelectedUsers:function(){var e=this.getData("selectedIds"),t=this.getData("fieldId"),a=$(this.$node).parent(),i=a.find("#"+t);0==i.length&&(i=a.parent().find("#"+t)),i.val(e)}}}),Lyte.Component.register("crm-user-wrapper",{_template:'<template tag-name="crm-user-wrapper"> <div class="w85_per dIB"> <template is="if" value="{{expHandlers(cxPropCustomRequest,\'!\')}}"><template case="true"> <crux-user-dropdown cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-aria-attributes="{{ariaAttributes}}" class="outLine_none" onfocus="{{action(\'setFocus\',this)}}" onfocusout="{{action(\'removeFocus\',this,doRemoveFocusOnBlur)}}" on-user-before-show="{{method(&quot;folUserDropdown&quot;)}}" tabindex="{{tabIndex}}" user-id-list="{{userIdList}}" cx-prop-disabled="{{readOnly}}" cx-prop-zcqa="{{zcqaDropdown}}" cx-prop-forced-fetch="true" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-selected-user="{{lbind(userRecord)}}" cx-prop-selected="{{dataId}}" cx-prop-selected-name="{{userName}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" on-user-selected="{{method(&quot;onSelect&quot;)}}" cx-prop-query-param="{{defaultQueryParams}}" cx-prop-show-suggestion="{{if(expHandlers(zorEnabled,\'&amp;&amp;\',expHandlers(zorAvailable,\'||\',isFetchingSuggestion)),true)}}" cx-prop-suggestion="{{recommendedUsersList}}" cx-prop-show-suggestion-loading="{{isFetchingSuggestion}}" cx-prop-is-subordinate="{{isSubordinateListing}}"></crux-user-dropdown> <template is="if" value="{{expHandlers(expHandlers(readOnly,\'===\',&quot;false&quot;),\'&amp;&amp;\',expHandlers(expHandlers(expHandlers(dataUitype,\'==\',availableUiTypes.USERLOOKUP),\'||\',expHandlers(dataUitype,\'==\',availableUiTypes.PRODUCT_HANDLER)),\'&amp;\',expHandlers(userRecord.id,\'!==\',&quot;&quot;)))}}"><template case="true"> <img data-zcqa="lookup_{{fieldId}}_close" src="{{getCrmImageUrl(\'spacer.gif\')}}" id="Crm_lookup_img_{{fieldId}}" class="clear_lookupfield lookup_hIconO dIB svgIcons ico-close-small2 op5 cP fR hIconO mR30 {{showClearIconClass}}" onclick="{{action(\'clearSelection\')}}"> </template></template> <crux-user-lookup class="dIB" cx-prop-criteria="{{userCriteria}}" on-body-before-show="{{method(&quot;folUserDropdown&quot;)}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-selected-id="{{dataId}}" on-assign="{{method(&quot;onLookupSelected&quot;)}}" cx-prop-query-params="{{defaultQueryParams}}" on-before-search="{{method(&quot;setFilterQueryId&quot;)}}" cx-prop-show-suggestion="{{if(expHandlers(zorEnabled,\'&amp;&amp;\',expHandlers(zorAvailable,\'||\',isFetchingSuggestion)),true)}}" cx-prop-suggestion="{{recommendedUsersList}}" cx-prop-show-suggestion-loading="{{isFetchingSuggestion}}" cx-prop-is-subordinate="{{isSubordinateListing}}" cx-prop-forced-fetch="true"></crux-user-lookup> </template><template case="false"> <crux-user-dropdown cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-aria-attributes="{{&quot;aria-label&quot; : {{zcqaDropdown}}}}" class="outLine_none" onfocus="{{action(\'setFocus\',this)}}" onfocusout="{{action(\'removeFocus\',this,doRemoveFocusOnBlur)}}" tabindex="{{tabIndex}}" cx-prop-forced-fetch="true" cx-prop-disabled="{{readOnly}}" cx-prop-zcqa="{{zcqaDropdown}}" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-selected-user="{{lbind(userRecord)}}" cx-prop-selected="{{dataId}}" cx-prop-selected-name="{{userName}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" on-user-selected="{{method(&quot;onSelect&quot;)}}" on-custom-user-request="{{method(&quot;filterDropdownUsers&quot;)}}" cx-prop-query-param="{{defaultQueryParams}}" on-user-before-show="{{method(&quot;setFilterQueryId&quot;)}}" cx-prop-show-suggestion="{{if(expHandlers(zorEnabled,\'&amp;&amp;\',expHandlers(zorAvailable,\'||\',isFetchingSuggestion)),true)}}" cx-prop-suggestion="{{recommendedUsersList}}" cx-prop-show-suggestion-loading="{{isFetchingSuggestion}}"></crux-user-dropdown> <template is="if" value="{{expHandlers(expHandlers(readOnly,\'===\',&quot;false&quot;),\'&amp;&amp;\',expHandlers(expHandlers(expHandlers(dataUitype,\'==\',availableUiTypes.USERLOOKUP),\'||\',expHandlers(dataUitype,\'==\',availableUiTypes.PRODUCT_HANDLER)),\'&amp;\',expHandlers(userRecord.id,\'!==\',&quot;&quot;)))}}"><template case="true"> <img data-zcqa="lookup_{{fieldId}}_close" src="{{getCrmImageUrl(\'spacer.gif\')}}" id="Crm_lookup_img_{{fieldId}}" class="clear_lookupfield lookup_hIconO dIB svgIcons ico-close-small2 op5 cP fR hIconO mR30 {{showClearIconClass}}" onclick="{{action(\'clearSelection\')}}"> </template></template> <crux-user-lookup cx-prop-show-suggestion="{{if(expHandlers(zorEnabled,\'&amp;&amp;\',expHandlers(zorAvailable,\'||\',isFetchingSuggestion)),true)}}" cx-prop-suggestion="{{recommendedUsersList}}" cx-prop-show-suggestion-loading="{{isFetchingSuggestion}}" cx-prop-custom-request="true" on-custom-request="{{method(&quot;filterLookupUsers&quot;)}}" class="dIB" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-selected-id="{{dataId}}" on-assign="{{method(&quot;onLookupSelected&quot;)}}" cx-prop-query-params="{{defaultQueryParams}}" on-body-before-show="{{method(&quot;setFilterQueryId&quot;)}}"></crux-user-lookup> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]}]}},default:{}}],_observedAttributes:["userRecord","dataId","actionSource","fieldId","userName","operationSource","showClearIconClass","filterOptions","filterUservalue","filterSystemvalue","placeholder","filterable","userCriteria","userSearchCriteria","zcqaDropdown","dataUitype","readOnly","tabIndex","availableUiTypes","module","cxPropCustomRequest","userIdList","isFieldLookup","fieldIdFol","layoutId","isOwnerRecordLock","filterQueryId","defaultQueryParams","recordId","source","isEditPermissionDenied","zorEnabled","zorAvailable","isFetchingSuggestion","recommendedUsersList","isSubordinateListing","doRemoveFocusOnBlur","ariaAttributes","isTeamModule","needForcedFetch","isAccessibilityConfigSupported","childData"],data:function(){return{userRecord:Lyte.attr("object",{default:{},hideAttr:!0}),dataId:Lyte.attr("string",{default:""}),actionSource:Lyte.attr("string"),fieldId:Lyte.attr("string"),userName:Lyte.attr("string"),operationSource:Lyte.attr("string"),showClearIconClass:Lyte.attr("string",{default:"vVIm"}),filterOptions:Lyte.attr("array",{default:[{id:"ActiveUsers",category:"Active"}]}),filterUservalue:Lyte.attr("string",{default:"category"}),filterSystemvalue:Lyte.attr("string",{default:"id"}),placeholder:Lyte.attr("string"),filterable:Lyte.attr("boolean",{default:!1}),userCriteria:Lyte.attr("string",{default:""}),userSearchCriteria:Lyte.attr("string",{default:""}),zcqaDropdown:Lyte.attr("string",{default:""}),dataUitype:Lyte.attr("string"),readOnly:Lyte.attr("string",{default:"false"}),tabIndex:Lyte.attr("string",{default:"0"}),availableUiTypes:Lyte.attr("object",{default:Crm.Field.UITYPES}),module:Lyte.attr("string"),cxPropCustomRequest:Lyte.attr("boolean",{default:!1}),userIdList:Lyte.attr("string",{default:""}),isFieldLookup:Lyte.attr("boolean"),fieldIdFol:Lyte.attr("string"),layoutId:Lyte.attr("string"),isOwnerRecordLock:Lyte.attr("string"),filterQueryId:Lyte.attr("string"),defaultQueryParams:Lyte.attr("object"),recordId:Lyte.attr("string"),source:Lyte.attr("string"),isEditPermissionDenied:Lyte.attr("string"),zorEnabled:Lyte.attr("boolean",{default:!1}),zorAvailable:Lyte.attr("boolean",{default:!1}),isFetchingSuggestion:Lyte.attr("boolean",{default:!1}),recommendedUsersList:Lyte.attr("object",{default:{users:[],label:I18n.getMsg("Zia Suggestion")}}),isSubordinateListing:Lyte.attr("boolean",{default:!1}),doRemoveFocusOnBlur:Lyte.attr("boolean",{default:!1}),ariaAttributes:Lyte.attr("object",{default:{}}),isTeamModule:Lyte.attr("boolean",{default:!1}),needForcedFetch:Lyte.attr("boolean",{default:!1}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:!1}),childData:Lyte.attr("object",{default:"{}"})}},lookupAutoComplete:[],ajaxEditOwnerValue:{},editOwnerValue:{},setFilterOptions:function(){if(this.getData("userCriteria")&&this.setData("userCriteria",decodeURIComponent(this.getData("userCriteria"))),this.getData("userSearchCriteria")&&this.setData("userSearchCriteria",decodeURIComponent(this.getData("userSearchCriteria"))),this.getData("filterable")&&this.setData("filterOptions",[{id:"AllUsers",category:_cruxUtils.getI18n("crm.globalsearch.option.all")},{id:"ActiveUsers",category:_cruxUtils.getI18n("webform.status.Active")},{id:"DeactiveUsers",category:_cruxUtils.getI18n("Inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("crm.user.component.unconfirmed")},{id:"DeletedUsers",category:_cruxUtils.getI18n("DeletedUser")}]),"ChangeOwner"===this.getData("actionSource")){var e=$L("#mouseArea__SMOWNERID").data();if(e){var t=e.params;if(t){if(t.userCriteria&&this.getData("userCriteria")){var a=this.getData("userCriteria");(a=JSON.parse(a)).push("and"),a=a.concat(t.userCriteria),this.setData("userCriteria",JSON.stringify(a))}if(t.userSearchCriteria&&this.getData("userSearchCriteria")){var i=this.getData("userSearchCriteria");i=i+"and("+t.userSearchCriteria+")",this.setData("userSearchCriteria",i)}}}}Crm.userDetails.isAccessibilityConfigSupported&&featuresAvailable&&!featuresAvailable.NEXTGENUI_ENABLED&&this.setData("isAccessibilityConfigSupported",!0),this.setData("ariaAttributes",{"aria-label":this.getData("zcqaDropdown")})}.on("init"),toggleClearLookup:function(){var e=$(this.$node).closest(".lookupFieldCreate");this.getData("dataUitype")!=this.getData("availableUiTypes").PRODUCT_HANDLER&&this.getData("dataUitype")!=this.getData("availableUiTypes").USERLOOKUP||!this.getData("userRecord").id?(this.setData("showClearIconClass",""),e.hasClass("userLookupCIH")&&e.removeClass("userLookupCIH")):(this.setData("showClearIconClass","vVIm"),e.addClass("userLookupCIH"))}.observes("userRecord").on("init"),changeOwnerValueImpose:function(e){var t=this.getData("fieldId"),a=$("#OwnerField");(t.includes("qownerName_select")||t.includes("SMOWNER")||a.length>0)&&this.executeMethod("validateRestrictionCheck",e);var i=$("#"+t),r=$("#ownerId");$("#ownerName").text(" "+e.full_name),r.val(e.id),$("#ownerNameIntext").text(" "+e.full_name),$(".form_err_msg").hide(),$(".wf_no_focus").removeClass("wf_no_focus form_err_fld"),a.removeClass("dN"),i.data("id",e.id).data("profileId",e.profile.id),a.show(),"undefined"!=typeof changeOwner&&changeOwner.enableButton()},folUserRefFields:function(e){if(Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE||void 0!==this.$node.dataset.subformdisplaylabel&&("subform"===moduleRecordMapping[this.$node.dataset.subformdisplaylabel].generated_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===moduleRecordMapping[this.$node.dataset.subformdisplaylabel].generated_type)){var t={},a="undefined"==typeof lookupAutoComplete?this.lookupAutoComplete:lookupAutoComplete;if(void 0!==a){for(var i=a.length,r=0;r<i;r++)if(a[r].seId===e.id){t.item=a[r];break}_.isEmpty(t)?this.folUserDropdownSelectedId(e,this,t):this.folUserValuePopulate(this,t,e)}}},folUserValuePopulate:function(e,t,a){var i=t.item.refFieldsInfo,r=$L("#createEntityForm"),s=$L("#qCreate");if(void 0===(o=e.getData("module"))&&!r.is(":visible"))var o=Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam();if(window[o]=void 0===window[o]?o:window[o],r.is(":visible")||"edit"!==window[o].currentStatus&&!$("#convertOwner").data("isownerdealfol")||"changeOwnerPopUp"!==e.data.fieldId)if(s.is(":visible")||"crm.tab.approvals.index"!==Lyte.Router.getRouteInstance().transition.target){if(i&&t.item.parentFieldsColumnName){var n=$("#multipleFieldsEditPop"),l=$(".socAddToCrmPopover"),d=$L("#ctinotifier_center"),u=Lyte.Router.getRouteInstance().routeName;if(r.is(":visible")||s.is(":visible")||d.is(":visible")||"view"!==window[o].currentStatus||n.is(":visible"))(r.is(":visible")||l.is(":visible")||"create"===window[o].currentStatus||"clone"===window[o].currentStatus||"edit"===window[o].currentStatus||s.is(":visible")||d.is(":visible")||n.is(":visible")&&("detail"===u||"canvas"===u))&&(i=i||{},Crm.setRefFieldValues(e,a.id,i));else{var c="changeOwnerPopUp"===e.data.fieldId?"SMOWNERID":e.$node.dataset.colname;fieldOfLookup.participatingfieldsvalidationrule(t,c)}}}else Crm.setRefFieldValues(e,a.id,i||{});else e.editOwnerValue=i},clearSelectionFn:function(){if(this.getData("dataId")){this.setData("userRecord",{}),this.setData("dataId","");var e=this.getData("fieldId");if(e)$("#"+e).data("id","");$(this.$node).find("lyte-dropdown")[0].ltProp("placeholder",I18n.getMsg("None"))}},didConnect:function(){this.$node.removeSelection=function(){this.clearSelectionFn()}.bind(this)},folUserDropdownSelectedId:function(e,t,a){if((Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE||void 0!==this.$node.dataset.subformdisplaylabel&&("subform"===moduleRecordMapping[this.$node.dataset.subformdisplaylabel].generated_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===moduleRecordMapping[this.$node.dataset.subformdisplaylabel].generated_type))&&this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var i=$L(".zcanvas_zcdefaultcontd"),r=$L("#createEntityForm"),s=$("#multipleFieldsEditPop").is(":visible");if(!i.is(":visible")||i.is(":visible")&&r.is(":visible")||s){var o,n=this.getData("fieldId"),l=this.getData("fieldIdFol"),d=this.getData("module"),u={searchmodule:"Users",fldValue:"",isAutoComplete:!0,offset:"1",currencyISOCode:"undefined"!=typeof returnJson&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:"",productId:"",fldName:n,entityId:"",fieldId:l,isSubFormField:"false",parentModule:d,layoutId:o=window[d]&&"edit"===window[d].currentStatus&&"changeOwnerPopUp"===n?crmCommonModule.createEditJson.layout_jsonarrayObj.sysLayoutId:"null"!==(o=this.getData("layoutId"))?o:"",isFolUser:!0,folUserSelectedId:e.id,isBP:s};store.findAll("dummy",u,!1,!1,{url:Crm.getCrmBasePath()+"/Search.do",method:"POST"}).then((function(i){this.lookupAutoComplete=i.dummy.Value,a.item=i.dummy.Value[0],t.folUserValuePopulate(t,a,e)}))}}},actions:{clearSelection:function(){this.clearSelectionFn()},setFocus:function(e){e.currentTarget=this.$node,setFocusClass(e)},removeFocus:function(e,t){t&&(e.currentTarget=this.$node,removeFocusClass(e))}},methods:{onSelect:function(e,t){var a=$L("crm-zia-reasoning-popover")[0];if(a&&a.component){var i="owner_recommendation_unavailable",r={};if(!0===t.is_zia_suggested_user){var s={};s.confidence_percentage=t.confidence_percentage,s.user={id:t.id},r={fields_considered:t.fields_considered,zia_suggested_users:[s]},i="assigned_by_zia",Crm.client_tracking("Zia Owner Recommendation - Made as owner from quick create pop-up (owner field dropdown)",{ModuleName:this.data.module})}a.component.setData({zia_owner_assignment:i,abz_details:r})}this.setData("userName",t.full_name),this.setData("dataId",t.id),this.setData("userRecord",t);var o=this.getData("actionSource"),n=$(this.$node);switch(o){case"ChangeOwner":this.changeOwnerValueImpose(t);break;case"entitycreate":var l=null!=this.getData("module")?this.getData("module"):$("#quick_module").val();l=l||module;var d=this.getData("fieldId");(d.includes("SMOWNER")||d.includes("qownerName_select"))&&this.executeMethod("showRestrictionWarningMessage",l,t.id,this.getData("recordId"));var u=$("#"+d);if(u.prevAll("input").length>0?u.prevAll("input:eq(0)").val(t.id):u.data("id",t.id),"true"==this.$node.getAttribute("createTask")){var c=$("#notifyOwnerDiv"),p=0==c.length?$(".Tasks_Notify_Owner"):c;Crm.userDetails.USER_ID!=t.id?p.show():p.hide()}}if(this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var m=$L(".zcanvas_zcdefaultcontd"),f=$L("#createEntityForm"),g=$("#multipleFieldsEditPop").is(":visible");if(!m.is(":visible")||f.is(":visible")||g)this.folUserRefFields(t);else{var h=$L("crm-detailview-canvas")[0].component,y=this;store.findAll("dummy",null,!1,!1,{url:"crm/v2/users/"+t.id}).then((function(e){h.executeMethod("setFolValueUserLookup",e.users[0],y.data,t)}))}}if(!$(".commonRightPanel").length){var v=Lyte.Router.getRouteInstance().transition.info.route;"crm.tab.module.create"!==v&&"crm.tab.module.entity.edit"!==v&&"crm.tab.module.entity.clone"!==v&&"crm.tab.module.entity.detail"!==v&&"crm.tab.module.custom-view.list"!==v&&"crm.crm-calendar"!==v||n.trigger("change",this.$node)}if(this.getData("cxPropCustomRequest")&&"Appointments"===this.getData("module")){var D=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");Lyte.registeredMixins["crm-appointments-mixin"].checkServiceAvailability(D,void 0,"edit"===Events.currentStatus)}this.getMethods("onUserSelect")&&this.executeMethod("onUserSelect",this)},filterDropdownUsers:function(){var e=this.getData("userIdList"),t=arguments,a=this,i=this.getData("isSubordinateListing"),r=this.getData("isTeamModule");return new Promise((function(s,o){if("search"!==t[1]||r){t[1].ids=e;n="search"!==t[1]?t[1]:{};Crm.userDetails.isLookupFilterEnabled&&a.getData("filterQueryId")&&(n.query_id=a.getData("filterQueryId")),Crm.userDetails.isDynamicLookupFilterEnabled&&a.getData("filterQueryId")&&(n.child_data=a.getData("childData")),r?(delete n.filters,n.feature="tab_users",n.related_entity_id=moduleRecordMapping[a.getData("module")].id,n.type="ActiveUsers",n.include_lite_users=!0,"search"===t[1]&&(n.search={criteria:t[2].criteria}),store.triggerAction("user_associations","get_assigned",n).then((function(e){e.users=e.get_assigned,delete e.get_assigned,s(e)}),(function(){o()}))):i?(n.feature="subordinates",n.related_entity_id=Crm.userDetails.USER_ID,store.triggerAction("user","get_assigned",n).then((function(e){s(e)}),(function(){o()}))):(n.page=1,store.findAll("user",n).then((function(e){s(e)}),(function(){o()})))}else{var n,l=t[2].criteria;if(e&&(l="("+l+"and(id:in:"+e+"))"),(n={}).criteria=l,n.type="ActiveUsers",Crm.userDetails.isLookupFilterEnabled&&a.getData("filterQueryId")&&(n.query_id=a.getData("filterQueryId")),Crm.userDetails.isDynamicLookupFilterEnabled&&a.getData("filterQueryId")&&(n.child_data=a.getData("childData")),i){var d=n.criteria;delete n.criteria,n.search={},n.search.criteria=d,n.feature="subordinates",n.related_entity_id=Crm.userDetails.USER_ID,store.triggerAction("user","get_assigned",n).then((function(e){s(e)}),(function(){o()}))}else store.triggerAction("user","search",n).then((function(e){s(e)}),(function(){o()}))}}))},folUserDropdown:function(){if(void 0!==moduleRecordMapping[this.getData("module")]&&"team_based"===moduleRecordMapping[this.getData("module")].access_type&&void 0!==this.getData("dataUitype")&&parseInt(this.getData("dataUitype"))===this.getData("availableUiTypes").USERLOOKUP){let e=void 0!==this.getData("defaultQueryParams")?this.getData("defaultQueryParams"):{};e.include_lite_users=!0,this.setData("defaultQueryParams",e)}if(Crm.userDetails.isLookupFilterEnabled&&this.getData("filterQueryId")){let e=void 0!==this.getData("defaultQueryParams")?this.getData("defaultQueryParams"):{};e.query_id=this.getData("filterQueryId"),this.setData("defaultQueryParams",e)}if(Crm.userDetails.isDynamicLookupFilterEnabled&&this.getData("filterQueryId")){var e={},t=store.peekRecord("field",this.data.fieldIdFol),a=moduleRecordMapping[this.data.module].fields;if(t&&t.lookup&&t.lookup.query_details&&t.lookup.query_details.criteria&&this.isDynamicCriteriaInvolved(t.lookup.query_details.criteria)){crmTemplate.iterateGroupFieldsAndGetFieldValues(t.lookup.query_details.criteria,a,e,this.data.module);let r=$("#newRelatedListPopUpDiv").is(":visible"),s=$("#createEntityForm").is(":visible");r||s||"clone"!==window[this.data.module].currentStatus&&"view"!==window[this.data.module].currentStatus&&"edit"!==window[this.data.module].currentStatus||(e.id=detailView.entityId?detailView.entityId:crmCommonModule.createEditJson.entityId),this.setData("childData",e);var i=void 0!==this.getData("defaultQueryParams")?this.getData("defaultQueryParams"):{};i.child_data=this.data.childData,this.setData("defaultQueryParams",i),this.setData("needForcedFetch",!0)}}if(this.getData("needForcedFetch")||this.setData("needForcedFetch",!1),Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE&&this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var r=$L(".zcanvas_zcdefaultcontd"),s=$L("#createEntityForm");if(!r.is(":visible")||r.is(":visible")&&s.is(":visible")){var o,n=this.getData("fieldId"),l=this.getData("fieldIdFol"),d=this.getData("module"),u={searchmodule:"Users",fldValue:"",isAutoComplete:!0,offset:"1",currencyISOCode:"undefined"!=typeof returnJson&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:"",productId:"",fldName:n,entityId:"",fieldId:l,isSubFormField:"false",parentModule:d,layoutId:o=window[d]&&"edit"===window[d].currentStatus&&"changeOwnerPopUp"===n?crmCommonModule.createEditJson.layout_jsonarrayObj.sysLayoutId:"null"!==(o=this.getData("layoutId"))?o:"",isFolUser:!0,isBP:$("#multipleFieldsEditPop").is(":visible")};store.findAll("dummy",u,!1,!1,{url:Crm.getCrmBasePath()+"/Search.do",method:"POST"}).then((function(e){this.lookupAutoComplete=e.dummy.Value}))}}var c=$("#zia-reasoning-band")[0];this.data.zorEnabled&&c&&c.childNodes[0]&&c.childNodes[0].component.executeMethod("checkAndTriggerZiaOwnerRecommendation",null,null,!0,null,!0)},filterLookupUsers:function(e,t,a){var i=this.getData("userIdList"),r=this,s=r.getData("isTeamModule");return new Promise((function(e,o){if(a&&!s){var n=t.criteria;i&&(n="("+n+"and(id:in:"+i+"))"),(l={}).criteria=n,l.type="ActiveUsers",Crm.userDetails.isLookupFilterEnabled&&r.getData("filterQueryId")&&(l.query_id=r.getData("filterQueryId")),store.triggerAction("user","search",l).then((function(t){e(t)}),(function(){o()}))}else{var l;(l=t).ids=i,Crm.userDetails.isLookupFilterEnabled&&r.getData("filterQueryId")&&(l.query_id=r.getData("filterQueryId")),s?(delete l.filters,l.feature="tab_users",l.related_entity_id=moduleRecordMapping[r.getData("module")].id,l.type="ActiveUsers",l.include_lite_users=!0,a&&(l.search={criteria:t.criteria},delete l.criteria),store.triggerAction("user_associations","get_assigned",l).then((function(t){t.users=t.get_assigned,delete t.get_assigned,e(t)}),(function(){o()}))):store.findAll("user",l).then((function(t){e(t)}),(function(){o()}))}}))},onLookupSelected:function(e){this.setData("dataId",e.id),this.setData("userRecord",e),this.setData("userName",e.full_name);var t=$L("crm-zia-reasoning-popover")[0];if(t&&t.component){var a="owner_recommendation_unavailable",i={};if(!0===e.is_zia_suggested_user){var r={};r.confidence_percentage=e.confidence_percentage,r.user={id:e.id},i={fields_considered:e.fields_considered,zia_suggested_users:[r]},a="assigned_by_zia",Crm.client_tracking("Zia Owner Recommendation - Made as owner from quick create pop-up (owner field pop-up)",{ModuleName:this.data.module})}t.component.setData({zia_owner_assignment:a,abz_details:i})}if("entitycreate"===this.getData("actionSource")){var s=this.getData("fieldId"),o=$("#"+s),n=$("#ownerId"),l=o.find("span");if(l.attr("userid",e.id),l.attr("userzuid",e.zuid),n.val(e.id),o.prevAll("input").length>0?o.prevAll("input:eq(0)").val(e.id):o.data("id",e.id),"true"==this.$node.getAttribute("createTask")){var d=$("#notifyOwnerDiv"),u=0==d.length?$(".Tasks_Notify_Owner"):d;Crm.userDetails.USER_ID!=e.id?u.show():u.hide()}}if("ChangeOwner"!==this.getData("actionSource")&&"entitycreate"!==this.getData("actionSource")||this.changeOwnerValueImpose(e),this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")){var c=$L(".zcanvas_zcdefaultcontd"),p=$L("#createEntityForm");if(c.is(":visible")&&!p.is(":visible")){var m=$L("crm-detailview-canvas")[0].component,f=this;store.findAll("dummy",null,!1,!1,{url:"crm/v2/users/"+e.id}).then((function(t){m.executeMethod("setFolValueUserLookup",t.users[0],f.data,e)}))}else this.folUserRefFields(e)}if(this.getData("cxPropCustomRequest")&&"Appointments"===this.getData("module")){var g=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");Lyte.registeredMixins["crm-appointments-mixin"].checkServiceAvailability(g)}if(!$(".commonRightPanel").length){var h=Lyte.Router.getRouteInstance().transition.info.route;"crm.tab.module.create"!==h&&"crm.tab.module.entity.edit"!==h&&"crm.tab.module.entity.clone"!==h&&"crm.tab.module.entity.detail"!==h&&"crm.tab.module.begin"!==h&&"crm.tab.module.custom-view.list"!==h&&"crm.tab.module.entity.detail"!==h&&"crm.crm-calendar"!==h||$(this.$node).trigger("change",this.$node)}},setFilterQueryId:function(){if(Crm.userDetails.isLookupFilterEnabled&&this.getData("filterQueryId")){let e=void 0!==this.getData("defaultQueryParams")?this.getData("defaultQueryParams"):{};e.query_id=this.getData("filterQueryId"),this.setData("defaultQueryParams",e)}},showRestrictionWarningMessage:function(e,t,a){var i="#"+e+"_fldRow_SMOWNERID";"Products"===e&&(i="#"+e+"_fldRow_HANDLER");let r=$("#isQuickCreate"),s=r.length>0;(this.getRestrictionInfo?this.getRestrictionInfo(e,t,a):this.executeMethod("getRestrictionInfo",e,t,a)).then((function(t){if(s?r.find("crm-threshold-grant").remove():$("crm-threshold-grant").remove(),!1===t.allow){var a=document.createElement("crm-threshold-grant"),o=s?r.find(i+" .labelValCreate"):$(i+" .labelValCreate"),n=o.length>0?o[0].offsetWidth:n,l="position:relative; width:"+n+"px; top:10px; ";if(0===$("#isQuickCreate").length){var d=o.position().left;Crm.userDetails.RTL_ENABLED&&(d=-$(i+" .labelTabCreate").outerWidth()),l+="left:"+d+"px;"}return a.setData("rsGrantStyle",l),a.setData("moduleName",e),o.after(a),void commonUtils.showHideLoadingDiv()}}))},validateRestrictionCheck:function(e){var t=null!=this.getData("module")?this.getData("module"):$("#quick_module").val();if(t=t||module,!Crm.isRestrictionEnabled||!this.isValidRestrictionModule(t))return;var a=$("#assignmentRestriction"),i=document.getElementById("assRestGrant");let r=$("#isQuickCreate"),s=r.length>0;var o=this.getData("source");if(i&&i.setData("moduleName",t),"massconvert"===o){if(!a||!i)return;if("Leads"!=t)return;var n=["Contacts","Accounts"],l=$("#potentialsCheckBox");l.length>0&&l[0].checked&&n.push("Deals"),a.hasClass("dN")||a.addClass("dN"),i.setData("source","massconvert"),i.setData("moduleName",""),n.forEach((function(t){changeOwner.getRestrictionInfo(t,e.id).then((function(e){!1===e.allow&&a.hasClass("dN")&&a.removeClass("dN")}))}))}else if("listview"===o||"entityview"===o||"massTransferTo"===o||"detailview"===o){this.executeMethod("getRestrictionInfo",this.getData("module"),e.id,this.getData("recordId")).then((function(e){!0===e.allow&&(a.hasClass("dN")||a.addClass("dN")),!1===e.allow&&a.removeClass("dN")}))}else if("entitycreate"===this.getData("actionSource")){var d="#"+t+"_fldRow_SMOWNERID";"Products"===t&&(d="#"+t+"_fldRow_HANDLER"),this.executeMethod("getRestrictionInfo",t,e.id,this.getData("recordId")).then((function(e){if(s?r.find("crm-threshold-grant").remove():$("crm-threshold-grant").remove(),!1===e.allow){var a=document.createElement("crm-threshold-grant"),i=s?r.find(d+" .labelValCreate"):$(d+" .labelValCreate"),o=i.length>0?i[0].offsetWidth:o,n="position:relative; width:"+o+"px; top:10px; ";if(0===$("#isQuickCreate").length){var l=i.position().left;Crm.userDetails.RTL_ENABLED&&(l=-$(d+" .labelTabCreate").outerWidth()),n+="left:"+l+"px;"}return a.setData("rsGrantStyle",n),a.setData("moduleName",t),i.after(a),void commonUtils.showHideLoadingDiv()}}))}var u=$L("#applyRestrictionOption");if(u&&u.length>0&&u[0].setData({source:o,user:e}),"entityview"===o){var c=$L(".relatedRecordsDiv");"Team User"===e.profile.name?(c.removeClass("dB"),c.addClass("dN")):(c.removeClass("dN"),c.addClass("dB"))}},getRestrictionInfo:function(e,t,a){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,a)},removeSelection:function(){this.fn1()}}},{mixins:["crm-assignment-threshold-common","crm-lookup-filter-mixin"]}),Lyte.Component.register("crm-threshold-grant",{_template:'<template tag-name="crm-threshold-grant" id="assRestGrant{{selectorId}}"> <div class="rsFieldInfo" style="{{rsGrantStyle}}"> <span class="svgIconsImg rsInfoIcon"></span> <span> <template is="if" value="{{isSingleModule}}"><template case="true"> {{getI18n(\'crm.restriction.grant.warning\',plural_label)}} </template><template case="false"> {{getI18n(\'crm.restriction.grant.warning.moremodules\')}} </template></template> </span> </div> </template>',_dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",dynamicValue:"rsGrantStyle"}}},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["rsGrantStyle","selectorId","source","isSingleModule","moduleName","moduleApiName","plural_label","recordid","ownerid","currentInstObjKey","moduleArray"],data:function(){return{rsGrantStyle:Lyte.attr("string",{default:""}),selectorId:Lyte.attr("string",{default:""}),source:Lyte.attr("string",{default:""}),isSingleModule:Lyte.attr("boolean",{default:!0}),moduleName:Lyte.attr("string",{default:I18n.getMsg("records")}),moduleApiName:Lyte.attr("string",{default:I18n.getMsg("records")}),plural_label:Lyte.attr("string",{default:I18n.getMsg("records")}),recordid:Lyte.attr("string",{default:null}),ownerid:Lyte.attr("string",{default:null}),currentInstObjKey:Lyte.attr("string",{hideAttr:!0}),moduleArray:Lyte.attr("array",{default:[]})}},init:function(){this.executeMethod("setModuleApiName")},methods:{setModuleApiName:function(){var e=this.getData("moduleName");if(e){var t=this.getModuleRecord(null,e);if(!t)return;this.setData("moduleApiName",t.api_name),this.setData("plural_label",t.plural_label)}var a=this.getData("source");"massconvert"!=a&&"convert"!=a&&"transfer_and_delete"!=a||(this.setData("moduleApiName",I18n.getMsg("records")),this.setData("plural_label",I18n.getMsg("records")),this.setData("isSingleModule",!1))},addRestrictionMessage:function(e){var t=(e=null==e?this:e).getData("recordid"),a=e.getData("ownerid"),i=e.getData("moduleName");(Lyte.registeredMixins["crm-assignment-threshold-common"].isValidRestrictionModuleByModuleName(i)||$("#assignmentRestriction").addClass("dN"),i&&a)&&Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(i,a,t).then((function(t){var a;a=$("#multipleFieldsEditPop").is(":visible")?$(e).parent():$("#assignmentRestriction"),!1===t.allow?a.removeClass("dN"):a.addClass("dN")}))}},dataModuleArray:function(){var e=this.getData("moduleArray"),t="";e.forEach((function(a,i){t=0==i?a:i==e.length-1?t+" "+I18n.getMsg("crm.label.lowercase.and")+" "+a:t+" , "+a})),this.setData("moduleName",t)}.observes("moduleArray"),dataObserverModule:function(){this.executeMethod("setModuleApiName")}.observes("moduleName")},{mixins:["crm-assignment-threshold-common"]}),Lyte.Component.register("crm-threshold-checkbox-option",{_template:'<template tag-name="crm-threshold-checkbox-option"> <template is="if" value="{{showOption}}"><template case="true"> <lyte-checkbox lt-prop-checked="{{lbind(checked)}}" lt-prop-id="arCheckbox" lt-prop-label="{{message}}" class="{{if(isFromChangeOwner,\'pT10 pB10\',\'dB\')}}"> </lyte-checkbox> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["checked","message","module","source","user","ownerName","showOption","isFromChangeOwner","isPreview"],data:function(){return{checked:Lyte.attr("boolean",{default:!0}),message:Lyte.attr("string",{default:I18n.getMsg("crm.restriction.apply.option.label")}),module:Lyte.attr("string"),source:Lyte.attr("string"),user:Lyte.attr("object"),ownerName:Lyte.attr("string",{default:"the user"}),showOption:Lyte.attr("boolean",{default:!1}),isFromChangeOwner:Lyte.attr("boolean",{default:!1}),isPreview:Lyte.attr("boolean",{default:!1})}},init:function(){this.executeMethod("moduleCheck"),this.executeMethod("setMessageBySource")},methods:{setMessageBySource:function(){var e=this.executeMethod("showBasedOnSource");if(e||!this.getData("isFromChangeOwner")){if(e){var t=this.data.user?this.data.user.full_name:this.data.ownerName,a=this.getData("source");"approvalprocess"===a&&(t=I18n.getMsg("crm.label.selected.owners"));var i=I18n.getMsg("crm.restriction.apply.option.label",t);"workflow_convert"===a&&(i=I18n.getMsg("crm.restriction.wfcreaterecord")),this.setData("message",i)}}else $L("crm-change-owner")[0].setData("showAssignmentThreshold",!1)},moduleCheck:function(){var e=this;if(this.executeMethod("showBasedOnSource")){var t=this.getData("module").split(","),a=t.length;Lyte.injectResources(networkUtils.returnDependencyFiles(["assignment_threshold_model.js"],ResourceConstants.CRMClient),void 0,(function(){for(let i=0;i<a;i++){let a=t[i];e.isConfiguredRestrictionModule(a,!0).then((function(t){t&&!e.getData("showOption")&&e.setData("showOption",!0)}))}}))}},showBasedOnSource:function(){var e=this.getData("source");return"workflow"===e||"blueprint"===e||"approvalprocess"===e||"macro"===e||"workflow_convert"===e||"mass_convert"===e||(this.setData("showOption",!1),!1)}},dataObserver:function(){this.executeMethod("moduleCheck"),this.executeMethod("setMessageBySource")}.observes("user","ownerName","source")},{mixins:["crm-assignment-threshold-common"]}),Lyte.Component.register("crmutil-icon",{_template:'<template tag-name="crmutil-icon"> <svg class="zcicn_embedSvg {{iconClass}}"> <use href="{{expHandlers(\'#zcicn-\',\'+\',iconName)}}"></use> </svg> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}],_observedAttributes:["iconName","iconClass","lyteUnbound"],data:function(){return{iconName:Lyte.attr("string",{default:""}),iconClass:Lyte.attr("string",{default:""}),lyteUnbound:Lyte.attr("boolean",{default:!1})}}}),Lyte.Component.register("crm-trial-expiry-popup",{_template:'<template tag-name="crm-trial-expiry-popup"> <lyte-modal id="trialExpiryDiv" lt-prop-show="{{showModal}}" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromTop&quot;}" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-width="{{if(expHandlers(profileName,\'==\',\'Administrator\'),\'650px\',\'450px\')}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{expHandlers(profileName,\'==\',\'Administrator\')}}"><template case="true"><lyte-modal-header>{{title}}</lyte-modal-header></template><template case="false"><lyte-modal-header class="aligncenter"> <crmutil-icon class="vaBottom" icon-name="notallowed" icon-class="zcicn-notallowed zcicn-f56d6d zcicn24"></crmutil-icon> {{title}}</lyte-modal-header></template></template> <lyte-modal-content> <template is="if" value="{{expHandlers(profileName,\'==\',\'Administrator\')}}"><template case="true"><div class="crmLabelColor">{{message}}</div></template><template case="false"><div class="crmLabelColor aligncenter pB30"> {{contactAdmin}} </div></template></template> </lyte-modal-content> <template is="if" value="{{expHandlers(profileName,\'==\',\'Administrator\')}}"><template case="true"><lyte-modal-footer class="right"> <template is="if" value="{{showExtendTrail}}"><template case="true"><span class="dIB crmLinkColor cP mR10" data-zcqa="trialExpiry_extendEditionTrial" onclick="{{action(\'extendEditionTrial\')}}"> {{option3}} </span></template></template> <lyte-button data-zcqa="trialExpiry_moveToActualEditionAfterExpiry" onclick="{{action(\'moveToActualEditionAfterExpiry\')}}"> <template is="registerYield" yield-name="text"> {{option2}} </template> </lyte-button> <template is="if" value="{{expHandlers(deployment,\'!=\',\'China\')}}"><template case="true"><lyte-button lt-prop-appearance="primary" data-zcqa="trialExpiry_upgradeAfterExpiry" onclick="{{action(\'upgradeAfterExpiry\')}}"> <template is="registerYield" yield-name="text"> {{option1}} </template> </lyte-button></template></template> </lyte-modal-footer></template></template> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[0,0]},{type:"componentDynamic",position:[0]}]},false:{dynamicNodes:[{type:"componentDynamic",position:[0,1]},{type:"text",position:[0,3]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"text",position:[0,0]}]},false:{dynamicNodes:[{type:"text",position:[0,1]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[0,1]},{type:"if",position:[0,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"text",position:[0,1]}]}},default:{}},{type:"attr",position:[0,3]},{type:"registerYield",position:[0,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0,3]},{type:"attr",position:[0,5]},{type:"if",position:[0,5],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"registerYield",position:[0,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[0]}]}},default:{}},{type:"componentDynamic",position:[0]}]}},default:{}}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["showModal","profileName","title","message","option1","option2","deployment","contactAdmin","option3","editionEvaluated","showExtendTrail"],data:function(){return{showModal:Lyte.attr("boolean"),profileName:Lyte.attr("string"),title:Lyte.attr("string"),message:Lyte.attr("string"),option1:Lyte.attr("string"),option2:Lyte.attr("string"),deployment:Lyte.attr("string"),contactAdmin:Lyte.attr("string"),option3:Lyte.attr("string"),editionEvaluated:Lyte.attr("string"),showExtendTrail:Lyte.attr("boolean")}},actions:{upgradeAfterExpiry:function(){$L("#trialExpiryDiv")[0].remove();var e=Crm.userDetails.manageSubscriptionUrl+"&edition="+Crm.userDetails.EDITION_EVALUATED;document.location.href=e},moveToActualEditionAfterExpiry:function(){var e={crmcsrfparam:csrfToken,actionType:"deleteTrialExpiryKey"};networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/License.do","POST",{params:e}).then((function(e){var t=$L("#trialExpiryDiv");if("success"===e&&t.length){cookieUtils.setCookie("crmtrialCancelled","Closed",365,"/"),Utils.windowLocationReload()}}))},extendEditionTrial:function(){commonUtils.showHideLoadingDiv(),$L("#trialExpiryDiv")[0].remove(),this.enableEditionTrial("extendYourTrail",this.getData("editionEvaluated"),"newEvaluation"),Crm.trackSpotLightAction("Trial Expiry alert - Extend "+this.getData("editionEvaluated")+" trial")}},methods:{}},{mixins:["crm-license-mixin"]});
