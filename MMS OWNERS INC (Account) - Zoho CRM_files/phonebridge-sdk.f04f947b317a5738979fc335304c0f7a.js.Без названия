var COMMON_UTILS={parentDomain:null,userlanguage:null,isHebrew:function(){return"iw"===COMMON_UTILS.userlanguage||"he"===COMMON_UTILS.userlanguage},darkmode:!1,cdnDomain:"",isDarkmodeEnabled:function(){return COMMON_UTILS.darkmode},toggleDarkmode:function(e){COMMON_UTILS.darkmode=e;var t=document.getElementById("darkmode_main"),a=document.getElementById("daymode_main");e?(t?t.disabled=!1:((t=document.createElement("link")).rel="stylesheet",t.type="text/css",t.id="darkmode_main",t.href=PBClient.getFingerPrintUsingFileName("darkmode.css"),document.head.appendChild(t)),a&&(a.disabled=!0)):(a?a.disabled=!1:((a=document.createElement("link")).rel="stylesheet",a.type="text/css",a.id="daymode_main",a.href=PBClient.getFingerPrintUsingFileName("daymode.css"),document.head.appendChild(a)),t&&(t.disabled=!0))},sendMessageToParentWindow:function(e){var t=COMMON_UTILS.parentDomain,a=document.createElement("a");a.href=t,t=a.origin,parent.postMessage(e,t)},fetchRequest:function(e){var t,a=e.actionUrl?e.actionUrl:e.action,i=e.params,l=e.headers||{};if(window.PhoneBridgeUtil?(PhoneBridgeUtil.zaid&&"null"!==PhoneBridgeUtil.zaid&&(l["X-ZAID"]=PhoneBridgeUtil.zaid),PhoneBridgeUtil.pbzaaid&&"null"!==PhoneBridgeUtil.pbzaaid&&(l["X-PB-ZAAID"]=PhoneBridgeUtil.pbzaaid),PhoneBridgeUtil.accesstoken&&"null"!==PhoneBridgeUtil.accesstoken&&(a.includes("/phonebridge/integration/internal")&&"ringcentral"===JSON.parse(e.body).providerType?(delete l["X-ZAID"],delete l["X-PB-ZAAID"]):l.Authorization="Zoho-oauthtoken "+PhoneBridgeUtil.accesstoken)):window.Setup&&(Setup.zaid&&"null"!==Setup.zaid&&(l["X-ZAID"]=Setup.zaid),Setup.pbzaaid&&"null"!==Setup.pbzaaid&&(l["X-PB-ZAAID"]=Setup.pbzaaid),Setup.accessToken&&"null"!==Setup.accessToken&&(a=a.replace("/phonebridge/",Setup.PBServer+"/phonebridge/"),l.Authorization="Zoho-oauthtoken "+Setup.accessToken)),i){var o=encodeURIComponent;t=Object.keys(i).map((e=>o(e)+"="+o(i[e]))).join("&")}var n=e.type?e.type:"POST",r={method:n,headers:l||"",credentials:"cookies"===e.authentication?"include":"omit"};return"POST"===n||"PUT"===n?(r.body=t||"",e.body?r.body=e.body:r.body=t||"",fetch(a,r).then((function(e){return e.text()})).then((function(e){try{return JSON.parse(e)}catch(t){return e}}))):"DELETE"===n?fetch(a,r).then((function(e){return e.text()})).then((function(e){try{return JSON.parse(e)}catch(t){return e}})):fetch(a+"?"+t,r).then((function(e){return e.text()})).then((function(e){try{return JSON.parse(e)}catch(t){return e}}))},getCookie:function(e){var t=document.cookie,a=t.indexOf(" "+e+"=");if(-1===a&&(a=t.indexOf(e+"=")),-1===a)t=null;else{a=t.indexOf("=",a)+1;var i=t.indexOf(";",a);-1===i&&(i=t.length),t=unescape(t.substring(a,i))}return t},print:function(e){console.log(e)},isEmpty:function(e){try{var t=null;if("object"!=typeof e&&"string"==typeof e)t=e.replace(/\ /g,"");else if("object"==typeof e)return Object.keys(e).length<1;return null===e||""===e||void 0===e||"null"===e||"NULL"===e||"empty"===e||"EMPTY"===e||"undefined"===e||"UNDEFINED"===e||""===t}catch(e){return!0}},isNotEmpty:function(e){return!this.isEmpty(e)},removeSpecialChars:function(e){if(""!==e&&null!=e)for(var t="~`!@#$^&%*()=-_[]/{}|:<>?. '\"\\",a=t.length,i=0;i<a;i++)e=e.split(t.charAt(i)).join("");return e},executeFunctionByName:function(e,t){try{for(var a=Array.prototype.slice.call(arguments,2),i=e.split("."),l=i.pop(),o=0;o<i.length;o++)t=t[i[o]];return t[l].apply(t,a)}catch(e){COMMON_UTILS.print(e)}},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})},browserDetect:function(){var e=I18n.getMsg("phonebridge.preferences.browser"),t=navigator.userAgent;return t.indexOf("Firefox")>-1?e="Mozilla Firefox":t.indexOf("Opera")>-1?e="Opera":t.indexOf("Trident")>-1?e="Microsoft Internet Explorer":t.indexOf("Edge")>-1?e="Microsoft Edge":t.indexOf("Chrome")>-1?e="Google Chrome or Chromium":t.indexOf("Safari")>-1&&(e="Apple Safari"),e},openUrl:function(e){var t=e.URL,a=e.TARGET,i=e.SPECS;if(null==i&&COMMON_UTILS.isNotEmpty(a)&&"_top"!==a&&"_self"!==a&&"_parent"!==a){var l=document.createElement("a");$(l).attr({href:t,target:a,rel:"noopener noreferrer"}),$(document.body).append(l),l.click(),$(l).remove()}else{window.open(t,a,i).opener=null}},onPremiseCall:function(e){var t,a,i,l,o,n={},r={},s={};t=null!=e.URI?e.URI:"",a=null!=e.AUTHPARAM_NAME?e.AUTHPARAM_NAME:"",i=null!=e.AUTHPARAM_VALUE?e.AUTHPARAM_VALUE:"",l=null!=e.AUTHPARAM_TYPE?e.AUTHPARAM_TYPE:"";var d=null!=e.PARAM?JSON.parse(e.PARAM):{};for(var c in o="true"===e.KEYPRESS,d)d.hasOwnProperty(c)&&(n[c]=d[c]);null!=e.STANDARD_HEADERS&&""!=e.STANDARD_HEADERS&&(s=JSON.parse(e.STANDARD_HEADERS)),o&&(n.digit=e.DIGIT),""!=l&&"param"==l&&""!=a&&""!=i?(r.actionUrl=t,r.type="POST",n[a]=i,r.params=n,COMMON_UTILS.sendpostvendor(r).then((e=>e.json().then((t=>({status:e.ok,body:t}))))).then((e=>{e.status||PhoneBridgeUtil.showErrorPopup("Cannot Send request","Please try after some time")}))):""!=l&&"header"==l&&""!=a&&""!=i?(r.actionUrl=t,r.type="POST",s[a]=i,r.headers=s,r.params=n,COMMON_UTILS.sendpostvendor(r).then((e=>e.json().then((t=>({status:e.ok,body:t}))))).then((e=>{e.status||PhoneBridgeUtil.showErrorPopup("Cannot Send request","Please try after some time")}))):""!=l&&""!=a&&""!=i||(r.actionUrl=t,r.type="POST",r.params=n,Object.keys(s).length>0&&(r.headers=s),COMMON_UTILS.sendpostvendor(r).then((e=>e.json().then((t=>({status:e.ok,body:t}))))).then((e=>{e.status||PhoneBridgeUtil.showError("Cannot Send request","Please try after some time")})))},openOauthWindow:function(e){window.open(e.WINDOW_URL,"windowname1","width=800, height=600")},sendpostvendor:function(e){var t,a=e.actionUrl?e.actionUrl:e.action,i=e.params,l=e.headers||{},o=!(0==Object.keys(l).length||!l.hasOwnProperty("Content-Type")||"Application/json"!=l["Content-Type"]);if(i&&!o){var n=encodeURIComponent;t=Object.keys(i).map((e=>n(e)+"="+n(i[e]))).join("&")}else t=JSON.stringify(i);var r=e.type?e.type:"POST",s={method:r,headers:l||"",credentials:"cookies"===e.authentication?"include":"omit"};if("POST"===r||"PUT"===r)return s.body=t||"",e.body?s.body=e.body:s.body=t||"",fetch(a,s)},escapeCss:function(e){if(!e||""==e.trim())return null;for(var t,a=String(e),i=a.length,l=-1,o="",n=a.charCodeAt(0);++l<i;)0!=(t=a.charCodeAt(l))?o+=t>=1&&t<=31||127==t||0==l&&t>=48&&t<=57||1==l&&t>=48&&t<=57&&45==n?"\\"+t.toString(16)+" ":(0!=l||1!=i||45!=t)&&(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?a.charAt(l):"\\"+a.charAt(l):o+="ï¿½";return o},formClientCallid:function(e){for(var t="",a=0;a<e.length;a++)126===e.charCodeAt(a)||32===e.charCodeAt(a)||45===e.charCodeAt(a)||58===e.charCodeAt(a)||64===e.charCodeAt(a)||44===e.charCodeAt(a)||46===e.charCodeAt(a)||47===e.charCodeAt(a)||e.charCodeAt(a)>=91&&e.charCodeAt(a)<=96&&95!==e.charCodeAt(a)?t=t+"_"+e.charCodeAt(a):t+=e[a];return t},debounceFunction:function(e,t,a){var i;return function(){var l=this,o=arguments,n=function(){i=null,a||e.apply(l,o)},r=a&&!i;clearTimeout(i),i=setTimeout(n,t),r&&e.apply(l,o)}},getNewArray:function(e){var t=[];if(e)for(var a=e.length,i=0;i<a;i++)t[i]=e[i];return t},getNewJSONObject:function(e){return e?JSON.parse(JSON.stringify(e)):e},appendNewRelatedData:function(e,t){for(var a in e=e||{},t=t||{})if(t.hasOwnProperty(a))if(e.hasOwnProperty(a)){var i=t[a];for(var l in i)e[a][l]=i[l]}else e[a]=t[a];return e}};function loadPhonebridge(e){var t={};e.serviceId="12323213",e.serviceName="ZohoCRM",e.pbDomain="https://phonebridge.localzoho.com",t.parts=location.hostname.split("."),t.subdomain=t.parts.shift(),t.uplvldom=t.parts.join("."),t.server="https://phonebridgeqa."+t.uplvldom,null!=e.pbDomain&&""!=e.pbDomain&&(t.server=e.pbDomain);var a=document.createElement("script");xhr=new XMLHttpRequest,xhr.open("GET",t.server+"/phonebridge/users/loadJS?init=WMS",!0),xhr.withCredentials=!0,xhr.send(null),xhr.onreadystatechange=function(){if(4===xhr.readyState){try{var t=JSON.parse(xhr.response);a.src=t.pbsdkurl,PBClient.isIntegrityEnabled&&(a.integrity=t.integrity),a.crossOrigin="anonymous"}catch(e){a.src="https:"+xhr.response}a.onload=function(){PB.jsurl=a.src.substring(0,a.src.lastIndexOf("/")),PBClient.isIntegrityEnabled=!0,PB.init(e)},document.head.appendChild(a)}}}function urischeme(e){(window.parent?window.parent:window).location.assign("rcmobile://call?number="+e)}var Zoho=Zoho||{};Zoho.PhoneBridge=Zoho.PhoneBridge||{},Zoho.PhoneBridge=function(){var e={OrgId:null,CallRefId:null,CallState:null,ChildCallState:null,isclicktodial:!1,Number:null,CallerDetails:{},AnyRecordExist:!1,CallDuration:0,CallDesc:"",CurrentServiceName:"",CurrentServiceId:"",callDirection:null,servicesCallBackParam:null,CurrentHeadless:{},backgroundRandomNumber:-1},t={minute:0,second:0,TimerId:0,start:function(){t.minute=0,t.second=0,0!=t.TimerId&&clearInterval(t.TimerId),t.TimerId=setInterval(t.run,1e3)},run:function(){t.second+=1,60===t.second&&(t.second=0,t.minute+=1),document.getElementById("calltimer_min")&&document.getElementById("calltimer_sec")&&(document.getElementById("calltimer_min").innerHTML=t.checktime(t.minute),document.getElementById("calltimer_sec").innerHTML=t.checktime(t.second))},stop:function(){0!=t.TimerId&&clearInterval(t.TimerId),t.TimerId=0,t.minute=0,t.second=0},checktime:function(e){return e<10&&(e="0"+e),e},pause:function(){clearInterval(t.TimerId),t.TimerId=0},resume:function(){t.TimerId=setInterval(t.run,1e3)},displaytime:function(){var a=t.checktime(Math.floor(e.CallDuration/60)),i=t.checktime(e.CallDuration%60);document.getElementById("callStage").innerHTML="<span id='calltimer_min' class='f13'>"+a+"</span>&nbsp;:&nbsp;<span id='calltimer_sec' class='f13'>"+i+"</span>"}},a={initWMS:function(e){var t=document.createElement("script");t.src="https://"+e.wmsjsurl,document.head.appendChild(t),t.onload=function(){var a=document.createElement("a");(a.href=t.src,WmsLite.setWmsContext("_wms"),WmsLite.setNoDomainChange(),WmsLite.setJSStaticDomain(a.hostname),WmsLite.setConfig(WMSSessionConfig.CHAT_PRESENCE|WMSSessionConfig.PRESENCE_PERSONAL|WMSSessionConfig.PRESENCE_ORG),PhoneBridgeUtil.zaid&&"null"!==PhoneBridgeUtil.zaid||PhoneBridgeUtil.pbzaaid&&"null"!==PhoneBridgeUtil.pbzaaid)?PhoneBridgeUtil.accesstoken&&PhoneBridgeUtil.pbzaaid&&"null"!==PhoneBridgeUtil.pbzaaid?(console.log("SDP ZAAID"+PhoneBridgeUtil.pbzaaid+" domain => https://"+document.domain),WmsLite.setOAuthCredentials(PhoneBridgeUtil.accesstoken,null,"onpremiseclient.useroperation","CUSTOM"),WmsLite.register("PB",e.zuid,null,null,null,null,PhoneBridgeUtil.pbzaaid,57,null)):(console.log("VCRM ZAAID"+PhoneBridgeUtil.pbzaid),WmsLite.useSameDomain(),WmsLite.register("PB",e.zuid,null,null,null,null,PhoneBridgeUtil.zaid,57,null)):WmsLite.registerZuid("PB",e.zuid,e.zuid,!0);i.attachWMSListner(),PhoneBridgeUtil.checkUserInCall()}}},i={attachWMSListner:function(){window.WmsliteImpl&&(WmsliteImpl.handleMessage=function(e,t){if("2"===e){if(COMMON_UTILS.print(t),PBMurphy){var a=Date.now();PBMurphy.addLogger("PushMessageReceived_"+a,t)}"string"==typeof t&&(t=JSON.parse(t)),t.clientcallid&&(t.clientcallid=COMMON_UTILS.formClientCallid(t.clientcallid));var i=t.pbmodule;if("CALLNOTIFY"===i)PhoneBridgeUtil.popupHidden||setTimeout(l.createPopup(t),1e3),PhoneBridgeUtil.openRecordInNewTab(t);else if("SAVECALLER"===i)PhoneBridgeUtil.popupHidden||setTimeout(l.saveCallerSearch(t),1e3),PhoneBridgeUtil.openRecordInNewTab(t);else if("UPDATECALLER"===i)PhoneBridgeUtil.popupHidden||l.updateCallerSearch(t);else if("HIDECALLPOPUP"===i)PhoneBridgeUtil.reloadpopup();else if("SHOWCALLPOPUP"===i)PhoneBridgeUtil.reloadpopup();else if("closecallpopup"===i)l.closeCall(t.clientcallid);else if("apinotify"===i)COMMON_UTILS.sendMessageToParentWindow(t);else if("execscript"===i)if(t.ARGUMENTS||(t.ARGUMENTS={}),t.orgId&&(t.ARGUMENTS.orgId=t.orgId),t.hasOwnProperty("tab")){var o=t.tab;("master"===o&&pbTabManager.ismaster||"slave"===o&&pbTabManager.isslave||"all"==o)&&COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}else COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS);else if("extensionlist"===i)COMMON_UTILS.sendMessageToParentWindow({action:"extensionlist",extensionlist:t.extensionlist});else if("updateCallDetails"===i){var n=document.getElementById("call-"+t.clientcallid);n&&Lyte.Component.set(n.component.data,t.detailKey,t.detailValue)}else"errorpopup"===i?(PhoneBridgeUtil.showErrorPopup(t.title,t.message),t.closecallpopup&&l.closeCall(t.clientcallid)):"negativebalance"===i?COMMON_UTILS.sendMessageToParentWindow(popupjson):"clicktodialPermission"===i?PhoneBridgeUtil.defaultOrg==t.orgId&&(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].callButtonAllowed=t.isClicktodialEnabled,COMMON_UTILS.sendMessageToParentWindow({action:"defineZPBCustomTag",callbuttonallowed:PhoneBridgeUtil.isCallButtonAllowed(PhoneBridgeUtil.defaultOrg)})):"callcontrolSettings"===i?window.callPopupHandler&&callPopupHandler.callControlListner(t):"CONFIG_CHANGES"===i?zpb_config.onConfigChanges(t):"callerIdStatus"===i?document.getElementById("outbound-callerid-popup").component.methods.onSetCallerId(t):"zv_reinit"===i&&"undefined"!=typeof zpb_zvoice&&zpb_zvoice.checkAndReInit(t)}},WmsliteImpl.serverup=function(){COMMON_UTILS.print("PB WMS reconnected!"),COMMON_UTILS.sendMessageToParentWindow({action:"callbackZPB"}),tabCommunicator.getPublishJsonFromOtherTab(),window.BroadcastChannel&&pbTabManager.channeltosend.postMessage("checkothertabsincall"),PhoneBridgeUtil.isWMSCreated||(PhoneBridgeUtil.checkUserInCall(),PhoneBridgeUtil.isWMSCreated=!0,PhoneBridgeUtil.requestNewTabData())},WmsliteImpl.serverdown=function(){COMMON_UTILS.print("PB WMS disconnected!")})}},l={sendCurrentCallsDetailsToParent:function(){var e={action:"setcurrentcall"};e.currentcalls=Zoho.PhoneBridge.CallsArray,COMMON_UTILS.sendMessageToParentWindow(e)},createPopup:function(e){if(-1==Zoho.PhoneBridge.CallsArray.indexOf(e.clientcallid)){if(-1!=Zoho.PhoneBridge.CallsArray.indexOf(e.orgid+"_clicktodial")&&"outgoing"==e.callDirection&&e.hasOwnProperty("callrefid")&&"clicktodial"!=e.callrefid)t=document.getElementById("call-"+e.orgid+"_clicktodial").component,Zoho.PhoneBridge.activeCall==e.orgid+"_clicktodial"&&(Zoho.PhoneBridge.activeCall=e.clientcallid),t.setData("clientcallid",e.clientcallid),t.setData("callrefid",e.callrefid),t.setData("callstate",e.callstate),t.data.callControls.end&&t.setData("forceEndIcon",!0),Zoho.PhoneBridge.CallsArray[Zoho.PhoneBridge.CallsArray.indexOf(e.orgid+"_clicktodial")]=e.clientcallid;else if(-1!=Zoho.PhoneBridge.CallsArray.indexOf(e.orgid+"_clicktodial")&&"agentdialed"==e.callstate&&"outgoing"==e.callDirection){var t=document.getElementById("call-"+e.clientcallid).component;e.callrefid&&(t.setData("clientcallid",e.clientcallid),t.setData("callrefid",e.callrefid)),t.setData("callstate",e.callstate)}else if("missed"!=e.callstate&&e.callerdetails&&("ended"!=e.callstate||0!=e.callduration)&&Zoho.PhoneBridge.CallsArray.length<5){var a=PhoneBridgeUtil.getCallPopDiv(e),i={};if(e.callerdetails.phonenumber&&(e.phonenumber=e.callerdetails.phonenumber),e.callerdetails.recordexist?e.recordexist=!0:e.recordexist=!1,e.callduration&&(e.duration=e.callduration),"answered"==e.callstate&&(e.answeredtime=(new Date).getTime()),"clicktodial"==e.callstate&&(e.childcallstate=e.childcallstate,e.isCTD=!0),i[e.servicename]={},i[e.servicename][e.serviceid]={},i[e.servicename][e.serviceid].portalname=e.portalname,i[e.servicename][e.serviceid].callerdetails=e.callerdetails,e.enabledServicesMap=PhoneBridgeUtil.multiOrgData[e.orgid].enabledServicesMap,e.searchdata=i,Lyte.Component.render("call-pop",e,"#"+a.id),$(":button, a, li, .zpb-additionalInfo, .zpb-relatedInfo, .zpb-callActionIcon, .zpb-followUpAddTxt, .zpb-callDoneBtn, .zpb-answerCallDesc, .zpb-endCallDesc, .zpb-answerButton, .zpb-endButton, .zpb-callControlOptions,textarea, .preventDrag").mousedown((function(e){e.stopPropagation()})),pbTabManager.ismaster&&!e.isInternalCall&&PhoneBridgeUtil.searchCallerInAllServices(e.orgid,e.clientcallid,e.callrefid,!1,e),pbTabManager.ismaster&&e.associatedCallerDetails&&Object.keys(e.associatedCallerDetails).length>0&&PhoneBridgeUtil.searchCallerInAllServices(e.orgid,"associated_"+e.clientcallid,e.callrefid,!0,e),document.getElementById("callBarDiv").style.display="none",l.adjustMultiCallPopup(),"customerdialed"==e.callstate&&"1000.000005"===PhoneBridgeUtil.multiOrgData[e.orgid].providerId){var o=(t=document.getElementById("call-"+e.clientcallid).component).getData("callControls");(r=JSON.parse(JSON.stringify(o))).end=!1,t.setData("callControls",r)}}l.sendCurrentCallsDetailsToParent(),document.getElementById("multiCallDiv").style.visibility="visible"}else{if("answered"===(t=document.getElementById("call-"+e.clientcallid).component).data.callstate&&"ended"!==e.callstate&&"transferended"!==e.callstate){if("transferattended"===e.callstate){t.setData("callerdetails",e.callerdetails);var n=t.getData("searchdata");try{n[e.servicename][e.serviceid].callerdetails=e.callerdetails,t.setData("phonenumber",e.callerdetails.phonenumber)}catch(e){console.log("call transfer failed due to "+e)}t.setData("searchdata",n),l.saveCallerSearch(e),setTimeout((()=>Zoho.PhoneBridge.UI.adjustMultiCallPopup()),1e3)}return}if("clicktodial"==e.clientcallid&&-1!=Zoho.PhoneBridge.CallsArray.indexOf(e.orgid+"_clicktodial"))return void console.log("multiple clicktodial");if(e.clientcallid==e.orgid+"_clicktodial"&&-1!=Zoho.PhoneBridge.CallsArray.indexOf(e.orgid+"_clicktodial")&&"connected"==e.childcallstate)t.setData("childcallstate",e.childcallstate);else if("answered"==e.callstate){if("ended"===t.data.callstate)return;if(t.setData("answeredtime",(new Date).getTime()),t.setData("callstate","answered"),"incoming"===e.callDirection&&"1000.000005"===PhoneBridgeUtil.multiOrgData[e.orgid].providerId&&"true"!==localStorage.getItem(e.callrefid+"answer")){var r;o=t.getData("callControls");(r=JSON.parse(JSON.stringify(o))).end=!1,t.setData("callControls",r)}}else"ended"==e.callstate&&0!=e.callduration?(t.setData("callduration",e.callduration),t.setData("callstate","ended")):"transferended"===e.callstate?(t.setData("isGoneState",!0),t.setData("callstate","ended")):"missed"==e.callstate||0==e.callduration&&"ended"==e.callstate?(l.closeCall(e.clientcallid),e.errorpopup&&(PhoneBridgeUtil.showErrorPopup(e.title,e.message),e.errorpopup=!1)):t.setData("callstate",e.callstate)}e.errorpopup&&(PhoneBridgeUtil.showErrorPopup(e.title,e.message),l.closeCall(e.clientcallid)),Zoho.PhoneBridge.CallsArray.length>0?("ended"===e.callstate&&t&&!t.getData("isGoneState")?(pbTabManager.incall=!1,window.BroadcastChannel&&pbTabManager.channeltosend.postMessage("noincall")):(window.BroadcastChannel&&pbTabManager.channeltosend.postMessage(JSON.stringify({incall:!0})),pbTabManager.incall=!0),t&&t.getData("isGoneState")&&t.setData("isGoneState",!1)):localStorage.removeItem("incall")},saveCallerSearch:function(e){var t=jQuery.extend(!0,{},document.getElementById("call-"+e.clientcallid).component.data.searchdata),a={};if(t.hasOwnProperty(e.servicename)?a[e.servicename]=t[e.servicename]:a[e.servicename]={},a[e.servicename][e.serviceid]={},a[e.servicename][e.serviceid].portalname=e.portalname,a[e.servicename][e.serviceid].callerdetails=e.callerdetails,t[e.servicename]=a[e.servicename],document.getElementById("call-"+e.clientcallid).component.setData("searchdata",t),document.getElementById("call-"+e.clientcallid).component.setData("callactionJson",Zoho.PhoneBridge.UI.getCallActionJson(e.orgid,t)),document.getElementById("call-"+e.clientcallid).component.setData("followupJson",Zoho.PhoneBridge.UI.getFollowUpJson(e.orgid,t)),e.hasOwnProperty("servicesCallBackParam")){var i=jQuery.extend(!0,{},document.getElementById("call-"+e.clientcallid).component.data.servicesCallBackParam);for(var l in e.servicesCallBackParam)i[l]=e.servicesCallBackParam[l];document.getElementById("call-"+e.clientcallid).component.setData("servicesCallBackParam",i)}},updateCallerSearch(e){var t=jQuery.extend({},document.getElementById("call-"+e.clientcallid).component.data.searchdata),a={};if(t.hasOwnProperty(e.servicename)?a[e.servicename]=t[e.servicename]:a[e.servicename]={},a[e.servicename][e.serviceid]={},a[e.servicename][e.serviceid].portalname=e.portalname,a[e.servicename][e.serviceid].callerdetails=e.callerdetails,t[e.servicename]=a[e.servicename],Lyte.Component.set(document.getElementById("call-"+e.clientcallid).component.data,"searchdata",t),Lyte.Component.set(document.getElementById("call-"+e.clientcallid).component.data,"callactionJson",Zoho.PhoneBridge.UI.getCallActionJson(e.orgid,t)),Lyte.Component.set(document.getElementById("call-"+e.clientcallid).component.data,"followupJson",Zoho.PhoneBridge.UI.getFollowUpJson(e.orgid,t)),e.hasOwnProperty("servicesCallBackParam")){var i=jQuery.extend(!0,{},document.getElementById("call-"+e.clientcallid).component.data.servicesCallBackParam);for(var l in e.servicesCallBackParam)i[l]=e.servicesCallBackParam[l];document.getElementById("call-"+e.clientcallid).component.setData("servicesCallBackParam",i)}},adjustMultiCallPopup:function(e,t,a){var i=document.getElementById("preferencesDiv").offsetHeight>0,l=document.getElementById("errorPopup").offsetHeight>0,o=0!=Object.keys(Zoho.PhoneBridge.CurrentHeadless).length,n="none"!==document.getElementById("providerIframeDiv").style.display,r=document.getElementById("preferencelistdiv").offsetHeight>0,s="none"!==document.getElementById("callBarDiv").style.display;if(!(i||l||o||n||s)){var d={action:"openpopup",type:"callpopup"};e=e||0;var c=document.getElementById("multiCallDiv").offsetHeight;if(t&&(c=c>t?c:t),r){var p=document.getElementById("preferencelistdiv").offsetHeight;p>c&&(c=p)}var u=c+100+"px",g=document.getElementById("multiCallDiv").offsetWidth+75+e+"px",m=a||offsetLeft-75;null==offsetLeft?(d.height=u,d.width=g,d.isHebrew=COMMON_UTILS.isHebrew(),d.cssText="color-scheme:none; border-width:0px; position:fixed; z-index:400;right:0px;bottom:26px;height:"+u+";width:"+g+";"):d.cssText="color-scheme:none; border-width:0px; position:fixed; z-index:400;bottom:26px;left:"+m+"px;height:"+u+";width:"+g+";",COMMON_UTILS.sendMessageToParentWindow(d)}},getRandomBackgroundPosition:function(){return-1==e.backgroundRandomNumber&&(e.backgroundRandomNumber=Math.floor(10*Math.random())),"background-position: -"+(e.backgroundRandomNumber%5*102+2)+"px -"+110*Math.floor(e.backgroundRandomNumber/5)+"px;"},showCallDesc:function(){var t=document.getElementById("CallDescription");t.style.display="block",e.CallDesc&&(t.value=e.CallDesc)},resetincall:function(){pbTabManager.incall=!1,window.BroadcastChannel&&pbTabManager.channeltosend.postMessage("noincall")},getCallActionJson:function(e,t){var a={};return PhoneBridgeUtil.multiOrgData[e].headlessJson&&t&&$.each(PhoneBridgeUtil.multiOrgData[e].headlessJson,(function(e,i){i&&$.each(i,(function(i,l){if(l){var o=[],n=null;n=t[e]&&t[e][i]&&t[e][i].callerdetails.recordexist?"known":"unknown",$.each(l,(function(e,t){t.action_support!=n&&"both"!=t.action_support||o.push(t)})),0!=o.length&&(a[e]||(a[e]={}),a[e][i]=o)}}))})),a},getFollowUpJson:function(e,t){var a={};return PhoneBridgeUtil.multiOrgData[e].followupJson&&t&&$.each(PhoneBridgeUtil.multiOrgData[e].followupJson,(function(e,i){i&&$.each(i,(function(i,l){if(l){var o=[],n=null;n=t[e]&&t[e][i]&&t[e][i].callerdetails.recordexist?"known":"unknown",$.each(l,(function(e,t){t.action_support!=n&&"both"!=t.action_support||o.push(t)})),0!=o.length&&(a[e]||(a[e]={}),a[e][i]=o)}}))})),a},getFollowUpJsonOld:function(e,t){var a={},i={},l={},o={};return PhoneBridgeUtil.multiOrgData[e].followupJson&&t&&$.each(PhoneBridgeUtil.multiOrgData[e].followupJson,(function(e,a){a&&$.each(a,(function(a,n){n&&t[e]&&t[e][a]&&t[e][a]&&t[e][a].callerdetails.recordexist&&(n.Call&&(i[e]||(i[e]={}),i[e][a]=n.Call),n.Event&&(l[e]||(l[e]={}),l[e][a]=n.Event),n.Task&&(o[e]||(o[e]={}),o[e][a]=n.Task))}))})),a.Call=i,a.Event=l,a.Task=o,a},openHeadless:function(e){e.startsWith("http")||(e="https://"+e);var t=document.createElement("a");t.href=document.referrer,e+=","+t.origin;var a,i={action:"openpopup"};(i.cssText="border-width:0px; position:fixed; z-index:400; top:0; left:0; width:100%; height:100%;",COMMON_UTILS.sendMessageToParentWindow(i),null!=offsetLeft&&(document.getElementById("multiCallDiv").style.left=offsetLeft+"px"),document.getElementById("multiCallDiv").style.bottom="26px",document.getElementById("overlayerdiv").style.display="block",document.getElementById("followup"))?(a=document.getElementById("followup")).setAttribute("src",e):((a=document.createElement("iframe")).setAttribute("src",e),a.setAttribute("id","followup"),a.setAttribute("name","followup"),a.style.cssText="border-width:0px; position:fixed; z-index:400; top:0; left:0; width:100%; height:100%;",a.style.visibility="hidden",document.body.appendChild(a),a.onload=function(){a.style.visibility="visible"})},closeHeadless:function(){var e=document.getElementById("followup");e&&0!=Object.keys(Zoho.PhoneBridge.CurrentHeadless).length&&(Zoho.PhoneBridge.CurrentHeadless={},e.style.visibility="hidden",document.getElementById("overlayerdiv").style.display="none",l.adjustMultiCallPopup(),document.getElementById("multiCallDiv").style.left="",document.getElementById("multiCallDiv").style.bottom="0px")},closeCallpopup:function(){e.OrgId=null,e.CallRefId=null,e.CallState=null,e.ChildCallState=null,e.isclicktodial=!1,e.Number=null,e.CallerDetails={},e.CurrentServiceName=null,e.CurrentServiceId=null,e.AnyRecordExist=!1,e.backgroundRandomNumber=-1,l.closeHeadless(),l.resetincall(),document.getElementById("multiCallDiv").style.visibility="hidden";var t=document.getElementById("preferencesDiv").offsetHeight>0,a=document.getElementById("loginPopup").offsetHeight>0,i=document.getElementById("errorPopup").offsetHeight>0,o="none"!==document.getElementById("providerIframeDiv").style.display;if(!(t||a||i||o)){COMMON_UTILS.sendMessageToParentWindow({action:"closepopup"})}null!=window.PhoneBridgeUtil&&window.PhoneBridgeUtil.is_reload_popup_after_call&&(PhoneBridgeUtil.is_reload_popup_after_call=!1,PhoneBridgeUtil.reloadpopup())},focusCall:function(e){0==document.getElementsByClassName("zpb-currentOpenCall").length&&(document.getElementById("callDiv"+e).classList.remove("zpb-secondCall"),document.getElementById("callDiv"+e).classList.remove("zpb-secondCallIncoming"),$L("#pbContent_"+e).css("display","none"),$L("#callDiv"+e).addClass("zpb-currentOpenCall"),$L("#pbContent_"+e+" .zpb-serviceSideBar").removeClass("zpb-serviceSideBarAnimate"),$L("#pbContent_"+e+" .zpb-serviceSideBar").css("left","0"),$L("#pbContent_"+e).slideDown((function(){$L("#pbContent_"+e+" .zpb-serviceSideBar").addClass("zpb-serviceSideBarAnimate")})),Zoho.PhoneBridge.activeCall=e)},closeCall:function(e){if(-1!=e.indexOf("_clicktodial"))for(var t=document.getElementsByTagName("call-pop"),a=0;a<t.length;a++)t[a].component.data.isCTD&&-1==["customerdialed","answered","ended"].indexOf(t[a].component.data.callstate)&&"outgoing"==t[a].component.data.callDirection&&(e=t[a].component.data.clientcallid);var i=document.getElementById("call-"+e);if(i)if(PhoneBridgeUtil.onCallPopupClose&&PhoneBridgeUtil.onCallPopupClose(i.getData("callrefid")),i.getData("isMiniUI"))i.setData("callstate","missed");else{var o=i.parentElement,n=[e],r=$L(i).find(".parallelCallDiv").find("call-pop")[0];if(r&&r.getData("isMiniUI")){var s=r.getData();if(-1!=["agentdialed","customerdialed","ringing","answered"].indexOf(s.callstate)){s.isMiniUI=!1;var d=document.createElement("DIV");d.id="calldiv-"+s.clientcallid,o.insertAdjacentElement("afterend",d),Lyte.Component.render("call-pop",s,"#"+d.id)}else n.push(s.clientcallid);s.timerData&&clearTimeout(s.timerData)}i.getData("timerData")&&clearInterval(i.getData("timerData")),i.getData("autoCloseTimer")&&clearTimeout(i.getData("autoCloseTimer")),document.getElementById("multiCallDiv").removeChild(o);var c=Zoho.PhoneBridge.CallsArray.indexOf(e);Zoho.PhoneBridge.CallsArray=Zoho.PhoneBridge.CallsArray.filter((function(e){return-1===n.indexOf(e+"")}));var p=null!=Zoho.PhoneBridge.CallsArray[c]?Zoho.PhoneBridge.CallsArray[c]:null!=Zoho.PhoneBridge.CallsArray[c-1]?Zoho.PhoneBridge.CallsArray[c-1]:null;if(null!=p?Zoho.PhoneBridge.UI.focusCall(p):Zoho.PhoneBridge.activeCall=null,l.sendCurrentCallsDetailsToParent(),0==Zoho.PhoneBridge.CallsArray.length){l.resetincall(),document.getElementById("multiCallDiv").style.visibility="hidden";var u=document.getElementById("preferencesDiv").offsetHeight>0,g=document.getElementById("loginPopup").offsetHeight>0,m=document.getElementById("errorPopup").offsetHeight>0,h="none"!==document.getElementById("providerIframeDiv").style.display;if(!(u||g||m||h)){COMMON_UTILS.sendMessageToParentWindow({action:"closepopup"})}null!=window.PhoneBridgeUtil&&window.PhoneBridgeUtil.is_reload_popup_after_call&&(PhoneBridgeUtil.is_reload_popup_after_call=!1,PhoneBridgeUtil.reloadpopup())}for(a=0;a<Zoho.PhoneBridge.CallsArray.length;a++)document.getElementById("call-"+Zoho.PhoneBridge.CallsArray[a]).setAttribute("data-pbqa","popup"+a)}},closeallCallpopup:function(e,t){var a={actionUrl:"/phonebridge/callpopup/close",params:{providerid:PhoneBridgeUtil.multiOrgData[e].providerId,clientcallid:t},type:"GET",authentication:"cookies",headers:{"X-PB-ORG":e}};COMMON_UTILS.fetchRequest(a)},allCallsData:function(e){var t={functionname:"PhoneBridgeUtil.setNewTabData"};t.tabID=e.tabID,t.arguments={},t.arguments.callData={};for(var a=0;a<Zoho.PhoneBridge.CallsArray.length;a++){var i=document.getElementById("call-"+Zoho.PhoneBridge.CallsArray[a]).component.data;t.arguments.callData[i.clientcallid]=i}t.arguments.tabID=e.tabID;var l=COMMON_UTILS.browserDetect().includes("Mozilla Firefox");window.BroadcastChannel&&pbTabManager.ismaster&&Zoho.PhoneBridge.CallsArray.length>0&&(t.tab=l?"master":"slave",setTimeout((()=>pbTabManager.send(t)),2e3))},addFollowUp:function(e){var t=e.clientcallid,a=e.type,i=e.details;document.getElementById("call-"+t)&&Lyte.arrayUtils(document.getElementById("call-"+t).component.data.followUpResult,"push",{type:a,details:i})}};return{SUBSCRIPTION:{initWMS:a.initWMS},UTILS:{callInfo:{callInfo:function(e,t){for(var a=0;a<Zoho.PhoneBridge.CallsArray.length;a++)if(Zoho.PhoneBridge.CallsArray[a].startsWith(e.orgid)){var i=document.getElementById("call-"+Zoho.PhoneBridge.CallsArray[a]).component.data;if(i.callstate==e.callstate)return i[t]}}}.callInfo},UI:{sendCurrentCallsDetailsToParent:l.sendCurrentCallsDetailsToParent,createPopup:l.createPopup,saveCallerSearch:l.saveCallerSearch,closeCallpopup:l.closeCallpopup,closeCall:l.closeCall,closeallCallpopup:l.closeallCallpopup,adjustMultiCallPopup:l.adjustMultiCallPopup,getCallActionJson:l.getCallActionJson,getFollowUpJson:l.getFollowUpJson,openHeadless:l.openHeadless,closeHeadless:l.closeHeadless,focusCall:l.focusCall,allCallsData:l.allCallsData,addFollowUp:l.addFollowUp},CallProperties:e,CurrentHeadless:{},CallsArray:[],activeCall:null,currentCall:null,CallTimer:t,parentDomain:""}}();var PhoneBridgeUtil=PhoneBridgeUtil||{};PhoneBridgeUtil.jsStaticPath="",PhoneBridgeUtil.cssStaticPath="",PhoneBridgeUtil.imgStaticPath="",this.limit_size=100,this.nextToIDVsData={},this.pageIDOrder=[],this.currentPageId=null,PhoneBridgeUtil.serviceID="",PhoneBridgeUtil.serviceName="",PhoneBridgeUtil.bundleService=void 0,PhoneBridgeUtil.bundleOrgId=void 0,PhoneBridgeUtil.doNotDisturb=!1,PhoneBridgeUtil.clickToDial="cross",PhoneBridgeUtil.isDesktopApp=!1,PhoneBridgeUtil.serviceDisplayName="",PhoneBridgeUtil.lastDialedNumber="",PhoneBridgeUtil.supportedBrowsers=["Google Chrome or Chromium","Mozilla Firefox"],PhoneBridgeUtil.isWMSCreated=!1,PhoneBridgeUtil.telephonyProviderFrames=[],PhoneBridgeUtil.zuid=null,PhoneBridgeUtil.popupHidden=!1,PhoneBridgeUtil.defaultOrg=null,PhoneBridgeUtil.ctdSubOrg=null,PhoneBridgeUtil.orglist=[],PhoneBridgeUtil.zaid=null,PhoneBridgeUtil.pbzaaid=null,PhoneBridgeUtil.nonSetupServicesList=["ZohoChat"],PhoneBridgeUtil.clickToDialOrgs=[],PhoneBridgeUtil.pageInit=!1,PhoneBridgeUtil.multiOrgData={},PhoneBridgeUtil.accesstoken=null,PhoneBridgeUtil.providerId=null,PhoneBridgeUtil.currentStatus=null,PhoneBridgeUtil.statusList=[],PhoneBridgeUtil.madecall=0,PhoneBridgeUtil.showDefaultPhoneIcon=!1,PhoneBridgeUtil.is_reload_popup_after_call=!1,PhoneBridgeUtil.errormute=new Map,PhoneBridgeUtil.errorhold=new Map,PhoneBridgeUtil.awsacw=!1;var dragelem=null,x_pos=0,x_elem=0,offsetLeft=null,draggingenabled=!1;PhoneBridgeUtil.modalTime=50,PhoneBridgeUtil.confirmationPopupProceed=function(){var e={value:"uninstall"};"installed-users"===PhoneBridgeUtil.currentComponent?e.component="installed-users":"installed-providers"===PhoneBridgeUtil.currentComponent?e.component="installed-providers":e.value="UninstallFromProviderSummary",COMMON_UTILS.sendMessageToParentWindow({action:"processConfirmationPrompt",value:e}),setTimeout((()=>{$("pb-conformation-popup")[0].remove()}),2e3)},PhoneBridgeUtil.confirmationPopupClose=function(){var e={value:"closePrompt"};COMMON_UTILS.sendMessageToParentWindow({action:"processConfirmationPrompt",value:e}),setTimeout((()=>{$("pb-conformation-popup")[0].remove()}),2e3)},PhoneBridgeUtil.openWindow=function(e,t,a,i){PhoneBridgeUtil.isDesktopApp&&!i?COMMON_UTILS.sendMessageToParentWindow({action:"whitelistDomain",domain:e,url:t,name:a}):window.open(t,a,"width=800, height=600")},PhoneBridgeUtil.checkForDisabling=function(e,t){var a=!1;switch(e){case"mute":a=PhoneBridgeUtil.errormute.get(t)>5;break;case"hold":a=PhoneBridgeUtil.errorhold.get(t)>5}return a},PhoneBridgeUtil.passErrorInfo=function(e){PhoneBridgeUtil.errormute=new Map(Object.entries(e.mute)),PhoneBridgeUtil.errorhold=new Map(Object.entries(e.hold))},PhoneBridgeUtil.loginToProvider=function(){PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"});var e={actionUrl:"/phonebridge/providerlogin",params:{providerId:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerId},type:"GET",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg()}};COMMON_UTILS.fetchRequest(e).then((function(e){window.open(e,"windowname1","width=800, height=600")}))},PhoneBridgeUtil.showWidget=function(){if("none"!==document.getElementById("providerIframeDiv").style.display)PhoneBridgeUtil.closepopup();else if("undefined"!=typeof zpb_type5){offsetLeft=null,zpb_type5.simpleload_provideriframe(),zpb_config.showHideBasicElements(["providerIframeDiv"]);var e=PhoneBridgeUtil.adjustCssTextForWidget(zpb_type5.cssText);COMMON_UTILS.sendMessageToParentWindow(zpb_config.getMsgForView("widgetPopup","providerIframeDiv",e))}},PhoneBridgeUtil.adjustCssTextForWidget=function(e){var t=e.indexOf("height:"),a=t+7,i=e.indexOf("px",t)-a,l=parseInt(e.substr(a,i)),o=l+10;return e.replace("height:"+l+"px","height:"+o+"px")},PhoneBridgeUtil.initialiseCallPopup=function(){return new Promise((e=>{setTimeout((()=>{PhoneBridgeUtil.closepopup(),e()}),2e3)}))},PhoneBridgeUtil.hideCallPopup=function(){if(!PhoneBridgeUtil.popupHidden){var e={actionUrl:"/phonebridge/iamuserpreference/pauseservice",params:{serviceName:PhoneBridgeUtil.serviceName},type:"POST",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(e).then((function(e){"success"===e&&(PhoneBridgeUtil.popupHidden=!0,PhoneBridgeUtil.showSuccessMessage(I18n.getMsg("phonebridge.callpopup.hidden",PhoneBridgeUtil.serviceDisplayName)))}))}},PhoneBridgeUtil.showCallPopup=function(){if(PhoneBridgeUtil.popupHidden){PhoneBridgeUtil.serviceName;var e={actionUrl:"/phonebridge/iamuserpreference/pauseservice/"+PhoneBridgeUtil.serviceName,type:"DELETE",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(e).then((function(e){"success"===e&&(PhoneBridgeUtil.popupHidden=!1,PhoneBridgeUtil.showSuccessMessage(I18n.getMsg("phonebridge.callpopup.shown",PhoneBridgeUtil.serviceDisplayName)))}))}},PhoneBridgeUtil.disableZV=function(e){var t={actionUrl:"/phonebridge/integration/delete/provider/"+e.proID,type:"DELETE",authentication:"cookies",headers:{"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr"),"X-PB-ORG":e.orgID,"X-SERVICE-ORG":e.serviceID,"X-SERVICE-NAME":e.serviceName}};COMMON_UTILS.fetchRequest(t).then((function(){PhoneBridgeUtil.reloadpopup()}))},PhoneBridgeUtil.showPreferenceList=function(){if(PhoneBridgeUtil.defaultOrg){var e=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg];if(e&&e.isLoginFormPresent&&PhoneBridgeUtil.currentStatus&&"phonelogin"===PhoneBridgeUtil.currentStatus.statustype)zpb_config.showUserFrameView("loginPopup");else if(e&&e.isStatusPresent){var t=function(){zpb_config.showUserFrameView("statusOptions",null,null,null,Zoho.PhoneBridge.UI.adjustMultiCallPopup)};if("block"===document.getElementById("callBarDiv").style.display)"block"!==document.getElementById("preferencelistdiv").style.display?zpb_config.showUserFrameView("statusOptions"):document.getElementById("preferencelistdiv").style.display="none";else{t=function(){zpb_config.showUserFrameView("statusOptions")};var a="block"!==document.getElementById("preferencelistdiv").style.display?t:null;PhoneBridgeUtil.closepopup(a)}}else if(e&&e.isPrefFormPresent)if("ZohoOne"===PhoneBridgeUtil.serviceName||"CRMPlus"===PhoneBridgeUtil.serviceName)zpb_config.showUserFrameView("preferencePopup");else{var i="block"!==document.getElementById("preferencelistdiv").style.display?function(){zpb_config.showUserFrameView("defaultStatusOptionsplusPreference")}:null;PhoneBridgeUtil.closepopup(i)}else if("ZohoOne"!==PhoneBridgeUtil.serviceName&&"CRMPlus"!==PhoneBridgeUtil.serviceName){l=function(){zpb_config.showUserFrameView("defaultStatusOptions")},o="block"!==document.getElementById("preferencelistdiv").style.display?l:null;PhoneBridgeUtil.closepopup(o)}}else{var l=function(){zpb_config.showUserFrameView("defaultStatusOptions")},o="block"!==document.getElementById("preferencelistdiv").style.display?l:null;PhoneBridgeUtil.closepopup(o)}},PhoneBridgeUtil.postIntegrationProcess=function(){"in-progress"!==PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus&&"wrap-up-time"!==PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus||!1!==pbTabManager.istabincall()||PhoneBridgeUtil.updateUserStatus("1",!1,!0,PhoneBridgeUtil.defaultOrg)},PhoneBridgeUtil.updateUserStatus=function(e,t,a,i){var l={actionUrl:"/phonebridge/userstatus",params:{status:e,isDuringCall:t=t||!1,isRaiseRequestNeeded:a=0!=a||a,providerID:PhoneBridgeUtil.multiOrgData[i].providerId,phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr")},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":i,"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(l)},PhoneBridgeUtil.loginLaterProcess=function(){var e={actionUrl:"/phonebridge/providerlogin/later",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr")},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(e),PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"})},PhoneBridgeUtil.getIVRData=function(){var e={actionUrl:"/phonebridge/config/ivrdata",params:{},type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(e).then((function(e){COMMON_UTILS.sendMessageToParentWindow({action:"IVR",getIvrData:e})}))},PhoneBridgeUtil.getAgentsData=function(){return new Promise((function(e,t){try{var a={actionUrl:"/phonebridge/resources/agents",params:{limit_size:500},type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(a).then((function(t){e(t)}))}catch(e){t()}}))},PhoneBridgeUtil.getActiveCallsData=function(e,t,a){var i={actionUrl:"/phonebridge/config/activecalls",params:{limit:50,search_by:"phone_number",search_value:t,upto:void 0===a?"":a},type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(i).then((function(e){COMMON_UTILS.sendMessageToParentWindow({action:"activeCalls",getActiveCallsData:e})}))},PhoneBridgeUtil.getQueueCallsData=function(e,t,a){var i={actionUrl:"/phonebridge/config/callsinqueue",params:{limit:3,search_by:"phone_number",search_value:t,uptoId:void 0===a?"":a},type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(i).then((function(e){COMMON_UTILS.sendMessageToParentWindow({action:"queueCalls",getQueueCallsData:e})}))},PhoneBridgeUtil.uiPref=function(e,t,a){for(var i="",l=0;l<e.length;l++)i+="<li onclick='selectNum(\""+e[l]+"\");'><span class='dIB fL'>"+e[l]+"</span><span class='f11 mL10 mR10'>(Direct)</span>";if(document.getElementById("numListDiv").innerHTML=i,t)if(a&&a.length>0){var o="";for(l=0;l<a.length;l++)o+="<li onclick='selectCallerId(\""+a[l]+"\")'>"+a[l]+"</li>";document.getElementById("callerIdList").innerHTML=o,a.length>10&&(document.getElementById("searchli").innerHTML='<input type ="text" onkeyup="SearchList()" onclick=prvDef(event) id="searchnum" class="callerListSearch" placeholder="Search number...">'),document.getElementById("browserOption").style.display="block"}else document.getElementById("browserOption").style.display="block",$("#browserOptionDiv").remove();else document.getElementById("browserOption").style.display="none";document.getElementById("preferencesDiv").style.display="block"},PhoneBridgeUtil.showSuccessMessage=function(e){var t={action:"showSuccessMessage",data:e};COMMON_UTILS.sendMessageToParentWindow(t)},PhoneBridgeUtil.showSuccessPopup=function(e){var t={action:"showSuccessPopup",data:e};COMMON_UTILS.sendMessageToParentWindow(t)},PhoneBridgeUtil.showErrorPopup=function(e,t){document.getElementById("overlayerdiv").style.display="block",document.getElementById("errorTitle").innerHTML=e,document.getElementById("errorMsg").innerHTML=t,document.getElementById("errorPopup").style.display="block",COMMON_UTILS.isEmpty(e)?document.getElementById("errorTitle").style.display="none":document.getElementById("errorTitle").style.display="block";var a={action:"openpopup",cssText:"border-width:0px; position:fixed; z-index:400; top:0; left:0; width:100%; height:100%;"};COMMON_UTILS.sendMessageToParentWindow(a)},PhoneBridgeUtil.changeCallControl=function(e,t){var a=e.split(","),i=a[0],l=a[1],o=document.getElementById("callControls_"+i).querySelector(l);switch(t){case"error":o.classList.remove("active");break;case"disable":o.classList.remove("active"),o.style.pointerEvents="none"}},PhoneBridgeUtil.showCCError=function(e){PhoneBridgeUtil.changeCallControl(e,"error")},PhoneBridgeUtil.showError=function(e){Zoho.PhoneBridge.UI.closeCall(PhoneBridgeUtil.defaultOrg+"_clicktodial"),PhoneBridgeUtil.showErrorPopup("",e)},PhoneBridgeUtil.showErrorAloneInPresentTab=function(e){PhoneBridgeUtil.showErrorPopup("",e)},PhoneBridgeUtil.showErrorInAllTabs=function(e){PhoneBridgeUtil.showErrorAloneInPresentTab(e),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.showErrorAloneInPresentTab",arguments:e})},PhoneBridgeUtil.openLoginPopup=function(e){e.hasOwnProperty("orgId")&&e.orgId==PhoneBridgeUtil.defaultOrg&&(Zoho.PhoneBridge.UI.closeallCallpopup(PhoneBridgeUtil.defaultOrg,PhoneBridgeUtil.defaultOrg+"_clicktodial"),zpb_config.showUserFrameView("loginPopup"))},PhoneBridgeUtil.afterLogin=function(){PhoneBridgeUtil.showSuccessMessage(I18n.getMsg("phonebridge.login.success",PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.getCurrentOrg()].providerDisplayName)),PhoneBridgeUtil.pageInit=!1,PhoneBridgeUtil.integrationCheck(),setTimeout(PhoneBridgeUtil.openPrefPopup,2e3,{orgId:PhoneBridgeUtil.getCurrentOrg()})},PhoneBridgeUtil.logout=function(){if(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn=!1,pbTabManager.ismaster){var e={actionUrl:"/phonebridge/providerlogin/logout",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr")},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(e)}},PhoneBridgeUtil.RCLogout=function(){PhoneBridgeUtil.setStatusForLogout(),PhoneBridgeUtil.showStatusIcon(PhoneBridgeUtil.defaultOrg)},PhoneBridgeUtil.openPrefPopup=function(e){e.orgId==PhoneBridgeUtil.defaultOrg&&(Zoho.PhoneBridge.UI.closeCall(PhoneBridgeUtil.defaultOrg+"_clicktodial"),zpb_config.showUserFrameView("preferencePopup"))},PhoneBridgeUtil.openCallsInConPopup=function(){zpb_config.showUserFrameView("callsInConvPopup")},PhoneBridgeUtil.openCallsInQueuePopup=function(){zpb_config.showUserFrameView("callsInQueuePopup")},PhoneBridgeUtil.showTopErrorMsg=function(e){document.getElementById("topErrorMsg").innerHTML=e,document.getElementById("topErrorPopup").style.display="block"},PhoneBridgeUtil.hideTopErrorMsg=function(){document.getElementById("topErrorPopup").style.display="none"},PhoneBridgeUtil.openHelp=function(e){window.open(e,"help","toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,resizeable=yes,menubar=no,width=1040,height=600")},PhoneBridgeUtil.cancelPref=function(){document.getElementById("userPreferencePopup").ltProp("show",!1),PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"})},PhoneBridgeUtil.cancelUkPopUp=function(){document.getElementById("UKBundlePopUp1").ltProp("show",!1),PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"})},PhoneBridgeUtil.cancelCallerId=function(){PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"})},PhoneBridgeUtil.closeErrorPopup=function(){PhoneBridgeUtil.closepopup(),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.closepopup"})},PhoneBridgeUtil.closepopup=function(e){document.getElementById("overlayerdiv").style.display="none",document.getElementById("errorPopup").style.display="none",document.getElementById("loginPopup").style.display="none",document.getElementById("preferencesDiv").style.display="none",document.getElementById("topErrorPopup").style.display="none",document.getElementById("preferencelistdiv").style.display="none",document.getElementById("floatingDialpad").style.display="none",document.getElementById("floatingDialpad1").style.display="none",document.getElementById("addCallerIdDiv").style.display="none",document.getElementById("callBarDiv").style.display="none",$("#providerIframeDiv").slideUp(null,null,(function(){if(document.getElementById("multiCallDiv").offsetHeight>0&&"hidden"!=document.getElementById("multiCallDiv").style.visibility)Zoho.PhoneBridge.UI.adjustMultiCallPopup();else{COMMON_UTILS.sendMessageToParentWindow({action:"closepopup"})}e&&e()}))},PhoneBridgeUtil.reloadpopup=function(){COMMON_UTILS.sendMessageToParentWindow({action:"reloadpopup"})},PhoneBridgeUtil.manageClickToDial=function(e){COMMON_UTILS.sendMessageToParentWindow({action:"defineZPBCustomTag",callbuttonallowed:e.callButtonAllowed&&!PhoneBridgeUtil.popupHidden})},PhoneBridgeUtil.isCallButtonAllowed=function(e){return PhoneBridgeUtil.multiOrgData[e].callButtonAllowed&&!PhoneBridgeUtil.popupHidden},PhoneBridgeUtil.showWidgetIcon=function(e){e==PhoneBridgeUtil.defaultOrg&&COMMON_UTILS.sendMessageToParentWindow({action:"showWidgetIcon"})},PhoneBridgeUtil.checkAndShowStatusIcon=function(e){PhoneBridgeUtil.multiOrgData[e].showPBSettingsIcon&&PhoneBridgeUtil.showStatusIcon(e)},PhoneBridgeUtil.showStatusIcon=function(e){e==PhoneBridgeUtil.defaultOrg&&(COMMON_UTILS.sendMessageToParentWindow({action:"showStatusIcon",isLoggedIn:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn,userStatus:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus,has_access:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].showPBSettingsIcon,preference_option:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isPrefFormPresent,currentStatus:PhoneBridgeUtil.currentStatus,statusList:PhoneBridgeUtil.statusList}),COMMON_UTILS.sendMessageToParentWindow({action:"showCTDialpadIcon",showCTDIcon:PhoneBridgeUtil.isCallButtonAllowed(PhoneBridgeUtil.defaultOrg),isLoggedIn:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn,userStatus:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus,currentStatus:PhoneBridgeUtil.currentStatus}),PhoneBridgeUtil.multiOrgData[e].showUkPopUp&&(zpb_config.showUserFrameView("UKBundlePopUp"),PhoneBridgeUtil.multiOrgData[e].showUkPopUp=!1))},PhoneBridgeUtil.hideStatusIcon=function(e){e==PhoneBridgeUtil.defaultOrg&&(PhoneBridgeUtil.showDefaultPhoneIcon&&"ZohoOne"!==PhoneBridgeUtil.serviceName||COMMON_UTILS.sendMessageToParentWindow({action:"hideStatusIcon"}),COMMON_UTILS.sendMessageToParentWindow({action:"showCTDialpadIcon",showCTDIcon:PhoneBridgeUtil.isCallButtonAllowed(PhoneBridgeUtil.defaultOrg),isLoggedIn:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn,userStatus:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus,currentStatus:PhoneBridgeUtil.currentStatus,showPopup:!PhoneBridgeUtil.popupHidden}))},PhoneBridgeUtil.showDefaultStatusIcon=function(){"ZohoOne"!==PhoneBridgeUtil.serviceName&&(PhoneBridgeUtil.showDefaultPhoneIcon=!0,COMMON_UTILS.sendMessageToParentWindow({action:"showDefaultStatusIcon"}))},PhoneBridgeUtil.toggleCTDialpad=function(e){if("none"===document.getElementById("floatingDialpad").style.display&&"none"===document.getElementById("floatingDialpad1").style.display){COMMON_UTILS.toggleDarkmode(e),PhoneBridgeUtil.closepopup((function(){PhoneBridgeUtil.showCTDialpad()}))}else PhoneBridgeUtil.closeCTDialpad()},PhoneBridgeUtil.showCTDialpad=function(){if("InBuilt"===PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].providerName)document.getElementById("floatingDialpad1").style.display="block",zpb_config.showUserFrameView("dialpadUserListing"),Lyte.Component.render("dialpad-user-listing","#floatingDialpad1");else{document.getElementById("floatingDialpad").style.display="block";var e={action:"openpopup",type:"dialpad"},t=260;Zoho.PhoneBridge.CallsArray.length>0&&(t=document.getElementById("multiCallDiv").offsetWidth>260?document.getElementById("multiCallDiv").offsetWidth+75:260),e.cssText="border-width:0px; position:fixed; z-index:400; bottom:28px; width:"+t+"px; height:373px;",e.cssText+=COMMON_UTILS.isHebrew()?"left:0px;":"right:0px;",COMMON_UTILS.sendMessageToParentWindow(e),document.getElementById("dialInput").focus()}},PhoneBridgeUtil.closeCTDialpad=function(){document.getElementById("floatingDialpad").style.display="none",document.getElementById("floatingDialpad1").style.display="none",document.getElementById("dialInput").value="",PhoneBridgeUtil.closepopup()},PhoneBridgeUtil.callfromdialpad=function(e){var t={};if(void 0===e){var a=document.getElementById("dialInput").value;a=a.trim()}if(""==a&&""!=PhoneBridgeUtil.lastDialedNumber&&(a=PhoneBridgeUtil.lastDialedNumber,$("#dialInput")[0].value=PhoneBridgeUtil.lastDialedNumber),void 0!==a)(t={}).number=a;else if(void 0===e.phoneNumber)t.toUser=e.referenceName;else{var i=e.phoneNumber.trim();t.number=i}""===a&&void 0===e.referenceName&&void 0===e.phoneNumber||(PhoneBridgeUtil.lastDialedNumber=a,PhoneBridgeUtil.defaultOrg?PhoneBridgeUtil.clicktodial(t):PhoneBridgeUtil.nonSetupCTD(t),PhoneBridgeUtil.closeCTDialpad())},PhoneBridgeUtil.clicktodial=function(e){if(pbTabManager.ismaster){var t=e.org||PhoneBridgeUtil.defaultOrg,a=PhoneBridgeUtil.multiOrgData[t];if(!a.providerId)return;var i=null;if(a.phoneNumber&&(i=a.phoneNumber,a.outgoingCallerId&&(i=a.outgoingCallerId)),"browser"===a.phoneNumberType){var l=COMMON_UTILS.browserDetect();if("ZohoBigin"==PhoneBridgeUtil.serviceName&&PhoneBridgeUtil.supportedBrowsers.push("Apple Safari"),!(PhoneBridgeUtil.supportedBrowsers.indexOf(l)>=0))return PhoneBridgeUtil.openPrefPopup({orgId:PhoneBridgeUtil.defaultOrg}),void PhoneBridgeUtil.showTopErrorMsg(I18n.getMsg("phonebridge.error.outgoing.browser.version",l)+I18n.getMsg("phonebridge.error.outgoing.choose.another"));pbTabManager.incall=!0;try{window.BroadcastChannel&&pbTabManager.channeltosend.postMessage(JSON.stringify("incall","outbound")),localStorage.setItem("incall","outbound")}catch(e){}i="browser",a.outgoingCallerId&&(i=a.outgoingCallerId),PhoneBridgeUtil.madecall=!0,PhoneBridgeUtil.madecall++}else if("softphone"===a.phoneNumberType){i="softphone";var o=COMMON_UTILS.removeSpecialChars(e.number);o=-1!=o.indexOf("+")?o.replace("+","%2B"):o,COMMON_UTILS.openUrl({URL:"rcmobile://call?number="+o})}var n={};n.providerID=a.providerId,n.callMadeServiceName=e.serviceName||PhoneBridgeUtil.serviceName,n.callMadeServiceID=e.serviceID||PhoneBridgeUtil.serviceID,n.fromNumber=i;var r=PhoneBridgeUtil.getCurrentOrg();e.number?(n.toNumber=COMMON_UTILS.removeSpecialChars(e.number),PhoneBridgeUtil.multiOrgData[r].toUserPresent=!1):(n.toUser=e.toUser,PhoneBridgeUtil.multiOrgData[r].toUserPresent=!0),e.module&&(n.module=e.module),e.recordid&&(n.recordID=e.recordid),e.callbackparam&&(n.callBackParam=e.callbackparam),e.name&&(n.name=e.name),e.companyname&&(n.companyname=e.companyname);var s={actionUrl:"/phonebridge/calloperations/clicktodial",params:n,type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e.org||PhoneBridgeUtil.defaultOrg,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(s).then((function(t){if(t.execScript&&!COMMON_UTILS.isEmptyObject(t.execScript)){var a=t.execScript;a.ARGUMENTS.orgId=e.org||PhoneBridgeUtil.defaultOrg,a.ARGUMENTS.messageId=(new Date).getTime()+"",COMMON_UTILS.executeFunctionByName(a.FUNCTIONNAME,window,a.ARGUMENTS),a.allClientTabs&&pbTabManager.send({key:"Msg",functionname:a.FUNCTIONNAME,arguments:a.ARGUMENTS})}}))}else{("ZohoOne"!==PhoneBridgeUtil.serviceName&&"CRMPlus"!==PhoneBridgeUtil.serviceName||!e.serviceName)&&(e.serviceName=PhoneBridgeUtil.serviceName,e.serviceID=PhoneBridgeUtil.serviceID),e.org=PhoneBridgeUtil.defaultOrg;var d={functionname:"PhoneBridgeUtil.clicktodial",arguments:e,tab:"master"};pbTabManager.send(d)}},PhoneBridgeUtil.nonSetupCTD=function(e){if(pbTabManager.ismaster){var t=PhoneBridgeUtil.clickToDialOrgs[0];PhoneBridgeUtil.ctdSubOrg=t;var a=PhoneBridgeUtil.multiOrgData[t],i=a.phoneNumber?a.phoneNumber:null;if("softphone"===a.phoneNumberType){i="softphone";var l=COMMON_UTILS.removeSpecialChars(e.number);l=-1!=l.indexOf("+")?l.replace("+","%2B"):l,COMMON_UTILS.openUrl({URL:"rcmobile://call?number="+l})}else{if("browser"===a.phoneNumberType){if("ZohoBigin"==PhoneBridgeUtil.serviceName&&PhoneBridgeUtil.supportedBrowsers.push("Apple Safari"),-1==PhoneBridgeUtil.supportedBrowsers.indexOf(COMMON_UTILS.browserDetect()))return PhoneBridgeUtil.openPrefPopup({ctdSubOrg:t}),void PhoneBridgeUtil.showTopErrorMsg(I18n.getMsg("phonebridge.error.outgoing.browser.version",browsername)+I18n.getMsg("phonebridge.error.outgoing.choose.another"));try{pbTabManager.incall=!0,window.BroadcastChannel&&pbTabManager.channeltosend.postMessage(JSON.stringify("incall","outbound")),localStorage.setItem("incall","outbound")}catch(e){Zoho.PhoneBridge.UITLS.print("Could not incall")}i="browser",PhoneBridgeUtil.madecall++}var o={};o.providerID=a.providerId,o.callMadeServiceName=e.serviceName||PhoneBridgeUtil.serviceName,o.callMadeServiceID=e.serviceID||PhoneBridgeUtil.serviceID,o.fromNumber=i,o.toNumber=COMMON_UTILS.removeSpecialChars(e.number),e.module&&(o.module=e.module),e.recordid&&(o.recordID=e.recordid),e.callbackparam&&(o.callBackParam=e.callbackparam),e.name&&(o.name=e.name),e.companyname&&(o.companyname=e.companyname);var n={actionUrl:"/phonebridge/calloperations/clicktodial",params:o,type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e.org||t,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(n).then((function(a){if(a.execScript&&!COMMON_UTILS.isEmptyObject(a.execScript)){var i=a.execScript;i.ARGUMENTS.orgId=e.org||t,COMMON_UTILS.executeFunctionByName(i.FUNCTIONNAME,window,i.ARGUMENTS)}}))}}else{e.serviceName=PhoneBridgeUtil.serviceName,e.serviceID=PhoneBridgeUtil.serviceID,e.org=PhoneBridgeUtil.clickToDialOrgs[0];var r={functionname:"PhoneBridgeUtil.clicktodial",arguments:e,tab:"master"};pbTabManager.send(r)}},PhoneBridgeUtil.savePreference=function(e){var t={actionUrl:"/phonebridge/phonenumberpreference",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),providerID:PhoneBridgeUtil.multiOrgData[e].providerId,phoneNumberType:PhoneBridgeUtil.multiOrgData[e].phoneNumberType,phoneNumber:PhoneBridgeUtil.multiOrgData[e].phoneNumber},type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e,"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(t).then((function(e){"success"==e&&(PhoneBridgeUtil.closepopup(),PhoneBridgeUtil.showSuccessMessage(I18n.getMsg("phonebridge.preference.success")))}))},PhoneBridgeUtil.updatePreference=function(e){PhoneBridgeUtil.closepopup();var t=PhoneBridgeUtil.multiOrgData[e.orgid].phoneNumberType;PhoneBridgeUtil.multiOrgData[e.orgid].phoneNumberType=e.PHONENUMBERTYPE,PhoneBridgeUtil.multiOrgData[e.orgid].phoneNumber=e.PHONENUMBER;var a=PhoneBridgeUtil.multiOrgData[e.orgid].phoneNumberType.toUpperCase();if("browser"!=PhoneBridgeUtil.multiOrgData[e.orgid].phoneNumberType&&"browser"==t&&PhoneBridgeUtil.destroyWebRTC(e.orgid),PhoneBridgeUtil.multiOrgData[e.orgid].answerAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("answer"),PhoneBridgeUtil.multiOrgData[e.orgid].endAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("end"),PhoneBridgeUtil.multiOrgData[e.orgid].declineAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("decline"),PhoneBridgeUtil.multiOrgData[e.orgid].muteAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("mute"),PhoneBridgeUtil.multiOrgData[e.orgid].holdAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("hold"),PhoneBridgeUtil.multiOrgData[e.orgid].keypressAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("keypress"),PhoneBridgeUtil.multiOrgData[e.orgid].transferAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("transfer"),PhoneBridgeUtil.multiOrgData[e.orgid].parallelcallAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("parallelcall"),PhoneBridgeUtil.multiOrgData[e.orgid].mergeandleaveAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[e.orgid].mergeAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("merge"),PhoneBridgeUtil.multiOrgData[e.orgid].leaveAllowed=PhoneBridgeUtil.multiOrgData[e.orgid].callControlFeature[a].includes("leave"),pbTabManager.ismaster&&"browser"!==t){if("browser"==e.PHONENUMBERTYPE&&e.EXECSCRIPT&&!COMMON_UTILS.isEmptyObject(e.EXECSCRIPT)){var i=JSON.parse(e.EXECSCRIPT);COMMON_UTILS.executeFunctionByName(i.FUNCTIONNAME,window,i.ARGUMENTS)}}else pbTabManager.ismaster||"browser"!==t||PhoneBridgeUtil.destroyWebRTC(e.orgid)},PhoneBridgeUtil.opencalleridpopup=function(e){e.orgId===PhoneBridgeUtil.defaultOrg&&zpb_config.showUserFrameView("calleridpopup")},PhoneBridgeUtil.saveDesc=function(e,t,a){var i={};i.description=t,i.providerID=PhoneBridgeUtil.multiOrgData[e].providerId,i.callRefID=a;var l={actionUrl:"/phonebridge/calloperations/updatecall",params:i,type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(l)},PhoneBridgeUtil.updateNotify=function(e,t){t.providerID=PhoneBridgeUtil.multiOrgData[e].providerId;var a={actionUrl:"/phonebridge/calloperations/updatecaller",params:t,type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(a)},PhoneBridgeUtil.updateCallBackParam=function(e,t){t.providerID=PhoneBridgeUtil.multiOrgData[e].providerId;var a={actionUrl:"/phonebridge/calloperations/updateCallBackParam",params:t,type:"POST",authentication:"cookies",headers:{"X-PB-ORG":e,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(a)},PhoneBridgeUtil.searchCallerInAllServices=function(e,t,a,i,l){var o=jQuery.extend({},document.getElementById("call-"+t).component.data.searchdata);for(servicename in PhoneBridgeUtil.multiOrgData[e].enabledServicesMap)for(var n=PhoneBridgeUtil.multiOrgData[e].enabledServicesMap[servicename].portallist,r=0;r<n.length;r++)if("SDPOnPremise"===servicename)PhoneBridgeUtil.searchCallerbyPostMessage(e,t,a);else if(!(o[servicename]&&o[servicename][n[r].serviceid]&&o[servicename][n[r].serviceid].callerdetails)){var s=!0;if(l.regex){var d=document.getElementById("call-"+t).component.data.phonenumber;s=new RegExp(l.regex).test(d)}s&&PhoneBridgeUtil.searchCaller(e,t,a,servicename,n[r].serviceid,i)}},PhoneBridgeUtil.searchCallerbyPostMessage=function(e,t,a){var i=document.getElementById("call-"+t).component.data.phonenumber;COMMON_UTILS.sendMessageToParentWindow({action:"searchCaller",id:a,phonenumber:i})},PhoneBridgeUtil.searchCaller=function(e,t,a,i,l,o){l||(l=PhoneBridgeUtil.multiOrgData[e].enabledServicesMap[i].portallist[0].serviceid);var n=document.getElementById("call-"+t).component.data.phonenumber,r={};r.callRefID=a,r.phoneNumber=n,r.serviceName=i,r.serviceID=l,o&&(r.isAssociatedCallSearch=o);var s={actionUrl:"/phonebridge/calloperations/searchcaller",params:r,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":e,"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(s).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}}))},PhoneBridgeUtil.getHeadLessJson=function(e){if(!PhoneBridgeUtil.multiOrgData[e].headlessJson){var t={actionUrl:"/phonebridge/headless/config",type:"GET",authentication:"cookies",headers:{"X-PB-ORG":e},params:{}};COMMON_UTILS.fetchRequest(t).then((function(t){PhoneBridgeUtil.multiOrgData[e].headlessJson=t.callaction,PhoneBridgeUtil.multiOrgData[e].followupJson=t.followup}))}},PhoneBridgeUtil.answercall=function(e){if(pbTabManager.ismaster){var t=e.orgId,a={};a.providerID=PhoneBridgeUtil.multiOrgData[t].providerId,a.callRefID=e.callRefId,PhoneBridgeUtil.madecall++;var i={actionUrl:"/phonebridge/calloperations/answercall",params:a,type:"POST",headers:{"X-PB-ORG":t,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},authentication:"cookies"};COMMON_UTILS.fetchRequest(i).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){pbTabManager.incall=!0;var t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS);try{window.BroadcastChannel&&pbTabManager.channeltosend.postMessage(JSON.stringify("incall","outbound"))}catch(e){}}}))}else{var l={functionname:"PhoneBridgeUtil.answercall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(l)}},PhoneBridgeUtil.endcall=function(e){if(pbTabManager.ismaster){var t=COMMON_UTILS.formClientCallid(e.orgId+"_"+e.callRefId);PhoneBridgeUtil.errormute.delete(t),PhoneBridgeUtil.errorhold.delete(t);var a=e.orgId,i={};i.providerID=PhoneBridgeUtil.multiOrgData[a].providerId,i.callRefID=e.callRefId,void 0===document.getElementById("call-"+t).component.data.callerdetails.module&&null!=document.getElementById("call-"+t).component.data.callerdetails.name&&(i.name=document.getElementById("call-"+t).component.data.callerdetails.name);var l={actionUrl:"/phonebridge/calloperations/endcall",params:i,type:"POST",headers:{"X-PB-ORG":a,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},authentication:"cookies"};COMMON_UTILS.fetchRequest(l).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS);try{pbTabManager.incall=!1,window.BroadcastChannel&&pbTabManager.channeltosend.postMessage("noincall")}catch(e){}}}))}else{var o={functionname:"PhoneBridgeUtil.endcall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(o)}},PhoneBridgeUtil.initWebRTC=function(e){var t={actionUrl:"/phonebridge/webrtc/init",headers:{"X-PB-ORG":e},params:{providerID:PhoneBridgeUtil.multiOrgData[e].providerId},type:"GET",authentication:"cookies"};COMMON_UTILS.fetchRequest(t).then((function(e){if(e.infoJSON&&!COMMON_UTILS.isEmptyObject(e.infoJSON)){COMMON_UTILS.print("in init response");var t=e.infoJSON;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}else if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}}))},PhoneBridgeUtil.destroyWebRTC=function(e){var t={actionUrl:"/phonebridge/webrtc/destroy",params:{providerID:PhoneBridgeUtil.multiOrgData[e].providerId},headers:{"X-PB-ORG":e},type:"GET",authentication:"cookies"};COMMON_UTILS.fetchRequest(t).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}}))},PhoneBridgeUtil.callcontrolui=function(e){switch(e){case"holdcontrol":(t=$("#zpb_hold")).hasClass("active")?t.removeClass("active"):t.addClass("active");break;case"mutecontrol":(a=$("#zpb_mute")).hasClass("active")?a.removeClass("active"):a.addClass("active");break;case"hold":!(t=$("#zpb_hold")).hasClass("active")&&t.addClass("active");break;case"resume":var t;(t=$("#zpb_hold")).hasClass("active")&&t.removeClass("active");break;case"mute":!(a=$("#zpb_mute")).hasClass("active")&&a.addClass("active");break;case"unmute":var a;(a=$("#zpb_mute")).hasClass("active")&&a.removeClass("active")}},PhoneBridgeUtil.mute=function(){$("#zpb_mute").hasClass("active")?($("#zpb_mute").removeClass("active"),PhoneBridgeUtil.unmutecall()):($("#zpb_mute").addClass("active"),PhoneBridgeUtil.mutecall())},PhoneBridgeUtil.hold=function(){$("#zpb_hold").hasClass("active")?($("#zpb_hold").removeClass("active"),PhoneBridgeUtil.unholdcall()):($("#zpb_hold").addClass("active"),PhoneBridgeUtil.holdcall())},PhoneBridgeUtil.disableElement=function(e){PhoneBridgeUtil.changeCallControl(e,"disable")},PhoneBridgeUtil.mutecall=function(e){var t=COMMON_UTILS.formClientCallid(e.orgId+"_"+e.callRefId);if(pbTabManager.ismaster){if(PhoneBridgeUtil.checkForDisabling("mute",t))return PhoneBridgeUtil.disableElement(t+",.zpb-muteOption"),void pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.disableElement",arguments:t+",.zpb-muteOption"});var a=e.orgId,i={};i.providerID=PhoneBridgeUtil.multiOrgData[a].providerId,i.callRefID=e.callRefId;var l={actionUrl:"/phonebridge/calloperations/mutecall",params:i,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":a}};COMMON_UTILS.fetchRequest(l).then((function(e){var a=!1;if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var i=e.execScript;COMMON_UTILS.executeFunctionByName(i.FUNCTIONNAME,window,i.ARGUMENTS),"PhoneBridgeUtil.showCCError"===e.execScript.FUNCTIONNAME&&(a=!0)}if(a){var l=PhoneBridgeUtil.errormute;if(void 0!==l.get(t)){var o=l.get(t);l.set(t,++o)}else l.set(t,1);pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.showCCError",arguments:t+",.zpb-muteOption"})}else document.getElementById("call-"+t)&&PhoneBridgeUtil.updateMute({clientcallid:t,mute:!0}),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.updateMute",arguments:{clientcallid:t,mute:!0}})}))}else{var o={functionname:"PhoneBridgeUtil.mutecall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(o)}},PhoneBridgeUtil.unmutecall=function(e){var t=COMMON_UTILS.formClientCallid(e.orgId+"_"+e.callRefId);if(pbTabManager.ismaster){var a=e.orgId,i={};i.providerID=PhoneBridgeUtil.multiOrgData[a].providerId,i.callRefID=e.callRefId;var l={actionUrl:"/phonebridge/calloperations/unmutecall",params:i,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":a}};COMMON_UTILS.fetchRequest(l).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var a=e.execScript;COMMON_UTILS.executeFunctionByName(a.FUNCTIONNAME,window,a.ARGUMENTS)}document.getElementById("call-"+t)&&PhoneBridgeUtil.updateMute({clientcallid:t,mute:!1}),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.updateMute",arguments:{clientcallid:t,mute:!1}})}))}else{var o={functionname:"PhoneBridgeUtil.unmutecall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(o)}},PhoneBridgeUtil.holdcall=function(e){var t=COMMON_UTILS.formClientCallid(e.orgId+"_"+e.callRefId);if(pbTabManager.ismaster){if(PhoneBridgeUtil.checkForDisabling("hold",t))return PhoneBridgeUtil.disableElement(t+",.zpb-holdOption"),void pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.disableElement",arguments:t+",.zpb-holdOption"});var a=e.orgId,i={};i.providerID=PhoneBridgeUtil.multiOrgData[a].providerId,i.callRefID=e.callRefId;var l={actionUrl:"/phonebridge/calloperations/holdcall",params:i,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":a}};COMMON_UTILS.fetchRequest(l).then((function(e){var a=!1;if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var i=e.execScript;COMMON_UTILS.executeFunctionByName(i.FUNCTIONNAME,window,i.ARGUMENTS),"PhoneBridgeUtil.showCCError"===e.execScript.FUNCTIONNAME&&(a=!0)}if(a){var l=PhoneBridgeUtil.errorhold;if(void 0!==l.get(t)){var o=l.get(t);l.set(t,++o)}else l.set(t,1);pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.showCCError",arguments:t+",.zpb-holdOption"})}else document.getElementById("call-"+t)&&PhoneBridgeUtil.updateHold({clientcallid:t,hold:!0}),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.updateHold",arguments:{clientcallid:t,hold:!0}})}))}else{var o={functionname:"PhoneBridgeUtil.holdcall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(o)}},PhoneBridgeUtil.unholdcall=function(e){var t=COMMON_UTILS.formClientCallid(e.orgId+"_"+e.callRefId);if(pbTabManager.ismaster){var a=e.orgId,i={};i.providerID=PhoneBridgeUtil.multiOrgData[a].providerId,i.callRefID=e.callRefId;var l={actionUrl:"/phonebridge/calloperations/unholdcall",params:i,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":a}};COMMON_UTILS.fetchRequest(l).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var a=e.execScript;COMMON_UTILS.executeFunctionByName(a.FUNCTIONNAME,window,a.ARGUMENTS)}document.getElementById("call-"+t)&&PhoneBridgeUtil.updateHold({clientcallid:t,hold:!1}),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.updateHold",arguments:{clientcallid:t,hold:!1}})}))}else{var o={functionname:"PhoneBridgeUtil.unholdcall",arguments:{orgId:e.orgId,callRefId:e.callRefId},tab:"master"};pbTabManager.send(o)}},PhoneBridgeUtil.dtmfcall=function(e){if(pbTabManager.ismaster){var t=e.orgId,a={};a.providerID=PhoneBridgeUtil.multiOrgData[t].providerId,a.callRefID=e.callRefId,a.digit=e.digit;var i={actionUrl:"/phonebridge/calloperations/dtmfcall",params:a,type:"POST",headers:{"X-PB-ORG":t,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},authentication:"cookies"};COMMON_UTILS.fetchRequest(i).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var t=e.execScript;COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}}))}else{var l={functionname:"PhoneBridgeUtil.dtmfcall",arguments:{orgId:e.orgId,callRefId:e.callRefId,digit:e.digit},tab:"master"};pbTabManager.send(l)}},PhoneBridgeUtil.raiseActionRequest=function(e,t,a){if(pbTabManager.ismaster){Array.isArray(e)&&(a=e[2],t=e[1],e=e[0]);var i=e.orgId,l=t||{};l.providerID=PhoneBridgeUtil.multiOrgData[i].providerId,l.callRefID=e.callRefId,e.associatedCallRefId&&(l.associatedCallRefId=e.associatedCallRefId);var o={actionUrl:"/phonebridge/calloperations/"+e.actionName,params:l,type:"POST",headers:{"X-PB-ORG":i,"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},authentication:"cookies"};COMMON_UTILS.fetchRequest(o).then((function(e){if(e.execScript&&!COMMON_UTILS.isEmptyObject(e.execScript)){var t=e.execScript;t.ARGUMENTS.orgId=i,COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS)}a&&a()}))}else{var n=Array.prototype.slice.call(arguments,0),r={functionname:"PhoneBridgeUtil.raiseActionRequest",arguments:n,tab:"master"};pbTabManager.send(r)}},PhoneBridgeUtil.loadScripts=function(e,t){if(e.length){var a=PBClient.getFingerPrintUsingFileName(e[0]);PhoneBridgeUtil.loadScript(a,(function(){var a=e.splice(1,e.length);PhoneBridgeUtil.loadScripts(a,t)}))}else t()},PhoneBridgeUtil.loadScript=function(e){var t=e.FILENAME,a=e.CALLBACK,i=e.CALLPRE,l=e.CALLBACKPARAMS?PhoneBridgeUtil.getAsJson(e.CALLBACKPARAMS,e.CALLBACKPARAMS):{},o=e.CALLPREPARAMS?PhoneBridgeUtil.getAsJson(e.CALLPREPARAMS,e.CALLPREPARAMS):{},n=e.CALLBACKFUNCTION;e.orgId&&(l.orgId=e.orgId,o.orgId=e.orgId);COMMON_UTILS.isNotEmpty(i)&&COMMON_UTILS.executeFunctionByName(i,window,o);var r=document.createElement("script");r.onload=r.onreadystatechange=function(){this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onload=this.onreadystatechange=null,COMMON_UTILS.isNotEmpty(a)?COMMON_UTILS.executeFunctionByName(a,window,l):COMMON_UTILS.isNotEmpty(n)&&n())};var s=PBClient.getFingerprintAndCSForFileName(t);r.src=s.cdnurl,PBClient.isIntegrityEnabled&&(r.integrity=s.integrity),r.crossOrigin="anonymous",document.getElementsByTagName("head")[0].appendChild(r)},PhoneBridgeUtil.webRTCcheck=function(e){"browser"===PhoneBridgeUtil.multiOrgData[e].phoneNumberType&&!1===pbTabManager.istabincall()&&PhoneBridgeUtil.initWebRTC(e)},PhoneBridgeUtil.executeScripts=function(e){if(e.exec&&e.exec.execScript){var t=e.exec.execScript;COMMON_UTILS.isEmptyObject(t)||(t.ARGUMENTS.orgId=e.zgid,COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS))}if(e.innerexec&&e.innerexec.execScript){t=e.innerexec.execScript;COMMON_UTILS.isEmptyObject(t)||(t.ARGUMENTS.orgId=e.zgid,COMMON_UTILS.executeFunctionByName(t.FUNCTIONNAME,window,t.ARGUMENTS))}},PhoneBridgeUtil.showMessage=function(e){"false"===e.MESSAGE_JSON&&PhoneBridgeUtil.showError(I18n.getMsg("phonebridge.error.outgoing.notreachable.unknown","Agent"))},PhoneBridgeUtil.getCallBackCode=function(e,t,a,i){return e+"_"+t+"_"+a+"_"+i},PhoneBridgeUtil.convertCallBackCodeToJson=function(e){var t={};if(e)for(var a=e.split("_"),i=a.length,l=0;l<i;l++)0==l?t.serviceName=a[l]:1==l?t.serviceId=a[l]:2==l?t.callRefId=a[l]:l==i-1?t.actionId=a[l]:t.callRefId+="_"+a[l];return t},PhoneBridgeUtil.getCallPopComponent=function(e){if(e.callRefId){if(Zoho.PhoneBridge.activeCall&&-1!=Zoho.PhoneBridge.activeCall.indexOf(e.callRefId))return document.getElementById("call-"+Zoho.PhoneBridge.activeCall);for(var t=document.getElementsByTagName("call-pop"),a=t.length,i=0;i<a;i++){var l=t[i];if(l.getData("callrefid")===e.callRefId)return l}}return null},PhoneBridgeUtil.type4Pref=function(e){PhoneBridgeUtil.uiPref(e.directNumbers.split(","),!1,null)},PhoneBridgeUtil.getStatusJson=function(e,t,a){return{statustype:e,label:t,statuskey:a}},PhoneBridgeUtil.setUserStatusInDORG=function(e){if(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].userStatus=e,PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn="offline"!==e&&"loginlater"!==e&&"dnd"!==e,"offline"===e)PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoginFormPresent?(PhoneBridgeUtil.currentStatus=PhoneBridgeUtil.getStatusJson("phonelogin","Login","offline"),PhoneBridgeUtil.showStatusIcon(PhoneBridgeUtil.defaultOrg)):PhoneBridgeUtil.hideStatusIcon(PhoneBridgeUtil.defaultOrg);else if(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].showPBSettingsIcon&&!PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isCustomStatusIcon){PhoneBridgeUtil.currentStatus={online:{statustype:"Online",label:"Online",statuskey:"online"},loginlater:{statustype:"phonelogin",label:"Login",statuskey:"loginlater"},"in-progress":{statustype:"Busy",label:"In-Progress",statuskey:"in-progress"},"wrap-up-time":{statustype:"Busy",label:"Wrap-Up Time",statuskey:"wrap-up-time"},dnd:{statustype:"Offline",label:"Offline",statuskey:"dnd"}}[e],PhoneBridgeUtil.showStatusIcon(PhoneBridgeUtil.defaultOrg)}else PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].showPBSettingsIcon||PhoneBridgeUtil.hideStatusIcon(PhoneBridgeUtil.defaultOrg)},PhoneBridgeUtil.setStatusForLogout=function(){PhoneBridgeUtil.currentStatus=PhoneBridgeUtil.getStatusJson("phonelogin","Login","offline"),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn=!1},PhoneBridgeUtil.setSystemStatusList=function(){PhoneBridgeUtil.statusList.push(PhoneBridgeUtil.getStatusJson("Online","Online","online")),PhoneBridgeUtil.statusList.push(PhoneBridgeUtil.getStatusJson("Offline","Offline","dnd"))},PhoneBridgeUtil.getTimeoutPromise=function(e){return new Promise((function(t,a){setTimeout((function(){t()}),e)}))},PhoneBridgeUtil.getPref=function(){return new Promise((function(e,t){var a={actionUrl:"/phonebridge/phonenumberpreference",params:{providerID:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].providerId},authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.defaultOrg},type:"GET"};COMMON_UTILS.fetchRequest(a).then((function(t){e({defaultOptionRefName:PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].phoneNumber,options:t.execScript.ARGUMENTS.directNumbers.split(",").map((function(e){return{optionRefName:e,optionLabel:e}}))})}))}))},PhoneBridgeUtil.createInternalTokens=function(){var e={serviceID:PhoneBridgeUtil.serviceID,serviceName:PhoneBridgeUtil.serviceName};COMMON_UTILS.isNotEmpty(PhoneBridgeUtil.bundleService)&&(e.bundleService=PhoneBridgeUtil.bundleService,e.bundleOrgId=PhoneBridgeUtil.bundleOrgId);var t={actionUrl:"/phonebridge/users/createinternaltokens",params:e,type:"GET",authentication:"cookies"};COMMON_UTILS.fetchRequest(t).then((function(){PhoneBridgeUtil.integrationCheck()}))},PhoneBridgeUtil.integrationCheck=function(){COMMON_UTILS.sendMessageToParentWindow({action:"setDefaultOrg",orgId:PhoneBridgeUtil.defaultOrg});var e={serviceID:PhoneBridgeUtil.serviceID,serviceName:PhoneBridgeUtil.serviceName,clickToDial:PhoneBridgeUtil.clickToDial};for(COMMON_UTILS.isNotEmpty(PhoneBridgeUtil.bundleService)&&(e.bundleService=PhoneBridgeUtil.bundleService,e.bundleOrgId=PhoneBridgeUtil.bundleOrgId),PhoneBridgeUtil.orglist.includes(PhoneBridgeUtil.defaultOrg)||(COMMON_UTILS.sendMessageToParentWindow({action:"integEnabled",integEnabled:!1}),COMMON_UTILS.sendMessageToParentWindow({action:"defineZPBCustomTag",callbuttonallowed:!1})),index=0;index<PhoneBridgeUtil.orglist.length;index++){var t={actionUrl:"/phonebridge/integration",params:e,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.orglist[index]}};COMMON_UTILS.fetchRequest(t).then((function(e){if(null==e.wms&&""==e.wms||(Zoho.PhoneBridge.SUBSCRIPTION.initWMS(e.wms),COMMON_UTILS.print("WebSocket initiated For PB!!!")),COMMON_UTILS.print("Processing PB ZGID: "+e.zgid),PhoneBridgeUtil.multiOrgData[e.zgid]=e,PhoneBridgeUtil.defaultOrg==e.zgid){if(e.usersync&&COMMON_UTILS.sendMessageToParentWindow({action:"reloadpopup"}),e.awsacw&&(PhoneBridgeUtil.awsacw=!0),COMMON_UTILS.sendMessageToParentWindow({action:"integEnabled",integEnabled:e.integEnabled}),COMMON_UTILS.sendMessageToParentWindow({action:"defineZPBCustomTag",callbuttonallowed:PhoneBridgeUtil.isCallButtonAllowed(PhoneBridgeUtil.defaultOrg),overrideCRMC2D:e.PBC2DEnabled}),!0!==e.integEnabled||PhoneBridgeUtil.doNotDisturb)PhoneBridgeUtil.hideStatusIcon(PhoneBridgeUtil.defaultOrg);else{if(PhoneBridgeUtil.providerId=e.providerId,e.enableMissedCall&&COMMON_UTILS.sendMessageToParentWindow({action:"enableMissedCall",missedCallFlag:e.enableMissedCall}),e.widgetIcon&&ClientResourceLoader.loadFeatureResources("widgeticon",(function(){COMMON_UTILS.sendMessageToParentWindow({action:"showWidgetIcon",widgetIcon:e.widgetIcon})})),PhoneBridgeUtil.pageInit||PhoneBridgeUtil.executeScripts(e),PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isStatusPresent&&!PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isCustomStatusIcon&&PhoneBridgeUtil.setSystemStatusList(),PhoneBridgeUtil.setUserStatusInDORG(e.userStatus),"online"===e.userStatus||"in-progress"===e.userStatus||"wrap-up-time"===e.userStatus||"dnd"===e.userStatus){if(COMMON_UTILS.isNotEmpty(e.CALLCONTROLFEATURE)&&(PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature=JSON.parse(e.CALLCONTROLFEATURE)),e.phoneNumberType&&PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature&&!PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature.hasOwnProperty("DEFAULT")){var t=e.phoneNumberType.toUpperCase();null!=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature&&(PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("answer"),PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("end"),PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("decline"),PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("mute"),PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("hold"),PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("keypress"),PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("transfer"),PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("parallelcall"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("merge"),PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("leave"))}else if(e.userbasedcallcontrol)PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=e.answerAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=e.endAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=e.declineAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=e.muteAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=e.holdAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=e.keypressAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=e.transferAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=e.parallelcallAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=e.mergeandleaveAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=e.mergeAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=e.leaveAllowed;else if(null!=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature&&PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature.hasOwnProperty("DEFAULT")){var a=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature.DEFAULT;PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=a.includes("answer"),PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=a.includes("end"),PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=a.includes("decline"),PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=a.includes("mute"),PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=a.includes("hold"),PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=a.includes("keypress"),PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=a.includes("transfer"),PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=a.includes("parallelcall"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=a.includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=a.includes("merge"),PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=a.includes("leave")}e.istokenreqneeded&&!PhoneBridgeUtil.pageInit&&PhoneBridgeUtil.createInternalTokens()}PhoneBridgeUtil.pageInit=!0}PhoneBridgeUtil.postIntegrationProcess()}else if(!0===e.integEnabled&&!PhoneBridgeUtil.doNotDisturb)if(!PhoneBridgeUtil.defaultOrg&&e.callButtonAllowed&&-1!=PhoneBridgeUtil.nonSetupServicesList.indexOf(PhoneBridgeUtil.serviceName)&&(0==PhoneBridgeUtil.clickToDialOrgs.length&&COMMON_UTILS.sendMessageToParentWindow({action:"defineZPBCustomTag",callbuttonallowed:PhoneBridgeUtil.isCallButtonAllowed(e.zgid),overrideCRMC2D:e.PBC2DEnabled}),PhoneBridgeUtil.clickToDialOrgs.push(e.zgid),PhoneBridgeUtil.ctdSubOrg=PhoneBridgeUtil.clickToDialOrgs[0]),"online"===e.userStatus||"in-progress"===e.userStatus||"wrap-up-time"===e.userStatus||"dnd"===e.userStatus){if(COMMON_UTILS.isNotEmpty(e.CALLCONTROLFEATURE)&&(PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature=JSON.parse(e.CALLCONTROLFEATURE)),PhoneBridgeUtil.multiOrgData[e.zgid].phoneNumberType){t=PhoneBridgeUtil.multiOrgData[e.zgid].phoneNumberType.toUpperCase();null!=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature&&(PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("answer"),PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("end"),PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("decline"),PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("mute"),PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("hold"),PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("keypress"),PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("transfer"),PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("parallelcall"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("merge"),PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature[t].includes("leave"))}else if(e.userbasedcallcontrol)PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=e.answerAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=e.endAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=e.declineAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=e.muteAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=e.holdAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=e.keypressAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=e.transferAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=e.parallelcallAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=e.mergeandleaveAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=e.mergeAllowed,PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=e.leaveAllowed;else if(null!=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature&&PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature.hasOwnProperty("DEFAULT")){a=PhoneBridgeUtil.multiOrgData[e.zgid].callControlFeature.DEFAULT;PhoneBridgeUtil.multiOrgData[e.zgid].answerAllowed=a.includes("answer"),PhoneBridgeUtil.multiOrgData[e.zgid].endAllowed=a.includes("end"),PhoneBridgeUtil.multiOrgData[e.zgid].declineAllowed=a.includes("decline"),PhoneBridgeUtil.multiOrgData[e.zgid].muteAllowed=a.includes("mute"),PhoneBridgeUtil.multiOrgData[e.zgid].holdAllowed=a.includes("hold"),PhoneBridgeUtil.multiOrgData[e.zgid].keypressAllowed=a.includes("keypress"),PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed=a.includes("transfer"),PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed=a.includes("parallelcall"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeandleaveAllowed=a.includes("mergeandleave"),PhoneBridgeUtil.multiOrgData[e.zgid].mergeAllowed=a.includes("merge"),PhoneBridgeUtil.multiOrgData[e.zgid].leaveAllowed=a.includes("leave")}PhoneBridgeUtil.executeScripts(e),PhoneBridgeUtil.showDefaultStatusIcon()}else PhoneBridgeUtil.executeScripts(e);PhoneBridgeUtil.multiOrgData[e.zgid].transferAllowed||PhoneBridgeUtil.multiOrgData[e.zgid].parallelcallAllowed?ClientResourceLoader.loadFeatureResources("transfer",PhoneBridgeUtil.requestNewTabData):PhoneBridgeUtil.requestNewTabData()}))}},PhoneBridgeUtil.manageUserPopupConfig=function(){"hidden"==document.getElementById("multiCallDiv").style.visibility?PhoneBridgeUtil.reloadpopup():PhoneBridgeUtil.is_reload_popup_after_call=!0},PhoneBridgeUtil.updateMute=function(e){document.getElementById("call-"+e.clientcallid)&&Lyte.Component.set(document.getElementById("call-"+e.clientcallid).component.data.currentControls,"mute",!!e.mute&&e.mute)},PhoneBridgeUtil.updateHold=function(e){document.getElementById("call-"+e.clientcallid)&&(Lyte.Component.set(document.getElementById("call-"+e.clientcallid).component.data.currentControls,"hold",!!e.hold&&e.hold),document.getElementById("call-"+e.clientcallid).setData("hold",!!e.hold&&e.hold),Zoho.PhoneBridge.currentCall=e.hold?null:e.clientcallid)},PhoneBridgeUtil.getAsJson=function(e,t){try{if("string"==typeof e&&PhoneBridgeUtil.isValidJson(e))return JSON.parse(e);if("object"==typeof e)return e}catch(e){}return t},PhoneBridgeUtil.isValidJson=function(e){if("string"==typeof e)try{return JSON.parse(e),!0}catch(e){return!1}else if("object"==typeof e)return!0;return!1},PhoneBridgeUtil.setNewTabData=function(e){if(e.tabID===pbTabManager.browserTabId+""&&!PhoneBridgeUtil.newTabCallData){PhoneBridgeUtil.newTabCallData=e.callData,COMMON_UTILS.print("New call Data set now need to Render");var t=[];for(var a in PhoneBridgeUtil.newTabCallData){if((o=PhoneBridgeUtil.newTabCallData[a]).isMiniUI)t.push(o);else{var i=PhoneBridgeUtil.getCallPopDiv(o,!0);Lyte.Component.render("call-pop",o,"#"+i.id)}}for(var l=0;l<t.length;l++){var o=t[l];i=PhoneBridgeUtil.getCallPopDiv(o,!0);Lyte.Component.render("call-pop",o,"#"+i.id)}Zoho.PhoneBridge.UI.adjustMultiCallPopup(),document.getElementById("multiCallDiv").style.visibility="visible"}},PhoneBridgeUtil.requestNewTabData=function(){PhoneBridgeUtil.isWMSCreated&&Object.keys(PhoneBridgeUtil.multiOrgData).length===PhoneBridgeUtil.orglist.length&&!PhoneBridgeUtil.doNotDisturb&&(COMMON_UTILS.print("WMS done.. Integ req done.."),pbTabManager.fetchCallDataForTab())},PhoneBridgeUtil.getCurrentOrg=function(){return PhoneBridgeUtil.defaultOrg||PhoneBridgeUtil.ctdSubOrg},PhoneBridgeUtil.getCallPopDiv=function(e,t){var a=e.associatedCallRefId;if(t&&(a=a&&e.isMiniUI),a){var i=e.orgid+"_"+e.associatedCallRefId,l=COMMON_UTILS.formClientCallid(i),o=document.getElementById("call-"+l);if(o&&!o.component.getData("isMiniUI"))return e.isMiniUI=!0,o.querySelector("#zpbparallelCall_"+l)}e.isMiniUI=!1;var n=document.createElement("DIV");return n.id="calldiv-"+e.clientcallid,document.getElementById("multiCallDiv").insertAdjacentElement("afterbegin",n),n},PhoneBridgeUtil.timerOff=function(e){var t=document.getElementById("call-"+e.clientcallid);t&&t.component.data.autoCloseTimer&&(clearTimeout(t.component.data.autoCloseTimer),t.component.setData("autoCloseTimer",void 0),t.component.setData("callDescFlag",!0),clearTimeout(t.component.data.autoCloseTimer))},PhoneBridgeUtil.updateUserInfo=function(e){var t=e.services,a=["ZohoCRM","ZohoSupport"],l=PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].enabledServicesMap,o=Object.keys(l),n=o.length;for(i=0;i<n;i++)userpermservicename=o[i],a.includes(userpermservicename)&&t.hasOwnProperty(userpermservicename)?delete t[userpermservicename]:a.includes(userpermservicename)&&!t.hasOwnProperty(userpermservicename)&&(t[userpermservicename]=JSON.parse(l[userpermservicename].portallist)[0].serviceid);if(Object.keys(t).length){var r={actionUrl:"/phonebridge/users/updateservices",body:JSON.stringify(t),type:"POST",headers:{"X-PB-ORG":e.bundleOrgId,"Content-Type":"application/json","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},authentication:"cookies"};COMMON_UTILS.fetchRequest(r)}},PhoneBridgeUtil.holdCurrentCall=function(){null!=Zoho.PhoneBridge.currentCall&&(PhoneBridgeUtil.updateHold({clientcallid:Zoho.PhoneBridge.currentCall,hold:!0}),pbTabManager.send({key:"Msg",functionname:"PhoneBridgeUtil.updateHold",arguments:{clientcallid:Zoho.PhoneBridge.currentCall,hold:!0}}))},PhoneBridgeUtil.openLink=function(){Zoho.PhoneBridge.UITLS.print("opening url in new window")},PhoneBridgeUtil.showConfigTabForZ=function(e){COMMON_UTILS.sendMessageToParentWindow({action:"showConfigTabForZ",tabid:e})},PhoneBridgeUtil.checkUserInCall=function(){return window.BroadcastChannel?new Promise((function(e){pbTabManager.channeltosend.postMessage("checkothertabsincall"),onmessage(),setTimeout((()=>{e()}),2e3)})):new Promise((function(e){e(!1)}))},PhoneBridgeUtil.openRecordInNewTab=function(e){return new Promise(((t,a)=>{let i=e.orgid,l=PhoneBridgeUtil.multiOrgData[i]&&PhoneBridgeUtil.multiOrgData[i].openerConfig?PhoneBridgeUtil.multiOrgData[i].openerConfig:null;if(-1==["clicktodial","missed"].indexOf(e.callstate)&&e.callerdetails.recordexist&&l&&-1!=l.service.indexOf(e.servicename)&&pbTabManager.ismaster){let i=localStorage.getItem("openerIds")?localStorage.getItem("openerIds").split(","):[],l=e.serviceid+e.clientcallid;-1==i.indexOf(l)?setTimeout((()=>{let a=window.open(e.callerdetails.uri.replace("crm.local","crmqa.local"));i.length>9&&i.shift(0),i.push(l),localStorage.setItem("openerIds",i.join(",")),t(a.close)}),1e3):a("Not opening Tab")}}))};var Coord={};function handleMousemove(e){COMMON_UTILS.sendMessageToParentWindow({action:"dragpopup",type:"DRAG_MOVE",offsetX:e.clientX-Coord.baseX,offsetY:e.clientY-Coord.baseY})}function handleDragEnd(){COMMON_UTILS.sendMessageToParentWindow({action:"dragpopup",type:"DRAG_END"});var e=document.getElementById("multiCallDiv");e.removeEventListener("mouseup",handleDragEnd),e.removeEventListener("mouseleave",handleDragEnd),e.removeEventListener("mousemove",handleMousemove)}function handleDragStart(e){var t=document.getElementById("preferencesDiv").offsetHeight>0,a=document.getElementById("errorPopup").offsetHeight>0,i=0!==Object.keys(Zoho.PhoneBridge.CurrentHeadless).length,l="none"!==document.getElementById("providerIframeDiv").style.display;if(!(t||a||i||l)){Coord.baseX=e.clientX,Coord.baseY=e.clientY,COMMON_UTILS.sendMessageToParentWindow({action:"dragpopup",type:"DRAG_START",mouseX:Coord.baseX,mouseY:Coord.baseY});var o=document.getElementById("multiCallDiv");o.addEventListener("mouseup",handleDragEnd),o.addEventListener("mouseleave",handleDragEnd),o.addEventListener("mousemove",handleMousemove)}}Coord.baseX=0,Coord.baseY=0,window.addEventListener("message",(function(e){var t=e.data;if(t="string"==typeof t?JSON.parse(t):t,-1==PhoneBridgeUtil.telephonyProviderFrames.indexOf(e.origin))if("close"===t.message||"success"===t.message){var a=Zoho.PhoneBridge.CurrentHeadless;if(t&&"updateCallBackParam"===t.action){var i=PhoneBridgeUtil.convertCallBackCodeToJson(t.callbackcode),l={callBackParam:"object"==typeof t.data?JSON.stringify(t.data):t.data,serviceName:i.serviceName,serviceID:i.serviceId,callRefID:i.callRefId};PhoneBridgeUtil.updateCallBackParam(a.orgid,l)}if(t&&"success"===t.message)if("callaction"==a.type){if(1!=jQuery.extend({},document.getElementById("call-"+a.clientcallid).component.data.searchdata)[a.servicename][a.serviceid].recordexist&&t.Details&&t.Details.module&&t.Details.recordid)(l={}).recordID=t.Details.recordid,l.module=t.Details.module,l.serviceName=a.servicename,l.serviceID=a.serviceid,l.phoneNumber=a.phonenumber,l.callRefID=a.callrefid,PhoneBridgeUtil.updateNotify(a.orgid,l)}else if("followup"==a.type){var o={};o.clientcallid=a.clientcallid,o.type=a.followuptype,o.details=t.Details&&t.Details.recordname?t.Details.recordname:t.RecordName,pbTabManager.send({key:"Msg",functionname:"Zoho.PhoneBridge.UI.addFollowUp",arguments:o})}Zoho.PhoneBridge.UI.closeHeadless()}else if("updateCaller"===t.action){var n={pbmodule:"SAVECALLER"};n.orgid=PhoneBridgeUtil.defaultOrg,n.callrefid=t.id,n.clientcallid=PhoneBridgeUtil.defaultOrg+"_"+t.id,n.servicename=PhoneBridgeUtil.serviceName,n.serviceid=PhoneBridgeUtil.serviceID,t.details&&(n.callerdetails=t.details,n.callerdetails.recordexist=!0,n.callerdetails.phonenumber=t.phonenumber,Zoho.PhoneBridge.UI.saveCallerSearch(n));var r={key:"Msg",functionname:"Zoho.PhoneBridge.UI.saveCallerSearch",arguments:n};pbTabManager.send(r)}else if("documentReady"===t.action){if(COMMON_UTILS.parentDomain=e.origin,PhoneBridgeUtil.serviceID=t.serviceID,PhoneBridgeUtil.serviceName=t.serviceName,PhoneBridgeUtil.doNotDisturb=t.doNotDisturb,PhoneBridgeUtil.clickToDial=t.clickToDial,PhoneBridgeUtil.bundleService=t.bundleService,PhoneBridgeUtil.bundleOrgId=t.bundleOrgId,PhoneBridgeUtil.currentOrgtype=t.orgtype,PhoneBridgeUtil.pbzaaid=t.pbzaaid,PhoneBridgeUtil.accesstoken=t.accessToken,PhoneBridgeUtil.doNotDisturb||PhoneBridgeUtil.popupHidden||PhoneBridgeUtil.checkUserInCall().then((function(e){if(e)pbTabManager.incall=e;else{let e=console;null!==pbTabManager.incall?e.log("Call loaded"):e.log("call not loaded")}pbTabManager.initialisetab()})),t.customStyle){var s=document.getElementsByTagName("HEAD")[0],d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.href=t.customStyle,s.appendChild(d)}PhoneBridgeUtil.isDesktopApp=t.isDesktopApp,PhoneBridgeUtil.integrationCheck(),document.getElementById("multiCallDiv").addEventListener("mousedown",handleDragStart),Lyte.Security.ignoreSanitizer=!0}else if("toggleCTDialpad"===t.action)PhoneBridgeUtil.toggleCTDialpad(t.isDarkmode);else if("toggleDarkmode"===t.action)COMMON_UTILS.toggleDarkmode(t.isDarkmode);else if("showPreference"===t.action)PhoneBridgeUtil.showPreferenceList();else if("showPreferencePopup"===t.action)PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isPrefFormPresent&&zpb_config.showUserFrameView("preferencePopup");else if("showWidget"===t.action)PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].widgetIcon&&PhoneBridgeUtil.showWidget();else if("showLoginForm"===t.action)PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoginFormPresent&&!PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isLoggedIn&&zpb_config.showUserFrameView("loginPopup");else if("updateStatus"===t.action)PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isStatusPresent&&(PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.defaultOrg].isCustomStatusIcon&&"function"==typeof PhoneBridgeUtil.updateStatusFunction?PhoneBridgeUtil.updateStatusFunction(t.statusKey):zpb_config.saveStatusConfig({status:t.statusKey}));else if("clicktodial"===t.action)PhoneBridgeUtil.defaultOrg?PhoneBridgeUtil.clicktodial(t):PhoneBridgeUtil.nonSetupCTD(t);else if("whitelistDomain"===t.action)PhoneBridgeUtil.openWindow(t.domain,t.url,t.name,!0);else if("enabledrag"===t.action)enabledragging();else if("getCallBackParam"===t.action){var c={};if(t.callbackcode){i=PhoneBridgeUtil.convertCallBackCodeToJson(t.callbackcode);if(h=PhoneBridgeUtil.getCallPopComponent(i)){var p=jQuery.extend({},h.component.data.servicesCallBackParam);callBackParam=p[i.serviceName+"_"+i.serviceId],c=callBackParam?callBackParam.callbackparam:{}}}var u={messageType:"set-pbcall-info",action:"setCallBackParam",data:c},g=JSON.stringify(u);e.source.postMessage(g,e.origin)}else if("getCallDescription"===t.action){var m="";if(t.callbackcode){var h;i=PhoneBridgeUtil.convertCallBackCodeToJson(t.callbackcode);if(h=PhoneBridgeUtil.getCallPopComponent(i)){var y=h.querySelector(".zpb-endCallDesc"),f=h.querySelector(".zpb-answerCallDesc"),b=y&&y.ltProp("value"),v=f&&f.ltProp("value");m=COMMON_UTILS.isNotEmpty(b)?b:COMMON_UTILS.isNotEmpty(v)?v:""}}u={messageType:"set-pbcall-info",action:"setCallDescription",data:m},g=JSON.stringify(u);e.source.postMessage(g,e.origin)}else if("updateCurrentCallCBP"===t.action){if(Zoho.PhoneBridge.activeCall){var C=jQuery.extend({},document.getElementById("call-"+Zoho.PhoneBridge.activeCall).component.data);delete t.action,t.callRefID=C.callrefid,PhoneBridgeUtil.updateCallBackParam(C.orgid,t)}}else if("getIvrData"===t.action)PhoneBridgeUtil.getIVRData();else if("getAgentsData"===t.action)PhoneBridgeUtil.getAgentsData();else if("getActiveCallsData"===t.action)PhoneBridgeUtil.getActiveCallsData();else if("getSMSCredit"===t.action){var P={actionUrl:"/phonebridge/payment/smscredit",params:{providerId:PhoneBridgeUtil.providerId},type:"GET",authentication:"cookies",headers:{"X-PB-ORG":PhoneBridgeUtil.getCurrentOrg(),"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(P).then((function(e){var t={action:"getSMSCredit",resp:e};COMMON_UTILS.sendMessageToParentWindow(t)}))}else"disableSMS"===t.action?(P={actionUrl:"/smsbridge/v3/sms/disable",params:{providerId:PhoneBridgeUtil.providerId},type:"DELETE",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}},COMMON_UTILS.fetchRequest(P).then((function(e){if("success"===e)return"success"}))):"updateAutoRecharge"===t.action&&(P={actionUrl:"/phonebridge/payment/autorecharge",type:"POST",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded","X-PB-ORG":inbuiltTelephony.orgId,"X-SERVICE-ORG":inbuiltTelephony.serviceID,"X-SERVICE-NAME":inbuiltTelephony.serviceName,"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")},params:{by:t.by,isSms:"true",when:t.when,isEnabled:"true"}},COMMON_UTILS.fetchRequest(P).then(function(e){t.callback(e)}.bind(this)));else zpb_type5.handlePostMessage(e.data)}),!1);var I18n=I18n||{};I18n.logger=[],I18n.getProperties=function(){try{if(this.properties)return this.properties;if(window.opener&&window.opener.I18n.properties)return window.opener.I18n.properties;if(parent.I18n.properties)return parent.I18n.properties}catch(e){this.logger.push(e.toString())}return{}},I18n.getMsg=function(e,t){var a=[];if(e&&"object"==typeof e){for(var i=e.length,l=0;l<i;l++)a[l]=I18n.getMsg(e[l],t);return a}var o=e,n=new RegExp("CustomModule\\d+");return n.test(e)&&(e=e.replace(n,"CustomModule")),t=void 0!==t&&"object"!=typeof t?[t]:t,this.properties||(this.properties=this.getProperties()),this.properties[e]&&(o=this.properties[e]),o&&t&&(o=o.replace(/{(\d+)}/g,(function(e,a){return t[a]}))),o},I18n.getMultipleMsg=function(e){for(var t=e.length,a={},i=0;i<t;i++){var l=e[i],o=l.key;a[o]=I18n.getMsg(o,I18n.getMsg(l.params))}return a},I18n.getValueForFields=function(e,t){t="string"==typeof t?[t]:t;var a=DWRutil.getModuleFromFieldLabel(t);return t=I18n.getMsg(t,I18n.getMsg(a)),I18n.getMsg(e,t)};var clienttab={browserTabId:Date.now(),ismaster:!1,isslave:!1,incall:!1,channel:null,listener:function(){window.addEventListener("storage",(function(e){if("MasterTabId"===e.key&&null==localStorage.getItem("MasterTabId")&&(null!=localStorage.getItem("SlaveTabId")?localStorage.getItem("SlaveTabId")==clienttab.browserTabId:clienttab.isslave))for(clienttab.ismaster=!0,localStorage.setItem("MasterTabId",clienttab.browserTabId),localStorage.removeItem("SlaveTabId"),Zoho.PhoneBridge.CallsArray.length>0&&localStorage.setItem("incall","true"),clienttab.isslave=!1,index=0;index<PhoneBridgeUtil.orglist.length;index++)"browser"==PhoneBridgeUtil.multiOrgData[PhoneBridgeUtil.orglist[index]].phoneNumberType&&PhoneBridgeUtil.initWebRTC(PhoneBridgeUtil.orglist[index]);else if(clienttab.ismaster||"SlaveTabId"!==e.key||null!=localStorage.getItem("SlaveTabId"))if(clienttab.ismaster||"SlaveTabId"!==e.key||e.newValue==clienttab.browserTabId)if("MasterTabId"===e.key&&e.oldValue==clienttab.browserTabId)clienttab.ismaster=!1,clienttab.isslave=!0,localStorage.setItem("SlaveTabId",clienttab.browserTabId);else if(e.key.startsWith("closePopup")&&null!=localStorage.getItem("closePopup")){var t=console,a=JSON.parse(localStorage.getItem("closePopup"));document.getElementById("callDesc"+a.clientcallid).component.data.callDescFlag&&(t.log("tabRequesting data::::"+a.tabID),localStorage.setItem("closePopupStat"+a.clientcallid,JSON.stringify({tabID:a.tabID,status:!1})))}else"poll"==e.key&&null!=localStorage.getItem("poll")?clienttab.ismaster&&Zoho.PhoneBridge.UI.allCallsData({tabID:localStorage.getItem("poll")}):e.key.includes("Msg")&&e.newValue?(message=JSON.parse(localStorage.getItem("Msg")),message.functionname&&COMMON_UTILS.executeFunctionByName(message.functionname,window,message.arguments)):e.key.includes(tabCommunicator.localStoreKey)&&e.newValue&&(message=JSON.parse(localStorage.getItem(e.key)),message.key&&message.dataMessage?tabCommunicator.tabListener(message):COMMON_UTILS.executeFunctionByName(message.functionname,window,message.arguments));else clienttab.isslave=!1;else localStorage.setItem("SlaveTabId",clienttab.browserTabId),clienttab.isslave=!0}))},tabinitializer:function(){"inbound"==localStorage.getItem("incall")||"outbound"==localStorage.getItem("incall")||"true"==localStorage.getItem("incall")?(localStorage.setItem("SlaveTabId",clienttab.browserTabId),clienttab.isslave=!0):(localStorage.setItem("MasterTabId",clienttab.browserTabId),clienttab.ismaster=!0),window.addEventListener("unload",(function(){localStorage.getItem("SlaveTabId")?clienttab.ismaster?(clienttab.postmessage({key:"Msg",functionname:"PhoneBridgeUtil.passErrorInfo",arguments:{mute:Object.fromEntries(PhoneBridgeUtil.errormute),hold:Object.fromEntries(PhoneBridgeUtil.errorhold)}}),localStorage.removeItem("incall"),null==localStorage.getItem("MasterTabId")&&localStorage.setItem("MasterTabId","0"),localStorage.removeItem("MasterTabId")):(clienttab.isslave||localStorage.getItem("SlaveTabId")==clienttab.browserTabId)&&(null==localStorage.getItem("SlaveTabId")&&localStorage.setItem("SlaveTabId","0"),localStorage.removeItem("SlaveTabId")):localStorage.clear(),"function"==typeof clienttab.onUnloadFunction&&clienttab.onUnloadFunction()})),window.addEventListener("beforeunload",(function(){(clienttab.incall||clienttab.showunloadalert)&&(window.onbeforeunload=function(e){return""})}))},basicInitializer:function(){window.addEventListener("unload",(function(){"function"==typeof clienttab.onUnloadFunction&&clienttab.onUnloadFunction()}))},postmessage:function(e,t){null!=clienttab.channel?(e.triggeredBy="BroadcastChannel",e.hasOwnProperty("tab")&&delete e.tab,clienttab.channel.postMessage(JSON.stringify(e))):COMMON_UTILS.browserDetect().includes("Safari")||!window.localStorage?(e.triggeredBy="Safari",e.functionname?clienttab.publishByWms(e.functionname,e.arguments,e.hasOwnProperty("tab")?e.tab:"all"):clienttab.publishByWms("tabCommunicator.tabListener",e,e.hasOwnProperty("tab")?e.tab:"all")):t?(e.hasOwnProperty("tab")&&delete e.tab,e.triggeredBy="LocalStorage",localStorage.setItem(t,JSON.stringify(e)),setTimeout((function(){localStorage.removeItem(t)}),3e3)):(e.hasOwnProperty("tab")&&delete e.tab,localStorage.setItem("Msg",JSON.stringify(e)))},initClientTab:function(){try{var e=COMMON_UTILS.browserDetect().includes("Mozilla Firefox");ismasterenable&&!e?clienttab.tabinitializer():(clienttab.ismaster=!0,clienttab.basicInitializer()),"BroadcastChannel"in self&&(clienttab.channel=new BroadcastChannel("message_channel"),onmessage()),clienttab.listener()}catch(e){clienttab.ismaster=!0}},publishByWms:function(e,t,a){var i={};i=a?{FUNCTIONNAME:e,ARGUMENTS:t,tab:a,pbmodule:"execscript"}:{FUNCTIONNAME:e,ARGUMENTS:t,pbmodule:"execscript"};var l={actionUrl:"/phonebridge/pushservice/publish",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),publishData:JSON.stringify(i)},type:"POST",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(l)},publishByWmsBody:function(e,t){var a={FUNCTIONNAME:e,ARGUMENTS:t,pbmodule:"execscript"},i={actionUrl:"/phonebridge/pushservice/publishBody",type:"POST",body:JSON.stringify(a),authentication:"cookies",headers:{"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(i)},fetchCallDataForTab:function(e){clienttab.channel?clienttab.ismaster&&localStorage.getItem("SlaveTabId")&&"true"==localStorage.getItem("incall")?clienttab.postmessage({functionname:"Zoho.PhoneBridge.UI.allCallsData",arguments:{tabID:clienttab.browserTabId+""},tabID:localStorage.getItem("SlaveTabId")}):clienttab.postmessage({functionname:"Zoho.PhoneBridge.UI.allCallsData",arguments:{tabID:clienttab.browserTabId+""}}):window.localStorage&&(localStorage.setItem("poll",clienttab.browserTabId+""),COMMON_UTILS.print("setting poll in storage"),setTimeout((function(){localStorage.getItem("poll")==clienttab.browserTabId+""&&localStorage.removeItem("poll")}),2e3))}};function onmessage(){clienttab.channel.onmessage=function(e){COMMON_UTILS.print(e.data),message=JSON.parse(e.data),message.key&&message.key.includes("Msg")?message.functionname&&COMMON_UTILS.executeFunctionByName(message.functionname,window,message.arguments):message.key&&message.dataMessage?tabCommunicator.tabListener(message):(message.functionname&&clienttab.ismaster&&!message.tabID||message.tabID&&message.tabID===clienttab.browserTabId+""&&message.functionname)&&COMMON_UTILS.executeFunctionByName(message.functionname,window,message.arguments)}}var tabCommunicator=function(){var e={},t=function(e,t,a){return{value:e,operation:t,functionName:a}},a=function(t,a){return!(!t||!a||"PJ"==t)&&(e[t]=a,!0)},i=function(t){if(t)return e[t]},l=function(e,i,l,o){try{var n={dataMessage:t(i,"SET",l),key:e,tabId:pbTabManager.browserTabId,setTabID:o};a(n.key,i),pbTabManager.send(n)}catch(e){COMMON_UTILS.print(e)}},o=function(){if(!ismasterenable)return!0;var e=!1;return(pbTabManager.ismaster||pbTabManager.isslave)&&(e=!0),e};return{hasPublishJson:!1,putValueToPublishJson:a,getValueFromPublishJson:i,localStoreKey:"tabCommunicate",publishData:l,getData:function(e,a){try{var i={dataMessage:t(void 0,"GET",a),key:e,tabId:pbTabManager.browserTabId};pbTabManager.send(i)}catch(e){COMMON_UTILS.print(e)}},getDynamicValues:function(e,a,i,l){try{var o={dataMessage:t({otherTabFunction:i,otherTabArgs:a,curentTabFunction:l},"DYNAMIC-GET"),key:e,tabId:pbTabManager.browserTabId};pbTabManager.send(o)}catch(e){COMMON_UTILS.print(e)}},tabListener:function(e){if(tabCommunicator.debug&&COMMON_UTILS.print(e),e.tabId&&e.tabId!==pbTabManager.browserTabId){var t=e.tabId,n=e.dataMessage,r=e.key;if(r&&n){var s=n.value,d=n.operation,c=n.functionName;if(d)if("SET"!==d||(y=e.setTabID)&&y!==pbTabManager.browserTabId){if("GET"===d&&o()){var p=i(r);l(r,p,c,t)}else if("DYNAMIC-GET"===d&&o()){var u=s.otherTabFunction,g=s.otherTabArgs,m=s.curentTabFunction;if(u){var h=COMMON_UTILS.executeFunctionByName(u,window,g);l(r,h,m,t)}}}else a(r,s),c&&COMMON_UTILS.executeFunctionByName(c,window,s)}}var y},storeDataInLocal:function(e,t){localStorage.setItem(e,t)},removeDataFromLocal:function(e){localStorage.getItem(e)&&localStorage.removeItem(e)},checkDataInLocal:function(e){return!!localStorage.getItem(e)},deleteValueOfKey:function(t){t&&e[t]&&(e[t]=void 0)},getPublishJsonCopy:function(){return JSON.parse(JSON.stringify(e))},setPublishJson:function(t){e=void 0,e=JSON.parse(JSON.stringify(t)),tabCommunicator.hasPublishJson=!0},debug:!1,getPublishJsonFromOtherTab:function(){tabCommunicator.hasPublishJson||tabCommunicator.getDynamicValues("PJ",void 0,"tabCommunicator.getPublishJsonCopy","tabCommunicator.beforeOnStart")},beforeOnStart:function(e){tabCommunicator.setPublishJson(e);var t=new Event("publishjson-init",{bubbles:!0});document.dispatchEvent(t),"undefined"!=typeof callPopupHandler&&callPopupHandler&&!COMMON_UTILS.browserDetect().includes("Safari")&&callPopupHandler.onStart()}}}();initCallPopupHandler=function(){return callPopupHandler={key:"createCallPopup",descriptionKey:"callDescription",followUpKey:"followUp",incall:"incall",followUpData:[],isCallPopupCreated:!1,getCallData:function(){return{callPopup:callPopupHandler.getCallPopupData(),followup:callPopupHandler.getCurrentFollowUpData(),timer:callPopupHandler.getTimerValue(),desc:$("#CallDescription").val()}},constructPopup:function(e){try{if(!callPopupHandler.isCallPopupCreated){var t=e.callPopup,a=e.followup,i=e.timer,l=e.desc;t&&t.arrData&&t.arrData.length>0&&(callPopupHandler.callPopupdata.arrData=new Array,t.arrData.forEach((function(e){Zoho.PhoneBridge.UI.createpopup(e)})),callPopupHandler.isCallPopupCreated=!0),l&&callPopupHandler.descriptionUpdater(l),i&&callPopupHandler.TimerUpdater(i),a&&callPopupHandler.constructFollowUpOnStart(a)}}catch(e){COMMON_UTILS.print(e)}},callPopupdata:{},getCallPopupData:function(){return callPopupHandler.callPopupdata},constructCallPopupData:function(e){return callPopupHandler.callPopupdata.arrData||(callPopupHandler.callPopupdata={},callPopupHandler.callPopupdata.arrData=new Array),callPopupHandler.callPopupdata.arrData.push(e),callPopupHandler.callPopupdata},descriptionListener:function(e){e.change((function(){var t=e.val()?e.val():"UNDEFINED_DESC";tabCommunicator.publishData(callPopupHandler.descriptionKey,t,"callPopupHandler.descriptionUpdater")}))},descriptionUpdater:function(e){try{"UNDEFINED_DESC"!=e?$("#CallDescription").val(e):$("#CallDescription").val("")}catch(e){COMMON_UTILS.print(e)}},getTimerValue:function(e){try{var t;if(callPopupHandler.isCallPopupCreated)if($("#calltimer_min")&&$("#calltimer_sec"))t={min:$("#calltimer_min").text(),sec:$("#calltimer_sec").text()};return t}catch(e){COMMON_UTILS.print(e)}},TimerUpdater:function(e){try{if(e&&e.min&&e.sec){var t=e.min,a=e.sec;Zoho.PhoneBridge.CallTimer.minute=parseInt(t),Zoho.PhoneBridge.CallTimer.second=parseInt(a)-1,Zoho.PhoneBridge.CallTimer.run()}}catch(e){COMMON_UTILS.print(e)}},saveFollowUpData:function(e){null==callPopupHandler.followUpData&&(callPopupHandler.followUpData=new Array);var t=!1;e&&e.currentFollowUp&&e.jsondata&&(callPopupHandler.followUpData.forEach((function(a,i){a.currentFollowUp==e.currentFollowUp&&(callPopupHandler.followUpData[i].jsondata=e.jsondata,t=!0)})),t||callPopupHandler.followUpData.push(e))},getCurrentFollowUpData:function(){return callPopupHandler.followUpData},constructFollowUpOnStart:function(e){e&&e.forEach((function(e){callPopupHandler.followUpListener(e)}))},followUpListener:function(e,t){try{if(e&&e.jsondata){var a=e.jsondata,i=e.currentFollowUp;if((t||document.getElementById("followup")&&"hidden"!=document.getElementById("followup").style.visibility)&&(document.getElementById("followup").style.visibility="hidden",document.getElementById("followup").style.display="none",document.getElementById("overlayerdiv").style.display="none",Zoho.PhoneBridge.UI.adjustMultiCallPopup(),document.getElementById("multiCallDiv").style.left="",document.getElementById("multiCallDiv").style.bottom="0px"),a&&"updateCallBackParam"===a.action){var l=PhoneBridgeUtil.convertCallBackCodeToJson(a.callbackcode),o={callBackParam:"object"==typeof a.data?JSON.stringify(a.data):a.data,serviceName:l.serviceName,serviceID:l.serviceId,callRefID:l.callRefId};PhoneBridgeUtil.updateCallBackParam(i.orgid,o)}if(a&&"success"===a.message){if(callPopupHandler.saveFollowUpData(e),Zoho.PhoneBridge.CallProperties.RecordExist)callPopupHandler.followupUpdater(a,i),t&&tabCommunicator.publishData(callPopupHandler.followUpKey,e,"callPopupHandler.followUpListener");else try{Zoho.PhoneBridge.CallProperties.RecordExist=!0,document.getElementById("addIcon").style.display="none","ended"==Zoho.PhoneBridge.CallProperties.CallState&&(document.getElementById("followUpDiv").style.display="block"),Zoho.PhoneBridge.UI.adjustMultiCallPopup(),Zoho.PhoneBridge.CallProperties.Module=a.Details.module,Zoho.PhoneBridge.CallProperties.RecordId=a.Details.recordid;var n={};n.recordID=Zoho.PhoneBridge.CallProperties.RecordId,n.module=Zoho.PhoneBridge.CallProperties.Module,t&&PhoneBridgeUtil.updateNotify(Zoho.PhoneBridge.CallProperties.OrgId,n)}catch(e){COMMON_UTILS.print(e)}t&&(document.getElementById("multiCallDiv").style.left="")}}}catch(e){COMMON_UTILS.print(e)}},followupUpdater:function(e,t){try{var a=t;document.getElementById("followUp"+a).style.display="none",document.getElementById("followUp"+a+"Div").style.display="block",document.getElementById("followUp"+a+"Link").innerText=e.RecordName,"none"==document.getElementById("followUpCall").style.display&&"none"==document.getElementById("followUpEvent").style.display&&"none"==document.getElementById("followUpTask").style.display&&(document.getElementById("followUpDiv").style.display="none"),Zoho.PhoneBridge.UI.adjustMultiCallPopup(),Zoho.PhoneBridge.CallProperties.CurrentFollowUp=null}catch(e){COMMON_UTILS.print(e)}},callControlListner:function(e){},destroyOnClosePopup:function(){tabCommunicator.deleteValueOfKey(callPopupHandler.key),tabCommunicator.deleteValueOfKey(callPopupHandler.descriptionKey),tabCommunicator.deleteValueOfKey(callPopupHandler.followUpKey),tabCommunicator.deleteValueOfKey(callPopupHandler.incall),callPopupHandler.callPopupdata={},callPopupHandler.isCallPopupCreated=!1,callPopupHandler.followUpData=new Array},addcallPopupListener:function(){tabCommunicator.putValueToPublishJson(callPopupHandler.incall,!0);var e=$("#CallDescription");callPopupHandler.descriptionListener(e),callPopupHandler.isCallPopupCreated=!0},onStart:function(){tabCommunicator.getValueFromPublishJson(callPopupHandler.incall)&&!PhoneBridgeUtil.doNotDisturb&&tabCommunicator.getDynamicValues(callPopupHandler.key,void 0,"callPopupHandler.getCallData","callPopupHandler.constructPopup")}}},Lyte.Component.registerHelper("getI18n",(function(e){var t=arguments.length;if(1===t)return I18n.getMsg(arguments[0]);for(var a=arguments[0],i=[],l=1;l<t;l++)i.push(arguments[l]);return I18n.getMsg(a,I18n.getMsg(i))})),Lyte.Component.registerHelper("getuserdisplayname",(function(e,t,a){return t[a]?e.filter((e=>e&&e.zohouser===t[a].zuid))[0].username:""})),Lyte.Component.registerHelper("getuservalue",(function(e,t){return e[t]?e[t].zuid:""})),Lyte.Component.registerHelper("getextndisplayname",(function(e,t){return e[t]?e[t].name:""})),Lyte.Component.registerHelper("getextnvalue",(function(e,t){return e[t]?e[t].phoneNumber:""})),Lyte.Component.registerHelper("checkNotNull",(function(e){return COMMON_UTILS.isNotEmpty(e)})),Lyte.Component.registerHelper("getjsonsize",(function(e){return COMMON_UTILS.isNotEmpty(e)?Object.keys(e).length:0})),Lyte.Component.registerHelper("getarraysize",(function(e){return COMMON_UTILS.isNotEmpty(e)?e.length:0})),Lyte.Component.registerHelper("getValueFromJson",(function(e,t){return e&&t?e[t]:null})),Lyte.Component.registerHelper("getAuthHeadersJson",(function(){var e=commonHelper.getOrgServiceIframeDetails();return JSON.stringify({"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr"),"X-SERVICE-ORG":e.serviceID,"X-SERVICE-NAME":e.serviceName})})),Lyte.Component.registerHelper("isPresentInArray",(function(e,t){return!(!COMMON_UTILS.isNotEmpty(e)||!COMMON_UTILS.isNotEmpty(t))&&-1!==e.indexOf(t)})),Lyte.Component.registerHelper("add",(function(e,t){return COMMON_UTILS.isNotEmpty(e)&&COMMON_UTILS.isNotEmpty(t)?e+t+"":0})),Lyte.Component.registerHelper("getdisplayname",(function(e,t){return e[t].displayname})),Lyte.Component.registerHelper("getSetupDisplayName",(function(){return Setup.displayName&&"undefined"!=Setup.displayName&&"null"!=Setup.displayName?Setup.displayName:Setup.serviceName})),Lyte.Component.registerHelper("getportalname",(function(e,t,a){var l=e[t].portallist;for(i=0;i<l.length;i++)if(l[i].serviceid==a)return l[i].portalname;return l[0].portalname})),Lyte.Component.registerHelper("getfirstletter",(function(e){return e[0]})),Lyte.Component.registerHelper("isVideoAvail",(function(e){return COMMON_UTILS.isNotEmpty(e)&&-1===e.indexOf(".jpg")&&-1===e.indexOf(".png")?e:null})),Lyte.Component.registerHelper("iterImage",(function(e){return!COMMON_UTILS.isNotEmpty(e)||-1===e.indexOf(".jpg")&&-1===e.indexOf(".png")?null:e})),Lyte.Component.registerHelper("renderImage",(function(e){return imageStaticPath+"/ProviderDetails/"+e})),Lyte.Component.registerHelper("evaluateValues",(function(e){return Setup.getExtensions(e),null})),Lyte.Component.registerHelper("checkIsUrl",(function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)})),Lyte.Component.registerHelper("biginUserName",(function(e,t){try{var a=PaymentsUtil.userData;return null==a[e]?""===t?"User":t:a[e]}catch(e){return t}})),Lyte.Component.registerHelper("RoundingOff",(function(e,t){try{return e.toFixed(t)}catch(t){return e}})),Lyte.Component.registerHelper("getPlanName",(function(e){try{return isNaN(e)?e:String(e).slice(0,-3)+"K"}catch(t){return e}})),Lyte.Component.registerHelper("removeUnderScore",(function(e){return e.replaceAll("_"," ")})),Lyte.Component.registerHelper("isBigin",(function(e){return!1})),Lyte.Component.registerHelper("checkEmptyObject",(function(e){return jQuery.isEmptyObject(e)})),Lyte.Component.registerHelper("concatArrayElements",(function(e){for(var t="",a=0;a<e.length;a++)t+=e[a];return t})),Lyte.Component.registerHelper("optEmptyIfNull",(function(e){return COMMON_UTILS.isNotEmpty(e)?e:""})),Lyte.Component.registerHelper("isChildPopForShow",(function(e,t){return-1!=["clicktodial","agentdialed","customerdialed","ringing","answered"].indexOf(e)&&"merged"!=t})),Lyte.Component.registerHelper("isCallControlsForShow",(function(e,t,a,i){return"answered"===e&&"merged"!==t&&-1===["clicktodial","agentdialed","customerdialed","ringing","answered"].indexOf(a)})),Lyte.Component.registerHelper("isMergedCallUI",(function(e,t){return"answered"===e&&"merged"===t})),Lyte.Component.registerHelper("getLastName",(function(e){return e.substring(e.lastIndexOf(" ")+1)})),Lyte.Component.registerHelper("isInbuiltNewConfig",(function(){return inbuiltTelephony.isInbuiltNewConfig})),Lyte.Component.registerHelper("getInbuiltTelephonyValueByKey",(function(e){return inbuiltTelephony[e]})),Lyte.Component.registerHelper("getDefaultOptions",(function(e,t){return e&&t?e[t]:null})),Lyte.Component.registerHelper("getOptionArr",(function(e){if(!Array.isArray(e)){var t=[];return t[0]={optionRefName:e,optionLabel:e},t}return e})),Lyte.Component.registerHelper("getSysrefVsValue",(function(e,t){return e&&t?e[t]:null})),Lyte.Component.registerHelper("getRelatedDataDisplayValue",(function(e,t,a,i,l){try{if(e){if(Array.isArray(e)){for(var o="",n=i&&i<e.length?i:e.length,r=0;r<n;r++){var s=e[r];o=0===r?o:o+", ",t[a.foreignResource][s]&&(o+=t[a.foreignResource][s][a.foreignResourceDisplayField])}var d=e.length-n;return d>0&&(o+=" "+I18n.getMsg("phonebridge.inbuilt.setup.andothers",d)),o}return t[a.foreignResource][e][a.foreignResourceDisplayField]}return l||null}catch(e){return"-"}})),Lyte.Component.registerHelper("getValueLabel",(function(e,t){return t.valueRefVsLabel?t.valueRefVsLabel[e[t.fieldRefName]]:null})),Lyte.Component.registerHelper("getDisableOperationInputs",(function(e,t){for(var a=e.length,i=[],l=0;l<a;l++){var o=e[l];"disable"===o[t]&&i.push(o)}return i})),Lyte.Component.registerHelper("isDisableOperationInputsEmpty",(function(e,t){for(var a=e.length,i=0;i<a;i++){if("disable"===e[i][t])return!1}return!0})),Lyte.Component.registerHelper("getOperationInputs",(function(e,t){for(var a=e.length,i=[],l=0;l<a;l++){var o=e[l];"disable"!==o[t]&&"hide"!==o[t]&&i.push(o)}return i}));var inbuiltTelephonyHelper={showOrHideLoadingBar:function(e){document.querySelector(".loadingsplash").style.display=e?"block":"none"}},commonHelper={getOrgServiceIframeDetails:function(){var e={};return"undefined"!=typeof Setup?(e.orgid=Setup.zgid,e.serviceName=Setup.serviceName,e.serviceID=Setup.serviceID,e.loadedIframe="pb_setup_iframe"):"undefined"!=typeof inbuiltTelephony?(e.orgid=inbuiltTelephony.orgId,e.serviceName=inbuiltTelephony.serviceName,e.serviceID=inbuiltTelephony.serviceID,e.loadedIframe="inbuilt_setup_iframe"):void 0!==PhoneBridgeUtil&&(e.orgid=PhoneBridgeUtil.defaultOrg,e.serviceName=PhoneBridgeUtil.serviceName,e.serviceID=PhoneBridgeUtil.serviceID,e.loadedIframe="popup_iframe"),e},getCurrentSetupProviderID:function(){return"undefined"!=typeof inbuiltTelephony?inbuiltTelephony.providerId:"undefined"!=typeof Setup&&Setup.providerInfo?Setup.providerInfo.providerId:void 0}},pbinput={addinputBorder:function(e,t){if(Lyte.Component.registeredHelpers.isBigin()){var a=t.closest(".ignite-form-field");a.classList.contains("form-multiple-input")?t.closest(".ignite-form-field-input").classList.add("multiinput-focus"):a.classList.add("input-focus")}},removeinputBorder:function(e,t){if(Lyte.Component.registeredHelpers.isBigin()){var a=t.closest(".ignite-form-field");a.classList.contains("form-multiple-input")?t.closest(".ignite-form-field-input").classList.remove("multiinput-focus"):a.classList.remove("input-focus")}}};Lyte.Component.registerHelper("hasOwnProperty",(function(e,t){return!!e.hasOwnProperty(t)})),Lyte.Component.registerHelper("getCallerDisplayName",(function(e){return e.name||e.phonenumber})),Lyte.Component.registerHelper("getCdnDomain",(function(e,t,a){return COMMON_UTILS.cdnDomain+e+t+"."+a})),Lyte.Component.registerHelper("getCdnDomainFP",(function(e){return COMMON_UTILS.cdnDomain+e}));var PBMurphy={murphyenabled:!1,environment:"",appKey:"",appDomain:"",authKey:"",init:function(e,t,a,i){window.murphy&&(PBMurphy.environment=e,PBMurphy.appKey=t,PBMurphy.appDomain=a,PBMurphy.authKey=i,murphy.config({appKey:PBMurphy.appKey,appDomain:PBMurphy.appDomain,environment:PBMurphy.environment,authKey:PBMurphy.authKey}),murphy.setTags((function(){return{buildId:"1001",zuid:PhoneBridgeUtil.zuid}})),murphy.install(),PBMurphy.addListener(),PBMurphy.murphyenabled=!0)},addListener:function(){Lyte.onerror=function(e){murphy.error(e)}},addCustomTracking:function(e,t){PBMurphy.murphyenabled&&murphy.addCustomTracking({message:t,type:e})},addLogger:function(e,t){if(PBMurphy.murphyenabled){var a={type:"custom event"};a.message=t,murphy.addCustomTracking(a),murphy.error(new Error(e))}}},ClientResourceLoader={featureVsResources:{phoneicon:["zpb_userconfig.js","zpb_userconfig.css"],widgeticon:["zpb_userconfig.js","zpb_userconfig.css"],transfer:["zpb_userconfig.js","transfer.js","tabs-pane.js","pb-dialpad.js","zpb_userconfig.css","transfer.css","tabs-pane.css","pb-dialpad.css"]},checkIfResourceLoaded:function(e){var t=!1;switch(e){case"zpb_userconfig.js":t="undefined"!=typeof zpb_config;break;default:t=-1!=ClientResourceLoader.loadedResources.indexOf(e)}return t},loadingResources:{},loadedResources:[],allPromisesArray:[],loadScript:function(e){return new Promise((function(t,a){var i=document.createElement("script");i.onload=i.onreadystatechange=function(){this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onload=this.onreadystatechange=null,t())};var l=PBClient.getFingerprintAndCSForFileName(e);i.src=l.cdnurl,PBClient.isIntegrityEnabled&&(i.integrity=l.integrity),i.crossOrigin="anonymous",document.getElementsByTagName("head")[0].appendChild(i)}))},loadCss:function(e){return new Promise((function(t,a){var i=document.createElement("link"),l=PBClient.getFingerprintAndCSForFileName(e);i.href=l.cdnurl,PBClient.isIntegrityEnabled&&(i.integrity=l.integrity),i.crossOrigin="anonymous",i.rel="stylesheet",i.type="text/css",i.onload=t,document.getElementsByTagName("head")[0].appendChild(i)}))},loadResource:function(e){if(ClientResourceLoader.checkIfResourceLoaded(e))return Promise.resolve();if(-1!=Object.keys(ClientResourceLoader.loadingResources).indexOf(e))return ClientResourceLoader.loadingResources[e];var t=null;return e.endsWith(".js")?t=ClientResourceLoader.loadScript(e):e.endsWith(".css")&&(t=ClientResourceLoader.loadCss(e)),ClientResourceLoader.loadingResources[e]=t,t.then((function(){delete ClientResourceLoader.loadingResources[e],ClientResourceLoader.loadedResources.push(e)})).catch((function(){delete ClientResourceLoader.loadingResources[e]}))},loadFeatureResources:function(e,t){for(var a=[],i=ClientResourceLoader.featureVsResources[e],l=0;l<i.length;l++)a.push(ClientResourceLoader.loadResource(i[l]));return ClientResourceLoader.allPromisesArray=ClientResourceLoader.allPromisesArray.concat(a),t?Promise.all(a).then((function(){t()})):Promise.all(a)},onAllResourcesLoaded:function(){return Promise.all(ClientResourceLoader.allPromisesArray)}},ClientDataManager={resourceNameVsModel:{},resourceVsCriteriaIdVsModel:{},resourceVsRecordIdVsData:{},getResourceModel:function(e,t,a,i,l,o){var n=ClientDataManager.getExistingResourceModel(e,t,a,o);if(!n)if(a){var r=ClientDataManager.resourceVsCriteriaIdVsModel[t];(n=new ClientDataModel(e,t)).setAndCriterias(i),n.setOrCriterias(l),n.setRequiredRelatedData(o),(r=r||{})[a]=n,ClientDataManager.resourceVsCriteriaIdVsModel[t]=r}else(n=new ClientDataModel(e,t)).setRequiredRelatedData(o),ClientDataManager.resourceNameVsModel[t]=n;return n},getExistingResourceModel:function(e,t,a,i){var l=null;if(a){var o=ClientDataManager.resourceVsCriteriaIdVsModel[t];l=o?o[a]:null}else l=ClientDataManager.resourceNameVsModel[t];if(l&&i)for(var n=i.length,r=0;r<n;r++){var s=i[r];if(!l.isRelationPresent(s)){l=null;break}}return l},getSingleRecordData:function(e,t,a){return new Promise((function(i,l){var o=commonHelper.getOrgServiceIframeDetails(),n={};a&&(n.required_related_data=JSON.stringify(a)),o.serviceID&&(n.serviceID=o.serviceID,n.serviceName=o.serviceName);var r={actionUrl:"/phonebridge/resources/"+e+"/"+t,params:n,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":o.orgid,"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(r).then((function(e){i(e)})).catch(l)}))},uncacheResources:function(e){delete ClientDataManager.resourceVsCriteriaIdVsModel[e],delete ClientDataManager.resourceNameVsModel[e]},pushRecordData:function(e,t,a){var i=ClientDataManager.resourceVsRecordIdVsData[e]||{};i[t]=a,ClientDataManager.resourceVsRecordIdVsData[e]=i},pushMultipleResourcesRecordData:function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var a=e[t],i=ClientDataManager.resourceVsRecordIdVsData[t]||{};a&&(ClientDataManager.resourceVsRecordIdVsData[t]=Object.assign(i,a))}},getDataByRecordId:function(e,t){return(ClientDataManager.resourceVsRecordIdVsData[e]||{})[t]}};function ClientDataModel(e,t){this.zorgID=e,this.resourceName=t,this.limit_size=100,this.nextToIDVsData={},this.pageIDOrder=[],this.currentPageId=null}function updateSlider(e){$L(this.$node.querySelector(".zpb-sliderBox")).css({"margin-left":-310*e+"px"}),$L(".zpb-currentOpenCall .currentPage").text(e+1)}ClientDataModel.prototype.setPageSize=function(e){this.limit_size!==e&&(this.limit_size=e,this.nextToIDVsData={},this.pageIDOrder=[],this.currentPageId=null)},ClientDataModel.prototype.setAndCriterias=function(e){this.and_criterias=e},ClientDataModel.prototype.setOrCriterias=function(e){this.or_criterias=e},ClientDataModel.prototype.setRequiredRelatedData=function(e){this.required_related_data=e},ClientDataModel.prototype.isRelationPresent=function(e){return this.required_related_data&&e&&-1!==this.required_related_data.indexOf(e)},ClientDataModel.prototype.setServiceDetails=function(e,t){this.serviceName=e,this.serviceID=t},ClientDataModel.prototype.getRecordDataIfAvailable=function(e,t){for(var a in this.nextToIDVsData)if(this.nextToIDVsData.hasOwnProperty(a))for(var i=obj[a],l=i.data,o=l?l.length:0,n=0;n<o;n++){var r=l[n];if(r[e]===t)return{related_data:i.related_data,data:r}}return null},ClientDataModel.prototype.hasPreviousPage=function(e){return this.pageIDOrder.indexOf(e)>0},ClientDataModel.prototype.getPreviousPageID=function(e){var t=this.pageIDOrder.indexOf(e);return t>0?this.pageIDOrder[t-1]:""},ClientDataModel.prototype.hasNextPage=function(e){var t=this.pageIDOrder.indexOf(e);return this.pageIDOrder.length>t+1},ClientDataModel.prototype.getNextPageID=function(e){var t=this.pageIDOrder.indexOf(e);return this.pageIDOrder.length>t+1?this.pageIDOrder[t+1]:""},ClientDataModel.prototype.getData=function(e){return new Promise(function(t,a){if(void 0!==typeof zpb_twilio&&(this.nextToIDVsData.default=void 0),e||!this.nextToIDVsData.default)if(e&&this.nextToIDVsData[e])t(this.nextToIDVsData[e]);else{var i={limit_size:this.limit_size};e&&(i.next_to=e),this.and_criterias&&(i.and_criterias=JSON.stringify(this.and_criterias)),this.or_criterias&&(i.or_criterias=JSON.stringify(this.or_criterias)),this.required_related_data&&(i.required_related_data=JSON.stringify(this.required_related_data)),this.serviceID&&(i.serviceID=this.serviceID,i.serviceName=this.serviceName),-1===this.pageIDOrder.indexOf(e)&&this.pageIDOrder.push(e),this.currentPageId=e||null;var l={actionUrl:"/phonebridge/resources/"+this.resourceName,params:i,type:"GET",authentication:"cookies",headers:{"X-PB-ORG":this.zorgID,"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(l).then(function(a){var i=e||"default";if(a.data){this.nextToIDVsData[i]=a;var l=a.upto;a.data.length>=this.limit_size&&-1===this.pageIDOrder.indexOf(l)&&this.pageIDOrder.push(l)}else this.nextToIDVsData[i]={data:[],upto:null,limit_size:this.limit_size};t(this.nextToIDVsData[i])}.bind(this)).catch(a)}else t(this.nextToIDVsData.default)}.bind(this))},Lyte.Component.register("call-pop",{_template:'<template tag-name="call-pop" id="call-{{clientcallid}}"> <div class="callPopWrapper"> <div class="{{if(isMiniUI,\'dN\',\'\')}}"> <div class="zpb-onGoing zpb-{{callstate}} {{if(viewCallsinQueue,\'zpb-viewCalls\',\'\')}}" id="callDiv{{clientcallid}}"> <div class="zpb-header zpb-clearFix" onclick="{{action(\'maxCall\',clientcallid,event)}}"> <div class="{{if(isMergedCallUI(associatedCallRefState,associatedCallRefSubState),\'zpb-merging\',\'\')}}"> <template is="if" value="{{callerdetails.dp_uri}}"><template case="true"> <div class="fL zpb-callerAvatar"> <img src="{{callerdetails.dp_uri}}" alt="{{getfirstletter(callerdetails.name)}}"> </div> </template><template case="false"><template is="if" value="{{callerdetails.recordexist}}"><template case="true"> <div class="fL zpb-callerAvatar zpb-firstLetterImg"> {{getfirstletter(callerdetails.name)}} </div> </template><template case="false"> <div class="fL zpb-callerAvatar"> <img src="{{getCdnDomainFP(\'/images/nophoto.png\')}}"> </div> </template></template></template></template> <template is="if" value="{{expHandlers(callerdetails.dp_status,\'&amp;&amp;\',callerdetails.dp_status.uri)}}"><template case="true"> <template is="if" value="{{callerdetails.dp_status.tooltip}}"><template case="true"> <span class="zpb-statusIcon"><img src="{{callerdetails.dp_status.uri}}" lt-prop-title="{{callerdetails.dp_status.tooltip}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;right&quot;}"></span> </template><template case="false"> <span class="zpb-statusIcon"><img src="{{callerdetails.dp_status.uri}}"></span> </template></template> </template></template> <template is="if" value="{{isMergedCallUI(associatedCallRefState,associatedCallRefSubState)}}"><template case="true"> <template is="if" value="{{associatedCallCallerDetails.dp_uri}}"><template case="true"> <div class="fL zpb-callerAvatar zpb-merging-childimg"> <img src="{{associatedCallCallerDetails.dp_uri}}" alt="{{getfirstletter(associatedCallCallerDetails.name)}}"> </div> </template><template case="false"><template is="if" value="{{associatedCallCallerDetails.recordexist}}"><template case="true"> <div class="fL zpb-callerAvatar zpb-firstLetterImg zpb-merging-childimg"> {{getfirstletter(associatedCallCallerDetails.name)}} </div> </template><template case="false"> <div class="fL zpb-callerAvatar zpb-merging-childimg"> <img src="{{getCdnDomainFP(\'/images/nophoto.png\')}}"> </div> </template></template></template></template> </template></template> </div> <div class="fL zpb-callerInfo mT3"> <div class="vam zpb-namediv clearfix"> <call-pop-title class="dIB fL" callerdetails="{{callerdetails}}" show-last-name-alone="{{isMergedCallUI(associatedCallRefState,associatedCallRefSubState)}}"></call-pop-title> <template is="if" value="{{isMergedCallUI(associatedCallRefState,associatedCallRefSubState)}}"><template case="true"> <call-pop-title callerdetails="{{associatedCallCallerDetails}}" prefix-string=" &amp; " show-last-name-alone="true"></call-pop-title> </template></template> <template is="if" value="{{callerdetails.custom_img}}"><template case="true"> <template is="if" value="{{callerdetails.custom_img.image}}"><template case="true"> <span class="fL zpb-customImg"> <img src="{{callerdetails.custom_img.image}}"> </span> </template></template> <template is="if" value="{{callerdetails.custom_img.text}}"><template case="true"> <span class="fL zpb-customImgTxt">{{callerdetails.custom_img.text}}</span> </template></template> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(callstate,\'==\',&quot;answered&quot;),\'||\',expHandlers(callstate,\'==\',&quot;ended&quot;)),\'&amp;&amp;\',callactionJson),\'&amp;&amp;\',expHandlers(getjsonsize(callactionJson),\'!=\',0)),\'&amp;&amp;\',expHandlers(isInternalCall,\'!\'))}}"><template case="true"> <i id="addIcon{{clientcallid}}" class="cP zpb-callActionIcon" onclick="{{action(\'setDescFlag\')}}"></i> </template></template> </div> <div class="zpb-additionalDetails vam cB"> <template is="if" value="{{callerdetails.additional_details}}"><template case="true"><template is="if" value="{{callerdetails.additional_details_uri}}"><template case="true"> <span class="cP" onclick="{{action(\'openUrlFromPopup\',callerdetails.additional_details_uri,callerdetails.uri_target)}}">{{callerdetails.additional_details}}</span> </template><template case="false"> <span>{{callerdetails.additional_details}}</span> </template></template></template></template> </div> <div class="zpb-hypenTxt">-</div> <div class="vam dIB"> <div class="zpb-callTimer">00:00</div> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(ifEquals(subState,&quot;hold&quot;),\'&amp;&amp;\',ifEquals(callstate,&quot;answered&quot;)),\'&amp;&amp;\',associatedCallRefId),\'&amp;&amp;\',associatedCallRefState),\'&amp;&amp;\',expHandlers(associatedCallRefState,\'!=\',&quot;ended&quot;)),\'&amp;&amp;\',expHandlers(associatedCallRefState,\'!=\',&quot;missed&quot;))}}"><template case="true"> <div class="zpb-holdSubState">- {{getI18n("phonebridge.onhold")}}</div> </template></template> </div> <div class="zpb-callState">{{getI18n("phonebridge.calling")}}</div> <div class="clicktodialedCallTxt outGoingCallTxt">{{getI18n("phonebridge.connecting")}}</div> <div class="agentdialedCallTxt outGoingCallTxt">{{getI18n("phonebridge.agentdialed")}}</div> <template is="if" value="{{ifEquals(servicename,&quot;SDPOnDemand&quot;)}}"><template case="true"> <div class="customerdialedCallTxt outGoingCallTxt">{{getI18n("phonebridge.calling")}}</div> </template><template case="false"> <div class="customerdialedCallTxt outGoingCallTxt">{{getI18n("phonebridge.customerdialed")}}</div> </template></template> </div> <template is="if" value="{{expHandlers(callControls.decline,\'&amp;&amp;\',ifEquals(callstate,&quot;ringing&quot;))}}"><template case="true"> <div class="zpb-callActions fR zpb-answerButton {{if(callControls.answer,\'\',\'dN\')}}" style="right:105px;" onclick="{{action(\'answerCall\')}}"> {{getI18n("phonebridge.answer")}} </div> <div class="zpb-callActions fR zpb-declineBtn {{if(callControls.decline,\'\',\'dN\')}}" onclick="{{action(\'endCall\')}}">{{getI18n("phonebridge.decline")}}</div> </template><template case="false"> <div class="zpb-callActions fR zpb-answerButton {{if(callControls.answer,\'\',\'dN\')}}" onclick="{{action(\'answerCall\')}}"> {{getI18n("phonebridge.answer")}} </div> </template></template> <template is="if" value="{{callControls.leave}}"><template case="true"> <div class="zpb-callActions fR zpb-endButton" onclick="{{action(\'raiseActionRequest\',\'leavecall\')}}"> {{getI18n("phonebridge.endcall")}} </div> </template><template case="false"><template is="if" value="{{callControls.end}}"><template case="true"> <div class="zpb-callActions fR zpb-endButton" onclick="{{action(\'endCall\')}}"> {{getI18n("phonebridge.endcall")}} </div> </template></template></template></template><template is="if" value="{{callControls.hold}}"><template case="true"> <div class="zpb-callHoldTxt fR">{{getI18n("phonebridge.onhold")}}</div> </template></template> <div class="zpb-activeCallText fR">Active</div> <div class="zpb-endCallText fR">Ended</div> <div class="minimizeBar_pb" onclick="{{action(\'minCall\',clientcallid,event)}}"></div> </div> <div class="zpb-callContent" id="pbContent_{{clientcallid}}"> <template is="if" value="{{expHandlers(isInternalCall,\'&amp;&amp;\',associatedCallerDetails)}}"><template case="true"> <associated-call-pop actual-caller-details="{{callerdetails}}" callerdetails="{{associatedCallerDetails}}" phonenumber="{{associatedCallerDetails.phonenumber}}" orgid="{{orgid}}" clientcallid="{{clientcallid}}"></associated-call-pop> <div class="zpb-beforeEndCall"> <call-controls class="{{if(isCallControlsForShow(callstate,subState,associatedCallRefState,associatedCallRefSubState),&quot;&quot;,&quot;dN&quot;)}}" disabled-call-controls="{\'parallelcall\':true}" call-controls="{{callControls}}" callrefid="{{callrefid}}" associated-call-ref-id="{{associatedCallRefId}}" orgid="{{orgid}}" clientcallid="{{clientcallid}}" current-controls="{{currentControls}}"> </call-controls> </div> </template></template> <div class="{{if(isInternalCall,\'dN\',\'reverseflex\')}}"> <div class="zpb-beforeEndCall"> <call-controls class="{{if(isCallControlsForShow(callstate,subState,associatedCallRefState,associatedCallRefSubState),&quot;&quot;,&quot;dN&quot;)}}" call-controls="{{callControls}}" callrefid="{{callrefid}}" associated-call-ref-id="{{associatedCallRefId}}" orgid="{{orgid}}" clientcallid="{{clientcallid}}" current-controls="{{currentControls}}"> </call-controls> <services-bar searchdata="{{searchdata}}" clientcallid="{{clientcallid}}" orgid="{{orgid}}"></services-bar> <lyte-input data-zcqa="call_description" class="zpb-answerCallDesc" lt-prop-placeholder="{{getI18n(&quot;phonebridge.calldescription.propercase&quot;)}}" lt-prop-type="textarea" lt-prop-text-area-resize="{&quot;horizontal&quot; : false, &quot;vertical&quot; : false }"> </lyte-input> </div> <div class="zpb-afterEndCall"> <div class="zpb-callDispositionContainer"> <div class="zpb-callDisposition"> <div class="zpb-callDispositionHeader zpb-font-semibold">{{getI18n("phonebridge.popup.disposition")}}</div> <div class="zpb-descriptionBlock"> <div class="zpb-descriptionHeader zpb-font-semibold">{{getI18n("phonebridge.description.propercase")}}</div> <lyte-input data-zcqa="call_description" class="zpb-endCallDesc" lt-prop-placeholder="{{getI18n(&quot;phonebridge.calldescription.propercase&quot;)}}" lt-prop-type="textarea" lt-prop-text-area-resize="{&quot;horizontal&quot; : false, &quot;vertical&quot; : false }" oninput="{{action(\'setDescFlag\')}}"> </lyte-input> </div> <template is="if" value="{{expHandlers(followupJson,\'&amp;&amp;\',expHandlers(getjsonsize(followupJson),\'!=\',0))}}"><template case="true"> <div class="zpb-followUpBlock"> <div class="zpb-followUpHeader zpb-font-semibold">{{getI18n("phonebridge.followup")}}</div> <div id="followupAdd{{clientcallid}}" class="zpb-followUpAddTxt" onclick="{{action(\'setDescFlag\')}}">{{getI18n("phonebridge.add.propercase")}}</div> <div class="zpb-followUpResultBlock"> <template is="for" items="{{followUpResult}}" item="followUpValue" index="index"> <div class="zpb-followUpResult"> <div class="zpb-followUpKey">{{followUpValue.type}}</div> <div class="zpb-followUpValue zpb-font-semibold">{{followUpValue.details}}</div> </div> </template> <div class="zpb-followUpResult dN"> <div class="zpb-followUpKey">Followup Task</div><div class="zpb-followUpValue zpb-font-semibold">Schedule a BSS Meeting</div> </div> <div class="zpb-followUpResult dN"> <div class="zpb-followUpKey">Followup Task</div><div class="zpb-followUpValue zpb-font-semibold">Schedule a BSS Meeting</div> </div> </div> </div> </template></template> <div class="zpb-callDoneBlock"> <lyte-button class="zpb-callDoneBtn" lt-prop-appearance="primary" lt-prop-class="lyteSm" onclick="{{action(\'saveDesc\')}}"> <template is="registerYield" yield-name="text">{{getI18n("phonebridge.done.propercase")}}</template> </lyte-button> </div> </div> </div> </div> <div id="zpbparallelCall_{{clientcallid}}" class="parallelCallDiv {{if(isChildPopForShow(associatedCallRefState,associatedCallRefSubState),\'\',\'dN\')}}"> </div> </div> <template is="if" value="{{expHandlers(expHandlers(isMiniUI,\'!\'),\'&amp;&amp;\',expHandlers(isInternalCall,\'!\'))}}"><template case="true"> <template is="if" value="{{expHandlers(callactionJson,\'&amp;&amp;\',expHandlers(getjsonsize(callactionJson),\'!=\',0))}}"><template case="true"> <template is="if" value="{{expHandlers(getjsonsize(enabledServicesMap),\'>\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#addIcon{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{enabledServicesMap}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(callactionJson[servicename]),\'!=\',0)}}"><template case="true"> <lyte-menu-item id="{{servicename}}callaction"> <lyte-menu-label><span class="dIB vam mR10"><img src="{{getCdnDomain(\'/images/\',servicename,\'ico\')}}" style="height:16px;"></span><span class="dIB vam">{{getdisplayname(enabledServicesMap,servicename)}}</span></lyte-menu-label> </lyte-menu-item> </template><template case="false"> <lyte-menu-item id="{{servicename}}callaction" class="disabled"> <lyte-menu-label><span class="dIB vam mR10"><img src="{{getCdnDomain(\'/images/\',servicename,\'ico\')}}" style="height:16px;"></span><span class="dIB vam">{{getdisplayname(enabledServicesMap,servicename)}}</span></lyte-menu-label> </lyte-menu-item> </template></template> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{callactionJson}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(servicevalue),\'!=\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}callaction" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu-item id="{{servicename}}{{serviceid}}callaction"> <lyte-menu-label><span class="dIB vam">{{getportalname(enabledServicesMap,servicename,serviceid)}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}{{serviceid}}callaction" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadCallAction&quot;,servicename,serviceid,urljson.action_uri)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template><template case="false"> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}callaction" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadCallAction&quot;,servicename,serviceid,urljson.action_uri)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template></template> </template> </template><template case="false"> <template is="forIn" object="{{callactionJson}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(servicevalue),\'!=\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#addIcon{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu-item id="{{servicename}}{{serviceid}}callaction"> <lyte-menu-label><span class="dIB vam">{{getportalname(enabledServicesMap,servicename,serviceid)}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}{{serviceid}}callaction" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadCallAction&quot;,servicename,serviceid,urljson.action_uri)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template><template case="false"> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#addIcon{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadCallAction&quot;,servicename,serviceid,urljson.action_uri)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template></template> </template> </template></template> </template></template> <template is="if" value="{{expHandlers(followupJson,\'&amp;&amp;\',expHandlers(getjsonsize(followupJson),\'!=\',0))}}"><template case="true"> <template is="if" value="{{expHandlers(getjsonsize(enabledServicesMap),\'>\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#followupAdd{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{enabledServicesMap}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(followupJson[servicename]),\'!=\',0)}}"><template case="true"> <lyte-menu-item id="{{servicename}}followup"> <lyte-menu-label><span class="dIB vam mR10"><img src="{{getCdnDomain(\'/images/\',servicename,\'ico\')}}" style="height:16px;"></span><span class="dIB vam">{{getdisplayname(enabledServicesMap,servicename)}}</span></lyte-menu-label> </lyte-menu-item> </template><template case="false"> <lyte-menu-item id="{{servicename}}followup" class="disabled"> <lyte-menu-label><span class="dIB vam mR10"><img src="{{getCdnDomain(\'/images/\',servicename,\'ico\')}}" style="height:16px;"></span><span class="dIB vam">{{getdisplayname(enabledServicesMap,servicename)}}</span></lyte-menu-label> </lyte-menu-item> </template></template> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{followupJson}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(servicevalue),\'!=\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}followup" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu-item id="{{servicename}}{{serviceid}}followup"> <lyte-menu-label><span class="dIB vam">{{getportalname(enabledServicesMap,servicename,serviceid)}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}{{serviceid}}followup" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadFollowUp&quot;,servicename,serviceid,urljson.action_uri,urljson.action_name)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template><template case="false"> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}followup" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadFollowUp&quot;,servicename,serviceid,urljson.action_uri,urljson.action_name)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template></template> </template> </template><template case="false"> <template is="forIn" object="{{followupJson}}" value="servicevalue" key="servicename"> <template is="if" value="{{expHandlers(getjsonsize(servicevalue),\'!=\',1)}}"><template case="true"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#followupAdd{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu-item id="{{servicename}}{{serviceid}}followup"> <lyte-menu-label><span class="dIB vam">{{getportalname(enabledServicesMap,servicename,serviceid)}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#{{servicename}}{{serviceid}}followup" lt-prop-wrapper-class="zpb-callActionMenu" lt-prop-event="mouseenter" lt-prop-position="left"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadFollowUp&quot;,servicename,serviceid,urljson.action_uri,urljson.action_name)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template><template case="false"> <template is="forIn" object="{{servicevalue}}" value="portalvalue" key="serviceid"> <lyte-menu lt-prop-callout="true" lt-prop-yield="true" lt-prop-query="#followupAdd{{clientcallid}}" lt-prop-wrapper-class="zpb-callActionMenu"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{portalvalue}}" item="urljson" index="index"> <lyte-menu-item onclick="{{action(&quot;loadFollowUp&quot;,servicename,serviceid,urljson.action_uri,urljson.action_name)}}"> <lyte-menu-label><span class="dIB vam">{{urljson.action_name}}</span></lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> </template> </template></template> </template> </template></template> </template></template> </template></template> </div> </div> </div> <template is="if" value="{{isMiniUI}}"><template case="true"> <mini-call-pop callrefid="{{callrefid}}" associated-call-ref-id="{{associatedCallRefId}}" orgid="{{orgid}}" callstate="{{callstate}}" sub-state="{{subState}}" callerdetails="{{callerdetails}}" call-controls="{{callControls}}" childcallstate="{{childcallstate}}"></mini-call-pop> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,1,1,1]},{type:"attr",position:[1,1,1,1,1,1]},{type:"if",position:[1,1,1,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,1,3]},{type:"if",position:[1,1,1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,1,5]},{type:"if",position:[1,1,1,1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,3,1,1]},{type:"componentDynamic",position:[1,1,1,1,3,1,1]},{type:"attr",position:[1,1,1,1,3,1,3]},{type:"if",position:[1,1,1,1,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,1,1,3,1,5]},{type:"if",position:[1,1,1,1,3,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,3,1,7]},{type:"if",position:[1,1,1,1,3,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,1,1,3,3,1]},{type:"if",position:[1,1,1,1,3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,3,7,3]},{type:"if",position:[1,1,1,1,3,7,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"text",position:[1,1,1,1,3,9,0]},{type:"text",position:[1,1,1,1,3,11,0]},{type:"text",position:[1,1,1,1,3,13,0]},{type:"attr",position:[1,1,1,1,3,15]},{type:"if",position:[1,1,1,1,3,15],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,1,1,5]},{type:"if",position:[1,1,1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"attr",position:[3]},{type:"text",position:[3,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,1,7]},{type:"if",position:[1,1,1,1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,8]},{type:"if",position:[1,1,1,1,8],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,1,1,14]},{type:"attr",position:[1,1,1,3]},{type:"attr",position:[1,1,1,3,1]},{type:"if",position:[1,1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]}]}},default:{}},{type:"attr",position:[1,1,1,3,3]},{type:"attr",position:[1,1,1,3,3,1,1]},{type:"componentDynamic",position:[1,1,1,3,3,1,1]},{type:"attr",position:[1,1,1,3,3,1,3]},{type:"componentDynamic",position:[1,1,1,3,3,1,3]},{type:"attr",position:[1,1,1,3,3,1,5]},{type:"componentDynamic",position:[1,1,1,3,3,1,5]},{type:"text",position:[1,1,1,3,3,3,1,1,1,0]},{type:"text",position:[1,1,1,3,3,3,1,1,3,1,0]},{type:"attr",position:[1,1,1,3,3,3,1,1,3,3]},{type:"componentDynamic",position:[1,1,1,3,3,3,1,1,3,3]},{type:"attr",position:[1,1,1,3,3,3,1,1,5]},{type:"if",position:[1,1,1,3,3,3,1,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5,1]},{type:"for",position:[1,5,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"text",position:[1,3,0]}]}]}},default:{}},{type:"attr",position:[1,1,1,3,3,3,1,1,7,1]},{type:"registerYield",position:[1,1,1,3,3,3,1,1,7,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,1,1,3,3,3,1,1,7,1]},{type:"attr",position:[1,1,1,3,3,5]},{type:"attr",position:[1,1,1,3,5]},{type:"if",position:[1,1,1,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0,0]},{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0,0]},{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]}},default:{}}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]}},default:{}}]}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0,0]},{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,0,0]},{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]}},default:{}}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"forIn",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"forIn",position:[3],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"forIn",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}]}},default:{}}]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["features","clientcallid","callstate","callerdetails","isNewCall","isCollapsed","answeredtime","timerData","callduration","servicename","serviceid","servicesarray","searchdata","recordexist","defaultsearch","phonenumber","servicesCallBackParam","callactionJson","followupJson","enabledServicesMap","orgid","childcallstate","callControls","latestServiceName","callDirection","currentControls","isCTD","callrefid","associatedCallRefId","associatedCallRefState","associatedCallRefSubState","associatedCallCallerDetails","associatedCallerDetails","forceEndIcon","callDesc","followUpResult","hold","subState","isMiniUI","isInternalCall","dialPadInternalDialed","timeoutConfig","autoCloseTimer","lastNotificationMillis","callDescFlag","viewCallsinQueue","dumTimer","isCallTransfered","isGoneState","desc_data"],data:function(){return{features:Lyte.attr("array"),clientcallid:Lyte.attr("string"),callstate:Lyte.attr("string"),callerdetails:Lyte.attr("object"),isNewCall:Lyte.attr("boolean"),isCollapsed:Lyte.attr("boolean"),answeredtime:Lyte.attr("number"),timerData:Lyte.attr("number"),callduration:Lyte.attr("number",{default:0}),servicename:Lyte.attr("string"),serviceid:Lyte.attr("string"),servicesarray:Lyte.attr("array"),searchdata:Lyte.attr("object"),recordexist:Lyte.attr("boolean"),defaultsearch:Lyte.attr("object"),phonenumber:Lyte.attr("string"),servicesCallBackParam:Lyte.attr("object"),callactionJson:Lyte.attr("object"),followupJson:Lyte.attr("object"),enabledServicesMap:Lyte.attr("object"),orgid:Lyte.attr("string"),childcallstate:Lyte.attr("string"),callControls:Lyte.attr("object"),latestServiceName:Lyte.attr("string"),callDirection:Lyte.attr("string"),currentControls:Lyte.attr("object",{default:{mute:!1,hold:!1}}),isCTD:Lyte.attr("boolean"),callrefid:Lyte.attr("string"),associatedCallRefId:Lyte.attr("string"),associatedCallRefState:Lyte.attr("string"),associatedCallRefSubState:Lyte.attr("string"),associatedCallCallerDetails:Lyte.attr("string"),associatedCallerDetails:Lyte.attr("object"),forceEndIcon:Lyte.attr("boolean",{default:!1}),callDesc:Lyte.attr("string"),followUpResult:Lyte.attr("array",{default:[]}),hold:Lyte.attr("boolean",{default:!1}),subState:Lyte.attr("string"),isMiniUI:Lyte.attr("boolean",{default:!1}),isInternalCall:Lyte.attr("boolean",{default:!1}),dialPadInternalDialed:Lyte.attr("boolean",{default:!1}),timeoutConfig:Lyte.attr("object",{default:{ringing:15e4,customerdialed:15e4,agentdialed:15e4,clicktodial:12e4,ended:18e4,transferended:12e4}}),autoCloseTimer:Lyte.attr("number"),lastNotificationMillis:Lyte.attr("number"),callDescFlag:Lyte.attr("boolean",{default:!1}),viewCallsinQueue:Lyte.attr("boolean",{default:!1}),dumTimer:Lyte.attr("number"),isCallTransfered:Lyte.attr("boolean",{default:!1}),isGoneState:Lyte.attr("boolean",{default:!1}),desc_data:Lyte.attr("string",{default:""})}},init:function(){PhoneBridgeUtil.multiOrgData[this.getData("orgid")].answeredNotification||this.setData("timeoutConfig",{agentdialed:15e4,clicktodial:12e4,ended:18e4,transferended:12e4});var e={};if(e.end=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].endAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].endAllowed,e.decline=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].declineAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].declineAllowed,e.answer=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].answerAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].answerAllowed,e.hold=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].holdAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].holdAllowed,e.mute=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].muteAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].muteAllowed,e.keypress=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].keypressAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].keypressAllowed,e.transfer=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].transferAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].transferAllowed,e.leave=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].leaveAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].leaveAllowed,e.mergeandleave=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeandleaveAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeandleaveAllowed,e.merge=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeAllowed,PhoneBridgeUtil.multiOrgData[this.getData("orgid")].toUserPresent?e.dialpadinternalcall=!1:e.dialpadinternalcall=!0,e.parallelcall=!1,PhoneBridgeUtil.multiOrgData[this.getData("orgid")].parallelcallAllowed&&(e.parallelcall=PhoneBridgeUtil.multiOrgData[this.getData("orgid")].parallelcallAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].callButtonAllowed),"transferred_to_phone"==this.getData("subState")&&(e.end=e.answer=e.hold=e.mute=e.keypress=e.transfer=e.leave=e.mergeandleave=e.merge=e.parallelcall=!1),this.setData("callControls",e),PhoneBridgeUtil.multiOrgData[this.getData("orgid")].headlessJson)this.setData("callactionJson",Zoho.PhoneBridge.UI.getCallActionJson(this.getData("orgid"),this.getData("searchdata"))),this.setData("followupJson",Zoho.PhoneBridge.UI.getFollowUpJson(this.getData("orgid"),this.getData("searchdata")));else{var t={actionUrl:"/phonebridge/headless/config",type:"GET",authentication:"cookies",headers:{"X-PB-ORG":this.getData("orgid")},params:{}};COMMON_UTILS.fetchRequest(t).then(function(e){PhoneBridgeUtil.multiOrgData[this.getData("orgid")].headlessJson=e.callaction,PhoneBridgeUtil.multiOrgData[this.getData("orgid")].followupJson=e.followup,this.setData("callactionJson",Zoho.PhoneBridge.UI.getCallActionJson(this.getData("orgid"),this.getData("searchdata"))),this.setData("followupJson",Zoho.PhoneBridge.UI.getFollowUpJson(this.getData("orgid"),this.getData("searchdata")))}.bind(this))}},didConnect:function(){var e=this.getAssociatedCallComp();e&&(e.setData("associatedCallRefId",this.getData("callrefid")),e.setData("associatedCallRefState",this.getData("callstate")),e.setData("associatedCallRefSubState",this.getData("subState")),e.setData("associatedCallCallerDetails",this.getData("callerdetails")),this.setData("associatedCallRefState",e.getData("callstate")),this.setData("associatedCallRefSubState",e.getData("subState")),this.setData("associatedCallCallerDetails",e.getData("callerdetails"))),this.adaptToAssociatedCall(),0==Zoho.PhoneBridge.CallsArray.length&&(Zoho.PhoneBridge.CallsArray.push(this.getData("clientcallid")),Zoho.PhoneBridge.activeCall=this.getData("clientcallid"),this.$node.querySelector(".zpb-onGoing").classList.add("zpb-currentOpenCall")),Zoho.PhoneBridge.activeCall!=this.getData("clientcallid")&&(this.$node.querySelector(".zpb-onGoing").classList.add("ringing"==this.getData("callstate")?"zpb-secondCallIncoming":"zpb-secondCall"),-1==Zoho.PhoneBridge.CallsArray.indexOf(this.getData("clientcallid"))&&Zoho.PhoneBridge.CallsArray.push(this.getData("clientcallid"))),this.methods.stateRendering.bind(this)(this.getData("callstate")),$L(this.$node.querySelector(".zpb-additionalInfo")).scroll(),document.getElementById("call-"+this.getData("clientcallid")).setAttribute("data-pbqa","popup"+Zoho.PhoneBridge.CallsArray.indexOf(this.getData("clientcallid"))),this.$node.querySelector(".zpb-onGoing")&&this.getData("hold")&&this.$node.querySelector(".zpb-onGoing").classList.add("zpb-onHold"),this.setData("lastNotificationMillis",this.getData("lastNotificationMillis")?this.getData("lastNotificationMillis"):+new Date)},actions:{setDescFlag:function(){this.getData("callDescFlag")||"ended"!=this.getData("callstate")||pbTabManager.publishByWms("PhoneBridgeUtil.timerOff",{clientcallid:this.getData("clientcallid")},null)},openUrlFromPopup:function(e,t){"iframe"==t?Zoho.PhoneBridge.UI.openHeadless(e):window.open(e,"_blank")},hideContact:function(){$L(".zpb-additionalInfoContent").slideUp()},maxCall:function(e,t){if(!document.getElementById("callDiv"+e).classList.contains("zpb-currentOpenCall")){var a=document.getElementsByClassName("zpb-currentOpenCall")[0];a&&this.actions.minCall.bind(this)(a.id.split("callDiv")[1],t),$L("#callDiv"+e).removeClass("zpb-secondCallIncoming"),$L("#callDiv"+e).removeClass("zpb-secondCall"),$L("#callDiv"+e).addClass("zpb-currentOpenCall"),$L("#pbContent_"+e).css("display","none"),$L("#pbContent_"+e+" .zpb-serviceSideBar").removeClass("zpb-serviceSideBarAnimate"),$L("#pbContent_"+e+" .zpb-serviceSideBar").css("left","0"),$L("#pbContent_"+e).slideDown((function(){$L("#pbContent_"+e+" .zpb-serviceSideBar").addClass("zpb-serviceSideBarAnimate"),Zoho.PhoneBridge.UI.adjustMultiCallPopup()})),Zoho.PhoneBridge.UI.adjustMultiCallPopup(),Zoho.PhoneBridge.activeCall=e,t.stopPropagation()}},minCall:function(e,t){var a=document.getElementById("callDiv"+e);a.classList.remove("zpb-currentOpenCall"),a.classList.contains("zpb-ringing")?a.classList.add("zpb-secondCallIncoming"):a.classList.add("zpb-secondCall"),$L("#pbContent_"+e).css("display","block"),$L("#pbContent_"+e).slideUp((function(){Zoho.PhoneBridge.UI.adjustMultiCallPopup()})),Zoho.PhoneBridge.UI.adjustMultiCallPopup(),t.stopPropagation()},showCurrentactiveCall:function(e,t,a){if(Zoho.PhoneBridge.activeCall!=e){for(var i=$(".zpb-onGoing"),l=0;l<i.length;l++)i[l].id!="callDiv"+e?i[l].classList.contains("zpb-ringing")?i[l].classList.add("zpb-secondCallIncoming"):i[l].classList.add("zpb-secondCall"):(i[l].classList.remove("zpb-secondCall"),i[l].classList.remove("zpb-secondCallIncoming"));$L("#pbContent_"+e).css("display","none"),$L("#pbContent_"+Zoho.PhoneBridge.activeCall).css("display","block"),$L("#pbContent_"+Zoho.PhoneBridge.activeCall).slideUp(),$L("#callDiv"+e).addClass("zpb-currentOpenCall"),$L("#callDiv"+Zoho.PhoneBridge.activeCall).removeClass("zpb-currentOpenCall"),$L("#pbContent_"+e+" .zpb-serviceSideBar").removeClass("zpb-serviceSideBarAnimate"),$L("#pbContent_"+e+" .zpb-serviceSideBar").css("left","0"),$L("#pbContent_"+e).slideDown((function(){$L("#pbContent_"+e+" .zpb-serviceSideBar").addClass("zpb-serviceSideBarAnimate"),Zoho.PhoneBridge.UI.adjustMultiCallPopup()})),Zoho.PhoneBridge.activeCall=e,Zoho.PhoneBridge.UI.adjustMultiCallPopup()}},closeCallPopup:function(){PhoneBridgeUtil.multiOrgData[this.getData("orgid")].providerId,this.getData("clientcallid"),this.getData("orgid")},answerCall:function(){PhoneBridgeUtil.answercall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})},endCall:function(){PhoneBridgeUtil.endcall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})},raiseActionRequest:function(e){"answered"===this.getData("callstate")&&PhoneBridgeUtil.raiseActionRequest({callRefId:this.getData("callrefid"),orgId:this.getData("orgid"),associatedCallRefId:this.getData("associatedCallRefId"),actionName:e})},loadCallAction:function(e,t,a){var i={};i.servicename=e,i.serviceid=t,i.type="callaction",i.phonenumber=this.getData("phonenumber"),i.orgid=this.getData("orgid"),i.callrefid=this.getData("callrefid"),i.clientcallid=this.getData("clientcallid"),Zoho.PhoneBridge.CurrentHeadless=i,a=(a=(a=(a=a.replace("{phonenumber}",i.phonenumber)).replace("{calldirection}",this.getData("callDirection")))+"&callbackcode="+PhoneBridgeUtil.getCallBackCode(e,t,this.getData("callrefid"),0))+"&frameorigin=https://"+document.domain,Zoho.PhoneBridge.UI.openHeadless(a)},loadFollowUp:function(e,t,a,i){var l={};l.servicename=e,l.serviceid=t,l.type="followup",l.followuptype=i,l.orgid=this.getData("orgid"),l.callrefid=this.getData("callrefid"),l.clientcallid=this.getData("clientcallid"),Zoho.PhoneBridge.CurrentHeadless=l;var o=this.getData("searchdata");a=(a=(a=(a=(a=(a=(a=a.replace("{recordid}",o[e][t].callerdetails.recordid)).replace("{module}",o[e][t].callerdetails.module)).replace("{entityid}",o[e][t].callerdetails.recordid)).replace("{entitymodule}",o[e][t].callerdetails.module)).replace("{calldirection}",this.getData("callDirection")))+"&callbackcode="+PhoneBridgeUtil.getCallBackCode(e,t,this.getData("callrefid"),"followup"+i))+"&frameorigin=https://"+document.domain,Zoho.PhoneBridge.UI.openHeadless(a)},saveDesc:function(){if(this.getData("isCallTransfered"))this.setData("desc_data",this.$node.querySelector(".zpb-endCallDesc").ltProp("value")),$L("#call-"+this.getData("clientcallid")).hide(),this.setData("callstate","doNotAllow");else{var e=this.$node.querySelector(".zpb-endCallDesc").ltProp("value");""!=e.trim()&&PhoneBridgeUtil.saveDesc(this.getData("orgid"),e,this.getData("callrefid")),this.$node.querySelector(".zpb-callDoneBtn").ltProp("disabled","true"),Zoho.PhoneBridge.UI.closeallCallpopup(this.getData("orgid"),this.getData("clientcallid"))}}},methods:{timeInMMSS:function(e){return(Math.floor(e/60)+"").padStart("2",0)+":"+(Math.floor(e-60*Math.floor(e/60))+"").padStart("2","0")},timeInHHMMSS:function(e){e=Math.floor(e);var t="",a=Math.floor(e/3600),i=Math.floor((e-3600*a)/60)+"";return e=e-3600*a-60*i+"",a>0&&(t=t+(a+="").padStart("2",0)+":"),t=t+i.padStart("2",0)+":"+e.padStart("2",0)},autoClose:function(){this.getData("isCallTransfered")&&PhoneBridgeUtil.saveDesc(this.getData("orgid"),this.getData("desc_data"),this.getData("callrefid")),Zoho.PhoneBridge.UI.closeallCallpopup(this.getData("orgid"),this.getData("clientcallid"))},stateRendering:function(e){if("answered"==e){var t,a,i=COMMON_UTILS.browserDetect().includes("Mozilla Firefox"),l=COMMON_UTILS.browserDetect().includes("Apple Safari"),o={};pbTabManager.allcalls_limited_time[this.getData("callrefid")]&&(o[this.getData("callrefid")]=pbTabManager.allcalls_limited_time[this.getData("callrefid")]),this.getData("answeredtime")?t=this.getData("answeredtime"):(t=(new Date).getTime(),this.setData("answeredtime",t)),o[this.getData("callrefid")]||(o[this.getData("callrefid")]=Math.floor(t)+60*parseInt(pbTabManager.threshold_time)*1e3+"",window.BroadcastChannel&&pbTabManager.channeltosend.postMessage({set_call_time:JSON.stringify(o)})),setTimeout((()=>{(window.BroadcastChannel&&pbTabManager.ismaster&&pbTabManager.browserTabId===pbTabManager.masterid||pbTabManager.isslave&&!pbTabManager.ismaster&&pbTabManager.browserTabId===pbTabManager.slaveid&&pbTabManager.is_slavecreated_incall||window.BroadcastChannel&&pbTabManager.ismaster&&i&&pbTabManager.incall||pbTabManager.ismaster&&l)&&(a=!0)}),2e3);var n=setInterval(function(){var e=this.methods.timeInHHMMSS(+Math.floor(new Date-this.getData("answeredtime"))/1e3);this.$node.querySelector(".zpb-callTimer").innerHTML=e;var t=this.getData("isMiniUI")&&this.$node&&this.$node.querySelector(".zpb-parallelCallTimer");if(Math.floor(new Date)>parseInt(o[this.getData("callrefid")])&&a){var i={actionUrl:"/phonebridge/calloperations/checkStatus",type:"GET",authentication:"cookies",params:{}};i.params.CALLREFID=this.getData("callrefid"),i.params.serviceID=PhoneBridgeUtil.serviceID,COMMON_UTILS.fetchRequest(i).then((e=>{"ended"===e.callstate?pbTabManager.publishByWmsforCallstate(e):e.status&&COMMON_UTILS.print(e.status)})),a=!1}t&&(t.innerHTML=e)}.bind(this),1e3);this.setData("timerData",n),this.getData("hold")||(Zoho.PhoneBridge.currentCall=this.getData("clientcallid"))}else if("transferended"===e)this.setData("isCallTransfered",!0),clearInterval(this.getData("timerData"));else if("ended"===e){var r=this.methods.timeInHHMMSS(this.getData("callduration"));this.$node.querySelector(".zpb-callTimer").innerHTML=r;var s=this.getData("isMiniUI")&&this.$node&&this.$node.querySelector(".zpb-parallelCallTimer");s&&(s.innerHTML=r),this.$node.querySelector(".zpb-endCallDesc").ltProp("value",this.$node.querySelector(".zpb-answerCallDesc").ltProp("value")),null==this.getData("timerData")&&null==this.getData("timerData")||clearInterval(this.getData("timerData")),Zoho.PhoneBridge.currentCall==this.getData("clientcallid")&&(Zoho.PhoneBridge.currentCall=null),this.getData("isInternalCall")&&Zoho.PhoneBridge.UI.closeCall(this.getData("clientcallid")),delete pbTabManager.allcalls_limited_time[this.getData("callrefid")]}else"clicktodial"==e&&(this.$node.querySelector(".clicktodialedCallTxt").innerHTML=Lyte.Component.registeredHelpers.getI18n("phonebridge."+this.getData("childcallstate").trim()),Zoho.PhoneBridge.activeCall==this.getData("clientcallid")||this.getData("isMiniUI")||this.$node.querySelector(".zpb-header").click());if(this.setData("lastNotificationMillis",+new Date),this.getData("isCallTransfered")&&"ended"===e)PhoneBridgeUtil.saveDesc(this.getData("orgid"),this.getData("desc_data"),this.getData("callrefid")),Zoho.PhoneBridge.UI.closeallCallpopup(this.getData("orgid"),this.getData("clientcallid"));else if(this.getData("timeoutConfig").hasOwnProperty(e)){if(this.getData("autoCloseTimer")&&(clearTimeout(this.getData("autoCloseTimer")),this.setData("autoCloseTimer",void 0)),console.log("setting timer"),"ended"!=this.getData("callstate")||""==this.$node.querySelector(".zpb-endCallDesc").ltProp("value")){var d=setTimeout(this.methods.autoClose.bind(this),this.getData("timeoutConfig")[e],"call-pop");this.setData("autoCloseTimer",d)}else this.setData("callDescFlag",!0),pbTabManager.publishByWms("PhoneBridgeUtil.timerOff",{clientcallid:this.getData("clientcallid")},null)}else this.getData("autoCloseTimer")&&(clearTimeout(this.getData("autoCloseTimer")),this.setData("autoCloseTimer",void 0))}},callStateObserver:function(e){if(this.getData("clientcallid")==Zoho.PhoneBridge.activeCall?this.$node.querySelector(".zpb-onGoing").classList.add("zpb-currentOpenCall"):(this.$node.querySelector(".zpb-onGoing").classList.remove("zpb-secondCallIncoming"),this.$node.querySelector(".zpb-onGoing").classList.add("zpb-secondCall"),$(this.$node.querySelector(".zpb-callContent")).hide()),"ringing"==e.newValue?this.methods.stateRendering.bind(this)("ringing"):"answered"==e.newValue?this.methods.stateRendering.bind(this)("answered"):"ended"===e.newValue&&this.getData("isGoneState")?this.methods.stateRendering.bind(this)("transferended"):this.methods.stateRendering.bind(this)(e.newValue),"doNotAllow"!==e.newValue){var t=this.getAssociatedCallComp();t&&(t.setData("associatedCallRefState",this.getData("callstate")),"ended"!=e.newValue&&"missed"!=e.newValue||"merged"!==t.getData("subState")||t.setData("subState","connected")),this.getData("isInternalCall")?"ended"!=e.newValue?Zoho.PhoneBridge.UI.adjustMultiCallPopup():(setTimeout(Zoho.PhoneBridge.UI.adjustMultiCallPopup,1e3),COMMON_UTILS.print("adjustMultiCallPopup after 1 second")):Zoho.PhoneBridge.UI.adjustMultiCallPopup()}$(":button, a, li, .zpb-additionalInfo, .zpb-relatedInfo, .zpb-callActionIcon, .zpb-followUpAddTxt, .zpb-callDoneBtn, .zpb-answerCallDesc, .zpb-endCallDesc, .zpb-answerButton, .zpb-endButton, .zpb-callControlOptions,textarea, .preventDrag").mousedown((function(e){e.stopPropagation()}))}.observes("callstate"),subStateObserver:function(e){var t=this.getData("subState");if("hold"===t)Lyte.Component.set(this.getData("currentControls"),"hold",!0);else if("connected"===t||"merged"===t)Lyte.Component.set(this.getData("currentControls"),"hold",!1);else if("transferred_to_phone"==this.getData("subState")){Lyte.Component.set(this.getData("currentControls"),"hold",!1);var a={};a.end=a.answer=a.hold=a.mute=a.keypress=a.transfer=a.leave=a.mergeandleave=a.merge=a.parallelcall=!1,this.setData("callControls",a)}this.adaptToAssociatedCall();var i=this.getAssociatedCallComp();i&&(i.setData("associatedCallRefSubState",this.getData("subState")),"merged"===e.oldValue&&"merged"!==e.newValue&&"merged"===i.getData("subState")&&i.setData("subState","connected"))}.observes("subState"),associatedCallObserver:function(){this.adaptToAssociatedCall()}.observes("associatedCallRefId","associatedCallRefState","associatedCallRefSubState"),getAssociatedCallDetails:function(){if(this.getData("isMiniUI")){var e={},t=this.$node.closest(".parallelCallDiv");return t&&(t=t.closest("call-pop"),e.associatedCallRefId=t.getData("callrefid"),e.associatedCallRefState=t.getData("callstate"),e.associatedCallRefSubState=t.getData("subState")),e}return this.getData()},getAssociatedCallComp:function(){if(!this.getData("isMiniUI"))return this.$node.querySelector(".parallelCallDiv").querySelector("call-pop");var e=this.$node.closest(".parallelCallDiv");return e?e.closest("call-pop"):void 0},adaptToAssociatedCall:function(){var e=this.getData("subState"),t=this.getData("callControls"),a=this.getAssociatedCallDetails();if("transferred_to_phone"===e)Lyte.Component.set(t,"mergeandleave",!1),Lyte.Component.set(t,"merge",!1),Lyte.Component.set(t,"leave",!1);else if("merged"===e){var i=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].leaveAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].leaveAllowed;Lyte.Component.set(t,"mergeandleave",!1),Lyte.Component.set(t,"merge",!1),Lyte.Component.set(t,"leave",i)}else if(COMMON_UTILS.isNotEmpty(a.associatedCallRefId)&&"ended"!==a.associatedCallRefState&&"missed"!==a.associatedCallRefState){var l=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeandleaveAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeandleaveAllowed,o=!!PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeAllowed&&PhoneBridgeUtil.multiOrgData[this.getData("orgid")].mergeAllowed;Lyte.Component.set(t,"mergeandleave",l),Lyte.Component.set(t,"merge",o),Lyte.Component.set(t,"leave",!1)}else Lyte.Component.set(t,"mergeandleave",!1),Lyte.Component.set(t,"merge",!1),Lyte.Component.set(t,"leave",!1);"ended"!==a.associatedCallRefState&&"missed"!==a.associatedCallRefState||this.removeChildAssociatedCallComp()},removeChildAssociatedCallComp:function(){if(!this.getData("isMiniUI")){var e=this.$node.querySelector(".parallelCallDiv").querySelector("call-pop");if(e){var t=e.getData("clientcallid");Zoho.PhoneBridge.CallsArray=Zoho.PhoneBridge.CallsArray.filter((function(e){return e+""!=t+""}));var a=e.getData("timerData");a&&clearTimeout(a),this.$node.querySelector(".parallelCallDiv").innerHTML="",this.setData("associatedCallRefId",null),this.setData("associatedCallRefState",null),this.setData("associatedCallRefSubState",null),this.setData("associatedCallCallerDetails",null)}}},callerDetailsObserver:function(){Zoho.PhoneBridge.UI.adjustMultiCallPopup()}.observes("callerdetails"),forceEndIconObserver:function(e){e.newValue&&(this.$node.querySelector(".zpb-endButton").style.display="block")},holdObserver:function(e){e.newValue?this.$node.querySelector(".zpb-onGoing").classList.add("zpb-onHold"):this.$node.querySelector(".zpb-onGoing").classList.remove("zpb-onHold")}.observes("hold")}),Lyte.Component.register("call-controls",{_template:'<template tag-name="call-controls" id="callControls_{{clientcallid}}"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(callControls.keypress,\'||\',callControls.mute),\'||\',callControls.hold),\'||\',callControls.transfer),\'||\',callControls.parallelcall),\'||\',callControls.mergeandleave),\'||\',callControls.merge),\'||\',callControls.leave)}}"><template case="true"> <div> <div class="zpb-callControl dF"> <template is="if" value="{{callControls.transfer}}"><template case="true"> <div class="zpb-dialPadOption zpb-callControlOptions cP transferCallOptions transferPopup {{if(callControls.transfer,\'dF\',\'hide\')}}" onclick="{{action(\'showTransferOptions\',\'transferPopup\')}}"> <span class="zpb-dialPadIcon"></span> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(callControls.dialpadinternalcall,\'!\'),\'||\',disabledCallControls.parallelcall)}}"><template case="true"> <div class="zpb-dialPadOption zpb-callControlOptions cP transferCallOptions parallelCallPopup disabled {{if(callControls.parallelcall,\'dF\',\'hide\')}}"> <span class="zpb-parallelcall"></span> </div> </template><template case="false"> <div class="zpb-dialPadOption zpb-callControlOptions cP transferCallOptions parallelCallPopup {{if(callControls.parallelcall,\'active dF\',\'hide\')}}" onclick="{{action(\'showTransferOptions\',\'parallelCallPopup\')}}"> <span class="zpb-parallelcall"></span> </div> </template></template> <div class="zpb-dialPadOption zpb-callControlOptions {{if(callControls.keypress,\'dF\',\'hide\')}}" onclick="{{action(\'showDialpad\')}}"> <span class="zpb-dialPadIcon"></span> </div> <div class="zpb-muteOption zpb-callControlOptions {{if(callControls.mute,&quot;dF&quot;,&quot;hide&quot;)}}" id="callControls_Mic_{{clientcallid}}"> <a href="javascript:void(0);" onclick="{{action(\'micAction\')}}"> <span class="zpb-micIcon"></span> </a> </div> <div class="zpb-holdOption zpb-callControlOptions {{if(callControls.hold,&quot;dF&quot;,&quot;hide&quot;)}}" id="callControls_Pause_{{clientcallid}}"> <a href="javascript:void(0);" onclick="{{action(\'pauseAction\')}}"> <span class="zpb-pauseIcon"></span> </a> </div> </div> <div class="zpb-dialPad" style="display: none;"> <lyte-input class="zpb-dialNumber"></lyte-input> <ul class="zpb-dialPadNumbers zpb-clearFix" onclick="{{action(\'dialNumber\',event)}}"> <li>1</li> <li>2</li> <li>3</li> <li>4</li> <li>5</li> <li>6</li> <li>7</li> <li>8</li> <li>9</li> <li>*</li> <li>0</li> <li>#</li> </ul> <div class="zpb-dialPadHideBtn" onclick="{{action(\'showDialpad\')}}">{{getI18n("phonebridge.hide.propercase")}}</div> </div> <div class="zpb-transfer preventDrag" id="callTransferOptions_{{clientcallid}}" style="display: none;"> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"attr",position:[1,1,7]},{type:"attr",position:[1,1,7,1]},{type:"attr",position:[1,1,9]},{type:"attr",position:[1,1,9,1]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"attr",position:[1,3,5]},{type:"text",position:[1,3,5,0]},{type:"attr",position:[1,5]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["callControls","callrefid","associatedCallRefId","orgid","clientcallid","currentControls","disabledCallControls"],data:function(){return{callControls:Lyte.attr("object"),callrefid:Lyte.attr("string"),associatedCallRefId:Lyte.attr("string"),orgid:Lyte.attr("string"),clientcallid:Lyte.attr("string"),currentControls:Lyte.attr("object"),disabledCallControls:Lyte.attr("object",{default:{}})}},didConnect:function(){for(var e=$L(this.$node.querySelector(".zpb-callControl")).children(".zpb-callControlOptions"),t=e.length,a=0,i=0;i<t;i++){e[i].classList.contains("hide")||a++}var l=100/a;$L(this.$node.querySelectorAll(".zpb-callControlOptions")).css("width",l+"%"),$L(".zpb-callControlOptions").removeClass("active")},actions:{showDialpad:function(){if($L(".zpb-callControlOptions").removeClass("active"),$L(this.$node.querySelector(".zpb-dialPad")).is(":visible"))$L(this.$node.querySelector(".zpb-dialPad")).hide(),$L(".zpb-currentOpenCall .zpb-businessCard").show(),this.$node.querySelector(".zpb-dialPadOption").classList.add("active"),Zoho.PhoneBridge.UI.adjustMultiCallPopup();else{$L(".zpb-currentOpenCall .zpb-businessCard").hide();var e=this.$node.querySelector(".zpb-transfer");e&&"none"!==e.style.display&&(e.style.display="none"),$L(this.$node.querySelector(".zpb-dialPad")).show(),$L(this.$node.querySelector(".zpb-dialNumber input")).focus(),Zoho.PhoneBridge.UI.adjustMultiCallPopup()}},dialNumber:function(e){var t=e.target,a=$L(t).text(),i=$L(this.$node.querySelector(".zpb-dialNumber input")).val()+a;$L(this.$node.querySelector(".zpb-dialNumber input")).val(i),PhoneBridgeUtil.dtmfcall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid"),digit:a})},micAction:function(){$L(".zpb-callControlOptions").removeClass("active");var e=this.$node.querySelector(".zpb-muteOption"),t=this.$node.querySelector(".zpb-holdOption");this.getData("callrefid")&&this.getData("orgid")&&(e.classList.contains("mute-active")?(e.classList.remove("mute-active"),t.style.pointerEvents="auto",t.style.opacity="1",PhoneBridgeUtil.unmutecall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})):(e.classList.add("mute-active"),e.classList.add("active"),t.style.pointerEvents="none",t.style.opacity="0.2",PhoneBridgeUtil.mutecall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})))},pauseAction:function(){$L(".zpb-callControlOptions").removeClass("active");const e=this.$node.querySelector(".zpb-holdOption");var t=this.$node.querySelector(".zpb-muteOption");this.getData("callrefid")&&this.getData("orgid")&&(e.classList.contains("hold-active")?(e.classList.remove("hold-active"),t.style.pointerEvents="auto",t.style.opacity="1",PhoneBridgeUtil.unholdcall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})):(e.classList.add("hold-active"),e.classList.add("active"),t.style.pointerEvents="none",t.style.opacity="0.2",PhoneBridgeUtil.holdcall({callRefId:this.getData("callrefid"),orgId:this.getData("orgid")})))},raiseActionRequest:function(e){this.getData("callrefid")&&this.getData("orgid")&&e&&PhoneBridgeUtil.raiseActionRequest({callRefId:this.getData("callrefid"),orgId:this.getData("orgid"),associatedCallRefId:this.getData("associatedCallRefId"),actionName:e})},showTransferOptions:function(e){$L(".zpb-callControlOptions").removeClass("active");var t=this.$node.querySelector(".zpb-transfer"),a=this.getData("clientcallid");ClientDataManager.uncacheResources("agents"),"none"===t.style.display?($L(".transferCallOptions").addClass("active"),zpb_config.showUserFrameView(e,this.getData("callrefid"),this.getData("orgid"),t.id,(function(){$L("#callDiv"+a+" .zpb-businessCard").hide(),$L("#callDiv"+a+" .zpb-answerCallDesc").hide(),$L("#callDiv"+a+" .zpb-dialPad").hide(),t.style.display="block";var e=$L(".zpb-transfer").find("#telephonyTabs")[0];pbInteraction.addLyteTabInteraction(e),Zoho.PhoneBridge.UI.adjustMultiCallPopup()}))):($L("#callDiv"+a+" .zpb-businessCard").show(),$L("#callDiv"+a+" .zpb-answerCallDesc").show(),t.style.display="none",this.$node.querySelector("."+e).classList.remove("active"),Zoho.PhoneBridge.UI.adjustMultiCallPopup())}}}),Lyte.Component.register("call-pop-title",{_template:'<template tag-name="call-pop-title"> <template is="if" value="{{showImage}}"><template case="true"> <div class="mL5"> <template is="if" value="{{callerdetails.dp_uri}}"><template case="true"> <div class="fL zpb-mini-callerAvatar"> <img src="{{callerdetails.dp_uri}}" alt="{{getfirstletter(callerdetails.name)}}"> </div> </template><template case="false"><template is="if" value="{{callerdetails.recordexist}}"><template case="true"> <div class="fL zpb-mini-callerAvatar zpb-firstLetterImg"> {{getfirstletter(callerdetails.name)}} </div> </template><template case="false"> <div class="fL zpb-mini-callerAvatar"> <img src="{{getCdnDomainFP(\'/images/nophoto.png\')}}"> </div> </template></template></template></template> </div> </template></template> <div class="vam preventDrag {{if(showImage,\'mL40\',\'\')}}"> <template is="if" value="{{prefixString}}"><template case="true"> <span class="fL whiteColorText pLR5">{{prefixString}}</span> </template></template> <template is="if" value="{{callerdetails.name}}"><template case="true"> <template is="if" value="{{callerdetails.uri}}"><template case="true"> <span class="fL cP zpb-name" style="max-width:{{titleMaxWidth}}px" onclick="{{action(\'openUrlFromPopup\',callerdetails.uri,callerdetails.uri_target)}}"> <template is="if" value="{{showLastNameAlone}}"><template case="true"> {{getLastName(callerdetails.name)}} </template><template case="false"> {{callerdetails.name}} </template></template> </span> </template><template case="false"> <span class="fL zpb-name" style="max-width:{{titleMaxWidth}}px"> <template is="if" value="{{showLastNameAlone}}"><template case="true"> {{getLastName(callerdetails.name)}} </template><template case="false"> {{callerdetails.name}} </template></template> </span> </template></template> </template><template case="false"> <span class="fL zpb-name" style="max-width:{{titleMaxWidth}}px">{{callerdetails.phonenumber}}</span> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'max-width:'","titleMaxWidth","'px'"]}}}},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'max-width:'","titleMaxWidth","'px'"]}}}},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'max-width:'","titleMaxWidth","'px'"]}}}},{type:"text",position:[1,0]}]}},default:{}}],_observedAttributes:["callerdetails","prefixString","showLastNameAlone","showImage","titleMaxWidth"],data:function(){return{callerdetails:Lyte.attr("object"),prefixString:Lyte.attr("string",{default:""}),showLastNameAlone:Lyte.attr("boolean",{default:!1}),showImage:Lyte.attr("boolean",{default:!1}),titleMaxWidth:Lyte.attr("number",{default:120})}},showOrHideToolTip:function(){if(this.getData("showLastNameAlone")&&this.getData("callerdetails").name)this.$node.querySelector(".zpb-name").setAttribute("lt-prop-title",this.getData("callerdetails").name),this.$node.querySelector(".zpb-name").setAttribute("lt-prop-tooltip-config",'{ "position" : "top"}');else if(this.getData("callerdetails").name){var e=this.getData("callerdetails").name,t=document.createElement("span");t.setAttribute("style","white-space: nowrap; overflow: hidden;text-overflow: ellipsis;"),t.innerText=e,document.body.appendChild(t),t.offsetWidth>this.getData("titleMaxWidth")?(this.$node.querySelector(".zpb-name").setAttribute("lt-prop-title",e),this.$node.querySelector(".zpb-name").setAttribute("lt-prop-tooltip-config",'{ "position" : "top"}')):(this.$node.querySelector(".zpb-name").removeAttribute("lt-prop-title"),this.$node.querySelector(".zpb-name").removeAttribute("lt-prop-tooltip-config")),document.body.removeChild(t)}else this.$node.querySelector(".zpb-name").removeAttribute("lt-prop-title"),this.$node.querySelector(".zpb-name").removeAttribute("lt-prop-tooltip-config")}.observes("callerdetails").on("didConnect"),actions:{openUrlFromPopup:function(e,t){"iframe"==t?Zoho.PhoneBridge.UI.openHeadless(e):window.open(e,"_blank")}}}),Lyte.Component.register("services-bar",{_template:'<template tag-name="services-bar"> <div style="{{if(showCallcontent,&quot;display:block;&quot;,&quot;display:none;&quot;)}}"> <div class="zpb-businessCard"> <template is="if" value="{{showPortalSection}}"><template case="true"> <div class="zpb-clearFix zpb-portalSection" style="display:block;"> <span class="fL zpb-serviceIcon"> <img src="{{getCdnDomain(\'/images/\',torender.servicename,\'ico\')}}" alt="" style="height:25px"> </span> <div class="fL zpb-serviceName zpb-font-semibold pb-medium-large-font-size"> {{displayName[torender.servicename].shortdisplayname}} </div> <div class="fR"> <template is="if" value="{{expHandlers(expHandlers(getjsonsize(torender),\'!=\',0),\'&amp;&amp;\',searchdata)}}"><template case="true"> <span class="zpb-portalTitle" style="{{if(expHandlers(getjsonsize(searchdata[torender.servicename]),&quot;>&quot;,1),&quot;display:inline-block;&quot;,&quot;display:none;&quot;)}}">Portal</span> <lyte-dropdown lt-prop-yield="true" lt-prop-tabindex="1" lt-prop-icon-class="dropdown" lt-prop-max-count="0" lt-prop-tooltip="{&quot;margin&quot;:&quot;5&quot;,&quot;showdelay&quot;:&quot;0&quot;,&quot;hidedelay&quot;:&quot;0&quot;}" class="vam zpb-portalDropdown" lt-prop-selected="{{torender.servicename}}*{{torender.serviceid}}" on-option-selected="{{method(\'portalChange\')}}" style="{{if(expHandlers(getjsonsize(searchdata[torender.servicename]),&quot;>&quot;,1),&quot;display:inline-block;&quot;,&quot;display:none;&quot;)}}" "=""> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <template is="forIn" object="{{searchdata[torender.servicename]}}" value="value" key="key"> <lyte-drop-item data-value="{{torender.servicename}}*{{key}}">{{value.portalname}}</lyte-drop-item> </template> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </template></template> </div> </div> </template></template> <div class="zpb-additionalInfo"> <div class="zpb-additionalInfoTitle zpb-font-semibold" onclick="{{action(\'showContact\')}}">Contact Information<span class="fR zpb-accordian" style="font-size: 16px;align-content: center;">&gt;</span></div> <p class="zpb-noData" style="display:none;">No data found</p> <div class="zpb-additionalInfoContent"> <template is="for" items="{{contactInfo}}" item="item" index="index"> <div class="zpb-additionalInfoRow"> <span class="zpb-additionalInfoKey">{{item.display_key}}</span> <template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;uri&quot;),\'&amp;&amp;\',item.field_value)}}"><template case="true"> <span class="cP zpb-additionalInfoValue" style="color:#3c7bd0" onclick="{{action(\'openUrlFromPopup\',item.field_value,item.uri_target)}}">{{item.display_value}}</span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;email&quot;),\'&amp;&amp;\',item.field_value)}}"><template case="true"> <a class="cP zpb-additionalInfoValue" style="color:#3c7bd0" href="mailto:{{item.field_value}}" target="_blank">{{item.display_value}}</a> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;richtext&quot;),\'&amp;&amp;\',item.display_value)}}"><template case="true"> <span class="zpb-additionalInfoValue">{{unescape(item.display_value)}}</span> </template><template case="false"> <span class="zpb-additionalInfoValue">{{item.display_value}}</span> </template></template></template></template></template></template> </div> </template> </div> </div> <template is="if" value="{{expHandlers(getarraysize(relatedInfo.info_details),\'!=\',0)}}"><template case="true"> <div class="zpb-relatedInfo" onclick="{{action(\'hideContact\')}}"> <div class="zpb-relatedInfoTitle"> {{relatedInfo.info_name}} - {{add(relatedInfo.currentItem,1)}}/{{relatedInfo.totalItems}}<span class="fR zpb-accordian" style="font-size: 16px;align-content: center;">&gt;</span></div> <div class="zpb-relatedInfoContent"> <template is="if" value="{{sliderNav.left}}"><template case="true"> <div class="zpb-leftNavigation" onclick="{{action(\'prev\',this)}}">&lt;</div> </template><template case="false"> <div class="zpb-leftNavigation zpb-disableNavigation" onclick="{{action(\'prev\',this)}}">&lt;</div> </template></template> <div class="zpb-sliderContainer"> <div class="zpb-sliderBox"> <template is="for" items="{{relatedInfo.info_details}}" item="ticket" index="index"> <div class="zpb-relatedInfoRecord"> <template is="if" value="{{ticket.record_uri}}"><template case="true"> <span class="cP zpb-recordName" onclick="{{action(\'openUrlFromPopup\',ticket.record_uri,ticket.uri_target)}}">{{ticket.record_name}}</span> </template><template case="false"> <span class="zpb-recordName">{{ticket.record_name}}</span> </template></template> <template is="for" items="{{ticket.additional_record_info}}" item="item" index="index"> <div class="zpb-additionalRecordInfoRow"> <span class="zpb-additionalRecordInfoKey">{{item.display_key}}</span> <template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;uri&quot;),\'&amp;&amp;\',item.field_value)}}"><template case="true"> <span class="cP zpb-additionalRecordInfoValue" style="color:#3c7bd0" onclick="{{action(\'openUrlFromPopup\',item.field_value,item.uri_target)}}">{{item.display_value}}</span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;email&quot;),\'&amp;&amp;\',item.field_value)}}"><template case="true"> <a class="cP zpb-additionalRecordInfoValue" style="color:#3c7bd0" href="mailto:{{item.field_value}}" target="_blank">{{item.display_value}}</a> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(item.field_type,\'==\',&quot;richtext&quot;),\'&amp;&amp;\',item.display_value)}}"><template case="true"> <span class="zpb-additionalRecordInfoValue">{{unescape(item.display_value)}}</span> </template><template case="false"> <span class="zpb-additionalRecordInfoValue">{{item.display_value}}</span> </template></template></template></template></template></template> </div> </template></div></template> </div> </div> </div> <template is="if" value="{{sliderNav.right}}"><template case="true"> <div class="zpb-rightNavigation" onclick="{{action(\'next\',this)}}">&gt;</div> </template><template case="false"> <div class="zpb-rightNavigation zpb-disableNavigation" onclick="{{action(\'next\',this)}}">&gt;</div> </template></template> </div>  </template></template> </div> <div class="zpb-serviceSideBar" style="{{if(showServices,&quot;display:block;&quot;,&quot;display:none;&quot;)}}"> <div class="zpb-serviceSlider"> <div class="zpb-serviceSliderMoveUp" onclick="{{action(\'sliderUp\')}}"> <span class="dIB zpb-serviceSliderArrowUp"></span> </div> <div class="zpb-serviceSliderList"> <ul> <template is="forIn" object="{{searchdata}}" value="value" key="key"> <li> <template is="if" value="{{expHandlers(key,\'==\',torender.servicename)}}"><template case="true"> <div class="zpb-serviceSliderContent zpb-serviceSliderCurrentService cP" onclick="{{action(\'showService\',key,event)}}"> <img src="{{getCdnDomain(\'/images/\',key,\'ico\')}}" alt=""> <span> {{displayName[key].shortdisplayname}}</span> </div> </template><template case="false"> <div class="zpb-serviceSliderContent cP" onclick="{{action(\'showService\',key,event)}}"> <img src="{{getCdnDomain(\'/images/\',key,\'ico\')}}" alt=""> <span> {{displayName[key].shortdisplayname}}</span> </div> </template></template> </li> </template> </ul> </div> <div class="zpb-serviceSliderMoveDown" onclick="{{action(\'sliderDown\')}}"> <span class="dIB zpb-serviceSliderArrowDown"></span> </div> </div> </div> </div> </template>',_dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"if",args:["showCallcontent","'display:block;'","'display:none;'"]}}}},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,3,1]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"if",args:[{type:"helper",value:{name:"expHandlers",args:[{type:"helper",value:{name:"getjsonsize",args:["searchdata[torender.servicename]"]}},"'>'",1]}},"'display:inline-block;'","'display:none;'"]}}}},{type:"attr",position:[3],attr:{style:{name:"style",helperInfo:{name:"if",args:[{type:"helper",value:{name:"expHandlers",args:[{type:"helper",value:{name:"getjsonsize",args:["searchdata[torender.servicename]"]}},"'>'",1]}},"'display:inline-block;'","'display:none;'"]}}}},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"forIn",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,3,1]},{type:"attr",position:[1,1,3,5,1]},{type:"for",position:[1,1,3,5,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"text",position:[1,1,3]},{type:"text",position:[1,1,5]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,3,3,1,1]},{type:"for",position:[1,3,3,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3],attr:{style:{name:"style",helperInfo:{name:"if",args:["showServices","'display:block;'","'display:none;'"]}}}},{type:"attr",position:[1,3,1,1]},{type:"attr",position:[1,3,1,3,1,1]},{type:"forIn",position:[1,3,1,3,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3,1]}]}},default:{}}]},{type:"attr",position:[1,3,1,5]}],_observedAttributes:["searchdata","clientcallid","userselected","torender","contactInfo","showServices","orgid","displayName","showCallcontent","relatedInfo","sliderNav","showPortalSection"],data:function(){return{searchdata:Lyte.attr("object"),clientcallid:Lyte.attr("string"),userselected:Lyte.attr("boolean",{default:!1}),torender:Lyte.attr("object",{default:{}}),contactInfo:Lyte.attr("array"),showServices:Lyte.attr("boolean"),orgid:Lyte.attr("string"),displayName:Lyte.attr("object"),showCallcontent:Lyte.attr("object"),relatedInfo:Lyte.attr("object"),sliderNav:Lyte.attr("object"),showPortalSection:Lyte.attr("boolean")}},businessCard:function(e,t){var a=this.getData("searchdata")[e][t];if(a.callerdetails.recordexist){this.setData("showCallcontent",{status:"true"}),this.setData("torender",{servicename:e,serviceid:t}),this.setData("contactInfo",a.callerdetails.additional_info);var i=a.callerdetails.related_info;i&&i.info_details?(i.currentItem=0,i.totalItems=i.info_details.length,1==i.totalItems?this.setData("sliderNav",{left:!1,right:!1}):this.setData("sliderNav",{left:!1,right:!0}),this.setData("relatedInfo",i)):(this.setData("relatedInfo",{}),this.setData("sliderNav",{}));var l=this.$node&&this.$node.querySelector(".zpb-additionalInfoContent")||".zpb-currentOpenCall .zpb-additionalInfoContent",o=this.$node&&this.$node.querySelector(".zpb-additionalInfo")||".zpb-currentOpenCall .zpb-additionalInfo";if($L(l).css("display","block"),$L(o).css("height","225px"),this.$node){var n=this.$node.querySelector(".zpb-relatedInfoContent");n&&$L(n).slideUp()}return Lyte.Component.set(document.getElementById("call-"+this.getData("clientcallid")).component.data,"callerdetails",a.callerdetails),!0}return this.setData("relatedInfo",{}),!1},updateSideBar:function(){if(Object.keys(this.getData("searchdata")).length>1){this.setData("showServices",!0);var e=$L(document.getElementById("pbContent_"+this.getData("clientcallid"))).height()||226,t=e-52,a=$L(this.$node.querySelectorAll(".zpb-serviceSliderList li")).length;a>3?(a=3,$L(this.$node.querySelector(".zpb-serviceSliderMoveUp,.zpb-serviceSliderMoveDown")).css("pointer-events","auto")):$L(this.$node.querySelector(".zpb-serviceSliderMoveUp,.zpb-serviceSliderMoveDown")).css("pointer-events","none");var i=e/a-17;$L(this.$node.querySelector(".zpb-serviceSideBar")).css({height:e-2}),$L(this.$node.querySelector(".zpb-serviceSliderList")).css({height:t}),$L(this.$node.querySelectorAll(".zpb-serviceSliderList li")).css({height:i}),this.setData("listLength",$L(this.$node.querySelectorAll(".zpb-serviceSliderList li")).length),this.setData("sliderCount",1),this.setData("sliderMoveval",$L(this.$node.querySelectorAll(".zpb-serviceSliderList li")).outerHeight()),this.setData("slideItemCount",3),this.setData("slideValue",3)}},searchchange:function(){if(this.setData("showPortalSection",1!=Object.keys(PhoneBridgeUtil.multiOrgData).length||1!=Object.keys(PhoneBridgeUtil.multiOrgData[this.getData("orgid")].enabledServicesMap).length),this.getData("displayName")||this.setData("displayName",PhoneBridgeUtil.multiOrgData[this.getData("orgid")].enabledServicesMap),!this.getData("userselected")){var e=this.getData("searchdata");for(var t in e){var a=!1;for(var i in e[t])if(a=this.businessCard.bind(this)(t,i)){this.setData("userselected",!0);break}if(a)break}}this.$node&&this.updateSideBar.bind(this)()}.observes("searchdata").on("init"),didConnect:function(){this.updateSideBar.bind(this)(),$L(this.$node.querySelectorAll(".zpb-relatedInfoRecord")).scroll(),$L(this.$node.querySelector(".zpb-additionalInfo")).addClass("zpb-currentView"),$L(this.$node.querySelector(".zpb-relatedInfo")).removeClass("zpb-currentView")},actions:{openUrlFromPopup:function(e,t){"iframe"==t?Zoho.PhoneBridge.UI.openHeadless(e):window.open(e,"_blank")},sliderUp:function(){3<this.getData("slideValue")&&(this.setData("sliderCount",this.getData("sliderCount")-1),this.setData("movePos",$L(this.$node.querySelector(".zpb-serviceSliderList ul")).css("margin-top")),movePos-=this.getData("sliderMoveval"),$L(this.$node.querySelector(".zpb-serviceSliderList ul")).css({"margin-top":-movePos}),this.setData("slideValue",this.getData("slideValue")-1))},sliderDown:function(){this.getData("listLength")>this.getData("slideValue")&&(movePos=this.getData("sliderMoveval")*this.getData("sliderCount"),$L(this.$node.querySelector(".zpb-serviceSliderList ul")).css("margin-top",-movePos),this.setData("sliderCount",this.getData("sliderCount")+1),this.setData("slideValue",this.getData("slideValue")+1))},showService:function(e,t){if(this.actions.showContact.bind(this)(),this.getData("torender").servicename!=e){var a=this.getData("searchdata")[e],i=!1;for(var l in a)if(i=this.businessCard.bind(this)(e,l)){this.$node.querySelector(".zpb-noData").style.display="none",this.$node.querySelector(".zpb-additionalInfoContent").style.visibility="visible",this.setData("userselected",!0);break}if(!i)for(var l in this.$node.querySelector(".zpb-noData").style.display="block",this.$node.querySelector(".zpb-additionalInfoContent").style.visibility="hidden",a){this.setData("torender",{servicename:e,serviceid:l});break}t.stopPropagation()}else t.stopPropagation()},showContact:function(){$L(this.$node.querySelector(".zpb-relatedInfoContent")).slideUp(),$L(this.$node.querySelector(".zpb-additionalInfoContent")).slideDown(function(){$L(this.$node.querySelector(".zpb-additionalInfo")).css("height","225px")}.bind(this)),$L(this.$node.querySelector(".zpb-relatedInfo")).css("height","auto"),this.$node.querySelector(".zpb-additionalInfo")&&this.$node.querySelector(".zpb-additionalInfo").classList.add("zpb-currentView"),this.$node.querySelector(".zpb-relatedInfo")&&this.$node.querySelector(".zpb-relatedInfo").classList.remove("zpb-currentView")},hideContact:function(){$L(this.$node.querySelector(".zpb-additionalInfo")).css("height","auto"),$L(this.$node.querySelector(".zpb-additionalInfoContent")).slideUp(function(){$L(this.$node.querySelector(".zpb-relatedInfo")).css("height","225px")}.bind(this)),$L(this.$node.querySelector(".zpb-relatedInfoContent")).slideDown(),this.$node.querySelector(".zpb-additionalInfo")&&this.$node.querySelector(".zpb-additionalInfo").classList.remove("zpb-currentView"),this.$node.querySelector(".zpb-relatedInfo")&&(this.$node.querySelector(".zpb-relatedInfo").classList.add("zpb-currentView"),$L(this.$node.querySelectorAll(".zpb-relatedInfoRecord")).scroll())},prev:function(e){var t=this.getData("relatedInfo").currentItem,a=this.getData("relatedInfo").totalItems;updateSlider.bind(this)(t-1),Lyte.Component.set(this.$node.component.data.relatedInfo,"currentItem",t-1);var i={};i.left=0!=this.getData("relatedInfo").currentItem,i.right=this.getData("relatedInfo").currentItem!=a-1,this.setData("sliderNav",i)},next:function(e){var t=this.getData("relatedInfo").currentItem,a=this.getData("relatedInfo").totalItems;updateSlider.bind(this)(t+1),Lyte.Component.set(this.$node.component.data.relatedInfo,"currentItem",t+1);var i={};i.left=0!=this.getData("relatedInfo").currentItem,i.right=this.getData("relatedInfo").currentItem!=a-1,this.setData("sliderNav",i)}},methods:{portalChange:function(e,t,a,i){this.actions.showContact.bind(this)(),t=t.split("*"),this.businessCard(t[0],t[1])?(this.$node.querySelector(".zpb-noData").style.display="none",this.$node.querySelector(".zpb-additionalInfoContent").style.visibility="visible",this.setData("userselected",!0)):(this.$node.querySelector(".zpb-noData").style.display="block",this.$node.querySelector(".zpb-additionalInfoContent").style.visibility="hidden",this.setData("torender",{servicename:t[0],serviceid:t[1]})),e.stopPropagation()}}});var pbTabManager={browserTabId:Date.now(),ismaster:null,isslave:null,incall:null,channeltosend:window.BroadcastChannel?new BroadcastChannel("m2"):{},channeltorecieve:window.BroadcastChannel?new BroadcastChannel("m2"):{},is_slavecreated_incall:!1,tabtype:null,masterid:null,slaveid:null,tabids:[],true_states:["answer","outbound","true"],normaltabid:null,threshold_time:null,allow:!0,master_tab:!1,allcalls_limited_time:{},is_type5_providers:!1,istabincall:function(){return!!pbTabManager.incall},fetchCallDataForTab:function(){null!==pbTabManager.channeltorecieve&&!0===pbTabManager.incall&&pbTabManager.send({functionname:"Zoho.PhoneBridge.UI.allCallsData",arguments:{tabID:pbTabManager.browserTabId+""},tab:"master"})},send:function(e){window.BroadcastChannel?(e.triggeredBy="Broadcast Channel Compatible",pbTabManager.channeltosend.postMessage(e)):(e.triggeredBy="WMS",e.functionname?pbTabManager.publishByWms(e.functionname,e.arguments,e.hasOwnProperty("tab")?e.tab:"all"):pbTabManager.publishByWms("tabCommunicator.tabListener",e,msg.hasOwnProperty("tab")?e.tab:"all"))},initialisetab:function(){var e=COMMON_UTILS.browserDetect().includes("Mozilla Firefox");pbTabManager.allow&&(window.BroadcastChannel&&!e?(onmessage(),pbTabManager.ismaster=!0,pbTabManager.incall?(pbTabManager.isslave=!1,pbTabManager.master_tab=!1,pbTabManager.is_slavecreated_incall=!0):pbTabManager.master_tab=!0,pbTabManager.channeltosend.postMessage("initialise"),pbTabManager.channeltosend.postMessage("master_id")):(pbTabManager.ismaster=!0,pbTabManager.isslave=!1),pbTabManager.allow=!1)},gettypeoftab:function(e,t){return e&&!t?"master":!e&&t?"slave":e||t?void 0:pbTabManager.type="normal"},publishByWmsBody:function(e,t){var a={FUNCTIONNAME:e,ARGUMENTS:t,pbmodule:"execscript"},i={actionUrl:"/phonebridge/pushservice/publishBody",type:"POST",body:JSON.stringify(a),authentication:"cookies",headers:{"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(i)},publishByWmsforCallstate:function(e){var t=e,a={actionUrl:"/phonebridge/pushservice/publishBody",type:"POST",body:JSON.stringify(t),authentication:"cookies",headers:{"X-ZCSRF-TOKEN":"phonebridgecsrparam="+COMMON_UTILS.getCookie("phonebridgecsr")}};COMMON_UTILS.fetchRequest(a)},publishByWms:function(e,t,a){var i={};i=a?{FUNCTIONNAME:e,ARGUMENTS:t,tab:a,pbmodule:"execscript"}:{FUNCTIONNAME:e,ARGUMENTS:t,pbmodule:"execscript"};var l={actionUrl:"/phonebridge/pushservice/publish",params:{phonebridgecsrparam:COMMON_UTILS.getCookie("phonebridgecsr"),publishData:JSON.stringify(i)},type:"POST",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded"}};COMMON_UTILS.fetchRequest(l)}};function execute(e){COMMON_UTILS.print(JSON.stringify(e)),e.key&&e.key.includes("Msg")&&e.functionname?COMMON_UTILS.executeFunctionByName(e.functionname,window,e.arguments):e.key&&e.dataMessage?tabCommunicator.tabListener(e):(e.functionname&&pbTabManager.ismaster&&"master"===e.tab||pbTabManager.isslave&&e.functionname&&"slave"===e.tab)&&COMMON_UTILS.executeFunctionByName(e.functionname,window,e.arguments)}function onmessage(){pbTabManager.channeltorecieve.onmessage=e=>{if((e=e.data)&&"initialise"!==e)if("slavetomaster"===e&&null!==e&&pbTabManager.isslave&&!pbTabManager.ismaster)pbTabManager.ismaster=!0,pbTabManager.isslave=!1,pbTabManager.master_tab=!0,pbTabManager.masterid=pbTabManager.browserTabId,pbTabManager.channeltosend.postMessage({setmastertabid:pbTabManager.browserTabId});else if("slavetomaster"!==e||null===e||pbTabManager.isslave||pbTabManager.ismaster||1!==pbTabManager.tabids.length)if("normaltoslave"!==e||pbTabManager.isslave||pbTabManager.ismaster||pbTabManager.browserTabId!==pbTabManager.tabids[0])if(e.setmastertabid)pbTabManager.masterid=e.setmastertabid;else if(e.setslavetabid)pbTabManager.slaveid=e.setslavetabid;else if("master_id"===e&&pbTabManager.ismaster)pbTabManager.channeltosend.postMessage({setmastertabid:pbTabManager.browserTabId});else if(!JSON.stringify(e).includes("normalid")||pbTabManager.ismaster||pbTabManager.isslave)if(JSON.stringify(e).includes("idtoremove")&&pbTabManager.tabids.indexOf(JSON.parse(e).idtoremove)>-1&&!pbTabManager.ismaster&&!pbTabManager.isslave){let t=pbTabManager.tabids.indexOf(JSON.parse(e).idtoremove);pbTabManager.tabids.splice(t,1)}else if(e.set_call_time){var t=JSON.parse(e.set_call_time);pbTabManager.allcalls_limited_time[Object.keys(t)[0]]=Object.values(t)[0]}else"checkothertabsincall"===e?pbTabManager.incall&&pbTabManager.channeltosend.postMessage("yesincall"):"yesincall"===e||pbTabManager.true_states.includes(e.incall)?pbTabManager.incall=!0:"noincall"===e?pbTabManager.incall=!1:void 0===e.dataMessage&&void 0===e.key&&void 0===e.tab&&void 0===e.functionname||execute(e);else pbTabManager.tabids.push(JSON.parse(e).normalid),pbTabManager.tabids=Array.from(new Set(pbTabManager.tabids)),pbTabManager.tabids.sort().reverse();else{pbTabManager.ismaster=!1,pbTabManager.isslave=!0,pbTabManager.master_tab=!1,pbTabManager.slaveid=pbTabManager.browserTabId;let e=pbTabManager.tabids.indexOf(pbTabManager.tabids[0]);pbTabManager.tabids.splice(e,1),pbTabManager.channeltosend.postMessage({setslavetabid:pbTabManager.browserTabId}),pbTabManager.channeltosend.postMessage(JSON.stringify({idtoremove:pbTabManager.slaveid}))}else{pbTabManager.ismaster=!1,pbTabManager.isslave=!0,pbTabManager.master_tab=!1,pbTabManager.slaveid=pbTabManager.browserTabId;let e=pbTabManager.tabids.indexOf(pbTabManager.tabids[0]);pbTabManager.tabids.splice(e,1),pbTabManager.channeltosend.postMessage({setslavetabid:pbTabManager.browserTabId}),pbTabManager.channeltosend.postMessage(JSON.stringify({idtoremove:pbTabManager.slaveid}))}else"initialise"===e&&(pbTabManager.ismaster&&null===pbTabManager.isslave&&pbTabManager.master_tab?(pbTabManager.isslave=!1,pbTabManager.ismaster=!0,pbTabManager.channeltosend.postMessage({setmastertabid:pbTabManager.browserTabId})):pbTabManager.isslave&&!pbTabManager.ismaster?(pbTabManager.isslave=!1,pbTabManager.channeltosend.postMessage(JSON.stringify({normalid:pbTabManager.browserTabId}))):pbTabManager.ismaster&&!pbTabManager.isslave&&pbTabManager.master_tab&&pbTabManager.incall?(pbTabManager.isslave=!1,pbTabManager.ismaster=!0):pbTabManager.ismaster&&!pbTabManager.isslave&&(pbTabManager.ismaster=!1,pbTabManager.isslave=!0,pbTabManager.channeltosend.postMessage({setslavetabid:pbTabManager.browserTabId})))}}window.addEventListener("beforeunload",(()=>{var e=COMMON_UTILS.browserDetect().includes("Mozilla Firefox");if(pbTabManager.is_type5_providers&&pbTabManager.onUnloadFunction(),window.BroadcastChannel&&!e)switch(pbTabManager.gettypeoftab(pbTabManager.ismaster,pbTabManager.isslave)){case"normal":pbTabManager.channeltosend.postMessage(JSON.stringify({idtoremove:pbTabManager.browserTabId})),pbTabManager.tabids.pop();break;case"slave":pbTabManager.channeltosend.postMessage("normaltoslave");break;case"master":pbTabManager.channeltosend.postMessage("slavetomaster")}}));var networkUtils=function(){function e(){"undefined"!=typeof renderingUtils&&renderingUtils.hideProgressBar()}function t(e){var t=document.cookie,a=t.indexOf(" "+e+"=");if(-1===a&&(a=t.indexOf(e+"=")),-1===a)t=null;else{a=t.indexOf("=",a)+1;var i=t.indexOf(";",a);-1===i&&(i=t.length),t=unescape(t.substring(a,i))}return t}function a(e,t,a,i){var l={is_success:t,data:a,args:i};"string"==typeof e&&""!==e&&Lyte.triggerEvent(e,l)}return{makeRequest:function(i,l,o,n,r){var s={"Content-Type":"application/x-www-form-urlencoded","X-PB-ORG":Setup.zgid,"X-SERVICE-ORG":Setup.serviceID,"X-SERVICE-NAME":Setup.serviceName,"X-ZCSRF-TOKEN":"phonebridgecsrparam="+t("phonebridgecsr")};Object.assign(s,n);var d=o;return"application/json"===s["Content-Type"]&&(d=JSON.stringify(o)),new Promise((function(t,n){"undefined"!=typeof renderingUtils&&renderingUtils.showProgressBar(),$L.ajax({url:i,type:l,headers:s,data:d,success:function(i){var l;try{l=JSON.parse(i)}catch(e){l=i}t(l),r&&a(r,!0,l,o),e()},error:function(t){var i;try{i=JSON.parse(t.responseText)}catch(e){i=t.responseText}n(i),r&&a(r,!1,i,o),e()}})}))},returnFilesWithPath:function(e){for(var t=[],a=e.length,i=0;i<a;i++){var l=PBClient.getFingerPrintUsingFileName(e[i]);t.push(l)}return t},getCookie:t,loadDependencies:function(e,t){if(e){var a=e.scripts?e.scripts:[],i=e.styles?e.styles:[],l=networkUtils.returnFilesWithPath(a,Setup.staticInfo.jsStaticPath),o=networkUtils.returnFilesWithPath(i,Setup.staticInfo.cssStaticPath),n=l.concat(o);Lyte.injectResources(n,void 0,t)}else t()}}}();Lyte.Component.register("pb-conformation-popup",{_template:'<template tag-name="pb-conformation-popup"> <lyte-modal lt-prop-height="auto" lt-prop-close-on-escape="false" lt-prop-show-close-button="false" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-width="{{modalWidth}}" lt-prop-wrapper-class="pbBoxModal {{wrapperClass}}" lt-prop-show="{{lbind(showPopup)}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{popupData.title}}"><template case="true"> <lyte-modal-header class="px-fsLarge px-cheading pbHeadingColor {{if(popupData.message,\'pb-heading-font-size pb-font-bold\',\'pb-subheading-font-size pb-font-semibold\')}}"> <span class="pb_maskIcons pb-ico-warning-triangle-lg pbicn_red_mask mR8 vam"></span> <span class="vam">{{getI18n(popupData.title)}}</span> </lyte-modal-header> </template></template> <template is="if" value="{{popupData.message}}"><template case="true"> <lyte-modal-content class="px-lh18 pbParagraphColor lh20"> <div class="{{if(popupData.title,\'\',\'px-pT25 pT15 pb-subheading-font-size pb-font-semibold\')}}"> {{unescape(getI18n(popupData.message))}} </div> </lyte-modal-content> </template></template> <lyte-modal-footer class="right pB30"> <template is="for" items="{{popupData.buttons}}" item="button" index="index"> <lyte-button class="mL8" id="{{button.id}}" lt-prop-appearance="{{button.appearance}}" onclick="{{action(\'onBtnClick\',button)}}"> <template is="registerYield" yield-name="text">{{getI18n(button.label)}}</template> </lyte-button> </template> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5,1]},{type:"for",position:[5,1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["showPopup","popupData","modalWidth","wrapperClass","eventName","rendererMode"],data:function(){return{showPopup:Lyte.attr("boolean"),popupData:Lyte.attr("object"),modalWidth:Lyte.attr("string",{default:"700px"}),wrapperClass:Lyte.attr("string"),eventName:Lyte.attr("string"),rendererMode:Lyte.attr("boolean")}},actions:{onBtnClick:function(e){this.setData("showPopup",!1),this.triggerClickEvent(e),"function"==typeof e.callBackFunction&&e.callBackFunction()}},triggerClickEvent:function(e){var t=this.getData("eventName"),a={button:e};this.getData("rendererMode")?ClientFrameCommunicator.callBack(t,a):t&&Lyte.triggerEvent(t,a)},popupDataObserver:function(e){var t=e.newValue,a=t.buttons;Array.isArray(a)&&0!==a.length||(a=[{id:"conformationpopup_default_cancel",label:"phonebridge.cancel.propercase"},{id:"conformationpopup_default_ok",label:"phonebridge.label.ok",appearance:"primary"}],t.buttons=a,this.setData(t))}.observes("popupData")}),Lyte.Component.register("dialpad-user-listing",{_template:'<template tag-name="dialpad-user-listing"> <div class="p0"> <tabs-pane styling-name="lyteInnerTab" header-border-radius="4px" handle-tab-content="true" default-tab="{{defaultTransferOption}}" tabs-array="{{transferOptions}}"></tabs-pane></div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}],_observedAttributes:["transferOptions","type","defaultTransferOption"],data:function(){return{transferOptions:Lyte.attr("array"),type:Lyte.attr("string"),defaultTransferOption:Lyte.attr("string")}},didConnect:function(){var e=this.$node.querySelector("tabs-pane").addEventListener("pbtab-content-rendered",function(e){var t=e.target.querySelector("lyte-input");null!==t&&t.focus()}.bind(this));this.setData("listener",e)},didDestroy:function(){this.$node.querySelector("tabs-pane").removeEventListener(this.getData("campaignEventListener"))},actions:{hideOptions:function(){$L(this.$node).closest("call-controls").find(".transferCallOptions.active").click(),ClientDataManager.uncacheResources("agents")}}}),Lyte.Component.register("call-transfer-options",{_template:'<template tag-name="call-transfer-options"> <div class="p0"> <tabs-pane styling-name="lyteInnerTab" header-border-radius="4px" handle-tab-content="true" default-tab="{{defaultTransferOption}}" tabs-array="{{transferOptions}}"></tabs-pane></div> <div class="zpb-keyPadHideBtn" data-zcqa="hide" onclick="{{action(\'hideOptions\')}}">{{getI18n(\'phonebridge.hide.propercase\')}}</div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[3]},{type:"text",position:[3,0]}],_observedAttributes:["transferOptions","type","defaultTransferOption"],data:function(){return{transferOptions:Lyte.attr("array"),type:Lyte.attr("string"),defaultTransferOption:Lyte.attr("string")}},didConnect:function(){this.$node.querySelector("tabs-pane").addEventListener("pbtab-content-rendered",function(e){var t=e.target.querySelector("lyte-input");t&&t.focus()}.bind(this))},actions:{hideOptions:function(){$L(this.$node).closest("call-controls").find(".transferCallOptions.active").click(),ClientDataManager.uncacheResources("agents")}}}),Lyte.Component.register("pb-dialpad",{_template:'<template tag-name="pb-dialpad"> <div class="zpb-keyPadSection"> <lyte-input class="zpb-dialInput" lt-prop-class="zpb-font-semibold"></lyte-input> <ul class="zpb-keyPadNumbers zpb-clearFix zpb-font-semibold" onclick="{{action(\'chooseNumber\',event)}}"> <li>1</li> <li>2</li> <li>3</li> <li>4</li> <li>5</li> <li>6</li> <li>7</li> <li>8</li> <li>9</li> <li class="zpb-star">*</li> <li>0</li> <li>#</li> <li class="dialPadPlus">+</li> </ul> <div class="zpb-keyPadCalBtnHolder"> <div class="zpb-keyPadCalBtn" onclick="{{action(&quot;transferOrDial&quot;)}}"> <lyte-button lt-prop-appearance="success" lt-prop-class="lyteSm"> <template is="registerYield" yield-name="text"> <template is="if" value="{{ifEquals(type,&quot;parallelcall&quot;)}}"><template case="true"> {{getI18n(\'phonebridge.call\')}} </template><template case="false"> {{getI18n(\'phonebridge.transfer\')}} </template></template> </template> </lyte-button> </div> </div> </div> </template>',_dynamicNodes:[{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"attr",position:[1,5,1]},{type:"registerYield",position:[1,5,1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1,5,1,1]}],_observedAttributes:["type"],data:function(){return{type:Lyte.attr("string",{default:"parallelcall"})}},actions:{chooseNumber:function(e){var t=$L(e.target).text();if(e.target&&e.target.tagName&&"ul"!=e.target.tagName.toLowerCase()){var a=this.$node.querySelector(".zpb-dialInput"),i=a.ltProp("value")+t;a.ltProp("value",i)}},transferOrDial:function(){var e=this.$node.querySelector(".zpb-dialInput").ltProp("value");if(void 0===$L(this.$node).closest("call-controls")[0]){var t={};t.phoneNumber=e,PhoneBridgeUtil.callfromdialpad(t)}else{var a=$L(this.$node).closest("call-controls")[0],i=a.getData("callrefid"),l=a.getData("orgid"),o={transferOption:"Transfer_Phone",transferNumber:e};$L(this.$node).closest("call-controls").find(".transferCallOptions.active").click(),PhoneBridgeUtil.raiseActionRequest({callRefId:i,orgId:l,actionName:this.getData("type")},o)}}}}),Lyte.Component.register("call-user-listing",{_template:'<template tag-name="call-user-listing"> <div class="zpb-userSection dIB"> <div class="w100per"> <div class="SearchHolder p15"> <lyte-search lt-prop-appearance="box" lt-prop-query-selector="{&quot;scope&quot;:&quot;.zpb-userListBlock&quot;,&quot;search&quot;:&quot;.zpb-addUserInfo&quot;,&quot;target&quot;:&quot;.zpb-userList&quot;}" class="zpb-search" lt-prop-class="zpb-searchBox" lt-prop-placeholder="Search"> </lyte-search> </div> <div class="zpb-userListBlock"> <template is="for" items="{{userList}}" item="item" index="index"> <div class="zpb-userList dF aIC"> <template is="if" value="{{item.imageURL}}"><template case="true"> <div class="pR dIB"> <template is="if" value="{{expHandlers(item.agentStatus,\'===\',\'online\')}}"><template case="true"> <span class="zpbUserOnline"></span> <img class="zpb-userListIcon vam" src="{{item.imageURL}}" alt="zpbUserOnline"> </template><template case="false"><template is="if" value="{{expHandlers(item.agentStatus,\'===\',\'dnd\')}}"><template case="true"> <span class="zpbUserOffline"></span> <img class="zpb-userListIcon vam" src="{{item.imageURL}}" alt="zpbUserOffline"> </template><template case="false"> <span class="zpbUserBusy"></span> <img class="zpb-userListIcon vam" src="{{item.imageURL}}" alt="zpbUserBusy"> </template></template></template></template> </div> </template></template> <div class="dIB vam zpb-addUserInfo"> <div class="zpb-userListName zpb-font-semibold"> <lyte-text data-zcqa="zpb-userListName" lt-prop-value="{{item.name}}"> </lyte-text> </div> <div class="zpb-userListMail"> <lyte-text data-zcqa="zpb-userListMail" lt-prop-value="{{optEmptyIfNull(item.subInfo)}}"> </lyte-text> </div> </div> <div class="zpb-userCalBtn" onclick="{{action(&quot;transferOrDial&quot;,item.referencename,item.phone_number)}}"> <template is="if" value="{{expHandlers(item.agentStatus,\'===\',\'online\')}}"><template case="true"> <lyte-button lt-prop-appearance="success" lt-prop-class="lyteSm" data-zcqa="zpb-userCalBtn"> <template is="registerYield" yield-name="text"> <template is="if" value="{{ifEquals(type,&quot;parallelcall&quot;)}}"><template case="true"> {{getI18n(\'phonebridge.call\')}} </template><template case="false"> {{getI18n(\'phonebridge.transfer\')}} </template></template> </template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-appearance="success" lt-prop-class="lyteSm" data-zcqa="zpb-userCalBtn-disabled" lt-prop-disabled="true"> <template is="registerYield" yield-name="text"> <template is="if" value="{{ifEquals(type,&quot;parallelcall&quot;)}}"><template case="true"> {{getI18n(\'phonebridge.call\')}} </template><template case="false"> {{getI18n(\'phonebridge.transfer\')}} </template></template> </template> </lyte-button> </template></template> </div> </div> </template> </div> </div> </div> </template>',_dynamicNodes:[{type:"componentDynamic",position:[1,1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"for",position:[1,1,3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[3]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"attr",position:[1,3,3,1]},{type:"componentDynamic",position:[1,3,3,1]},{type:"attr",position:[1,5]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}],_observedAttributes:["userList","resourceName","fetched_from_List","fetched_upto","isLoadingState","resourceModel","isSearchMode","orgid","type"],data:function(){return{userList:Lyte.attr("array"),resourceName:Lyte.attr("string"),fetched_from_List:Lyte.attr("array"),fetched_upto:Lyte.attr("number",{default:-1}),isLoadingState:Lyte.attr("boolean",{default:!1}),resourceModel:Lyte.attr("object"),isSearchMode:Lyte.attr("boolean",{default:!1}),orgid:Lyte.attr("string"),type:Lyte.attr("string",{default:"parallelcall"})}},init:function(){this.getData("userList")||(this.setData("userList",[]),this.setData("fetched_from_List",[]))},didConnect:function(){var e=this.getData("resourceName"),t=this.getData("userList"),a=PhoneBridgeUtil.getCurrentOrg();(this.setData("orgid",a),a)||(a=$L(this.$node).closest("call-controls")[0].getData("orgid"),this.setData("orgid",a));if(e&&0==t.length){var i=ClientDataManager.getResourceModel(a,e,"online",null,[{name:"agent_status",value:"online",comparator:"equal"},{name:"agent_status",value:"in-progress",comparator:"equal"},{name:"agent_status",value:"dnd",comparator:"equal"}]);i.setPageSize(200),this.setData("resourceModel",i),this.setData("fetched_upto",null),this.loadPageData(1)}},actions:{transferOrDial:function(e,t){if(void 0!==$L(this.$node).closest("call-controls")[0]){var a=$L(this.$node).closest("call-controls")[0],i=a.getData("callrefid"),l=a.getData("orgid"),o={transferOption:"Transfer_ProviderContacts",transferProviderContactID:e};t&&(o.transferNumber=t),$L(this.$node).closest("call-controls").find(".transferCallOptions.active").click(),PhoneBridgeUtil.raiseActionRequest({callRefId:i,orgId:l,actionName:this.getData("type")},o)}else{var n={},r={dialpadinternalcall:!1};this.setData("callControls",r),n.referenceName=e,PhoneBridgeUtil.callfromdialpad(n)}}},addListenerForSearch:function(){var e=function(e){var t=e.keyCode?e.keyCode:e.which,a=e.target.value,i=this.getData("isSearchMode"),l=this.getData("resourceName"),o=this.getData("orgid"),n=[{name:"agent_status",value:"online",comparator:"equal"},{name:"agent_status",value:"in-progress",comparator:"equal"},{name:"agent_status",value:"dnd",comparator:"equal"}];if(COMMON_UTILS.isEmpty(a)){var r=ClientDataManager.getResourceModel(o,l,"online",null,n);this.setData("resourceModel",r),this.setData("fetched_upto",null),i&&this.setData("isSearchMode",!1),this.loadPageData(1)}else if(13==t){var s=[{name:"display_name",value:a,comparator:"contains"},{name:"email",value:a,comparator:"contains"}],d=ClientDataManager.getResourceModel(o,l,"online_"+a,null,n,s);this.setData("resourceModel",d),this.setData("fetched_upto",null),!i&&this.setData("isSearchMode",!0),this.loadPageData(1)}}.bind(this);$(this.$node.querySelector("lyte-search input")).keyup(e)},removeListenerForSearch:function(){$(this.$node.querySelector("lyte-search input")).unbind("keyup")},addListenerForScroll:function(){var e=function(e){var t=e.target;this.getData("isLoadingState")||(t.scrollTop+t.clientHeight)/t.scrollHeight>.8&&this.loadPageData()}.bind(this),t=COMMON_UTILS.debounceFunction(e,300);$(this.$node.querySelector(".zpb-userListBlock")).scroll(t)},removeListenerForScroll:function(){$(this.$node.querySelector(".zpb-userListBlock")).unbind("scroll")},loadPageData:function(e){var t=this.getData("resourceModel"),a=this.getData("fetched_upto");a||(this.removeListenerForScroll(),!this.getData("isSearchMode")&&this.removeListenerForSearch());var i=-1==a?this.getData("userList"):[],l=-1==a?null:a;this.setData("isLoadingState",!0),t.getData(l).then(function(t){var a,o=t.data,n=o.length,r=o.limit_size,s=[],d=[],c=0,p=0;for(var u in o){var g=o[u],m={},h={};"online"===g.agent_status?(m.name=g.display_name,m.imageURL=g.photo_id,m.subInfo=g.email,m.referencename=g.zuid,m.agentStatus=g.agent_status,s[c]=m,c++):(h.name=g.display_name,h.imageURL=g.photo_id,h.subInfo=g.email,h.referencename=g.zuid,h.agentStatus=g.agent_status,d[p]=h,p++)}a=s.concat(d);var y=this.getData("fetched_from_List");-1==y.indexOf(l)&&(y.push(l),i=i.concat(a),this.setData("userList",i),this.setData("fetched_upto",t.upto)),this.setData("isLoadingState",!1);var f=this.getData("isSearchMode");n==r?(this.addListenerForScroll(),!f&&1==e&&this.addListenerForSearch()):(this.removeListenerForScroll(),!f&&this.removeListenerForSearch())}.bind(this))}}),Lyte.Component.register("tabs-pane",{_template:'<template tag-name="tabs-pane"> <lyte-tabs on-open="{{method(\'onOpen\')}}" lt-prop-height="{{tabHeight}}" class="{{stylingName}} tabsPane {{if(ifEquals(stylingName,\'lyteInnerTab\'),\'\',\'lyteOuterTab\')}}" lt-prop="{{tabProp}}" lt-prop-tab-style="nested" id="telephonyTabs"> <template is="registerYield" yield-name="tabYield"> <lyte-tab-head id="tabsHead"> <template is="for" items="{{tabsArray}}" item="currentTab" index="index"> <template is="if" value="{{handleTabContent}}"><template case="true"> <lyte-tab-title class="tabs-pane-title" lt-prop-id="{{currentTab.tabId}}" id="title_{{currentTab.tabId}}" onclick="{{action(\'onTitleClick\',currentTab)}}" data-zcqa="{{currentTab.tabId}}">{{getI18n(currentTab.tabName)}}</lyte-tab-title> </template><template case="false"> <lyte-tab-title class="tabs-pane-title" lt-prop-id="{{currentTab.tabId}}" id="{{currentTab.tabId}}" onclick="{{currentTab.functionName}}" data-zcqa="{{currentTab.tabId}}">{{getI18n(currentTab.tabName)}} </lyte-tab-title> </template></template> </template> </lyte-tab-head> <template is="if" value="{{handleTabContent}}"><template case="true"> <lyte-tab-body class="tabs-pane-body"> <template is="for" items="{{tabsArray}}" item="currentTab" index="index"> <lyte-tab-content id="{{currentTab.tabId}}" data-populated="false" data-zcqa="{{currentTab.tabId}}"> <div class="p30 mT75"> <span class="tabLoadingIcon"></span> </div> </lyte-tab-content> </template> </lyte-tab-body> </template></template> </template> </lyte-tabs> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["tabsArray","defaultTab","stylingName","handleTabContent","headerBorderRadius","tabProp","tabHeight","nonPb"],data:function(){return{tabsArray:Lyte.attr("array"),defaultTab:Lyte.attr("string"),stylingName:Lyte.attr("string",{default:""}),handleTabContent:Lyte.attr("boolean",{default:!0}),headerBorderRadius:Lyte.attr("string"),tabProp:Lyte.attr("object"),tabHeight:Lyte.attr("string",{default:"auto"}),nonPb:Lyte.attr("boolean",{default:!1})}},init:function(){var e=this.getData("tabsArray"),t=[],a=0;if(e)for(var i=0;i<e.length;i++){var l=e[i];(!l.hasOwnProperty("showTab")||l.hasOwnProperty("showTab")&&l.showTab)&&(t[a++]=e[i])}this.setData("tabsArray",t)},didConnect:function(){var e=this.getDefaultOrFirstTabTitle();e&&e.click();var t=this.getData("tabsArray"),a=this.getData("headerBorderRadius");if(t.length<=1){var i=this.getData("handleTabContent")?"lyte-tab-head":"lyte-tabs";this.$node.querySelector(i).style.display="none"}else if(a){var l=this.getTabTitleByIndex(0);l&&(l.style["border-top-left-radius"]=a,l.style["border-bottom-left-radius"]=a);var o=this.getTabTitleByIndex(t.length-1);o&&(o.style["border-top-right-radius"]=a,o.style["border-bottom-right-radius"]=a)}},getDefaultOrFirstTabTitle:function(){var e,t=this.getData("defaultTab");if(t&&(e=this.getData("handleTabContent")?document.querySelector("lyte-tab-title#title_"+t):document.querySelector("lyte-tab-title#"+t)))return e;if((t=this.getData("tabsArray")[0].tabId)&&(e=this.getData("handleTabContent")?document.querySelector("lyte-tab-title#title_"+t):document.querySelector("lyte-tab-title#"+t)))return e;return null},getTabTitleByIndex:function(e){var t=this.getData("tabsArray")[e].tabId;if(t){var a=this.getData("handleTabContent")?document.querySelector("lyte-tab-title#title_"+t):document.querySelector("lyte-tab-title#"+t);if(a)return a}return null},actions:{onTitleClick:function(e){if(e&&e.tabId){var t=e.tabPageName||e.tabId;this.renderTabContent(t,e.tabPageArgs,e.tabId,e.tabComponent,e.isUserFrame,e.argument)}else(e&&!e.tabId&&"Go to Testing page"===e.tabName||e&&!e.tabId&&"Go to Testing page"===e.tabName)&&COMMON_UTILS.executeFunctionByName(e.functionName,window,Setup.currentProvider.providerId)}},methods:{onOpen:function(e){e.dispatchEvent(new Event("pbtab-content-rendered",{bubbles:!0}))}},renderTabContent:function(e,t,a,i,l,o){var n=document.getElementById(a);if(n){var r=n.getAttribute("data-populated");if("true"==r)return;if("error"==r&&this.emptyTabContent(a),i)return void networkUtils.loadDependencies(i.dependency,(function(){n.innerHTML=null,Lyte.Component.render(i.name,i.dynamicKeys,"#"+a),n.setAttribute("data-populated","true")}));if(t=t||{},"undefined"!=typeof Setup&&(t.providerId=Setup.providerInfo.providerId),t="string"==typeof t?JSON.parse(t):t,l)return void zpb_config.showUserFrameView(e,t.callrefid,t.orgid,a,(function(){n.setAttribute("data-populated","true"),n.dispatchEvent(new Event("pbtab-content-rendered",{bubbles:!0}))}));var s=commonHelper.getOrgServiceIframeDetails();t.serviceName=s.serviceName,t.serviceID=s.serviceID,t.frameorigin=COMMON_UTILS.parentDomain;var d={};if(d=this.getData("nonPb")?{actionUrl:e,params:t,type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded"}}:{actionUrl:"/phonebridge/viewcomponent/"+e,params:t,type:"GET",authentication:"cookies",headers:{"Content-Type":"application/x-www-form-urlencoded"}},o&&"string"==typeof o){var c=JSON.parse(o);$.extend(d.params,c)}COMMON_UTILS.fetchRequest(d).then(function(e){e.name?networkUtils.loadDependencies(e.dependency,(function(){n.innerHTML=null,e.UserLists&&(e.dynamicKeys.userLists=e.UserLists),Lyte.Component.render(e.name,e.dynamicKeys,"#"+a),n.setAttribute("data-populated","true"),n.dispatchEvent(new Event("pbtab-content-rendered",{bubbles:!0}))})):"error"===e.status&&("NO ADMIN PRIVILEGES"!==e.code||e.body||(e.title=I18n.getMsg("phonebridge.permission.error.title"),e.body=I18n.getMsg("phonebridge.permission.error.body")),this.emptyTabContent(a,e))}.bind(this))}},emptyTabContent:function(e,t){var a=document.getElementById(e);if(null!=a)if(a.innerHTML=null,t&&"error"===t.status){var i='<div class="mL75 p30 mT75"><div class="fL mT10 mL10"><span class="dIB zpb_iconDenied"></span></div><div class="fL pL25 w400">';t.title&&(i+='<div class="f18 mT5">'+t.title+"</div>"),i+='<div class="f14 mT10" style="line-height:20px;">'+t.body+"</div></div></div>",a.innerHTML=i,a.setAttribute("data-populated","error"),a.dispatchEvent(new Event("pbtab-content-rendered",{bubbles:!0}))}else a.innerHTML='<div class="p30 mT75"><span class="tabLoadingIcon"></span></div>',a.setAttribute("data-populated","false")},emptyAndRerender:function(e){this.emptyTabContent(e);var t=this.getData("tabsArray");if(t)for(var a=0;a<t.length;a++)if(t[a].tabId==e){var i=t[a],l=i.tabPageName||i.tabId;return void this.renderTabContent(l,i.tabPageArgs,i.tabId,i.tabComponent,i.isUserFrame,i.argument)}}});