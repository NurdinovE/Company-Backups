var fieldOfLookup={mappingFieldList:{},delmappingFieldList:{},lookupModule:"",lookupModuleFields:{},referFromFieldIdList:[],fieldoflookupList:[],relatedlistlabels:{},lookupFieldId:"",follimit:5,getFieldOfLookupFields:function(e){for(var i=e.length,l="",d=0;d<i;d++){var o=e[d];l=o.fieldOfLookupFieldid.includes("NE")?l+"."+o.fieldOfLookupFieldid+" .fieldcontainer,":l+"#id_"+o.fieldOfLookupFieldid+" .fieldcontainer,"}return l=$(l.slice(0,-1))},getReferFromFieldIdVsColumnName:function(e,i,l,d){var o,t={},a={},r=JSON.stringify(returnJson.entityMapJson),n=JSON.parse(r),s=Object.keys(n),f=Object.keys(n).length;if(i=i&&"string"!=typeof i?i.toString():i,n.CURRENCYISOCODE)var p=n.CURRENCYISOCODE.defaultvalue;for(var u=0;u<f;u++){var m=n[s[u]].dependent_lookup_fieldid;if(i==n[s[u]].fieldid&&(o=n[s[u]].colname),i==m){n[s[u]].fieldid;var c=n[s[u]].colname,L=n[s[u]].refered_from_fieldid,k=e[L],g=n[s[u]].uitype;if(d&&d.curLayoutFields&&!d.curLayoutFields.contains(L))continue;if(e.hasOwnProperty(L)){if((36==g||143==g||144==g||145==g)&&n.CURRENCYISOCODE&&""!==k){var F=Crm.userDetails.CURRENCY_DETAILS,v=parseFloat(F[d.currency].er),C=F[p].er,O=k/v,h=parseFloat(C),b=parseInt(Crm.userDetails.CURRENCY_DETAILS[p].decimals);k=commonUtils.roundNumber(O*h,b)}t[L]=c,a[L]=k}}}var M={},y={};y.parentFieldsColumnName=t,y.refFieldsInfo=a,y.seId=l,M.item=y,fieldOfLookup.participatingfieldsvalidationrule(M,o,"lookuppopup")},participatingfieldsvalidationrule:function(e,i,l){if(!0===Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE){var d=detailView.currentModule,o={},t=Object.keys(e.item.parentFieldsColumnName).length,a=new Map,r="",n=new Map,s=[];Crm.VR&&(delete Crm.VR,"SMOWNERID"===i&&($("#VRAjaxEdit").find(".fieldsContainer").empty(),CFRExec.performCancelMandatory()));var f=$("#formRuleMandatoryFields");(f=f.length>0?f:$("#closedWon")).is(":visible")||CFRExec.setHaltedFieldLabel(i),Crm.oldVR&&delete Crm.oldVR,Crm.VR={},Crm.oldVR={},Crm.oldVR.ajaxEditFieldLabel=i,Crm.VR.ajaxEditFieldLabel=i,Crm.VR.entityDetails={},Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson,Crm.VR.entityID=e.item.seId;var p=JSON.stringify(returnJson.entityMapJson),u=JSON.parse(p),m=$("#createEntityForm");for(var c in e.item.parentFieldsColumnName){var L=e.item.parentFieldsColumnName[c],k=u[L];if(k){if("view"===window[d].currentStatus&&businessCardJson&&businessCardJson.isEditRestricted&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&detailView.changedBCJson.recordLockingDetails.isLockedForMe&&detailView.changedBCJson.recordLockingDetails.allowed_fields){var g=detailView.changedBCJson.recordLockingDetails.fieldIds;if(g&&!g.contains(k.fieldid)){t--;continue}}var F=$("#"+fieldOfLookup.getElemId(L,d,"view"));if($L("#AjaxEditComponent")[0]||F&&(F.is(":visible")||!CFRExec.LayoutRuleHiddenElem.includes(L))){var v=u[L];if(v){var C=v.uitype;if(36==C||38==C||32==C){var O=v.decimalLength,h=e.item.refFieldsInfo[c];h=h?"string"!=typeof h?h.toString():h:"",36==C&&-1!=h.indexOf(",")&&(h=h.replace(/,/g,"")),null==O&&(O=9),null==O&&(O=9),38!=C&&32!=C||(h=Search.reverseFormatNumber(h)),h=h.replace(/,/g,""),h=parseFloat(parseFloat(h).toFixed(O)),isNaN(h)&&(h=""),e.item.refFieldsInfo[c]=h}if("250"===C){r+=c+",",a.set(c,L);continue}if(221==C){var b=e.item.refFieldsInfo[c];if(b&&b.ID){var M=store.peekRecord("user",b.ID);M&&"deleted"===M.status?e.item.refFieldsInfo[c]={}:(s.push(b.ID),n.set(c,L))}}if("333"===C&&m.length>0&&e.item.refFieldsInfo[c]&&l&&"lookuppopup"!==l){var y=CrmDateUtils.getDateObjectFromString(e.item.refFieldsInfo[c]).toString(),I=y.indexOf(":"),x=y.substring(0,I+6);e.item.refFieldsInfo[c]=x}("24"===C||"202"===C)&&m.length>0&&e.item.refFieldsInfo[c]&&l&&"lookuppopup"!==l&&(e.item.refFieldsInfo[c]=CrmDateUtils.getFormattedDate(CrmDateUtils.getDateObjectFromString(e.item.refFieldsInfo[c])))}o[L]=e.item.refFieldsInfo[c]}else t--}else t--}if(t<1)return!1;if(a.size>0||n.size>0)if(a.size>0&&n.size>0){commonUtils.showHideLoadingDiv(!0);var R=returnJson.entityMapJson[i].lookupmodule;store.findAll("field",{module:moduleApiMapping[R]}).then((function(t){for(var n=(r=r.slice(0,-1)).split(","),p=n.length,m=0;m<p;m++){var c=t.filter((e=>e.id===n[m]))[0].api_name;r=r.replace(n[m],c),a.set(c,a.get(n[m])),a.delete(n[m])}var L=e.item.seId;Lyte.resolvePromises([store.findAll("dummy",null,!1,!1,{url:"crm/v6/"+moduleApiMapping[R]+"/"+L+"/actions/fetch_full_data?fields="+r}),store.findAll("user",{ids:s.join(",")},!0)]).then((function(e){for(let[i,l]of a.entries())e[0].data[0][i]?o[l]=e[0].data[0][i]:o[l]="";commonUtils.showHideLoadingDiv(!1),fieldOfLookup.populatefieldsvaluesandvalidationrule(o,i,l,u,d,f)}))}))}else if(a.size>0){commonUtils.showHideLoadingDiv(!0);R=returnJson.entityMapJson[i].lookupmodule;var _=e.item.seId;store.findAll("field",{module:moduleApiMapping[R]}).then((function(e){for(var t=(r=r.slice(0,-1)).split(","),n=t.length,s=0;s<n;s++){var p=e.filter((e=>e.id===t[s]))[0].api_name;r=r.replace(t[s],p),a.set(p,a.get(t[s])),a.delete(t[s])}store.findAll("dummy",null,!1,!1,{url:"crm/v6/"+moduleApiMapping[R]+"/"+_+"/actions/fetch_full_data?fields="+r}).then((function(e){for(let[i,l]of a.entries())e.data[0][i]?o[l]=e.data[0][i]:o[l]="";commonUtils.showHideLoadingDiv(!1),fieldOfLookup.populatefieldsvaluesandvalidationrule(o,i,l,u,d,f)}))}))}else n.size>0&&(commonUtils.showHideLoadingDiv(!0),store.findAll("user",{ids:s.join(",")},!0).then((function(){commonUtils.showHideLoadingDiv(!1),fieldOfLookup.populatefieldsvaluesandvalidationrule(o,i,l,u,d,f)})));else fieldOfLookup.populatefieldsvaluesandvalidationrule(o,i,l,u,d,f)}f&&"closedWon"===f.attr("id")&&renderingUtils.labelWidthFixed()},populatefieldsvaluesandvalidationrule:function(e,i,l,d,o,t){var a=$("#VRAjaxEdit"),r=$("#show"),n={};n.message=I18n.getMsg("crm.field.of.lookup.fields.related.fields"),n.message1=I18n.getMsg("crm.field.of.lookup.fields.related.fields.custom.message3",$ESAPI.encoder().encodeForHTML(d[i].displaylabel)),n.message2=I18n.getMsg("crm.field.of.lookup.fields.related.fields.custom.message2"),!a||a&&0===a.length?(r.prepend($(Handlebars.templates.ValidationRuleAjaxEditFailure(n))),a=$("#VRAjaxEdit")):($("#cm_per_desc").empty(),$("#dv_field_info_header").text(n.message),$("#vr_fol_otherdetails_msg1").html(n.message1),$("#vr_fol_otherdetails_msg2").text(n.message2),$("#vr_fol_otherdetails").show());var s=a.find(".fieldsContainer"),f=a.find(".pp-content");for(var p in f.css("overflow","auto"),e){var u=d[p];if(221==u.uitype&&e[p]&&e[p].ID){var m=store.peekRecord("user",e[p].ID);m&&"deleted"===m.status&&(e[p]={})}validationUtils.isJsonCheck(e[p])?void 0!==e[p].Name||void 0!==e[p].name?(u.defaultid=e[p].ID||e[p].id,u.defaultvalue=e[p].Name||e[p].name):(u.defaultid="",u.defaultvalue=""):(u.defaultvalue=e[p],301==u.uitype&&"boolean"==typeof u.defaultvalue&&(u.defaultvalue=u.defaultvalue+""));var c=fieldOfLookup.getElemId(p,o,"edit");if((L=s.find("#"+c)).length>0){L[0].parentNode.parentNode.remove();var L=[]}if(!L||L&&!L.length>0){var k=crmTemplate.createFieldRow(returnJson.layout_jsonarrayObj.sysLayoutId,o,void 0,u,void 0,!0);if((k=$(k)).addClass("LR"),t&&"closedWon"===t.attr("id")&&k.find(".labelTabCreate").addClass("columnCal1"),t.is(":visible")){var g=k[0].id,F=t.find("#"+g);F.length>0&&(F.find(".labelTabCreate").hasClass("newmandatory")&&(k.find(".labelTabCreate").addClass("newmandatory"),k.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_']").data("mandate","true")),F.remove()),t.find(".tabdiv.fieldsContainer").append(k)}else{if(l&&"lookuppopup"===l&&(24!=u.uitype&&202!=u.uitype||k.find(".textField").val(u.defaultvalue),333==u.uitype&&e[p])){var v=e[p];if(v=(v=v.split(":"))[0].slice(0,v[0].lastIndexOf(" ")),k.find("#"+c).val(v),u.timeVal.includes("NaN:NaN")){var C=e[p],O=C.indexOf(":"),h=C.substring(O-2,C.length);k.find("#"+c+"_TimeOption").val(h)}}s.append(k)}}L.length>0&&L.focus()}var b=a.find("select");if(b&&b.length&&thirdPartyUtils.bindSelect2(b),t.is(":visible"))r.find(a).remove(),(b=t.find("select"))&&b.length&&thirdPartyUtils.bindSelect2(b);else{var M=$(".zc_ajax_pop_wrapper");void 0!==M&&M.eq(0).addClass("moveLookupPopBackToFreezeAjax");var y=$L("#topBandPopup");$L("#changeOwnerPopup").length>0?(a.css("z-index","31"),y.addClass("moveTopbandBackToTheFreeze")):a.css("z-index",""),crmui.showPopup("VRAjaxEdit",!0)}setTimeout((function(){$(".fol_ajaxEditPop:visible").length&&$(".textField.ui-autocomplete-input").blur()}),10)},getElemId:function(e,i,l){return"view"===l?"mouseArea__"+e:"Crm_"+i+"_"+e},loadFieldsofLookup:function(){Handlebars.registerPartial("addFieldMapRow",Handlebars.templates.addFieldMapRow),fieldOfLookup.referFromFieldIdList=[],fieldOfLookup.fieldoflookupList=[];var e=$("#currentfield").data();fieldOfLookup.mappingFieldList=[],fieldOfLookup.delmappingFieldList=[],fieldOfLookup.relatedlistlabels={},e.fieldOfLookupList&&(fieldOfLookup.mappingFieldList=e.fieldOfLookupList.slice()),fieldOfLookup.lookupModule=e.lookuptype,fieldOfLookup.lookupFieldId=e.id,("userLookupField"===e.etype&&void 0===fieldOfLookup.lookupModule||8===e.uitype&&void 0===fieldOfLookup.lookupModule)&&(fieldOfLookup.lookupModule="Users");for(var i=fieldOfLookup.mappingFieldList.length,l=0;l<i;l++){var d=fieldOfLookup.mappingFieldList[l],o=fieldOfLookup.getfieldOfLookupEle(d.fieldOfLookupFieldid);if(null==o||o.length<1)fieldOfLookup.mappingFieldList.removeFirstOccurenceOfElement(d),i--,l--;else{var t=o.data();t.label!==d.fieldOfLookupFieldLabel&&(d.fieldOfLookupFieldLabel=t.label),fieldOfLookup.referFromFieldIdList.push(d.referFromFieldid),fieldOfLookup.fieldoflookupList.push(d.fieldOfLookupFieldid)}"Potential Name"===d.referFromFieldLabel&&(d.referFromFieldLabel="Deal Name")}e.fieldOfLookupList=fieldOfLookup.mappingFieldList.slice();var a={action:"getRelatedFieldsOfLookupModule",lookupModule:fieldOfLookup.lookupModule};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/PageLayout.do?",data:a,type:"POST",success:function(e){var i=$("#addRelatedFieldsPop");i.length>0&&i.remove(),fieldOfLookup.lookupModuleFields=e;var l={};l.lookupModule=fieldOfLookup.lookupModule,l.baseModule=CMB.oCHolder.moduleInfo.moduleName,l.baseModuleLabel=CMB.oCHolder.moduleInfo.pluralLabel,l.fieldOfLookup=fieldOfLookup.mappingFieldList;var d=$(Handlebars.templates.fieldOfLookupList(l));$("#hiddenContentHolder").append(d),fieldOfLookup.checkForLimit_DisableAddButton(!0),fieldOfLookup.mappingFieldList.length>0&&$("#relatedFeildsTbl").show(),CrmPageLayout.totalLayoutCnt>1&&d.find(".fol_infoAlertText").removeClass("dNImp"),crmui.showPopup("addRelatedFieldsPop")}})},isPicklist:function(e){return"picklistField"===e||"multipicklistField"===e},openMappingPop:function(){if($("#relatedFeildsTbl").find("tr").size()-1>=CML.fieldOfLookupLimit)crmui.showMsgBand("error",I18n.getMsg("crm.customfield.lookup.fieldoflookup.limit",CML.fieldOfLookupLimit),"4000","");else{var e=$("#addRelatedFieldRelatingPop");e.length>0&&e.remove();var i={};if("Users"===fieldOfLookup.lookupModule?i.lookupModule="User":i.lookupModule=I18n.getMsg(moduleRecordMapping[fieldOfLookup.lookupModule].singular_label),i.baseModule=CMB.oCHolder.moduleInfo.pluralLabel,i.lookupModule==CMB.oCHolder.moduleInfo.singularLabel){let e=$("#currentfield").data("id");i.lookupModuleFields=fieldOfLookup.lookupModuleFields.filter((i=>i.fieldId!=e))}else i.lookupModuleFields=fieldOfLookup.lookupModuleFields;i.referFromFieldIdList=fieldOfLookup.referFromFieldIdList;var l=$(Handlebars.templates.addRelatedField(i));$("#hiddenContentHolder").append(l),crmui.showPopup("addRelatedFieldRelatingPop"),$("#addRelatedFieldsPop").addClass("goBackToFirstLayer"),thirdPartyUtils.bindSelect2(".lookupModule, .relatingFields "),setTimeout((function(){$("#select2-lookup_fieldList-container").attr("title",$("#lookup_fieldList").find("option:selected").text())}),100)}},generateUniqueRelatedListTitle:function(e){var i=I18n.getMsg("crm.label.enterRelatedListName"),l=[];fieldOfLookup.relatedlistlabels[e]&&(l=l.concat(fieldOfLookup.relatedlistlabels[e])),l=l.concat(CMB.usedLabels.relatedlistlabels[e]);for(var d=i,o=0;o++,d=i.concat(" "+o),l.contains(d.toLowerCase().trim()););return d},selectedFieldToMap:function(e){var i=function(e,i){return"textareaField"===e.etype&&"textareaField"===i.attr("data-etype")&&110===e.uitype&&"110"===i.attr("data-uitype")&&2e3===parseInt(e.mxchar)||(!e.mxlen||!i.attr("data-mxlen")||parseInt(e.mxlen)>=i.attr("data-mxlen"))&&(!e.mxchar||parseInt(e.mxchar)>=i.attr("data-mxchar"))&&(!e.mxdgt||parseInt(e.mxdgt)>=i.attr("data-mxdgt"))&&(void 0===e.decimal||parseInt(e.decimal)>=i.attr("data-decimal"))};e=e?$(e):$("#lookup_fieldList");var l=[39,40],d=$("#cm_fieldList"),o=$("#forLookupAlone");d.children("option:not(:first)").remove(),d.change();var t,a=$("#addRelatedFieldRelatingPop .doneBtnReltedFeildsPP"),r=$("#currentfield");if(e.val()!=I18n.getMsg("crm.label.picklist.none")){$("#mapping_option").removeClass("eventNone op5"),d.attr("disabled",!1),$("#addnewfield").attr("disabled",!1);var n,s=e.find("option:selected"),f=s.attr("data-etype"),p=s.attr("data-uitype"),u=s.attr("data-isencryptfield"),m=s.attr("data-ispersonalfield"),c=$("#asSingleLine"),L=$("#forRelatedListName");"lookupField"===f||"userLookupField"===f?(o.removeClass("dNImp"),8==p||221==p?$L("#lookupLabel").text(I18n.getMsg("crm.field.of.lookup.fields.users.lookuplabel")):133==p&&$L("#lookupLabel").text(I18n.getMsg("crm.field.label.lookup")),n=s.attr("data-lookupModule"),c.is(":checked")?(f="textField",L.addClass("dNImpdN")):8==p||221==p?L.addClass("dNImp"):($(".nameOfRelatedList").val(fieldOfLookup.generateUniqueRelatedListTitle(n)),L.removeClass("dNImp"))):(o.addClass("dNImp"),L.addClass("dNImp"));var k=s.text();k=CMB.getUniqueDomLabel(f,k.trim(),CMB.nCHolder,CMB.usedLabels);var g=$(".nameOftheField");g.val(k),g.removeClass("errFieldBdr");var F=g.parents("div").eq(0).find(".fieldErrMsg");F.length>0&&F.remove();var v=$("#sectioncontainerholder");f=8!=p||c.is(":checked")?f:"userLookupField";var C=v.find(".fieldcontainer[etype="+f+"]");C.sort((function(e,i){var l=$(e).data("label"),d=$(i).data("label");return l<d?-1:l>d?1:0}));for(var O=C.length,h=0;h<O;h++){var b=$(C[h]);if("currentfield"!==b.attr("id")&&b.data("id")!==s.attr("data-fieldid")&&!b.data("isDisplayColumn")&&!b.data("fldUnique")&&1!==b.data("gentype")&&3!==b.data("fcategory")&&(!l.contains(b.data("uitype"))||s.attr("data-uitype")===b.data("uitype"))&&("lookupField"!==f||b.data("lookuptype")===n&&(!b.data("fieldOfLookupList")||0===b.data("fieldOfLookupList").length))&&i(b.data(),s)&&1===b.data("source")){if("250"!==s.attr("data-uitype")&&250===b.data("uitype"))continue;var M=b.parent(),y='<option data-fieldid="'+(b.data("id")?b.data("id"):M.attr("copyof"))+'">'+$ESAPI.encoder().encodeForHTML(b.data("label"))+"</option>";b.data("fieldOfLookupModule")&&b.data("lookupFieldid")!=r.data("id")||(t=b.data()).alsocreatefor_layouts&&(t.Accounts||t.Contacts||t.Potentials||t.Invoices||t.SalesOrders)||b.data("isExternalField")||b.data("isUsedAsFOL")||b.data("isUsedInFieldUpdate")||"multiUserLookupField"===b.data("etype")||(!b.data("id")||fieldOfLookup.fieldoflookupList.contains(b.data("id")))&&(b.data("id")||fieldOfLookup.fieldoflookupList.contains(M.attr("copyof")))||d.append(y)}}var I=$(".setupnoteswrapper"),x=$("#fol_list");0===I.length&&(u||m)&&(x.after('<div class="setupnoteswrapper mB20 mT12"></div>'),I=$(".setupnoteswrapper")),u||m?x.removeClass("pB30"):x.addClass("pB30"),u&&m?I[0].innerHTML='<span class="crm-font-bold">Note : </span>'+I18n.getMsg("crm.fol.sensitive.encrypt.fields.alert.message")+"</div>":u?I[0].innerHTML='<span class="crm-font-bold">Note : </span>'+I18n.getMsg("crm.fol.encrypt.fields.alert.message")+"</div>":m?I[0].innerHTML='<span class="crm-font-bold">Note : </span>'+I18n.getMsg("crm.fol.sensitive.fields.alert.message")+"</div>":I.length>0&&I.remove();var R=$(".existingField");R.attr("disabled",!1),R.is(":checked")?a.attr("disabled","disabled"):a.attr("disabled",!1)}else $("#mapping_option").addClass("eventNone op5"),d.attr("disabled",!0),$("#addnewfield").attr("disabled",!0),$(".nameOftheField").val(""),a.attr("disabled","disabled")},mappingDecision:function(){$(".existingField").is(":checked")?($(".forExistingField").removeClass("dNImp"),$(".forNewField").addClass("dNImp"),fieldOfLookup.mappedFieldValidate()):($(".forExistingField").addClass("dNImp"),$(".forNewField").removeClass("dNImp"),fieldOfLookup.textboxValidate())},mappedFieldValidate:function(){var e=$("#cm_fieldList"),i=$("#addRelatedFieldRelatingPop .doneBtnReltedFeildsPP");e.val()!=I18n.getMsg("crm.label.picklist.none")?i.attr("disabled",!1):i.attr("disabled","disabled")},textboxValidate:function(e){var i=$("#addRelatedFieldRelatingPop .doneBtnReltedFeildsPP");e||(e=$(".nameOftheField")),""===$(e).val()?i.attr("disabled","disabled"):$(".lookupModule").val()!=I18n.getMsg("crm.label.picklist.none")&&i.attr("disabled",!1)},removefieldOfLookupFromList:function(e){crmui.hideTooltip();var i=e.index();fieldOfLookup.mappingFieldList[i].isnew||fieldOfLookup.delmappingFieldList.push(fieldOfLookup.mappingFieldList[i]),fieldOfLookup.mappingFieldList.splice(i,1),fieldOfLookup.checkForLimit_DisableAddButton(!0),fieldOfLookup.referFromFieldIdList.splice(i,1),fieldOfLookup.fieldoflookupList.splice(i,1),e.remove(),$("#addRelatedFieldsPop .doneBtnReltedFeildsPP").attr("disabled",!1)},addButtonHTML:function(){return'<div class="alignRight fR" onmouseenter="fieldOfLookup.checkForLimit_ShowToolTip()" onmouseleave="crmui.hideTooltip()" ><button id="addFieldOfLookupBtn" class="primaryflatbtn" data-zcqa="FOLU_addField2" onclick="fieldOfLookup.openMappingPop();">'+I18n.getMsg("crm.customfield.lookup.relatedfield.addfieldbutton")+"</button></div>"},getfieldOfLookupEle:function(e){var i=$("#id_"+e),l=$("."+e);if(i.length>0)return i.find(".fieldcontainer");if(l.length>0)return l.find(".fieldcontainer");var d=$("#fieldsTrash"),o=d.find(".eachremovedfieldcontainer").find(".detBlknew"),t=d.find(".eachremovedfieldcontainer[copyof="+e+"]").find(".detBlknew");if(null!=t&&0!=t.length)return t;for(var a=o.length,r=0;r<a;r++){var n=o.eq(r);if(n.data("id")==e)return n}},checkForLimit_ShowToolTip:function(){fieldOfLookup.mappingFieldList.length>=CML.fieldOfLookupLimit&&crmui.showTooltip({content:I18n.getMsg("crm.customfield.lookup.fieldoflookup.limit",CML.fieldOfLookupLimit),isHTML:!1})},checkForLimit_DisableAddButton:function(e){var i=$("#addFieldOfLookupBtn");fieldOfLookup.mappingFieldList.length>=CML.fieldOfLookupLimit||e&&["X","S","Y"].contains(CML.accountInfo.licType)?i.attr("disabled","disabled"):i.removeAttr("disabled")},saveList:function(e){for(var i=$("#currentfield"),l=i.data(),d=i.parent(),o=i.parents(".sectionli"),t=o.find(".sectioncontainer"),a=o.find(".ul-field-left").find("li"),r=o.find(".ul-field-right").find("li"),n=o.find(".overLapedDiv"),s=fieldOfLookup.delmappingFieldList.length,f=0;f<s;f++){if((u=fieldOfLookup.delmappingFieldList[f]).fieldOfLookupFieldid){if(null==(m=fieldOfLookup.getfieldOfLookupEle(u.fieldOfLookupFieldid))||m.length<1)continue;var p=m.data();delete p.fieldOfLookupModule,delete p.lookupModule,delete p.referFromFieldid,delete p.referFromFieldLabel,delete p.lookupFieldid,delete p.lookupLabel,p.isFieldPropertyUpdated=!0,p.removeParentFOL=!0,m.attr({isfploaded:"yes",modified:"true"}),m.removeAttr("lookuplabel")}}s=fieldOfLookup.mappingFieldList.length;for(f=0;f<s;f++){var u,m,c={};if((u=fieldOfLookup.mappingFieldList[f]).isnew){if(u.fieldOfLookupFieldid)m=fieldOfLookup.getfieldOfLookupEle(u.fieldOfLookupFieldid),c.iscopyOfRefField=!1;else{var L=$("#mB_"+u.etype);CMB.nCHolder.draggedElem=L;var k=$(CMB.convertTemplateIntoDOM(L[0])),g=k.find("div.fieldcontainer"),F=k.find("#currentfield");void 0!==F&&"new"===F.attr("ekind")&&F.data("source",1),void 0!==CMB.nCHolder.draggedElem[0].getAttribute("dbstatus")&&g.attr("dbstatus",CMB.nCHolder.draggedElem[0].getAttribute("dbstatus"));var v="NE"+ ++CMB.nCHolder.fieldAddCount;k.addClass(v).attr("copyof",v),F.data("label",u.fieldOfLookupFieldLabel);var C=F.find("input");if(C.data("oldval",u.fieldOfLookupFieldLabel),C.val(u.fieldOfLookupFieldLabel),d.after(k),d=k,"sectioncontainerholder_qcreate"!==o.attr("id")&&("Events"===CMB.oCHolder.moduleInfo.moduleName||"formulaField"!==L.data("etype")&&"autonumberField"!==L.data("etype")&&99!=L.data("uitype")&&20!=L.data("uitype")&&66!=L.data("uitype")&&555!=L.data("uitype")&&208!=L.data("uitype")&&111!=L.data("uitype")&&"COMMENTCOUNT"!=L.data("name")&&"ADDCOMMENT"!=L.data("name")&&"POSITIVE_SCORE"!=L.data("name")&&"NEGATIVE_SCORE"!=L.data("name")&&"TP_POSITIVE_SCORE"!=L.data("name")&&"TP_NEGATIVE_SCORE"!=L.data("name")&&"SCORE"!=L.data("name")&&"TP_SCORE"!=L.data("name")&&"SMOWNERID"!=L.data("name")&&"Quotes"!==CMB.oCHolder.moduleInfo.moduleName&&"Invoices"!==CMB.oCHolder.moduleInfo.moduleName&&"PurchaseOrders"!==CMB.oCHolder.moduleInfo.moduleName&&"SalesOrders"!==CMB.oCHolder.moduleInfo.moduleName&&"PriceBooks"!==CMB.oCHolder.moduleInfo.moduleName)&&CMB.updateQuickCreateAvailableFields(F,t),"currencyField"===F.data("etype")&&((CMB.unusedFieldLabels.contains(CMB.currencyISOFldLabel.toLowerCase())||CMB.unusedFieldLabels.contains(CMB.exchangeRateFldLabel.toLowerCase())&&((CMB.nCHolder.currencyFields.contains(CMB.exchangeRateFldLabel)||CMB.nCHolder.currencyFields.contains(CMB.currencyISOFldLabel))&&1===CMB.nCHolder.currencyFields.length||0===CMB.nCHolder.currencyFields.length))&&CMB.showCurrencyDepPp(!0),CMB.updateCurrencyFieldsList(u.fieldOfLookupFieldLabel,!0)),CMB.updateFieldCount(u.etype,!0,!0),CMB.setNextNum(u.etype),CMB.handleRemainField(),CMB.usedLabels.field.push($.trim(u.fieldOfLookupFieldLabel).toLowerCase()),0==a.length&&0==r.length?n.show():n.hide(),t.attr("schange","yes"),CMB.nCHolder.fieldSeqChanged=!0,Events.isPageLayoutModified=!0,(m=g).removeAttr("id"),m.removeClass("selectfieldcontainer"),m.parent().removeClass("dragElStyle"),u.fieldOfLookupFieldid=k.attr("copyof"),fieldOfLookup.isPicklist(u.etype)){var O=JSON.parse(u.options);c.options=O,c.reference_options=O,c.options_id=new Array(O.length).fill("")}"lookupField"==u.etype&&(c.lookuptype=u.pModule,c.relatedlistlabel=u.relateListName,CMB.usedLabels.relatedlistlabels[u.pModule].push(CMBValidator.toLowerCaseAndTrim(u.relateListName))),c.iscopyOfRefField=!0,u.mxlen&&(c.mxlen=u.mxlen),u.decimal&&(c.decimal=u.decimal),u.mxchar&&(c.mxchar=u.mxchar),u.mxdgt&&(c.mxdgt=u.mxdgt),"textareaField"===u.etype&&"50000"===u.mxchar&&(c.uitype=250,CMB.nCHolder.richTextFieldCount++,k.find(".textareafield").prop({defaultValue:I18n.getMsg("ze.editor.rich.text"),innerHTML:I18n.getMsg("ze.editor.rich.text"),innerText:I18n.getMsg("ze.editor.rich.text")}))}if(delete u.isnew,c.fieldOfLookupModule=!0,"Users"===fieldOfLookup.lookupModule?c.lookupModule=fieldOfLookup.lookupModule:c.lookupModule=moduleRecordMapping[fieldOfLookup.lookupModule].plural_label,c.referFromFieldid=u.referFromFieldid,c.referFromFieldLabel=u.referFromFieldLabel,fieldOfLookup.lookupFieldId&&"string"==typeof fieldOfLookup.lookupFieldId&&fieldOfLookup.lookupFieldId.length>0)c.lookupFieldid=fieldOfLookup.lookupFieldId;else if(fieldOfLookup.lookupFieldId&&"string"!=typeof fieldOfLookup.lookupFieldId){c.lookupFieldid=fieldOfLookup.lookupFieldId.toString();var h=new Error(JSON.stringify(l)+"follookupid"+fieldOfLookup.lookupFieldId)}else{c.lookupFieldid=l.id;h=new Error(JSON.stringify(l));murphy.error(h)}l.gentype&&1===l.gentype&&8===l.uitype&&void 0===l.layouts_id?c.lookupLabel=l.dblabel:c.lookupLabel=l.label,c.isFieldPropertyUpdated=!0,m.data(c),m.attr({isfploaded:"yes",modified:"true",lookuplabel:l.label}),m.data().removeParentFOL&&(delete m.data().removeParentFOL,m.data("isMapRemoveFol",!0))}}$("#saveBtn,#saveCloseBtn").removeClass("inActiveSec"),i.length>0&&(l.fieldOfLookupList=fieldOfLookup.mappingFieldList.slice()),crmui.hidePopup("addRelatedFieldsPop")}};Handlebars.registerHelper("addmxlen",(function(e){var i="";return e.mxlen?(i="data-mxlen='"+e.mxlen+"'",void 0!==e.decimal&&(i=i+" data-decimal='"+e.decimal+"'")):e.mxchar?i="data-mxchar='"+e.mxchar+"'":e.mxdgt&&(i="data-mxdgt='"+e.mxdgt+"'"),e.isEncryptField&&(i=i+"data-isencryptfield='"+e.isEncryptField+"'"),e.isPersonalField&&(i=i+"data-ispersonalfield='"+e.isPersonalField+"'"),i}));