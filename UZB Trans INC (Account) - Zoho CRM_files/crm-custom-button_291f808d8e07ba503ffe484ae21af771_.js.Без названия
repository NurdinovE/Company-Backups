Lyte.Mixin.register("crm-custom-button-mixin",{getRequestHandler:(t,e={},o={},n="custom_button")=>store.triggerAction(n,t,e,o,"GET",{}),postRequestHandler:(t,e={},o={},n={},s="custom_button")=>store.triggerAction(s,t,o,n,"POST",e),putRequestHandler:(t,e={},o={},n={},s="custom_button")=>store.triggerAction(s,t,o,n,"PUT",e),deleteRequestHandler:(t,e={},o={},n="custom_button")=>store.triggerAction(n,t,e,o,"DELETE",{}),listViewPositionsList:["list_view_without_record","list_view_each_record","list_view"],recordViewPositionsList:["create_clone","edit","view"],editNotSupportedActions:["widget","web_tab","circuit","cscript","kiosk"],locationInfoSupportPositions:["create_clone","edit","view","related_list"],getTranslatedInfoMessage:function(t,...e){const o={listViewLayoutInfo:"crm.custombutton.listview.notlayoutspecific.info",extensionInstalledButton:"crm.custombutton.label.plugin",cannotChangeWizardAssociatedButtonPosition:"crm.custombutton.wizard.association"}[t];return o?e?I18n.getMsg(o,...e):I18n.getMsg(o):void 0},customButtonRestrictedProfileNames:["SupportProfileInternal","Requesters"],positionToShowPopupForChangeOfPlaceForCustomFunction:["list_view_without_record","list_view"],customButtonNotSupportedModuleNames:["Services","Appointments","Calls"],kioskSupportedCustomButtonPositions:["view","list_view_without_record","list_view_each_record"],commonData:{isRecordUpdated:!1,customButtonUtilMenuNotSupportedModules:[],allModuleMergeFields:[],moduleApiName:null,moduleName:null,getMergeFieldsCallTriggered:!1,currentModule:"",customButtonMaxLimit:50},initiateRequest:function(t,e,o){return store.findAll("dummy",o,!1,!1,{url:t,method:e})},literals:{cannotChangeLayoutofWizardAssociatedButton:"crm.custombutton.wizard.layout.association"},checkCustomButtonSupportedForModule:function(t){return!this.customButtonNotSupportedModuleNames.includes(t)},imagePreviewClassMap:{create_clone:"create_img_section",edit:"edit_img_section",view:"view_img_section",list_view_without_record:"utility_menu_img_section",list_view_each_record:"each_record_img_section",list_view:"mass_action_img_section",related_list:"related_list_img_section",email_related_list:"email_related_list_img_section"},cscriptSupportedPosition:["create","clone","edit"],errorMessage:{cannotDeleteCustomButtonAssociatedWithWizard:"cannot delete custom button associated with a wizard"},previewSupportedPosition:["create_clone","edit","view","list_view_without_record","list_view_each_record","list_view","related_list"],addRemoveCurrentModuleMergeFields:function(){const t=ZohoDRE&&ZohoDRE.buttonsmoduleMap||void 0;if(t&&t.length){this.commonData.allModuleMergeFields&&this.commonData.allModuleMergeFields.length||(this.commonData.allModuleMergeFields=t);let e=$L("crm-custom-button-common");e.length&&"list_view_without_record"===e[0].component.getSelectedPosition()?ZohoDRE.buttonsmoduleMap=t.filter((t=>!this.commonData.customButtonUtilMenuNotSupportedModules.includes(t.groupName))):ZohoDRE.buttonsmoduleMap=this.commonData.allModuleMergeFields;let o=$L("crm-function-argument-popup");o.length&&o[0].component.$node.remove()}},isButtonListViewPosition:function(t){return!(!t||-1===this.listViewPositionsList.indexOf(t))},hideDropDownItemByValue:function(t){let e='lyte-drop-item[data-value="'+t+'"]';$L(e)&&$L(e)[0].classList&&$L(e)[0].classList.contains("hide")||$L(e).addClass("hide")},showDropDownItemByValue:function(t){let e='lyte-drop-item[data-value="'+t+'"]';$L(e).length&&$L(e)[0].classList&&$L(e)[0].classList.contains("hide")&&$L(e).removeClass("hide")},getModuleType:function(t){let e="default";return crmTab.isZBCustomModule(t)?e="zohoBooks":["Events","Calls","Tasks"].includes(t)?e="activity":crmTab.isZSCustomModule(t)&&(e="zohoSubscriptions"),e},getRelatedListData:function(t,e,o){if(t&&e){let n=store.findAll("related_list",{module:t},!0,!0);commonUtils.showHideLoadingDiv(!0),n.then((function(t){e(t,o)})).finally((function(){commonUtils.showHideLoadingDiv(!1)}))}},getUserTypePromise:function(){if(CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME||Crm.userDetails.CLIENT_PORTAL_NAME){let t=this.getQueryParamForInitialModels("user_type");return store.findAll("user_type",t)}},getButtonPlaceByPosition:function(t){return-1!==this.listViewPositionsList.indexOf(t)?"list":-1!==this.recordViewPositionsList.indexOf(t)?"record":t},isActionSupported:function(t,e){let o=this.actionCheckerMap;if(o[t]){return o[t].bind(this)(e)}return!0},actionCheckerMap:{circuit:function(t){let e=Crm.userDetails.isCircuitsEnabled&&Crm.userDetails.Circuits;return!("related_list"===t.place&&t.details&&t.details.related_list&&"Emails"===t.details.related_list.api_name||t&&t.place===this.custom_button_place.WIZARD)&&e},cscript:function(t){return!t||t.place!==this.custom_button_place.WIZARD},gallery_function:function(t){return!t||t.place!==this.custom_button_place.WIZARD},widget:function(t){return!t.place||t.place!==this.custom_button_place.WIZARD},kiosk:function(t){const e=this.kioskSupportedCustomButtonPositions;return Crm.isKioskEnabled&&t.position&&e.includes(t.position)},component:function(t){return!t.place||t.place!==this.custom_button_place.WIZARD}},getButtonMetaInfo:{getCurrentModuleApiName:function(){let t=$L("crm-custom-button-list"),e=$L("crm-custom-button-common");return t.length?t[0].component.data.moduleApiName:e.length?e[0].component.data.moduleApiName:void 0},getLayouts:function(){let t=store.peekAll("layout");return t&&t.length?t:[]}},addNoneOptionForDropDown(t,e,o){if(t&&Array.isArray(t)){let n={};n[e]="-1",n[o]=I18n.getMsg("crm.label.none"),t.unshift(n)}return t},resetCustomButtonData:function(){store.unloadAll("custom_button"),store.unloadAll("layout"),store.clearCachedQuery("profile"),store.unloadAll("related_list"),store.clearCachedQuery("user_type")},resetDataMap:{module_change:function(){this.setData("selectedFieldId",void 0)},action_change:function(){this.setData("selectedAction",void 0),this.setData("action",""),this.setData("actionData",{})},action_selection:function(){let t=this.getData("actionData");t&&Object.keys(t).length||this.setData("selectedAction",void 0)},share_location:function(){this.setData("shareLocation",!1)},reset_filter_data:function(){let t=$L("crm-custom-button-list-content");t&&t.length&&(t=t[0].component,t.setData("toShowNoButtonFound",!1),t.setData("buttons",store.peekAll("custom_button")));let e=$L("crm-custom-button-list-header");e&&e.length&&(e=e[0].component,e.setData("searchValue",""),e.setData("selectedLayout",""),e.setData("selectedPlace",""))},portal_unselected:function(){this.setData("selectedUserTypes",[])},button_list_view_to_other_place_change:function(){this.setData("selectedLayouts",[]),this.buttonDivConfig.enableLayoutSec.call(this),this.setData("layoutDropDownSelPlaceHolder",I18n.getMsg("crm.label.none"))},button_wizard_to_other_place_change:function(){this.setData("toShowButtonPositionSec",!0)},custom_function:function(){this.setData("shareLocation",!1),this.setData("addlParams",{}),this.setData("entityParams",{})},url:function(){this.setData("selectedDisplayType",void 0);let t=$L("crm-custom-button-url");t&&t.length&&(t=t[0].component,t.setData("urlExpression",""),t.setData("selectedEncodeType","UTF-8")),this.setData("urlExpression",""),this.setData("encodeFormat","UTF-8")},web_tab:function(){this.setData("urlExpression",""),this.setData("encodeFormat","UTF-8"),this.setData("isWebTabAssociated",!1),this.setData("selectedWebTab",void 0);let t=$L("crm-custom-button-url");t&&t.length&&(t=t[0].component,t.setData("selectedEncodeType","UTF-8")),this.setData("webTabLink",""),this.setData("isChangeSupportedForAction",!0)},custom_function_requirement:function(){this.setData("requirement",""),this.setData("phoneNumber",""),this.setData("selectedPriority","low")},place_change:function(){this.setData("selectedRecordViewPos",void 0),this.setData("selectedListViewPos",void 0),this.setData("selectedRelatedListId",void 0),this.buttonDivConfig.hidePreviewSec.call(this)},resetDataFetch:function(){for(const t of Object.keys(this.isDataFetched))this.isDataFetched[t]=!1},functionMergeFieldData:function(){try{customFunctionsObj&&customFunctionsObj.relatedModule&&delete customFunctionsObj.relatedModule,void 0!==ZohoDRE&&void 0!==ZohoDRE.buttonsmoduleMap&&(Array.isArray(ZohoDRE.buttonsmoduleMap)?ZohoDRE.buttonsmoduleMap=[]:ZohoDRE.buttonsmoduleMap={}),void 0!==ZohoDRE&&void 0!==ZohoDRE.fieldValueVsFieldLabel&&(ZohoDRE.fieldValueVsFieldLabel={}),void 0!==ZohoDRE&&void 0!==ZohoDRE.requestData&&void 0!==ZohoDRE.requestData.moduleMapGlobal&&(ZohoDRE.requestData.moduleMapGlobal=void 0),customFunctionsObj.isFrom&&delete customFunctionsObj.isFrom,ZohoDRE.resetRequestData();const t=$L("crm-function-argument-popup");t.length&&t[0].component.$node.remove(),this.commonData.customButtonUtilMenuNotSupportedModules=[],this.commonData.allModuleMergeFields=[],this.commonData.getMergeFieldsCallTriggered=!1}catch(t){murphy.addCustomTracking({message:"exception occurred while reseting function merge field data ",type:"custom event"}),murphy.error(t)}}},setMaxLimitForCustomButton:function(t){let e=this.commonData.customButtonMaxLimit;t&&t.length&&((t=t[0])&&t.details?(e=t.details.limits.total,this.commonData.customButtonMaxLimit=e):this.commonData.customButtonMaxLimit=-1)},checkCustomButtonCreationAllowed:{isUserEmailConfirmed:{check:function(){return!Crm.userDetails.IS_CONFIRMED_IN_IAM},getInfoMessage:function(){return I18n.getMsg("crm.custombutton.error.usermail.notconfirmed")},beforeDataFetch:function(){return!0}},isLimitReached:{check:function(t){return(t&&t.customButtonCount?t.customButtonCount:store.peekAll("custom_button").length)>=this.commonData.customButtonMaxLimit},getInfoMessage:function(){return-1===this.commonData.customButtonMaxLimit?I18n.getMsg("crm.custombutton.layout.creation.notallowed"):I18n.getMsg("crm.custombutton.limit.exceeded.msg",this.commonData.customButtonMaxLimit)},beforeDataFetch:function(){return!1}},isSupportProfileUser:{check:function(){return"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled},getInfoMessage:function(){return""},beforeDataFetch:function(){return!0}}},checkCustomButtonListViewPageAllowed:{isSupportProfileUser:{check:function(){return"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled},getInfoMessage:function(){return""}}},checkCustomButtonEditPageAllowed:{isSupportProfileUser:{check:function(){return"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled},getInfoMessage:function(){return""},beforeDataFetch:function(){return!0}},isExtensionInstalledButton:{check:function(t){if(!t||!t.customButton||!t.customButton.source)return!1;return"crm"!==t.customButton.source},getInfoMessage:function(){return""},beforeDataFetch:function(){return!1}}},updateButtonRec:function(t,e){let o=store.peekRecord("custom_button",e);for(const e in t)o.$.set(e,t[e]);return o},getCustomButtonAssociationDetails:function(t,e){let o={module:this.getData("moduleApiName")},n={buttonId:t,isV6Api:!0};this.getAssociationDetails(o,n,e.bind(this))},getAssociationDetails:function(t,e,o){let n=this.getRequestHandler("get_button_associated_details",e,t);this.makeRequest(n,o)},performActionBasedOnButtonLimit:function(t){let e=t.self?t.self:this;const o=this,n=function(t){t.renderComponent=function(t){const e=Lyte.registeredMixins["crm-custom-button-mixin"];let o=e.getComponentResource["crm-custom-button-create-popup"].call(e),n={};n.buttonComp=t.buttonComp,n.from=t.from,n.successCallback=t.resolve,n.failureCallback=t.reject,n.finallyCallback=t.finally;const s=store.peekAll("user_type");Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-custom-button-create-popup",{buttonComp:t.buttonComp,moduleName:t.moduleName,moduleApiName:moduleApiMapping[t.moduleName],buttonId:t.buttonId,layouts:t.layouts,profiles:t.profiles,customButton:t.customButton,callerData:n,userTypes:s},t.componentOutlet)}))},o.renderCustomButtonPopUp(t)};if(t.isEdit){let s=t.onLimitNotExceeded,i=t.data;s&&s.call(e,i),n.call(o,i)}else store.findAll("features",{api_names:"custom_button"},!0,!0).then((function(s){o.setMaxLimitForCustomButton(s);let i=!0;const a=o.checkCustomButtonCreationAllowed;for(const t of Object.keys(a))if(a[t].check.call(o)){let e=a[t].getInfoMessage.call(o);o.showErrorMsg(e),i=!1}if(i){let s=t.onLimitNotExceeded,i=t.data;s&&s.call(e,i),n.call(o,i)}else{let o=t.onLimitExceeded;o&&o.call(e,t.data)}}))},elementSelectorMap:{ProfileSelDiv:".buttonAccessSection",PositionSelDiv:".choosePositionSection",ActionSelDiv:".buttonPerformSection",ButtonNameDiv:".buttonNameSection",ButtonDescDiv:".buttonDescSection",ActionDropDown:".chooseBtnActionDropdown",ActionSelectedDiv:".choosedBtnActionSection",PreviewSec:".position_preview_link",LocationSec:".buttonLocationSection",LayoutSec:"#btn_layout_dd",PortalCheckBox:"#btnPortalCheckBox",SettingsLayoutUpdate:"#settings_set_layout",SettingsEdit:"#settings_btn_edit",SettingsDelete:"#settings_btn_delete",SaveButton:"#saveBtn",ListViewCreateCustomButton:"#listViewCreateCustomBtn",HelpIcon:".btnHelpIcon",UrlSection:"#btn_url_sec",DisplayTypeSection:".btnDisplayTypeSection",WebTabSelecionDropDown:"#btn_web_tab_dd"},getElement:function(t){const e=this.getData("compSelector"),o=this.elementSelectorMap[t];return e?$L(e+" "+o):$L(o)},ElementAction:{addDisplayNone:function(t){const e=this.getElement(t);e&&e.addClass("dN")},removeDisplayNone:function(t){const e=this.getElement(t);e&&e.removeClass("dN")},enable:function(t){const e=this.getElement(t);e&&e.removeClass("disable","pointerEventsNone")},disable:function(t){const e=this.getElement(t);e&&e.addClass("disable","pointerEventsNone")},show:function(t){const e=this.getElement(t);e&&e.removeClass("hide")},hide:function(t){const e=this.getElement(t);e&&e.addClass("hide")},close:function(t){const e=this.getElement(t);e&&e.length&&e[0].close()}},buttonDivConfig:{do:function(t){t=Array.isArray(t)?t:[t];for(let e of t)this.buttonDivConfig[e]&&this.buttonDivConfig[e].call(this)},showProfileSelDiv:function(){this.ElementAction.removeDisplayNone.call(this,"ProfileSelDiv")},showPositionSelDiv:function(){this.ElementAction.removeDisplayNone.call(this,"PositionSelDiv")},hidePositionSelDiv:function(){this.ElementAction.addDisplayNone.call(this,"PositionSelDiv")},showActionSelDiv:function(){this.ElementAction.removeDisplayNone.call(this,"ActionSelDiv")},hideActionSelDiv:function(){this.ElementAction.addDisplayNone.call(this,"ActionSelDiv")},showButtonNameDiv:function(){this.ElementAction.removeDisplayNone.call(this,"ButtonNameDiv")},showButtonDescDiv:function(){this.ElementAction.removeDisplayNone.call(this,"ButtonDescDiv")},hideButtonDescDiv:function(){this.ElementAction.addDisplayNone.call(this,"ButtonDescDiv")},hideActionDropDown:function(){this.ElementAction.addDisplayNone.call(this,"ActionDropDown")},showActionDropDown:function(){this.ElementAction.removeDisplayNone.call(this,"ActionDropDown")},showActionSelectedDiv:function(){this.ElementAction.show.call(this,"ActionSelectedDiv")},hideActionSelectedDiv:function(){this.ElementAction.hide.call(this,"ActionSelectedDiv")},showPreviewSec:function(){this.ElementAction.removeDisplayNone.call(this,"PreviewSec")},hidePreviewSec:function(){this.ElementAction.addDisplayNone.call(this,"PreviewSec")},showLocationSec:function(){this.ElementAction.removeDisplayNone.call(this,"LocationSec")},hideLocationSec:function(){this.ElementAction.addDisplayNone.call(this,"LocationSec")},disableLayoutSec:function(){this.ElementAction.disable.call(this,"LayoutSec")},enableLayoutSec:function(){this.ElementAction.enable.call(this,"LayoutSec")},disablePortalCheckBox:function(){this.ElementAction.disable.call(this,"PortalCheckBox")},hidePortalCheckBox:function(){this.ElementAction.addDisplayNone.call(this,"PortalCheckBox")},enablePortalCheckBox:function(){this.ElementAction.enable.call(this,"PortalCheckBox")},disableSettingsLayoutUpdate:function(){this.ElementAction.disable.call(this,"SettingsLayoutUpdate")},enableSettingsLayoutUpdate:function(){this.ElementAction.enable.call(this,"SettingsLayoutUpdate")},disableSettingsEdit:function(){this.ElementAction.disable.call(this,"SettingsEdit")},enableSettingsEdit:function(){this.ElementAction.enable.call(this,"SettingsEdit")},disableSettingsDelete:function(){this.ElementAction.disable.call(this,"SettingsDelete")},enableSettingsDelete:function(){this.ElementAction.enable.call(this,"SettingsDelete")},disableSaveButton:function(){this.ElementAction.disable.call(this,"SaveButton")},enableSaveButton:function(){this.ElementAction.enable.call(this,"SaveButton")},disableListViewCreateCustomButton:function(){this.ElementAction.disable.call(this,"ListViewCreateCustomButton")},enableListViewCreateCustomButton:function(){this.ElementAction.enable.call(this,"ListViewCreateCustomButton")},hideHelpIcon:function(){this.ElementAction.addDisplayNone.call(this,"HelpIcon")},showUrlSection:function(){this.ElementAction.removeDisplayNone.call(this,"UrlSection")},showDisplayTypeSection:function(){this.ElementAction.removeDisplayNone.call(this,"DisplayTypeSection")},closeWebTabSelecionDropDown:function(){this.ElementAction.close.call(this,"WebTabSelecionDropDown")}},custom_button_position:{CREATE_CLONE:"create_clone",EDIT:"edit",DETAIL_VIEW:"view",LIST_VIEW_MASS_ACTION:"list_view",LIST_VIEW_UTILITY_MENU:"list_view_without_record",LIST_VIEW_EACH_RECORD:"list_view_each_record",RELATED_LIST:"related_list",WIZARD:"wizards"},custom_button_place:{RECORD:"record",LIST:"list",RELATED_LIST:"related_list",WIZARD:"wizards"},isZBModule:function(t){return-1!==["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005"].indexOf(t)},isActivityModule:function(t){return-1!==["Events","Tasks"].indexOf(t)},isDataFetched:{related_list:!1,wizard_associated_details:!1},addButtonAssociatedProfilesWhichHasNotPermForModule:function(t,e){const o=store.peekAll("profile"),n=e&&e.length&&e.map((t=>t.id))||[],s=t.map((t=>t.id))||[],i=o&&o.length&&o.filter((t=>n.includes(t.id)&&!s.includes(t.id)))||[];return[...t,...i]},addButtonAssociatedUserTypesWhichHasNotPermForModule:function(t,e){const o=store.peekAll("user_type"),n=e&&e.length&&e.map((t=>t.id))||[],s=t.map((t=>t.id))||[],i=o&&o.length&&o.filter((t=>n.includes(t.id)&&!s.includes(t.id)))||[];return[...t,...i]},filterModuleVisibleProfiles:function(t,e){const o=e.map((t=>t.id));return t&&t.length&&t.filter((t=>o.includes(t.id)))||[]},getCustomButtonApiPromise(t){if(t&&t.moduleApiName){let e={};return e.module=t.moduleApiName,t.fields&&(e.fields=t.fields),store.findAll("custom_button",e,!0,!0,{isV6Api:!0})}},filterButtonData(t,e){return t=this.filterButtonsByPosition(t,e.position,e.relatedListApiName),t=this.filterButtonsByLayout(t,e.layoutId),t=this.filterButtonsByProfile(t,e.profileId,e.configurationPage,e.moduleName)},filterButtonsByPosition:(t,e,o)=>t&&t.length&&e&&o&&"related_list"===e?t.filter((t=>t.details&&t.details.related_list&&t.position===e&&t.details.related_list.api_name===o)):t&&t.length&&e?t.filter((t=>t&&t.position===e)):t||[],filterButtonsByLayout:(t,e)=>t&&t.length&&e?t.filter((t=>!(!t.layouts||!t.layouts.length)&&t.layouts.some((t=>t&&t.id===e)))):t||[],filterButtonsByProfile(t,e,o,n){const s=["canvas","wizard"],i=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM;if(!e&&n){const t=moduleRecordMapping[n];if(t){const o=t.access_type;e="team_based"===o?moduleRecordMapping[n].private_profile.id:Crm.userDetails.PROFILE_ID}}return e||(e=Crm.userDetails.PROFILE_ID),t&&t.length&&e?t.filter((t=>{if(t.profiles&&t.profiles.length||t.user_types&&t.user_types.length){const n=t&&t.profiles&&t.profiles.some((t=>t&&t.id===e)),a=t&&t.user_types&&t.user_types.some((t=>t&&t.id===e)),r=i&&s.includes(o)&&t.user_types&&t.user_types.length&&(!t.profiles||!t.profiles.length);return n||a||r}return!1})):t||[]},getProfilePromise:function(t){const e=this.getQueryParamForInitialModels("profile");return"team"===("team_based"===moduleRecordMapping[t].access_type?"team":"custom")?store.findAll("profile",{type:"private_profile"},!1,!0,{apiVersion:"5"}):store.findAll("profile",e)},initialModelQueryParams:{profile:function(){return{include_lite_profile:!0}},user_type:function(){return{include:"modules"}}},getQueryParamForInitialModels:function(t){let e=this.initialModelQueryParams[t];return e?e():{}},resourcesVsPromiseGetter:{layouts:function(t){return store.findAll("layout",{module:t.moduleApiName},void 0,void 0,{moduleSet:!0,subformModuleSet:!0,apiVersion:"2.2"})},profiles:function(t){return this.getProfilePromise(t.moduleName)},moduleAssociatedProfiles:function(t){return store.triggerAction("profile","get_assigned",{},void 0,"POST",{get_assigned:{feature:"module",related_entity_id:moduleRecordMapping[t.moduleName].id,page:1,per_page:"200"}})},customButtonCount:function(t){return store.triggerAction("custom_button","count",{apiVersion:"4"},{module:t.moduleApiName})},userTypes:function(){const t=this.getUserTypePromise();return new Promise(t?e=>{t.then((t=>e(t))).catch((()=>e([])))}:function(t){return t([])})},customButtonRecord:function(t){return store.findRecord("custom_button",t.buttonId,{module:t.moduleApiName},!0,!0,{isV6Api:!0})},customButtons:function(t){return store.findAll("custom_button",{module:t.moduleApiName},!0,!0,{isV6Api:!0})}},resourcesVsSuccessCallback:{layouts:function(t){return[...t]},profiles:function(t){return[...t]},moduleAssociatedProfiles:function(t){return[...t.profiles]},customButtonCount:function(t){return t.count},userTypes:function(t){return[...t]},customButtonRecord:function(t){return t&&t.length&&t[0]||void 0},customButtons:function(t){return[...t]}},customButtonModel:{getModelData:function(t,e){const o={},n=this.resourcesVsPromiseGetter;return t&&t.forEach((t=>{n[t]&&(o[t]=n[t].call(this,e))})),o},successCallback:function(t,e){const o={},n=this.resourcesVsSuccessCallback;return e&&e.forEach((e=>{if(n[e]&&t[e]){const s=n[e];o[e]=s.call(this,t[e])}})),o}},filterRelatedList:function(t){let e=["Notes","Attachments","Social","Activities","Calls","Events","Tasks","Activities_History","Invited_Events","Child_Accounts","Reporting_Contacts","Stage_History","Competitors","Contact_Roles","Mailing_History","Zoho_Survey","Visits_Zoho_Livedesk","Zoho_Projects","Zoho_Support","Zoho_Desk","Invitees","Zoho_Invoice","Circuit_Executions","Entity_Scores__s","Open_Appointments__s","Connected_Records__s"];Crm.userDetails.EMAIL_THREAD_VIEW||(e=e.concat("Emails"));const o=["RELATEDLISTPERSONALITY","WEBFORMUSAGEPERSONALITY","REVIEWPROCESSLOGPERSONALITY","WEBFORMUSAGEPERSONALITY","CHILDCAMPAIGNSPERSONALITY","WEBINAR_POLLS_PERSONALITY","WEBINAR_QUESTION_PERSONALITY","BLUEPRINTLOGPERSONALITY","CHECKLISTSPERSONALITY","REVIEWPROCESSPERSONALITY","EMAILSENTIMENTPERSONALITY","LOCKINGINFORMATIONPERSONALITY","ZINVOICEPERSONALITY","ZEXPENSEPERSONALITY","ZSUBSCRIPTIONSPERSONALITY","VOCPERSONALITY","SERIESPERSONALITY","SURVEYPERSONALITY"];return t.filter((t=>t.visible&&-1===e.indexOf(t.api_name)&&-1===o.indexOf(t.personality_name)&&-1===t.personality_name.indexOf("ORCHESTRATION")&&-1===t.personality_name.indexOf("HISTORY")&&(!t.parent_related_lists||t.parent_related_lists&&t.parent_related_lists[0]&&"Connected_Records__s"!==t.parent_related_lists[0].api_name)))},filterUserTypes:function(t,e){return t&&t.filter((t=>t.modules&&t.modules.filter((t=>"webtab_link"!==t.generatedType&&"webtab_widget"!==t.generatedType)).some((t=>t.api_name===e))))||[]},changeRelatedListLabel:function(t){for(const e of t)"Emails"===e.api_name&&(e.display_label="Email Threads");return t},saveFunctionScript:function(t,e,o){let n={};n.display_name=t.name,n.description=t.description,n.script=t.script,t.commit_message&&(n.commit_message=t.commit_message);let s=this.putRequestHandler("save_function_script",{functions:[n]},{functionId:t.id},{language:t.language});this.makeRequest(s,e,o)},addAllLayouts:function(t,e){return e&&(t=store.peekAll("layout")),t?[{id:"all",display_label:I18n.getMsg("crm.label.all.layouts")},...t]:t},setSelectedLayouts:function(t,e){return e&&e.length&&t&&t.length?t.length===e.length-1?(this.setData("layouts",e.filter((t=>"all"===t.id))),["all"]):t.map((t=>t.id)):[]},setSelectedUserTypes:function(t,e){return t&&t.length&&e&&e.length?t.map((t=>t.id)):[]},addLayoutHandling:function(t,e,o,n,s){("all"===t||e.length===o.length-1&&o.length>2)&&(n.setData("selectedLayouts",["all"]),n.setData("layouts",n.getData("layouts").filter((t=>"all"===t.id))),s.component.close())},removeLayoutHandling:function(t,e,o){"all"===o&&(this.setData("layouts",this.addAllLayouts(void 0,!0)),this.setData("selectedLayouts",this.getData("wizardAssocLayouts")))},showLeavePagePopup:function(t){const e=t.pause();this.showCustomButtonLeavePagePopupAlert((function(){e.resume()}),(function(){t.abort()}))},showCustomButtonLeavePagePopupAlert:function(t,e){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.event.layout.leavepage.confirm.message2"),ltPropSecondaryMessage:I18n.getMsg("crm.event.layout.leavepage.confirm.message1"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure"},{type:"reject",text:I18n.getMsg("crm.button.stay.here")}]},accept:t,reject:e})},getMergeFields:function(t,e,o,n=!0,s="custom_button"){let i={module:e,type:s,includelookups:n};o&&(i.relatedmodules=o),commonUtils.showHideLoadingDiv(!0);let a=this.getRequestHandler("get_merge_fields",{},i),r=t.bind(this);a.then((t=>{(({mergefields:t})=>{t.details.forEach((t=>{t.sections.forEach((t=>{t.fields=t.fields.filter((t=>t.show)).sort(((t,e)=>t.field_label.toLowerCase()<e.field_label.toLowerCase()?-1:t.field_label.toLowerCase()>e.field_label.toLowerCase()?1:0))}))}))})(t),r(t)})).catch((t=>this.errorHandling(t))).finally((()=>commonUtils.showHideLoadingDiv(!1)))},errorHandling:function(t,e,o){let n,s;if(!(!o||!!o.showErrorMessage))return;if(e)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg(e)}});try{n=t.response?JSON.parse(t.response):JSON.parse(t)}catch(e){n=t.response?t.response:t}n&&n.custom_buttons&&n.custom_buttons.length&&n.custom_buttons[0].message&&(n=n.custom_buttons[0]);let i=!1;switch(n.code){case"NO_PERMISSION":s=I18n.getMsg("crm.tryagain.message");break;case"NOT_ALLOWED":s="creating or editing custom button is not supported in your edition"===n.message?I18n.getMsg("crm.custombutton.label.lower.edition"):"cannot update wizard associated button position"===n.message?I18n.getMsg("crm.custombutton.wizard.association"):n.message?n.message:s;break;case"INVALID_DATA":n.details&&"id"===n.details.api_name||n.details&&2===n.details.resource_path_index?s=I18n.getMsg("crm.translation.refresh.cases"):"unsupported merge field provided in url"===n.message?s=I18n.getMsg("crm.custombutton.url.unsupported.merge.field"):"invalid url provided"===n.message&&n.details&&"url_expression"===n.details.api_name?s=I18n.getMsg("webform.url.validation"):"maximum length of url exceeded"===n.message&&n.details&&"url_expression"===n.details.api_name?i=!0:s=n.message?n.message:s;break;case"LIMIT_EXCEEDED":s=0===n.details.limit?I18n.getMsg("crm.custombutton.layout.creation.notallowed"):I18n.getMsg("crm.custombutton.limit.exceeded.msg",n.details.limit);break;default:s=n.message?n.message:I18n.getMsg("crm.label.widgets.error.internal")}s||(s=I18n.getMsg("crm.label.widgets.error.internal")),i?this.showValidationErrorMessage("MAX_URL_LENGTH_EXCEEDED",{element:"url"}):_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:s}});const a=o.callback&&"function"==typeof o.callback?o.callback:void 0;a&&a()},elementVsSelector:{layout:".btnLayout",place:".btnPlace",position:".btnPosition",action:".btnAction",url:".btnUrlExpression",encodeFormat:".btnUrlActionEncoding",profile:".btnProfile",userType:".btnPortal",name:".btnName",webTab:".btnActionWebTab",urlDisplayType:".btnActionDisplayType"},elementVsPropertyName:{layout:["selectedLayouts"],place:["selectedPlace"],position:["selectedRecordViewPos","selectedListViewPos","selectedRelatedListId"],action:["selectedAction"],url:["urlExpression"],encodeFormat:["selectedEncodeType"],profile:["selectedProfiles"],userType:["selectedUserTypes"],name:["buttonName"],webTab:["selectedWebTab"],urlDisplayType:["selectedDisplayType"]},elementVsValidationMap:{layout:["NO_LAYOUT"],name:["SPECIAL_CHAR_ERROR","NO_NAME"],url:["NO_URL"],urlDisplayType:["NO_URL_DISPLAY_IN"],webTab:["NO_WEB_TAB"],action:["NO_ACTION"],place:["NO_PLACE"],position:["NO_BUTTON_POSITION","NO_RELATED_LIST"],encodeFormat:["NO_ENCODE_FORMAT"]},validationMap:{NO_PLACE:function(){let t=$L("#btn_place_dd");return!(!t&&!t.length)&&(t=t[0].component,!t.data.cxPropSelected)},NO_NAME:t=>!t||!t.name,NO_ACTION:t=>!t||!t.action,SPECIAL_CHAR_ERROR:function(t){return this.checkSpecialChar(t.name)},NO_RELATED_LIST:function(t){return!(!t||"related_list"!==t.position)&&!(t.details&&t.details.related_list&&(t.details.related_list.id||t.details.related_list.api_name))},NO_LAYOUT:function(t){return!(-1!==this.listViewPositionsList.indexOf(t.position)||t.layouts&&t.layouts.length)},NO_URL:function(t){return!("url"!==t.action||t.details.url&&t.details.url.url_expression)},NO_WEB_TAB:function(t){return!("web_tab"!==t.action||t.details.web_tab&&t.details.web_tab.id)},MAX_URL_LENGTH_EXCEEDED:function(t){return"url"===t.action&&t.details.url.url_expression.length>3e3||"web_tab"===t.action&&t.details.web_tab.url_expression&&t.details.web_tab.url_expression.length>3e3},NO_ENCODE_FORMAT:function(t){return t&&"url"===t.action?!(t.details&&t.details.url&&t.details.url.encode_format):!(!t||"web_tab"!==t.action)&&!(t.details&&t.details.web_tab&&t.details.web_tab.encode_format)},NO_URL_DISPLAY_IN:function(t){return!(!t||"url"!==t.action)&&!(t.details&&t.details.url&&t.details.url.display_in)},NO_DEVICE_PERMISSION:function(t){return!(!t||"custom_function"!==t.action)&&!(t.details&&t.details.custom_function&&void 0!==t.details.custom_function.device_permissions)},NO_CUSTOM_FUNCTION_ID:function(t){return!(!t||"custom_function"!==t.action)&&!(t.details&&t.details.custom_function&&t.details.custom_function.id)},NO_CUSTOM_FUNCTION_LANGUAGE:function(t){return!(!t||"custom_function"!==t.action)&&!(t.details&&t.details.custom_function&&t.details.custom_function.language)},NO_WIDGET_ID:function(t){return!(!t||"widget"!==t.action)&&!(t.details&&t.details.widget&&t.details.widget.id)},NO_CIRCUIT_ID:function(t){return!(!t||"circuit"!==t.action)&&!(t.details&&t.details.circuit&&t.details.circuit.id)},NO_BUTTON_POSITION:t=>!t.position},errorResponseMap:{NO_PERMISSION:"crm.tryagain.message",INTERNAL_SERVER_ERROR:"crm.label.widgets.error.internal",NO_NAME:"crm.custombutton.JSAlert.NameRequired",SPECIAL_CHAR_ERROR:"crm.custombutton.JSAlert.NoSplCharsInName",NO_BUTTON_POSITION:"crm.orchestration.error.selectvalue",NO_RELATED_LIST:"crm.orchestration.error.selectvalue",NO_ACTION:"crm.orchestration.error.selectvalue",BUTTON_NAME_DUPLICATE:"crm.custombutton.name.duplicate",WIZARD_BUTTON_IS_ASSOCIATED:"crm.custombutton.wizard.association",LIMIT_EXCEEDED:"crm.custombutton.limit.exceeded",NO_URL:"crm.custombutton.JSAlert.enterURL",NO_WEB_TAB:"crm.custombutton.invalid.weburl.check",URL_VALIDATION_ERROR:"crm.custombutton.url.unsupported.merge.field",MAX_URL_LENGTH_EXCEEDED:"maxlenmsg",NO_LAYOUT:"crm.custombutton.label.select.one",NO_ACTION:"crm.select.info.label",NO_PLACE:"crm.select.info.label",NO_ENCODE_FORMAT:"crm.orchestration.error.selectvalue",NO_URL_DISPLAY_IN:"crm.orchestration.error.selectvalue",NO_CUSTOM_FUNCTION_ID:"Mandatory Field Not Found",NO_CUSTOM_FUNCTION_LANGUAGE:"Mandatory Field Not Found",NO_WIDIGET_ID:"Mandatory Field Not Found",NO_CIRCUIT_ID:"Mandatory Field Not Found"},validateCustomButton:function(t,e){let o=this.validationMap;e&&e.length&&Object.keys(o).forEach((t=>{e.includes(t)||delete o[t]}));let n=!0;const s=this.elementVsValidationMap;for(const e in s){let i=s[e];for(const s of i)o[s]&&o[s].call(this,t)&&(this.setData("showDisableButton",!0),this.showValidationErrorMessage(s,{element:e}),n=!1)}return n},showValidationErrorMessage:function(t,e){let o=this.errorResponseMap[t];if(e&&e.element){const n=this.elementVsSelector[e.element];if(o=this.getErrorMessage(t,e.element),n){$L(n).html(o);const t=$L(n).parent(),e=":first-child",s=t?t.children(e):void 0;s&&s.focus()}else this.showErrorMsg(o)}else this.showErrorMsg(o)},getErrorMessage:function(t,e){let o,n=this.errorResponseMap[t];return e&&(o=["layout","userType","profile","action","place"].includes(e)?I18n.getMsg(n,e):I18n.getMsg(n)),"MAX_URL_LENGTH_EXCEEDED"===t&&(o=I18n.getMsg(n,3e3)),o},errorMessageObserveHandler:function(){const t=this.elementVsPropertyName,e=this.elementVsSelector;for(const o in t){let n=$L(".btnCreateValidateErrMsg"+e[o]),s=t[o],i=!1;if(1===s.length){let e=this.data[t[o][0]];(Array.isArray(e)&&e.length||e)&&(i=!0)}else for(const t of s)this.data[t]&&(i=!0);i&&n.length&&n.html()&&n.html("")}},getRelatedListModuleNameById:function(t){let e;if(t){let o=store.peekAll("related_list").find((e=>e.id===t));o&&(e=o.connectedmodule?moduleApiMapping[o.connectedmodule]:o.module.api_name)}let o=Object.values(moduleRecordMapping).find((t=>t.api_name===e));return o&&o.module_name||e},getModuleNameByApiName:function(t){return moduleDetailedInfo.modules.find((e=>e.api_name===t)).module_name},removeFuncPopUps:function(){["crm-button-cf-configure","crm-button-cf-full-details","crm-existing-function-list-popup"].forEach((t=>this.removeCompNode(t)),this)},checkSpecialChar:t=>[...t].some((t=>"`~!#^*[]{}|\";'&+%()@?:<>:$=/".includes(t))),showButtonListViewPage:function(t){const e=Object.values(moduleRecordMapping).find((e=>e.api_name===t));Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.modules.module.custom-button",e?e.module_name:t)},removeCompNode:function(t){if(t&&t.constructor===String){let e=$L(t)[0];e&&e.component.$node.remove()}else this.$node.remove()},showMsg:function(t,e,o){const n=o?e:I18n.getMsg(e),s=["error","success","info","warning"].includes(t)?t:"info";_cruxUtils.showCustomMessage({params:{ltPropType:s,ltPropMessage:n}})},showErrorMsg:function(t){this.showMsg("error",t,!1)},showSuccessMsg:function(t,e){this.showMsg("success",t,e)},resetData:function(t){t&&t.constructor===Array?t.forEach((t=>this.resetDataMap[t].apply(this))):this.resetDataMap[t].apply(this)},makeRequest(t,e,o,n){o||(o=this.errorHandling.bind(this)),commonUtils.showHideLoadingDiv(!0),(t instanceof Array?Lyte.resolvePromises(t):t).then(e&&e.bind(this)).catch(o).finally((function(){n&&n.call(this),commonUtils.showHideLoadingDiv(!1)}))},saveCustomButtonDeluge:function(t,e,o,n,s,i,a,r,l,c,u){var d=customFunctionsObj.language,m=r||null;t=t||$("#templateName").val(),$("#btnLanguage").val(d);var p=$(".saveCloseActionBtn");p.addClass("inActiveSec");let h={};if(h.name=t,h.description=m,h.id=i,h.language=d,h.script=a,h.commit_message=u,"gallery"!==l){const i=function(t){if("deluge"===h.language&&400===t.status){try{t=t.response?JSON.parse(t.response):JSON.parse(t)}catch(e){t=t.response?t.response:t}var e=t.details.errorMessage;if(t.details.lineNumber&&(e=e+" Line Number:"+t.details.lineNumber),customFunctionsObj.delugeEditor.v2&&"deluge"===customFunctionsObj.language)return void c({message:e,errorMessage:e,lineNumber:t.details&&t.details.lineNumber||3});var o=$(".clickSave"),n=$("crm-function-editor")[0];return n.component.setData("error",""),n.component.setData("output",""),n.component.setData("info",""),o.removeClass("inActiveSec"),$(".functionoutputCont").addClass("hide"),$(".cusFunctOutputCont").hasClass("openCusFunctOutputCont")||$(".ouputToggleHook").click(),$(".errorSaveTagClass").removeClass("hide"),$(".successTagClass").addClass("hide"),n.component.setData("error",e),renderingUtils.removeFreezeLayer(),!1}},a=function(){$(".clickSave").addClass("inActiveSec"),$(".functionBtn").removeClass("inActiveSec"),p.removeClass("inActiveSec"),$("#customizeModuleDiv").css("display","block"),customFunctionsObj.removeEditor(),$("#tabLayer").css("display","block"),ZohoDRE.resetRequestData(),crmui.hidePopup("newRelatedListPopUpDiv");var i=$("#customFunctionNameDisp");i.text(t),i.removeClass("hide"),$("#editCustomFunction,#remoteCustomFunction").removeClass("hide"),$("#buttonActionSelect,#undoCustomFunctionChange").addClass("hide"),Events.isLinksModified=!1,$("#newRelatedListPopUpDiv").empty(),Lyte.registeredMixins["crm-custom-button-mixin"].saveFunctionInfo({id:h.id,display_name:h.name,addlParamNames:e,addlParamValues:o,entityParamNames:n,entityParamValues:s,language:d})};Lyte.registeredMixins["crm-custom-button-mixin"].saveFunctionScript(h,a,i)}else renderingUtils.removeFreezeLayer(),Lyte.registeredMixins["crm-custom-button-mixin"].saveFunctionInfo({id:h.id,display_name:h.name,addlParamNames:e,addlParamValues:o,entityParamNames:n,entityParamValues:s,language:d})},setParamsData:function(){var t=$L("#confparamTab");if(t.length>0){for(var e=[],o=[],n=[],s=t.find(".confParamRow").length,i=1;i<=s;i++){var a=$L("#confparamValTD_"+i),r=$L("#confparamName_"+i),l=$L("#confparamValue_"+i),c=l.attr("type"),u=a.attr("datatype"),d=r[0].innerHTML;if("entity"===c){var m=l.find(".mergespan").attr("value");if(""===(m=m.split("&&&")[0]))return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.customRL.JSAlert.enterParamValue.new")}}),l.focus(),!1;(h={}).name=d,h.value=m,e.push(h)}else{var p,h;if(""===(p=l[0].attributes.hasOwnProperty("placeholder")&&"true"===l[0].attributes.getNamedItem("placeholder").value?"":l[0].textContent))return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.customRL.JSAlert.enterParamValue.new")}}),l.focus(),!1;(h={}).name=d,h.value=p,o.push(h)}var f={};f.paramName=d,f.paramType=u,n.push(f)}var _=ZohoDRE.getFunctionParameter(n);ZohoDRE.requestData.functionParameters=_,ZohoDRE.requestData.dreEntityParam=e,ZohoDRE.requestData.dreOtherParamValues=o}return!0},getParamsAndSaveScript:function(t,e){if(customFunctionsObj.language="gallery"===e?"deluge":t.language,customFunctionsObj.currWorkflowLinkId=t.id,customFunctionsObj.listrelationid=void 0,ZohoDRE.resetRequestData(),ZohoDRE.requestData.dreFunctionName=t.display_name,!this.setParamsData())return!1;"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1),customFunctionsObj.isDuplicateCall=!1;var o=ZohoDRE.getFunctionEntityCustomParams(),n=o.entityParamNames,s=o.entityParamVals,i=o.otherParamNames,a=o.otherParamVals;return this.saveCustomButtonDeluge(t.display_name,i,a,n,s,t.id,t.script,t.description,e),!0},setComponentsParamsData:function(){var t=$L("#confparamTab");if(t.length>0){for(var e=[],o=[],n=[],s=t.find(".confParamRow").length,i=1;i<=s;i++){var a=$L("#confparamValTD_"+i),r=$L("#confparamName_"+i),l=$L("#confparamValue_"+i),c=l.attr("type"),u=a.attr("datatype"),d=r[0].innerHTML;if("entity"===c){var m=l.find(".mergespan").attr("value");if(""===(m=m.split("&&&")[0]))return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.customRL.JSAlert.enterParamValue.new")}}),l.focus(),!1;(h={}).name=d,h.value=m,e.push(h)}else{var p,h;if(""===(p=l[0].attributes.hasOwnProperty("placeholder")&&"true"===l[0].attributes.getNamedItem("placeholder").value?"":l[0].textContent))return _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.customRL.JSAlert.enterParamValue.new")}}),l.focus(),!1;(h={}).name=d,h.value=p,o.push(h)}var f={};f.paramName=d,f.paramType=u,n.push(f)}return{argumentsMap:n,entityparams:e,customparams:o}}},parameterFormatter:function(t,e){if(!t)return!0;for(var o=t.entityparams,n=t.customparams,s=o?o.length:0,i=n?n.length:0,a="",r="",l="",c="",u=0;u<s;u++){var d=(p=o[u]).name,m=p.value;if(e&&""===m)return ZohoDRE.editArguments(!!customFunctionsObj.isFrom&&"button"===customFunctionsObj.isFrom),!1;a=""===a?d:a+","+d,r=""===r?m:r+","+m}for(u=0;u<i;u++){var p;d=(p=n[u]).name,m=p.value;if(e&&""===m)return ZohoDRE.editArguments(!!customFunctionsObj.isFrom&&"button"===customFunctionsObj.isFrom),!1;l=""===l?d:l+","+d,c=""===c?m:c+","+m}if(e){var h=$("#functionArguments").text();if(""===a&&""===r&&""===l&&""===c&&"salessignals"!==customFunctionsObj.isFrom&&"functions"!==customFunctionsObj.isFrom&&"()"!==h)return ZohoDRE.editArguments(!!customFunctionsObj.isFrom&&"button"===customFunctionsObj.isFrom),!1}var f={};return f.entityParamNames=a,f.entityParamVals=r,f.otherParamNames=l,f.otherParamVals=c,f},getComponentsParamsAndSaveScript:function(t){let e=t.arguments&&this.setComponentsParamsData();if(t.arguments&&!e)return!1;"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1);let o=this.parameterFormatter(e),n=null;return"object"==typeof o&&(n={addlParamNames:o.otherParamNames,addlParamValues:o.otherParamVals,entityParamNames:o.entityParamNames,entityParamValues:o.entityParamVals}),this.saveComponentInfo({id:t.id,display_name:t.name,...n}),!0},listCustomFunctionsByLazyLoading:function(t,e,o,n,s){const i={type:o,start:0,limit:200,language:e,functionType:"crm",deployed:!0,category:t};let a=store.findAll("function",i),r=(i=>{let a={from:n,language:e,category:t,type:o,functions:i,fetchLimit:200};const r=networkUtils.returnDependencyFiles(["crm-existing-function-list-popup.js"],ResourceConstants.CRMClient);Lyte.injectResources(r,void 0,s(a))}).bind(this);this.makeRequest(a,r,(function(t){"UNCONFIRMED_EMAIL"===t.code&&_cruxUtils.showCustomMessage({params:{ltPropType:customFunctionsObj.ERROR,ltPropMessage:customFunctionsObj.errorCode.UNCONFIRMED_EMAIL.message}})}))},createNewFunction:function(){Crm.trackSpotLightAction("Custom Function Created",{Place:"Custom Button"}),customFunctionsObj.constructCFBodyDiv(),$("#createfunctionpopdiv").html(""),Lyte.Component.render("crm-createfunction-pop",{formdata:{name:"",description:"",category:"cf_select",language:"deluge",type:"editor"},disableNextBtn:!1,from:"button"},"#createfunctionpopdiv"),$L("#createNewFunction")[0].ltProp("show",!0)},isAssociateNeeded:function(t){if("button"===t)return!0},showSandboxDifference:function(t,e){const o=t=>"string"==typeof t?"string":"boolean"==typeof t?"boolean":"object"==typeof t?"object":Array.isArray(t)?"array":"unknown",n="#sandboxObj_sandboxChanges";let s=$L("#parentObj_sandboxChanges crm-custom-button-common")[0];s&&(s=s.component.data);const i=$L(n+" crm-custom-button-common")[0].component.data,a=t=>$L(n+" "+t).addClass("btn_sb_modified"),r={name:(t,e)=>{o(t.name)===o(e.name)&&t.name===e.name||a("#btn_name_txt lyte-input input")},description:(t,e)=>{o(t.description)===o(e.description)&&t.description===e.description||a("#btn_desc_txt lyte-input textarea")},layouts:(t,e)=>{const n="#btn_layout_dd div";if(o(t.layouts)!==o(e.layouts))return void a(n);const s=(t.layouts&&t.layouts.length||0)===(e.layouts&&e.layouts.length||0),i=e.layouts&&e.layouts.length&&e.layouts.map((t=>t.name))||[],r=s&&t.layouts&&t.layouts.length&&t.layouts.every((t=>i.includes(t.name)));s&&r||a(n)},profiles:(t,e)=>{const n="#btn_profile_dd div";if(o(t.profiles)!==o(e.profiles))return void a(n);const s=(t.profiles&&t.profiles.length||0)===(e.profiles&&e.profiles.length||0),i=e.profiles&&e.profiles.length&&e.profiles.map((t=>t.name))||[],r=s&&t.profiles&&t.profiles.length&&t.profiles.every((t=>i.includes(t.name)));s&&r||a(n)},position:(t,e)=>{const o=s.selectedPlace,n=i.selectedPlace,r=o===n;r||a("#btn_place_dd div");const l="#btn_related_list_position_dd div";if(r&&"related_list"===o){const t=s.relatedLists&&s.relatedLists.find((t=>s.selectedRelatedListId===t.id)),e=t&&t.display_label||"",o=i.relatedLists&&i.relatedLists.find((t=>i.selectedRelatedListId===t.id));e===(o&&o.display_label||"")||a(l)}else"related_list"===n&&a(l);if(t.position!==e.position){["#btn_list_view_position_dd div","#btn_record_position_dd div"].forEach((t=>a(t)))}},action:(t,e)=>{const o=t.action===e.action;o||"url"!==e.action&&"web_tab"!==e.action?o||a("#btn_action_name"):a("#btn_action_dd lyte-drop-button");const n={url:()=>{const o=e.details.url,n=t.details&&t.details.url||{},s=o.url_expression&&n.url_expression&&n.url_expression===o.url_expression,i=o.display_in&&n.display_in&&o.display_in===n.display_in,r=o.encode_format&&n.display_in&&o.encode_format===n.encode_format;if(!s){a("crm-custom-button-url #expression lyte-input textarea")}if(!i){a("#btn_action_display_type_dd div")}if(!r){a("#btn_url_encode_format_dd div")}},web_tab:()=>{const o=e.details.web_tab,n=t.details&&t.details.web_tab||{},s=o.name&&n.name&&o.name===n.name,i=o.encode_format&&n.encode_format&&o.encode_format===n.encode_format,r=o.url_expression&&n.url_expression&&o.url_expression===n.url_expression;if(!s){a("#btn_web_tab_dd lyte-drop-button")}if(!r){a("crm-custom-button-url #expression")}if(!i){a("#btn_url_encode_format_dd div")}},widget:()=>{const o=e.details.widget,n=t.details&&t.details.widget||{};if(!(o.name&&n.name&&n.name===o.name)){a("#btn_action_name")}},custom_function:()=>{const o=e.details,n=t.details&&t.details.custom_function||{},s=o.name&&n.name&&n.name===o.name,i=o.device_permissions&&n.device_permissions&&n.device_permissions.location&&n.device_permissions.location===o.device_permissions.location;if(!s){a("#btn_action_name")}if(!i){a("#btn_cf_location lyte-checkbox label")}},circuit:()=>{const o=e.details,n=t.details&&t.details.circuit||{};if(!(o.name&&n.name&&n.name===o.name)){a("#btn_action_name")}}},s=e.action;n[s]&&n[s].call(this)}};t&&e&&Object.keys(e).forEach((o=>r[o]&&r[o].call(this,t,e)))},viewSandboxDiffPage:function(t,e,o,n){const s=this,i=moduleApiMapping[n]||n;let a=networkUtils.returnDependencyFiles(["crm-custom-button-actions.js","crm-custom-button-helper.js","crm-custom-button-common.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["user_type.js","crm-client-portal-module.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM),c=networkUtils.returnDependencyFiles(["crm-custom-button-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom_button")],ResourceConstants.CRM);Lyte.injectResources(l.concat(a).concat(c).concat(r).concat(u),void 0,(function(){let a=t.getDominUrlDetails("button",o,n,!1),r=t.getDominUrlDetails("button",e,n,!0),l={isV6Api:!0};l.hostUrl=a,a.headers&&(l.headers=a.headers);const c=store.findRecord("custom_button",o,{module:i},!0,!0,l),u=function(t,e,o,n,s,i){let a={isV6Api:!0};a.hostUrl=t,t.headers&&(a.headers=t.headers);const r=store.findRecord("custom_button",e,{module:o},!0,!0,a);i.makeRequest(r,function(t){let i={layouts:[],profiles:[],customButton:t[0]},a=[];if("related_list"===i.customButton.position){const t=i.customButton.details.related_list;a.push({id:t.id,display_label:t.api_name})}Lyte.Component.render("crm-custom-button-common",{buttonComp:"sandboxDiffPage",moduleName:n,moduleApiName:o,buttonId:e,layouts:i.layouts,profiles:i.profiles,customButton:i.customButton,compSelector:"#sandboxObj_sandboxChanges",compOrg:"sandbox",relatedLists:a},"#sandboxObj_sandboxChanges"),s.showPopup("sandboxSeeDiffPop",!0)}.bind(i),void 0,function(){let t=$L("#parentObj_sandboxChanges crm-custom-button-common")[0];t&&(t=t.component.data.customButton);let e=$L("#sandboxObj_sandboxChanges crm-custom-button-common")[0];e&&(e=e.component.data.customButton),this.showSandboxDifference(t,e)}.bind(i))};s.makeRequest(c,function(a){const{layouts:l,profiles:c,customButton:d}={layouts:[],profiles:[],customButton:a[0]},m={compSelector:"#parentObj_sandboxChanges",buttonComp:"sandboxDiffPage",buttonId:o,moduleName:n,moduleApiName:i,layouts:l,profiles:c,customButton:d};Lyte.Component.render("crm-custom-button-common",m,"#parentObj_sandboxChanges"),u(r,e,i,n,t,s)}.bind(s),function(o){let a;try{a=o.response?JSON.parse(o.response):JSON.parse(o)}catch(t){a=o.response?o.response:o}if(a&&a.custom_buttons&&a.custom_buttons.length&&a.custom_buttons[0].message&&(a=a.custom_buttons[0]),"INVALID_DATA"===a.code&&a.details&&"id"===a.details.api_name||a.details&&2===a.details.resource_path_index){const t=sandbox.showDiffDeletedMessage("button");$("#parentObj_sandboxChanges").append(t)}u(r,e,i,n,t,s)}.bind(s))}))},renderCustomButtonPopUp:function(t){t.moduleApiName||(t.moduleApiName=moduleApiMapping[t.moduleName]);this.getCustomButtonCreateOrEditRequiredData(t,(function(t){t.renderComponent&&t.renderComponent(t),t.afterRender&&t.afterRender(t)}))},getCustomButtonCreateOrEditRequiredData:function(t,e){const o=this,n={moduleName:t.moduleName,moduleApiName:t.moduleApiName},s=["moduleAssociatedProfiles"];t.layouts||s.push("layouts"),t.profiles||s.push("profiles"),t.buttonId&&"edit"===t.buttonComp&&(s.push("customButtonRecord"),n.buttonId=t.buttonId);const i=this.customButtonModel.getModelData.call(this,s,n),a=function(t,e){return function(o){const n=this.resourcesVsSuccessCallback;t&&t.forEach((t=>{if(n[t]&&o[t]){const s=n[t];e[t]=s.call(this,o[t])}}))}}(s,t);Lyte.resolvePromises(i).then((function(n){a.call(o,n),t.profiles=o.filterModuleVisibleProfiles(t.profiles,t.moduleAssociatedProfiles),delete t.moduleAssociatedProfiles,s.includes("customButtonRecord")&&(t.customButton=t.customButtonRecord,delete t.customButtonRecord),e(t)})).catch((function(t){o.errorHandling(t)}))},getComponentResource:{commonResources:function(){var t=networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js","zohocrm_workflow.js"],ResourceConstants.CRM),e=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["crm-custom-button-actions.js","crm-custom-button-helper.js","crm-custom-button-common.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["user_type.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","custom-function-gallery.js","custom-function-credits.js","custom-function-editor.js","crm-function-components-wrapper.js","reviewprocess.js","crm-functions-helper.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-custom-button-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],ResourceConstants.CRMClient);return Crm.userDetails.RTL_ENABLED&&(l=l.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],ResourceConstants.CRMClient))),t.concat(e).concat(i).concat(a).concat(o).concat(e).concat(s).concat(l).concat(r).concat(n)},"crm-custom-button-create-popup":function(){var t=networkUtils.returnDependencyFiles(["crm-custom-button-create-popup.js"],ResourceConstants.CRMClient);return this.getComponentResource.commonResources().concat(t)}},modalSwitchingHelper:{modalStack:[],peek:function(){let t=this.modalStack.length;return t?this.modalStack[t-1]:void 0},size:function(){return this.modalStack&&this.modalStack.length||0},add:function(t){if(-1!==this.modalStack.indexOf(t)){let t=this.modalStack;for(;t.length;){let e=t.pop();$L(e).length&&$L(e)[0].component.$node.remove()}this.modalStack.length=0}this.modalStack.push(t)},clear:function(){this.modalStack.length=0},next:function(){if(this.modalStack.length<=1)return;const t=$L(this.modalStack[this.modalStack.length-2]);t.length&&t[0].ltProp("show",!1);const e=$L(this.modalStack[this.modalStack.length-1]);e.length&&e[0].ltProp("show",!0)},previous:function(){let t=this.modalStack.length;if(t){let e=this.modalStack.pop();if(t--,e&&$L(e).length&&$L(e)[0].ltProp("show",!1),t-1>=0){let e=this.modalStack[t-1];e&&$L(e).length&&$L(e)[0].ltProp("show",!0)}}}},saveWidgetInfo:function(t){const e={id:t.id,name:t.name,description:t.description};Lyte.triggerEvent("actionCreated",{action:"widget",widget:e})},saveComponentInfo:function(t){const e={id:t.id,name:t.display_name};if(t.addlParamValues&&(e.addlParams=[]),t.entityParamValues&&(e.entityParams=[]),t.addlParamNames&&t.addlParamValues){const o=t.addlParamNames.split(","),n=t.addlParamValues.split(",");if(o.length&&n.length&&o.length===n.length){const t=o.length;for(let s=0;s<t;s++)e.addlParams.push({name:o[s],value:n[s]})}}if(t.entityParamNames&&t.entityParamValues){const o=t.entityParamNames.split(","),n=t.entityParamValues.split(",");if(o.length&&n.length&&o.length===n.length){const t=o.length;for(let s=0;s<t;s++){const t=n[s].split(":");e.entityParams.push({name:o[s],api_name:t[0],id:t[1]&&parseInt(t[1])?t[1]:null,type:t[2]})}}}Lyte.triggerEvent("actionCreated",{action:"component",component:e})},saveWebTabInfo:function(t){const e={id:t.id,name:t.name,link:t.link};Lyte.triggerEvent("actionCreated",{action:"web_tab",web_tab:e})},saveFunctionInfo:function(t){const e=$L("crm-custom-button-comp");e.length&&"sandboxDiffPage"!==e[0].component.getData("buttonComp")&&(customFunctionsObj.isFrom="button");const o={id:t.id,name:t.display_name,addlParams:[],entityParams:[],language:t.language};if(t.addlParamNames&&t.addlParamValues){const e=t.addlParamNames.split(","),n=t.addlParamValues.split(",");if(e.length&&n.length&&e.length===n.length){const t=e.length;for(let s=0;s<t;s++)o.addlParams.push({name:e[s],value:n[s]})}}if(t.entityParamNames&&t.entityParamValues){const e=t.entityParamNames.split(","),n=t.entityParamValues.split(",");if(e.length&&n.length&&e.length===n.length){const t=e.length;for(let s=0;s<t;s++){const t=n[s].split(":");o.entityParams.push({name:e[s],api_name:t[0],id:t[1]&&parseInt(t[1])?t[1]:null,type:t[2]})}}}"deluge"!==t.language&&($L("#customizeModuleDiv").css("display","block"),$(".scartch-creation").removeClass("editorVisible").hide(),$L("#tabLayer").css("display","block"),$L(".nextGenUILeftMenu").css("display","block"),ZohoDRE.resetRequestData()),Lyte.triggerEvent("actionCreated",{action:"custom_function",custom_function:o})},saveCircuitInfo:function(t){const e={id:t.id,name:t.name};Lyte.triggerEvent("actionCreated",{action:"circuit",circuit:e})},saveProcessFlowInfo:function(t){const e={id:t.id,name:t.name};Lyte.triggerEvent("actionCreated",{action:"kiosk",kiosk:e})},checkRemovedLayoutAssocWithWizard:function(t,e){const o=this.getData("wizardAssocLayouts");if("all"===e){const t=store.peekAll("layout").filter((t=>"all"!==t.id));if(t.every((t=>o.includes(t.id))))return this.showErrorMsg(I18n.getMsg(this.literals.cannotChangeLayoutofWizardAssociatedButton)),!1;return!t.some((t=>o.includes(t.id)))||(this.showErrorMsg(I18n.getMsg(this.literals.cannotChangeLayoutofWizardAssociatedButton)),!0)}return!o.includes(e)||(this.showErrorMsg(I18n.getMsg(this.literals.cannotChangeLayoutofWizardAssociatedButton)),!1)}});
