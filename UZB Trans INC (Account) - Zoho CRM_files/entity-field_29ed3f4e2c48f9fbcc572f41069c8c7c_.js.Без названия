Lyte.Component.register("entity-field",{_template:'<template tag-name="entity-field"> <div class="oH entity_{{eid}}"> <template is="if" value="{{isLink}}"><template case="true"> <link-to class="cP entityElement" onmouseover="{{action(\'showBCardPop\',this)}}" onmouseout="{{action(\'hideBCardPop\',this)}}" id="eid{{moverBcard}}{{eid}}" data-zcqa="detailView" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{module}}&quot;,&quot;{{eid}}&quot;]" lt-prop-class="{{estyle}}" onclick="{{action(\'checkForPublicFields\',event,this)}}"> {{name}} </link-to> <template is="if" value="{{expHandlers(isNotEmpty(name),\'!\')}}"><template case="true"> <span class="callFormatLtr"></span> </template></template> </template><template case="false"><template is="if" value="{{openInNewTab}}"><template case="true"> <link-to class="cP entityElement" onmouseover="{{action(\'showBCardPop\',this)}}" onmouseout="{{action(\'hideBCardPop\',this)}}" id="eid{{moverBcard}}{{eid}}" data-zcqa="detailView" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{module}}&quot;,&quot;{{eid}}&quot;]" lt-prop-class="{{estyle}}" lt-prop-target="_blank" lt-prop-rel="noopener noreferrer" onclick="{{action(\'checkForPublicFields\',event,this)}}"> {{name}} </link-to> </template><template case="false"><template is="if" value="{{expHandlers(isNotEmpty(name),\'!\')}}"><template case="true"> <span class="callFormatLtr"></span> </template><template case="false"> <span class="pL0 cP entityElement dIB vaM fL {{estyle}} dvFlnone crm-font-medium" id="eid{{moverBcard}}{{eid}}"> {{name}} </span> </template></template></template></template></template></template> <template is="if" value="{{showModule}}"><template case="true"> <span class="crm-small-font-size p3 pL10 pR10 mL5 mT10 ellipsistext wsNowrap dIB vaM dvmT0 dvmL5 lh16 tagCont crm-font-regular" style="max-width:80px;" title="{{getSingularLabel(module)}}">{{getSingularLabel(module)}}</span> </template></template> </div> <template is="if" value="{{moverBcard}}"><template case="true"> <lyte-popover lt-prop-origin-elem="#eid{{moverBcard}}{{eid}}" class="bCardPop" lt-prop-duration="0" lt-prop-type="callout" lt-prop-placement="{{bcardPlacement}}" lt-prop-freeze="false" lt-prop-wrapper-class="profile-wrapper" lt-prop-show-close-button="false" lt-prop-width="400px" lt-prop-close-on-body-click="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content onmouseleave="{{action(\'hideBCardPop\',this)}}"> <div class="bCardPopTemp{{eid}}"></div> </lyte-popover-content> </template> </lyte-popover> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["module","name","eid","isLink","openInNewTab","showModule","moverBcard","bcardPlacement","getBCard","estyle","highlightedText"],data:function(){return{module:Lyte.attr("string"),name:Lyte.attr("string"),eid:Lyte.attr("string"),isLink:Lyte.attr("boolean"),openInNewTab:Lyte.attr("boolean",{default:!1}),showModule:Lyte.attr("boolean",{default:!1}),moverBcard:Lyte.attr("boolean",{default:!1}),bcardPlacement:Lyte.attr("string",{default:"right"}),getBCard:Lyte.attr("boolean",{default:!1}),estyle:Lyte.attr("string"),highlightedText:Lyte.attr("string")}},actions:{showBCardPop:function(){this.getData().moverBcard&&(this.actions.hideBCardPop.call(this),setTimeout(function(){var t=this.$node.querySelector("link-to");if($L(t).is(":hover")){var e=this.$node.querySelector(".bCardPop");e&&e.ltProp("show",!0),!this.getData().getBCard&&this.getEntityBCardDetails()}}.bind(this),250))},hideBCardPop:function(){this.getData().moverBcard&&setTimeout(function(){var t=this.$node.querySelector("link-to"),e=".bCardPopTemp"+this.getData("eid");if(!$L(t).is(":hover")&&!$L(e).parent().is(":hover")){var a=this.$node.querySelector(".bCardPop");a&&a.ltProp("show",!1)}}.bind(this),300)},checkForPublicFields:async function(t,e){var a=JSON.parse(e.getAttribute("lt-prop-dp"));if(await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(a[0],a[1],t))return!1}},getEntityBCardDetails:function(){var t=".bCardPopTemp"+this.getData("eid"),e=void 0===this.getData().highlightedText||isCallerInfoDisabled?this.getData().name:this.getData().name+" ( "+this.getData().highlightedText+" )";Lyte.Component.render("static-businesscard",{module:this.getData("module"),entityId:this.getData().eid,headerName:e,highlightedText:this.getData().highlightedText},t),this.bindScrollListener(),this.setData("getBCard",!0)},bindScrollListener:function(){window.addEventListener("scroll",(function(){for(var t=document.querySelectorAll(".bCardPop"),e=t.length,a=0;a<e;a++){var i=t[a];i&&i.ltProp("show")&&i.ltProp("show",!1)}}),!0)}}),Lyte.Component.register("static-businesscard",{_template:'<template tag-name="static-businesscard"> <div class="oH"> <template is="if" value="{{photoFileId}}"><template case="true"> <img class="userlistphoto w40 mR10" src="{{getCrmBasePath()}}/EntityImageAttach.do?action_module={{module}}&amp;entityId={{entityId}}&amp;actionName=readImage&amp;fileId={{photoFileId}}"> </template></template> <div class="fL w270 oH"> <link-to class="mT5 dIB fL" lt-prop-route="crm.tab.module.entity" lt-prop-dp="[&quot;{{module}}&quot;,&quot;{{entityId}}&quot;]" onclick="{{action(\'checkForPublicFields\',event,this)}}">{{headerName}}</link-to> <span class="crm-small-font-size f12 p3 pL10 pR10 fL mT3 mL5 tagCont">{{getSingularLabel(module)}}</span> <template is="if" value="{{subheaderName}}"><template case="true"> <div class="mT5 cBoth">{{subheaderName}}</div> </template></template> </div> </div> <lyte-table class="callsRewamp_dv noBorderTable" lt-prop-yield="true"> <template is="registerYield" yield-name="yield"> <lyte-table-structure class="pT10"> <lyte-tbody> <template is="for" items="{{bcfieldsArray}}" item="item" index="index"> <lyte-tr> <lyte-td class="crmNotFoundColor pT10 wwBreakWord wbBreakAll vaT ">{{item.fieldObj.displaylabel}}</lyte-td> <lyte-td class="pT10 pL10 wwBreakWord wbBreakAll vaT uiType{{item.fieldObj.uitype}}"><span class="crm-font-regular">{{uiTypeTemplate(item.fieldObj)}}</span></lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"text",position:[1,3,1,0]},{type:"componentDynamic",position:[1,3,1]},{type:"text",position:[1,3,3,0]},{type:"attr",position:[1,3,5]},{type:"if",position:[1,3,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0,0]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["headerName","subheaderName","module","entityId","photoFileId","bcfieldsArray","highlightedText"],init:function(){store.findRecord("businesscard",this.getData("entityId"),{module:moduleRecordMapping[this.getData("module")].api_name}).then(function(t){var e=[],a=t.fields;if(t.data){for(var i=t.data[0],o=a.length,l=0,s=["Leads","Contacts","Accounts","Potentials","Deals"],n=0;n<o;n++){var p=a[n],r=i[p.api_name];if(p.uitype=p.ui_type,p.displaylabel=p.field_label,p.colname=p.column_name,p.forBC=!0,p.defaultvalue=r,p.displayValue=r,26===p.uitype&&"STAGE"===p.colname&&(p.plainValue=r),"SMOWNERID"===p.colname&&(p.isReportingToFlow=!0),null!==r&&"object"==typeof r&&(p.defaultid=r.id,p.defaultvalue=r.name,p.displayValue=r.name),null!==r&&r.constructor==Array){var d=r.length;p.defaultvalue="",p.displayValue="";for(var m=0;m<d;m++)p.defaultvalue=p.defaultvalue+r[m]+(m!=d-1?";":""),p.displayValue=p.displayValue+r[m]+(m!=d-1?";":"")}void 0!==p.lookup.module&&void 0!==p.lookup.module.api_name&&(p.lookupmodule=p.lookup.module.api_name),p.fromss=!0,"PHOTO_FILEID"==p.colname?(this.setData("photoFileId",p.displayValue),l+=1):n===l?validationUtils.isEmpty(this.getData("headerName"))&&this.setData("headerName",p.displayValue):n===l+1&&-1!=s.indexOf(this.getData("module"))?this.setData("subheaderName",p.displayValue):e.push({fieldObj:p,forBC:!0,module:this.getData("module")})}this.setData("bcfieldsArray",e);var c=this.getData().highlightedText;if(validationUtils.isNotEmpty(c)&&!isCallerInfoDisabled){var u=c.trim().replace(/[^0-9]/g,""),y=this.$node.querySelectorAll(".uiType33"),h=y.length;for(n=0;n<h;n++){var f=$(y[n]).text().trim().replace(/[^0-9]/g,"");validationUtils.isNotEmpty(f)&&f.search(u)>=0&&y[n].querySelector("span").classList.add("highlight-phn")}}}}.bind(this))},data:function(){return{headerName:Lyte.attr("string"),subheaderName:Lyte.attr("string"),module:Lyte.attr("string"),entityId:Lyte.attr("string"),photoFileId:Lyte.attr("string"),bcfieldsArray:Lyte.attr("array"),highlightedText:Lyte.attr("string")}},actions:{checkForPublicFields:async function(t,e){var a=JSON.parse(e.getAttribute("lt-prop-dp"));if(await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(a[0],a[1],t))return!1}}});
