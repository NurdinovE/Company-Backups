var PBClient={fingerPrintJson:"",checkSumJson:"",jsurl:"",imgurl:"",cssurl:"",isIntegrityEnabled:!1};PBClient.con=console,PBClient.log=PBClient.con.log,PBClient.isCdn=function(){return!(!PBClient.jsurl.includes("cdn")&&!PBClient.jsurl.includes("js-stratus"))},PBClient.getFingerPrintFile=function(e){return PBClient.isCdn()?JSON.parse(PBClient.fingerPrintJson)[e]:e},PBClient.getDomain=function(e){let t="";return t=PBClient.isCdn()?PBClient.jsurl.substring(0,PBClient.jsurl.lastIndexOf("/")):e.includes(".js")?PBClient.jsurl:e.includes(".css")?PBClient.cssurl:PBClient.imgurl,t},PBClient.getFingerPrintUsingFileName=function(e){return PBClient.isCdn()?PBClient.log("FileName is "+e+" => "+JSON.parse(PBClient.fingerPrintJson)[e]):PBClient.log("FileName is "+e),PBClient.getDomain(e)+"/"+(PBClient.isCdn()?JSON.parse(PBClient.fingerPrintJson)[e]:e)},PBClient.getCheckSumUsingFileName=function(e){return"sha384-"+JSON.parse(PBClient.checkSumJson)[e]},PBClient.getFingerprintAndCSForFileName=function(e){var t={};return t.cdnurl=PBClient.getFingerPrintUsingFileName(e),PBClient.isIntegrityEnabled&&(t.integrity=PBClient.getCheckSumUsingFileName(e)),t};var ClientFrame=function(){function e(e,t,i){this.frameSelector=e,this.domain=t,this.source=t+i,this.frameId="client-frame-"+e+"_"+Date.now(),this.isRendered=!1,this.callBackFrame=void 0,this._listeners=[]}function t(t,i){t instanceof e&&t.sendMessage(i)}return e.prototype.generateFrame=function(e,t){if(this.$iframeElement)return this.$iframeElement;this.$iframeElement=document.createElement("iframe"),this.$iframeElement.setAttribute("src",this.source),this.$iframeElement.setAttribute("id",this.frameSelector),this.$iframeElement.setAttribute("name",this.frameSelector),Object.assign(this.$iframeElement.style,e);var i=this;return this.$iframeElement.onload=function(){i.isRendered=!0,i.sendMessage({action:"client-frame",data:{status:"loaded",frameId:i.frameId}}),t&&t()},this.$iframeElement},e.prototype.render=function(e,t,i){this.isRendered||(this.generateFrame(t,i),e.appendChild(this.$iframeElement))},e.prototype.sendMessage=function(e){if(!this.isRendered)throw new Error("ClientFrame not rendered");this.$iframeElement.contentWindow.postMessage(e,this.domain)},e.prototype.listenMessage=function(e){this.listenerAdded||(window.addEventListener("message",(e=>{var i=e.data;if(i.frameId===this.frameId)switch(i.action){case"client-frame-render":!function(e,i){e.getRendererFrame((function(e){e.showFrame(),t(e,i)}))}(this,i);break;case"client-renderer-callback":!function(e,i){i.meta.showFrame||e.hideFrame(),t(e.callBackFrame,i)}(this,i);break;default:this._listeners.length>0&&this._listeners.forEach((function(t){try{t(i,e)}catch(e){Lyte.error(e)}}))}})),this.listenerAdded=!0),"function"==typeof e&&this._listeners.push(e)},e.prototype.showFrame=function(){this.$iframeElement&&(this.$iframeElement.style.display="block")},e.prototype.hideFrame=function(){this.$iframeElement&&(this.$iframeElement.style.display="none")},e.prototype.deleteFrame=function(){this.$iframeElement&&this.$iframeElement.parentNode.removeChild(this.$iframeElement)},e.prototype.setRendererFrameProvider=function(e){this.rendererFrameProvider=e},e.prototype.getRendererFrame=function(e){var t=this;if("function"==typeof t.rendererFrameProvider)return t.rendererFrameProvider().then((function(i){i.callBackFrame=t,e(i)}))},e}(),PB=PB||{};function initPBSDK(){return new Promise((function(e){var t=document.createElement("script"),i=PBClient.getFingerprintAndCSForFileName("pbone.js");t.src=i.cdnurl,PBClient.isIntegrityEnabled&&(t.integrity=i.integrity),t.crossOrigin="anonymous",document.head.appendChild(t),t.onload=function(){ZPB.initPlatform(PB.serviceData),e()}}))}function attachZTIListner(){window.ZTI&&(ZTI.handleCrossProductMessage=function(e){var t="test".constructor;if(e.constructor===t&&(e=JSON.parse(e)),e.action&&"reloadSDK"===e.action){var i=PB.serviceData.loadPB||!0;PB.pbxhr=new XMLHttpRequest,PB.serviceData.bundleOrgId&&PB.serviceData.bundleService?PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&bundleOrgId="+PB.serviceData.bundleOrgId+"&bundleService="+PB.serviceData.bundleService+"&loadPB="+i,!0):PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&loadPB="+i,!0),e.zaid&&"null"!==e.zaid&&PB.pbxhr.setRequestHeader("X-ZAID",e.zaid),e.zaaid&&"null"!==e.zaaid&&PB.pbxhr.setRequestHeader("X-PB-ZAAID",e.zaaid),PB.accesstoken&&PB.pbxhr.setRequestHeader("Authorization","Zoho-oauthtoken "+PB.accesstoken),PB.pbxhr.withCredentials=!0,PB.pbxhr.onreadystatechange=function(){if(this.readyState===this.DONE){var e,t=JSON.parse(PB.pbxhr.response);if(e=t.integResponse,PBClient.fingerPrintJson=t.parentFing,PBClient.log("Parent fing Loaded"),"true"===e||"syncuser"==e||"D_ORG"===e||"O_ORG"===e){PB.integEnabled="syncuser"!==e,PB.integRest=e;var i=document.getElementById("zpbsdk");null!=PB.serviceData.doNotDisturb&&!PB.serviceData.doNotDisturb&&i?i.src=i.src:initPBSDK()}else PB.integRest="false","SDPOnDemand"===PB.serviceData.serviceName&&window.callbackZPB&&callbackZPB()}},PB.pbxhr.send(null)}else if(e.hasOwnProperty("CTDConfiguration"))for(var n=document.getElementsByTagName("zpb-phone"),r=0;r<n.length;r++)e.CTDConfiguration?n[r].component.setData("isCTD",!0):n[r].component.setData("isCTD",!1);e.subAction&&"alterModify"===e.subAction&&ZPB.sendMessage("zpbsetup",{action:"alterModify",providerID:e.providerID})})}function registerCustomTag(){Lyte.Component.register("zpb-phone",{_template:'<template tag-name="zpb-phone"><a class="pH2" lt-prop-title="Call" onclick="{{action(\'telcall\',event,number)}}"></a>\t</template>\n<style>.telIcon{ display: inline-block; width: 16px;height: 19px;background: transparent url('+PB.cdnUrl+"images/svgicons.svg) no-repeat -160px -471px;margin-right: 6px;cursor: pointer;}</style>",_dynamicNodes:[{type:"attr",position:[0]}],_observedAttributes:["number","lyteUnbound"],data:function(){return{number:Lyte.attr("string"),lyteUnbound:Lyte.attr("boolean",{default:!1})}},actions:{telcall:function(e,t){e.stopPropagation(),window.location.href="tel:"+t}}})}PB.parts=location.hostname.split("."),PB.subdomain=PB.parts.shift(),PB.uplvldom=PB.parts.join("."),PB.server=PB.uplvldom.includes("tsi")?"https://phonebridge.csez.zohocorpin.com":"https://phonebridge."+PB.uplvldom,PB.serviceData=void 0,PB.jsurl="",PB.integEnabled=!1,PB.defaultOrgIntegEnabled=!1,PB.target="splitscreen",PB.integRest="false",PB.tagNeededProducts=["ZohoCRM","ZohoRecruit","Solution","VCRM"],PB.cdnUrl="",PB.loadPromise=void 0,PB.verticalProducts=["VCRM"],PB.isVerticalService=!1,PB.accesstoken="",PB.zuid="",PB.darkmode=!1,PB.init=function(e){PB.isVerticalService=PB.verticalProducts.includes(e.serviceName),e.access_token&&(PB.accesstoken=e.access_token),e.darkmode&&(PB.darkmode=e.darkmode),PB.cdnUrl=PB.jsurl.substring(0,PB.jsurl.lastIndexOf("/"))+"/",PBClient.jsurl=PB.jsurl,PBClient.imgurl=PB.jsurl.replace("localjs","localimg").replace("javascript","images"),PBClient.cssurl=PB.jsurl.replace("localjs","localcss").replace("javascript","styles"),PB.followUp(e)},PB.initFingFile=function(e){var t=document.createElement("script");t.src=PB.jsurl+"/pcdn.js",t.onload=function(){PB.followUp(e)},document.head.appendChild(t)},PB.followUp=function(e){attachZTIListner(),PB.serviceData=e;var t=e.loadPB||!0;e.crmplusData&&!e.isUnifiedPB&&(PB.serviceData.serviceId=e.crmplusData.ZohoCRM||e.crmplusData.ZohoSupport||e.crmplusData.LiveDesk,PB.serviceData.serviceName=e.crmplusData.ZohoCRM?"ZohoCRM":e.crmplusData.ZohoSupport?"ZohoSupport":"LiveDesk","LiveDesk"===PB.serviceData.serviceName&&delete PB.serviceData.crmplusData),null!=e.pbDomain&&""!=e.pbDomain&&(PB.server=e.pbDomain),PB.pbxhr=new XMLHttpRequest,PB.serviceData.bundleOrgId&&PB.serviceData.bundleService?PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&bundleOrgId="+PB.serviceData.bundleOrgId+"&bundleService="+PB.serviceData.bundleService+"&loadPB="+t,!0):PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&loadPB="+t,!0),e.zaid&&PB.pbxhr.setRequestHeader("X-ZAID",e.zaid),e.pbzaaid&&PB.pbxhr.setRequestHeader("X-PB-ZAAID",e.pbzaaid),PB.accesstoken&&PB.pbxhr.setRequestHeader("Authorization","Zoho-oauthtoken "+PB.accesstoken),PB.pbxhr.withCredentials=!0,PB.pbxhr.onreadystatechange=PB.ready,PB.pbxhr.send(null)},PB.ready=function(){if(this.readyState===this.DONE){var e,t=JSON.parse(PB.pbxhr.response);if(e=t.integResponse,PBClient.fingerPrintJson=t.parentFing,PBClient.checkSumJson=t.parentCs,PBClient.isIntegrityEnabled=t.isSriEnabled,PB.zuid=t.zuid,PBClient.log("Parent fing Loaded"),PB.integRest=e,"true"===e||"syncuser"==e||"D_ORG"===e||"O_ORG"===e){if(PB.integEnabled="syncuser"!==e,"CRMPlus"===PB.serviceData.bundleService&&PB.serviceData.crmplusData&&"O_ORG"===e)return delete PB.serviceData.crmplusData[PB.serviceData.serviceName],PB.serviceData.serviceId=PB.serviceData.crmplusData.ZohoSupport||PB.serviceData.crmplusData.LiveDesk,PB.serviceData.serviceName=PB.serviceData.crmplusData.ZohoSupport?"ZohoSupport":"LiveDesk",void PB.init(PB.serviceData);initPBSDK()}else{if(PB.tagNeededProducts.includes(PB.serviceData.serviceName))if(window.Lyte)registerCustomTag();else{var i=document.createElement("script");i.src=wmsUserConfig.phonebridgejsurl.substring(0,wmsUserConfig.phonebridgejsurl.lastIndexOf("/"))+"/lyte-parent-dom.js",i.type="text/javascript",i.onload=function(){registerCustomTag()},document.head.appendChild(i)}window.callbackZPB&&callbackZPB()}}},PB.toggleTheme=function(e){var t=e.darkmode;if(PB.darkmode!=t){PB.darkmode=t;var i={action:"toggleDarkmode",isDarkmode:t};document.getElementById("zpbsetup")&&ZPB.sendMessage("zpbsetup",i),document.getElementById("zpbsdk")&&ZPB.sendMessage("zpbsdk",i),document.getElementById("pb_renderer_frame")&&ZPB.sendMessage("pb_renderer_frame",{action:"darkmode",data:{isDarkmode:t}})}},PB.loadSetup=function(e,t,i){if("undefined"==typeof ZPB){var n=document.createElement("script"),r=PBClient.getFingerprintAndCSForFileName("pbone.js");n.src=r.cdnurl,PBClient.isIntegrityEnabled&&(n.integrity=r.integrity),n.crossOrigin="anonymous",n.onload=function(){ZPB.initPlatform(PB.serviceData)},document.head.appendChild(n)}var a,s=document.location.origin,o="0";if(PB.serviceData&&PB.serviceData.serviceData&&PB.serviceData.serviceData.planId?o=PB.serviceData.serviceData.planId:PB.serviceData&&PB.serviceData.planId&&(o=PB.serviceData.planId),"SDPOnPremise"===PB.serviceData.serviceName)a="/phonebridge/viewcomponent/fetchsetup?frameorigin="+s+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&planId="+o+"&accesstoken="+PB.accesstoken;else if(PB.serviceData.bundleService&&""!==PB.serviceData.bundleService){if("ZohoOne"===PB.serviceData.bundleService&&"ZohoOne"!==PB.serviceData.serviceName){var c=document.referrer;window.location!==window.parent.location&&document.referrer&&(c="https://"+(c=(c=document.referrer.split("https://"))[1].substr(0,c[1].indexOf("/")))),s=window.location!==window.parent.location?c+","+document.location.origin:document.location.origin}a="/phonebridge/viewcomponent/providers?frameorigin="+s+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&bundleService="+PB.serviceData.bundleService+"&bundleOrgId="+PB.serviceData.bundleOrgId+"&planId="+o}else if(PB.isVerticalService){var d="";PB.serviceData.zaid&&(d="zaid_"+PB.serviceData.zaid),PB.serviceData.pbzaaid&&(d="zaaid_"+PB.serviceData.pbzaaid+"_"+d),a="/phonebridge/viewcomponent/providers/"+d+"?frameorigin="+s+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&planId="+o}else a="/phonebridge/viewcomponent/providers?frameorigin="+s+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&darkmode="+PB.darkmode+"&planId="+o;if(document.location.origin.includes("bigin")){var l=document.createElement("div");l.id="loadingDivIblt",l.style=" position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 800; background: #23ae73; transform: translateX(100%); overflow: hidden; animation: shift-rightwards 1.5s ease-in-out infinite; animation-delay: .8s; ",document.getElementById(t).appendChild(l)}var u,P={action:"setupPageReady",serviceID:PB.serviceData.serviceId,serviceName:PB.serviceData.serviceName,serviceData:PB.serviceData.serviceData,bundleService:PB.serviceData.bundleService,bundleOrgId:PB.serviceData.bundleOrgId,planId:PB.serviceData.planId,accessToken:PB.accesstoken,pbzaaid:PB.serviceData.pbzaaid,PBServer:PB.server},B={border:"none",width:"100%",height:(e-=30)+"px"},m=function(){if(document.location.origin.includes("bigin")&&document.getElementById("phoneSetup"))try{document.getElementById("phoneSetup").removeChild(document.getElementById("loadingDivIblt"))}catch(e){PBClient.log("Exception ",e)}if(ZPB.sendMessage("zpbsetup",P),i){var e=null!==document.getElementById("pb_response")?document.getElementById("pb_response").value:"success";i(e)}},p=new ClientFrame("zpbsetup",PB.server,a);if(p.setRendererFrameProvider((function(){return new Promise(u?function(e){e(u)}:function(e){(u=new ClientFrame("pb_renderer_frame",PB.server,"/phonebridge/ui/base?frameorigin="+s+"&serviceName="+PB.serviceData.serviceName+"&serviceId="+PB.serviceData.serviceId+"&darkmode="+PB.darkmode)).listenMessage(),u.render(document.body,{border:"none",position:"fixed",left:"0px",top:"0px",height:"100vh",width:"100vw","z-index":"400",display:"none"},(function(){e(u)}))})})),p.listenMessage(),t){var v=document.getElementById(t);return v.textContent="",void p.render(v,B,m)}return p.generateFrame(B,m)},PB.isIntegrationEnabled=function(){return PB.integEnabled},PB.isIntegrationEnabledinCurrentOrg=function(){return"D_ORG"===PB.integRest},PB.isDefaultIntegrationEnabled=function(){return"D_ORG"===PB.integRest},PB.getPhoneBridgeContainer=function(){return void 0!==PB.serviceData&&PB.serviceData.zpbContainerId?document.getElementById(PB.serviceData.zpbContainerId):"undefined"!=typeof WebMessanger&&WebMessanger.getPhoneBridgeContainer?WebMessanger.getPhoneBridgeContainer():null},null!==PB.getPhoneBridgeContainer()&&(PB.getPhoneBridgeContainer().style.visibility="hidden"),PB.setHeadersForVCRM=function(){return PB.isVerticalService?PB.serviceData.pbzaaid?{"X-ZAID":PB.serviceData.zaid,"X-PB-ZAAID":PB.serviceData.pbzaaid}:{"X-ZAID":PB.serviceData.zaid}:{}},PB.enableSMS=function(e){PB.target="inbuiltSMS",PB.loadSetup(500,"pbSmsSetup",e)},PB.loadRecording=function(){const e=new Promise((function(e,t){var i=document.createElement("LINK");i.rel="stylesheet";var n=window.Lyte?"audio-tag.css":"laudio-tag.css",r=PBClient.getFingerprintAndCSForFileName(n);i.href=r.cdnurl,PBClient.isIntegrityEnabled&&(i.integrity=r.integrity),i.crossOrigin="anonymous",i.onload=function(){e()},document.head.appendChild(i),setTimeout(function(){t()}.bind(this),4e3)})),t=new Promise((function(e,t){var i=document.createElement("SCRIPT");i.type="text/javascript";var n=window.Lyte?"audio.js":"lyte-audio.js",r=PBClient.getFingerprintAndCSForFileName(n);i.src=r.cdnurl,PBClient.isIntegrityEnabled&&(i.integrity=r.integrity),i.crossOrigin="anonymous",i.onload=function(){e()},document.head.appendChild(i),setTimeout(function(){t()}.bind(this),4e3)}));return Promise.all([e,t])},PB.loadClientPortalSetup=function(e,t){const i=document.createElement("iframe");var n=document.location.origin,r=PB.server+"/phonebridge/viewcomponent/providers/zaaid_"+PB.serviceData.pbzaaid+"?frameorigin="+n+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&planId=0&zuid="+PB.zuid;fetch(r,{headers:{Authorization:"Zoho-oauthtoken "+PB.serviceData.access_token,X_PB_ZAAID:PB.serviceData.pbzaaid}}).then((e=>e.text())).then((n=>{i.addEventListener("load",(function(){const e=i.contentDocument||i.contentWindow.document;e.open(),e.write(n),e.close()})),i.setAttribute("id","zpbsetup"),i.setAttribute("name","zpbsetup"),i.style.cssText="border: none;width: 100%",i.style.height=e+"px";var r=document.getElementById(t);return r.innerHTML="",r.appendChild(i),i}))};