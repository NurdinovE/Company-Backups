Lyte.Mixin.register("chat-setup-mixin",{getDependencies:function(){return networkUtils.returnDependencyFiles(["chat-setup-store.js"],ResourceConstants.CRMClient)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chat-setup.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],ResourceConstants.CRMClient),s=e.concat(t);return s=s.concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],ResourceConstants.CRM)),"ms-teams"===this.routeName&&(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MicrosoftTeams")],ResourceConstants.CRM))),s},beforeModel:function(){if(!Crm.userDetails.IS_ADMIN)return renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort(),!1;var e,t="cliq"===this.routeName,s=this.transition.data;if(s&&(e=s.integrationEnabled),t&&"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&!e){CrmPlusImpl.trigger("enableApplication",["ZohoCliq",function(){Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.cliq")}])}if("C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE){store.triggerAction("rso_configuration","get_rso_info",{},{},"GET").then((function(e){if(null!=e.remote_sales_office){var t=e.remote_sales_office.length;1===t?"zoho_cliq"===e.remote_sales_office[0].service:2===t&&("zoho_cliq"===e.remote_sales_office[0].service||"zoho_cliq"===e.remote_sales_office[1].service)}}))}},model:function(){var e;e="cliq"===this.routeName?this.routeName:"ms-teams"===this.routeName?"microsoft_teams":"cisco";var t=this.transition,s=t.info.queryParams,r=function(e){var t={type:"cisco"};return t.active="FEATURE_ALREADY_ENABLED"===e,t};if("cisco"===e&&s.activate)return store.triggerAction("chat_setting","toggleIntegration",{type:"cisco",active:!0}).then((function(){return{type:e,active:!0}}),(function(e){return chatIntegration.handleErrorResponse(e,void 0,void 0,r)}));return store.findAll("chat_setting",{type:e},!1).then((function(e){return e[0]}),(function(e){var s=JSON.parse(e.response);(s&&"PERMISSION_DENIED"===s.code||"FEATURE_NOT_SUPPORTED"===s.code)&&(renderingUtils.displayPermissionDenied(),t.abort())}))},renderTemplate:function(){return{outlet:"cliq"===this.routeName||"ms-teams"===this.routeName?"#result":"#internalExtensionDetail",component:"crm-chat-setup"}}}),Lyte.Mixin.register("crm-view-utils",{isRecordFetched:!1,massConvertLimit:Lyte.attr("number"),mergeLimit:Lyte.attr("number"),initiateRequest:function(e,t,s,r,i,o){this.isRecordFetched=!1,this.lookupLimitExceeded=!1;var a=moduleRecordMapping[s],n=e.queryParams,c={};if(this.beforeRecordAPI(n,c,a,i,o),!this.preventTransition){var l=c.per_page?Number(c.per_page):a.per_page;if(500==l&&500==Crm.userDetails.maxRange?l=500:-1==[10,20,30,40,50,100].indexOf(l)?l=a.per_page:100!=l||Crm.userDetails.ISPAID_USER||(l=50),this.per_page=l,c.per_page=l,e.list_props||this.data&&this.data.listfields){var d=(e.list_props?e.list_props.fields:this.data.listfields).mapByKey("api_name");c.fields=[...new Set(c.fields.concat(d))]}n&&n.sort_by&&n.sort_order&&["asc","desc","unsort"].contains(n.sort_order)&&a.custom_view&&(null==a.custom_view.sort_order&&"unsort"!=n.sort_order||a.custom_view.sort_order&&a.custom_view.sort_order!=n.sort_order||validationUtils.isNotEmpty(a.custom_view.sort_by)&&a.custom_view.sort_by.id!=n.sort_by)&&(this.updateSort=!0,store.unloadAll(a.id));var u=a.id;t.module=a.module_name,this.cachedObj.searchletter&&"All"!=this.cachedObj.searchletter&&(t.clearCache=!0);var m=[],p=Number(c.page);if(t.clearCache)store.unloadAll(u),0!=this.fetchCount&&(a.total_count=void 0);else{m=store.model[u]?store.model[u].data.sortBy("recnum"):m;var _=(p-1)*a.per_page+1,g=p*a.per_page-1;g=a.total_count&&a.total_count<g?a.total_count-1:g}if(c.fields&&e.fldUsedinCanvas){var v=c.fields.diff(e.fldUsedinCanvas);c.fields=v.concat(e.fldUsedinCanvas)}this.queryObj=c;var f=this,h="chart"===this.routeName&&o?void 0:$L("crm-customview-layer")[0];return!t.clearCache&&m.length>0&&m[_-1]&&m[g]&&m[_-1].recnum===_?Lyte.resolvePromises({cv_records:m.splice(_-1,a.per_page),module:t.module,total_count:moduleRecordMapping[t.module].total_count}):(store.model[u]||store.registerModel(u,{},{extends:"entity"}),this.cachedObj.searchletter&&"All"!=this.cachedObj.searchletter&&(delete t.clearCache,this.cachedObj.searchletter="All"),Crm.userDetails.fetchCountValues?!1!==r.fetchCount&&!1!==this.fetchCount||!this.cachedObj?(h&&h.setData("show_loading",!0),this.triggerRecordCount=!0):(this.cachedObj.totalCount=moduleRecordMapping[a.module_name].total_count,r.currentModel&&(r.currentModel.total_count=moduleRecordMapping[a.module_name].total_count)):h&&(!1!==r.fetchCount&&!1!==this.fetchCount||!this.cachedObj)&&h.setData("total_new_count","###"),new Promise((function(e,s){if(f.updateSort){var r=store.peekRecord("custom_view",c.cvid);"unsort"==n.sort_order?(r.$.set("sort_by",{}),r.$.set("sort_order",void 0)):(r.$.set("sort_order",c.sort_order),r.$.set("sort_by",{id:c.sort_by})),store.triggerAction("custom_view","change_sort",{sort_by:r.sort_by,sort_order:r.sort_order,module:a.api_name,id:c.cvid}).then((function(){i()}),(function(e){s(e)})),delete f.updateSort}else i();function i(){c.cvid&&(delete c.sort_by,delete c.sort_order),Promise.all([app.store.makeRequest("findAll",u,c,void 0,!1)]).then((function(s){f.isRecordFetched=!0;var r={isRecordFetched:!0};if(r.module=t.module,s[0]){if(r.cv_records=s[0][u],s[0].meta)for(var i in s[0].meta)r[i]=s[0].meta[i]}else r.cvError=!0;e(r)}),(function(e){f.lookupLimitExceeded=!0,s(e)}))}})))}delete this.preventTransition},beforeRecordAPI:function(e,t,s,r,i){var o=crmConstants.moduleDisplayField[s.module_name]?crmConstants.moduleDisplayField[s.module_name][0]:"";for(var a in e)if(null!=e[a]&&(e[a]||!1===e[a]))switch(a){case"sort_order":"unsort"==e.sort_order?delete t.sort_by:t.sort_order=e.sort_order;break;case"search_letter":t.alphabet=e.search_letter,t.fields=[s.module_name.indexOf("CustomModule")>-1||s.module_name.indexOf("LinkingModule")>-1?"Name":o];break;case"search_field":!e.search_letter||"Full_Name"!==e.search_field&&"Last_Name"!==e.search_field||(t.alphabetical_index_field=e.search_field);break;case"filter_id":t.filter_id=e.filter_id;break;default:t[a]=e[a]}t.sort_order&&!t.sort_by&&delete t.sort_order,"Campaigns"==s.module_name&&(t.exclude_followup_campaigns=!0),1===Crm.userDetails.TMENABLED&&!i&&void 0===t.territory_id&&s.territory&&s.territory.id&&0!==s.territory.id&&/Leads|Contacts|Potentials|Deals|Accounts|CustomModule/.test(s.module_name)&&(t.territory_id=s.territory.id,s.territory.subordinates&&(t.include_child=s.territory.subordinates));var n=this.cachedObj?this.cachedObj:crmTab.getFromCache(s.module_name);n=n||{};var c=t.filters&&"string"==typeof t.filters?JSON.parse(t.filters):t.filters;if(t.filters&&this.isOldCriteria(c))try{var l=this.oldCriteria_to_newCriteria(JSON.parse(t.filters),Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]);return l?(e.filters=t.filters=l.filters?JSON.stringify(l.filters):void 0,l.cross_filters&&(e.cross_filters=t.cross_filters=JSON.stringify(l.cross_filters)),this.transition.abort(),this.setQueryParams(e).data={clearCache:!0},void(this.preventTransition=!0)):(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),void delete t.filters)}catch(e){return this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),void delete t.filters}n.filters=t.filters?this.parse_Nested_Json(t.filters):void 0,n.cross_filters=t.cross_filters?this.parse_Nested_Json(t.cross_filters):void 0,t.filter_id&&(t.filters||t.cross_filters)&&(delete t.filters,delete t.cross_filters);var d=this.portalName?this.portalName:n?n.screenName:void 0;d&&"allportals"!==d&&(t.portal_name=CrmTracking.portalsInfo[d]),Crm.userDetails.activityBadgeUpgradeEnabled&&(t.on_demand_properties="$client_portal_permission"),t.fields?(t.fields=s.$properties?t.fields.concat(s.$properties):t.fields,s&&s.$on_demand_properties&&(t.fields=t.fields.concat(s.$on_demand_properties))):(t.fields=s.$properties,s&&s.$on_demand_properties&&(t.fields=t.fields.concat(s.$on_demand_properties))),t.fields=t.fields?t.fields.filter((function(e){return"$notes_view"!==e})):void 0,t.fields?this.addDefaultCustomViewFields(t.fields,s.module_name,s.api_name):delete t.fields,t.approved="both",t.cvid=r,t.home_converted_currency=!0,t.formatted_currency=!0},setCount:function(e,t,s){var r,i=setInterval((function(){if((r=document.getElementsByTagName("crm-list-view")).length||(r=document.getElementsByTagName("crm-list-view-canvas")),r.length||(r=document.getElementsByTagName("crm-chart-view")),r.length||(r=document.getElementsByTagName("crm-timeline-view")),-1!==["list","users","list-view","canvas","card","chart","detail","timeline"].indexOf(Lyte.Router.getRouteInstance().routeName)||"user-types"===Lyte.Router.getRouteInstance().parent.routeName){if(r.length){var o=!1;e&&!e.count&&(e.count=0,o=!0),r=r[0],clearInterval(i);var a=Lyte.Router.getRouteInstance(),n=s.cachedObj;r.setData("total_count",e.count),moduleRecordMapping[t.module_name].total_count=e.count,n.totalCount=e.count,a.currentModel&&(a.currentModel.total_count=e.count),$L("crm-customview-layer")[0].setData("show_loading",!1),a.currentModel&&a.currentModel.isFromChartView||"chart"===a.routeName?s.setCountForChartDrilldown(e.count):document.querySelector("crm-custom-outer-box").setData("total_count",e.count);var c=$("crm-custom-filter")[0];if(a.getQueryParams().filter_id||c&&c.component.data.appliedFilterId&&!c.getData("isSaveFilter")&&c.getData("savedFilters").length){var l,d=(c=c.component).getData("savedFilters"),u=d.length,m=a.getQueryParams().filter_id?a.getQueryParams().filter_id:c.filter_id;if(a.currentModel.isFromModal&&"chart"===a.routeName||s.filter_id&&s.filter_id!==c.data.appliedFilterId||"timeline"===a.routeName)return;for(l=0;l<u;l++)o||d[l].id!==m||(Lyte.objectUtils(n,"add","totalCount",e.count),Lyte.objectUtils(d[l],"add","count",e.count))}}}else clearInterval(i)}),200)},fieldYieldMapping:function(e,t,s,r){var i=Object.assign({},crmConstants.defaultUiTypeToCruxMapping);Object.assign(i,{20:"user",127:"lookup",133:"lookup"}),"mass-tools"===r&&Object.assign(i,{33:"text"});var o=(s=void 0===s?this.getData("module_info"):s).custom_view.sort_by?s.custom_view.sort_by.id:void 0,a={},n=s.fields,c=crmConstants.moduleDisplayField,l="Activities"===s.module_name||"Events"===s.module_name;s.module_name.indexOf("CustomModule")>-1||s.module_name.indexOf("LinkingModule")>-1?c[s.module_name]=["Name"]:(s.module_name.startsWith("Orchestration")||s.module_name.startsWith("PathFinder"))&&(c[s.module_name]=[]);var d=c[s.module_name];d=void 0===d?[]:d;for(var u=e.length,m=[],p=n.length,_=d.length,g=$L("crm-inner-list")[0],v=$L("crm-list-view")[0],f=!1,h=!1,y=g?g.component.getData("cv_mod_fields"):new Map,w=0;w<u;w++)if(e[w]._width||y.size>0){f=!0;break}for(w=0;w<u;w++)for(var C=0;C<p;C++)if(e[w].api_name==n[C].api_name&&n[C].visible&&n[C].available_in_user_layout&&51!=n[C].ui_type){if(0===n[C].show_type&&"FULLNAME"!==n[C].column_name&&"PROCESSINGBASIS"!==n[C].column_name&&"SE_STATUS"!==n[C].column_name||"S_MODIFIEDTIME"===n[C].column_name&&17===n[C].show_type)continue;"Full_Name"!=n[C].api_name||"Contacts"!=s.module_name&&"Leads"!=s.module_name||(n[C].field_label=I18n.getMsg("custommodule.crmfield.fl.name",s.singular_label));var b=!1;"zia_suggested_user_1"===n[C].api_name&&(n[C].api_name="zia_suggested_user"),a[n[C].api_name]=i[n[C].ui_type],"lookup"==n[C].data_type&&(n[C].api_name&&n[C].api_name.indexOf("Touchpoint_Email")>-1&&s.module_name.startsWith("PathFinder")?n[C].yieldName="pf_email_lookup":n[C].yieldName="lookup");for(var R=0;R<_;R++)d[R]==n[C].api_name&&(n[C].yieldName="lookup");if(n[C].cxPropClass=this.getClassForLVData(n[C]),n[C].list_display_label=n[C].field_label,209==n[C].ui_type&&(n[C].list_display_label=I18n.getMsg("crm.label.small.tags")),n[C].sortable||window.clientPortalName&&(n[C].cxPropClass+=" noSortFieldOption"),2==n[C].ui_type&&"TYPE"==n[C].column_name?n[C].yieldName="campaign-type":"multi_module_lookup"==n[C].data_type?n[C].yieldName="multi_module_lookup":2===n[C].ui_type&&-1!==s.module_name.indexOf("PathFinder")&&"STATE_ID"===n[C].column_name?(n[C].yieldName="current_state",n[C].disableExtraValue=!0):"BEST_TIME"==n[C].column_name?n[C].yieldName="best_time":l&&!0===n[C].enable_colour_code?(n[C].yieldName="eventtypecolour",n[C].cxPropClass="pR"):"ACTIVITYTYPE"==n[C].column_name?n[C].yieldName="activity_type":999==n[C].ui_type?n[C].yieldName="territory":8==n[C].ui_type&&(n[C].cxPropTooltip=!0,n[C].style="max-width :  150px"),"Owner"===e[w].api_name&&e[w].id!==n[C].id&&(b=!0),!b){var M=Object.assign({},n[C]);M.cxPropClass+=" cellWrap",d.contains(e[w].api_name)&&(M.cxPropClass+=" aZLinkIncl","Last_Name"!==e[w].api_name&&(M.cxPropClass+=" displayColumn")),!M.ui_type||3!==M.ui_type&&110!==M.ui_type||(M.cxPropClass+=" nlv_data_textarea");var D=0;t&&(M.cxPropResize="enable",y.has(M.id)?(D=y.get(M.id),M.style="width: "+D+"px;"):e[w]._width?(D=parseInt(e[w]._width),M.style="width: "+D+"px;"):M.style="",f&&""===M.style&&(D=this.getDefaultWidthForField(M.ui_type),M.style="width: "+D+"px;"),0!==D&&(M.width=D+"px")),209===M.ui_type&&(D=0===D?this.getDefaultWidthForField(M.ui_type):D,M.tagWidth=D+"px",M.cxPropClass+=" nlv_data_tags"),999===M.ui_type&&(M.cxPropClass+=" nlv_data_territory"),e[w]._pin?(M.fixed="enable",M.cxPropPinned=!0,e[w]._pin_order&&(M.cxPropPinOrder=e[w]._pin_order)):M.cxPropPinned=!1,o&&o===M.id&&(M.cxPropClass+=" sApplyField",v&&(v.component.setData("sortByComp",s.custom_view.sort_by),h=!0)),2!==M.ui_type&&26!==M.ui_type||!M.enable_colour_code||(M.cxPropClass+=" nlv_data_picklist"),m.push(M);break}}h||v&&v.component.setData("sortByComp",void 0);var k=m.length;for(w=0;w<k-1;w++)for(C=0;C<k-w-1;C++)if(!m[C].cxPropPinOrder&&m[C+1].cxPropPinOrder||m[C].cxPropPinOrder>m[C+1].cxPropPinOrder){var L=m[C];m[C]=m[C+1],m[C+1]=L}return{customfields:m,fieldMapping:a}},addDefaultCustomViewFields:function(e,t,s){crmTab.isZBCustomModule(t)?e.push("ExchangeRate"):e.push("Exchange_Rate"),"Activities"===t&&(e.push("$activity_type"),isNewCallView?e.push("Outgoing_Call_Status"):e.push("Call_Status"),e.push("Call_Type"),e.push("Owner")),"Calls"===t&&(isNewCallView?e.push("Outgoing_Call_Status"):e.push("Call_Status"),e.push("Call_Type"),e.push("Owner")),"Events"!==t&&"Tasks"!==t||e.push("Owner"),"Leads"!==s&&"Contacts"!==s||(e.push("First_Name"),e.push("Last_Name"),e.push("Full_Name")),e.push("Currency"),e.push("Tag"),e.push("Owner"),e.push("Layout"),e.push("Data_Processing_Basis_Details"),e.push("Locked__s")},getClassForLVData:function(e){var t=e.ui_type;return"SMOWNERID"===e.column_name||"SMCREATORID"===e.column_name||"MODIFIEDBY"===e.column_name?"lv_data_textfield lv_data_username":36==t||77==t||116==t&&"currency"==e.data_type||"formula"==e.data_type&&"currency"==e.formula.return_type?"lv_data_currency listviewalignright":3==t||110==t?"lv_data_desc":Handlebars.helpers.getClassForLVData(e,void 0,void 0,"list")},checkDateWithCurrentDate:function(e){var t=CrmDateUtils.getDateObjectFromString(e,"YYYY-MM-DD",!0),s=(new CrmDate).primitiveDateObject;s.setHours(0),s.setMinutes(0),s.setSeconds(0);var r=Utils.getDateInUserDatePattern(s,!0),i=(r=Utils.getDateInUserDatePattern(s,!0),Crm.userDetails.DATE_PATTERN);return i=(i=(i=i.replaceAll("y","Y")).replaceAll("m","M")).replaceAll("d","D"),s=CrmDateUtils.getDateObjectFromString(r,i,!0),t.getTime()<s.getTime()?0:t.getTime()===s.getTime()?1:t.getTime()>s.getTime()?2:void 0},isListComponents:function(){if("crm.tab.module.custom-view.list"===Lyte.Router.getRouteInstance().transition.target){var e=$L("crm-listpage-components");if(e&&e[0])return!0}return!1},filterErrorMsg:function(e,t,s,r,i){var o="",a="",n=I18n.getMsg("crm.button.ok.got.it"),c=!1;s&&"Auto-refresh formula field criteria usage of 2 exceeded"===s.message&&(n=I18n.getMsg("crm.button.ok.got.it"),c=!1,a=I18n.getMsg("crm.dashboard.dynamic.formula.filters.limit.alert.message",2),o=I18n.getMsg("crm.title.max.dynamic.formula.fields")),e||(n=I18n.getMsg("crm.button.ok.got.it"),a=I18n.getMsg("crm.filter.common.error1"),c=!0),s&&"A proper filter id is required"==s.message&&(n=I18n.getMsg("crm.button.ok.got.it"),c=!1,a="",o=I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.label.filter")));var l=Lyte.Router.getRouteInstance(),d={filters:void 0,filter_id:void 0,cross_filters:void 0,territory_id:void 0,include_child:void 0};d.search_letter=l.getQueryParams().search_letter,"crm.tab.module.custom-view.canvas"===l.transition.target&&l.getQueryParams().viewType&&(d.viewType=l.getQueryParams().viewType),!s||"Given territory ID is not accessible for the user"!=s.message&&"Territories does not contains any subordinates"!=s.message||(o=I18n.getMsg("crm.territory.error.heading"),a=I18n.getMsg("crm.territory.error.content"),n=I18n.getMsg("crm.error.goto.button",[I18n.getMsg("crm.label.all.territories")]),c=!1,d.territory_id="0"),s&&s.details&&"sort_order"==s.details.api_name&&(d.sort_by=void 0,d.sort_order=void 0),"message"==t?(renderingUtils.showMsgBox(e,"error"),l.setQueryParams(d).data={clearCache:!0}):_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"filterAlertMsg",ltPropPrimaryMessage:o,ltPropContentAlign:"left",ltPropSecondaryMessage:c?"x":a,ltPropButtons:[{type:"accept",text:n,appearance:"primary"}]},show:function(e){if($L(".filterAlertMsg lyte-button").focus(),c){var t=e.childComp.querySelector(".alertSecondaryMsg");t.innerHTML=a,$L(e.childComp).find(".filterAlert").addClass("darkMainHead pB20"),$L(t).addClass("alignLeft")}},close:function(){("0"==d.territory_id&&l.setTerritory(d,l.transition.info.dynamicParams[0]),r&&i)?i():l.transitionTo({route:l.transition.target,dynamicParams:l.transition.info.dynamicParams,queryParams:d}).data={clearCache:!0,reloadAll:!0}}})},viewAfterModel:function(e,t,s){e.cv_records||e.errorOnModel||(e.cv_records=[]);document.getElementsByTagName("crm-customview-layer");if(e.module=s,!1===e.more_records){var r=((t.page?t.page:1)-1)*(t.per_page?t.per_page:moduleRecordMapping[e.module].per_page)+e.cv_records.length;e.total_count=r,moduleRecordMapping[e.module].total_count=r}else e.more_records=!0,e.total_count=moduleRecordMapping[e.module].total_count;this.cachedObj.module=e.module,this.cachedObj.fromLyte=!0,this.cachedObj.searchletter=t.search_letter?t.search_letter:"All",this.cachedObj.search_field=t.search_letter?t.search_field:void 0,this.cachedObj.filter_id=t.filter_id?t.filter_id:this.cachedObj.filter_id?this.cachedObj.filter_id:void 0,e.total_count&&(this.cachedObj.totalCount=e.total_count)},setABMModuleInfo:function(e,t){var s,r,i=$L("#customFilter")[0];e.abmModuleInfo=!1,!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&crmTab.isABMFieldAvaiable&&(s=store.peekAll("account-configuration")[0],r=store.peekAll("contact-configuration")[0],s&&s.module&&s.module.api_name===t?(e.abmModuleInfo=s,e.abmModuleInfo.isAccountModule=!0):r&&r.module&&r.module.api_name===t&&(e.abmModuleInfo=r,e.abmModuleInfo.isAccountModule=!1)),e.abmModuleInfo&&(e.abmModuleInfo.renderSegmentFilter=!0,e.abmModuleInfo.techniqueFields=this.abmTechniqueFields.slice(),e.abmModuleInfo.abmAccountFields=[],e.abmModuleInfo.scoreFields=this.abmScoreFields.slice(),e.abmModuleInfo.isAccountModule||(e.abmModuleInfo.currentModuleDisplayName=store.peekAll("module").filter((e=>e.api_name===t))[0].plural_label,e.abmModuleInfo.parentModuleDisplayName=store.peekAll("module").filter((e=>e.api_name===s.module.api_name))[0].singular_label),i&&Lyte.objectUtils(i.component.data,"add","cxPropCommonInfo",{abmModuleInfo:e.abmModuleInfo}))},abmTechniqueFields:["RFM_Label__s","Firmographic_Label__s","Engagement_Label__s","VOICEOFCUSTOMERLABEL__s","Recommendation_Label__s"],abmScoreFields:["Account_Score__s","Value_Score__s","Mood_Score__s","Engagement_Score__s"],setDataFromRoute:function(e,t,s,r,i){e.module_name=e.module;var o=moduleRecordMapping[e.module],a=store.peekRecord("custom_view",t),n=o.per_page;if(this.per_page=this.per_page?this.per_page:o.per_page,o.per_page=e.currentOption?Number(e.currentOption):this.per_page,n!==o.per_page&&o.$.triggerAction("view_preference_configurations",{module:o.api_name},{},"PUT",{per_page:o.per_page}),o.last_accessed_views){var c=o.last_accessed_views.find((function(e){return"custom_view"===e.type}));(c&&c.custom_view.id&&a&&a.id!=c.custom_view.id||!c&&a&&a.id)&&(o.$.set("custom_view",void 0),o.$.set("custom_view",a),c&&c.custom_view?c.custom_view={id:a.id,name:a.name}:o.last_accessed_views.push({type:"custom_view",custom_view:{id:a.id,name:a.name}}))}if(r||o.$.save(),"Visits"==e.module&&(this.vistFields(e),e.portalName="allportals"===this.portalName?I18n.getMsg("crm.salesiq.all.accounts"):CrmTracking.portalsInfo[this.portalName],e.screenName=this.portalName),this.setABMModuleInfo(e,o.api_name),e.module_info=moduleRecordMapping[e.module],e.cv_name=moduleRecordMapping[e.module].custom_view?moduleRecordMapping[e.module].custom_view.display_value:"",e.cvid=this.cachedObj.cvId=t,e.cvId=t,e.saved_filters=!r&&this.parent.currentModel.saved_filters?this.parent.currentModel.saved_filters:[],e.filters=s&&s.filters?JSON.parse(s.filters):void 0,e.cross_filters=s&&s.cross_filters?JSON.parse(s.cross_filters):void 0,e.filter_id=s&&s.filter_id?s.filter_id:void 0,this.transition&&this.transition.clearCache)for(var l=e.saved_filters.length,d=0;d<l;d++)e.saved_filters[d].count=void 0;e.showCustomFilter=!("Activities"===e.module&&o.kanban_view||"Visits"===e.module&&o.kanban_view),e.isFilterActive=!!e.module_info.filter_status,e.hideGreyArea=("Activities"===e.module_info.module_name||"Visits"===e.module_info.module_name)&&e.module_info.kanban_view,e.showAlphaSort="en_US,en_GB".indexOf(Crm.userDetails.RELEVANT_LOCALE)>-1&&!Crm.userDetails.CLIENT_ACCOUNT&&(e.module_info.canvas_view||e.module_info.table_view||e.module_info.card_view)&&"Appointments"!==e.module&&!e.module_info.chart_view,e.showKvSettings=(e.module_info.kanban_view||e.module_info.zia_view)&&"false"===e.error,this.parent&&this.parent.parent&&this.parent.parent.currentModel&&this.parent.parent.currentModel.cpqObj&&moduleRecordMapping.ZohoCPQ&&(crmTab.isZCpqTab(e.module)||crmTab.isZCpqSubTab(e.module))?(e.cpqobj=this.parent.parent.currentModel.cpqObj,e.enableCpqTab=!0):e.enableCpqTab=!1,e.showNote=!0,e.showFilterBy=!0,this.parent&&this.parent.parent.currentModel.relatedModules&&(e.relatedModules=this.parent.parent.currentModel.relatedModules,moduleRecordMapping[e.module].relatedModules=e.relatedModules),this.fetchRecFilterCount(e.saved_filters,s,e.module_info,r,i)},setDataBeforeRender:function(e,t,s,r,i){var o,a=moduleRecordMapping[e.module],n=s.queryParams,c=this.cachedObj.currentOption=a.per_page,l=n.page?n.page:1;if((s.list_props||this.data&&this.data.listfields)&&(o=s.list_props?s.list_props.fields:this.data.listfields),l>1?e.startIndex=Math.round(c*(l-1)):a.start_index&&1!=n.page?e.startIndex=a.start_index:e.startIndex=0,a.$.set("start_index",e.startIndex),!e.errorOnModel){var d=$L("crm-page-navigator")[0],u=$L("crm-customview-buttons")[0];this.fromNavigator&&d?(e.page=d.getData("page"),e.per_page=d.getData("per_page"),e.reset_scroll=!1):(e.reset_scroll=!0,e.page=Number(l),e.per_page=c),e.cvbtnRendered=!(u&&u.getData("frominitial")||!u),this.cachedObj.body=e.cv_records,this.cachedObj.fromIndex=c*(l-1)+1,this.cachedObj.toIndex=c*l,e.errorOnModel=!1}e.module_info=a;var m=store.peekRecord("custom_view",t);if(a.custom_view&&m){if(e.cv_records&&(this.isRecordFetched||e.isRecordFetched)&&(e.cv_records=store.pushPayload(a.id,e.cv_records),e.cv_records.length)){var p=(l-1)*c+1;e.cv_records.forEach((function(e){e.recnum=p++}))}e.listfields=o&&o.length?o:m.fields,e.customview_records=e.cv_records,e.clip_mode=!m.wrap_text,e.isResizeEnabled=!(void 0!==window.clientPortalName&&window.clientPortalName||"PORTALS"===i),e.isClipWrapEnabled=!(void 0!==window.clientPortalName&&window.clientPortalName||"PORTALS"===i);let t="team_based"===a.access_type?Crm.userDetails.permissions["Crm_Implied_Manage_CustomViews_"+a.module_name]:Crm.userDetails.permissions.Crm_Implied_Manage_CustomViews;if(e.showManageColumn=t&&!(void 0!==window.clientPortalName&&window.clientPortalName)&&!("PORTALS"===i),e.moduleActionsMenu=this.populateModuleActionsMenu(e,r),e.showActivityQuickCreate=!0,e.featureObject={},Crm.userDetails.CLIENT_ACCOUNT&&(e.hideActivityBadge=!0),r&&i)switch(e.featureName=i,i){case"PORTALS":if("crm.settings.section.client-portal.user-types.index"===Lyte.Router.getRouteInstance().transition.target)var _=store.peekRecord("user_type",CPMF.userTypeId).name;else _=store.peekRecord("user_type",Lyte.Router.getRouteInstance().getDynamicParam()).name;e.customMessage=I18n.getMsg("invite.users.to.portals",_),e.showNote=!1,e.showFilterBy=!0,e.hideActivityBadge=!0;break;case"CAMPAIGNMEMBERLISTVIEW":e.customMessage=a.plural_label,e.featureObject.statusLabel=" - "+I18n.getMsg("campaign.Member"),e.featureObject.statusLabel2=I18n.getMsg("crm.camp.memb.exclude.msg",e.customMessage);break;case"COMPLIANCE":e.customMessage=a.plural_label,e.featureObject.statusLabel=" - "+I18n.getMsg(CrmPrivacyDashboard.statusVsLabelKey[n.status]),e.isPrivacyListView=!0,this.cachedObj.privacyDetails={status:n.status,type:n.type},this.getBtnListForPrivacyDashBoard(n,e.featureObject),e.showNote=!1,e.showFilterBy=!0,e.hideActivityBadge=!0;break;case"CHARTVIEWS":e.showCustomFilter=!1,e.customMessage=a.plural_label,e.showManageColumn=!0,e.isResizeEnabled=!0,e.isClipWrapEnabled=!0,e.module_info.chart_view=!0,e.persistPinUpdate=!1,e.persistWrapUpdate=!1,e.persistWidthUpdate=!1,e.showFilterBy=!1,e.showActivityQuickCreate=!1,e.showLastAddedNote=!0,this.parent&&this.parent.currentModel&&this.parent.currentModel.related_lists&&(e.related_lists=this.parent.currentModel.related_lists),this.setChartSummaryLabel(e)}}},headerSelection:function(e,t,s,r){if($L("#selectCheckbox").length){if(!t){var i=document.getElementsByTagName("crm-list-view")[0];i||(i=document.getElementsByTagName("crm-list-view-canvas")[0]),r=i.getData("customview_records"),s=i.getData("selectedIds")}"mass_tools"===t?i=$L("crm-mass-tools")[0]:"merge"===t&&(i=$L("crm-find-merge")[0]);var o="customCheckBox",a=0,n=s.length,c=r.length;this.lastRecNum=-1;for(var l=r.length,d=0;d<l;d++)if(s.indexOf(r[d].id)>-1)a++,this.lastRecNum=r[d].recnum,o="partialselect";else if(this.waitingForApproval(r[d],i.getData("featureName")))c--,this.lastRecNum=r[d].recnum;else if(a>0){o="partialselect";break}if(a==c&&0!=a&&(o="customCheckBoxChecked"),!t){e.temp_count=e.total_count-(s.length-c);var u=Lyte.Router.getRouteInstance().getQueryParams().filters,m=$L("crm-customview-buttons")[0];if(!u&&!1!==customViewObject.showSelectAll&&Crm.massOperationTotalLimit>=e.total_count&&e.temp_count>n&&e.total_count>e.per_page&&"customCheckBoxChecked"==o&&featuresAvailable.Schedule_Mass_Operation&&m){customViewObject.showHideSelectAllDiv=!0,m.setData("showSelectedDiv",!0);var p=i.getData("page");customViewObject.selectAllHistory||(customViewObject.selectAllHistory=[]),!customViewObject.selectAllHistory.contains(p)&&customViewObject.selectAllHistory.push(p)}m&&"customCheckBoxChecked"!=o&&this.fromPerpage&&(m.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1)}}document.querySelectorAll("[id='selectCheckbox']").forEach((function(e){e.ltProp("class",o);var t=e.querySelector("span");t.classList.remove(t.classList.value),t.classList.add(o)}))},vistFields:function(e){if("object"==typeof CrmTracking&&CrmTracking.portalsInfo){var t={allportals:I18n.getMsg("crm.salesiq.all.accounts")},s=objectUtils.cloneObject(CrmTracking.portalsInfo);for(var r in s)t[r]=s[r];e.portals=t}},executeCustomButtons:function(e,t,s,r,i,o,a,n){var c;if(e.empty_fields&&Object.keys(e.empty_fields).length&&"component"!==e.action)Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_customButtonPopup.js"],ResourceConstants.CRM)).then(function(){var o={};if(o.errorMessage=e.empty_fields,e.buttonId=t,e.recordId=s,"custom_function"==e.action&&null==s){var a=this.getData("selectedIds");a&&a.length&&(e.recordId=a)}e.position=r,e.module_id=i,Crm.userDetails.isRelatedListLyteEnabled&&(e.payloadForRelatedList=n),o.jsonResString=e,o.position=r,Handlebars.registerPartial("CustomButtonPopup",Handlebars.templates.CustomButtonPopup),$("#tabLayer").after(Handlebars.templates.CustomButtonPopup(o)),crmui.showPop("customButtonPopUp")}.bind(this));else if("invoke_url"===e.action||"web_tab"===e.action){var l=e.url.open_in;if("web_tab"===e.action&&this.storeCustomButtonWebTabParamDetails(e),"invoke_url"===e.action&&this.toTransitionToWebTab(e.url.open_url,l))this.transitionToWebTab(e.url.open_url);else{switch(l){case"new_tab":g="_blank";break;case"same_tab":g="_self";break;default:openPopUp("newWin","",networkUtils.getOrgSpecificURL(e.url.open_url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")}if(e.web_tab){e.web_tab,c=e.url.open_url,CustomButtonJSObjectInit.webtabUrl=c;var d=window.location.href.split("crm/")[0]+"crm/ShowTab.do?webTab=true&module="+e.web_tab;window.open(networkUtils.getOrgSpecificURL(d),g)}else"new_window"!==l&&networkUtils.openUrl(e.url.open_url,g)}}else if("widget"==e.action){var u="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",t):void 0,m={Entity:moduleRecordMapping[this.getData("module")].api_name};"eachRecord"==r?(m.ButtonPosition="listvieweachrecord",m.EntityId=[s]):"withoutRecord"==r?(m.ButtonPosition="listviewwithoutrecord",o.hasOwnProperty("cvid")&&(m.cvid=o.cvid),o.hasOwnProperty("page")&&(m.page=o.page),a.hasOwnProperty("ids")&&(m.EntityId=a.ids)):(m.EntityId=this.getData("selectedIds"),m.ButtonPosition="listview"),u&&WidgetHandler.CustomButtons.render(u,m,r)}else if("component"===e.action){let s={Entity:moduleRecordMapping[this.getData("module")].api_name};"withoutRecord"===r&&(s.ButtonPosition="listviewwithoutrecord",o.hasOwnProperty("cvid")&&(s.cvid=o.cvid),o.hasOwnProperty("page")&&(s.page=o.page),a.hasOwnProperty("ids")&&(s.EntityId=a.ids)),s.component_id=e[e.action].id,s.arguments=e[e.action].arguments,s.ids=e.ids,this.renderButtonLux(t,s)}else if("custom_function"==e.action)if(e.proceed_empty){if(commonUtils.showHideLoadingDiv(!0),Crm.userDetails.isRelatedListLyteEnabled){var p={proceed_empty:!0};"related_list"===e.position&&(p.ids=e.recordId),this.triggerCustomButtonAction(this,e.module_id,{button_id:e.buttonId,ids:e.recordId,type:"POST"},p,e.position?e.position:"listView",e.recordId,e.payloadForRelatedList)}else this.triggerCustomButtonAction(this,e.module_id,{button_id:e.buttonId,ids:e.recordId,type:"POST"},{proceed_empty:!0},e.position?e.position:"listView")}else{var _,g;if(e.custom_function&&"success"==e.custom_function.status&&e.custom_function.creator_response?networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$L("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(e.custom_function.creator_response),$L("#cbExecutedPage").val(r)}),null):renderingUtils.removeFreezeLayer(),e.custom_function&&e.custom_function.url&&(_=e.custom_function.url.open_url,g=e.custom_function.url.open_in),_&&CustomButtonJSObjectInit.isValidWebUrl(_))if(Crm.userDetails.CUSTOM_BUTTON_CUSTOM_FUNCTION_OPEN_URL_NEW_FLOW){const t=e.custom_function.url.height||1e3,s=e.custom_function.url.width||800;let r,i="_blank";switch(g=e.custom_function.url.open_in){case"same window":i="_self";break;case"parent window":window.opener&&(window.opener.open(_,"_blank"),i=void 0);break;case"popup window":r=`height=${t},width=${s},menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes`}i&&networkUtils.openUrl(networkUtils.getOrgSpecificURL(_),i,r)}else switch(g){case"iframe":$("#"+e.frameElement).attr("src",_);break;case"New window":openPopUp("newWin","",networkUtils.getOrgSpecificURL(_),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");break;case"parent window":window.location=networkUtils.getOrgSpecificURL(jsonRes.openURL);break;default:networkUtils.openUrl(networkUtils.getOrgSpecificURL(_),g)}}else if("circuits"===e.action)if(e.circuits.scheduled)crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.schedule.success",e.circuits.name),"4000");else if(e.circuits.circuitId&&Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Advanced_Dev_Access")&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access)if(e.circuits.executionUrl){var v=e.circuits.executionUrl,f=e.circuits.name;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+'. <span class="crmLinkColor cP" onClick="crmRelatedList.showCircuitPreview(\''+v+"','"+f+"')\">"+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3)}else{v=Crm.getCrmBasePath()+"/settings/circuits/executionLogs?circuit_id="+e.circuits.circuitId;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+". <span class='crmLinkColor cP' onClick='networkUtils.openUrl(\""+v+'", "_blank", "");\'>'+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3)}else e.circuits&&"failure"===e.circuits.status?crmui.showMsgBand("error",e.circuits.message,"4000"):crmui.showMsgBand("success",I18n.getMsg("crm.circuits.withname.component.trigger.success",e.circuits.name),"4000");else"kiosk"===e.action&&(Lyte.registeredMixins.kiosk_execute.setKioskExecution(!1),Lyte.registeredMixins.kiosk_execute.renderExecuteKiosk(e.kiosk.id,"buttons",!0,s,this))},renderButtonLux:(e,t)=>new Promise((s=>{let r={position:"POPUP",listRelationId:e,infos:t,onsuccess:function(){s(!0)},onerror:function(){s(!1)}};Lyte.triggerEvent("render",r)})),showTagOpPopupOption:function(e,t,s){if(0!==t){var r=document.getElementById("tagPopover");r&&r.ltProp("show",!1);var i=this.getData("module"),o=store.peekRecord("module",moduleRecordMapping[this.getData("module")].id),a=o.api_name;if("Activities"===a){var n=o.custom_view;a=n.calls_view?"Calls":n.event_view?"Events":n.task_view?"Tasks":i}var c=e+"_TagPopUp",l=document.getElementById(c);null===l?(Lyte.Component.render("crm-tag-modal",{alltags:store.peekAll("tag").filterBy({module_name:a}),from:"list",maxTagLimit:this.getData("maxTagLimit"),recordTagLimit:this.getData("recordTagLimit"),module:a,popUp:e,fromQuickActionsMenu:void 0!==s&&!0===s,disableSaveFromQuickactions:void 0!==s&&!0===s,recordObjForQuickAction:void 0!==s&&!0===s&&"edit"===e?Object.assign({},this.getData("recordObjForQuickAction")):void 0},s?"#tagPopUpShowFromQA":"#tagPopUpShow"),l=$L("#"+c)[0]):$L("#"+e+"_TagComp_list")[0].setData({alltags:store.peekAll("tag").filterBy({module_name:a}),maxTagLimit:this.getData("maxTagLimit"),recordTagLimit:this.getData("recordTagLimit"),fromQuickActionsMenu:void 0!==s&&!0===s,disableSaveFromQuickactions:void 0!==s&&!0===s,recordObjForQuickAction:void 0!==s&&!0===s&&"edit"===e?Object.assign({},this.getData("recordObjForQuickAction")):void 0,selectedtags:void 0!==s&&!0===s&&"edit"===e?[].concat(this.getData("recordObjForQuickAction").Tag):[]}),l.ltProp("offset",{top:"0px",left:"center"}),l.ltProp("show",!0),$L("crm-tag-modal")[0].component.setData("isOverWrite",!1)}},moreActionsValue:function(e,t,s,r){var i="create_call"===e?"NewCall":"create_meetings"===e?"NewEvent":"";""!==i?Q.selectAction(i,void 0,this.getData("module"),"","NewEvent"===i||isNewCallView?"stageView":"listview",void 0,void 0,t,s,"quickAction",r):""===i&&"create_appointment"===e&&(customViewObject.selectedIdForQuickAction=[r],Events.globalCreate("Appointments","listview",t))},updateActions:function(e,t,s,r){var i=document.getElementById("moreActionPopup");i&&i.ltProp("show",!1),(i=document.getElementById("quickActionsOptionsmenu_"+s))&&i.ltProp("show",!1);var o,a=this.getData("module"),n=this.getData("module_info.custom_view.display_value"),c=this.getData("module_info.custom_view.system_name"),l=this.getData("start_index"),d=this.getData("module_info.per_page"),u=this.getData("module_info.custom_view.id"),m=this.getData("module_info.custom_view.sort_by.id"),p=this.getData("module_info.custom_view.sort_order"),_="quickAction"===t?s:customViewObject.selectedIds?customViewObject.selectedIds.join(";"):"";switch(e){case"copy_url":var g=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Lyte.Router.getURL({route:"crm.tab.module.entity.detail",dynamicParams:[this.getData("module"),this.getData("entityId")]});navigator.clipboard.writeText(g),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("pf.url.copy.msg")}});break;case"make_public":case"make_private":case"download_vcard":var v={make_public:"makepublic",make_private:"makeprivate",run_rules:"runRules",download_vcard:"downloadVCard"},f={make_public:"ZMailConfig",make_private:"ZMailConfig",run_rules:"TerritoryConfig",download_vcard:"Template"};massAction(v[e]?v[e]:e,f[e]?f[e]:"","",a,n,u,l+1,l+d,d);break;case"mass_update":case"mass_delete":case"change_owner":"mass_delete"!==e&&"change_owner"!==e||(customViewObject.fromQuickActionsMenu="quickAction"===t);var h={ids:customViewObject.fromQuickActionsMenu?s:this.data.selectedIds};customViewObject.fromQuickActionsMenu&&(h.from="quickAction",h.old_owner_id=this.data.recordObjForQuickAction.Owner?this.data.recordObjForQuickAction.Owner.id:""),Lyte.registeredMixins["crm-mass-action-mixin"].massAction(e,a,h,void 0,void 0,"quickAction"===t?"change_owner":"mass_transfer");break;case"add_to_gtask":addToGCal(a,n,u,l+1,l+d,d,"",o,m,p,"");break;case"bulk_email_unblock":EmailUnblocking.bulkEmaiUnblock(a,this.data.selectedIds);break;case"print_mailing_label":return massAction("printmailinglabels","","",a,"",u,"","","")&&openPopUp("printView",this,"/crm/"+crmPortal+"/MailingLabel.do?mailinglabel=true&module="+a+"&rangeValue="+customViewObject.currentOption+"&cvid="+u+"&searchletter="+"undefined&FROM_INDEX="+customViewObject.fromIndex+"&TO_INDEX="+customViewObject.toIndex+"&printview=true&firstPage=true","sheet",700,600,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),!1;case"hideSelectAllRecords":break;case"bulktask":if(Crm.userDetails.isStorageLimitReached)return void Crm.showStorageExceedPopup();Crm.userDetails.TaskPopup?t&&"quickAction"===t?crmRelatedList.relTaskCreate(this,s,a,a):crmRelatedList.relTaskCreate(this,void 0,void 0,void 0,"bulk"):t&&"quickAction"===t?Q.selectAction("NewTask",void 0,a,"","listview",void 0,void 0,void 0,void 0,"quickAction",s):Q.selectAction("BulkTask",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"quickAction",s);break;case"zia_reminder":crmBstTime.showZiaReminderSettingsforListView(a,u);break;case"mail_merge":if(m&&m.indexOf("##")>-1&&(m=m.split("##",1)),c&&("CONVERTEDVIEWS"===c||"MYCONVERTEDVIEWS"===c))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.mailmerge.cvsupport",I18n.getMsg(a))}}),!1;g=Crm.getCrmBasePath()+"/MailMerge.do?";m||(m=""),g+="action=mergeAction&module="+a+"&previous_sort_column="+m+"&previous_sort_order="+(p=p?"sort_"+p:"");var y={idlist:_};y[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:g,data:y,type:"POST",success:function(e){var t=$L("#lookupdiv");t.addClass("newupdateResponse"),t[0].style.display="block",t[0].style.zIndex=30,t[0].style.width="550px",renderingUtils.freezeBackground(),t.empty(),t[0].innerHTML=e,JSEvalScript(t[0]),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),crmui.modalZIndex("nonLyte",t[0],"open")},error:function(){}});break;case"mass_convert":if(Crm.userDetails.isStorageLimitReached)return void Crm.showStorageExceedPopup();if(customViewObject.selectedIds&&customViewObject.selectedIds.length>Crm.userDetails.massConvertLimit)return void this.setData("showConvertConfirmModal",!0);t&&"quickAction"===t?!r||"Quotes"!==a&&"SalesOrders"!==a?Lyte.Router.transitionTo({route:"crm.tab.module.entity.convert",dynamicParams:[a,s]}):productDetails.convertQuote(a,r,_):showMassConvertDialog(a,_),customViewObject.selectedIdForQuickAction=[];break;case"update_response":var w="SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled;w||(document.getElementById("loadingDiv").style.zIndex=30,$L("#loadingDiv").removeClass("roundedCornerPop").addClass("ppTop")),new AjaxAPI({id:"loadingDiv",url:Crm.getCrmBasePath()+"/SelectResponder.do?module="+a,callbackfn:function(){w||crmui.showPopup("loadingDiv")}}).get();break;case"run_rules":g=Territory.territoryAction+"runRules";var C="idsList="+_+"&module="+a+"&"+Territory.csrf();(new crmRequestPool).initiate({action:g,type:"POST",data:C,success:function(){crmListView.reloadCurrentListView(customViewObject)},error:function(){}});break;case"sendmail":case"sendmail_potential":if(Crm.userDetails.isStorageLimitReached)return void Crm.showStorageExceedPopup("mailAlert");if(customViewObject.selectedIds&&1===customViewObject.selectedIds.length||"quickAction"===t&&null!==s)EntSendMail(a,_,"listview"),customViewObject.selectedIdForQuickAction=[];else if("L"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"F"!==Crm.userDetails.LICENSE_TYPE)if(Crm.userDetails.MassMailUnificationEnabled)networkUtils.loadFeatureScripts(["zohocrm_massmail_unification.js","zohocrm_massmailTemplates.js"],(function(){MassMailUnificationUtil.showMassMailPop(a,"LV",_)}),"undefined"!=typeof MassMailUnificationUtil&&"object"==typeof MassMailUnificationUtil);else{showAnimatePopup("massMailstatsPop");g=Crm.getCrmBasePath()+"/ShowTemplates.do?module="+a,C={idlist:_};$L("#massMailstatsPop").empty(),new AjaxAPI({id:"massMailstatsPop",url:g,params:C}).post()}else sendMailPermissionAlert();break;case"update_data_processing_basis":ConsentLawBasisUpdates.updateConsentType(),Crm.trackSpotLightAction("GDPR - Update Data Processing Click",{Place:"More",Module:a});break;case"send_invite":var b={};b.title=I18n.getMsg("custmr.prtl.bulk.invite.confirm.title"),b.buttons=[];var R={};R.name=I18n.getMsg("custmr.prtl.send.invite"),R.data_zcqa="YesProceedButton",R.id="sendInviteButton",R.action_name="send_bulk_invite",R.isDisabled=!1,R.appearance="primary",R.button_class="fR",R.arguments={},R.arguments.user_type_id=Lyte.Router.getRouteInstance().getDynamicParam(),R.arguments.module=a,R.arguments.clientIds=_,b.buttons.push(R);var M={};M.name=I18n.getMsg("crm.button.cancel"),M.data_zcqa="cancelButton",M.id="cancelButton",M.isDisabled=!1,M.button_class="fL",M.action_name="close_modal",M.appearance="",M.arguments={},b.buttons.push(M),Lyte.Component.render("crm-client-portal-confirmation-modal",b,"body"),Crm.trackSpotLightAction("PORTALS - Bulk Invite Button Clicked",{Place:"Portals",Module:a})}},observeSelectedIds:function(e,t){var s="partialselect",r=e.selectedIds.length,i=Lyte.Router.getRouteInstance().routeName,o=Lyte.Router.getRouteInstance().getQueryParams();o.search_letter&&"All"!=o.search_letter&&(customViewObject.showSelectAll=!1);var a=void 0!==customViewObject.module?moduleRecordMapping[customViewObject.module].actions:void 0;if(a&&a.length){var n=a.filter((function(e){return"hideSelectAllRecords"==e.name}));customViewObject.showSelectAll=!n.length&&customViewObject.showSelectAll}var c,l=e.unCheckedEntitiesCount;e&&e.data&&(c=$L("#"+e.data)),0!=l&&null==l&&(e.data?l=c.find(".customCheckBox[data-cid=selectEntity]").length:(l="list"===i||"view-usage"===i?$L(".lyteExpTableOrigTableInnerWrap .lyteExpTableRowGroup .customCheckBox").length:$L("#viewcontainer .customCheckBox").length,"canvas"===i&&(l=$L("#viewcontainer .canvasviewrecordlayer .customCheckBox").length)));var d="list"===i||"view-usage"===i?$L(".lyteExpTableOrigTableInnerWrap .lyteExpTableRowGroup .customCheckBoxChecked").length:$L("#viewcontainer .customCheckBoxChecked").length;"kanban"===i&&c&&(l=c.find(".customCheckBox").length,d=c.find(".customCheckBoxChecked").length),"canvas"===i&&(d=$L("#viewcontainer .canvasviewrecordlayer .customCheckBoxChecked").length);var u=moduleRecordMapping[e.module],m=(f=$L("crm-customview-buttons")).length;if(0==r)s="customCheckBox",delete customViewObject.selectAllHistory,$L("#custom_layer_table").removeClass("cvtransform"),this.hideButtonLayer=setTimeout(function(){customViewObject.doMassActioninScheduler=!1,f&&f[0]&&(f[0].setData("selectAllEntity",!1),f[0].setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1);var e=document.getElementsByTagName("crm-custom-filter")[0];e&&e.classList.remove("selectAllOverlay");var t=document.getElementById("viewcontainer");t&&t.classList.remove("selectAllOverlay"),$L("crm-customview-layer").css({visibility:"visible"}),$L("#listviewButtonLayer").css({visibility:"hidden"}),("chart"===i||this.data&&"CHARTVIEWS"===this.data.featureName)&&$L("#chartviewButtonLayer").css({visibility:"hidden"})}.bind(this),200),delete this.startIndex;else{if(clearTimeout(this.hideButtonLayer),u.$.set("start_index",e.start_index),"view-usage"!==i&&"mass-tools"!==i&&"find-and-merge"!==i){if(f.length)f=f[0],e.showSelectDiv=e.showSelectDiv?e.showSelectDiv:f.getData("showSelectedDiv"),customViewObject.showHideSelectAllDiv=e.showSelectDiv;else{customViewObject.showHideSelectAllDiv=e.showSelectDiv;var p=document.querySelector("crm-custom-outer-box");p&&((p=null==p?$L("crm-workflow-reports")[0]:p).setData("selectedIds",e.selectedIds),f=p.querySelector("crm-customview-buttons"))}f.setData({module:e.module,total_count:customViewObject.totalCount,start_index:e.start_index,page:e.page,actions:moduleRecordMapping[e.module].actions,parent_comp:e.parent_comp,showSelectedDiv:e.showSelectDiv}),$L("#custom_layer_table").addClass("cvtransform"),e.parent_comp&&f.setData("parent_comp",e.parent_comp),t||setTimeout((function(){$L("#listviewButtonLayer").css({visibility:"visible"});const e=f.getData("cscript_restricted_actions");e&&e.size&&e.forEach((e=>{$(`[cscript-tag="${e}"`).addClass("op6 peNone")}))}),200)}if(t){var _=1===r?I18n.getMsg("crm.record.not.accessible"):I18n.getMsg("records"),g=$L("crm-customview-layer");if(g[0].component.setData("selected",I18n.getMsg("crm.listview.selected.records",[r,_])),$L("#modal_buttons_layer").css({visibility:"visible"}),"chart"===i||"CHARTVIEWS"===this.data.featureName){var v=g.length;1===m&&Lyte.Component.render("crm-customview-buttons",{module:e.module,total_count:customViewObject.totalCount,start_index:e.start_index,page:e.page,actions:moduleRecordMapping[e.module].actions,selectedIds:e.selectedIds,parent_comp:e.parent_comp,showSelectedDiv:e.showSelectDiv},"#chartviewButtonLayer"),$L("crm-voc-component").length&&0===m&&(u.chart_view=!0,Lyte.Component.render("crm-customview-buttons",{module_info:u,module:e.module,total_count:customViewObject.totalCount,start_index:e.start_index,page:e.page,actions:moduleRecordMapping[e.module].actions,selectedIds:e.selectedIds,parent_comp:e.parent_comp,showSelectedDiv:e.showSelectDiv},"#chartviewButtonLayer")),g[v-1].component.setData("selected",I18n.getMsg("crm.listview.selected.records",[r,_])),setTimeout((function(){$L("#chartviewButtonLayer").css({visibility:u.actions?"visible":"hidden"})}),200)}}this.startIndex=this.startIndex&&this.startIndex<e.page?this.startIndex:e.page,(1==e.customview_recordlen||0==l)&&r>=1&&(s="customCheckBoxChecked","view-usage"!==i&&"mass-tools"!==i&&"find-and-merge"!==i&&f.setData("displayOnlineEntities",!1)),0==d&&(s="customCheckBox"),"customCheckBoxChecked"==s&&(e.showSelectDiv=!0,this.checkSelectedDiv(u,f,e),customViewObject.selectAllHistory||(customViewObject.selectAllHistory=[]),!customViewObject.selectAllHistory.contains(e.page)&&customViewObject.selectAllHistory.push(e.page)),"partialselect"==s&&r<u.per_page&&"view-usage"!==i&&(d>=r&&0!=l?f.setData("showSelectedDiv",!1):f.setData("showSelectedDiv",e.showSelectDiv),customViewObject.showHideSelectAllDiv=f.getData("showSelectedDiv"))}if("list"===i||"view-usage"===i||t||"canvas"===i)this.$node.querySelectorAll("[id='selectCheckbox']").forEach((function(e){if(e){var t=e.querySelector("span");t.classList="",t.classList=s,e.ltProp("class",s)}}));else if("kanban"===i){var f,h=$L("crm-kanbanview-component")[0].querySelectorAll("#selectAll_"+e.data)[0],y="customCheckBoxChecked"===s;if(h&&e.boardDetail)if(Lyte.objectUtils(e.boardDetail,"add",{selectAll:y,boardClass:s}),f=$L("crm-customview-buttons")[0]){var w=!!document.querySelectorAll(".selectCheckbox .customCheckBoxChecked").length;f.setData("showSelectedDiv",w),customViewObject.showHideSelectAllDiv=w}}customViewObject.selectedIds=e.selectedIds,"view-usage"!==i&&"mass-tools"!==i&&"find-and-merge"!==i&&!u.kanban_view&&r&&["customCheckBox","partialselect"].contains(s)&&f&&(f=f[0]?f[0]:f,customViewObject.selectAllHistory&&-1!=customViewObject.selectAllHistory.indexOf(e.page)&&customViewObject.selectAllHistory.removeFirstOccurenceOfElement(e.page),f.getData("showSelectedDiv")&&(customViewObject.selectAllHistory&&customViewObject.selectAllHistory.length||(f.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1)))},checkSelectedDiv:function(e,t,s){var r=Lyte.Router.getRouteInstance().getQueryParams().filters;customViewObject.totalCount=customViewObject.totalCount?customViewObject.totalCount:e.total_count,e.total_count=e.total_count?e.total_count:customViewObject.totalCount,customViewObject.filters||customViewObject.cross_filters||customViewObject.filter_id||!featuresAvailable.Schedule_Mass_Operation||(r||!e.total_count&&!customViewObject.totalCount?void 0!==t&&0!==t.length&&!r&&s.showSelectDiv&&0!=customViewObject.showSelectAll&&(customViewObject.showHideSelectAllDiv=!0,t.setData("showSelectedDiv",!0)):Crm.massOperationTotalLimit>=e.total_count&&customViewObject.totalCount>s.selectedIds.length&&0!=customViewObject.showSelectAll&&(customViewObject.showHideSelectAllDiv=!0,t.setData("showSelectedDiv",!0)))},selectAllEntity:function(e,t,s,r,i){var o=this.getData("massConvertLimit"),a=Lyte.Router.getRouteInstance().routeName,n=document.getElementsByTagName("crm-custom-outer-box")[0];if("CHARTVIEWS"===this.getData("featureName")){n=document.getElementsByTagName("crm-list-view-modal")[0];this.setHeight()}if("mass-tools"===a){r=(c=$L("crm-mass-tools")[0]).component.data.selectedIds;n=c}else if("find-and-merge"===a){r=(c=$L("crm-find-merge")[0]).component.data.selectedIds;(n=c).setData("prevSelectedId","")}else{if("chart"===a){var c;r=(c=$L("crm-list-view-modal")[0]).component.data.selectedIds;n=c}var l=document.getElementsByTagName("crm-list-view")[0],d=$L("crm-workflow-reports")[0];r=(n=void 0===n?d:n).getData("selectedIds");n.setData("prevSelectedId","")}var u,m=!1,p=[];if("kanban"===a){l=$L("crm-kanbanview-component")[0];u=(i=i||{selectedIds:r,page:0,per_page:10,module:this.getData("module"),start_index:0,parent_comp:this.getData("parent_comp"),categoryList:l?l.getData("categoryList"):[]}).data?document.querySelector("#selectAll_"+i.data):void 0,p=i.boardDetail?i.boardDetail.cards:customViewObject.customview_records?customViewObject.customview_records:[]}else u=document.querySelector("[id='selectCheckbox']");if(i=i||{selectedIds:r,page:this.getData("page"),per_page:this.getData("module_info").per_page,module:this.getData("module"),start_index:this.getData("start_index"),parent_comp:this.getData("parent_comp")?this.getData("parent_comp"):"crm-custom-outer-box"},"list"===a||"kanban"===a||"canvas"===a||"mass-tools"===a||"find-and-merge"===a||"view-usage"===a||"chart"===a||n.getData("isFromModal")){var _=this,g=!1,v=!0,f=u?u.ltProp("class"):"customCheckBoxChecked",h="canvas"===a||"card"===a?"crm-list-view-canvas":"crm-inner-list",y=void 0===l?document.getElementsByTagName(h)[0]:l,w=(p=p.length?p:y.getData("customview_records")).length;if("customCheckBox"===f&&!e||t&&"partialselect"===f||t&&"kanban"===a){var C=[];if(!g){for(var b=!1,R=0;R<w;R++)if("view-usage"!==a||!(null!==p[R].reason_for_exclusion||p[R].$deleted_record&&(null==p[R].record||!p[R].$retry_enabled)||p[R].$converted_record||p[R].$retry_limit_reached||!p[R].$retry_enabled||p[R].$stop_processing||"email_notification"===p[R].action.type&&null===p[R].associated_to||"email_notification"===p[R].action.type&&null!=p[R].Data_Processing_Basis_Details&&!p[R].Data_Processing_Basis_Details.Contact_Through_Email||null!==p[R].retry_mode_in_progress)){var M=this.getData("type");if("convert"==M&&!customViewObject.doMassActioninScheduler&&r.length+C.length==o){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.convert.alert",o)),i.showSelectDiv=!1,m=!1;break}if("merge"===M&&!customViewObject.doMassActioninScheduler&&r.length+C.length>2){_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.listview.maximum.records.alert","3")}}),i.showSelectDiv=!1,m=!1;break}if("PORTALS"===n.getData("featureName")&&r.length+C.length==200){_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.listview.maximum.records.alert",200),ltPropContentAlign:"center",ltPropWrapperClass:"crmCenterAlert"}}),i.showSelectDiv=!1,m=!1;break}if(r.length+C.length==crmConstants.maxSelectCount&&!customViewObject.doMassActioninScheduler){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)),i.showSelectDiv=!1,m=!1;break}if(m=!0,(!_.waitingForApproval(p[R],n.getData("featureName"))||"mass-tools"===a)&&-1===r.indexOf(p[R].id)){if("undefined"!=typeof CrmTracking&&CrmTracking.isEntityOnline(this.getData("module"),p[R].id))b=!0;else if(s){v=!1;continue}var D="canvas"===a?document.querySelectorAll("#crm-list-view-canvas-row-"+p[R].id):document.querySelectorAll("lyte-exptable-tr[id='"+p[R].id+"']"),k=!1;C.push(p[R].id),"kanban"===a?Lyte.objectUtils(p[R],"add",{select:!0,highlightClass:"kv-card-selected"}):D.forEach((function(e){var t=e.querySelector("lyte-checkbox");if(t&&"customCheckBox"==t.ltProp("class")){t.ltProp("class","customCheckBoxChecked"),e.style.backgroundColor="setTdBorBtm";var s=t.querySelector("span");s.classList.remove("customCheckBox"),s.classList.add("customCheckBoxChecked"),e.classList.add("listViewRowSelected")}}))}}_&&_.$node&&"CRM-LIST-VIEW-CANVAS"==_.$node.tagName||i.per_page<_.getData("total_count")&&(i.showSelectDiv=!0);var L=document.querySelector("crm-customview-buttons");b&&L&&!L.getData("displayOnlineEntities")&&L.setData("displayOnlineEntities",!0)}Lyte.arrayUtils(r,"push",C),crmListView.startIndex[customViewObject.fromIndex]?crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]+C.length:crmListView.startIndex[customViewObject.fromIndex]=C.length}else if(!g){for(R=0;R<w;R++){var I=r.indexOf(p[R].id);k=!1;if("kanban"===a)Lyte.objectUtils(p[R],"add",{select:!1,highlightClass:""});else{k=!1;(D="canvas"===a?document.querySelectorAll("#crm-list-view-canvas-row-"+p[R].id):document.querySelectorAll("lyte-exptable-tr[id='"+p[R].id+"']")).forEach((function(e){var t=e.querySelector("lyte-checkbox");if(t&&"customCheckBoxChecked"==t.ltProp("class")){t.ltProp("class","customCheckBox"),e.style.backgroundColor="";var s=t.querySelector("span");s.classList.remove("customCheckBoxChecked"),s.classList.add("customCheckBox"),e.classList.remove("listViewRowSelected")}}))}!k&&I>-1&&(Lyte.arrayUtils(r,"removeAt",I,1),k=!0,crmListView.startIndex[customViewObject.fromIndex]&&(crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]-1),0==crmListView.startIndex[customViewObject.fromIndex]&&delete crmListView.startIndex[customViewObject.fromIndex])}var E=$L("crux-smart-filter");if(E.length>0){var j=E[0].component.getFilterCriteria();if(j&&"competitor_alert"===j.preventSaveFilter){var A=$L("#saveBtn");A.length>0&&A[0].component.setData("ltPropDisabled",!0)}}if("mass-tools"!==a&&"find-and-merge"!==a){i.showSelectDiv=!1;var O=$L("crm-customview-layer")[0];(O=void 0!==O?O:d).style.visibility="visible"}}g=!0;var S=document.querySelectorAll("[id='selectCheckbox']");if("kanban"===a){let e=!(!m||!v);if(i.boardDetail)setTimeout((()=>{Lyte.objectUtils(i.boardDetail,"add","selectAll",e)}));else{(i.categoryList?i.categoryList:[]).forEach((function(t){Lyte.objectUtils(t,"add",{selectAll:e,boardClass:e?"customCheckBoxChecked":"customCheckBox"})}))}}else S.forEach((function(e){var t=e?e.querySelector("span"):void 0;m&&v?(e.ltProp("class","customCheckBoxChecked"),t.classList.remove("customCheckBox"),t.classList.add("customCheckBoxChecked")):t&&(t.classList.remove("customCheckBoxChecked"),t.classList.add("customCheckBox"),e.ltProp("class","customCheckBox"))}));let c=_.getData("parent_comp")?_.getData("parent_comp"):"crm-custom-outer-box";var P=document.getElementsByTagName(c)[0];P||(P=n),P.setData("selectedIds",r),i.selectedIds=r}if(e&&("mass-tools"!==a&&"find-and-merge"!==a?n.setData("selectedIds",[]):P.setData("selectedIds",[]),i.selectedIds=[],crmListView.startIndex={}),this.getData("customview_records")&&(i.customview_recordlen=this.getData("customview_records").length),"mass-tools"!==a&&"find-and-merge"!==a&&(this.observeSelectedIds(i,this.getData("isFromModal")),e&&("list"===a||"kanban"===a||n.getData("isFromModal")?l.component.setData("selectedIds",[]):"view-usage"===a?d.setData("selectedIds",[]):"canvas"===a?document.getElementsByTagName("crm-list-view-canvas")[0].component.setData("selectedIds",[]):crmListView.selectAllEntity())),"mass-tools"===a||"find-and-merge"===a){var T=P.getData("selectedIds").length;T?(P.setData("showActionBtn",!0),1===T?this.setData("selectedMsg",I18n.getMsg("crm.masstool.record.selected",1)):this.setData("selectedMsg",I18n.getMsg("crm.masstool.records.selected",T))):P.setData("showActionBtn",!1)}},selectedEntity:function(e,t,s,r,i,o,a){var n=this.getData("massConvertLimit"),c=document.getElementsByTagName("crm-custom-outer-box")[0];if("CHARTVIEWS"===this.getData("featureName")){c=document.getElementsByTagName("crm-list-view-modal")[0];this.setHeight()}if("merge"===i)c=$L("crm-find-merge")[0];else if("mass-tools"!==i){(c=void 0===c?document.getElementsByTagName("crm-workflow-reports")[0]:c)&&(s=c.getData("selectedIds"),r=c.getData("prevSelectedId"))}else c=$L("crm-mass-tools")[0];var l=o&&o.length?o[0].querySelector(".crmlistview-canvas-selectionbox").ltProp("class"):$("#"+e.id+" lyte-checkbox")[0].ltProp("class");if(event&&1==event.shiftKey&&r&&r!=e.id){var d=$L("#selectEntity_"+r)[0].component.data.dataRecnum-1,u=$L("#selectEntity_"+e.id)[0].component.data.dataRecnum-1,m=this.getData("module_info").start_index;if(d-=m,u-=m,"customCheckBox"==l)if(u<d)for(var p=d;p>=u;p--){if(s.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(!this.waitingForApproval(t[p],c.getData("featureName"))){var _=t[p].id;s.contains(_)||this.selectEntityCommon(_,"customCheckBox",void 0,void 0,c,o)}}else for(p=d;p<=u;p++){if(s.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(!this.waitingForApproval(t[p],c.getData("featureName"))){_=t[p].id;s.contains(_)||this.selectEntityCommon(_,"customCheckBox",void 0,void 0,c,o)}}else if(u<d)for(p=d;p>=u;p--){_=t[p].id;s.contains(_)&&this.selectEntityCommon(_,"customCheckBoxChecked",void 0,void 0,c,o)}else for(p=d;p<=u;p++){_=t[p].id;s.contains(_)&&this.selectEntityCommon(_,"customCheckBoxChecked",void 0,void 0,c,o)}a={selectedIds:s,per_page:this.getData("module_info").per_page,page:this.getData("page"),module:this.getData("module"),start_index:this.getData("module_info").start_index,customview_recordlen:this.getData("customview_records").length,parent_comp:this.getData("parent_comp")};return this.observeSelectedIds(a,c.getData("isFromModal")),!1}var g=this.getData("type");s&&"merge"===g&&s.length>2&&"customCheckBoxChecked"!==l?_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.listview.maximum.records.alert","3")}}):s&&"convert"===g&&s.length===n&&"customCheckBoxChecked"!==l?renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.convert.alert",n)):s&&200===s.length&&"PORTALS"===c.getData("featureName")&&"customCheckBoxChecked"!==l?_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.listview.maximum.records.alert",200),ltPropContentAlign:"center",ltPropWrapperClass:"crmCenterAlert"}}):s&&s.length===crmConstants.maxSelectCount&&"customCheckBoxChecked"!==l?renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)):this.selectEntityCommon(e.id,l,void 0,void 0,c,o,i,a)},selectEntityCommon:function(e,t,s,r,i,o,a,n){var c=i?i.getData("selectedIds"):this.getData("selectedIds");i&&!a&&(a="listview");var l=o||document.querySelectorAll("lyte-exptable-tr[id='"+e+"']");"kanban"===a&&(l=document.querySelectorAll("#detailView_"+e));var d=this;l.forEach((function(r){var l=r.querySelector("lyte-checkbox"),u=l.querySelector("span");if("customCheckBox"==t&&"selectAllEntity"!=e){if(-1==c.indexOf(e)&&(Lyte.arrayUtils(c,"push",e),crmListView.startIndex[customViewObject.fromIndex]?crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]+1:crmListView.startIndex[customViewObject.fromIndex]=1),a){var m=document.querySelector("crm-customview-buttons");if(("Leads"==d.getData("module")||"Contacts"==d.getData("module"))&&m&&!m.getData("displayOnlineEntities")&&"undefined"!=typeof CrmTracking){var p=document.getElementsByTagName("crm-list-view")[0];p||(p=document.getElementsByTagName("crm-list-view-canvas")[0]);for(var _=p?p.getData("customview_records"):n?n.boardDetail.cards:[],g=_.length,v=0;v<g;v++)if(CrmTracking.isEntityOnline(d.getData("module"),_[v].id)){m.setData("displayOnlineEntities",!0);break}}}l.ltProp("class","customCheckBoxChecked"),u.classList.remove("customCheckBox"),u.classList.add("customCheckBoxChecked"),"kanban"===a?Lyte.objectUtils(store.peekRecord(d.getData("moduleInfo").id,e),"add",{highlightClass:"kv-card-selected"}):$L(r).addClass("listViewRowSelected")}else c.indexOf(e)>-1&&(Lyte.arrayUtils(c,"removeAt",c.indexOf(e),1),crmListView.startIndex[customViewObject.fromIndex]&&(crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]-1),0==crmListView.startIndex[customViewObject.fromIndex]&&delete crmListView.startIndex[customViewObject.fromIndex]),l.ltProp("class","customCheckBox"),u.classList.remove("customCheckBoxChecked"),u.classList.add("customCheckBox"),"kanban"===a?Lyte.objectUtils(store.peekRecord(d.getData("moduleInfo").id,e),"add",{highlightClass:""}):$L(r).removeClass("listViewRowSelected");var f=document.getElementsByTagName(d.getData("parent_comp"))[0];f&&f.setData("selectedIds",c),"selectAllEntity"!==s&&"listview"===a&&(i.setData("prevSelectedId",e),n={selectedIds:c,page:d.getData("page"),per_page:d.getData("module_info").per_page,module:d.getData("module"),start_index:d.getData("module_info").start_index,customview_recordlen:d.getData("customview_records").length,parent_comp:d.getData("parent_comp")},($L(r).parents(".lyteExpTableOrigTableInnerWrap").length||o)&&d.observeSelectedIds(n,d.getData("isFromModal"))),"kanban"===a&&(n.selectedIds=c,d.observeSelectedIds(n,d.getData("isFromModal")))}))},reloadCurrentView:function(e,t,s,r){r=r||!1;crmTab.deleteFromCache(e);var i=$L("crm-customview-buttons")[0];i&&i.setData("selectAllEntity",!1),this.hideCVbtns();var o=Lyte.Router.getRouteInstance();if("list"===s){var a=o.getQueryParams(),n=document.getElementsByTagName("crm-list-view")[0],c=n?n.component.startIndex:void 0;t&&!a.page?(t=crmHistory.getPageDetailsFromIndex(t.fromIndex,t.toIndex)).page===a.page&&t.perPage===a.per_page||!a.page||!a.per_page?o.refresh().data={clearCache:!0}:o.setQueryParams({page:a.page,per_page:a.per_page}).data={clearCache:!0}:c&&a.page&&a.page!==c?o.setQueryParams("page",c).data={clearCache:!0}:o.refresh().data={clearCache:!0,hideSelectAll:r}}else{var l={};"crm.tab.module.custom-view.kanban"===o.transition.target&&(l.reloadAll=!0),"crm.tab.module.custom-view.chart"===o.transition.target&&(l.reloadAll=!0),o.refresh().data=l}},mouseOverCustomButton:function(e,t,s,r){mouseOverCustomButton(e,t,s,r,null)},mouseOverCustomButton:function(e,t,s,r,i){var o=document.getElementsByTagName("crm-custombuttons-popover");0==o.length&&(o=Lyte.Component.render("crm-custombuttons-popover","","#crmCustomButton")),clearTimeout(this.disp_popover),this.disp_popover=setTimeout((function(){var s=store.peekRecord("custom_button",t);i?o.component?o.component.onMouseOver("."+e+t+i,s.name,s.description,"left"):o[0].component.onMouseOver("."+e+t+i,s.name,s.description,"left"):o.component?o.component.onMouseOver("."+e+t,s.name,s.description,"left"):o[0].component.onMouseOver("."+e+t,s.name,s.description,"left")}),3e3)},mouseOutCustomButton:function(){var e=$L("#customButtonPopover");e&&e[0]&&e[0].ltProp("show",!1),clearTimeout(this.disp_popover)},executeCustomButton:function(e,t,s,r,i){if(commonUtils.showHideLoadingDiv(!0),!this.requestButtonSend){var o=moduleRecordMapping[this.getData("module")].id,a={button_id:e,type:"POST"};a.ids=t?[t]:r||"";var n={};i&&(i.hasOwnProperty("cvId")&&(n.cvid=i.cvId),i.hasOwnProperty("pageNo")&&(n.page=i.pageNo)),this.requestButtonSend=!0,s=s||"eachRecord",this.triggerCustomButtonAction(this,o,a,n,s,t)}event&&(event.stopPropagation(),event.preventDefault())},triggerCustomButtonAction:function(e,t,s,r,i,o,a){var n=store.peekRecord("custom_button",s.button_id);"kiosk"===n.action&&((r={}).id=s.button_id,s.isKioskBtn=!0,""===s.ids&&(s.ids=null)),"component"===n.action&&(s.fromLux=!0),store.triggerAction(t,"custom_buttons",s,r,void 0,Crm.userDetails.isRelatedListLyteEnabled?a:void 0).then((function(a){var c;commonUtils.showHideLoadingDiv(),"kiosk"===n.action?c=a.execute_custom_button[0].details:(e.requestButtonSend=!1,c=a.details),e.executeCustomButtons(c,s.button_id,o,i,t,r,s)}),(function(t){var s=t.response?JSON.parse(t.response):{},r=s.hasOwnProperty("details")?s.details:{},i=!!r.hasOwnProperty("creator_error")&&"TOO_MANY_REQUESTS"==r.creator_error,o=!!s.hasOwnProperty("message")&&"circuit call has reached its maximum limit"==s.message,a=!!s.hasOwnProperty("code")&&"ACCOUNT_FREEZED"==s.code,n=!!s.hasOwnProperty("code")&&"TYPE_NOT_ALLOWED"==s.code,c=!!s.hasOwnProperty("code")&&"RECORD_LOCKED"===s.code;if(e.requestButtonSend=!1,commonUtils.showHideLoadingDiv(),i)crmui.showMsgBand("error","Sorry, the action can’t be performed as you have reached the allowed functions call limit that can be made in the last 24 hours",2500);else if(o)s.hasOwnProperty("details")&&(s.details.hasOwnProperty("limit")&&0===s.details.limit)?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.button.feature.not.available",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.limit.exceeded"),5e3);else if(a)Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.admin",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.nonadmin",Crm.brandName),5e3);else if(n)Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),5e3);else if(c)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.record.locking.permission.denied"),ltPropType:"error",ltPropDuration:5e3}});else if(500!=s.status)if("INVALID_MODULE"!==s.code){if("NO_PERMISSION"!==s.code)return 400===t.status?s.details&&"SOCKET_CLOSED"===s.details.creator_error?void crmui.showMsgBand("warning",I18n.getMsg("crm.custombutton.function.time.exceed"),1500):"the button is under lock for the current record"===s.message||"the button is under lock for all the given records"===s.message?void _cruxUtils.showCustomMessage({id:"buttonLock",params:{ltPropType:"error",ltPropOffset:{top:"56"},ltPropMessage:I18n.getMsg("crm.record.action.restricted"),ltPropDuration:1500}}):void crmui.showMsgBand("error",s.message,1500):void(500!==t.status||crmui.showMsgBand("warning",I18n.getMsg("crm.workflow.save.error"),3e3));renderingUtils.displayPermissionDenied()}else renderingUtils.displayPermissionDenied();else crmui.showMsgBand("warning",I18n.getMsg("crm.security.error.add.user"),1500)}))},clearCustomButtonCache:function(e){store.clearCachedQuery("custom_button","custom_button_"+e)},filterButtonData(e,t){return e=this.filterButtonsByPosition(e,t.position,t.relatedListApiName),e=this.filterButtonsByLayout(e,t.layoutId),e=this.filterButtonsByProfile(e,t.profileId,t.configurationPage,t.moduleName)},filterButtonsByPosition:(e,t,s)=>e&&e.length&&t&&s&&"related_list"===t?e.filter((e=>e.details&&e.details.related_list&&e.position===t&&e.details.related_list.api_name===s)):e&&e.length&&t?e.filter((e=>e&&e.position===t)):e||[],filterButtonsByLayout:(e,t)=>e&&e.length&&t?e.filter((e=>!(!e.layouts||!e.layouts.length)&&e.layouts.some((e=>e&&e.id===t)))):e||[],filterButtonsByProfile(e,t,s,r){const i=["canvas","wizard"],o=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM;if(!t&&r){const e=moduleRecordMapping[r];if(e){const s=e.access_type;t="team_based"===s?moduleRecordMapping[r].private_profile.id:Crm.userDetails.PROFILE_ID}}return t||(t=Crm.userDetails.PROFILE_ID),e&&e.length&&t?e.filter((e=>{if(e.profiles&&e.profiles.length||e.user_types&&e.user_types.length){const r=e&&e.profiles&&e.profiles.some((e=>e&&e.id===t)),a=e&&e.user_types&&e.user_types.some((e=>e&&e.id===t)),n=o&&i.includes(s)&&e.user_types&&e.user_types.length&&(!e.profiles||!e.profiles.length);return r||a||n}return!1})):e||[]},getCustomButtonApiPromise(e){if(e&&e.moduleApiName){let t={};return t.module=e.moduleApiName,e.fields&&(t.fields=e.fields),store.findAll("custom_button",t,!0,!0,{isV6Api:!0})}},hideCVbtns:function(){var e=document.getElementsByTagName("crm-custom-outer-box")[0];e&&e.setData("selectedIds",[]),customViewObject.selectedIds=[],$L("#listviewButtonLayer").length>0&&$("crm-customview-buttons")[0]&&($L("#custom_layer_table").removeClass("cvtransform"),document.getElementsByTagName("crm-custom-filter")[0].classList.remove("selectAllOverlay"),document.getElementById("viewcontainer").classList.remove("selectAllOverlay"),setTimeout((function(){$L("#listviewButtonLayer").css({visibility:"hidden"})}),200))},isOldCriteria:function(e){return!(!e[0]||!e[0].searchfieldtype)},getDateCompValue:function(e){if(-1!=e.value.indexOf("$"))return e;if("equal"==e.comp&&(e.comp="between",e.value=[e.value,e.value]),"between"==e.comp||"not_between"==e.comp){e.value="string"==typeof e.value?e.value.split(","):e.value,e.value[0]=this.getISODateStartTime(Utils.convertDateToUserPattern(e.value[0])),e.value[1]=this.getISODateEndTime(Utils.convertDateToUserPattern(e.value[1]));var t=/^(.*)T/.exec(e.value[0])[1],s=/^(.*)T/.exec(e.value[1])[1];e.value="D"==e.criteria.searchfieldtype?[t,s]:e.value}else if(-1!=["greater_than","less_than"].indexOf(e.comp)){e.value=this.getISODateStartTime(Utils.convertDateToUserPattern(e.value));t=/^(.*)T/.exec(e.value)[1];e.value="D"==e.criteria.searchfieldtype?t:e.value}return e},oldCriteria_to_newCriteria:function(e,t){var s,r={},i=[],o=[],a=[],n=e.length,c={0:"equal",1:"not_equal",2:"contains",3:"not_contains",4:"greater_equal",5:"greater_than",6:"less_equal",7:"less_than",10:"starts_with",11:"ends_with",14:"between",15:"not_between"},l=function(e){-1!=e.indexOf(",")&&(e=e.split(","));for(var t=(e="string"==typeof e?[e]:e).length,s=[],r=0;r<t;r++)s.push({id:e[r]});return s};for(s=0;s<n;s++){var d=e[s].searchfield;$=e[s].value,B=c[e[s].condition];var u=d.split(":");if(1==$||!$||-1==$.indexOf("LASTDAYS")&&-1==$.indexOf("LASTAGE"))if(1!=$&&$&&"-1"!=$.indexOf("${AGE")){m=/\d+/i.exec($)[0],p="-1"!=$.indexOf("WEEKS")?"WEEKS":"-1"!=$.indexOf("MONTHS")?"MONTHS":"DAYS";$="${DUEIN"+p+"}+"+m,B="less_equal"}else 1!=$&&$&&"-1"!=$.indexOf("${")&&(B="${NOTEMPTY}"==$?"less_equal":"equal",$="${NEXT7DAYS}"==$?"${DUEINDAYS}+7":$);else{var m=/\d+/i.exec($)[0],p="-1"!=$.indexOf("WEEKS")?"WEEKS":"-1"!=$.indexOf("MONTHS")?"MONTHS":"DAYS";$="${AGEIN"+p+"}+"+m,B="less_equal"}if("-1"!=d.indexOf("TOUCHED")||"-1"!=d.indexOf("UNTOUCHED")||"-1"!=d.indexOf("RECORDACTION")||"-1"!=d.indexOf("RELRECORDACTION")){$="${NOTEMPTY}"==$?"${CURRENTTIME}":$;var _={TOUCHED:"TouchedRecords",UNTOUCHED:"UnTouchedRecords",RECORDACTION:"RecordAction",RELRECORDACTION:"RelatedRecordsAction"},g={BOTH:"UserAndSystem",EITHER:"UserOrSystem",USER:"User",SYSTEM:"System",USERONLY:"OnlyByUser",SYSTEMONLY:"OnlyBySystem"};if(r.is_modified="","-1"!=d.indexOf("RECORDACTION")||"-1"!=d.indexOf("RELRECORDACTION")?(r.is_modified=u[2],r.by=g[u[3]]):r.by=g[u[2]],r.field={},r.api_name=_[u[1]],r.value=$,r.comparator=B,!(I=this.specialfield(r,r.by,r.value,r.comparator,r.is_modified)))return"";i.push(I),r={}}else if("ACT"==e[s].searchfieldtype){r.api_name="Activities",r.comparator=B,r.value=$;_=d.split(":");if(h={OVERDUE:"Activities",WITHOUTOPEN:"Without_Open_Activity",DUE:"Activity_Due",MODIFIEDTIME:"Without_Any_Activity",COMPLETED:"Activity_Done"},r.by=h[_[1]],"Tasks"!=_[0]&&"Calls"!=_[0]||(r.by=_[0]),r.value&&r.comparator){var v=this.getDateCompValue({criteria:e[s],value:r.value,comp:r.comparator});r.comparator=v.comp,r.value=v.value}if(!(I=this.specialfield(r,r.by,r.value,r.comparator)))return"";o.push(I)}else if("EMA"==e[s].searchfieldtype){r.api_name="Email_Status",r.comparator=B,r.value=$;_=d.split(":");if("-1"!=e[s].searchfield.indexOf("LAST_SENT_TIME"))r.by="sent",r.sub_status={SENT_OPENED:"opened",NOTOPENED:"not_opened",BOUNCED:"bounced",OPENEDNOTREPLIED:"opened_and_not_replied",SENT:"any_of_the_above"}[_[2]];else{var f=_[1]+":"+_[2];r.by={LAST_SENT_TIME:"sent","NOT_SENT:NOTSENT":"not_sent","LAST_ACTION_TIME:OPENED":"opened","NOT_OPENED:NOTOPENED":"not_opened","LAST_ACTION_TIME:RECEIVED":"received","NOT_RECEIVED:NOTRECEIVED":"not_received","LAST_ACTION_TIME:BOUNCED":"bounced","LAST_ACTION_TIME:OPENEDNOTREPLIED":"opened_and_not_replied"}[f]}v=this.getDateCompValue({criteria:e[s],value:r.value,comp:r.comparator});if(r.comparator=v.comp,r.value=v.value,!(I=this.specialfield(r,r.by,r.value,r.comparator,r.sub_status)))return"";i.push(I)}else if("NOT"==e[s].searchfieldtype){r.api_name="Notes",r.comparator=B,r.value="${EMPTY}"==$?"${NOTEMPTY}":$;_=d.split(":");r.by=null!=_[2]?"Without_Any_Notes":"Notes_Added";v=this.getDateCompValue({criteria:e[s],value:r.value,comp:r.comparator});if(r.comparator=v.comp,r.value=v.value,!(I=this.specialfield(r,r.by,r.value,r.comparator)))return"";o.push(I)}else if("POT"==e[s].searchfieldtype){r.api_name="Deals",r.comparator=B,r.value=$;_=d.split(":");var h={WITHOUTOPEN:"Without_Open_Deal",WITHOPEN:"With_Open_Deal",CREATEDTIME:"Without_Any_Deal"};r.by=h[_[1]],this.preventDealField="With_Open_Deal"!=r.by;v=this.getDateCompValue({criteria:e[s],value:r.value,comp:r.comparator});if(r.comparator=v.comp,r.value=v.value,!(I=this.specialfield(r,r.by,r.value,r.comparator)))return"";if(this.preventDealField)for(var y=o.length,w=0;w<y;w++)if("Deals"==o[w].relation.api_name){o.splice(w,1);break}this.updateCrossFilter(o,"Deals",I)}else if("CHATS"==e[s].searchfieldtype){r.api_name="Chats",r.comparator=B,r.value="${EMPTY}"==$?"${NOTEMPTY}":$;_=d.split(":");r.by="CHATSMISSED"==_[1]?"Missed":"Attended";v=this.getDateCompValue({criteria:e[s],value:r.value,comp:r.comparator});if(r.comparator=v.comp,r.value=v.value,!(I=this.specialfield(r,r.by,r.value,r.comparator)))return"";o.push(I)}else if("CAM"==e[s].searchfieldtype){var C=s;if("MEMBERSTATUS"==(_=d.split(":"))[1]){var b={comparator:"equal",field:{api_name:"Member_Status"},value:e[s].value.split(",")};C=s+1,s+=1}$=JSON.parse(e[C].value);var R=0,M=$.length;for(R=0;R<M;R++)$[R].name=$[R].Campaign_Name,delete $[R].Campaign_Name;var D={comparator:"equal",field:{api_name:"Campaign_Name"},value:$};q={include_objects:!0,relation:{api_name:"Campaigns"}},"MEMBERSTATUS"==_[1]?(q.criteria={},q.criteria.group=[b,D],q.criteria.group_operator="AND"):q.criteria=D,o.push(q)}else if("MXN"==e[s].searchfieldtype){if(!(_=moduleRecordMapping[t].fields.filterBy({api_name:e[s].sysrefname})[0]))continue;if(q={include_objects:!0,relation:{api_name:_[_.data_type].api_name}},"${EMPTY}"==e[s].condition)B="not_equal",$=e[s].condition,q.include_objects=!1;else{$=JSON.parse(e[s].value);R=0,M=$.length;for(R=0;R<M;R++)$[R].name=$[R].value,delete $[R].value}q.criteria={comparator:B,field:{api_name:_[_.data_type].connectedlookup_apiname},value:$},o.push(q)}else if("SMA"==e[s].searchfieldtype){r.api_name="Email_Sentiment";var k,L;u=e[s].searchfield.split(":");r.by={POSITIVE:"Positive",NEGATIVE:"Negative",POSITIVE_AND_NEGATIVE:"PositiveAndNegative",POSITIVE_OR_NEGATIVE:"PositiveOrNegative",POSITIVE_ONLY:"PositiveOnly",NEGATIVE_ONLY:"NegativeOnly",NEUTRAL:"Neutral"}[u[1]],r.comparator=B,r.substatus="","POSITIVE"!=u[1]&&"NEGATIVE"!=u[1]&&"POSITIVE_OR_NEGATIVE"!=u[1]&&"NEUTRAL"!=u[1]||"LASTMAIL"==u[2]&&(r.status="For_The_Last_Email"),"COUNT"!=u[2]&&"PERCENTAGE"!=u[2]||(r.status="",k=u[3],u[3]&&("less_than_or_equal"!=u[3]&&"greater_than_or_equal"!=u[3]||(k="less_than_or_equal"==k?"less_equal":"greater_equal"),L=u[4],r.substatus=u[2],r.status=u[2].toLowerCase())),$="${UNTILNOW}"==$?"${CURRENTTIME}":$;var I;v=this.getDateCompValue({criteria:e[s],value:$,comp:r.comparator});if(r.comparator=v.comp,$=v.value,!(I=this.specialfield(r,r.by,$,r.comparator,r.status,L,k)))return"";o.push(I)}else if("CON"==e[s].searchfieldtype)I={include_objects:"WITH"==e[s].searchfield.split(":")[1],relation:{api_name:"Contacts"},criteria:{field:{api_name:"Full_Name"},comparator:"not_equal",value:"${EMPTY}"}},o.push(I);else if("LPRE"==e[s].searchfieldtype||"PRE"==e[s].searchfieldtype)r.field={},r.field.api_name="Prediction_Score",r.comparator="equal",r.value="LPSCR"==e[s].searchfield||"PRESCORE"==e[s].searchfield?$:"${"+e[s].searchfield+"|"+$+"}","LPSCR"!=e[s].searchfield&&"PRESCORE"!=e[s].searchfield||(r.comparator=B,-1!=r.value.indexOf(",")&&(r.value=$.split(","))),a.push(JSON.parse(JSON.stringify(r)));else if("REC"===e[s].searchfieldtype){var E,j=e[s].searchfield.split(":")[1],A=JSON.parse(e[s].value),O=A.selected_products;if(O?0!==O.length&&(E={comparator:"equal",value:O}):E={comparator:"not_equal",value:"${EMPTY}"},E.field={FIRSTBUY:{api_name:"first_buy_what"},CWBAB:{api_name:"cross_selling_what"},FBT:{api_name:"bundle_what"},REBUY:{api_name:"rebuy_what"},NEXTBUY:{api_name:"next_buy_what"}}[j],"CWBAB"===j)E={group_operator:"and",group:[E,{comparator:"equal",value:A.value_Recommendation,field:{api_name:"cross_selling_what_influenced"}}]};if("REBUY"===j){var S=A.rebuy_options.option,P=A.rebuy_options.custom_date;(S={day:"${TODAY}",week:"${THISWEEK}",month:"${THISMONTH}"}[S])||(S=P),E={group_operator:"and",group:[E,{comparator:"equal",value:S,field:{api_name:"rebuy_date_what"}}]}}var T={include_objects:!0,relation:{api_name:{FIRSTBUY:{api_name:"First_Buy"},CWBAB:{api_name:"Cross_Selling"},FBT:{api_name:"Bundle"},REBUY:{api_name:"Rebuy"},NEXTBUY:{api_name:"Sequence"}}[j]},criteria:E};o.push(T)}else if("RFM_score"==e[s].searchfieldtype){var x={CF_Recency:"Recency",CF_Frequency:"Frequency",CF_Monetary:"Monetary"},U=e[s].searchfield.replaceAll("::","").split(":"),F=e[s].condition.split(":::"),N=e[s].value.split(":::"),V=N.length;for(w=1;w<=V;w++){var B,$="between"==(B=c[F[w-1]])||"not_between"==B?N[w-1].split(","):N[w-1];a.push({field:{api_name:x[U[3*w-1]]},comparator:B,value:$})}}else{x={AMOUNT:"Deal_Amount",CLOSINGDATE:"Deal_Closing_Date",STAGE:"Deal_Stage",SMOWNERID:"Deal_Owner",STATUSID:"Record_status"};if(e[s].value.split(",").length>1&&($=e[s].value.split(",")),e[s].condition==e[s].value&&(B="equal"),"U"!=e[s].searchfieldtype&&"L"!=e[s].searchfieldtype&&"W"!=e[s].searchfieldtype||(B=c[e[s].condition],$=l($)),e[s].searchModule!=t&&("Deal_Amount"==x[u[1]]||"Deal_Closing_Date"==x[u[1]]||"Deal_Stage"==x[u[1]]||"Deal_Owner"==x[u[1]])){if(this.preventDealField)continue;if("Deal_Closing_Date"==x[u[1]])B=(v=this.getDateCompValue({criteria:e[s],value:$,comp:B})).comp,$=v.value;var q={include_objects:!0,relation:{relation_id:moduleRecordMapping.Potentials.id,api_name:"Deals"},criteria:{field:{api_name:moduleRecordMapping.Potentials.fields.filterBy({column_name:u[1]})[0].api_name},comparator:B,value:$}};this.updateCrossFilter(o,"Deals",q);continue}if("Record_status"==x[u[1]]){q={include_objects:!0,relation:{relation_id:"",api_name:"Review_Processes"},criteria:{field:{api_name:x[u[1]]},comparator:B,value:$}};o.push(q);continue}var z=this.isVisitsField(u[1]);if("DT"==e[s].searchfieldtype||"D"==e[s].searchfieldtype)B=(v=this.getDateCompValue({criteria:e[s],value:$,comp:B})).comp,$=v.value;if(z.isVisits&&e[s].searchModule!=t){if("normalField"==z.fieldtype)a.push({field:{api_name:z.api_name},comparator:B,value:$});else{q={include_objects:!0,relation:{relation_id:"",api_name:"Visits_Zoho_Livedesk"},criteria:{field:{api_name:z.api_name},comparator:B,value:$}};this.updateCrossFilter(o,"Visits_Zoho_Livedesk",q)}continue}var H="DATASOURCE"==u[1]?"SE_STATUS":u[1],W=moduleRecordMapping[t].fields.filterBy({column_name:H})[0];if(!W||!W.visible)continue;if("duration"==e[s].trackerOption){b={field:{api_name:"Modified_Time"},comparator:{lesser:"less_than",greater:"greater_than",greaterequal:"greater_equal",lesserequal:"less_equal",equal:"equal"}[e[s].trackerOptionCond],value:"${AGEINDAYS}+"+e[s].trackerOptionDays};var J={field:{api_name:W.history_tracking.duration_configured_field.api_name},comparator:"equal",value:"${EMPTY}"},Y=(v=this.construct_group(b,J,"AND"),moduleRecordMapping[t].related_lists[this.getIndex(moduleRecordMapping[t].related_lists,"picklist_tracker","action",!0)]);o.push({include_objects:!0,relation:{api_name:Y.api_name},criteria:this.construct_group(v,{field:{api_name:W.api_name},comparator:B,value:$},"AND")})}if("tag"==e[s].searchfieldtype){if("${EMPTY}"!=$&&"${NOTEMPTY}"!=$){var Q=($="string"==typeof $?$.split(","):$).length,G=[],K=Lyte.Router.getRouteInstance().parent.currentModel.tags;for(R=0;R<Q;R++)G.push(K.filter((function(e){return $[R]==e.modRefId}))[0]);$=this.getValueBasedonKeys(G,"name")}var Z={field:{api_name:W.api_name},comparator:B,value:$};if("Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()){J={field:{api_name:"Activity_Type"},comparator:"equal",value:e[s].searchModule};Z=this.construct_group(Z,J,"AND")}a.push(Z)}else{var X=W.api_name;if("lookup"==W.data_type&&("Activities"!=t||-1==["CONTACTID","SEID"].indexOf(W.column_name))){var ee=crmConstants.moduleDisplayField[store.peekRecord("module",W.lookup.module.id).module_name];X=X+"."+(ee=ee||["Name"])[0]}a.push({field:{api_name:X},comparator:B,value:$})}}}r={};return Lyte.arrayUtils(a,"insertAt",0,i),a.length>0&&(a.reverse(),r.filters=1==a.length?a[0]:{group:a,group_operator:"AND"}),o.length>0&&(r.cross_filters=o.reverse()),delete this.preventDealField,r},handleKanbanSettingPopup:function(e=!1){var t=crmListView.kanbanSettingData;if(t&&!0===t.showKanbanPopup){var s=Crm.userDetails.isMultipleKanbanViewsEnabled;s&&(t.displayAggregate=I18n.getMsg("crm.process.option.none"));var r=[];r.push(networkUtils.returnDependencyFiles(["crm-kanban-resources.js"],ResourceConstants.CRMClient)),r.push(networkUtils.returnDependencyFiles(["kanbanview/crm-kanban-lyte-resources.css","kanbanview/crm-kanban-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(r,void 0,(function(){s||delete t.showNewKanban;var r=Lyte.Component.render("crm-kanbansetting-component",t,"#kanbansettingpopup");r.component.setData("showModal",!0),e&&Crm.userDetails.isMultipleKanbanViewsEnabled&&r.component.setData("fromManage",!0)}))}},parse_Nested_Json:function(e){return"string"==typeof e?this.parse_Nested_Json(JSON.parse(e)):e},campaignLayoutFilterFetch:function(e){var t=["status","source"],s=["active","campaign_integration"];if(Crm.userDetails.isRelatedListLyteEnabled)r=moduleRecordMapping.Campaigns.layouts.filter((function(e){if((e.status>=0||"active"===e.status)&&"campaign_integration"===e.source)return!0}));else var r=moduleRecordMapping.Campaigns.layouts.filter((function(e){return t.every((function(t){return s.includes(e[t])}))}));for(var i=r.length,o=[],a=0;a<i;a++)for(var n=r[a].profiles.length,c=0;c<n;c++)if(Crm.userDetails.PROFILE_NAME==r[a].profiles[c].name){o.push(r[a]);break}e.setData("campaignLayout",o);var l=moduleRecordMapping.Campaigns.layouts.filter((function(e){return e.profiles.some((function(e){return e.name==Crm.userDetails.PROFILE_NAME&&e.default}))}))[0];e.setData("campDefLayout",l)},setHeight:function(){$L.fastdom.measure(function(){renderingUtils.resizeWindowHW();var e=$L("crm-inner-list")[0],t=!(!e||"CHARTVIEWS"!==e.component.data.featureName),s=$L(".outerElem"),r=t?s[s.length-1].getBoundingClientRect().top:s[0].getBoundingClientRect().top,i=renderingUtils.windowHeight-r-$L("#cvpadding").outerHeight(),o=$L("#wmstoolbar");o.length?i-=o.outerHeight():i-=28;var a=$L("crm-inner-list .lyteExpOriginalTable").height(),n=$L("crm-inner-list .lyteExpTableOrigTableInnerWrap"),c=n[0].scrollWidth;n[0].clientWidth<c&&(a+=renderingUtils.getScrollBarWidthValue);var l=i;a<i&&0!=a&&(l=a),this.height=l,$L.fastdom.mutate(function(){var e,s,r=$L("#wfRpExecutionList"),i=void 0!==r[0]?r.offset():void 0;s=t?$L(".crmLVModalWrapper .viewcontainer"):$L("#viewcontainer");var o=void 0!==i?i.top:void 0!==s&&void 0!==(e=s.offset())?e.top:0,a=renderingUtils.windowHeight-(o+28),n=0;this.height>=a&&(n=20);var c=$L("crm-customview-layer")[0].component.data.warningNote,l=c?143:95;if(t&&o>(c?145:100)){var d=$("#lv_left_filter")[0];this.height<a&&d?this.height=d.getBoundingClientRect().height:this.height=this.height-(o-l)}var u=document.getElementById("listcrux");if(u.cxProp("height",this.height-n+"px"),!t&&Crm.isCpqActivated()){var m=$("#lv_left_filter").css("height");u.cxProp("height",m)}Crm.latestEntId&&this.latestEntityId&&this.latestEntityId(Crm.latestEntId),$L("#listviewtablescroll").css("min-height",a-20)}.bind(this))}.bind(this));var e=$L("#cv_buttons_layer")[0];e&&e.scrollWidth>e.offsetWidth?$L("#cv_pagination").addClass("cv_btns_layerbxshadow"):$L("#cv_pagination").removeClass("cv_btns_layerbxshadow")},constructNavigObject:function(e,t,s,r=10,i,o){for(var a=t?t.length:0,n=[],c=0;c<a;c++)n[void 0!==t[c].recnum?t[c].recnum:c+1]={module:"Activities"===s?t[c].$activity_type:s,id:t[c].id};crmNavig.customViewKey=e,i&&(crmNavig.customViewKey=e+"#"+o.id),crmNavig.recentListViewUrl=crmHistory.getState().url,crmNavig[crmNavig.customViewKey]={},crmNavig[crmNavig.customViewKey].recordId=n,crmNavig[crmNavig.customViewKey].currentOption=r},sortRecord:function(e,t,s,r,i,o,a,n){var c,l,d=moduleRecordMapping[this.getData("module")],u=d.custom_view.id,m=this,p=store.peekRecord("custom_view",u),_=(r=$L(".lyteMenuSelected")[0]||r)?r.parentElement.id:"unsort"===e?i.id:m.getData("sortIconFieldId");_||(_=n);var g=p.sort_by?p.sort_by.id:void 0;if(_&&(c=store.peekRecord("field",_).api_name,"unsort"===e?p.$.set("sort_by",{}):p.$.set("sort_by",{id:_,api_name:c}),l=store.peekRecord("field",_).id),"BEST_TIME"!==c||g!==p.sort_by.id||p.sort_order!==e){"unsort"===e?(p.$.set("sort_order",void 0),p.$.set("sort_by",{})):p.$.set("sort_order",e),customViewObject.selectedIds&&customViewObject.selectedIds.length&&this.selectAllEntity(!0),commonUtils.showHideLoadingDiv(!0);var v={sort_by:p.sort_by,sort_order:p.sort_order,module:d.api_name,id:u};o&&a&&this.setFeatureSpecificParams(v,a),store.triggerAction("custom_view","change_sort",v).then((function(){o?(m.sortRecordsForModal(l,e,d.per_page,d.module_name,a),commonUtils.showHideLoadingDiv()):m.throwEvent("sortOrder",l,e,d.per_page)}),(function(e){403===e.status||401===e.status?renderingUtils.displayPermissionDenied(e):400===e.status&&_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.field.sort.error")}}),p.$.rollBack(),commonUtils.showHideLoadingDiv()}))}},pinUnpinfield:function(e,t){var s,r,i=moduleRecordMapping[this.getData("module")],o="CHARTVIEWS"===this.getData("featureName"),a=i.custom_view.id,n=this,c=o?store.peekRecord("chart_view",$L("crm-chart-view")[0].component.data.chartViewId):store.peekRecord("custom_view",a),l=c.fields,d=$L(".lyteMenuSelected")[0];(r=d?d.parentElement.id:n.getData("sortIconFieldId"))&&(s=[{api_name:store.peekRecord("field",r).api_name,id:r,_pin:"UnPin Column"!==e,_pin_order:"UnPin Column"===e?null:n.getData("pined_fields_length")+1}]);var u={fields:s||l,id:a},m={module:i.api_name};commonUtils.showHideLoadingDiv(!0),t?store.triggerAction("custom_view","pin_unpin_fields",u,m).then((function(){n.changePinUnpin(n,e,i,false,c,r,a)}),(function(e){if(400===e.status){var t=-1!==e.responseText.indexOf("Maximum Limit Reached to Pin the Field")?I18n.getMsg("crm.customview.pin.unpin.maximum.limit.new",1):-1!==e.responseText.indexOf("Given Field is not associated with the mentioned Custom View")?I18n.getMsg("crm.customview.pin.unpin.column.error.msg"):I18n.getMsg("crm.customview.pin.unpin.issue");_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:t}})}commonUtils.showHideLoadingDiv(),c.$.rollBack()})):n.changePinUnpin(n,e,i,false,c,r,a)},changePinUnpin:function(e,t,s,r,i,o,a){var n=i.fields,c=e.getData("cv_mod_pined_fields"),l=[];"Pin Column"===t?c.push(o):"UnPin Column"===t&&(c=c.filter((function(e){return e!==o}))),e.setData("cv_mod_pined_fields",c),e.setData("pined_fields_length",c.length);var d=new Map,u=$L("crm-inner-list")[0].component,m=u?u.getData("cv_mod_fields"):new Map,p=m.size>0;"list"===e.data.from&&u&&u.getData("isResizeEnabled")&&i.fields.forEach((function(e){e._width&&d.set(e.id,e._width)}));var _=0;i.fields.forEach((function(t){c&&c.contains(t.id)&&(_+=p?m.has(t.id)?m.get(t.id):t._width?t._width:e.getDefaultWidthForField(store.peekRecord("field",o).ui_type):d.has(t.id)?d.get(t.id):t._width?t._width:e.getDefaultWidthForField(store.peekRecord("field",o).ui_type))})),c.forEach((function(t){var s=n.filter((function(e){return e.id===t}))[0];if(s){s._pin=!0;var i=m.has(t),a=p?i?m.get(t):s._width?s._width:e.getDefaultWidthForField(store.peekRecord("field",o).ui_type):d.has(t)?d.get(t):s._width?s._width:e.getDefaultWidthForField(store.peekRecord("field",o).ui_type),u=document.querySelector(".lyteExpTableOrigTableInnerWrap").clientWidth,g=e.calculatefixedColumnWidth();a&&u&&g+_+100>=u&&(i&&m.delete(t),s._width=Math.round((u-g-100)/c.length),m.set(t,s._width),r=!0)}else s={api_name:store.peekRecord("field",t).api_name,id:t,_pin:!0};s._pin_order=c.indexOf(t)+1,l.push(s)})),n.forEach((function(e){c.includes(e.id)||(o===e.id&&"UnPin Column"===t&&(e._pin=!1,delete e._pin_order),l.push(e))})),r&&(u.setData("cv_mod_fields",m),u.setData("updateWidthValue",!0),u.setData("width_prev_cvid",a),u.checkForWidthUpdate(!0)),store.unloadAll(s.id);var g={},v=e.getData("isFromModal");if(v){var f=$L("#customFilter"),h=f&&f[0].component?f[0].component.getFilterCriteria():void 0;g=h?h.queryParams:{}}var y=v?g:Lyte.Router.getRouteInstance().getQueryParams(),w=y&&y.page||s.start_index>1?Math.round(s.start_index/Number(s.per_page))+1:1,C={module:e.getData("module"),page:w,per_page:s.per_page};if(v&&(y||(y={}),e.setFeatureSpecificFilters(y,e.getData("featureName"))),e.beforeRecordAPI(y,C,s,a),!e.getData("persistPinUpdate")){var b=n.mapByKey("api_name");C.fields=[...new Set(C.fields.concat(b))]}store.findAll(s.id,C).then((function(r){"Pin Column"===t&&(u.setData("doEnablePinnedColAnim",!0),setTimeout((function(){u.setData("doEnablePinnedColAnim",!1)}),2e3)),e.setData({listfields:l,customview_records:r}),CScriptLib&&CScript.Engine.Global.dispatchEvent("onCustomViewLoad",null,{id:s.custom_view.id,name:s.custom_view.display_value}),e.headerSelection(s),commonUtils.showHideLoadingDiv()}),(function(e){403===e.status&&renderingUtils.displayPermissionDenied(e)}))},setSortBySummary:function(e){var t="",s=store.peekRecord("custom_view",e.cvid);if(s&&s.sort_by){for(var r=e.module_info.fields.length,i=e.module_info.fields,o="",a=s.sort_by.api_name?s.sort_by.api_name:i.find((function(e){if(e.id===s.sort_by.id)return e})).api_name,n=0;n<r;n++)if(i[n].api_name===a){t=i[n].field_label,o=i[n].data_type;break}t.length&&(t+=" (",["phone","currency","integer"].contains(o)&&"BEST_TIME"!==a?t+="asc"===s.sort_order?"0-9":"9-0":t+="asc"===s.sort_order?I18n.getMsg("crm.column.sort.asc"):I18n.getMsg("crm.column.sort.desc"),t+=")")}e.sorted_column=t},setFilterSummary:function(){var e=$L("crm-custom-filter")[0],t=new Set,s=$L("crux-smart-filter")[0].component.data.appliedFields;e&&(t=e.getData("mspfieldsVsinclude"));var r="";if(s.length>0)for(var i=s.length,o=0;o<i;o++){if(r+=$ESAPI.encoder().encodeForHTML(s[o].display_field_label),"crossModule"===s[o].data_type)r+=this.setChildSummary(s[o],t);t.has("option_"+s[o].api_name)&&Lyte.objectUtils(s[o],"add","maxCount",crmConstants.include_exclude_values_limit),o<i-1&&(r+=", ")}var a=$L("crm-custom-outer-box")[0];a&&a.component.setData("applied_filters",r);var n=$L("crm-customview-layer")[0];0===r.length&&e&&e.component.data.appliedFilterId&&n&&n.setData("showClearFilter",!0),e&&!e.component.data.appliedFilterId&&n&&n.setData("showClearFilter",!1)},setChildSummary:function(e,t){var s=e.api_name,r=$L("#customFilter_"+s)[0].component.data.appliedFields,i="";if(r.length>0){i+=" <span class = 'childFilterSummary crmLabelColor'>(";for(var o=r.length,a=0;a<o;a++)i+=$ESAPI.encoder().encodeForHTML(r[a].display_field_label),t.has("option_"+r[a].api_name+"_"+r[a].id+"_"+s)&&Lyte.objectUtils(r[a],"add","maxCount",crmConstants.include_exclude_values_limit),a<o-1&&(i+=", ");i+=")</span>"}return i},reRenderTagComponent:function(e,t){$L.fastdom.measure((function(){var s=document.querySelectorAll("crux-tag-component"),r=s.length;$L.fastdom.mutate((function(){for(var i=0;i<r;i++)s[i].resize({cxPropClipMode:e,cxPropWidth:t})}))}))},applyAlphaSort:function(e,t){var s=Lyte.Router.getRouteInstance().transition.info,r=s.queryParams;r.page=1,r.search_letter="All"!==e?e:void 0,r.search_field=t&&r.search_letter?t:void 0,Lyte.Router.transitionTo({route:s.route,queryParams:r,dynamicParams:s.dynamicParams}).data={clearCache:!0}},getCVFieldsWOWidth:function(e){for(var t=e.length,s=!1,r=0;r<t;r++)if(e[r]._width){s=!0;break}if(s){var i=[];return e.forEach((function(e){var t=Object.assign({},e);delete t._width,i.push(t)})),i}return e},getDefaultWidthForField:function(e){return 209===e||3===e||110===e?400:200},checkForStickyTable:function(){if(!/firefox/gi.test(navigator.userAgent)){var e=document.createElement("th"),t="IntersectionObserver"in window;return e.style.position="sticky",!("sticky"!==e.style.position||!t)||(e.style.position="-webkit-sticky",!("-webkit-sticky"!==e.style.position||!t))}return!1},constructRCOptions:function(){var e=I18n.getMsg("crm.label.no.of.records"),t=[{user_value:"10 "+e,system_value:10},{user_value:"20 "+e,system_value:20},{user_value:"30 "+e,system_value:30},{user_value:"40 "+e,system_value:40},{user_value:"50 "+e,system_value:50}];return Crm.userDetails.ISPAID_USER&&t.push({user_value:"100 "+e,system_value:100}),500===Crm.userDetails.maxRange&&t.push({user_value:"500 "+e,system_value:500}),t},WEBINAR_BASE_URL:"/crm/v2/__internal/Campaigns",WEBINAR_POLL_CATEGORY:{STAR_RATING:1,MCQ_SINGLE:2,MCQ_MULTIPLE:3},getIntegCampObject:function(){var e={};return e["zoho.webinar"]={route:"crm.settings.section.extensions.zoho-extensions.webinar",showLayout:!0,name:Crm.integrationsAppName.ZOHO_WEBINAR,nameSpace:"zoho.webinar",iconClass:"zCampWebinarIcon"},e},waitingForApproval:function(e,t){var s=!1===e.$approved&&!1===e.$approval.resubmit;return!!(e.$stop_processing&&"COMPLIANCE"!==t||s||"review_process_pending"===e.$approval_state)},hideMoreActions:function(e){for(var t=$L("#moreActionPopup,#tagPopover,#zCampMoreActionMenu,lyte-popover#divMacro,#add_TagPopUp,#remove_TagPopUp"),s=t.length,r=0;r<s;r++)t[r].component&&t[r].ltProp("show",!1);for(var i=$L(".moreActionListview"),o=i.length,a=0;a<o;a++)i[a].parent.ltProp("show",!1);for(var n=$L(".customButtonDropBox"),c=n.length,l=0;l<c;l++)!n[l].classList.contains("lyteDropdownHidden")&&n[l].origindd&&n[l].origindd.toggle();var d=$("#cruxCustomAlert")[0];d&&d.ltProp("show",!1),Q.close(),crmui.hidePopup("updateConsenttype"),crmui.hidePopup("customButtonPopUp");var u=$("#customButtonPopUp")[0];u&&u.remove(),closeDashletDiv("loadingDiv")},handleError:function(e,t,s,r){var i=t||this.currentModel;if(i&&i.status&&200!==i.status&&201!==i.status){var o=i.response?JSON.parse(i.response):void 0;if(403==i.status&&o&&"FEATURE_NOT_SUPPORTED"==o.code)this.replaceWith("crm.tab.module.custom-view.list",e,moduleRecordMapping[e].cvid).data=this.transition.data;else if(403==i.status||o&&"NO_PERMISSION"==o.code||401===i.status&&o&&"AUTHENTICATION_FAILURE"==o.code&&Crm.userDetails.CLIENT_ACCOUNT){crmHistory.transitionError=!1;var a=Lyte.Router.getRouteInstance().transition.info,n=app.prevTransitionBeforeRefresh?app.prevTransitionBeforeRefresh:app.prevTransition;a.route.indexOf("custom-view")>-1&&n.route==a.route&&n.dynamicParams[0]==a.dynamicParams[0]&&n.dynamicParams[1]==a.dynamicParams[1]||(crmHistory.handleAjaxErrorLyte=!0),crmHistory.doNotReload=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()}else if(400===i.status&&o&&"INVALID_MODULE"===o.code||null==moduleRecordMapping[e]){crmHistory.transitionError=!1;var c=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),l=window.location.pathname.split(c)[1];this.replaceWith("crm.crm-error",l).data={showError:!0,module:e,errorMsg:I18n.getMsg("module.not.available")}}else if(o&&"LOOKUP_LIMIT_EXCEEDED"==o.code&&o.details)if(Crm.userDetails.isRelatedModuleFilters)this.handleLimitForCrossFilters(o,e);else{crmHistory.transitionError=!1;var d=0,u=o.details.used_in.length,m={Custom_View_Select_Column:"",Criteria:""};for(d=0;d<u;d++)m[o.details.used_in[d].name]=this.getApiName(o.details.used_in[d].lookup_fields);var p=m.Custom_View_Select_Column+"####"+m.Criteria;for(d=0;d<u;d++)for(var _=o.details.used_in[d].lookup_fields.length,g=0;g<_;g++)if(void 0!==o.details.used_in[d].lookup_fields[g].type&&"field"===o.details.used_in[d].lookup_fields[g].type){p+="####f";break}for(d=0;d<u;d++)for(_=o.details.used_in[d].lookup_fields.length,g=0;g<_;g++)if(void 0!==o.details.used_in[d].lookup_fields[g].type&&"related_list"===o.details.used_in[d].lookup_fields[g].type){p+="####r";break}(v=$L("crm-custom-filter")[0])&&(v.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),crmHistory.doNotReload=!0,Search.displayLookupExceedsMsg({responseText:p}),customViewObject.filters=customViewObject.cross_filters=void 0,s&&(history.go(-1),this.transition.abort()),r&&(r.hasErrorInFilter=!0)}else if(o&&"LIMIT_EXCEEDED"===o.code&&o.message&&"Auto-refresh formula field criteria usage of 2 exceeded"===o.message){crmHistory.transitionError=!1,(v=$L("crm-custom-filter")[0])&&(v.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),crmHistory.doNotReload=!0,_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.title.max.dynamic.formula.fields"),ltPropSecondaryMessage:I18n.getMsg("crm.dashboard.dynamic.formula.filters.limit.alert.message",2),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok"),cxPropZcqa:"DF_field_max_limit"}]}}),this.transition.abort(),customViewObject.filters=customViewObject.cross_filters=void 0}else if(o&&("COMPARATOR_LIMIT_EXCEEDED"===o.code||"DEPENDENT_MISMATCH"===o.code)&&o.details){var v;crmHistory.transitionError=!1,(v=$L("crm-custom-filter")[0])&&(v.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),crmHistory.doNotReload=!0,_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.multi.select.field.filter.limit.reached.heading"),ltPropSecondaryMessage:"COMPARATOR_LIMIT_EXCEEDED"===o.code?I18n.getMsg("crm.multi.select.field.cv.filter.limit.reached.msg",o.details.limit?o.details.limit:crmConstants.include_exclude_comparator_limit):I18n.getMsg("crm.multi.select.field.option.limit.reached.heading",o.details.maximum_length?o.details.maximum_length:crmConstants.include_exclude_values_limit),ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok"),cxPropZcqa:"field_max_limit"}]}}),"chart"!==customViewObject.viewType&&("kanban"===customViewObject.viewType&&!customViewObject.filter_id||"kanban"!==customViewObject.viewType&&(customViewObject.filters||customViewObject.cross_filters))&&history.go(-1),customViewObject.filters=customViewObject.cross_filters=void 0,r&&(r.hasErrorInFilter=!0)}else i.response&&i.response.indexOf('{"param_name":"cvid"}')>-1?(crmHistory.transitionError=!1,this.currentModel.cvDeletePage=!0):i.response&&-1==i.response.indexOf('{"param_name":"cvid"}')&&400==i.status?(crmHistory.transitionError=!1,this.filterErrorMsg(void 0,void 0,o),this.transition.abort()):(crmHistory.transitionError=!1,this.currentModel.errorOnModel=!0,this.currentModel.module=this.parent.parent.getDynamicParam())}},handleLimitForCrossFilters:function(e,t){crmHistory.transitionError=!1;var s=0,r=e.details.used_in.length,i=[],o=[],a=[],n=customViewObject.cvId,c=store.peekRecord("custom_view",n),l=!1;for(s=0;s<r;s++){if(e.details.used_in[s].lookup_fields&&e.details.used_in[s].lookup_fields.length>0){(k={}).display_label="Custom_View_Sort_Column"===e.details.used_in[s].name?"Sort Columns":"Filter",k.display_label===I18n.getMsg("Sort Columns")&&(k.values=this.getApiName(e.details.used_in[s].lookup_fields,!0),i.push(k));for(var d=e.details.used_in[s].lookup_fields.length,u=[],m=[],p=0;p<d;p++){var _=e.details.used_in[s].lookup_fields[p];customViewObject.filters&&this.isFieldPresentinFilters(customViewObject.filters,_.api_name)&&u.push(_),c&&c.criteria&&this.isFieldPresentinFilters(c.criteria,_.api_name)&&m.push(_)}if(u.length>0){var g=this.getApiName(u,!0);o.push(g)}if(m.length>0){var v=this.getApiName(m,!0);a.push(v)}}if(e.details.used_in[s].cross_module_relations&&e.details.used_in[s].cross_module_relations.length>0){var f=e.details.used_in[s].cross_module_relations,h=f.length;e.details.cross_module_limit&&h>e.details.cross_module_limit&&(l=!0);for(var y=[],w=0;w<h;w++)for(var C=moduleRecordMapping[t].relatedModules,b=C.length,R=0;R<b;R++)if(C[R].api_name===f[w]){var M=C[R].module.plural_label.toLowerCase()===C[R].display_label.toLowerCase()?C[R].module.plural_label:C[R].module.plural_label+" ("+C[R].display_label+")";y.push(M)}l&&(o=[]),o.push(y.join(", "))}}if(o.length>0){(k={display_label:"Filter"}).values=o[0];var D=o.length;for(w=1;w<D;w++)k.values+=", "+o[w];i.push(k)}if(a.length>0&&!l){var k;(k={display_label:"Criteria"}).values=a[0];var L=a.length;for(w=1;w<L;w++)k.values+=", "+a[w];i.push(k)}var I=i,E=$L("crm-custom-filter")[0];E&&(E.setData({isApplyFilter:!0,isSaveFilter:!1}),$L("crm-customview-layer")[0].setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),crmHistory.doNotReload=!0,this.displayLimitExceededPopup(I,!0,l?e.details.cross_module_limit:e.details.limit,l),customViewObject.filters=customViewObject.cross_filters=void 0},getApiName:function(e,t){var s=0,r=[],i=e?e.length:0;for(s=0;s<i;s++)if(void 0!==e[s].type&&"related_list"===e[s].type)r.push(e[s].fieldlabel);else if(store.peekRecord("field",e[s].id))if(t){var o=store.peekRecord("field",e[s].id);if(o.lookup&&o.lookup.module&&o.lookup.module.id){var a=idModuleMapping[o.lookup.module.id];r.push(moduleRecordMapping[a].plural_label+" ("+o.display_label+")")}else r.push(store.peekRecord("field",e[s].id).display_label)}else r.push(store.peekRecord("field",e[s].id).display_label);return r.join(", ")},isFieldPresentinFilters:function(e,t){var s=!1;if(e.group&&e.group.length>0){for(var r=e.group.length,i=0;i<r;i++)if(s=this.isFieldPresentinFilters(e.group[i],t))return s}else e.field&&e.field.api_name.split(".")[0]===t&&(s=!0);return s},removeTotalCache:function(e,t){var s=moduleRecordMapping[e];if(s){store.unloadAll("custom_view"),store.unloadAll("kanban_view"),store.clearCachedQuery("layout"),store.clearCachedQuery("wizard"),store.clearCachedQuery("filter",{module:e,cvid:t}),store.clearCachedQuery("layout_rule"),store.clearCachedQuery("validation_rule"),store.unloadAll("territory"),"Activities"==e?moduleRecordMapping.Activities.child_module.forEach((function(e){store.clearCachedQuery("tag",{module:e.api_name,fromPage:"view"})})):store.clearCachedQuery("tag",{module:s.api_name,fromPage:"view"}),store.clearCachedQuery("custom_button",{module:s.api_name}),moduleRecordMapping[e].actions=void 0,moduleRecordMapping[e].start_index=void 0,null!=store.modelFor(moduleRecordMapping[e].id)&&store.unloadAll(moduleRecordMapping[e].id),moduleRecordMapping[e].crux_customViewAccessedModules=!1;var r=crmConstants.moduleVsCrossModules[e];if(r)for(var i=r.length,o=0;o<i;o++)-1==crmConstants.cachedModules.indexOf(r[o])&&(moduleRecordMapping[r[o]].crux_customViewAccessedModules=!1);moduleRecordMapping[e].total_count=void 0,crmTab.getFromCache(e)&&(crmTab.getFromCache(e).selectedIds=[])}},makeCustomViewRequest:function(e,t,s,r){var i=store.peekRecord("custom_view",e),o=i?i.modified_time:"",a={module:moduleRecordMapping[t].api_name};let n=moduleRecordMapping[t].id,c=this;s&&r&&this.setFeatureSpecificParams(a,r);let l={};return l.custom_view=store.findRecord("custom_view",e,a),"kanban"===s&&(store.model[n]||store.registerModel(n,{},{extends:"entity"}),l.record=app.store.makeRequest("findAll",n,{cvid:this.parent.getDynamicParam(),approved:"both",fields:this.populateFields(),page:1,per_page:1},!1,!1)),Lyte.resolvePromises(l).then((function(e){let r=e.custom_view;if(r?(r.modified_time!=o&&crmTab.deleteFromCache(t),"timeline"!==s&&store.pushPayload("module",{custom_view:r,id:moduleRecordMapping[t].id})):crmTab.deleteFromCache(t),e.record){!e.record[n].length&&e.record.meta&&e.record.meta.show_begin_page&&(c.show_begin_page=!0)}return r}))},fetchFilterCount:function(e){if(Crm.userDetails.fetchCountValues){var t=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();"crm.tab.messages.custom-view.list"===Lyte.Router.getRouteInstance().transition.info.route&&(t="Messages");var s=moduleRecordMapping[t],r={cvid:s.custom_view.id,approved:"both"};s.territory&&(r.territory_id=s.territory.id,s.territory.subordinates&&(r.include_child=s.territory.subordinates));var i=crmTab.getFromCache(t),o=i?i.screenName:customViewObject?customViewObject.screenName:void 0;o&&"allportals"!==o&&(r.portal_name=CrmTracking.portalsInfo[o]),Lyte.Router.getRouteInstance().getQueryParams().search_letter&&(r.alphabet=Lyte.Router.getRouteInstance().getQueryParams().search_letter),"Campaigns"==t&&(r.exclude_followup_campaigns=!0);var a=!1;Array.isArray(e)||(e=[e],a=!0),e.forEach((function(e){r.filter_id=e.id,store.triggerAction(s.id,"count",r).then((function(t){Lyte.objectUtils(e,"add","count",t.count),a&&(customViewObject.totalCount=t.count)}))}))}},fetchRecFilterCount:function(e,t,s,r,i){if(Crm.userDetails.fetchCountValues&&(this.triggerRecordCount||e.length)){var o={},a="",n={},c=this;if(this.beforeRecordAPI(t,o,s,s.custom_view.id,r),delete o.fields,delete o.page,delete o.per_page,delete o.module,Array.isArray(e)||(e=[e]),e.forEach((function(e){n[e.id]=e,(void 0===e.count||c.triggerRecordCount)&&(delete e.count,a=a+e.id+",")})),a.length&&(o.include_filters=a.slice(0,a.length-1)),!this.triggerRecordCount&&!o.include_filters)return null;r&&(delete o.type,delete o.status,this.setFeatureSpecificFilters(o,i));var l=Lyte.deepCopyObject(o);if(delete l.filter_id,"timeline"===c.routeName){l["X-CRM-FEATURE-NAME"]="timeline_view",o.filter_id&&(l.filter_id=o.filter_id);var d=c.viewConfig;this.applyFilterByColorCriteria(l,d,s.module_name)}store.triggerAction(s.id,"count",l).then((function(e){c.filter_id=o.filter_id,c.filter_id&&"timeline"!==c.routeName&&e.filters_count.forEach((function(t){c.filter_id===t.id&&(e.count=t.status&&"error"===t.status?0:t.count)})),c.setCount(e,s,c),e.filters_count&&e.filters_count.forEach((function(e){Lyte.objectUtils(n[e.id],"add","count",e.status&&"error"===e.status?"COMPARATOR_LIMIT_EXCEEDED"===e.code||"DEPENDENT_MISMATCH"===e.code||"LOOKUP_LIMIT_EXCEEDED"===e.code?"###":"-":e.count)})),setTimeout((function(){c.headerSelection(s)}),201)}),(function(e){if(e.response&&"TOO_MANY_REQUESTS"===JSON.parse(e.response).code&&JSON.parse(e.response).message.indexOf("Request skipped internally for Mitigation")>-1){Crm.userDetails.fetchCountValues=!1;var t,r=$L("crm-customview-layer")[0];if(r&&(r.setData({total_new_count:"###",fetchCountValues:!1}),r.setData("show_loading",!1)),o.include_filters)for(t in n)Lyte.objectUtils(n[t],"add","count","###")}else c.setCount({},s,c)}))}},clearSelection:function(){var e=document.querySelector("crm-customview-buttons");if(e&&e.component){let t="kanban"!==Lyte.Router.getRouteInstance().routeName;this.selectAllEntity.call(e.component,t)}},setTerritory:function(e,t){var s=moduleRecordMapping[t];e=e||Lyte.Router.getRouteInstance().getQueryParams();var r=!1,i={},o=this;if(s.territory&&null!=e.territory_id&&e.territory_id!==s.territory.id)if(-1!==["-1","-3","0","-2"].indexOf(e.territory_id)){var a={0:I18n.getMsg("crm.label.all.territories"),"-1":I18n.getMsg("crm.label.without.territory"),"-3":I18n.getMsg("crm.label.multiple.territories"),"-2":I18n.getMsg("crm.label.other.territories")};i={id:e.territory_id,name:a[e.territory_id]},r=!0}else store.findRecord("territory",e.territory_id).then((function(t){t=store.peekRecord("territory",e.territory_id),i={id:t.id,name:t.name},"true"===e.include_child&&(i.$subordinates=!0),s.$.triggerAction("view_preference_configurations",{module:s.api_name},{},"PUT",{territory:i}),i.$subordinates&&(i.subordinates=!0,delete i.$subordinates),s.territory=i,o.data&&o.data.territoryInfo&&o.setData("territoryInfo",s.territory)}));else if(null!=e.territory_id){var n,c=!1;if("true"===e.include_child&&!1===s.territory.subordinates?(c=!0,n=!0):"false"===e.include_child&&s.territory.subordinates&&(c=!0,n=!1),c){i={id:e.territory_id,name:s.territory.name,$subordinates:n};r=!0}}r&&(s.$.triggerAction("view_preference_configurations",{module:s.api_name},{},"PUT",{territory:i}),i.hasOwnProperty("$subordinates")&&(i.subordinates=!!i.$subordinates,delete i.$subordinates),s.territory=i)},getUpdatedActions:function(e,t){var s=moduleRecordMapping[e].actions;s&&s.length&&(s.filter((function(e){return"hideSelectAllRecords"==e.name})).length&&app.store.makeRequest("triggerAction",moduleRecordMapping[e].id,"mass_actions",{cvid:t,type:"GET"}).then((function(t){if(t.actions){moduleRecordMapping[e].actions=t.actions;var s=t.actions.filter((function(e){return"hideSelectAllRecords"==e.name}));customViewObject.showSelectAll=!s.length||customViewObject.showSelectAll}})))},preFetch:function(e,t,s,r,i,o){var a=moduleRecordMapping[t],n=crmTab.getFromCache(a.module_name);this.cachedObj=n||{},"Visits"===a.module_name&&(this.portalName=r.portalName?r.portalName:this.cachedObj.screenName?this.cachedObj.screenName:"allportals",Crm.trackSpotLightAction("Visits - Normal View Click")),!e.sort_order||"sort_asc"!==e.sort_order&&"sort_unsort"!==e.sort_order&&"sort_desc"!==e.sort_order||(e.sort_order=e.sort_order.slice(5)),!e.page&&a.start_index&&(e.page=a.start_index/a.per_page+1),e.page=e.page?Number(e.page)<1?1:Number(e.page):1,this.fetchOnlyBody=!1;var c=$L("#listviewtablescroll");return c[0]&&c.addClass("lvTHPointerEventNone"),this.makeCustomViewRequest(s,t,i,o)},fetch:function(e,t,s,r,i,o){var a=moduleRecordMapping[t],n=!1;return!i&&(a.kanban_view||a.canvas_view||a.zia_view||a.card_view||a.table_view||a.chart_view||a.timeline_view)&&(n=!0),a.$.set("kanban_view",!1),a.$.set("timeline_view",!1),i&&a.chart_view?a.$.set("chart_view",!0):a.$.set("chart_view",!1),Crm.userDetails.CLIENT_ACCOUNT||(a.$.set("canvas_view",!1),a.$.set("card_view",!1),a.$.set("table_view",!1)),a.$.set("zia_view",!1),!1!==this.fetchCount&&n&&store.triggerUpdate("module",a.id,["kanban_view","per_page"]),r=r||{},this.initiateRequest(e,r,t,o||{},s,i)},postFetch:function(e,t,s){return e&&!e.errorOnModel&&(e&&e.show_begin_page&&e&&e.data_waiting_for_approval||"Activities"===e.module&&!0===moduleRecordMapping[e.module].filter_status&&($L("#lv_left_filter").css({display:"block"}),$L("#viewcontainer").css({width:"calc(100% - 303px)"}))),this.viewAfterModel(e,t,s),e},renderHTMLTemplate:function(e,t,s,r,i,o,a,n,c){var l=moduleRecordMapping[s];if(e.cvDeletePage){function d(e){if("ALLVIEWS"===e.system_name)return e}delete l.custom_view,store.findAll("custom_view",{module:l.api_name}).then((function(e){for(var t=$L("crm-cverror-page")[0],s=e.filter(d),r=s[0],i=s.length,o=0;o<i;o++)if(s[o].name.startsWith("All")){r=s[o];break}var a=r.display_value;t&&(t.setData("cvdisplayName",a),t.setData("module_name",l.module_name)),l.cvid=r.id,l.custom_view=r})),app.renderTemplate(this,{outlet:"#show",component:"crm-cverror-page"})}else{e.viewType="list",l&&l.kanban_view&&l.$.set("kanban_view",!1);var u=l.module_name,m=!1;this.prevModule!==u&&(m=!0),this.prevModule=u,(i.clearselectedIds||!1!==i.clearselectedIds&&(i.clearCache||this.cachedObj.clearonImportCompletion))&&(this.cachedObj.selectedIds=[],delete this.cachedObj.selectAllHistory,delete this.cachedObj.showHideSelectAllDiv,delete this.cachedObj.showSelectAll,crmListView=crmListView||{},crmListView.startIndex={});var p=l.module_name.startsWith("Orchestration")||l.module_name.startsWith("PathFinder")?"crm.orchestration.empty.message":"crm.module.empty.message";if(e.no_record_message=Lyte.Component.registeredHelpers.I18nDynamicKey(p,"",l.plural_label),e.selectedIds=this.cachedObj.selectedIds?this.cachedObj.selectedIds:[],!n&&(i.refreshTemplate||!this.ORComponent)){var _=$L("crm-inner-list")[0];_&&(_.getData("cv_width_updated")&&_.component.persistWidthToStore.call(_.component),_.component.checkForWrapUpdate.call(_.component))}this.setDataFromRoute(e,r,t.queryParams,n,c),this.setDataBeforeRender(e,r,t,n,c),e.cv_sys_name=l.custom_view&&l.custom_view.system_name?l.custom_view.system_name:"",e.search_letter=t.queryParams.search_letter?t.queryParams.search_letter:"All",e.search_field=t.queryParams.search_letter?t.queryParams.search_field:void 0;var g=t.queryParams;e.errorOnModel&&!e.cvDeletePage&&(e.errorHTML=Handlebars.templates.cvError(this.cachedObj));var v=$L("crm-custom-filter");if(n&&v[0]&&"CHARTVIEWS"!==c&&v[0].setData("filterQueryParams",{filters:g.filters,cross_filters:g.cross_filters,filter_id:g.filter_id}),e.filterQueryParams={filters:g.filters,cross_filters:g.cross_filters,filter_id:g.filter_id},this.setSortBySummary(e),"CAMPAIGNMEMBERLISTVIEW"===e.featureName){var f=$L("crm-customview-layer")[0];f&&f.setData("show_loading",!1)}if(a&&"CAMPAIGNMEMBERLISTVIEW"===e.featureName&&i.id){var h=$L("crm-customview-layer")[0];e.selectedIds=h.component.data.selectedIds;var y=e.cv_records.findIndex((e=>e.id===i.id));-1!==y&&e.cv_records[y].$approved&&(e.selectedIds.push(i.id),e.showNextAction=!0),this.cachedObj.selectedIds=e.selectedIds;var w=1===e.selectedIds.length?I18n.getMsg("crm.record.not.accessible"):I18n.getMsg("records");h.component.setData("selected",I18n.getMsg("crm.listview.selected.records",[e.selectedIds.length,w])),document.querySelector("crm-customview-layer").setData(e)}if(n)if(e.isFromModal=!0,e.queryParams=g,o||a){document.querySelector("crm-list-view-modal").setData(e)}else{var C=document.querySelector("#listViewPopup");null!==C&&C.remove(),Lyte.Component.render("crm-list-view-modal",e,"body")}else this.reRender=m,app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box",reRender:m})}},postRender:function(e,t,s){if(!crmHistory.transitionError&&!e.cvDeletePage){if("Accounts"!==e.module&&"Contacts"!==e.module||(this.cachedObj.isZBCustomModuleEnabled=moduleRecordMapping[e.module].zb_custommodule_enabled),delete this.fetchCount,!e.errorOnModel){this.cachedObj.isKanbanView=!1,this.cachedObj.isStageView=!1,this.cachedObj.isPredictView=!1;var r=t.queryParams;if(this.cachedObj.filters=r.filters?JSON.parse(r.filters):void 0,this.cachedObj.cross_filters=r.cross_filters?JSON.parse(r.cross_filters):void 0,crmTab.putInCache(e.module,this.cachedObj),customViewObject=this.cachedObj,!this.triggerRecordCount){var i=$L("crm-customview-layer")[0];i&&i.setData("show_loading",!1)}if(!customViewObject.selectedIds||!customViewObject.selectedIds.length){var o=$L("crm-custom-filter")[0];o&&o.classList.remove("selectAllOverlay");var a=$L("#viewcontainer")[0];a&&a.classList.remove("selectAllOverlay")}var n=$L("#listviewtablescroll");n[0]&&n.removeClass("lvTHPointerEventNone"),this.headerSelection(moduleRecordMapping[e.module]);var c=$L("crm-customview-buttons")[0];c&&(c.component.setData("start_index",e.startIndex),c.component.setData("total_count",e.total_count)),customViewObject.filterId=customViewObject.filter_id=r.filter_id?r.filter_id:void 0,customViewObject.screenName=this.portalName,customViewObject.isPrivacyListView=e.isPrivacyListView,this.constructNavigObject(s,e.customview_records,e.module,moduleRecordMapping[e.module].per_page);var l=$L("#newPopup"),d=$L("crm-inner-list");l[0]&&d[0]&&(l[0].ltProp("show",!1),d[0].setData("columnListOpen",!1)),moduleRecordMapping[e.module].territory&&moduleRecordMapping[e.module].territory.id&&(customViewObject.territoryId=moduleRecordMapping[e.module].territory.id,customViewObject.includeChild=moduleRecordMapping[e.module].territory.subordinates),delete customViewObject.isCustomizedView,this.getUpdatedActions(e.module,s)}delete this.triggerRecordCount,commonUtils.showHideLoadingDiv()}},getModuleData:function(e,t){if("Contact Role"!==e){if("OneFeeds"===e&&(e="Feeds"),void 0===moduleRecordMapping[e]&&moduleRecordMapping[e.replace(" ","/")]&&(e=e.replace(" ","/")),(e.indexOf("CustomModule")>=0||e.indexOf("Orchestration")>=0&&"Orchestration"!==e||e.indexOf("PathFinder")>=0&&"PathFinder"!==e||e.indexOf("LinkingModule")>=0||window.clientPortalName||"Visits"===e&&"object"==typeof CrmTracking&&CrmTracking.portalsInfo||"Services"===e||"Appointments"===e)&&moduleRecordMapping[e]&&(!moduleRecordMapping[e].custom_view||!moduleRecordMapping[e].custom_view.id)&&(!window.clientPortalName||"web"!==moduleRecordMapping[e].generated_type)&&!moduleRecordMapping[e].web_link)return store.findAll("custom_view",{module:moduleRecordMapping[e].api_name}).then((function(t){return t&&(moduleRecordMapping[e].cvid=t.$.meta.default),moduleRecordMapping[e].api_supported?store.findRecord("module",moduleRecordMapping[e].id).then((function(t){return{module:t.module?t.module[0]:moduleRecordMapping[e],module_name:e}})):{module:moduleRecordMapping[e],module_name:e}}));if(moduleRecordMapping[e]&&!moduleRecordMapping[e].cvid&&"crm.tab.module.promo"===this.transition.target)return this.handlePromo(e);e="Potentials"===e?"Deals":e;var s=moduleRecordMapping[e],r=["crm.tab.module.entity.edit","crm.tab.module.create","crm.tab.module.entity.clone"];if((["crm.settings.section.client-portal.user-types.index","crm.settings.section.client-portal.user-types.users","crm.settings.section.client-portal.user-types.summary"].includes(t)||t.indexOf("crm.tab.module.custom-view")>-1||t.indexOf("crm.tab.module.entity")>-1||t.indexOf("crm.settings.section.compliance.consent-dashboard.list-view")>-1||t.indexOf("crm.tab.module.actions.mass-tools")>-1)&&s&&s.api_supported&&(!s.crux_customViewAccessedModules||s.crux_customViewAccessedModules&&-1===crmConstants.cachedModules.indexOf(e))){this.transition&&r.contains(this.transition.target)&&(this.transition.data.skipModuleReqTrigger=!0);var i={};if(i.module=app.store.makeRequest("findRecord","module",s.id,void 0,void 0,void 0,{fetchViewPref:!0}),s.crux_customViewAccessedModules=!0,!window.clientPortalName){var o=crmConstants.moduleVsCrossModules[e];if(o){for(var a=o.length,n=0;n<a;n++){var c=moduleRecordMapping[o[n]];("Visits"!==c.module_name||"Visits"===c.module_name&&"object"==typeof CrmTracking&&CrmTracking.portalsInfo)&&(i["request"+(n+1)]=l(c.id))}function l(e){return new Promise((function(t){app.store.makeRequest("findRecord","module",e,void 0,void 0,void 0,{getFields:!0}).then((function(e){t(e[0])}),(function(){t()}))}))}}}return Lyte.resolvePromises(i).then((function(t){t.module=Array.isArray(t.module)?t.module[0]:t.module,t.module=t.module?t.module:moduleRecordMapping[e],t.module_name=e;for(var s=1;t["request"+s];)t["request"+s]=t["request"+s],s++;if(Lyte.registeredMixins["crm-dataprivacy-mixin"].isGDPREnabledForModule(t.module_name)){let e=Lyte.registeredMixins["crm-dataprivacy-mixin"].getRequiredConsentFieldsColumnNames(t.module.fields);return e.length>0?store.findAll("field",{module:"Consents",type:"all"},!0,!0,{apiVersion:"2.2"}).then((function(s){let r=s.length;for(let i=0;i<r;i++)e.includes(s[i].column_name)&&(t.module.fields.push(s[i]),e.splice(i,1));return t})):t}return t}))}var d=Lyte.Router.getRouteInstance().parent.routeName,u=s?s.relatedModules:void 0;return-1===["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(e)&&("Activities"===e&&(s=moduleRecordMapping[this.getQueryParams().sub_module]),s&&s.id&&s.api_supported&&-1!==["crm.tab.module.create"].indexOf(Lyte.Router.getRouteInstance().transition.target)||d&&"entity"===d)?(this.transition&&r.contains(this.transition.target)&&(this.transition.data.skipModuleReqTrigger=!0),app.store.makeRequest("findRecord","module",s.id,{include:["layouts","lookup_field_properties","custom_view","related_lists","business_card_fields"]}).then((function(){return{module:moduleRecordMapping[e],module_name:e,relatedModules:u}}))):{module:moduleRecordMapping[e],module_name:e,relatedModules:u}}},postModuleDataFetch:function(e){("Leads"===e||"Contacts"===e||"Campaigns"===e)&&moduleRecordMapping.Campaigns.viewable&&moduleRecordMapping.Campaigns.visible&&app.store.makeRequest("findAll","campaign_status",{module:"Campaigns"},!0)},getCustomViewData:function(e,t,s){var r,i,o,a,n,c,l=store.peekRecord("module",moduleRecordMapping[e].id),d=l.id,u=[],m=[],p=!(Crm.userDetails.CLIENT_ACCOUNT||!crmTab.isABMConfigured)&&store.peekRecord("account-configuration","account"),_=!(Crm.userDetails.CLIENT_ACCOUNT||!crmTab.isABMConfigured)&&store.peekRecord("contact-configuration");if(l.actions||(store.model[d]||store.registerModel(d,{},{extends:"entity"}),o=app.store.makeRequest("triggerAction",d,"mass_actions",{cvid:t,type:"GET"})),this.isOldTagCriteria){var g="Activities"===l.api_name?this.isOldTagCriteria.searchModule:l.api_name;delete this.isOldTagCriteria,r=app.store.makeRequest("findAll","tag",{module:g,fromPage:"view"},!0)}"Activities"===e&&"crm.tab.module.custom-view.kanban"==s.target||(i=app.store.makeRequest("findAll","filter",{module:l.api_name,cvid:t},!0,void 0,{cvid:t,module:l.api_name})),!l.api_supported||"Calls"===e||"Services"===e||"Appointments"===e||e.startsWith("Orchestration")||e.startsWith("PathFinder")||(a=app.store.makeRequest("findAll","custom_button",{module:l.api_name,fields:"id,name,description,profiles,layouts,sequence_number,position,user_types,action"},!1,void 0,{isV6Api:!0}));var v=this.fetchViewPreferences(l),f=this.fetchRelatedList(l);Crm.userDetails.CLIENT_ACCOUNT||!crmTab.isABMConfigured||crmTab.isABMFieldAvaiable||(p||(u=app.store.makeRequest("findAll","account-configuration")),_||(m=app.store.makeRequest("findAll","contact-configuration")),c=app.store.makeRequest("findAll","field",{module:"ABM_Account__s"},null,null,{apiVersion:"4"}),crmTab.isABMFieldAvaiable=!0),Crm.userDetails.isRelatedModuleFilters&&!window.clientPortalName&&(n=store.findAll("dummy",{module:l.api_name,from:"views"},!1,!1,{url:"/crm/v2.2/settings/child_relationships",method:"GET"}));const h=this;return Lyte.resolvePromises({filter:i,custom_button:a,actions:o,tag:r,relatedList:f,view_preference:v,relatedModules:n}).then((function(t){var s={};if(t&&t.relatedModules&&t.relatedModules.child_relationships?moduleRecordMapping[e].relatedModules=t.relatedModules.child_relationships:Crm.userDetails.isRelatedModuleFilters&&(moduleRecordMapping[e].relatedModules=[]),t.relatedList&&(s.related_lists=t.relatedList),t.actions&&t.actions.actions&&(moduleRecordMapping[e].actions=t.actions.actions),t.custom_button&&t.custom_button.length){var r=h.filterButtonData(t.custom_button,{position:"list_view_without_record",moduleName:e}),i=h.filterButtonData(t.custom_button,{position:"list_view_each_record",moduleName:e});s.list_cv_btn=i||[],s.layerBtn=r||[]}else s.list_cv_btn=[];return s.saved_filters=t.filter?t.filter:[],s.tags=t.tag?t.tag:[],Lyte.resolvePromises({accountConfig:u,contactConfig:m,abmAccountField:c}).then((function(){return s}),(function(){return s}))}))},findObjectFromArray:function(e,t,s){return e.filter((function(e){return e[s]===t}))},calculatefixedColumnWidth:function(){for(var e=$L("crux-table-component")[0].component.data.cxPropHeaderYield.prefix,t=0,s=e.length,r=0;r<s;r++){var i=e[r];if("enable"===i.fixed){var o=getComputedStyle(document.getElementsByClassName(-1!==i.class.indexOf("lv_activityLink")?"lv_activityLink":i.class)[0]);if(o){var a=void 0!==o.width&&"0px"!==o.width?o.width.substring(0,o.width.indexOf("px")):-1!==i.class.indexOf("lv_activityLink")?120:36;t+=Math.round(a)}}}return t},populateModuleActionsMenu:function(e,t){var s=[],r=e.module,i=e.module_info.actions,o=store.peekRecord("custom_view",e.cvId),a=o&&("CONVERTEDVIEWS"===o.system_name||"MYCONVERTEDVIEWS"===o.system_name);if(!t&&r){if(r.indexOf("Orchestration")<0&&Crm.userDetails.permissions["Crm_Implied_Edit_"+r]&&s.push({name:I18n.getMsg("crm.button.edit"),value:"Edit"}),i){var n=!1;i.forEach((function(e){"action"===e.type&&("sendmail"===e.name&&Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+r]||"sendmail_potential"===e.name||"bulktask"===e.name&&Crm.userDetails.permissions.Crm_Implied_Create_Tasks&&moduleRecordMapping.Tasks.visible&&!a&&"Visits"!==r||"mass_convert"===e.name||"change_owner"===e.name&&Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+r]&&!a||"mass_delete"===e.name&&Crm.userDetails.permissions["Crm_Implied_Delete_"+r])&&("mass_convert"!==e.name||"Quotes"!==r&&"SalesOrders"!==r?s.push({name:"mass_convert"===e.name?I18n.getMsg("crm.button.convert"):e.display_label,value:e.name}):n=!0),"action"===e.type&&"tag_op"===e.name&&s.push({name:e.display_label,value:e.name}),"action"===e.type&&"mass_convert"===e.name&&(n=!0)})),n||!Crm.userDetails.permissions["Crm_Implied_Convert_"+r]||"Leads"!==r||a||s.push({name:I18n.getMsg("crm.button.convert"),value:"mass_convert"})}var c,l,d=e.relatedListForModule;void 0===d&&(d=moduleRecordMapping[r].related_lists?moduleRecordMapping[r].related_lists:store.peekAll("related_list",{module:r})),d&&(void 0===e.relatedListForModule&&(e.relatedListForModule=d),d.filter((function(e){c=c||"APPOINTMENTSPERSONALITY"===e.personality_name,l=l||"ACTIVITYPERSONALITY"===e.personality_name}))),Crm.userDetails.activityBadgeUpgradeEnabled&&s.push({name:I18n.getMsg("workflow.webHook.copyUrl"),value:"copy_url"});var u=moduleRecordMapping.Events&&moduleRecordMapping.Events.visible||moduleRecordMapping.Calls&&moduleRecordMapping.Calls.visible||c&&moduleRecordMapping.Appointments&&moduleRecordMapping.Appointments.visible;c&&["Tasks","Calls","Events"].push("Appointments"),!a&&u&&(l&&(Crm.userDetails.permissions.Crm_Implied_Create_Calls||Crm.userDetails.permissions.Crm_Implied_Create_Events)||c&&Crm.userDetails.permissions.Crm_Implied_Create_Appointments)&&s.push({name:I18n.getMsg("crm.menu.more"),value:"more"})}return s},displayLimitExceededPopup:function(e,t,s,r){var i=$L("crm-lookuplimit-exceed-popup")[0],o={showModal:!0,lookups:e};t&&((o={showModal:!0,limitArrObj:e,includeCrossFilter:!0,limit:s}).titleLimitMsg=r?I18n.getMsg("crm.title.max.related.modules.new"):I18n.getMsg("crm.title.max.other.modules.new"),o.limitMsgInfo=r?I18n.getMsg("crm.msg.exceeds.max.related.modules.limit1.new",s):I18n.getMsg("crm.msg.exceeds.max.other.modules.limit1.new",s)),i?i.component.setData(o):Lyte.Component.render("crm-lookuplimit-exceed-popup",o,"body")},preFetchForCanvas(e,t,s,r,i,o){var a=moduleRecordMapping[e],n=crmTab.getFromCache(a.module_name);this.cachedObj=n||{};var c=store.peekAll("canvasview").filter((function(e){return"DetailView"!==e.feature}));store.unloadAll("canvasview",c);var l={views:store.findRecord("canvasview",s,{parsed:!0},void 0,void 0),customRecord:this.preFetch(o,e,t,i)},d=this;return Lyte.resolvePromises(l).then((function(e){d.getQueryParams().viewType&&e.views&&e.views[0]&&d.getQueryParams().viewType!==e.views[0].view_type&&d.setQueryParams("viewType",e.views[0].view_type),e.rules=[];var t=e.views&&e.views[0]?e.views[0]:[];return!t.related_to||!t.related_to.feature_info||t.related_to.feature_info.contains("detailview_canvasrules")?Lyte.resolvePromises(store.findAll("canvas_rule",{},null,null,{customizationId:s})).then((function(t){return e.rules=t,e}),(function(){return e})):e}))},FetchForCanvas:function(e,t,s,r,i,o){var a=moduleRecordMapping[t],n=this.getDynamicParam(),c=store.peekRecord("canvasview",n);if(a.chart_view&&a.$.set("chart_view",!1),a.timeline_view&&a.$.set("timeline_view",!1),c&&c.canvas_enabled){a=moduleRecordMapping[t];"CustomizedView"!==e.queryParams.viewType||a.canvas_view&&a.viewid===e.dynamicParam||(a.$.set("canvas_view",!0),a.$.set("card_view",!1),a.$.set("table_view",!1),a.$.set("viewid",e.dynamicParam),a.$.set("default_view",{name:"canvas_view",id:e.dynamicParam}),a.$.save()),"CardView"!==e.queryParams.viewType||a.card_view&&a.cardid===e.dynamicParam||(a.$.set("card_view",!0),a.$.set("canvas_view",!1),a.$.set("table_view",!1),a.$.set("cardid",e.dynamicParam),a.$.set("default_view",{name:"card_view",id:e.dynamicParam}),a.$.save()),"TableView"!==e.queryParams.viewType||a.table_view&&a.tableid===e.dynamicParam||(a.$.set("card_view",!1),a.$.set("canvas_view",!1),a.$.set("table_view",!0),a.$.set("tableid",e.dynamicParam),a.$.set("default_view",{name:"table_view",id:e.dynamicParam}),a.$.save());var l=[],d=[];this.getFieldsInvolvedinCanvas(c,d),r=r||{};var u={components:{components:[{type:"field"},{type:"button"},{type:"link"}]},module:t,views:store.peekAll("canvasview").filterBy({feature:"ListView"})};c&&c.related_to&&c.related_to.feature_info?(u.link=c.related_to.feature_info.contains("custom_link")?app.store.makeRequest("findAll","custom_link",{module:a.api_name}):[],u.button=c.related_to.feature_info.contains("custom_button")?app.store.makeRequest("findAll","custom_button",{module:a.api_name}):[]):(u.link=app.store.makeRequest("findAll","custom_link",{module:a.api_name}),u.button=app.store.makeRequest("findAll","custom_button",{module:a.api_name})),u.currentModuleData=this.parent.parent.currentModuleData?this.parent.parent.currentModuleData:{};var m=this;return new Promise((function(a,n){Lyte.resolvePromises(u).then((function(c){return d.filter((function(e){store.peekRecord("field",e.split("_")[0])&&l.push(store.peekRecord("field",e.split("_")[0]).api_name)})),e.fldUsedinCanvas=l,u.record_details=m.initiateRequest(e,r,t,o||{},s,i),Lyte.resolvePromises(u).then((function(e){var t={};for(var s in e)if("record_details"===s)for(var r in e[s])t[r]=e[s][r];else t[s]=e[s];a(t)}),(function(e){commonUtils.showHideLoadingDiv(!1),n(e)}))}),(function(e){commonUtils.showHideLoadingDiv(!1),n(e)}))}))}if(e.queryParams.viewType||!a.viewid){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:I18n.getMsg("crm.canvas.view.delete.message"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg").style="color:#E20000"}});var p=store.peekAll("canvasview").filterBy({view_type:e.queryParams.viewType});switch(p=(p=p.filter((function(e){return e.module.id===moduleRecordMapping[t].id&&e.canvas_enabled}))).sortBy("created_time","asc"),e.queryParams.viewType){case"CustomizedView":p[0]?moduleRecordMapping[t].viewid=p[0].id:(delete moduleRecordMapping[t].viewid,moduleRecordMapping[t].canvas_view=!1);break;case"CardView":p[0]?moduleRecordMapping[t].cardid=p[0].id:(delete moduleRecordMapping[t].cardid,moduleRecordMapping[t].card_view=!1);break;case"TableView":p[0]?moduleRecordMapping[t].viewid=p[0].id:(delete moduleRecordMapping[t].tableid,moduleRecordMapping[t].table_view=!1)}this.replaceWith({route:"crm.tab.module.custom-view.list",dynamicParams:[a.module_name,a.cvid]})}else this.replaceWith({route:"crm.tab.module.custom-view.canvas",dynamicParams:[a.module_name,a.cvid,a.viewid],queryParams:{viewType:"CustomizedView"}})},getFieldsInvolvedinCanvas:function(e,t){for(var s,r=e&&e.children||[],i=r.length,o=0;o<i;o++){var a=(s=r[o]).children;"field"===s.type?s.id&&!t.includes(s.id)&&t.push(s.id):"component"!==s.type||"canvas_progress_bar"!==s.theme&&"canvas_progress_circle"!==s.theme?a&&a.length>0&&this.getFieldsInvolvedinCanvas(s,t):s.mapped_field_id&&!t.includes(s.mapped_field_id)&&t.push(s.mapped_field_id)}if(e.ui&&e.ui.canvas_rules){var n=[];e.ui.canvas_rules.filter((function(e){n.includes(e.id)||n.push(e.id)})),this.getFieldsInvolvedinCanvasRule(n).filter((function(e){t.includes(e)||t.push(e)}))}},getFieldsInvolvedinCanvasRule:function(e){var t=[];return e.filter((function(e){var s=store.peekRecord("canvas_rule",e);s&&Lyte.registeredMixins["crm-view-utils"].getFieldsInvolvedinCanvasRuleCriteria(s.criteria,t)})),t},constructPayloadForReorder:function(e,t,s){var r=[],i=t.length,o=e.length;if(0===i)for(var a=0;a<o;a++){var n={id:e[a],sequence_number:a+1};r.push(n)}else for(a=0;a<i;a++){n={};s||e[a]===t[a]?s&&s.has(t[a])&&e[a]!==t[a]&&(n.id=t[a]?t[a]:e[a],n.sequence_number=a+1,r.push(n)):(n.id=t[a]?t[a]:e[a],n.sequence_number=a+1,r.push(n))}return r},getFieldsInvolvedinCanvasRuleCriteria:function(e,t){e.group?e.group.filter((function(e){Lyte.registeredMixins["crm-view-utils"].getFieldsInvolvedinCanvasRuleCriteria(e,t)})):t.includes(e.field.id)||t.push(e.field.id)},pushChildModulePayloads:function(e){for(var t=e.length,s=[],r=0;r<t;r++)if(e[r].module&&e[r].api_name&&e[r].module.module_name&&!moduleRecordMapping[e[r].module.module_name]){var i=e[r].module.module_name;idModuleMapping[e[r].module.id]=i,Crm.moduleInfo&&Crm.moduleInfo[i]&&"Users"===i&&"true"===Crm.moduleInfo[i].isVisible&&(e[r].module.visible=!0,e[r].module.viewable=!0);["Cadences_Followups","Entity_Cadences","Users","WebformUsage","EmailSentiment","Competitors","Competitor Mentions","Google AdWords","GoogleAdsAccount","GoogleAdsAccountHistory","GoogleAdsCampaign","GoogleAdsCampaignHistory","GoogleAdGroup","GoogleAdGroupHistory","GoogleAdwordAd","GoogleAdwordAdHistory","GoogleAdKeyword","GoogleAdKeywordHistory","Forecast Predictions","Forecast Analysis","Forecast Prediction Stats","Messages","MarketingAttributions","Facebook","Twitter","LockingInformation","VocAnswers","VocAnswers1","VocAnswers2","VocEvents","VocEvents1","VocEvents2","VocInferences","VocInferences1","VocInferences2","VocResponses","VocResponses1","VocResponses2","VocResources","VocQuestions","Review Processes","Review Logs"].contains(i)||["Visits_Zoho_Livedesk__r","Locking_Information__s__r","Email_Sentiment__r","Entity_Scores__s__r","similarity_whom__r","similarity_user__r","Marketing_Attributions__r","Activities__r","bundle_whom__r","first_buy_whom__r","cross_selling_whom__r","re_buy_whom__r","next_buy_whom__r","Blueprint_Logs__r"].contains(e[r].api_name)||(e[r].module.addedForCrossFilter=!0,s.push(e[r].module))}s.length>0&&store.pushPayload("module",s)},deleteChildModulePayloads:function(e){for(var t=e.length,s=[],r=0;r<t;r++){var i=e[r].module.module_name;moduleRecordMapping[i]&&moduleRecordMapping[i].addedForCrossFilter&&(s.push(moduleRecordMapping[i].id),delete moduleRecordMapping[i])}s.length>0&&store.deleteMany("module",s)},sortArray:function(e,t){return e.sort((function(e,s){if(!e[t])return 0;var r=e[t].toUpperCase(),i=s[t].toUpperCase();return r<i?-1:r>i?1:0})),e},scheduleSyncToRedis:function(){try{var e=localStorage.getItem("syncJobId"),t=null,s=null;if(e){var r=e.split("_");t=r[0],s=r[1]}var i=$L.moment().toDate().getTime();if(i=Math.floor(i/1e3),null!==t&&t)i-s>=600?(clearTimeout(t),localStorage.removeItem("syncJobId"),this.syncDataToRedis()):setTimeout(this.scheduleSyncToRedis.bind(this),6e4);else{var o=setTimeout(this.syncDataToRedis.bind(this),6e5);localStorage.setItem("syncJobId",o+"_"+i)}}catch(e){murphy.error(e)}},syncDataToRedis:function(){try{var e={},t=[];e.record_views={module_access:t};var s=JSON.parse(localStorage.getItem("lastAccessedTime"));for(const e in s)if(s.hasOwnProperty(e)&&"InsertionOrder"!==e){const i=s[e],o=e.split("_"),a=o[0],n=o[1];if(!Lyte.registeredMixins["crm-view-utils"].validateModuleandIdForRecordViews(e)){delete s[e];const t=s.InsertionOrder.filter((t=>t!==e));s.InsertionOrder=t;continue}var r={module:{api_name:moduleRecordMapping[a].api_name,id:n}};r.last_accessed_time=i,t.push(r)}localStorage.setItem("lastAccessedTime",JSON.stringify(s));t.length>0&&Crm.userDetails.lastAccessedTimeofModuleForMobile&&store.triggerAction("dummy","dummyAction",{contentType:"application/json",url:"/crm/v6/__internal/__user_specific_data/record_views",payLoad:e},void 0,"PUT"),localStorage.removeItem("syncJobId"),this.scheduleSyncToRedis()}catch(e){murphy.error(e)}},validateModuleandIdForRecordViews:function(e){const t=e.split("_"),s=t[0],r=t[1];let i=r;if(!Number.isNaN(Number(i))&&s&&moduleRecordMapping.hasOwnProperty(s)){let e,t;try{e=moduleRecordMapping[s].id}catch(e){return!1}if(e&&(Object.entries(moduleRecordMapping).forEach((([e,s])=>{`${s.id}`===r&&(t=`${e}`)})),t===s&&e===r))return!0}return!1},updateLastAccessedTime:function(e){var t,s,r=$L.moment().toDate().toISOString().slice(0,19).concat("Z");if(localStorage.hasOwnProperty("lastAccessedTime")&&(t=localStorage.getItem("lastAccessedTime")),t&&(s=JSON.parse(t)),s||((s={}).InsertionOrder=[]),s.hasOwnProperty("InsertionOrder")){var i=s.InsertionOrder;if(i.length>=50)delete s[i.shift()]}if(moduleRecordMapping.hasOwnProperty(e)){var o=e+"_"+moduleRecordMapping[e].id;s.hasOwnProperty(o)&&(s.InsertionOrder=s.InsertionOrder.filter((e=>e!==o))),s.InsertionOrder.push(o),s[o]=r,localStorage.setItem("lastAccessedTime",JSON.stringify(s)),this.scheduleSyncToRedis()}},segregateCVList:function(e,t,s){var r=["Favorites","created_by_me","shared_with_me","public_views","other_users_views"],i=[];if(app.cvCategory){var o={};for(var a in Object.defineProperty(o,app.cvCategory.created_by_me,{value:[],writable:!0,enumerable:!0}),i.push(o),o={},Object.defineProperty(o,app.cvCategory.shared_with_me,{value:[],writable:!0,enumerable:!0}),i.push(o),o={},Object.defineProperty(o,app.cvCategory.public_views,{value:[],writable:!0,enumerable:!0}),i.push(o),o={},Object.defineProperty(o,app.cvCategory.other_users_views,{value:[],writable:!0,enumerable:!0}),i.push(o),app.cvCategory)-1===r.indexOf(a)&&(o={},Object.defineProperty(o,app.cvCategory[a],{value:[],writable:!0,enumerable:!0}),i.push(o))}for(var n=i.length,c=e?e.length:0,l=0;l<c;l++)if(-1===s.indexOf(e[l].system_name))for(var d=e[l].category,u=0;u<n;u++)-1!==Object.keys(i[u]).indexOf(app.cvCategory[d])&&i[u][app.cvCategory[d]].push(e[l]);if("Leads"===t){var m=[];i.filter((function(e){void 0!==e[app.cvCategory.public_views]&&(m=e[app.cvCategory.public_views])}));var p=m.filter((function(e){if("All Open Leads"===e.name)return e}));p&&p.length>0&&"All Open Leads"===p[0].name&&(p[0].name="All Leads",m.sort(((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:t.name.toLowerCase()>e.name.toLowerCase()?-1:0)),p[0].name="All Open Leads")}return i},checkAndRenderPublicFields:async function(e,t,s){if(!1===featuresAvailable.PUBLIC_FIELD||void 0===moduleRecordMapping[e]||void 0!==Crm.activityGrp[e]||"Appointments"===e||"Services"===e||!moduleRecordMapping[e].public_fields_configured)return!1;let r="_self";if(void 0!==s){if(!0===s.ctrlKey||!0===s.metaKey||2===s.which)return!1;let e=s.target.closest("A");if(null!=e&&(null!=e.id&&e.id.includes("listView")))return!1;if("LYTE-TEXT"===s.target.tagName&&"A"===s.target.parentElement.tagName&&"LINK-TO"===s.target.parentElement.parentElement.tagName){if(s.target.parentElement.parentElement.getAttribute("lt-prop-route").indexOf("edit")>0)return!1}r="A"===s.target.tagName&&"_blank"===s.target.target||"LYTE-TEXT"===s.target.tagName&&"A"===s.target.parentElement.tagName&&"_blank"===s.target.parentElement.target||"TD"===s.target.tagName&&null!==s.target.parentElement.getAttribute("target")&&"_blank"===s.target.parentElement.getAttribute("target")?"_blank":"_self",s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation()}else r="_blank";commonUtils.showHideLoadingDiv(!0);let i={};try{i=await store.triggerAction("entity","public_data",{param:"approved=both&converted=both&formatted_currency=true&home_converted_currency=true&on_demand_properties=%24client_portal_permission",type:"GET",module:moduleRecordMapping[e].api_name,entityId:t})}catch(s){return commonUtils.showHideLoadingDiv(!1),Lyte.registeredMixins["crm-view-utils"].publicPageFailureTransition(e,t,r,!1)}if(0===Object.keys(i).length)return Lyte.registeredMixins["crm-view-utils"].publicPageFailureTransition(e,t,r,!1);const o=!!(i&&i.data&&i.data[0].$converted_detail&&0!==Object.keys(i.data[0].$converted_detail).length),a=!!(i&&i.data&&i.data[0].$sharing_permission&&"public_fields_only"===i.data[0].$sharing_permission);if(!a&&i&&i.data&&i.data[0]){const s=i.data[0];return store.modelFor(moduleRecordMapping[e].id)||await store.findRecord("module",moduleRecordMapping[e].id),store.pushPayload(moduleRecordMapping[e].id,s),Lyte.registeredMixins["crm-view-utils"].publicPageFailureTransition(e,t,r,!0)}if(!a||o)return Lyte.registeredMixins["crm-view-utils"].publicPageFailureTransition(e,t,r,!1);let n={},c=!0;featuresAvailable.TEAM_MODULE_ENABLED&&-1!==["convert"].indexOf(Lyte.Router.getRouteInstance().routeName)?c=!0:void 0!==window.clientPortalName&&window.clientPortalName&&(c=!1);const l={},d=moduleRecordMapping[e].child_module?moduleRecordMapping[e].child_module.filter((e=>1==e.public_fields_configured)).sortBy("id"):[];let u=[];try{u=await Lyte.registeredMixins["crm-view-utils"].getPublicFields(moduleRecordMapping[e].api_name,c);const t=d.map((e=>Lyte.registeredMixins["crm-view-utils"].getSubformPublicFields(e.api_name,!0).then((t=>{t.length>0&&(l[e.api_name]=t)}))));await Lyte.resolvePromises(t)}catch(e){murphy.error(e)}if(0===u.length)return Lyte.registeredMixins["crm-view-utils"].publicPageFailureTransition(e,t,r,!1);if(d.length>0&&Object.keys(l).length>0){let t=i.data[0].Layout.id,s=store.peekRecord("layout",t,{module:moduleRecordMapping[e].api_name});if(!s||!s.sections)try{s=(await store.findRecord("module",moduleRecordMapping[e].id,{},void 0,!0,{layoutId:t}))[0].layouts.find((e=>e.id==t))}catch(e){murphy.error(e)}n[moduleRecordMapping[e].api_name]=s}const m=store.peekAll("section").filter((function(t){return t.layout&&t.layout.module&&t.layout.module.api_name===moduleRecordMapping[e].api_name})),p=store.peekRecord("module",moduleRecordMapping[e].id);let _=store.peekAll("field").filter((function(t){return t.module&&t.module[0]&&t.module[0].api_name&&t.module[0].api_name===moduleRecordMapping[e].api_name&&!0===t.display_field})),g=_.length>0?_[0].api_name:"";const v=$L("#public_fields_"+t)[0];if(v){Lyte.registeredMixins["crm-view-utils"].closePublicPage(t);return v.component.setData({recordId:i.data[0].id,recordData:i.data[0],fieldsData:u,moduleName:e,subformsVsfields:l,layoutObj:n,targetBlank:r,moduleSections:m,moduleData:p,recordNameApiName:g,showPublicFieldModal:!0}),commonUtils.showHideLoadingDiv(!1),!0}let f=networkUtils.returnDependencyFiles(["crm-public-fields-view.js","crux-form-component.js","crux-image-upload.js","crux-file-upload-component.js","crm-uploadfields-mixin.js"],ResourceConstants.CRMClient),h=networkUtils.returnDependencyFiles(["crm-public-fields-view.css","crux-subform.css","crux-file-upload-component.css","crm-file-upload-component.css","crux-image-component.css","crm-image-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return u.some((e=>"imageupload"===e.data_type))&&(f=f.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-upload-create.js","crm-image-mixin.js","crm-image-preview.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-vision-create.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(f=f.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css"],ResourceConstants.CRMClient))),f=f.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM)),f=f.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient))),u.some((e=>250===e.ui_type))&&(f=f.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources.js"],ResourceConstants.CRMClient)),f=f.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),"Cases"!==e&&"Solutions"!==e||!u.some((e=>"Comments"===e.api_name))||(f=f.concat(networkUtils.returnDependencyFiles(["crm-comment-information.js"],ResourceConstants.CRMClient)),f=f.concat(networkUtils.returnDependencyFiles(["crm-comment-information.css"],ResourceConstants.CRMClient))),Lyte.registeredMixins["crm-view-utils"].closePublicPage(),Lyte.injectResources(f.concat(h),void 0,(function(){Lyte.Component.render("crm-public-fields-view",{id:"public_fields_"+i.data[0].id,recordId:i.data[0].id,recordData:i.data[0],fieldsData:u,subformsVsfields:l,moduleName:e,layoutObj:n,recordNameApiName:g,targetBlank:r,moduleSections:m,moduleData:p},"#show").setData("showPublicFieldModal",!0)})),commonUtils.showHideLoadingDiv(!1),!0},getPublicFields:async function(e,t){let s=[],r=moduleApiVsNameMapping[e];if(void 0===r||void 0===moduleRecordMapping[r]||void 0!==Crm.activityGrp[r]||"Appointments"===r||"Services"===r)return s;s=store.peekRecord("module",moduleRecordMapping[r].id).fields;let i=void 0!==window.clientPortalName&&window.clientPortalName;s=s&&s.length?s.filter((function(e){return e.module&&e.module[0]&&e.module[0].api_name&&e.module[0].api_name===moduleRecordMapping[r].api_name})):[];try{s&&(!0!==t||s.length)&&0!==s.length||(s=await store.findRecord("module",moduleRecordMapping[r].id,void 0,void 0,void 0,{getFields:!0,getExternalFields:!0}),s=s[0].fields)}catch(e){murphy.error(e),s=[]}return s=i?s.filter((function(e){return e.module&&e.module[0].api_name===moduleRecordMapping[r].api_name&&!0===e.visible&&!0===e.public})):s.filter((function(e){return e.module&&e.module[0].api_name===moduleRecordMapping[r].api_name&&!0===e.public})),s},getSubformPublicFields:async function(e,t){let s=store.peekAll("field"),r=void 0!==window.clientPortalName&&window.clientPortalName;s=s.length?s.filter((function(t){return t.module&&t.module[0]&&t.module[0].api_name&&t.module[0].api_name===e})):[];try{(!0===t&&!s.length||0===s.length)&&(s=await store.findAll("field",{module:e,feature_name:"public_data",include_external_fields:!0,include_inner_details:!0,type:"all"},null,void 0,{apiVersion:"5",include_external_fields:!0,include_inner_details:!0}))}catch(e){murphy.error(e),s=[]}return s=r?s.filter((function(t){return t.module&&t.module[0].api_name===e&&!0===t.visible&&!0===t.public})):s.filter((function(t){return t.module&&t.module[0].api_name===e&&!0===t.public})),s},closePublicPage:function(e){const t=$L("crm-public-fields-view");t&&t.each((function(s){e&&t[s].component.data.id==="public_fields_"+e||t[s].component.setData("showPublicFieldModal",!1)}))},publicPageFailureTransition:function(e,t,s,r){let i="crm.tab.module.entity";void 0!==moduleRecordMapping[e]&&"team_based"===moduleRecordMapping[e].access_type&&moduleRecordMapping[e].private_profile&&"Requesters"===moduleRecordMapping[e].private_profile.name&&(i="crm.tab.requesters.module.index-module.entity"),commonUtils.showHideLoadingDiv(!1);const o={route:i,dynamicParams:[e,t]};return"_blank"===s?networkUtils.openUrl(Lyte.Router.getURL(o),"_blank"):r?(Lyte.registeredMixins["crm-view-utils"].closePublicPage(),Lyte.Router.transitionTo(o).dynamicParams=[e,t,{needPeek:!0}]):(Lyte.registeredMixins["crm-view-utils"].closePublicPage(),Lyte.Router.transitionTo({route:i,dynamicParams:[e,t]})),!1},restrictActionsForCscript:function(e){const t=e.getData("cscript_restricted_actions");t&&t.size&&t.forEach((e=>{$(`[cscript-tag="${e}"]`).addClass("op6 peNone")}))},setCountForChartDrilldown:function(e){var t=$L("crm-custom-outer-box"),s=t.length;$L("crm-customview-layer")[s-1].setData("show_loading",!1),t[s-1].setData("total_count",e)},setChartSummaryLabel:function(e,t,s){if(e.filters)if(s){var r=I18n.getMsg("Empty");t=t||e.filters;if(e.filters.hasOwnProperty("group")){var i=t.group[0];i.hasOwnProperty("group")&&this.setChartSummaryLabel(e,i,!0);var o="EMPTY"===i.label?r:i.label,a=i.field.field_label,n=t.group[1];n.hasOwnProperty("group")&&this.setChartSummaryLabel(e,n,!0);var c="chart"===n.type&&"EMPTY"===n.label?r:n.label,l="chart"===n.type?n.field.field_label:void 0;if(o&&c)e.featureObject.statusLabel=this.getOverallCriteria(this.getFieldCriteriaLabel(a,o),this.getFieldCriteriaLabel(l,c));else{d=o||c,u=a||l;e.featureObject.statusLabel=e.featureObject.statusLabel?this.getOverallCriteria(e.featureObject.statusLabel,this.getFieldCriteriaLabel(u,d)):this.getFieldCriteriaLabel(u,d)}}else{var d="EMPTY"===t.label?r:t.label,u=t.field.field_label;e.featureObject.statusLabel=this.getFieldCriteriaLabel(u,d)}}else this.setChartSummaryLabelWithoutRecursion(e)},setChartSummaryLabelWithoutRecursion:function(e){var t=e.filters,s=I18n.getMsg("Empty");if(e.filters.hasOwnProperty("group")){var r="EMPTY"===t.group[0].label?s:t.group[0].label,i=t.group[0].field.field_label,o="chart"===t.group[1].type&&"EMPTY"===t.group[1].label?s:t.group[1].label,a="chart"===t.group[1].type?t.group[1].field.field_label:void 0;e.featureObject.statusLabel=o?"("+$ESAPI.encoder().encodeForHTML(i)+"  \t<span class=chartview-cri-label>"+I18n.getMsg("is").toUpperCase()+"</span>  \t"+$ESAPI.encoder().encodeForHTML(r)+")  \t<span class=chartview-cri-label>"+I18n.getMsg("crm.label.and")+"</span>  \t("+$ESAPI.encoder().encodeForHTML(a)+"  \t<span class=chartview-cri-label>"+I18n.getMsg("is").toUpperCase()+"</span>  \t"+$ESAPI.encoder().encodeForHTML(o)+")":$ESAPI.encoder().encodeForHTML(i)+"  \t<span class=chartview-cri-label>"+I18n.getMsg("is").toUpperCase()+"</span>  \t"+$ESAPI.encoder().encodeForHTML(r)}else{r="EMPTY"===t.label?s:t.label,i=t.field.field_label;e.featureObject.statusLabel=$ESAPI.encoder().encodeForHTML(i)+"  \t<span class=chartview-cri-label>"+I18n.getMsg("is").toUpperCase()+"</span>  \t"+$ESAPI.encoder().encodeForHTML(r)}},getOverallCriteria:function(e,t){return"("+e+")  \t<span class=chartview-cri-label>"+I18n.getMsg("crm.label.and")+"</span>  \t("+t+")"},getFieldCriteriaLabel:function(e,t){return $ESAPI.encoder().encodeForHTML(e)+"  \t<span class=chartview-cri-label>"+I18n.getMsg("is").toUpperCase()+"</span>  \t"+$ESAPI.encoder().encodeForHTML(t)},isCustomButtonSupportedForModule:function(e){return"Calls"!==e&&"Services"!==e&&"Appointments"!==e&&"Activities"!==e&&!e.startsWith("Orchestration")&&!e.startsWith("PathFinder")},getChartViewResources:function(e){var t=networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM);e||(t=t.concat(networkUtils.returnDependencyFiles(["crm-chart-view-initial.js"],ResourceConstants.CRMClient)));var s=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["crm-chart-view.js","crm-list-view-modal.js","crm-list-view.js","crm-inner-list.js","crm-custom-view.js","crm-column-list.js","crm-cpqdashboard.js","crm-analytical-component-model.js","crm-list-helpers.js","crm-report-chart-common.js","crm-report-dependencies.js","canvasview_model.js","crm-report-util.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient);return t=(t=(t=(t=t.concat(r)).concat(networkUtils.returnDependencyFiles(["crm-chart-view.css","crm-ui-loaders.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(s)).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","custom-view-layer-new.css","crm-page-navigator.css","custom-view-layer-common.css","crm-list-view-crux.css","crm-inner-list-new.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],ResourceConstants.CRMClient))),t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("listview"),networkUtils.getI18nJSUrl("besttimeanalytics"),networkUtils.getI18nJSUrl("Dashboard"),networkUtils.getI18nJSUrl("Reports"),networkUtils.getI18nJSUrl("chartview")],ResourceConstants.CRM))},renderChartView:function(e,t,s,r,i,o,a){var n={},c=this.getChartViewResources();n.moduleInfo=r||this.getModuleData(e,Lyte.Router.getRouteInstance().transition.target),n.customView=this.customviewRequestCall(e,t);var l=Lyte.registeredMixins["crm-chartview-utils"];Lyte.injectResources(c).then((function(){Lyte.resolvePromises(n).then((function(t){r=t.moduleInfo.module;var n=t.customView;n&&(r.$.set("custom_view",n),r.$.set("cvid",n.id),l.getChartViewsData(e,s,r,i,o,a))}))}))},customviewRequestCall:function(e,t){if(t){var s=store.peekRecord("custom_view",t);return s||store.findRecord("custom_view",t,{module:e})}for(var r,i=store.peekAll("custom_view"),o=i?i.length:0,a=0;a<o;a++){var n=i[a];if("ALLVIEWS"===n.system_name&&n.module.api_name===e){t=n.id,r=n;break}}return t?r:store.findAll("custom_view",{module:e}).then((function(e){for(var s,r=e.length,i=0;i<r;i++)if("ALLVIEWS"===e[i].system_name){t=e[i].id,s=e[i];break}return s}))},renderKanbanView:function(e,t,s,r){var i=networkUtils.returnDependencyFiles(["crm-kanbanview-util.js"],ResourceConstants.CRMClient);Lyte.injectResources(i,void 0,function(){Lyte.registeredMixins["crm-kanbanview-util"].renderKanbanViewComponent(e,t,s,r)}.bind(this))},getKanbanDependencyFiles:function(){return networkUtils.returnDependencyFiles(["crm-kanbanview-util.js","lyte-counter.js"],ResourceConstants.CRMClient)},getKanbanResourcesFiles:function(e){var t=[];return t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-create-mixin.js","canvasview_model.js","crm-list-helpers.js","crux-combo-box.js","crm-dataprivacy-mixins.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient)),"Activities"!==e&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-kanban-resources.js","crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","phone-entity.js","call-fromto-field.js","calls-kanbancard.js","crm-vision-create.js","entity-field.js","businesscard_model.js","crux-form-component.js"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload-ziaError.css","crm-image-upload-rtl.css"],ResourceConstants.CRMClient))),t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-preview.css","crm-image-upload-create.css","crm-image-upload.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("FieldOfLookup"),networkUtils.getI18nJSUrl("kanbanview"),networkUtils.getI18nJSUrl("listview")],ResourceConstants.CRM))),Crm.userDetails.ValidationAlertPreference&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM))),"Calls"!==e&&"Events"!==e&&"Tasks"!==e||(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("KanbanViewDeprecationBanner")],ResourceConstants.CRM))),t=t.concat(networkUtils.returnDependencyFiles(["kanbanview/crm-kanban-lyte-resources.css","kanbanview/crm-kanban-resources.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getModulePermissionObj:function(e){var t={};return e.forEach(function(e){var s,r=moduleRecordMapping[e];if(t[e]={moduleVisibility:!1,creatable:!1,id:!1,rlVisible:!1},r){var i=this.getData("related_lists");i&&(s=i.filter((function(e){var t="Appointments__s"===r.api_name?"Appointments":r.api_name;return e.personality_name===t.toUpperCase()+"PERSONALITY"})));var o=r.viewable&&r.visible;s&&s[0]&&(t[e]={moduleVisibility:o,creatable:r.creatable,id:r.id,rlVisible:s[0].visible})}}.bind(this)),t},focusSmartFilterField:function(e,t){switch(e.data_type){case"email":case"text":case"textarea":case"website":case"twitter":case"autonumber":case"multiselectpicklist":case"phone":case"lookup":if(e&&e.ui_type===CrmField.UITYPES.TAGS){(i=t.querySelector("lyte-dropdown"))&&i.open()}else{var s=t.querySelector("lyte-input");s&&s.click()}break;case"integer":case"currency":case"percent":case"double":case"bigint":case"decimal":case"date":case"datetime":var r=t.querySelector("lyte-number");r&&r.click();break;case"ownerlookup":case"userlookup":case"picklist":case"boolean":var i;(i=t.querySelector("lyte-dropdown"))&&i.open()}},transitionToWebTab(e){if(e){const t=/WebTab\d+/,s=e=>e.match(t),r=s(e),i=e.includes("?");if(r.length){const t={route:"crm.tab.module.index-module",dynamicParams:[r[0]]};if(i){const s={},r=e.split("?");if(r.length>1){r[1].split("&").forEach((e=>{const t=e.split("=");(t.length=2)&&(s[t[0]]=decodeURI(t[1]))}))}t.queryParams=s}Lyte.Router.transitionTo(t)}}},toTransitionToWebTab(e,t){const s="same_tab"===t;return e.includes("tab/WebTab")&&Crm.userDetails.CUSTOM_BUTTON_INVOKE_URL_LYTE_TRANSITION&&s},getActivityRelatedList:function(e){if("Activities"!==e){var t=this.getData("related_lists");const e=$L("crm-listpage-components")[0],s={Activities_Chronological_View:"chronologicalId",Tasks:"tasksId",Events:"meetingsId",Calls:"callsId",Open_Appointments__s:"appointmentsId",Notes:"notesId"};t.forEach((t=>{const r=s[t.api_name];r&&e.setData(r,t.id)}))}},hideFieldColumn:function(e,t,s){commonUtils.showHideLoadingDiv(!0);var r=s.custom_view.id,i=s.fields.map((e=>e.id)),o="CHARTVIEWS"===t?store.peekRecord("chart_view",s.chart_id):store.peekRecord("custom_view",r),a=o.fields.filter((t=>t.id!==e));a=a.filter((e=>i.includes(e.id))),o.$.set("fields",a);var n=this,c={module:s.api_name};o.$.save(c).then((function(){commonUtils.showHideLoadingDiv(!1),n.onHideColumnSuccess&&n.onHideColumnSuccess(e,o.fields)}),(function(e){commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied(e)}))},filterByColumn:function(e,t){var s=store.peekRecord("field",e).api_name,r=$L("crm-custom-filter")[0].component,i=$L("crm-customview-layer")[0].component;!0!==t.filter_status&&i.hideShowFilterPanel(),r.setData("isFilterByFieldApplied",!0),$L("crux-smart-filter")[0].filterByField(s),this.timeInterval=setInterval(function(){var t=$L(`crux-smart-filter-input #${s}_crux_comp`)[0],r=$L(`crux-smart-filter #field_${s}`)[0];t&&r&&(t.closest(".cvFilterList").classList.contains("lyteSearchHidden")||this.focusSmartFilterField(store.peekRecord("field",e),t),clearInterval(this.timeInterval))}.bind(this),700)},hideShowFilterPanel:function(){var e=$L("crm-inner-list")[0],t=e?$L("#listViewTable")[0]:void 0,s=$L("#lv_filter_scroll");e&&e.component.setWidthForPinnedColumns(this.getData("isFilterActive")?0:332);var r=this.getData("module_info");r.filter_status=!r.filter_status,$L("crm-custom-filter")[0].component.setData("filter_status",r.filter_status),this.setData("isFilterActive",!this.getData("isFilterActive")),this.getData("isFromModal")||r.$.triggerAction("view_preference_configurations",{module:r.api_name},{},"PUT",{filter_status:r.filter_status});var i=t?t.querySelector(".lyteExpOriginalTable").offsetWidth:void 0,o=this.getData("isFilterActive")?renderingUtils.windowOuterWidth-332:renderingUtils.windowOuterWidth-30;e&&!e.getData("cv_width_updated")&&t&&i<o&&setTimeout((function(){t.setColumnWidth()}),60),s&&$L.fastdom.measure((function(){s.resetScrollbar()})),"kanban"===Lyte.Router.getRouteInstance().routeName&&setTimeout(function(){var e=$L("crm-kanbanview-component")[0];e&&e.component.resizeKVColumn()}.bind(this),100),r.filter_status||"canvas"!==Lyte.Router.getRouteInstance().routeName||"CardView"!==Lyte.Router.getRouteInstance().queryObj.viewType||setTimeout((function(){Lyte.Component.viewPortSettings.executePendingViewPortElements()}),100)},storeCustomButtonWebTabParamDetails:function(e){const t=e.web_tab,s=e.url.open_url,r=moduleRecordMapping[t];if(r){const e=function(e){return e.web_link},t=function(e,t){return e.widget?t.startsWith(e.widget.id)?e.widget.id:e.widget.url&&e.widget.url:""},i="webtab_widget"===r.generated_type?t(r,s):e(r);CustomButtonJSObjectInit.webtabparams=s.length!==i.length&&s.length>i.length&&s.startsWith(i)?s.substring(i.length):""}},fetchRelatedList:function(e){if(Crm.userDetails.activityBadgeUpgradeEnabled)return store.findAll("related_list",{module:e.api_name},!1,!0,{from:"Chronological"})},fetchViewPreferences:function(e){var t=e.api_name;store.triggerAction("module","view_preference_configurations",{module:t},{},"GET").then((function(s){var r=s.modules[0];r.id=e.id,r.territory&&r.territory.hasOwnProperty("$subordinates")&&(r.territory.subordinates=r.territory.$subordinates,delete r.territory.$subordinates),r.zia_view=!1,r.default_view_type&&"kanban_view"===r.default_view_type?(r.kanban_view=!0,r.stage_view="Visits"!==t&&"Activities"!==t):(r.kanban_view=!1,r.stage_view=!1),store.pushPayload("module",[r])}))},loadNotesDependencyFiles:function(){var e=[];return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-listpage-notes.js","crm-global-search.js","crux-note.js","note_model.js","crm-timeline-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workqueue"),networkUtils.getI18nJSUrl("timeline"),networkUtils.getI18nJSUrl("Portals")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crux-note.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(e,void 0)},showValidationRuleAlertPopup:function(e,t,s,r){if(t){let t=e.length,i=`<div class="crm-font-bold mB8">${I18n.getMsg("crm.validation.error.popup.msg")}</div>`;if(1===t)i+='<span class="crmNegativeColor dIB">'+$ESAPI.encoder().encodeForHTML(e[0].message)+"</span>";else{i+='<div class="mT18">';for(let s=0;s<t;s++)i+='<div class="crmErrorBullet mB16">'+$ESAPI.encoder().encodeForHTML(e[s].message)+"</div>";i+="</div>"}_cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropYield:!0,ltPropPrimaryMessage:I18n.getMsg("crm.validation.rule.invalid.entry.alertmsg.title"),ltPropSecondaryMessage:i,ltPropWrapperClass:"kv-cx-alert",ltPropButtons:[{type:"accept",appearance:"default",text:I18n.getMsg("crm.button.ok.got.it")}],accept:function(){r&&r.call(this.$node)}},close:function(){s&&s.call(this.$node)}})}else _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.validation.rule.invalid.entry.alertmsg.title"),ltPropSecondaryMessage:e.message,ltPropWrapperClass:"kv-cx-alert"},close:function(){s&&s.call(this.$node)}})}}),Lyte.Mixin.register("crm-create-init-mixin",{getLyteCreateComponentForCscript:function(){if(["crm.tab.module.entity.edit","crm.tab.module.create","crm.tab.module.entity.clone","crm.tab.requesters.module.create","crm.tab.module.entity.detail"].contains(Lyte.Router.getRouteInstance().transition.info.route)){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if(!moduleRecordMapping[e])return null;var t="crm-create-layout#"+e+"LC_layoutNode";return $L(t)[0]}return Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()?t=$L("crm-canvas-form")[0]:null},checkLyteConvertionSupport:function(e){var t=!1;return(Crm.userDetails.isLyteCreateSupported||Crm.userDetails.IS_DEVELOPMENT_SETUP)&&(crmConstants.lyteCreateInitialModules.contains(e)||e.indexOf("CustomModule")>-1&&!["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005","CustomModule5006","CustomModule5007","CustomModule5008","CustomModule5009","CustomModule5010"].contains(e)||e.indexOf("LinkingModule")>-1)&&(t=!0),(Crm.userDetails.isInvLyteCreateSupported||Crm.userDetails.IS_DEVELOPMENT_SETUP)&&crmConstants.lyteCreateInventoryModules.contains(e)&&(t=!0),t},loadRouteDependencies:function(e){var t=[];t=(t=(t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CreateEditCloneRecord")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-create-dependencies.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm_finance_suite.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-models.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-canvasrule-model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaReasoning")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiSelectPopup")],ResourceConstants.CRM));["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portalmisc")],ResourceConstants.CRM)));const s=Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]:null;return["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&s&&("Leads"===s||"Accounts"===s||"Contacts"===s||"Vendors"===s||s.startsWith("CustomModule"))&&(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["zia-data-enrichment-util.js","zia-data-enrichment-util-model.js"],ResourceConstants.CRMClient))),t},loadResources:function(e){var{currentFeature:t,module_name:s,isCreate:r,isEdit:i,isClone:o,lyteConvertionSupported:a,extraInfo:n}=e,c={js:[],css:[],less:[],i18n:[],others:[],complete:[],lyte_js:[],lyte_css:[],lyte_less:[]},l=[],d=[];if("create"===(t=t||"quickCreate")||"wizards"===t?(l=l.concat(["imageUploadRelated","visionRelated","crm-richtext-component","existing-email-quickinfo","crm-image-upload-ziaError","crm-uploadfields-mixin","moduleLookupRelated","crm-custom-rl","crm-list-view-crux","crm-detail-view-utils","crm-zia-reasoning-popover","crm-create-mixin2","custom_button"]),(r||o)&&(l=l.concat(["reviewprocess","lyte-progressbar","crm-ziavision-myjobs"])),i&&(l=(l=l.concat(["crm-project-sync-task"])).concat(["crm-zprojects-sync-task"])),r&&crmTab.isZBCustomModule(s)&&(d=d.concat(["ZBCustomModule"])),a&&["Quotes","Invoices","SalesOrders","PurchaseOrders"].contains(s)&&(d=d.concat(["lyte-hovercard"])),(r||o)&&Lyte.Component.registeredHelpers.isTeamModule(s)&&(d=d.concat(["crm-userassociations-datastore"])),("wizards"===t||a||i)&&(l=l.concat(["createBaseResources","createBaseResources1","wizardSpecificResources","crm-entity-lookup","crm-entity-utils","crux-tag","visionRelated","crm-uploadfields-mixin","crm-image-upload-ziaError","lyte-colorpicker","lyte-step","crm-change-owner","crm-uploadfields-mixin","businesscard_model"]),a&&"Campaigns"===s&&(d=d.concat(["crm-webinar-data-store"])),(r||i||o)&&(i||"wizards"===t)&&(l=l.concat(["zohocrm_wizard_record_create"]))),a&&"wizards"===t&&(l=l.concat(["wizardExecutionResources"])),Crm.isCpqActivated()&&!0===Crm.isCpqActivated()&&(d=d.concat(["cpq"]),l=l.concat(["crux-criteria-component"])),"PriceBooks"===s&&(d=d.concat(["PriceBooks"])),"Services"===s&&(d=d.concat(["Services"])),"create"===t&&i&&n.isCallsOnEdit&&(d=d.concat(["Calls"])),Crm.userDetails.isPhoneNoNewView&&(l=l.concat(["PhoneNoNewView"])),(r||i||o)&&("wizards"===t&&(l=l.concat(["wizardrecordcreate"])),l=l.concat(["businesshours","changeOwner","ziavision"]),Crm.userDetails.isCanvasFormViewEnabled&&(c.lyte_js=c.lyte_js.concat(["crm-detailview-common-footer.js"])))):"quickCreate"===t&&((l=["createBaseResources","existing-email-quickinfo","moduleLookupRelated","quickCreateRelated","crux-tag","crm-richtext-component","lyte-colorpicker","crm-uploadfields-mixin","crm-image-upload-ziaError","visionRelated","moduleLookupRelated","crm-entity-lookup","crm-entity-utils","crm-detail-view-utils","crm-create-mixin","crm-zia-reasoning-popover","modal-scroll-box-shadow","businesscard_model","imageUploadRelated","crm-create-mixin2","crm-uploadfields-mixin"]).push("visionRelated"),Crm.userDetails.isPhoneNoNewView&&(l=l.concat(["PhoneNoNewView"])),"Appointments"===s&&(l=l.concat(["crm-detail-view-utils","imageUploadRelated","crm-quick-reminder","reminderField"]),d=d.concat(["Appointments"]))),Crm.userDetails.ValidationAlertPreference&&Crm.userDetails.VRINVOLVEDMODULES.contains(s)&&(l=l.concat(["validation-rule"])),l.push("multiSelectLookup"),l.length)for(var u=l.length,m=0;m<u;m++)switch(l[m]){case"validation-rule":c.lyte_js=c.lyte_js.concat(["crm-validation-rule-error.js"]),c.lyte_less=c.lyte_less.concat(["crm-validation-rule-error-less.css"]),c.i18n=c.i18n.concat(["ValidationAlert"]);case"imageUploadRelated":c.lyte_js=c.lyte_js.concat(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"]),c.lyte_css=c.lyte_css.concat(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"]),c.js=c.js.concat(["zohocrm_module_settings_common.js"]),Crm.userDetails.RTL_ENABLED&&(c.lyte_css=c.lyte_css.concat(["crm-image-upload-rtl.css"])),c.i18n=c.i18n.concat(["imageupload"]);break;case"crm-uploadfields-mixin":c.lyte_js=c.lyte_js.concat(["crm-uploadfields-mixin.js","crux-image-upload.js"]),c.lyte_less=c.lyte_less.concat(["crux-image-component.css","crm-image-upload-component.css","crux-file-upload-component.css","crm-file-upload-component.css"]);break;case"visionRelated":c.lyte_js=c.lyte_js.concat(["crm-vision-helper.js","crm-vision-create.js","crm-vision-validation.js","crm-vision-match-utils.js"]);break;case"existing-email-quickinfo":c.lyte_js=c.lyte_js.concat(["crm-existing-email-quickinfo.js"]),c.lyte_css=c.lyte_css.concat(["crm-existing-email-quickinfo.css"]);break;case"crm-image-upload-ziaError":c.lyte_js=c.lyte_js.concat(["crm-image-upload-ziaError.js"]),c.lyte_css=c.lyte_css.concat(["crm-image-upload-ziaError.css"]);break;case"moduleLookupRelated":c.lyte_js=c.lyte_js.concat(["crux-lookupfilter-component.js","crux-column-list.js"]),Crm.userDetails.RTL_ENABLED&&(c.lyte_css=c.lyte_css.concat(["crm-list-view-crux.css"]));break;case"crm-custom-rl":c.lyte_css=c.lyte_css.concat(["crm-custom-rl.css"]);break;case"crm-list-view-crux":Crm.userDetails.RTL_ENABLED||(c.lyte_css=c.lyte_css.concat(["crm-list-view-crux.css"]));break;case"crm-detail-view-utils":c.lyte_js=c.lyte_js.concat(["crm-detail-view-utils.js"]);break;case"reviewprocess":c.lyte_js=c.lyte_js.concat(["reviewprocess.js","crm-reviewprocess-detail.js"]);break;case"lyte-progressbar":c.lyte_js=c.lyte_js.concat(["lyte-progressbar.js"]);break;case"crm-ziavision-myjobs":c.lyte_js=c.lyte_js.concat(["crm-ziavision-myjobs.js"]);break;case"crm-project-sync-task":c.lyte_js=c.lyte_js.concat(["crm-project-sync-task.js"]);break;case"crm-zprojects-sync-task":c.lyte_css=c.lyte_css.concat(["crm-zprojects-sync-task.css"]);break;case"createBaseResources":c.lyte_js=c.lyte_js.concat(["crm-create-resources.js","crm-create-pricingdetails.js","crm-create-fields.js","crm-create-helpers.js","crm-services-create-resources.js"]),c.i18n=c.i18n.concat(["lookupfilter"]),c.lyte_less=c.lyte_less.concat(["crm-create-resources-less.css"]),Crm.userDetails.RTL_ENABLED&&(c.lyte_less=c.lyte_less.concat(["crm-create-resources-lessrtl.css"])),Crm.userDetails.isSubformNewComponentEnabled&&(c.lyte_js=c.lyte_js.concat(["crm-ui-loaders.js"]),c.lyte_less=c.lyte_less.concat(["crm-ui-loaders.css"]));break;case"createBaseResources1":c.lyte_js=c.lyte_js.concat(["crm-create-dependent-resources.js"]),c.lyte_less=c.lyte_less.concat(["crm-create-dependent-resources-less.css"]);break;case"wizardSpecificResources":c.lyte_js=c.lyte_js.concat(["crm-wizard-common-helpers.js","crm-wizard-cscript-handler.js"]),c.lyte_css=c.lyte_css.concat(["crm-create-dependent-resources.css"]),c.lyte_less=c.lyte_less.concat(["crm-wizards-querycomp.css"]);break;case"crm-entity-lookup":c.lyte_js=c.lyte_js.concat(["crm-entity-lookup.js"]);break;case"crm-entity-utils":c.lyte_js=c.lyte_js.concat(["crm-entity-utils.js"]);break;case"crux-tag":c.lyte_js=c.lyte_js.concat(["crux-tag.js","crux-color-palette.js"]);break;case"lyte-colorpicker":c.lyte_js=c.lyte_js.concat(["lyte-colorpicker.js"]);break;case"lyte-step":c.lyte_js=c.lyte_js.concat(["lyte-step.js"]);break;case"crm-change-owner":c.lyte_less=c.lyte_less.concat(["crm-change-owner.css"]);break;case"zohocrm_wizard_record_create":c.others=c.others.concat(["zohocrm_wizard_record_create.js"]);break;case"crm-quick-recurringactivity":c.lyte_js=c.lyte_js.concat(["crm-quick-recurringactivity.js"]),c.lyte_css=c.lyte_css.concat(["crm-quick-recurringactivity.css"]);break;case"crm-quick-reminder":c.lyte_js=c.lyte_js.concat(["crm-quick-reminder.js","crm-reminder-create.js"]),c.lyte_less=c.lyte_less.concat(["crm-quick-reminder.css"]);break;case"modal-scroll-box-shadow":c.lyte_js=c.lyte_js.concat(["modal-scroll-box-shadow.js"]);break;case"MeetingRevampI18n":c.i18n=c.i18n.concat(["MeetingRevamp"]);break;case"reminderField":c.i18n=c.i18n.concat(["reminderField"]);break;case"PhoneNoNewView":c.complete=c.complete.concat(Crm.returnPhoneFieldDependencyFiles());break;case"wizardrecordcreate":c.i18n=c.i18n.concat(["wizardrecordcreate"]);break;case"businesshours":c.i18n=c.i18n.concat(["businesshours"]);break;case"changeOwner":c.i18n=c.i18n.concat(["changeOwner"]);break;case"ziavision":c.i18n=c.i18n.concat(["ziavision"]);break;case"cruxLazyLoad":c.lyte_js=c.lyte_js.concat(["crux-lazyLoad.js"]);break;case"quickCreateRelated":c.lyte_js=c.lyte_js.concat(["crm-quick-create-resources.js"]),c.lyte_less=c.lyte_less.concat(["crm-quickcreate-less-resources.css"]);break;case"crm-create-mixin":c.lyte_js=c.lyte_js.concat(["crm-create-mixin.js"]);break;case"crm-create-mixin2":c.lyte_js=c.lyte_js.concat(["crm-create-mixin2.js"]);break;case"crm-zia-reasoning-popover":c.lyte_js=c.lyte_js.concat(["crm-zia-reasoning-popover.js"]);break;case"businesscard_model":c.lyte_js=c.lyte_js.concat(["businesscard_model.js"]);break;case"multiSelectLookup":c.lyte_js=c.lyte_js.concat(["crm-ui-loaders.js","crux-criteria-conditions.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-helpers.js","crm-multi-selection-popup.js"]),c.lyte_css=c.lyte_css.concat(["crm-ui-loaders.css","custom-view-layer-new.css","crm-inner-list-new.css","crm-list-view-new.css"]),!0===Crm.userDetails.RTL_ENABLED&&(c.lyte_css=c.lyte_css.concat(["crm-list-view-new-rtl.css","crm-list-view-rtl.css"])),c.i18n=c.i18n.concat(["MultiSelectPopup"]),c.lyte_less=c.lyte_less.concat(["crm-multi-selection-popup.css","crux-smart-filter.css"]);break;case"crux-criteria-component":c.lyte_js=c.lyte_js.concat(["crux-criteria-component.js","crux-criteria-conditions.js"]);break;case"custom_button":c.lyte_js=c.lyte_js.concat(["crm-custom-button.js"]);break;case"crm-richtext-component":c.lyte_js=c.lyte_js.concat(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-ui-emoji.css"]),c.lyte_less=c.lyte_less.concat(["crm-richtext-resources-less.css","lyte-ui-editor.css"]),c.i18n=c.i18n.concat(["richtext"]);break;case"crm-create-route-mixin":c.lyte_js=c.lyte_js.concat(["crm-create-route-mixin.js"])}if(d.length){var p=d.length;for(m=0;m<p;m++)switch(d[m]){case"ZBCustomModule":c.js=c.js.concat(["crm_finance_suite.js"]);break;case"lyte-hovercard":c.lyte_js=c.lyte_js.concat(["lyte-hovercard.js"]);break;case"crm-webinar-data-store":c.lyte_js=c.lyte_js.concat(["crm-webinar-data-store.js"]);break;case"cpq":c.lyte_js=c.lyte_js.concat(["cpq-presave.js","crm-cpq-gsinlineitems.js","lyte-scrollspy.js","lyte-hovercard.js"]),c.i18n=c.i18n.concat(["CpqExecuteRules","cpq"]),c.lyte_less=c.lyte_less.concat(["crm-cpq-executerules.css"]);break;case"PriceBooks":c.others=c.others.concat(["zohocrm_pricingDetails.js"]);break;case"Services":c.others=c.others.concat(["zohocrm_services.js"]),c.i18n=c.i18n.concat(["businesshours"]),c.lyte_js=c.lyte_js.concat(["service-user-lookup.js"]),c.lyte_js=c.lyte_js.concat(["crm-services-create-resources.js"]);break;case"Appointments":c.i18n=c.i18n.concat(["ServiceEntityKeys","businesshours"]);break;case"Calls":var _=isNewCallView?["zcrm_callsnew.js","zcrm_callsnew1.js"]:["zcrm_callsold.js"];c.others=c.others.concat(_);break;case"crm-userassociations-datastore":c.lyte_js=c.lyte_js.concat(["crm-userassociations-datastore.js"])}}var g=[];for(var v in c)if(c[v].length)switch(v){case"js":case"others":g=g.concat(networkUtils.returnDependencyFiles(c[v],ResourceConstants.CRM));break;case"lyte_js":case"lyte_css":g=g.concat(networkUtils.returnDependencyFiles(c[v],ResourceConstants.CRMClient));break;case"lyte_less":g=g.concat(networkUtils.returnDependencyFiles(c[v],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));break;case"i18n":var f=c[v].length;for(m=0;m<f;m++)g=g.concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl(c[v][m]),ResourceConstants.CRM));break;case"complete":g=g.concat(c[v])}l.contains("wizardExecutionResources")&&Crm.userDetails.isWizardViewEnabled&&!Crm.userDetails.RTL_ENABLED&&(g=g.concat(Lyte.registeredMixins["crm-create-init-mixin"].downloadFormViewResources()));var h={};return h.resourceList=g,h.featureInfo={features:l,modules:d},h},getDynamicCurrentInstanceObjKey:function(e){e||(e={});for(var t="obj"+(e.actionName||""),s=e.charLen||5,r=0;r<s;r++)t+=Math.floor(100*Math.random()).toString(36);return t},generateCurrentInstanceObject:function(e){e||(e={}),!e.instanceObjKey&&this.getDynamicCurrentInstanceObjKey&&(e.instanceObjKey=this.getDynamicCurrentInstanceObjKey());var t,s=e.instanceObjKey;if(e.hasOwnProperty("copyFromExisting")&&(t=!0),s){if(e.moduleData&&validationUtils.isEmpty(e.moduleData[s])&&(e.moduleData[s]={},t&&e.parentInstObjKey&&e.copyFromExisting.contains("moduleData")&&!validationUtils.isEmpty(e.moduleData[e.parentInstObjKey])&&(e.moduleData[s]=Lyte.deepCopyObject(e.moduleData[e.parentInstObjKey]))),e.moduleSections)(e.moduleSections||[]).forEach((function(e){validationUtils.isEmpty(e[s])&&(e[s]={}),!e[s].hasOwnProperty("type")&&e.hasOwnProperty("type")&&(e[s].type=e.type);var t=e.fields;validationUtils.isNotEmpty(t)&&t.forEach((function(e){validationUtils.isEmpty(e[s])&&(e[s]={})}))}));if(e.moduleFields)(e.moduleFields||[]).forEach((function(e){validationUtils.isEmpty(e[s])&&(e[s]={})}))}return e.instanceObjKey},deleteCurrentInstanceObject:function(e){e||(e={});var t=e.instanceObjKey;if(t){if(e.moduleData&&delete e.moduleData[t],e.moduleSections)(e.moduleSections||[]).forEach((function(e){delete e[t],(e.fields||[]).forEach((function(e){delete e[t]}))}));if(e.moduleFields)(e.moduleFields||[]).forEach((function(e){delete e[t]}))}},getCustomButtonResourcesList:function(){return[...networkUtils.returnDependencyFiles(["crm-custom-button-create-popup.js","crm-client-portal-module.js","crm-custom-button-actions.js","crm-custom-button-helper.js","crm-custom-button.js","features_model.js","crm-client-portal-module.js","crm-custom-button-common.js"],ResourceConstants.CRMClient),...networkUtils.returnDependencyFiles(["crm-custom-button-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),...networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("custom_button"),networkUtils.getI18nJSUrl("customfunctions")],ResourceConstants.CRM)]},cscriptMenuLessUIHandling:function(e){if(e=e||Lyte&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().transition){var t=$L("#wmstoolbar, #mainMenuTabDiv, .dummy_Topband, .dummy_Body, #leftMainMenuDiv, #leftMenuLoader");e&&e.info&&e.info.queryParams.menuless&&(app.isMenuless=!0);var s=app.isMenuless?"add":"remove";!function(e,t,s){for(var r=(t=t||[])&&t.length?t.length:0,i=0;i<r;i++){var o=t[i];o&&o.classList&&o.classList[e](s)}}(s,t,"menu-less-dNImp"),document.body&&document.body.classList[s]("zcrm-wizard-widget-render")}},downloadFormViewResources:function(){var e=[],t=["crm-canvasform.js","crm-canvas-form.css","crm-formview-mixin.js","crm-detailcanvas-utils.js","crm-canvas-helpers.js","crm-canvas-common.js","crm-canvas-common-utils.js","crm-canvas-view.js","crm-canvas-core.js","crm-canvas-profile-image.js","crm-detailview-common-footer.js","crm-canvas-formview-cscript-handler.js","crm-create-resources.js","crm-create-dependent-resources.js","crm-comment-information.js","crm-uploadfields-mixin.js","crux-image-upload.js","crm-file-upload.js","crm-owner-field.js","crm-multi-lookup.js","crm-skype-field.js","cpq-presave.js","crux-textautocomplete-options.js","crux-video.js","crux-color-palette.js","lyte-colorbox.js","lyte-colorpicker.js","lyte-progressbar.js","lyte-fileupload.js","zia-insights.js","zia-helpers.js","nba-detail-page.js","zia/nbx/crm-nba-mixins.js","crm-image-mixin.js","crm-custom-button-wrapper.js","approvalprocess-mixins.js"],s=[networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("detailview"),networkUtils.getI18nJSUrl("AutoEnrichment")];return Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&t.concat(["crm-zia-smart-prompt.js"]),e=(e=(e=(e=(e=(e=e.concat([{parent:networkUtils.returnDependencyFiles(["crm-canvas-main.css"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["crm-canvasview.css","crux-tag.css","crm-stage-history.css","crux-boolean-component.css"],ResourceConstants.CRMClient)}])).concat([{parent:networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],ResourceConstants.CRM),child:networkUtils.returnDependencyFiles(["i18n/canvas_clientsdk/zcanvas_"+Crm.getCurrentI18NLocale()+".js"],ResourceConstants.CRM)}])).concat(networkUtils.returnDependencyFiles(t,ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zcrm_customization.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["canvas-formview-editor.css","crux-image-component.css","crm-image-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(s,ResourceConstants.CRM))},getWizardResources:function(e){window.module=void 0;let t=networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js","zohocrm_wizard.js","zohocrm_wizard_util.js"],ResourceConstants.CRM),s=Lyte.registeredMixins["crm-create-init-mixin"].getCustomButtonResourcesList(),r=networkUtils.returnDependencyFiles(["crm-wizards-builder.js","lyte-hovercard.js","crm-event-picklist.js","lyte-colorpicker.js","lyte-shortcut.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_ProcessFlow.js"],ResourceConstants.CRM)).concat(s);let i=fetchAutomationFunctionFiles(),o=t.concat(r).concat(i);return e.queryParams.layoutid&&(o=o.concat(networkUtils.returnDependencyFiles(["canvasview_model.js"],ResourceConstants.CRMClient))),{parent:networkUtils.returnDependencyFiles(["user_type.js","clientPortalModulePermissions.js","crm-wizards-list.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js"],ResourceConstants.CRMClient),child:o}},removeCanvasFormViewResources:function(){var e=Lyte.Router.getRouteInstance().transition.info.route;if("crm.tab.module.entity.clone.canvas"!==e&&"crm.tab.module.create.canvas"!==e&&"crm.tab.module.entity.edit.canvas"!==e){var t=networkUtils.returnDependencyFiles(["canvas-formview-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);Lyte.removeFromCache(t),"undefined"!=typeof createStruture&&delete createStruture.toolinst}},getLayoutRelatedInfo:function(e){var{layDet:t,pLayoutId:s,dLayoutId:r,module_name:i,currentuserProfile:o}=e;t&&t.length&&(t=(t=Lyte.deepCopyObject(t)).sort((function(e,t){var s=e.name.toUpperCase(),r=t.name.toUpperCase();return s<r?-1:s>r?1:0})));for(var a,n,c=t?t.length:0,l=[],d=!1,u=0,m=!1,p=0;p<c;p++)if(t[p].status>=0||!0===t[p].status||"active"===t[p].status){d="Campaigns"===i&&"active"===t[p].status&&"campaign_integration"===t[p].source||d;var _=!1;if(t[p].profiles)for(var g=t[p].profiles.length,v=(m=!1,0);v<g;v++)if(t[p].profiles[v].name===o&&(_=!0),t[p].profiles[v].default&&o===t[p].profiles[v].name){a=t[p].name,n=t[p].id,m=!0;break}_&&(l[u]={uservalue:t[p].name,systemvalue:t[p].id,id:t[p].id,isDefault:m,status:t[p].status,source:t[p].source},window.clientPortalName&&(l[u].status="inactive"),u++)}if(s&&(n=s),"Campaigns"===i&&(r||s)){var f=r||s,h=l.filter((function(e){return e.id===f}))[0];h&&(a=h.uservalue,n=h.id)}if(!n&&l&&l.length)if("Campaigns"===i){var y=l.filter((function(e){return"crm"===e.source}))[0];a=(y=y||l[0]).name,n=y.id,y.isDefault=!0}else a=l[0].name,n=l[0].id,l[0].isDefault=!0;return{showInteglayoutoption:d,layoutddValues:l,selected:a,selectedId:n}},getResourcesHook:function(e){var{currentFeature:t,getResourcesParams:s,moduleName:r,transitionData:i,isCreate:o,isEdit:a,isClone:n,subModule:c,lyteConvertionSupported:l,isThroughQC:d}=e;l||(l=Lyte.registeredMixins["crm-create-init-mixin"].checkLyteConvertionSupport(r)),this.lyteConvertionSupported=l;var u={currentFeature:t,isCreate:o,isEdit:a,isClone:n};return u.targetRoute=e.targetRoute,(!d||d&&"quickCreate"!==u.currentFeature)&&(i&&i.isWizard||s&&s.queryParams&&s.queryParams.wizardId)&&(u.currentFeature="wizards"),u.module_name=r,u.lyteConvertionSupported=this.lyteConvertionSupported,"create"===u.currentFeature&&u.isEdit&&(u.extraInfo={},u.extraInfo.isCallsOnEdit="Calls"===r||"Activities"===r&&"Calls"===c),this.loadResourcesOutput=this.loadResources(u),this.loadResourcesOutput.resourceList}}),Lyte.Mixin.register("crm-detailview-resources-downloader",{getDependenciesFiles:function(e,t,s){return e||(e=[]),s&&!s.zia||(e=e.concat(networkUtils.returnDependencyFiles(["zia-insights.js"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["crm-detail-view-initial-files.js"],ResourceConstants.CRMClient)),t&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-lookup-parser-mixin.js"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["crm-entity-utils.js"],ResourceConstants.CRMClient)),Crm.isZiaOwnerRecommendationEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-models.js"],ResourceConstants.CRMClient))),e=e.concat(networkUtils.returnDependencyFiles(["features_model.js"],ResourceConstants.CRMClient))},getLyteResources:function(e,t,s){var r=[],i=[],o=[],a=[];if(r=(r=(r=(r=(r=(r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-detail-view.js","crm-detailcanvas-utils.js","crm-create-helpers.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-result.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-lookup-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["custom_link_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-tag.js"],ResourceConstants.CRMClient))).concat(this.getInitialOuterRLResourcesFiles())).concat(networkUtils.returnDependencyFiles(["crm-detailview-common-footer.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-user-tooltip.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),featuresAvailable.hasOwnProperty("ZiaVision")&&featuresAvailable.ZiaVision&&(r=r.concat(networkUtils.returnDependencyFiles(["zia-insights.js"],ResourceConstants.CRMClient)),o=o.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient))),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt.js","crm-zia-smart-prompt-store.js","crm-ui-loaders.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-smart-prompt.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),featuresAvailable.ZIA_RECORD_SUMMARY&&Crm.userDetails.permissions.Crm_Implied_Generate_Zia_Record_Summary&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-zia-record-summary.js","crm-zia-feedback.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-record-summary.css","crm-zia-feedback.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM))),Crm.userDetails.isPhoneNoNewView&&(t=t.concat(Crm.returnPhoneFieldDependencyFiles())),(Crm.isInventoryModule(e)||"PriceBooks"===e||"Cases"===e||"Solutions"===e)&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-inventory-detail-view.js"],ResourceConstants.CRMClient))),Crm.isInventoryModule(e))if(Crm.userDetails.isSubformNewComponentEnabled){r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-detail-view-subform-inventory-dependencies.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-subform.css","crux-table-component-v1.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-subform-component.js","crux-subform.js","crm-detail-view-subform.css","crm-detail-view-subform-inventory-dependencies.js"],ResourceConstants.CRMClient))}else r=r.concat(networkUtils.returnDependencyFiles(["detail-view/crm-detail-view-subform.js"],ResourceConstants.CRMClient));switch("Activities"===Crm.activityGrp[e]&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-detail-view-right-panel.js"],ResourceConstants.CRMClient))),"Activities"===s&&(r=r.concat(networkUtils.returnDependencyFiles(["calls-cvcard.js","call-fromto-field.js","phone-entity.js","entity-field.js","calls-kanbancard.js"],ResourceConstants.CRMClient))),"Leads"!==e&&"Contacts"!==e&&"Calls"!==e||(r=r.concat(networkUtils.returnDependencyFiles(["calls-button.js"],ResourceConstants.CRMClient))),e){case"Potentials":r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-sales-summary.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-stage-history.js","lyte-step.js"],ResourceConstants.CRMClient)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage")],ResourceConstants.CRM)),o=o.concat(networkUtils.returnDependencyFiles(["crm-stage-history.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(o=o.concat(networkUtils.returnDependencyFiles(["crm-stage-detailview-rtl.css"],ResourceConstants.CRMClient)));break;case"Tasks":r=r.concat(networkUtils.returnDependencyFiles(["crm-task-detailview.js","crm-task-markascompleted-popup.js"],ResourceConstants.CRMClient)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("taskDetailView")],ResourceConstants.CRM));break;case"Calls":r=r.concat(networkUtils.returnDependencyFiles(["crm-call-menu.js","phone-entity.js","lyte-voicenote.js","lyte-multislider.js"],ResourceConstants.CRMClient)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_detailview"),networkUtils.getI18nJSUrl("associate"),"zohocrm_phoneNumbers.js","zcrm_callsnew2.js"],ResourceConstants.CRM)),o=(o=o.concat(networkUtils.returnDependencyFiles(["lyte-ui-voicenote.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crux-voicenote-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));break;case"Events":r=r.concat(networkUtils.returnDependencyFiles(["crm-meetings-detailview.js","lyte-video.js"],ResourceConstants.CRMClient)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("meetingrecurring"),networkUtils.getI18nJSUrl("meetingdetailpage")],ResourceConstants.CRM)),o=o.concat(networkUtils.returnDependencyFiles(["simpleemail-min.css"],ResourceConstants.CRM)),i=i.concat(networkUtils.returnDependencyFiles(["crm-participants-less.css","crm-invitee-invitation.css","lyte-ui-video.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));break;case"Campaigns":a=(a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")],ResourceConstants.CRM));break;case"Appointments":r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-detail-view-services.js","servapp_preferences_model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM));break;case"Services":r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-detail-view-services.js","crm-services-appointments.js","crm-services-availability-information.js","crm-services-members.js","crm-services-availability-status.js","crm-services-create-resources.js","business_hours-model.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("servicesDetailView")],ResourceConstants.CRM));break;case"Messages":r=(r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-msg-utils.js","lyte-colorbox.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-msg-detail-view.js","crm-permission-error.js","crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-right-panel.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_module_settings_common.js","zohocrm_integration_home.js"],ResourceConstants.CRM)),o=o.concat(networkUtils.returnDependencyFiles(["crm-msg-detail-view.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(o=o.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],ResourceConstants.CRMClient))),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmdetailview")],ResourceConstants.CRM))}return Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(e)&&(a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordLocking")],ResourceConstants.CRM))),Crm.userDetails.isWorkdriveConfigured&&(a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workdrive")],ResourceConstants.CRM))),i=i.concat(networkUtils.returnDependencyFiles(["crm-detail-view-less.css","crux-user-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")],ResourceConstants.CRM)),o=o.concat(networkUtils.returnDependencyFiles(["crux-tag.css"],ResourceConstants.CRMClient)),t=(t=(t=(t=t.concat(r)).concat(i)).concat(o)).concat(a),Crm.isCpqActivated()&&((crmTab.isZCpqTab(e)||crmTab.isZCpqSubTab(e))&&(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-cpq-breadcrumb.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-cpq-breadcrumb.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),moduleRecordMapping[e]&&moduleRecordMapping[e].child_module&&moduleRecordMapping[e].child_module.length>0&&(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.js","cpq-utils.js","modal-scroll-box-shadow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.css"],ResourceConstants.CRMClient)))),t},getInitialOuterRLResourcesFiles:function(){let e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Customization")],ResourceConstants.CRM),t=networkUtils.returnDependencyFiles(["crm-left-panel.js","crm-related-list-left-panel.js"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crm-related-list-action-wrapper.js","crm-attachments.js","crm-related-list-attachments.css"],ResourceConstants.CRMClient)),t=t.concat(networkUtils.returnDependencyFiles(["crm-related-list-view.js","crm-activity-rel-wrapper.js"],ResourceConstants.CRMClient)),t=t.concat(e),t},fetchFilesForRenderingUsingData:function(e){var t,s=e.layout,r=[];return s.sections.forEach(function(s){if(s.isSubformSection)if(Crm.userDetails.isSubformNewComponentEnabled){t=!0;e.content_json.reviewProcessDetails&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-canvas-core.js"],ResourceConstants.CRMClient))),r=(r=r.concat(networkUtils.returnDependencyFiles(["crux-subform.css","crux-table-component-v1.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm-detail-view-subform-component.js","crux-subform.js","crm-detail-view-subform.css"],ResourceConstants.CRMClient))}else r=r.concat(networkUtils.returnDependencyFiles(["detail-view/crm-detail-view-subform.js"],ResourceConstants.CRMClient)),e.review_process_data&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-canvas-core.js"],ResourceConstants.CRMClient)));s.fields.forEach(function(e){switch(e.data_type){case"profileimage":r=r.concat(networkUtils.returnDependencyFiles(["crm-vision-create.js","crm-image-upload-ziaError.js"],ResourceConstants.CRMClient));break;case"imageupload":r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js","crux-image-upload.js","crm-vision-create.js","crm-image-upload-ziaError.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-image-component.css","crm-image-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));break;case"fileupload":r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-uploadfields-mixin.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crux-file-upload-component.css","crm-file-upload-component.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));break;case"multiselectlookup":r=r.concat(networkUtils.returnDependencyFiles(["crm-multi-lookup.js"],ResourceConstants.CRMClient));break;case"lookup":r=r.concat(networkUtils.returnDependencyFiles(["crux-lookupfilter-component.js"],ResourceConstants.CRMClient));break;default:switch(e.ui_type){case CrmField.UITYPES.TERRITORY:1===Crm.userDetails.TMENABLED&&(r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-territory-helper.js","crm-assign-territory-detail-view.js","lyte-tree.js","crm-territory-common-utils.js","crm-territory-crux-components.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-assign-territory-detail-view.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignterritory")],ResourceConstants.CRM)),r=Crm.userDetails.RTL_ENABLED?r.concat(networkUtils.returnDependencyFiles(["crux-territory-rtl.css"],ResourceConstants.CRMClient)):r.concat(networkUtils.returnDependencyFiles(["crux-territory-ltr.css"],ResourceConstants.CRMClient)));break;case CrmField.UITYPES.RICHTEXT:r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css","lyte-ui-emoji.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM));break;default:switch(e.api_name){case"Segment_Label":13===e.show_type&&(r=r.concat(this.getSegmentationResource()));break;case"Company":e.ui_type===CrmField.UITYPES.SINGLE_LINE&&(r=r.concat(networkUtils.returnDependencyFiles(["crux-textautocomplete-options.js"],ResourceConstants.CRMClient)))}}}}.bind(this))}.bind(this)),t&&Crm.userDetails.isSubformDVFilterSupported&&(r=r.concat(networkUtils.returnDependencyFiles(["crux-lookupfilter-component.js"],ResourceConstants.CRMClient))),e.ziaOwnerRecommendationEnabled&&(r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-zia-reasoning-popover.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-reasoning-popover.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AssignByZia")],ResourceConstants.CRM))),e.content_json.reviewProcessDetails&&(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js","reviewprocess.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ReviewProcess")],ResourceConstants.CRM))),r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js","crux-criteria-conditions.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-helpers.js","crm-multi-selection-popup.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.css","custom-view-layer-new.css","crm-inner-list-new.css","crm-list-view-new.css"],ResourceConstants.CRMClient)),!0===Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","crm-list-view-rtl.css"],ResourceConstants.CRMClient))),r=(r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiSelectPopup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-multi-selection-popup.css","crux-smart-filter.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))},getSegmentationResource:function(){var e=[];if(Crm.userDetails.isSegmentationEnabled){var t=networkUtils.returnDependencyFiles(["related-list-rfm.js","segmentation-utils.js"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")],ResourceConstants.CRM),r=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["related-list-rfm.css","related-list-rfm-rtl.css"],ResourceConstants.CRMClient):networkUtils.returnDependencyFiles(["related-list-rfm.css"],ResourceConstants.CRMClient);e=(e=(e=e.concat(t)).concat(s)).concat(r)}return e},getFeedsFollowerListResources:function(e){return e=e.concat(networkUtils.returnDependencyFiles(["crm-feed-follower-datastore.js","crm-follower.js"],ResourceConstants.CRMClient))},getValidationAlertResources:function(e){return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-validation-rule-error-less.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ValidationAlert")],ResourceConstants.CRM))},getTimelineRelatedFiles:function(){var e=networkUtils.returnDependencyFiles(["crm-timelines.js","crm-timeline-helpers.js","lyte-dateselect.js","lyte-daterangepicker.js","crux-note.js","crm-permission-dropdown.js","lyte-sticky.js","lyte-hovercard.js","crm-setup-data.js","note_model.js","crm-ui-loaders.js","crm-notes-timeline.js","crm-notes.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-permission-dropdown.css"],ResourceConstants.CRMClient),s=networkUtils.returnDependencyFiles(["crm-timeline.css","crux-note.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM),i=e.concat(t);return i=(i=i.concat(s)).concat(r)},getFinanceStockInfoForResources:function(){var e=[];return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zfinance-rl.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zfinance-stock-info.css"],ResourceConstants.CRMClient))}}),Lyte.Mixin.register("crm-browser-version-check",{checkVersion:function(){var e,t,s=this.getBrowserDetails(),r=s.name.toLowerCase(),i=s.version,o="";return"undefined"!=typeof Crm&&Crm.userDetails&&Crm.userDetails.LOCALE?o=Crm.userDetails.LOCALE:"undefined"!=typeof crmLocale&&(o=crmLocale),e=this.upgradeLinks()[r]?"chrome"===r?"zh_CN"===o||document.domain.includes(".com.cn")?this.upgradeLinks()[r].zh_CN:this.upgradeLinks()[r].def:this.upgradeLinks()[r]:RebrandLinkUtil.getProperty("COMMON_UPGRADE_LINK"),void 0===(t="zh_CN"===o||document.domain.includes(".com.cn")?this.supportedCNVersion[r]:this.supportedVersion[r])?{support:!1,name:s.name,version:i,upgradeLink:e}:{support:this.check(i,t),name:s.name,version:i,upgradeLink:e}},upgradeLinks:function(){return{chrome:{def:RebrandLinkUtil.getProperty("CHROME_UPGRADE_LINK"),zh_CN:RebrandLinkUtil.getProperty("CHROME_UPGRADE_LINK_CN")},safari:RebrandLinkUtil.getProperty("SAFARI_UPGRADE_LINK"),firefox:RebrandLinkUtil.getProperty("FIREFOX_UPGRADE_LINK"),edge:RebrandLinkUtil.getProperty("EDGE_UPGRADE_LINK"),opr:RebrandLinkUtil.getProperty("OPERA_UPGRADE_LINK")}},supportedVersion:{chrome:73,safari:13,firefox:68,edge:79,opr:60},supportedCNVersion:{chrome:55,safari:11,firefox:54,edge:79,opr:42},getBrowserDetails:function(){var e,t=$L.userAgent;return"CriOS"===(e=t.browser)?e="Chrome":"FxiOS"===e&&(e="Firefox"),{name:e,version:t.version}},check:function(e,t){return!(e<t)}});var cruxAssets=cruxAssets||{};cruxAssets.cxLookupElementLinkClicked=function(e){let t=e.target.closest("LINK-TO");if("LINK-TO"===t.tagName){let s=JSON.parse(t.getAttribute("lt-prop-dp"));Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(s[0],s[1],e)}};
