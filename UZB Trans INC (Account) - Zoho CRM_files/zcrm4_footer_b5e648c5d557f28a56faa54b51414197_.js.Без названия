var Events={isSlimScrollEnabled:-1==navigator.userAgent.indexOf("Mac OS X"),reminderNotificationImgUrl:networkUtils.getImageUrl("event_reminder_feed_chrome.png",ResourceConstants.CRM),cloneEntId:void 0,reminderNotificationEnabled:!0,viewInviteeReqSent:!1,quickViewEv:void 0,callStartTime:new Date,viewInviteeRecordAvailable:!1,inviteesViewPageNo:0,loadedInvIds:[],lastLoadedType:"3",invPreparedPageCnt:0,currentEventObjectInQV:void 0,currentQuickViewId:void 0,eventNoteReqSent:!1,isLinksModified:!1,isPageLayoutModified:!1,formRuleModified:!1,moduleName:"Events",currentStatus:void 0,createSource:void 0,relatedToSelectBox:void 0,currentEventObjectInView:void 0,addMoreDetailsClicked:void 0,invAddLinkClicked:!1,calScrollYval:0,whatIdModulesArr:[],scrollOnSetHTML:!1,reqInvRecAvail:{t:!1,u:!1,l:!1,c:!1,lv:!1,cv:!1,g:!1,r:!1,rs:!1},isAddInvReqSent:!1,addInvPageCnt:{t:0,u:0,l:0,c:0,lv:0,cv:0,g:0,r:0,rs:0,rc:0},invJsonCreate:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invDelListCreate:{t:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invRemoveJson:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invAddJson:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},meetingToolNameObj:{JOINME_MEETING:"JoinMeMeeting",GOTO_MEETING:"GoToMeeting",ZOHO_MEETING:"ZohoMeeting",TEAMV_MEETING:"TeamVMeeting",ZOOM_MEETING:"ZoomMeeting",BLUEJEANS_MEETING:"BlueJeansMeeting",WEBEX_MEETING:"WebexMeeting",RINGCENTRAL_MEETING:"RingCentralMeeting",CLICK_MEETING:"ClickMeeting",MEGA_MEETING:"MegaMeeting",STARLEAF_MEETING:"StarLeafMeeting",RCVIDEOMEETING:"RCVideoMeeting",MICROSOFTTEAMS_MEETING:"MicrosoftTeamsMeeting"},displayToolName:{GoToMeeting:"GoToMeeting",ZohoMeeting:"Zoho Meeting",JoinMeMeeting:"Join.Me",TeamVMeeting:"TeamViewer",ZoomMeeting:"Zoom",BlueJeansMeeting:"BlueJeans",WebexMeeting:"Cisco Webex",RingCentralMeeting:"Ring Central",ClickMeeting:"Click Meeting",MegaMeeting:"Mega Meeting",StarLeafMeeting:"StarLeaf",RCVideoMeeting:"RingCentral Video",MicrosoftTeamsMeeting:"Microsoft Teams"},actualToolName:{GoToMeeting:"GoToMeeting","Zoho Meeting":"ZohoMeeting","Join.Me":"JoinMeMeeting",TeamViewer:"TeamVMeeting",Zoom:"ZoomMeeting",BlueJeans:"BlueJeansMeeting","Cisco Webex":"WebexMeeting","Ring Central":"RingCentralMeeting","Click Meeting":"ClickMeeting","Mega Meeting":"MegaMeeting",StarLeaf:"StarLeafMeeting","RingCentral Video":"RCVideoMeeting","Microsoft Teams":"MicrosoftTeamsMeeting"},meetingTitleLength:{JoinMeMeeting:100,GoToMeeting:255,ZoomMeeting:200,TeamVMeeting:255,ZohoMeeting:255,BlueJeansMeeting:255,WebexMeeting:128,RingCentralMeeting:200,ClickMeeting:200,MegaMeeting:255,StarLeafMeeting:255,RCVideoMeeting:255,MicrosoftTeamsMeeting:255},showMeetingAuthorizeHelpIcon:["MegaMeeting","ClickMeeting"],meetingLoginPopupField:{siteName:["WebexMeeting","MegaMeeting"],userName:["WebexMeeting","MegaMeeting","ClickMeeting","StarLeafMeeting"],password:["WebexMeeting","StarLeafMeeting"]},selInvPageCnt:0,selInviteesCnt:0,selInvPagerecAvail:!0,selInvPagereqSent:!1,selInvlinkClicked:!1,isCVSelected:!1,isViaCopyPaste:!1,addInvEmailsList:{},removeInvEmailsList:{},isRecurringEditAvail:!1,evtWidfor15Mins:39,tilePageNo:0,isAllUsersLoaded:!1,isUsersLoadReqSent:!1,totalUsersCount:0,isRecEvent:!1,recCntIdsArr:{add:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}},remove:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}}},modifyingEvent:void 0,selectedCVId:void 0,timeEntryAdded:!1,tileLoadingUserId:"",monthStartDate:null,monthEndDate:null,weekStartDate:null,weekEndDate:null,userImgSrc:null,prevTempObj:null,calHTML:"",srchVal:"",mouseStillDown:!1,multiUserCalMovement:null,userEvents:{},onMouseOverTimeOut:null,multiUserDayScrollTime:null,isMultiUserDayScrolled:!1,tdWidth:null,isMouseOnArrw:!1,relAccId:"",relAccName:"",relAccMod:!1,addressInfo:[],maxReminderValue:0,reminderCount:0,reminders:[],allDayReminders:[],evtCreateFrom:"",addPartCheck:!0,showDuplicateContView:[],eventDesc:"",skipEventAlert:!1,startMeetingWindowObject:void 0,eventMeetingOnboardingShown:!1,meetingOnboardScrollBlock:!1,scheduleOnlineEvent:!1,meetingToolName:"",inviteeslimit:50,remainingInvitees:50,pastEventInvCnt:void 0,exceededInviteesList:[],meetingCheckBoxEnabled:!1,relatedParticipantName:"",finalIdsJson:{},invTypeVsUserIdsMap:{},sendNotificationMail:!1,jobSheetMAC:!1,statusDropDownObj:[{html:I18n.getMsg("Prepared"),value:"0"},{html:I18n.getMsg("Confirmed"),value:"1"},{html:I18n.getMsg("Cancelled"),value:"-1"}],numberStringArray:[{html:I18n.getMsg("First"),value:"1"},{html:I18n.getMsg("Second"),value:"2"},{html:I18n.getMsg("Third"),value:"3"},{html:I18n.getMsg("Fourth"),value:"4"},{html:I18n.getMsg("Last"),value:"5"}],numberStringArrayWidthDay:[{html:I18n.getMsg("Day"),value:"Day"},{html:I18n.getMsg("First"),value:"1"},{html:I18n.getMsg("Second"),value:"2"},{html:I18n.getMsg("Third"),value:"3"},{html:I18n.getMsg("Fourth"),value:"4"},{html:I18n.getMsg("Last"),value:"5"}],recDateArrray:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],recurringElemIds:["Crm_Events_REPEATTYPE","Crm_Events_RECURRING_FREQUENCY","Crm_Events_RECURRING_END_NEVER","Crm_Events_RECURRING_END_NOOFTIMES","Crm_Events_RECURRING_END_ON","Crm_Events_RECURRING_REPEAT_COUNT","Crm_Events_RECURRING_END_DATE","Crm_Events_RECURRING_INVITATIONMAIL_0","Crm_Events_EXCEPT_HOLIDAY_0","Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT","Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST","Crm_Events_RECURRING_CUSTOM_OCCUR_DAY","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE","Crm_Events_STARTDATETIME","Crm_Events_ENDDATETIME"],weekDaysDropdownObj_lastDay:[{html:I18n.getMsg("Sunday"),value:"1"},{html:I18n.getMsg("Monday"),value:"2"},{html:I18n.getMsg("Tuesday"),value:"3"},{html:I18n.getMsg("Wednesday"),value:"4"},{html:I18n.getMsg("Thursday"),value:"5"},{html:I18n.getMsg("Friday"),value:"6"},{html:I18n.getMsg("Saturday"),value:"7"},{html:I18n.getMsg("crm.event.rec.last.day"),value:"-1"},{html:I18n.getMsg("crm.event.rec.last.working.day"),value:"0"}],weekDaysDropdownObj:[{html:I18n.getMsg("Sunday"),value:"1"},{html:I18n.getMsg("Monday"),value:"2"},{html:I18n.getMsg("Tuesday"),value:"3"},{html:I18n.getMsg("Wednesday"),value:"4"},{html:I18n.getMsg("Thursday"),value:"5"},{html:I18n.getMsg("Friday"),value:"6"},{html:I18n.getMsg("Saturday"),value:"7"}],monthsDropdownObj:[{html:I18n.getMsg("Januray"),value:"0"},{html:I18n.getMsg("February"),value:"1"},{html:I18n.getMsg("March"),value:"2"},{html:I18n.getMsg("April"),value:"3"},{html:I18n.getMsg("May"),value:"4"},{html:I18n.getMsg("June"),value:"5"},{html:I18n.getMsg("July"),value:"6"},{html:I18n.getMsg("August"),value:"7"},{html:I18n.getMsg("September"),value:"8"},{html:I18n.getMsg("October"),value:"9"},{html:I18n.getMsg("November"),value:"10"},{html:I18n.getMsg("December"),value:"11"}],invTypeVsDispMsg:{c:I18n.getMsg("Contacts"),l:I18n.getMsg("Leads"),u:I18n.getMsg("Users"),r:I18n.getMsg("roles"),g:I18n.getMsg("groups"),t:I18n.getMsg("Territories"),cv:I18n.getMsg("crm.invitees.filter.contact.customeview.label"),lv:I18n.getMsg("crm.invitees.filter.lead.customeview.label"),rs:I18n.getMsg("crm.security.roles.and.subordinates")},eventRemindAtOptions:[],init:function(){this.timeStrForAllDayReminder=Utils.getTimeStrForAllDayReminder(),this.eventRemindAtOptions_allday=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([this.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)])},{value:"1 days",html:I18n.getMsg("crm.event.remind.allday.day",["1",I18n.getMsg(this.timeStrForAllDayReminder)])},{value:"2 days",html:I18n.getMsg("crm.event.remind.allday.days",["2",I18n.getMsg(this.timeStrForAllDayReminder)])},{value:"1 weeks",html:I18n.getMsg("crm.event.remind.allday.week",["1",I18n.getMsg(this.timeStrForAllDayReminder)])}],this.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[Crm.getModuleDisplayName(!0,!1,!0)])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}],Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MeetingCreation")],ResourceConstants.CRM)[0]])},enableInternalServiceSync:function(e){let t={};t.show=e.checked,t.api_name=e.component.data.ltPropValue,$L("#Checkbox_"+t.api_name).attr("disabled",!0),$L("#"+t.api_name+"_manage_button").attr("disabled",!0),$L("#save").attr("disabled",!0),this.downloadInternalServiceSyncFiles(t)},showInternalServiceSync:function(e){let t=$L("#isManageBtnClicked");if("false"===t.val()){t.val("true");let n={show:!0};n.api_name=e,this.downloadInternalServiceSyncFiles(n)}},downloadInternalServiceSyncFiles:function(e){let t=Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile();Lyte.injectResources.availableTags[networkUtils.returnDependencyFiles(["gapps/crm-gcal-models.js"],ResourceConstants.CRMClient)]||(t=t.concat(networkUtils.returnDependencyFiles(["gapps/crm-gcal-models.js"],ResourceConstants.CRMClient)));let n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("internal_calendar_sync"),networkUtils.getI18nJSUrl("google_cal")],ResourceConstants.CRM);t=t.concat(n),Lyte.injectResources(t,void 0,(function(){Lyte.registeredMixins["business-hours-utils"].configureInternalServiceSync(e)}))},openInMarketPlace:function(e){let t=window.location.origin+Crm.getCrmBasePath()+e;networkUtils.openUrl(t),Events.openCalendarPref("optionMU")},globalCreate:function(e,t,n,i,a,r,s,o,l,d,c){if($(".ziaCallAnalyticswrapper").length&&(t="relatedlist_new"),crmConstants.lyteCreateInitialModules.contains("Appointments")&&n&&("Appointments"===n||n.dataset&&("Detail_createApppointment"===n.dataset.zcqa||"moreOptInQAOpt_create_appointment"===n.dataset.zcqa)||n[0]&&n[0].dataset&&n[0].dataset.appointment)&&!l){Lyte.$.replaceOldInjectResource(),"undefined"!=typeof featuresAvailable&&featuresAvailable||(featuresAvailable="undefined"!=typeof SIHomeUtil&&SIHomeUtil.featuresAvailable?SIHomeUtil.featuresAvailable:{});var v=Lyte.registeredMixins["crm-appointments-mixin"];Lyte.resolvePromises(v?{}:{filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-services-appointments.js"],ResourceConstants.CRMClient))}).then((function(){var a=v||Lyte.registeredMixins["crm-appointments-mixin"],r={};r="relatedlist_new"===t&&Crm.renderDVLyteFlow("Appointments")||"krp"===t&&(Lyte.Router.getRouteInstance()&&"canvas"===Lyte.Router.getRouteInstance().routeName||Crm.renderDVLyteFlow("Appointments"))?Events.appointmentParams:a.setAppointmentPopupParams(t,n,i,e),a&&a.checkAppointmentRecordPermission("Appointments","Create")&&!a.isAppointmentPopup&&$("#qcModalContent").length<1&&(a.isAppointmentPopup=!0,a.showAppointmentSectionPopup(void 0,"Appointment Information",t,void 0,"create",r))}))}else{if(Crm.userDetails.isStorageLimitReached)return void Crm.showStorageExceedPopup();var m=networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js","lyte-colorpicker.js"],ResourceConstants.CRMClient);if(m=(m=(m=m.concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailEditor")],ResourceConstants.CRM)),Lyte.injectResources(m),Crm.userDetails.isPhoneNoNewView&&Crm.loadPhoneFieldComponentJSFiles(),n&&("Appointments"===n||n.dataset&&("Detail_createApppointment"===n.dataset.zcqa||"moreOptInQAOpt_create_appointment"===n.dataset.zcqa)||n[0]&&n[0].dataset&&n[0].dataset.appointment)&&!l){var u=[];u=(u=(u=(u=u.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-vision-create.js","crm-services-appointments.js","servapp_preferences_model.js","crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));var p=[];Crm.userDetails.RTL_ENABLED&&(p=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],ResourceConstants.CRMClient)),p=p.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],ResourceConstants.CRMClient)),u=(u=u.concat(p)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")],ResourceConstants.CRM));var E=networkUtils.getI18nJSUrl("serviceentitykeys");u=u.concat(networkUtils.returnDependencyFiles([E],ResourceConstants.CRM));var g={};return g.filesResolved=Lyte.injectResources(u),(!store.peekRecord("module",moduleRecordMapping.Services.id).fields||store.peekRecord("module",moduleRecordMapping.Services.id).fields.length<0)&&(g.servicesField=store.findAll("field",{module:"Services__s"})),void Lyte.resolvePromises(g).then((function(){Events.globalCreate(e,t,n,i,a,r,s,o,!0)}))}Lyte.injectResources(networkUtils.returnDependencyFiles(["businessHoursmixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadRecourceFile(),void 0)})),this.closeEntity(),this.allDayField=a,this.addMoreDetailsClicked=!1,this.currentStatus="create";var h=Events.getPositionObjFromEvent(e);if(Events.createSource=t,Events.evtCreateFrom=t,Events.currElem=n,Events.currentEventHostId=r,n&&("Appointments"===n||n.dataset&&("Detail_createApppointment"===n.dataset.zcqa||"moreOptInQAOpt_create_appointment"===n.dataset.zcqa)||n[0]&&n[0].dataset&&n[0].dataset.appointment)){if(this.moduleName="Appointments",$("#saveAppointmentsBtn").attr("value",I18n.getMsg("Save")),"relatedlist_new"==t||"nbx"===t)"canvas"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName&&(Events.appointmentParams={},Events.appointmentParams.listRelationId=$(n).data().relid,Events.appointmentParams.entityid=detailView.entityId,Events.appointmentParams.relmodule=detailView.currentModule,Events.appointmentParams.entityname=$("#entityName").val());else if("krp"===t){if(!Lyte.Router.getRouteInstance()||"canvas"!==Lyte.Router.getRouteInstance().routeName){var f=$("#krp_Rightpanel_InfoContainer").find("#entityName").val();Lyte.registeredMixins["crm-appointments-mixin"].setAppointmentParams($$rightPanel.entityId,f,$$rightPanel.currentModule),Lyte.$.replaceOldInjectResource(),"undefined"!=typeof featuresAvailable&&featuresAvailable||(featuresAvailable="undefined"!=typeof SIHomeUtil&&SIHomeUtil.featuresAvailable?SIHomeUtil.featuresAvailable:{})}}else if("salessignals"===t){var I=$("#ss_entityId").val(),C=$("#ntcBusinessCard"+I).find("#subvalue_LASTNAME").text();Lyte.registeredMixins["crm-appointments-mixin"].setAppointmentParams(I,C,$("#ss_module").val())}else if("kanban"===Lyte.Router.getRouteInstance().routeName&&"listview"===t){var _=$(n).attr("data-relid"),w=$("[name='module']").val();Lyte.registeredMixins["crm-appointments-mixin"].setAppointmentParams(_,$("#listView_"+_).text(),w)}else if("list"===Lyte.Router.getRouteInstance().routeName&&"listview"===t&&n.dataset&&"moreOptInQAOpt_create_appointment"===n.dataset.zcqa){if(Events.appointmentParams={},Events.appointmentParams.entityid=customViewObject.selectedIdForQuickAction[0],Events.appointmentParams.relmodule=customViewObject.module,"Services"===Events.appointmentParams.relmodule){var y=moduleRecordMapping.Services.related_lists.filter((function(e){if("APPOINTMENTSPERSONALITY"===e.personality_name)return e}));Events.appointmentParams.listRelationId=y[0].id}var M=$("#listView_"+customViewObject.selectedIdForQuickAction[0]).text();Events.appointmentParams.entityname=M.trim(),customViewObject.selectedIdForQuickAction=[]}else Events.appointmentPos=h,Events.evtappointment=e,Events.crntEleappointment=n;if("calendar"==t){if("monthview"===calView.currCalView&&"calendarGlobelAdd"!=t||"weekview"===calView.currCalView&&calView.isMultiUserView){if("24:00"!==Crm.calPreferences.DAYSTARTSAT)if(Utils.isToday(i)){var D=new Date;i.setHours(D.getHours()),i.setMinutes(D.getMinutes()),i=Events.getRoundedDateTime(i)}else i.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT))}else"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||i.setMinutes(0);Events.appointmentClickedDate=i}}var T=Crm.getCrmBasePath()+"/Create.do";Crm.downloadValidationRules(T+"?format=json&module="+this.moduleName,this.moduleName,(function(){Events.createEntity(Events.moduleName,void 0,(function(){"ACTIVITYPERSONALITY"==$(n).parent().attr("data-options")&&($(n).parent().css("z-index",19),Events.hideObjId=$(n).parent().attr("id"),Crm.menu.menusInDisplay[Events.hideObjId]&&delete Crm.menu.menusInDisplay[Events.hideObjId],renderingUtils.stopEvent(e)),Events.eventCreateCBn(t,n,e,void 0,h,d);var a="eventCreateFrom";if(Crm.requestParam[a]=t,"calendar"!==t&&$("#calSelUserHeader").is(":visible")&&(Crm.requestParam[a]="calendarGlobelAdd"),"calendar"==t||"calendarGlobelAdd"==t){if("monthview"===calView.currCalView&&"calendarGlobelAdd"!=t||"weekview"===calView.currCalView&&calView.isMultiUserView){if("24:00"!==Crm.calPreferences.DAYSTARTSAT)if(Utils.isToday(i)){var l=new Date;i.setHours(l.getHours()),i.setMinutes(l.getMinutes()),i=Events.getRoundedDateTime(i)}else i.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT))}else"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||i.setMinutes(0);calView.isMultiUserView?r&&s||(s=Crm.userDetails.DISPLAY_NAME,r=Crm.userDetails.USER_ID):(s=crmCalendar.currCalSelusrName,r=calView.currCalSelusr);var v=s;return v.length>15&&(s=s.substr(0,14)+"..."),Crm.userDetails.LITE&&Crm.userDetails.LITE.IS_LITE_USER||($("#Crm_Events_SMOWNERID").attr("title",v).data("id",r).data("oldValue",r),$("#Crm_Events_SMOWNERID span").text(s)),Events.setStartDateAndTime(i),Events.setEndDateAndTime(!0,!1),"calendar"==t&&$("#eventCreatePopup").addClass("eventCreateCalenderView"),!0}if("crmEmail"==t)return Events.setStartDateAndTime(i),Events.setEndDateAndTime(!0,!1),!0;n||Events.setEndDateAndTime(!0,!1,void 0,!0),o&&o();var m=$L("#eventCreatePopup");if(m.length>0&&m.trapFocus({stopPropagation:!0}),Events.scheduleOnlineEvent){if($L("#meetingInclude").prop("checked",!0),Events.changeLocationValue(),"canvas"===Lyte.Router.getRouteInstance().routeName||$L("#btn_send_mail").length>0&&$L("#Events_fldRow_CONTACTID").length>0){var u=$L("#addpartCheckbox");u.prop("checked",!0),Events.addRelatedParticipant(u,c.rlid,c.rlmodule)}$("#addpartCheck").hide(),Events.scheduleOnlineEvent=!1,Events.createSource=void 0}}),void 0,void 0,d)})),thirdPartyUtils.bindSelect2($(".newChosenSel").find("select"))}},createEntity:function(e,t,n,i,a,r){Crm.requestParam={},commonUtils.showHideLoadingDiv(!0),Crm.isFromSalesInbox&&"Appointments"===e&&window.Appointments&&void 0===window.Appointments.setStatus&&(window.Appointments=void 0);var s=Crm.getModuleObj(e);Crm.userDetails.USER_ID;i=i||"create",window[e].setStatus(i);var o=Crm.getCrmBasePath()+"/Create.do";Crm.fieldsObj[e]=[],Crm.currencyFields[e]=[];var l={module:e,format:"json"};for(var d in"Appointments"===e&&Events.appointmentParams&&(t=Events.appointmentParams),t)/clickId|calleeObj/.test(d)||(l[d]=t[d]),Crm.requestParam[d]=t[d];if(Events.finalIdsJson={},l.tstamp=(new Date).getTime(),"setup"==window[e].currentStatus&&(l.isPageLayout="true"),"stageView"===Events.createSource){var c=$L("crm-inner-list")[0];c&&c.component.data.recordObjForQuickAction&&c.component.data.recordObjForQuickAction.id&&"Contacts"===c.component.data.module?(l.relmodule=c.component.data.module,l.entityid=c.component.data.recordObjForQuickAction.id):customViewObject&&customViewObject.isKanbanView&&Events.currElem&&"Contacts"===customViewObject.module&&(l.relmodule=customViewObject.module,l.entityid=$(Events.currElem).attr("data-relid"))}store.findAll("wizard");var v=new crmRequestPool;return v.initiate({type:"GET",url:o,data:l,dataType:"json",success:function(t){if(t.meetingConfZuid&&(Events.meetingConfZuid=t.meetingConfZuid,Events.meetingSiteUrl=t.meetingSiteUrl),t.inviteeslimit&&(Events.inviteeslimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit),t.responseText&&-1!=t.responseText.indexOf("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEEDS"))return renderingUtils.showCustomAlert(I18n.getMsg("crm.newfree.limit.exceed")),void commonUtils.showHideLoadingDiv();if(t.eventMeetingOnboardingShown&&(Events.eventMeetingOnboardingShown=!0),t.productLineItems&&(window[e].currentStatus="create"),null!=a&&null!=a&&""!=a&&"clientPortal"===a){if("Calls"===e&&(s.createTemplate=crmCommonModule.createTemplate),Crm.userDetails.SUBFORM_PERMISSIONS){var i=t[e].profilePermissionMap?t[e].profilePermissionMap:[],o=t[e].subforms?t[e].subforms.section:[];if(o)for(var l=o.length,d=objectUtils.getKeys(i),c=d.length,v=0;v<l;v++)for(var m=0;m<c;m++)if(d[m]===o[v].subFormTabId){o[v].profilePermissionMap=i[d[m]];break}}if(s.createTemplate(t,n,"layoutPreview"),"Tasks"===e||"Events"===e||"Calls"===e){let t=$L("crm-client-portal-preview"),n=t[t.length-1].component.data.personality_module.api_name;var u=$L("#preHTMLContainer_"+e);if(u.addClass("peNone"),"Calls"===e){var p=new CrmDate;$L("#Crm_Calls_CALLSTARTDATETIME").val(p.getDateInUserPattern());let e=$L("#Crm_Calls_CONTACTID_WhoId_select , #Crm_Calls_SEID_select",u),t=e.length;for(let n=0;n<t;n++)e[n].remove()}if("Events"===e){let e="Contacts"===n||"Leads"===n?n:"Others";$("#Crm_Events_CONTACTID_select").val(e).trigger("change"),"Others"===e?$L("#Events_fldRow_SEID").show():$L("#Events_fldRow_CONTACTID")[0].remove(),$L("#Crm_Events_SMOWNERID #ownerNameLookupSpan").text(Crm.userDetails.DISPLAY_NAME),thirdPartyUtils.bindPerfectScrollUpdate("#eventCreationInnerDiv")}let i="#Crm_"+e+"_SEID_label_select",a=$L("option",i).toArray().map((e=>e.value));a.contains("Related To")||$(i).append('<option value="Related To">Related To</option>'),a.contains(n)?$L(i).val(n):$L(i).val("Related To")}}else"Campaigns"==t.module&&"true"==t.intermediatePage?s.showIntermediatePage(t,n):s.createTemplate(t,n,void 0,r);commonUtils.showHideLoadingDiv()},error:function(e){var t="crm.record.delete.message";if(-1!=e.responseText.indexOf("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEEDS")&&(t="crm.newfree.limit.exceed"),-1===e.responseText.indexOf("INSUFFICIENT_PRIVILEGES")){var n='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg(t,[Crm.getCrmBasePath()])+'</div></div><br class="cBoth"><div class="alignRight mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(n)}commonUtils.showHideLoadingDiv()}}),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(l.module))&&(l.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},v.addUp({type:"GET",action:o,data:l,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,l.module,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),!1},initCreateLayout:function(e){Events.createEntity(this.moduleName,void 0,(function(){this.currentStatus=void 0,e&&e()}),"setup")},createFieldRow:function(e,t,n){if(n){var i=n.label,a=n.colname;if("MEETING_PROVIDER"===a&&0===n.val.length)return;if("setup"!=this.currentStatus){if("Who Id"==i){var r=n.defaultvalue;(C=document.createDocumentFragment()).appendChild(t);var s=t.cloneNode(!0),o=(g=$(t).find("input")[0]).id,l=n.label,d=$(s.firstChild);$(g).val(""),d.html(I18n.getMsg("What Id")),n.mandate+""=="true"&&d.append("<sup class='crmNegativeColor'>*</sup>");d.firstChild;var c=$(s.childNodes[1]),v=objectUtils.getKeys(crmConstants.defaultWhoId[this.moduleName]),m=renderingUtils.createSelectBox((function(e){var t=Crm.moduleInfo[v[e]]?Crm.moduleInfo[v[e]].translatedSingularLabel:I18n.getMsg(crmConstants.defaultWhoId[Events.moduleName][v[e]]);if(!t)return!1;var i={html:t,value:v[e]};return(0===e||r&&n.lookupmodule===v[e])&&(i.defaultVal="true"),i})),u=$(m);u.removeClass("select"),u.css({width:"135px"}),u.attr({id:o+"_select"}).data({displaylabel:I18n.getMsg("Related To"),uitype:n.uitype,mandate:n.mandate,name:l,maxlength:n.maxlength}),Crm.fieldsObj[this.moduleName].push(o+"_select"),u.change((function(){Events.showEventRelatedToOptions(this,!0)}));var p=$(document.createElement("div"));if($(c[0]).empty(),c.html(p),p.attr("class","createSelect newChosenSel"),p.html(m),$(s).find("#addpartCheck").remove(),C.insertBefore(s,t),r){var E=n.lookupmodule;u.val(E),$(g).val(r).data("displaylabel",E).data("id",n.entityid)}else $(t).hide(),"create"!==this.currentStatus&&(u.val("Others"),n.defaultvalue="Others");return C}if("What Id"==i){r=n.defaultvalue;var g=$(t).find("input"),h=$(t).find("select");if(h.length){h.removeClass("select");var f=$(t).find("div").first();p=$(document.createElement("div"));f.append(p),p.attr("class","createSelect newChosenSel"),p.append(h)}if(r){var I=n.entitymodule;I||(I=n.lookupmodule),h.val(I),$(t).find("#Crm_Events_SEID").attr("recId",n.defaultid),Events.relAccMod=!0,crmTab.tabList.contains(I)||$(t).find("#Crm_Events_SEID_img").hide(),$(g).val(r).data("id",n.entityid)}else $(t).hide()}else if(("ALLDAYEVENT"==a||"STARTDATETIME"==a||"ENDDATETIME"==a)&&($(t).attr("id",this.moduleName+"_fldRow_"+a),"ALLDAYEVENT"==a)){var C;(C=document.createDocumentFragment()).appendChild(t);var _=document.createElement("div");$(_).attr({id:"timeAlertTR",style:"display:none"});p=document.createElement("div");return $(p).attr({style:"border:1px solid #EDF0F4; background:#FAFAE7; padding:3px;"}),$(_).append($(p)),C.appendChild(_),C}}else{if("Who Id"==i){d=$(t).find("table td div").eq(0);var w=$("<select>",{style:"pointer-events:none; cursor:move; width:115px"});w.append($("<option>").html(I18n.getMsg("None")));var y=$(t).find("table td div").eq(1),M=" <sup class='crmNegativeColor'></sup>";"true"==n.mandate&&(M=" <sup class='crmNegativeColor'>*</sup>"),d.html(I18n.getMsg("What Id")+M),(p=$(document.createElement("div"))).attr("class","newSelect"),p.append(w),y.html(p)}else if("What Id"==i)return;$(t).attr("uitype",n.uitype)}return t}return t},createTemplate:function(e,t,n,i){"portalPreview"===this.currentStatus&&$("#"+n).html(""),"layoutPreview"===n?Events.loadeventCreatePopup(n):Events.loadeventCreatePopup(),Crm.isHeadless||!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||"undefined"==typeof detailView||detailView.atnAddClassSelected($("tr#"+e.entityId).find(".neweditIcon")),Events.createEditJson=e;var a=this.moduleName;Events.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[Crm.getModuleDisplayName(!0,!1,!0)])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}],Crm.userDetails.changeOwnerPermission=e.changeOwnerPermission,e[a].fieldDependency&&(Crm.fieldDependency[a]=JSON.parse(e[a].fieldDependency)),e.DatePattern&&(Crm.userDetails.DATE_PATTERN=e.DatePattern.toLowerCase()),e.DISPLAY_NAME&&(Crm.userDetails.DISPLAY_NAME=e.DISPLAY_NAME),e[a].calPreferences&&(Crm.calPreferences=e[a].calPreferences),e.WhatId&&(this.whatIdModulesArr=e.WhatIdArr.split(":::"),crmConstants.defaultWhatId[a]=window[a].whatIdModulesArr),e.currencyDetails&&(this.currencyDetails=e.currencyDetails),"Appointments"!==a&&(crmConstants.defaultWhoId[this.moduleName].None="None",moduleRecordMapping.Leads.viewable&&moduleRecordMapping.Leads.visible&&(crmConstants.defaultWhoId[this.moduleName].Leads="Leads"),moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.visible&&(crmConstants.defaultWhoId[this.moduleName].Contacts="Contacts"),crmConstants.defaultWhoId[this.moduleName].Others="Others",e[this.moduleName].section.length||(this.addMoreDetailsClicked=!0,$("#showMoreFiledsLink").hide()),this.isEventStarted=e.isEventStarted?e.isEventStarted:0,this.selInviteesCnt=e.invCnt?parseInt(e.invCnt):0,this.status=e.status?e.status:0,Crm.requestParam["property(EventStatus)"]=this.status),crmTemplate.lyteEnabled=this.lyteEnabled,crmTemplate.parentModuleName=this.parentModuleName,crmTemplate.recordId=this.recordId;var r=crmTemplate.create(e,this.moduleName,e[this.moduleName].section,void 0,i);if("setup"==this.currentStatus){var s=r;$("#"+n).html(""),"Appointments"===a?($elemId.append(s.find("#secContent_Appointment_Information li")),$elemId.append(s.find("#secContent_Appointment_Additional_Information li "))):($("#"+n).append(s.find("#secContent_Event_Information li")),$("#"+n).append(s.find("#secContent_Event_Additional_Information li ")))}else{var o=r,l=o.find("#Crm_Events_ALLDAYEVENT").data("oldValue");if("false"==l||""==l?($(renderingUtils.createSelectBox(Events.eventRemindAtOptions)),"create"==this.currentStatus&&Crm.calPreferences.REMINDAT):($(renderingUtils.createSelectBox(Events.eventRemindAtOptions_allday)),o.find("#Crm_Events_STARTDATETIME_TimeOption, #Crm_Events_ENDDATETIME_TimeOption").css({visibility:"hidden"}),"create"==this.currentStatus&&Crm.calPreferences.ALLDAYEVENTREMINDER),"relatedlist_meetnow"==Events.createSource){for(var d=["#Events_fldRow_EVENT_PROVIDER","#Events_fldRow_EVENT_VENUE","#Events_fldRow_LOCATION","#Events_fldRow_ALLDAYEVENT","#Events_fldRow_STARTDATETIME","#Events_fldRow_ENDDATETIME","#Events_fldRow_SMOWNERID","#Events_fldRow_RECURRING","#Events_fldRow_REMINDAT","#CrmEventMeetingInteg","#Events_fldRow_REMINDINVITEESAT"],c=d.length,v=0;v<=c;v++){var m=d[v];o.find(m).attr("style","display:none")}o.find("#secDiv_Event_Additional_Information").removeAttr("style"),o.find("#meetingInclude").attr("checked","true"),o.find("#Crm_Events_MeetingSolutions_select").find("option").attr("name",Events.meetToolsel);var u=o.find("#Events_fldRow_SUBJECT");Crm.userDetails.MEETING_BRIDGE_ENABLED&&(u=o.find("#Events_fldRow_MEETING_PROVIDER"));var p=$(Handlebars.templates.meetingDurationField());u.after(p),u.after(o.find("#Events_fldRow_DESCRIPTION")),thirdPartyUtils.bindSelect2("#Crm_Events_DURATION")}if("Appointments"===a){var E=$("<div>",{id:"AppointmentCreateErrorRespDiv",align:"center",style:"display:none",class:"red11 m0 crm-small-font-size"});this.addMoreDetailsClicked=!0,$("#showMoreFiledsLink").hide(),$("div.contHeadInfo.eventHeaderStyle.crm-heading-font-size").text(I18n.getMsg("Appointments"))}else E=$("<div>",{id:"eventCreateErrorRespDiv",align:"center",style:"display:none",class:"red11 m0 crm-small-font-size"});if(!Crm.isHeadless&&SalesSignalsWrapper.isSignalIFrameOpen){"Appointments"===a?$("#preHTMLContainer_Appointments"):$("#preHTMLContainer_Events"),top.signalsIframe.prehtmlcontainerModule.remove();var g=$(document.getElementById("eventCreationInnerDiv_ss"));if(g.prepend(o),crmTemplate.bindFldTooltip(),"edit"===Events.currentStatus)"Appointments"===a?(h=$("#secDiv_Appointment_Information "),f=$("#secContent_Appointment_Additional_Information div.tabDivCreate")):(h=$("#eventCreateContainerDiv #secDiv_Event_Information "),f=$("#secContent_Event_Additional_Information div.tabDivCreate")),h.eq(0).append(f);g.prepend(E),thirdPartyUtils.bindPerfectScroll(g),g.css({"padding-right":"12px"})}else{var h,f,I;if(("Appointments"===a?$("#preHTMLContainer_Appointments"):$("#preHTMLContainer_Events")).remove(),$("#eventCreationInnerDiv").prepend(o),crmTemplate.bindFldTooltip(),"edit"===Events.currentStatus)"Appointments"===a?(h=$("#secDiv_Appointment_Information "),f=$("#secContent_Appointment_Additional_Information div.tabDivCreate")):(h=$("#eventCreateContainerDiv #secDiv_Event_Information "),f=$("#secContent_Event_Additional_Information div.tabDivCreate")),f&&(I=f.find("crm-richtext-component")),h.eq(0).append(f),I.each((e=>{var t=".createMultiLineRTFFieldtask #"+I[e].component.getData("id"),n=$(t);if(n.length>0){n.remove();var i="#Events_fldRow_"+I[e].dataset.colname+" .createMultiLineRTFFieldtask";if($(i).length>0){Lyte.Component.render("crm-richtext-component",I[e].component.data,i);var a=$(i)[0].querySelector("crm-richtext-component");if(a){var r=I.eq(e).data();$.each(r,(function(e,t){a.setAttribute("data-"+e,t)}))}}}}));$("#eventCreationInnerDiv").prepend(E),thirdPartyUtils.bindPerfectScroll("#eventCreationInnerDiv"),$("#eventCreationInnerDiv").css({"padding-right":"12px"})}"Appointments"!==a&&Events.setSelInvCnt()}if(void 0!==n&&"layoutPreview"!==n)renderingUtils.setTooltip($("#"+crmTemplate.getElemIdByColname(this.moduleName,"SMOWNERID")+" span")[0],$("#"+crmTemplate.getElemIdByColname(this.moduleName,"SMOWNERID"))[0].title);else if("setup"===this.currentStatus){var C=$("#Crm_"+this.moduleName+"_setup_SMOWNERID")[0].title;$("#Crm_"+this.moduleName+"_setup_SMOWNERID span")[0].innerText=C,$("#Crm_"+this.moduleName+"_setup_SMOWNERID")[0].title=C}else if(!Crm.isHeadless&&SalesSignalsWrapper.isSignalIFrameOpen){C=top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title;top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID span")[0].innerText=C,top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title=C,top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].setAttribute("data","bodyappend:'yes',innerscrollid:'eventCreationInnerDiv_ss'"),top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.bodyappend="yes",top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.innerscrollid="eventCreationInnerDiv_ss"}else if("layoutPreview"!==n){C=$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title;$("#Crm_"+this.moduleName+"_SMOWNERID span")[0].innerText=C,$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title=C,$("#Crm_"+this.moduleName+"_SMOWNERID")[0].setAttribute("data","bodyappend:'yes',innerscrollid:'eventCreationInnerDiv'"),$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.bodyappend="yes",$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.innerscrollid="eventCreationInnerDiv"}if(crmTemplate.setDependentFields("Events",this.currentStatus),t&&t(),$("#saveEventsBtn").prop("disabled",!1).siblings("input[type=button]").prop("disabled",!1),Events.loadInvitationConfirmDiv(),$("#invitationConfirmDiv .send,#invitationConfirmDiv .dntSend").prop("disabled",!1),crmTemplate.contentLoaded(e,this.moduleName,o),"edit"==Events.currentStatus&&"Appointments"!==a){$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),(new Date).getTime();Events.isRecEvent&&(Events.isRecurringEditAvail=!0)}$("#Crm_Events_ENDDATETIME_TimeOption").trigger("create_edit_clone_DomChange"),o&&thirdPartyUtils.bindSelect2(o.find(".newChosenSel select,.mlSelect select"));var _=$("#eventCreatePopup");"Events"===a&&($("#eventCreationInnerDiv").perfectScrollbar("destroy"),$L("#eventCreationInnerDiv").scroll({nested:!0})),$(".fixedSearch").is(":visible")&&_.addClass("pFixed"),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.modifyLocationValue()},validateOnlineProvider:function(e,t,n,i,a,r,s){if("Events"===e&&$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")){$("#CrmEventMeetingInteg").remove();var o=$("#Events_fldRow_MEETING_PROVIDER"),l=$("#Crm_Events_MEETING_PROVIDER").val(),d=$("#Events_fldRow_MEETING_VENUE"),c=$("#provNotEnabledAlert"),v=$("#provNotAuthorisedAlert");"true"===isSandboxAcc?0===c.length?d.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.sandbox.alert")+"</span></div>"):"text"===t&&c.addClass("meetingVenueHiRed"):"F"===Crm.userDetails.LICENSE_TYPE||"N"===Crm.userDetails.LICENSE_TYPE||"L"===Crm.userDetails.LICENSE_TYPE?(0===c.length?Crm.userDetails.LITE.IS_LITE_USER?d.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pR10 pB6 pL10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.liteusers.alert")+"</span></div>"):"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled?d.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pR10 pB6 pL10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.supportuser.alert")+"</span></div>"):d.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pR10 pB6 pL10 meetingVenueTranspBg"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.freeedition.alert")+"</span></div>"):"text"===t&&c.addClass("meetingVenueHiRed"),o.length>0&&o.hide()):void 0!==l&&(Crm.userDetails.USER_ID!==$("#Crm_Events_SMOWNERID").data("id")?n&&Events.saveEntity(i,a,r,s):"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled||MeetingBridge.isAuthorized(MeetingBridge.providerNameVsId[Events.actualToolName[l]],Crm.userDetails.ZUID).then((function(e){v=$("#provNotAuthorisedAlert"),!1===e?(n=!1,"modal"===t?Events.callAuthorization(Events.actualToolName[l],t):"text"===t&&(0===v.length?o.after('<div id="provNotAuthorisedAlert" class="crm-small-font-size pT6 pB6 p10" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meetingprovider.authorise.alert1")+'<a href="javascript:void(0);" onclick="Events.callAuthorization(\''+Events.actualToolName[l]+"', '"+t+"')\">"+I18n.getMsg("crm.meetingprovider.authorise.alert2")+"</a></span></div>"):v.addClass("meetingVenueHiRed"))):(v.remove(),$("#saveEventsBtn").prop("disabled",!1)),(n||0!==v.length)&&Events.saveEntity(i,a,r,s)}))),0===c.length||"SupportProfileInternal"!==Crm.userDetails.PROFILE_NAME&&!Crm.userDetails.isSupportAccessExitSessionEnabled||(c.addClass("meetingVenueHiRed"),$("#eventCreationInnerDiv").scrollTop(0),Events.saveEntity(i,a,r,s))}},setStartDateAndTime:function(e){var t,n=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(n=!0);var i=$("#Crm_Events_STARTDATETIME");if(e)t=new Date(e);else{t=$L.moment(i.data("dateObj")).toDate();var a=trimBoth($("#Crm_Events_STARTDATETIME_TimeOption").val().split(" ")[0]),r=$("#Crm_Events_STARTDATETIME_TimeOption").timeEntry("getTime");if(r){var s=Utils.getMeridiem(r).toUpperCase();n?t.setHours(parseInt(a.split(":")[0],10)):t.setHours(Utils.convertTimeTo24HoursFormat(parseInt(a.split(":")[0],10),s)),t.setMinutes(parseInt(a.split(":")[1],10))}}if("Invalid Date"==t)return t;if(n)$("#Crm_Events_STARTDATETIME_TimeOption").val(Utils.formatTimeVal(t.getHours())+":"+Utils.formatTimeVal(t.getMinutes()));else{var o=Utils.convertTo12HoursFormatTimeObj(t);$("#Crm_Events_STARTDATETIME_TimeOption").val(o.hrs+":"+o.mins+" "+I18n.getMsg(o.meridiem.toUpperCase()))}i.val(crmCalendar.convertToUserDatePattern(t.getDate()+" "+t.getMonth()+" "+t.getFullYear())),i.data("dateObj",t)},checkAvailability:function(e,t,n,i,a,r,s){$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"GET",data:"type=checkAvail&st="+e+"&et="+t+"&hostId="+n+"&entityId="+a+"&actType="+i+"&meetNow="+r,success:s})},checkDuplicateEvent:function(e,t,n,i,a){var r=$("#Crm_Events_SMOWNERID");$("#saveEventsBtn").attr("disabled","disabled"),e&&"Calls"===e.activityType&&$("#saveCallBtn").attr("disabled","disabled"),e||((e={start:$("#Crm_Events_STARTDATETIME").data("dateObj"),end:$("#Crm_Events_ENDDATETIME").data("dateObj"),activityType:"Events"}).oldStart=new Date($("#Crm_Events_STARTDATETIME").data("oldValue")),e.oldEnd=$("#Crm_Events_ENDDATETIME").data("oldValue"),r.length>0?(e.ownerId=r.data("id"),e.oldOwnerId=r.data("oldValue")):(e.ownerId=Crm.userDetails.USER_ID,e.oldOwnerId=Crm.userDetails.USER_ID),e.isAllday=$("#Crm_Events_ALLDAYEVENT").is(":checked"),e.entityId=a||Events.entityId);var s="";e.entityId&&""!==e.entityId&&(s=e.entityId),"true"===isSandboxAcc&&$("#Events_fldRow_MEETING_PROVIDER").hide();var o=e.activityType,l=e.start,d=new Date,c=e.ownerId,v=e.oldOwnerId,m="";if($("#Crm_Events_SMOWNERID").length>0&&(m=r.attr("data-id")),("edit"===this.currentStatus&&l.getTime()===e.oldStart.getTime()&&m===c||Utils.compareDateandTime(l,d)||"calendar"===Events.createSource&&("weekview"===calView.currCalView||"dayview"===calView.currCalView)&&c===v)&&"Events"===o||"Calls"===o&&Utils.compareDateandTime(u,d)){if("calendar"!==Events.createSource||"weekview"!==calView.currCalView&&"dayview"!==calView.currCalView||"Events"!==o)return n&&n(),$("#saveEventsBtn").attr("disabled",!1),!1;Events.skipEventAlert=!0}var u=Utils.getTimeStringWithAmPm(l),p=Utils.getDateInUserDatePattern(l)+" "+u.hrs+":"+u.mins+" "+u.meridiem,E=Utils.getTimeStringWithAmPm(e.end),g=Utils.getDateInUserDatePattern(e.end)+" "+E.hrs+":"+E.mins+" "+E.meridiem,h="relatedlist_meetnow"==Events.createSource;"Events"===o&&$("#provNotAuthorisedAlert").remove(),Events.checkAvailability(p,g,e.ownerId,o,s,h,(function(a){Events.skipEventAlert=!1;e.isAllday;var s,l=a.activityType,d=a.isAllDay;if(null==a.isbusinesshours){var v="<a target='_blank' href='"+Crm.getCrmBasePath()+"/EntityInfo.do?module="+l+"&id="+a.entityId+"'>"+a.subject+"</a>";s="Appointments"===l?Crm.userDetails.USER_ID===c?a.startCoincides?I18n.getMsg("crm.duplicate.appointment.overlapwith.otherevent.start.you",[v,a.endtimeStr,Crm.moduleInfo[o].translatedSingularLabel.toLocaleLowerCase()]):I18n.getMsg("crm.duplicate.appointment.overlapwith.otherevent.end.you",[v,a.starttimeStr,Crm.moduleInfo[o].translatedSingularLabel.toLocaleLowerCase()]):a.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.start.otherevent.other",[a.ownerName,v,a.endtimeStr,Crm.moduleInfo[o].translatedSingularLabel.toLocaleLowerCase()]):I18n.getMsg("crm.duplicate.event.overlapwith.end.otherevent.other",[a.ownerName,v,a.starttimeStr,Crm.moduleInfo[o].translatedSingularLabel.toLocaleLowerCase()]):"Events"===o?Crm.userDetails.USER_ID===c?"Events"===l?d?I18n.getMsg("crm.duplicate.event.overlap.allday.you",[v,Events.getModuleName(!0,!1,!0)]):a.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.event.start.you",[v,a.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.event.end.you",[v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):a.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.call.start.you",[v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.call.end.you",[v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):"Events"===l?d?I18n.getMsg("crm.duplicate.event.overlap.allday.other",[a.ownerName,v,Events.getModuleName(!0,!1,!0)]):a.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.event.start.other",[a.ownerName,v,a.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.event.end.other",[a.ownerName,v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):a.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.call.start.other",[a.ownerName,v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.call.end.other",[a.ownerName,v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):Crm.userDetails.USER_ID===c?"Events"===l?d?I18n.getMsg("crm.duplicate.call.overlap.allday.you",[v]):a.startCoincides?I18n.getMsg("crm.duplicate.call.overlapwith.event.start.you",[v,a.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.event.end.you",[v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.call.you",[v,a.starttimeStr]):"Events"===l?d?I18n.getMsg("crm.duplicate.call.overlap.allday.other",[a.ownerName,v,Events.getModuleName(!0,!1,!0)]):a.startCoincides?I18n.getMsg("crm.duplicate.call.overlapwith.event.start.other",[a.ownerName,v,a.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.event.end.other",[a.ownerName,v,a.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.call.other",[a.ownerName,v,a.starttimeStr])}else{var m=$("#Crm_Events_REPEATTYPE");if(null!=m.val()&&"none"!=m.val())a.isAvail=!1;else switch(a.type){case"business":s=I18n.getMsg("bh.wrng.user.bh.time.1");break;case"shift":s=I18n.getMsg("bh.wrng.user.sh.time.1",[a.ownerName]);break;case"Unavailable":switch(a.unavailabletype){case 1:s=I18n.getMsg("bh.wrng.user.busy.time1",[a.ownerName,a.starttime,a.endtime]);break;case 2:s=I18n.getMsg("bh.wrng.user.busy.time2",[a.ownerName]);break;case 3:s=I18n.getMsg("bh.wrng.user.busy.time3",[a.ownerName,a.startdate,a.enddate]);break;default:s=I18n.getMsg("bh.wrng.user.busy.time4",[a.ownerName,a.starttime,a.startdate,a.endtime,a.enddate])}break;case"holiday":s=I18n.getMsg("bh.wrng.user.holiday",[a.time,a.ownerName]);break;case"break":s=I18n.getMsg("bh.wrng.user.break.time.1",[a.ownerName])}}if(a.isAvail&&!t){if($("#checkDuplicateEvent").remove(),"Calls"===o){var u=renderingUtils.createHTML({name:"div",attr:{id:"checkDuplicateEvent"},css:{padding:"3px","padding-left":"10px","border-bottom":"none"},child:[{name:"table",attr:{cellpadding:"3",cellspacing:"0",border:"0"},child:[{name:"tbody",child:[{name:"tr",child:[{name:"td",attr:{valign:"top"},child:[{name:"span",attr:{class:"dupTimeAlert"}}]},{name:"td",attr:{class:"pL5 crmNotFoundColor crm-small-font-size"},html:s}]}]}]}]});if($("#callDateSpanEdit").is(":visible"))$(u).insertAfter("#callQuickviewTable"),$L("#quickViewContentDiv").scrollTo($L("#callTimeSpanEdit"));else if($("#compCalDiv").length>0)$(u).insertAfter("#compCalDiv");else if($("#Calls_fldRow_CALLSTARTDATETIME").is(":visible")){var p=renderingUtils.createHTML({name:"div",attr:{id:"checkDuplicateEvent"},css:{"margin-top":"-5px"},child:[{name:"div",attr:{class:"labelTabCreate pL5 columnCal1"}},{name:"div",attr:{class:"labelValCreate mL45"},child:[{name:"div",attr:{class:"crmInfoSection mR10 mB20 w390 boxBB dF"},css:{"margin-left":"auto"},child:[{name:"span",attr:{class:"zcicncss-info-rounded zcicn-cssIcons zcicn_grey_mask mT3",id:"dupAlertInCallsCheck"},css:{"flex-shrink":"0",padding:""}},{name:"span",attr:{class:"pL5 crmNotFoundColor crm-small-font-size"},html:s}]}]}]});$(p).insertAfter("#Calls_fldRow_CALLSTARTDATETIME")}else if($("#CallStartDateTimeDiv").is(":visible")){p=renderingUtils.createHTML({name:"tr",attr:{id:"checkDuplicateEvent"},child:[{name:"td"},{name:"td",attr:{class:"tdCheckDuplicateEvent"},child:[{name:"div",attr:{id:"checkDuplicateEventDiv",class:"crmInfoSection dF"},child:[{name:"span",attr:{class:"zcicncss-info-rounded zcicn-cssIcons zcicn_grey_mask mT3",id:"dupAlertInCallsCheck"},css:{"flex-shrink":"0"}},{name:"span",attr:{class:"pL5 crmNotFoundColor crm-small-font-size"},html:s}]}]}]});$(p).insertAfter("#CallStartDateTimeDiv")}else $("#whichCallDiv").parent().append($(u))}else{u=renderingUtils.createHTML({name:"div",attr:{id:"checkDuplicateEvent",class:"timeAlert mT5 infoCont"},child:[{name:"div",attr:{},child:[{name:"div",css:{padding:"3px","border-bottom":"none"},child:[{name:"table",attr:{cellpadding:"3",cellspacing:"0",border:"0"},child:[{name:"tbody",child:[{name:"tr",child:[{name:"td",attr:{valign:"top"},child:[{name:"span",attr:{class:"dupTimeAlert"}}]},{name:"td",attr:{class:"crm-small-font-size crmNotFoundColor"},html:s}]}]}]}]}]}]});if(i)$(u).insertAfter(r.parents("div").eq(0));else{$("#Crm_Events_ENDDATETIME");$(u).insertAfter($("#Events_fldRow_STARTDATETIME")[0])}var E="";E=a.isFromBusinessHour?$("#Events_fldRow_SMOWNERID"):$("#Events_fldRow_ENDDATETIME"),$("#errorMsg_Crm_Events_ENDDATETIME").is(":visible")?u.classList.add("pT15"):u.classList.remove("pT15"),$(u).insertAfter(E)}n&&n(a.isAvail)}else if(a.isAvail){var g=[{val:I18n.getMsg("crm.button.create"),fn:function(){var e=$L("#duplicateEventMsg");crmui.modalZIndex("nonLyte",e[0],"close"),e.hide(),n&&(n(a.isAvail),renderingUtils.removeDummyBackground())}},{val:I18n.getMsg("crm.button.cancel"),fn:function(){var e=$L("#duplicateEventMsg");crmui.modalZIndex("nonLyte",e[0],"close"),e.hide(),renderingUtils.removeDummyBackground()}}],h="crm.events.duplicate.create.msg2";"edit"===Events.currentStatus&&(g=[{val:I18n.getMsg("crm.button.save"),fn:function(){var e=$L("#duplicateEventMsg");crmui.modalZIndex("nonLyte",e[0],"close"),e.hide(),n&&(n(a.isAvail),renderingUtils.removeDummyBackground())}},{val:I18n.getMsg("crm.button.cancel"),fn:function(){var e=$L("#duplicateEventMsg");crmui.modalZIndex("nonLyte",e[0],"close"),e.hide(),renderingUtils.removeDummyBackground()}}],h="crm.events.duplicate.edit.msg2"),renderingUtils.showCustomConfirmMessage("duplicateEventMsg",[s,I18n.getMsg(h,["Calls"===o?Calls.moduleName:Events.getModuleName(!0,!1,!0)])],g),renderingUtils.dummyBackground(!1,"duplicateEventMsg")}else $("#checkDuplicateEvent").remove(),n&&n();$("#saveEventsBtn").attr("disabled",!1),$("#saveCallBtn").attr("disabled",!1),Events.userChange&&($("#saveEventsBtn").attr("disabled","disabled"),Events.userChange=!1)}))},setEndDateAndTime:function(e,t,n,i){var a=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(a=!0);var r=$("#Crm_Events_ENDDATETIME_TimeOption"),s=$("#Crm_Events_ENDDATETIME"),o=!t&&s.data("edited"),l=new Date($("#Crm_Events_STARTDATETIME").data("dateObj")),d=crmCalendar.monthName[l.getMonth()].html;if($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_ON_label").text(I18n.getMsg("crm.recurring.custom.yearly.repeat.on",I18n.getMsg([d]))),$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE")[0]){for(var c=Utils.getMonthEnd(l.getMonth(),l.getFullYear()),v=crmConstants.dateArray.slice(0),m=v.length-1;m>0&&c!==v[m];m--)v.splice(m,1);$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(v).innerHTML).data("name","yearlydays1select")}if(o){if(!e&&!t){u=n?new Date(n):new Date(s.data("dateObj"));if(a)r.val(Utils.formatTimeVal(u.getHours())+":"+Utils.formatTimeVal(u.getMinutes()));else{h=Utils.convertTo12HoursFormatTimeObj(u);r.val(h.hrs+":"+h.mins+" "+I18n.getMsg(h.meridiem.toUpperCase()))}s.val(crmCalendar.convertToUserDatePattern(u.getDate()+" "+u.getMonth()+" "+u.getFullYear())),renderingUtils.triggerEvent("change",s),s.data("dateObj",u),r.trigger("create_edit_clone_DomChange")}}else{var u=n?new Date(n):new Date(s.data("dateObj"));if(e&&"edit"===r.data().currentstatus||e&&"clone"===r.data().currentstatus)u=$L.moment(s.data("dateObj")).toDate();else{if("Invalid Date"==n)return;(u=new Date($("#Crm_Events_STARTDATETIME").data("dateObj"))).setMinutes(u.getMinutes()+Crm.calPreferences.EVENTDURATION)}if(t){var p=trimBoth(r.val().split(" ")[0]),E=r.timeEntry("getTime");if(E){var g=Utils.getMeridiem(E).toUpperCase();a?u.setHours(parseInt(p.split(":")[0],10)):u.setHours(Utils.convertTimeTo24HoursFormat(parseInt(p.split(":")[0],10),g)),u.setMinutes(parseInt(p.split(":")[1],10))}}if("Invalid Date"==u)return;if(a)r.val(Utils.formatTimeVal(u.getHours())+":"+Utils.formatTimeVal(u.getMinutes()));else{var h=Utils.convertTo12HoursFormatTimeObj(u);r.val(h.hrs+":"+h.mins+" "+I18n.getMsg(h.meridiem.toUpperCase()))}s.val(crmCalendar.convertToUserDatePattern(u.getDate()+" "+u.getMonth()+" "+u.getFullYear())),renderingUtils.triggerEvent("change",s),s.data("dateObj",u),r.trigger("create_edit_clone_DomChange")}i||this.checkDuplicateEvent()},showMoreFields:function(){var e,t=$("#secDiv_Event_Additional_Information"),n=$("#eventCreateContainerDiv #secDiv_Event_Information"),i=t.children(),a=i.first();i&&(e=i.find("crm-richtext-component")),n.eq(0).append(i),e.each((t=>{var n=".createMultiLineRTFFieldtask #"+e[t].component.getData("id"),i=$(n);if(i.length>0){i.remove();var a="#Events_fldRow_"+e[t].dataset.colname+" .createMultiLineRTFFieldtask";if($(a).length>0){Lyte.Component.render("crm-richtext-component",e[t].component.data,a);var r=$(a)[0].querySelector("crm-richtext-component");if(r){var s=e.eq(t).data();$.each(s,(function(e,t){r.setAttribute("data-"+e,t)}))}}}})),!a.length||window.ctiApiNotifier&&ctiApiNotifier.eventCreate&&validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text())||$L("#eventCreationInnerDiv").scrollTo(a,{duration:1500}),thirdPartyUtils.bindSelect2(n.find(".newChosenSel select,.mlSelect select")),$("#showMoreFiledsLink").hide(),this.addMoreDetailsClicked=!0},resetEntityVars:function(){this.entityId=void 0,this.cloneEntId=void 0,this.currentStatus=void 0,this.invAddLinkClicked=!1,this.reqInvRecAvail={t:!1,u:!1,l:!1,c:!1,lv:!1,cv:!1,g:!1,r:!1,rs:!1},this.isAddInvReqSent=!1,this.addInvPageCnt={t:0,u:0,l:0,c:0,lv:0,cv:0,g:0,r:0,rs:0,rc:0},this.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invDelListCreate={t:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.selInvPageCnt=0,this.selInviteesCnt=0,this.selInvPagerecAvail=!0,this.selInvPagereqSent=!1,this.selInvlinkClicked=!1,this.isCVSelected=!1,this.addInvEmailsList={},this.removeInvEmailsList={},this.isViaCopyPaste=!1,this.recCntIdsArr={add:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}},remove:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}}},this.isRecurringEditAvail=!1,this.isRecEvent=!1,this.modifyingEvent=void 0,this.selectedCVId=void 0,this.timeEntryAdded=!1,this.isPageLayoutModified=!1,this.formRuleModified=!1,this.currentQuickViewId=void 0,this.maxReminderValue=1,this.reminderCount=1,this.showDuplicateContView=[],this.authNotificationSentUsers={},this.withMeetingTool=void 0},resetParticipantJson:function(){this.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.addInvEmailsList={},this.removeInvEmailsList={}},closeEntity:function(e,t){Events.closeOnboarding(),Events.hideObjId&&($("#"+Events.hideObjId).hide().trigger("onBeforeClose"),Events.hideObjId=void 0);var n=$("#saveEventsBtn"),i=$("#eventCreatePopup");i&&i.length>0&&crmui.modalZIndex("nonLyte",i[0],"close"),i.hide(),"create"!==Events.currentStatus&&"edit"!==Events.currentStatus||!CFRExec.tempHold||validationUtils.isEmpty(CFRExec.tempHold.oldResJson)||(CFRExec.init(CFRExec.tempHold.oldResJson,CFRExec.tempHold.formRuleModule,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.tempHold={}),$("#doneRecurringBtn, #eventCreateErrorRespDiv").hide(),i.removeClass("eventCreateCalenderView"),n.show(),$("#cancelEventBtn").show(),n.val(I18n.getMsg("crm.button.save")),"edit"!==Events.currentStatus&&$("#showMoreFiledsLink").show(),Utils.detachObjects.push($.ui.ddmanager.current),$("#eventRecurringDiv, #participantDiv, #addpartCheckbox").remove();var a=$L("#FreezeLayer"),r=$L(".gSecondarySearch"),s="undefined"!=typeof featuresAvailable&&featuresAvailable.NEXTGENUI_ENABLED&&r&&r.length>0;if(s&&a.length>0&&a.css({"z-index":"20"}),!s&&(0===$(".temp_freezelayer").length||Lyte.registeredMixins["crm-emailconversation-view-mixin"]&&Lyte.registeredMixins["crm-emailconversation-view-mixin"].isEmailViewOpen()&&renderingUtils&&renderingUtils.removeFreezeLayer)&&renderingUtils.removeFreezeLayer(),removeFreezeLayer2(),e&&"calendar"===Events.createSource&&"monthview"===calView.currCalView&&Events.currentEventObjectInQV){var o=Events.currentEventObjectInQV.scrollTop;o&&$L(window).scrollTop(o)}crmCalendar.close(),Events.resetEntityVars(),i.empty().remove(),window.ctiApiNotifier&&ctiApiNotifier.notifierCloseEvent(t),$("div[name='ownerNameLookup']").remove(),$("#eventPopupArrow").hide(),Crm.isRecordModified=!1,$(".eventActionsMenu a, .quickCreateLink a").removeClass("quickCreateLinkAct"),$(".eventActionsMenu span, .quickCreateLink span").removeClass("quickCreateLinkAct"),$("body").removeClass("oH"),Events.moduleName="Events",Events.module="Events",Events.movePVInitialvalue(),Crm.isHeadless||!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||"undefined"==typeof detailView||(detailView.btnRemoveClassSelected(!0),detailView.atnRemoveClassSelected(!0))},closeOnboarding:function(){$("#eventCreationInnerDiv").off("scroll.ArrowVisibility"),$(".eventsOnboarding").remove(),$(".markBlueDot").hide(),$("#eventPopupArrow").show()},getCurrEventjson:function(){var e=$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),t=$("#Crm_Events_ENDDATETIME").data("dateObj").getTime(),n=$("#Crm_Events_SMOWNERID").data("id"),i=$("#Crm_Events_SMOWNERID").val(),a=$("#Crm_Events_SUBJECT").val(),r=$("#Crm_Events_ALLDAYEVENT").is(":checked"),s=$("#selectColorComponent").css("background-color");return s&&(s=Events.rgbtohex(s)),{activityType:"Events",start:e,end:t,host:n,title:a,allday:r,hostName:i,color:s}},getCurrAppointmentjson:function(e){var t=$("#Crm_Appointments_APPOINTMENTDATEANDTIME").data("dateObj").getTime(),n=60*JSON.parse($("#Crm_Appointments_SERVICEID").attr("serviceJSON")).Duration*1e3,i=new Date(t+n).getTime(),a=$("#Crm_Appointments_SMOWNERID").data("id"),r=$("#Crm_Appointments_SMOWNERID").val();return{activityType:"Appointments",start:t,end:i,host:a,title:e.title,allday:!1,hostName:r}},isEventModified:function(e,t){var n=!1;return e&&(e.start===t.start&&e.end===t.end&&e.host===t.host&&e.title===t.title&&e.allday===t.allday&&e.color===t.color||(n=!0)),n},isEventTimeModified:function(e,t){var n=!1;return e&&(e.start===t.start&&e.end===t.end&&e.allday===t.allday||(n=!0)),n},isRefreshNeeded:function(e,t,n){if(calView.needRefresh=!1,n){var i=new Date(e.start),a=new Date(e.end),r=new Date(i.getFullYear(),i.getMonth(),i.getDate()),s=new Date(a.getFullYear(),a.getMonth(),a.getDate()),o=$.datepicker.formatDate("yy-mm-dd",u),l=$.datepicker.formatDate("yy-mm-dd",p),d=(s.getTime(),r.getTime(),Utils.getDayDiff(s,r));for(o!==l&&0===s.getHours()&&0===s.getMinutes()&&d--,k=0;k<d;k++){var c=$.datepicker.formatDate("yy-mm-dd",r);if(Events.eventsCntDatewise[c]>4){calView.needRefresh=!0;break}Events.eventsCntDatewise[c]--,r.setDate(r.getDate()+1)}}if(!calView.needRefresh){var v=new Date(t.start),m=new Date(t.end),u=new Date(v.getFullYear(),v.getMonth(),v.getDate()),p=new Date(m.getFullYear(),m.getMonth(),m.getDate()),E=$.datepicker.formatDate("yy-mm-dd",u),g=$.datepicker.formatDate("yy-mm-dd",p);d=Utils.getDayDiff(p,u);for(E!==g&&0===p.getHours()&&0===p.getMinutes()&&d--,k=0;k<d;k++){c=$.datepicker.formatDate("yy-mm-dd",u);if(Events.eventsCntDatewise[c]>4){calView.needRefresh=!0;break}Events.eventsCntDatewise[c]++,u.setDate(u.getDate()+1)}}return calView.needRefresh},validateEntity:function(e,t,n,i){if(Crm.userDetails.MEETING_BRIDGE_ENABLED&&$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")){var a=$("#Crm_Events_MEETING_PROVIDER").val();MeetingBridge.getEnabledProviders().then((function(r){if(void 0!==a){for(var s=!1,o=0!==r.length?r.providers.length:0,l=0;l<o;l++)if(r.providers[l].display_name===a){s=!0;break}var d=$("#provNotEnabledAlert"),c=$("#provNotAuthorisedAlert");if(!s&&!Crm.userDetails.LITE.IS_LITE_USER&&"true"!==isSandboxAcc&&"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE)return d.hide(),c.hide(),void _cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.notenabled.authorised.message1.line1"),ltPropSecondaryMessage:I18n.getMsg("crm.meeting.online.notenabled.authorised.message1.line2",a),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.done"),appearance:"failure"}],ltPropButtonPosition:"center"}});if("SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled)return d.hide(),c.hide(),void _cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.supportuser.alert"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.done"),appearance:"failure"}],ltPropButtonPosition:"center"}})}Events.validateOnlineProvider("Events","text",!0,e,t,n,i)}))}else Events.saveEntity(e,t,n,i)},saveEntity:function(e,t,n,i,a,r){if(!(n&&e&&$(e.currentTarget).hasClass("greenbtn")&&Lyte.registeredMixins["crm-email-auth-util"].showPopUpForEventModule("sendInvite"))){var s=$("#saveEventsBtn"),o=$("#eventCreateErrorRespDiv");if(s.attr("disabled","disabled"),""==$("#Crm_Events_SUBJECT").val()&&s.removeAttr("disabled"),Events.hideObjId&&($("#"+Events.hideObjId).hide().trigger("onBeforeClose"),Events.hideObjId=void 0),"calendar"!==Events.createSource&&$("#calSelUserHeader").is(":visible")&&(Events.createSource="calendarGlobelAdd"),"calendar"===i){Events.createSource="calendar",Events.currentStatus="create";Crm.requestParam.eventCreateFrom="calendar",s.attr("onclick","Events.validateEntity(event)")}if(Crm.requestParam.sendNotificationMail=Events.sendNotificationMail,t&&!n&&!a){var l=trimBoth($("#Crm_Events_SUBJECT").val()),d=this.status,c={title:l,start:$("#Crm_Events_STARTDATETIME").data("dateObj"),status:d};if(returnVal=Events.showSendMailAlert(c),!returnVal)return!0}if("stageView"===Events.createSource&&$("#lv_left_filter").length&&0===$("#lv_left_filter").find('input[type=checkbox][data-name="Activities"]:checked').length&&(Crm.requestParam.fetchUpcomingActivities=!0),Events.selInviteesCnt>Events.inviteeslimit&&Events.isFutureEvent())return Events.showInvExceedPopup(),!1;Crm.saveEntity(e,this.moduleName,(function(e,t){var n=Lyte.registeredMixins["crm-view-utils"];n&&n.isListComponents()&&crmListView.reloadCurrentListView();e.entityId;var a=$L("crm-email-activity-suggestions")[0],r=a?a.component:void 0;if(r){var s=r.data;Lyte.registeredMixins["crm-email-activity-mixin"].entityUpdateCall(s,e)}if(e.hasOwnProperty("affected_formula_fields")){detailView&&(detailView.affectedData=JSON.parse(e.affected_formula_fields.replace("//","")));var l=$L("crm-detail-view");if(l&&l.length>0&&l[0].component){var d=JSON.parse(e.affected_formula_fields.replace("//","")),c=l[0].component,v=c.data.tobe_highlighted_fields;if(c&&c.data&&c.data.content_json.meta_info.fieldAPINameVsIdMap){var m=c.data.content_json.meta_info.fieldAPINameVsIdMap,u=Math.floor(1e4*Math.random());d.forEach((function(e){if(c.data.content_json.meta_info.fieldColumnNameMap[e]){var t=c.data.content_json.meta_info.fieldColumnNameMap[e][1];!m[t]||116!==m[t][1]&&118!==m[t][1]||Lyte.objectUtils(v,"add",t,u)}})),c.setData("tobe_highlighted_fields",v),setTimeout(Lyte.registeredMixins["crm-detailview-common-utils"].removeHighlightedFields,5e3,u)}}}var p=$(".ziaCallAnalyticswrapper");if(p.length||!($(".temp_freezelayer").length>0)||$("#signalDetailViewClose").length>0&&$("#ntcInnerDivContent").length>0||reloadActivityRL(),p.length&&Events.closeEntity(!0),Crm.trackSpotLightAction("Event - Added"),o.hide(),"stageView"===Events.createSource)!e||t||e.error||validationUtils.isEmpty(e)?t||crmListView.refreshRecords($(Q.currElem).attr("data-relid")):crmListView.updateUpComingActions(e),Events.closeEntity();else if(!e||t||e.error)if(e.errorCode)Events.showMeetingErrorMsg(),mailsetCenter("meetingBuy");else{if("edit"!=Events.currentStatus)if(e.errMsg)if("Invalid Refresh Token"==e.errMsg)Events.eventMeetingReAuthorize(e);else if("NOT_AUTHORIZED"==e.errMsg){var E=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[E,e.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e.toolName,e.hostUserId)}else if("SUBSCRIPTION_INVALID"===e.errMsg){E=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.subscription.error",[e.toolName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)}))}else"NOT_ALLOWED"===e.errMsg?"true"===e.isLiteUser?(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.liteusers.alert2")}}),$("#cancelEventBtn").removeAttr("disabled")):"true"===e.isSupportUser&&(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.supportuser.alert2")}}),$("#cancelEventBtn").removeAttr("disabled")):crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(e.errMsg)),6e3);else _cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropPrimaryMessage:I18n.getMsg("crm.event.create.error.msg")}});else if(e.errMsg)if("Invalid Refresh Token"==e.errMsg)Events.eventMeetingReAuthorize(e);else if("NOT_AUTHORIZED"===e.errMsg){E=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[E,e.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e.toolName,e.hostUserId)}else if("SUBSCRIPTION_INVALID"===e.errMsg){E=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.subscription.error",[e.toolName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)}))}else"NOT_ALLOWED"===e.errMsg?"true"===e.isLiteUser?(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.liteusers.alert2")}}),$("#cancelEventBtn").removeAttr("disabled")):"true"===e.isSupportUser&&(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.supportuser.alert2")}}),$("#cancelEventBtn").removeAttr("disabled")):crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(e.errMsg)),6e3);else _cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropPrimaryMessage:I18n.getMsg("crm.event.edit.error.msg",[Events.getModuleName(!0,!1,!0)])}});$L("#eventCreationDiv").scrollTo(o)}else{if(!Crm.isHeadless)if(crmNTC.isSignalDetailViewVisible()||SalesSignalsWrapper.isSignalIFrameOpen)crmNTC.showQuickCreateSuccessMsg(e);else if(document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value||"Appointments"===e.module)if("Appointments"===e.module){if(Crm.requestApp2)return void("calendar"!==Events.createSource&&"calendarGlobelAdd"!==Events.createSource||(Crm.calJSON=e));if(crmui.hidePopup("appointmentCreate"),"edit"===Events.currentStatus)crmui.showMsgBand("success",I18n.getMsg("crm.appointments.edit.success.msg",$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Appointments.singular_label)),4e3);else{var g="krp"===Events.createSource?e.appId:e.entityId,h="<a target='_blank' href='"+(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/tab/Appointments/"+g)+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";crmui.showMsgBand("success",I18n.getMsg("crm.appointments.create.success.msg",[$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Appointments.singular_label),h]),4e6)}}else detailView.refreshInWms||Events.showEventSuccessMessage(Events.currentStatus,i,!0,e.entityId);else"undefined"!=typeof detailView&&detailView.refreshInWms||Events.showEventSuccessMessage(Events.currentStatus,i,!1,e.entityId);if("calendar"===Events.createSource||"calendarGlobelAdd"===Events.createSource){var f=e;if(delete Crm.calJSON,f.eventObj||"Appointments"===f.module&&3!==Crm.calPreferences.ACTIVITYTYPE&&1!==Crm.calPreferences.ACTIVITYTYPE&&2!==Crm.calPreferences.ACTIVITYTYPE){var I,C=f.entityId,_=(Events.status,$("#Crm_Events_REPEATTYPE").val()),w=Events.modifyingEvent;I="Appointments"===f.module?Events.getCurrAppointmentjson(f.appointmentObj):Events.getCurrEventjson(),void 0===f.color&&f.eventObj&&(f.eventObj.color=I.color);var y=Events.isEventTimeModified(w,I),M=Events.isEventModified(w,I);if(calView.isMultiUserView){var D=f.userImg;if(D||(D="/nophoto.png"),Events.userImgSrc=D,"dayview"===calView.currCalView?"edit"===Events.currentStatus?M&&Events.handleEvtAddinMulUserDayView(C,w,I):Events.handleEvtAddinMulUserDayView(C,void 0,I):"weekview"===calView.currCalView?"edit"===Events.currentStatus?M&&Events.handleEvtAddinMulUserWeekView(C,w,I):Events.handleEvtAddinMulUserWeekView(C,void 0,I):"edit"===Events.currentStatus?M&&Events.handleEvtAddinMulUserMonthView(C,w,I):Events.handleEvtAddinMulUserMonthView(C,void 0,I),y)Events.closeQuickView();else{Events.eventQuickView(I.activityType,C,void 0,void 0,!0,!1,!1,I.invitedby);var T=$("#dCMU_"+C),R=T.find(".activitesColor");if(f.eventObj)if(R.length>0&&f.eventObj.color)R.css("background-color",f.eventObj.color);else if(f.eventObj.color){var A='<span class="activitesColor act_mul_week" data-zcqa="weekViewcolor_'+$ESAPI.encoder().encodeForHTML(f.eventObj.title)+'" style="background:'+f.eventObj.color+'"></span>';T.append(A)}else!f.eventObj.color&&R.length>0&&R.remove()}"Appointments"===f.module&&Lyte.registeredMixins["crm-services-appointments-old-mixin"].hideAppointment_calendar()}else{var b,S=new Date(I.start),N=new Date(I.end);b="Appointments"===f.module?f.appointmentObj:f.eventObj,1==I.allday&&(S=new Date(S),N=new Date(Utils.getDateInUserDatePattern(N)),N=new Date(N.getTime()+86399998),b.durationEditable=!1),"monthview"===calView.currCalView&&(calView.needRefresh=Events.isRefreshNeeded(w,b,"edit"===Events.currentStatus));var P=Events.currentStatus;if(w&&w.host+""==b.ownerId+""&&(calView.needRefresh=!0),_&&"none"!==_)calView.needRefresh=!0;else if("edit"===P&&Events.currentEventObjectInQV&&"true"===Events.currentEventObjectInQV.isRecEvent)calView.refresh(y,Events.currentEventObjectInQV.id);else{if("edit"===Events.currentStatus){if(M&&(w.host+""!=b.ownerId+""&&Events.closeQuickView(),calView.needRefresh=!0),y?Events.closeQuickView():Events.eventQuickView(b.activityType,C,void 0,void 0,!0,!1,!1,I.invitedby),"calendar"===Events.createSource&&"monthview"===calView.currCalView&&Events.currentEventObjectInQV){var L=Events.currentEventObjectInQV.scrollTop;L&&setTimeout((function(){$L(window).scrollTop(L)}),0)}}else"edit"!==Events.currentStatus&&b.ownerId.toString()===calView.currCalSelusr&&(calView.needRefresh=!0);"Appointments"===f.module&&Lyte.registeredMixins["crm-services-appointments-old-mixin"].hideAppointment_calendar()}calView.needRefresh&&calView.refresh()}}}else if("listview"==Events.createSource){Crm.latestEntId=e.entityId,"Appointments"===Events.moduleName&&($("#appointmentCreationInnerDiv").empty(),crmui.hidePopup("appointmentCreate"));var k=Lyte.Router.getRouteInstance();"crm.tab.module.custom-view.kanban"===k.transition.target&&"Events"!==Events.moduleName||k.refresh()}else if("detailView"==Events.createSource)!Crm.isHeadless&&detailView.refreshInWms?detailView.hideElementsForKafkaWorkFlow("Events"):"Appointments"===Events.moduleName?($("#appointmentCreationInnerDiv").empty(),crmui.hidePopup("appointmentCreate"),Lyte.Router.getRouteInstance().refresh()):Crm.renderDVLyteFlow("Events")&&"detail"===Lyte.Router.getRouteInstance().routeName?Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView():reloadCurrentEntityView(e.entityId,"Events");else if("relatedlist"==Events.createSource||"rightpannel"==Events.createSource||"relatedlist_new"==Events.createSource||"relatedlist_meetnow"==Events.createSource||"nbx"===Events.createSource){try{var U=document.querySelector("crm-nba-detail-page");"nbx"===Events.createSource&&U&&(U.component.updateSuggestionFollowUp(),Events.createSource="relatedlist_new")}catch(e){murphy.error(e)}var O=document.getElementById("iskanbanview");if(!O||"true"!=O.value){getElemById("relatedPageContent");var V=detailView.currentModule;V||(V=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]);var x="undefined"==typeof entityId?$("#entityId").val():"object"==typeof entityId?$(entityId).val():entityId;"relatedlist_new"==Events.createSource||"relatedlist_meetnow"==Events.createSource?setTimeout((function(){if(crmui.hidePopup("appointmentCreate"),Crm.userDetails.isRelatedListLyteEnabled)"Appointments"===e.module&&Lyte.Globals.get("relatedList.oldAppointments")&&Lyte.triggerEvent("appointmentsReload",{}),Lyte.triggerEvent("relatedList",{module:e.module,refresh:!0});else{var t={module:V,id:x,fromIndex:1};crmRelatedList.ajaxReq(t,void 0,!1,{action:"refresh"}),"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{refresh:!0})}if(refreshFollowDiv(V,"Events"),"relatedlist_meetnow"==Events.createSource)if(e.meetingStartUrl){var n=I18n.getMsg("crm.label.popup.blocker.msg.startmeeting.new",Crm.appName)+" <a target='_blank' onclick='hideAnimatePopup('custom_alert_popup')' href='"+e.meetingStartUrl+"' rel='noopener noreferrer'>"+I18n.getMsg("crm.event.start.meeting")+"</a>";networkUtils.openUrlwithpopBlockerHandle(e.meetingStartUrl,n)}else if("TeamVMeeting"==e.meetingToolName){n=I18n.getMsg("crm.label.popup.blocker.msg.startmeeting.new",Crm.appName)+" <a target='_blank' onclick='hideAnimatePopup('custom_alert_popup')' href='"+RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"' rel='noopener noreferrer'>"+I18n.getMsg("crm.event.start.meeting")+"</a>";window.location="teamviewer8://",setTimeout((function(){networkUtils.openUrlwithpopBlockerHandle(RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"",n)}),5e3)}else{(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=startMeeting&toolName="+e.meetingToolName+"&meetingid="+e.meetingid+"&eventId="+e.entityId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){networkUtils.openUrlwithpopBlockerHandle(e)}})}}),1e3):Crm.userDetails.isRelatedListLyteEnabled?(refreshFollowDiv(V,"Events"),Events.createSource=void 0,Lyte.triggerEvent("relatedList",{res:e})):$.ajax({url:Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&module="+getObj("module").value+"&id="+x,type:"POST",success:function(t){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e,!0),refreshFollowDiv(V,"Events"),Events.createSource=void 0,"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{res:e})}})}}else if("homePage"==Events.createSource){if("Appointments"===e.module){var B=$("#applayoutId").html();return void(B&&$("#datafetchdate_"+B)[0].click())}var F=getElemById("show");$(F).empty(),$(F)[0].innerHTML=e,EvalInnerScript(F)}else if("krp"===Events.createSource)$$rightPanel.refreshOnCreatingNewEntity("Activities",e);else if("act_dashboard_comp"===Events.createSource){var H=$L("crm-activity-component")[0].component;H.replaceDataInRecordContainer.bind(H)(e.entityId,e.module,!0)}Events.closeEntity()}if(this.currentStatus=void 0,Crm.isHeadless)if(t)WindowsCommunicator.notifyParent("cancel-operation");else{var j=new BasicEntityInfo(Events.moduleName,e.entityId,e.name);WindowsCommunicator.notifyParent("crm-followup-create",j)}}),t,!1,void 0,!1,void 0,void 0,a,r),setTimeout((function(){var e=$("#checkDuplicateEvent");$("#errorMsg_Crm_Events_ENDDATETIME").is(":visible")?e.addClass("pT15"):e.removeClass("pT15")}),500),Events.movePVInitialvalue(),Events.closeOnboarding(),($("#provNotEnabledAlert").length||$("#provNotAuthorisedAlert").length)&&s.attr("disabled","disabled")}},showMeetingErrorMsg:function(){var e={},t="Administrator"==Crm.userDetails.PROFILE_NAME;e.isOrgAdmin=t,e.crmAppName=Crm.appName,e.brandName=Crm.defaultBrandName;var n=$(Handlebars.templates.eventMeetingErrorPop(e));$("body").append(n),renderingUtils.dummyBackground(!1,"meetingBuy"),mailsetCenter("meetingBuy")},showEventSuccessMessage:function(e,t,n,i){if("edit"!=e){if("callPopup"!==t){var a=RebrandLinkUtil.getProperty("CRMURL");window.isSandboxAcc&&"true"==window.isSandboxAcc&&(a=RebrandLinkUtil.getProperty("SANDBOXURL"));var r="<a target='_blank' href='"+(Crm.isActivitySplitDone?RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+a+Crm.getCrmBasePath()+"/tab/Events/"+i:RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+a+Crm.getCrmBasePath()+"/tab/Activities/"+i+"?sub_module=Events")+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";$L(".ziaCallAnalyticswrapper").length&&CrmEmailInitialize&&CrmEmailInitialize.ComposeMailData&&CrmEmailInitialize.ComposeMailData.features_available.activity_suggestions&&(r=""),crmui.showMsgBand("success",I18n.getMsg("crm.event.create.success.msg.viewdetails",[r,Events.getModuleName(!0,!0,!0)]),4e3),$("#qCreate").hasClass("ziaForEmailsCheck")&&validation.updateEventCreatedInfo();var s=$("#upcoming");n&&s&&s.hasClass("liselected")&&s.click()}}else crmui.showMsgBand("success",I18n.getMsg("crm.event.edit.success.msg",[Events.getModuleName(!0,!0,!0)]),4e3)},showEventRelatedToOptions:function(e,t,n,i){var a=$("#addpartCheck"),r=$("#Crm_Events_CONTACTID"),s=$("#Crm_Events_SEID");if(e){var o=$("#Crm_Events_SEID_label");o.removeClass("newmandatory"),$("#errorMsg_Crm_Events_CONTACTID").remove(),$("#errorMsg_Crm_Events_SEID").remove(),r.removeClass("errorHighlight").css({"border-color":""});var l=$(e).val();if("Others"==l)r.closest("div").parents("div").eq(0).hide(),s.closest("div").parents("div").eq(0).css("display",""),r.data("id","").val(""),o.addClass("newmandatory");else if("Leads"==l){r.closest("div").parents("div").eq(0).css("display",""),$("#Crm_Events_CONTACTID_img").data("lookupModule",l).show(),r.data("lookupModule",l),crmTab.tabList.contains(l)||$("#Crm_Events_CONTACTID_img").hide(),s.closest("div").parents("div").eq(0).hide();var d=Crm.moduleInfo[l].translatedSingularLabel;if($("#Crm_Events_CONTACTID_labSpan").text(d),t){var c=Crm.moduleInfo[l].singularLabel;r.val("").data("id","").data("displaylabel",c),s.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts")}}else if("Contacts"==l){d=Crm.moduleInfo[l].translatedSingularLabel;$("#Crm_Events_CONTACTID_labSpan").text(I18n.getMsg(d)),r.closest("div").parents("div").eq(0).css("display",""),$("#Crm_Events_CONTACTID_img").data("lookupModule",l).show(),r.data("lookupModule",l),crmTab.tabList.contains(l)||$("#Crm_Events_CONTACTID_img").hide();var v=$("#subvalue_ACCOUNTID");if(("relatedlist_new"===Events.createSource||"relatedlist_meetnow"===Events.createSource)&&void 0!==v.html()&&""!==v.html()&&"true"===Crm.moduleInfo.Accounts.isVisible&&void 0!==v.data("params"))if(""!=v.text()){var m=v.data("params").module;"false"==Crm.moduleInfo[m].isVisible&&""!=m&&($("#Crm_Events_SEID_label_select").append("<option value="+m+">"+m+"</option>"),$("#Crm_Events_SEID_label_select").val(m),$("select[name='property(modsel)'] option[value='"+m+"']").prop("selected",!0))}else"true"!=Crm.moduleInfo.Accounts.isVisible&&$("#Events_fldRow_SEID").remove();if(s.closest("div").parents("div").eq(0).css("display",""),t){c=Crm.moduleInfo[l].singularLabel;r.val("").data("id","").data("displaylabel",c)}if("krp"==Events.createSource&&null==typeof requestFromEmailClient){var u=returnJson.entityMapJson.SEID.defaultid;u&&"null"!=u&&(s.val(returnJson.entityMapJson.SEID.defaultvalue),s.data("id",u))}}else r.closest("div").parents("div").eq(0).hide(),s.closest("div").parents("div").eq(0).hide(),s.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts"),r.val("").data("id","");if("Contacts"!=l&&"Leads"!=l&&a.hide(),"Contacts"==l||"Leads"==l){var p=r.data("id")+"";(I=$("#addpartCheckbox")).attr("module",l),I.attr("onclick","Events.addRelatedParticipant($(this),'"+p+"','"+l+"')");var E=[r.val()],g=I18n.getMsg("crm.event.add.contact",E);$("#addpartCheckboxTitle").text(g),0==$("#Events_fldRow_PARTICIPANTID").length&&a.hide(),"relatedlist_meetnow"==Events.createSource&&($("#showMoreFiledsLink").remove(),$("#saveEventsBtn").val(I18n.getMsg("crm.event.start.meeting")),($("#btn_send_mail").length>0||$("#social_dmm_group").length>0||"canvas"===Lyte.Router.getRouteInstance().routeName)&&(I.prop("checked",!0),Events.addRelatedParticipant(I,p,l)),a.hide())}else if(!l&&("relatedlist_meetnow"==Events.createSource||Events.scheduleOnlineEvent)){if($("#showMoreFiledsLink").remove(),"relatedlist_meetnow"==Events.createSource&&$("#saveEventsBtn").val(I18n.getMsg("crm.event.start.meeting")),$("#social_dmm_group").length>0||"canvas"===Lyte.Router.getRouteInstance().routeName){var h=$("#id").val(),f=$("#module").val(),I=$("<input id='addpartCheckbox' style='display:none' recId='"+h+"' module= '"+f+"' type='checkbox' checked />");$("body").append(I),Events.addRelatedParticipant(I,h,f)}Events.scheduleOnlineEvent=!1}}else r.closest("div").parents("div").eq(0).hide(),s.closest("div").parents("div").eq(0).hide(),s.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts"),r.val("").data("id","");if(t){var C=r.data(),_=C.lookupModule;if(_===e.value&&(r.val(C.oldValue),r.data("id",C.oldId)),(C=s.data())&&(_=C.lookupModule)===$("#Crm_Events_SEID_label_select").val()){s.val(C.oldValue).data("id",C.oldId);c=Crm.moduleInfo[_].singularLabel;s.data("displaylabel",c)}a.hide()}s.length>0&&s.attr({"data-selectedlookupvalue":s.val(),"data-selectedid":s.data().id}),r.length>0&&r.attr({"data-selectedlookupvalue":r.val(),"data-selectedid":r.data().id}),thirdPartyUtils.bindSelect2($("#Crm_Events_SEID_label_select")),Events.invitationLimitValidation(!0,void 0,void 0,t?"onChange":void 0,n)},constructRecurringEnd:function(e,t){var n={colname:"RECURRING_END_NEVER",customfield:"false",displaylabel:I18n.getMsg("Ends"),val:[{html:I18n.getMsg("crm.databackup.backupends.none"),value:"1"}],label:"endRadioOption",mandate:"true",maxlength:"120",readonly:"false",type:"radio",uitype:"17",defaultvalue:"1"},i=crmTemplate.createFieldRow(1,"Events",i,n);e.append(i),n={colname:"RECURRING_END_NOOFTIMES",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.recurring.after.times"),value:"2"}],label:"endRadioOption",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_REPEAT_COUNT",customfield:"false",defaultvalue:1,displaylabel:"",label:"repeatEndCount",mandate:"false",maxlength:"2",readonly:"false",type:"int",uitype:"32"}]},i=crmTemplate.createFieldRow(1,"Events",i,n),$(i).attr("height","5px"),e.append(i);var a=new Date;"daily"===t?a.setDate(a.getDate()+1):"monthly"===t?a.setMonth(a.getMonth()+1):"weekly"===t?a.setDate(a.getDate()+7):a.setYear(a.getFullYear()+1),n={colname:"RECURRING_END_ON",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.recurring.end.date.on"),value:"3"}],label:"endRadioOption",false:"true",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_END_DATE",defaultvalue:a,customfield:"false",displaylabel:"",label:"repeatEndDate",mandate:"false",maxlength:"120",readonly:"false",type:"date",uitype:"24"}]},i=crmTemplate.createFieldRow(1,"Events",i,n),$(i).attr("height","5px"),e.append(i)},showPeriodDetails:function(e){var t=e.value,n=$("#Events_fldRow_REPEATTYPE");n.nextAll().remove();var i=$(document.createDocumentFragment());switch(t){case"none":break;case"custom":var a={colname:"RECURRING_FREQUENCY",customfield:"false",displaylabel:I18n.getMsg("crm.calendar.freq"),val:[{html:I18n.getMsg("Daily"),value:"daily",attr:{repeatLab:"crm.recurring.no.days"}},{html:I18n.getMsg("Weekly"),value:"weekly",attr:{repeatLab:"crm.recurring.no.weeks"}},{html:I18n.getMsg("Monthly"),value:"monthly",attr:{repeatLab:"crm.recurring.no.months"}},{html:I18n.getMsg("Yearly"),value:"yearly",attr:{repeatLab:"crm.recurring.no.years"}}],label:"period",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},r=crmTemplate.createFieldRow(1,"Events",r,a);$(r).insertAfter(n),n=r,recDropDown=$(n).find("select").eq(0),Events.showFrequencyDetails(recDropDown);break;case"daily":Events.createEditJson.isBusinessHoursCreated&&(a={colname:"EXCEPT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.except.week.holidays"),value:undefined}],label:"exceptHoliday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r)),"daily"==t&&this.constructRecurringEnd(i,t),i.insertAfter(n);break;case"weekly":case"yearly":case"monthly":this.constructRecurringEnd(i,t),a={colname:"RECURRING_INVITATIONMAIL",customfield:"false",displaylabel:" ",val:[{value:I18n.getMsg("crm.event.recurring.turnon.msg",[Events.getModuleName(!1,!1,!0)]),html:I18n.getMsg("crm.event.invitation.mail",[Events.getModuleName(!0,!1,!0)])}],label:"invitationMail",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r),i.insertAfter(n)}},showFrequencyDetails:function(e){var t=$("#Events_fldRow_RECURRING_FREQUENCY");t.nextAll().remove();var n=e.val(),i=$(document.createDocumentFragment());switch(n){case"daily":case"weekly":case"monthly":case"yearly":var a={colname:"RECURRING_PERIODS_NO",customfield:"false",displaylabel:I18n.getMsg("crm.databackup.repeat.every"),val:I18n.getMsg({daily:"crm.recurring.no.days",weekly:"crm.recurring.no.weeks",monthly:"crm.recurring.no.months",yearly:"crm.recurring.no.years"}[n]),label:"daily11",mandate:"false",maxlength:"120",readonly:"false",type:"text",uitype:"60",dynamicFields:[{colname:"RECURRING_CUSTOM_PERIODS_COUNT",defaultvalue:"1",customfield:"false",displaylabel:"",label:"repeatEveryCnt",mandate:"true",maxlength:"2",readonly:"false",type:"int",uitype:"32"}]},r=crmTemplate.createFieldRow(1,"Events",r,a);if(i.append(r),"daily"==n&&Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated){a={colname:"EXCEPT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.except.week.holidays"),value:"true"}],label:"exceptHoliday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0};r=crmTemplate.createFieldRow(1,"Events",r,a);i.append(r)}if("weekly"==n)a={colname:"RECURRING_CUSTOM_WEEK_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.week.repeat.on"),val:this.weekDaysDropdownObj,label:"selectedWeekDays",mandate:"true",maxlength:"120",readonly:"false",type:"multipicklist",uitype:"100"},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r);else if("monthly"==n){a={colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.week.repeat.on"),val:[{html:I18n.getMsg("crm.recurring.custom.day.choose"),value:"1"}],label:"monthlyhidden",mandate:"true",defaultvalue:"1",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY",customfield:"false",displaylabel:I18n.getMsg("crm.calendar.freq"),val:this.recDateArrray,label:"monthly1select",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]};r=crmTemplate.createFieldRow(1,"Events",r,a);if(i.append(r),Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated){a={colname:"NEXT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.next.business.holiday",[Events.getModuleName(!1,!1,!0)]),value:"true"}],label:"exceptBus_Holiday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0};r=crmTemplate.createFieldRow(1,"Events",r,a)}i.append(r),a={colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON_1",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.common.two.dynamic.value"),value:"2"}],label:"monthlyhidden",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_CUSTOM_OCCUR_FIRST",customfield:"false",displaylabel:"",val:Events.numberStringArray,label:"weeksequence",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},{colname:"RECURRING_CUSTOM_OCCUR_DAY",customfield:"false",displaylabel:"",val:this.weekDaysDropdownObj,label:"weekdays",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]};r=crmTemplate.createFieldRow(1,"Events",r,a);i.append(r)}else if("yearly"==n){for(var s=$("#Crm_Events_STARTDATETIME").data("dateObj"),o=Utils.getMonthEnd(s.getMonth(),s.getFullYear()),l=crmConstants.dateArray.slice(0),d=l.length-1;d>0&&o!==l[d];d--)l.splice(d,1);var c=crmCalendar.monthName[s.getMonth()].html;a={colname:"RECURRING_CUSTOM_YEAR_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.custom.yearly.repeat.on",I18n.getMsg([c])),val:[I18n.getMsg("crm.common.two.dynamic.value")],label:"daily11",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"60",dynamicFields:[{colname:"RECURRING_CUSTOM_YEAR_REPEAT_FIRST",customfield:"false",displaylabel:"",val:Events.numberStringArrayWidthDay,label:"weeksequence1",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},{colname:"RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE",customfield:"false",displaylabel:"",val:l,label:"yearlydays1select",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r),Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated&&(a={colname:"NEXT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.next.business.holiday",[Events.getModuleName(!1,!1,!0)]),value:"true"}],label:"exceptBus_Holiday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r))}default:this.constructRecurringEnd(i,n),"daily"!=n&&(a={colname:"RECURRING_INVITATIONMAIL",customfield:"false",displaylabel:" ",val:[{value:I18n.getMsg("crm.event.recurring.turnon.msg",[Events.getModuleName(!1,!1,!0)]),html:I18n.getMsg("crm.event.invitation.mail",[Events.getModuleName(!0,!1,!0)])}],label:"InvitationMail",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,a),i.append(r))}$L("#eventRecurringInnerDiv").scrollTo($L("#Crm_Events_RECURRING_FREQUENCY"),{duration:300}),i.insertAfter(t),thirdPartyUtils.bindSelect2("#Crm_Events_RECURRING_FREQUENCY"),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST")),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY")),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST")),"weekly"==n&&thirdPartyUtils.bindSelect2("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON")},createFieldLabel:function(e,t){if("setup"==this.currentStatus)t&&t.attr({align:"right",class:"bord"});else{var n="Crm_"+this.moduleName+"_"+e.colname;if(n=n.replace(/ /g,"_"),t){if(t.removeAttr("align"),t.removeAttr("nowrap"),t.attr({class:"labelTabCreate pL5"}),e.isSystemMandate&&"true"==e.isSystemMandate&&t.find("sup").remove(),4==e.uitype&&"Who Id"==e.label){var i=$("<span>",{id:n+"_labSpan"});i.text(I18n.getMsg(e.lookupmodule)),t.html(i),t.attr("class","labelTabCreate pL5")}"true"==e.mandate&&t.closest(".labelTabCreate").addClass("newmandatory")}}return t},createFieldContent:function(e,t){if(t.attr("align","left"),"setup"==this.currentStatus)e.defaultvalue="","SMOWNERID"===e.colname&&t.find(".customSel").css({cursor:"move","pointer-events":"none"});else{t.removeAttr("align"),t.attr("class","labelValCreate"),4==e.uitype&&t.find("input").width("160px");var n=e.uitype,i=e.colname;if("RECURRING_END_NEVER"===i||"RECURRING_END_NOOFTIMES"===i||"RECURRING_END_ON"===i)t.find("input").click((function(){$(this).data("dynamicFields");for(var e=$(this).attr("id"),t=$("input[name='"+$(this).attr("name")+"']"),n=0;n<t.length;n++){var i=$(t[n]),a=i.data("dynamicFields"),r=i.attr("id")==e?"true":"false";if(i.data("mandate",r),a&&a.length)for(j=0;j<a.length;j++){var s=$("#Crm_Events_"+a[j].colname);if(s.data("mandate",r),"false"==r){var o=s.data("oldValue");"24"===s.data("uitype")&&(o=Utils.getDateInUserDatePattern(new Date(o))),s.val(o)}}}}));else if("RECURRING_CUSTOM_WEEK_REPEAT_ON"==i)t.find("select").attr({"data-placeholder":I18n.getMsg("None"),style:"width:180px;"});else if("RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY"==i||"RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE"==i){t.find(".newSelect").css({"min-width":"inherit"})}else if("RECURRING_END_NOOFTIMES"==i||"RECURRING_INVITATIONMAIL"==i||"EXCEPT_HOLIDAY"==i||"RECURRING_END_ON"==i||"RECURRING_PERIODS_NO"==i||"RECURRING_CUSTOM_MONTH_REPEAT_ON"==i||"RECURRING_CUSTOM_MONTH_REPEAT_ON_1"===i||"RECURRING_CUSTOM_YEAR_REPEAT_ON"==i){var a=$("<span>");a.append(t.contents()),t.html(a),"EXCEPT_HOLIDAY"===i&&t.css({"padding-top":"0"})}else if("RECURRING_REPEAT_COUNT"==i||"RECURRING_CUSTOM_PERIODS_COUNT"==i){var r=t.find("input[type='text']");r.removeAttr("style"),r.attr("class","textField w20 vaM"),"RECURRING_CUSTOM_PERIODS_COUNT"===i&&r.css({"margin-right":"5px"})}else if("RECURRING_END_DATE"==i){var s=t.find("input[type='text']");s.removeAttr("style"),s.attr("class","textField recurringEndDateField")}else if("RECURRING_CUSTOM_YEAR_REPEAT_FIRST"==i){t.find(".newSelect").css({"min-width":"inherit"}),t.find("select").first().change((function(){"Day"==$(this).val()?($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(crmConstants.dateArray).innerHTML).data().name="yearlydays1select",$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").data.name="yearmonths",$(".NEXT_BUSINESS_HOLIDAY").removeClass("dN")):($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(Events.weekDaysDropdownObj).innerHTML).data().name="weekdays1",$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").data.name="yearmonths1",$(".NEXT_BUSINESS_HOLIDAY").addClass("dN"),$("#Crm_Events_NEXT_BUSINESS_HOLIDAY_0").prop("checked",!1))}))}else"RECURRING_CUSTOM_YEAR_REPEAT_MONTH"===i?t.find(".newSelect").css({"min-width":"inherit","margin-left":"5px"}):"ALLDAYEVENT"==i?t.find("input").css("margin-top","0px"):"RECURRING_CUSTOM_OCCUR_FIRST"==i?(t.find(".newSelect").css({"min-width":"inherit"}),t.find("select").change((function(){var e;e="5"==$(this).val()?renderingUtils.createSelectBox(Events.weekDaysDropdownObj_lastDay):renderingUtils.createSelectBox(Events.weekDaysDropdownObj);var t=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY"),n=t.val();t.html($(e).html()),t.val(n)}))):"RECURRING_CUSTOM_OCCUR_DAY"===i?t.find(".newSelect").css({"min-width":"inherit"}):"STARTDATETIME"!=i&&"ENDDATETIME"!=i||(t.find("input[type='text']").removeAttr("style"),t.find("input[type='text']")[0].setAttribute("style","width:110px;"),t.find("input[type='text']")[1].setAttribute("style","width: 80px; margin-left: 10px;"))}if(123!=n||"create"!==Events.currentStatus&&"clone"!==Events.currentStatus&&"setup"!==Events.currentStatus){if(41===n||"41"===n){var o=(2===crmTemplate.isApproved||3===crmTemplate.isApproved)&&crmTemplate.record_modification&&crmTemplate.record_modification.length>0&&!crmTemplate.record_modification.contains(e.colname)?" disable":"",l=$("<span>").addClass("rec vaM p0"),d="setup"===this.currentStatus?"Crm_Events_setup_"+e.colname:"Crm_Events_"+e.colname;l.attr("id",d),l.attr({"data-zcqa":d}),l.css({"white-space":"normal",display:"inline-block","min-width":"70px","max-width":"140px"}),l.html(I18n.getMsg("None")),l.data({mandate:e.mandate,colname:e.colname,uitype:e.uitype,name:e.label,maxlength:e.maxlength,customfield:e.customfield});v=$("<a>").attr({href:"javascript:void(0)"}).attr({"data-zcqa":"Lookup_event_addparticipant"}).addClass("createlink p0"+o).html(I18n.getMsg("crm.button.add"));"setup"!=this.currentStatus&&v[0].setAttribute("onclick","Events.showAddParticipants()"),t.html(l),null==Events.createEditJson.sourceid&&t.append(v)}else if("LOCATION"===i){var c=t.children("input")[0];"relatedlist_new"==Events.evtCreateFrom||"nbx"===Events.evtCreateFrom?(t.children("input").attr("onfocus","detailView.setEventLocation($('#Crm_Events_CONTACTID_select').val())"),t.children("input").attr("onblur","Events.hideLocationPop();"),t.attr("onclick","detailView.setEventLocation($('#Crm_Events_CONTACTID_select').val())"),c["aria-label"]=c["data-displayValue"],c["aria-valuemax"]=c.maxlenght,c["aria-placeholder"]=c.placeholder):(t.children("input").attr("onfocus","Events.setLocation($('#Crm_Events_CONTACTID_select').val());sE(event)"),t.children("input").attr("onblur","Events.hideLocationPop();"),t.attr("onclick","Events.setLocation($('#Crm_Events_CONTACTID_select').val())"),c["aria-label"]=c["data-displayValue"],c["aria-valuemax"]=c.maxlenght,c["aria-placeholder"]=c.placeholder),t.find("input[type='text']").attr("autocomplete","off")}}else{var v,m=$("<span>").addClass("rec vaM p0"),u="setup"===this.currentStatus?"Crm_Events_setup_"+e.colname:"Crm_Events_"+e.colname;m.attr({id:u}),m.attr({"data-zcqa":u}),m.css({"white-space":"normal",display:"inline-block","min-width":"70px","max-width":"190px"}),m.html(I18n.getMsg("None")),m.data({mandate:e.mandate,colname:e.colname,uitype:n,name:e.label,maxlength:e.maxlength,customfield:e.customfield}),(v=$("<a>").attr({href:"javascript:void(0)"}).attr({"data-zcqa":"Lookup_event_editparticipant"}).attr({title:I18n.getMsg("crm.label.change")}).addClass("neweditIconSvg")).attr({"aria-label":I18n.getMsg("crm.label.change")}),"setup"!=this.currentStatus&&($(v).click((function(){Events.showRecurringActivity()})),m.click((function(){Events.showRecurringActivity()}))),t.html(m),t.append(v)}2===n&&t.find("select").change(Events.loadColorNearSelect2($(this)));return t},showSelHeaders:function(){var e=["cv","lv","c","l","u","g","r","rs"];for(i=0;i<e.length;i++){var t=$("#invselListTr_"+e[i]),n=t.next();if(n.length>0&&!n.hasClass("invSelListHd")){$L("#selectedInvDiv").find(".ui-list").scrollTo(t);break}}},showRecurringActivity:function(){if(!$("#eventRecurringDiv").is(":visible")){if($("#doneAddParticipantBtn").hide(),getElemById("eventRecurringDiv"))$("#eventRecurringDiv").fadeIn("",(function(){$(this).css({opacity:"1"})}));else{var e=$("<div>",{id:"eventRecurringDiv",class:"eventForm-create",style:"width:100%; padding:20px;margin:0;box-sizing:border-box; display:none; left: 395px"}),t=$("<div>",{id:"eventRecurringInnerDiv",class:"eventForm-ins",style:"height:342px;width:100%;"});e.append($("<div>",{html:I18n.getMsg("crm.workflow.scheduler.repeatRate"),class:"contHeadInfo"})),e.append(t);var n=$("<div>",{id:"recEventTimeInfoDiv"}),i=$("<table>",{border:"0",cellpadding:"0",cellspacing:"0",style:"width:100%;"});i.append("<tbody>"),n.append(i),t.append(n);var a=[{colname:"REPEATTYPE",customfield:"false",displaylabel:I18n.getMsg("Repeat Type"),label:"period",mandate:"false",maxlength:"120",readonly:"false",type:"Pick List",uitype:"42",val:[{html:I18n.getMsg("None"),value:"none"},{html:I18n.getMsg("Daily"),value:"daily"},{html:I18n.getMsg("Weekly"),value:"weekly"},{html:I18n.getMsg("Monthly"),value:"monthly"},{html:I18n.getMsg("Yearly"),value:"yearly"},{html:I18n.getMsg("Custom"),value:"custom"}]}];crmTemplate.createSubFields(this.moduleName,t[0],"recurringInner",a),t.find("#recurringInner").removeAttr("width","100%"),$("#eventCreateContainerDiv ").append(e),e.show(),thirdPartyUtils.bindPerfectScroll("#"+t.attr("id"))}$("#doneRecurringBtn").show();var r=$("#recEventTimeInfoDiv tbody").eq(0);r.prepend($("#Events_fldRow_ENDDATETIME")),r.prepend($("#Events_fldRow_STARTDATETIME")),r.prepend($("#Events_fldRow_ALLDAYEVENT")),$("#saveEventsBtn, #cancelEventBtn, #doneAddParticipantBtn").hide(),setTimeout((function(){$("#eventCreationDiv").css({left:"-100%",opacity:"0"}),$("#eventRecurringDiv").css({left:"0%",opacity:"1"})}),1),thirdPartyUtils.bindSelect2($("#eventRecurringDiv").find("select")),$("#showMoreFiledsLink").hide()}},doneRecCallBack:function(){var e=$("#Events_fldRow_LOCATION");e.after($("#Events_fldRow_ENDDATETIME")),e.after($("#Events_fldRow_STARTDATETIME")),e.after($("#Events_fldRow_ALLDAYEVENT")),e.after($("#CrmEventMeetingInteg")),$("#checkDuplicateEvent").remove(),$("#doneRecurringBtn").hide(),$("#doneAddParticipantBtn").hide(),$("#saveEventsBtn, #cancelEventBtn").show(),$("#eventCreationDiv").css({left:"0%",opacity:"1"}),$("#eventRecurringDiv").css({left:"100%",opacity:"0"}),this.addMoreDetailsClicked||$("#showMoreFiledsLink").show()},getLastWorkingDay:function(e){var t=e.getMonth(),n=Utils.getMonthEnd(t,e.getFullYear()),i=new Date(e.getTime()),a=0;do{n-=a,i.setDate(n);var r=i.getDay();a++}while(Crm.calPreferences.HOLIDAY1==r||Crm.calPreferences.HOLIDAY2==r);return i},validateRecurringData:function(e,t,n,i){var a,r,s,o,l,d,c=$("#Crm_Events_STARTDATETIME"),v=$("#Crm_Events_ENDDATETIME"),m=1;if(this.isRecEvent){if(this.recVal)switch(e=(S=(t=this.recVal).split("*#"))[0]){case"daily":f=S[3].split("^")[1],g=S[4];break;case"weekly":f=S[2].split("^")[1],a=S[3].split("^^");case"monthly":1===(r=parseInt(S[1]))?(s=S[4],g=S[5]):(l=S[4],o=S[5],g=S[6]);break;case"yearly":var u;1===(u=S[1])?(d=S[4],b=S[5],g=S[6]):(u=S[4],o=S[5],d=S[6],g=S[7])}if(""===t)return!0}n=n||c.data("dateObj"),i=i||v.data("dateObj");if(!t){var p,E,g,h=parseInt($("input:radio[name='endRadioOption']:checked").val());if(3===h)var f=(p=$("#Crm_Events_RECURRING_END_DATE")).data("dateObj");else 2===h&&(E=$("#Crm_Events_RECURRING_REPEAT_COUNT").val());if((g=$("#Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT"))[0]){if((m=parseInt(g.val()))<1)return!1;g=g[0]}}var I=new Date(n.getTime()),C=i.getTime()-n.getTime();if(E&&E<1||""==E)return!1;switch(e){case"daily":if(g&&(I.setDate(n.getDate()+m),!Utils.compareDateandTime(i,I)))return!1;if(p&&(I.setDate(n.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(n,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,I)))return!1;break;case"weekly":if(g){var _=7;if($("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON")[0]){a||(a=$("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON").val());for(var w=0;w<a.length;w++){var y=a[w+1]-a[w];_=y>0&&y<_?y:_}}if(m=_,I.setDate(n.getDate()+m),!Utils.compareDateandTime(i,I))return!1}if(p&&(I.setDate(n.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(n,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,I)))return!1;break;case"monthly":if(g){if(r||(r=parseInt($("input:radio[name='monthlyhidden']:checked").val())),1==r){s||(s=$("#Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY").val()),n.setDate(s);var M=new Date(n.getTime());M.setTime(M.getTime()+C),this.setStartDateAndTime(n),this.setEndDateAndTime(!1,!1,M)}else if(2==r){if(l||(l=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val()-1),o||(o=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val()-1),-2==o){var D=new Date(n.getTime()),T=Utils.getMonthEnd(n.getMonth(),n.getFullYear());D.setDate(T),o=D.getDay()}else-1==o&&(o=this.getLastWorkingDay(n).getDay());var R=Events.weekOfDay(n,l,o),A=new Date;(Utils.compareDateandTime(R,n)||Utils.compareDateandTime(R,A))&&(n.setMonth(n.getMonth()+1),R=Events.weekOfDay(n,l,o)),n=R,this.setStartDateAndTime(R),this.setEndDateAndTime(!1,!1,new Date(R.getTime()+C))}if(I.setMonth(n.getMonth()+1),!Utils.compareDateandTime(i,I))return!1}if(p&&(I.setDate(n.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(n,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,I)))return!1;break;case"yearly":if(g[0]){if(d||(d=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").val()),u||(u=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST").val()),"Day"==u){var b=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val();(S=new Date).setDate(b),S.setMonth(d),S.getTime()<n.getTime()&&S.setFullYear(S.getFullYear()+1),this.setStartDateAndTime(S),this.setEndDateAndTime(!1,!1,new Date(S.getTime()+C))}else{var S;(S=new Date(n.getTime())).setMonth(d),o||(o=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val()),(S=Events.weekOfDay(S,u,o)).getTime()<n.getTime()&&(S.setFullYear(S.getFullYear()+1),S=Events.weekOfDay(S,u,o)),this.setStartDateAndTime(S),this.setEndDateAndTime(!1,!1,new Date(S.getTime()+C))}if(n=S,I.setFullYear(n.getFullYear()+1),!Utils.compareDateandTime(i,I))return!1}else(p=new Date(n.getTime())).setDate(p.getDate()+365),f||(f=p);if(I.setDate(n.getDate()+crmConstants.recurringEndDateLimit[e]),p&&(!Utils.compareDateandTime(n,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,I)))return!1;break;case"custom":var N=$("#Crm_Events_RECURRING_FREQUENCY").val();return this.validateRecurringData(N)}return!0},processParam:function(e,t){var n={};for(key in e)-1!=t.indexOf(key)&&(n[key]=e[key]);return n},doneRecuring:function(){if(Crm.requestParam&&(Crm.requestParam=this.processParam(Crm.requestParam,["eventCreateFrom","property(EventStatus)"])),!Crm.validateEntityAndShowErrorMsg(this.recurringElemIds,this.moduleName))return!1;var e=$("#Crm_Events_REPEATTYPE").val();if(!this.validateRecurringData(e))return alert("Recurring Validation Failed"),!1;if("none"!=$("#Crm_Events_REPEATTYPE").val()){$("#CrmEventMeetingInteg").hide();var t=$("#Crm_Events_RECURRING_FREQUENCY").val();if("monthly"==t&&"2"==$("input:radio[name='monthlyhidden']:checked").val()){var n=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val(),i=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val();"5"!=n||"0"!=i&&"-1"!=i||(Crm.requestParam.monthlyhidden="1",Crm.requestParam.monthly1select=i)}else"monthly"==t&&"1"==$("input:radio[name='monthlyhidden']:checked").val()&&(Crm.requestParam.monthlyhidden="1");null!=t&&"daily"!=t?Crm.requestParam.nextbusin_holiday=$("#Crm_Events_NEXT_BUSINESS_HOLIDAY_0").is(":checked"):Crm.requestParam.exceptholiday=$("#Crm_Events_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked"),Crm.requestParam.hostId=$("#Crm_Events_SMOWNERID").data("id"),$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do?type=getRecText",data:Crm.requestParam,type:"GET",success:function(e){$("#Crm_Events_RECURRING").html(e),$("#Crm_Events_RECURRING").css({display:"block","margin-right":"0"}),Events.doneRecCallBack()}})}else $("#Crm_Events_RECURRING").html(I18n.getMsg("None")),$("#Crm_Events_RECURRING").css({display:"inline-block","margin-right":"5px"}),delete Crm.requestParam["property(Recurring Activity)"],Events.doneRecCallBack();$("#eventRecurringDiv").fadeOut()},delEventAttachment:function(e,t){hideAnimatePopup("deletepopup");var n=parseInt($("#attachTotCnt").val()),a=$("#"+t),r=t.split("_")[1],s=new getHTTPObject;try{s.open("POST",e,!0),s.onreadystatechange=function(){if(4==s.readyState){if($("#attTotalCnt").text(n-1),$("#attachTotCnt").val(n-1),a.remove(),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&!Crm.userDetails.isRelatedListLyteEnabled)var e=$("#eventsRightPanelAttachDiv"),t=$("#eventsAttachButtonDiv");if(n<=1)1!=Crm.userDetails.detailView_newUI&&$("#eventAttTable").remove(),$("#eventAttachmentDataDiv").remove(),$("#noAttachmentTable").show(),$("#attTotalCnt").closest(".cntSpn").hide(),1!=Crm.userDetails.detailView_newUI||null==Crm.userDetails.detailView_newUI||Crm.userDetails.isRelatedListLyteEnabled||(e.addClass("noDataFountDetail"),t.parent("td").addClass("noDataFountDetailtxt"));else{var o=$("#eventAttachmentDataDiv").find("tr").first().find("td"),l=[];if(o.each((function(){l.push($(this).outerWidth())})),1!=Crm.userDetails.detailView_newUI){var d=$("#eventAttTable").find("td");o.each((function(e){d.eq(e).css("width",l[e])}))}for(i=r+1;i<=n;i++){var c=i-1,v=$("#attTabCnt_"+i);v.attr("id","attTabCnt_"+c),v.find(".slNo").text(c+".")}1!=Crm.userDetails.detailView_newUI||null==Crm.userDetails.detailView_newUI||Crm.userDetails.isRelatedListLyteEnabled||(e.removeClass("noDataFountDetail"),t.parent("td").removeClass("noDataFountDetailtxt"))}}}}catch(e){alert(e)}s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),s.send(csrfParamName+"="+encodeURIComponent(csrfToken))},initEventRightPannel:function(e,t){$("#addAttach").click((function(e){return showPopupMenuOld(this,"addAttOptions","right","bottom",event),!1})),$("#addAttchmentFromDetailMenu").mouseenter((function(e){$("#attachOptionsFromDetailMenu").css({right:$("#eventActionsMenu").outerWidth()-2,top:"50px"}).show(),$("#invStULFromDetailMenu").hide()})),$("#addAttchmentFromDetailMenu").mouseleave((function(e){$("#attachOptionsFromDetailMenu").hide()})),$("#eventActionsMenu").mouseleave((function(e){$("#invStULFromDetailMenu, #eventActionsMenu, #addAttOptions").hide()})),$("#invStatusFromDetailMenu").mouseenter((function(e){$("#invStULFromDetailMenu").css({right:-$("#invStULFromDetailMenu").outerWidth(),top:"60px"}).show()})),$("#invStatusFromDetailMenu").mouseleave((function(e){$("#invStULFromDetailMenu").hide()})),$("#addAttOptions a, .eventActionsMenu a ul li").click((function(){hideMenu()})),$("#invStatusDropdown, #addAttOptions").mouseleave((function(e){$(this).hide()})),$("#statusBtn").click((function(e){return $("#invStatusDropdown").show(),!1})),$("#attachOptionsFromDetailMenu").html($("#addAttOptions").html());var n=$("#eventInvitationStatus").val();$("#invSt_"+n).hide(),$("#invStDet_"+n).addClass("on"),$("#addNoteFromDetailMenu").click((function(e){var t=$("#eventActionsBtn").offset();$("#newNoteDivId").css({top:t.top+40,left:t.left-170}),$("#newNoteDivId").html($("#fullInfoNoteDiv").html()).show(),$("#fullInfoNoteDiv").html(""),Notes.initNote("open"),getElemById("save_comment").setAttribute("onclick","Notes.addNoteFromEventActionMenu($(this).closest('table'))"),getElemById("cancel_comment").setAttribute("onclick","Notes.initNote('close', true)")})),parseInt($("#attachTotCnt").val())<=0?($("#attTotalCnt").closest(".cntSpn").hide(),$("#noAttachmentTable").show()):($("#attTotalCnt").closest(".cntSpn").show(),$("#noAttachmentTable").hide(),$("#eventsRightPanelAttachDiv").removeClass("noDataFountDetail"));var i=$("#internalUserInvDiv");i.length&&($("#right_invUserDetails").prepend(i),$("#internalUserInvDiv").show())},updateInvStatusFromDetails:function(e,t,n,i,a,r){commonUtils.showHideLoadingDiv(!0),i||(i=$("#dvInvRow_invId").val()),$.ajax({url:Crm.getCrmBasePath()+"/events/Invitation.do",type:"POST",data:"eventId="+e+"&type=updateInvStatus&status="+t+"&invId="+i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){if(commonUtils.showHideLoadingDiv(),null!=a){$("#inv"+a).closest("div").remove();var i=parseInt($("#myinvitationCnt").val())-1;$("#inviCnt").html(i),$("#myinvitationCnt").val(i),i<=0&&$(".eventForm-ins-myinv").html("<div align='center'>"+I18n.getMsg("crm.cal.inv.no.invitation")+"</div>")}else if("quickView"===r){$("#qv_myStatusDrpdowp").val(t),$("#qv_invitationRow").show(),$("#qv_statusBtnsDiv").remove(),$("#qv_invDelBtnsDiv").show(),$("#doneBtnForInvitedEvent").show();var s=parseInt($("#myinvitationCnt").val());s<=1&&$("#myInvites").hide(),$("#myinvitationCnt").val(s-1),$("#inviCnt").text(s-1)}else if("qvOnChange"===r)"decline"===t?$("#hideInvitedEventBtn").show():$("#hideInvitedEventBtn").hide();else if("detailNew"===r)Lyte.triggerEvent("detail_view_participant_section");else{$("a[id^='invSt_']").show(),$("li[id^='invStDet_']").removeAttr("class"),$("#statusBtn span").html($("#invSt_"+t).html());var o=$("#eventInvitationStatus").val();n&&($("#buttonTable").hide(),$("#statSpan").show(),$("#invSt_"+t).hide(),$("#invStatusFromDetailMenu").show(),$("#eventInvitationStatus").val(t)),$("#invStDet_"+t).addClass("on"),$("#invSt_"+t).hide(),$("#invStatusDropdown").hide();trimBoth($("#right_invCnt_"+t).html());var l=$("#invCntJsonHid").val();if(""!=l){var d=JSON.parse(l),c=parseInt(d[t])+1;if(d[t]=c,o&&""!==o){var v=parseInt(d[o])-1;d[o]=v}$("#right_invCnt_accept").text(d.accept),$("#right_invCnt_maybe").text(d.maybe),$("#right_invCnt_decline").text(d.decline),$("#right_invCnt_invited").text(d.invited),$("#invCntJsonHid").val(JSON.stringify(d))}$("#eventInvitationStatus").val(t)}}})},cancelEvent:function(e,t,n,i,a,r){if(!n){let n=networkUtils.returnDependencyFiles(["crm-email-auth-util.js"],ResourceConstants.CRMClient);Lyte.injectResources(n,void 0,(function(){Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy()}));var s=$("#deletepopup");return s.find("#deleteButton").hide(),s.find("#dissociatebutton").hide(),$("#warningMsg").html(I18n.getMsg("crm.listview.delete.alert.participant",[Events.getModuleName(!1,!1,!0)])),s.find("#showWarning2").css("display","none"),s.find("#delItemName").text(""),s.find(".evButtons.fromDeletePopup").eq(0).val(I18n.getMsg("crm.button.send")).show().off("click").click((function(n){Events.cancelEvent(e,t,!0,1,a,n),renderingUtils.stopEvent(n),Crm.trackSpotLightAction("Calendar Booking - Booking cancelled, Email Sent")})).removeAttr("data-cid").removeAttr("data-params"),s.find(".evButtons.fromDeletePopup").eq(1).val(I18n.getMsg("crm.button.dont.send")).show().off("click").click((function(n){return Events.cancelEvent(e,t,!0,0,a,n),renderingUtils.stopEvent(n),Crm.trackSpotLightAction("Calendar Booking - Booking cancelled, Email not sent"),!1})).removeAttr("data-cid").removeAttr("data-params"),showAnimatePopup("deletepopup"),!1}void 0===i&&(i=0),i&&Lyte.registeredMixins["crm-email-auth-util"].showPopUpForEventModule()||$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"POST",data:"type=updateEventStatus&newStatus=-1&eventId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&isCancelMailNeeded="+i,success:function(t){if(hideAnimatePopup("deletepopup"),-1==(t=JSON.stringify(t)).indexOf("error"))a?Events.eventQuickView("Events",e,void 0,r,!0):Crm.renderDVLyteFlow("Events")&&"detail"===Lyte.Router.getRouteInstance().routeName?Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView():reloadCurrentEntityView();else if(-1!=t.indexOf("Invalid Refresh Token"))t=JSON.parse(t),Events.eventMeetingReAuthorize(t);else if("NOT_AUTHORIZED"==t.errMsg){var n=res.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[n,res.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(res.toolName,res.hostUserId)}else-1!=t.indexOf("crm.limit.reached")?(t=JSON.parse(t),crmui.showMsgBand("error",I18n.getMsg(t.errMsg),4e3)):t.indexOf("PERMISSION_DENIED")?(hideAnimatePopup("deletepopup"),renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()):alert("failure")},error:function(){hideAnimatePopup("deletepopup"),renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()}})},showMailVerificationAlert:function(){if(!Crm.userDetails.IS_PRIMARY_EMAIL_VERIFIED_IAM){var e=I18n.getMsg("crm.mail.user.not.confirmed.new",[Crm.userDetails.EMAIL,"<a href='"+RebrandLinkUtil.getProperty("SAMPLE_URL")+"/accounts/help/' target='_blank'>"]),t=$L("#shownotes");return t.addClass("newPopup p30"),t.html(e),t[0].style.zIndex=21,t[0].style.width="600px",t[0].style.position="absolute",$L("#shownotes input[type=button]").click((function(){var e=$L("#shownotes");crmui.modalZIndex("nonLyte",e[0],"close"),e.html(""),e.css("display","none")})),t.css("display","block"),mailsetCenter("shownotes"),!0}return!1},SendMailToParticipant:function(e,t,n,i,a){if(!n){Events.loadInvitationConfirmDiv();var r=$("#invitationConfirmDiv"),s=r.find(".msgBody"),o=r.find(".msgTitle"),l=r.find(".send").prop("disabled",!1),d=r.find(".dntSend").prop("disabled",!1),c=r.find(".cancel").prop("disabled",!1);l.val(I18n.getMsg("crm.button.send")),d.val(I18n.getMsg("crm.button.dont.send")).show(),c.hide(),o.html(I18n.getMsg("crm.event.inv.create.alert.msg1")).show(),s.html(I18n.getMsg("crm.event.inv.create.alert.msg2")),l.off("click").click((function(n){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),renderingUtils.removeDummyBackground(),Events.sendNotificationMail=!0,Events.SendMailToParticipant(e,t,!0,i,n),renderingUtils.stopEvent(n))})),d.off("click").click((function(e){return crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),renderingUtils.removeDummyBackground(),Events.sendNotificationMail=!1,!1}));var v=r.attr("id");return mailsetCenter(v),renderingUtils.dummyBackground(!1,v),r.show(),crmui.modalZIndex("nonLyte",r[0],"open"),!1}var m="type=updateEventStatus&newStatus=1&eventId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"POST",data:m,success:function(t){-1==(t=JSON.stringify(t)).indexOf("error")?i?Events.eventQuickView("Events",e,void 0,a,!0):Crm.renderDVLyteFlow("Events")&&"detail"===Lyte.Router.getRouteInstance().routeName?Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView():reloadCurrentEntityView():"crm.limit.reached"===(t=JSON.parse(t)).errMsg?crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(t.errMsg)),4e3):alert("failure")}})},edit:function(e,t,n){var i=n.from;this.addMoreDetailsClicked=!1,this.entityId=e,t.entityId=e,this.currentStatus="edit",Events.evtCreateFrom=i,"Appointments"===n.module&&(this.moduleName=n.module),this.createTemplate(t),this.createSource=i;if(Crm.requestParam.eventCreateFrom=i,Events.eventCreateCBn(i,void 0,void 0,n),"Appointments"!==n.module){var a=$("#Crm_Events_CONTACTID"),r=$("#Crm_Events_SEID"),s=r.data("id");if(s&&"null"!==s||a.data("id")&&"null"!==a.data("id")||$("#Crm_Events_CONTACTID_select").val("None"),"Accounts"==$("#Crm_Events_SEID_label_select").val()&&(Events.relAccId=s+"",Events.relAccName=r.val(),Events.relAccMod=!0),Events.withMeetingTool){var o=new Date,l=o.getDate()<10?"0"+o.getDate():o.getDate(),d=o.getMonth()<10?"0"+(o.getMonth()+1):o.getMonth()+1,c=o.getFullYear();(o=d+"/"+l+"/"+c)==$("#Crm_Events_STARTDATETIME").val()&&$("#Events_fldRow_ALLDAYEVENT").hide(),Events.changeTitleMessageDiv(Events.meetingToolName)}Events.showEventRelatedToOptions($("#Crm_Events_CONTACTID_select"),void 0,!1),($("#moreEventsAllDiv").is(":visible")||$("#showAllEventsDIV").is(":visible"))&&(Events.closeMoreEventsPop(!0),Events.closeQuickView(),Events.closeMoreEventDiv(!0)),Events.modifyingEvent=Events.getCurrEventjson(),Events.modifyingEvent.invMailType=t.invMailType+"",Events.modifyingEvent.status=t.status+"",Events.modifyingEvent.id=e,Events.modifyingEvent.hostName=t.hostName,Events.modifyingEvent.invCnt=t.invCnt,Events.modifyingEvent.invCntJson=t.invCnt,Events.modifyingEvent.sourceid=t.sourceid,Events.pastEventInvCnt=t.invCnt>t.inviteeslimit?t.invCnt:t.inviteeslimit,Events.inviteesLimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit-t.invCnt,Events.formatInvDetailsToFinalIdsJson(t)}},clone:function(e,t,n){var i=$("#eventViewPopup");Crm.requestParam["property(cloneEntityId)"]=e,this.addMoreDetailsClicked=!1,this.currentStatus="clone",t.eventMeetingOnboardingShown&&(Events.eventMeetingOnboardingShown=!0),t.meetingConfZuid&&(Events.meetingConfZuid=t.meetingConfZuid,Events.meetingSiteUrl=t.meetingSiteUrl),this.createTemplate(t),"calendar"===Events.createSource&&$("#eventCreatePopup").addClass("eventCreateCalenderView"),Events.eventCreateCBn(void 0,void 0,void 0,void 0,void 0,{currentEntityId:e}),i.is(":visible")&&(Events.closeMoreEventsPop(!0),Events.closeQuickView(),Events.closeMoreEventDiv(!0));var a,r=$("#Crm_Events_SEID").data("id"),s=$("#Crm_Events_CONTACTID");r&&"null"!==r||s.data("id")&&"null"!==s.data("id")||$("#Crm_Events_CONTACTID_select").val("None"),t.entityMapJson.LOCATION.meetingToolName&&Events.changeTitleMessageDiv(t.entityMapJson.LOCATION.meetingToolName),Events.showEventRelatedToOptions($("#Crm_Events_CONTACTID_select"),void 0,!1),Events.invJsonCreate=t.inviteeJson,Events.cloneEntId=e,Events.pastEventInvCnt=t.invCnt>t.inviteeslimit?t.invCnt:t.inviteeslimit,Events.inviteesLimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit-t.invCnt,n&&(a={inviteeDetails:n}),Events.formatInvDetailsToFinalIdsJson(a);var o=$("#Crm_Events_LOCATION"),l=t.entityMapJson.LOCATION.meetingToolName;Crm.userDetails.MEETING_BRIDGE_ENABLED||(Events.isFutureEvent()?void 0===l&&($("#Events_fldRow_LOCATION").removeClass("disable-events"),o.val(null!=Events.locationValue?Events.locationValue:""),$("#meetingInclude").prop("checked",!1)):($("#CrmEventMeetingInteg").hide(),null!=l?$("#meetingInclude").prop("checked",!0):($("#Events_fldRow_LOCATION").removeClass("disable-events"),o.val(null!=Events.locationValue?Events.locationValue:""),$("#meetingInclude").prop("checked",!1))))},appendEventParams:function(e){if("REPEATTYPE"==e&&"none"!=$("#Crm_Events_REPEATTYPE").val()&&(Crm.requestParam["property(Recurring Activity)"]="on",Crm.requestParam["property(Start Date1)"]=$("#Crm_Events_STARTDATETIME").val(),Crm.requestParam["property(End Date1)"]=$("#Crm_Events_ENDDATETIME").val()),"RECURRING_FREQUENCY"===e&&(Crm.requestParam.mainSelect="custom"),"EXCEPT_HOLIDAY"==e)holDay="Holidays and weekends";else if("daily"==$("#Crm_Events_RECURRING_FREQUENCY").val())"RECURRING_FREQUENCY"==e?(Crm.requestParam.dailyhidden=2,Crm.requestParam.exceptholiday=!!$("#Crm_Events_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked")):"RECURRING_CUSTOM_PERIODS_COUNT"==e&&(Crm.requestParam.daily111=$("#Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT").val());else if("RECURRING_CUSTOM_YEAR_REPEAT_FIRST"==e&&"yearly"==$("#Crm_Events_RECURRING_FREQUENCY").val())"Day"==$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST").val()?Crm.requestParam.yearlyhidden="1":Crm.requestParam.yearlyhidden="2",Crm.requestParam.yearmonths=$("#Crm_Events_STARTDATETIME").data("dateObj").getMonth(),Crm.requestParam.yearmonths1=$("#Crm_Events_STARTDATETIME").data("dateObj").getMonth();else if(!$("#Crm_Events_RECURRING_FREQUENCY").length&&$("#Crm_Events_REPEATTYPE").length){var t=$("#Crm_Events_REPEATTYPE").val();if("REPEATTYPE"==e){var n=new Date($("#Crm_Events_STARTDATETIME").data("dateObj"));Crm.requestParam.repeatEveryCnt=1,"none"!=t&&("daily"==t?Crm.requestParam.dailyhidden=1:"weekly"==t?Crm.requestParam.selectedWeekDays=n.getDay()+1:"monthly"==t?(Crm.requestParam.monthlyhidden=1,Crm.requestParam.monthly1select=n.getDate()):"yearly"==t&&(Crm.requestParam.yearlyhidden=1,Crm.requestParam.yearmonths=n.getMonth(),Crm.requestParam.yearlydays1select=n.getDate()))}}},eventCreateCBn:function(e,t,n,i,a,r){"edit"!==Events.currentStatus&&"calendar"===e?$("#eventViewPopup,#unAvailablePopup").hide():$("#eventViewPopup").is(":visible")&&(Events.currentEventObjectInQV.scrollTop=$L(window).scrollTop()),"clone"==Events.currentStatus&&(Events.showOrHideAllDayEvent(void 0,r?r.currentEntityId:void 0),$("#meetingInclude").prop("checked")&&($("#Events_fldRow_ALLDAYEVENT").hide(),$("#Events_fldRow_RECURRING").hide()));var s=$L("#FreezeLayer"),o=$L(".gSecondarySearch"),l="undefined"!=typeof featuresAvailable&&featuresAvailable.NEXTGENUI_ENABLED&&o&&o.length>0,d=$("#Events_fldRow_REMINDINVITEESAT");if($("#Crm_Events_ALLDAYEVENT").is(":checked")?d.hide():d.show(),Events.createSource=e,t&&"Appointments"!==t){var c=0;if("calendarGlobelAdd"==e?(Events.createSource="calendar",c=300,$("#eventCreatePopup").show()):"rightpannel"!=e&&"krp"!==e||(c=150),"calendar"==e||"relatedlist"===e||"rightpannel"===e||"krp"===e||"crmEmail"===e||"fromMap"===e||"relatedlist_new"==e||"relatedlist_meetnow"==e||"stageView"==e||"nbx"===e)$("#crmEmailOuterContainerDiv").is(":visible")?mailsetCenterNew("eventCreatePopup"):(renderingUtils.positionArrow(t,"eventCreatePopup",n,"eventPopupArrow",a),$("body").addClass("oH"));else if("salessignals"===e)crmNTC.positionEventQcreatePopup(t),renderingUtils.positionArrow(t,"eventCreatePopup",n,"eventPopupArrow",a),$("body").addClass("oH");else{var v=$(t).offset(),m=t.offsetWidth,u=t.offsetHeight;$("#eventCreatePopup").css({top:v.top+u+10,left:v.left-m-c});var p=$("#eventCreatePopup").offset();$("#eventPopupArrow").css({top:"",left:v.left-p.left+m/4}).attr("class","arrwTop")}$("#eventPopupArrow").show(),renderingUtils.freezeBackground(),crmui.adjustFreezeLayer(crmui.zIndex),$("#FreezeLayer").css("opacity",.2),"edit"===Events.currentStatus&&l&&s.length>0&&s.css({"z-index":"22"})}else PopSetCenter("eventCreatePopup"),Crm.isHeadless||(renderingUtils.freezeBackground(),crmui.adjustFreezeLayer(crmui.zIndex)),"edit"===Events.currentStatus&&l&&s.length>0&&s.css({"z-index":"22"}),"clone"===Events.currentStatus&&$("#eventCreatePopup").css({position:"absolute",top:"0%",left:"0",right:"0",margin:"0 auto"}),$("#eventPopupArrow").hide();if("edit"===Events.currentStatus||this.addMoreDetailsClicked?$("#showMoreFiledsLink").hide():$("#showMoreFiledsLink").show(),$(".ziaCallAnalyticswrapper").length&&(e="relatedlist_new"),("relatedlist"===e||"relatedlist_new"==e||"relatedlist_meetnow"==e||"rightpannel"===e||"krp"===e||"fromMap"===e||"listview"===e||"stageView"===e||"salessignals"===e||"nbx"===e)&&"create"===this.currentStatus||"call_popup"===e){var E=$("#Crm_Events_CONTACTID_select"),g=$("#Crm_Events_CONTACTID"),h=getObj("module")?getObj("module").value:null;h="krp"===e?$$rightPanel.currentModule:h;var f=$("#entityName");"salessignals"===e&&(h=$("#ss_module").val());var I,C,_,w,y="krp"===e?$$rightPanel.entityId:$("#entityId").val();r&&r.id&&(h=r.record_module?r.record_module:h,y=r.id?r.id:y,q=r.name);var M=Lyte.Router.getRouteInstance(),D="krp"===e?moduleApiMapping.Events:h,T=void 0!==M&&Crm.renderDVLyteFlow(D)&&"crm.tab.module.entity.detail"===M.transition.target;if(T)(F=store.peekRecord(moduleRecordMapping[h].id,y))&&F.Account_Name&&(I=F.Account_Name.id,C=F.Account_Name.name),F&&F.Contact_Name&&(_=F.Contact_Name.id,w=F.Contact_Name.name);if("salessignals"==e&&(y=$("#ss_entityId").val()),"stageView"==e)if(t&&-1!==t.id.indexOf("_create_meetings"))(j=$L("crm-inner-list")[0])&&(y=j.component.data.recordObjForQuickAction.id);else y=$(t).attr("data-relid");else"call_popup"===e&&(h=$("#Ctiapi_entityModule").attr("value"),y=$("#Ctiapi_entityId").attr("value"));if("object"==typeof y&&(y=$(y).val()),null!=h){E.val(h);var R=$("#associatedContName");if("relatedlist_new"!==e&&"relatedlist_meetnow"!==e||"Accounts"!==h||(Events.relAccName=f.val(),Events.relAccId=$("#entityId").val(),Events.relAccMod=!0,r&&r.id&&(Events.relAccId=r.id?r.id:Events.relAccId,Events.relAccName=r.name?r.name:Events.relAccName)),"Leads"==h||"Contacts"==h){if(E.val(h),$("#Crm_Events_SEID_label").removeClass("newmandatory"),"krp"===e){var A=$("#krp_Rightpanel_InfoInnerContainer").find("#entityName").val();A?g.val(A):q?g.val(q):g.val($("#associatedContName").val())}else if("stageView"===e){if(t&&-1!==t.id.indexOf("_create_meetings")){if(j=$L("crm-inner-list")[0]){var b=moduleRecordMapping[h].display_field?moduleRecordMapping[h].display_field.api_name:store.peekRecord("module",moduleRecordMapping[h].id).display_field.api_name;q=j.component.data.recordObjForQuickAction[b],g.val(q)}}else g.val($("#listView_"+y).text())}else"salessignals"===e?g.val($("#ss_entityName").val()):"call_popup"===e?(g.val($("#Ctiapi_entityName").attr("value")),"Contacts"===h&&ctiApiNotifier.populteRelDetEvent()):g.val(r&&r.name?r.name:f.val());g.data("id",y);var S=$L("crm-detailview-canvas")[0],N=$("#subvalue_ACCOUNTID");if(I&&"true"===Crm.moduleInfo.Accounts.isVisible){"relatedlist_new"!==e&&"relatedlist_meetnow"!==e&&"krp"!==e||(Events.relAccName=C,Events.relAccId=I,Events.relAccMod=!0);var P=$("#Crm_Events_SEID");P.val(C),P.data("id",I),$("#Crm_Events_SEID_label_select").val("Accounts")}else if("Contacts"!==h||""===N.html()||void 0===N.html()||"true"!==Crm.moduleInfo.Accounts.isVisible||T){if("Contacts"==h&&S){const t=S.getData("record");var L="",k="";t.Account_Name&&(L=t.Account_Name.name,k=t.Account_Name.id),"relatedlist_new"!==e&&"relatedlist_meetnow"!==e&&"krp"!==e||(Events.relAccName=L,Events.relAccId=k,Events.relAccMod=!0);var U=$("#Crm_Events_SEID");U.val(L),U.data("id",k),$("#Crm_Events_SEID_label_select").val("Accounts")}}else"relatedlist_new"!==e&&"relatedlist_meetnow"!==e&&"krp"!==e||(Events.relAccName=$("#subvalue_ACCOUNTID").text(),Events.relAccId=$("#subvalue_ACCOUNTID").data("params").id,Events.relAccMod=!0),$("#Crm_Events_SEID").val($("#subvalue_ACCOUNTID").text()),$("#Crm_Events_SEID").data("id",$("#subvalue_ACCOUNTID").data("params").id),$("#Crm_Events_SEID_label_select").val("Accounts")}else{if(_&&"create"===Events.currentStatus)E.val("Contacts"),g.val(w).data("id",_);else if(R[0]&&""!==R.val()&&"create"===Events.currentStatus){E.val("Contacts");var O=$L("crm-detailview-canvas")[0],V="",x=$("#cntId").val();if(x)V=x;else if(O){var B=O.getData("record");B.Contact_Name&&(V=B.Contact_Name.id)}g.val(R.val()).data("id",V)}else if("Potentials"===h&&"create"===Events.currentStatus&&"stageView"===e){var F;(F=store.peekRecord(moduleRecordMapping[h].id,y)).Contact_Name?(E.val("Contacts"),g.val(F.Contact_Name.name).data("id",F.Contact_Name.id)):E.val("Others")}else E.val("Others");if(document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value)if("stageView"===e)if(t&&-1!==t.id.indexOf("_create_meetings")){if(j=$L("crm-inner-list")[0]){b=moduleRecordMapping[h].display_field?moduleRecordMapping[h].display_field.api_name:store.peekRecord("module",moduleRecordMapping[h].id).display_field.api_name;q=j.component.data.recordObjForQuickAction[b],$("#Crm_Events_SEID").val(q)}}else $("#Crm_Events_SEID").val($("#listView_"+y).text());else"krp"===e&&Crm.userDetails.DETAIL_VIEW_LYTE?$L("#Crm_Events_SEID").val(f):$("#Crm_Events_SEID").val($("#modname1").val());else if("krp"===e)if(r&&r.name)$L("#Crm_Events_SEID").val(r.name);else{var H=$("#krp_Rightpanel_InfoInnerContainer").find("#entityName").val();$("#Crm_Events_SEID").val(void 0!==H?H:$("#krp_Rightpanel_InfoContainer").find("#entityName").val())}else if("stageView"===e){var j,q;if(t&&-1!==t.id.indexOf("_create_meetings")){if(j=$L("crm-inner-list")[0]){var b=moduleRecordMapping[h].display_field?moduleRecordMapping[h].display_field.api_name:store.peekRecord("module",moduleRecordMapping[h].id).display_field.api_name;q=j.component.data.recordObjForQuickAction[b],$("#Crm_Events_SEID").val(q)}}else $("#Crm_Events_SEID").val($("#listView_"+y).text())}else $("#Crm_Events_SEID").val(r&&r.name?r.name:f.val());$("#Crm_Events_SEID").data("id",y),$("#Crm_Events_SEID_label_select").val(h)}"create"==Events.currentStatus&&"relatedlist_new"!=Events.createSource&&"krp"!=Events.createSource&&"stageView"!=Events.createSource&&"relatedlist_meetnow"!=Events.createSource&&"salessignals"!=Events.createSource&&"nbx"!==Events.createSource&&E.val("None")}else E.val("None");if("stageView"!==e&&"call_popup"!==e&&document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value){if(kvEventPopLeft=$("#eventCreatePopup").css("left").replace("px",""),kvEventPopTop=$("#eventCreatePopup").css("top").replace("px",""),eventPopupArrowTop=$("#eventPopupArrow").css("top").replace("px",""),$("#eventCreatePopup").is(":visible")&&($("#eventCreatePopup").addClass("kveventCreatePopup"),$("#eventCreatePopup").css("left",parseInt(kvEventPopLeft)-40+"px"),$("#eventCreatePopup").css("top",parseInt(kvEventPopTop)-35+"px")),getObj("whoid")){h=getObj("whoidmodule").value;var z=getObj("whoid").value;E.val(h),g.val(f.val()),g.data("id",z)}if(getObj("modid")){$("#Crm_Events_SEID").val($("#modname1").val());var G=getObj("modid").value;$("#Crm_Events_SEID").data("id",G);var J=getObj("modsel").value;$("#Crm_Events_SEID_label_select").val(J)}}Events.showEventRelatedToOptions(E,void 0,void 0,t)}if("clone"===this.currentStatus&&(Events.relAccName=$("#Crm_Events_SEID").val(),Events.relAccId=$("#Crm_Events_SEID").attr("recid"),Events.relAccMod=!0),i&&"true"===i.isAjaxEdit)i&&"true"===i.isAjaxEdit&&$("#cancelEventBtn").focus();else{var Y=$("#"+Crm.fieldsObj[this.moduleName][0]);Y.focus()}"create"===this.currentStatus&&Y.select(),$L("#eventCreationInnerDiv").scrollTop(0),Events.createSource=e;var W=$("#wid_calCreate_opts_menu");W.length>0&&W.is(":visible")&&W.hide()},getPositionObjFromEvent:function(e){var t={};return e&&(t.mouseclientY=e.clientY,t.mouseclientX=e.clientX,t.mousepageY=e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t.mousepageX=e.pageX?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),t},eventQuickView:function(e,t,n,i,a,r,s,o){$("#eventViewPopup");var l=$("#allUsrMonthView");if("Unavailable"!==e){$("#wid_calCreate_opts_menu").hide();var d=Events.getPositionObjFromEvent(i);clearTimeout(Events.onMouseOverTimeOut),renderingUtils.zctt.hidett(!0);var c=Crm.getCrmBasePath()+"/ShowEntityInfo.do?action=eventQuickView&module="+e+"&id="+t;a?c+="&isInnerRequest=true":commonUtils.showHideLoadingDiv(!0),Lyte.Router.getRouteInstance().getQueryParams().isMobile&&"true"===Lyte.Router.getRouteInstance().getQueryParams().isMobile.toString()&&(c+="&isMobile=true"),$("#unAvailablePopup").hide(),Events.quickViewEv=d,$.ajax({url:c,type:"POST",success:function(c){commonUtils.showHideLoadingDiv();var v=$("#posArrow").attr("class"),m=$("#posArrow").attr("style");if(a)$("#eventViewPopup")[0]&&($("#eventViewPopup").empty(),$("#eventViewPopup")[0].innerHTML=c,EvalInnerScript(getElemById("eventViewPopup")),$("#posArrow").attr({class:v,style:m}));else{$("#eventViewPopup").remove();var u=getElemById("basic")?"basic":"show",p=document.createElement("div");if(p.innerHTML=c,-1==c.indexOf("quickViewMainDiv"))return $("#show").html(c),!1;getElemById(u).appendChild(p),EvalInnerScript(getElemById("eventViewPopup")),i?(renderingUtils.positionArrow(n,"eventViewPopup",i,void 0,d),l.css("overflow","hidden"),"Events"===e&&(Events.currentEventObjectInQV.curQviewStyle=$("#eventViewPopup").attr("style"),Events.currentEventObjectInQV.curQviewArrowCls=$("#posArrow").attr("class"),Events.currentEventObjectInQV.curQviewArrowStyle=$("#posArrow").attr("style"))):Events.currentEventObjectInQV.curQviewStyle&&"Events"===e&&$("#posArrow").attr({class:Events.currentEventObjectInQV.curQviewArrowCls,style:Events.currentEventObjectInQV.curQviewArrowStyle}),Events.currentQuickViewId=id}if("undefined"!=typeof eventStatus&&"0"==eventStatus.value&&$(".invitedSt").html(0),r&&Events.currentEventObjectInQV&&"monthview"===calView.currCalView){var E=Events.currentEventObjectInQV.scrollTop;E&&$L(window).scrollTop(E)}var g=$L("#eventViewPopup");if(g.css({"z-index":""}),!a){if("Events"===e){var h=$L(window).scrollTop();Events.currentEventObjectInQV.scrollTop=h}s&&g.css({"z-index":"32"})}if("Calls"===e){if(populateTimeVal(".ddTime"),Events.currQuickViewBCDetails){var f=Events.businessCardViewHTML(Events.currQuickViewBCDetails);$("#businessCardDetailsTD").append(f)}}else if("Appointments"===e)crmui.hidePopup("appointmentCreate");else if(o&&""!=o){var I=$("#eventHead_"+t);I.addClass("fc-event-invited-mon"),I.mouseover((function(e){renderingUtils.zctt.showtt(o,void 0,!1,e)})),I.mouseout((function(e){renderingUtils.zctt.hidett()}))}crmui.modalZIndex("nonLyte",g[0],"open")},error:function(e){if(0!==e.status){var t='<div onclick="sE()" class="w500 p20"><div class="fL pL20 w430"><div class="crm-heading-font-size"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()])+'</div></div><br class="cBoth"><div  class="alignRight mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(t),commonUtils.showHideLoadingDiv()}}}),crmui.hideTooltip(),renderingUtils.stopEvent(i)}else{Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].getCurrentUnavailableInfo(t,n,i)}))}},getRoundedDateTime:function(e){var t;return e||(e=new Date),(t=e.getMinutes()<30?new Date(e.valueOf()+36e5):new Date(e.valueOf()+36e5+36e5)).setMinutes(0),t},getDateTimeValForQuickView:function(e,t,n){var i="",a=new Date,r=$.datepicker.formatDate("dd mm y M D MM",e).split(" "),s=$.datepicker.formatDate("dd mm y M D MM",t).split(" "),o=Utils.convertTo12HoursFormatTimeObj(e),l=Utils.convertTo12HoursFormatTimeObj(t),d=o.hrs+"."+o.mins+" "+I18n.getMsg(o.meridiem.toUpperCase()),c=l.hrs+"."+l.mins+" "+I18n.getMsg(l.meridiem.toUpperCase()),v=r[0]+"-"+r[1]+"-"+r[2],m=s[0]+"-"+s[1]+"-"+s[2],u="",p="";return a.getFullYear()!=e.getFullYear()&&(u=e.getFullYear()+""),a.getFullYear()!=t.getFullYear()&&(p=t.getFullYear()+""),v==m?n?(""!=u&&(u=", "+u),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[5])+" "+r[0]+u):(""!=u&&(u=", '"+u.substring(2)),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[3])+" "+r[0]+u+", "+d+" - "+c):n?(""!=u&&(u=", "+u),""!=p&&(p=", "+p),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[5])+" "+r[0]+u+" - "+I18n.getMsg(s[4])+" "+s[0]+" "+I18n.getMsg(s[5])+p):(""!=u&&(u=", '"+u.substring(2)),""!=p&&(p=", '"+p.substring(2)),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[3])+" "+r[0]+u+", "+d+" - "+I18n.getMsg(s[4])+" "+s[0]+" "+I18n.getMsg(s[3])+p+", "+c),i},closeQuickView:function(){var e=$L("#eventViewPopup");e&&e.length>0&&"none"!==e[0].style.display&&crmui.modalZIndex("nonLyte",e[0],"close"),$("#eventViewPopup,#unAvailablePopup").hide(),$("#allUsrMonthView").css("overflow","scroll"),e.html(""),Events.invAddLinkClicked=!1,Events.currentQuickViewId=void 0,crmCalendar.close(),$("body").removeClass("oH")},valDeleteEvent:function(e,t,n,i,a){t||(t=!1);var r="detailView";if(t||(r="calendar"),n&&""!==n&&"onlyThis"!=n){i=I18n.getMsg("crm.event.rec.del.msg1",[Events.getModuleName(!0,!1,!0)])+"<br>"+I18n.getMsg("crm.event.rec.del.msg2",[Events.getModuleName(!0,!1,!0)]);var s=$("#deletepopup"),o=s.find(".evButtons");s.find("#deleteButton").hide(),s.find("#warningMsg").html(i),s.find("#showWarning2").css("display","none"),s.find("#delItemName").text(""),s.find("#delItemName").append("<br>"),s.find("#dissociatebutton").remove(),s.find("#showDontAskOptionDiv").remove(),s.find("#notifyOwnerOptionDiv").remove();var l='{"module":"Events","id":"'+e+'","delOpt":"upcomingEv", "from":"'+r+'"}';o=s.find(".evButtons");$(o).removeClass("fromDeletePopup"),o.eq(0).show().attr({"data-cid":"deleteEntity","data-params":l,value:I18n.getMsg("crm.event.rec.del.btn.all",Events.getModuleName(!1,!0,!0))}).off("click"),l='{"module":"Events","id":"'+e+'","delOpt":"onlyThis","from":"'+r+'"}',o.eq(1).show().attr({"data-cid":"deleteEntity","data-params":l,value:I18n.getMsg("crm.event.rec.del.btn.one",Events.getModuleName(!0,!0,!0))}).off("click"),showAnimatePopup("deletepopup")}else showDeletePopup(i,"crm.button.delete","","",a);return!1},getQuickViewRelatedToContent:function(e){var t="",n=I18n.getMsg("What Id");try{var i=trimBoth(e["Who Id"]);i&&-1!=i.indexOf(",#;")&&(i=i.replace(/,#;/g,'"'));var a=trimBoth(e["What Id"]);a&&-1!=a.indexOf(",#;")&&(a=a.replace(/,#;/g,'"'));var r=trimBoth(e.leContModSel),s=trimBoth(e.modus2);if(r&&"Leads"==r){if(i){var o=$("#compName_Laeds").val();t=i+(o=o?" ( "+o+" )":"");n=Crm.moduleInfo.Leads.translatedSingularLabel}}else{if(i&&!a)n=Crm.moduleInfo.Contacts.translatedSingularLabel,t=i;else if(a&&!i)t=a,n=I18n.getMsg(s);else if(i&&a){n=Crm.moduleInfo.Contacts.translatedSingularLabel,t="Accounts"==trimBoth(e.modsel)?i+" ( "+a+" )":I18n.getMsg("crm.bc.related.mode.quickview.info",[i,I18n.getMsg(trimBoth(e.modus2)),a])}}}catch(e){}return""===t&&(t=I18n.getMsg("None")),{label:n,val:t}},showCurrInvDiv:function(e){$(".invList").hide(),$("#invListDiv_"+e).show()},showhideContacts:function(e){"c"==e&&("relContactOption"==$("#invFilterDropDown :selected")[0].id?$(".contactTR").hide():$(".contactTR").show())},getParticipantsListBasedOnStatus:function(e){for(var t=[],n=returnJson.inviteeDetails,i=n.length,a=0;a<i;){var r=n[a];(r.status==e||-1==e&&4!=r.status)&&t.push(r),a++}return t},showMoreOpt:function(e,t){sE();var n=$(e).parent().find(".moreOptionsDiv").html(),i=$(e).offset().top-10,a=$(e).offset().left+20,r=$(".moreOptions"),s=$(".currentActiveIcon"),o=$(".moreOptionsDiv"),l=$("#moreOptionsDiv");if(r.css({visibility:"hidden"}),t){$(e).children().find(".moreOptionsDiv").is(":visible")&&o.hide(),setTimeout((function(){l.is(":visible")?$(e).addClass("currentActiveIcon"):s.removeClass("currentActiveIcon")}),100)}else{if($(e).parent().children(".moreOptionsDiv").is(":visible")&&o.hide(),o.hide(),l.html(n),Crm.userDetails.RTL_ENABLED){l.show();var d=l.outerWidth()+25;l.css({visibility:"visible",top:i,left:a-d})}else l.css({visibility:"visible",top:i,left:a}).show();r.css({visibility:"hidden"}),$(e).css({visibility:"visible"}).addClass("currentActiveIcon")}},hideMoreOpt:function(){var e=$(".currentActiveIcon"),t=$(".moreOptions"),n=$("#moreOptionsDiv");e.removeClass("currentActiveIcon"),t.css({visibility:"hidden"}),n.hide()},getStringForStatus:function(e){switch(e){case-1:return"invited";case 0:return"noreply";case 1:return"accept";case 2:return"maybe";case 3:return"decline";default:return""}},showCurrentTab:function(e){var t=$(e).index(),n=$(e).closest(".tabContent_wrapper").children().find(".tabContent_evt");n.hide(0),n.eq(t).show(),$(".tabHeader_evt li").removeClass("selected_tab"),$(e).addClass("selected_tab")},getInviteesDetails:function(e,t){t&&Events.showCurrentTab(t);var n=Events.getStringForStatus(e),i={},a=$("#tabContent_"+n),r=$(".noPartticipantTxt");i.option=n,i.Events={entityid:returnJson.Events.entityid},Handlebars.registerPartial("eventParticipantsListInner",Handlebars.templates.eventParticipantsListInner),i.inviteeDetails=Events.getParticipantsListBasedOnStatus(e);var s=Handlebars.templates.eventParticipantsListInner(i);0==a.size()&&$("#participants_tabContent_wrapper").append(s),null==Events.previousOption&&(Events.previousOption="invited"),r.css("display","block"),i.inviteeDetails.length>0&&r.css("display","none"),-1==e&&$("#tabContent_invited").find(".attendedInvitees").closest("li").remove(),$("#tabContent_"+Events.previousOption).hide(),a.show(),thirdPartyUtils.bindPerfectScroll("#tabContent_"+n),thirdPartyUtils.bindPerfectScroll(".added_OnlyevtParticipants"),Events.previousOption=n},viewInviteesPop:function(e,t,n,i,a,r,s){commonUtils.showHideLoadingDiv(!0),Events.selInviteesCnt=parseInt($("#right_invCnt_invited").text());var o=returnJson||Events.returnJson;Events.pastEventInvCnt=o&&o.invCntJson&&o.invCntJson.invited>Events.inviteeslimit?o.invCntJson.invited:Events.pastEventInvCnt,"onChange"===t&&(Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0);var l=$("#id").val(),d=trimBoth($("#viewInviteesSearchTxt").val());d||(d=""),Events.searchInvRel=!1;var c="viewInviteesInner";t?"onChange"==t?Events.inviteesViewPageNo=0:"onScroll"==t&&Events.inviteesViewPageNo++:(c="viewInvitees",Events.inviteesViewPageNo=0),e||(e=$("#invStatusFilter").val());var v=0;v=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.status:Events.currentEventObjectInView.status;var m=0;if(returnJson&&returnJson.entMetaData&&returnJson.entMetaData.meeting_detials){var u=JSON.parse(returnJson.entMetaData.meeting_detials);u.attendees_details&&(m=Object.keys(u.attendees_details).length)}var p="action="+c+"&calledFrom="+n+"&eventStatus="+v+"&pageno="+Events.inviteesViewPageNo+"&invStatus="+e+"&eventId="+l+"&searchTxt="+encodeURIComponent(d)+"&invType="+Events.lastLoadedType;p+="&cvPageCnt="+Events.invPreparedPageCnt+"&attendeeCount="+m,$.ajax({url:Crm.getCrmBasePath()+"/events/ViewInvitees.do",data:p,type:"POST",success:function(r){if(commonUtils.showHideLoadingDiv(),s?Events.formatInvDetailsToFinalIdsJson({inviteeDetails:s}):a||Events.formatInvDetailsToFinalIdsJson(),"onChange"==t)$("#viewInviteesListDiv").html(r),thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),bindEventsForViewPop();else if("onScroll"==t)$("#viewInviteesListDiv").append(r),thirdPartyUtils.bindPerfectScrollUpdate("#viewInviteesListDiv"),Events.viewInviteeReqSent=!1,bindEventsForViewPop();else if(thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),n&&"quickView"==n){var o=parseInt($("#quickViewRelDivCont").prev().css("top"),10),l=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#qvInvitedListDivInner").html(r),$("#doneViewPartFromDetail").remove(),$("#cancelBtneventQform").remove(),Events.initViewInviteesPop(),$("#quickViewMainDiv").animate({left:"-440px"},500),$("#quickViewRelDivCont").animate({height:"380"},500),$("#quickViewRelDivCont").parent().animate({top:l-125},500),$("#quickViewRelDivCont").prev().animate({top:o+125},500),$("#qvInvitedListDivCont").show().animate({left:"0px"},500),$("#eventViewPopup").find(".eventFooter").hide(),$("#doneBtnQuickView").show(),$("#doneBtnDetailsView").hide()}else{Events.loadViewInviteesPopDiv();var d=$("#viewInviteesPop");d[0].innerHTML=r,d.show(),EvalInnerScript(d[0]),PopSetCenter("viewInviteesPop"),renderingUtils.freezeBackground(),Events.initViewInviteesPop(i),$("#doneBtnQuickView").hide(),a&&(Events.formatInvDetailsToFinalIdsJson({inviteeDetails:Events.inviteesDetailsDetailView}),Events.inviteeslimit=Events.invLimitDetailView,Events.remainingInvitees=Events.inviteeslimit-Events.invCntDetailView,Events.pastEventInvCnt=Events.invCntDetailView>Events.inviteeslimit?Events.invCntDetailView:Events.inviteeslimit)}thirdPartyUtils.bindSelect2($(".newSelect").find("select"));var c=$("#inviteesViewPageNoHid_"+Events.inviteesViewPageNo).val();Events.viewInviteeRecordAvailable="true"==c,i&&($("#eventActionsMenu").hide(),Events.showAddParticipants(void 0,void 0,"detailView",i)),4==e||"0"==v?$("#viewInviteesSearchTxt").hide():$("#viewInviteesSearchTxt").show()}})},closeViewInviteesPop:function(){removeFreezeLayer2(),$("#viewInviteesPop").html("").hide(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0},closeAddPartEvent:function(){Events.closeViewInviteesPop(),Events.invAddLinkClicked=!1,Events.selInvlinkClicked=!1,Events.resetEntityVars()},initViewInviteesPop:function(e){var t=trimBoth($("#invStatusHidden").val()),n=$("#inviteesViewPageNoHid_0").val();Events.viewInviteeRecordAvailable="true"==n,e||$("#viewInvPopDivCont").show(),$("#invStatusFilter").val(t),bindEventsForViewPop(),$("#viewInviteesSearchTxt").keyup((function(){Events.viewInviteesPop(void 0,"onChange")})),$("#viewInvPopInnerDiv").css({height:"465px"})},initAddParticipant:function(){var e=$("#invListDiv_c");e.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&e.scrollTop()>=e.get(0).scrollHeight-e.get(0).clientHeight-40&&Events.reqInvRecAvail.c&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.c=Events.addInvPageCnt.c+1,Events.showAddParticipants("c","onScroll"))}),250));var t=$("#invListDiv_t");t.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&t.scrollTop()>=t.get(0).scrollHeight-t.get(0).clientHeight-40&&Events.reqInvRecAvail.t&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.t=Events.addInvPageCnt.t+1,Events.showAddParticipants("t","onScroll"))}),250));var n=$("#invListDiv_l");n.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&n.scrollTop()>=n.get(0).scrollHeight-n.get(0).clientHeight-40&&Events.reqInvRecAvail.l&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.l=Events.addInvPageCnt.l+1,Events.showAddParticipants("l","onScroll"))}),250));var i=$("#invListDiv_u");i.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&i.scrollTop()>=i.get(0).scrollHeight-i.get(0).clientHeight-40&&Events.reqInvRecAvail.u&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.u=Events.addInvPageCnt.u+1,Events.showAddParticipants("u","onScroll"))}),250));var a=$("#invListDiv_g");a.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&a.scrollTop()>=a.get(0).scrollHeight-a.get(0).clientHeight-40&&Events.reqInvRecAvail.g&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.g=Events.addInvPageCnt.g+1,Events.showAddParticipants("g","onScroll"))}),250));var r=$("#invListDiv_r");r.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&r.scrollTop()>=r.get(0).scrollHeight-r.get(0).clientHeight-40&&Events.reqInvRecAvail.r&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.r=Events.addInvPageCnt.r+1,Events.showAddParticipants("r","onScroll"))}),250));var s=$("#invListDiv_rs");s.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&s.scrollTop()>=s.get(0).scrollHeight-s.get(0).clientHeight-40&&Events.reqInvRecAvail.rs&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.rs=Events.addInvPageCnt.rs+1,Events.showAddParticipants("rs","onScroll"))}),250));var o=$("#invListDiv_cv");o.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&o.scrollTop()>=o.get(0).scrollHeight-o.get(0).clientHeight-40&&Events.reqInvRecAvail.cv&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.cv=Events.addInvPageCnt.cv+1,Events.showAddParticipants("cv","onScroll"))}),250));var l=$("#invListDiv_lv");l.off("scroll").scroll((function(){!Events.isAddInvReqSent&&l.scrollTop()>=l.get(0).scrollHeight-l.get(0).clientHeight-40&&Events.reqInvRecAvail.lv&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.lv=Events.addInvPageCnt.lv+1,Events.showAddParticipants("lv","onScroll"))})),$("#invListDiv_rc").off("scroll").scroll((function(){var e=$L("#invListDiv_rc");if(!Events.isAddInvReqSent&&e.scrollTop()>=e.get(0).scrollHeight-e.get(0).clientHeight-40){var t="rc";Events.reqInvRecAvail.rc&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.rc=Events.addInvPageCnt.rc+1,Events.showAddParticipants(t,"onScroll"))}}));var d=!1;$("#invFilterTextBox").keyup((function(){d||(d=!0,setTimeout((function(){Events.showAddParticipants($("#invFilterDropDown").val(),"onKeyup"),d=!1}),1e3))})),$("#withEmtEmailChk").click((function(){Events.showAddParticipants($("#invFilterDropDown").val(),"onKeyup")})),Events.loadTagitPlugin()},loadTagitPlugin:function(){var e=$("#invEmailsListBox");if(e.tagit({placeholderText:I18n.getMsg("crm.inv.label.add.emails"),fieldName:"addEmailInvs",removeConfirmation:!0,caseSensitive:!1,allowSpaces:!0,singleField:!0,singleFieldDelimiter:",",tagLimit:100,beforeTagAdded:function(t,n){var i=e.find(".ui-autocomplete-input"),a=e.tagit("tagLabel",n.tag);if(-1!=a.indexOf(",")){var r=a.split(",");i.val("");for(var s=0;s<r.length;s++){var o=trimBoth(r[s]);e.tagit("createTag",o)}return!1}"edit"==Events.currentStatus&&(Events.addInvEmailsList[a]=a,i.val(""))},afterTagAdded:function(t,n){var i=e.find(".ui-autocomplete-input");i.length>0&&(i.removeAttr("placeholder"),$L(e).scrollTo(i));var a=e.tagit("tagLabel",n.tag);Events.invJsonCreate.e[a]=a,Events.finalIdsJson[a]={},Events.finalIdsJson[a].e=[a],Events.setSelInvCnt(Object.keys(Events.finalIdsJson).length),Events.invitationLimitValidation(!0,$("#invFilterDropDown").val(),Events.isFromSel),"edit"==Events.currentStatus&&(Events.removeInvEmailsList[a]?delete Events.removeInvEmailsList[a]:Events.addInvEmailsList[a]=a)},afterTagRemoved:function(t,n){e.find("li").length<=1&&e.find(".ui-autocomplete-input").attr("placeholder",I18n.getMsg("crm.inv.label.add.emails"));var i=e.tagit("tagLabel",n.tag);if(delete Events.finalIdsJson[i],Events.setSelInvCnt(Object.keys(Events.finalIdsJson).length),Events.invitationLimitValidation(!1,$("#invFilterDropDown").val(),Events.isFromSel),"edit"==Events.currentStatus)Events.addInvEmailsList[i]?delete Events.addInvEmailsList[i]:Events.removeInvEmailsList[i]=i;else{Events.invJsonCreate.e&&delete Events.invJsonCreate.e[i]}},onTagExists:function(t,n){var i=e.find(".ui-autocomplete-input");i.length>0&&i.val("")},onTagLimitExceeded:function(e,t){return!1}}),"edit"==Events.currentStatus){Events.addInvEmailsList={},Events.removeInvEmailsList={};Events.invJsonCreate.e={},e.find("li").length>=1&&e.find(".ui-autocomplete-input").removeAttr("placeholder")}if("clone"===Events.currentStatus||window.ctiApiNotifier&&ctiApiNotifier.eventCreate)for(var t=objectUtils.getKeys(Events.invJsonCreate.e),n=0;n<t.length;n++){var i=t[n];e.tagit("createTag",i),Events.setSelInvCnt(Events.selInviteesCnt)}},validateEmailIdsInTagit:function(){var e=$("#invEmailsListBox"),t=e.tagit("assignedTags"),n=e.find(".ui-autocomplete-input"),a=!1;for(i=0;i<t.length;i++){var r=t[i];if(!validationUtils.isValidEmail(r)){alert(I18n.getMsg("crm.participant.invalid.email.id",[r])),a=!0,n.focus();break}}return!a},showAddParticipants:function(e,t,n,i,a){commonUtils.showHideLoadingDiv(!0),crmui.hideMsgBand(),$("#saveEventsBtn").removeAttr("disabled");var r=0;"detailView"===n||"quickView"===n?r=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.status:Events.currentEventObjectInView.status:this.currentStatus&&"create"!==this.currentStatus&&(r=Events.status),null==r&&(r=0),"detailView"!=n&&"quickView"!=n||(Events.entityId=$("#id").val(),Events.currentStatus="edit");var s=$("#invListDiv_"+e),o=$("#withEmtyEmailRec");if("onChange"==t)if("c"==e||"l"==e||"rc"==e){o.addClass("dB"),o.removeClass("dN");var l=$("#invFilterDropDown :selected").text();o.find("label").text(I18n.getMsg("crm.inv.exclude.empty.email.msg",I18n.getMsg([l])))}else o.addClass("dN"),o.removeClass("dB");if($("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")&&(Events.meetingToolName=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Events.searchInvRel=!1,"onChange"!=t||""==trimBoth(s.html())||Events.relAccMod)if(e||!Events.invAddLinkClicked||Events.relAccMod){var d=$("#invFilterTextBox").val();d||(d="");var c=0;"onScroll"==t&&(c=Events.addInvPageCnt[e]),e&&(Events.addInvPageCnt[e]=c);var v,m="getInviteesPop";t&&(m="getInviteesPopInner"),$("#invFilterDropDown").length>0&&(v=$("#invFilterDropDown").val());var u=Crm.getCrmBasePath()+"/AddInvitees.do?action="+m+"&status="+r+"&pageno="+c+"&operation="+Events.currentStatus+"&srchTxt="+encodeURIComponent(d);if(Events.relAccMod||"getInviteesPopInner"==m&&"rc"==v?(u+="&accountIdforRelCont="+Events.relAccId,"detailView"!=n&&"onChange"!=t&&(Events.relAccMod=!1),"getInviteesPopInner"==m&&(u+="&selmodule="+v)):v&&(u+="&selmodule="+v),Events.entityId&&(u+="&eventId="+Events.entityId),"clone"===Events.currentStatus&&(u+="&cloneEntId="+Events.cloneEntId),t||($("#addInvDivFromView").removeClass("addInvFromViewInv"),a&&$("#addInvDivFromView").addClass("addInvFromViewInv")),$("#withEmtEmailChk").length>0)u+="&withEmtEmail="+$("#withEmtEmailChk").is(":checked");$.ajax({url:u,type:"POST",success:function(r){if(commonUtils.showHideLoadingDiv(),"undefined"!=typeof returnJson&&returnJson.inviteeslimit&&(Events.inviteeslimit=returnJson.inviteeslimit,Events.remainingInvitees=Events.inviteeslimit-returnJson.invCnt,Events.pastEventInvCnt=returnJson.invCnt>returnJson.inviteeslimit?returnJson.invCnt:returnJson.inviteeslimit),"detailView"==n){$("#addInvFromDetCont").empty(),$("#addInvFromDetCont")[0].innerHTML=r;var o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),EvalInnerScript(getElemById("addInvFromDetCont")),Events.initAddParticipant(),i?($("#doneViewPartFromDetail")[0].setAttribute("onclick","Events.saveParticipantFromView('detailView', true, true)"),$("#viewInvPopDivCont").css({left:"-100%",opacity:"0"}),$("#addInvDivFromView").show().css({left:"0%",opacity:"1"})):($("#viewInvPopDivCont").animate({left:"-500px"},500),$("#addInvDivFromView").show().animate({left:"0px"},500)),thirdPartyUtils.bindSelect2($("#invFilterDropDown")),$("#viewInvPopInnerDiv").css({height:"495px"}),t||(a?$("#qvAddInvFoterBtns_fromView").show():$("#qvAddInvFoterBtns_fromView").hide(),Events.relAccId&&""!=Events.relAccId?($("#relContactOption").text(I18n.getMsg("crm.related.contact.account",[Crm.moduleInfo.Contacts.translatedPluralLabel,Events.relAccName])),$("#invFilterDropDown").val("rc")):$("#relContactOption").remove())}else if("quickView"==n){var l=parseInt($("#quickViewRelDivCont").prev().css("top"),10),d=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#qvParticipantDivInner").empty(),$("#qvParticipantDivInner")[0].innerHTML=r;o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),EvalInnerScript(getElemById("qvParticipantDivInner")),Events.initAddParticipant(),$("#quickViewRelDivCont").animate({height:"380"},500),$("#quickViewRelDivCont").parent().animate({top:d-125},500),$("#quickViewRelDivCont").prev().animate({top:l+125},500),$("#quickViewMainDiv").animate({left:"-440px"},500),$("#qvParticipantDivCont").show().animate({left:"0px"},500,(function(){$(window).height()<550&&renderingUtils.positionArrow(void 0,"eventViewPopup",void 0,void 0,Events.quickViewEv)})),$("#qv_editBtnDiv").hide(),$("#qvAddInvFoterBtns").show(),$("#qvAddInvFoterBtns_fromView").show(),a?$("#qvAddInvFoterBtns_fromView").show():$("#qvAddInvFoterBtns_fromView").hide()}else if(t){o=$("#invFilterDropDown").val();"onChange"==t||"onKeyup"==t?($(s[0]).empty(),s[0].innerHTML=r,thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o)):(s.append(r),thirdPartyUtils.bindPerfectScrollUpdate("#invListDiv_"+o)),EvalInnerScript(s[0])}else{$("#participantDiv").remove();var c=$("<div>",{id:"participantDiv",class:"w100_per eventForm-create p20",style:"display:none;left: 395px;margin:0;"});c.append($("<div>",{id:"participantInnerDiv",class:"eventForm-ins",style:"width:362px"})),$("#eventCreateContainerDiv").append(c);var v=$("#participantInnerDiv");$("#relContactOption");v[0].innerHTML=r,Events.relAccId&&""!=Events.relAccId?(v.find("#relContactOption").text(I18n.getMsg("crm.related.contact.account",[Crm.moduleInfo.Contacts.translatedPluralLabel,Events.relAccName])),$("#invFilterDropDown").val("rc")):$("#relContactOption").remove(),EvalInnerScript(getElemById("participantDiv")),Events.initAddParticipant(),$("#eventCreationDiv").show(),$("#saveEventsBtn, #cancelEventBtn, #doneRecurringBtn").hide(),$("#doneAddParticipantBtn").show(),$("#eventCreationDiv").css({left:"-100%"}),$("#participantDiv").show().css({left:"0px"}),thirdPartyUtils.bindSelect2($("#invFilterDropDown"));var o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),$("#showMoreFiledsLink").hide()}if(Events.showRelatedpartSelected(t,!1),Events.isAddInvReqSent=!1,e){var m=Events.invJsonCreate[e];for(key in m)if(!$("#invSelRow"+e+"_"+m[key]).length&&window.ctiApiNotifier&&ctiApiNotifier.eventCreate)$("#"+e+"_"+m[key]).trigger("click");else{var u=$("#"+e+"_"+m[key]);u.removeClass("beforeAdd"),u.is(":disabled")&&u.prop("disabled",!1),$("#"+e+"_"+m[key]).prop("checked",!0)}for(key in Events.invAddJson[e])$("#"+e+"_"+m[key]).prop("checked",!0)}Events.invAddLinkClicked=!0;var p=$("[name='cvRadioBtn']:checked"),E=$("[name='lvRadioBtn']:checked");p.length>0?$("[name='lvRadioBtn']").prop("disabled",!0):E.length>0&&$("[name='cvRadioBtn']").prop("disabled",!0),deselectFromRemoveJson(Events.invRemoveJson,e),Events.setSelInvCnt();var g=$("#invFilterDropDown :selected").text();$("#withEmtyEmailRec").find("label").text(I18n.getMsg("crm.inv.exclude.empty.email.msg",I18n.getMsg([g])))}})}else{$("#eventCreationDiv").show(),$("#saveEventsBtn, #cancelEventBtn, #doneRecurringBtn").hide(),$("#removeEvents_link").hide(),$("#doneAddParticipantBtn").show(),$("#eventCreationDiv").css({left:"-100%",opacity:"0"}),$("#participantDiv").show().css({left:"0%",opacity:"1"}),$("#showMoreFiledsLink").hide();var p=$("[name='cvRadioBtn']:checked"),E=$("[name='lvRadioBtn']:checked");if(p.length>0?$("[name='lvRadioBtn']").prop("disabled",!0):E.length>0&&$("[name='cvRadioBtn']").prop("disabled",!0),deselectFromRemoveJson(Events.invRemoveJson,e),Events.setSelInvCnt(),commonUtils.showHideLoadingDiv(),Events.relAccId&&""!=Events.relAccId)$("#relContactOption").text(I18n.getMsg("crm.related.contact.account",[Crm.moduleInfo.Contacts.translatedPluralLabel,Events.relAccName]));Events.showRelatedpartSelected(t)}else Events.showCurrInvDiv(e),Events.showhideContacts(e),Events.setSelInvCnt(),commonUtils.showHideLoadingDiv(),Events.showRelatedpartSelected(t);Events.invitationLimitValidation(Events.invReached,e,void 0,t,!1),Events.showRelatedpartSelected(t,!1);let g=networkUtils.returnDependencyFiles(["crm-email-auth-util.js"],ResourceConstants.CRMClient);Lyte.injectResources(g,void 0,(function(){Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy()}))},doneAddParticipants:function(){if(Events.validateEmailIdsInTagit()){for(var e=$("#selectedInvDiv").find(".invChkBox"),t=0;t<e.length;t++){var n=$(e[t]);n.is(":checked")||n.closest("tr").remove()}if($("#eventCreationDiv").css({left:"0%",opacity:"1"}),$("#participantDiv").css({left:"100%",opacity:"0"}),$("#doneAddParticipantBtn, #doneRecurringBtn").hide(),$("#saveEventsBtn, #cancelEventBtn").show(),window.ctiApiNotifier&&ctiApiNotifier.eventCreate&&validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text())&&$("#removeEvents_link").show(),this.addMoreDetailsClicked||"edit"===Events.currentStatus||$("#showMoreFiledsLink").show(),$("#selectedInvDiv").is(":visible")){var i=$("#invFilterDropDown").val();$("#selectedInvDiv").hide(),$("#invListDiv_"+i).show();var a="";if("lv"===i||"cv"===i){var r="lv"===i?Crm.moduleInfo.Leads.translatedSingularLabel:Crm.moduleInfo.Contacts.translatedSingularLabel;a=I18n.getMsg("crm.invitees.filter.customview.label",[r])}else a=Events.invTypeVsDispMsg[i];$("#invFilterDropDown").attr({disabled:!1}).find("option[value='"+i+"']").text(a),$("#invFilterTextBox").prop({disabled:!1}),$(".invAnc").removeClass("invAncSel"),$(".invAnc").eq(0).addClass("invAncSel")}}var s=$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online");if(Events.withMeetingTool||s){var o=Events.meetingToolName;o||""!==o||(o=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Events.checkAuthorizeDone(o)}},showHideSelIns:function(){var e=["c","cv","l","lv","u","g","r","rs","t"];for(idx=0;idx<e.length;idx++){var t=e[idx],n=$("#invSelTbody_"+t);n.append($("#SelListTbody_"+t).html());var i=n.find("tr"),a=$("#selInvHeader_"+t);i.length>0?(a.show(),a.next().show()):(a.hide(),a.next().hide())}},showInvList:function(e,t,n,i){t||($(".invAnc").removeClass("invAncSel"),$(n).addClass("invAncSel"));var a=$("#withEmtyEmailRec"),r=$("#invFilterDropDown");if(e&&"sel"==e){if(!validationUtils.validateCommaSepEmails("invMoreEmails"))return!1;this.invDelListCreate={u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}};var s=this.entityId;"clone"==Events.currentStatus&&(s=Events.cloneEntId);var o="&searchInvRel=false";if(Events.searchInvRel&&(o="&searchInvRel=true",-1!=Events.searchInvRelPageCnt&&(Events.selInvPageCnt=1)),Events.isFromSel=!0,!s||Events.selInvlinkClicked&&"onScroll"!=t)Events.showHideSelIns(),i&&($("#eventCreationDiv").animate({left:"-430px"},500),$("#participantDiv").show().animate({left:"0px"},500)),Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide();else{var l=Crm.getCrmBasePath()+"/AddInvitees.do?action=showSelInvs&pageno="+Events.selInvPageCnt+"&eventId="+s+o;$.ajax({url:l,type:"POST",success:function(e){if(Events.selInvlinkClicked=!0,$("#popupnew")[0].innerHTML=e,EvalInnerScript(getElemById("popupnew")),Events.selInvPagereqSent=!1,Events.showHideSelIns(),i&&($("#eventCreationDiv").animate({left:"-430px"},500),$("#participantDiv").show().animate({left:"0px"},500)),$("#popupnew").html(""),"onScroll"!=t){Events.showSelHeaders();var n=$("#selectedInvDiv");n.scroll((function(e){!Events.selInvPagereqSent&&n.scrollTop()>=n.get(0).scrollHeight-n.get(0).clientHeight-100&&Events.selInvPagerecAvail&&(Events.selInvPagereqSent=!0,Events.selInvPageCnt++,Events.showInvList("sel","onScroll"))}))}i||removeRowsFromSelInvList(Events.invRemoveJson),Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide()}})}$(".invList").hide();var d=$("#invFilterDropDown option:selected");Events.selectedOldVal=d.text(),d.text(I18n.getMsg("All")),(c=$("#invFilterDropDown")).prop("disabled",!0),c.parent().css({opacity:"0.5"}),$("#invFilterTextBox").prop("disabled",!0),$("#selectedInvDiv").show(),$(".topNav a").eq(0).removeClass("active"),$(".topNav a").eq(1).addClass("active"),a.removeClass("dB"),a.addClass("dN")}else{removeRowsFromSelInvList(Events.invDelListCreate),$("#selectedInvDiv").hide(),$("#invFilterDropDown").closest("td").show(),$("#invFilterTextBox").closest("div").show(),$(".topNav a").eq(0).addClass("active"),$(".topNav a").eq(1).removeClass("active"),$("#invListDiv_"+$("#invFilterDropDown").val()).show();var c,v=$("#invFilterDropDown").val();"c"!=v&&"l"!=v||(a.addClass("dB"),a.removeClass("dN")),Events.isFromSel=!1,(d=$("#invFilterDropDown option:selected")).text(d.attr("dispval")),(c=$("#invFilterDropDown")).prop("disabled",!1),$("#invFilterDropDown_chosen").removeClass("chosen-disabled"),c.trigger("change.select2"),c.parent().css({opacity:"1"}),$("#invFilterTextBox").prop("disabled",!1)}a.is(":visible")&&$("#invListDiv_"+r.val()).attr("style","height:188px !important"),$("#selectedInvDiv").perfectScrollbar()},setSelInvCnt:function(e){null!=e&&(this.selInviteesCnt=e),$("#selInvCntSpan").text(this.selInviteesCnt),0==this.selInviteesCnt?$("#Crm_Events_PARTICIPANTID").text(I18n.getMsg("None")):$("#Crm_Events_PARTICIPANTID").text(I18n.getMsg("crm.create.inv.cnt.label",[this.selInviteesCnt])),$("#selectedInvDiv").is(":visible")||(Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide())},isFutureEvent:function(){var e=(new Date).getTime(),t=$("#Crm_Events_STARTDATETIME").data("dateObj");return e<(t?t.getTime():Events.currentQuickViewId?Events.currentEventObjectInQV.start.getTime():Events.currentEventObjectInView?Events.currentEventObjectInView.start.getTime():returnJson.entityMapJson.STARTDATETIME.valueinLong)},parseInvTypeUserIdMap:function(e){var t=JSON.parse(e[0]),n=JSON.parse(e[1]);Events.getInvTypeUserIdMap(t),Events.getInvTypeUserIdMap(n)},getInvTypeUserIdMap:function(e){for(var t in"string"==typeof e&&(e=JSON.parse(e)),e){var n=e[t];if(Events.invTypeVsUserIdsMap[t]){var i=Events.invTypeVsUserIdsMap[t];for(var a in n)i[a]||(i[a]=n[a])}else Events.invTypeVsUserIdsMap[t]=n}},updateFinalIdJson:function(e){var t=e.split("actModule=")[1].split("&")[0].substring(0,1).toLowerCase(),n=e.split("actId=")[1].split("&")[0],i={},a={},r=[];r.push(n),i[n]=r,a[t]=i,Events.getSelectedInviteesCnt({},a),returnJson&&returnJson.inviteeDetails.every((function(e,t){return e.id!==n||(returnJson.inviteeDetails.deleteElementAt(t),!1)}))},getSelectedInviteesCnt:function(e,t){for(var n in"string"==typeof e&&(e=JSON.parse(e),t=JSON.parse(t)),e){var i=e[n];for(invId in i){var a=i[invId];Events.checkAvailabilityInInvAddArray(a,invId,n)}}for(var n in t){i=t[n];for(invId in i){a=i[invId];Events.checkAvailabilityInInvRemArray(a,invId,n)}}return Object.keys(Events.finalIdsJson).length},checkAvailabilityInInvAddArray:function(e,t,n){e.forEach((function(e){var i=Events.finalIdsJson[e];if(-1==Object.keys(Events.finalIdsJson).indexOf(e)){var a={};a[n]=[t],Events.finalIdsJson[e]=a}else i[n]&&-1==i[n].indexOf(t)?i[n].push(t):i[n]=[t]}))},checkAvailabilityInInvRemArray:function(e,t,n){e.forEach((function(e){var i=Events.finalIdsJson[e];if(i){if(i[n]&&-1!==i[n].indexOf(t)){var a=Events.finalIdsJson[e][n].indexOf(t);delete Events.finalIdsJson[e][n][a]}i&&0==Object.keys(i[n]).length&&delete Events.finalIdsJson[e][n],i&&0==Object.keys(i).length&&delete Events.finalIdsJson[e]}}))},formatInvDetailsToFinalIdsJson:function(e){var t=returnJson||Events.returnJson,n=e?e.inviteeDetails:t.inviteeDetails;Events.finalIdsJson={},"create"==Events.currentStatus?n.forEach((function(e){var t=Events.finalIdsJson[e.id],n=e.type[0].toLowerCase();t?-1===t.indexOf(n)&&t.push(n):Events.finalIdsJson[e.id]=[n]})):n.forEach((function(e){if("Email"===e.type){var t=e.name;Events.finalIdsJson[t]={},Events.finalIdsJson[t].e=[t]}else Events.finalIdsJson[e.id]=e.invTypeOfCurrUser}))},convertIntoResetCntJsonFormat:function(e){var t={};for(invType in e){var n=0,i=e[invType];if(0!==Object.keys(i).length&&("u"!=invType||"c"!=invType||"l"!=invType)){for(typeId in i)n+=i[typeId].length;t[invType]=n}}return t},convertIntoResponseFormat:function(e,t){var n={};if("l"==t||"c"==t||"u"==t||"e"==t)return e;for(var i in e){var a=e[i];if(0==Object.keys(a).length)n[i]={};else for(var r in a){var s;s="u"==i||"l"==i||"c"==i||"e"==i?[r]:Events.invTypeVsUserIdsMap[i][r],n[i]||(n[i]={}),n[i][r]=s}}return n},invitationLimitValidation:function(e,t,n,i,a,r){var s=$(".beforeAdd"),o=$("#invListDiv_"+t),l=$(".eventInvitationInfo-alert"),d=$("#showInviteeslimitalert"),c=$("#addpartCheckbox");Events.inviteeslimit==Events.selInviteesCnt&&Events.isFutureEvent()||Events.selInviteesCnt==Events.pastEventInvCnt&&!Events.isFutureEvent()?(Events.remainingInvitees=0,Events.invReached=!0,c.is(":checked")||c.attr("disabled","disabled"),Events.positionEmailTextBox(n,t,o,r),l.show(),d.text(I18n.getMsg("crm.event.participant.limit",Events.inviteeslimit)),s.attr("disabled",!0),Events.enableDisableEmailListBox(!0),n||Events.enableDisableDoneButton(!1)):Events.inviteeslimit<Events.selInviteesCnt&&Events.isFutureEvent()||Events.selInviteesCnt>Events.pastEventInvCnt&&!Events.isFutureEvent()?("onChange"!=i&&"onScroll"!=i&&e&&0!=a&&Events.showInvExceedPopup(),Events.positionEmailTextBox(n,t,o,r),c.is(":checked")||c.attr("disabled","disabled"),Events.enableDisableParticipantsDropDown(!1,!1),l.show(),d.text(I18n.getMsg("crm.event.participant.limit",Events.inviteeslimit)),s.attr("disabled",!0),Events.enableDisableEmailListBox(!0),Events.enableDisableDoneButton(!0)):e||(Events.remainingInvitees=Events.pastEventInvCnt-Events.selInviteesCnt,Events.isFutureEvent()&&(Events.remainingInvitees=Events.inviteeslimit-Events.selInviteesCnt),c.attr("disabled",!1),Events.invReached=!1,l.hide(),Events.positionEmailTextBox(n,t,o,r),s.attr("disabled",!1),Events.enableDisableEmailListBox(!1),Events.inviteeslimit>Events.selInviteesCnt&&!n&&Events.enableDisableParticipantsDropDown(!1,!1),Events.enableDisableDoneButton(!1))},positionEmailTextBox:function(e,t,n,i){e||0==i||"c"!=t&&"l"!=t||("rc"==$("#invFilterDropDown").val()?$("#invListDiv_rc").attr("style","height:188px !important"):n.attr("style","height:188px !important"))},enableDisableEmailListBox:function(e){var t=$("#invEmailsListBox");$("#invEmailsListBox input").attr("disabled",e),t.css("background-color","var(--bg_white)"),e&&t.css("background-color","var(--infoBgColor)")},enableDisableDoneButton:function(e){$("#doneAddParticipantBtn").attr("disabled",e),$("#doneViewPartFromDetail").attr("disabled",e)},enableDisableParticipantsDropDown:function(e,t,n){e=Events.isBothStatusSame(e,n);var i=$("#invFilterDropDown"),a=i.parent();i.prop("disabled",e),a.css({opacity:"1"}),t&&a.css({opacity:"0.5"}),$("#invFilterTextBox").prop("disabled",e)},isBothStatusSame:function(e,t){return Events.selInviteesCnt>=0&&$("#selectedInviteesEmpty").hide(),t?-1==$(".invAncSel").html().indexOf("All")&&(-1!=$(".invAncSel").html().indexOf("Selected")||void 0):e},showInvExceedPopup:function(){networkUtils.loadFeatureScripts(["zohocrm_invitationExceedPopup.js"],(function(){var e=document.createElement("DIV");e.innerHTML=Handlebars.templates.InvitationExceedPopup(),document.body.appendChild(e);var t=$("#invExceedMsg");t.length>0&&""==t[0].innerHTML&&(t[0].innerHTML=I18n.getMsg("crm.event.participant.limit.htmldetail",Events.inviteeslimit));var n=$("#invitationExceedPopup"),i=(renderingUtils.windowHeight-n.height()-70)/2;n.attr("style","top:"+i+"px !important"),crmui.showPopup({id:"invitationExceedPopup"}),$(".freezeLayer_zi32").length<1&&$(".bodycontainer,.commonRightPanel").append('<div class="freezeLayer_zi32 zi34"></div>'),$(".freezeLayer_zi32").show()}))},removeSelectedOptionFromExceededPopup:function(){var e=$("#invFilterDropDown").val(),t=e||Events.selectedOption;Events.invitationLimitValidation(!0,t,Events.isFromSel),$("#invitationExceedPopup").hide(),$(".freezeLayer_zi32").hide()},completeMultipleInviteesSelectRequest:function(e,t,n){Events.totalReqSent=Events.totalReqSent<=0||Events.totalReqSent-e<=0?0:Events.totalReqSent-e,0==Events.totalReqSent&&(Events.enableDisableDoneButton(!1),t?Events.enableDisableParticipantsDropDown(!0,!0,n):Events.enableDisableParticipantsDropDown(!1,!1,n),Events.enableDisableEmailListBox(!1)),Events.inviteeslimit==Events.selInviteesCnt&&(Events.enableDisableEmailListBox(!0),t||Events.enableDisableParticipantsDropDown(!1,!1,n)),Events.inviteeslimit>Events.selInviteesCnt&&(Events.enableDisableEmailListBox(!1),Events.enableDisableParticipantsDropDown(!1,void 0,n),t&&0==Events.totalReqSent&&Events.enableDisableParticipantsDropDown(!0,!1,n),Events.enableDisableDoneButton(!1))},initializeMultipleInviteesSelectRequest:function(){Events.totalReqSent=Events.totalReqSent+1,Events.enableDisableParticipantsDropDown(!0,!0),Events.enableDisableDoneButton(!0),Events.enableDisableEmailListBox(!0)},saveParticipantFromView:function(e,t,n,i,a){if(Events.validateEmailIdsInTagit()){var r=(c="quickView"===e?Events.currentEventObjectInQV:Events.currentEventObjectInView).id;if(n)Events.showSendMailAlert(c,!0,e,a);else{var s=$L.moment(c.start).toDate().getTime(),o=$L.moment().toDate().getTime();if(Events.invAddJson&&s>o)for(key in Events.invAddJson)if(Object.keys(Events.invAddJson[key]).length>0&&Lyte.registeredMixins["crm-email-auth-util"].showPopUpForEventModule("sendInvite"))return;commonUtils.showHideLoadingDiv(!0);var l=Crm.getCrmBasePath()+"/AddInvitees.do",d="pageno=0&eventId="+r;Events.invAddJson.e=Events.addInvEmailsList,Events.invRemoveJson.e=Events.removeInvEmailsList;var c,v=1==Events.sendNotificationMail?"1":"0";d+="quickView"==e?"&calledFrom="+e+"&action=addInvfromQV&invAddJson="+encodeURIComponent(JSON.stringify(Events.invAddJson))+"&invRemoveJson="+encodeURIComponent(JSON.stringify(Events.invRemoveJson)):"&calledFrom="+e+"&eventStatus="+v+"&action=addInvfromDetail&invAddJson="+encodeURIComponent(JSON.stringify(Events.invAddJson))+"&invRemoveJson="+encodeURIComponent(JSON.stringify(Events.invRemoveJson))+"&invStatus="+$("#invStatusFilter").val()+"&"+trimBoth($("#viewInviteesSearchTxt").val()),Crm.requestParam&&Crm.requestParam.isCancelMailNeeded&&(d+="&isCancelMailNeeded="+Crm.requestParam.isCancelMailNeeded),i&&(d+="&isNeedupdateStatus="+i),a&&(d+="&responsePage="+a),d+="&"+csrfParamName+"="+encodeURIComponent(csrfToken),$.ajax({url:l,type:"POST",data:d,success:function(n){if(commonUtils.showHideLoadingDiv(),-1==n.indexOf("error")){if("detailView"==e)t&&"viewInvitees"!==a?(Events.closeViewInviteesPop(),Crm.renderDVLyteFlow("Events")&&"detail"===Lyte.Router.getRouteInstance().routeName?Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView():reloadCurrentEntityView()):(Events.closeEntity(),renderingUtils.freezeBackground(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0,Events.loadViewInviteesPopDiv(),$("#viewInviteesPop")[0].innerHTML=n,EvalInnerScript($("#viewInviteesPop")[0]),$("#addInvFromDetCont").html(""),Events.initViewInviteesPop(),$("#doneBtnQuickView").hide()),Events.selInviteesCnt=0;else if("quickView"==e){$("#eventViewPopup").offset().top;var r=parseInt($("#quickViewRelDivCont").prev().css("top"),10),s=parseInt($("#quickViewRelDivCont").parent().css("top"),10);if("viewInvitees"===a)Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0,$("#qvInvitedListDivInner").empty(),$("#qvInvitedListDivInner")[0].innerHTML=n,EvalInnerScript($("#qvInvitedListDivCont")[0]),$("#addInvFromDetCont").html(""),Events.initViewInviteesPop(),$("#qvAddInvFoterBtns_fromView").hide(),$("#doneBtnQuickView").show(),$("#doneBtnDetailsView").hide();else{var o=parseInt(n),l=$("#value_Participants").find(".invited");if(0==o)l.html(I18n.getMsg("None")),l.addClass("invNone"),$("#textarea_Participants").hide();else{l.removeClass("invNone"),l[0].setAttribute("onclick","Events.viewInviteesPop(-2, undefined, 'quickView')"),l.text(I18n.getMsg("crm.create.inv.cnt.label",[o]));(["1","2","3","4"].indexOf(c.status)>-1||i)&&($("#textarea_Participants").find(".invitedSt").text("("+o+")"),$("#textarea_Participants").css({display:"block"}))}$("#qvAddInvFoterBtns").hide(),$("#qvAddInvFoterBtns_fromView").hide(),$("#qv_editBtnDiv").show(),$("#qvAddInvFoterBtns").hide(),$("#quickViewRelDivCont").animate({height:"305px"},500),$("#quickViewRelDivCont").parent().animate({top:s+125},500),$("#quickViewRelDivCont").prev().animate({top:r-125},500),$("#qvParticipantDivCont").show().animate({left:"440px"},500),$("#quickViewMainDiv").animate({left:"0"},500,(function(){$("#qvParticipantDivInner").html("")})),Events.resetEntityVars()}}thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),Events.addInvEmailsList={},Events.removeInvEmailsList={},Events.selInvlinkClicked=!1,Events.invAddLinkClicked=!1,Events.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.maxReminderValue=1,Events.reminderCount=1,Events.allDayReminders=[],Events.reminders=[],Events.showDuplicateContView=[]}else{var d=JSON.parse(n);crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(d.errMsg)),1e3)}}})}}},donePartViewFromQuickView:function(){$("#qvDoneParViewFoterBtns").hide(),$("#qvInvitedListDivCont").show().animate({left:"440px"},500),$("#qv_editBtnDiv").show(),$("#quickViewMainDiv").animate({left:"0"},500),Events.invAddLinkClicked=!1},loadMap:function(e,t,n){var i=encodeURIComponent(e),a="https://maps.google.com/maps?q="+i,r="https://maps.google.com/maps?q=to:"+i;$("#event_map_loc").html($ESAPI.encoder().encodeForHTML(e)),$("#eventDetail_MapDiv .viewMap").attr("href",a),$("#eventDetail_MapDiv .getDir").attr("href",r);var s="https://maps.googleapis.com/maps/api/staticmap?center="+i+"&zoom=13&size="+t+"x"+n+"&sensor=false";$("#event_static_map").attr("src",s);var o=$("#event_map_bubDiv"),l=o.outerWidth(),d=(t-l)/2;o.css({left:d});var c=$("#eventDetail_MapDiv .mapPointer"),v=l/2-c.outerWidth()/2;c.css({left:v})},setEditOption:function(e,t){Crm.requestParam.eventEditOption=t,Events.validateEntity(e,!0,!1)},editRecurringAlert:function(e,t,n,i,a){if(Crm.isRecordModified||n){var r=t.id+"";$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"GET",data:"type=getLastOccurrenceId&eventId="+r+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(s){if(trimBoth(s)!==r){Events.loadEditRecAlertMsgDiv(),renderingUtils.positionCenter("editRecAlertMsgDiv");var o=$("#editRecAlertMsgDiv");crmui.modalZIndex("nonLyte",o[0],"open"),o.find(".allUpCome").prop("disabled",!1).off("click").click((function(){var a=$L("#editRecAlertMsgDiv");crmui.modalZIndex("nonLyte",a[0],"close"),a.hide(),e?calView.saveEventDrop(t,n,!0):Events.setEditOption(i,"allUpCome"),renderingUtils.removeDummyBackground()})),o.find(".onlyThis").prop("disabled",!1).off("click").click((function(){var a=$L("#editRecAlertMsgDiv");crmui.modalZIndex("nonLyte",a[0],"close"),a.hide(),e?calView.saveEventDrop(t,n,!1):Events.setEditOption(i,"onlyThis"),renderingUtils.removeDummyBackground()})),o.find(".cancel").prop("disabled",!1).off("click").click((function(){var t=$L("#editRecAlertMsgDiv");crmui.modalZIndex("nonLyte",t[0],"close"),t.hide(),e&&n(),renderingUtils.removeDummyBackground()})),renderingUtils.dummyBackground(!1,"editRecAlertMsgDiv"),o.find(".allUpCome").focus(),o.show()}else e?calView.saveEventDrop(t,n,!1):Events.showSendMailAlert(a)&&(void 0===i?Events.saveEntity(void 0,!0,!0):Events.saveEntity(i,!0,!0))}})}else Events.showSendMailAlert(a)&&(void 0===i?Events.saveEntity(void 0,!0,!0):Events.saveEntity(i,!0,!0))},getDateTimeInRespFormat:function(e){var t=e.split(" ");return t[0]+" "+t[1]+" "+t[2]+" "+t[3]+" "+t[4]},getUserFormat:function(e){var t=e.split(" "),n=t[t.length-1].split(":"),i=n[0]+":"+n[1];if("HH:mm"===Crm.userDetails.TIME_FORMAT)return i;var a=n[0]<12?" AM":" PM";return" PM"===a?n[0]=n[0]<=12?n[0]:n[0]-12:" AM"===a&&("0"!==n[0]&&"00"!==n[0]||(n[0]=12)),n[0]+":"+n[1]+a},changeTime:function(e,t,n,i,a,r,s,o){encodeURIComponent("Start DateTime"),encodeURIComponent(t),encodeURIComponent(n),csrfParamName,encodeURIComponent(csrfToken);var l="/crm/v2/Events/"+e+"?affected_data=true",d={},c={},v=[],m="Events";if("Events"===a.activityType){var u=Crm.userDetails.TIME_ZONE.split(".");u=u[0]+":"+u[1],c.Start_DateTime=apiDateTimeFormat(t)+u,c.End_DateTime=apiDateTimeFormat(n)+u,c.All_day="true"===i||!0===i,d.update_all_future_events=r||!1}else"Calls"===a.activityType&&(l="/crm/v2/Calls/"+e+"?affected_data=true",c={},m="Calls",o?("module=Calls&uitype=786&tableName=CrmTask&moduleid="+e+"&type=scheduleCallUpdate&itsFrom=calendarView&fieldLabel="+encodeURIComponent("Call Status")+"&fieldValue=Scheduled&columnName=CALLSTATUS&tableName1=CrmTask&fieldLabel1="+encodeURIComponent("Call Start Time")+"&columnName1=CALLSTARTDATETIME&fieldValue1="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),c.Call_Status="Scheduled",c.Call_Start_Time=apiDateTimeFormat(t)):("module=Calls&uitype=786&tableName=CrmTask&columnName=CALLSTARTDATETIME&moduleid="+e+"&fieldLabel="+encodeURIComponent("Call Start Time")+"&fieldValue="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),c.Call_Start_Time=apiDateTimeFormat(t)));a.cancelMail&&("&cancelMail="+a.cancelMail,c.Send_Notification_Email=a.cancelMail),r||(r=!1),null!=a.futureToPast&&a.futureToPast;var p=$("#loadedCalendarUserIds").val();p&&"null"!==p||(p=""),encodeURIComponent(p),v.push(c),d.data=v;var E={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(E["X-CRMPORTAL"]=window.clientPortalName),$.ajax({url:l,type:"PUT",data:JSON.stringify(d),headers:E,contentType:"application/json",success:function(e){if("error"===e.data.status)e="error";else if((e={}).startFormatted=a.startFormatted,e.invitedby=a.invitedby,e.editable=a.editable,e.start=Events.getDateTimeInRespFormat(a.start.toString()),e.title=a.title,e.ownerId=a.ownerId,e.duration=a.duration,e.isRecEvent=a.isRecEvent,e.cus_allDay=a.cus_allDay,e.endFormatted=a.endFormatted,e.end=Events.getDateTimeInRespFormat(a.end.toString()),e.onlineEvent=a.onlineEvent,e.id=a.id,e.isInvitedEvent=a.isInvitedEvent,e.activityType=a.activityType,e.startInUserFormat=Events.getUserFormat(e.start),e.endInUserFormat=Events.getUserFormat(e.end),"Events"===m){e.toolTip=e.title+"<br><span class='ttLowercase'>"+e.startInUserFormat+" - "+e.endInUserFormat+"</span>",e.color=a.color,$(".remainderList").find("#"+e.id).remove(),$("#reminderContent").html("");var t=$("#notificationCount"),n=t.text();n-=1,$("#reminder_notification").text(n).show(),t.text(n).show(),Activities.notifyCountToCrmPlusFrame(n),Activities.reminderCount=0,Activities.reminderList=""}else e.toolTip=e.title+"<br><span class='ttLowercase'>"+e.startInUserFormat+"</span>";if(renderingUtils.positionCenter("bulkUpdateSuccess"),"Calls"===a.activityType?showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.call.re.schedule.success.msg"),1e3):"error"!==e?showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.event.edit.success.msg",[Events.getModuleName(!0,!0,!0)]),1e3):showAlertMessage("bulkUpdateSuccess",!1,I18n.getMsg("crm.event.edit.error.msg",[Events.getModuleName(!0,!1,!0)]),500),!calView.isMultiUserView){$.datepicker.formatDate("yy-mm-dd",new Date(calView.currEventObject.start)),$.datepicker.formatDate("yy-mm-dd",new Date(a.start));if(r)calView.needRefresh=!0;else if("monthview"===calView.currCalView){if(Events.isRefreshNeeded(calView.currEventObject,a,!0))calView.needRefresh=!0;else{var s=e;i&&(s.durationEditable=!1),calView.needRefresh=!0}}else{s=e;i&&(s.durationEditable=!1),calView.needRefresh=!0}calView.needRefresh&&calView.refresh()}calView.currEventObject=void 0},error:function(e){e.status===crmConstants.errorStatusCode&&s&&s()}})},loadTileForDayCal:function(e,t){if(getElemById("allUserTbl")){var n=$L("#multiUsrScroll").scrollTop();if((Events.calScrollYval!==n||e)&&(Events.calScrollYval=n,!Events.isAllUsersLoaded&&!Events.scrollOnSetHTML||e)){Events.isUsersLoadReqSent=!0;var i="";if(e?(Events.tileLoadingUserId=e,i="&userId="+e):Events.tileLoadingUserId="",t){i+="&isTailLoadCall=true";var a=$("#loadedUserIds").val();a&&"null"!==a&&void 0!==a&&(i=i+"&idStr="+a);var r=$("#loadedUserViewType").val(),s="MYEVENT";"user"===r?s="u":"group"===r?s="g":"territory"===r?s="t":"ALLEVENT"===r&&(s="ALLEVENT"),i+="&calViewType="+s}var o=crmCalendar.calcTDWidth(calView.currCalView),l=$("#topdivbg"),d=Math.ceil((renderingUtils.windowHeight-(l.length>0?l.height():0)-100)/100)+2;mR(Crm.getCrmBasePath()+"/events/CalendarView.do?type="+calView.currCalView+"&userCalView="+getElemById("selUser").value+"&obtaineddate="+getElemById("obtaineddate").value+"&pageNo="+Events.tilePageNo+i+"&tdWidthParam="+o+"&userFetchCnt="+d,Events.reConstructTileForDayCal)}}else window.onscroll=null},reConstructTileForDayCal:function(e){if(""===Events.tileLoadingUserId){var t=$L("#multiUsrScroll").scrollTop();$("#allUserTbl").fixedHeaderTable("destroy"),Events.calHTML+=e,$("#allUserTbl").html(Events.calHTML),$(".fht-fixed-column").remove();var n=Events.getWidgetHeight();(r=getElemById("allUserTbl").offsetHeight-4)<n&&(n=r),$("#allUserTbl").fixedHeaderTable({footer:!1,cloneHeadToFoot:!0,fixedColumn:!0,height:n,create:function(){$("#multiUsrScroll .fancyTable tbody").find("tr").each((function(e,t){$(this).attr("event_row_idx",e+1),(e+1)%2==0&&$(this).attr("class","evenrow")})),$("#multiUsrScroll2 .fancyTable tbody").find("tr").each((function(e,t){$(this).attr("event_row_idx",e+1),(e+1)%2==0&&$(this).attr("class","evenrow")})),$L("#multiUsrScroll").scrollTop(t)}}),Events.scrollOnSetHTML=!1,setTimeout((function(){Events.moveMultiUserCal(!0,Events.multiUserDayScrollTime)}),0),$(".fht-tbody").height(n-20+"px"),$(".fht-fixed-body .fht-tbody").on("mousemove",(function(e){Events.showNaviForMultiUserCal(e,this)}))}else if(getElemById("userRow_"+Events.tileLoadingUserId)){var i=getElemById("userRow_"+Events.tileLoadingUserId).getAttribute("event_row_idx"),a=getElemById("userRow_"+Events.tileLoadingUserId).offsetHeight,r=getElemById("allUserTbl").offsetHeight-4;if($("tr#userRow_"+Events.tileLoadingUserId).replaceWith(e),getElemById("userRow_"+Events.tileLoadingUserId).setAttribute("event_row_idx",i),$("tr[event_row_idx='"+i+"']").css("height",a+"px"),$("tr[event_row_idx='"+(parseInt(i)-Events.totalUsersCount)+"']").css("height",a+"px"),$('span[id^="userEventCnt_"]',$("tr[event_row_idx='"+parseInt(i)+"']")).each((function(e){this.innerHTML=$('span[id^="userEventCnt_"]',$("#userRow_"+Events.tileLoadingUserId))[0].innerHTML})),"dayview"===calView.currCalView)r<(n=Events.getWidgetHeight())&&(n=r),$(".fht-tbody").height(n+"px"),$("#allUserTbl").fixedHeaderTable({height:n})}JSEvalScript(getElemById("allUserTbl")),Events.isUsersLoadReqSent=!1,Events.isAllUsersLoaded||""!==Events.tileLoadingUserId||Events.tilePageNo++},callMonthCalScroller:function(e,t,n){if($("div#monthUserList_"+e+" dl").length>5){if(n||(n=$L("#monthUserCont_"+e).scrollTop()),!t){var i=$("div#monthUserList_"+e+" dl");(i.length-5)*(i[0].offsetHeight+3)>n+i.length?($("#usrMoreDown_"+e).show(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDown")):($("#usrMoreDown_"+e).hide(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDownSm"),Events.callMonthCalScrollLoader(e,n))}t&&(n>15?($("#usrMoreUp_"+e).show(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUp")):($("#usrMoreUp_"+e).hide(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUpSm"),Events.callMonthCalScrollLoader(e,n)))}},callMonthCalScrollLoader:function(e,t){if($("div#monthUserList_"+e+" dl").length>5){t||(t=$L("#monthUserCont_"+e).scrollTop());var n=$("div#monthUserList_"+e+" dl");(n.length-5)*(n[0].offsetHeight+3)>t+n.length?($("#usrMoreDown_"+e).show(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDownSm")):$("#usrMoreDown_"+e).hide(),t>15?($("#usrMoreUp_"+e).show(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUpSm")):$("#usrMoreUp_"+e).hide()}},showConfirmForModify:function(e,t,n,i,a){var r=t.id;$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=getInvitedCnt&eventId="+r,type:"GET",success:function(r){if(parseInt(r)>0){Events.loadInvitationConfirmDiv();var s=$("#invitationConfirmDiv"),o=s.find(".msgBody"),l=s.find(".msgTitle"),d=s.find(".send").prop("disabled",!1),c=s.find(".dntSend").prop("disabled",!1),v=s.find(".cancel").prop("disabled",!1);if(l.hide(),e){d.val(I18n.getMsg("crm.event.btn.notify.part")),c.val(I18n.getMsg("crm.event.btn.dnt.notify.part")).show();var m=$ESAPI.encoder().encodeForHTML(t.title);o.html(I18n.getMsg("crm.future.to.past.msg",[m])),v.show(),d.off("click").click((function(r){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",s[0],"close"),s.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),i?a?a():(t.futureToPast=e,t.cancelMail="true",calView.saveEventDrop(t,n)):a?a():Events.validateEntity(r,!0,!1))})),c.off("click").click((function(r){crmui.modalZIndex("nonLyte",s[0],"close"),s.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),i?a?a():(t.futureToPast=e,t.cancelMail="false",calView.saveEventDrop(t,n)):a?a():Events.validateEntity(r,!0,!1)})),v.off("click").click((function(e){i&&n(),crmui.modalZIndex("nonLyte",s[0],"close"),s.hide(),renderingUtils.removeDummyBackground()}))}else d.val(I18n.getMsg("crm.button.send")),c.val(I18n.getMsg("crm.cancel.this.change")).show(),o.text(I18n.getMsg("crm.past.to.future.msg")),v.hide(),d.off("click").click((function(r){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",s[0],"close"),s.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),i?a?a():(t.futureToPast=e,calView.saveEventDrop(t,n)):a?a():Events.validateEntity(r,!0,!1))})),c.off("click").click((function(e){i&&n(),crmui.modalZIndex("nonLyte",s[0],"close"),s.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground()}));if(null!=t.sourceid&&e)return c.click(),!0;var u=s.attr("id");return renderingUtils.dummyBackground(!1,u),mailsetCenter(u),s.show(),crmui.modalZIndex("nonLyte",s[0],"open"),d.focus(),!0}i?a?a():calView.saveEventDrop(t,n):a?a():Events.validateEntity(event,!0,!1)}})},handleEvtDelinMulUserWeekView:function(e){var t=getElemById("dCMU_"+e).getAttribute("host");Events.loadTileForDayCal(t)},handleEvtAddinMulUserWeekView:function(e,t,n){t&&t.host!==n.host&&Events.loadTileForDayCal(t.host),setTimeout((function(){var e=n.host;e||(e=n.ownerId),getElemById("userRow_"+e)&&Events.loadTileForDayCal(e)}),500)},handleEvtDelinMulUserDayView:function(e){var t=getElemById("dCMU_"+e).getAttribute("host");Events.loadTileForDayCal(t)},handleEvtAddinMulUserDayView:function(e,t,n){t&&t.host!==n.host&&Events.handleEvtDelinMulUserDayView(e),setTimeout((function(){var e=n.host;e||(e=n.ownerId),getElemById("userRow_"+e)&&Events.loadTileForDayCal(e)}),500)},handleEvtDelinMulUserMonthView:function(e){var t=getElemById("dCMU_"+e),n=parseInt(t.getAttribute("idx")),a=parseInt(t.getAttribute("eventDur"));for(i=1;i<a;i++){var r=getElemById("dCMU_"+e+"_"+(n+i));r&&r.parentNode.removeChild(r)}t.parentNode.removeChild(t)},handleEvtAddinMulUserMonthView:function(e,t,n){t&&Events.handleEvtDelinMulUserMonthView(e);var a=n.host;a||(a=n.ownerId),t&&t.color!==n.color&&calView.refresh();var r=new Date(n.start),s=new Date(n.end),o=(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),new Date(n.start)),l=new Date(n.end),d=(new Date,r.getHours()),c=(r.getMinutes(),s.getHours(),s.getMinutes(),n.allday),v=n.title,m=v;m.length>25&&(m=m.substring(0,22)+"..."),o.setHours(0),o.setMinutes(0),o.setSeconds(0),l.setHours(0),l.setMinutes(0),l.setSeconds(0),Events.monthStartDate.setHours(0),Events.monthStartDate.setMinutes(0),Events.monthStartDate.setSeconds(0),Events.monthEndDate.setHours(0),Events.monthEndDate.setMinutes(0),Events.monthEndDate.setSeconds(0);var u=Math.ceil((l.getTime()-o.getTime())/864e5);o.getTime()<Events.monthStartDate.getTime()&&(o=Events.monthStartDate);var p=Events.monthStartDate.getTime(),E=Events.monthEndDate.getTime(),g=o.getTime(),h=n.end;if(g>p&&h<E||h<E&&h>p||g<E&&g>p){var f=Math.ceil((o.getTime()-Events.monthStartDate.getTime())/864e5);o.getTimezoneOffset()!=Events.monthStartDate.getTimezoneOffset()&&calView.refresh(),l.getTime()>Events.monthEndDate.getTime()&&(l=Events.monthEndDate);var I=l.getTime()===o.getTime()?0:Math.ceil((l.getTime()-o.getTime())/864e5);++I>42&&(I=42);var C=c?"wAllday cmLdl":u>0?"wMutipleDay cmLdl":"",_="";if(!c){var w=(U=r.getHours())<13?" AM":" PM";U=(U=0===(U=U>13?U-12:U)?12:U)<10?"0"+U:U;var y=(O=s.getHours())<13?" AM":" PM";O=(O=0===(O=O>13?O-12:O)?12:O)<10?"0"+O:O;var M=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+U+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+w,D=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+O+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+y,T=M.split(" "),R=D.split(" ");_=o-l!=0?T[1]+" "+T[2]:T[1]+" "+T[2]+" - "+R[1]+" "+R[2]}(k=document.createElement("dl")).setAttribute("stHr",r.getHours()),k.setAttribute("stMin",r.getMinutes()),k.setAttribute("idx",f),k.setAttribute("id","dCMU_"+e),k.setAttribute("stMin",r.getMinutes()),k.setAttribute("eventCont",!1),k.setAttribute("eventDur",I);var A=document.createElement("img");if("Unavailable"==n.activityType?(k.setAttribute("onclick","Events.showUnavailablePopUp('"+e+"',this, event,'"+n.host+"','monthview')"),A.src="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+n.zuid+"&fs=thumb"):(k.setAttribute("onclick","Events.eventQuickView('"+n.activityType+"', '"+e+"', this, event, false, false, false, '"+n.invitedby+"')"),A.src=Events.userImgSrc),k.style.position="relative",k.className=C,k.classList.add("cmLdl"),k.classList.add("event-title-padding"),(V=document.createElement("dt")).setAttribute("class","cmLdt"),A.title=n.hostName,V.appendChild(A),(x=document.createElement("dd")).setAttribute("class","cmLdd"),(B=document.createElement("span")).innerText=m,B.title=v,x.appendChild(B),3===Crm.calPreferences.ACTIVITYTYPE&&"Calls"===n.activityType){var b=document.createElement("div");$(b).addClass("fc-schedule-call"),x.appendChild(b)}var S=document.createTextNode(_),N=document.createElement("br");if(x.appendChild(N),(F=document.createElement("span")).setAttribute("class","ttLowercase"),F.appendChild(S),x.appendChild(F),k.appendChild(V),k.appendChild(x),0===(H=$("div#monthUserList_"+f+" dl")).length)getElemById("monthUserList_"+f).appendChild(k);else{var P=!1;for(i=0;i<H.length;i++){var L=H[i];if((U=parseInt(L.getAttribute("stHr")))>(d=r.getHours())){getElemById("monthUserList_"+f).insertBefore(k,L),P=!0;break}if(U===d&&parseInt(L.getAttribute("stMin"))>=r.getMinutes()){getElemById("monthUserList_"+f).insertBefore(k,L),P=!0;break}}P||getElemById("monthUserList_"+f).appendChild(k)}if(I>1)for(j=1;j<I;j++){var k;_="";if(!c&&I===j+1){var U;w=(U=r.getHours())<13?" AM":" PM";U=(U=0===(U=U>13?U-12:U)?12:U)<10?"0"+U:U;var O;y=(O=s.getHours())<13?" AM":" PM";O=(O=0===(O=O>13?O-12:O)?12:O)<10?"0"+O:O;M=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+U+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+w,D=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+O+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+y,T=M.split(" ");_=" ends "+(R=D.split(" "))[1]+" "+R[2]}(k=document.createElement("dl")).setAttribute("stHr",r.getHours()),k.setAttribute("stMin",r.getMinutes()),k.setAttribute("idx",f),k.setAttribute("id","dCMU_"+e+"_"+(f+j)),k.setAttribute("stMin",r.getMinutes()),k.setAttribute("eventCont",!1),k.setAttribute("eventDur",I);var V,x,B;A=document.createElement("img");if("Unavailable"==n.activityType?(k.setAttribute("onclick","Events.showUnavailablePopUp('"+e+"',this, event,'"+n.host+"','monthview')"),A.src="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+n.zuid+"&fs=thumb"):(k.setAttribute("onclick","Events.eventQuickView('"+n.activityType+"', '"+e+"', this, event, false, false, false, '"+n.invitedby+"')"),A.src=Events.userImgSrc),k.style.position="relative",k.className=C,k.classList.add("cmLdl"),k.classList.add("event-title-padding"),(V=document.createElement("dt")).setAttribute("class","cmLdt"),A.title=n.hostName,V.appendChild(A),(x=document.createElement("dd")).setAttribute("class","cmLdd"),(B=document.createElement("span")).innerText=m,B.title=v,x.appendChild(B),3===Crm.calPreferences.ACTIVITYTYPE&&"Calls"===n.activityType){b=document.createElement("div");$(b).addClass("fc-schedule-call"),x.appendChild(b)}var F,H;S=document.createTextNode(_),N=document.createElement("br");x.appendChild(N),(F=document.createElement("span")).setAttribute("class","ttLowercase"),F.appendChild(S),x.appendChild(F),k.appendChild(V),k.appendChild(x),0===(H=$("div#monthUserList_"+(f+j)+" dl")).length?getElemById("monthUserList_"+(f+j)).appendChild(k):getElemById("monthUserList_"+(f+j)).insertBefore(k,H[0])}}},setStatus:function(e){this.currentStatus=e},getStatusObj:function(e,t){var n=Events.statusDropDownObj,i=parseInt(e);i&&i>8&&(i=parseInt(i)-10);return 0===i?(n=[Events.statusDropDownObj[0],Events.statusDropDownObj[1]],t&&(n=n.slice(0,1))):-1===i?n=[Events.statusDropDownObj[2]]:1===i&&(n=[Events.statusDropDownObj[1],Events.statusDropDownObj[2]],t&&(n=n.slice(0,1))),n},moveMultiUserCal:function(e,t){if(Events.mouseStillDown||t){var n=null;"dayview"===calView.currCalView&&(t||(Events.isMultiUserDayScrolled=!0)),n=Events.tdWidth+1,t&&(n*=t),"weekview"===calView.currCalView&&(n=0),e?t?$(".fht-table-wrapper .fht-tbody").scrollLeft(n):($(".fht-table-wrapper .fht-tbody").animate({scrollLeft:"+="+n+"px"},200),Events.multiUserDayScrollTime<18&&(Events.multiUserDayScrollTime+=1)):t?$(".fht-table-wrapper .fht-tbody").scrollLeft(n):($(".fht-table-wrapper .fht-tbody").animate({scrollLeft:"-="+n+"px"},200),Events.multiUserDayScrollTime>0&&(Events.multiUserDayScrollTime-=1))}else clearInterval(Events.multiUserCalMovement)},showMoreEvents:function(e,t,n){getElemById("moreEvent_"+e+"_"+t);var a=$("div#moreEvent_"+e+"_"+t+" p"),r=$("#moreEventLink_"+e+"_"+t).offset(),s=getElemById("event_"+e+"_"+t).offsetWidth,o=$("#showMoreEventsDIV").outerHeight(),l=window.innerHeight,d=document.body.clientHeight;$("#showMoreEventsDIV").find("p").each((function(){$(this).remove()}));var c=$("#wid_calCreate_opts_menu");c.is(":visible")&&c.hide();var v=getElemById("showMoreEventsDIV");let m=[];for(i=0;i<a.length;i++)if(!m.includes(a[i].id)){m.push(a[i].id);var u=a[i].cloneNode(!0);if(v.appendChild(u),9===i&&a.length>10){var p=document.createElement("p");$(p).addClass("andMoreEv"),p.innerHTML=I18n.getMsg("crm.events.calender.multiUser.month.moreEvents",[a.length-10]),v.appendChild(p);break}}v.style.display="block",v.style.left=parseInt(r.left-10)+"px",v.style.width=s+"px";var E=n.clientY,g=(n.pageY,(l||d)-E),h=parseInt(r.top)+20;g<o+24&&(h=h-20-o),v.style.top=h+"px",$L("#showMoreEventsDIV")[0].childNodes.forEach((e=>e.style.textAlign="left")),$L("#showAllEventsInnerDIV").scrollTop(0)},hideMoreEvents:function(e,t){getElemById("showMoreEventsDIV").style.display="none"},showAllEvents:function(e,t,n,a){var r=getElemById("showAllEventsInnerDIV");$("#showAllEventsInnerDIV").find("p").each((function(){$(this).remove()})),$("#tempShowEvent_"+e+"_"+t).find("p").each((function(){$(this).remove()}));getElemById("userRow_"+e).getAttribute("username");var s="dayview"===calView.currCalView?getElemById("obtaineddate").getAttribute("dT"):getElemById("weekRowHeader_"+t).getAttribute("dT");getElemById("allEventsPopHeader").innerText=s;var o=$("div#event_"+e+"_"+t+" p"),l=[];for(i=0;i<o.length;i++){if(a){if(l.includes(o[i].id))continue;l.push(o[i].id)}var d=o[i].cloneNode(!0);d.style.position="",d.id="temp_"+o[i].id,d.style.left="",d.style.top="",d.style.marginTop="10px",d.style.cursor="pointer",d.style.position="relative",d.style.width="";var c=d.innerHTML,v=o[i].id.split("_")[1],m=$(o[i]),u=m.attr("mod");"Unavailable"==u?d.setAttribute("onclick",m.attr("onclick")):d.setAttribute("onclick","Events.eventQuickView('"+u+"','"+v+"', this, event, undefined, undefined, true, false)")," "!==c&&"&nbsp;"!==c||(d.innerText=d.getAttribute("dT")),r.appendChild(d)}$L("#showAllEventsInnerDIV")[0].childNodes.forEach((e=>e.style.textAlign="left")),renderingUtils.freezeBackground(),PopSetCenter("showAllEventsDIV"),renderingUtils.stopEvent(n)},closeMoreEventsPop:function(e){getElemById("showAllEventsDIV")&&(getElemById("showAllEventsDIV").style.display="none"),e||removeFreezeLayer2()},showConfirmAlertForMandateonDrop:function(e){var t=$(e.item),n=t.find(".tdW130").text();n=n.substr(0,n.length-1);var i=$("#mandateConfirmBox");i.find(".infoCont").text(I18n.getMsg("crm.event.cancel.required.field",[I18n.getMsg([n]),Events.getModuleName(!0,!0,!0)]));var a=i.find(".confirm"),r=i.find(".cancel");a.val(I18n.getMsg("crm.event.btn.make.non.mandate")),r.val(I18n.getMsg("crm.event.btn.dnt.move.field"));var s=t.prev();a.off("click").click((function(){var e=t.find(".icnSetting");$("#secContent_Event_Additional_Information").append(t),t.attr("section","2"),e.attr("mandate","false"),t.find("sup").html(""),s.length<1&&(s=$(".dummyLiInLayout")),t.insertAfter(s),crmui.modalZIndex("nonLyte",i[0],"close"),i.hide(),renderingUtils.removeDummyBackground()})),r.off("click").click((function(){crmui.modalZIndex("nonLyte",i[0],"close"),i.hide(),renderingUtils.removeDummyBackground()})),$(e.sender).sortable("cancel");var o=i.attr("id");renderingUtils.dummyBackground(!1,o),mailsetCenter(o),i.show(),crmui.modalZIndex("nonLyte",i[0],"open")},showConfirmAlertForMandate:function(e,t){var n=$(renderingUtils.getTargetElem(e));n.closest(".eventActionsMenu").hide();var i=$("#mandateConfirmBox");i.find(".infoCont").html(I18n.getMsg("crm.event.more.mandate.confirm.msg",[$ESAPI.encoder().encodeForHTML(I18n.getMsg([t])),Events.getModuleName(!0,!0,!0),Events.getModuleName(!0,!1,!0)]));var a=i.find(".confirm"),r=i.find(".cancel");a.val(I18n.getMsg("crm.event.btn.move.field")),r.val(I18n.getMsg("crm.event.btn.dnt.mandate")),a.off("click").click((function(){var e=n.closest(".layoutCreate-Drag"),t=n.closest(".icnSetting");$("#secContent_Event_Information").append(e),e.attr("section","1"),t.attr("mandate","true"),e.find("sup").html("*"),crmui.modalZIndex("nonLyte",i[0],"close"),i.hide(),renderingUtils.removeDummyBackground()})),r.off("click").click((function(){crmui.modalZIndex("nonLyte",i[0],"close"),i.hide(),renderingUtils.removeDummyBackground()}));var s=i.attr("id");renderingUtils.dummyBackground(!1,s),mailsetCenter(s),i.show(),crmui.modalZIndex("nonLyte",i[0],"open")},showSendMailAlert:function(e,t,n,i){var a;if(t?(Events.invAddJson.e=Events.addInvEmailsList,Events.invRemoveJson.e=Events.removeInvEmailsList,a=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV:Events.currentEventObjectInView):a=Events.modifyingEvent,Events.sendNotificationMail=!1,"edit"!==Events.currentStatus&&!t||"1"!==a.invMailType||"0"!==a.status){Events.loadInvitationConfirmDiv();var r=$("#invitationConfirmDiv"),s=r.find(".msgBody"),o=r.find(".msgTitle"),l=r.find(".send").prop("disabled",!1),d=r.find(".dntSend").prop("disabled",!1),c=r.find(".cancel").prop("disabled",!1),v=parseInt(e.status),m=!1,u=Events.selInviteesCnt,p=Events.getCountFromInvJson(Events.invAddJson),E=Events.getCountFromInvJson(Events.invRemoveJson);if((p>0||E>0)&&(m=!0),new Date(e.start).getTime()>(new Date).getTime()&&(m||u>0)&&-1!==v){var g="";if(t?"0"===v.toString()&&m?g="createConfirmedEv":p>0&&0===E?g="onlyAddInv":E>0&&0===p?g="onlyRemoveInv":E>0&&p>0&&(g="addAndRemove"):("create"===Events.currentStatus||"clone"===Events.currentStatus)&&u>0||"edit"===Events.currentStatus&&"0"===a.status&&p>0?g="createConfirmedEv":p>0&&0===E?g="onlyAddInv":E>0&&0===p?g="onlyRemoveInv":E>0&&p>0&&(g="addAndRemove"),"createConfirmedEv"===g){if("relatedlist_meetnow"===Events.createSource){Events.status=Crm.userDetails.IS_CONFIRMED_IN_IAM?"1":"0";return Crm.requestParam["property(EventStatus)"]=Events.status,Events.validateEntity(void 0,!0,!0),!1}l.val(I18n.getMsg("crm.button.send")),d.val(I18n.getMsg("crm.button.dont.send")).show(),c.show(),o.html(I18n.getMsg("crm.event.inv.create.alert.msg1")).show(),s.html(I18n.getMsg("crm.event.inv.create.alert.msg2")),l.off("click").click((function(e){if(!Events.showMailVerificationAlert())if(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t)Events.saveParticipantFromView(n,!0,!1,!0,i),renderingUtils.stopEvent(e);else{Events.status="1";Crm.requestParam["property(EventStatus)"]="1",Events.validateEntity(e,!0,!0)}})),d.off("click").click((function(e){if(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),t)Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e);else{Events.status="0";Crm.requestParam["property(EventStatus)"]="0",store.findAll("field",{module:"Events"},!0).then((function(t){t.forEach((function(e){"REMINDINVITEESAT"==e.column_name&&(Events.loadDontSendReminderDiv(),$("#dontSendReminderDivOk").off("click").click((function(e){$("#dontSendReminderDiv").remove()})))})),Events.validateEntity(e,!0,!0)}))}})),c.off("click").click((function(e){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),renderingUtils.removeDummyBackground()}))}else if("onlyAddInv"===g)l.val(I18n.getMsg("crm.button.send")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.button.dnt.add.part")).show(),s.text(I18n.getMsg("crm.event.inv.only.add.alert.msg",[p])),l.off("click").click((function(e){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t?(Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.validateEntity(e,!0,!0))})),d.off("click").click((function(e){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Events.resetParticipantJson(),t?(Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):(Crm.requestParam.invAddJson=JSON.stringify(Events.invAddJson),Events.validateEntity(e,!0,!0))}));else if("onlyRemoveInv"===g)l.val(I18n.getMsg("crm.event.btn.notify.part")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.btn.dnt.notify.part")).show(),s.text(I18n.getMsg("crm.event.inv.only.remove.alert.msg",[E,I18n.getMsg(e.title)])),l.off("click").click((function(e){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="1",t?(Crm.requestParam={},Crm.requestParam.isCancelMailNeeded="1",Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.validateEntity(e,!0,!0))})),d.off("click").click((function(e){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="0",t?(Crm.requestParam={},Crm.requestParam.isCancelMailNeeded="0",Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.validateEntity(e,!0,!0)}));else if("addAndRemove"===g)l.val(I18n.getMsg("crm.event.btn.notify.part")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.button.dnt.add.remove.part")).show(),s.text(I18n.getMsg("crm.event.add.remove.alert.msg",[p,E])),l.off("click").click((function(e){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t?(Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.validateEntity(e,!0,!0))})),d.off("click").click((function(e){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Events.resetParticipantJson(),t?(Events.saveParticipantFromView(n,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.validateEntity(e,!0,!0)}));else{if("cancelEv"!==g)return t&&Events.saveParticipantFromView(n,!0,!1,!1,i),!0;o.html(I18n.getMsg("crm.event.inv.cancel.alert.msg1",[Events.getModuleName(!0,!0,!0)])).show(),s.html(I18n.getMsg("crm.event.inv.cancel.alert.msg2")),l.off("click").click((function(e){Events.showMailVerificationAlert()||(crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="1",Events.validateEntity(e,!0,!0))})),d.off("click").click((function(e){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="0",Events.validateEntity(e,!0,!0)})),c.off("click").click((function(){crmui.modalZIndex("nonLyte",r[0],"close"),r.hide(),renderingUtils.removeDummyBackground()}))}l.focus();var h=r.attr("id");return renderingUtils.dummyBackground(!1,h),mailsetCenter(h),r.show(),crmui.modalZIndex("nonLyte",r[0],"open"),!1}return t&&Events.saveParticipantFromView(n,!0,!1,!1,i),!0}return t&&Events.saveParticipantFromView(n,!0,!1,!1,i),!0},getCountFromInvJson:function(e){var t=0;for(type in e)t+=objectUtils.getKeys(e[type]).length;return t},doneViewInviteesFromQV:function(){var e=parseInt($("#quickViewRelDivCont").prev().css("top"),10),t=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#quickViewRelDivCont").animate({height:"305px"},500),$("#quickViewRelDivCont").parent().animate({top:t+125},500),$("#quickViewRelDivCont").prev().animate({top:e-125},500);var n=Events.currentEventObjectInQV.invCntJson,i=$("#textarea_Participants");if(i.find(".invitedSt").length>0){i.find(".going").text("("+n.going+")"),i.find(".maybe").text("("+n.maybe+")"),i.find(".invitedSt").text("("+n.invited+")");var a=parseInt(n.total),r=$("#value_Participants").find(".invited");msg=I18n.getMsg("None"),a>0?(msg=I18n.getMsg("crm.create.inv.cnt.label",[a]),r[0].setAttribute("onclick","Events.viewInviteesPop(-2, undefined, 'quickView')")):r[0].setAttribute("onclick",""),r.text(msg)}else{var s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),d=document.createElement("span"),c=document.createElement("span"),v=document.createElement("span");s.setAttribute("onclick","Events.viewInviteesPop(1, undefined, 'quickView')"),o.setAttribute("onclick","Events.viewInviteesPop(2, undefined, 'quickView')"),l.setAttribute("onclick","Events.viewInviteesPop(-1, undefined, 'quickView')"),$(s).addClass("partLab cP").html(I18n.getMsg("crm.invitation.status.going.label")),$(o).addClass("partLab cP").html(I18n.getMsg("crm.quickview.mystatus.maybe")),$(l).addClass("partLab cP").html(I18n.getMsg("Invited")),$(d).addClass("partVal going").text("("+n.accept+")"),$(c).addClass("partVal maybe").text("("+n.maybe+")"),$(v).addClass("partVal invitedSt").text("("+n.invited+")"),i.css({display:"block"}),i.append(l),i.append(v),i.append(s),i.append(d),i.append(o),i.append(c)}$("#qvInvitedListDivCont").show().animate({left:"440px"},500),$("#quickViewMainDiv").animate({left:"0"},500),$("#eventViewPopup").find(".eventFooter").show(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0},showNaviForMultiUserCal:function(e,t){if(calView.showNaviForMultiUserCal){var n,i="dayview"===calView.currCalView?-2808:-370,a=$("#arrwCont"),r=$(window).height()/2,s=$("#calWidget").width()-66,o=$("#fancyParentDIV").height()/2-70;e.pageX-t.offsetLeft-230<$(t).width()/2?"0px"===$(".fht-fixed-body .fht-table").not("#allUserTbl").css("marginLeft")?(n="Next",a.removeClass("prevT").addClass("nextT")):(n="Prev",a.removeClass("nextT").addClass("prevT")):"weekview"===calView.currCalView&&parseInt($(".fht-fixed-body .fht-table").not("#allUserTbl").css("marginLeft"))<=i||"dayview"===calView.currCalView&&Events.multiUserDayScrollTime>=18?(n="Prev",a.removeClass("nextT").addClass("prevT")):(n="Next",a.removeClass("prevT").addClass("nextT")),r=r>o?o:r,a.show(),a.css({left:"Prev"===n?"dayview"===calView.currCalView&&4==(4&Crm.calPreferences.ACTIVITYTYPE)?"460px":"246px":s,top:r})}},showNaviForMultiUserCalForArrow:function(){$("#arrwCont").show()},globalCreateFromMultiUserView:function(e,t,n,i,a,r,s){if(!(Lyte.Router.getRouteInstance().getQueryParams().isMobile&&"true"===Lyte.Router.getRouteInstance().getQueryParams().isMobile.toString())){Crm.userDetails.isPhoneNoNewView&&Crm.loadPhoneFieldComponentJSFiles();var o=new Date,l=null;s=-1===s?0:s,"dayview"===calView.currCalView?(l=new Date(calView.currCalDateObj)).setHours(s):"weekview"===calView.currCalView?((l=new Date(Events.weekStartDate)).setTime(l.getTime()+864e5*s),l=Events.getRoundedDateTime(l)):((l=new Date(Events.monthStartDate)).setTime(l.getTime()+864e5*s),l=Events.getRoundedDateTime(l));var d=!a||Crm.userDetails.USER_ID==a,c=Events.getPositionObjFromEvent(e);renderingUtils.positionArrow(void 0,$L("#wid_calCreate_opts_menu").attr("id"),e,"abcd",c);var v=$("#wid_calCreate_opts_menu"),m=v.height(),u=Crm.calPreferences.ACTIVITYTYPE;Crm.moduleInfo.Appointments&&(Crm.moduleInfo.Appointments.showSubMenu||(u&=7)),$L("#allUsrMonthView").is(":visible")&&(u&=11),u=0===u?3:u,Crm.calPreferences.ACTIVITYTYPE=u;var p=v.eq(0);let C=p.find(".event"),_=p.find(".call"),w=p.find(".task"),y=p.find(".all-task"),M=p.find(".appointment"),D=p.find(".markbusy");C.addClass("hide"),_.addClass("hide"),w.addClass("hide"),y.addClass("hide"),M.addClass("hide"),D.addClass("hide"),renderingUtils.stopEvent(e),1==(1&Crm.calPreferences.ACTIVITYTYPE)&&Crm.moduleInfo.Events.showSubMenu&&(C.removeClass("hide"),v.find(".event").off("click").click((function(){var s=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(s).hasClass("fc-day-number")||Events.globalCreate(e,t,n,l,i,a,r)}))),2==(2&Crm.calPreferences.ACTIVITYTYPE)&&l.getTime()>=o.getTime()&&Crm.moduleInfo.Calls.showSubMenu&&(_.removeClass("hide"),v.find(".call").off("click").click((function(){var i=Events.getPositionObjFromEvent(e);Events.clickPosObj=i,Events.callHostId=a||Crm.userDetails.USER_ID,isNewCallView?Crm.globalCreate(e,t,n,l,a,r):(Q.isFromCalTop=!1,Q.selectAction("NewCall","","Calls","0","calendar",!1,void 0,void 0,e)),"monthview"===calView.currCalView&&l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0],10)),Events.callStartTime=l}))),4==(4&Crm.calPreferences.ACTIVITYTYPE)&&Crm.moduleInfo.Tasks.showSubMenu&&(i&&"monthview"!==calView.currCalView?(y.removeClass("hide"),v.find(".all-task").off("click").click((function(){calView.createTaskFromTop(e,$(this),l,a,r)}))):(w.removeClass("hide"),v.find(".task").off("click").click((function(){calView.createTaskFromTop(e,$(this),l,a,r)})))),8==(8&Crm.calPreferences.ACTIVITYTYPE)&&Crm.moduleInfo.Appointments.showSubMenu&&(M.removeClass("hide"),v.find(".appointment").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||(this.dataset.appointment=!0,Events.globalCreate(e,"calendar",$(this),l,i))}))),d&&Crm.moduleInfo.Events.showSubMenu&&(D.removeClass("hide"),v.find(".markbusy").off("click").click((function(e){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){"monthview"!=calView.currCalView||Utils.isToday(l)||"24:00"==Crm.calPreferences.DAYSTARTSAT?"monthview"==calView.currCalView&&l.setHours((new Date).getHours()):l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])),Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))})));var E=$("#eventViewPopup");E.is(":visible")&&E.hide();var g=$("#wid_calCreate_opts_menu a:visible").length,h=v.offset();calView.setOptionsMenuPosistion(v,h,"bottom",g);var f=(h=v.offset()).top,I=h.left;v.css({top:f+m-20,left:I-50})}renderingUtils.stopEvent(e)},getWidgetHeight:function(){return $(window).height()-$("#calendarBd, #calWidget").offset().top-60},constructInviteeResponse:function(e){var t=document.createElement("table");$(t).attr({cellpadding:"3",cellspacing:"0",border:"0",width:"100%",class:"invitees"});var n=document.createElement("tbody");for(t.appendChild(n),i=0;i<e.length;i++){var a=e[i];if(-1===Events.loadedInvIds.indexOf(a.id)){var r=document.createElement("tr");$(r).attr("srch",a.name+a.email),$(r).addClass("trIninviteesPop"),n.appendChild(r);var s=document.createElement("td");$(s).addClass("l-ht").attr("valign","top"),r.appendChild(s);var o=document.createElement("a");s.appendChild(o),a.href&&$(o).attr({href:a.href,target:"_blank"}),$(o).html(a.dispName),s.appendChild(document.createElement("br"));var l=document.createElement("span");$(l).addClass("crmLinkColor").html(a.dispEmail),s.appendChild(l),Events.loadedInvIds.push(a.id)}}$("#viewInviteesListDiv").append($(t))},searchInvitee:function(e,t){showMacroSuggest(e,t,"viewInviteesListDiv","tr",void 0,void 0,"viewInviteesListDiv",300,void 0,"srch","false")},closeReminderPop:function(e,t){var n="eventReminderPop_"+e;$("#"+n).remove(),$(".eventReminderPop").length<1&&Events.removeremindFrzLayer(),t||localStorage.setItem("closeReminder",n)},refreshAlldayReminderOptions:function(){Events.timeStrForAllDayReminder=Utils.getTimeStrForAllDayReminder(),Events.eventRemindAtOptions_allday=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([Events.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)])},{value:"1 days",html:I18n.getMsg("crm.event.remind.allday.day",["1",I18n.getMsg(Events.timeStrForAllDayReminder)])},{value:"2 days",html:I18n.getMsg("crm.event.remind.allday.days",["2",I18n.getMsg(Events.timeStrForAllDayReminder)])},{value:"1 weeks",html:I18n.getMsg("crm.event.remind.allday.week",["1",I18n.getMsg(Events.timeStrForAllDayReminder)])}]},sendMailToInvitees:function(e,t,n,i,a){$("#moreOptionsDiv").css({visibility:"hidden"}),t||(t=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.title:Events.currentEventObjectInView.title),null!=n?simpleEmail.SendMailPopup(e,t,$(n).attr("invId"),"Events",i,a):simpleEmail.SendMailPopup(e,t,void 0,"Events")},removeremindFrzLayer:function(){renderingUtils.removeDummyBackground(),$("#remindFrzLayer").remove()},checkEventAvailToSendCancel:function(e,t,n){if(e){var a=e.split(";"),r=!1;for(i=0;i<a.length;i++){var s=a[i],o=$("#listView_"+s).attr("data-params");if(o)if(JSON.parse(o).module===t){r=!0;break}}if(r){var l=$("#deletepopup");return l.find("#deleteButton").hide(),$("#warningMsg").html(I18n.getMsg("crm.listview.delete.alert.participant",[Events.getModuleName(!1,!1,!0)])),l.find("#showWarning2").css("display","none"),l.find("#delItemName").text(""),l.find(".evButtons").eq(0).val(I18n.getMsg("crm.button.send")).show().off("click").click((function(){n(!0)})).removeAttr("data-cid").removeAttr("data-params"),l.find(".evButtons").eq(1).val(I18n.getMsg("crm.button.dont.send")).show().off("click").click((function(){n(!1)})).removeAttr("data-cid").removeAttr("data-params"),showAnimatePopup("deletepopup"),!0}}return!1},handleMouseOverInView:function(e,t){var n=!0;"2"!==businessCardJson.isApproved&&"3"!==businessCardJson.isApproved||(n=t&&businessCardJson.hidden.EditFieldsType&&2===businessCardJson.hidden.EditFieldsType&&businessCardJson.hidden.ApprovalProcessEditFields.contains(t.fieldid)),n&&$(e).find(".editLinkClass").show()},businessCardViewHTML:function(e){var t="",n=e.useridVsProfileidMap,i=e.moduleVsProfiles,a=i[e.entitymodule][n[Crm.userDetails.USER_ID]],r=Object.keys(a);t+='<div class="wwBreakWord pT5" style="display:none" id="callBusinessCardDivInCal">',t+='<div class="fL">';for(var s=0;s<e.orderedbusinessCard.length;s++){var o=e.orderedbusinessCard[s],l=o.labelName,d=o.p_moduleName,c=o.uiType;if(void 0!==n&&void 0!==i&&-1!==r.indexOf(l)){if(t+='<p class="pT5">',t+='<span class="crmLabelColor">',t+=$ESAPI.encoder().encodeForHTML(I18n.getMsg(l,Crm.moduleInfo[d].translatedSingularLabel)),t+="</span>",t+=" : ",t+='<span class="dvValueTxt">',validationUtils.isNotEmpty(e.businessCard[l]))if("9"===c&&"Vendors"===d){var v=e.businessCard[l],m=v.entityid,u=v.entityName;validationUtils.isNotEmpty(u)&&(t+="<a href='javascript:void(0);' onclick=\"CTIAPI.openUrl('"+m+"','"+d+"')\">"+$ESAPI.encoder().encodeForHTML(u)+"</a>")}else t+=$ESAPI.encoder().encodeForHTML(e.businessCard[l]+"");t+="</span>",t+="</p>"}}return t+='<textarea class="w100_per mT10 p5 h50" id="callNotes" onkeyup="localStorage.setItem(\'callnotes\',this.value);" placeholder="'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callnotes")+'"  style="display:none"></textarea>',t+="</div>",t+='<br class="cBoth">',t+="</div>"},callDuplicateCheckHandler:function(e,t){if("ScheduleCall"===$("input:radio[name='whichCall']:checked").val()||$("#callTimeSpanEdit").is(":visible")){var n,i,a,r=Crm.userDetails.USER_ID;if(r=$("#callDateSpanEdit").is(":visible")?$("#qownerName_reschedule").val():$("#qownerName_select").is(":visible")?$("#qownerName_select").val():$("#ownerId").val(),t)n=$("input[name='property(Call Start Time)']").val(),$("#callTimeSpanEdit").is(":visible")&&(n=$("#callDateSpanEdit").val()),i=parseInt(t[0],10),"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(i=Utils.convertTimeTo24HoursFormat(i,t[2])),a=parseInt(t[1],10);else if($("#callTimeSpanEdit").is(":visible")){if(n=$("#callDateSpanEdit").val(),i=parseInt($("#calltimefrmhour").val(),10),"HH:mm"!==Crm.userDetails.TIME_FORMAT){var s=$("#calltimefrmampm").val();i=Utils.convertTimeTo24HoursFormat(i,s)}a=parseInt($("#calltimefrmminute").val(),10)}else if(n=$("input[name='property(Call Start Time)']").val(),"Call Start Time"===e){if(i=parseInt($("input[name='property(Call Start Timehour)']").val(),10),"HH:mm"!==Crm.userDetails.TIME_FORMAT){s=$("input[name='property(Call Start Timeampm)']").val();i=Utils.convertTimeTo24HoursFormat(i,s)}a=parseInt($("input[name='property(Call Start Timeminute)']").val(),10)}var o=Utils.getDateObject(n,{hrs:i,mins:a}),l={start:o,end:o,activityType:"Calls"};l.ownerId=r,l.oldOwnerId=r,l.isAllday=!1,$("#callTimeSpanEdit").is(":visible")?l.entityId=$("#id").val():l.entityId=$("input[name='property(id)']").val(),Number.isNaN(parseInt(r))||Events.checkDuplicateEvent(l)}},callDuplicationDateHandler:function(){Events.callDuplicateCheckHandler("Call Start Time")},showPopupDropdown:function(e,t){var n=$(e).position().top+$(e).outerHeight()+2,i=$(e).position().left,a=$("#calBd"),r=$("#allUsrMonthView"),s=$("#"+t);if("none"===s.css("display")){var o=$(e).outerWidth(),l=s.outerWidth(),d=$L(window).scrollTop(),c=$(window).height(),v=s.outerHeight();$(".rep_runreportPop,#dropDownMenu").css("display","none"),s.css({top:n+"px",left:i+"px",visibility:"hidden",display:"block"});var m=s.offset().top+v-d+28;$("#"+t).offset().left;if(c<=m?s.css({top:"-65px",left:i-l+o,visibility:"visible"}):s.css({top:n+"px",left:i-l+o,visibility:"visible"}).show(),a.is(":visible")||r.is(":visible")){n=$(e).position().top-2;s.css({top:n-v+"px",left:i-l+o,visibility:"visible"}).show()}}else s.css("display","none")},exportEvent:function(e){var t=Crm.getCrmBasePath()+"/ExportEntity.do?module=Events&format=ics&source=exportFromDetailView";e&&(t+="&entityId="+e),showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.text.exporting")+"...",1e3),document.exportEventForm.action=t,document.exportEventForm.submit()},weekOfDay:function(e,t,n){e=e||new Date;var i=new Date(e.getTime());i.setDate(1);var a=i.getMonth(),r=Utils.getMonthEnd(a,i.getFullYear()),s=(i.getDay(),[]),o=0;do{var l=i.getDate()+6;0==o&&(l-=i.getDay()),l>r&&(l=r);var d=i.getDay()+(l-i.getDate());s[o]={startDate:i.getDate(),endDate:l,stDay:i.getDay(),endDay:d},i.setDate(l+1),o++}while(i.getMonth()==a);s[0].stDay>n&&(t+=1);var c=s[t]?s[t]:s[s.length-1];0==t&&(c=n>=s[0].stDay&&n<=s[0].endDay?s[0]:s[1]);d="endDay";if(4!=t||n>=c.stDay&&n<=c[d]||(c=s[s.length-2]),n>=c.stDay&&n<=c[d]){var v=c.startDate;for(o=c.stDay;o<n;o++)v++;e.setDate(v)}else e.setDate(1),e.setMonth(e.getMonth()+1),e=this.weekOfDay(e,t,n);return e},closeMoreEventDiv:function(e){$("#moreEventsAllDiv").hide(),e||removeFreezeLayer2()},reinviteParticipantAlert:function(e,t,n){$("#moreOptionsDiv").css({visibility:"hidden"});var i=$("#reinvitepopup");t=$(t),i.find("#reinviteAlertWarningMsg").html(I18n.getMsg("crm.event.reinvite.participant",[$ESAPI.encoder().encodeForHTML(n)]));var a=i.find("#reinvite_participant").show();let r=networkUtils.returnDependencyFiles(["crm-email-auth-util.js"],ResourceConstants.CRMClient);Lyte.injectResources(r,void 0,(function(){Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy()})),a.unbind("click").click((function(t){Lyte.registeredMixins["crm-email-auth-util"].showPopUpForEventModule("reinvite_participant")||Events.reinviteParticipant(e,t)})),a.focus(),showAnimatePopup("reinvitepopup"),t.blur(),event&&renderingUtils.stopEvent(event)},reinviteParticipant:function(e,t,n,i){var a={action:"reinviteForEvent"};a.entityId=n||$("#id").val(),a.inviteeId=e,a[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/mailer/EntReply.do",data:a,type:"POST",success:function(e){var n="error",a=I18n.getMsg("crm.unable.to.process.request");-1!==e.indexOf("success")?(n="success",a=I18n.getMsg("crm.events.reinvite.success")):-1!==e.indexOf("dayLimitReached")?a=I18n.getMsg(e):-1!==e.indexOf("Email has been unsubscribed")&&(a=I18n.getMsg("crm.unsubscription.event.invitie.blocked")),i?_cruxUtils.showCustomMessage({params:{ltPropMessage:a,ltPropType:n,ltPropDuration:"2000",ltPropOffset:{top:"50px"}}}):(crmui.showMsgBand(n,a,4e3),renderingUtils.stopEvent(t),hideAnimatePopup("reinvitepopup"))}})},sendAuthorizationNotificationToHost:function(e,t){(!Events.authNotificationSentUsers.hasOwnProperty(e)||Events.authNotificationSentUsers.hasOwnProperty(e)&&!Events.authNotificationSentUsers[e].contains(t))&&(Events.authNotificationSentUsers.hasOwnProperty(e)||(Events.authNotificationSentUsers[e]=[]),Events.authNotificationSentUsers[e].push(t),store.findAll("dummy",{type:"sendAuthorizationNotificationToHost",toolName:e,currHost:t},!1,!1,{url:Crm.getCrmBasePath()+"/events/EventAction.do"}).then((function(){return!0})))},removeHostAuthKey:function(e){var t={type:"removeHostAuthKey"};t.toolName=e,t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventAction.do",data:t,type:"GET",success:function(){return!0}})},hideMouseHoverSettingIcon:function(e){(e=$(e).children("td:last")).find(".relListMenuDiv").css("visibility","hidden").find(".scaleCont").removeClass("scaleOne")},reminderAddorRemove:function(e){var t=(e=$(e)).parent("ul").attr("currentId"),n=$("#"+t).find("input").attr("data-value"),i=$("#setup_new_ContentDiv");if(e.closest("ul").find("li").removeClass("selectedOpt"),i.css("overflow","auto"),"eventPartReminderDiv"===t)return Events.saveValtoopt(t,e),void e.addClass("selectedOpt");if("none"==e.attr("data-value")){if("none"==$("#Crm_"+Events.module+"_REMINDAT"+t.substring(16)).val())return;if(Events.reminderCount>=1&&Events.reminderCount<20&&"none"!=n)$("#"+t).parent().remove();else if(20==Events.reminderCount){$("#"+t).parent().remove(),Events.maxReminderValue++,(a=$("#eventReminderDiv").clone()).css({display:"inline-block"}),a.attr("id","eventReminderDiv"+Events.maxReminderValue),a.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),$("#eventReminderDiv").parent().append($("<div>").append($("<div>").append(a)).html())}else Events.saveValtoopt(t,e);"none"!=n&&1!=Events.reminderCount&&Events.reminderCount--}else{var a,r;if("none"==$("#"+t).find("input").attr("data-value")&&Events.reminderCount<20)Events.saveValtoopt(t,e),Events.reminderCount++,Events.maxReminderValue++,(a=$("#eventReminderDiv").clone()).css({display:"inline-block"}),a.attr("id","eventReminderDiv"+Events.maxReminderValue),a.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),$("#eventReminderDiv").parent().append($("<div>").append($("<div>").append(a)).html()),r=(Events.reminderCount-2>0?Events.maxReminderValue-2:"")>0?$("#eventReminderDiv"+Events.maxReminderValue).parent("div").prev("div").prev("div").find("div.selectBoxInput").eq(0).attr("id"):"Crm_"+Events.module+"_REMINDAT_label",$L("#eventCreationInnerDiv").scrollTo($L("#"+r),{duration:1e3});else(20==Events.reminderCount||Events.maxReminderValue>=t.substring(16))&&Events.saveValtoopt(t,e)}},getMultipleRemindersAsJson:function(){var e="{",t=[],n=1;for(i=1;i<=Events.maxReminderValue;i++)$("#Crm_Events_REMINDAT"+i).length&&"none"!=$("#Crm_Events_REMINDAT"+i).attr("data-value")&&-1==$.inArray($("#Crm_Events_REMINDAT"+i).attr("data-value"),t)&&(t.push($("#Crm_Events_REMINDAT"+i).attr("data-value")),e=e+'"'+n+'":"'+$("#Crm_Events_REMINDAT"+i).attr("data-value")+'",',n++);return e=""==(e=e.substring(0,e.length-1))?"none":e+"}"},getReminderforParticipants:function(e,t){var n=[],i={},a="minutes";if("0"!==e){var r=e.split(" ");switch(a=r[1]){case"mins":a="minutes";break;case"hrs":a="hours"}e=r[0]}return i.remind="before",i.period=a,i.unit=e,n.push(i),t?n:JSON.stringify({partRem:n})},saveRemindersState:function(){for(i=1;i<=Events.maxReminderValue;i++){var e=$("#Crm_"+Events.module+"_REMINDAT"+i);0!=e.length&&"none"!=e.attr("data-value")&&Events.reminders.push({value:e.attr("data-value"),html:$("#eventReminderDiv"+i).find(".slctOptVal").text()})}},retrieveReminders:function(){for(i=0;i<Events.reminders.length;i++){Events.reminderCount++,Events.maxReminderValue++;var e=$("#eventReminderDiv").clone();e.css({display:"inline-block"}),e.attr("id","eventReminderDiv"+Events.maxReminderValue),e.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),(e=$($("<div>").append($("<div>").append(e)).html())).insertBefore($("#eventReminderDiv1").parent());var t=Events.getValueForRemInputBox(Events.reminders[i].value),n="eventReminderDiv"+Events.maxReminderValue,a=renderingUtils.saveValtoopt(n,t,Events.reminders[i].value),r=Events.getHtmlForReminders(Events.reminders[i].value,a,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+n).html(r),$("#"+n).removeClass("SlctListAtv")}20==Events.reminders.length&&$("#eventReminderDiv1").parent().remove(),Events.reminders=[]},removeReminders:function(){for(i=1;i<Events.maxReminderValue;i++)$("#eventReminderDiv"+i).parent().remove();var e=$("#Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue);e.hide(),e.attr("data-value","none");var t=$("#eventReminderDiv"+Events.maxReminderValue);t.find(".slctOptVal").text(I18n.getMsg("None")),t.attr("id","eventReminderDiv1"),e.attr("id","Crm_"+Events.module+"_REMINDAT1"),$("#eventReminderDiv1").find(".slctOptVal").css({"padding-left":"10px"}),Events.maxReminderValue=1,Events.reminderCount=1},saveAllDayRemindersState:function(){for(i=1;i<=Events.maxReminderValue;i++){var e=$("#Crm_"+Events.module+"_REMINDAT"+i);0!=e.length&&"none"!=e.attr("data-value")&&Events.allDayReminders.push({value:e.attr("data-value"),html:$("#eventReminderDiv"+i).find(".slctOptVal").text()})}},retrieveAllDayReminders:function(){for(0==Events.allDayReminders.length&&"create"==Events.currentStatus&&"none"!=Crm.calPreferences.ALLDAYEVENTREMINDER&&Events.allDayReminders.push({value:Crm.calPreferences.ALLDAYEVENTREMINDER}),i=0;i<Events.allDayReminders.length;i++){Events.reminderCount++,Events.maxReminderValue++;var e=$("#eventReminderDiv").clone();e.css({display:"inline-block"}),e.attr("id","eventReminderDiv"+Events.maxReminderValue),e.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),(e=$($("<div>").append($("<div>").append(e)).html())).insertBefore($("#eventReminderDiv1").parent());var t=Events.getValueForRemInputBox(Events.allDayReminders[i].value),n="eventReminderDiv"+Events.maxReminderValue,a=renderingUtils.saveValtoopt(n,t,Events.allDayReminders[i].value),r=Events.getHtmlForReminders(Events.allDayReminders[i].value,a,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+n).html(r),$("#"+n).removeClass("SlctListAtv")}20==Events.allDayReminders.length&&$("#eventReminderDiv1").parent().remove(),Events.allDayReminders=[]},getHtmlForReminders:function(e,t,n){var i=Events.getHtmlForEventReminder(e,t,n);return i+="</span></div><div class='cBoth'></div>"},getHtmlForEventReminder:function(e,t,n,i){var a=e.split(" "),r="",s=!1,o=null;if("Appointments"==this.moduleName||"Appointments"==crmCommonModule.moduleName?(o=moduleRecordMapping.Appointments.singular_label.toLowerCase(),o=I18n.getMsg(o)):o=Crm.getModuleDisplayName(!0,!1,!0),"HH:mm"===Crm.userDetails.TIME_FORMAT&&(s=!0),a.length>1){var l=parseInt(a[0]),d=0,c=0,v=0;if(("hrs"==a[1]||"mins"==a[1])&&n){var m=parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])-1;if(t=isNaN(t)?t:"","hrs"==a[1]&&l>24){if(l/168>=1)return l-=168*(c=Math.floor(l/168)),n&&0!=l&&(l=m-l),l=l<0?l+=24:l,s?l=l<10?"0"+l:l+":00":(isAmPm=l>=12?" PM":" AM",l=(l=(l=(l=0==l?12:l)>12?l-12:l)<10?"0"+l:l)+":00"+isAmPm),c>1?t+I18n.getMsg("crm.event.remind.allday.weeks1",[c,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.week1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.week",[c,l]);if(l/24>=1)return l-=24*(v=Math.floor(l/24)),n&&0!=l&&(l=m-l),l=l<0?l+=24:l,s?l=l<10?"0"+l:l+":00":(isAmPm=l>=12?" PM":" AM",l=(l=(l=(l=0==l?12:l)>12?l-12:l)<10?"0"+l:l)+":00"+isAmPm),v>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.days1",[v,l]):t+I18n.getMsg("crm.event.remind.allday.days",[v,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.day1",[v,l]):t+I18n.getMsg("crm.event.remind.allday.day",[v,l])}else if("mins"==a[1]&&l>60){if(l/10080>=1)return(l-=10080*(c=Math.floor(l/10080)))/60>=1&&(l-=60*(d=Math.floor(l/60)),n&&0!=d&&(d-=m),d=d<0?d+=24:d),s?l=d<10?"0"+d:d+":"+(l<10)?"0"+l:l:(isAmPm=d>=12?" PM":" AM",l=(d=(d=(d=0==d?12:d)>12?d-12:d)<10?"0"+d:d)+":"+(l=l<10?"0"+l:l)+isAmPm),c>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.weeks1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.weeks",[c,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.week1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.week",[c,l]);if(l/1440>=1)return(l-=1440*(v=Math.floor(l/1440)))/60>=1&&(l-=60*(d=Math.floor(l/60)),n&&0!=d&&(d-=m),d=d<0?d+=24:d),s?l=d<10?"0"+d:d+":"+(l<10)?"0"+l:l:(isAmPm=d>=12?" PM":" AM",l=(d=(d=0==d?12:d)<10?"0"+d:d)+":"+(l=l<10?"0"+l:l)+isAmPm),c>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.days1",[v,l]):t+I18n.getMsg("crm.event.remind.allday.days",[v,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.day1",[v,l]):t+I18n.getMsg("crm.event.remind.allday.day",[v,l])}}switch(a[1]){case"mins":r="true"==i?I18n.getMsg("crm.event.remind.mins1",[a[0]]):I18n.getMsg("crm.event.remind.mins",[t]);break;case"hrs":r="true"==i?I18n.getMsg(a[0]>1?"crm.event.remind.hrs1":"crm.event.remind.hr1",[a[0]]):I18n.getMsg(a[0]>1?"crm.event.remind.hrs":"crm.event.remind.hr",[t]);break;case"days":r=n?"true"==i?I18n.getMsg(a[0]>1?"crm.event.remind.days1":"crm.event.remind.day1",[a[0],I18n.getMsg(Events.timeStrForAllDayReminder)]):I18n.getMsg(a[0]>1?"crm.event.remind.allday.days":"crm.event.remind.allday.day",[t,I18n.getMsg(Events.timeStrForAllDayReminder)]):"true"==i?I18n.getMsg(a[0]>1?"crm.event.remind.days1":"crm.event.remind.day1",[a[0]]):I18n.getMsg(a[0]>1?"crm.event.remind.days":"crm.event.remind.day",[t]);break;case"weeks":r=n?a[0]<1?"true"==i?t+I18n.getMsg("crm.event.allday.remind.ondate1",[Events.getModuleName(!0,!1,!0)]):t+I18n.getMsg("crm.event.allday.remind.ondate",[Events.timeStrForAllDayReminder,Events.getModuleName(!0,!1,!0)]):"true"==i?I18n.getMsg(a[0]>1?"crm.event.remind.weeks1":"crm.event.remind.week1",[a[0]]):I18n.getMsg(a[0]>1?"crm.event.remind.allday.weeks":"crm.event.remind.allday.week",[t,I18n.getMsg(Events.timeStrForAllDayReminder)]):a[0]<1?"true"==i?'<span class="m0 crm-base-font-size mR5 crmBaseColor fL">'+I18n.getMsg("crm.event.remind.ontime",[o])+"</span>":t+I18n.getMsg("crm.event.remind.ontime",[o]):"true"==i?I18n.getMsg(a[0]>=1?"crm.event.remind.days1":"crm.event.remind.day1",[7*a[0]]):I18n.getMsg(a[0]>=1?"crm.event.remind.days":"crm.event.remind.day",[t])}}else r="none"==a[0]?t+I18n.getMsg("None"):n?"true"==i?t+I18n.getMsg("crm.event.allday.remind.ondate1",[Events.getModuleName(!0,!1,!0)]):t+I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([this.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)]):"true"==i?'<span class="m0 crm-base-font-size mR5 crmBaseColor fL">'+I18n.getMsg("crm.event.remind.ontime",[o])+"</span>":t+I18n.getMsg("crm.event.remind.ontime",[o]);return r},convertObjToKeyValuePair:function(e){var t="";for(var n in e)void 0!==e[n]&&("string"==typeof e[n]?t+=n+'= "'+$ESAPI.encoder().encodeForHTMLAttribute(e[n])+'"  ':t+=n+'= "'+e[n]+'" ');return t},constructMultipleRemindersOptions:function(e,t,n){var a=null;"Appointments"==this.moduleName||"Appointments"==crmCommonModule.moduleName?(a=moduleRecordMapping.Appointments.singular_label.toLowerCase(),a=I18n.getMsg(a)):a=Crm.getModuleDisplayName(!0,!1,!0),Events.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[a])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}],null==e&&(null!=n&&n?n&&(e=Events.eventRemindAtOptions_allday):e=Events.eventRemindAtOptions),null==t&&(t="none");var r=$("#eventMultipleRemindersDiv");for(r.html(""),i=0;i<e.length;i++){var s=$("<li>",{class:e[i].value==t?"selectedOpt":"",onclick:"Events.reminderAddorRemove(this);","data-value":e[i].value});$("<span>",{class:"slctOptTxt",html:e[i].html}).appendTo(s),s.appendTo(r)}},saveValtoopt:function(e,t){e.substring(16);$(t).parent("ul").hide();var n=Events.getValueForRemInputBox(t.attr("data-value")),i=renderingUtils.saveValtoopt(e,n,t.attr("data-value")),a=Events.getHtmlForReminders(t.attr("data-value"),i,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+e).html(a),$("#"+e).removeClass("SlctListAtv")},selectInput:function(e){if(($L(".etTrendsWrapper").length||$L(".ziaCallAnalyticswrapper").length)&&$L("#eventMultipleRemindersDiv").css({zIndex:315}),"INPUT"!==event.target.tagName){var t=$(e).outerHeight(),n=$(e).offset().top,i=$(e).offset().left,a=$(window).height(),r=$(e).children("input").attr("data-value"),s=$("#eventMultipleRemindersDiv"),o=s.find("li"),l=o.length,d=$("#setup_new_ContentDiv");0===l&&Events.constructMultipleRemindersOptions(),o.removeClass("selectedOpt"),$(e).closest("ul").find("li").removeClass("selectedOpt"),o.each((function(){$(this).attr("data-value")!==r||$(this).addClass("selectedOpt")})),$(e).addClass("SlctListAtv");var c={top:n+t,left:i,display:"block",visibility:"hidden"};s.css(c);var v={top:s.offset().top+s.outerHeight()>=a?n-s.outerHeight():n+t,left:i,visibility:"visible"};s.css(v),s.attr("currentId",$(e).attr("id")),d.css("overflow","hidden")}},getValueForRemInputBox:function(e){var t=e.split(" ");return t.length>1&&!isNaN(t[0])?"0"==t[0]?"":t[0]:""},changeVal:function(e){var t=$(e).val(),n=$(e).attr("data-value").split(" ");$(e).attr("data-value",t+$(e).attr("data-value").substring(n[0].length))},getDataValue:function(e){var t=e.split(" ");return"0"==t[0]?"0":"weeks"==t[1]?7*parseInt(t[0])+" days":e},setPadding:function(e){return""==Events.getValueForRemInputBox(e)},setPreviousValue:function(e,t){(e=$(e)).attr("prevVal",e.val())},validateTimeNumeralFieldOfReminders:function(e){""==(e=$(e)).val()&&e.attr("data-value",e.attr("prevVal"))},showReminderList:function(e,t){if("fromQV"==t||"fromDV"===t){var n=$(e).offset().top,i=$(e).offset().left;$("#reminderListQV").css({top:n,left:i}),$("#reminderListQV").show()}else $("#remListDiv").parent("div").show();thirdPartyUtils.bindPerfectScroll("#remListDiv",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1})},hideReminderList:function(e){$("#reminderListQV").hide()},remindersInQuickView:function(e,t){var n=JSON.parse(e);if(0==n.length)return"";var a="<div class='pR'>",r="";if(n.length>1){a=a+"<div class='multpl_remainList dIB pB10'><a href='javascript:;' onclick='renderingUtils.stopEvent()' onmouseover='Events.showReminderList(this,&#39;fromQV&#39;)' onmouseout='Events.hideReminderList(this)' class='pL10'>"+I18n.getMsg("crm.event.number.of.reminders",[n.length])+"</a>";$("<ul>",{class:"remListUL p0 dIB m0"});var s=t["All day"];for(s=$(s),"none"==("yes_All day"==$(s[0]).attr("id")?s[1]:s[0]).style.display,i=0;i<n.length;i++)r=r+"<li class='m0'><span class='crm-small-font-size fL'>"+n[i].remTime+"</span><div class='cBoth'></div></li>";$("#remListDiv").find("ul").html(r)}else a=a+"<div class='multpl_remainList dIB pB10 mL10'><span class='crm-small-font-size w150 fR wsNowrap'>"+n[0].remTime+"</span></div></div>";return a},addRelatedParticipant:function(e,t,n){var i,a=e.is(":checked");if(this.relatedParticipantName=a?$("#Crm_Events_CONTACTID").val():"",-1!=n.indexOf("Lead")?Events.selectInv(e,"l",t):-1!=n.indexOf("Contact")&&Events.selectInv(e,"c",t),crmui.hideMsgBand(),$("#saveEventsBtn").removeAttr("disabled"),i=Crm.userDetails.MEETING_BRIDGE_ENABLED?$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online"):$("#meetingInclude").is(":checked"),Events.withMeetingTool||i){var r=Events.meetingToolName;r||""!==r||(r=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Crm.userDetails.MEETING_BRIDGE_ENABLED||Events.checkAuthorizeDone(r)}Events.invitationLimitValidation($("#addpartCheckbox").is(":checked"),$("#invFilterDropDown").val())},showRelatedpartSelected:function(e,t){var n=$("#addpartCheckbox"),i=n.attr("recId"),a=n.attr("module");"Contacts"==a?a="c":"Leads"==a&&(a="l");var r="invSelRow"+a+"_"+i;if("c"==a||"l"==a)if(n.is(":checked")){if($("#"+a+"_"+i).prop("checked",!0),null==document.getElementById(r)){var s=$("#invRow"+a+"_"+i).clone();s.attr("id","invSelRow"+a+"_"+i);var o="sel"+a+"_"+i;if(s.find("input").attr({id:o}),s.find("label").attr({for:o}),s.find("input")[0])s.find("input")[0].setAttribute("onclick","selectInv(this, '"+a+"', true)"),$("#invSelTbody_"+a).prepend(s);else{var l=document.createElement("TR");l.setAttribute("id","invSelRow"+a+"_"+i);var d=$ESAPI.encoder().encodeForHTML(this.relatedParticipantName);d||(d=$ESAPI.encoder().encodeForHTML($("#entityName").val()));var c='<td valign="top" width="15"><label class="newCustomchkbox-md" for="sel'+a+"_"+i+'"><input data-zcqa="Lookup_event_contactidlistchik" id="sel'+a+"_"+i+'" checked cnt="1" recid="'+i+'" onclick="selectInv(this, \''+a+'\', true)" class="invChkBox" type="checkbox"><span class="chkbxIcon"></span></label></td>';c=c+"<td class='l-ht' valign='top'><label data-zcqa='Lookup_event_contactidlistlabel' for='sel"+a+"_"+i+"'><span><a class='link' data-zcqa='Lookup_event_contactidlistname'>"+d+"</a></span><span class='crmNotFoundColor' data-zcqa='Lookup_event_contactidlistcompanyname'></span><br><span class='crmLinkColor dIB mT3 lh18' data-zcqa='Lookup_event_contactidlistemail'>&nbsp;</span></label></td>",l.innerHTML=c,$("#invSelTbody_"+a).prepend(l)}}}else null!=document.getElementById(r)&&$("#invSelRow"+a+"_"+i).remove(),$("#"+a+"_"+i).prop("checked",!1);if("c"==(a=$("#invFilterDropDown").val())||"rc"==a){for(var v=0;v<Events.showDuplicateContView.length;v++){var m=Events.showDuplicateContView[v];null!=$("#c_"+m)?($("#c_"+m).removeClass("beforeAdd"),$("#invListDiv_c").find("#c_"+m).prop("checked",!0),$("#invListDiv_rc").find("#c_"+m).prop("checked",!0)):($("#invListDiv_c").find("#c_"+m).prop("checked",!1),$("#invListDiv_rc").find("#c_"+m).prop("checked",!1))}$(".beforeAdd").attr("disabled",!1)}Events.invitationLimitValidation(Events.invReached,a,void 0,e,t)},loadeventCreatePopup:function(e){var t=$("#eventCreatePopup");if(0==t.length){if("layoutPreview"===e){var n={elemId:e};t=$(Handlebars.templates.eventCreatePopup(n));var i=$L("#eventCreateContainerDiv",t);$L(".contHeadInfo",i).addClass("cvpadding pL25 dvTitle").removeClass("contHeadInfo eventHeaderStyle crm-heading-font-size"),$("#"+e).append(i)}else t=$(Handlebars.templates.eventCreatePopup()),$("body").append(t);($(".etTrendsWrapper").length||$(".ziaCallAnalyticswrapper").length)&&t.addClass("ziaForEmailsCheck");let a=networkUtils.returnDependencyFiles(["crm-email-auth-util.js"],ResourceConstants.CRMClient);Lyte.injectResources(a,void 0,(function(){Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy()})),crmui.modalZIndex("nonLyte",t[0],"open")}},loadInvitationConfirmDiv:function(){var e=$("#invitationConfirmDiv");0==e.length&&(e=$(Handlebars.templates.invitationConfirmDiv()),$("body").append(e))},loadViewInviteesPopDiv:function(){var e=$("#viewInviteesPop");0==e.length?(e=$('<div id="viewInviteesPop" class="newpopup maxW600 zi30 p25 invstatus" style="display:none;width:500px;padding:0px; overflow:hidden"></div>'),$("body").append(e)):$(e[0]).empty()},loadDontSendReminderDiv:function(){var e=$("#dontSendReminderDiv");0===e.length&&(e=$(Handlebars.templates.dontSendReminderDiv()),$("body").append(e)),e.show(),$(".bodycontainer").append('<div class="freezeLayer_zi32"></div>'),$(".freezeLayer_zi32").show(),mailsetCenter("dontSendReminderDiv")},loadEditRecAlertMsgDiv:function(){var e=$(Handlebars.templates.editRecAlertMsgDiv());$("body").append(e)},selectInv:function(e,t,n){var i=$(e).is(":checked"),a="";a="edit"==Events.currentStatus?Events.invAddJson[t]:Events.invJsonCreate[t];var r=["t","lv","cv","g","r","rs"],s=0;if(i){if(a[n]=n,Events.selCntIdsArr=Events.recCntIdsArr,delete Events.selCntIdsArr.remove[t][n+""],Events.selCntIdsArr.add[t][n+""]=[n],s=Events.getSelectedInviteesCnt(Events.convertIntoResponseFormat(Events.selCntIdsArr.add,t),Events.convertIntoResponseFormat(Events.selCntIdsArr.remove,t)),-1!=r.indexOf(t)){delete Events.recCntIdsArr.remove[t][n]}Events.invRemoveJson[t][n]&&(delete Events.invRemoveJson[t][n],delete Events.invAddJson[t][n])}else{if(delete a[n],Events.selCntIdsArr=Events.recCntIdsArr,Events.selCntIdsArr.remove[t][n+""]=[n],delete Events.selCntIdsArr.add[t][n+""],s=Events.getSelectedInviteesCnt(Events.convertIntoResponseFormat(Events.selCntIdsArr.add,t),Events.convertIntoResponseFormat(Events.selCntIdsArr.remove,t)),-1!=r.indexOf(t)){delete Events.recCntIdsArr.add[t][n]}"edit"==Events.currentStatus&&(i?Events.invRemoveJson[t][n+""]?delete Events.invRemoveJson[t][n+""]:Events.invAddJson[t][n+""]=n:Events.invAddJson[t][n+""]?delete Events.invAddJson[t][n+""]:Events.invRemoveJson[t][n+""]=n)}Events.setSelInvCnt(parseInt(s))},setLocation:function(e){if(renderingUtils.stopEvent(),!($("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online"))){if("Others"==e){var t=$("#Crm_Events_SEID_label_select").val();e="Accounts"==t||"SalesOrders"==t?t:"Vendors"}Events.setAddrDetails(e,(function(e){e&&$(".evtLocationDD").slideDown(300)}))}},addLocationData:function(e,t){e.stopPropagation();var n=$(t).text();$("#Crm_Events_LOCATION").val(n),$(".evtLocationDD").hide()},setAddrDetails:function(e,t){var n=[];if("Contacts"==e||"Accounts"==e||"SalesOrders"==e){var a=null!=Events.addressInfo.contactBilAddr?Events.addressInfo.contactBilAddr:"",r=null!=Events.addressInfo.contactShipAddr?Events.addressInfo.contactShipAddr:"";""==a&&""==r||(n=[a,r]);var s=null!=Events.addressInfo.accountBilAddr?Events.addressInfo.accountBilAddr:"",o=null!=Events.addressInfo.accountShipAddr?Events.addressInfo.accountShipAddr:"";""==s&&""==o||(n.push(s),n.push(o))}else n[0]=null!=Events.addressInfo[e]?Events.addressInfo[e]:"";var l=$("#locationDataDiv ul");for(l.empty(),i=0;i<n.length;i++)""!=n[i]&&l.append("<li class='crmBaseColor pB5 cP' onclick='Events.addLocationData(event,this)'>"+$ESAPI.encoder().encodeForHTML(n[i])+"</li>");""!=n&&t(!0)},setAddressInfo:function(e,t){if("Leads"==t){var n="";null!=e.LANE&&"null"!=e.LANE&&(n+=e.LANE+", "),null!=e.CITY&&"null"!=e.CITY&&(n+=e.CITY+", "),null!=e.STATE&&"null"!=e.STATE&&(n+=e.STATE+", "),null!=e.COUNTRY&&"null"!=e.COUNTRY&&(n+=e.COUNTRY+", "),null!=e.CODE&&"null"!=e.CODE&&(n+=e.CODE+", "),n=Events.removeExtraComma(n),Events.addressInfo[t]=n}else if("Contacts"==t||"Accounts"==t||"SalesOrders"==t){var i="",a="";null!=e.BILLINGSTREET&&(i+=e.BILLINGSTREET+", "),null!=e.BILLINGCITY&&(i+=e.BILLINGCITY+", "),null!=e.BILLINGSTATE&&(i+=e.BILLINGSTATE+", "),null!=e.BILLINGCOUNTRY&&(i+=e.BILLINGCOUNTRY+", "),null!=e.BILLINGCODE&&(i+=e.BILLINGCODE+", "),null!=e.SHIPPINGCITY&&(a+=e.SHIPPINGCITY+", "),null!=e.SHIPPINGSTREET&&(a+=e.SHIPPINGSTREET+", "),null!=e.SHIPPINGSTATE&&(a+=e.SHIPPINGSTATE+", "),null!=e.SHIPPINGCOUNTRY&&(a+=e.SHIPPINGCOUNTRY+", "),null!=e.SHIPPINGCODE&&(a+=e.SHIPPINGCODE+", ");if(i=Events.removeExtraComma(i),a=Events.removeExtraComma(a),"Contacts"==t){Events.addressInfo.contactBilAddr=i,Events.addressInfo.contactShipAddr=a}else{Events.addressInfo.accountBilAddr=i,Events.addressInfo.accountShipAddr=a}}else if("Vendors"==t){var r="",s="ZIPCODE";null!=e.STREET&&"null"!=e.STREET&&(r+=e.STREET+", "),null!=e.CITY&&"null"!=e.CITY&&(r+=e.CITY+", "),null!=e.STATE&&"null"!=e.STATE&&(r+=e.STATE+", "),null!=e.COUNTRY&&"null"!=e.COUNTRY&&(r+=e.COUNTRY+", "),null!=e[s]&&"null"!=e[s]&&(r+=e[s]+", "),r=Events.removeExtraComma(r),Events.addressInfo[t]=r}},removeExtraComma:function(e){return e=e.slice(0,e.length-2),e+="."},movePVInitialvalue:function(){Events.relAccId="",Events.relAccName="",Events.relAccMod=!1,Events.addressInfo=[],Events.showDuplicateContView=[],Events.authNotificationSentUsers={}},removeParticipant:function(e,t,n){var i=e,a=new crmRequestPool,r={};r[csrfParamName]=csrfToken,a.initiate({action:e,type:"post",data:r,success:function(e){if(commonUtils.showHideLoadingDiv(),hideAnimatePopup("removepopup"),"success"===e)if(n)n();else{Events.updateFinalIdJson(i),crmui.showMsgBand("success",I18n.getMsg("crm.event.participant.removed"),4e3);var a=$("#invStatusFilter").val();Crm.userDetails.detailView_newUI||Events.viewInviteesPop(a);var r=-1==a?"invited":1==a?"accept":2==a?"maybe":null;null!=r&&void 0!==r&&$("#right_invCnt_"+r).text($("#right_invCnt_"+r).text()-1);var s=t.closest("tr");s&&s.length&&s.remove&&s.remove(),Crm.userDetails.detailView_newUI&&(Crm.renderDVLyteFlow("Events")&&"detail"===Lyte.Router.getRouteInstance().routeName?Lyte.registeredMixins["crm-detailview-common-utils"].reloadCurrentEntityView():reloadCurrentEntityView())}else crmui.showMsgBand("error",I18n.getMsg("crm.security.error.add.user"),3e3,"")}})},hideLocationPop:function(){setTimeout((function(){$("#locationDataDiv").hide()}),500)},showUnavailablePopUp:function(e,t,n,i,a){var r=this;$("#eventViewPopup").remove();Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].showUnavailableinMultiUserView(n,e,t,r,i,a)})),sE(n)},loadMeetingConfigPage:function(e){var t={type:"showMeetingPage",toolName:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",data:t,type:"GET",success:function(e){$("#internalExtensionDetail").html(e)}})},eventMeetingOAuthSuccess:function(e){Events.closeAuthorizationPopUp();var t=Events.meetingConfZuid[e.toolName],n=0,i=!1;if(t){"string"==typeof t&&(t=JSON.parse(t));for(var a=t.length;n<a;){for(key in t[n])key==Crm.userDetails.USER_ID&&(t[n][Crm.userDetails.USER_ID]=!0,i=!0);n++}}if(!i){var r={};r[Crm.userDetails.USER_ID]=!0,t[t.length]=r}Events.meetingConfZuid[e.toolName]=JSON.stringify(t),$("#saveEventsBtn").attr("disabled",!1),$("#errorMsg_authorizationError").hide(),$("#meetingOnlineProviders").removeClass("errorFieldP"),"undefined"!=typeof calendarSchedule&&calendarSchedule.closePopUp();var s=JSON.parse(Crm.calPreferences.MEETINGPREFDETAILS);if(-1==JSON.stringify(s).indexOf(e.toolName)){var o={conference_details:"",type:"1"};o.toolName=e.toolName,s.push(o),Crm.calPreferences.MEETINGPREFDETAILS=JSON.stringify(s)}crmui.showMsgBand("success",I18n.getMsg("crm.tpi.ctiapi.msg.alert.authorizedsuccess",Events.displayToolName[e.toolName]),"2000"),$("#calsched_savebtn").attr("disabled",!1),$("#meetingauthorize").remove()},eventMeetingOAuthFailure:function(e){$("#errorMsg_authorizationError4").hide(),$("#errorMsg_authorizationError3").hide(),$("#errorMsg_authorizationError1").show()},eventMeetingReAuthorize:function(e){Crm.userDetails.MEETING_BRIDGE_ENABLED||Events.showMeetingAuthorizationPopUp(e.toolName,void 0,!0,e.isCalendarBooking)},meetingTokenCreation:function(e){var t={type:"showMeetingPage",toolName:e.Initiator,isMeetingSignup:!0,source:e.source};t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",data:t,type:"POST",success:function(){console.log("Success -- token  creation")},error:function(){console.log("Failure -- token creation")}})},disableMeetingTool:function(e){if(Crm.userDetails.MEETING_BRIDGE_ENABLED){var t=document.querySelector("meeting-disable");null!==t&&t.remove()}var n={type:"disableMeetingTool",toolName:e};n[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",data:n,type:"POST",success:function(t){moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.fields&&delete moduleRecordMapping.Campaigns.fields,"GoToMeeting"==e?(renderingUtils.removeFreezeLayer(),Crm.userDetails.MEETING_BRIDGE_ENABLED?setTimeout((function(){var e=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/settings/modules/Events/events_preferences";Utils.windowLocationHref(e)}),1e3):Utils.windowLocationReload()):($("#internalExtensionDetail").html(t),Crm.userDetails.MEETING_BRIDGE_ENABLED?setTimeout((function(){var e=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/settings/modules/Events/events_preferences";Utils.windowLocationHref(e)}),1e3):Utils.windowLocationReload())}}),crmui.hidePopup("disablemeetingpopup")},getToolNamefromDisplayName:function(e){for(var t in Events.displayToolName)if(Events.displayToolName.hasOwnProperty(t)&&e===Events.displayToolName[t])return t},showonboardingChanges:function(){Events.eventMeetingOnboardingShown&&networkUtils.loadFeatureScripts(["zohocrm_eventMeetingOnBoarding.js"],(function(){var e=[{class:"onBoarding-inviteIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.invite.more"),desc:I18n.getMsg("crm.event.meeting.onboarding.invite.desc")}];e.push({class:"onBoarding-hostmeetingIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.host"),desc:I18n.getMsg("crm.event.meeting.onboarding.host.desc.new",[Crm.appName])}),e.push({class:"onBoarding-insightsIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.view"),desc:I18n.getMsg("crm.event.meeting.onboarding.view.desc")}),e.push({class:"onBoarding-meetHandIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.supported.providers.view"),desc:I18n.getMsg("crm.event.meeting.onboarding.supported.providers.view.desc","Zoho Meeting")});var t={};t.newData=e,t.isAdmin=Crm.userDetails.IS_ADMIN,t.crmAppName=Crm.appName;var n=Handlebars.templates.eventMeetingOnboarding(t);$("body").append(n),setTimeout((function(){if(-1!==$("#Crm_Events_MEETING_VENUE").attr("data-picklistmap").indexOf("Online")){var e=$("#eventCreatePopup"),t=$("#eventCreationInnerDiv"),n=$("#eventCreateContainerDiv"),i=$("#Events_fldRow_MEETING_VENUE"),a=i.offset(),r=e.position().left,s=e.width(),o=$(window).scrollTop(),l=i.prev().width();t.off("scroll.ArrowVisibility");var d=$(".eventsOnboarding"),c=i.offset().top-170,v=n.offset(),m=n.outerWidth(),u=v.left-d.outerWidth()-10;c<=0&&(c=0),u<=0?(d.removeClass("popOverLeftarrow").addClass("popOverrightarrow"),u=v.left+m+10):d.addClass("popOverLeftarrow").removeClass("popOverrightarrow"),d.show();var p=d.width(),E=renderingUtils.windowWidth,g=0;u+p>E&&(g=u+p-E+30,e.css("left",r-g));var h=u-g;d.css({top:c,left:h});var f=$("#eventPopupArrow");d.is(":visible")?f.hide():f.show();var I,C,_,w=a.top-o,y=$("#eventOnboardingSvg");if(d.hasClass("popOverrightarrow")){I='<svg style="width: 320px; height: 35px;" id="evBoardRightArw"><defs><marker id="arrowhead" viewBox="0 0 30 30" refX="24" refY="20" markerWidth="30" markerHeight="30" orient="auto"> <path d="M 8 8 L 25 20 L 5 30" /></marker></defs><g marker-end="url(#arrowhead)"> '+'<path style="display: block" id="path_1" d="M0 0 C90 45 250 45 304 -69" stroke-dashoffset="350" stroke-dasharray="350"></path>'+"</g></svg>",_=a.left+l,s<500&&(_-=20)}else{I='<svg style="width: 100px; height: 50px;" id="evBoardLeftArw"><defs><marker id="arrowhead1" viewBox="0 0 30 30" refX="24" refY="20" markerWidth="30" markerHeight="30" orient="auto"> <path d="M 10 10 L 25 20 L -15 50" /></marker></defs><g marker-end="url(#arrowhead1)"> '+'<path style="display: block" id="path_1" d="M102 -2 C90 5 30 5 0 -45" stroke-dashoffset="150" stroke-dasharray="150"/>'+"</g></svg>",_=h+p-70}C=w+25,y.css({left:_,top:C}).html(I),setTimeout((function(){y.find("#path_1").css("stroke-dashoffset","0")}),10),Events.meetingOnboardScrollBlock=!1,t.on("scroll.ArrowVisibility",Events.onboardArrowScrollListen)}}),600),Events.eventMeetingOnboardingShown=!1}))},onboardArrowScrollListen:function(){if(Events.meetingOnboardScrollBlock)return!1;var e=$("#eventOnboardingSvg"),t=350;e.find("#evBoardLeftArw").length>0&&(t=150),e.find("#path_1").css("stroke-dashoffset",t),Events.meetingOnboardScrollBlock=!0,e.addClass("op0"),setTimeout((function(){var e=$("#eventOnboardingSvg"),t=$("#Events_fldRow_MEETING_VENUE"),n=$(".eventsOnboarding-title"),i=$(".gotomettingpreference"),a=i.width(),r=i.offset(),s=n.offset(),o=n.outerHeight(),l=t.position(),d=t.offset(),c=d.top-$(window).scrollTop();e.css("top",c+25);var v,m=e.offset(),u=m.left,p=m.top,E=s.top,g=s.left;if("evBoardRightArw"==e.find("svg").attr("id")){var h={x:g+10-u,y:E+o-p};v="M 0, 0 C"+((f={x:r.left+a-u,y:r.top-p+20}).x+40)+","+(f.y+50)+" "+(h.x-20)+","+(h.y+100)+" "+(h.x+10)+","+(h.y+10)}else{var f;h={x:0,y:E+o-p};v="M 102,-2 C"+((f={x:100,y:d.top-p+20}).x-30)+","+(f.y+45)+" "+(h.x+20)+","+(h.y+40)+" 0,"+(h.y+10)}var I=e.find("#path_1");I.attr("d",v),l.top>-5&&(e.removeClass("op0"),I.css({"stroke-dashoffset":"0"})),Events.meetingOnboardScrollBlock=!1}),1e3)},generateAccessToken:function(e,t,n){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i={};if(i.type="authorizeMeetingTool","enableMeeting"!==t||(i.type=t,"WebexMeeting"!==e&&"MegaMeeting"!==e))i.toolName=e,i[csrfParamName]=csrfToken,(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",type:"POST",data:i,success:function(n){var i=document.getElementsByClassName("crmBodyWin")[0],a=document.createElement("input");if(a.setAttribute("type","hidden"),a.setAttribute("id","removedRSO"),a.setAttribute("value","true"),moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.fields&&delete moduleRecordMapping.Campaigns.fields,"enableMeeting"===t)switch(t){case"RSO":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps");break;case"meetingBuy":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.meeting");break;case"meetingBuyObserver":i.append(a);break;default:Crm.userDetails.MEETING_BRIDGE_ENABLED?setTimeout((function(){var e=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/settings/modules/Events/events_preferences";Utils.windowLocationHref(e)}),1e3):Utils.windowLocationReload()}else{if($("#meetingauthorize").remove(),$("#calschmeetingauthorize").remove(),n.error&&n.errMsg)return void crmui.showMsgBand("error",n.errMsg,"5000");if("ZohoMeeting"!==e&&"WebexMeeting"!==e){var r=n.authorizeUrl;window.open(r,"Login Meeting","height=800,width=600").opener=null,renderingUtils.removeFreezeLayer()}else switch(n.paid_user&&crmui.showMsgBand("error",n.message,"5000"),t){case"RSO":case"meetingBuy":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps");break;case"meetingBuyObserver":i.append(a);break;default:Crm.userDetails.MEETING_BRIDGE_ENABLED?setTimeout((function(){var e=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/settings/modules/Events/events_preferences";Utils.windowLocationHref(e)}),1e3):Utils.windowLocationReload()}Events.removeHostAuthKey(e)}}});else Events.getLoginCredentials(t,e,n)}},getLoginCredentials:function(e,t,n){networkUtils.loadFeatureScripts(["zohocrm_loginPopup.js"],(function(){var i={};i.toolName=t||"WebexMeeting",i.type=e,i.siteUrl=Events.meetingSiteUrl?Events.meetingSiteUrl:{},i.operation=n,i.showMeetingAuthorizeHelpIcon=Events.showMeetingAuthorizeHelpIcon,i.meetingLoginPopupField=Events.meetingLoginPopupField,i.crmAppName=Crm.appName;var a=document.createElement("DIV");a.innerHTML=Handlebars.templates.loginPopup(i);var r=renderingUtils.windowHeight,s=$("#meetingauthorize");0!=s.length?s.replaceWith(a):document.body.appendChild(a);var o=(r-(s=$("#meetingauthorize")).height()-70)/2;$("#eventCreatePopup").css("z-index",19),s.attr("style","top:"+o+"px !important"),crmui.showPopup({id:"meetingauthorize"})}))},authorizeUsingPwdCredentials:function(e,t){var n={},i=$("#calschmeetingauthorize");n.toolName=e,n.type=t;var a=!1;(commonUtils.showHideLoadingDiv(!0),t?(n.siteUrl=$("#siteUrl").val(),a=Events.validateCredentialFields(!0)):(n.type="authorizeMeetingTool",n.emailAddress=$("#webexemailAddress").val(),n.password=$("#webexPassword").val(),a=Events.validateCredentialFields(!1)),a)?commonUtils.showHideLoadingDiv(!1):(n[csrfParamName]=csrfToken,(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",type:"POST",data:n,success:function(){"enableMeeting"==t&&Utils.windowLocationReload(),i.remove(),commonUtils.showHideLoadingDiv(!1)},error:function(){commonUtils.showHideLoadingDiv(!1),$(".errMsg").hide(),$("#errorMsg_authorizationError1").show()}}),$("#eventCreatePopup").is(":visible")||i.css({"z-index":"31"}))},validateCredentialFields:function(e){var t=$("#errorMsg_authorizationError2"),n=$("#errorMsg_authorizationError3"),i=$("#errorMsg_authorizationError4"),a=$("#webexemailAddress"),r=$("#webexPassword");if(e){if(""==$("#siteUrl").val())return t.show(),!0;t.hide()}else if(""==a.val()||""==r.val()){if(n.hide(),i.hide(),$("#errorMsg_authorizationError1").hide(),""==a.val())return n.show(),!0;if(""==r.val())return i.show(),!0}},constructMeetingToolSelectBox:function(e){var t=Object.keys(e),n="[";for(i=0;i<t.length;i++){n=n+'{"toolName":"'+t[i]+'"},'}return n=n.substring(0,n.length-1),n+="]"},startMeeting:function(e,t,n){var i,a=(i=null!=n?JSON.parse(n):JSON.parse($L("#meetingDetails").val())).meeting_toolName,r=i.meeting_id;if(s=i.meeting_starturl){var s=i.meeting_starturl;window.open(s).opener=null}else if("TeamVMeeting"==a)window.location="teamviewer8://",setTimeout((function(){networkUtils.openUrl(RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"")}),5e3);else{var o="";o="Reminder"==e?t:$("#id").val(),(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=startMeeting&toolName="+a+"&meetingid="+r+"&eventId="+o+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){networkUtils.openUrlwithpopBlockerHandle(e)}})}Crm.trackSpotLightAction("Event Start Meeting",{Place:e})},getModuleName:function(e,t,n){return Crm.getModuleDisplayName(e,t,n)},joinMeeting:function(e){var t=JSON.parse($("#meetingDetails").val());null!=e&&(t=JSON.parse(e));t.meeting_toolName,t.meeting_id;var n=t.meeting_joinurl;window.open(n).opener=null},openCalendarPref:function(e){commonUtils.showHideLoadingDiv(!0);var t=$("#eventCreationDiv").is(":visible");t&&$("#FreezeLayer").css("z-index","31"),(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/Calendar.do?type=getCalPreferences",type:"POST",success:function(n){document.getElementById("pref")||$("body").append("<div id='pref' class='newpopup zi32 pref' style='padding:30px; display:none'></div>"),Crm.trackSpotLightAction("Activities - Calendar Preferences Click"),commonUtils.showHideLoadingDiv(),$("#pref").html(n).show(),manipulateScriptElems(getElemById("pref")),renderingUtils.freezeBackground(),preference_pos(),Events.calPrefCenter("pref"),showHideDuration("openCalendarPref"),t?$("#pref").css({top:$L(window).scrollTop()}):$("#pref").css({top:0});var i=$(window).height()-($("#pref .recLabelDiv").outerHeight()+$("#pref #prefBtns").innerHeight()+126);$("#calPrefer_outer").animate({height:i}),t&&$L("#calPrefer_inner").scrollTo($("#audio_pref_container").offset().top-100,500),e&&document.getElementById(e).scrollIntoView(),crmui.modalZIndex("nonLyte",$L("#pref")[0],"open")}})},calPrefCenter:function(e){let t=(renderingUtils.windowWidth-675)/2;$L("#"+e).css({top:"0px",left:t}),window.document.documentElement.style.overflow="hidden"},changeMeetingPref:function(e,t){"ap-own-pref"===e.value||"ap-own-pref"===e.component.data.ltPropValue?($("#confrencedetails_"+t).css("display","table-cell"),$("#confid"+t).focus(),$L("#tAfix").addClass("tA")):($("#confrencedetails_"+t).css("display","none"),$L("#tAfix").removeClass("tA"))},showAttendessToolTip:function(e,t,n){crmui.showTooltip({content:I18n.getMsg("crm.event.joined.meeting")+": <b> "+e+"</b><br> "+I18n.getMsg("crm.event.left.meeting")+": <b> "+t+"</b><br> "+I18n.getMsg("crm.event.duration.meeting")+":<b>"+n+"</b>",isHTML:!0,position:"showOnRight"}),$(".moreOptions").addClass("hide")},loadHtmlForMeetingLength:function(e){var t='<div id="meetingLength" class="timeAlert" style="display:none"><div><div class="noteinfocont p3 mT5"><table cellpadding="3" cellspacing="0" border="0"><tbody><tr><td valign="top"><span class="dupTimeAlert"></span></td><td class="crm-small-font-size">';return t+=I18n.getMsg("crm.event.meeting.title.length.limit.msg",[e,Events.meetingTitleLength[e]]),t+="</td></tr></tbody></table></div></div></div>",$(t)},changeTitleMessageDiv:function(e){e=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name");var t=$("#meetingLength");if(e||(e=Events.meetingToolName),($("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")&&"edit"!==Events.currentStatus||Events.withMeetingTool&&"edit"===Events.currentStatus)&&$("#Crm_Events_SUBJECT").val().length>Events.meetingTitleLength[e]){var n=Events.loadHtmlForMeetingLength(e);t.replaceWith(n[0]),(t=Events.getObj("meetingLength")).show()}else t.hide()},getObj:function(e){return $("#"+e)},changeLocationValue:function(e){var t=$("#Events_fldRow_RECURRING"),n=$("#meetingOnlineProviders"),i=$("#Events_fldRow_LOCATION"),a=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name"),r=$("#meetingInclude"),s=$("#errorMsg_authorizationError"),o=$("#Crm_Events_LOCATION");if(s.is(":visible")&&(s.hide(),n.removeClass("errorFieldP")),"SaveEntity"!=e&&Events.showOrHideAllDayEvent(),r.prop("checked")){Events.meetingCheckBoxEnabled=!0,$(t).hide(),n.show(),Events.onlineMeetingVenue(),$("#Events_fldRow_ALLDAYEVENT").hide(),Events.changeTitleMessageDiv(a),i.addClass("disable-events"),o.val(I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[a]));var l=Events.checkAuthorizeDone(a,e);return o.attr("readOnly",!0),1==$("#Crm_Events_MeetingSolutions_select").length&&n.addClass("borderNone"),l}Events.meetingCheckBoxEnabled=!1,$(t).show(),n.hide(),$("#meetingLength").hide(),i.removeClass("disable-events"),o.val(""),o.attr("readOnly",!1),$("#Events_fldRow_ALLDAYEVENT").show()},hideSubMenu:function(){$(".setList").removeClass("MV_selected_edit_prop"),$("#MB_subMenu").hide(),document.getElementById("mdBldCnt").removeEventListener("scroll",null)},modifyLocationValue:function(){$("#saveEventsBtn").prop("disabled",!1);var e=$("#Crm_Events_MEETING_VENUE"),t=$("#Crm_Events_MEETING_PROVIDER"),n=Events.getToolNamefromDisplayName(t.val()),i=$("#Crm_Events_STARTDATETIME"),a=($("#Crm_Events_ENDDATETIME"),$("#Crm_Events_STARTDATETIME_TimeOption"),$("#Crm_Events_ENDDATETIME_TimeOption"),$("#Events_fldRow_MEETING_PROVIDER")),r=$("#Events_fldRow_MEETING_VENUE");$("#provNotEnabledAlert").remove(),$("#provNotAuthorisedAlert").remove();var s=t.attr("data-picklistmap");s&&JSON.parse(s).forEach((function(e){e.uservalue===n&&(n=e.systemvalue)}));var o=JSON.parse(s||"[]").length;if(0!==e.length&&$("#CrmEventMeetingInteg").remove(),e.val()===I18n.getMsg("Online")){crmConstants.helpUrl&&!Crm.userDetails.LITE.IS_LITE_USER&&Events.showonboardingChanges(),$("#meetingInfoIcon").show(),"true"===isSandboxAcc?(a.length>0&&a.hide(),r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.sandbox.alert")+"</span></div>")):"F"===Crm.userDetails.LICENSE_TYPE||"N"===Crm.userDetails.LICENSE_TYPE||"L"===Crm.userDetails.LICENSE_TYPE?(a.length>0&&a.hide(),r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.freeedition.alert")+"</span></div>")):Events.isRecurringEditAvail?r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">Recurring online meetings are not supported.</span></div>'):"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME||Crm.userDetails.isSupportAccessExitSessionEnabled?(a.length>0&&a.hide(),"edit"===Events.currentStatus?r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.supportuser.alert2")+"</span></div>"):r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10 meetingVenueTranspBg" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meeting.online.supportuser.alert")+"</span></div>")):0===o&&(Crm.userDetails.IS_ADMIN?r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10" style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meetingprovider.admin.message1")+' <a href="javascript:Events.getConfirmationAndRedirect();">'+I18n.getMsg("crm.meetingprovider.admin.message2")+"</a></span></div>"):r.after('<div id="provNotEnabledAlert" class="crm-small-font-size pT6 pB6 p10"  style="background : #f5f5f5"><span class="mcSvgIcons ico-warning-small-red dIB vaM zcicncss-infoSolid zcicn-cssIcons zcicn_red_mask"></span><span class="vaM mL7 crmParagraphColor">'+I18n.getMsg("crm.meetingprovider.nonadmin.message")+"</span></div>"));var l=$("#provNotEnabledAlert");0!==l.length&&l.addClass("meetingVenueHiRed"),Events.onlineMeetingVenue();var d=$L.moment(i.data("dateObj")).toDate(),c=$L.moment().toDate();$L.moment(c.valueOf()+36e5).toDate();if(d<c)return"false"!==isSandboxAcc||Crm.userDetails.LITE.IS_LITE_USER||crmui.showMsgBand("info",$ESAPI.encoder().encodeForHTML(I18n.getMsg("crm.event.meeting.time.invalid.error")),3e3),!0;Events.validateOnlineProvider("Events","text")}else $("#meetingInfoIcon").hide(),$(".eventsOnboarding").hide()},onlineMeetingVenue:function(){var e=$("#Events_fldRow_ALLDAYEVENT"),t=$("#Events_fldRow_RECURRING");(e.is(":visible")||t.is(":visible"))&&(e.hide(),t.hide());var n=$("#Crm_Events_ALLDAYEVENT");n.is(":checked")&&(n.prop("checked",!1),crmTemplate.modifyCheckBox(null,n,"Events"))},getConfirmationAndRedirect:function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.meetingprovider.admin.message2.line1"),ltPropSecondaryMessage:I18n.getMsg("crm.meetingprovider.admin.message2.line2"),ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.cancel")},{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"failure"}],ltPropButtonPosition:"center"},accept:function(){Utils.windowLocationHref(Crm.getCrmBasePath()+"/settings/modules/Events/events_preferences")}})},showOrHideAllDayEvent:function(e,t){$("#Crm_Events_MEETING_VENUE").val()===I18n.getMsg("Online")?$("#Events_fldRow_ALLDAYEVENT").hide():$("#Events_fldRow_ALLDAYEVENT").show(),e||Events.checkDuplicateEvent(void 0,!1,void 0,void 0,t)},checkAuthorizeDone:function(e,t,n){if(Events.userChange=!1,"ZohoMeeting"!=e&&Events.meetingConfZuid){var i=Crm.userDetails.USER_ID,a=$("#ownerNameLookupSpan"),r=a.attr("userId"),s=a.text(),o=$("#Crm_Events_SMOWNERID");if("calendar"!=Events.createSource||"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||(r=Events.currentEventHostId),!r)if("edit"==Events.currentStatus){r=$("#changeOwnerPopUp").data("id");var l=document.querySelector("crm-user-wrapper");l&&(s=l.component.getData("userName")),r||(r=o.attr("data-id"),s=o.attr("title"))}else"create"!=Events.currentStatus&&"clone"!=Events.currentStatus||(r=o.attr("data-id"),s=o.attr("title"));var d=null!=n?n:[];if(Events.GetAuthorizedUserCallBack?Events.GetAuthorizedUserCallBack=!1:d=Events.getAuthorizedUsers(e,i,t),i==r&&d&&!d.contains(i)){if("SaveEntity"!==t)if(Crm.userDetails.MEETING_BRIDGE_ENABLED){if(MeetingBridge){var c=MeetingBridge.providerNameVsId[e];MeetingBridge.loadAuthorizePopup(c)}}else Events.showMeetingAuthorizationPopUp(e,t);else Events.showAuthorizationError();return $("#saveEventsBtn").attr("disabled","disabled"),!1}if(i!=r&&d&&!d.contains(r)){var v=$("#Crm_Events_MeetingSolutions_select").val();v||(v=Events.meetingToolName),renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[s,v,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e,r),"ChangeOwner"!=t&&$("#saveEventsBtn").attr("disabled","disabled"),Events.userChange=!0}}},showAuthorizationError:function(){var e="crm.event.meeting.errormsg2",t=$("#CrmEventMeetingInteg").offset().top-($("#eventCreatePopup").offset().top+50);1==document.getElementById("Crm_Events_MeetingSolutions_select").length&&(e="crm.event.meeting.errormsg1"),$("#errorMsg_authorizationError").html(I18n.getMsg(e,[Events.displayToolName[$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")],Events.getModuleName(!0,!1,!0)])),$("#errorMsg_authorizationError").show(),$("#meetingOnlineProviders").addClass("errorFieldP"),$("#eventCreationInnerDiv").scrollTop(t)},loadMeetingbridge:function(){if(Crm.userDetails.MEETING_BRIDGE_ENABLED&&"object"!=typeof MeetingBridge&&"F"!==Crm.userDetails.LICENSE_TYPE&&"N"!==Crm.userDetails.LICENSE_TYPE&&"L"!==Crm.userDetails.LICENSE_TYPE){var e={serviceName:"ZohoCRM",serviceID:Crm.userDetails.ZGID,mbDomain:RebrandLinkUtil.getProperty("MEETINGBRIDGE_URL")};Events.downloadMeetingbridge(e)}},downloadMeetingbridge:function(e){var t={};t.parts=location.hostname.split("."),t.subdomain=t.parts.shift(),t.uplvldom=t.parts.join("."),t.server=e.mbDomain;var n=document.createElement("script"),i=new XMLHttpRequest;i.open("GET",t.server+"/meetingbridge/v1/loadJS",!0),i.withCredentials=!0,i.send(null),i.onreadystatechange=function(){if(4===i.readyState){var t=JSON.parse(i.response);n.src=t.MeetingBridgeJS,n.pbJsUrl=t.PBJsUrl,n.onload=function(){MeetingBridge.parentDomain=window.origin,MeetingBridge.init(n,e)},document.head.appendChild(n)}}},getAuthorizedUsers:function(e,t,n){var i=[];if(!Crm.userDetails.MEETING_BRIDGE_ENABLED){var a=Events.meetingConfZuid[e];"string"==typeof a&&(a=JSON.parse(a));for(var r=a?a.length:0,s=0;s<r;){var o=a[s];for(id in"string"==typeof o&&(o=JSON.parse(o)),o)o.hasOwnProperty(id)&&1==o[id]&&i.push(id);s++}return i}store.findAll("dummy",{type:"getAuthorizedUsers",providerId:MeetingBridge.providerNameVsId[e],userId:t},!1,!1,{url:Crm.getCrmBasePath()+"/events/EventAction.do",method:"GET"}).then((function(t){Events.GetAuthorizedUserCallBack=!0,Events.checkAuthorizeDone(e,n,t instanceof Object?t:JSON.parse(t))}))},getInstalledMeetingTools:function(){var e=[];if(!Crm.userDetails.MEETING_BRIDGE_ENABLED){if(""==Crm.calPreferences.MEETINGPREFDETAILS||!Crm.calPreferences.MEETINGPREFDETAILS)return[];for(var t=JSON.parse(Crm.calPreferences.MEETINGPREFDETAILS),n=t.length,i=0;i<n;i++){var a=t[i];a.toolName in e||e.push(a.toolName)}}return e},getEnabledMeetingToolsFromStore:function(){var e=CMB.eventFldColNameVsId.MEETING_PROVIDER,t=[];""!==e&&(t=void 0!==store.peekRecord("field",e)?store.peekRecord("field",e).pick_list_values:[]);for(var n=t.length,i=[],a=0;a<n;a++)"used"===t[a].type&&i.push(t[a].display_value);return i},showHideFields:function(e){var t="Client location",n="In-office";if("MEETING_VENUE"===e.data("name")){var i=$(".meetingprovider"),a=$(".meetinglocation"),r=e.data("reference_options");r.includes("Online")?(i.removeClass("hide"),a.addClass("margin0")):(i.addClass("hide"),a.removeClass("margin0"),CMB.eventHideField="MEETING_PROVIDER"),r.includes(t)||r.includes(n)?(a.removeClass("hide"),$("#locationFldRequired").show()):(a.addClass("hide"),CMB.eventHideField="LOCATION",$("#locationFldRequired").hide()),r.includes("Online")&&(r.includes(t)||r.includes(n))&&(CMB.eventHideField="")}},getAlertMessageBasedOnCount:function(e,t,n){var i=t.length;return 1===i?I18n.getMsg(e+"1","object"!=typeof t[0]?t[0]:t[0].name):2===i&&i<n?I18n.getMsg(e+"2",["object"!=typeof t[0]?t[0]:t[0].name,"object"!=typeof t[1]?t[1]:t[1].name]):I18n.getMsg(e+"3",["object"!=typeof t[0]?t[0]:t[0].name,i-1])},showMeetingAuthorizationPopUp:function(e,t,n,i){networkUtils.loadFeatureScripts(["zohocrm_meetingAuthorizePopUp.js"],(function(){n&&Events.startMeetingWindowObject&&Events.startMeetingWindowObject.close();var a={};a.toolName=e,a.origin=t,a.isReauthorize=n,a.isCalendarBooking=i,a.crmAppName=Crm.appName;var r=document.createElement("DIV");r.innerHTML=Handlebars.templates.meetingAuthorizePopUp(a);var s=renderingUtils.windowHeight,o=$("#meetingauthorize");0!=o.length?o.replaceWith(r):document.body.appendChild(r);var l=(s-(o=$("#meetingauthorize")).height()-70)/2,d=$("#eventCreatePopup"),c=$("#FreezeLayer"),v=d.attr("style"),m="z-index",u=c.css(m),p=isNaN(Number(u))?Number(d.css(m)):Number(u);d.attr("style","z-index : "+(p-1)+"!important;"+v),o.attr("style","top:"+l+"px !important; z-index :"+(p+2)+"!important"),crmui.showPopup({id:"meetingauthorize"})}))},closeAuthorizationPopUp:function(e,t){var n=$("#saveEventsBtn"),i=$(".eventPop"),a=$("#eventCreatePopup");crmui.hidePopup("meetingauthorize",!1),n.attr("disabled",!1),a.css("z-index",31),$("#meetingInclude").prop("checked",!0),0==a.length?$("#calschmeetingauthorize").css({"z-index":"31"}):i.is(":visible")?i.is(":visible")&&renderingUtils.freezeBackground():renderingUtils.removeFreezeLayer(),commonUtils.showHideLoadingDiv(!1),Events.removeHostAuthKey(e)},sharedRecorded:function(e){Lyte.injectResources(networkUtils.returnDependencyFiles(["zcrm_eventMeetingShareRecording.js","simpleemail-min.css"],ResourceConstants.CRM),void 0,(function(){var t={type:"getMailDetailsforShareRecording",eventId:e||$L("#id").val(),email:Crm.userDetails.LOGIN_NAME};(new crmRequestPool).initiate({type:"GET",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:t,success:function(e){var t={};t.fromemail=Crm.userDetails.LOGIN_NAME;var n=Handlebars.templates.eventMeetingShareRecording(t),i=$L("#BodyContent");i.length||(i=$L("#show")),i.append($L(n)[0]),Events.loadTagitPlugin(),$("#EMAIL_MSG_TEXT_AREA").html(e.mailBody),$("#shareScreenSubject").val(e.mailSubject),$("#Crm_Events_SENDTO_select").select2({minimumResultsForSearch:-1}),crmui.showPopup({id:"sharerecordingpopup"})}})}))},shareRecoredInMail:function(){var e=$("#id").val(),t=$("#Crm_Events_SENDTO_select").val(),n=$("#EMAIL_MSG_TEXT_AREA").html(),i=$("#shareScreenSubject").val(),a={type:"sendRecordedDetails",eventId:e,shareRecordingType:t,mailContent:n,additionEmailids:JSON.stringify(Events.invJsonCreate.e),mailSubject:i};crmui.hidePopup("sharerecordingpopup"),(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:a,success:function(e){Events.invJsonCreate.e={},crmui.showMsgBand("success","Recording sent",4e3)}})},setEmailIdsInSharingTextArea:function(e,t){var n="",i=t?JSON.parse(t):returnJson.entMetaData.all_participants.clone(),a=JSON.parse(returnJson.entMetaData.meeting_detials);if("Not Attended"==e){if(0!=(o=objectUtils.getKeys(a.attendees_details)).length&&0!=i.length)for(var r=0;r<o.length;r++){var s=i.indexOf(o[r]);s>=0&&i.splice(s,1)}n=i.join(", ")}else if("All Participants"==e)n=i.join(", ");else if("Attendees"==e){var o;n=(o=objectUtils.getKeys(a.attendees_details)).join(", ")}$("#EMAIL_ID_TEXT_AREA").val(n).prop("readonly",!0)},loadEmailToShareRecored:function(e){var t=$("#EMAIL_ID_TEXT_AREA");if("Others"===e)t.val("").prop("readonly",!1);else if(returnJson.entMetaData.all_participants)Events.setEmailIdsInSharingTextArea(e,void 0);else{var n=new crmRequestPool,i={type:"participantDetails",eventId:$("#id").val()+"",option:e};n.initiate({action:Crm.getCrmBasePath()+"/events/EventAction.do",data:i,type:"GET",success:function(t){returnJson.entMetaData.all_participants=JSON.parse(t),Events.setEmailIdsInSharingTextArea(e,t)}})}},callAuthorization:function(e,t,n){$("#saveEventsBtn").prop("disabled",!1),Crm.userDetails.MEETING_BRIDGE_ENABLED?(void 0===n&&(n=MeetingBridge.providerNameVsId[e]),"modal"===t?MeetingBridge.loadAuthorizePopup(n):"text"===t&&(MeetingBridge.getEnabledProviders().then((function(t){for(var i=t.providers.length,a=!1,r=0;r<i;r++)if(t.providers[r].name===e){a=!0;break}a?MeetingBridge.authorizeProviderNow(n):_cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropPrimaryMessage:I18n.getMsg("crm.meeting.online.notenabled.authorised.message1.line1"),ltPropSecondaryMessage:I18n.getMsg("crm.meeting.online.notenabled.authorised.message1.line2",e),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.done"),appearance:"failure"}],ltPropButtonPosition:"center"}})})),$("#provNotAuthorisedAlert").remove())):Events.authorizeMeetingIndividual($("#Crm_Events_MeetingSolutions_select option:selected").attr("name"))},authorizeMeetingIndividual:function(e,t){if(Crm.userDetails.MEETING_BRIDGE_ENABLED){var n=MeetingBridge.providerNameVsId[e];MeetingBridge.loadAuthorizePopup(n)}else{if($("#eventCreatePopup").is(":visible")||$("#calschmeetingauthorize").css({"z-index":"19"}),("WebexMeeting"===e||"ClickMeeting"===e||"MegaMeeting"===e||"StarLeafMeeting"===e)&&"Login"!==t)return void Events.getLoginCredentials(void 0,e,"create");Events.generateAccessToken(e,"")}},showMeetingDetailsTooltip:function(){var e=" ",t=$("#Crm_Events_MeetingSolutions_select");1==t.length&&("Zoho Meeting"==t[0].value&&(e=" (powered by Zoho Meeting) "));crmui.showTooltip({content:I18n.getMsg("crm.event.meeting.toolTip.point1",e)+" <br><br> "+I18n.getMsg("crm.event.meeting.toolTip.point2",[Events.getModuleName(!0,!1,!0)]),isHTML:!0,position:"showOnRight"})},showOnlineMeetingVenueTooltip:function(){return I18n.getMsg("crm.meeting.infoicon.message.point1")+" <br><br> "+I18n.getMsg("crm.meeting.infoicon.message.point2")},meetingTrialExpireOkClicked:function(){$("#meetingBuy").remove(),$("#Crm_Events_LOCATION").val(""),$("#meetingInclude").prop("checked",!1)},meetingBuyNowClicked:function(){$("#meetingBuy").remove(),0!=$("#modDiv").length&&0==$("#eventCreationDiv").length&&renderingUtils.removeFreezeLayer(),renderingUtils.removeDummyBackground();var e=RebrandLinkUtil.getProperty("MEETING_PAYMENTS_URL");window.open(e)},viewInvitationDetails:function(){renderingUtils.freezeBackground();var e={};e.eventTitle=$("#entityNameInBCView").text(),e.eventDateTime=returnJson.eventStartDateTime;var t=returnJson.entMetaData.meeting_detials;if(null!=t){var n=JSON.parse(t);e.joinURL=n.meeting_joinurl,n.meeting_dialIn&&"build-in"!=n.meeting_dialIn&&(e.dialDetails=n.meeting_dialIn)}var i=Handlebars.templates.viewOnlineInvitationDetails(e);$("body").append(i),mailsetCenter("onlinemeetingInvitationDetails")},closeOnlineMeetingJoinDetails:function(){$("#onlinemeetingInvitationDetails").remove(),renderingUtils.removeFreezeLayer()},copyonlinemeetingDetails:function(){var e=$("#meetingjoinurlval");e.val($("#meeting-join-url").text()),e.select(),document.execCommand("copy"),Events.closeOnlineMeetingJoinDetails(),e.val("")},isOnlineVenuePresent:function(){var e;return store.findAll("field",{module:"Events"},!1,!0,{apiVersion:"4"}).then((function(t){if(void 0!==t){var n,i=t.length;for(n=0;n<i;n++)if("MEETING_VENUE"===t[n].column_name){var a,r=t[n].pick_list_values,s=r.length;for(a=0;a<s;a++)if("Online"===r[a].actual_value){e=!0;break}}return!!e}}))},isEnabledProviders:function(e){var t=[];return store.findAll("field",{module:"Events"},!1,!0,{apiVersion:"4"}).then((function(n){if(void 0!==n){var i,a=n.length;for(i=0;i<a;i++)if("MEETING_PROVIDER"===n[i].column_name){var r,s=n[i].pick_list_values,o=s.length;for(r=0;r<o;r++)"used"===s[r].type&&t.push(s[r].display_value);e&&e(t);break}}}))},loadZohoMeetingDisablePopForMarketplace:function(){var e=[];e[0]={comparator:"equal",field:{api_name:"Meeting_Provider__s",ui_type:2,label:"Provider"},value:"Zoho Meeting"},e[1]={comparator:"greater_than",field:{api_name:"Start_DateTime"},value:$L.moment().toDate().toISOString().slice(0,19)+"+00:00"},Events.getMeetingCountBasedOnCriteria(e).then((function(t){var n=0;t.count>0&&(n=t.count),Events.loadSingleProviderDisablePop(void 0,"ZohoMeeting",n,e,"body");var i=document.getElementById("yesBtn");i.removeAttribute("click"),i.setAttribute("onclick",'Events.disableMeetingTool("ZohoMeeting")')}))},getMeetingCountBasedOnCriteria:function(e){store.model[moduleRecordMapping.Events.id]||store.registerModel(moduleRecordMapping.Events.id,{},{extends:"entity"});var t={filters:JSON.stringify({group_operator:"AND",group:e})};return store.triggerAction(moduleRecordMapping.Events.id,"count",t)},loadFilteredReports:function(e){var t={module:"Events",action:"viewMeetings"};t.criteria=JSON.stringify({group_operator:"AND",group:e});var n=Lyte.Router.getURL({route:"crm.tab.newReports.records",dynamicParams:moduleRecordMapping.Events.id,queryParams:t});networkUtils.openUrl(n,"_blank","")},getModelForReportsView:function(e){var t=[{api_name:"Event_Title",ui_type:"11"},{api_name:"Start_DateTime",ui_type:"333"},{api_name:"End_DateTime",ui_type:"333"},{api_name:"Meeting_Provider__s",ui_type:"2",label:"Provider"}],n={};n.criteria=e.queryParams.criteria,n.report=[],n.report[0]={},n.report[0].fields=[];for(var i=t.length,a=0;a<i;a++)n.report[0].fields[a]=t[a];return n.report[0].name=I18n.getMsg("crm.meeting.online.scheduled"),n.report[0].module={},n.report[0].module.api_name=moduleRecordMapping.Events.api_name,n.report[0].module.id=moduleRecordMapping.Events.id,n.isSortingNeeded=!1,n.listViewUI=!0,n},loadSingleProviderDisablePop:function(e,t,n,i,a){var r=document.querySelector("meeting-disable");null!==r&&r.remove(),Lyte.Component.render("meeting-disable",{toolId:e,toolName:t,onlineMeetingsCount:n,criteriaGroupArr:i},a),document.getElementById("singleProviderDisable").ltProp("show",!0)},loadColorPicker:function(e){var t,n=$(e),i=n.prop("id");if(Crm.userDetails.isStaticSubFormEnabled){var a=$L("#fieldtyperesult2").find("#picklistFieldFPPopup");a&&a.length>=1&&(t="#fieldtyperesult2 #"+i)}var r,s=n.attr("data-source"),o=document.getElementById("colorpicker"),l="",d=document.querySelector("crm-user-eventtype");if(r=$(e).hasClass("picklistColorNoFill")?"transparent":$(e).find(".colorDropper_mb").css("background-color")){var c;c="transparent"===(r=Events.rgbtohex(r))?"bg_"+r:"bg_"+r.slice(1),["bg_88413e","bg_cc5e5a","bg_ff4e47","bg_ffa246","bg_f8f65f","bg_ccff33","bg_56fb56","bg_4cc381","bg_7ee7ff","bg_9dc4ff","bg_5590ff","bg_5f80bd","bg_6c6cee","bg_a076ff","bg_c14adf","bg_e789ff","bg_ffb8e8","bg_ff879b","bg_ff4d77","bg_b7b7b7"].contains(c)&&(r=c)}if(d&&(l=d.component.data.from),o&&"Events"===CrmPageLayout.module||o&&"calendar"===l)o.setData({originElem:"#"+i,show:!0,selectedColor:r,from:l,domElements:{pickList_Wrapper:{show:!1}}}),(v=$L("crm-picklist-colorpicker")[0].component)&&v.getData("customColorlen")>=0?o.setData({originElem:"#"+i,show:!0,selectedColor:r,from:l,domElements:{pickList_Wrapper:{show:!1}}}):Lyte.Component.render("crm-picklist-colorpicker",{originElem:"#"+i,id:"colorpicker",from:l,selectedColor:r},"body");else if(s&&"blueprint"===s){Lyte.Component.render("crm-picklist-colorpicker",{originElem:"#"+i,id:"colorpicker",from:l,selectedColor:r,source:"blueprint"},"body").setMethods("onSelect",BlueprintTransition.saveColorForTransition)}else{var v;(v=$L("crm-picklist-colorpicker")[0])&&v.getData("customColorlen")>=0?o.setData({originElem:t||"#"+i,show:!0,selectedColor:r,from:l,domElements:{pickList_Wrapper:{show:!1}}}):Lyte.Component.render("crm-picklist-colorpicker",{originElem:t||"#"+i,id:"colorpicker",from:l,selectedColor:r},"body")}},loadColorNearSelect2:function(e){var t=e.children("option:selected")[0],n=$(t).attr("data-colorcode");n&&$('<span class="dIB activitesColor" data-zcqa="color_span" style="background:'+n+'"></span>').insertBefore(e)},rgbtohex:function(e){if(void 0!==e){if(e.startsWith("rgba"))return Events.rgbatohexa(e);if(-1===e.search("rgb"))return e;{function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+t(e[2])+t(e[3])}}},rgbatohexa:function(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.substr(5).split(")")[0].split(","))[0])+t(e[1])+t(e[2])+(0==(n=e[3])?"00":Math.round(255*n).toString(16));var n},checkForPublicFields:async function(e,t,n){if(featuresAvailable.PUBLIC_FIELD)return!await Lyte.registeredMixins["crm-view-utils"].checkAndRenderPublicFields(e,t,n)}},CrmReminderNotification={};function openPrintTemplatePop(e,t){var n=networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+e+"&module="+t+"&action=print");if(n=networkUtils.getPortalURL(n),$("#tIdx").length>0&&(n+="&tIdx="+$("#tIdx").val()),$("#relParentId").length>0&&(n+="&relParentId="+$("#relParentId").val()),$("#TotalNotesCount").length>0&&(n+="&TotalNotesCount="+$("#TotalNotesCount").val()),$("#currentCount").length>0&&(n+="&currentCount="+$("#currentCount").val()),$("#model").length>0&&(n+="&model="+$("#model").val()),$("#notesTypeHolder").length>0&&(n+="&isallnotes="+$("#notesTypeHolder").attr("isallnotes")),Crm.userDetails.isRelatedListLyteEnabled?n+="&hiddenNotes=false":$("#hiddenNotes").length>0&&($("#hiddenNotes").is(":visible")?n+="&hiddenNotes=true":n+="&hiddenNotes=false"),"Accounts"===t){var i=$("#contactSelDropdownInAcc :selected").attr("value");i&&(n+="&contactId="+i)}adjustScreenAndOpen(n,t)}function adjustScreenAndOpen(e,t){if("undefined"!=typeof crmNewPortal&&crmNewPortal)Crm.showURLChangeAlert(!1);else{var n=window.screen.availWidth,i=window.screen.availHeight,a=n,r=i;r=i<450?440:i<600?550:i>700?680:i-50,n<1200||n<=1440?a=1150:n>1500&&(a=1200),Crm.userDetails.ISPAID_USER||Crm.isInventoryModule(t)||(a=800);var s=100;n>a&&(s=(n-a)/2),window.open(networkUtils.getOrgSpecificURL(e),"","toolbar=no, scrollbars=yes, resizable=yes, top=0, left="+s+", width="+a+", height="+r)}}function showPopupMenuOld(e,t,n,i,a,r){hideMenu(a);var s=e.offsetWidth,o=e.offsetHeight,l=renderingUtils.findPosY(getObj(e.id)),d=renderingUtils.findPosX(getObj(e.id)),c=getObj(t),v=0;if(-1!=navigator.userAgent.indexOf("Firefox")&&getObj("dv-button-layer")&&"fixed"===getObj("dv-button-layer").style.position&&"Contact Tools"===e.id)v=document.getElementById("show").offsetLeft;c.style.display="block";var m=c.offsetWidth,u=c.offsetHeight;if(null!=r&&(e.className=r),"addAttach"===$(e).attr("id")&&$("#dvinner").length){var p=$(e).offset();return $(c).offset({top:p.top+o,left:p.left-v-m}),void $(c).offset({top:p.top+o,left:p.left-v-m})}c.style.left=null==n||"left"==n?d-v+"px":d+s-m-v+"px",c.style.top=null==i||"bottom"==i?l+o+"px":l-u+"px"}CrmReminderNotification.init=function(){var e=window.Notification||window.mozNotification||window.webkitNotification;e&&"denied"!==e.permission&&"granted"!==e.permission&&$(document.body).one("click",(function(){e.requestPermission()}))},CrmReminderNotification.show=function(e,t,n,i){var a={icon:e,body:n};i.id&&(a.tag=i.id);var r=new Notification(t,a);i.clickUrl&&(r.onclick=function(){window.open(i.clickUrl,"_blank")})},Handlebars.registerHelper("getValueForRemInputBox",(function(e,t){var n=Events.getValueForRemInputBox(e);return""==n?t.inverse(this):n})),Handlebars.registerHelper("getValueForRemInputBoxAndSpanRemInv",(function(e,t,n,i,a,r){var s=e.split(" "),o=s[0],l="";if(2===s.length)return Handlebars.helpers.getValueForRemInputBoxAndSpan(e,t,n,i,a,r);switch(s[1]){case"minutes":o=s[0],l="mins";break;case"days":case"day":o=s[0],l="days";break;case"hour":o=s[0],l="hrs";break;case"time":o=0,l="weeks"}var d=o+" "+l;return"None"===o&&(d="none"),Handlebars.helpers.getValueForRemInputBoxAndSpan(d,t,n,i,a,r)})),Handlebars.registerHelper("getValueForRemInputBoxAndSpan",(function(e,t,n,i,a,r){null==e&&(e=n.indexOf("Appointment")>0?Crm.calPreferences.APPOINTMENT_REMINDAT:Crm.calPreferences.REMINDAT);var s=Events.getValueForRemInputBox(e),o=e.split(" ");t||"weeks"==o[1]&&(s*=7);var l="<input type='text' value='",d=null;d=t&&("hrs"==o[1]&&s>24||"mins"==o[1]&&s>1440)?s+"' style='display:none;'":0==s?"0' style='display:none;'":s+"'";var c=n+(parseInt(r)+3);return"Crm_Events_REMINDINVITEESAT"===n&&(c=n),l=(l+=d)+" id='"+c+"' onmouseenter='$(this).css(&#39;border&#39;,&#39;1px solid #ddd&#39;);$(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;&#39;);' onmouseleave='$(this).css(&#39;border&#39;,&#39;&#39;);sE(event)' onkeyup='Events.changeVal(this)' onkeypress='return event.charCode >=48 && event.charCode <=57' onclick='this.setSelectionRange(0, this.value.length)' onfocusout='Events.validateTimeNumeralFieldOfReminders(this)' onfocus='Events.setPreviousValue(this)' data-value='"+Events.getDataValue(e,t)+"' class='selectBoxField dIB vaM multiselectreminder' maxlength='2'"+Events.convertObjToKeyValuePair(i)+Events.convertObjToKeyValuePair(a),"true"==a["data-readonly"]&&"Crm_Events_REMINDINVITEESAT"===n&&(l+="readonly='true'"),l+="'/>",l+="<div class='selectOpt dIB vaM' onmouseenter='$(this).parent(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;1px solid #ddd&#39;);' onmouseleave='$(this).parent(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;&#39;);sE(event);'>",l+="<span class='slctOptVal'",1==Events.setPadding(e)&&(l+="style='padding-left:10px'"),l+=">",Events.getHtmlForReminders(e,l,t)})),Handlebars.registerHelper("isUndefinedOrEmpty",(function(e,t){return null==e||""==e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("setReminderVars",(function(e){null==e||""==e?(Events.maxReminderValue=1,Events.reminderCount=1,Events.reminders=[],Events.allDayReminders=[]):(Events.maxReminderValue=e.length+2,Events.reminderCount=e.length+1,Events.reminders=[],Events.allDayReminders=[])})),Handlebars.registerHelper("sum",(function(e,t){return parseInt(e)+parseInt(t)})),Handlebars.registerHelper("constructMultipleRemindersOptions",(function(e){return Events.constructMultipleRemindersOptions(void 0,void 0,e)})),Handlebars.registerHelper("getDataValue",(function(e){return Events.getDataValue(e)})),Handlebars.registerHelper("getNumberOfRemindersText",(function(e){return I18n.getMsg("crm.event.number.of.reminders",[e.length])})),Handlebars.registerHelper("getDisplayReminderText",(function(e,t,n){return Events.getHtmlForEventReminder(e,Events.getValueForRemInputBox(e),t,n)})),Handlebars.registerHelper("isReminderDivNeeded",(function(e,t){return 1==e.length?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("isNoneNeeded",(function(e,t){return null!=e&&e.length>=20?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("isPreferenceReminderNeeded",(function(e,t){if("Appointments"!==Events.moduleName&&"Appointments"!==crmCommonModule.moduleName||void 0===Crm.calPreferences.APPOINTMENT_REMINDAT){if(void 0!==e&&e.length<=1||"edit"===Events.currentStatus||"clone"===Events.currentStatus||"none"===Crm.calPreferences.REMINDAT)return t.inverse(this)}else if("edit"===Events.currentStatus||"clone"===Events.currentStatus||"edit"===crmCommonModule.currentStatus||"clone"===crmCommonModule.currentStatus||"none"===Crm.calPreferences.APPOINTMENT_REMINDAT)return t.inverse(this);return Events.reminderCount=2,Events.maxReminderValue=2,t.fn(this)}));