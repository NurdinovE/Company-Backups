Lyte.Component.register("crm-cscript-record-view",{_template:'<template tag-name="crm-cscript-record-view" class="cscriptRecordWrapper"> <template is="if" value="{{expHandlers(is_setup,\'&amp;&amp;\',expHandlers(selected_index,\'===\',undefined))}}"><template case="true"> <div class="aligncenter crmNotFoundColor crm-small-font-size selectPageLabel_cs"> {{getI18n(\'crm.cscript.plsselectpage\')}} </div> </template><template case="false"><template is="if" value="{{is_no_script}}"><template case="true"> <div class="noRecordImg_cs dF aiCenter h100_per jcCenter flexDC"> <img class="w500 h300" src="{{getCrmClientImageUrl(if(expHandlers(active_tab,\'===\',\'Module\'),\'cscript_modules.svg\',if(expHandlers(active_tab,\'===\',\'Commands\'),if(isMac,\'commands_mac.svg\',\'commands_windows.svg\'),\'cscript_landing.svg\')))}}" alt="landing"> <template is="if" value="{{expHandlers(active_tab,\'===\',\'Module\')}}"><template case="true"> <p class="aligncenter crmParagraphColor mB20">{{getI18n(\'crm.cscript.module.description\',\'crm.social.crm\')}}</p> </template><template case="false"> <p class="aligncenter crmParagraphColor mB20 w550">{{unescape(getI18n(\'crm.cscript.commands.description\', concat("&lt;span id="commands_helpurl" data-zcqa="commands_help_url" class="cP crmLinkColor"&gt;" , getI18n("here") , "&lt;/span&gt;"))) }}</p> </template></template> </div> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(snippets,\'&amp;&amp;\',expHandlers(snippets.length,\'>\',0)),\'||\',expHandlers(expHandlers(is_loading,\'===\',true),\'&amp;&amp;\',page_uuid))}}"><template case="true"> <div class="pageEventSBox clearFix"> <template is="if" value="{{expHandlers(is_from_sandobox,\'!\')}}"><template case="true"> <lyte-search id="cscript-search-element" lt-prop-disabled="{{is_reorder_mode}}" data-zcqa="snippetSearch" class="crmBoxSearchInput" lt-prop-maxlength="30" lt-prop-query-selector="{&quot;scope&quot;:&quot;.snipParentScope&quot;,&quot;search&quot;:&quot;.csriptName_cs&quot;,&quot;target&quot;:&quot;.reorderBlock1&quot;, &quot;related&quot;:&quot;.snippetContainer&quot;}" lt-prop-width="240px" lt-prop-placeholder="{{getI18n(\'com.cscript.searchevent\')}}" lt-prop-appearance="box" on-search="{{method(\'onSearch\')}}" lt-prop-close-icon="true"></lyte-search> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(is_ro_mode,\'!\'),\'&amp;&amp;\',expHandlers(expHandlers(is_proxy,\'&amp;&amp;\',expHandlers(is_setup,\'!\')),\'!\')),\'&amp;&amp;\',expHandlers(active_tab,\'==\',\'Module\'))}}"><template case="true"> <template is="if" value="{{expHandlers(is_reorder_mode,\'!\')}}"><template case="true"> <template is="if" value="{{is_add_script_enabled}}"><template case="true"> <lyte-button data-zcqa="snippetAddScriptBtn" class="fR mR0" lt-prop-style="border-radius:5px;" onclick="{{action(\'choose_event\')}}" lt-prop-disabled="{{expHandlers(is_add_enabled,\'!\')}}" lt-prop-tooltip-config="{ &quot;position&quot;: &quot;bottomleft&quot; }" lt-prop-title="{{expHandlers(expHandlers(expHandlers(is_add_enabled,\'!\'),\'&amp;&amp;\',expHandlers(is_loading,\'!\')),\'?:\',add_disabled_msg,\'\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'com.cscript.addscript\')}}</template> </lyte-button> </template></template> <template is="if" value="{{is_reorder_enabled}}"><template case="true"> <lyte-button lt-prop-tabindex="0" data-zcqa="snippetReorderBtn" class="fR" lt-prop-style="border-radius:5px;" onclick="{{action(\'reorder_event\')}}"> <template is="registerYield" yield-name="text"><div class="dB">{{getI18n(\'crm.button.new.reorder\')}}</div></template> </lyte-button> </template></template> </template><template case="false"> <lyte-button lt-prop-tabindex="0" data-zcqa="snippetReorderCancelBtn" class="fR" lt-prop-style="border-radius:5px;" onclick="{{action(\'reorder_event_cancel\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.cancel\')}}</template> </lyte-button> <lyte-button lt-prop-tabindex="0" data-zcqa="snippetReorderSaveBtn" class="fR mR10" lt-prop-appearance="primary" lt-prop-disabled="{{expHandlers(is_reordered,\'!\')}}" lt-prop-style="border-radius:5px;" onclick="{{action(\'reorder_event_save\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.setup.editor.btn.save\')}}</template> </lyte-button> </template></template> </template></template> </div> <div class="w100_per recordTable_cs pR"> <div class="recordTableHeader_cs clearFix"> <div class="w40_per dIB fL">{{getI18n(\'Name\')}}</div> <div class="w20_per dIB fL">{{getI18n(\'Size\')}}</div> <div class="w33_per dIB fL">{{getI18n(\'com.cscript.lastmodified\')}}</div> <div class="w5_per dIB fL">{{getI18n(\'Status\')}}</div> </div> <template is="if" value="{{expHandlers(is_loading,\'===\',true)}}"><template case="true"> <div class="snipParentScope h300"> <div class="ks_loading_new pA zi1"></div> </div> </template><template case="false"> <div class="snipParentScope"> <template is="for" items="{{snippets}}" item="item" index="index"> <div class="snippetContainer {{if(expHandlers(expHandlers(currentSortSection,\'>=\',0),\'&amp;&amp;\',expHandlers(currentSortSection,\'!=\',index)),\'op3 eventNone\',\'\')}}"> <template is="if" value="{{expHandlers(active_tab,\'!==\',\'Commands\')}}"><template case="true"> <div class="eventInfo_cs"> <template is="if" value="{{expHandlers(mode,\'===\',\'tab\')}}"><template case="true"> <span class="dIB">{{category}}</span> <span class="dotLabel vaM"></span> </template></template> <template is="for" items="{{item.key}}" item="it" index="i"> <span class="crm-font-bold">{{it}}</span> <template is="if" value="{{expHandlers(expHandlers(i,\'+\',1),\'!==\',item.key.length)}}"><template case="true"> <span class="dotLabel vaM"></span> </template></template></template> </div> </template></template> <ul class="recordViewSorter recordViewSorter_{{index}}"> <template is="for" items="{{item.value}}" item="i" index="index2"> <li class="reorderBlock1 pR {{expHandlers(is_reorder_mode,\'?:\',\'cMove\',\'\')}}" data-uuid="{{i.uuid}}" data-sort-section="{{index}}"> <div class="cscriptRecord_cs dF aiCenter {{if(ifEquals(highlight_uuid,i.uuid),\'cscriptAuditHighlight\',\'\')}}"> <span class="csriptName_cs w40_per"> <template is="if" value="{{i.script_event.child}}"><template case="true"> <span class="dNImp">{{i.script_event.child.label}}</span> </template></template> <span class="dNImp">{{item.key[0]}}</span> <template is="if" value="{{is_reorder_mode}}"><template case="true"> <span class="dragHoldIcon_cs_new zcrm_svgIcons"></span> </template></template> <span class="dIB csNamelabel">{{i.name}}</span> <span data-zcqa="snippetShowMoreOptionsBtn{{i.uuid}}" id="showButton" class="{{expHandlers(expHandlers(is_saving,\'||\',is_reorder_mode),\'?:\',\'cscriptVisibilityHidden\',\'\')}} csriptMoreOptions mL5 cP" data-params="{&quot;uuid&quot;:&quot;{{i.uuid}}&quot;}"><crmutil-icon class="zcicn-more-bgrounded moreMenu_cs" icon-name="more-hr-md" icon-class="zcicn-more-hr-md zcicn_636f86 "></crmutil-icon></span> </span> <span class="csriptSize_cs">{{formatBytesCeil(i.size)}}</span> <span class="csriptModifier_cs w33_per"> <span class="userName_cs vaM"> <template is="if" value="{{expHandlers(is_csez,\'!\')}}"><template case="true"><template is="if" value="{{i.modified_by}}"><template case="true"> <img src="{{getUserImageUrl(i.modified_by.id)}}" class="dIB vaM cscriptLMImg" alt="-"> </template><template case="false"> <img src="{{getUserImageUrl(i.created_by.id)}}" class="dIB vaM cscriptLMImg" alt="-"> </template></template></template></template> <template is="if" value="{{i.modified_time}}"><template case="true"> <span class="cDefault dIB ellipsistext userNameTxt_cs vaM" lt-prop-tooltip-config=" { &quot;position&quot; : &quot;top&quot; } " lt-prop-title="{{dateTimeUserFormatFromISOFormat(i.modified_time)}}">{{i.modified_by.name}}</span> </template><template case="false"> <span class="cDefault dIB ellipsistext userNameTxt_cs vaM" lt-prop-tooltip-config=" { &quot;position&quot; : &quot;top&quot; } " lt-prop-title="{{dateTimeUserFormatFromISOFormat(i.created_time)}}">{{i.created_by.name}}</span> </template></template> </span> </span> <span class="cscriptStatus_cs wsNowrap"> <lyte-checkbox lt-prop-disabled="{{if(or(ifEquals(is_ro_mode,true),ifEquals(is_saving,true),ifEquals(is_reorder_mode,true)),&quot;true&quot;,&quot;false&quot;)}}" data-zcqa="snippetToggleBtn_{{i.name}}" lt-prop-id="snippetToggleBtn_{{i.uuid}}" lt-prop-type="switch" lt-prop-checked="{{unbound(i.active)}}" on-checked="{{method(\'toggleStatus\',this,i.uuid)}}" on-unchecked="{{method(\'toggleStatus\',this,i.uuid)}}"></lyte-checkbox> </span> </div> </li> </template> </ul> </div> </template> <template is="if" value="{{no_result}}"><template case="true"> <div class="aligncenter crmNotFoundColor crm-small-font-size noFoundLabel_cs"> {{getI18n(\'crm.skyeye.search.no.results.found\')}} </div> </template></template> </div> </template></template> </div> <lyte-menu lt-prop-yield="true" lt-prop-event="click" on-open="{{method(\'set_uuid\')}}" lt-prop-query="#showButton" lt-prop-tab-index="0" lt-prop-width="auto" lt-prop-height="auto" lt-prop-query-class="lyteMenuSelected" lt-prop-freeze="true" lt-prop-boundary="{&quot;top&quot;:&quot;300&quot;}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <lyte-menu-item data-value="edit" data-zcqa="snippetEditBtn" onclick="{{action(\'edit_option\')}}"><lyte-menu-label>{{getI18n(\'Edit\')}}</lyte-menu-label></lyte-menu-item> <lyte-menu-item data-value="delete" data-zcqa="snippetDeleteBtn" onclick="{{action(\'delete_option\')}}"><lyte-menu-label>{{getI18n(\'Delete\')}}</lyte-menu-label></lyte-menu-item> </lyte-menu-body> </template> </lyte-menu> <lyte-alert lt-prop-show="{{delete_alert_show}}" lt-prop-yield="true" lt-prop-top="0" lt-prop-show-close-button="false" on-accept="{{method(&quot;delete_script&quot;)}}" on-close="{{method(&quot;close_delete_alert&quot;)}}" lt-prop-buttons="[{&quot;type&quot;:&quot;reject&quot;,&quot;text&quot;:&quot;{{getI18n(&quot;crm.button.cancel&quot;)}}&quot;,&quot;appearance&quot;:&quot;default&quot;,&quot;data-zcqa&quot;:&quot;cscriptDeleteScriptCancel&quot;},{&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;{{getI18n(&quot;crm.button.yes.delete.it&quot;)}}&quot;,&quot;appearance&quot;:&quot;failure&quot;,&quot;data-zcqa&quot;:&quot;cscriptDeleteScript&quot;}]"> <template is="registerYield" yield-name="alert"> <lyte-alert-header>{{getI18n(\'com.cscript.delete.header\')}}</lyte-alert-header> <lyte-alert-content>{{getI18n(\'com.cscript.delete.confirm\')}}</lyte-alert-content> </template> </lyte-alert> <lyte-alert lt-prop-show="{{disable_alert_show}}" lt-prop-yield="true" lt-prop-top="0" lt-prop-show-close-button="false" on-close="{{method(\'reject_disable_alert\')}}"> <template is="registerYield" yield-name="alert"> <lyte-alert-header>{{getI18n(\'com.cscript.disable.header\')}}</lyte-alert-header> <lyte-alert-content class="crmParagraphColor lh20"> <p class="dB mB15">{{getI18n(\'com.cscript.disable.confirm\',expHandlers(disable_script_name,\'||\',"this script"))}}</p> <span class="dIB noteinfocont noteinfo_cs">{{unescape(getI18n(\'com.cscript.disable.note\'))}}</span> </lyte-alert-content> <lyte-alert-footer> <lyte-button lt-prop-appearance="default" onclick="{{action(\'reject_disable_alert\')}}" data-zcqa="cscriptDisableScriptCancel"> <template is="registerYield" yield-name="text">{{getI18n("crm.button.cancel")}}</template> </lyte-button> <lyte-button lt-prop-appearance="failure" onclick="{{action(\'accept_disable_alert\')}}" data-zcqa="cscriptDisableScript"> <template is="registerYield" yield-name="text">{{getI18n("com.cscript.yes.disable.it",disable_script_name)}}</template> </lyte-button> </lyte-alert-footer> </template> </lyte-alert> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(snippets,\'&amp;&amp;\',expHandlers(snippets.length,\'===\',0)),\'&amp;&amp;\',expHandlers(is_loading,\'===\',false))}}"><template case="true"> <div class="aligncenter cScriptBtnLayer pA w100_per"> <template is="if" value="{{is_cscript_section_route}}"><template case="true"> <div class="dB">{{active_tab}}</div> </template></template> <div class="noScriptTag">{{getI18n(\'com.cscript.noscript\')}}</div> <template is="if" value="{{expHandlers(is_proxy,\'!\')}}"><template case="true"> <lyte-button data-zcqa="snippetNewScriptBtn2" lt-prop-appearance="primary" class="mT15" onclick="{{action(\'choose_event\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'com.cscript.newscript\')}}</template> </lyte-button> </template></template> </div> </template></template></template></template></template></template></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0,0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3]}]}},default:{}}]}},default:{}},{type:"text",position:[3,1,1,0]},{type:"text",position:[3,1,3,0]},{type:"text",position:[3,1,5,0]},{type:"text",position:[3,1,7,0]},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[]}},default:{}}]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"text",position:[1,1,1,3,0]},{type:"attr",position:[1,1,1,5]},{type:"if",position:[1,1,1,5],cases:{true:{dynamicNodes:[]}},default:{}},{type:"text",position:[1,1,1,7,0]},{type:"attr",position:[1,1,1,9]},{type:"componentDynamic",position:[1,1,1,9,0]},{type:"text",position:[1,1,3,0]},{type:"attr",position:[1,1,5,1,1]},{type:"if",position:[1,1,5,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,5,1,3]},{type:"if",position:[1,1,5,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,7,1]},{type:"componentDynamic",position:[1,1,7,1]}]}]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0,0]},{type:"componentDynamic",position:[1,3,0]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,0]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[7]},{type:"attr",position:[9]},{type:"registerYield",position:[9,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,1,0]},{type:"text",position:[3,3,0]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,1]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[9]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}],_observedAttributes:["is_csez","no_result","is_proxy","is_force_reload","snippets","is_no_script","page_uuid","cached_page_uuids","delete_alert_show","disable_alert_show","is_ro_mode","snippet_uuid","isMac","dropdownValue","highlight_uuid","is_loading","is_saving","is_setup","is_reordered","is_reorder_enabled","is_add_enabled","is_from_sandobox","host_url","add_disabled_msg","currentSortSection","active_tab","is_add_script_enabled","is_cscript_section_route"],data:function(){var e=navigator.platform.indexOf("Mac")>-1;return{is_csez:Lyte.attr("boolean",{default:document.domain.indexOf("csez.zohocorpin.com")>-1}),no_result:Lyte.attr("boolean",{default:!1}),is_proxy:Lyte.attr("boolean",{default:!1}),is_force_reload:Lyte.attr("boolean",{default:!1}),snippets:Lyte.attr("array"),is_no_script:Lyte.attr("boolean",{default:!0}),page_uuid:Lyte.attr("string"),cached_page_uuids:Lyte.attr("object",{default:new Set}),delete_alert_show:Lyte.attr("boolean"),disable_alert_show:Lyte.attr("boolean"),is_ro_mode:Lyte.attr("boolean",{default:Crm.userDetails.ISROMODE}),snippet_uuid:Lyte.attr("string"),isMac:Lyte.attr("boolean",{default:e}),dropdownValue:Lyte.attr("object",{default:{systemValue:"value",userValue:"name"}}),highlight_uuid:Lyte.attr("string"),is_loading:Lyte.attr("boolean",{default:!0}),is_saving:Lyte.attr("boolean"),is_setup:Lyte.attr("boolean",{default:!1}),is_reordered:Lyte.attr("boolean",{default:!1}),is_reorder_enabled:Lyte.attr("boolean",{default:!1}),is_add_enabled:Lyte.attr("boolean",{default:!1}),is_from_sandobox:Lyte.attr("boolean",{default:!1}),host_url:Lyte.attr("object"),add_disabled_msg:Lyte.attr("string",{default:`You can add a maximum of ${Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT||"30"} snippets in a page`}),currentSortSection:Lyte.attr("number",{default:-1}),active_tab:Lyte.attr("string",{default:"Module"}),is_add_script_enabled:Lyte.attr("boolean",{default:!0}),is_cscript_section_route:Lyte.attr("boolean",{default:"crm.settings.section.crm-cscript"===Lyte.Router.getRouteInstance().transition.info.route})}},didConnect:function(){const e=this;window.addEventListener("resize",this.update_height),this.update_height(),e.setData("cscript_save_listener",Lyte.addEventListener("cscript_save",(async t=>{let i="Module";if(t.page_uuid===e.getData("page_uuid"))if("commands"===store.peekRecord("cscript",e.getData("page_uuid")).definition_name)e.populate_list_view(),i="Commands";else e.modify_listview(t.snippet_uuid,t.is_edit?"update":"add");else e.setData({page_uuid:t.page_uuid});"commands"===store.peekRecord("cscript",t.page_uuid).definition_name&&(i="Commands",t.is_from_command_palette&&Lyte.registeredMixins["crm-cscript-global-mixin"].toggle_command_palette()),e.setData({highlight_uuid:t.snippet_uuid,active_tab:i}),t.is_close&&this.tab_change()})));let t=$L("#commands_helpurl")[0];t&&"object"==typeof t.onclick&&null===t.onclick&&(t.onclick=Lyte.registeredMixins["crm-open-help"].actions.openHelp.bind(e,"https://www.zoho.com/crm/developer/docs/client-script/commands.html",void 0,void 0,void 0)),e.setData("tab_change_listener",Lyte.addEventListener("tab_change",(async()=>{this.tab_change()}))),e.setData("cscript_not_found_listener",Lyte.addEventListener("cscript_not_found",(async t=>{await e.delete_script(!0,t.snippet_uuid)})))},didDestroy:function(){window.removeEventListener("resize",this.update_height),Lyte.removeEventListener(this.getData("cscript_save_listener")),Lyte.removeEventListener(this.getData("cscript_not_found_listener")),Lyte.removeEventListener(this.getData("tab_change_listener"))},observe_active_tab:function(){let e,t=store.peekAll("cscript");switch(this.getData("active_tab")){case"Module":e=t.filter((e=>e.$Module)).map((e=>e.uuid))[0];break;case"Commands":e=t.filter((e=>"commands"===e.definition_name)).map((e=>e.uuid))[0]}this.setData({page_uuid:e})}.observes("active_tab"),observe_page_uuid:function(){this.getData("is_setup")&&this.set_tab_from_page(),this.populate_list_view()}.observes("page_uuid").on("init"),set_tab_from_page:function(){if(this.getData("page_uuid")){let e;if("commands"===store.peekRecord("cscript",this.getData("page_uuid")).definition_name)e="Commands";else e="Module";this.setData({active_tab:e})}},observe_highlight_uuid:function(){const e=this;e.getData("highlight_uuid")&&($L(".snipParentScope").scrollTo($L(".cscriptRecord_cs.cscriptAuditHighlight"),{duration:500}),setTimeout((function(){e.setData("highlight_uuid",void 0)}),4e3))}.observes("highlight_uuid").on("init"),observe_reorder:function(){const e=this,t=e.getData("snippets").length;e.getData("is_reorder_mode")&&(e.update_height(),e.reset_search());for(let i=0;i<t;i++)e.getData("is_reorder_mode")?$L(".recordViewSorter_"+i).sortable({containment:"parent",tolerance:"pointer",onDrag:function(t){e.setData("currentSortSection",t.dataset.sortSection)},onDrop:function(t,i,a,s,o){s!==o&&e.setData("is_reordered",!0),e.setData("currentSortSection",-1)}}):$L(".recordViewSorter_"+i).sortable("destroy")}.observes("is_reorder_mode"),tab_change:function(){let e=$L("#cscript_tabs")[0];if(e){e.openTab(this.getData("active_tab"));let t=$L("#commands_helpurl")[0];t&&"object"==typeof t.onclick&&null===t.onclick&&(t.onclick=Lyte.registeredMixins["crm-open-help"].actions.openHelp.bind(this,"https://www.zoho.com/crm/developer/docs/client-script/commands.html",void 0,void 0,void 0)),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.crm-cscript",{tab:this.getData("active_tab")})}},get_sorted_snippets:async function(e){const t=this,i=[],a=e.length>0&&CScript.Utils.get_config_by_apiname(e[0].cscript_page.definition_name);e=e.sort(((e,t)=>e.precedence-t.precedence));let s=await a.events();for(snippet of e){const e=await t.get_event_info(snippet,a,s),o=i.findIndex((t=>t.event===e));-1===o?i.push({event:e,value:[snippet],key:e.split(",")}):(i[o].value.push(snippet),!t.getData("is_reorder_enabled")&&t.setData("is_reorder_enabled",i[o].value.length>1))}return i.sort(((e,t)=>e.event.localeCompare(t.event)))},delete_script:async function(e,t,i){const a=this;commonUtils.showHideLoadingDiv(!0);const s=store.peekRecord("cscript_snippets",t),o=await a.get_event_info(s,CScript.Utils.get_config_by_apiname(s.cscript_page.definition_name));let n;try{n=e?s.$.deleteRecord():await s.$.destroyRecord("cscript_snippets")}catch(e){n=e}const p=store.peekRecord("cscript",a.getData("page_uuid")).consolidated_code_url,r=(await store.findRecord("cscript",a.getData("page_uuid"),{include_extra_details:!0}))[0],c=r&&r.snippet_count||0;if("Commands"===a.getData("active_tab")){if(Lyte.arrayUtils(this.getData("snippets"),"removeAt",this.getData("snippets").findIndex((e=>e.value[0].uuid===t))),r)CScript.Engine.Hot.Restart();else{CScript.Engine.Hot.Utils.onLastDeleted();let e=$L("#commands_helpurl")[0];e&&"object"==typeof e.onclick&&null===e.onclick&&(e.onclick=Lyte.registeredMixins["crm-open-help"].actions.openHelp.bind(a,"https://www.zoho.com/crm/developer/docs/client-script/commands.html",void 0,void 0,void 0))}let e=store.peekAll("keyboard_shortcuts");if(e&&e.length){const i=e.find((({category:e})=>"Commands"===e));if(i){const{components:e}=i,a=e.findIndex((({cscript_snippet:{uuid:e}})=>e===t));if(-1!==a){const[i]=e.splice(a,1);Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].deleteKeyboardShortcuts(JSON.stringify({category:"Commands",components:[{cscript_snippet:{uuid:t},_delete:null}]}),{action:t,key_combination:i.key_combination})}}}}else await a.modify_listview(t,"delete",o);r||(store.deleteRecord("cscript",a.getData("page_uuid")),a.setData("is_no_script",a.getData("is_cscript_section_route"))),commonUtils.showHideLoadingDiv(!1),e&&i||(n&&n.cscript_snippets?crmui.showMsgBand("success",I18n.getMsg("crm.auditlog.cscript.msg.delete"),4e3):crmui.showMsgBand("error",I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.setup.system.cscript")),2e3)),a.update_height(),a.getData("is_setup")?Lyte.triggerEvent("cscript_delete",{snippet_uuid:t,snippet_count:c,page_uuid:a.getData("page_uuid")}):0===c?a.setData("page_uuid",void 0)||CScript.Engine.Global.Restart():p!==r.consolidated_code_url&&CScript.Engine.Global.Restart();s&&s.cscript_page&&"module_view_canvas"===s.cscript_page.definition_name&&Lyte.triggerEvent("cscript_delete",{snippet_uuid:t,snippet_count:c,page_uuid:a.getData("page_uuid")}),a.reset_search(),a.executeMethod("unset_uuid")},populate_list_view:async function(){const e=this;if(e.getData("page_uuid")){let t;e.setData({is_loading:!0,is_reorder_enabled:!1,is_add_enabled:!1,is_no_script:!1});try{if(e.getData("is_from_sandobox")){const i=e.getData("hostUrl");t=await store.findAll("cscript_snippets",{page_uuid:e.getData("page_uuid")},"","",{...i&&{hostUrl:i,...i.headers&&{headers:i.headers}}})}else{const i=store.peekRecord("cscript",e.getData("page_uuid"))||{};e.getData("cached_page_uuids").has(i.uuid)&&!e.getData("is_force_reload")?t=store.peekAll("cscript_snippets").filter((t=>t.cscript_page.uuid===e.getData("page_uuid"))):(t=await store.findAll("cscript_snippets",{page_uuid:e.getData("page_uuid")}),e.getData("cached_page_uuids").add(e.getData("page_uuid")),e.getData("is_force_reload")&&e.setData("is_force_reload",!1))}}catch(t){return murphy.error(t),e.setData({page_uuid:void 0,snippets:[],is_loading:!1,is_no_script:e.getData("is_cscript_section_route"),is_proxy:!_cscript._definition}),void e.setData("is_page_loading",!1)}e.setData({is_add_enabled:t.length<(Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT||30),is_proxy:!_cscript._definition,snippets:"Commands"===e.getData("active_tab")?t.map((e=>({value:[e]}))):t.length?await e.get_sorted_snippets(t):[],is_loading:!1}),e.update_height(),e.reset_search()}else e.setData({snippets:[],is_loading:!1,is_no_script:e.getData("is_cscript_section_route"),is_proxy:!_cscript._definition});e.setData("is_page_loading",!1)},get_event_info:async function(e,t,i){i||(i=await t.events());let a=[];return i[e.script_event.type]&&i[e.script_event.type].label&&a.push(i[e.script_event.type].label),a.push(...e.script_event.child&&e.script_event.child.id?[e.script_event.child.label]:[]),a.push(e.script_event.event),a.join(",")},modify_listview:async function(e,t,i){const a=this,s=store.peekRecord("cscript_snippets",e),o=i||await a.get_event_info(s,CScript.Utils.get_config_by_apiname(s.cscript_page.definition_name));let n,p,r=0,c=!1,l=0;for(const[e,t]of this.getData("snippets").entries()){const i=t.value.length;t.event===o?(p=e,n=t):(c=i>1,p||(r=t.event.localeCompare(o)<0?e+1:r)),l+=i}switch(t){case"add":(n&&n.value||(n={event:o,key:o.split(",")})&&(n.value=[])).push(s),void 0!==p?Lyte.arrayUtils(this.getData("snippets"),"replaceAt",p,n):Lyte.arrayUtils(this.getData("snippets"),"insertAt",r,n),!this.getData("is_reorder_enabled")&&this.setData("is_reorder_enabled",n.value.length>1),this.getData("is_add_enabled")&&this.setData("is_add_enabled",l<(Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT&&Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT-1||29)),a.update_height(),a.reset_search();break;case"update":n.value[n.value.findIndex((t=>e===t.uuid))]=s,Lyte.arrayUtils(this.getData("snippets"),"replaceAt",p,n),a.reset_search();break;case"delete":this.getData("is_reorder_enabled")&&!c&&this.setData("is_reorder_enabled",n.value.length>2),1===n.value.length?Lyte.arrayUtils(this.getData("snippets"),"removeAt",p,1):(n.value.splice(n.value.findIndex((t=>e===t.uuid)),1),Lyte.arrayUtils(this.getData("snippets"),"replaceAt",p,n)),!this.getData("is_add_enabled")&&this.setData("is_add_enabled",!0)}},update_record:async function(e,t){const i=this;e.$.set("active",!e.active);let a=await e.$.save();a&&a.uuid?(await store.findRecord("cscript",e.cscript_page.uuid),!i.getData("is_setup")&&CScript.Engine.Global.Restart(),e.active&&await store.findRecord("cscript_snippets",t),"commands"!==e.cscript_page.definition_name&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.auditlog.cscript.msg."+(e.active?"enable":"disable")),ltPropType:"success",ltPropDuration:"2000"}})):store.deleteRecord("cscript_snippets",t),i.setData("is_saving",!1),"commands"===e.cscript_page.definition_name&&(!e.active&&CScript.Engine.Hot.Utils.isKeyboardShortcutAssociated(e.uuid)&&(Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].unbindShortcutKey(store.peekAll("keyboard_shortcuts").find((e=>"Commands"===e.category)).components.find((t=>t.cscript_snippet.uuid===e.uuid)).key_combination),await store.findAll("keyboard_shortcuts")),_cscript._hotEngine._engine&&await CScript.Engine.Hot.Restart(),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.auditlog.cscript.msg."+(e.active?"enable":"disable")),ltPropType:"success",ltPropDuration:"2000"}})),commonUtils.showHideLoadingDiv(!1)},update_height:function(){const e=document.querySelector("crm-cscript-record-view");if(e){const t=window.innerHeight;if(!0===e.getData("is_setup")){const e=$L(".csPageBlock").offset().top;$L(".snipParentScope").height(t-(e+165)),$L(".recordTable_cs").height(t-(e+127))}else $L(".snipParentScope").height(t-181),$L(".recordTable_cs").height(t-133),$L(".noRecordImg_cs").height(t-153)}},reset_search:function(){const e=$L("#cscript-search-element")[0];e&&e.setValue("")},reject_disable_alert:function(){this.setData({disable_alert_show:!1,disable_script_name:void 0});let e=$L("#snippetToggleBtn_"+this.getData("snippet_uuid"));e&&e[0]&&e[0]&&"LYTE-CHECKBOX"===e[0].parentElement.parentElement.tagName&&e[0].parentElement.parentElement.setData({ltPropChecked:!0,ltPropPreventCallbackObservers:!1}),this.executeMethod("unset_uuid"),this.setData("is_saving",!1)},methods:{toggleStatus:async function(e,t){this.setData("is_saving",!0),commonUtils.showHideLoadingDiv(!0);const i=this;var a=await store.findRecord("cscript_snippets",t);a.length>0?a[0].active?"commands"===a[0].cscript_page.definition_name&&await CScript.Engine.Hot.Utils.isKeyboardShortcutAssociated(a[0].uuid)?(commonUtils.showHideLoadingDiv(!1),this.setData("snippet_uuid",t),e.setData("ltPropPreventCallbackObservers",!0),this.setData({disable_script_name:a[0].name,disable_alert_show:!0})):i.update_record(a[0],t):fetch(a[0].content.source_code_url).then((function(e){const t=e.headers.get("content-type");if(!t||!t.includes("application/javascript"))throw new TypeError("Invalid Content Type");return e.text()})).then((async function(e){try{await Lyte.injectResources([networkUtils.returnDependencyFiles(["cscript/convert-to-asyncawait.js"],ResourceConstants.CRMClient)]);const s=AsyncAwait.compile(e+"\n",{functionScope:!0,minify:!1,sourceFileName:`${Math.random().toString(36).substring(2,15)}-client-script.js`,prefix:"'use strict';",excludeList:_cscript._exclude_list.concat(store.peekRecord("cscript_snippets",t).script_event.arguments||[])});if(s.error)throw s.error;a[0].$.set("content",{async_code:s.code,source_map:s.map}),i.update_record(a[0],t)}catch(e){murphy.error(e),crmui.showMsgBand("error",I18n.getMsg("crm.cscript.codeerror"),4e3)}})).catch((function(){crmui.showMsgBand("error",I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.setup.system.cscript")),2e3)})):i.delete_script(!0,t,!1)},delete_script:async function(){await this.delete_script(!1,this.getData("snippet_uuid"))},set_uuid:function(e){this.setData("snippet_uuid",JSON.parse(e.element.dataset.params).uuid)},unset_uuid:function(){this.setData("snippet_uuid",void 0)},onSearch:function(e){this.setData("no_result",0===e.length),this.getData("no_result")&&this.update_height()},close_delete_alert:function(){this.setData("delete_alert_show",!1)},reject_disable_alert:function(){this.reject_disable_alert.call(this)}},actions:{panel:function(e){$L("crm-cscript")[0].component.setData("cscriptPaneShow",e)},edit_option:async function(){const e=this,t=e.getData("snippet_uuid");if((await store.findRecord("cscript_snippets",t)).length>0){const{definition_name:i,uuid:a,selectors:s}=store.peekRecord("cscript",e.getData("page_uuid")),{script_event:o,name:n,description:p}=store.peekRecord("cscript_snippets",t),r={};s&&Object.keys(s).forEach((e=>{r[e]=s[e].id}));try{await Lyte.registeredMixins["crm-cscript-global-mixin"].addScript({page_unique_name:i,page_uuid:a,selector_info:r,event_info:o,snippet_info:{name:n,description:p,uuid:t}})}catch(e){return}finally{e.executeMethod("unset_uuid")}}else this.delete_script(!0,t,!1)},delete_option:function(){this.setData("delete_alert_show",!0)},choose_event:async function(){Lyte.registeredMixins["crm-cscript-global-mixin"].render_create_popup(this.getData("page_uuid"),this)},reorder_event:function(){this.setData("is_reorder_mode",!0)},reorder_event_cancel:function(){this.setData({is_reorder_mode:!1,is_reordered:!1,snippets:this.get_sorted_snippets(store.peekAll("cscript_snippets").filter((e=>e.cscript_page.uuid===this.getData("page_uuid"))))})},reorder_event_save:async function(){commonUtils.showHideLoadingDiv(!0);let e={};document.getElementsByClassName("recordViewSorter").forEach((t=>{let i=1;t.children.forEach((t=>{e[t.dataset.uuid]=i++}))})),store.peekAll("cscript_snippets").filter((e=>e.cscript_page.uuid===this.getData("page_uuid"))).forEach((t=>t.$.set("precedence",e[t.uuid]))),await store.update("cscript_snippets",{precedence:!0},{page_uuid:this.getData("page_uuid")})&&(await store.findRecord("cscript",this.getData("page_uuid")),!this.getData("is_setup")&&CScript.Engine.Global.Restart()),crmui.showMsgBand("success",I18n.getMsg("crm.label.changes.success"),2e3,""),this.setData({is_reorder_mode:!1,is_reordered:!1}),commonUtils.showHideLoadingDiv(!1)},reject_disable_alert:function(){this.reject_disable_alert.call(this)},accept_disable_alert:async function(){commonUtils.showHideLoadingDiv(!0);let e=this.getData("snippet_uuid");await this.update_record.call(this,store.peekRecord("cscript_snippets",e),e);let t=$L("#snippetToggleBtn_"+this.getData("snippet_uuid"));t&&t[0]&&t[0]&&"LYTE-CHECKBOX"===t[0].parentElement.parentElement.tagName&&t[0].parentElement.parentElement.setData({ltPropPreventCallbackObservers:!1}),this.executeMethod("unset_uuid"),this.setData({disable_alert_show:!1,disable_script_name:void 0})}}});
