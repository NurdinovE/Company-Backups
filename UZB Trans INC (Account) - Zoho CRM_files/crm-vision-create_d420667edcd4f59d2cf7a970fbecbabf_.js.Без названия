Lyte.Mixin.register("crm-vision-create",{actions:{onmouseleave:function(e){return crmui.hideTooltip(e)},onmouseenter:function(e,i){var a,t=$L(i)[0].component;if("summaryToolTip"===e){var o=t.getData("viewVisions"),r=I18n.getMsg("crm.module.createdby")+" : "+o.created_by.name+" "+I18n.getMsg("crm.zia.vision.on")+" "+Lyte.Component.registeredHelpers.getLastModified(o.created_time)+" "+Lyte.Component.registeredHelpers.getLocaleTimeString(o.created_time)+",<br>"+I18n.getMsg("crm.module.modifiedby")+" : "+o.modified_by.name+" "+I18n.getMsg("crm.zia.vision.on")+" "+Lyte.Component.registeredHelpers.getLastModified(o.modified_time)+" "+Lyte.Component.registeredHelpers.getLocaleTimeString(o.modified_time);return crmui.showTooltip({content:r,isHTML:!0,position:"left"})}switch(e){case"limit":a=I18n.getMsg("crm.zia.vision.max.limit",t.getData("maxLimit"));break;case"fail":a=I18n.getMsg("crm.zia.vision.model.fail.msg");break;case"gallery":a=I18n.getMsg("crm.zia.vision.gallery.message")}return crmui.showTooltip(a)},onmouseover:function(e){var i;switch(e){case"image_approval":i=I18n.getMsg("crm.zia.vision.image.approval.msg");break;case"record_approval":i=I18n.getMsg("crm.zia.vision.record.approval.msg")}return crmui.showTooltip(i)}},labelnameValidateHighlighter(e,i){"imgValidation"===i?$L("#labelNameImg")[0].component.validate():$L("#labelNameObj")[0].component.validate(),$L(".vision_training_criteria_header_".concat("imgValidation"===i?"img":"obj"))[e].component.setData("highlightLabelNameError",!0)},notAllowedSplCharChecker:function(e){var i="";if(""!==e)for(var a=new Array("!","@","#","$","%","^","&","*","(",")","_","+","=","-","`","~","'",";",",",".","/",":",'"',"<",">","?","{","}","|","[","]","\\"),t=a.length,o=0;o<t;o++)e.indexOf(a[o])>=0&&(i+=a[o]);return i},deepCopyOfAnObject:e=>JSON.parse(JSON.stringify(e)),patternCriToTextPattern:function(e,i,a,t){a=a;var o=[];if(i.group)!function i(a,t,r){if(void 0!==a){t||(t={});var n=a.group_operator;if(!n&&a.label)t=s(a,r);else{var d=a.group;if(d){Lyte.arrayUtils(o,"push","(");for(var c=d.length,p=0;p<c;p++){var m={};if(0!==p&&Lyte.arrayUtils(o,"push",a.group_operator.toLowerCase()),m=i(d[p],t,n),0!==Object.keys(m).length||m.constructor!==Object){var v,g=l(m);v="summary"!==e?g.criteriaIndex+" is "+g.type:"detected"===g.type?I18n.getMsg("crm.zia.vision.is.detected",g.labelName):I18n.getMsg("crm.zia.vision.is.not.detected",g.labelName),Lyte.arrayUtils(o,"push",v)}}Lyte.arrayUtils(o,"push",")")}}}return t}(i);else{Lyte.arrayUtils(o,"push","(");var r,n=l(s(i));r="summary"===e?"detected"===n.type?I18n.getMsg("crm.zia.vision.is.detected",n.labelName):I18n.getMsg("crm.zia.vision.is.not.detected",n.labelName):n.labelName+" is "+n.type,Lyte.arrayUtils(o,"push",r),Lyte.arrayUtils(o,"push",")")}function s(e,i){var a={};return a.comparator=i&&i.length>0?i.toLowerCase():"",a.labelId=e.label.id,a.type="${DETECTED}"===e.value?"detected":"not detected",t&&(a.criteriaIndex=e.criteriaindex),a}function l(e){for(var i=a.length,t=0;t<i;t++)e.labelId!==a[t].id&&e.labelId!==a[t].reference_id||(e.labelName=a[t].name,e.model_tags=a[t].model_tags);return e}return o},saveVision:function(e,i,a){a.setData("saveDisable",!0),a.setData("saveButtonTriggered",!0);var t={};return t.module=!0===e.vision_module.api_name.includes("CustomModule")?"CustomModule":e.vision_module.api_name,t.validation_type=e.validation_type,t.field=void 0!==e.vision_fields?e.vision_fields.api_name:"None",a.getData("is_edit_page")?Crm.client_tracking("Image Validation Metrics - Edit Page Clicks",t):Crm.client_tracking("Image Validation Metrics - Create Page Clicks",t),e.$.save(i).then((function(e){var i=e.visions;commonUtils.showHideLoadingDiv(!1),Lyte.Router.transitionTo({route:"crm.settings.section.zia.vision.image-validation.view",dynamicParams:[i.id]})}),(function(e){commonUtils.showHideLoadingDiv(!1),a.setData("saveDisable",!1),a.setData("saveButtonTriggered",!1);var i=JSON.parse(e.response);if("NO_PERMISSION"!==i.code)if(i.visions&&i.visions[0].code&&"LIMIT_EXCEEDED"===i.visions[0].code){if(i.visions[0].message.includes("image count"))var t=I18n.getMsg("crm.zia.vision.max.image.limit");else{t=I18n.getMsg("crm.zia.vision.max.limit",i.visions[0].details.limit);a.getData("maxLimit")<store.model.visions.data.length&&(t=t+" "+I18n.getMsg("crm.zia.vision.limit.exceed"))}renderingUtils.showCustomAlert(t)}else if(i.visions&&i.visions[0].code&&"NOT_ALLOWED"===i.visions[0].code&&"failure_action"===i.visions[0].details.api_name)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.save.action.error"));else if(i.visions&&i.visions[0].code&&"INVALID_DATA"===i.visions[0].code&&"id"===i.visions[0].details.api_name&&"$.visions[0].vision.id"===i.visions[0].details.json_path)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.access.error"));else if(i.visions&&"NO_PERMISSION"===i.visions[0].code)i.details&&i.details.permissions&&"Crm_Implied_View_Record_Image"===i.details.permissions[0]?renderingUtils.displayPermissionDenied(i):renderingUtils.displayPermissionDenied();else if(i.visions&&"NOT_ALLOWED"===i.visions[0].code&&"$.visions[0].field.id"===i.visions[0].details.json_path)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.image.count.limit.exceed.error"));else if(!i.visions||("INVALID_FIELD"!==i.visions[0].code&&"INVALID_LAYOUT_ID"!==i.visions[0].code&&"INVALID_DATA"!==i.visions[0].code||"$.visions[0].field.id"!==i.visions[0].details.json_path)&&"$.visions[0].layout.id"!==i.visions[0].details.json_path&&"$.visions[0].criteria"!==i.visions[0].details.json_path)i.visions&&"INVALID_MODULE"===i.visions[0].code&&"$.visions[0].module.api_name"===i.visions[0].details.json_path?renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.module.invalid.error")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.common.error"));else{var o;o="$.visions[0].layout.id"===i.visions[0].details.json_path?"layout":"field",renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.fieldOrLayout.invalid.error",o))}else renderingUtils.displayPermissionDenied()}))},getFields:function(e,i){for(var a=[],t=e.length,o=store.peekAll("visions"),r=[],n=o.length-1,s=0;s<n;s++)o.hasOwnProperty(s)&&o[s].vision_module.api_name===i&&r.push(o[s].vision_fields.api_name);for(var l=0;l<t;l++){if(e.hasOwnProperty(l))if(("profileimage"===e[l].data_type||"imageupload"===e[l].data_type&&1===e[l].length)&&!0===e[l].visible)if(!r.contains(e[l].api_name))(d={}).api_name=e[l].api_name,d.id=e[l].id,d.field_label=e[l].field_label,a.push(d)}if(a.length<1){var d={field_label:"None",id:"none"};a.push(d)}return a},getModules:function(e,i,a){var t=[];if(e){var o=store.peekAll("visions");for(var r in o)o.hasOwnProperty(r)&&void 0!==o[r].vision_module&&t.push(o[r].vision_module.id)}var n=store.peekAll("module");void 0!==a&&(e?t.deleteElementAt(t.indexOf(a)):t=a);for(var s=[],l=n.length,d=["Forecasts","Emails","Visits","Activities","Tasks","Events","Calls","Services","Appointments","Campaigns","Bundles","LinkingModuleBundleRel","CustomModule5009"],c=0;c<l;c++)if((!i||n[c].viewable)&&"org_based"===n[c].access_type&&n[c].presence_sub_menu&&n[c].visible&&-1===d.indexOf(n[c].module_name)&&"linking"!==n[c].generated_type){var p=!0;if(t.length>0){var m=t.indexOf(n[c].id);if(e)p=m<0||t.indexOf(n[c].id,m+1)<0;else p=m<0}if(p){var v={};v.module_name=n[c].module_name,v.id=n[c].id,v.api_name=n[c].api_name,v.plural_label=n[c].plural_label,s.push(v)}}return s},getVision:function(e){return this.hasError=!0,store.findRecord("visions",e).then((function(e){if(e&&e[0])return this.hasError=!1,e}))},getAvailableNames:function(e){var i=[],a=store.peekAll("visions"),t=a.length;if(e)for(var o=0;o<t;o++)a[o].id!==e&&a[o].created_by&&i.push(a[o].name);else for(o=0;o<t;o++)a[o].created_by&&i.push(a[o].name);return i},getAllFields:function(e,i,a){return Lyte.resolvePromises({module:store.findRecord("module",e,void 0,void 0,void 0,{getFields:!0}),unused:store.findAll("field",{module:i,type:"Unused"})}).then((function(e){if(e.module){var i=(void 0!==e.module.module_name?e.module:e.module[0]).fields;return i=i.filter((function(e){return"rollup_summary"!==e.data_type&&!(116===e.ui_type&&e.formula.dynamic)})),e.unused&&e.unused.map((function(e){e.unused=!0,i.push(e)})),a(i)}}))},getDetectedAndNotDetectedLabels:function(e){for(var i={},a=[],t=[],o=e.length,r=0;r<o;r++){var n=e[r];"detected"===n.type?a.push(n):t.push(n)}return i.detected_labels=a,i.notdetected_labels=t,i},renderDetailViewPopUp:function(e,i,a){e.setData("totApprovals",i);var t=i[0].record;e.setData("selectedRecord",t),e.setData("selectedRecordName",t.name);var o={};o.id=returnJson.tabId?returnJson.tabId:Lyte.Router.getRouteInstance().currentModel.tabId,o.id||(o.id=moduleRecordMapping[Lyte.Router.getRouteInstance().currentModel.module].id),o.api_name=store.peekRecord("module",o.id).api_name,o.plural_label=store.peekRecord("module",o.id).plural_label;var r={};r.recordModule=o,r.selectedRecord=e.getData("selectedRecord"),r.selectedRecord.module=o,r.isMyJobsPage=!1,r.record_approvals=e.getData("record_approvals"),r.image_approvals=e.getData("image_approvals"),r.records=e.getData("totRecords"),r.editAllowed=e.getData("editAllowed"),r.record_approvals&&r.record_approvals.length>0?r.action="record_approval":r.action="image_approval",r.showReviewButtons=!e.getData("is_edit_page"),r.readOnly=e.getData("readOnly"),r.moduleName=e.getData("moduleName"),r.isSaveAndNew=e.getData("isSaveAndNew"),e.getDisplayMessage(e),r.selectedRecordName=r.selectedRecord.name,r.displayMessage=e.getData("displayMessage"),r.record_approvals&&r.record_approvals.length>0?(r.showRecActions=!0,r.showImgActions=!1,r.approvals=e.getData("record_approvals"),r.selected_action="record_approval"):(r.selected_action="image_approval",r.approvals=e.getData("image_approvals"),r.showImgActions=!0,r.showRecActions=!1),Lyte.Component.render("crm-ziavision-myjobslistview",r,"#detailPopUpModal");var n=$L("crm-ziavision-myjobslistview");n&&n[0]&&n[0].setData("vision_feedback_details",a)},approvalsCallbackAndImageFetch:function(e,i,a){for(var t=this,o=i.vision_approvals,r=o.length,n=[],s=0;s<r;s++){var l=o[s].vision;-1===n.indexOf(l.id)&&n.push(l.id)}a&&!store.model[o[0].vision.vision_module]&&store.registerModel(o[0].vision.vision_module,{},{extends:"entity"}),store.batch((function(){n.forEach((function(e){store.findRecord("visions",e)}))})).then((function(r){for(var n,s=r.length,l=[],d=0;d<s;d++){var c=r[d][0].$.toJSON(),p=c.id;n=c.validation_type;for(var m=o.length,v=0;v<m;v++){if(o[v].vision.id===p){if(o[v].vision=c,"object_detection"===n||"match_detect"===n){var g=c.training_details,u=t.patternCriToTextPattern("summary",g.pattern_criteria,g.labels);o[v].rule_pattern=u}if("image_validation"===n||"match_detect"===n){var _=null,f=!0;c.desired_set&&null!==c.desired_set&&c.desired_set.labels.length>0?_=c.desired_set.labels:c.undesired_set&&null!==c.undesired_set&&c.undesired_set.labels.length>0&&(_=c.undesired_set.labels,f=!1);var h=t.labelsToTextPatternMatch(_,f);o[v].rule_pattern_match=h}}}}a&&!store.model[o[0].vision.vision_module]&&store.registerModel(o[0].vision.vision_module,{},{extends:"entity"}),store.findRecord(o[0].vision.vision_module,o[0].record.id).then((r=>{var s=!1;r&&r[0]&&(s=r[0].$locked_for_me&&!r[0].$editable),t.splitApprovals(o,t),e.fields="image_details",store.triggerAction("visions","record_approvals",{},e).then((function(e){var r=e.vision_approvals,d=[];t.setApprovalImages(r,o,d),a||t.renderDetailViewPopUp(t,o,d),$L("#myJobsVisionPop")[0].ltProp("show",!0);var c=$L("#crm-ziavision-myjobslistview")[0].component;c.setData("approvalsInfo",i.meta),c.setData("approvalDetailsArray",[]);var p=c.getData("selected_action");c.setData("selected_action",""),c.setData("selected_action",p),c.setData("visionFullDetails",l),c.setData("is_record_locked",s),c.setData("button_disable_tootip",s?I18n.getMsg("crm.zia.vision.record.lock.case"):I18n.getMsg("crm.zia.vision.read.only.case")),"record_approval"===p?(c.setData("record_approvals",t.getData("record_approvals")),c.setData("approvals",[].concat(t.getData("record_approvals")))):(c.setData("image_approvals",t.getData("image_approvals")),c.setData("approvals",[].concat(t.getData("image_approvals")))),"object_detection"!==n&&"match_detect"!==n||(c.setData("approvalDetailsArray",o),t.addMarkers(o))}),(function(e){t.approvalsErrorHandler(e)}))}))}))},nextTransitionCheck:function(e,i,a){var t=$L("#vision_creation_page")[0].component,o=t.getData("saveDisable"),r=t.getData("saveButtonTriggered"),n=t.getData("isCriteriaEditPatternOpen");if(t.data)if(t.data.criteriaSelected){if(!o&&r){var s=document.querySelector("#visionCruxCriteriaEditorComp").component.getCriteria();if(null===s||!1===s){if(!t.getData("isCriteriaEditPatternOpen"))return void e.abort()}else if(void 0===s)return crmui.showMsgBand("error",I18n.getMsg("crm.zia.vision.error.criteria"),3500),void e.abort();t.data.visions.$.set("criteria",s)}}else Lyte.objectUtils(t.data.visions,"add","criteria",null);if(!o||n&&!r&&"crm.settings.section.section-error"!==e.target){if(!a&&"crm.settings.section.zia.vision.image-validation.view"===e.target)return;var l=store.peekRecord("visions",i),d=l.$.getDirtyAttributes();if(!d.length||1!==d.length||"name"!==d[0]||void 0!==l.name&&""!==l.name.trim()){var c=e;c.pause(),_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"visionConfirmationPop",ltPropHeading:I18n.getMsg("crm.zia.vision.unsave.msg"),ltPropSecondaryMessage:I18n.getMsg("crm.zia.vision.unsave.title"),ltPropType:"confirm",ltPropButtonPosition:"right",ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.stay.here"),appearance:"default"},{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure"}]},ltPropContentAlign:"Left",ltPropShowCloseButton:!1,ltPropYield:"true",yieldName:"alert",accept:function(){t.methods.redirectToOut(c,t)},reject:function(){t.methods.abortToOut(c)}})}else l.$.rollBack()}},commonErrorAlerts:function(e,i){return 403===e.status?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops")),i.abort(),!1},setCriteriaMethods:function(e,i){e.setMethods({onChange:function(){i.getData("isCriteriaEditPatternOpen")||i.setData("saveDisable",!1)},onEditPattern:function(){i.setData("saveDisable",!0),i.setData("isCriteriaEditPatternOpen",!0)},onSavePattern:function(){i.setData("saveDisable",!1),i.setData("isCriteriaEditPatternOpen",!1)},onCancelPattern:function(){i.setData("saveDisable",!1),i.setData("isCriteriaEditPatternOpen",!1)}})},getmyJobsApprovals:function(e,i,a,t){var o={};if(o.page=e,o.per_page=i,"All"!==t){var r={};r.value=t,r.api_name="module.api_name",r.comparator="equals",o.filters=r}return store.triggerAction("visions","total_records",{},o).then((function(e){return commonUtils.showHideLoadingDiv(!1),a(e)}),(function(e){if(commonUtils.showHideLoadingDiv(!1),e&&e.response){var i=JSON.parse(e.response);"INVALID_MODULE"===i.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.reviewprocess.invalid.module")):"NO_PERMISSION"===i.code?renderingUtils.displayPermissionDenied():renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}}))},getMyJobsGroupCount:function(e,i,a){var t={};if("All"!==e){var o={};o.value=e,o.api_name="module.api_name",o.comparator="equals",t.filters=o}return store.triggerAction("visions","approval_recordCount",{},t).then((function(e){return i(e.group_count)}),(function(){return a(JSON.parse(data.response))}))},approvalsErrorHandler:function(e,i){commonUtils.showHideLoadingDiv(!1);var a=JSON.parse(e.response);(i&&a&&"NO_PERMISSION"===a.code||a.vision_approvals&&"NO_PERMISSION"===a.vision_approvals[0].code)&&renderingUtils.displayPermissionDenied()},setApprovalImages:function(e,i,a){for(var t=e.length,o=0;o<t;o++)if(e.hasOwnProperty(o))for(var r in i)if(i.hasOwnProperty(r)&&e[o].id===i[r].id){var n={},s=i[r];s.image=e[o].image_details.image,n.id=i[r].id,n.vision_success_rate_feedback=e[o].image_details.vision_success_rate_feedback,n.suggest_for_learn=e[o].image_details.suggest_for_learn,Lyte.arrayUtils(i,"removeAt",r,1),Lyte.arrayUtils(i,"insertAt",r,s),Lyte.arrayUtils(a,"insertAt",o,n);break}var l=$L("crm-ziavision-myjobslistview");l&&l[0]&&l[0].setData("vision_feedback_details",a)},get_detected_undetected_labels:function(e){var i=e.object_details,a=i?i.length:0,t=[],o=[],r=e.vision,n=r.training_details.labels,s=[];s=function e(i){if(!i.group_operator&&i.label){var a={};a.id=i.label.id,a.type="${DETECTED}"===i.value?"Detected":"Not_Detected",s.push(a)}else{var t=i.group;t&&(e(t[0]),e(t[1]))}return s}(r.training_details.pattern_criteria);for(var l=n.length,d=0;d<l;d++){var c=n[d],p=c.id,m=c.name,v=0,g={};g.labelname=m,g.id=p;for(var u=0;u<a;u++){i[u].label.id===p&&(v=i[u].count)}g.count=v;var _=s.length,f={};for(u=0;u<_;u++){var h=s[u];h.id===p&&(f=h)}"Detected"===f.type?o.push(g):t.push(g)}e.detectedLabels=o,e.undetectedLabels=t},get_training_label_details:function(e,i){var a=this.get_training_details(e);return this.update_other_label_details(a,i)},get_training_details:function(e,i,a){if(void 0!==e){i||(i=[]);var t=e.group_operator;if(!t&&e.label)i.push(this.construct_group_obj(e,a));else{var o=e.group;o&&(this.get_training_details(o[0],i,t),this.get_training_details(o[1],i,t))}}return i},construct_group_obj:function(e,i){var a={};return a.comparator=void 0!==i?i.toLowerCase():"",a.labelId=e.label.id,a.apiName=null!==e.label.api_name?e.label.api_name:"",a.isDetected="${DETECTED}"===e.value,a.isNotDetected="${NOT_DETECTED}"===e.value,a.isDelete=!1,a},update_other_label_details:function(e,i){if(e)for(var a=e.length,t=i.length,o=0;o<a;o++)for(var r=0;r<t;r++)if(e[o].labelId===i[r].id||e[o].labelId===i[r].reference_id){a>=2&&o<a-1&&(e[o].comparator=e[o+1].comparator),e[o].labelName=i[r].name;var n=i[r].model_details;e[o].show_tags=n.length>0,e[o].tags=n,e[o].index=o+1,e[o].model_details=i[r].model_details}return this.addParenthesisToCriteria(e)},addParenthesisToCriteria:function(e){var i=[];if(e){var a=e.length,t=")";switch(a){case 1:e[0].openingBrackets="(",e[0].closingBrackets=t;break;case 2:e[0].openingBrackets="(",e[a-1].closingBrackets=t;break;case 3:e[0].openingBrackets="((",e[1].closingBrackets=t,e[2].closingBrackets=t}i=e}return i},has_gallery_selected:function(e){for(var i=e.length,a=0;a<i;a++)for(var t=e[a].model_details,o=t.length,r=0;r<o;r++){if("gallery"===t[r].type)return!0}return!1},addMarkers:function(e,i){var a,t=e.length,o=["zv_tag_yellow","zv_tag_green","zv_tag_blue"];(a=i?$L("#visionApprovalImg_preview"):$L("#myJobsSelectorView"))&&a[0]&&a.selector({destroy:!0});for(var r=0;r<t;r++){var n=e[r].object_details,s=n?n.length:0,l=[],d=0,c=[];if(s>0){for(var p=0;p<s;p++){var m=n[p].label,v={};v.left=n[p].x1,v.top=n[p].y1,v.width=n[p].x2-n[p].x1,v.height=n[p].y2-n[p].y1,l.push(v),d=3===d?0:d;var g={};g.label=m.name,g.colorClass=o[d],c.push(g)}d++,u(l,c)}}function u(e,i){a.selector({selections:e,onCreate:function(e){var a=document.createElement("span"),t=parseInt(e.classList[0].replace("lyteSelector",""))-1;e.classList.add(i[t].colorClass),i.length>0&&(a.setAttribute("class","vision_select_inputEle"),a.innerText=i[t].label),e.append(a)}})}},splitApprovals:function(e,i){for(var a=e.length,t=[],o=[],r=0;r<a;r++){var n;if("waiting_for_approval"===e[r].record_status)e[r].vision=store.peekRecord("visions",e[r].vision.id),"object_detection"!==(n=e[r].vision.validation_type)&&"match_detect"!==n||this.get_detected_undetected_labels(e[r]),o.push(e[r]);else e[r].vision=store.peekRecord("visions",e[r].vision.id),"object_detection"!==(n=e[r].vision.validation_type)&&"match_detect"!==n||this.get_detected_undetected_labels(e[r]),t.push(e[r])}i.setData("record_approvals",o),i.setData("image_approvals",t),o.length>0?i.setData("approvals",i.getData("record_approvals")):i.setData("approvals",i.getData("image_approvals"))},getDisplayMessage:function(e){var i=e.getData("action");switch(i="waiting_for_approval"===i?"image_approval":i){case"image_processing":e.setData("displayMessage",I18n.getMsg("crm.zia.vision.processing.msg"));break;case"do_not_create":e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.not.create"));break;case"record_approval":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.record.approval1")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.record.approval"));break;case"image_approval":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.image.approval1")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.image.approval"));break;case"create_without_image":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image1")):e.getData("isAjaxEdit")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image.ajax")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image"))}},attachmentApprovalsFromInsights:function(e){for(var i=Lyte.Router.getRouteInstance().currentModel.zia_insights.zia_insights_keys.vision_data,a=i.length,t=[],o=0;o<a;o++){var r=i[o];if(void 0!==r&&r.hasOwnProperty("approval_details"))for(var n=r.approval_details,s=n?n.length:0,l=0;l<s;l++){var d=n[l].vision,c=n[l].type,p=n[l].id,m=n[l].attachment;if(e===d.field.api_name){var v=m.id,g={};g.attachment_id=v,g.failure_action=c,g.visionApproval_id=p,g.vision_id=d.id,t.push(g);break}}}return t},renderVisionErrorPopUpForOtherFields:function(e,i,a,t,o,r,n,s){var l,d=$("crm-zia-vision-error-popup"),c=Crm.renderDVLyteFlow(a);if(d&&0!==d.length&&d.remove(),t||(t=!1),void 0===s)if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route)p=Lyte.Router.getRouteInstance().currentModel.entityDetails.image_vision_approvals[n];else{var p=[];e?p=c?this.attachmentApprovalsFromInsights(n):detailView.changedBCJson.hidden.vision_approvals[n]:t&&(p=Lyte.Router.getRouteInstance().currentModel.vision_approvals[n]);for(var m=p.length,v=0;v<m;v++)if(p[v].attachment_id===r){s=p[v].failure_action;break}}e?l=c?undefined:"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route?Lyte.Router.getRouteInstance().currentModel.entityDetails.image_vision_approvals[n][0].vision_id:detailView.changedBCJson.hidden.vision_approvals[n][0].vision_id:t&&(l=Lyte.Router.getRouteInstance().currentModel.vision_approvals[n][0].vision_id),Lyte.Component.render("crm-zia-vision-error-popup",{isDetailPage:e,fieldName:n,isOnClick:i,attachmentId:r,moduleName:a,entityId:o,is_edit_page:t,action:s,visionId:l},"#zia-vision-popup"),document.querySelector("crm-zia-vision-error-popup").setMethods({onDelete:function(e){this.executeMethod("deleteImageFromPreview",e)}.bind(this)}),Crm.userDetails.permissions.Crm_Implied_Approve_Actions&&"image_processing"!==s||$L("#visionModal")[0].ltProp("show",!0)},visionMyJobsPageChange:function(e,i){if(commonUtils.showHideLoadingDiv(!0),i)for(var a=Math.ceil(e.getData("jobs_count").image_validation/e.getData("recordPerPage")),t=1;t<=a;t++)if(e.getData("initialIndex")<t*e.data.recordPerPage){e.setData("initialIndex",(t-1)*e.data.recordPerPage),e.setData("page",t);break}var o=$L("#crm-ziavision-myjobslistview")[0].component;e.getmyJobsApprovals(e.getData("page"),e.getData("recordPerPage"),(function(i){o.setData("records",i.total_records),o.setData("recordInfo",i.meta),o.setData("index",(e.data.page-1)*e.data.recordPerPage),o.setData("page",e.getData("page")),commonUtils.showHideLoadingDiv(!1)}),o.getData("selectedModule"))},triggerBulkReviews:function(e,i){for(var a=e.getData("selectedAppObj"),t=[],o=a.length,r=0;r<o;r++){var n={},s=a[r],l=!1,d=$L("#visionErrorChk_"+s.id);d&&d[0]&&(l=d[0].ltProp("checked"));var c=!1,p=$L("#addToLearning_"+s.id);p&&p[0]&&(c=p[0].ltProp("checked")),n.vision_validation_error=l,n.add_to_learning=c,s.zia_vision_feedback=n,t[r]=s}var m=e.getData("selectedRecord"),v=store.peekRecord("module",m.module.id),g=e.getData("action"),u={};return u.is_satisfied=l?"yes":"no",Crm.client_tracking("Image Validation Metrics - Zia Feedback",u),store.triggerAction("visions","bulk_reviews",{failure_action:g,recordObj:m,moduleObj:v,reviewJson:t}).then((function(e){commonUtils.showHideLoadingDiv(!1),i(e)}),(function(e){commonUtils.showHideLoadingDiv(!1);var i=$L("#myJobsVisionPop");if(i.length&&(i[0].ltProp("show",!1),$L("crm-ziavision-myjobslistview")[0].component.setData("disaleAllButns",!1)),e&&e.response){var a="vision_record_approval";"image_approval"===g&&(a="vision_image_approval");var t=JSON.parse(e.response);!t[a]||"INVALID_DATA"!==t[a][0].code&&"UNAPPROVABLE"!==t[a][0].code?t&&"NO_PERMISSION"===t.code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.message.fail.validated"),I18n.getMsg("crm.zia.vision.action.performed"),!0)}else renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}))},constructImagePreview:function(e,i,a){e.constructSizeMinimizedImage(a).then((function(e){var t=[];t[0]={downloadUrl:a,original_src:a,src:e.url,uploadid:i.id,filename:i.image_name};var o={currentId:i.id,selector:"myJobsPreview_"+i.id,downloadImage:!0,zoom:!0};Lyte.Component.render("crm-image-preview",{imageData:t,isEditable:"false",previewConfiguration:o,id:"myJobsImagePreview"},"body");var r=$L("crm-image-preview#myJobsImagePreview")[0];r.setMethods({onClose:function(){r.remove()}});var n={lytecboxHref:a,lytecboxDlink:a,lytecboxTitle:i.image_name};$L(r).find(".imagePreviewTest")[0].launch(n),commonUtils.showHideLoadingDiv(!1)}))},setCreatePageErrorToFalse:function(e){e.component.setData("is_label_name_error",!1),e.component.setData("highlight_label_input",!1),e.component.setData("has_error_in_label_training_data",!1),e.component.setData("is_label_name_empty",!1)},labelNameValidator:function(e,i,a){var t=$L(".vision_training_criteria_header_".concat("imgValidation"===a?"img":"obj"));if(void 0===e.name||""===e.name.trim()||e.name.length>30)t[i].component.setData("is_label_name_error",!0),this.labelnameValidateHighlighter(i,a);else if(""!==e.name.trim()){var o=this.notAllowedSplCharChecker(e.name);if(""!==o){var r=I18n.getMsg("crm.zia.vision.objectname.not.allowed.splchar.error",o);"imgValidation"===a&&(r=I18n.getMsg("crm.zia.vision.labelname.not.allowed.splchar.error",o)),t[i].component.setData("labelNameSplCharErrorMsg",r),t[i].component.setData("highlight_label_input",!0),this.labelnameValidateHighlighter(i,a)}}},deleteVisionFailed:function(e,i){var a=JSON.parse(e.response);a.visions&&a.visions[0].code&&"INVALID_DATA"===a.visions[0].code?renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.delete.error")):(store.rollBack("visions"),a&&"CANNOT_DELETE"===a.code?$L("#deleteVisionModalRefresh")[0].ltProp("show",!0):a&&"NO_PERMISSION"===a.code?renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.zia.vision.deleted.error"),4e3))},enableSaveButton:function(){var e=$L("crm-ziavision-creationpage");e&&e[0]&&e[0].component.data.is_edit_page&&!e[0].component.data.isCriteriaEditPatternOpen&&e[0].component.setData("saveDisable",!1)},calculateFileArrCount:function(e){for(var i=e.files_arr.length,a=0,t=0;t<i;t++)(void 0!==e.files_arr[t].isDelete&&!e.files_arr[t].isDelete||null!==e.files_arr[t]._delete)&&(a+=1);return a},traininDataDetailsValidator:function(e,i){var a=$L(".vision_training_criteria_header_".concat("imgValidation"===i?"img":"obj")),t=$L("crm-ziavision-creationpage");(a[e].component.getData("is_label_name_error")||a[e].component.getData("highlight_label_input")||a[e].component.getData("has_error_in_label_training_data"))&&((a[e].component.getData("is_label_name_error")||a[e].component.getData("highlight_label_input"))&&a[e].component.getData("has_error_in_label_training_data")&&(this.setCreatePageErrorToFalse(a[e]),a[e].component.setData("has_label_and_images_error",!0),this.labelnameValidateHighlighter(e,i)),t[0].component.setData("trainingData_validation_failure",!0))},getModelInformation:function(e,i){return Lyte.resolvePromises({model_information:app.store.makeRequest("triggerAction","visions","model_information",{id:e})}).then((function(e){return i(e)})).catch((function(){return i()}))},renderHelpZiaPopupInEntityEdit:function(e,i,a,t){var o,r=this,n=!1,s={},l=0,d=$L("#zv_confirmModal")[0],c=$L("crm-zia-vision-error-popup");if(void 0===d||c&&c[0]&&!1===c[0].component.getData("isZiaFeedbackPopupShown")){var p,m=$L("crm-create-entity"),v=$L("crm-create-buttons"),g=$L("crm-image-upload-create");if(m&&v){var u,_=v[0].getData("entityrecordData"),f=m[0].getData("vision_data");if(f){for(var h=f.length,D=0;D<h;D++)f[D].validation_result&&(p=f[D].validation_result);if(p){var b=p.length;if(m[0].getData("isRecordImgRemoved")){var y=void 0!==_?_.$photo_id:null;if(y)for(var I=0;I<b;I++)p[I].image_ids.includes(y)&&p[I].validated_model_active&&(n=!0)}if(g&&g.length>0)for(var L=g.length,w=0;w<L;w++){o=g[w].getData("removedIds");var M=g[w].getData("existingData");l=o.length;for(I=0;I<l;I++){for(var k,P,z=M.length,C=0;C<z;C++)M[C].uploadid===o[I]&&(k=M[C].fileId,P=g[w].component.data.fieldid);for(D=0;D<b;D++)p[D].image_ids.includes(k)&&p[D].validated_model_active&&(s[P]=!0)}}}}m[0].setData("showVisionHelpZiaOfRecImg",n),m[0].setData("showVisionHelpZiaOfCusImg",s);var E=null,A=null;if(n){E=N("Record_Image",null),u=E}var S=!1;if(s&&Object.keys(s).length>0){L=g.length;if(g&&L>0)for(L=g.length,I=0;I<L;I++){if(s[g[I].component.data.fieldid])S=!0,A=N(null,g[I].component.data.fieldid),u=E||u?u+" "+I18n.getMsg("crm.zia.vision.comparator.and")+" "+A:A}}if(n||S)!function(){var o=$L("crm-zia-vision-error-popup");o&&o[0]?(o[0].component.setData("isFromEntityEditPage",!0),o[0].component.setData("deletedFieldLabels",u)):(Lyte.Component.render("crm-zia-vision-error-popup",{isFromEntityEditPage:!0,deletedFieldLabels:u},"#tabLayer"),o=$L("crm-zia-vision-error-popup"));var n=$L("#zv_confirmModal")[0];o[0].component.setData("isZiaFeedbackPopupShown",!1),n.ltProp("show",!0);var s=document.querySelector("#visionErrorChk");s&&s.checked&&r.unChkSRVisionErrInPopup();$L("#visionErrProceedBtn").on("click",(function(){var o=$L("crm-create-buttons");$L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!0),n.ltProp("show",!1),t?o[0].component.validateCreateform(e,void 0,void 0,void 0,void 0,t):o[0].component.createSubmit(e,i,a)})),$L("#visionErrCancelBtn").on("click",(function(){var e=$L("crm-create-buttons");$L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!1),n.ltProp("show",!1),e[0]&&e[0].component.setData("disableFormbuttons",!1)}))}();else if(t){var $,O=v[0].component.data.buttons;if(O&&O.length){var R=O.length;for(I=0;I<R;I++)if("crm_create_savebutn"===O[I].id){$=O[I];break}}$||($={}),v[0].component.validateCreateform(e,$.onSubmitFunction,$.id,void 0,void 0,t)}function N(e,i){var a=m[0].getData("moduleData"),t=a?a.fields:null,o=t.length;if(null!==e&&null!==t)for(var r=0;r<o;r++){if((n=t[r]).api_name===e)return n.field_label}if(null!==i&&null!==t)for(r=0;r<o;r++){var n;if((n=t[r]).id===i)return n.field_label}}}}},checkAndShowHelpZia:function(e){for(var i=this.getData("showHelpZia"),a=i?i.length:0,t=!0,o=0;o<a;o++)i[o].approvalId===e&&(t=!1);t&&this.addHelpZiaInMyJobsPopup(e)},addHelpZiaInMyJobsPopup:function(e){for(var i=$L("crm-ziavision-myjobslistview")[0].component,a=i.getData("vision_feedback_details"),t=a.length,o=0;o<t;o++){var r={};a[o].id===e&&a[o].vision_success_rate_feedback?(r.approvalId=e,r.askVisionError=!0,a[o].suggest_for_learn&&(r.suggest_for_learn=!0),Lyte.arrayUtils(i.getData("showHelpZia"),"push",r)):a[o].id!==e||a[o].vision_success_rate_feedback||(r.approvalId=e,r.askVisionError=!1,a[o].suggest_for_learn&&(r.suggest_for_learn=!0),Lyte.arrayUtils(i.getData("showHelpZia"),"push",r))}},successRateFeedbackPopupNewFlow:function(e,i,a){if(i){var t=this,o=e&&e.data.zia_insights&&e.data.zia_insights.zia_insights_keys?e.data.zia_insights.zia_insights_keys.vision_data:void 0;if(o&&0!==o.length){var r=$L("crux-image-component");if(r&&!(r.length<1)){var n=e.getData("ajaxEditFieldMeta");if(n&&n.id){for(var s,l,d=r.length,c=0;c<d;c++){var p=r[c].component;if(n.id===p.data.cxPropField.id){s=p.getData("cxPropValue"),l=p.getValue();break}}var m=l.filter((e=>e.hasOwnProperty("_delete")));if(!(m.length<1)){var v=m.map((e=>e.id)),g=s.length,u=[];for(c=0;c<g;c++)v.includes(s[c].id)&&u.push(s[c].fileId);if(!(u.length<1)){var _=[],f=o.filter((e=>e.validation_result));f[0]&&f[0].validation_result&&(_=f[0].validation_result.filter((e=>e.validated_model_active)));var h=!1,D=_.length;for(c=0;c<D;c++){var b=_[c];if(b.validated_model_active)if(b.image_ids.map((e=>u.includes(e.id))).length>0){h=!0;break}}if(h){var y=$L("#zv_confirmModal")[0],I=$L("crm-zia-vision-error-popup"),L=e;if(void 0===y||I&&I[0]&&!1===I[0].component.getData("isZiaFeedbackPopupShown"))return function(e){var i=$L("crm-zia-vision-error-popup");i&&i[0]?(i[0].component.setData("isFromEntityEditPage","edit"===a),i[0].component.setData("ziaErrorField","Custom_image")):(Lyte.Component.render("crm-zia-vision-error-popup",{ziaErrorField:"Custom_image",isFromEntityEditPage:!1},"#zia-vision-popup"),i=$L("crm-zia-vision-error-popup"));i[0].component.setData("isZiaFeedbackPopupShown",!1);var o=$L("#zv_confirmModal")[0];o.ltProp("show",!0);var r=$L("lyte-checkbox");return r.each((function(e){"visionErrorChk"!==$L(r[e]).attr("lt-prop-id")||r[e].component.data.ltPropChecked&&r[e].component.setData("ltPropChecked",!1)})),$L("#visionErrProceedBtn").on("click",(function(){$L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!0),o.ltProp("show",!1),t.ajaxEditSubmitSRFeedBack(n.id,e.getData("module"),e.getData("entityId")),"detail"===a&&(e.setData("visionSuccessRateProcessed",!0),e.handleAjaxSaveAction())})),$L("#visionErrCancelBtn").on("click",(function(){$L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!1),o.ltProp("show",!1)})),!0}(L)}}}}}}}},ajaxEditShowSRFBpopup:function(e,i,a,t,o,r){var n,s=this;if((n=o?e&&e.data&&e.data.zia_insights&&e.data.zia_insights.zia_insights_keys?e.data.zia_insights.zia_insights_keys.vision_data:void 0:e.vision_data)&&0!==n.length){var l,d,c=$L("#Crm_"+i.module+"_"+i.fieldLabel),p=c&&c[0]?c[0].children[0]:void 0,m=p?p.component:void 0;l=(o?$L("#Image_"+t.fieldObj.id):$L("#Image_"+i.fieldId))[0].component.getData("cxPropValue"),t&&t.image_upload_canvas_comp?d=t.image_upload_canvas_comp.getValue().filter((e=>null===e._delete)).map((e=>e.id)):m&&(d=m.getValue().filter((e=>null===e._delete)).map((e=>e.id)));var v=!1;if(n&&d&&d.length>0){for(var g,u=n.length,_=0;_<u;_++)n[_].validation_result&&(g=n[_].validation_result);if(g)for(var f=d.length,h=0;h<f;h++){for(var D,b=g.length,y=l.length,I=0;I<y;I++)l[I].uploadid===d[h]&&(D=l[I].fileId);if(D)for(var L=0;L<b;L++)g[L].image_ids.includes(D)&&g[L].validated_model_active&&(v=!0)}}var w=$L("#zv_confirmModal")[0],M=$L("crm-zia-vision-error-popup");if(v&&(void 0===w||M&&M[0]&&!1===M[0].component.getData("isZiaFeedbackPopupShown")))return function(){var e=$L("crm-zia-vision-error-popup");e&&e[0]?(e[0].component.setData("isFromEntityEditPage",!1),e[0].component.setData("ziaErrorField","Custom_image")):(Lyte.Component.render("crm-zia-vision-error-popup",{ziaErrorField:"Custom_image",isFromEntityEditPage:!1},"#zia-vision-popup"),e=$L("crm-zia-vision-error-popup"));e[0].component.setData("isZiaFeedbackPopupShown",!1);var n=$L("#zv_confirmModal")[0];n.ltProp("show",!0);var l=document.querySelector("#visionErrorChk");l&&l.checked&&s.unChkSRVisionErrInPopup();return $L("#visionErrProceedBtn").on("click",(function(){if($L("crm-zia-vision-error-popup")[0].component.setData("isZiaFeedbackPopupShown",!0),n.ltProp("show",!1),a&&t){var e={};e.api_name=t.fieldObj.api_name,e.value=Lyte.registeredMixins["crm-uploadfields-mixin"].constructFinalValueForCanvas(t.image_upload_canvas_comp.getValue(),"vlabel_"+t.fieldObj.column_name),t.crm_detailview_canvas_comp.onSave(e,t.fieldObj),s.ajaxEditSubmitSRFeedBack(t.fieldObj.id,t.crm_detailview_canvas_comp.getData("module"),t.crm_detailview_canvas_comp.getData("entityId"))}else o&&r?r._self.actions.saveImageEdit(r._self):Callonclickofbutton(i.param_url,i.getValue,i.showAfter,i.hideAfter,i.fieldLabel,i.module,i.subid,i.uitype,i.tableName,i.columnName,i.entityID,i.isZtiEnabled,i.istkv,i.fieldId,i.isCallAllowed,!0)})),!0}();if(v)return!1}},entityImgShowSRFBpopup:function(e){var i,a;if(Crm.userDetails.DETAIL_VIEW_LYTE){var t=$L("crm-detail-view");if(t&&t[0]||(t=$L("crm-detailview-canvas")),t&&t[0]){var o=t[0].component.getData("record");i=o?o.$photo_id:void 0,a=t[0].component.data.zia_insights&&t[0].component.data.zia_insights.zia_insights_keys?t[0].component.data.zia_insights.zia_insights_keys.vision_data:void 0}}else i=e.profileImgPhotoId,a=e.vision_data;if(a&&a.length>0){for(var r,n=a.length,s=0;s<n;s++)a[s].validation_result&&(r=a[s].validation_result);if(r)for(var l=r.length,d=0;d<l;d++)if(r[d].image_ids.includes(i)&&r[d].validated_model_active)return!0}},renderSRFBpopupForEntityImg:function(e){var i,a,t=$L("crm-zia-vision-error-popup");if(e){var o=$L("crm-detail-view");o&&o[0]||(o=$L("crm-detailview-canvas")),o&&o[0]&&(i=o[0].component.getData("entityId"),a=o[0].component.getData("module"))}else i=detailView.entityId,a=detailView.currentModule;t&&t[0]?(t[0].component.setData("isFromEntityEditPage",!1),t[0].component.setData("entityId",i),t[0].component.setData("ziaErrorField","Entity_image"),t[0].component.setData("moduleName",a),t[0].component.setData("contentLiterals","crm.image.remove.confirm")):Lyte.Component.render("crm-zia-vision-error-popup",{ziaErrorField:"Entity_image",entityId:i,moduleName:a,contentLiterals:"crm.image.remove.confirm"},"#zia-vision-popup"),$L("#zv_confirmModal")[0].ltProp("show",!0);var r=document.querySelector("#visionErrorChk");r&&r.checked&&this.unChkSRVisionErrInPopup()},ajaxEditSubmitSRFeedBack:function(e,i,a){var t=document.querySelector("#visionErrorChk"),o={},r=[],n=[],s={};s.id=e;var l="/crm/v3/"+i+"/"+a+"/actions/vision_feedback",d={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};if(t&&t.checked?(s.validation_failure_count=1,n.push(s)):t&&!t.checked&&(s.validation_failure_count=0,n.push(s)),t&&n.length>0){var c={};c.fields=n,r.push(c),o.vision_feedback=r,app.store.makeRequest("sendXHR",l,"PUT",d,JSON.stringify(o))}},unChkSRVisionErrInPopup:function(){document.querySelector("#visionErrorChk").checked=!1},getValidModules:function(e){var i=store.peekAll("visions").map((e=>({vision_id:e.id,field_id:void 0!==e.vision_fields?e.vision_fields.id:"-1"}))),a=[];return e.forEach((e=>{store.peekAll("layout",{module:e.api_name}).filter((i=>{if(i.module)return i.module.api_name===e.api_name})).filter((e=>{var a=e.status;if("active"===a||1===a){var t=[];if(e.fields&&(t=e.fields.filter((e=>{if(("profileimage"===e.data_type||"imageupload"===e.data_type&&1===e.length)&&!0===e.visible){var a=!0;return i.forEach((i=>{i.field_id===e.id&&(a=!1)})),a}return!1}))),t.length>0)return!0}return!1})).length>0&&a.push(e)})),a},postGalleryFeedback:function(e,i){var a={gallery_feedback:[{helpful:e,gallery_feedback:i}]};return store.triggerAction("visions","gallery_feedback",{request_body:a})},chkVisionDataForCustomUpload:function(e,i,a){var t,o,r,n,s=this,l=$L("crm-detailview-canvas")[0].component;if(t=l.data.zia_insights&&l.data.zia_insights.zia_insights_keys?l.data.zia_insights.zia_insights_keys.vision_data:void 0,o=l.getData("entityId"),r=l.getData("module"),n=l,!0,t&&0!==Object.keys(t).length){var d={fieldLabel:a.column_name,module:detailView.currentModule},c={crm_detailview_canvas_comp:e,image_upload_canvas_comp:i,fieldObj:a};if(!s.ajaxEditShowSRFBpopup(n,d,!0,c,true)){var p={};p.api_name=a.api_name,p.value=Lyte.registeredMixins["crm-uploadfields-mixin"].constructFinalValueForCanvas(i.getValue(),"vlabel_"+a.column_name),e.onSave(p,a)}}else if(detailView){Lyte.registeredMixins["zia-insights-utils"].getInsights(moduleRecordMapping[r],o,{keys:"vision_data"},(function(t){var o=$L("crm-detailview-canvas")[0].component;o.getData("originalRecord"),t={zia_insights_keys:{vision_data:t.vision_data}},o.setData("zia_insights",t);var r={fieldLabel:a.column_name,module:detailView.currentModule},l={crm_detailview_canvas_comp:e,image_upload_canvas_comp:i,fieldObj:a};if(!s.ajaxEditShowSRFBpopup(n,r,!0,l,true)){var d={};d.api_name=a.api_name,d.value=Lyte.registeredMixins["crm-uploadfields-mixin"].constructFinalValueForCanvas(i.getValue(),"vlabel_"+a.column_name),e.onSave(d,a)}}))}},getZipIdsToBeDeleted:function(e,i){for(var a=e.length,t=0;t<a;t++){var o=e[t].getData("files_arr");if(o&&o.length>0)for(var r=o.length,n=0;n<r;n++){var s=o[n],l=s&&s.file_id?s.file_id:void 0;l&&i.push(l)}}return i},setToolTipValues:function(e,i){var a={};if(a.heading=I18n.getMsg("crm.zia.vision.create.match.only"),a.label=I18n.getMsg("crm.zia.vision.create.feedback.match"),Lyte.arrayUtils(i.getData("tooltip_menu_item_values"),"push",a),"US"===e){var t={};t.heading=I18n.getMsg("crm.zia.vision.create.detect.only"),t.label=I18n.getMsg("crm.zia.vision.create.feedback.detect");var o={};o.heading=I18n.getMsg("crm.zia.vision.create.match.detect"),o.label=I18n.getMsg("crm.zia.vision.create.match.detect.info"),Lyte.arrayUtils(i.getData("tooltip_menu_item_values"),"push",t),Lyte.arrayUtils(i.getData("tooltip_menu_item_values"),"push",o)}},getValidationTypes:function(e){var i,a=[];((i={}).name=I18n.getMsg("crm.zia.vision.create.match.only"),i.value="imgValidation",a.push(i),"US"===e)&&((i={}).name=I18n.getMsg("crm.zia.vision.create.detect.only"),i.value="objDetection",a.push(i),(i={}).name=I18n.getMsg("crm.zia.vision.create.match.detect"),i.value="imgAndObj",a.push(i));return a}});
