Lyte.Mixin.register("crm-circuits-mixin",{data:{brandName:Lyte.attr("string",{default:Crm.brandName}),needToShowStopBanner:Lyte.attr("boolean",{default:!1}),inputData:Lyte.attr("object",{default:{}})},methods:{errorHandling:function(e,t,r){if(t)crmui.showMsgBand("error",I18n.getMsg(t),"4000");else switch(JSON.parse(e).code){case"NO_PERMISSION":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.error.authorization"),"4000");break;case"USER_NOT_CONFIRMED":crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.email.unconfirmed"),"4000");break;case"FEATURE_NOT_AVAILABLE":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),"4000");break;case"NOT_ALLOWED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.integration.deactivate.error"),"4000");break;case"CANNOT_PROCESS":"abort"===r[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.abort.ranalready.error"),"4000"):"retry"===r[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.retry.initiate.error"),"4000"):"rerun"===r[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.rerun.running.error"),"4000"):0===r[1]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.deactivate.error",r[0]),"4000"):1===r[1]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.delete.error",r[0]),"4000"):crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000");break;case"DUPLICATE_DATA":crmui.showMsgBand("error",t,"4000");break;case"USED_IN_OTHER_SERVICES":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.cannot.be.deleted.other",r[0]),"4000");break;case"PATTERN_NOT_MATCHED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.name.criteria.failed"),"4000");break;case"PRIMARY_ID_ALREADY_INTEGRATED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.portal.integration.unavailable"),"4000");break;case"INVALID_DATA":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.does.not.exist"),"4000");break;case"TRIAL_EXECUTION_LIMIT_EXCEEDED":Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),"4000"):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),"4000");break;default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000")}},openAssociateComponent:function(e){Lyte.registeredMixins["crm-circuits-mixin"].openAssociateCircuitComponent(e)},checkPaymentStatusIsPresentInClient:function(e,t){Crm.userDetails.hasOwnProperty("Circuits")&&Crm.userDetails.Circuits.hasOwnProperty("paymentInfo")?e&&e(t):store.triggerAction("circuits","circuits_payment_status",{request_type:"GET"}).then((function(r){Crm.userDetails.Circuits||(Crm.userDetails.Circuits={}),Crm.userDetails.Circuits.integration_done_by=r.payment_status[0].done_by,delete r.payment_status[0].done_by,Crm.userDetails.Circuits.paymentInfo=r.payment_status[0],e&&e(t)}),(function(){e&&e(t)}))},getZuidVsUserIdObj:function(){for(var e=store.peekAll("user"),t={},r=e.length,i=0;i<r;i++){var s=e[i];t[s.zuid]=s.id}return t}},onCloseOfCircuitAssociateComp:function(e,t,r){try{var i=$(".setupleftmenutable"),s=$("#customizeModuleDiv");switch(t){case"close":if("custom_button"===e)CustomButtonJSObject.closeCustomFunctionConfigDiv();break;case"configure":switch(e){case"custom_button":Lyte.registeredMixins["crm-custom-button-mixin"].saveCircuitInfo(r);break;case"workflow":var a={};a.details={circuit_id:r.id,name:r.name},a.type=this.data.inputData.actionApiName,a.name=r.name,this.data.inputData.id?a.id=this.data.inputData.id:this.data.inputData.tempId&&(a.tempId=this.data.inputData.tempId),Lyte.registeredMixins["crm-automation-actions"].associateActionToFeatureComponent(this.data.inputData.actionApiName,this.data.inputData.featureType,a,this.data.inputData.sequenceNumber,this.data.inputData.triggerCount,this.data.inputData.isScheduledAction);break;case"blueprint_state":BlueprintState.frameSubmitAction("create",r.id,r.name,"");break;case"blueprint":ProcessBuilder.frameSubmitAction("associateCircuit",r.id,r.name,"")}break;case"editorOpen":switch(e){case"custom_button":s.hide();break;case"workflow":case"blueprint":case"blueprint_state":i.hide()}break;case"editorClose":switch(e){case"custom_button":s.show();break;case"workflow":case"blueprint":case"blueprint_state":i.show()}break;case"getRenderId":switch(e){case"custom_button":case"workflow":case"blueprint":case"blueprint_state":if(0===$("#circuitEditorDiv").length){$('<div id="circuitEditorDiv"></div>').prependTo("body")}return"#circuitEditorDiv"}break;default:return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000"),!1}}catch(e){return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000"),!1}return!0},preProcessAction:function(e,t){if(t.isEdit&&!Crm.userDetails.IS_ADMIN&&!Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&Lyte.registeredMixins["crm-automation-actions"].isReadOnlyActionForTeamModule(t.module,e))return Lyte.registeredMixins["crm-automation-actions"].handleErrorResponses(JSON.stringify({code:"NO_PERMISSION"}),!1)},fetchDataForNewAction:function(){return{}},processDataForNewAction:function(e,t){return Lyte.registeredMixins["crm-automation-actions"].setTemporaryIdForNonAssociateActions(e.actionApiName,t,e),t.inputData=e,t},fetchActionDataForEdit:function(e){return e.actionData},processActionDataForEdit:function(e,t){return Lyte.registeredMixins["crm-automation-actions"].setTemporaryIdForNonAssociateActions(e.actionApiName,t,e),t.inputData=e,t},renderActionComponent:function(e){e.isEdit||(this.data.inputData=e,this.openAssociateCircuitComponent({feature:e.featureType,hasCircuitsConfigPermissionInWf:Crm.userDetails.IS_ADMIN||Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||!Lyte.registeredMixins["crm-automation-actions"].isReadOnlyActionForTeamModule(e.module,"circuits"),inputData:e}),commonUtils.showHideLoadingDiv(!1))},processActionData:function(e){var t={};return e.actionData&&(t=e.actionData),t},openAssociateCircuitComponent:function(e){if(commonUtils.showHideLoadingDiv(!0),0!==$L("crm-circuits-association").length)Lyte.triggerEvent("cirAssoc_setData",e),Lyte.triggerEvent("cirAssoc_reloadCircuitsPop");else{var t=networkUtils.returnDependencyFiles(["crm-circuits-association.js"],ResourceConstants.CRMClient);t=t.concat(networkUtils.returnDependencyFiles(["crm-circuits-association.css","crm-circuits-preview-display.css","crm-circuits-create-edit.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],ResourceConstants.CRMClient))),Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-circuits-association",e,"#result"),Lyte.triggerEvent("cirAssoc_setData",{showMainPop:!0})}))}},setFocusOnSearchControl:function(e){$L(this.$node.querySelector(`#${e}`)).focus()}});
