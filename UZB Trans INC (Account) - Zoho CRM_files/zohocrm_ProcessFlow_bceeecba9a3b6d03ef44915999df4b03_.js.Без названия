var returnJson=returnJson||{},ProcessFlow={recordIdVsTransitionDetails:{},transitionIdVsTransitionDetails:{},nextTransitions:[],API_VERSION:"v2"};ProcessFlow.PROCESS_URL=Crm.getCrmBasePath()+"/ProcessFlow.do",ProcessFlow.TRANSITION_URL=Crm.getCrmBasePath()+"/FlowTransition.do",ProcessFlow.MODULE_PAGELAYOUT=Crm.getCrmBasePath()+"/PageLayout.do",ProcessFlow.ACTION="action",ProcessFlow.SHOW_ALL_PROCESSES="showAllProcesses",ProcessFlow.GET_PROCESS_RELATED_DATA="getProcessRelatedData",ProcessFlow.GET_RELATED_TRANSITIONNAMES="getRelatedTansitionNames",ProcessFlow.SAVE_PROCESS_ORDER="saveProcessOrder",ProcessFlow.DO_TRANSITION="doTransition",ProcessFlow.SAVE_FLOWCHANGEACTION="SaveFlowChangeAction",ProcessFlow.UPDATE_PROCESS_STATUS="updateProcessStatus",ProcessFlow.GET_NEXT_TRANSITION="nextTransition",ProcessFlow.TRANSITION_FIELD_UPDATE="transitionFieldUpdate",ProcessFlow.GET_LAYOUT_AND_FIELDS="getLayoutAndFields",ProcessFlow.SAVE_PROCESS="saveProcess",ProcessFlow.CREATE_PROCESS="CreateProcess",ProcessFlow.UPDATE_PROCESS="UpdateProcess",ProcessFlow.GET_RECORDSINVOLVED_COUNT="getRecordsInvolvedCount",ProcessFlow.DELETE_PROCESS="deleteProcess",ProcessFlow.CREATE_TRANSITION="CreateTransition",ProcessFlow.UPDATE_TRANSITION="UpdateTransition",ProcessFlow.GET_DURINGFIELDS_FOR_MODULE="getDuringFieldsForModule",ProcessFlow.GET_DEPENDENT_DURINGFIELDS="getDependentDuringFields",ProcessFlow.POST_REQUEST_TYPE="POST",ProcessFlow.GET_REQUEST_TYPE="GET",ProcessFlow.RESPONSE_SUCCESS="Success",ProcessFlow.RESPONSE_FAILURE="Failure",ProcessFlow.STATUS="Status",ProcessFlow.SUPPORTED_MODULES=[],ProcessFlow.processCurrentViewResponse={},ProcessFlow.fieldIdVsData={},ProcessFlow.criteriaProperties=[],ProcessFlow.processIdVsTransitionNames={},ProcessFlow.moduleVsLayouts={},ProcessFlow.layoutIdVsFields={},ProcessFlow.isRequestSent=!1,ProcessFlow.currentProcessDetails={},ProcessFlow.isAllProcessLoaded=!1,ProcessFlow.moduleProcessLength={},ProcessFlow.isProcessListView=!1,ProcessFlow.isPortalActivated=!1,ProcessFlow.isPortalDataLoaded=!1,ProcessFlow.allPortalsData=[],ProcessFlow.ACTION_CHANGE=1,ProcessFlow.ACTION_SCROLL=2,ProcessFlow.ACTION_REORDER=3,ProcessFlow.PROCESS_LIMIT=200,ProcessFlow.PROCESS_COUNT=0,ProcessFlow.ExcecutionObjs={},ProcessFlow.ActivityModules=["Tasks","Events","Calls"],ProcessFlow.PipelineOptionsTemplate="",ProcessFlow.FieldDependency={},ProcessFlow.layoutRuleData={},ProcessFlow.processConfiguredFieldColumn=void 0,ProcessFlow.isPartialSaveDisabled=!1,ProcessFlow.isKioskExecPopupClosed=!0,ProcessFlow.OPTIONAL_FIELD_FEATURE=!1,ProcessFlow.AFTERTRANSITION_CS=!1,ProcessFlow.canvasAfterTransObj={},ProcessFlow.OPTIONAL_LR_ENABLED=!1,ProcessFlow.loadProcesses=function(e,t,s,r){var o={},i=$("#modOpt"),a=$("#status"),n=$("#processListHeader");o[ProcessFlow.ACTION]=ProcessFlow.SHOW_ALL_PROCESSES;var l=i.parent();"All"!==e?l.addClass("filterApplied"):l.removeClass("filterApplied"),e?(ProcessFlow.isAllProcessLoaded=!1,ProcessBuilder.ProcessPageCnt=0):e=i.val(),t||(t=$("#status").val());var d=a.parent();if("All"!==t?d.addClass("filterApplied"):d.removeClass("filterApplied"),r?o.SearchText=r:$("#bluePrintSearchTxt").val(""),o.module=e,s===ProcessFlow.ACTION_SCROLL)ProcessBuilder.ProcessPageCnt++,o.Page=ProcessBuilder.ProcessPageCnt;else if(s===ProcessFlow.ACTION_REORDER){if(ProcessBuilder.ProcessPageCnt=0,o.Page=ProcessBuilder.ProcessPageCnt,t="All","All"==e)return!1;n.find("select").prop("disabled",!0)}o.Status=t,ProcessBuilder.listViewModule=e,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:o,success:function(r){if(ProcessBuilder.ProcessSearchReqSent=!1,ProcessFlow.isAllProcessLoaded=r.IsAllProcessLoaded,ProcessFlow.isProcessListView=!0,r.isPortalActivated&&(ProcessFlow.isPortalActivated=r.isPortalActivated),r.inactivePortalIds&&(ProcessBuilder.inactivePortalIds=r.inactivePortalIds),r.allPortalsData&&(ProcessFlow.allPortalsData=r.allPortalsData,ProcessFlow.isPortalDataLoaded=!0),ProcessFlow.setProcessListViewData(r,s),ProcessFlow.PROCESS_LIMIT=r.totalProcessLimit,ProcessFlow.PROCESS_COUNT=r.totalCnt,ProcessFlow.hideCreateProcessOnModuleLengthExceed(r),s!==ProcessFlow.ACTION_SCROLL){t?$("#processListHeader #status").val(t):$("#processListHeader #status").val("All");var o=$("#reOrderBtn");"All"==e?(o.addClass("disabledBtn"),o[0].setAttribute("onmouseover","crmui.toolTip_show(this,'left','"+I18n.getMsg("crm.automation.process.reorder.disabled.msg")+"')"),o[0].setAttribute("onmouseout","crmui.toolTip_hide()")):(o.removeClass("disabledBtn"),o.removeAttr("onmouseover"),o.removeAttr("onmouseout")),s===ProcessFlow.ACTION_REORDER&&($("#processDataContainer .processDataRow").each((function(e,t){var s=$(t);s.removeClass("hide"),s.addClass("reorderIc")})),ProcessFlow.doReorderActions(!0))}}})},ProcessFlow.hideCreateProcessOnModuleLengthExceed=function(e){e.hasOwnProperty("selectedModuleLength")&&(ProcessFlow.moduleProcessLength[e.selectedModule]=e.selectedModuleLength),ProcessFlow.hideCreateProcessButtonOnLimitExceed(e.totalCnt)},ProcessFlow.hideCreateProcessButtonOnLimitExceed=function(e){var t=$("#pa_createProcessBtn");e>=ProcessFlow.PROCESS_LIMIT?(t.prop("disabled",!0),t.attr("title",I18n.getMsg("crm.process.max.limit.reached.msg",[ProcessFlow.PROCESS_LIMIT]))):t.prop("disabled",!1)},ProcessFlow.tabAction=function(e){var t=$(".NodeContextMenu"),s=$(".linkContextMenu");if("block"!=s.css("display")&&"block"!=t.css("display")||(t.hide(),s.hide()),"pb_processInfo"==e&&ProcessBuilder.unSavedAction)return ProcessBuilder.showHideUnsavedAction(),!1;if("pb_processInfo"===e&&ProcessBuilder.unSavedStateAction)return ProcessBuilder.showHideUnsavedTransitionReorder(),!1;var r=$(".select2-container.select2-container--open");r.is(":visible")&&r.remove();var o=$("#"+e),i=o.siblings();"pb_transitionInfo"==e?(o.removeClass("hide"),$("#pb_stateInfo, #pb_orderInfo").addClass("hide")):"pb_stateInfo"==e?(o.removeClass("hide"),$("#pb_transitionInfo, #pb_orderInfo").addClass("hide")):"pb_orderInfo"===e?(o.removeClass("hide"),$("#pb_stateInfo, #pb_transitionInfo").addClass("hide")):(i.addClass("hide"),$("#pb_stateInfo, #pb_transitionInfo").addClass("hide")),o.addClass("sel"),i.removeClass("sel");var a=i[0],n=i[1];if(void 0!==a){var l=a.getAttribute("id");$("."+l).css("display","none")}if(void 0!==n){var d=n.getAttribute("id");$("."+d).css("display","none")}thirdPartyUtils.bindSelect2(".pb_form_ele"),$("."+e).fadeIn(200);var c=$(".actTransition"),p=$("#canvas .window.jtk-node, .jsplumb-overlay.aLabel"),u=$("#hotSpotSwitch");"pb_processInfo"==e?(p.removeClass("cTstates"),ProcessBuilder.setFieldDivHeight(),ProcessBuilder.applyCommonlineStyle(),u.removeClass("bpHelpClose"),$(".hotspots").removeClass("dIB").addClass("dN"),$(".pb_tabClass .commentabmenu").find("#pb_processInfo").removeClass("mR36"),$(".pb_property_toll").removeClass("hotspotOn")):0==c.find(".reverseSkew").length?u.addClass("dN"):u.removeClass("dN")},ProcessFlow.setProcessListViewData=function(e,t){var s=$("#processDataContainer");if(t===ProcessFlow.ACTION_SCROLL){if(e.Processes.length>0){ProcessFlow.processCurrentViewResponse.Processes=ProcessFlow.processCurrentViewResponse.Processes.concat(e.Processes);var r=Handlebars.templates.ProcessListViewData({processes:e.Processes,isReOrder:e.ALLOWREORDER});s.append(r)}}else{$(".setupleftmenutd").show(),$("#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow"),ProcessFlow.processCurrentViewResponse=e,e.SUPPORTED_MODULES&&(ProcessFlow.SUPPORTED_MODULES=e.SUPPORTED_MODULES);r=Handlebars.templates.ProcessListViewData({processes:e.Processes,isReOrder:e.ALLOWREORDER});ProcessBuilder.RegexValidators=e.RegexValidators;var o=$("#reOrderBtn"),i=$("#noProcessMessageDiv");s.html(r),o.hide(),i.addClass("hide"),$("#saveReOrderBtn, #cancelReOrderBtn").hide();var a=s.find(".processDataRow").length;0===a?i.removeClass("hide"):a>1&&o.show()}commonUtils.showHideLoadingDiv(),ProcessBuilder.bindMoreActions()},ProcessFlow.getProcessIdVsDetails=function(e){var t={};return e.each((function(e){t[e.Id]=e})),t},ProcessFlow.bpRelatedListTab=function(e){var t=$(e),s=t.attr("data-tab");if(ProcessFlow.bpRelatedListTabSwitch(t.attr("data-tab")),t.addClass("sel"),"Calls_rlContainer"!==s&&"Tasks_rlContainer"!==s&&"Events_rlContainer"!==s)setTimeout((function(){for(var e=$(".duringTabDivsClass .bpRl-tab-content:visible"),t=[],s=e.find(".tabDivCreate .labelTabCreate"),r=s.length,o=0;o<r;o++){var i=s.eq(o).outerWidth();t.push(i)}var a=Math.max.apply(null,t);a>=190&&(a=190),s.css("width",a+"px");var n=e.find(".assignmentRestrictionDiv");n&&n.length>0&&(Crm.userDetails.RTL_ENABLED&&(a=-s.outerWidth()),n.css("left",a+"px"))}),100);else if(isNewCallView&&"Calls_rlContainer"===s){var r=$("#duringTabDivs #Calls_fldRow_CALLTYPE select"),o=$("#duringTabDivs #Calls_fldRow_OUTBOUNDCALLSTATUS select");r.val(r.find("option").filterByData("actual-value","Outbound").val()),o.val(o.find("option").filterByData("actual-value","Completed").val()),r.attr("disabled",!0),o.attr("disabled",!0)}select2ChangesInFields($("#duringTabDivs"))},ProcessFlow.bpRelatedListTabSwitch=function(e){$("ul.bpRLcommentabmenu li").removeClass("sel"),$(".bpRl-tab-content").removeClass("current");var t=$("#"+e),s=$("#"+e+"_header");if(t.addClass("current"),s.addClass("sel"),t.hasClass("expandWidth")?$("#multipleFieldsEditPop").addClass("w90_per").removeClass("w980"):$("#multipleFieldsEditPop").removeClass("w90_per").addClass("w980"),"checkListContainer"!==e){var r=t.find(".restrictAssignment .labelTabCreate");if(r.length>0&&r.length>0){var o,i,a=r.attr("id");a=a.split("_label")[0];var n=$("#"+a);if("fieldsContainer"===e)o=$("#multipleFieldEditModule").val(),i=t.find("crm-threshold-grant"),$.each(r,(function(e,t){var s=$(t),r=s.attr("id");r=r.split("_label")[0];var a,l=(n=$("#"+r)).data("entitymodule");if(void 0!==l&&o!==l){var d={};d.ownerid=n.data("id"),d.moduleName=l;var c="#"+s.parent().attr("id")+" .assignmentRestrictionDiv";(a=$(c).find("crm-threshold-grant")).length>0?(a=a[0]).setData("ownerid",d.ownerid):((a=Lyte.Component.render("crm-threshold-grant",d,c)).id="assRestGrant",a.classList.add("dIB",r),a.component.executeMethod("addRestrictionMessage",a))}else i.length>0&&((a=i[0]).setData("ownerid",n.data("id")),a.classList.add(r),a.component.executeMethod("addRestrictionMessage",a))}));else{o=s.data("mod");var l={};l.ownerid=n.data("id"),l.moduleName=o;var d="#"+t.find(".restrictAssignment").attr("id")+" .assignmentRestrictionDiv";(i=$(d).find("crm-threshold-grant")).length>0?(i=i[0]).setData("ownerid",l.ownerid):((i=Lyte.Component.render("crm-threshold-grant",l,d)).id="assRestGrant",i.classList.add("dIB")),i.classList.add(a),i.component.executeMethod("addRestrictionMessage",i)}}}},ProcessFlow.saveProcessReOrder=function(){var e=ProcessFlow.getProcessIdVsDetails(ProcessFlow.processCurrentViewResponse.Processes),t={},s=[];$("#processDataContainer .processDataRow").each((function(r,o){var i=$(o).attr("data-pid");t[i]=r+1,s.push(e[i])})),ProcessFlow.processCurrentViewResponse.Processes=s,commonUtils.showHideLoadingDiv(!0);var r=$("#modOpt").val(),o={};o[ProcessFlow.ACTION]=ProcessFlow.SAVE_PROCESS_ORDER,o.module=r,o.sequenceDetails=JSON.stringify(t),networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:o,success:function(e){commonUtils.showHideLoadingDiv(),e[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&ProcessFlow.cancelProcessReOrder(!0),ProcessFlow.hideCreateProcessButtonOnLimitExceed(ProcessFlow.PROCESS_COUNT),$("#bluePrintSearchTxt").css("pointer-events","");var t=$("#processDataContainer");t.removeClass("cM ui-sortable"),t.data("ui-sortable")&&t.sortable("destroy"),ProcessBuilder.bindMoreActions()}})},ProcessFlow.interceptTransition=function(e,t,s,r,o,i){if(!CFRExec.ruleExecutedinDetailViewPage&&CFRExec.ruleDownloadPromise&&detailView.entityId===t)return CFRExec.ruleDownloadPromise.then((function(a){a&&a[0]&&(CFRExec.init(a[0],e,"view"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0),CFRExec.ruleExecutedinDetailViewPage=!0,CFRExec.ruleDownloadPromise=void 0),ProcessFlow.interceptTransition(e,t,s,r,o,i)}));if(CScriptLib){var a=ProcessFlow.recordIdVsTransitionDetails[t].Transitions||[],n={};a.filter((function(e){0==e.ParallelTrans&&e.TransitionRelId===s?n={id:e.TransitionRelId,name:e.TransitionName}:1==e.ParallelTrans&&e.ParallelConnections.filter((function(e){e.TransitionRelId===s&&(n={id:e.TransitionRelId,name:e.TransitionName})}))}));var l=$L("span[id^='transBtn_']");l.attr("disabled",!0),l.addClass("pointerEveNone"),CScript.Engine.Global.dispatchIEvent("beforeTransition",void 0,n).then((function(a){l.attr("disabled",!1),l.removeClass("pointerEveNone"),!0===a&&ProcessFlow.doTransition(e,t,s,r,o,i)}))}else ProcessFlow.doTransition(e,t,s,r,o,i)},ProcessFlow.doTransition=function(e,t,s,r,o,i,a,n,l,d){if(Crm.renderDVLyteFlow(e)&&"Approvals"===o)Lyte.injectResources(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("blueprintexecution")],ResourceConstants.CRM),void 0).then((function(){var s={id:a,name:n,source:"myjobs",next_field_value:d},r=$L("#awtAppRecsDIV");if($L("#bpExecPopup").length<=0){var o=$("<div>");o.attr("id","bpExecPopup"),r.append(o[0])}if($L("#bpExecTransitionDiv").length<=0){var i=$("<div>");i.attr("id","bpExecTransitionDiv"),r.append(i[0])}var c=moduleRecordMapping[e].id;store.model[c]||store.registerModel(c,{},{extends:"entity"});var p=store.peekRecord(c,t);void 0!==p?ProcessFlow.renderBlueprintExecTransition(p,s,e,!1,l):store.findRecord(c,t).then((function(r){r[0]?ProcessFlow.renderBlueprintExecTransition(r[0],s,e,!1,l):ProcessFlow.renderBlueprintExecTransition({id:t},s,e,!1,l)}),(function(){ProcessFlow.renderBlueprintExecTransition({id:t},s,e,!1,l)}))}));else{"entity"===Lyte.Router.getRouteInstance().parent.routeName&&"canvas"===Lyte.Router.getRouteInstance().routeName&&(o="Canvas",Crm.canvasScroll=$L("crm-detail-view-blueprint-action")[0].parentElement.closest("[id]").id),void 0===r&&(r=$("#entityName").val()),ProcessFlow.ExcecutionObjs.module=e,ProcessFlow.ExcecutionObjs.entityId=t,ProcessFlow.ExcecutionObjs.entityName=r,ProcessFlow.ExcecutionObjs.isContinuousBP=1==i,ProcessFlow.ExcecutionObjs.transRelId=s;var c={};c[ProcessFlow.ACTION]=ProcessFlow.DO_TRANSITION,c.module=e,c.entityId=t,c.transitionRelId=s,networkUtils.setCsrfParam(c),commonUtils.showHideLoadingDiv(!0);var p=$("#pb_processButtonLayerInner, #transitionBtnLayer");p.find(".pb_transitionState").addClass("eventNone"),(void 0!==o&&"Approvals"===o||"Canvas"===o)&&(c.getLayoutRuleJSON=!0),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:c,success:async function(r){if(commonUtils.showHideLoadingDiv(),r[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS){r.OptionalFieldFeature&&(ProcessFlow.OPTIONAL_FIELD_FEATURE=r.OptionalFieldFeature),r.afterTransitionCSSupport&&(ProcessFlow.AFTERTRANSITION_CS=r.afterTransitionCSSupport),r.OptionalLREnabled&&ProcessFlow.OPTIONAL_FIELD_FEATURE&&(ProcessFlow.OPTIONAL_LR_ENABLED=r.OptionalLREnabled),ProcessFlow.currentTransitionDetails=r.Transition;var o=r.DuringFields?r.DuringFields:[],i=r.NextTransitions?r.NextTransitions.Transitions:[];ProcessFlow.fieldDependency=r.fieldDependency?r.fieldDependency:void 0;var a=r.dependentFields?r.dependentFields:void 0;ProcessFlow.isPartialSaveDisabled=r.isPartialSaveDisabled;for(var n=!1,l=i.length,d=[],c=0;c<l;c++)i[c].IsCriteriaMatched&&d.push(i[c]),n=n||i[c].IsCriteriaMatched;ProcessFlow.nextTransitions=d,ProcessFlow.duringFieldDetails=o,CFRExec&&void 0!==r.layoutRuleJSONObj&&!$.isEmptyObject(r.layoutRuleJSONObj)&&(returnJson=$.parseJSON(r.entityInfo),CFRExec.init(r.layoutRuleJSONObj,e,"list")),ProcessFlow.layoutRuleData=r.layoutRuleData?r.layoutRuleData:{};var u=!1;if(o.length>1||n){var m=!1;if(o.each((function(e){var t=e.Type;"Note"!==t&&"rlFields"!==t||(m=!0),"Tags"!==t||Lyte.Component.registeredComponents["crux-tag"]||(u=!0)})),p.find(".pb_transitionState").removeClass("eventNone"),Crm.userDetails.isStorageLimitReached&&m)Crm.showStorageExceedPopup();else if(u){var v=networkUtils.returnDependencyFiles(["crux-tag.js","crux-color-palette.js"],ResourceConstants.CRMClient);Lyte.injectResources(v,void 0,(function(){ProcessFlow.showDuringTransitionFieldsPop(e,o,t,s,d,ProcessFlow.currentTransitionDetails,ProcessFlow.fieldDependency,a)}))}else ProcessFlow.showDuringTransitionFieldsPop(e,o,t,s,d,ProcessFlow.currentTransitionDetails,ProcessFlow.fieldDependency,a)}else 1===o.length&&o[0].FieldObject.fieldid===r.Transition.ProcessFieldId&&(ProcessFlow.processConfiguredFieldColumn=o[0].FieldObject.colname),ProcessFlow.saveStateChange(e,t,ProcessFlow.currentTransitionDetails.ProcessFieldId,s)}else null!=r.Error&&r.Error.indexOf("We will reload this record")>-1?renderingUtils.showCustomAlert(r.Error,void 0,void 0,(function(){crmHistory.refreshCurrentPage()}),void 0,void 0):renderingUtils.showCustomAlert(r.Error),p.find(".pb_transitionState").removeClass("eventNone");if(CScriptLib&&("undefined"!=typeof DetailViewHandler||"undefined"!=typeof CanvasDetailPageHandler)&&(!$L("crm-detailview-canvas").length||Crm.userDetails.CANVAS_BP_MANDATORY_CSCRIPT)){"undefined"==typeof DetailViewHandler&&await Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-detailview-cscript-handler.js"],ResourceConstants.CRMClient),void 0,void 0);var g={};$("#multipleFieldsEditPop").find("[cscript-tag]").each(((e,t)=>{var s=$(t).attr("cscript-tag");s.startsWith("__")||(g[s]=DetailViewHandler.mandatory_form_read(s))})),CScript.Engine.Global.dispatchEvent("onMandatoryFormLoad",void 0,g)}}})}Crm.trackSpotLightAction("Process Automation - Record Level Transition",{Module:e})},ProcessFlow.renderBlueprintExecTransition=function(e,t,s,r,o){var i=networkUtils.returnDependencyFiles(["crm-blueprint-exec.js","crm-blueprint-exec-mixin.js","crux-criteria-component.js","crm-create-dependent-resources.js","crm-create-fields.js","crm-create-dependencies.js","crux-form-component.js","crm-related-list-action-wrapper.js","crm-related-list-view-header.js","crm-detail-view-utils.js","crm-create-mixin.js","crm-attachments.js","crm-detail-view-initial-files.js","crm-lookup-parser-mixin.js","crm-lookup-mixin.js"],ResourceConstants.CRMClient);i=i.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(i=i.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),Lyte.injectResources(i,void 0,(function(){var i=Lyte.Component.render("crm-blueprint-exec-transition",{transition:t,module:s,record:e,noModuleAccess:r,processFieldId:o},"#bpExecTransitionDiv");i.setAttribute("id","bpExecTransition"),i.component.executeMethod("doTransitionAction")}))},ProcessFlow.checkForTransitionPreview=function(e,t){if(Crm.renderDVLyteFlow(t)){var s=networkUtils.returnDependencyFiles(["crm-blueprint-exec.js","crm-blueprint-exec-mixin.js","crux-criteria-component.js","crm-create-dependent-resources.js","crm-create-fields.js","crm-create-dependencies.js","crux-form-component.js","crm-related-list-action-wrapper.js","crm-related-list-view-header.js","crm-detail-view-utils.js","crm-create-mixin.js","crm-attachments.js","crm-detail-view-initial-files.js","crm-lookup-parser-mixin.js"],ResourceConstants.CRMClient);s=s.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(s=s.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),Lyte.injectResources(s,void 0,(function(){var s=document.querySelector("crm-blueprint-preview");s?s.setData("displayPopup",!0):store.findRecord("blueprint_exec",e,null,null,null,{type:"GET",recordId:e,module:t}).then((function(e){if(e&&e.blueprint&&e.blueprint.process_info){let s=e.blueprint,r=s.process_info,o=[],i={};s.transitions.forEach((function(e){if(e.parent_transition){let t=e.parent_transition.id,s=i[t];s=void 0===s?[]:s,s.push(e),i[t]=s}else"automatic"!==e.type&&o.push(e)})),Lyte.Component.render("crm-blueprint-preview",{processName:r.name,currentState:r.value,transitions:o,parallelTransitions:i,canViewNonAccessibleTransition:Crm.userDetails.BLUEPRINT_SHOW_NON_ACCESSIBLE_TRANSITIONS,module:t},"#pb_processPreviewLayer")}}))}))}else{if(void 0===ProcessFlow.recordIdVsTransitionDetails[e]){var r={};r[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,r.module=t,r.entityId=e,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:r,success:function(t){void 0!==t.NextTransitions&&(ProcessFlow.recordIdVsTransitionDetails[e]=t.NextTransitions,Handlebars.templates.ProcessPreviewPop?ProcessFlow.showTransitionPreview(e):Lyte.injectResources([networkUtils.returnDependencyFiles(["processPreviewPop.js"],ResourceConstants.CRM)[0]],void 0,(function(){ProcessFlow.showTransitionPreview(e)})))}})}else Handlebars.templates.ProcessPreviewPop?ProcessFlow.showTransitionPreview(e):Lyte.injectResources([networkUtils.returnDependencyFiles(["processPreviewPop.js"],ResourceConstants.CRM)[0]],void 0,(function(){ProcessFlow.showTransitionPreview(e)}))}},ProcessFlow.showTransitionPreview=function(e){var t=ProcessFlow.recordIdVsTransitionDetails[e],s=$("[id=pb_configProcess][entityId="+e+"]"),r=renderingUtils.windowHeight-150;if(s.length<=0){var o=Handlebars.templates.ProcessPreviewPop({EntityId:e,ProcessName:t.ProcessName,CurrentStateDisplayValue:t.CurrentStateDisplayValue,Transitions:t.Transitions}),i=$L("#canvasPopupDiv");i&&i.length?i.html(o):$("#pb_processPreviewLayer").html(o),(s=$("[id=pb_configProcess][entityId="+e+"]")).find(".pre_trans, .pre_trans_head, .preview_PTrans_spanElem").each((function(){$(this).hover((function(){var t=$(this),s=t.offset(),r=$("#pb_configProcess").position().left,o=s.top+t.outerHeight()+10,i=s.left,a=$("[id=pb_preview_criteria_tootip][entityId="+e+"]"),n=t.attr("relId"),l=ProcessFlow.getTransitionRelIdVstransitionDetails(e)[n];if(void 0===l){var d=t.attr("transId");l=ProcessFlow.transitionIdVsTransitionDetails[d]}if(l.Summary){var c="<div class='pR dIB'><span class='pb_topArr'></span><div class='pb_criteriaSummaryView'>"+l.Summary+"</div></div>";a.html(c);var p=$(".pb_criteriaSummaryView").find(".viewCriRow");1===p.length&&p.find(".wf_oprView").remove(),a.css({top:o,left:i-r}).show()}}),(function(){$("#pb_preview_criteria_tootip").hide()}))}))}s.find(".pb_preview").css("max-height",r),crmui.showPopup(s.attr("id"),!0);var a=$("#processPreviewTable");if(a.find(".pb_prevProcess_layer").length>1){var n=a.find("tr td:nth-child(2)"),l=$("#processPreviewTable tr td:nth-child(2)"),d=l.find(".pb_prevProcess_layer:first").outerHeight()/2,c=l.find(".pb_prevProcess_layer:last").outerHeight()/2,p=a.outerHeight()-(d+c);n.append('<span class="pbMorePreiview"></span>'),a.find("span.pbMorePreiview").css({height:p,top:d})}},ProcessFlow.saveStateChange=function(e,t,s,r){Crm.requestParamWithColname={};var o=ProcessFlow.getFieldIdVsFieldDetailsJson(e,ProcessFlow.duringFieldDetails)[s];if(o){Crm.requestParamWithColname[o.colname]=ProcessFlow.currentTransitionDetails.ToStateValue;var i=ProcessFlow.getParamsForMulitipleFieldsSave(e,t,r),a=JSON.parse(i.duringFields).ChildModuleFields;(a=ProcessFlow.changeToOldFormat(a)).module=i.module,a.moduleid=i.moduleid,a.transitionRelId=i.transitionRelId;var n="Potentials"===e&&"STAGE"===a.columnName,l="";n&&(l=o.val.filter((function(e){return e.content===a.fieldValue}))[0].pbty),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e))&&CFRExec&&CFRExec.evalAjaxEditForLayoutRule(e,a.columnName,n?l+":"+a.fieldValue:a.fieldValue,"formRuleMandatoryFields")?(a.check={type:"processFlow"},CFRExec.haltStageChange(a)):(CFRExec.haltStageChange({}),ProcessFlow.saveFields(e,i,t))}},ProcessFlow.getTransitionRelIdVstransitionDetails=function(e,t){var s={};return ProcessFlow.recordIdVsTransitionDetails[e].Transitions.each((function(e){s[e.TransitionRelId]=e})),ProcessFlow.nextTransitions.each((function(e){s[e.TransitionRelId]=e})),s},ProcessFlow.getDuringTransitionDependentFields=function(e,t){var s=$("#multipleFieldEditModule").val(),r={};r[ProcessFlow.ACTION]=ProcessFlow.GET_DEPENDENT_DURINGFIELDS,r.Module=s,r.TransitionRelId=$("#multipleFieldEditTransRelId").val(),r.EntityId=e,r.FieldId=t,networkUtils.setCsrfParam(r),commonUtils.showHideLoadingDiv(!0),crmRequestPool().initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.TRANSITION_URL,data:r,success:function(e){if(e[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&void 0!==e.FieldMeta){commonUtils.showHideLoadingDiv(!1);for(var t=$("#multipleFieldsEditPop").find(".fieldsContainer"),r=e.FieldMeta,o=r.length,i=$L("#multipleFieldsEditPop").find('[data-fieldid="'+e.LkpFieldId+'"]'),a=r.length>0&&r[0].suffixIndex&&""!==r[0].suffixIndex?r[0].suffixIndex:i.length>0?i.data("colname"):"",n=$L('div[id^="'+(s+"_fldRow_"+a+"_")+'"]'),l=n.length,d=[],c=0;c<l;c++){var p=n.eq(c).attr("id");d.contains(p)||d.push(p)}for(var u=0;u<o;u++){var m=r[u],v=ProcessFlow.constructDuringFields(s,m),g=0===$L("#"+v.id+" .newmandatory").length;ProcessFlow.OPTIONAL_FIELD_FEATURE&&g&&(m.mandate="false",m.IsNonMandatory=!0,v=ProcessFlow.constructDuringFields(s,m)),d.contains(v.id)&&d.removeFirstOccurenceOfElement(v.id);var f,P=$("#"+v.id),h=P.prev();if("SMOWNERID"===m.colname&&(f=$("#"+v.id+" .assignmentRestrictionDiv").attr("style")),P.length>0&&(P.remove(),0==h.length?t.prepend(v):h.after(v),"SMOWNERID"===m.colname)){var C="#"+v.id,w=document.createElement("div");(w=$(w)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(C).append(w);var F=C+" .assignmentRestrictionDiv";$(F).attr("style",f);var b=m.attrObj?m.attrObj.id:"",I={};I.ownerid=m.defaultid,I.moduleName=m.entityModule;var T=Lyte.Component.render("crm-threshold-grant",I,F);T.id="assRestGrant",T.classList.add("dIB",b),T.component.methods.addRestrictionMessage(T)}}d.length>0&&d.forEach((function(e){var r=$L("#"+e),o=e.split("_"),i=o.length;if(i>3){var a=$L("#Crm_"+s+"_"+o[i-2]+"_"+o[i-1]).data();if(void 0!==a){a.restricted=!0,a.suffixIndex=o[i-2],a.mandate=!1,a.readonly=!0;var n=$L("#Crm_"+s+"_"+o[2]+"_label").text();a.reasonrestrict=I18n.getMsg("crm.transition.layout.dep.nonexistent.field",n.trim());var l=ProcessFlow.constructDuringFields(s,a),d=r.prev();0==d.length?t.prepend(l):d.insertAfter(l),r[0].remove(),$L(l).addClass("nonExistentBPLayoutFld")}}})),t.find(".infotoolTip").length&&crmTemplate.bindFldTooltip();var E=t.find("select");E.length&&thirdPartyUtils.bindSelect2(E),t.find(".readonlyF").length<=0&&($("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1)),void 0!==e.Module&&""!==e.Module&&crmTemplate.setDependentFields(e.Module,"edit")}}})},ProcessFlow.constructDuringFields=function(e,t){var s={changeOwnerPermission:!0,module:e},r="false"===t.mandate&&"false"===t.isSystemMandate&&t.IsNonMandatory;"Boolean"===t.type||r?t.mandate="false":t.mandate="true";var o=void 0!==t.reasonrestrict;o?(t.reasonrestrict=$ESAPI.encoder().encodeForHTML(t.reasonrestrict),t.readonly="true"):t.readonly="false",s.callFrm="processflow";var i=crmTemplate.createFieldRow(1,e,void 0,t,s,!0);"Events"!==e&&"Calls"!==e&&"Tasks"!==e||0!==$L(i).find(".labelTabCreate").length||(s.isBPExec=!0,i=crmTemplate.createFieldRow(1,e,void 0,t,s)),void 0!==t.fieldoflookupprefix&&o&&$L(i).addClass("nonExistentBPLayoutFld");var a=$(i).find(".labelValCreate [data-colname]");return a.addClass("bp-during-field"),void 0!==t.isdependfield&&a.attr("data-dependfield",!0).attr("data-fieldid",t.fieldid),void 0!==t.suffixIndex&&a.attr("data-suffixIndex",t.suffixIndex),void 0!==t.entityModule&&a.attr("data-entityModule",t.entityModule),void 0!==t.entityId&&a.attr("data-entityId",t.entityId),void 0!==t.reasonrestrict&&a.attr("data-reasonrestrict","true"),void 0!==t.IsNonMandatory&&(a.attr("is-optional-field",r),r&&a.find(".newmandatory").removeClass("newmandatory")),"445"===t.uitype&&(a.val(a.data("selectedid")),a.addClass("bp-mxn-field")),"444"===t.uitype&&(a.data({selectedid:t.selectedid,confirmselectedid:t.confirmSelectedId,confirmunselectedid:t.confirmUnSelectedId}),a.addClass("bp-mxn-field")),"8"===t.uitype&&void 0!==t.isFieldOfLookup&&a.attr("data-isFieldOfLookup",t.isFieldOfLookup).attr("data-actionFol","Blueprint"),i},ProcessFlow.showDuringTransitionFieldsPop=function(e,t,s,r,o,i,a,n){var l=s=s||$("#id").val(),d=moduleRecordMapping[e].id;ProcessFlow.dependentFields=[];var c=t.filter((function(e){if("kiosk"===e.Type)return e}))[0];if(c){if(!ProcessFlow.isKioskExecPopupClosed)return!1;ProcessFlow.isKioskExecPopupClosed=!1;var p={kiosk:c.kiosk,transition:{id:i.TransitionId,name:i.Name},stateId:i.FromStateId,recordId:s,module:e,recordName:ProcessFlow.ExcecutionObjs.entityName,transRelId:i.TransitionRelId};return ProcessFlow.kioskCache||(ProcessFlow.kioskCache=[]),ProcessFlow.kioskCache.push(p),void($L("#awtAppRecsDIV").length>0?Lyte.registeredMixins.kiosk_execute.loadAndRenderExecuteKiosk(p.kiosk.id,"blueprint",!0,detailView.entityId?detailView.entityId:s):Lyte.registeredMixins.kiosk_execute.renderExecuteKiosk(p.kiosk.id,"blueprint",!0,detailView.entityId?detailView.entityId:s))}var u={module:e,entityId:s,transitionRelId:r,isOptionalFldEnabled:ProcessFlow.OPTIONAL_FIELD_FEATURE},m=$("#multipleFieldsEditPop"),v=m.is(":visible"),g=Handlebars.templates.MultipleFieldsEdit({data:u,SkipContainer:v}),f=$("#blueprintAttachmentContextMenu");v?m.html(g):(m.remove(),$("#show").prepend(g),m=$("#multipleFieldsEditPop"));var P=$L("#bpsaveasdraft");void 0!==ProcessFlow.ExcecutionObjs&&ProcessFlow.ExcecutionObjs.isContinuousBP&&P.length>0&&P.hide();var h,C=t.filter((function(e){if("widget"===e.Type)return e}))[0];C&&Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-blueprint-exec-mixin.js"],ResourceConstants.CRMClient)[0]],void 0,function(){Lyte.registeredMixins["crm-blueprint-exec-mixin"].showWidget(C,i,s,ProcessFlow.ExcecutionObjs.entityName,e,m,"multipleFieldsEditPop")}.bind(this)),m.removeClass("h600"),m.find(".pp-header").text(i.Name),t=ProcessFlow.restructureDuringFieldObj(t);var w=$("#assignmentRestriction"),F=$L("#assRestGrant"),b={},I=[],T=!0;t.each((function(t){var r=t.Type,o=t.tempNotes;if("Note"===r){b[r]=!0,T=!1;var a=ProcessFlow.getFieldsContainer(m),n=$(document.createElement("div"));n.attr({class:"tabDiv borderNone notesCommonClass",id:"transitionNotesDiv"});var c=$(document.createElement("div"));t.IsNonMandatory?c.addClass("tabDivCreate"):c.addClass("tabDivCreate newmandatory"),n.append(c),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("crm.label.notes")),c.append(O),(N=$(document.createElement("div"))).addClass("labelValCreate"),N.text(I18n.getMsg("crm.label.notes")),N.html("<textarea class='textField w200' maxlength='3000' id='transitionNotes' onclick=\"bindMentions(this,'transitionNotes');\"></textarea>"),c.append(N),a.append(n),(h=$("#transitionNotes")).click(),void 0!==o&&(h.val(o),Notes.tempNotes=t.noteContent)}else if("Tags"===r){b[r]=!0,T=!1;var p=o||[],v=$("crm-detailview-tag")[0];if(void 0!==v)var g=v.component.data.tagnamevscolor;var P=p.length;if(void 0!==g)for(var C=0;C<P;C++)void 0!==g[p[C].name]&&(p[C].color_code=g[p[C].name]);if(!Array.isArray(p))throw new Error("typeof tag object should be JSON Array");a=ProcessFlow.getFieldsContainer(m);var E=$(document.createElement("div"));E.attr({class:"tabDiv borderNone",id:"transitionTagsDiv"});c=$(document.createElement("div"));t.IsNonMandatory?c.addClass("tabDivCreate"):c.addClass("tabDivCreate newmandatory"),E.append(c),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("crm.label.small.tags")),c.append(O),(N=$(document.createElement("div"))).addClass("labelValCreate");var L={};L.cxPropTags=p;var _=Lyte.Component.render("crux-tag",L);_.id="tagCruxContainer",N.append(_),c.append(N),a.append(E),Lyte.resolvePromises([store.findAll("tag",{module:moduleApiMapping[e],fromPage:"view"}),store.findRecord(d,l)]).then((function(e){if(Array.isArray(e[0])){var t=[],s={};e[0].forEach((function(e){e.name&&(s[e.name]=!0,t.push({name:e.name,id:e.id,color_code:e.color_code}))}));var r=_.getData("cxPropTags");r=r.map((function(e){return s[e.name]||(e.isNewtag=!0),e}));var o=e[0].$.meta,i=store.peekRecord(d,l);if(i&&i.Tag){var a=new Set(i.Tag.map((e=>e.id)));t=t.filter((e=>!a.has(e.id)))}_.cxProp({tagOptions:t,tags:r,maxTagLimit:o.record_limit,maxOptionsLimit:o.allowed_count}),_.setMethods({onError:function(e,t){3==t.errorCode?renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",o.record_limit),"error"):2==t.errorCode&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.edition.limit.exceeded"),"error")},onBeforeAddTag:function(e){if(!CrmTags.checkCharacter(e))return _.toggle("close"),!1;var t=_.getData("cxPropTags");if(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=o.record_limit-CrmTags.clientJSON.value.length)return renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",o.record_limit),"error"),_.toggle("close"),!1;if(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=o.record_limit-CrmTags.clientJSON.value.length)return renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",o.record_limit),"error"),_.toggle("close"),!1;t=_.getData("cxPropTags");return!(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=o.record_limit-CrmTags.clientJSON.value.length)||(renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",o.record_limit),"error"),_.toggle("close"),!1)},onColorTagPaletteHide:function(e,t){var s=document.getElementById("tagCruxContainer"),r=s.component.bodyDrop.querySelector("crux-color-palette lyte-popover");t&&t.target&&!s.component.bodyDrop.contains(t.target)&&!r.component.childComp.contains(t.target)&&s.toggle("close")}})}})).catch((function(){crmui.showMsgBand("error","Error while fetching available tags",3e3,"")}))}else if("Attachment"===r){if(b[r]=!0,T=!1,f.length<1){var y=document.createElement("div"),R=$(y);R.attr("id","blueprintAttachmentContextMenu"),R.css({position:"absolute",visibility:"hidden","z-index":"10"}),m.append(R)}a=ProcessFlow.getFieldsContainer(m);var D=t.relListId,S=t.persName;Crm.userDetails.isRelatedListLyteEnabled||ProcessFlow.updateRelatedListObj(D,S);var A=$(document.createElement("div"));A.attr({class:"tabDiv borderNone",id:"transitionAttachDiv"});var O,N;c=$(document.createElement("div"));t.IsNonMandatory?c.addClass("tabDivCreate"):c.addClass("tabDivCreate newmandatory"),A.append(c),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("Attachments")),c.append(O),(N=$(document.createElement("div"))).addClass("labelValCreate attachmentsLabel"),N.text(I18n.getMsg("Attachments")),c.append(N);var M="canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName;Crm.userDetails.isRelatedListLyteEnabled&&a.append(A);var x=t.tempAttachments,U={},B=networkUtils.returnDependencyFiles("zohocrm_blueprintattachment.js",ResourceConstants.CRM);Lyte.injectResources(B,void 0,(function(){if(x)x=JSON.parse(x),BlueprintAttachment.validateFilePreview(x).then((function(e){var s=e.isPreviewAvailable;$.each(x,(function(e,t){var r=U[t.type];switch(void 0===r&&(r=$("<div>",{id:"attachmentList-"+t.type,type:t.type})),t.name="string"==typeof t.name?[t.name]:t.name,t.type){case"attachLink":t.$link_url="string"==typeof t.$link_url?[t.$link_url]:t.$link_url,(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$link_url},t.type))&&r.append(o);break;case"fileUpload":t.$file_id="string"==typeof t.$file_id?[t.$file_id]:t.$file_id,(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$file_id,isPreviewAvailable:s},t.type))&&r.append(o);break;case"attachDocuments":t.$attachDocs="string"==typeof t.$attachDocs?[t.$attachDocs]:t.$attachDocs,(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachDocs,isPreviewAvailable:s},t.type))&&r.append(o);break;case"attachZDocs":t.$attachZDocs="string"==typeof t.$attachZDocs?[t.$attachZDocs]:t.$attachZDocs,t.service="string"==typeof t.service?[t.service]:t.service,(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachZDocs,service:t.service,isPreviewAvailable:s},t.type))&&r.append(o);break;case"attachFromTeamDrive":(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachTeamDriveDocIds,linkUrls:t.teamDriveLinkUrls},t.type))&&r.append(o);break;case"attachGDocs":(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachGDocs,service:t.service,isPreviewAvailable:s,mimeTypes:t.$mimeType},t.type))&&r.append(o);break;case"attachGTDocs":var o;(o=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachGTDocs,service:t.service,isPreviewAvailable:s,mimeTypes:t.$mimeType},t.type))&&r.append(o)}U[t.type]=r}));var r=Object.values(U);if(r.length>0){if(N.removeClass("attachmentsLabel"),N.html(""),Crm.userDetails.isRelatedListLyteEnabled){var o={module:{api_name:"Attachments"},actions:t.Actions,fromBlueprint:!0,menuSelector:"#attachBlueprint",personality_name:t.persName,id:t.relListId},i=$("<div>",{id:"attachBlueprint",class:"attachmentsLabel blueprintAttachment"});c.after().append(i),$L("#awtAppRecsDIV").length>0?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-related-list-action-wrapper.js","crm-attachments.js","crm-detail-view-utils.js","crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.Component.render("crm-related-list-actions",{relatedList:o,newLyteRL:!M},"#attachBlueprint")})):Lyte.Component.render("crm-related-list-actions",{relatedList:o,newLyteRL:!M},"#attachBlueprint")}else{var a=$(ProcessFlow.getAttachDropdown(t));a.addClass("attachmentsLabel blueprintAttachment"),a.removeAttr("style"),a.css("margin","7px"),c.after().append(a.outerHTML())}BlueprintAttachment.appendClickEventForDropdown(),$.each(r,(function(e,t){N.append(t)})),N.attr("isAttachmentAdded","true")}}));else if(Crm.userDetails.isRelatedListLyteEnabled){N[0].setAttribute("id","attachBlueprint");var r={module:{api_name:"Attachments"},actions:t.Actions,fromBlueprint:!0,menuSelector:"#attachBlueprint",personality_name:t.persName,id:t.relListId,entityId:s};$L("#attachBlueprint")[0].innerHTML="",$L("#awtAppRecsDIV").length>0?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-related-list-action-wrapper.js","crm-attachments.js","crm-detail-view-utils.js","crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.Component.render("crm-related-list-actions",{relatedList:r,record:u,module:e,newLyteRL:!M},"#attachBlueprint")})):Lyte.Component.render("crm-related-list-actions",{relatedList:r,record:u,module:e,newLyteRL:!M},"#attachBlueprint")}else{var o=Handlebars.templates.personalityAction({actions:t.Actions,rid:t.relListId,name:t.persName,mailObj:t.mailObj,entityId:crmRelatedList.EntityId,moduleName:t.Module,fromSrc:"bluePrint"}),i=$(o),a=$("body"),n=i.find(".atch-droplist").clone();n.attr("id","bp-attachment"),i.find(".atch-droplist").remove(),$("#bp-attachment").hasClass("atch-droplist")||a.append(n),N.html(i)}})),Crm.userDetails.isRelatedListLyteEnabled||a.append(A)}else if("Info"===r){a=ProcessFlow.getFieldsContainer(m);b.Field=!0;var k=$(document.createElement("div"));k.addClass("textFld tabDivCreate pB5"),k.css("word-break","break-word"),k.html(t.Info),a.append(k)}else if("Field"===r){var V=t.FieldObject;void 0===V.entityModule||I.contains(V.entityModule)||I.push(V.entityModule);var j=i.ProcessFieldId===V.fieldid;j||(b[r]=!0,T=!1),j&&(V.defaultvalue=i.ToStateValue,V.default=i.ToStateValue,ProcessFlow.processConfiguredFieldColumn=V.colname);var H=ProcessFlow.constructDuringFields(e,V);a=ProcessFlow.getFieldsContainer(m,!0);if(j?$(H).hide():$("#fieldsContainer_header").removeClass("hide"),0==a.length&&!j){var W=$("#duringTabs"),G=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"fieldsContainer",id:"fieldsContainer_header"}).html($("<a>",{class:"setuplink",text:"Notes, Attachments & Fields"}));W.append(G);var q=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle fieldsContainer moduleParent",id:"fieldsContainer"});W.append(q),a=m.find("#fieldsContainer")}if("SMOWNERID"===V.colname&&F.length>0){if(V.entityModule){var J=document.createElement("div");(z=$(J)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(H).append(z)}else{var Y=w.clone();Y.addClass("assignmentRestrictionDiv dIB"),$(H).append(Y)}$(H).addClass("restrictAssignment")}if(a.append(H),"SMOWNERID"===V.colname&&0===F.length){if(V.entityModule){var z;J=document.createElement("div");(z=$(J)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(H).append(z)}else{var K="#"+H.id;J=document.createElement("div");(J=$(J)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(K).append(J);var X=K+" .assignmentRestrictionDiv",Q=V.attrObj?V.attrObj.id:"",Z={};Z.ownerid=V.defaultid,Z.moduleName=e;var ee=Lyte.Component.render("crm-threshold-grant",Z,X);ee.id="assRestGrant",ee.classList.add("dIB",Q)}$(H).addClass("restrictAssignment")}crmTab.isLinkingModule(e)&&V.colname.startsWith("LINKINGMXN")&&$(H).on("autocompleteselect",function(t,s){var r=t.target,o=s.item.seId,i=t.currentTarget.id.split("_")[2];ProcessFlow.checkDuplicateAssociation(r,o,i,e)}.bind(this))}else if("rlFields"==r){T=!1;var te=t.Module,se=Lyte.Component.registeredHelpers.getDisplayModuleName(t.Module,!1),re=t.FieldObjects,oe=(D=t.relListId,S=void 0===t.relListName?te:t.relListName,void 0===t.relListLabel?se:t.relListLabel);Crm.userDetails.isRelatedListLyteEnabled||ProcessFlow.updateRelatedListObj(D,S);G=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-mod":te,"data-tab":D+"_rlContainer",id:D+"_rlContainer_header",layoutid:t.LayoutId}).html($("<a>",{class:"setuplink",text:void 0!==t.relListLabel?oe+" - "+se:se}));$("#duringTabs").append(G);var ie="";"Calls"!==D&&"Tasks"!==D&&"Events"!==D&&(ie="newInputStyleEle");q=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content moduleParent "+ie,id:D+"_rlContainer"});$("#duringTabDivs").append(q);var ae,ne,le=$("#"+D+"_rlContainer"),de={};re.each((function(e){var t=e.FieldObject,s={changeOwnerPermission:!0,module:te,isBPExec:!0};if(t[te]&&t[te].subforms){window[te].createEditJson=t,window[te].formulaObj=new crmFormulaInit,window[te].formulaObj.resetProps(),e.defaultCurrency&&e.currencyDetails&&(window[te].currencyDetails=e.currencyDetails,window[te].defaultCurrency=e.defaultCurrency),t.module=te,t.isFrom="ProcessFlow";var r=crmTemplate.createSectionLayout(t,te);le.append(r),ne=le.find(".subformParentSection").eq(0),crmCommonModule.renderSubformInSection(le,t,!0,{relListId:D}),crmTemplate.bindFldTooltip(),ae=t}else{"false"===t.mandate&&"false"===t.isSystemMandate&&t.IsNonMandatory?(t.mandate="false",Crm.userDetails.LITE.IS_LITE_USER&&(""!==t.defaultid&&t.defaultid!==Crm.userDetails.USER_ID&&t.defaultvalue!==Crm.userDetails.DISPLAY_NAME&&""!==t.defaultvalue||(t.defaultvalue=I18n.getMsg("None"),t.defaultid=null))):t.mandate="true","SMOWNERID"!==t.colname||!Crm.userDetails.LITE.IS_LITE_USER||""!==t.defaultid&&t.defaultid!==Crm.userDetails.USER_ID&&t.defaultvalue!==Crm.userDetails.DISPLAY_NAME&&""!==t.defaultvalue||(t.defaultvalue=I18n.getMsg("None"),t.defaultid=null),t.readonly=!1,!0===e.isLookupFld&&(t.defaultid=ProcessFlow.ExcecutionObjs.entityId,t.defaultvalue=ProcessFlow.ExcecutionObjs.entityName),"Events"==te&&(Events.currentStatus="create"),s.callFrm="processflow",s.bp_type=e.Type;var o=crmTemplate.createFieldRow(1,te,void 0,t,s,!0);"PRODUCTDETAILS"==t.colname&&o.classList.add("ProductDetailsContainer");var i=$(o),a=i.find(".labelValCreate [data-colname]");if(void 0!==t.suffixIndex&&a.attr("data-suffixIndex",t.suffixIndex),"PRODUCTDETAILS"!==t.colname&&i.find(".labelTabCreate").addClass("columnCal1"),"8"===t.uitype&&void 0!==t.isFieldOfLookup&&a.attr("data-isFieldOfLookup",t.isFieldOfLookup).attr("data-actionFol","Blueprint"),"SMOWNERID"===t.colname&&t.defaultid&&F.length>0){var n=document.createElement("div"),l=$(n);l.addClass("dN pR mT7 assignmentRestrictionDiv dIB"),i.append(l),i.addClass("restrictAssignment")}if(le.append(o),"PRODUCTDETAILS"==t.colname&&Crm.isInventoryModule(te)&&productDetails.init(t,te,"blueprint",{relListId:D}),crmTab.isLinkingModule(te)&&t.colname.startsWith("LINKINGMXN")&&i.on("autocompleteselect",function(e,t){var s=e.target,r=t.item.seId,o=e.currentTarget.id.split("_")[2];ProcessFlow.checkDuplicateAssociation(s,r,o,te)}.bind(this)),"PRODUCTDETAILS"==t.colname&&t.productLineItems&&t.productLineItems.totalProductCount>0){if(le.find("#linesTbody").children().remove(),Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem){var d=t.productLineItems;d.fieldMeta=t,productDetails.setValuesForAddedRowForEdit(d,void 0,!0,{relListId:D})}else productDetails.setValuesForAddedRowForEdit(t.productLineItems,void 0,!0,{relListId:D});le.find("#productList").find(".pB20").show(),le.find("#productList").find(".pB20").find(".wrap").show(),le.find("#addLinesBtnLwr").hide()}!0===e.isLookupFld&&i.hide(),void 0!==t.IsNonMandatory&&i.attr("is-optional-field",t.IsNonMandatory),de[t.colname]=t}})),ae&&(Object.assign(ae.entityMapJson,de),crmTemplate.contentLoaded(ae,te,le),crmTemplate.bindSubformScrollEvent(),ProcessFlow.designSubforForBPLayout(ne))}else if("checkList"===r){T=!1;var ce=t.CheckLists;void 0!==ce.title&&""!==ce.title||(ce.title=I18n.getMsg("crm.untitled.default.label")),t.TransitionRelId;var pe=ce.items;if(0===m.find("#checkListContainer_header").length){var ue=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"checkListContainer",id:"checkListContainer_header"}).html($("<a>",{class:"setuplink",text:I18n.getMsg("crm.process.during.checklist")}));$("#duringTabs").append(ue);var me=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle moduleParent mL20",id:"checkListContainer"});me.append($("<h3>",{class:"m0 mB20 crm-heading-font-size pR",id:"checkListsTitle"}).text(ce.title)),me.append($("<ul>",{class:"bp_checkListConfig crm-font-regular crm-base-font-size mL10"}));var ve=$("<div>",{class:"crm-base-font-size crm-font-regular mT15",id:"cl_completed_div"});ve.append($("<span>",{id:"cl_completed"}).text("0")),ve.append(" / "),ve.append($("<span>",{id:"cl_total"}).text(pe.length)),ve.append(" "),ve.append(I18n.getMsg("Completed")),me.append(ve),$("#duringTabDivs").append(me)}var ge=$("#checkListContainer"),fe=ge.find(".bp_checkListConfig"),Pe=!0;pe.each((function(e){var t=objectUtils.getKeys(e),s="$optional"===t[0]?t[1]:t[0],r=e[s],o=e.$optional,i=$("<li>",{value:s});Pe&&(i.addClass("pT0"),Pe=!1);var a=$("<label>",{class:"newCustomchkbox-md"});if(void 0!==o&&ProcessFlow.OPTIONAL_FIELD_FEATURE&&!o&&a.addClass("bp_checkListConfigMandatory"),a.append($("<input>",{type:"checkbox",onclick:"ProcessFlow.handleChkListClick(this)",checked:r})),a.append($("<span>",{class:"vaM chkbxIcon"})),a.append($("<span>",{class:"dIF vaT mL8 cLC "+(r?"strikeT":"")}).text(s)),i.append(a),fe.append(i),r){var n=ge.find("#cl_completed").eq(0);n.text(parseInt(n.text().trim())+1)}}))}})),ProcessFlow.OPTIONAL_FIELD_FEATURE&&T&&P.hide();var E=$L("#checkListContainer");if(E.length>0&&ProcessFlow.OPTIONAL_FIELD_FEATURE){var L=E.find(".bp_checkListConfig").children().length,_=E.find(".bp_checkListConfigMandatory");L===_.length&&(_.removeClass("bp_checkListConfigMandatory"),$L("#checkListsTitle").addClass("checkListsTitleMandatory"))}var y=objectUtils.getKeys(b),R=y.length,D="",S=m.find(".fieldsContainer");if(ProcessFlow.OPTIONAL_FIELD_FEATURE){for(var A=0;A<R;A++)"Field"!==y[A]&&"Info"!==y[A]||-1!==D.indexOf("Fields")?"Attachment"===y[A]?D+=I18n.getMsg("crm.chat.attachments"):"Tags"===y[A]?D+=I18n.getMsg("crm.transition.action.tags.label"):"Note"===y[A]&&(D+=I18n.getMsg("crm.label.notes")):D+=I18n.getMsg("crm.label.searchable"),A===R-2?D=D+", "+I18n.getMsg("crm.label.lowercase.and")+" ":D+=A===R-1?"":", ";$L("#fieldsContainer_header .setuplink").text(D)}if(S.append($L('<div class="bpLayoutRuleFlds crm-base-font-size contHeadInfo crmBaseColor sum crm-font-bold pB25 hide"></div>')),S.append($L('<div class="crm-subheading-font-size contHeadInfo crmBaseColor sum crm-font-bold p0 bpLayoutRuleFldsContainer hide"></div>')),S.append($L('<div class="bpLRSectionContainer"></div>')),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e))&&CFRExec&&CFRExec.holdFormRule()){CFRExec.handleChangeEventForFREval(m);var O=$("#fieldsContainer_header");t.each((function(t){if("Field"===t.Type){var s=t.FieldObject;if(CFRExec.valChangesNeedsLayoutRuleEval(s.colname)){var r=s.defaultvalue,o=i.ProcessFieldId===s.fieldid;o&&(r=i.ToStateValue);var a="Potentials"===e&&"STAGE"===s.colname,n="";a&&(n=s.val.filter((function(e){return e.content===temp.fieldValue}))[0].pbty),CFRExec.evalAjaxEditForLayoutRule(e,s.colname,a?n+":"+r:r)&&o&&O.removeClass("hide")}}})),ProcessFlow.OPTIONAL_FIELD_FEATURE&&void 0!==CFRExec.LayoutRuleConditionInvolvedElem&&CFRExec.LayoutRuleConditionInvolvedElem.length>0&&(CFRExec.promptIfMandatory=!0,CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0))}if(ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===R&&(m.find(".bpLayoutRuleFldsContainer").children().length>0||m.find(".bpLRSectionContainer").children().length)){var N=$L("#fieldsContainer_header");N.find(".setuplink").text(I18n.getMsg("crm.label.searchable")),N.removeClass("hide")}m.find(".infotoolTip").length&&crmTemplate.bindFldTooltip();var M=m.find("select");M.length&&thirdPartyUtils.bindSelect2(M);var x=ProcessFlow.getDuringTabtotalbWidth();if(x>900&&$("#multipleFieldsEditPop").removeClass("w980").addClass("w89_per"),$("#duringTabs").css("width",x),o&&o.length>0){var U=$("<div class='p20' align='center' id='transitionBtnLayer'/>"),B=0;o.each((function(e){if(!e.IsAutoTrans&&e.IsAccessible){var t=e.IsCriteriaMatched?"pb_transitionState dIB primarybtn lyteSm":"pb_transitionState dIB primarybtn lyteSm bpTransDisable",s=e.TransitionDefaultColor&&"#transparent"!==e.TransitionDefaultColor&&"transparent"!==e.TransitionDefaultColor?e.TransitionDefaultColor:void 0,r="",o="",i="",a="",n="";if(s&&"#2385ef"!==s){o='onmouseover=ProcessFlow.onHoverBgChange(this,"'+s+'");',r="onmouseout=ProcessFlow.onHoverBgRemove(this,'"+s+"','"+e.ButtonTextColorCode+"')",i='onmouseup=ProcessFlow.onHoverBgRemove(this,"'+s+'");',a='onmousedown=ProcessFlow.onDownBgChange(this,"'+s+'")';var l=e.ButtonBorderColorCode?e.ButtonBorderColorCode:void 0;n=' data-colorcode="'+e.TransitionDefaultColor+'"style="'+(l?"border:1px"+l+" solid;":"")+" background:transparent linear-gradient(0deg,"+e.ButtonBgColorCode+" 0%, "+e.TransitionColorCode+" 100%);color:"+e.ButtonTextColorCode+";box-shadow: inset 0px -2px 0px "+e.ButtonShadowColorCode+';"'}var d="<input "+n+" "+o+" "+r+" "+i+" "+a+' data-zcqa="doTransition_'+$ESAPI.encoder().encodeForHTMLAttribute(e.TransitionName)+'" type="button" class="'+t+'" onclick="ProcessFlow.interceptSaveMulitipleFieldsEdit(\''+$ESAPI.encoder().encodeForJavaScript(e.TransitionRelId)+'\')" value="'+$ESAPI.encoder().encodeForHTMLAttribute(e.TransitionName)+'"/>';U.append(d),e.IsCriteriaMatched&&B++}})),B>0&&(m.append(U),m.find(".pp-footer").hide())}ProcessFlow.bpRelatedListTab($("#duringTabs").find("li:not(.hide)")[0]);var k=$(".fieldsContainer .labelValCreate input,.fieldsContainer .labelValCreate textarea").eq(0);if(void 0!==k){var V=k.attr("data-uitype");void 0!==V&&"1"!=V&&"110"!=V||k.addClass("focusEleField").focus()}v||crmui.showPopup("multipleFieldsEditPop",!0),crmTemplate.setDependentFields(e,"edit"),I.forEach((function(e){crmTemplate.setDependentFields(e,"edit")}));var j=-1,H=-1,W=-1;for(var G in t)if(t.hasOwnProperty(G)){var q=t[G];q.FieldId==Crm.userDetails.isMultiPipelineActivated?j=G:null!=q.FieldObject&&q.FieldObject.uitype==CrmField.UITYPES.STAGE&&(H=G)}for(var A in n)n.hasOwnProperty(A)&&n[A].FieldId==Crm.userDetails.isMultiPipelineActivated&&(W=A);var J=[],Y=t.length;if(Crm.userDetails.isMultiPipelineActivated&&-1==H)for(var z=0;z<Y;z++)if("rlFields"===t[z].Type){for(var K=(J=t[z].FieldObjects).length,X=0;X<K&&!(j>-1&&H>-1);X++)j=J[X].FieldId===Crm.userDetails.isMultiPipelineActivated?X:j,H=J[X].FieldObject.uitype===CrmField.UITYPES.STAGE.toString()?X:H;H=j>-1?H:-1;break}if(j>-1&&H>-1){var Q=$(document),Z=(le=(oe=J.length?J[j]:t[j]).FieldObject).default[0].html,ee=J.length?oe.Module:e,te=le.suffixIndex&&"Tasks"!=e&&"Calls"!=e&&"Events"!=e?ee+"_"+le.suffixIndex:ee,se=document.getElementById(le.attrObj.id);Crm.setDependentValuesByParentNameValue(te,le.colname,Z,Q,a,se)}else if(H>-1&&W>-1){Q=$(document);var re=t[H];if(i.ProcessFieldId!=re.FieldId){var oe,ie=re.FieldObject,ae=ie.suffixIndex&&"Tasks"!=e&&"Calls"!=e&&"Events"!=e?e+"_"+ie.suffixIndex:e,ne=ie.parentcolname,le=(oe=n[W]).FieldObject;Crm.setDependentValuesByParentNameValue(ae,ne,le.defaultvalue,Q)}}},ProcessFlow.designSubforForBPLayout=function(e){e.removeClass("pL30 pR30"),e.find(".contHeadInfo").removeClass("contHeadInfo"),e.find(".subFrmAggTablWrapper").css({"max-width":"100%",width:"100%"}),e.find(".subFrmTablWrapper").addClass("leftFixedSubFrmDisp")},ProcessFlow.restructureDuringFieldObj=function(e){for(var t={},s=-1,r=e.length,o=0;o<r;o++)if(e[o].FieldId===Crm.userDetails.isMultiPipelineActivated){s=o;break}if(s>-1){var i=e[s].FieldObject;Array.isArray(i.picklistmap)&&!i.picklistmap.some((function(e){return e.uservalue===i.defaultvalue}))?i.defaultvalue=i.picklistmap[0].uservalue:i.picklistmap.uservalue&&i.defaultvalue!=i.picklistmap.uservalue&&(i.defaultvalue=i.picklistmap.uservalue)}if(s>-1&&!e.some((function(e){return e.FieldObject&&e.FieldObject.uitype==CrmField.UITYPES.STAGE}))){var a=JSON.parse($("#mouseArea__STAGE").attr("data-params")),n={FieldId:a.fieldid,ModLabel:Crm.moduleInfo.Potentials.apiname,Module:a.module,Type:"Field",FieldObject:a};e.splice(s+1,0,n)}r=e.length;var l=[];for(o=0;o<r;o++){var d=e.splice(0,1)[0];"rlFields"===d.Type?(void 0===t[d.FieldObject.relListId]&&(t[d.FieldObject.relListId]=[],l[l.length]=void 0),t[d.FieldObject.relListId].push(d)):l.push(d)}var c=0,p=l.length;for(var u in t){var m=t[u],v={Type:"rlFields"};v.Module=m[0].Module,v.ModLabel=m[0].ModLabel,v.FieldObjects=m,v.LayoutId=m[0].FieldObject.LayoutId,v.relListId=u,v.relListName=m[0].FieldObject.persName,v.relListLabel=m[0].FieldObject.relListLabel;var g=!1;for(o=c;o<p;o++)if(void 0===l[o]){l[o]=v,c=o,g=!0;break}g||l.push(v)}return l},ProcessFlow.getParamsForMulitipleFieldsSave=function(e,t,s){var r={};r.module=e||$("#multipleFieldEditModule").val(),r.moduleid=t||$("#multipleFieldEditEntityId").val(),r.transitionRelId=s||$("#multipleFieldEditTransRelId").val();var o={},i={};for(var a in Crm.requestParamWithColname){var n=Crm.requestParamWithColname[a];if(a.indexOf("_")>-1){var l={value:n},d=a.split("_")[1];if(-1!=$.inArray(d,Crm.requestParamWithColname))var c=$("#Crm_"+r.module+"_"+d).data();else c=$("#mouseArea__"+d).data().params;l.id=void 0!==c.id?c.id:c.defaultid,l.lookupmodule=c.lookupmodule,i[a]=l}else o[a]=n}var p={ChildModuleFields:o,ParentModuleFields:i};return CFRExec&&Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e)&&(p.lrMandatoryFields=CFRExec.lrMandatoryElem),r.duringFields=JSON.stringify(p),r},ProcessFlow.saveFields=function(e,t,s,r,o){$L(".errorFieldP").removeClass("errorFieldP");for(var i=$L(".errMsg"),a=i.length,n=0;n<a;n++)i[n].remove();$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").addClass("eventNone"),$("#multipleFieldEditSaveBtn").prop("disabled",!0),ProcessFlow.OPTIONAL_FIELD_FEATURE&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!0),t.hasMXNField=$("#multipleFieldsEditPop .bp-mxn-field").length>0,t[ProcessFlow.ACTION]=ProcessFlow.TRANSITION_FIELD_UPDATE,commonUtils.showHideLoadingDiv(!0),networkUtils.setCsrfParam(t),detailView.isWFExecInKafka=!1,detailView.refreshInWms=!1,(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.TRANSITION_URL,data:t,success:function(t){if(t.isSubordinateListingError&&t.api_name){var i=moduleRecordMapping[e].fields.filter((e=>e.api_name===t.api_name))[0];commonUtils.showErrorMsg(I18n.getMsg("crm.record.creation.userlookup.alert.manage.subordinate.user"),$L("#cruxcomponent_Crm_"+e+"_"+i.column_name)),$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1)}else if(t[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS){isWFKafkaUser()&&(detailView.isWFExecInKafka=t.isWFExecInKafka,detailView.refreshInWms=t.callWMS,detailView.prevModule=t.module),$("#bp-attachment").remove(),ProcessFlow.destroyUploaderObj(),ProcessFlow.removeMultiUserDropdown(),commonUtils.showHideLoadingDiv(!1);var a=$("#duringTabDivs").find(".activitesColor"),n=t.IsTransitionCompleted;if(a.length>0){var l=a.css("background-color"),d=$("#detailView_"+s).find(".activitesColor");d.length>0?d.css("background-color",l):$("#cvlist_"+s).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+s+'" style="background: '+Events.rgbtohex(l)+'"></span>')}if(CFRExec&&CFRExec.relatedEntityMap&&($("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone"),CFRExec.relatedEntityMap={}),r){var c=t.DuringFields;commonUtils.showHideLoadingDiv(),ProcessFlow.currentTransitionDetails=t.Transition;for(var p=t.NextTransitions?t.NextTransitions:[],u=!1,m=p.length,v=[],g=0;g<m;g++)p[g].IsCriteriaMatched&&v.push(p[g]),u=u||p[g].IsCriteriaMatched;ProcessFlow.nextTransitions=ProcessFlow.nextTransitions.concat(v),ProcessFlow.duringFieldDetails=c,c.length>1||u?ProcessFlow.showDuringTransitionFieldsPop(e,c,s,r,v,t.Transition):ProcessFlow.saveStateChange(e,s,ProcessFlow.currentTransitionDetails.ProcessFieldId,r)}else ProcessFlow.postTransitionAction(e,s,o,n)}else if("FILTER_CRITERIA_NOT_SATISFIED"===t.Status){var f=[];ProcessFlow.getAllRelatedModulesInDuringTrans(f);var P=$("#Crm_"+t.data.MODULE+"_"+f[0].relId+"_"+t.data.COLUMNNAME);if(0!==P.length){var h=t.data.SINGULARTABLABEL;commonUtils.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",h),P,t.MODULE,!0)}else renderingUtils.showMsgBox(I18n.getMsg("crm.lookupfilter.migration.criteria.error",t.data.FIELDLABEL),"error")}else if("DUPLICATE"===t.Error){$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");var C=t.UNIQFIELD_DETAILS,w=C.length;if(C&&w>0)for(g=0;g<w;g++){var F=C[g],b=crmTemplate.getElemIdByColname(e,F.COLUMNNAME),I=commonUtils.getDuplicateErrorMsg(F,!1,!0);commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTMLAttribute(I),$("#"+b),e,!0)}}else if("Tags"===objectUtils.getValueFromObj(t,["Error","api_name"])||"tag_names"===objectUtils.getValueFromObj(t,["Error","api_name"]))"Tags"===objectUtils.getValueFromObj(t,["Error","api_name"])?renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",t.Error.limit),"error"):0===objectUtils.getValueFromObj(t,["Error","available_limit"])?renderingUtils.showAlertMsg(I18n.getMsg("blueprint.parallel.tag.limit.reached.msg",t.Error.limit),"error"):renderingUtils.showAlertMsg(I18n.getMsg("blueprint.parallel.tag.limit.msg",[t.Error.available_limit,t.Error.limit-t.Error.available_limit]),"error"),$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");else if("Attachments"===objectUtils.getValueFromObj(t,["Error","api_name"])){var T=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloudpickersupport")],ResourceConstants.CRM);Lyte.injectResources(T,void 0,(function(){var s=$("#transitionAttachDiv .labelValCreate");commonUtils.showErrorMsg(I18n.getMsg("crm.process.unauthorised.attachment",objectUtils.getValueFromObj(t,["Error","service"])),s.children(),e,!0),$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone")}))}else if("RECORD_LOCKED"===t.Error)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.record.locking.permission.denied"),ltPropType:"error",ltPropDuration:"4000"}});else if("storage space exceeds"===t.Error)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.fileuploader.entityattachments.message.507"),ltPropType:"error",ltPropDuration:"5000"}}),$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");else if("MyFolder storage exceeds"===t.Error)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.workdrive.file.attach.insufficient.myfolder.storage.admin"),ltPropType:"error",ltPropDuration:"5000"}}),$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");else if("File Name or parameter contains delimiter"===t.Error){var E=function(){$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone")};_cruxUtils.showCustomAlert({params:{ltPropSecondaryMessage:I18n.getMsg("crm.attachment.name.check"),ltPropWrapperClass:"zcpq_cruxCustomAlertAlign",ltPropAllowMultiple:!0},accept:E,close:E})}else ProcessFlow.showFieldValidationErrors(e,t.FiledsValdation);commonUtils.showHideLoadingDiv()}}),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.setCurrentStageSetOnChange()},ProcessFlow.refreshButtonLayer=function(e,t,s,r,o,i){var a={};a[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,a.module=e,a.entityId=t,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:a,success:function(a){$("[id=pb_configProcess][entityId="+t+"]").remove();var n=!1;if("canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName){var l=Lyte.registeredMixins["crm-detailcanvas-utils"],d=l.showStage,c=l.isBluePrintTrans,p=!!Lyte.Router.getRouteInstance().currentModel&&(Lyte.Router.getRouteInstance().currentModel.record&&Lyte.Router.getRouteInstance().currentModel.record.$process_flow);"Potentials"!==e||d||c||!p||(n=!0)}if(void 0!==a.NextTransitions&&a.NextTransitions.Transitions.length>0){ProcessFlow.recordIdVsTransitionDetails[t]=a.NextTransitions;var u=ProcessFlow.getBlueprintButtonLayerDetails(a.NextTransitions,t);if(u.orchestrations=s,u.pathfinders=r,s&&s.length&&(u.isbothactive=!0),o&&(u.isIntercepted=!0),!n||"canvas"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().parent.routeName){var m,v=Handlebars.templates.TransitionButtonLayer(u),g=!1;if(i)(F=i.querySelector(".crm-blueprint-lyte-comp"))&&($(F).html(v),g=!0);!g&&$("#pb_processButtonLayer").html(v),$("#InnerTransDivider .ptContainer").each((function(){var e=$(this);m=Math.round(e.outerWidth())-18,e.find(".ptButton").css("max-width",m)})),u.IsCriteriaTransEnabled&&(ProcessFlow.initBlueprintLyteHoverCard(!1,"InnerTransDivider","bp_hoverCardDiv",!1),ProcessFlow.setMouseEventForDisabledTransitions())}else ProcessFlow.getClientPortalStatus(u.CurrentStateDisplayValue);if("canvas"==Lyte.Router.getRouteInstance().routeName&&"Potentials"==e){var f=$("#pb_processButtonLayer").closest(".zc-list-component").find(".zcanvas-title-editor").find(".zcstatictext");if(!clientPortalName&&f[0]&&f[0].innerText==I18n.getMsg("Stage")){f[0].innerText=I18n.getMsg("crm.label.cf.blueprint");var P=$(f[0]).closest(".zc-tab-content")[0],h=P?P.id:void 0;if(h){var C=$(".tab[data-tab=#"+h+"]")[0];C&&C.innerText==I18n.getMsg("Stage")&&(C.innerText=I18n.getMsg("crm.label.cf.blueprint"))}}}"canvas"===Lyte.Router.getRouteInstance().routeName&&(Lyte.registeredMixins["crm-detailcanvas-utils"].blueprintFldId=a.NextTransitions.ProcessFieldId)}else if("canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName||i)if(n&&void 0!==a.NextTransitions)ProcessFlow.getClientPortalStatus(a.NextTransitions.CurrentStateDisplayValue);else{var w=document.createElement("div");w.append(I18n.getMsg("crm.canvas.blueprint.empty")),w.classList.add("emptyBlueprintMessage");var F,b=$("#previewcanvas #pb_processButtonLayer"),I=b.length?b:$("#pb_processButtonLayer");if(i)(F=i.querySelector(".crm-blueprint-lyte-comp"))&&(I=$(F));I.length>0&&0===I[0].children.length&&I[0].append(w),I.addClass("rl_NoRec")}else $("#pb_processButtonLayer").remove();var T=Lyte.registeredMixins["crm-detailcanvas-utils"];T&&T.onSpecialCompLoaded(["stage_navigator","blueprint"]),ProcessFlow.canvasAfterTransObj&&!0===ProcessFlow.canvasAfterTransObj.isTransCompleted&&ProcessFlow.canvasAfterTransObj.argresultsobj&&CScript.Engine.Global.dispatchEvent("afterTransition",void 0,ProcessFlow.canvasAfterTransObj.argresultsobj),ProcessFlow.canvasAfterTransObj={}},error:function(){if("canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName){var e=document.createElement("div");e.append(I18n.getMsg("crm.canvas.blueprint.empty")),e.classList.add("emptyBlueprintMessage");var t=$("#previewcanvas #pb_processButtonLayer"),s=t.length?t:$("#pb_processButtonLayer");s.length>0&&0===s[0].children.length&&s[0].append(e),s.addClass("rl_NoRec")}}})},ProcessFlow.getFieldElemIds=function(e,t){var s={};t.find(".labelValCreate [data-colname]").each((function(t,r){var o=$(r),i=o.attr("id");if($.inArray(i,e)>-1||"Crm_Calls_CALLDURATION_Mins"==i||"Crm_Calls_CALLDURATION_Secs"==i){var a=o.data("suffixindex");if(void 0===o.data("reasonrestrict")||ProcessFlow.OPTIONAL_FIELD_FEATURE){void 0===a&&(a="childField");var n=[];s.hasOwnProperty(a)&&(n=s[a]),n.push(i),s[a]=n}}}));var r=t.find(".PRODUCTDETAILS").length;$.each(e,(function(e,t){if(t.endsWith("_PRODUCTDETAILS")){var o=t.split("_")[2];if(r>0){var i=[];return s.hasOwnProperty(o)&&(i=s[o]),i.push(t),s[o]=i,!1}}}));var o=t.find(".subFrmAggTablWrapper");if(o.length>0){var i=t.find(".subFrmTablWrapper table").attr("rellistid");o.find("input").each((function(){var t=$(this).attr("id");if($.inArray(t,e)>-1){var r=[];s.hasOwnProperty(i)&&(r=s[i]),r.push(t),s[i]=r}}))}return s},ProcessFlow.removeNoteMandatory=function(){var e=$("#transitionNotesDiv"),t=e.find(".newmandatory");e.find(".errMsg").remove(),t.removeClass("errorFieldP")},ProcessFlow.removeNoteMandatory=function(){ProcessFlow.removeMandatoryErrIndicator($("#transitionNotesDiv"))},ProcessFlow.removeAttachMandatory=function(){ProcessFlow.removeMandatoryErrIndicator($("#transitionAttachDiv"))},ProcessFlow.removeTagsMandatory=function(){ProcessFlow.removeMandatoryErrIndicator($("#transitionTagsDiv"))},ProcessFlow.removeMandatoryErrIndicator=function(e){var t=e.find(".newmandatory");e.find(".errMsg").remove(),t.removeClass("errorFieldP")},ProcessFlow.interceptSaveMulitipleFieldsEdit=async function(e,t){if(CScriptLib&&("undefined"!=typeof DetailViewHandler||"undefined"!=typeof CanvasDetailPageHandler)&&(!$L("crm-detailview-canvas").length||Crm.userDetails.CANVAS_BP_MANDATORY_CSCRIPT)){const s={};$("#multipleFieldsEditPop").find("[cscript-tag]").each(((e,t)=>{var r=$(t).attr("cscript-tag");r.startsWith("__")||(s[r]=DetailViewHandler.mandatory_form_read(r))}));return!0===await CScript.Engine.Global.dispatchIEvent("onBeforeMandatoryFormSave",void 0,s)&&ProcessFlow.saveMulitipleFieldsEdit(e,t)}return ProcessFlow.saveMulitipleFieldsEdit(e,t)},ProcessFlow.saveMulitipleFieldsEdit=function(e,t){var s,r=$("#multipleFieldsEditPop"),o=r.find(".fieldsContainer"),i=$("#multipleFieldEditModule").val(),a=$("#multipleFieldEditEntityId").val(),n=o.find(".labelValCreate div[id^='Crm_'],:input[id^='Crm_'],crm-user-wrapper[id^='Crm_'],crux-text-area-component[id^='Crm_'],crm-richtext-component[id^='Crm']").not("input[id$='_TimeOption']"),l=!1,d=!0,c=ProcessFlow.isAllFldsEmpty(i),p=!(!ProcessFlow.ExcecutionObjs.isContinuousBP&&!e),u=o.find(".LR").length>0,m=ProcessFlow.isPartialSaveDisabled,v=[],g=n.length;for(ie=0;ie<g;ie++)v.push($(n[ie]).attr("id"));var f=ProcessFlow.mandatoryUnfilledFieldsExist(v,i,p);if(s=ProcessFlow.OPTIONAL_FIELD_FEATURE?(void 0===t||!t)&&(f||u||p):c||p||u,d){var P=ProcessFlow.getFieldElemIds(v,$("#fieldsContainer")),h={};for(var C in P)if(P.hasOwnProperty(C)&&(P[C]=ProcessFlow.removeOptionalUnfilledFlds(P[C],i),d=d&&Crm.validateEntityAndShowErrorMsg(P[C],i,!0,void 0,!s),h[C]=Crm.requestParamWithColname,crmTab.isLinkingModule(i)))for(var w=P[C].length,F=0;F<w;F++){if((V=$("#"+P[C][F])).data("colname").startsWith("LINKINGMXN")&&V.data("isMXNDuplicate"))return commonUtils.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),V,i,!0),!1}}var b=[];ProcessFlow.getAllRelatedModulesInDuringTrans(b);for(var I=b.length,T={},E={},L=$("#Crm_Calls_CALLSTARTDATETIME"),_=$("#Crm_Calls_CALLDURATION_Mins"),y=$("#Crm_Calls_CALLDURATION_Secs"),R=$("#Calls_rlContainer_header"),D=$("#Crm_Calls_CALLSTARTDATETIME_label"),S=$("#Crm_Calls_CALLDURATION_label"),A=D.closest(".tabDivCreate"),O=0;O<I;O++){var N=b[O],M=N.relId,x=N.module;E[M]=x;v=Crm.fieldsObj[x];var U=ProcessFlow.getFieldElemIds(v,$("#"+M+"_rlContainer"));for(var C in U)if(U.hasOwnProperty(C)){var B={isContinuous:!!e,relListId:M,fieldsArr:U[C],isFrmBP:!0};U[C]=ProcessFlow.removeOptionalUnfilledFlds(U[C],x);var k=Crm.validateEntityAndShowErrorMsg(U[C],x,!0,void 0,!s,B);if(d=d&&k,"Calls"===x){if(-1!==U[C].indexOf("Crm_Calls_CALLSTARTDATETIME")&&-1===Object.keys(Crm.requestParamWithColname).indexOf("CALLSTARTDATETIME")&&void 0!==L)return void 0!==R&&void 0!==R.data("tab")&&ProcessFlow.bpRelatedListTabSwitch(R.data("tab")),A.addClass("labelValTwo"),commonUtils.showErrorMsg(I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(L.data("displaylabel"))),D,"Calls",!0),!1;if(-1!==U[C].indexOf("Crm_Calls_CALLDURATION_Mins")&&-1===Object.keys(Crm.requestParamWithColname).indexOf("Crm_Calls_CALLDURATION_Mins")&&"--"===_[0].value||-1!==U[C].indexOf("Crm_Calls_CALLDURATION_Secs")&&-1===Object.keys(Crm.requestParamWithColname).indexOf("Crm_Calls_CALLDURATION_Secs")&&"--"===y[0].value)return void 0!==R&&void 0!==R.data("tab")&&ProcessFlow.bpRelatedListTabSwitch(R.data("tab")),A.addClass("labelValTwo"),"--"===_[0].value?commonUtils.showErrorMsg(I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(_[0].dataset.displaylabel)),S,"Calls",!0):commonUtils.showErrorMsg(I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(y[0].dataset.displaylabel)),S,"Calls",!0),!1}if(crmTab.isLinkingModule(x))for(w=U[C].length,F=0;F<w;F++){var V;if((V=$("#"+U[C][F])).data("colname").startsWith("LINKINGMXN")&&V.data("isMXNDuplicate"))return commonUtils.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),V,x,!0),!1}T[C]=Crm.requestParamWithColname;var j=crmTab.tabVsSubTabs[x],H=!0,W=!1;if(j&&j.length>0){for(var G=j.length,q=0;q<G;q++)H=H&&B[j[q]].resultObj.mandateFailed,W=W||B[j[q]].resultObj.maxRowlimitFailed;if(!(Object.keys(T[C]).length>0)&&H||W)for(q=0;q<G;q++){if((Y=$("#subform_"+j[q])).attr("rellistid")===C){var J=Y.data("dataSubformsectionlabel").replace(" ","_");J="secHead_"+J,Crm.showErrorMessage(B[j[q]].resultObj,$("#"+J),i,Y.data("dataColumnname"),Y.data("dataSubformsectionlabel"),Y.data())}}else for(var q=0;q<G;q++){var Y;if((Y=$("#subform_"+j[q])).attr("rellistid")===C){var z=Y.find("tbody tr").closest("table").data("data-columnname"),K=T[C];K[z]=Crm.requestParam["property("+z+")"];var X=B[j[q]].aggFldObj;for(var Q in X)K[Q]=X[Q]}}}Crm.isInventoryModule(x)&&Crm.userDetails.IS_MULTI_CURRENCY_ENABLED&&C===M&&!T[C].CURRENCYISOCODE&&window[x].defaultCurrency&&(T[C].CURRENCYISOCODE=window[x].defaultCurrency)}}var Z=$("#transitionNotes"),ee=void 0;if(Z.length>0){ee=$("textarea[id='transitionNotes']").val().trim();try{Notes.tempNotes&&(Notes.tempNotes=Notes.tempNotes.trim()),Notes.transNoteContent?ee=Notes.transNoteContent:Notes.tempNotes&&ee&&(ee=Notes.tempNotes)}catch(e){}s&&((!ee||ee.length<=0)&&$L("#transitionNotesDiv").find(".tabDivCreate").hasClass("newmandatory")?(commonUtils.showErrorMsg(I18n.getMsg("crm.process.notes.not.empty"),Z,i,!0),l=!0,d=!1):ProcessFlow.removeNoteMandatory()),ee.length>3e3?(commonUtils.showErrorMsg(I18n.getMsg("crm.process.notes.limit.error"),Z,i,!0),l=!0,d=!1):ee.length>0&&ProcessFlow.removeNoteMandatory()}var te=$("#transitionAttachDiv .labelValCreate"),se=void 0!==te[0]?$(te[0]):void 0;void 0!==se&&(s&&"true"!==se.attr("isAttachmentAdded")&&$L("#transitionAttachDiv").find(".tabDivCreate").hasClass("newmandatory")?(commonUtils.showErrorMsg(I18n.getMsg("crm.process.empty.attachment"),te.children(),i,!0),l=!0,d=!1):ProcessFlow.removeAttachMandatory());var re=document.querySelector("#transitionTagsDiv crux-tag");if(re&&(s&&0===re.component.getData("cxPropTags").length&&$L("#transitionTagsDiv").find(".tabDivCreate").hasClass("newmandatory")?(commonUtils.showErrorMsg(I18n.getMsg("crm.tag.not.empty"),$(re),i,!0),l=!0,d=!1):ProcessFlow.removeTagsMandatory()),s){var oe=$L("#checkListContainer").find(".checkListsTitleMandatory").length>0;$.each($("#checkListContainer .bp_checkListConfig li"),(function(e,t){var s=$(t),r=!s.find("input").eq(0).is(":checked");if(r&&s.find(".bp_checkListConfigMandatory").length>0||oe&&r)return!1}));var ie=0;I=(_e=ProcessFlow.getCheckListDet()).length;if(ProcessFlow.OPTIONAL_FIELD_FEATURE&&(ie=I),I>0){var ae=!0;if(ProcessFlow.OPTIONAL_FIELD_FEATURE){ae=!1;for(var ne=0;ne<I;ne++){!1===(le=_e[ne])[Object.keys(le)[0]]&&!1===le.$optional&&(ae=!0,ie-=1)}}else for(ne=0;ne<I;ne++){var le;!0===(le=_e[ne])[Object.keys(le)[0]]&&(ae=!1,ie+=1)}(p||m)&&ie!==I&&(ae=!0);$("#duringTabDivs #checkListContainer .errMsg");if(s&&ae&&ae&&!l&&(ProcessFlow.bpRelatedListTabSwitch("checkListContainer"),$("#checkListContainer").hasClass("current")))return crmui.showMsgBand("alert",I18n.getMsg("crm.process.checklist.not.empty"),2e3,r),!1;d=d&&!ae}}if(l&&(d=!1),!d)return setTimeout((function(){var e=$("#duringTabDivs"),t=e.find(".errMsg.errorMsgDesc");0===t.length&&(t=e.find("#addLinesBtnLwr .errMsg")),t=0===t.length||l?"fieldsContainer":t.eq(0).parents(".moduleParent").attr("id"),$("ul.bpRLcommentabmenu li").removeClass("sel"),$(".bpRl-tab-content").removeClass("current"),$("#"+t+"_header").addClass("sel"),$("#"+t).addClass("current")}),500),!1;var de={};de.module=i,de.moduleid=a,de.transitionRelId=$("#multipleFieldEditTransRelId").val();var ce={},pe={};for(var ue in h)if(h.hasOwnProperty(ue)){var me=h[ue];for(var ve in me)if(me.hasOwnProperty(ve)){var ge=me[ve];if("STAGE"===ve&&-1!==ge.indexOf(":")&&(ge=ge.substring(ge.indexOf(":")+1)),"childField"!==ue){var fe={};if(pe.hasOwnProperty(ue))fe=pe[ue];else{var Pe=null,he=null,Ce=$("#Crm_"+i+"_"+ue).data();if(void 0!==Ce)Pe=Ce.id,he=Ce.lookupModule;else{var we=ve;"SALUTATION"===ve&&(we="FIRSTNAME_"+ve);var Fe=$("#Crm_"+i+"_"+ue+"_"+we);Pe=Fe.data("entityid"),he=Fe.data("entitymodule")}fe.id=Pe,fe.lookupmodule=he}fe[ve]=ge,pe[ue]=fe}else ce[ve]=ge}}for(var be in T){var Ie=E[be];for(depRelCol in T[be]){ge=T[be][depRelCol];if("STAGE"===depRelCol&&-1!==ge.indexOf(":")&&(ge=ge.substring(ge.indexOf(":")+1),T[be][depRelCol]=ge),"ACCOUNTID"===depRelCol&&"Accounts"!=Ie){""!==ge&&void 0!==ge?ge+=":":ge=":";var Te=$("#Crm_"+Ie+"_"+be+"_"+depRelCol).val();T[be][depRelCol]=ge+Te}}}h={ChildModuleFields:ce,ParentModuleFields:pe,rlDetails:T,saveAsDraft:t};if(CFRExec&&Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(i)&&(h.lrMandatoryFields=CFRExec.lrMandatoryElem),de.duringFields=JSON.stringify(h),de.Notes=ee,$("#transitionAttachDiv .labelValCreate").children().attr("type")&&(de.Attachments=JSON.stringify(ProcessFlow.getAttachmentsJSON())),e&&(de.NextTransitionRelId=e),re){var Ee=re.component.getData("cxPropTags"),Le=Ee.length;for(ne=0;ne<Le;ne++)"noFill"===Ee[ne].color_code&&(Ee[ne].color_code=null);Ee.length>0&&(de.Tags=JSON.stringify(Ee))}var _e=ProcessFlow.getCheckListDet();Object.keys(_e).length>0&&(de.checkLists=JSON.stringify(_e)),ProcessFlow.validateAndSaveFields(i,de,a,e,ProcessFlow.ExcecutionObjs.entityName),void 0!==detailView.oldfieldUpdateJson&&detailView.oldfieldUpdateJson.length>0&&detailView.updateTimerValue(),Notes.transNoteContent=void 0,r.find(".lyteMentionsInnerDiv").length>0&&(Notes.destroyMentionsComponent("transitionNotes"),Notes.mentionedTagsData=[]),detailView&&detailView.invokeClientScript()},ProcessFlow.showFieldValidationErrors=function(e,t){if(t){for(var s,r=t.length,o=0;o<r;o++){var i="";if("Notes"===t[o].ColumnName||"Attachments"===t[o].ColumnName)i="transition"+t[o].ColumnName,t[o].IsValid?$("#errorMsg_"+i).hide():(commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(t[o].Error),$("#"+i),e,!0),s||(s="fieldsContainer"));else{if(5===t[o].type){var a=t[o].ColumnName.split("::");if("Events"!=a[1]&&"Tasks"!=a[1]&&"Calls"!=a[1]&&(a[0]=t[o].relListId+"_"+a[0]),"SALUTATION"===a[0]&&(a[0]="FIRSTNAME_SALUTATION"),t[o].hasOwnProperty("index")){a[0]=a[0]+"_"+(t[o].index+1);var n=(i=$($("#subform_"+t[o].relListId).find("tr"))[t[o].index]).querySelector("textarea[data-colname="+t[o].ColumnName.split("::")[0]+"]");i=n?n.id:i.querySelector("input[data-colname="+t[o].ColumnName.split("::")[0]+"]").id}else i=crmTemplate.getElemIdByColname(a[1],a[0])}else{var l="SALUTATION"===t[o].ColumnName?"FIRSTNAME_SALUTATION":t[o].ColumnName;i=crmTemplate.getElemIdByColname(e,l)}"Crm_Events_LOCATION"!==i&&"Crm_Events_SUBJECT"!==i&&!t[o].hasOwnProperty("index")&&i.indexOf("SALUTATION")<0&&(i+="_label"),t[o].IsValid?$("#errorMsg_"+i).hide():(s||5!==t[o].type?s||(s="fieldsContainer"):s=t[o].relListId+"_rlContainer",t[o].Error.includes("Duplicate")||(t[o].Error=$ESAPI.encoder().encodeForHTML(t[o].Error)),$("#"+i).closest(".tabDivCreate").addClass("labelValTwo"),commonUtils.showErrorMsg(t[o].Error,$("#"+i),e,!0),setTimeout(ProcessFlow.addStyleToErrorMsg(i),501))}}$("#multipleFieldsEditPop #duringTabs #"+s+"_header").addClass("sel"),null!=document.getElementById(s)&&ProcessFlow.bpRelatedListTabSwitch(s);var d=$L("#"+s);setTimeout((function(){d.scrollTo(d.find(".errorFieldP:eq(0)"))}),600)}else crmui.showMsgBand("error","Error while saving Transition.",4e3,"");$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone")},ProcessFlow.addStyleToErrorMsg=function(e){return function(){$("#errorMsg_"+e).css("white-space","initial")}},ProcessFlow.getFieldIdVsFieldDetailsJson=function(e,t){var s={};return t.each((function(e){if("Field"===e.Type){var t=e.FieldObject;s[t.fieldid]=t}})),s},ProcessFlow.cancelProcessReOrder=function(){$("#saveReOrderBtn, #cancelReOrderBtn").hide(),$("#reOrderBtn").show(),$("#modOpt").prop("disabled",!1);var e=$("#processDataContainer");e.find(".processDataRow").removeClass("reorderIc");var t=ProcessFlow.processCurrentViewResponse,s=Handlebars.templates.ProcessListViewData({processes:t.Processes,isReOrder:t.ALLOWREORDER});e.html(s);var r=$("#processListHeader"),o=$("#processDataContainer");r.find("#status").val("All"),r.find("select").prop("disabled",!1),$("#bluePrintSearchTxt").css("pointer-events",""),o.removeClass("cM ui-sortable"),o.sortable("destroy"),$("#bp_reorderHintMgs").addClass("hide"),ProcessFlow.hideCreateProcessButtonOnLimitExceed(ProcessFlow.PROCESS_COUNT),ProcessBuilder.bindMoreActions()},ProcessFlow.updateProcessStatus=function(e,t,s){var r=$("#processDataRow_"+e),o="Active"===r.attr("data-status")?"InActive":"Active",i=r.attr("data-module");if("InActive"!==o||t){var a=!1;s&&"exit"===$("#deleteprocesspopup input[name='recordaction']:checked").val()&&(a=!0),"Active"==o?Crm.trackSpotLightAction("Process Automation - Active Click"):Crm.trackSpotLightAction("Process Automation - DeActivate Click"),commonUtils.showHideLoadingDiv(!0);var n={};n[ProcessFlow.ACTION]=ProcessFlow.UPDATE_PROCESS_STATUS,n.module=i,n.processId=e,n.status=o,n.IsExitRecords=a,networkUtils.setCsrfParam(n),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:n,success:function(t){if(t[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS)ProcessFlow.processCurrentViewResponse.Processes.each((function(t){t.Id==e&&(t.ProcessStatus=o)})),crmui.hidePopup("deleteprocesspopup"),commonUtils.showHideLoadingDiv(),r.attr("data-status",o),r.find("input.onOffcb").prop("checked","Active"===o),r.find(".hoverDiv").removeAttr("onmouseover").mouseover((function(){crmui.toolTip_show(this,"center","Active"===o?I18n.getMsg("Active"):I18n.getMsg("Inactive"))}));else if(t.Error===ProcessBuilder.LIMIT_REACHED||"LAYOUT_DEACTIVATED"===t.Error||"LICENSE_LIMIT_EXCEEDED"===t.Error)renderingUtils.showCustomAlert(t.ErrorMsg),commonUtils.showHideLoadingDiv();else if(t.error===ProcessBuilder.INACTIVE_PORTAL_OWNERS){commonUtils.showHideLoadingDiv();var s='<p class="bp-err-paragraph">'+I18n.getMsg("blueprint.unsupported.trans.inactive.prtl.owner.msge2")+"</p>",i='<div class="alertPrimaryMsg">'+I18n.getMsg("blueprint.unsupported.transition.inactive.portal.owner.msge1.new")+'</div><div class="alertSecondaryMsg">'+s+"</div>",a={val:I18n.getMsg("review.blueprint"),fn:function(){Lyte.Router.transitionTo("crm.settings.section.blueprint.view-blueprint",e)}},n={val:I18n.getMsg("crm.button.cancel")};$("#customConfirmationPop").addClass("bpLicenseErr"),ProcessBuilder.showWarning(i,n,a)}else if(t.Error===ProcessBuilder.LICENSE_TYPE_NOT_SUPPORTED){commonUtils.showHideLoadingDiv();s=ProcessBuilder.getUnsupportedConfigurationMessage(["blueprint.unsupported.sla.actions","blueprint.automatictransition","crm.label.widgets","blueprint.unsupported.configuration.transition.owner.portal"]),i='<div class="alertPrimaryMsg">'+I18n.getMsg("unsupported.configuration")+'</div><div class="alertSecondaryMsg">'+s+"</div>",a={val:I18n.getMsg("review.blueprint"),fn:function(){Lyte.Router.transitionTo("crm.settings.section.blueprint.view-blueprint",e)}},n={val:I18n.getMsg("crm.button.cancel")};$("#customConfirmationPop").addClass("bpLicenseErr"),ProcessBuilder.showWarning(ProcessBuilder.getUnsupportedConfigurationMessage(),n,a)}else t.Error===ProcessBuilder.KIOSK_INACTIVE&&(commonUtils.showHideLoadingDiv(),_cruxUtils.showCustomMessage({params:{ltPropMessage:"Invalid Kiosk configured during transitions",ltPropType:"error"}}))},error:function(e){"object"==typeof e.responseJSON&&"Usage of V1 API is Deprecated"==e.responseJSON.message&&renderDenyTemp(e.responseJSON,"blueprint","statuschange")}})}else ProcessFlow.confirmDeleteWarning("ProcessFlow.updateProcessStatus",window,"crm.process.deactivate.warning","inactive",e,!0,i)},ProcessFlow.getRecordInvolvedCount=async function(e,t){commonUtils.showHideLoadingDiv(!0);var s={RecordCount:0,IsMigrationInProgress:!1},r={};r[ProcessFlow.ACTION]=ProcessFlow.GET_RECORDSINVOLVED_COUNT,r.processId=e,r.module=t||$("#modOpt").val(),networkUtils.setCsrfParam(r);var o={params:r},i=await networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,ProcessFlow.GET_REQUEST_TYPE,o);return i&&(commonUtils.showHideLoadingDiv(),i[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&(s=i)),s},ProcessFlow.deleteProcess=function(e,t){var s=$("#processDataRow_"+e);"undefined"==t&&(t=s.attr("data-module")),commonUtils.showHideLoadingDiv(!0);var r={};r[ProcessFlow.ACTION]=ProcessFlow.DELETE_PROCESS,r.module=t,r.processId=e,networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:r,success:function(){ProcessFlow.PROCESS_COUNT--,crmui.hidePopup("deleteprocesspopup"),commonUtils.showHideLoadingDiv(),s.remove();var t=[];ProcessFlow.processCurrentViewResponse.Processes.each((function(s){s.Id!==e&&t.push(s)})),ProcessFlow.processCurrentViewResponse.Processes=t,t.length<=1&&$("#reOrderBtn").hide();var r=$("#pa_createProcessBtn");r.show(),ProcessFlow.PROCESS_COUNT<ProcessFlow.PROCESS_LIMIT&&r.prop("disabled",!1)}}),Crm.trackSpotLightAction("Process Automation - Delete Process",{Module:t})},ProcessFlow.getLayoutAndFields=async function(e){var t={};if(t[ProcessFlow.ACTION]=ProcessFlow.GET_LAYOUT_AND_FIELDS,t.module=e,!ProcessFlow.moduleVsLayouts[e]){commonUtils.showHideLoadingDiv(!0),networkUtils.setCsrfParam(t);var s={params:t},r=await networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,ProcessFlow.GET_REQUEST_TYPE,s);r&&void 0!==r.Layouts&&(ProcessFlow.moduleVsLayouts[e]=r.Layouts,ProcessBuilder.Process.AproverMeta=r.AproverMeta,BluePrintUserUtil&&BluePrintUserUtil.initUserComboBox(r.AproverMeta,e),ProcessFlow.moduleProcessLength[r.selectedModule]=r.selectedModuleLength)}return ProcessFlow.moduleVsLayouts[e]},ProcessFlow.getLayoutOptions=async function(e){if(await ProcessFlow.getLayoutAndFields(e),Array.isArray(ProcessFlow.moduleVsLayouts[e])&&0!=ProcessFlow.moduleVsLayouts[e].length){i="";for(var t=ProcessFlow.moduleVsLayouts[e].length,s=0;s<t;s++){var r=ProcessFlow.moduleVsLayouts[e][s],o=r.Name;i+="Standard"==o?"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(r.Id)+"'>"+$ESAPI.encoder().encodeForHTML(I18n.getMsg("Standard"))+"</option>":"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(r.Id)+"'>"+$ESAPI.encoder().encodeForHTML(o)+"</option>",ProcessFlow.layoutIdVsFields[r.Id]=r.Fields}}else var i="<option value='none'>-"+I18n.getMsg("None")+"-</option>";return i},ProcessFlow.updateFieldOptions=function(e){var t="<option value='none'>-"+I18n.getMsg("crm.label.picklist.none")+"-</option>";if("none"!=e)for(var s=ProcessFlow.layoutIdVsFields[e].length,r=0;r<s;r++){var o=ProcessFlow.layoutIdVsFields[e][r];t+='<option colname="'+$ESAPI.encoder().encodeForHTMLAttribute(o.Column)+'" value="'+$ESAPI.encoder().encodeForHTMLAttribute(o.Id)+'">'+$ESAPI.encoder().encodeForHTML(o.Label)+"</option>"}var i=$("#processFieldListTmp");i.find("select").html(t),i.find(".select2-selection__rendered").text(I18n.getMsg("crm.label.picklist.none")).attr("title",I18n.getMsg("crm.label.picklist.none")),$("#pipelineInput").hide()},ProcessFlow.showCreateProcessPop=function(e,t){renderingUtils.windowHeight;var s=$("#modOpt");e="All"==(e=e||s.val())?s.find("option").eq(1).attr("value"):e,commonUtils.showHideLoadingDiv(!0);var r=$("#createProcessPopDiv");ProcessFlow.getLayoutOptions(e).then((function(s){if(!r.is(":visible")){var o,i=ProcessFlow.SUPPORTED_MODULES;(o=i.indexOf("Calls"))>-1&&i.splice(o,1);var a=Handlebars.templates.CreateProcessPop({modulesList:i});r.html(a),$("#pipelineInput").hide(),$("#ruleNameTmp, #ruleDescTmp").val(""),crmui.showPopup(r.attr("id"),!0),wfForm.initFormClick(),$("#limitWarnDIV").hide();var n=$("#moduleSel");"object"==typeof Crm.userDetails.MODULE_LIST?Crm.userDetails.MODULE_LIST:JSON.parse(Crm.userDetails.MODULE_LIST);n.trigger("chosen:activate"),n.val(e),n.trigger("change.select2")}var l=$("#processLayoutListTmp");l.find("select").html(s);var d=l.find("option").eq(0).text();d=="-"+I18n.getMsg("None")+"-"?l.find(".select2-selection__rendered").text(I18n.getMsg("None")).attr("title",I18n.getMsg("None")):l.find(".select2-selection__rendered").text(d).attr("title",d),ProcessFlow.updateFieldOptions(l.find("select").val()),t?ProcessBuilder.showCriteriaEditor(e,void 0,"process",!0).then((function(){ProcessFlow.showCreateProcPopUnloadHandling(e)})):ProcessFlow.showCreateProcPopUnloadHandling(e)}))},ProcessFlow.showCreateProcPopUnloadHandling=function(e){var t=renderingUtils.windowHeight;if(crmTab.isLinkingModule(e)){var s=document.querySelector("crm-blueprint-user-component");s&&s.component.executeMethod("removePortalUserTypeFromTransitionOwnerSelection",s.getData("selectedUsers"))}commonUtils.showHideLoadingDiv(),$("#processNameTmp").focus(),$('<style type="text/css">.pp-content{ max-height:'+(t-230)+"px !important;}</style>").appendTo(document.head),$(".searchfld").each((function(){"Calls.Billable"!=$(this).val()&&$(this).parent().find("select option[value='Calls.Billable']").remove().trigger("change.select2")})),store.unloadAll("layout")},ProcessFlow.hideCreateProcessPop=function(){crmui.hidePopup("createProcessPopDiv"),ProcessFlow.moduleVsLayouts={},ProcessFlow.layoutIdVsFields={},thirdPartyUtils.unbindPerfectScroll("#createProcessPopDiv .pp-content"),featuresAvailable.NEXTGENUI_ENABLED&&app.prevTransition&&app.prevTransition.route&&app.prevTransition.route.startsWith("crm.tab")&&Lyte.Router.getRouteInstance().transitionTo(app.prevTransition)},ProcessFlow.showRemindDiv=function(e,t){1==$(e).is(":checked")?$("#"+t).css("opacity",0).slideDown(300).animate({opacity:1},{queue:!1,duration:400}):$("#"+t).slideUp("fast")},ProcessFlow.setExitAsFlowChangeAction=function(){ProcessBuilder.flowChangeAction="exit"},ProcessFlow.initProcessBuilder=function(e){(Crm.userDetails.ISROMODE||!0===ProcessBuilder.isReportPreview)&&(ProcessBuilder.isBlueprintROMode=!0),ProcessFlow.initProcessBuilder_beforeRender(e);var t=Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process});ProcessBuilder.TransitionIdVsDetails={};var s=$("#result");if(s.html(t),ProcessBuilder.Process.Id||s.find(".exportBlueprint").addClass("disable"),ProcessBuilder.Process.IsReadOnly||ProcessBuilder.Process.IsOrphanProcess){var r='<div class="bp-transparentLayer-forProcess"></div>';if(s.find("#canvasContainer").prepend(r),s.find(".pb_property_toll").prepend(r),ProcessBuilder.Process.IsReadOnly){if(e.IsMigrationInProgress)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert"));ProcessBuilder.showFlowChangeRecordAction(e.NoOfRecordsInvolved,e.UnAvailNodeIds,e.ExistingNodeIds)}else{var o=null;$("#saveFlowChange").removeClass("hide"),o=1===e.NoOfRecordsInvolved?I18n.getMsg("crm.process.orphan.flowchange.record.action.msg"):I18n.getMsg("crm.process.orphan.flowchange.records.action.msg",e.NoOfRecordsInvolved),o+=I18n.getMsg("crm.blueprint.orphan.flowchange.alert"),renderingUtils.showCustomAlert($ESAPI.encoder().encodeForHTMLAttribute(o),I18n.getMsg("crm.process.title.attention"),!0,ProcessFlow.setExitAsFlowChangeAction)}}else s.find(".bp-transparentLayer-forProcess").remove();ProcessFlow.initProcessBuilder_afterRender(e)},ProcessFlow.renderProcessResponce=function(e){ProcessBuilder.populateDefaultProcessDetails(e),ProcessBuilder.getApproverIdVsNameMap(e)},ProcessFlow.initProcessBuilder_beforeRender=function(e){ProcessBuilder.resetProcessCreateRelatedObjects(),ProcessBuilder.delAlertTriggers=[],ProcessBuilder.cloneProcessDetails={},ProcessBuilder.flowChangeAction="",ProcessBuilder.unSavedAction=!1,ProcessBuilder.TranistionCreated=[],ProcessFlow.isProcessListView=!1,void 0!==e.transitionVsDeletedFlds?BlueprintTransition.transitionIdsVsInvalidFields=e.transitionVsDeletedFlds:BlueprintTransition.transitionIdsVsInvalidFields={},BlueprintTransition.transitionIdsVsFieldCols={},e.isPortalActivated&&(ProcessFlow.isPortalActivated=e.isPortalActivated),e.allPortalsData&&(ProcessFlow.allPortalsData=e.allPortalsData,ProcessFlow.isPortalDataLoaded=!0),e.portalSupportedModules&&(ProcessBuilder.portalSupportedModules=e.portalSupportedModules),e.convertTransIds&&(ProcessBuilder.convertTransitionIds=e.convertTransIds),ProcessBuilder.inactivePortalIds=e.inactivePortalIds,ProcessBuilder.transitionIdsWithInactivePortals=e.transitionIdsWithInactivePortals,ProcessBuilder.stateIdVsTransitionOrder=e.stateIdVsTransitionOrder,e.Id&&Crm.trackSpotLightAction("Process Automation - Edit Or View Process",{Module:e.Module}),ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0,thirdPartyUtils.bindSelect2(".chosenSel",{placeholder_text_single:" e.g. User, Groups & Roles"}),ProcessFlow.renderProcessResponce(e),e.RegexValidators&&(ProcessBuilder.RegexValidators=e.RegexValidators);var t=!1;return"Potentials"===e.Tab.Name&&"STAGE"===e.Field.Column&&(t=!0),e.isPotentialStage=t,ProcessBuilder.Process=e,ProcessBuilder.ProcessOwnersNameMap=e.ProcessOwnersNameMap,Handlebars.registerPartial("ProcessInfo",Handlebars.templates.ProcessInfo),Handlebars.registerPartial("ProcessVersionHistory",Handlebars.templates.ProcessInfo),ProcessBuilder.IsProcessCriteriaUpdated=!1,e.Error===ProcessBuilder.LIMIT_REACHED?$("#savePublishBtn").prop("disabled",!0):$("#savePublishBtn").prop("disabled",!1),wfActions&&e.isNewConvertUIEnabled&&(wfActions.isNewConvertUIEnabled=e.isNewConvertUIEnabled),ProcessBuilder.LicenseLimits=jQuery.extend(!0,ProcessBuilder.LicenseLimits,e.LicenseLimits),ProcessBuilder.Process.lockedStates=[],ProcessBuilder.Process.appName=Crm.appName,ProcessBuilder.TransitionSupportedActions=e.TransitionSupportedActions,ProcessBuilder.readOnlyActionForTeamModule=e.readOnlyActionForTeamModule,ProcessBuilder.ActionsvsLimit=e.ActionsvsLimit,ProcessBuilder.transitionsWithWidget=e.hasOwnProperty("WidgetTransiitionIds")?e.WidgetTransiitionIds:[],ProcessBuilder.transitionsWithKiosk=e.hasOwnProperty("KioskTransitionIds")?e.KioskTransitionIds:[],e},ProcessFlow.getDropCanvasHeight=function(){var e=renderingUtils.tabLayerOuterHeight(),t=$("#annoncement");t.is(":visible")&&(e+=t.outerHeight());var s=$("#wmstoolbar"),r=1==s.is(":visible")?s.outerHeight():28;return renderingUtils.windowHeight-(e+r)},ProcessFlow.getDropCanvasWidth=function(e){return e||(e=480),renderingUtils.windowOuterWidth-e},ProcessFlow.initProcessBuilder_afterRender=function(e){BluePrintUserUtil.initUserComboBox(ProcessBuilder.Process.AproverMeta),ProcessBuilder.resetCacheInfo();var t=$("#savePublishBtn");e.Error===ProcessBuilder.LIMIT_REACHED?(t.prop("disabled",!0),t.attr("title",e.ErrorMsg)):t.prop("disabled",!1);var s=renderingUtils.tabLayerTop(),r=renderingUtils.tabLayerOuterHeight(),o=ProcessFlow.getDropCanvasHeight(),i=$(".pp_all_saveCancel").outerHeight(),a=$("#pb_all_saveCancel"),n=a.outerHeight(),l=$(".pb_summaryview").outerHeight(),d=0,c=$L(".ts-fxd-sc"),p=c&&c.length>0?c.outerWidth():0,u=$("#processDescription");pBDescription.showDesc(u,"processDesc_div");var m=$("#new_custom_picklist");if(!0===e.isGlobal?(m.addClass("hoverRestriction cDefault"),m.attr({"lt-prop-title":I18n.getMsg("mb.field.globalfield.usedfield"),"lt-prop-tooltip-config":'{"appearance":"callout","position" : "top"}'}),m.removeAttr("onclick")):(m.removeClass("hoverRestriction cDefault"),m.attr("onclick","ProcessBuilder.addNewPickList(this); sE(event);")),wfmergefield.initMergeFieldDetl("Blueprint"),wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(ProcessBuilder.Process.Module),e.Continuous&&(ProcessBuilder.showOwnerData(),thirdPartyUtils.bindSelect2(".pb_form_ele"),thirdPartyUtils.bindSelect2(".chosenSel",{placeholder_text_single:" e.g. User, Groups & Roles"})),!0===featuresAvailable.NEXTGENUI_ENABLED&&(d=p,i=0),e.CriteriaContentFromCreatePop){var v=$("#"+ProcessBuilder.PROCESS_CRITERIA_ID),g=ProcessBuilder.gather(v);v.find(".pp-content").remove(),v.find("form[name='processCriteriaForm']").append(e.CriteriaContentFromCreatePop),ProcessBuilder.deploy(g);var f=Search.getCriteriaDetails(void 0,"_1",void 0,"createProcess");f&&f.length>0&&Search.showSummaryView("processFlow","1",!1,$("#pA_process_condition_pop"),!0,void 0,"createProcess")}var P=1;$("#pb_processInfoContainer .viewCriRow").each((function(){$(this).find("span.criNum").length<=0&&($(this).prepend("<span class='crmBaseColor pR10'>"+P+"</span>"),P++)})),2===P&&$("#pb_processInfoContainer .viewCriRow .wf_oprView").addClass("hide"),$("#setupInnerLinks, .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("#picklistOptions").css({height:"270px"}).addClass("oH pR").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1});var h=$("#canvasContainer"),C=ProcessFlow.getDropCanvasWidth(480+d),w=$("#pb_dragAndDropBox");$("#setup_new_ContentDiv").height(o);var F=$("#canvas");F.css({width:"1px",height:"1px"}),ProcessBuilder.Process.IsReadOnly,$("#processDropCanvas").css({height:Math.round(o-i),width:C}),a.css({width:C}),h.css({height:Math.round(o-i),width:C}),Crm.userDetails.RTL_ENABLED?w.css({right:C/2-200,top:(o-n)/2-200}):w.css({left:C/2-200,top:(o-n)/2-200});var b=$(".pb_property_toll");if(b.css({width:480,height:Math.round(o),top:r+s+"px"}),$(".bp_versionHistory").css({height:o-l}),1==$(".pb_tabClass").is(":visible"))var I=o-51;else I=o;if($(".pb_transitionInfo, .pb_processInfo, #pb_stateInfoContainer").css({height:I,"box-sizing":"border-box"}),b.addClass("open"),w.css("display","none"),ProcessBuilder.init(),F.on("click",(function(){ProcessFlow.tabAction("pb_processInfo")})),$(".moreIcon").on("mouseenter",(function(){$(this).addClass("showMoreHvr");var e=$(this).next(".more-opt-list");e.css("display","block"),e.on("mouseleave",(function(){e.closest(".moreIcon").removeClass("showMoreHvr"),$(this).css("display","none")}))})),ProcessBuilder.setFieldDivHeight(),ProcessBuilder.unSavedChanges=!1,ProcessBuilder.Process.IsReadOnly||ProcessBuilder.Process.IsOrphanProcess){var T='<div class="bp-transparentLayer-forProcess"></div>';if(h.prepend(T),b.prepend(T),ProcessBuilder.Process.IsReadOnly){if(e.IsMigrationInProgress)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert"));ProcessBuilder.showFlowChangeRecordAction(e.NoOfRecordsInvolved,e.UnAvailNodeIds,e.ExistingNodeIds)}else{var E=null;$("#saveFlowChange").removeClass("hide"),E=1===e.NoOfRecordsInvolved?I18n.getMsg("crm.process.orphan.flowchange.record.action.msg"):I18n.getMsg("crm.process.orphan.flowchange.records.action.msg",e.NoOfRecordsInvolved),E+=I18n.getMsg("crm.blueprint.orphan.flowchange.alert"),renderingUtils.showCustomAlert($ESAPI.encoder().encodeForHTMLAttribute(E),I18n.getMsg("crm.process.title.attention"),!0,ProcessFlow.setExitAsFlowChangeAction)}}else $(".bp-transparentLayer-forProcess").remove()},ProcessFlow.showProcessDetailsPage=function(){var e=$("#moduleSel").val(),t=$("#processField"),s=$("#processNameTmp"),r=$("#processDescTmp"),o=$("#pipelineList"),i=trimBoth(s.val()),a=trimBoth(r.val()),n=!0,l=$("#createProcessPopDiv");l.find(".form_err_fld").removeClass("form_err_fld"),l.find(".form_err_msg").remove(),"none"===t.val()&&(renderingUtils.displayErrorDiv("processField",void 0,I18n.getMsg("crm.automation.process.filed.empty")),n=!1),o.length>0&&""===o.val()&&(renderingUtils.displayErrorDiv("pipelineList",void 0,I18n.getMsg("crm.blueprint.pipeline.field.empty")),n=!1),a.length>1e3&&(renderingUtils.displayErrorDiv(r.attr("id"),void 0,I18n.getMsg("crm.workflow.rule.description.limitExceed.alert",[1e3])),r.focus(),n=!1),ProcessFlow.PROCESS_COUNT>=ProcessFlow.PROCESS_LIMIT&&(renderingUtils.displayErrorDiv("moduleSel",void 0,I18n.getMsg("crm.process.max.limit.reached.msg",[ProcessFlow.PROCESS_LIMIT])),n=!1),""===i?(renderingUtils.displayErrorDiv(s.attr("id"),void 0,I18n.getMsg("crm.automation.process.empty.name")),s.focus(),n=!1):""!==getClrTxtPtnResChars(s.val()).join(", ")?(renderingUtils.displayErrorDiv("processNameTmp",void 0,I18n.getMsg("crm.automation.process.name.spl.char")),s.focus(),n=!1):ProcessBuilder.isProcessNameAlreadyExist(e,i).then((function(r){if(r&&(renderingUtils.displayErrorDiv(s.attr("id"),void 0,I18n.getMsg("crm.automation.process.duplicate.name")),s.focus(),n=!1),!n)return!1;var o=$("#pb_creteria_conditions"),l=Search.getCriteriaDetails(void 0,"_1",void 0,"createProcess");if(void 0!==l&&(l&&l.length>0&&(n=Search.showSummaryView("processFlow","1",!1,o,!0,void 0,"createProcess")),!1===l||!n))return!1;featuresAvailable.NEXTGENUI_ENABLED&&document.querySelector("crm-left-menu").component.actions.showOrHideLeftPane(!1);var d=t.val(),c=$("#layoutSel").val(),p=$("#processField :selected"),u=$("#pipelineInput :visible"),m={Module:e,ProcessStatus:"Active",Name:i,Description:a};m.Layout={Name:$("#layoutSel :selected").text(),Id:c},m.Tab={Name:e,Id:moduleRecordMapping[e].id},m.Field={Name:p.text(),Column:p.attr("colname"),Id:d},m.Continuous=$("#isProcessContinuous").is(":checked"),m.Continuous&&(m.Owners=objectUtils.cloneObject_new(BluePrintUserUtil.convertToConstantTypes("#bp_continuous_ownercount")));var v={};v[ProcessFlow.ACTION]=ProcessFlow.GET_PROCESS_RELATED_DATA,u.length>0&&(v.pipeline=$("#pipelineList :selected").text()),v.module=e,v.fieldId=d,v.layoutId=c,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:v,success:function(e){ProcessBuilder.validatePickListValues(v,e.PicklistValues),commonUtils.showHideLoadingDiv(),renderingUtils.removeFreezeLayer(),m.PicklistValues=e.PicklistValues,m.TimeBoxConfig=e.TimeBoxConfig,m.AproverMeta=e.AproverMeta,m.inactivePortalIds=e.inactivePortalIds,e.isPortalActivated&&(m.isPortalActivated=e.isPortalActivated),e.allPortalsData&&(m.allPortalsData=e.allPortalsData),e.portalSupportedModules&&(m.portalSupportedModules=e.portalSupportedModules),m.transitionIdsWithInactivePortals=e.transitionIdsWithInactivePortals,m.Pipeline=e.Pipeline,m.RegexValidators=e.RegexValidators,m.state_actions=e.state_actions,m.isBlueprintExportenabled=e.isBlueprintExportenabled,m.isBlueprintMinorTweakEnabled=e.isBlueprintMinorTweakEnabled,m.isWhatsAppNotfAvailable=e.isWhatsAppNotfAvailable,m.isSMSNotfAvailable=e.isSMSNotfAvailable,m.isNewConvertUIEnabled=e.isNewConvertUIEnabled,wfActions&&(wfActions.isNewConvertUIEnabled=e.isNewConvertUIEnabled),m.isTransColorReorderEnabled=e.isTransColorReorderEnabled,m.isOptionalFieldsOnBoardingNeeded=e.isOptionalFieldsOnBoardingNeeded,m.isOptionalFieldsEnabled=e.isOptionalFieldsEnabled,e.stateIdVsTransitionOrder?m.stateIdVsTransitionOrder=e.stateIdVsTransitionOrder:m.stateIdVsTransitionOrder={},m.isBlueprintCreateRecordEnabled=e.isBlueprintCreateRecordEnabled,m.TransitionSupportedActions=e.TransitionSupportedActions,m.ActionsvsLimit=e.ActionsvsLimit,thirdPartyUtils.unbindChildSelect2(o),o.addClass("pp-content p25");var t=ProcessBuilder.gather(o),s=o.clone(!0);ProcessBuilder.deploy(t),s=ProcessBuilder.copySelectValues(s,o),m.CriteriaContentFromCreatePop=s,m.ProcessStatus="Draft",m.Source=1,ProcessBuilder.unSavedChanges=!0,thirdPartyUtils.unbindPerfectScroll("#createProcessPopDiv .pp-content"),ProcessFlow.initProcessBuilder(m),$("#pb_dragAndDropBox").css("display","block"),ProcessBuilder.hideShowAddState(),ProcessBuilder.hideShowStagelist();var r=e.isGlobal,i=$("#new_custom_picklist");r?(i.addClass("hoverRestriction cDefault"),i.attr({"lt-prop-title":I18n.getMsg("mb.field.globalfield.usedfield"),"lt-prop-tooltip-config":'{"appearance":"callout","position" : "top"}'}),i.removeAttr("onclick")):(i.removeClass("hoverRestriction cDefault"),i.attr("onclick","ProcessBuilder.addNewPickList(this); sE(event);")),e.LicenseLimits&&(ProcessBuilder.LicenseLimits=jQuery.extend(!0,ProcessBuilder.LicenseLimits,e.LicenseLimits)),ProcessBuilder.Process.lockedStates=[]}}),Crm.trackSpotLightAction("Process Automation - Next Click")}))},ProcessFlow.bindSortable=function(){var e=$("#processDataContainer");e.addClass("cM");var t=0,s=0,r=0,o=!1,i=null,a=null,n=null,l=null,d=null,c=null;e.sortable({placeholder:"placeholder",items:".processDataRow",start:function(e,r){if(o=!1,s=t=e.pageY,i=r.item,c=r.placeholder,i.addClass("sortingItems").siblings("div").addClass("sortAnim sortingItems"),a=$(this).find(".sortingItems"),!o){var p=i.outerHeight();i.addClass("sortingEle"),n=i[0].offsetTop,l=i.parent().outerHeight()-n-p,d=p}},sort:function(e){o=!0,t=e.pageY,(r=t-s)<-n&&(r=-n),r>l&&(r=l),i.css({transform:"translateY("+r+"px)","-moz-transform":"translateY("+r+"px)"}),a.each((function(){var e=$(this);if(e[0]!==i[0]){var t=e[0].offsetTop,s=e.outerHeight(),o=i[0].offsetTop+r;if(o>=t-s/2&&i.index()<e.index())e.css({transform:"translateY(-"+d+"px)"}),c.insertAfter(e);else{if(o<=t+s/2&&i.index()>e.index())return e.css({transform:"translateY("+d+"px)"}),c.insertBefore(e),!1;$(this).css({transform:"translateY(0px)"})}}}))},stop:function(){o=!1,i.removeClass("sortingEle"),a.removeClass("sortAnim").removeAttr("style")}})};var pBDescription={onFocus:function(e){$(e).closest(".labelValCreate").addClass("focusEleField")},addDesc:function(e){var t=$("#"+e),s=t.find(".processDesc_inp");t.find(".addDescLink").addClass("hide"),s.removeClass("hide");var r=s.find(".textField");r.focusin(setFocusClass),s.find(".textField").focus(),ProcessBuilder.unSavedChanges=!0,r.blur(removeFocusClass)},editDesc:function(e){var t=$("#"+e),s=t.find(".processDesc_inp");t.find(".processDesc_span").addClass("hide"),t.find(".descReadMore").addClass("hide"),s.removeClass("hide");var r=s.find(".textField");r.focusin(setFocusClass),s.find(".textField").focus(),r.blur(removeFocusClass),ProcessBuilder.unSavedChanges=!0},showDesc:function(e,t){var s=$(e),r=$("#"+t),o=s.val(),i=o?o.trim():"",a=r.find(".processDesc_inp"),n=r.find(".processDesc_span");if(ProcessBuilder.checkSplCharsForDesc(i)){if(""===i)s.closest(".labelValCreate").removeClass("focusEleField"),a.addClass("hide"),r.find(".addDescLink").removeClass("hide");else{var l=n.find("span");a.addClass("hide"),l.text(i),n.removeClass("hide");var d=n.find(".descReadMore");i.length>55?(l.addClass("maxW250 crmEllipticText"),d.removeClass("hide")):(l.removeClass("maxW250 crmEllipticText"),d.addClass("hide"))}s.next().remove()}else renderingUtils.displayErrorDiv(s.attr("id"),void 0,I18n.getMsg("crm.automation.transition.decr.spl.char")),s.focus(),s.css("border-color","red")},taskDesc:function(e){var t=$(e),s=$("#processTaskDesc_div"),r=s.find(".processDesc_inp");""!==t.val().trim()||t.hasClass("err_fld")||(t.closest(".labelValCreate").removeClass("focusEleField"),r.addClass("hide"),s.find(".addDescLink").removeClass("hide"))}};ProcessFlow.confirmDeleteWarning=async function(e,t,s,r,o,i,a,n){$("#deleteprocesspopup").remove();var l="",d=0,c=null,p=null,u=!1,m=I18n.getMsg("crm.label.yes"),v=!1,g=null;if(0==$("#canvasContainer").length&&("delete"===r||"inactive"===r)){var f=await ProcessFlow.getRecordInvolvedCount(o,i);if(d=f.RecordCount,u=f.IsMigrationInProgress,"delete"===r&&(v=!0,g=I18n.getMsg("blueprint.delete.confirmationmsg")),u&&"delete"===r)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.delete.alert"))}"delete"===r?(d>0&&(s=I18n.getMsg("crm.process.delete.record.exists.warning")),l=I18n.getMsg("crm.process.title.warning"),m=I18n.getMsg("crm.button.delete")):"inactive"===r?(d>0?(l=I18n.getMsg("crm.process.title.attention"),1==d?(s=I18n.getMsg("crm.process.record.exit.msg1"),c=I18n.getMsg("crm.process.record.action.continue"),p=I18n.getMsg("crm.process.record.action.exit")):d>0&&(s=I18n.getMsg("crm.process.records.exit.msg1",d),c=I18n.getMsg("crm.process.records.action.continue"),p=I18n.getMsg("crm.process.records.action.exit")),a=!0):l=I18n.getMsg("crm.process.title.warning"),m=I18n.getMsg("crm.label.deactivate")):"save"===r&&(m=I18n.getMsg("crm.button.save"));var P={functionName:e,param1:o+"",param2:i+"",param3:a+"",param4:n+"",context:"window",noText:I18n.getMsg("crm.button.cancel"),yesText:m,warningMsg:I18n.getMsg(s),title:l,recordContinueMsg:c,recordExitMsg:p,isMigrationInProgress:u,isDeleteBP:v,confirmationMsg:g};Handlebars.registerPartial("ProcessDeleteWarning",Handlebars.templates.ProcessDeleteWarning),$("#deletepopup").after(Handlebars.templates.ProcessDeleteWarning(P)),v&&$("input#deleteButton").prop("disabled",!0),crmui.showPopup("deleteprocesspopup",!0)},ProcessFlow.cancelMulitipleFieldsEdit=function(){ProcessFlow.destroyUploaderObj(),Notes.transNoteContent=void 0;var e=$("#multipleFieldsEditPop");e.find(".lyteMentionsInnerDiv").length>0&&(Notes.destroyMentionsComponent("transitionNotes"),Notes.mentionedTagsData=[]),crmui.hidePopup("multipleFieldsEditPop"),CFRExec.relatedEntityMap={},CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0),$("#bp-attachment").remove();var t=$("#unsubscripeEmails");t&&t.length>0&&t.remove(),ProcessFlow.removeMultiUserDropdown(),ProcessFlow.removeTagsDropDown(),e.remove()};var processHelp={showHotspots:function(){var e=$("#hotSpotSwitch"),t=$(".pb_tabClass .commentabmenu").find("#pb_processInfo"),s=$(".pb_property_toll"),r=$(".hotspots");e.hasClass("bpHelpClose")?(e.removeClass("bpHelpClose").attr("title",I18n.getMsg("crm.topmenu.help")),r.removeClass("dIB").addClass("dN"),t.removeClass("mR36"),s.removeClass("hotspotOn")):(e.addClass("bpHelpClose").attr("title",I18n.getMsg("crm.button.close")),r.removeClass("dN").addClass("dIB"),t.addClass("mR36"),s.addClass("hotspotOn")),$("#canvasContainer").on("click.hotspotListen",(function(){$(".pb_property_toll").removeClass("hotspotOn"),$(".hotspots").removeClass("dIB").addClass("dN"),$(".pb_tabClass .commentabmenu").find("#pb_processInfo").removeClass("mR36"),$("#canvasContainer").off("click.hotspotListen"),$("#hotSpotSwitch").removeClass("hide")}))},showHotspotHelp:function(e){var t=null,s=null,r=null,o="",i="",a="",n="",l="",d="",c="",p="",u="";switch(e){case"info_and_states":r=renderingUtils.windowHeight-210,c="enabled";break;case"pb_transition":t="crm.auditlog.transition",p="enabled";break;case"cont_trans_help":t="crm.process.continuous.transition.label",s="crm.helpcontent.continuoustransition.desc";break;case"global_trans_help":t="crm.process.global.transition.label",s="crm.helpcontent.globaltransition.desc",u="enabled";break;case"before_help":t="crm.process.automation.before.trans",s="crm.helpcontent.beforetrans.desc",a="enabled";break;case"during_help":t="crm.process.automation.during.trans",s="crm.helpcontent.duringtrans.desc.new",n="enabled";break;case"after_help":t="crm.process.automation.after.trans",s="crm.helpcontent.aftertrans.desc",l="enabled";break;case"approveuser":t="crm.process.automation.whocanexecute",s="crm.helpcontent.whocanexecute.desc";break;case"criteria":t="crm.process.automation.conditiontodisplay",s="crm.conditiontodisplay.desc",o="crm.condition.display.line1",i="crm.condition.display.line2";break;case"insertmessage":t="crm.process.builder.during.header",s="crm.helpcontent.insertmes",d="enabled"}var m=$(".pb_property_toll").width(),v=$(".hotSpotHelp");v.find("#hotspothelp_heading").html(I18n.getMsg(t)),v.find(".hotspothelp_content").html(I18n.getMsg(s,Crm.appName));var g=v.find("#bp_before_Transoptions"),f=v.find("#bp_during_Transoptions"),P=v.find("#bp_after_Transoptions"),h=v.find("#bp_insertDuring_Transoptions"),C=v.find("#bp_insertInfoAndStates"),w=v.find("#bp_Transition"),F=v.find("#pb_global_trans_help"),b=v.find("#critList");""!=o?(b.removeClass("dN"),b.find(".crit1").html(I18n.getMsg(o)),b.find(".crit2").html(I18n.getMsg(i))):b.addClass("dN"),"enabled"===a?g.removeClass("dN"):g.addClass("dN"),"enabled"===n?f.removeClass("dN"):f.addClass("dN"),"enabled"===l?P.removeClass("dN"):P.addClass("dN"),"enabled"===d?h.removeClass("dN"):h.addClass("dN"),"enabled"===c?C.removeClass("dN"):C.addClass("dN"),"enabled"===u?F.removeClass("dN"):F.addClass("dN"),"enabled"===p?w.removeClass("dN"):w.addClass("dN"),v.css({left:m,"z-index":31}),$(".pb_property_toll.open").css("z-index","21"),v.removeClass("dN"),$("#bp_insertInfoAndStates .bpAccordionBtnContent:eq(1)").css("height",r),$L(".hotSpotHelpInner").scrollTop(0),setTimeout((function(){v.css({left:"0px"})}),10),$("#pb_freezeLayer").css({width:"100%",right:"initial"}).fadeIn(200)},closeHotspotHelp:function(){var e=$(".pb_property_toll").width(),t=$(".hotSpotHelp");t.css({left:e}),setTimeout((function(){t.addClass("dN"),$(".pb_property_toll.open").css("z-index","1")}),500),$("#pb_freezeLayer").fadeOut(200)}};ProcessFlow.getDuringTabtotalbWidth=function(){var e=0;return $.each($("#duringTabs li"),(function(t,s){e+=$(s).outerWidth()+5+24})),Math.round(e+50)},ProcessFlow.getAllRelatedModulesInDuringTrans=function(e){var t=$("#duringTabs").find("li");$.each(t,(function(){var t=$(this).attr("data-tab");if("fieldsContainer"===t||"checkListContainer"===t)return!0;t=t.split("_")[0],e.push({relId:t,module:$(this).attr("data-mod")})}))},ProcessFlow.updateRelatedListObj=function(e,t){void 0===crmRelatedList.EachModuleData[e]&&(crmRelatedList.EachModuleData[e]={listRelationId:e,name:t})},ProcessFlow.handleChkListClick=function(e){var t=(e=$(e)).parents("li").find(".cLC"),s=$("input[type='checkbox']").length;1==e.is(":checked")?t.addClass("strikeT"):t.removeClass("strikeT");var r=$(".bp_checkListConfig  input[type='checkbox']:checked").length,o=$("#cl_completed_div");r==s?o.addClass("cLcc"):o.removeClass("cLcc"),$("#cl_completed").text(r)},ProcessFlow.getCheckListDet=function(){var e=[],t=$L("#checkListContainer").find(".checkListsTitleMandatory").length>0;return $.each($("#checkListContainer .bp_checkListConfig li"),(function(s,r){var o=$(r),i=o.attr("value"),a=!1,n=!1;0!==o.find(".bp_checkListConfigMandatory").length||t||(n=!0),o.find("input").eq(0).is(":checked")&&(a=!0);var l={};l[i]=a,ProcessFlow.OPTIONAL_FIELD_FEATURE&&(l.$optional=n),e.push(l)})),e},ProcessFlow.toggleCheckLists=function(e){var t=(e=$(e)).parent().outerWidth(),s=e.attr("chkLiId"),r=e.parents("tr").eq(0).next("tr #ChkLiItems_"+s);if(r.find(".bp_rl_checkList tr td:nth-child(1)").css("width",t-7),r.length>0)r.is(":visible")?r.slideUp(100,(function(){e.find("span").removeClass("toggleRotate")})):(r.slideDown(),e.find("span").addClass("toggleRotate"));else{var o={};o.module=$("#module").val(),o.checkListId=s,o[ProcessFlow.ACTION]="getCheckListItems",(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:o,success:function(r){var i={};i.checkListId=o.checkListId,i.CheckLists=r.CheckLists;var a=Handlebars.templates.CheckListsRLView(i);e.parents("tr").eq(0).after(a);var n=e.parents("tr").eq(0).next("tr #ChkLiItems_"+s);n.find(".bp_rl_checkList tr td:nth-child(1)").css("width",t-7);var l=n.find(".bp_rl_checkList tr td");l.hasClass("tableData")||l.addClass("tableData"),e.find("span").addClass("toggleRotate")},error:function(){renderingUtils.showCustomAlert("Please try again later")}})}},ProcessFlow.isAllFldsEmpty=function(e){var t=Crm.fieldsObj[e],s=ProcessFlow.getFieldElemIds(t,$("#fieldsContainer")),r={};for(var o in s)if(s.hasOwnProperty(o)){Crm.validateEntityAndShowErrorMsg(s[o],e,!0,void 0,!0),r[o]=Crm.requestParamWithColname;var i="childField"===o?1:0;if(i=1===i&&r[o].hasOwnProperty("SALUTATION")?i+1:i,Object.keys(r[o]).length>i)return!1}var a=[];ProcessFlow.getAllRelatedModulesInDuringTrans(a);for(var n=a.length,l={},d=$("#Crm_Calls_CALLSTARTDATETIME"),c=0;c<n;c++){var p=a[c],u=p.relId,m=p.module,v=(t=Crm.fieldsObj[m],ProcessFlow.getFieldElemIds(t,$("#"+u+"_rlContainer")));for(var o in v)if(v.hasOwnProperty(o)){var g={isFrmBP:!0};if(Crm.validateEntityAndShowErrorMsg(v[o],m,!0,void 0,!0,g),l[o]=Crm.requestParamWithColname,isNewCallView&&"Calls"===m&&Crm.requestParamWithColname.CALLSTARTDATETIME&&new CrmDate(d.data("date-obj")).isFutureTime()){var f=I18n.getValueForFields("crm.custom.field.less.than.equalto",[I18n.getMsg("Call Start Time"),I18n.getMsg("currentDateTime")]);return commonUtils.showErrorMsg(f,d),!0}var P=crmTab.tabVsSubTabs[m],h=!0,C=!1;if(P&&P.length>0){for(var w=P.length,F=0;F<w;F++)h=h&&g[P[F]].resultObj.mandateFailed,C=C||g[P[F]].resultObj.maxRowlimitFailed;if(!(Object.keys(l[o]).length>0)&&h||C)for(F=0;F<w;F++){if((I=$("#subform_"+P[F])).attr("rellistid")===o){var b=I.data("dataSubformsectionlabel").replace(" ","_");b="secHead_"+b,Crm.showErrorMessage(g[P[F]].resultObj,$("#"+b),e,I.data("dataColumnname"),I.data("dataSubformsectionlabel"),I.data())}}else for(var F=0;F<w;F++){var I;if((I=$("#subform_"+P[F])).attr("rellistid")===o){var T=I.find("tbody tr").closest("table").data("data-columnname"),E=l[o];E[T]=Crm.requestParam["property("+T+")"];var L=g[P[F]].aggFldObj;for(var _ in L)E[_]=L[_]}}}if(Crm.isInventoryModule(m)&&Crm.userDetails.IS_MULTI_CURRENCY_ENABLED&&o===u&&!l[o].CURRENCYISOCODE&&window[m].defaultCurrency&&(l[o].CURRENCYISOCODE=window[m].defaultCurrency),Object.keys(l[o]).length>0)return!1}}var y=$("#transitionNotes"),R=void 0;if(y.length>0){R=y.val().trim();if(Notes.transNoteContent&&(Notes.transNoteContent=Notes.transNoteContent.trim(),Notes.transNoteContent&&(R=Notes.transNoteContent)),R&&!(R.length<=0))return!1}var D=$("#transitionAttachDiv .labelValCreate")[0],S=void 0!==D?$(D):void 0;if(void 0!==S&&"true"===S.attr("isAttachmentAdded"))return!1;for(var A=ProcessFlow.getCheckListDet(),O=(n=A.length,0);O<n;O++){var N=A[O];if(!0===N[Object.keys(N)[0]])return!1}var M=document.querySelector("#transitionTagsDiv crux-tag");return!M||!(M.component.getData("cxPropTags").length>0)},ProcessFlow.doReorderActions=function(e){ProcessFlow.bindSortable(),$("#reOrderBtn").hide(),$("#saveReOrderBtn, #cancelReOrderBtn").show(),$("#pa_createProcessBtn").prop("disabled",!0),$("#bluePrintSearchTxt").css("pointer-events","none"),$("#processDataContainer table tr td").find("div.delleftPo").css("visibility","hidden"),e&&$("#modOpt").prop("disabled",!0),$("#bp_reorderHintMgs").removeClass("hide")},ProcessFlow.getFieldsContainer=function(e,t){var s=e.find(".fieldsContainer");if(0==s.length){var r=$("<li>",{class:t?"hide":"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"fieldsContainer",id:"fieldsContainer_header"}).html($("<a>",{class:"setuplink",text:I18n.getMsg("crm.process.notes.attachments.fields")}));$("#duringTabs").append(r);var o=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle fieldsContainer moduleParent",id:"fieldsContainer"});$("#duringTabDivs").append(o),s=e.find(".fieldsContainer")}return s},ProcessFlow.getAttachmentsJSON=function(){var e=$("#transitionAttachDiv .labelValCreate"),t=[];return $.each(e.children(),(function(e,s){var r=$(s).attr("type"),o={};o.type=r;var i=$("#attachmentList-"+r+" #BP_fileDetails li>a"),a=[],n=[],l=[],d=[],c=[];if(i.length>0){switch($.each(i,(function(e,t){t=$(t),a.push(t.data("fileId")),"attachGTDocs"!==r&&"attachGDocs"!==r||n.push(t.data("mimeType")),l.push(t.text().trim()),t.data("service")&&d.push(t.data("service")),t.data("linkUrl")&&c.push(t.data("linkUrl"))})),r){case"attachLink":o.$link_url=a,o.name=l;break;case"fileUpload":o.$file_id=a,o.name=l;break;case"attachDocuments":o.$attachDocs=a,o.name=l;break;case"attachZDocs":o.$attachZDocs=a,o.name=l,o.service=d;break;case"attachFromTeamDrive":o.$attachTeamDriveDocIds=a,o.name=l,o.teamDriveLinkUrls=c;break;case"attachGDocs":o.$attachGDocs=a,o.name=l,o.service=d,o.$mimeType=n;break;case"attachGTDocs":o.$attachGTDocs=a,o.name=l,o.service=d,o.$mimeType=n}t.push(o)}})),t},ProcessFlow.getFileNames=function(e,t){switch(e){case"fileUpload":if(t){for(var s=t.files,r=[],o=[],i=[],a=t.options.successfullyUploadedFiles,n=a.length,l=s.length,d=0;d<n;d++)if("success"==s[d].status){o.push(a[d].uploadId);for(var c=0;c<l;c++)a[d].eventid===s[c].upload.id&&(r.push(s[c].name),i.push(s[c].size.toString()))}return{names:r,ids:o,size:i}}break;case"attachDocuments":if(t&&t.indexOf("&")>-1){var p=[],u=[],m=t.split("&");if(m[0].startsWith("docIds")&&m[1].startsWith("docNames")){p=m[0].split("=")[1].split(",");var v=(u=m[1].split("=")[1].split(",")).length;for(d=0;d<v;d++)u[d]=u[d].replace(/\+/g,"%20"),u[d]=decodeURIComponent(u[d]);return{names:u,ids:p}}}break;case"attachZDocs":if(t){var g=[];void 0===t.docIds&&""===t.docIds||(g=g.concat(t.docIds.split(",")));var f=[];void 0===t.docNames&&""===t.docNames||(f=f.concat(t.docNames.split(",")));var P=[];return void 0===t.service&&""===t.service||(P=t.service.split(",")),{names:f,ids:g,service:P}}break;case"attachFromTeamDrive":if(t){var h=[],C=[],w=[];return $.each(t,(function(e,t){h[e]=t.File_Name,C[e]=t.$resource_id,w[e]=t.$link_url})),{names:h,ids:C,linkUrls:w}}break;case"attachGDocs":if(t){var F={};return t.GdocId&&(F.ids=t.GdocId.split(":")),t.GdocName&&(F.names=t.GdocName.split(":")),t.service&&(F.service=t.service.split(":")),F}}},ProcessFlow.getFileNamesHtmlForTransPop=function(e,t){if(e){var s=$("<ul>",{id:"BP_fileDetails",class:"pL0 mL0"}),r=e.names,o=e.ids,i=null;"attachGTDocs"!==t&&"attachGDocs"!==t||(i=e.mimeTypes);for(var a,n,l=e.service,d=e.linkUrls,c=o.length,p=$("#module").val(),u=$("#multipleFieldEditEntityId").val(),m=$(document.createElement("li")),v=$(document.createElement("a")),g=$(document.createElement("span")),f=e.isPreviewAvailable,P=[],h=0;h<c;h++){var C,w=s.clone(),F=v.clone();l&&(a=l[h]),void 0!==f&&Object.keys(f).length>0&&(C=f[o[h]]),d&&(n=d[h],F.data("linkUrl",n));var b=BlueprintAttachment.appendAttachmentOptions(I,t,o[h],r[h],p,u,a,C,n),I=m.clone();F.text(r[h]),"attachGTDocs"===t||"attachGDocs"===t?(F.attr({class:"pL0 mL0",id:"bp_attachitem_"+o[h]+"_"+i[h]}),F.data("mimeType",i[h])):F.attr({class:"pL0 mL0",id:"bp_attachitem_"+o[h]}),F.data("fileId",o[h]),F.css("cursor","pointer"),l&&F.data("service",l[h]),void 0!==C&&F.data("isPreviewAvailable",C),void 0!==b&&(void 0!==b.clickFunction?b.isImage?(F.attr({onclick:"showImagePreview(this)",href:b.clickFunction,name:"cboxElement"}),F.addClass("cboxElement")):F.attr({onclick:b.clickFunction,target:"_blank"}):void 0!==b.downloadFunction&&F.attr("href",b.downloadFunction));var T=g.clone(),E=BlueprintAttachment.getAttachIconClass(t,r[h]);T.addClass(E+" mR10 dIB vaM"),I.append(T),I.append(F),I="attachGTDocs"===t||"attachGDocs"===t?BlueprintAttachment.appendContextMenu(o[h]+"_"+i[h],I,t,b):BlueprintAttachment.appendContextMenu(o[h],I,t,b),w.append(I),P.push(w)}if(P.length>0)return P}},ProcessFlow.destroyUploaderObj=function(){var e=$("#multipleFieldsEditPop"),t=e.data("attachUploaderObj");if(t&&Object.keys(t).length>1){var s=$(".crm-msg.fileuploader");s&&s.remove(),t.clean(),e.removeData("attachUploaderObj")}},ProcessFlow.changeToOldFormat=function(e){for(var t=Object.keys(e),s={},r=0,o=t.length,i=0;i<o;i++){var a=t[i],n=0===r?"fieldValue":"fieldValue"+r;s[0===r?"columnName":"columnName"+r]=a,s[n]=e[a],r++}return s},ProcessFlow.validateAndSaveFields=function(e,t,s,r,o){if(t.duringFields){var i=JSON.parse(t.duringFields);if(objectUtils.getValueFromObj(i,["rlDetails","Events"])){var a=$("#Crm_Events_SMOWNERID"),n=a.length>0&&"null"!==a.attr("data-id")?a.attr("data-id"):Crm.userDetails.USER_ID;Events.currentStatus="create",Events.createSource="Blueprint";var l={start:$("#Crm_Events_STARTDATETIME").data("dateObj"),end:$("#Crm_Events_ENDDATETIME").data("dateObj"),activityType:"Events",oldEnd:"",ownerId:n,isAllday:!1};return void Events.checkDuplicateEvent(l,!0,(function(){ProcessFlow.saveFields(e,t,s,r,o)}),!1)}}ProcessFlow.saveFields(e,t,s,r,o)},ProcessFlow.validateAndRenderPipelineInput=function(){var e=$("#moduleSel").val(),t=$("#processField option:selected").attr("colname");if("Potentials"===e&&"STAGE"===t){var s=$("#layoutSel").val();0===store.peekAll("layout").length?store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname}).then((function(){ProcessFlow.renderPipelineOptions(s)})):ProcessFlow.renderPipelineOptions(s)}else $("#pipelineInput").hide()},ProcessFlow.renderPipelineOptions=function(e){store.model.layout.data.filterBy({id:e})[0].sections.forEach((function(t){var s=t.fields.filterBy({column_name:"PIPELINE"});0!=s.length&&(ProcessFlow.PipelineOptionsTemplate||(ProcessFlow.PipelineOptionsTemplate=Handlebars.compile("{{#each pick_list_values}}<option>{{this.display_value}}</option>{{/each}}")),$("#pipelineList").html(ProcessFlow.PipelineOptionsTemplate(s[0][e])).trigger("change"),$("#pipelineInput").show())}))},ProcessFlow.getAttachDropdown=function(e){if(!Crm.userDetails.isRelatedListLyteEnabled){var t=Handlebars.templates.personalityAction({actions:e.Actions,rid:e.relListId,name:e.persName,mailObj:e.mailObj,entityId:crmRelatedList.EntityId,moduleName:e.Module,fromSrc:"bluePrint"}),s=$(t),r=$(".bodycontainer"),o=s.find(".atch-droplist"),i=o.clone();return i.attr("id","bp-attachment"),o.remove(),$("#bp-attachment").hasClass("atch-droplist")||r.append(i),s}$valCont[0].setAttribute("id","attachBlueprint");var a={module:{api_name:"Attachments"},actions:e.Actions,fromBlueprint:!0,menuSelector:"#attachBlueprint",personality_name:e.persName,id:e.relListId};$L("#attachBlueprint")[0].innerHTML="",Lyte.Component.render("crm-related-list-actions",{relatedList:a},"#attachBlueprint")},ProcessFlow.refreshPage=function(e,t,s){var r=$L("#multipleFieldEditTransRelId").val(),o=""!==r?r:ProcessFlow.ExcecutionObjs.transRelId;if("canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName){if(void 0!==s&&!0===s&&ProcessFlow.AFTERTRANSITION_CS){ProcessFlow.canvasAfterTransObj.isTransCompleted=!0;var i=ProcessFlow.recordIdVsTransitionDetails[t].Transitions||[];ProcessFlow.canvasAfterTransObj.argresultsobj=ProcessFlow.getAfterTransCSArgs(i,o)}else ProcessFlow.canvasAfterTransObj.isTransCompleted=!1;Lyte.Router.getRouteInstance().refresh()}else if("crm.tab.requesters.module.index-module.entity.detail"===Lyte.Router.getRouteInstance().transition.target)Lyte.Router.getRouteInstance().refresh();else{crmTab.deleteFromCache(e);i=ProcessFlow.recordIdVsTransitionDetails[t].Transitions||[];reloadCurrentEntityView(t,e,(function(){var e=$("#pb_processButtonLayer");if(e.addClass("zbp-transition-panel-freeze"),CFRExec&&(CFRExec.promptIfMandatory=!1,CFRExec.haltStageChange({}),CFRExec.evalRules("view",!0),detailView.invokeClientScript()),e.removeClass("zbp-transition-panel-freeze"),ProcessFlow.AFTERTRANSITION_CS&&void 0!==s&&!0===s&&""!==o){var t=ProcessFlow.getAfterTransCSArgs(i,o);CScript.Engine.Global.dispatchEvent("afterTransition",void 0,t)}}))}},ProcessFlow.postTransitionAction=function(e,t,s,r){if(crmui.hidePopup("multipleFieldsEditPop"),renderingUtils.removeFreezeLayer(),detailView.setScoreRulePreviousData(),detailView.refreshInWms)detailView.hideElementsForKafkaWorkFlow(e);else if($("#awtAppRecsDIV").length>0){var o={};o[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,o.module=e,o.entityId=t,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:o,success:function(r){$("#multipleFieldEditSaveBtn").prop("disabled",!1),ProcessFlow.OPTIONAL_FIELD_FEATURE&&0===$L("#multipleFieldsEditPop").find(".LR").length&&$L("#bpsaveasdraft").attr("lt-prop-disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");var o=objectUtils.getValueFromObj(r,["NextTransitions","Transitions"]);if(o){var i=$("#listView_"+t),a=i.find(".nextTrans"),n=i.find(".bptname"),l="",d="",c=r.NextTransitions.IsCriteriaTransEnabled;if(o.length>0){var p=0,u=r.Continuous;d=d+'<div class="ellipsistext">'+r.NextTransitions.ProcessName+"</div>",n.html(d);var m,v=[],g=function(o,i){var a=o.TransitionDefaultColor&&"#transparent"!==o.TransitionDefaultColor&&"transparent"!==o.TransitionDefaultColor&&"#2385ef"!==o.TransitionDefaultColor?o.TransitionDefaultColor:void 0,n=i?"":'onmouseover=ProcessFlow.showCriteriaSummary(this,"'+$ESAPI.encoder().encodeForJavaScript(o.Summary)+'",true,false);';a&&(n?n+="ProcessFlow.onHoverBgChange(this,'"+a+"');":n='onmouseover=ProcessFlow.onHoverBgChange(this,"'+a+'");');var l=i?"":"onmouseout=ProcessFlow.hideCriteriaSummary(true);",d="",c="";a&&(l?l+="ProcessFlow.onHoverBgRemove(this,'"+a+"','"+o.ButtonTextColorCode+"')":l="onmouseout=ProcessFlow.onHoverBgRemove(this,'"+a+"','"+o.ButtonTextColorCode+"')",d='onmouseup=ProcessFlow.onHoverBgRemove(this,"'+a+'");',c='onmousedown=ProcessFlow.onDownBgChange(this,"'+a+'")');var p=Crm.renderDVLyteFlow(e)?"'Approvals'":void 0;return(i?" onclick=\"sE(event);ProcessFlow.doTransition('"+$ESAPI.encoder().encodeForJavaScript(e)+"', '"+$ESAPI.encoder().encodeForJavaScript(t)+"', '"+$ESAPI.encoder().encodeForJavaScript(o.TransitionRelId)+"', '"+$ESAPI.encoder().encodeForJavaScript(s)+"',"+p+","+u+",'"+$ESAPI.encoder().encodeForJavaScript(o.TransitionId)+"', '"+$ESAPI.encoder().encodeForJavaScript(o.TransitionName)+"', '"+$ESAPI.encoder().encodeForJavaScript(r.NextTransitions.ProcessFieldId)+"', '"+$ESAPI.encoder().encodeForJavaScript(o.ToStateDisplayValue)+"')\"":' onclick="sE(event);"')+" "+n+" "+l+" "+d+" "+c},f=function(e,t){var s,o,i="",a=e.TransitionDefaultColor&&"#transparent"!==e.TransitionDefaultColor&&"transparent"!==e.TransitionDefaultColor&&"#2385ef"!==e.TransitionDefaultColor?e.TransitionDefaultColor:void 0,n='class="my-jobs-bp-trans-buttons'+(a?"":" default-btn-color")+" ellips maxW400",d="";if(a&&(d=' data-colorcode="'+a+'" style="'+((s=e.ButtonBorderColorCode?e.ButtonBorderColorCode:void 0)?"border:1px"+s+" solid;":"")+" background:transparent linear-gradient(0deg,"+e.ButtonBgColorCode+" 0%, "+e.TransitionColorCode+" 100%);color:"+(o=e.ButtonTextColorCode)+";box-shadow: inset 0px -2px 0px "+e.ButtonShadowColorCode+';"'),void 0!==e.progress){var c=parseInt(e.progress.saved/e.progress.total*100);i+='<span data-zcqa="bcirspan_'+e.TransitionName+'" id="bcirclespan_'+e.TransitionId+'" class="bp-progress-ring" onmouseenter="ProcessFlow.showProgress(this,'+c+');" onmouseleave="ProcessFlow.hideProgress();">';var p='<svg height="16" width="16"';100===c?(i+='<span class="pTrans_Complete_tick '+(a&&"#313949"===o?"bpTrans_tickin_black":"")+'"></span>',i+=p+' class="bp_Trans_Completed">'):i+=p+">",i+='<circle  data-zcqa="bcirc_'+e.TransitionName+'" id="bcircle_'+e.TransitionId+'" class="progress-ring__circle" stroke="'+(a?o:"#fff")+'" stroke-width="4" fill="transparent" r="2" cx="8" cy="8" style="'+ProcessFlow.getProgressChartStyle(e.progress.saved,e.progress.total)+'"/>',i+='<circle stroke="'+(a?o:"#fff")+'" stroke-width="1.5" fill="transparent" r="6.5" cx="8" cy="8"/>',i+="</svg>",i+="</span>",n+=" pR pR30"}t||(n+=" bpTransDisable"),n+='"',l=l+'<span id="transBtn_'+r.NextTransitions.EntityId+"_"+e.TransitionId+'"  data-stateid="'+r.NextTransitions.CurrentStateId+'" '+n+" "+d+g(e,t)+' title="'+$ESAPI.encoder().encodeForHTML(e.TransitionName)+'">'+$ESAPI.encoder().encodeForHTML(e.TransitionName)+i+"</span>"},P=function(e){if(e.IsCriteriaMatched){if(!e.ParallelTrans)return!0;for(var t=e.ParallelConnections.length,s=0;s<t;s++){if(e.ParallelConnections[s].IsCriteriaMatched)return!0}}return!1};o.forEach((function(e){if(e.IsAccessible)if(e.IsAutoTrans)v.push(e),p++;else if(c||P(e))if(p++,e.ParallelTrans){var t='<div id="transBtn_'+r.NextTransitions.EntityId+"_"+e.TransitionId+'"  data-stateid="'+r.NextTransitions.CurrentStateId+'" class="ptContainer';c&&!P(e)?t+=' bpTransDisable" '+g(e,!1)+">":t+='">',l+=t,l+='<div class="ptButton crmEllipticText">'+$ESAPI.encoder().encodeForHTML(e.TransitionName)+" </div>";var s=!0,o=e.ParallelConnections.length;e.ParallelConnections.forEach((function(t){t.progress&&t.progress.total===t.progress.saved||(s=!1);var r=e.IsCriteriaMatched&&t.IsCriteriaMatched;(c||r)&&f(t,r)})),s&&e.progress&&e.progress.total!==o&&(l+='<span class="zbp_trans_waiting zcrm_svgIcons" lt-prop-title="'+I18n.getMsg("blueprint.parallel.transition.waiting.for.others")+'"></span>'),l+="</div>"}else f(e,e.IsCriteriaMatched)})),v.forEach((function(e){l=l+'<p class="readOnlyMode cBoth vaBottom w100_per"><span style="color:#d3a921">'+$ESAPI.encoder().encodeForHTML(e.TransitionName)+"</span> "+I18n.getMsg("blueprint.autotrans.exec.msg")+'<span class="crm-font-regular crmNotFoundColor">'+e.execution_time+"</span></p>"})),0===p&&(l=l+'<span style="position: static;" class="pbconfigProcess" onclick="sE(event);ProcessFlow.checkForTransitionPreview(\''+$ESAPI.encoder().encodeForJavaScript(t)+"','"+$ESAPI.encoder().encodeForJavaScript(e)+'\' );">View Configured Process</span><div id="pb_processPreviewLayer" onclick="sE(event);"></div>'),l+='<div class="cBoth"></div>',a.html(l),$(".parTransAvail .ptContainer").each((function(){var e=$(this);m=Math.round(e.outerWidth())-18,e.find(".ptButton").css("max-width",m)}))}else{i.remove();var h=$("#awtAppRecsDIV > table > tbody").find("tr").length,C=$L("crm-myjobs")[0];1!==C.getData("totalNumberOfRecords")-C.getData("initialIndex")&&0!==h||(C.getData("page")-1>0&&C.getData("records")&&(C.setData("page",C.getData("page")-1),C.setData("initialIndex",(C.getData("page")-1)*C.getData("recordPerPage"))),C.component.methods.showMoreProcessRecords(C.getData("type"),C))}}}})}else detailView.isBlueprintPageRefresh=!0,ProcessFlow.refreshPage(e,t,r)},ProcessFlow.proceedWidget=function(){var e=ProcessFlow.widgetCache.pop(),t=e.recordId,s=e.module,r=e.recordName,o={blueprint:[{transition_id:e.transition.id,data:{widget:{id:e.widget.id}}}]},i={params:JSON.stringify(o),headers:{"Content-Type":"application/json"}};networkUtils.lyteInitiateRequest("/crm/v2.1/"+moduleRecordMapping[s].api_name+"/"+t+"/actions/blueprint","PUT",i).then((function(){ProcessFlow.postTransitionAction(s,t,r)})).catch((function(o){var i=o.responseJSON;if("invalid transition"!==i.message){var a=objectUtils.getValueFromObj(i,["details","validation_error",0]);a&&"widget"===a.api_name&&"Invalid widget"===a.message?renderingUtils.showCustomAlert(I18n.getMsg("blueprint.transition.removed.widget",[e.transition.name])):renderingUtils.showAlertMsg(I18n.getMsg("crm.errorpage.note1")),crmui.hidePopup("multipleFieldsEditPop"),renderingUtils.removeFreezeLayer()}else{renderingUtils.showAlertMsg(I18n.getMsg("blueprint.transition.invalid",[e.transition.name]),void 0,void 0,{onAccept:function(){ProcessFlow.postTransitionAction(s,t,r)}})}}))},ProcessFlow.validateAndClosePopUp=function(){var e=ProcessFlow.widgetCache.pop(),t=e.recordId;if(($("#awtAppRecsDIV").length>0?document.getElementById("listView_"+t).querySelector(".nextTrans p"):document.querySelector(".pb_transitionState")).getAttribute("data-stateid")===e.stateId)crmui.hidePopup("multipleFieldsEditPop");else{var s=e.module,r=e.recordName;ProcessFlow.postTransitionAction(s,t,r)}},ProcessFlow.proceedBPFromKiosk=function(){var e=ProcessFlow.kioskCache.pop(),t=e.recordId,s=e.module,r=e.transRelId;if(ProcessFlow.isKioskExecPopupClosed=!0,ProcessFlow.saveStateChange(s,t,ProcessFlow.currentTransitionDetails.ProcessFieldId,r),CScriptLib&&"undefined"!=typeof DetailViewHandler){var o={};$L("#multipleFieldsEditPop").find("[cscript-tag]").each(((e,t)=>{var s=$L(t).attr("cscript-tag");s.startsWith("__")||(o[s]=DetailViewHandler.mandatory_form_read(s))})),CScript.Engine.Global.dispatchEvent("onMandatoryFormLoad",void 0,o)}},ProcessFlow.checkDuplicateAssociation=function(e,t,s,r){var o=[],i=!1,a=ProcessFlow.ExcecutionObjs.module===r?$("#fieldsContainer"):$("#"+s+"_rlContainer"),n=$(e);if($.each(a.find("input"),(function(s,r){if((r=$(r)).data("colname").startsWith("LINKINGMXN"))if(r.data("isMXNDuplicate")&&($("#errorMsg_"+r.attr("id")).remove(),r.closest(".errorFieldP").removeClass("errorFieldP"),r.data("isMXNDuplicate",!1)),r.attr("id")===e.id)o.push(t);else{var a=r.data("id");validationUtils.isEmpty(a)&&(i=!0),o.push(a)}})),!i){var l={};l.module=r,l.linkingLookupValue1=o[0],l.linkingLookupValue2=o[1],l.action="checkDuplicateAssociation",networkUtils.setCsrfParam(l);var d={};d.params=l,networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,"GET",d).then((function(t){var s=JSON.parse(t),o=s.isDuplicate&&s.duplicateRecordId!==ProcessFlow.ExcecutionObjs.entityId;o?commonUtils.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),n,r,!0):($("#errorMsg_"+e.id).remove(),n.closest(".errorFieldP").removeClass("errorFieldP")),n.data("isMXNDuplicate",o)}))}},ProcessFlow.removeMultiUserDropdown=function(){$.each(Crm.fieldsObj[ProcessFlow.ExcecutionObjs.module],(function(e,t){var s=$("#"+t);445===s.data("uitype")&&s.data("colname").indexOf("MXNDUMMYCOLUMN")>-1&&$("#ownerNameLookup_"+t).remove()}))},ProcessFlow.removeTagsDropDown=function(){var e=$L("#tagCruxContainer")[0];e&&e.toggle("close")},ProcessFlow.getOwnerLookupHeight=function(e){var t=e.parent(),s=t.offset(),r={};return r.topOffset=t.innerHeight()+s.top,r.leftOffset=s.left,r},ProcessFlow.showProgress=function(e,t){var s="";s+='<div class="pb_progress_bar_callout">',s+='<div class="pR dIB">',s+='<div class="pb_criteriaSummaryView w300"><div class="crm-base-font-size crm-font-semibold">'+I18n.getMsg("blueprint.parallel.partial.saved.percentage",t)+"</div>",s+='<progress max="100" value="'+t+'" class="bp_progressbar_btn_callout"></progress>',s+="</div></div></div>";var r=$("body"),o=$(e).offset(),i=o.top+28,a=o.left;a+170>renderingUtils.windowWidth?a-=300:a-=170,r.append(s),$(".pb_progress_bar_callout").css({top:i,left:a,display:"block"})},ProcessFlow.hideProgress=function(){$(".pb_progress_bar_callout").remove()},ProcessFlow.getClientPortalStatus=function(e){var t=document.createElement("div");t.classList.add("flex-grid-skeleton","p30","detailviewRevampStage","relatedlist-bg");var s=document.createElement("div");s.classList.add("crmNotFoundColor","mB20","bp_lockedstage_heading","crm-font-bold"),s.innerText=I18n.getMsg("crm.stage.lock.msg");var r=document.createElement("div");r.classList.add("mB20","bp_locked_stage_txt","dF");var o=document.createElement("span");o.classList.add("mR30"),o.innerText=I18n.getMsg("crm.transition.current.stage");var i=document.createElement("span");i.classList.add("crmBaseColor","pR","bp_locked_stage"),i.innerText=e,r.appendChild(o),r.appendChild(i);var a=document.createElement("div");a.classList.add("bp_locked_stage_txt"),a.innerText=I18n.getMsg("crm.stage.lock.desc.new",Crm.appName),t.appendChild(s),t.appendChild(r),t.appendChild(a),$("#pb_processButtonLayer").html(t)},ProcessFlow.getProgressChartStyle=function(e,t){var s=parseInt(e/t*100),r=4*Math.PI;return`stroke-dasharray:${r} ${r};stroke-dashoffset:`+(r-s/100*r)},ProcessFlow.showCriteriaSummary=function(e,t,s,r,o){var i=$(e);if(s){r||(o=i[0].id),0!==document.getElementById("bp_hoverCardDiv").childNodes.length||r||ProcessFlow.initBlueprintLyteHoverCard(s,"show","bp_hoverCardDiv",!0,i[0].id,t);var a=document.getElementById("blueprintCriteriaHover"),n=document.getElementById("blueprint-criteria-hovercard");a&&(a.ltProp("originElem","#"+o),a.ltProp("show",!0),n.setData("criteriaString",t))}else{$("#bp_hoverCardDiv");(a=document.getElementById("blueprintCriteriaHover")).ltProp("originElem","#"+i[0].id),a.ltProp("show",!0),(n=document.getElementById("blueprint-criteria-hovercard")).setData("criteriaString",t)}},ProcessFlow.initBlueprintLyteHoverCard=function(e,t,s,r,o,i){var a=networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-blueprint.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-blueprint-dependents.css"],ResourceConstants.CRMClient);n=n.concat(a),Lyte.injectResources(n,void 0,(function(){Lyte.Component.render("crm-blueprint-hovercard",{buttonElementId:"#"+t,criteriaString:""},"#"+s),r&&ProcessFlow.showCriteriaSummary(void 0,i,e,!0,o)}))},ProcessFlow.setMouseEventForDisabledTransitions=function(){$(".pb_processDiv .TransDivider").find(".bpTransDisable").each((function(){var e=$(this),t=ProcessFlow.transitionIdVsTransitionDetails[$(this).data("transitionid")];e.attr({onmouseover:'ProcessFlow.showCriteriaSummary(this,"'+t.Summary+'")',onmouseout:"ProcessFlow.hideCriteriaSummary()"})}))},ProcessFlow.hideCriteriaSummary=function(e){if(e){var t=document.getElementById("bp_hoverCardDiv").childNodes;if(t.length>0)t[0].ltProp("show",!0)}else{document.getElementById("blueprintCriteriaHover").ltProp("show",!0)}},ProcessFlow.getBlueprintButtonLayerDetails=function(e,t){var s=!1,r=!1,o=!1;e.Transitions.each((function(e){e.IsAutoTrans&&(r=!0),e.ParallelTrans||void 0===e.TransitionDefaultColor||"#2385ef"!==e.TransitionDefaultColor||(delete e.ButtonBgColorCode,delete e.ButtonShadowColorCode,delete e.ButtonTextColorCode,delete e.TransitionColorCode,delete e.TransitionDefaultColor),e.IsAccessible&&(o=!0,e.ParallelTrans?e.ParallelConnections.each((function(t){e.IsCriteriaMatched&&t.IsCriteriaMatched&&(s=!0,void 0!==t.TransitionDefaultColor&&"#2385ef"===t.TransitionDefaultColor&&(delete t.ButtonBgColorCode,delete t.ButtonShadowColorCode,delete t.ButtonTextColorCode,delete t.TransitionColorCode,delete t.TransitionDefaultColor)),ProcessFlow.transitionIdVsTransitionDetails[t.TransitionId]=t})):e.IsCriteriaMatched&&(s=!0)),ProcessFlow.transitionIdVsTransitionDetails[e.TransitionId]=e}));var i=e.IsCriteriaTransEnabled,a=e;return a.IsAccessibleTransitionAvailable=o,a.IsCriteriaTransEnabled=i,a.IsTransitionFound=i?o:s,a.autoTransAvailable=r,a.PreviewLink="<span class='pb_link' onclick=\"ProcessFlow.showTransitionPreview('"+$ESAPI.encoder().encodeForJavaScript(t)+"')\">"+I18n.getMsg("crm.process.view.process.preview")+"</span>",a},ProcessFlow.confirmDeletionCheckboxAction=function(e){$("input#deleteButton").prop("disabled",!e.checked)},ProcessFlow.getContrastYIQ=function(e){if(e&&("#"===e.slice(0,1)&&(e=e.slice(1)),"transparent"!==e))return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=128?"#313949":"#fff";return"var(--baseColor)"},ProcessFlow.getLighterDarkerColor=function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var s,r,o="#";for(r=0;r<3;r++)s=parseInt(e.substr(2*r,2),16),o+=("00"+(s=Math.round(Math.min(Math.max(0,s+s*t),255)).toString(16))).substr(s.length);return o},ProcessFlow.onDownBgChange=function(e,t){var s=ProcessFlow.getLighterDarkerColor(t,-.05);$L(e).css({"box-shadow":"none",background:s})},ProcessFlow.onHoverBgChange=function(e,t){var s="transparent linear-gradient(180deg, "+ProcessFlow.getLighterDarkerColor(t,.04)+" 0%, "+ProcessFlow.getLighterDarkerColor(t,.06)+" 0%, "+ProcessFlow.getLighterDarkerColor(t,-.1)+" 100%)";$L(e).css({background:s})},ProcessFlow.onHoverBgRemove=function(e,t){var s=ProcessFlow.getLighterDarkerColor(t,-.01),r=ProcessFlow.getLighterDarkerColor(t,.03),o="inset 0 -2px 0 "+ProcessFlow.getLighterDarkerColor(t,-.25),i="transparent linear-gradient(0deg, "+s+" 0%, "+r+" 100%)";$L(e).css({"box-shadow":o,background:i})},ProcessFlow.highlightSavedBlueprint=function(e){var t=$("#"+e),s=$("#setup_new_ContentDiv");s.on("mousedown wheel keyup touchmove",(function(){$("#setup_new_ContentDiv").stop()})),s.animate({scrollTop:t.offset().top-250},"5000","linear",(function(){s.off("mousedown wheel keyup touchmove")})),t.addClass("lastActiveRow")},ProcessFlow.mandatoryUnfilledFieldsExist=function(e,t,s){var r=[];ProcessFlow.getAllRelatedModulesInDuringTrans(r);var o=r.length,i={};if(o>0){for(var a={},n=0;n<o;n++){var l=r[n],d=l.module,c=l.relId;a[c]=d;var p=Crm.fieldsObj[d],u=ProcessFlow.getFieldElemIds(p,$L("#"+c+"_rlContainer")),m=[];for(var v in u)u.hasOwnProperty(v)&&(m=m.concat(u[v]));i[c]=m}var g=objectUtils.getKeys(i),f=g.length;for(n=0;n<f;n++){var P=g[n],h=i[P];if(void 0!==h&&h.length>0){var C={isContinuous:s,relListId:P,fieldsArr:h,isFrmBP:!0};Crm.validateEntityAndShowErrorMsg(h,a[P],!0,void 0,!0,C);for(var w=objectUtils.getKeys(Crm.requestParamWithColname),F=h.length,b=0;b<F;b++){var I=h[b],T=$L("#"+I),E=$L("#"+I+"_label"),L=T.attr("data-colname");if(0===E.length&&(E=$L("#Crm_"+P+"_"+L+"_label")),!w.contains(L)&&E.hasClass("newmandatory"))return!0}}}}var _=$L("#transitionNotes");if(_.length>0&&$L("#transitionNotesDiv").find(".newmandatory").length>0&&""===_.val().trim())return!0;var y=$L("#transitionAttachDiv .labelValCreate");if(y.length>0&&$L("#transitionAttachDiv").find(".newmandatory").length>0){var R=void 0!==y[0]?y.eq(0):void 0;if(void 0!==R&&"true"!==R.attr("isAttachmentAdded"))return!0}var D=$L("#tagCruxContainer");if(D.length>0&&$L("#transitionTagsDiv").find(".newmandatory").length>0&&D&&0===D.e.component.getData("cxPropTags").length)return!0;var S=ProcessFlow.getFieldElemIds(e,$("#fieldsContainer"));for(var A in S){var O=S[A],N=O.length;Crm.validateEntityAndShowErrorMsg(O,t,!0,void 0,!0);for(w=objectUtils.getKeys(Crm.requestParamWithColname),n=0;n<N;n++){var M=O[n],x=(L=(T=$L("#"+M)).attr("data-colname"),(E=$L("#"+M+"_label")).parent());if(E.hasClass("newmandatory")&&!w.contains(L)&&!x.hasClass("nonExistentBPLayoutFld"))return!0}}var U=ProcessFlow.getCheckListDet(),B=U.length;for(n=0;n<B;n++){var k=objectUtils.getKeys(U[n])[0];if(!1===U[n][k])return!0}return!1},ProcessFlow.removeOptionalUnfilledFlds=function(e,t){var s=e.length,r=[];Crm.validateEntityAndShowErrorMsg(e,t,!0,void 0,!0);for(var o=objectUtils.getKeys(Crm.requestParamWithColname),i=0;i<s;i++){var a=e[i],n=$L("#"+a).attr("data-colname"),l=$L("#"+a+"_label");0===l.length&&(l=$L("#Crm_"+t+"_"+n+"_label")),(l.hasClass("newmandatory")||o.contains(n))&&(!l.hasClass("newmandatory")&&o.contains(n)&&""===Crm.requestParamWithColname[n]||r.push(a))}return r},ProcessFlow.performPostLRExecActions=function(){var e=$L("#multipleFieldsEditPop");if(e.length>0){var t=e.find(".bpLayoutRuleFldsContainer"),s=e.find(".bpLayoutRuleFlds"),r=$L("#bpsaveasdraft"),o=t.children().length,i=e.find(".LR").length;if(i>0||o>0){r.attr("lt-prop-disabled",!0);var a="";i!==e.find(".LR .bp-during-field").length&&(a=1===o?I18n.getMsg("crm.transition.lr.single.field"):I18n.getMsg("crm.transition.lr.multiple.field")),""!==a?(s.removeClass("hide"),s.text(a)):""===a&&0===o&&s.addClass("hide")}else s.addClass("hide"),t.addClass("hide"),0===i&&r.attr("lt-prop-disabled",!1)}},ProcessFlow.isValidLRFieldUIType=function(e,t){var s=!1,r=!1,o=void 0!==t;if(o){var i=CFRExec.relatedEntityMap[t],a=void 0!==CFRExec.getRelatedEntityMap(CFRExec.OPERATIONCONSTANT.VIEW)[t]?CFRExec.getRelatedEntityMap(CFRExec.OPERATIONCONSTANT.VIEW)[t].defaultvalue:i.defaultvalue;("Pick List"!==CFRExec.relatedEntityMap[t].type||""!==i.defaultvalue&&"-None-"!==i.defaultvalue&&""!==a||"REASON_FOR_LOSS"===i.colname)&&("Lookup"!==i.type||void 0!==i.defaultvalue&&""!==i.defaultvalue&&""!==a)&&("Currency"!==i.type||"null"!==i.defaultvalue&&i.defaultvalue!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING&&""!==a)&&("Boolean"!==i.type||"false"!==i.defaultvalue&&"false"!==a)&&(556===parseInt(i.uitype)||""!==i.defaultvalue&&""!==a||"REASON_FOR_LOSS"===i.colname)||(s=!0)}return[1,2,3,4,5,6,8,9,10,11,12,13,15,21,24,25,26,27,32,33,34,35,36,37,38,52,100,110,127,133,143,144,145,202,300,301,786,333,221,444,445].contains(parseInt(e))&&(r=!0),o?s&&r:r},ProcessFlow.getAfterTransCSArgs=function(e,t){var s={};return e.filter((e=>{!1===e.ParallelTrans&&e.TransitionRelId===t?s={id:e.TransitionRelId,name:e.TransitionName}:!0===e.ParallelTrans&&e.ParallelConnections.filter((e=>{e.TransitionRelId===t&&(s={id:e.TransitionRelId,name:e.TransitionName})}))})),s};