var DetailViewHandler=function(){var e={otherRestrictedFields:["Created_Time","Modified_Time"],readField:function(e,t){if("99"===e.uitype)return e.commentsArr;if("26"===e.uitype)return e.stageValue;if("51"===e.uitype)return e.pricingDetails;if(["User Lookup","OwnerLookup","Lookup"].includes(e.type))return e.defaultvalue.length?{name:e.defaultvalue,id:e.defaultid}:null;if("Multiselect Pick List"===e.type)return e.defaultvalue.length?e.defaultvalue.split(";"):[];if("DateTime"===e.type||"Date"===e.type||"Rollup_Summary"===e.type&&"date"===e.returntype||"Rollup_Summary"===e.type&&"datetime"===e.returntype)return t.find("[id^=value]").text().trim()||null;if("301"===e.uitype&&"Boolean"===e.type)return"true"===e.defaultvalue;if(["32","34","36","38"].includes(e.uitype)){var i=e.defaultvalue;return"32"!==e.uitype&&"38"!==e.uitype&&"52"!==e.uitype||(i=Search.reverseFormatNumber(i)),i.length?parseFloat(i):null}return["555","556"].includes(e.uitype)||["File Upload","Image Upload"].includes(e.type)||0===e.defaultvalue.length?null:e.defaultvalue.trim()},PageInfo:function(){var e=DetailViewHandler.Utils.get_current_module();return{module:moduleRecordMapping[e].api_name,record_id:DetailViewHandler.Utils.get_current_entity_id(),name:"record_detail"}},Form:function(){return{Read:function(){var e={};return returnJson.entityMapJson.forEach((t=>{e[t.sysRefName]=t.defaultvalue})),e}}},Field:{GetTerritoryApiName:function(){const e=store.peekRecord("module",moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].id).fields.find((e=>["Territories","Territory"].includes(e.api_name)));return e&&e.api_name},Get:function(t,i){const r=e.Field.GetTerritoryApiName();if(i&&r&&t===r)return!0;var a=DetailViewHandler.Utils.get_current_module();const n=store.peekRecord("module",moduleRecordMapping[a].id).fields.find((e=>e.api_name===t));if(!n)throw CScript.Error("no such field present - "+t);if("subform"===n.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===n.data_type)return{dataType:n.data_type,element:$L("#secDiv_"+t),fields:DetailViewHandler.Utils.is_lyte_enabled()?[]:returnJson[a].subforms.section[0].FL[0],id:n.subform.id};if(DetailViewHandler.Utils.is_lyte_enabled()?!DetailViewHandler.Utils.is_supported_field(n):"undefined"!=typeof returnJson&&returnJson&&!returnJson.entityMapJson[n.column_name])throw CScript.Error("field not supported - "+t);return{ui_type:n.ui_type,dataType:n.subform?"aggregate":n.data_type,element:n.subform?$L("#tr_"+n.column_name):$("#mouseArea__"+n.column_name),colname:n.column_name,id:n.id,record:n}},checkVisibilityOfSectionsSections:function(e){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];returnJson[t].section.forEach((t=>{var i=t.systemName,r=0;t.FL.forEach((t=>{t.colname===e&&(r+=1),$("#mouseArea__"+t.colname).is(":visible")&&(r+=1)})),0===r?(i=i.replace(/[^\w\s']/g,"\\$&").replace(/['\s]/g,"_"),$("#secDiv_"+i).hide()):(i=i.replace(/[^\w\s']/g,"\\$&").replace(/['\s]/g,"_"),$("#secDiv_"+i).show())}))},Hide:function(t){if(DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,i)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"show_hide",field:t,promise:{resolve:e,reject:i},config:{value:"hide"}})}));var i=e.Field.Get(t);$("#header_"+i.colname).parent("tr").hide(),i.element.hide();const r=i.element.closest("[id^='secDiv']");!(r.find('span[id^="value_"]:visible').length>0)&&r.hide(),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].visible=!1},Show:function(t){if(DetailViewHandler.Utils.is_lyte_enabled())return Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"show_hide",field:t,config:{value:"show"}}),!0;var i=e.Field.Get(t);$("#header_"+i.colname).parent("tr").show(),i.element.show(),i.element.closest("[id^='secDiv']").css("display","block"),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].visible=!0},Mask:function(t,i){var r=e.Field.Get(t);if(r.element.length>0){if(e.otherRestrictedFields.indexOf(t)>-1||["profileimage","imageupload","fileupload","boolean","subform","static_subform"].indexOf(r.dataType)>-1||[250].indexOf(r.ui_type)>-1)throw CScript.Error("field not supported for masking - "+t);if(!DetailViewHandler.Utils.is_lyte_enabled()&&Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module())&&Lyte.triggerEvent("detail_view_masking_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{field:t,config:i}),DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"masking",field:t,promise:{resolve:e,reject:r},config:i})}));var a,n,l=$("#headervalue_"+r.colname),o=l.find("#subvalue_"+r.colname);if(["ownerlookup","lookup","multiselect lookup","multiuserlookup","userlookup"].indexOf(r.dataType)>-1||"LAYOUTID"===r.colname){if(r.element.unbind("mouseover"),r.element.removeAttr("onmouseover"),a=r.element.find("lookup"!==r.dataType?"[data-fieldid="+r.id+"]":"a[id^='subvalue']"),"ownerlookup"===r.dataType||"userlookup"===r.dataType){var s=a.find("crux-user-tooltip");s.length>0&&s.remove(),a.unbind("mouseover")}const e=r.element.find("span[id^='value']");e.length>0&&(e.removeAttr("onclick"),("ownerlookup"===r.dataType||"LAYOUTID"===r.colname)&&e.addClass("cscriptMasked")),a.length>0&&(a.removeAttr("href"),a.unbind("click"),a.removeAttr("onclick"),a.removeAttr("onmouseenter"),a.removeAttr("onmouseout"),a.removeAttr("data-cid")),(n=l).length>0&&(n.unbind("mouseover"),("ownerlookup"===r.dataType||"LAYOUTID"===r.colname)&&n.addClass("cscriptMasked"))}else"website"===r.dataType?(a=r.element.find("a[id^='subvalue']"),n=$("#header_"+r.colname).find("#subvalue_"+r.colname)):(a=r.element.find("[id^='subvalue']"),n=$("#header_"+r.colname).find("#subvalue_"+r.colname));n.addClass("cDefault");const c=$(`#header_${r.colname}`);c.addClass("cDefault"),c.find(`#value_${r.colname}`).addClass("cDefault"),a.addClass("cDefault"),r.element.find(`#header_${r.colname}`).addClass("cDefault"),r.element.find(`#value_${r.colname}`).addClass("cDefault"),r.element.find(`#subvalue_${r.colname}`).addClass("cDefault"),"email"===r.dataType&&(n&&n.length&&(n[0].removeAttribute("href"),n.hasClass("cscriptMasked")||(n.addClass("cscriptMasked"),n.attr("cscriptActualValue",a.text().trim()))),a.hasClass("cscriptMasked")||(a.addClass("cscriptMasked"),a.attr("cscriptActualValue",a.text().trim()))),"phone"===r.dataType&&($(`#headervalue_${r.colname}`).find("zpb-phone").remove(),$(`span#value_${r.colname}`).find("zpb-phone").remove());var d=a.text().trim();d=i.reverse?d.substring(0,d.length-i.length)+(i.length<d.length?i.character.repeat(i.length):i.character.repeat(d.length)):(i.length<d.length?i.character.repeat(i.length):i.character.repeat(d.length))+d.substring(i.length),a.text(d),a.removeClass("link"),a.removeAttr("href"),n&&n.text(d),o.text(d);try{e.Field.ReadOnly(t,!0)}catch(e){murphy.error(err)}detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].mask=i}},MaxLength:function(t,i){var r=e.Field.Get(t);if(r.element.length>0){if(e.otherRestrictedFields.indexOf(t)>-1)throw CScript.Error("max length action not supported for field - "+t);if(["profileimage","imageupload","fileupload","picklist","multiselect picklist","date","datetime","lookup","userlookup","ownerlookup","boolean"].indexOf(r.dataType)>-1)throw CScript.Error("max length action not support for field - "+t);if(DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"max_length",field:t,promise:{resolve:e,reject:r},config:{value:i}})}));var a=JSON.parse(r.element.attr("data-params"));a.maxlength=i,r.element.attr("data-params",JSON.stringify(a))}detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].maxLength=i},ReadOnly:function(t,i){const r=e.Field.Get(t);if(r.element.length>0){if(DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"read_only",field:t,promise:{resolve:e,reject:r},config:{value:i}})}));if(556===r.ui_type){let e=$L(`#Image_${r.id}`)[0];e&&e.component.setData("readonly",i)}const e=r.element.attr("data-params");if(!e)throw CScript.Error("field not supported - "+t);if("ownerlookup"===r.dataType){var a=$(r.element),n=$("#headervalue_"+r.colname);const e=$("#headervalue_SMOWNERID").find("#ownerName_id");var l=$("#header_"+r.colname).find("#subvalue_"+r.colname);i?(a.closest(".tabDiv").addClass("readOnlyFld"),n.addClass("cscriptMasked readOnlyFld"),e.addClass("readOnlyFld"),l.addClass("cDefault")):(a.closest(".tabDiv").removeClass("readOnlyFld"),n.removeClass("cscriptMasked readOnlyFld"),e.removeClass("readOnlyFld"),l.removeClass("cDefault"))}var o=JSON.parse(e);o.readonly=i,r.element.attr("data-params",JSON.stringify(o))}detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),208===r.ui_type&&(returnJson.layout_jsonarrayObj.showChange=i,i?($("#headervalue_LAYOUTID").addClass("lockedRecordEnb"),$("#header_LAYOUTID").attr({onclick:"sE(event);"}),r.element.addClass("zcLockedLayout dvLayoutReadOnly"),r.element.find("#value_LAYOUTID").attr({onclick:"sE(event)"})):(r.element.removeClass("zcLockedLayout dvLayoutReadOnly"),$("#headervalue_LAYOUTID").removeClass("lockedRecordEnb"),$("#header_LAYOUTID").attr({onclick:"triggerClickEvent(event);sE(event);"}),r.element.find("#value_LAYOUTID").attr({onclick:"triggerClickEvent(event);sE(event);"}))),detailView.cscriptFieldAttribs[t].readOnly=i},Style:{Add:function(t,i){var r=e.Field.Get(t);if(r){if(e.otherRestrictedFields.indexOf(t)>-1)throw CScript.Error("styling not supported for field - "+t);if(i.borderColor&&!/^#[0-9A-F]{6}$/i.test(i.borderColor))throw CScript.Error("Invalid border color code: "+i.borderColor);if(i.backgroundColor&&!/^#[0-9A-F]{6}$/i.test(i.backgroundColor))throw CScript.Error("Invalid background color code: "+i.backgroundColor);if(i.foregroundColor&&!/^#[0-9A-F]{6}$/i.test(i.foregroundColor))throw CScript.Error("Invalid foreground color code: "+i.foregroundColor);var a={border:i.borderColor?i.borderColor+" 1px solid":"","background-color":i.backgroundColor||"","font-weight":i.fontWeight||"",color:i.foregroundColor||""};const d=function(e){e.css({...i.foregroundColor&&{color:i.foregroundColor},...i.backgroundColor&&{"background-color":i.backgroundColor,"border-color":i.backgroundColor}})};if(DetailViewHandler.Utils.is_lyte_enabled()){"COMMENTCONTENTS"===r.colname&&(d(r.element.find(".commentSection")),d(r.element.find(".commentedBy")),d(r.element.find(".commentText")),i.backgroundColor&&r.element.find(".commentInfoWrapper").css({"border-color":i.backgroundColor})),$L(`#ajaxEdit_${r.colname}`).css(a);var n=$L("crm-detail-view")[0];if(n){var l=n.component.getData("cscript_properties"),o=l[t]?objectUtils.cloneObject_new(l[t]):{};o.style=a,n.component.setData("cscript_properties."+t,o)}}else{var s=r.element.find("span#value_"+r.colname);"COMMENTCONTENTS"===r.colname?(d(r.element.find(".commentText")),d(r.element.find(".commentDesc")),i.backgroundColor&&s.find(".commentSection").css({"border-color":i.backgroundColor})):a.color=i.foregroundColor||"",s.css(a)}}detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].style=i}},ToolTip:{Add:function(t,i){var r=e.Field.Get(t);if(r){if(i.length>255)throw CScript.Error("maximum length of the message exceeded 255 characters");if(DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"add_tooltip",field:t,promise:{resolve:e,reject:r},config:{value:i,type:"Static Text"}})}));""===i?r.element.removeAttr("title"):r.element.attr("lt-prop-title",i).attr("lt-prop-tooltip-config",'{ "position" : "top" }'),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].tooltip=i}},Remove:function(t){var i=e.Field.Get(t);i&&(i.element.removeAttr("title"),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].tooltip=void 0)}},Info:{Add:function(t,i){var r=e.Field.Get(t);if(r){if(i.length>255)throw CScript.Error("maximum length of the message exceeded 255 characters");if(DetailViewHandler.Utils.is_lyte_enabled())return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"add_info_icon",field:t,promise:{resolve:e,reject:r},config:{value:i,type:"Info Icon"}})}));var a;for(key in returnJson.entityMapJson)returnJson.entityMapJson[key].sysRefName===t&&(a=returnJson.entityMapJson[key].colname);var n=$('<i class="icon_roundinfo infotoolTip mL5 dIB vaM cP" fldtooltip="'+i+'"></i>');r.element.find("span#labelTD_"+a).append(n),r.element.addClass("containTooltip"),crmTemplate.bindFldTooltip(),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].info=i}},Remove:function(t){var i=e.Field.Get(t);if(i){var r;for(key in returnJson.entityMapJson)returnJson.entityMapJson[key].sysRefName===t&&(r=returnJson.entityMapJson[key].colname);$L("span#labelTD_"+r).find("i").length&&$L("span#labelTD_"+r).find("i")[0].remove(),i.element.removeClass("containTooltip"),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].info=void 0}}},Read:function(t){if(DetailViewHandler.Utils.is_lyte_enabled()){let e=$L("crm-blueprint-layer");if(e.is(":visible")&&e.length>0){let i=e[0].getData("processInfo");if(i&&i.field.api_name===t)return i.current_picklist.value}var i={};return new Promise(((e,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"get_value",field:t,promise:{resolve:e,reject:r},valueObj:i})})).then((function(){return i.value}))}const r=e.Field.GetTerritoryApiName(),a=returnJson.TransitionDetails&&returnJson.TransitionDetails.ProcessFieldId&&store.peekRecord("field",returnJson.TransitionDetails.ProcessFieldId).api_name;if(a&&t===a)return returnJson.TransitionDetails.CurrentStateDisplayValue;if(r&&t===r)return returnJson[DetailViewHandler.Utils.get_current_module()].terrDetails.map((e=>({name:e.territoryName,canRemove:e.canRemove,id:e.territoryId})));var n=e.Field.Get(t);if(("subform"===n.dataType||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===n.dataType)&&n.fields){for(var l=returnJson[DetailViewHandler.Utils.get_current_module()].subforms.section.filter((function(e){if(e.subFormTabId===n.id)return!0})),o=l[0].FL,s=o.length,d=[],c=0;c<s;c++){var u=o[c],m={};u.each((function(i){var r;"Date"!==i.type&&"DateTime"!==i.type||(r=e.Field.Get(t).element),m[i.sysRefName]=e.readField(i,r)})),d.push(m)}return d}if(n){var p,_=returnJson.entityMapJson[Object.keys(returnJson.entityMapJson).find((e=>returnJson.entityMapJson[e].sysRefName===t))];return("Date"===_.type||"DateTime"===_.type||"Rollup_Summary"===_.type&&"date"===_.returntype||"Rollup_Summary"===_.type&&"datetime"===_.returntype)&&(p=e.Field.Get(t).element),e.readField(_,p)}},GetValue:function(e){if(DetailViewHandler.Utils.is_lyte_enabled()&&$L("#bp-exec-popup-div").is(":visible"))return Lyte.registeredMixins["crm-blueprint-exec-mixin"].getBpComponentDataForField(e);const t=returnJson.TransitionDetails&&returnJson.TransitionDetails.ProcessFieldId&&store.peekRecord("field",returnJson.TransitionDetails.ProcessFieldId).api_name;if(t&&e===t)return returnJson.TransitionDetails.CurrentStateDisplayValue;var i=$L("[cscript-tag='"+e+"']");if(0===i.length)return null;var r=null,a=i.prop("type"),n=i.attr("data-content-type");switch(a){case"text":if("Lookup"===n){var l=i.val(),o=i[0].dataset.selectedid;l&&o?((r={}).name=l,r.id=o):r=null}else r=i.val()||null;break;case"checkbox":r=i.is(":checked");break;case"datetime":r=CrmDateUtils.convertDateAndTimeApiFormatToUserViewFormat(i.val());break;case"date":r=CrmDateUtils.convertDateToUserPattern(i.val());break;default:"Lookup"===n?133===i.data().uitype?(l=i.val(),o=i.data("selectedid"),r=l&&o?{name:l,id:o}:null):store.peekRecord("user",i.data("id"))&&(r={id:i.data("id"),name:store.peekRecord("user",i.data("id")).full_name}):r=26===i.data().uitype?i.val().split(":")[1]:i[0]instanceof HTMLSpanElement?i.text():i.val()||null}return r},SetValue:async function(e,t,i){if(DetailViewHandler.Utils.is_lyte_enabled()&&$L("#bp-exec-popup-div").is(":visible")){(_={})[e]=t;var r=$L("crm-blueprint-exec-popup")[0];if(r){var a=Lyte.registeredMixins["crm-create-mixin"],n=r.component.data,l=n.record,o=n.currentInstObjKey,s=store.modelFor(l.$.model._name).fieldList;if(_){for(const[t,i]of Object.entries(_))if(s[t]){var d=store.peekRecord("field",s[t].fieldID);if(d&&(!d.read_only||d[o].isCscriptReadOnly)&&d.visible){var c="crm-blueprint-exec-fields#Crm_"+n.module+"_"+d.column_name+"_field";if(0===$L(c).length)throw CScript.Error(`no such field present: ${e}`);var u={key:t,value:i,fldInfo:d,dataBind:l,moduleName:n.module,selectorString:c,source:"Blueprint",cscriptFullFormData:_};await Lyte.registeredMixins["crm-detailview-common-utils"].setCscriptDataForLyteContainer(c,u)}else if(this.isInventoryModule(currentModuleName)&&"Discount"===t&&d&&"DISCOUNT"===d.column_name&&s.Discount&&"DISCOUNT"===s.Discount.columnName){let e="#AggFld_"+currentModuleName+"_Discount",o={fieldApiName:t,value:i,recordData:l,isGrandDiscount:!0,currentPage:n.initRoute,moduleName:currentModuleName,cscriptFullFormData:_,layoutCompData:n,discFieldSelector:e};await this.cScriptDiscountFieldHandler(o);let s=r.querySelector("crm-blueprint-exec-fields");s&&s.component&&a.checkLayoutrules(s)}}var m=n&&n.moduleFormulafields;(m=m||[])&&m.length&&m.length&&await a.formulaWorkerExecution(m,{},l,void 0,!0)}}return}if(DetailViewHandler.Utils.is_lyte_enabled()){var p,_,f=$L("crm-quick-create-listing")[0],g=$L("crm-detail-view")[0].component,v=!1;if(!0===g.data.ajax_edit_in_progress&&g.data.ajaxEditFieldMeta.api_name===e&&(v=!0),!f){if(v)return void $L("#subvalue_"+g.data.ajaxEditFieldMeta.column_name)[0].component.setData("cxPropValue",t);p="unsupported action"}if(!p){g.data.field_apiname_map||g.populateFldApiNameMap(g.data.layout,g);var h=store.peekRecord("field",g.data.field_apiname_map[e]),y="crm-create-fields#"+DetailViewHandler.Utils.get_current_module()+"_fldRow_"+h.column_name,w=$L(y);w[0]&&w[0].checkVisibility()||(p="unsupported action")}(_={})[e]=t;var b=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(p)throw CScript.Error(p);return b?void await Lyte.registeredMixins["crm-create-mixin"].formHandlerWrapperForLyteConversion(b,_):void 0}var D=$("[cscript-tag='"+e+"']");const C=D.length;let k;const L=$("#formRuleMandatoryFields"),V=$("#multipleFieldsEditPop"),T=$("#closedWon"),F=L.is(":visible")||V.is(":visible")||T.is(":visible");if(0===C)k=F?`no such field present: ${e}`:"unsupported action";else{const t=CScript.Utils.get_config_by_apiname(_cscript._info.definition_name).events().field.list().map((e=>e.event)),r=_cscript._snippet_uuid_vs_event_map[i]&&_cscript._snippet_uuid_vs_event_map[i].event;t.includes(r)||L.find(`[cscript-tag='${e}']`).length||V.find(`[cscript-tag='${e}']`).length||T.find(`[cscript-tag='${e}']`).length||(k="unsupported action")}if(k)throw CScript.Error(k);var S=D.attr("data-content-type");if(!D.data().readonly&&117!==D.data().uitype&&116!==D.data().uitype)switch(S){case"Text":t?D.val((""+t).slice(0,D.data().maxlength)):D.val(t);break;case"Lookup":if(t){if(t.constructor===Object){var A=t.id,H=t.name;D.data("id",A),D.val(H),D[0]&&D[0].dataset&&(D[0].dataset.selectedid=A)}}else D.data("id",""),D.val("");break;case"User Lookup":t?t.constructor===Object&&(D.data("id",t.id),D[0].component.executeMethod("onSelect",event,store.peekRecord("user",t.id))):(D.data("id",""),D.val(""));break;case"TextArea":D.val(t);break;case"Boolean":"boolean"==typeof t&&D.prop("checked",t);break;case"Multiselect Pick List":Array.isArray(t)&&(populatePicklist(D,t),D.val(t));break;case"Pick List":if("string"==typeof t||2===D.data().uitype&&null===t)if(t=null===t||"-None-"===t?"":t,26===D.data().uitype)(t=D.data().values.find((e=>e===t)))&&D.val()!=t.value&&(populatePicklist(D,[t]),D.val(t),renderingUtils.triggerEvent("change",D));else{if(""!==t&&!D.data().values.contains(t)&&!D.data().values.find((e=>e.content===t)))throw CScript.Error("invalid picklist option - "+t);D.val()!=t&&(populatePicklist(D,[t]),D.val(t),renderingUtils.triggerEvent("change",D))}break;case"Currency":D.val(t),crmTemplate.calculationProcessArea(D),setTimeout((()=>{const e=D.siblings().find(".resultValue");"hidden"!==e.css("visibility")&&e.click()}),500);break;default:if(!S&&D&&D[0]&&D[0].component&&"CRUX-TEXT-AREA-COMPONENT"===D[0].tagName){3!==D.data("uitype")&&110!==D.data("uitype")||D[0].component.setData("cxPropValue",t);break}"Lookup"===S&&8===D.data().uitype?t?t.constructor===Object&&store.peekRecord("user",t.id)&&(D[0].component?D[0].component.executeMethod("onSelect",event,store.peekRecord("user",t.id)):(D.data("id",t.id),D.val(store.peekRecord("user",t.id).full_name))):(D.data("id",""),D.val("")):D.val(t)}},GetOptions:function(t){var i=e.Field.Get(t),r=i.element;if("picklist"===i.dataType||"multiselectpicklist"===i.dataType){if(DetailViewHandler.Utils.is_lyte_enabled())return i.record.pick_list_values.map((({id:e,display_value:t,actual_value:i})=>({..."-None-"!==i&&{id:e,filtered:!1},display_value:t,actual_value:i})));var a=r.data("params"),n=[];if(a.parentlabel&&""!==a.parentlabel&&a.parentcolname&&a.colname){var l=returnJson.entityMapJson[a.parentcolname].defaultvalue;l=""!==l?l:"-None-",n=JSON.parse(returnJson[DetailViewHandler.Utils.get_current_module()].fieldDependency)[a.parentcolname][a.colname][l]}var o=a.filteredoptions?a.filteredoptions:[],s=[];return"26"===a.uitype&&(a.picklistmap=[],a.val.forEach((e=>{var t={};e&&e.stageId&&(t.oldvalue=e.stageId),t.uservalue=e.content?e.content:e.html,t.systemvalue=e.name?e.name:e.html,a.picklistmap.push(t)}))),a.picklistmap.forEach((e=>{if(0===n.length||-1!==n.indexOf(e.uservalue)){var t=e.optionId?e.optionId:e.oldvalue;t?s.push({id:t,actual_value:e.systemvalue,display_value:e.uservalue,filtered:o.indexOf(e.optionId)>-1}):s.push({actual_value:e.systemvalue,display_value:e.uservalue})}})),s}throw CScript.Error("action supported only for picklist and multiselect picklist fields")},SetOptions:function(t,i){var r=e.Field.Get(t),a=r.element;if("picklist"!==r.dataType&&"multiselect picklist"!==r.dataType)throw CScript.Error("action supported only for picklist and multiselect picklist fields");var n=[],l=a.data("params"),o=[];l.picklistmap.forEach((e=>{e.oldvalue&&o.push(e.oldvalue),e.optionId&&o.push(e.optionId)})),i.forEach((e=>{e.id&&-1!==o.indexOf(e.id)&&n.push(e.id)})),l.filteredoptions=n,a.data("params",l),returnJson.entityMapJson[l.colname].filteredoptions=n},SetCriteria:async function(t,i,r){var a=e.Field.Get(t),n=a.element;if(null==i||""===i)throw CScript.Error("invalid criteria");if(i.startsWith("(")||""===i||(i="("+i+")"),"lookup"!==a.dataType&&"multiselectlookup"!==a.dataType&&"userlookup"!==a.dataType&&"multiuserlookup"!==a.dataType&&"ownerlookup"!==a.dataType)throw CScript.Error("criteria can be set only to Lookup and Multiselect Lookup fields");{var l=n.data("params");const e={criteria:i,...r&&r.filterOnSearch&&{filterOnSearch:r.filterOnSearch}};if(DetailViewHandler.Utils.is_lyte_enabled()){switch(a.dataType){case"multiuserlookup":case"userlookup":await CriteriaHandler.init("Users"),CriteriaHandler.validate(i);const t=CriteriaHandler.convert_to_search_criteria(CriteriaHandler.convert_to_filter_criteria(i,"lookup_criteria"),"lookup_criteria");e.userCriteria=JSON.stringify([...CriteriaHandler.convert_to_search_criteria_json(t,"lookup_criteria")]);break;case"multiselectlookup":case"lookup":await CriteriaHandler.init(a.record.lookup.module.api_name),CriteriaHandler.validate(i),e.criteriaObj=[...CriteriaHandler.convert_to_search_criteria_json(i,"adv_lookup_criteria")]}if($L("#bp-exec-popup-div").is(":visible")){let t=document.querySelector("crm-blueprint-exec-popup").getData("fieldVsComponentId")[a.id],i=document.getElementById(t);i&&(e.criteriaObj?(i.cxProp("defaultCriteria",e.criteriaObj),$L(i).closest("crm-blueprint-exec-fields")[0].setData("cscriptCriteria",e)):e.userCriteria&&i.cxProp("criteria",e.userCriteria))}return new Promise(((i,r)=>{Lyte.triggerEvent("detail_view_csript_listener_"+DetailViewHandler.Utils.get_listener_id(),{event:"field",type:"set_criteria",field:t,promise:{resolve:i,reject:r},config:{...e}})}))}if("8"===(l=n.data("params")).uitype||"221"===l.uitype){await CriteriaHandler.init("Users"),CriteriaHandler.validate(i);const e=CriteriaHandler.convert_to_search_criteria(CriteriaHandler.convert_to_filter_criteria(i,"lookup_criteria"),"lookup_criteria");l.userCriteria=[...CriteriaHandler.convert_to_search_criteria_json(e,"lookup_criteria")],l.userSearchCriteria=i}else{await CriteriaHandler.init(l.lookupmodule),CriteriaHandler.validate(i),l.criteria=JSON.stringify(e);const t=CriteriaHandler.convert_to_search_criteria_json(i,"adv_lookup_criteria");n.attr("data-criteria-str",i),n.data("criteria-obj",t),l&&$L("#multipleFieldsEditPop").is(":visible")&&$L("#Crm_"+l.module+"_"+l.colname).length>0&&$L("#Crm_"+l.module+"_"+l.colname).attr("data-criteria",l.criteria)}n.attr("data-params",JSON.stringify(l)),n.data("params",l),detailView.cscriptFieldAttribs[t]||(detailView.cscriptFieldAttribs[t]={}),detailView.cscriptFieldAttribs[t].criteria={criteria:i,config:r}}},field_set_folder_id:async function(e,t,i){detailView.cscriptFieldAttribs&&(detailView.cscriptFieldAttribs={}),detailView.cscriptFieldAttribs[e]&&(detailView.cscriptFieldAttribs[e]={}),detailView.cscriptFieldAttribs[e].workdriveFolderId=t}},Form:{Read:function(){if(DetailViewHandler.Utils.is_lyte_enabled()){const e=DetailViewHandler.Utils.get_current_record();return DetailViewHandler.Utils.serialize_record(e)}var t=Object.keys(returnJson.entityMapJson),i={};if(t.forEach((function(t){var r,a=returnJson.entityMapJson[t];a.uitype&&"209"!==a.uitype&&("Date"!==a.type&&"DateTime"!==a.type||(r=e.Field.Get(a.sysRefName).element),i[a.sysRefName]=e.readField(a,r))})),returnJson[DetailViewHandler.Utils.get_current_module()].terrDetails&&(i[e.Field.GetTerritoryApiName()]=returnJson[DetailViewHandler.Utils.get_current_module()].terrDetails.map((e=>({name:e.territoryName,canRemove:e.canRemove,id:e.territoryId})))),returnJson.TransitionDetails&&returnJson.TransitionDetails.ProcessFieldId&&(i[store.peekRecord("field",returnJson.TransitionDetails.ProcessFieldId).api_name]=returnJson.TransitionDetails.CurrentStateDisplayValue),returnJson[DetailViewHandler.Utils.get_current_module()].subforms){var r=DetailViewHandler.Utils.get_current_module(),a=store.peekRecord("module",moduleRecordMapping[r].id).fields,n={};a.forEach((function(e){("subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type)&&(n[e.subform.id]=e.api_name)})),returnJson[DetailViewHandler.Utils.get_current_module()].subforms.section.forEach((function(t){var r=t.FL,a=r.length,l=[];const o={};for(var s=0;s<a;s++){var d={};r[s].each((function(t){"Date"===t.type||"DateTime"===t.type?(o[t.colname]||(o[t.colname]=document.querySelectorAll(`#subvalue_${t.colname}`)),d[t.sysRefName]=o[t.colname][s]?o[t.colname][s].textContent.trim():null):d[t.sysRefName]=e.readField(t)})),l.push(d)}i[n[t.subFormTabId]]=l}))}return i}},Section:{GetAll:function(){return returnJson.Leads.section.map((function(e){return{name:e.displaylabel,id:e.section_id}}))},Get:function(e){var t=returnJson.Leads.section.filter((function(t){if(t.section_id===e)return!0}));if(0===t.length)throw CScript.Error("no such section present");return $L("#secDiv_"+t[0].displaylabel.replace(/ |'/g,"_"))},GetName:function(e){var t=returnJson.Leads.section.filter((function(t){if(t.section_id===e)return!0}));if(0===t.length)throw CScript.Error("no such section present");return t[0].displaylabel},Hide:function(t){e.Section.Get(t).hide()},Show:function(t){e.Section.Get(t).show()}},Tag:{checkLinkingModule:function(){if(crmTab.isLinkingModule(DetailViewHandler.Utils.get_current_module()))throw CScript.Error("Tags are not supported in Linking Modules")},Get:function(){e.Tag.checkLinkingModule();var t=$L("crm-detailview-tag");if(t.length>0){var i=[],r=t[0].component.getData("selectedtags"),a=[];return r.forEach((e=>{-1===i.indexOf(e.name)&&(i.push(e.name),a.push({name:e.name}))})),a}},Remove:async function(t){if(e.Tag.checkLinkingModule(),(i=$L("crm-detailview-tag")).find(".addPermissionDenied").length)throw CScript.Error("permission denied");if(i.length>0){for(var i,r=(i=i[0].component).getData("selectedtags"),a=[],n=r.length,l=0;l<n;l++)t.contains(r[l].name)?Lyte.arrayUtils(i.getData("tagarray"),"push",r[l]):a.push(r[l]);if(i.setData("selectedtags",a),i.setData("removedTags",t.toString()),0===a.length){try{await store.triggerAction("tag","remove_tags",{tag_names:t.toString(),id:DetailViewHandler.Utils.get_current_entity_id(),over_write:!0,type:"POST",fromPage:"view",fromClient:"true",module:moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].api_name,action:"remove_tags"})}catch(e){i.setData("saveEnabled",!1)}i.setData({selectedtags:[],displaytags:[]}),DetailViewHandler.Utils.is_lyte_enabled()||(CrmTags.clientJSON.value=[]),commonUtils.showHideLoadingDiv(!1),document.getElementById("detailview_add_tag").ltProp("show",!1)}else await e.Tag.saveTags()}},Add:async function(t){if(e.Tag.checkLinkingModule(),(i=$L("crm-detailview-tag")).find(".addPermissionDenied").length)throw CScript.Error("permission denied");if(i.length>0){var i=i[0].component,r=t.length,a=i.getData("selectedtags");const o=new Set(a.map((e=>e.name))),s=t.filter((e=>!o.has(e))).length,d=i.getData("recordTagCount");if(a.length+s>d)throw CScript.Error(`Can't add more than ${d} for a record`);const c=[];let u=!1;for(var n=0;n<r;n++){if(!/\d/.test(t[n])&&!/[a-zA-Z]/.test(t[n]))throw CScript.Error(`need atleast one alphanumeric character in tag - ${t[n]}`);if(t[n].length>25)throw CScript.Error(`maximum tag length is 25 - ${t[n]}`);if(!o.has(t[n])){var l={name:t[n]};i.getData("tagnames").contains(t[n])||(l.isNewTag=!0,u=!0),c.push(l)}}c.length&&(Lyte.arrayUtils(a,"push",c),await e.Tag.saveTags(u))}},AddPartial:function(e,t){e.setData("tagnames",[]),e.setData("tagarray",[]);for(var i=e.getData("selectedtags"),r=i.length,a=[],n=0;n<r;n++)a.push(i[n].name);return e.setData("selectedtags",[]),store.findAll("tag",{module:t}).then((function(t){for(var i=t.length,r=0;r<i;r++){var n=t[r].name;Lyte.arrayUtils(e.getData("tagnames"),"push",n),Lyte.arrayUtils(e.getData("tagarray"),"push",{name:n,id:t[r].id,color_code:t[r].color_code}),a.contains(n)&&Lyte.arrayUtils(e.getData("selectedtags"),"push",{name:n})}void 0!==e.getData("selectedtags")&&0!==e.getData("selectedtags").length||e.setData("saveEnabled",!0),e.setData("displaytags",e.getData("selectedtags").slice()),commonUtils.showHideLoadingDiv(!1),e.setData("saveEnabled",!1),document.getElementById("detailview_add_tag").ltProp("show",!1)}))},saveTags:async function(t){const i=$L("crm-detailview-tag");if(i.length>0){let p=!1;var r=i[0].component;CrmTags.edited=!1;var a=r.getData("selectedtags"),n=a.length;if(r.setData("saveEnabled",!0),commonUtils.showHideLoadingDiv(!0),n&&t){var l=r,o=moduleRecordMapping[l.getData("module")].api_name;for(let e=0;e<n;e++)a[e].isNewTag&&store.createRecord("tag",{name:a[e].name});try{const t=(await store.create("tag",void 0,void 0,{module:o,fromPage:"view"})).tag;if(store.unloadAll("tag"),JSON.stringify(t).includes("symbols are not allowed"))return await e.Tag.AddPartial(l,o),!1;for(var s=t.length,d=l.getData("tagnamevstagid"),c=l.getData("tagnamevsmodrefid"),u=0;u<s;u++){Lyte.objectUtils(l.getData("idvsname"),"add",t[u].modRefId,t[u].name),d[t[u].name]=t[u].id,c[t[u].name]=t[u].modRefId;var m=t[u].name;l.getData("tagnames").indexOf(m)&&Lyte.arrayUtils(l.getData("tagarray"),"push",{name:m}),Lyte.arrayUtils(l.getData("tagnames"),"push",m)}l.setData("tagnamevstagid",d),l.setData("tagnamevsmodrefid",c)}catch(t){t.response.includes("LICENSE_LIMIT_EXCEEDED")&&(await e.Tag.AddPartial(l,o),p=!0)}}if(await new Promise((e=>{r.addTags({is_cscript:!0,resolve_cscript:e})})),p)throw CScript.Error("Reached the maximum number of Tags that can be used per module")}},Hide:function(){$L("crm-detailview-tag").hide()},Show:function(){$L("crm-detailview-tag").show()}},Navigate:{Next:function(){var e=$L("#detailNext")[0];crmNavig.navigateRecord(void 0,e,void 0)},Previous:function(){var e=$L("#detailPrevious")[0];crmNavig.navigateRecord(void 0,e,void 0)}},Blueprint:{Hide:function(){$L("#pb_processButtonLayer").hide()},Show:function(){$L("#pb_processButtonLayer").show()},GetCurrentState:function(){return{CurrentStateValue:returnJson.TransitionDetails.CurrentStateDisplayValue,CurrentStateId:returnJson.TransitionDetails.CurrentStateId}},getBlueprintTransitions:function(){var e=DetailViewHandler.Utils.get_current_entity_id();if(DetailViewHandler.Utils.is_lyte_enabled()){let e=$L("crm-blueprint-layer")[0];if(e&&e.component)return e.component.data.normalTransitions.filter((e=>e.criteria_matched)).map((({id:e,name:t})=>({id:e,name:t})))}else if(ProcessFlow.recordIdVsTransitionDetails&&ProcessFlow.recordIdVsTransitionDetails[e])return ProcessFlow.recordIdVsTransitionDetails[e].Transitions.filter((e=>e.IsCriteriaMatched&&!e.IsAutoTrans&&e.IsAccessible)).map((e=>({id:e.TransitionRelId,name:e.TransitionName})));return[]},getBlueprintTransitionById:function(e){const t=this.getBlueprintTransitions().find((t=>t.id===e));if(!t)throw CScript.Error("Transition not found");return t},initiateTransition:function(e,t){var i=DetailViewHandler.Utils.get_current_entity_id(),r=DetailViewHandler.Utils.get_current_module();if(DetailViewHandler.Utils.is_lyte_enabled()){if($L("crm-blueprint-exec-popup")[0])throw CScript.Error("Already a transition in progress");const t=$L("crm-blueprint-layer")[0];if(t&&t.component){if(!t.component.data.normalTransitions.find((t=>t.id===e)))throw CScript.Error("Transition not found");const i=Object.values($L("crm-blueprint-exec-transition")).find((t=>t.component&&t.component.getData("transition")&&t.component.getData("transition").id===e));i.component.actions.doTransition.call(i.component)}}else{if($("#multipleFieldsEditPop").is(":visible"))throw CScript.Error("Already a transition in progress");if(!ProcessFlow.recordIdVsTransitionDetails.hasOwnProperty(i))throw CScript.Error("Transition not found ");var a=ProcessFlow.recordIdVsTransitionDetails[i];1===a.Transitions.filter((function(t){return t.IsCriteriaMatched&&!t.IsAutoTrans&&t.TransitionRelId===e})).length&&(t?ProcessFlow.interceptTransition(r,i,e,void 0,void 0,a.Continuous):ProcessFlow.doTransition(r,i,e,void 0,void 0,a.Continuous))}}},Button:{GetAll:async function(){return[...this.System.GetAll(),...await this.Custom.GetAll()]},GetButton:function(e){return this.System.GetAll({api_name:e})[0]||null},GetButtonById:async function(e){const t=(await this.Custom.GetAll({id:e}))[0];if(t)return t;throw CScript.Error(`invalid id - ${e}`)},Hide:function(e){"custom"===e||/^-?[\d.]+(?:e-?\d+)?$/.test(e)?this.Custom.Hide(e):this.System.Hide(e)},Show:function(e){"custom"===e||/^-?[\d.]+(?:e-?\d+)?$/.test(e)?this.Custom.Show(e):this.System.Show(e)},SetValue:function(e,t){this["custom"===e||/^-?[\d.]+(?:e-?\d+)?$/.test(e)?"Custom":"System"].SetValue(e,t)},Click:function(e){this["custom"===e||/^-?[\d.]+(?:e-?\d+)?$/.test(e)?"Custom":"System"].Click(e)},Custom:{GetButtons:async function(){const e=store.peekAll("custom_button",{module:moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].api_name});return e.length?e:await store.findAll("custom_button",{module:moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].api_name})},GetAll:async function(e){return(await this.GetButtons()).filter((t=>"view"===t.position&&(e&&e.id===t.id||!e))).map((({id:e,name:t})=>({name:t,id:e,type:"custom"})))},GetNextButton:async function(){var e,t,i=CustomButtonJSObjectInit.cscriptChecks.restrict;return(await this.GetButtons()).forEach((function(r){"view"===r.position&&-1===i.indexOf(r.id)&&(!t||t>r.sequence_number)&&(t=r.sequence_number,e=r)})),e},Hide:async function(e){if(-1===CustomButtonJSObjectInit.cscriptChecks.restrict.indexOf(e)&&CustomButtonJSObjectInit.cscriptChecks.restrict.push(e),Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module()))Lyte.triggerEvent("detail_view_action_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{type:"disable",id:e});else if($L('[cscript-id="'+e+'"]').length>0){let e=$L('[cscript-tag="custom"]');e.attr("disabled",!0),e.addClass("peNone disable cscript_disable")}detailView.cscriptButtonAttribs[e]||(detailView.cscriptButtonAttribs[e]={}),detailView.cscriptButtonAttribs[e]={...detailView.cscriptButtonAttribs[e],button_id:e,isDisabled:!0}},Show:async function(e){var t=CustomButtonJSObjectInit.cscriptChecks.restrict.indexOf(e);if(-1!==t)if(CustomButtonJSObjectInit.cscriptChecks.restrict.splice(t,1),Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module()))Lyte.triggerEvent("detail_view_action_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{type:"enable",id:e});else if($L('[cscript-id="'+e+'"]').length>0){let e=$L('[cscript-tag="custom"]');e.attr("disabled",!1),e.removeClass("peNone disable cscript_disable")}detailView.cscriptButtonAttribs[e]&&detailView.cscriptButtonAttribs[e].isDisabled&&delete detailView.cscriptButtonAttribs[e].isDisabled},SetValue:function(e,t){CustomButtonJSObjectInit.cscriptChecks.rename[e]=t,Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module())?Lyte.triggerEvent("custom_button_cscript_action",{action:"rename"}):$L('[cscript-id="'+e+'"]').length>0&&$L('[cscript-id="'+e+'"] input').attr("value",t),detailView.cscriptButtonAttribs[e]||(detailView.cscriptButtonAttribs[e]={}),detailView.cscriptButtonAttribs[e]={...detailView.cscriptButtonAttribs[e],button_id:e,label:t}},Click:function(e){CustomButtonJSObjectInit.execute(e,"viewEntity",DetailViewHandler.Utils.get_current_entity_id(),"",DetailViewHandler.Utils.get_current_module())}},System:{blackListedButtons:["find_and_merge_duplicates","customize_business_card","customize_related_details","add_related_list","add_to_projects","run_macro","custom"],GetAll:function(e){let t=[];if(Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module())){for(var i=$L("crm-detailview-actions")[0].component,r=i.getData("csript_suportedActions"),a=i.getData("csript_labelMap"),n=(r=objectUtils.cloneObject_new(r)).length,l=0;l<n;l++)r[l].api_name&&a[r[l].api_name]&&(r[l].name=a[r[l].api_name]);t=r}else $L("#detailViewButtonLayerDiv").find("[cscript-tag]").each(((e,i)=>{t.push({api_name:i.getAttribute("cscript-tag"),type:"system",name:i.textContent||i.value})}));return t.filter((t=>-1===this.blackListedButtons.indexOf(t.api_name)&&(e&&e.api_name===t.api_name||!e)))},Hide:function(e){if(Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module()))Lyte.triggerEvent("detail_view_action_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{type:"disable",apiName:e});else{let t=$L("#detailViewButtonLayerDiv").find('[cscript-tag="'+e+'"]');if(["INPUT","BUTTON"].includes(t.prop("tagName")))t.attr("disabled",!0),t.parent().removeClass("cP");else{let i=t.find("button");if(i.length)"convert"===e&&t.addClass("peNone disable cscript_disable"),t=i,t.attr("disabled",!0);else{t.addClass("peNone disable cscript_disable");const e=t.parent();e.removeClass("cP"),e[0].style.cursor="auto"}}}detailView.cscriptButtonAttribs[e]||(detailView.cscriptButtonAttribs[e]={}),detailView.cscriptButtonAttribs[e]={...detailView.cscriptButtonAttribs[e],button_name:e,isDisabled:!0}},Show:function(e){if(Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module()))Lyte.triggerEvent("detail_view_action_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{type:"enable",apiName:e});else{let t=$L("#detailViewButtonLayerDiv").find('[cscript-tag="'+e+'"]');t.removeClass("peNone disable cscript_disable"),["INPUT","BUTTON"].includes(t.prop("tagName"))?t.parent().addClass("cP"):t=t.find("button"),t.attr("disabled",!1)}detailView.cscriptButtonAttribs[e]&&detailView.cscriptButtonAttribs[e].isDisabled&&delete detailView.cscriptButtonAttribs[e].isDisabled},SetValue:function(e,t){if(Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module()))Lyte.triggerEvent("detail_view_action_listener_"+DetailViewHandler.Utils.get_current_entity_id(),{type:"set_newaction_label",apiName:e,new_label:t});else{var i=$L("#detailViewButtonLayerDiv").find('[cscript-tag="'+e+'"]');"a"===i[0].localName?i.find("button").length?i.find("button").text(t):i.text(t):"link-to"===i[0].localName?(i.find("button").text(t),i.find("a").text(t)):i.attr("value",t)}detailView.cscriptButtonAttribs[e]||(detailView.cscriptButtonAttribs[e]={}),detailView.cscriptButtonAttribs[e]={...detailView.cscriptButtonAttribs[e],button_name:e,label:t}},Click:function(e){if(Crm.lyteHeaderNeeded(DetailViewHandler.Utils.get_current_module())){var t=$L("crm-detailview-actions");e=t[0].component.get_system_or_csript_name(e,DetailViewHandler.Utils.get_current_module(),!0);var i=t.find("#btn_"+e);if(i.length)i[0].click();else{var r=$L("#drop_action_"+e+"_"+DetailViewHandler.Utils.get_current_entity_id());r.length&&r[0].click()}}else{var a=$L("#detailViewButtonLayerDiv").find('[cscript-tag="'+e+'"]');!a.hasClass("cscript_disable")&&a[0].click()}}}},Related_List:{GetOptions:function(){return returnJson.relListLabelsJson.relListLabelJson.map((function(e){return{name:e.label,id:e.id}}))},Hide:function(e,t){if("Notes"===t)$L("#noteDetails").hide(),$L("#newleft_Notes").hide(),detailView.restrictedRelatedLists[e]=t;else{for(var i,r=returnJson.relListLabelsJson.relListLabelJson,a=r.length,n=0;n<a;n++)r[n].id===e&&(i=r[n].name);if(!i)throw CScript.Error("invalid related list - "+e);$L("#RelatedListCommonDiv[ddname="+i+"]").hide(),$L("#newleft_"+e).hide(),detailView.restrictedRelatedLists[e]=t}},Show:function(e,t){if("Notes"===t)$L("#noteDetails").show(),$L("#newleft_Notes").show(),delete detailView.restrictedRelatedLists[e];else{for(var i,r=returnJson.relListLabelsJson.relListLabelJson,a=r.length,n=0;n<a;n++)r[n].id===e&&(i=r[n].name);if(!i)throw CScript.Error("invalid related list - "+e);$L("#RelatedListCommonDiv[ddname="+i+"]").show(),$L("#newleft_"+e).show(),delete detailView.restrictedRelatedLists[e]}}},Link:{GetAll:function(){var e=[];return $L("[name='customlink']").find("[cscript-tag]").each((function(t,i){const r=$L(this);e.push({id:r.attr("cscript-tag"),name:r.children().text()||r.text()})})),e},Get:function(e){const t=$L("[data-zcqa='lnk_cl_custom'][cscript-tag='"+e+"']");return t.length>0?{id:e,name:t.children().text()||t.text()}:null},Hide:function(e,t){$L("[name='customlink']").find("[cscript-tag='"+t+"']").parent().hide();var i=$L("#cuslnkquickact").attr("data-restricted-links");i=i&&0!==i.length?i+","+t:t,$L("#cuslnkquickact").attr("data-restricted-links",i),detailView.restrictedLinks.contains(t)||detailView.restrictedLinks.push(t)},Show:function(e,t){$L("[data-zcqa='lnk_cl_custom'][cscript-tag='"+t+"']").parent().show(),detailView.restrictedLinks.removeLastOccurenceOfElement(t)},Click:function(e,t){var i=$L("[data-zcqa='lnk_cl_custom'][cscript-tag='"+t+"']");if(!i.is(":visible"))throw CScript.Error("hidden links can't be clicked");i.click()}},Email:{emailtranslate:function(e){return e&&Array.isArray(e)?e.map((function(e){return{email:e.email,user_name:e.label}})):[]},opencomposewindow:function(e,t){EmailComposeUtil.preformAndComposeWindow(e,{module:DetailViewHandler.Utils.get_current_module(),record:{id:DetailViewHandler.Utils.get_current_entity_id()}},t)},triggersendmail:function(t){if(!Crm.userDetails.isNewEditor)throw CScript.Error("unsupported feature");if(!Crm.userDetails.permissions[`Crm_Implied_Send_Mail_${DetailViewHandler.Utils.get_current_module()}`])throw CScript.Error("permission denied");return new Promise((function(i,r){const a=function(e){r(CScript.Error(EmailComposeUtil.getErrorMessageFromCode(e||"")))},n=function(){i()};EmailComposeUtil.ComposeMailData?e.Email.opencomposewindow(t,{callback:a,successcallback:n}):CrmEmailInitialize.PopulateComposeMailData((function(){EmailComposeUtil.ComposeMailData=CrmEmailInitialize.ComposeMailData,e.Email.opencomposewindow(t,{callback:a,successcallback:n})}))}))}}};return{Utils:{is_lyte_enabled:function(){return Crm.renderDVLyteFlow(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])},get_current_module:function(){return Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]},get_current_entity_id:function(){return Lyte.Router.getRouteInstance().transition.info.dynamicParams[1]},get_listener_id:function(){return $L("crm-detail-view")[0].component.data.unique_listener_id},get_current_record:function(){return store.peekRecord(moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].id,Lyte.Router.getRouteInstance().transition.info.dynamicParams[1])},is_supported_field:function(e){var t=DetailViewHandler.Utils.get_current_module();return("Leads"===t||"Contacts"===t)&&"LASTNAME"===e.column_name||(999===e.ui_type||!(Lyte.registeredMixins["crm-detailview-common-utils"].view_unsupported_columns.indexOf(e.column_name)>-1)&&(CrmField.UITYPES.TAGS!==e.ui_type&&e.view_type.view&&e.show_type>0&&e.section_id))},serialize_field:function(e,t,i,r,a,n){if(a&&(i=a.api_name,r=a.column_name),n&&""===e)return e;if(!e&&!1!==e)return"multiselectpicklist"===t?[]:null;switch(t){case"ownerlookup":case"userlookup":case"lookup":return{id:e.id,name:e.name};case"multiselectpicklist":return(e=e instanceof Array?e:e.split("; "))instanceof Array?e:e.split("/s+;s+/");case"subform":case"static_subform":return e.map((e=>DetailViewHandler.Utils.serialize_record(e,Object.keys(e).filter((e=>"Created_Time"!==e)))));case"profileimage":case"imageupload":case"fileupload":return null;case"integer":case"double":return"EXCHANGERATE"===r?e:parseFloat(e);case"boolean":return!!e;default:switch(r){case"PRICINGDETAILS":for(var l=[],o=e.length,s=0;s<o;s++){var d=e[s],c={};c.discount=Number.isInteger(d.discount)?d.discount.toFixed(1):d.discount,c.fromRange=d.from_range,c.toRange=d.to_range,l.push(c)}return l;case"LAYOUTID":return e&&e.name||null}return r&&i&&"SHAREDTO"===r&&("Territory"===i||"Territories"===i)||"territories"===t?e.map((e=>({id:e.id,name:e.Name,canRemove:e.can_remove}))):e}},serialize_record:function(e,t,i){const r=moduleRecordMapping[DetailViewHandler.Utils.get_current_module()].id;return i||(i=$L("crm-detail-view")[0].component.data.layout.fields),i.filter((e=>t?t.includes(e.api_name):e.module&&e.module[0].id===r&&DetailViewHandler.Utils.is_supported_field(e))).reduce(((t,i)=>(t[i.api_name]=DetailViewHandler.Utils.serialize_field(e[i.api_name],i.data_type,i.api_name,i.column_name),t)),{})}},is_mandatory_form:function(){if(DetailViewHandler.Utils.is_lyte_enabled()&&$L("crm-quick-create-listing")[0]||$("#multipleFieldsEditPop").is(":visible")||$("#formRuleMandatoryFields").is(":visible")||$("#closedWon").is(":visible"))throw CScript.Error("unsupported action")},page_info:function(){return e.PageInfo()},field_visibility:function(){DetailViewHandler.is_mandatory_form(),this.value?e.Field.Show(this.field_name):e.Field.Hide(this.field_name)},field_read:function(){var t,i=e.Field.Read(this.field_name);return(DetailViewHandler.Utils.is_lyte_enabled()&&$L("#bp-exec-popup-div").is(":visible")||$("#multipleFieldsEditPop").is(":visible")||$("#formRuleMandatoryFields").is(":visible")||$("#closedWon").is(":visible"))&&(t=e.Field.GetValue(this.field_name)),t||i},form_read:function(){return e.Form.Read()},mandatory_form_read:function(t){return e.Field.GetValue(t)},field_write:async function(t){await e.Field.SetValue(this.field_name,this.value,t)},field_mask:function(){DetailViewHandler.is_mandatory_form(),e.Field.Mask(this.field_name,this.config)},field_set_read_only:function(){DetailViewHandler.is_mandatory_form(),e.Field.ReadOnly(this.field_name,this.value)},field_set_max_length:function(){DetailViewHandler.is_mandatory_form(),e.Field.MaxLength(this.field_name,this.value)},field_info_add:function(){DetailViewHandler.is_mandatory_form(),e.Field.Info.Add(this.field_name,this.message)},field_info_remove:function(){DetailViewHandler.is_mandatory_form(),e.Field.Info.Remove(this.field_name)},field_style_add:function(){DetailViewHandler.is_mandatory_form(),e.Field.Style.Add(this.field_name,this.style_config)},field_tooltip_add:function(){DetailViewHandler.is_mandatory_form(),e.Field.ToolTip.Add(this.field_name,this.message)},field_tooltip_remove:function(){DetailViewHandler.is_mandatory_form(),e.Field.ToolTip.Remove(this.field_name)},field_get_options:function(){return e.Field.GetOptions(this.field_name)},field_set_options:function(){e.Field.SetOptions(this.field_name,this.options)},field_set_criteria:async function(){await e.Field.SetCriteria(this.field_name,this.criteria,this.config)},field_set_folder_id:function(){e.Field.field_set_folder_id(this.field_name,this.value,this.source)},get_field_read:function(){return e.Field.Get(this.field_name,!0)?{api_name:this.field_name}:null},section_hide:function(){e.Section.Hide(this.id)},section_show:function(){e.Section.Show(this.id)},section_list:function(){return e.Section.GetAll()},section_get_name:function(){return e.Section.GetName(this.id)},related_list_visibility:function(){this.value?e.Related_List.Show(this.id,this.name):e.Related_List.Hide(this.id,this.name)},related_list_options:function(){return e.Related_List.GetOptions()},link_list:function(){return e.Link.GetAll()},get_link_id:function(){return e.Link.Get(this.id)},link_disable:function(){e.Link.Hide(this.name,this.id)},link_enable:function(){e.Link.Show(this.name,this.id)},link_click:function(){e.Link.Click(this.name,this.id)},tag_list:function(){return e.Tag.Get()},tag_hide:function(){e.Tag.Hide()},tag_show:function(){e.Tag.Show()},tag_add:async function(){await e.Tag.Add(this.tag_name)},tag_remove:async function(){await e.Tag.Remove(this.tag_name)},button_list:function(){return e.Button.GetAll()},get_button_apiname:function(){return e.Button.GetButton(this.api_name)},get_button_id:function(){return e.Button.GetButtonById(this.id)},button_disable:function(){this.api_name?e.Button.Hide(this.api_name):e.Button.Hide(this.id)},button_enable:function(){this.api_name?e.Button.Show(this.api_name):e.Button.Show(this.id)},button_click:function(){this.api_name?e.Button.Click(this.api_name):e.Button.Click(this.id)},button_set_value:function(){this.api_name?e.Button.SetValue(this.api_name,this.value):e.Button.SetValue(this.id,this.value)},send_mail:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("open mail popup"),e.Email.triggersendmail(this.config)},get_blueprint_transitions:function(){return e.Blueprint.getBlueprintTransitions()},initiate_blueprint_action:function(){e.Blueprint.initiateTransition(this.id,this.trigger_event)},get_blueprint_transition_by_id:function(){return e.Blueprint.getBlueprintTransitionById(this.id)},refresh_page:function(){if(Lyte.Router.getRouteInstance().prevent_cscript_onLoad=!this.config.triggerOnLoad,DetailViewHandler.Utils.is_lyte_enabled()){const e=$L("crm-detail-view")[0].component;Lyte.triggerEvent("detail_view_listener_"+e.getData("unique_listener_id"),{componentsToBeReloaded:["all_components"]}),Lyte.registeredMixins["crm-related-list-utils"].loadRelatedListComponents(DetailViewHandler.Utils.get_current_module(),DetailViewHandler.Utils.get_current_entity_id(),void 0,e.getData("related_list"))}else reloadCurrentEntityView()}}}();
