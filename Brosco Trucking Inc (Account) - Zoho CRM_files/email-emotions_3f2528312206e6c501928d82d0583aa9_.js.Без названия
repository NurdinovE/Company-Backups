store.registerModel("zia_notification_setup",{configurations:Lyte.attr("array"),id:Lyte.attr("string")},{actions:{put_notification_config:{},EmailsAI:{}}}),store.registerAdapter("zia_notification_setup",{namespace:"crm/ver$ion/settings/zia",buildURL:function(i,e,a,t,n,o){return n=n.replace("/ver$ion/","email_intelligence"===a.type||Crm.userDetails.ZIA_CONFIG_API_DEPRECATED?"/v8/":"/v7/"),"findAll"!==e&&(n=n.substring(0,n.lastIndexOf("/")+0)),n="action"!==e||"EmailsAI"!==o&&"put_notification_config"!==o?n.replace("zia_notification_setup","notifications"):n.replace("zia_notification_setup/actions","notifications")},methodForRequest:function(i){return"PATCH"===i?"PUT":i}}),store.registerSerializer("zia_notification_setup",{payloadKey:function(i,e){if("findAll"===e||"findRecord"===e)return"zia_notification_setup"},normalizeResponse:function(i,e,a,t){return a[i]=a.zia_notification_settings?a.zia_notification_settings:{},("createRecord"===e||"updateRecord"===e)&&a.zia_notification_settings&&a.zia_notification_settings.details?a.zia_notification_setup.id=t:a.zia_notification_setup.id=Math.floor(10*Math.random()).toString(),delete a.zia_notification_settings,a},serialize:function(i,e,a,t){if(e&&e.zia_notification_setup)e.zia_notification_settings=e.zia_notification_setup,delete e.zia_notification_setup;else if(void 0!==t)return t;return e}}),Lyte.Mixin.register("crm-email-emotions-mixin",{getPreviousMailDetailsFromDB:function(i,e){if(Crm&&Crm.userDetails&&Crm.userDetails.isMailAppsUser){var a="/crm/v2.2/"+i+"/"+e+"/Emails",t={type:"received",per_page:"1"},n=this;if(!Crm.userDetails.isEmotionsEnabled)return;return store.findAll("dummy",t,!1,!1,{url:a}).then((function(i){if(i&&i.Emails&&i.Emails.length>0){var e=i?i.Emails[0].emotion:"",a=i?i.Emails[0].from.user_name:"";n.loadEmotionBand(e,a)}}))}},loadEmotionBand:function(i,e){var a=$("#etZiaEmotionBand"),t="",n="";i&&(t="Happy"===i||"Enthusiasm"===i||"Trust"===i||"Gratitude"===i?"ziaLastMailSendBandHappy":"Neutral"===i?"ziaLastMailSendBandNeutral":"ziaLastMailSendBandangry",e=Handlebars.helpers.encodeHTML(e),i=this.getTranslatedEmotionValue(i),n=EmailComposeUtil.isReplyMail?'<span data-zcqa="emotion_band" class="pA fromTopCenter ziaLastMailSentimentBand crmBaseColor '+t+'">'+I18n.getMsg("crm.label.zia.reply.desc",[e,i])+' <div class="ico-close-small pA right10 svgIcons top10 cP" onClick="EmailComposeUtil.closeZiaEmotionBand()"></div></span>':'<span data-zcqa="emotion_band" class="pA fromTopCenter ziaLastMailSentimentBand crmBaseColor '+t+'">'+I18n.getMsg("crm.label.zia.compose.desc",[e,i])+' <div class="ico-close-small pA right10 svgIcons top10 cP" onClick="EmailComposeUtil.closeZiaEmotionBand()"></div></span>',a.append(n))},closeZiaEmotionBand:function(){var i=$("#etZiaEmotionBand").children()[0];void 0!==i&&i.remove()},setEmailsAIVariables:function(i){if("enterprise"!==Crm.userDetails.EDITION_NAME.toLowerCase()||Crm.userDetails.isEmailSummaryEnabled||(Crm.userDetails.isEmailSummaryEnabled=!0),Crm.userDetails.intentEnabled=!1,Crm.userDetails.emailsentimentEnabled=!1,Crm.userDetails.isEmotionsEnabled=!1,!i.zia_config&&i[0].zia_config&&(i.zia_config=i[0].zia_config),i&&i.zia_config&&i.zia_config.configurations.length>0&&i.zia_config.configurations[0]&&i.zia_config.configurations[0].enabled){var e=i.zia_config.configurations,a=e.length,t=e[0].enabled;for(let i=0;i<a;i++)"EMAIL_SUMMARY"===e[i].type&&!0===e[i].enabled&&(Crm.userDetails.isEmailSummaryEnabled=!0),"EMAIL_INTENT"===e[i].type&&!0===e[i].enabled&&(Crm.userDetails.intentEnabled=t),"EMAIL_SENTIMENT"===e[i].type&&!0===e[i].enabled&&(Crm.userDetails.emailsentimentEnabled=t),"EMOTIONS"===e[i].type&&!0===e[i].enabled&&(Crm.userDetails.isEmotionsEnabled=t)}},findZiaEmailConfigDetails:function(){return Lyte.resolvePromises({zia_config:store.findAll("zia_notification_setup",{type:"email_intelligence"})}).then((function(i){return i}))},getTranslatedEmotionValue:function(i){var e="";switch(i){case"Happy":e="crm.label.zia.email.emotion.happy";break;case"Gratitude":e="crm.label.zia.email.emotion.gratitude";break;case"Enthusiasm":e="crm.label.zia.email.emotion.enthusiasm";break;case"Trust":e="crm.label.zia.email.emotion.trust";break;case"Neutral":e="crm.label.zia.email.emotion.neutral";break;case"Discontentment":e="crm.label.zia.email.emotion.discontentment";break;case"Frustration":e="crm.label.zia.email.emotion.frustration";break;case"Confusion":e="crm.label.zia.email.emotion.confusion"}return I18n.getMsg(e)}});
