Lyte.Component.register("crm-richtext-component",{_template:'<template tag-name="crm-richtext-component"> <template is="if" value="{{expHandlers(cxPropFrom,\'===\',&quot;create&quot;)}}"><template case="true"> <template is="if" value="{{expHandlers(isMaximized,\'&amp;&amp;\',expHandlers(canvasFormView.isFormView,\'!\'))}}"><template case="true"> <div class="rtfEditorFreezeLayer"></div> </template></template> <div class="rtfParentWrap pR bg_white" tabindex="{{cxPropTabIndex}}" onfocus="{{action(\'toggleFocusState\',this,true)}}" onfocusout="{{action(\'toggleFocusState\',this,false)}}"> <div class="rtfInitWrap {{if(and(isMaximized,expHandlers(canvasFormView.isFormView,\'!\')),\'rtfLargeTextEditorParent oH\',\'\')}}"> <template is="if" value="{{isMaximized}}"><template case="true"> <div class="dF spaceBetween pT25 pB10 {{if(expHandlers(canvasFormView.isFormView,\'!\'),\'pL30\',\'\')}}"> <p class="rtfMaxLabel crm-font-bold crm-heading-font-size p0 m0">{{if(cxPropField.display_label,cxPropField.display_label,cxPropDisplayLabel)}}</p> <template is="if" value="{{canvasFormView.isFormView}}"><template case="true"> <div class="cP rtfEditorMinimizeIcon br6 flexAlignCenter jcCenter" onclick="{{action(\'formviewminimize\',this)}}" lt-prop-title="{{getI18n(\'crm.richtext.tool.minimize\')}}"> <span class="dIB zcicncss-common-exit-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_minimizeIcon"></span> </div> </template><template case="false"> <div class="cP rtfEditorMinimizeIcon br6 flexAlignCenter jcCenter mR25" onclick="{{action(\'initMinimize\',this)}}" lt-prop-title="{{getI18n(\'crm.richtext.tool.minimize\')}}"> <span class="dIB zcicncss-common-exit-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_minimizeIcon"></span> </div> </template></template> </div> </template></template> <div class="{{if(and(isMaximized,cxPropSaveCloseIconNeededInMaximize),\'dF\',\'\')}}"> <div class="crmMultiLineInnerLayer {{if(isMaximized,\'rtfLargeTextEditor\',\'\')}}"> <div class="multilineFieldRTE {{if(isRichTextNeeded,\'rtfCustomSize\',\'rtfCustomRichText\')}}" onclick="{{action(\'openRichTextEditor\',this,false,true)}}"> <lyte-texteditor class="richTextField" id="{{id}}_Editor" after-render="{{method(\'onEditorRender\')}}" onkeydown="{{action(\'rtfKeyMaximize\',event,this)}}" lt-prop-cursor-class="rtfCursor" lt-prop-tabindex="{{cxPropTabIndex}}" lt-prop-custom-list-color="true" lt-prop-anchor-text-edit="true" lt-prop-unformatted-paste-option="destination" lt-prop-tooltip-config="{{cxPropTooltipConfig}}" lt-prop-title="{{cxPropTitle}}" on-anchor-modification="{{method(\'validateMaxLengthAndSetVal\',this)}}" lt-prop-placeholder="{{cxPropPlaceholder}}" on-after-input="{{method(\'validateMaxLengthAndSetVal\',this)}}" on-shortcut-apply="{{method(\'validateMaxLengthAndSetVal\',this)}}" on-after-paste="{{method(\'validatePasteContentAndSetVal\',this)}}" set-colors-list="{{method(\'setUsedColorsList\')}}" is-show-more-button-required="{{method(\'isShowMoreButtonRequired\')}}" on-before-anchor-remove="{{method(\'beforeAnchorRemove\')}}" lt-prop-queue-update-time="0" lt-prop-list-style="{&quot;list-style-position&quot; : &quot;inside&quot;, &quot;padding-inline-start&quot;:&quot;20px&quot;}" lt-prop-replace-style="{{cxPropReplaceStyle}}" lt-prop-word-to-para-style="{{cxPropWordToParaStyle}}" lt-prop-para-to-word-style="{{cxPropParaToWordStyle}}" lt-prop-allowed-tags="{{cxPropAllowedTags}}" lt-prop-allowed-styles="{{cxPropAllowedStyles}}" lt-prop-remove-default-style="true" lt-prop-shortcuts="{{editorShortcuts}}" lt-prop-clear-para-on-full-selection="true" lt-prop-list-variable="false" lt-prop-un-ordered-list="{{cxPropAllowedUnOrderedList}}" lt-prop-ordered-list="{{cxPropAllowedOrderedList}}" lt-prop-selection-delay="300" lt-prop-url-detection="true" lt-prop-word-style="{{cxPropWordStyle}}" lt-prop-wrapper-class="rtfEditorPopWrapper" lt-prop-blue-pencil="true" lt-prop-freeze="true" lt-prop-anchor-style="{&quot;color&quot;: &quot;rgb(44, 123, 208)&quot;, &quot;textDecoration&quot;: &quot;underline&quot;}" lt-prop-context-menu="true" on-anchor-show="{{method(\'addDataZcqaToLinkPopup\')}}" lt-prop-url-detection-options="{&quot;insert&quot; : false, &quot;paste&quot; : true, &quot;input&quot; : true, &quot;output&quot; : true}" lt-prop-checkbox="{&quot;prevent&quot;:&quot;true&quot;}" lt-prop-max-margin="200" lt-prop-data-tabindex="{{cxPropField.data_index}}"> </lyte-texteditor> </div> <template is="if" value="{{expHandlers(isRichTextNeeded,\'&amp;&amp;\',expHandlers(cxPropReadonly,\'!\'))}}"><template case="true"> <div class="rtfEditorPanelWrap pR oH {{if(canvasFormView.isFormView,\'zcanvas_richtext_tollbar\',\'\')}}" onclick="{{action(\'onEditorPanelFocus\')}}"> <lyte-editorpanel class="mB30 rtfEditorPanel" lt-prop-tabindex="{{cxPropTabIndex}}" on-show="{{method(\'toggleFocusEditorIcon\',this,true)}}" on-before-show="{{method(\'toggleFocusEditorIcon\',this,true)}}" on-before-emoji-close="{{method(\'checkEmojiClose\')}}" on-hide="{{method(\'toggleFocusEditorIcon\',this,false)}}" id="{{id}}_EditorPanel" lt-prop-editor="lyte-texteditor#{{id}}_Editor" on-click="{{method(\'validateMaxLengthAndSetFormatVal\',this)}}" lt-prop-icons="{{crmNoteIconData}}" lt-prop-tooltip-config="{&quot;position&quot; : &quot;bottom&quot;}" lt-prop-wrapper-class="rtfEditorPopWrapper" lt-prop-freeze="true" lt-prop-more-options-wrapper-class="rtfMoreIconPopup" lt-prop-data-tabindex="{{cxPropField.data_index}}"> </lyte-editorpanel> <template is="if" value="{{expHandlers(isMaximized,\'!\')}}"><template case="true"> <template is="if" value="{{canvasFormView.isFormView}}"><template case="true"> <div class="cP rtfEditorMaximizeIcon br6 pA" id="{{id}}_maximizeIcon" lt-prop-title="{{maxShortcutToolTip}}" onclick="{{action(\'formviewMaximize\',this,event)}}" tabindex="{{cxPropTabIndex}}" data-tabindex="{{cxPropField.data_index}}"> <span class="rtfMaximizeEditor dIB zcicncss-common-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_maximizeIcon"></span> </div> - </template><template case="false"> <div class="cP rtfEditorMaximizeIcon br6 pA" lt-prop-title="{{maxShortcutToolTip}}" onclick="{{action(\'clickMaximize\',this)}}" tabindex="{{cxPropTabIndex}}" data-tabindex="{{cxPropField.data_index}}"> <span class="rtfMaximizeEditor dIB zcicncss-common-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_maximizeIcon"></span> </div> </template></template> </template></template> </div> </template></template> </div> <template is="if" value="{{expHandlers(isMaximized,\'&amp;&amp;\',cxPropSaveCloseIconNeededInMaximize)}}"><template case="true"> <div class="flexAlignCenter rtfSaveCloseWrap"> <span class="zcicncss-tick-filled-rounded zcicn-cssIcons zcicn_blue_mask mR5 cP" onclick="{{action(\'onMaximizeSave\',event)}}" data-tabindex="{{cxPropField.data_index}}"></span> <span class="zcicncss-close-rounded zcicn-cssIcons cP" onclick="{{action(\'onMaximizeClose\',event)}}" data-tabindex="{{cxPropField.data_index}}"></span> </div> </template></template> </div> <template is="if" value="{{expHandlers(isMaximized,\'&amp;&amp;\',toggleKeyPress)}}"><template case="true"> <span class="crm-extra-small-font-size crmNegativeColor rtfMaxMl30">{{cxPropMaxErrorMsg}}</span> </template></template> </div> <div style="height:{{miniEditorHeight}}px"></div> </div> </template><template case="false"><template is="if" value="{{expHandlers(cxPropFrom,\'===\',&quot;view&quot;)}}"><template case="true"> <template is="if" value="{{expHandlers(showMoreButton,\'!\')}}"><template case="true"> <template is="if" value="{{cxPropValue}}"><template case="true"> <div class="rtfViewValue">{{unescape(cxPropValue)}}</div> </template><template case="false"> {{cxPropEmptyValue}} </template></template> </template><template case="false"> <template is="if" value="{{cxPropValue}}"><template case="true"> <div class="rtfViewParent" id="rtfParentView"> <div class=" pA right10 rtfExpandIcon cP flexAlignCenter jcCenter" onclick="{{action(\'detailPageMax\',this,event)}}" lt-prop-title="{{getI18n(\'crm.label.maximize\')}}"> <div class="zcicncss-common-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_view_maximizeIcon"></div> </div> <div class="rtfViewValue rtfOverFlowX">{{unescape(cxPropValue)}}</div> <div class="rtfDummyorigin w100_per pA"></div> </div> <template is="if" value="{{expHandlers(buttonNeeded,\'||\',cxPropHasMoreContent)}}"><template case="true"> <template is="if" value="{{expHandlers(showFullContent,\'!\')}}"><template case="true"> <div class="crmLinkColor dIB cP" onclick="{{action(\'toggleContent\',event)}}" data-zcqa="{{dataZcqa}}_show_more"> {{getI18n(\'crm.wf.summary.label.ShowInstantActions\')}} <div class="dIB vaM zcicn-arrow-solid-down-md-mask zcicn-cssIcons zcicn_blue_mask"></div> </div> </template><template case="false"> <div class="crmLinkColor dIB cP" onclick="{{action(\'toggleContent\',event)}}" data-zcqa="{{dataZcqa}}_show_less"> {{getI18n(\'crm.wf.summary.label.HideInstantActions\')}} <div class="dIB vaM zcicn-arrow-solid-up-md-mask zcicn-cssIcons zcicn-rotate-180 zcicn_blue_mask"></div> </div> </template></template> </template></template> </template><template case="false"> <p class="rtfEmptyValue">{{cxPropEmptyValue}}</p> </template></template> </template></template> </template></template></template></template> <template is="if" value="{{expHandlers(errorMessage,\'&amp;&amp;\',expHandlers(cxPropFrom,\'===\',&quot;create&quot;))}}"><template case="true"> <span class="crm-extra-small-font-size crmNegativeColor">{{cxPropErrorMessage}}</span> </template></template> <template is="if" value="{{expHandlers(canvasFormView.isFormView,\'!\')}}"><template case="true"> <lyte-modal lt-prop-wrapper-class="rtfViewModalWrap inPageModal" class="rtfViewModal" lt-prop-transition="{&quot;animation&quot;:&quot;zoom&quot;,&quot;duration&quot;:&quot;0.5&quot;,&quot;originElement&quot;:&quot;.rtfModalOrigin&quot;}" lt-prop-offset="{&quot;top&quot;:&quot;center&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-close-on-escape="false" lt-prop-width="80%" lt-prop-height="{{ViewModalHeight}}px" lt-prop-show-close-button="false" lt-prop-set-content-height="true" on-resize="{{method(&quot;viewModalResize&quot;)}}" on-close="{{method(&quot;removeOriginClass&quot;)}}" on-before-close="{{method(&quot;rtfViewModalBeforeClose&quot;)}}" lt-prop-prevent-focus="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="dF spaceBetween"> <p class="rtfMaxLabel p0 m0">{{if(cxPropField.display_label,cxPropField.display_label,cxPropDisplayLabel)}}</p> <div class="rtfViewExitIcon cP flexAlignCenter jcCenter" onclick="{{action(\'detailPageMin\')}}" lt-prop-title="{{getI18n(\'crm.richtext.tool.minimize\')}}"> <span class="zcicncss-common-exit-full-view zcicn-cssIcons" data-zcqa="{{dataZcqa}}_view_minimizeIcon"></span> </div> </lyte-modal-header> <lyte-modal-content class="p0 pR"> <div class="rtfViewModalValWrap br6 p10 mL30 boxBB {{if(cxPropReadonly,\'cNotAllowed\',\'cP\')}}" onclick="{{action(\'openMaxEditor\')}}"> <div class="rtfViewValue">{{unescape(cxPropValue)}}</div> <template is="if" value="{{cxPropReadonly}}"><template case="true"> <crmutil-icon icon-name="lock-locked" icon-class="zcicn-lock-locked" class="rftViewLockIcon pA top7 right47" lt-prop-title="{{getI18n(\'crm.richtext.tool.minimize\')}}"></crmutil-icon> </template></template> <template is="if" value="{{expHandlers(expHandlers(cxPropReadonly,\'!\'),\'&amp;&amp;\',cxPropIsEditable)}}"><template case="true"> <div class="pA w42 top5 right47 cDefault"> <div class="rtfViewEditIcon flexAlignCenter jcCenter cP mlAuto" lt-prop-title="{{getI18n(\'gs.edit\')}}"> <span class="zcicncss-editFilled zcicn-cssIcons zcicncss13"></span> </div> </div>  </template></template>  </div></lyte-modal-content></template> </lyte-modal> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"attr",position:[3]},{type:"attr",position:[3,1]},{type:"attr",position:[3,1,1]},{type:"if",position:[3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"attr",position:[3,1,3,1]},{type:"attr",position:[3,1,3,1,1]},{type:"attr",position:[3,1,3,1,1,1]},{type:"componentDynamic",position:[3,1,3,1,1,1]},{type:"attr",position:[3,1,3,1,3]},{type:"if",position:[3,1,3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3,1,3,3]},{type:"if",position:[3,1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3]}]}},default:{}},{type:"attr",position:[3,1,5]},{type:"if",position:[3,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3,3],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'height:'","miniEditorHeight","'px'"]}}}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"text",position:[3,1,1,0]},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1,5]},{type:"if",position:[3,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["cxPropField","cxPropSaveCloseIconNeededInMaximize","cxPropFrom","cxPropViewedFrom","cxPropToViewMore","cxPropEmptyValue","cxPropDisplayLabel","cxPropViewMaxNeeded","cxPropDefaultMaximize","cxPropMaxlength","cxPropValue","cxPropReadonly","cxPropPlaceholder","cxPropErrorMessage","cxPropClearErrorMessage","cxPropTabIndex","cxPropIsEditable","cxPropAllowedTags","ViewModalHeight","cxPropAllowedStyles","cxPropMaxErrorMsg","cxPropTooltipConfig","cxPropRecordId","cxPropFieldApiName","cxPropModuleApiName","cxPropTitle","cxPropIntialContLen","cxPropAllowedUnOrderedList","cxPropAllowedOrderedList","cxPropInitialScrollNeeded","cxPropEditorInitialHeight","cxPropHasMoreContent","cxPropReplaceStyle","cxPropWordToParaStyle","cxPropParaToWordStyle","cxPropInitialFocusNeeded","cxPropWordStyle","lastUpdatedCruxValue","dataZcqa","isWfAction","errorMessage","showMoreButton","canvasFreezeLayer","viewIsMax","showFullContent","compFuncUsed","psScrollClassNeeded","isRichTextNeeded","buttonNeeded","toggleKeyPress","transitionDone","maxShortcutToolTip","id","name","canvasEditMax","iscxPropValueChanged","isLyteCreate","isMaximized","crmNoteIconData","editorShortcuts","miniEditorHeight","miniEditorWidth","detailPageEditorHeight","detailPageEditorWidth","standardView","ltPropMoreOptionsPopover","canvasFormView","isforFormviewModal","browserName"],data:function(){var t,e,a,o,i=["removeUL","disc","circle","square","ulDiamond","ulTick","ulOutlineStar","ulRightPointer"],r=_lyteUiEditor.icons.length;-1!==navigator.appVersion.indexOf("Mac")?(e=I18n.getMsg("crm.richtext.tool.mac.bold"),a=I18n.getMsg("crm.richtext.tool.mac.italics"),o=I18n.getMsg("crm.richtext.tool.mac.underline")):(e=I18n.getMsg("crm.richtext.tool.bold"),a=I18n.getMsg("crm.richtext.tool.italics"),o=I18n.getMsg("crm.richtext.tool.underline"));var s=$L.extend(!0,{},_lyteUiEditor.shortcuts);delete s[9],delete s[187],delete s[75],delete s[79],s[85].splice(1,1),delete s[221],delete s[219],delete s[70],delete s[74],delete s[82],delete s[188],delete s[190];var l=s[66];l[0].css="bold",l[0].ctrl=!0,l[0].scope="Word",l[0].value="fontWeight";var n=_lyteUiEditor.wordStyle;n.color="rgb(51,51,51)",n.wordBreak="break-word";var c=_lyteUiEditor.orderedList;c.push({name:"katakana",conversionName:"katakana",type:"OL",suffix:"„ÄÅ"});for(var d=_lyteUiEditor.unOrderedList,p=[],u=d.length,m=0;m<u;m++){var h=d[m];i.contains(h.conversionName)&&p.push(h)}for(m=0;m<r;m++){if("lyteUIEditorPanelList"===_lyteUiEditor.icons[m].class)for(var f=(t=$L.extend(!0,{},_lyteUiEditor.icons[m])).subIcons,g=f.length,x=0;x<g;x++){var y=f[x];if("Ul"===y.name){y.title=I18n.getMsg("crm.richtext.tool.bullet");for(var v=[],P=y.list,C=P.length,L=0;L<C;L++){var M=P[L],w=p.length;if(i.contains(M.name)){for(var b=0;b<w;b++)M.name===p[b].conversionName&&(M.selected=b+1);v.push(M)}}y.list=v}else y.title=I18n.getMsg("crm.richtext.tool.numbering")}}var D=[{class:"Formatting",subIcons:[{type:"switch",name:"bold",display:"B",functionName:"toggleWordClass",arguments:["fontWeight","bold"],active:!1,title:e},{type:"switch",name:"italic",display:"I",functionName:"toggleWordClass",arguments:["fontStyle","italic"],title:a,active:!1},{type:"switch",name:"underline",display:"U",functionName:"toggleWordClass",arguments:["textDecoration","underline"],title:o,active:!1},{type:"switch",name:"strike",display:"",functionName:"toggleWordClass",arguments:["textDecoration","line-through"],title:I18n.getMsg("crm.editor.tool.option.strikeout"),active:!1}]},{class:"colorPickers",subIcons:[{type:"colorpicker",name:"color",display:"color",selected:"black",functionName:"toggleWordClass",arguments:["color","{{selected}}"],title:I18n.getMsg("crm.editor.tool.option.fontcolor"),usedColorsList:[],active:!1},{type:"colorpicker",name:"bg",display:"bg",selected:"white",functionName:"toggleWordClass",title:I18n.getMsg("crm.richtext.tool.fontbg"),arguments:["backgroundColor","{{selected}}"],usedColorsList:[],active:!1}]},t,{class:"anchor",subIcons:[{type:"anchor",name:"anchor",display:"anchor",functionName:"toggleWordClass",arguments:["lyteEditorAnchor"],title:I18n.getMsg("crm.editor.tool.option.insertLink"),active:!1}]},{class:"indentSection",subIcons:[{type:"switch",name:"textIndentIncrease",display:"textIndentIncrease",functionName:"textIndentIncrease",activeClass:"lyteEditorPanelIconDisabled",title:I18n.getMsg("crm.editor.tool.option.increaseIndent"),arguments:[""],ignore:!1,active:!1},{type:"switch",name:"textIndentDecrease",display:"textIndentDecrease",functionName:"textIndentDecrease",activeClass:"lyteEditorPanelIconDisabled",title:I18n.getMsg("crm.editor.tool.option.decreaseIndent"),arguments:[""],ignore:!1,active:!1}]},{class:"smiley",subIcons:[{type:"switch",name:"sub",display:"sub",functionName:"toggleWordClass",arguments:["lyteSubScript"],removeClass:["lyteSuperScript"],title:I18n.getMsg("crm.editor.tool.option.subscript"),active:!1},{type:"switch",name:"super",display:"super",functionName:"toggleWordClass",arguments:["lyteSuperScript"],removeClass:["lyteSubScript"],title:I18n.getMsg("crm.editor.tool.option.superscript"),active:!1}]},{class:"smiley",subIcons:[{type:"emoji",name:"emoji",display:"Emoji",title:I18n.getMsg("crm.richtext.tool.emojis"),active:!1,ignore:!0,input:{appearance:"box",closeIcon:!0,placeholder:I18n.getMsg("crm.richtext.tool.search.emoji"),type:"search"},noMatchText:I18n.getMsg("crm.richtext.tool.emoji.noresult")}]},{class:"clearformatting",subIcons:[{type:"switch",name:"clear",display:"",functionName:"clearFormat",title:I18n.getMsg("crm.richtext.tool.clear.format"),arguments:[""],action:!1}]}];return{cxPropField:Lyte.attr("object",{default:{}}),cxPropSaveCloseIconNeededInMaximize:Lyte.attr("boolean",{default:!1}),cxPropFrom:Lyte.attr("string",{default:"create"}),cxPropViewedFrom:Lyte.attr("string",{default:""}),cxPropToViewMore:Lyte.attr("boolean",{default:!1}),cxPropEmptyValue:Lyte.attr("string",{default:""}),cxPropDisplayLabel:Lyte.attr("string",{default:""}),cxPropViewMaxNeeded:Lyte.attr("boolean",{default:!1}),cxPropDefaultMaximize:Lyte.attr("boolean",{default:!1}),cxPropMaxlength:Lyte.attr("number"),cxPropValue:Lyte.attr("string"),cxPropReadonly:Lyte.attr("boolean",{default:!1}),cxPropPlaceholder:Lyte.attr("string"),cxPropErrorMessage:Lyte.attr("string",{default:""}),cxPropClearErrorMessage:Lyte.attr("boolean",{default:!1}),cxPropTabIndex:Lyte.attr("number",{default:0}),cxPropIsEditable:Lyte.attr("boolean",{default:!0}),cxPropAllowedTags:Lyte.attr("object",{default:{word:["b","i","u","em","strong","a","mark","del","small","sub","sup","span"],paragraph:["ul","li","ol","p","div","br"]}}),ViewModalHeight:Lyte.attr("number",{default:0}),cxPropAllowedStyles:Lyte.attr("array",{default:["font-style","font-weight","text-decoration","color","background-color","background","vertical-align","--tablevel","margin-left","margin-right","list-style-type","padding-inline-start","text-decoration-line","text-decoration-thickness","text-decoration-style","text-decoration-color","margin-inline-start","padding-left","list-style-position","display"]}),cxPropMaxErrorMsg:Lyte.attr("string",{default:""}),cxPropTooltipConfig:Lyte.attr("string",{default:""}),cxPropRecordId:Lyte.attr("string"),cxPropFieldApiName:Lyte.attr("string"),cxPropModuleApiName:Lyte.attr("string"),cxPropTitle:Lyte.attr("string",{default:""}),cxPropIntialContLen:Lyte.attr("number",{default:0}),cxPropAllowedUnOrderedList:Lyte.attr("array",{default:p}),cxPropAllowedOrderedList:Lyte.attr("array",{default:c}),cxPropInitialScrollNeeded:Lyte.attr("boolean",{default:!1}),cxPropEditorInitialHeight:Lyte.attr("number",{}),cxPropHasMoreContent:Lyte.attr("boolean",{default:!1}),cxPropReplaceStyle:Lyte.attr("object",{default:{fontWeight:{value:"bold",name:"fontFamily",replaceValue:"var(--crm-font-bold)",fallBackValue:"var(--crm-font-regular)"}}}),cxPropWordToParaStyle:Lyte.attr("array",{default:["color","fontWeight","fontStyle","fontFamily"]}),cxPropParaToWordStyle:Lyte.attr("array",{default:["color","fontSize","fontWeight","fontStyle","fontFamily"]}),cxPropInitialFocusNeeded:Lyte.attr("boolean",{default:!1}),cxPropWordStyle:Lyte.attr("object",{default:n}),lastUpdatedCruxValue:Lyte.attr("string"),dataZcqa:Lyte.attr("string",{default:""}),isWfAction:Lyte.attr("boolean",{default:!1}),errorMessage:Lyte.attr("boolean",{default:!1}),showMoreButton:Lyte.attr("boolean",{default:!0}),canvasFreezeLayer:Lyte.attr("boolean",{default:!1}),viewIsMax:Lyte.attr("boolean",{default:!1}),showFullContent:Lyte.attr("boolean",{default:!1}),compFuncUsed:Lyte.attr("boolean",{default:!1}),psScrollClassNeeded:Lyte.attr("boolean",{default:!1}),isRichTextNeeded:Lyte.attr("boolean",{default:!1}),buttonNeeded:Lyte.attr("boolean",{default:!1}),toggleKeyPress:Lyte.attr("boolean",{default:!1}),transitionDone:Lyte.attr("boolean",{default:!1}),maxShortcutToolTip:Lyte.attr("string",{default:""}),id:Lyte.attr("string"),name:Lyte.attr("string"),canvasEditMax:Lyte.attr("boolean",{default:!1}),iscxPropValueChanged:Lyte.attr("boolean",{default:!0}),isLyteCreate:Lyte.attr("boolean",{default:!1}),isMaximized:Lyte.attr("boolean",{default:!1}),crmNoteIconData:Lyte.attr("array",{default:D}),editorShortcuts:Lyte.attr("object",{default:s}),miniEditorHeight:Lyte.attr("number",{default:0}),miniEditorWidth:Lyte.attr("number",{default:0}),detailPageEditorHeight:Lyte.attr("number",{default:0}),detailPageEditorWidth:Lyte.attr("number",{default:0}),standardView:Lyte.attr("boolean",{default:!1}),ltPropMoreOptionsPopover:Lyte.attr("string",{default:'{"duration":"","freeze":false,"allowMultiple":true,"showCloseButton":false,"placement":"topLeft bottom","type":"callout","scrollable":true}'}),canvasFormView:Lyte.attr("object",{default:{}}),isforFormviewModal:Lyte.attr("boolean"),browserName:Lyte.attr("string",{default:$L.userAgent.browser})}},init:function(){-1!==navigator.appVersion.indexOf("Mac")?this.setData("maxShortcutToolTip",I18n.getMsg("crm.richtext.tool.mac.maximize")):this.setData("maxShortcutToolTip",I18n.getMsg("crm.richtext.tool.maximize"))},convertRgbToRgbaFormat:function(t){return/rgba/i.test(t)?t:/rgb/i.test(t)?"rgba("+(t=t.substring(4,t.length-1).split(","))[0].trim()+", "+t[1].trim()+", "+t[2].trim()+", 1)":void 0},setUsedColorsList:function(){for(var t,e=this.getData("cxPropValue"),a=this.getData("crmNoteIconData")[1].subIcons,o=/['"\s]color\s*:\s*([^;'"]+)[;'"]/gi,i=[],r=[];null!==(t=o.exec(e));){var s=this.convertRgbToRgbaFormat(t[1]);if(i&&i.contains(s)){var l=i.indexOf(s);i.splice(l,1)}s&&i.unshift(s)}for(a[0].usedColorsList=i,o=/-color:\s*([^;'"]+)[;'"]/gi;null!==(t=o.exec(e));){s=this.convertRgbToRgbaFormat(t[1]);if(r&&r.contains(s)){l=r.indexOf(s);r.splice(l,1)}s&&r.unshift(s)}a[1].usedColorsList=r},didConnect:function(){var t=this,e=$L(this.$node.querySelector(".rtfParentWrap"));this.$node.querySelector("lyte-texteditor");if(this.getData("cxPropField")&&this.getData("cxPropField").read_only&&!this.getData("isWfAction")&&this.setData("cxPropReadonly",!0),"create"===this.getData("cxPropFrom")&&this.openRichtextEditorAndInsertInitialValue(),"view"===this.getData("cxPropFrom")){if(this.getData("cxPropValue")&&this.setData("cxPropValue",this.addCrmSpecificStylestoView(this.getData("cxPropValue"))),this.getData("cxPropHasMoreContent")&&this.setData("cxPropValue",this.getData("cxPropValue")+"..."),"fromFindAndMerge"===this.getData("cxPropViewedFrom")){var a=this.getData("cxPropDisplayLabel")+"_"+this.getData("cxPropField.id"),o=$L("crm-merge-entity")[0].component,i=o.getData("moreOptionRequired"),r=o.getData("isMoreOptionChanged");t.isShowMoreButtonRequired()?i[a]=!0:i[a]=!1,this.setData("cxPropToViewMore",!r),o.setData("moreOptionRequired",i)}if(this.getData("showMoreButton")){t.showMoreButton();new IntersectionObserver((function(e){e[0].isIntersecting&&!t.getData("buttonNeeded")&&t.showMoreButton()})).observe(this.$node)}}if(this.getData("cxPropDisplayLabel")||this.setData("cxPropDisplayLabel",this.getData("cxPropField.display_label")||t.getData("cxPropField.field_label")),this.getData("standardView")){var s=$L("#dvinner"),l=e.closest(".rtfDvEditWrap").prev()[0].getBoundingClientRect(),n=s[0].getBoundingClientRect();l.top>=n.top&&l.bottom<=n.bottom||setTimeout((function(){$L(".rtfEditorPanelWrap")[0].scrollIntoView({behaviour:"smooth",block:"center"})}),1)}this.getData("isforFormviewModal")||(t._resize=t.rtfresizeCalc.bind(t),window.addEventListener("resize",t._resize,!0)),t.keyDown=t.rtfKeyDownFunction.bind(t),document.addEventListener("keydown",t.keyDown),"zh_CN"!==Crm.userDetails.RELEVANT_LOCALE&&"zh_TW"!==Crm.userDetails.RELEVANT_LOCALE&&"ja_JP"!==Crm.userDetails.RELEVANT_LOCALE||$L(t.$node).addClass("rtfUnservedFontWrap")},didDestroy:function(){var t=$L("#zc_ajax_popover");document.removeEventListener("keydown",this.rtfKeyDownFunction),window.removeEventListener("resize",this.rtfresizeCalc),$L("body").removeClass("oH"),$L(".rtfDvEditWrap").removeClass("vH"),$L("#dvinner").removeClass("oH"),$L("#detailcanvascontainer").removeClass("oH"),t.length&&(t[0].ltProp("duration","500"),$L("#zc-richtextedit-el").removeAttr("id"))},observeMandatory:function(){this.observeMandatoryMixin(".rtfParentWrap")}.observes("cxPropField.required","lyteViewPort").on("didConnect"),observeReadOnly:function(){this.getData("cxPropField").read_only||this.getData("cxPropReadonly")?this.addReadOnlyClasses():this.removeReadOnlyClasses()}.observes("cxPropField.read_only","cxPropReadonly"),observeErrorMsg:function(){var t=$L(this.$node.querySelector(".rtfParentWrap"));this.getData("cxPropErrorMessage")&&this.getData("cxPropErrorMessage").trim()?(t.addClass("rtfEditorError"),this.getData("compFuncUsed")&&this.setData("errorMessage",!0)):(t.removeClass("rtfEditorError"),this.getData("compFuncUsed")&&this.setData("errorMessage",!1)),this.setData("cxPropMaxErrorMsg",this.getData("cxPropErrorMessage"))}.observes("cxPropErrorMessage"),observeChangeInValue:function(){var t=this.$node.querySelector("lyte-texteditor");if("view"===this.getData("cxPropFrom")&&(this.getData("cxPropValue")&&this.setData("cxPropValue",this.addCrmSpecificStylestoView(this.getData("cxPropValue"))),this.getData("showMoreButton"))){var e=this;setTimeout((function(){e.showMoreButton()}),50)}"create"===this.getData("cxPropFrom")&&this.getData("iscxPropValueChanged")&&t?(!this.getData("isRichTextNeeded")&&this.getData("cxPropValue")&&this.actions.openRichTextEditor.call(this,$L(this.$node.querySelector(".multilineFieldRTE")),!0,!1),t.clear(),this.getData("cxPropValue")&&t.insertHTML(this.getData("cxPropValue"))):"create"===this.getData("cxPropFrom")&&this.setData("iscxPropValueChanged",!0)}.observes("cxPropValue"),observeChangeInView:function(){"create"===this.getData("cxPropFrom")?this.openRichtextEditorAndInsertInitialValue():"view"===this.getData("cxPropFrom")&&(this.setData({miniEditorHeight:0,miniEditorWidth:0,isMaximized:!1,toggleKeyPress:!1}),this.showMoreButton())}.observes("cxPropFrom"),openRichtextEditorAndInsertInitialValue:function(){var t=this.$node.querySelector("lyte-texteditor"),e=$L(this.$node.querySelector(".rtfParentWrap"));if("firefox"===this.getData("browserName").toLowerCase()&&(-1!==navigator.userAgent.indexOf("Mac")?t.setData("ltPropDisabledPasteTooltip",I18n.getMsg("crm.richtext.tool.mac.paste.notsupport")):t.setData("ltPropDisabledPasteTooltip",I18n.getMsg("crm.richtext.tool.paste.notsupport"))),this.getData("cxPropValue")&&(this.setUsedColorsList(),this.setData("isRichTextNeeded",!0),t&&(t.insertHTML(this.getData("cxPropValue")),t.resetQueue(),this.getData("cxPropInitialScrollNeeded")||t.ltProp("preventInitialScroll",!0))),!0===this.getData("isRichTextNeeded")){var a=$L(this.$node.querySelector(".rtfEditorPanelWrap"));e.addClass("rtfP0"),a.addClass("rtfEventNone"),this.getData("cxPropInitialFocusNeeded")&&(e.addClass("multilineFocus"),a.removeClass("rtfEventNone"),setTimeout((function(){t.focus()}),450))}else t.ltProp("resize",{horizontal:!1,vertical:!1});if(this.getData("cxPropReadonly")&&this.addReadOnlyClasses(),this.getData("psScrollClassNeeded")){var o=$L(t.querySelector(".lyteEditorMainDiv"));o&&o.addClass("ps-child")}if(this.getData("isLyteCreate")&&this.setData("lastUpdatedCruxValue",t.getHTML(!0,!0)),this.setData("cxPropIntialContLen",this.getContentValFromEditor(t).length),this.getData("cxPropEditorInitialHeight")){var i=$L(t);i.css("height",this.getData("cxPropEditorInitialHeight")).addClass("rtfTransitionNone"),setTimeout((function(){i.removeClass("rtfTransitionNone")}),1)}if(this.setDataZCQAForEditorElements(),"create"===this.getData("cxPropFrom")&&this.getData("cxPropDefaultMaximize")){this.initMaximize.call(this,$L(this.$node.querySelector(".rtfEditorMaximizeIcon")));var r=$L(this.$node.querySelector(".rtfInitWrap")),s=r.find(".crmMultiLineInnerLayer");r.addClass("rtfTransitionNone"),s.addClass("rtfTransitionNone"),$L(t).addClass("rtfTransitionNone")}},observeDataZCQA:function(){"create"===this.getData("cxPropFrom")&&this.setDataZCQAForEditorElements()}.observes("dataZcqa"),addReadOnlyClasses:function(){this.getData("cxPropReadonly")||this.setData("cxPropReadonly",!0);var t=this.$node.querySelector("lyte-texteditor"),e=$L(this.$node.querySelector(".rtfParentWrap"));!this.$node.closest(".createMultiLineRTFFieldtask")&&e&&e.addClass("rtfReadOnly"),$L(this.$node.querySelector(".rtfCreateField")).addClass("rtfCreateFieldReadOnly"),t.ltProp("disabled",!0),t.ltProp("readonly",!0)},removeReadOnlyClasses:function(){this.getData("cxPropReadonly")&&this.setData("cxPropReadonly",!1);var t=this.$node.querySelector("lyte-texteditor"),e=$L(this.$node.querySelector(".rtfParentWrap"));!this.$node.closest(".createMultiLineRTFFieldtask")&&e&&e.removeClass("rtfReadOnly"),$L(this.$node.querySelector(".rtfCreateField")).removeClass("rtfCreateFieldReadOnly"),t&&(t.ltProp("disabled",!1),t.ltProp("readonly",!1))},addCrmSpecificStylestoView:function(t){var e=(new DOMParser).parseFromString(t,"text/html");return e=this.addBoldFontFamilyToList(e),(e=this.addListPositionAndPadding(e)).body.innerHTML},addBoldFontFamilyToList:function(t){for(var e=t.getElementsByTagName("li"),a=e.length,o=0;o<a;o++)e[o].style.fontWeight&&(e[o].style.fontFamily="var(--crm-font-bold)",e[o].style.fontWeight="normal");return t},addListPositionAndPadding:function(t){for(var e=t.querySelectorAll("ul,ol"),a=e.length,o=0;o<a;o++)e[o].style.listStylePosition="inside","B"!==e[o].parentElement.tagName&&"I"!==e[o].parentElement.tagName&&"U"!==e[o].parentElement.tagName&&(e[o].style.paddingInlineStart="20px");return t},setDataZCQAForEditorElements:function(){for(var t=this.getData("crmNoteIconData"),e=t.length,a=0;a<e;a++)for(var o=t[a].subIcons,i=o.length,r=0;r<i;r++){if(this.getData("dataZcqa")){var s={"data-zcqa":this.getData("dataZcqa")+"_richtext_toolbar_"+o[r].name};o[r].attr=s}else{s={"data-zcqa":"richtext_toolbar"+o[r].name};o[r].attr=s}if("list"===o[r].type)for(var l=o[r].list,n=l.length,c=0;c<n;c++)if(this.getData("dataZcqa")){s={"data-zcqa":this.getData("dataZcqa")+"_richtext_toolbar_"+o[r].name+"_"+l[c].name};l[c].attr=s}else{s={"data-zcqa":"richtext_toolbar"+o[r].name+"_"+l[c].name};l[c].attr=s}}},removeTabLevel:function(t){return t.replace(/--tablevel:\d+;/g,"")},getValue:function(){return this.getData("cxPropValue")?this.getData("cxPropValue"):""},getTextValue:function(){return this.getData("cxPropValue")?(new DOMParser).parseFromString(this.getData("cxPropValue"),"text/html").documentElement.textContent:""},getContentValFromEditor:function(t){if(!t||!t.getText()||!t.getText().trim())return"";var e=this.removeTabLevel(t.getHTML(!0,!0));return(e=e.replaceAll("\n","<br>")).endsWith("<br>")&&(e=e.slice(0,-4)),e},validate:function(){return!!(this.getData("cxPropValue")&&this.data.cxPropValue.trim()&&this.getTextValue().trim()||this.validateMandatory(!0))&&(!(this.getData("cxPropValue")&&!this.validateLength(this.getData("cxPropValue")))&&(this.setData("cxPropErrorMessage",""),!0))},validateRtfMergeValue:function(t){if(t.includes("<b>")||t.includes("<i>")||t.includes("<u>")||t.includes("<em>")||t.includes("<strong>")||t.includes("<a>")||t.includes("<mark>")||t.includes("<del>")||t.includes("<small>")||t.includes("<sub>")||t.includes("<sup>")||t.includes("<span"))return!1;var e=CrmConvertMergeFields.removeMergeFieldsInStr(t).trim();return!((e=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent).length>0)},showMoreButton:function(){this.getData("showMoreButton")&&(this.isShowMoreButtonRequired()?this.setData("buttonNeeded",!0):this.setData("buttonNeeded",!1)),this.addShowMoreButtonClasses()},isShowMoreButtonRequired:function(){if("view"===this.getData("cxPropFrom")&&this.getData("cxPropValue")&&this.data.cxPropValue.trim()){var t=$L(this.$node.querySelector(".rtfViewValue"));if(t.addClass("rtfLessText"),"safari"===this.getData("browserName").toLowerCase())t.closest(".rtfViewParent").addClass("rtfLessTextSaf");return t[0].scrollHeight>t[0].clientHeight}},addShowMoreButtonClasses:function(){var t=$L(this.$node.querySelector(".rtfViewValue")),e=t.closest(".rtfViewParent");this.getData("showFullContent")?(t.removeClass("rtfLessText"),e.removeClass("rtfLessTextSaf")):(t.addClass("rtfLessText"),"safari"===this.getData("browserName").toLowerCase()&&e.addClass("rtfLessTextSaf"))},rtfresizeCalc:function(){var t=window.innerHeight,e=window.innerWidth;if(this.getData("isMaximized")&&"create"===this.getData("cxPropFrom")){var a=$L(this.$node.querySelector(".rtfInitWrap")),o=$L(this.$node.querySelector(".crmMultiLineInnerLayer")),i=a.closest(".rtfDvEditWrap"),r=i.find(".rtfDvSaveCancelBtn"),s=$L(this.$node.querySelector(".richTextField")),l=t/100*80,n=e/100*80,c=(t-l)/2,d=(e-n)/2,p=l-88,u=n-60,m=o.position().top,h=e-(u+d+r.outerWidth())+11,f=c+m;this.getData("cxPropSaveCloseIconNeededInMaximize")&&(u=n-122),i.length>0&&(u=n-(70+r.outerWidth()),r.css("top",f),Crm.userDetails.RTL_ENABLED?r.css("left",h):r.css("right",h)),a.addClass("rtfTransitionNone"),s.addClass("rtfTransitionNone"),o.addClass("rtfTransitionNone"),a.css({height:l,width:n,top:c,left:d}),o.css({height:p,width:u}),s.css("height",p-35),a.find(".rtfEditorPanel")[0].component.check_availability()}},rtfKeyDownFunction:function(t){if(27===t.keyCode){var e=$L(".zc_ajax_container").find(".rtfEditorMinimizeIcon"),a=this.getData("isMaximized"),o=this.getData("toggleKeyPress");$L(".rtfLargeTextEditorParent").is(":visible")&&t.preventDefault(),e.length&&o&&this.actions.initMinimize.call(this,e),a&&o&&(this.data.canvasFormView.isFormView?this.actions.formviewMinimize.call(this,this.$node.querySelector(".rtfEditorMinimizeIcon")):this.actions.initMinimize.call(this,this.$node.querySelector(".rtfEditorMinimizeIcon")))}else 13===t.keyCode&&$L(document.activeElement).hasClass("rtfEditorMaximizeIcon")&&document.activeElement.click()},maximizeErrorField:function(t){var e,a=$L(t).closest(".cuserrorFborder");a.length?(e=a.parent().next().text(),this.setData("cxPropMaxErrorMsg",e)):this.setData("cxPropMaxErrorMsg","")},initMaximize:function(t){var e=$L(t),a=$L("body"),o=this,i=$L(t).closest(".task-detailview"),r=$L(t).closest(".tabdiV"),s=$L("#dvinner"),l=$L("#detailcanvascontainer"),n=$L(t).closest("lyte-wormhole"),c=$L(this.$node.querySelector(".rtfEditorPanelWrap")),d=renderingUtils.windowHeight,p=renderingUtils.windowWidth,u=e.closest(".ppTop"),m=e.closest("#appointmentCreate"),h=u,f=$L(".zc_ajax_container"),g=$L(".zc_ajax_field_label"),x=$L("#elementEditSpan"),y=$L(".zc_ajax_pop_wrapper").find(".lytePopover"),v=e.closest(".eventPop"),P=e.closest(".eventCreateCalenderView"),C=v.is(":visible"),L=P.is(":visible"),M=e.closest(".rtfParentWrap"),w=M.height(),b=M.width(),D=e.closest(".rtfInitWrap"),F=e.closest(".crmMultiLineInnerLayer"),E=M[0].getBoundingClientRect().top,I=d/100*80,z=p/100*80,T=D.offset().left,V=(d-I)/2,S=I-88,$=z-60,q=F.find(".richTextField"),_=$L(".rtfViewModalValWrap").closest("lyte-yield")[0],N=e.closest(".newActivitesPopupStyleEle"),R=$L(t).closest(".socAddToCrmPopover"),W=e.closest(".lyteModal"),k=e.closest(".zcrm-modal"),H=k.find(".zcrm-content"),A=(p-k.outerWidth())/2,B=this.getData("cxPropSaveCloseIconNeededInMaximize");s.addClass("oH"),l.addClass("oH"),a.addClass("oH"),f.addClass("rtfDvEditWrap"),r.addClass("rtfDvParent"),g.addClass("labelHide"),W.addClass("customRTFLytePopUp"),H.addClass("customRTFLookPopUPChild"),k.addClass("customRTFLookPopUP"),k.css({left:A}),N.addClass("customRTFPopup"),x.addClass("rtfDvSaveCancelBtn elementEditHide");var O=e.closest(".rtfDvEditWrap"),U=O.find(".rtfDvSaveCancelBtn"),j=U.outerWidth();if(i.length>0&&(Crm.userDetails.isCanvasActivitySupportEnabled?(s.removeScroll(),$L(this.$node).addClass("preventWheel")):thirdPartyUtils.unbindPerfectScroll(s)),n.length){var Z=n[0].component.parent;!0===Z.ltProp("closeOnEscape")&&($L(Z).addClass("rtfModalClass"),$L(".rtfModalClass")[0].ltProp("closeOnEscape",!1))}R.length>0&&R.addClass("rtfSocAddToCrmPopover"),m.length<1?h.addClass("customRTFPopup"):h.addClass("customRTFappointmentPopUp"),!L&&C&&v.addClass("customRTFMeetingPopUp"),_&&_._callee&&0===l.length&&_._callee.ltProp("freeze",!1),this.getData("isLyteCreate")&&o.maximizeErrorField(t),o.setData({miniEditorHeight:w,miniEditorWidth:b,isMaximized:!0}),D.css({height:w,width:b,top:E,left:T}),F.css({height:w,width:b});var K=p-($+(T=(p-z)/2)+j)+11;c.removeClass("rtfEventNone"),O.addClass("vH"),M.removeClass("vH"),B&&($=z-122,F.addClass("rtfMaxMl30")),this.getData("cxPropDefaultMaximize")?(D.css({height:I,width:z,left:T,top:V}),O.length>0&&($=z-(70+j),F.addClass("rtfMaxMl30")),F.css({height:S,width:$}),U.addClass("rtfCloseSave").removeClass("elementEditHide"),U.css("top",V+70),y.addClass("vH"),Crm.userDetails.RTL_ENABLED?U.css("left",K):U.css("right",K),q.css("height",S-35),q[0].ltProp("resize",{horizontal:!1,vertical:!1}),o.setData("cxPropDefaultMaximize",!1),q[0].ltProp("focus",!0),M.find(".rtfEditorPanel")[0].component.check_availability(),o.setData("toggleKeyPress",!0)):(setTimeout(function(){D.css({height:I,width:z,left:T,top:V}),y.addClass("vH"),O.length>0&&($=z-(70+j),F.addClass("rtfMaxMl30")),F.css({height:S,width:$}),U.addClass("rtfCloseSave"),q.css("height",S-35),q[0].ltProp("resize",{horizontal:!1,vertical:!1}),crmui.modalZIndex("nonLyte",D[0],"open"),U.css("zIndex",crmui.zIndex+2)}.bind(this,e),101),D.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){D.trapFocus();var t=O.find(".rtfDvSaveCancelBtn");t.css("top",V+70).removeClass("elementEditHide"),Crm.userDetails.RTL_ENABLED?t.css("left",K):t.css("right",K),q[0].ltProp("focus",!0),M.find(".rtfEditorPanel")[0].component.check_availability(),o.setData("toggleKeyPress",!0)}.bind(O,q,M)))},loadFullContent:async function(){var t=this,e=this.getData("cxPropField.api_name")||this.getData("cxPropFieldApiName"),a=this.getData("cxPropModuleApiName"),o=this.getData("cxPropRecordId");e&&a&&o&&await store.findAll("dummy",null,!1,!1,{url:"crm/v6/"+a+"/"+o+"/actions/fetch_full_data?fields="+e}).then((function(a){var o=a.data[0][e];t.setData("cxPropValue",o)}))},actions:{onMaximizeSave:function(){this.getMethods("onMaximizeSave")&&this.executeMethod("onMaximizeSave",event)},onMaximizeClose:function(){this.getMethods("onMaximizeClose")&&this.executeMethod("onMaximizeClose",event),this.setData({miniEditorHeight:0,miniEditorWidth:0,isMaximized:!1,toggleKeyPress:!1})},openMaxEditor:function(){if(!this.getData("cxPropReadonly")&&this.getData("cxPropIsEditable")){var t=this.$node.querySelector(".rtfViewModal"),e=t.closest(".zcanvas.divClass"),a=$L("crm-detailview-canvas");if(t.ltProp("closeDuration",1),e&&a)$L("#zc_ajax_popover")[0].ltProp("duration","0"),a[0].component.handleeditButtonMethod(),$L(".rtfInitWrap").addClass("rtfTransitionNone"),$L(".crmMultiLineInnerLayer").addClass("rtfTransitionNone"),$L(".richTextField").addClass("rtfTransitionNone");else{var o=this.$node.closest("crm-detailview-fields");o?o.click():(triggerClickEvent(event),sE(event))}setTimeout((function(){t.ltProp("show",!1)}),150)}},toggleFocusState:function(t,e){var a=this.getData("isMaximized"),o=this.getData("cxPropReadonly"),i=this.$node.querySelector("lyte-texteditor"),r=$L(t);!this.getData("isRichTextNeeded")&&e&&this.actions.openRichTextEditor.call(this,t,!1,!0);var s,l,n=event.relatedTarget;(n&&(s=n.closest(".rtfParentWrap")||n._callee&&(n._callee.closest(".rtfParentWrap")||n._callee._callee&&(n._callee._callee.closest(".rtfParentWrap")||n._callee._callee._callee&&(n._callee._callee._callee.closest(".rtfParentWrap")||n._callee._callee._callee._callee&&n._callee._callee._callee._callee.closest(".rtfParentWrap"))))),e||!this.data.isLyteCreate||n&&s===this.$node.querySelector(".rtfParentWrap")||this.getData("lastUpdatedCruxValue")===i.getHTML(!0,!0))||(l=this.data.canvasFormView.isFormView?$L("crm-canvas-form")[0].component:$L(t)[0].closest("crm-create-fields").component,this.getTextValue().trim()?l.executeMethod("cruxValueChange",this.getData("cxPropField").api_name,this.getData("cxPropValue")):l.executeMethod("cruxValueChange",this.getData("cxPropField").api_name,this.getTextValue()),this.getMethods("onValueChange")&&this.executeMethod("onValueChange",this),this.setData("lastUpdatedCruxValue",i.getHTML(!0,!0)));!e||a||o?(r.closest(".focusEleField").removeClass("focusEleField"),this.data.canvasFormView.isFormView?r.closest(".zcanvas_value_richtext").removeClass("zcInputFocus"):r.closest(".rtfParentWrap").removeClass("multilineFocus"),r.closest(".quickCreatertfField").removeClass("wf_setFocus"),a||$L(this.$node.querySelector(".rtfEditorPanelWrap")).addClass("rtfEventNone")):(r.closest(".createMultiLineRTFField").addClass("focusEleField"),r.closest(".rtfQuickCreateField").addClass("focusEleField"),r.closest(".createMultiLineRTFFieldtask").addClass("focusEleField"),r.closest(".rtfLabelValBc").addClass("focusEleField"),this.data.canvasFormView.isFormView?r.closest(".zcanvas_value_richtext").addClass("zcInputFocus"):r.closest(".rtfParentWrap").addClass("multilineFocus"),r.closest(".quickCreatertfField").addClass("wf_setFocus"),r.closest(".tabDiv").addClass("focusEleField"),$L(this.$node.querySelector(".rtfEditorPanelWrap")).removeClass("rtfEventNone"))},onEditorPanelFocus:function(){this.$node.querySelector(".richTextField").ltProp("focus",!0)},toggleContent:async function(t){t.stopPropagation();var e=$L(this.$node.querySelector(".rtfViewValue"));if(this.getData("showFullContent"))if(this.setData("showFullContent",!1),this.addShowMoreButtonClasses(),this.getMethods("onShowLess"))this.executeMethod("onShowLess",this);else{var a,o=e.closest("#detailcanvascontainer"),i=e.closest("#dvinner"),r=e.closest(".ntcBcContent"),s=e.closest(".publicFldRichTxtCompWrapper");o.length>0&&(a=o),i.length>0&&(a=i),r.length>0&&(a=r),s.length>0&&(a=s);var l=a[0].getBoundingClientRect(),n=e[0].getBoundingClientRect(),c=a.scrollTop()-e.height()+e.offset().top-200;n.top>=l.top&&n.bottom<=l.bottom||a.scrollTop(c)}else this.getData("cxPropHasMoreContent")&&(await this.loadFullContent(),this.setData("cxPropHasMoreContent",!1)),this.setData("showFullContent",!0),this.addShowMoreButtonClasses()},openRichTextEditor:function(t,e,a){var o=this;if(!o.getData("isRichTextNeeded")&&(!this.getData("cxPropReadonly")||e)){var i=$L(t).closest(".quickCreatertfField"),r=i.outerWidth();setTimeout(function(){if(o.setData("isRichTextNeeded",!0),o.data.canvasFormView.isFormView){var e=$L(t).closest("crm-richtext-component");if(e.closest(".zc-tabindex-configured").length){var i=e.find(".richTextField")[0].ltProp("tabindex");e.find(".rtfEditorPanel")[0].ltProp("tabindex",i)}}a&&$L(t).find(".richTextField")[0].focus(),$L(o.$node.querySelector(".rtfParentWrap")).addClass("rtfP0"),$L(o.$node.querySelector(".richTextField"))[0].ltProp("resize",{horizontal:!1,vertical:!0}),o.$node.querySelector("lyte-editorpanel").refresh(),!this.getData("cxPropReadonly")&&a||$L(o.$node.querySelector(".rtfEditorPanelWrap")).addClass("rtfEventNone")}.bind(o),10),i.length&&i.attr("style",`width: ${r}px !important`)}},clickMaximize:function(t){this.initMaximize.call(this,t)},detailPageMax:function(t,e){e.stopPropagation();var a=$L(this.$node.querySelector(".rtfViewModal")),o=$L(this.$node.querySelector(".rtfViewParent")),i=$L(this.$node.querySelector(".rtfDummyorigin"));o.addClass("vH"),i.addClass("rtfModalOrigin"),setTimeout(function(){a[0].ltProp("show",!0),a[0].ltProp("closeDuration",void 0),a[0].ltProp("freeze",!0),this.executeMethod("viewModalResize")}.bind(this),0),setTimeout(function(){this.setData("viewIsMax",!0),a[0].ltProp("closeOnEscape",!0)}.bind(this),500)},detailPageMin:function(){$L(this.$node.querySelector(".rtfViewModal"))[0].ltProp("show",!1),this.setData("viewIsMax",!1)},formviewMaximize:function(t,e){e&&e.stopPropagation();var a=$L("crm-canvas-formview-richtext-modal"),o=$L(t);o.addClass("formViewRtfModalOrigin");var i=this.getData("id")+"_modal",r=o.closest("crm-richtext-component").find("lyte-texteditor").get(0).getHTML();a.length?a[0].setData({show:!0,field:this.getData("cxPropField"),id:i,value:r}):Lyte.Component.render("crm-canvas-formview-richtext-modal",{show:!0,field:this.getData("cxPropField"),id:i,value:r},"#canvasFormViewRichTextContainer")},formviewminimize:function(){$L("crm-canvas-formview-richtext-modal")[0].setData({show:!1,field:this.getData("cxPropField")})},rtfKeyMaximize:function(t,e){var a=this.getData("isMaximized"),o=this.getData("toggleKeyPress");this.getData("isRichTextNeeded")&&!$("#userInfoScreen").length&&(!(-1!==navigator.appVersion.indexOf("Win")?t.ctrlKey:-1!==navigator.appVersion.indexOf("Mac")?t.metaKey:t.ctrlKey)||13!==t.keyCode||a||o||(this.data.canvasFormView.isFormView?this.actions.formviewMaximize.call(this,e):this.initMaximize.call(this,e)))},initMinimize:function(t){var e=$L("body"),a=$L(t).closest(".task-detailview"),o=$L("#dvinner"),i=$L("#detailcanvascontainer"),r=$L(".rtfModalClass");e.addClass("oH"),$L(".rtfViewValue").removeClass("op0");var s=this.$node,l=$L(t).closest(".rtfInitWrap"),n=$L(t).closest(".rtfDvParent"),c=$L(s.querySelector(".rtfCursor")),d=$L(".customRTFPopup"),p=$L(".customRTFLookPopUP"),u=$L(".customRTFappointmentPopUp"),m=$L(".customRTFLytePopUp"),h=$L(t).closest(".rtfParentWrap"),f=h.find(".richTextField"),g=$L(t).closest(".rtfDvEditWrap"),x=h.find(".crmMultiLineInnerLayer "),y=$L("#"+s.getData("id")+"_EditorPanel"),v=s.getData("miniEditorHeight"),P=s.getData("miniEditorWidth"),C=h.offset().left,L=h[0].getBoundingClientRect().top,M=$L(".rtfCloseSave"),w=$L(".zc_ajax_field_label"),b=$L(".zc_ajax_pop_wrapper").find(".lytePopover");(w.removeClass("labelHide"),l.removeClass("rtfTransitionNone"),f.removeClass("rtfTransitionNone"),x.removeClass("rtfTransitionNone"),f.css("height",v-33),x.css({height:v,width:P,top:L,left:C}),l.css({height:v+100,width:P+60,top:L-66,left:C-30}),l.trapFocus("destroy"),M.removeAttr("style"),n.removeClass("rtfDvParent"),"elementEditSpan"===M.attr("id"))&&(M.closest(".zc_ajax_container").removeClass("rtfDvEditWrap"),M.removeClass("rtfDvSaveCancelBtn"));l.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){b.removeClass("vH"),g.removeClass("vH"),h.removeClass("vH"),o.removeClass("oH"),i.removeClass("oH"),M.removeClass("rtfCloseSave"),d.addClass("rtfTransitionNone"),m.addClass("rtfTransitionNone"),p.addClass("rtfTransitionNone"),u.addClass("rtfTransitionNone"),p.css({left:""}),d.removeClass("customRTFPopup"),u.removeClass("customRTFappointmentPopUp"),p.removeClass("customRTFLookPopUP"),$L(".customRTFLookPopUPChild").removeClass("customRTFLookPopUPChild"),$L(".customRTFMeetingPopUp").removeClass("customRTFMeetingPopUp"),$L(".rtfSocAddToCrmPopover").removeClass("rtfSocAddToCrmPopover"),m.removeClass("customRTFLytePopUp"),s.setData({miniEditorHeight:0,miniEditorWidth:0,isMaximized:!1}),h.focus(),f[0].ltProp("focus",!0),l.css({height:"",width:"",left:"",top:""}),x.css({height:"",width:"",left:"",top:""}),f[0].ltProp("resize",{horizontal:!1,vertical:!0}),y[0].checkWidth(),setTimeout((function(){e.removeClass("oH"),a.length>0&&(Crm.userDetails.isCanvasActivitySupportEnabled?(o.scroll(),$L("crm-richtext-component.preventWheel").removeClass("preventWheel")):thirdPartyUtils.bindPerfectScroll(o)),s.setData("toggleKeyPress",!1),r.length&&(r[0].ltProp("closeOnEscape",!0),r.removeClass("rtfModalClass"));var t=h.closest(".rtfDvEditWrap")[0],i=o[0];if(t&&i){var l=t.getBoundingClientRect(),n=i.getBoundingClientRect();l.top>=n.top&&l.bottom<=n.bottom||(c.is(":visible")?c[0].scrollIntoView({behaviour:"smooth",block:"center"}):y[0].scrollIntoView({behaviour:"smooth",block:"center"}))}$L(".rtfTransitionNone").removeClass("rtfTransitionNone")}),1),crmui.modalZIndex("nonLyte",l[0],"close")}.bind(s,l))}},methods:{onEditorRender:function(){if(this.data.canvasFormView.isFormView){var t=$(this.$node).closest(".zcanvas-value-container"),e=zutils.getinstancetool(),a=e.getSelectorByElement(t,"default"),o=e.getstylebyselector(a),i=t.find("lyte-texteditor");if(!canvasObjUtils._.isEmpty(o)&&o.default&&o.default.$height){var r=zutils.zcopyobj2(o);i.css("height",r.default.$height),delete r.default.$height,e.config.preventDeleteRule=!1;var s=(a=e.getSelectorByElement(t)).replace(".zcanvas-field",".zcanvas-field(.zc_dummystate)");s+=" .zcanvas_value_richtext",e.deleterule(s),e.addrule(a,r.default,!1,null,null,null,{state:"default",type:"richText value"}),e.config.preventDeleteRule=!0}else i.css("height","100px")}},viewModalResize:function(){var t=window.innerHeight/100*80;this.setData("ViewModalHeight",t);var e=$L(this.$node.querySelector(".rtfViewModal"))[0];this.getData("viewIsMax")&&e&&(e.alignModal(),e.calculateOffset())},removeOriginClass:function(){var t=$L(this.$node.querySelector(".rtfViewModal"))[0];$L(".rtfModalOrigin").removeClass("rtfModalOrigin"),this.setData("viewIsMax",!1),t.ltProp("closeOnEscape",!1)},rtfViewModalBeforeClose:function(){$L(this.$node.querySelector(".rtfViewParent")).removeClass("vH")},toggleFocusEditorIcon:function(t,e){var a=$L(this.$node.querySelector(".rtfEditorPanelWrap")),o=this.getData("cxPropReadonly"),i=$L(this.$node.querySelector(".richTextField")),r=$L(t);!e||this.getData("isMaximized")||o?($L(".rtfModalWrapper").removeClass("rtfModalWrapper"),$L(".rtfFocusIcon").removeClass("rtfFocusIcon"),r.closest(".rtfCreateField").removeClass("custHighlBorder"),a.removeClass("removeRtfEventNone"),i[0].ltProp("focus",!0)):(r.closest(".modalWrapper").addClass("rtfModalWrapper"),r.closest(".createMultiLineRTFField").addClass("rtfFocusIcon"),r.closest(".rtfQuickCreateField").addClass("rtfFocusIcon"),r.closest(".createMultiLineRTFFieldtask").addClass("rtfFocusIcon"),r.closest(".rtfLabelValBc").addClass("rtfFocusIcon"),r.closest(".rtfParentWrap").addClass("rtfFocusIcon"),r.closest(".quickCreatertfField").addClass("rtfFocusIcon"),r.closest(".tabDiv").addClass("rtfFocusIcon"),r.closest(".rtfCreateField").addClass("custHighlBorder"),a.addClass("removeRtfEventNone"))},checkEmojiClose:function(t){if("lyteEmoji"===t.target.className)return!1},addDataZcqaToLinkPopup:function(t,e){e.querySelector(".lyteEditorLinkUserInput").setAttribute("data-zcqa",this.getData("dataZcqa")+"_lyteEditor_link_text_input"),e.querySelector(".lyteEditorLinkURLInput").setAttribute("data-zcqa",this.getData("dataZcqa")+"_lyteEditor_link_url_input"),e.querySelector("lyte-button").setAttribute("data-zcqa",this.getData("dataZcqa")+"_lyteEditor_link_url_button")},beforeAnchorRemove:function(t){t.attr["url-detection"]=!1},validateMaxLengthAndSetVal:function(t){var e=this.getContentValFromEditor(t),a=e.length;a>this.data.cxPropMaxlength&&!(this.getData("cxPropIntialContLen")>this.data.cxPropMaxlength&&a<this.getData("cxPropIntialContLen"))?(t.undo(),_cruxUtils.removeCustomMessage(),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.richtext.warning.msg",Lyte.Component.registeredHelpers.formatNumber(this.data.cxPropMaxlength.toString())),ltPropType:"warning"}})):(this.getData("cxPropIntialContLen")>this.data.cxPropMaxlength&&a<this.getData("cxPropIntialContLen")&&(this.setData("cxPropIntialContLen",a),t.resetQueue(1)),this.setData("iscxPropValueChanged",!1),this.setData("cxPropValue",e),this.getData("cxPropClearErrorMessage")&&this.setData("cxPropErrorMessage",""),this.getMethods("onEditorValueChange")&&this.executeMethod("onEditorValueChange",this))},validateMaxLengthAndSetFormatVal:function(t){this.executeMethod("validateMaxLengthAndSetVal",t.component.editor)},validatePasteContentAndSetVal:function(t){this.executeMethod("validateMaxLengthAndSetVal",t)}}},{mixins:["crux-element-validation"]});
