function havevalidLength(e,t,i){if(e&&e.length){var r=(t=Array.isArray(t)?t:t+"").length;return i&&-1!==t.indexOf(".")&&(r=r?--r:r),r<=e.length}return!0}function getcurrentFieldAtributes(e,t){var i=t.$&&t.$.model&&t.$.model.fieldList?t.$.model.fieldList:{};if(i)return i[e]}function eliminateDuplicates(e){var t,i=e.length,r=[],a={};for(t=0;t<i;t++)a[e[t]]=0;for(t in a)r.push(t);return r}Lyte.Service.register("globalAccessibilityServices",class{initialVariablesetter(e){this.accessibilityDefaultData={accessibility:{vision:{screen_reader:null,zoom:null,font_size:{size:"default"},spacing:{character_spacing:"normal"},magnify_on_text_hover:{enable:!1},motion_control:{animation_speed:"default"},switch_state_label:{enable:!1},strike_through__disabled_buttons:{enable:!1},form_display_mode:{enable:!1},mandatory_field:{mandatory_field_type:"red_accent_line"},custom_error:{message_color:"#FF5D5A",alert_icon:!1,enable:!1},flash_screen:{enable:!1},aria_landmark:{enable:!1,banner:"#660000",complementary:"#DE4F5D",content_info:"#07385D",form:"#366DC7",main:"#37A5A5",navigation:"#165151",region:"#996633",search:"#313949"}},motor:{standard_navigation_order:{enable:!1},voice_assistant:{enable:!1,autoStopDuration:"3000",numberOverlay:!1}},interaction:{reading_focus:{enable:!1,focus_mode:"small",focus_height:80,focus_width:60,mask_opacity:50},underline_links:{enable:!1}}}},this.accessibilityConfiguration={},void 0===e&&(e=Lyte.deepCopyObject(this.accessibilityDefaultData)),this.mediaQuery=window.matchMedia("(prefers-reduced-motion: reduce)"),this.accessibilityConfiguration.vision=e.accessibility.vision,this.accessibilityConfiguration.motor=e.accessibility.motor,this.accessibilityConfiguration.interaction=e.accessibility.interaction,this.keyboardShortcut={enable:Crm.userDetails.isKeyboardShortcutsEnabled}}getVariable(e){switch(e){case"meta":return this.accessibilityMeta;case"motionControl":return this.accessibilityConfiguration.vision.motion_control.animation_speed;case"flashScreen":return this.accessibilityConfiguration.vision.flash_screen.enable;case"magnifyText":return this.accessibilityConfiguration.vision.magnify_on_text_hover.enable;case"ariaLandmarkEnable":return this.accessibilityConfiguration.vision.aria_landmark.enable;case"formDisplayMode":return this.accessibilityConfiguration.vision.form_display_mode.enable;case"mandatoryField":return this.accessibilityConfiguration.vision.mandatory_field.mandatory_field_type;case"standardNavigationOrder":return this.accessibilityConfiguration.motor.standard_navigation_order.enable;case"voiceAssistantEnable":return!!this.accessibilityConfiguration&&this.accessibilityConfiguration.motor.voice_assistant.enable;case"autoStopDuration":return this.accessibilityConfiguration?this.accessibilityConfiguration.motor.voice_assistant.autoStopDuration:"3000";case"numberOverlay":return!!this.accessibilityConfiguration&&this.accessibilityConfiguration.motor.voice_assistant.numberOverlay;case"customError":return this.accessibilityConfiguration.vision.custom_error;case"customErrorColor":return void 0!==this.accessibilityConfiguration?this.accessibilityConfiguration.vision.custom_error.message_color:"#FF5D5A";case"ariaLandMark":return void 0!==this.accessibilityConfiguration?this.accessibilityConfiguration.vision.aria_landmark:{enable:!1,banner:"#660000",complementary:"#DE4F5D",content_info:"#07385D",form:"#366DC7",main:"#37A5A5",navigation:"#165151",region:"#996633",search:"#313949"};case"accessibilityDefault":return this.accessibilityDefaultData;case"accessibility":return{accessibility:this.accessibilityConfiguration};case"keyboardShortcut":return this.keyboardShortcut;case"readingMask":return this.accessibilityConfiguration.interaction.reading_focus}}setVariable(e,t){switch(e){case"accessibility":this.accessibilityConfiguration=t;break;case"meta":this.accessibilityMeta=t;break;case"motionControl":this.accessibilityConfiguration.vision.motion_control.animation_speed=t;break;case"flashScreen":this.accessibilityConfiguration.vision.flash_screen.enable=t;break;case"formDisplayMode":this.accessibilityConfiguration.vision.form_display_mode.enable=t;break;case"mandatoryField":this.accessibilityConfiguration.vision.mandatory_field.mandatory_field_type=t;break;case"standardNavigationOrder":this.accessibilityConfiguration.motor.standard_navigation_order.enable=t;break;case"voiceAssistantEnable":this.accessibilityConfiguration.motor.voice_assistant.enable=t;break;case"autoStopDuration":this.accessibilityConfiguration.motor.voice_assistant.autoStopDuration=t;break;case"numberOverlay":this.accessibilityConfiguration.motor.voice_assistant.numberOverlay=t;break;case"customErrorEnable":this.accessibilityConfiguration.vision.custom_error.enable=t;break;case"customErrorColor":this.accessibilityConfiguration.vision.custom_error.message_color=t;break;case"customErrorAlert":this.accessibilityConfiguration.vision.custom_error.alert_icon=t;break;case"ariaLandMark":case"ariaLandMarkReset":this.accessibilityConfiguration.vision.aria_landmark=t;break;case"ariaLandMarkEnable":this.accessibilityConfiguration.vision.aria_landmark.enable=t;break;case"ariaLandMarkBanner":this.accessibilityConfiguration.vision.aria_landmark.banner=t;break;case"ariaLandMarkComplementary":this.accessibilityConfiguration.vision.aria_landmark.complementary=t;break;case"ariaLandMarkContentInfo":this.accessibilityConfiguration.vision.aria_landmark.content_info=t;break;case"ariaLandMarkForm":this.accessibilityConfiguration.vision.aria_landmark.form=t;break;case"ariaLandMarkMain":this.accessibilityConfiguration.vision.aria_landmark.main=t;break;case"ariaLandMarkNavigation":this.accessibilityConfiguration.vision.aria_landmark.navigation=t;break;case"ariaLandMarkRegion":this.accessibilityConfiguration.vision.aria_landmark.region=t;break;case"ariaLandMarkSearch":this.accessibilityConfiguration.vision.aria_landmark.search=t;break;case"keyboardShortcut":this.keyboardShortcut.enable=t}}accessibilityAPISettings(){return Lyte.resolvePromises(store.triggerAction("accessibility","fetch",void 0,{include:"accessibility_meta"}).then((function(e){return e})).catch((function(){})))}accessibilityAPI(){return Lyte.resolvePromises(store.triggerAction("accessibility","fetch").then((function(e){return e})).catch((function(){})))}accessibilityConfigInitialization(e){if(void 0!==e){var t=e.accessibility.vision,i=e.accessibility.motor,r=e.accessibility.interaction,a=$L("html");Object.keys(t).forEach(function(e){switch(e){case"font_size":"size"in t.font_size&&(a.attr("data-size",t.font_size.size),this.tabResize()),Crm.client_tracking("Accessibility_Vision1",{font_size:t.font_size.size});break;case"screen_reader":case"zoom":case"custom_error":break;case"spacing":"character_spacing"in t.spacing&&(a.attr("data-letterspacing",t.spacing.character_spacing),this.tabResize()),Crm.client_tracking("Accessibility_Vision1",{spacing:t.spacing.character_spacing});break;case"motion_control":if("animation_speed"in t.motion_control){switch(t.motion_control.animation_speed){case"minimum":_lyteUiUtils.reduceAnimation();break;case"default":_lyteUiUtils.enableAnimation();break;case"system_settings":"function"==typeof window.matchMedia?(this.mediaQuery.matches?_lyteUiUtils.reduceAnimation():_lyteUiUtils.enableAnimation(),this.mediaQuery.onchange=this.motionControlSystemSettingObserver):_lyteUiUtils.enableAnimation()}Crm.client_tracking("Accessibility_Vision1",{motion_control:t.motion_control.animation_speed})}break;case"switch_state_label":"enable"in t.switch_state_label&&(t.switch_state_label.enable?(_lyteUiUtils.registerDefaultValues({"lyte-checkbox":{aria:!0}}),a.addClass("checkboxSwitchEnabledState"),Crm.client_tracking("Accessibility_Vision1",{switch_state_label:"enabled"})):(_lyteUiUtils.registerDefaultValues({"lyte-checkbox":{aria:!1}}),a.removeClass("checkboxSwitchEnabledState"),Crm.client_tracking("Accessibility_Vision1",{switch_state_label:"disabled"})));break;case"strike_through__disabled_buttons":"enable"in t.strike_through__disabled_buttons&&(t.strike_through__disabled_buttons.enable?(a.addClass("accessibility-strikeout"),Crm.client_tracking("Accessibility_Vision1",{strike_through__disabled_buttons:"enabled"})):(a.removeClass("accessibility-strikeout"),Crm.client_tracking("Accessibility_Vision1",{strike_through__disabled_buttons:"disabled"})));break;case"form_display_mode":t.form_display_mode.enable?Crm.client_tracking("Accessibility_Vision2",{form_display_mode:"enabled"}):Crm.client_tracking("Accessibility_Vision2",{form_display_mode:"disabled"});break;case"magnify_on_text_hover":"enable"in t.magnify_on_text_hover&&t.magnify_on_text_hover.enable?($L.zoomer({controlKey:"altKey",className:""}),Crm.client_tracking("Accessibility_Vision2",{magnify_on_text_hover:"enabled"})):Crm.client_tracking("Accessibility_Vision2",{magnify_on_text_hover:"disabled"});break;case"mandatory_field":Crm.client_tracking("Accessibility_Vision2",{mandatory_field:t.mandatory_field.mandatory_field_type});break;case"flash_screen":t.flash_screen.enable?Crm.client_tracking("Accessibility_Vision2",{flash_screen:"enabled"}):Crm.client_tracking("Accessibility_Vision2",{flash_screen:"disabled"});break;case"aria_landmark":t.aria_landmark.enable?Crm.client_tracking("Accessibility_Vision2",{aria_landmark:"enabled"}):Crm.client_tracking("Accessibility_Vision2",{aria_landmark:"disabled"})}}.bind(this)),Object.keys(i).forEach((function(e){switch(e){case"standard_navigation_order":i.standard_navigation_order.enable?(_lyteUiUtils.registerDefaultValues({"lyte-table":{aria:!0}}),Crm.client_tracking("Accessibility_Motor",{standard_navigation_order:"enabled"})):(_lyteUiUtils.registerDefaultValues({"lyte-table":{aria:!1}}),Crm.client_tracking("Accessibility_Motor",{standard_navigation_order:"disabled"}));break;case"voice_assistant":i.voice_assistant.enable&&i.voice_assistant.numberOverlay?(Lyte.Service.getInjected("globalVoiceAssistance").initializeVCConfig({numberingEnabled:!0}),Lyte.Service.getInjected("globalVoiceAssistance").configForVoiceAssistance(),Crm.client_tracking("Accessibility_Motor",{voice_assistant:"enabled"})):Crm.client_tracking("Accessibility_Motor",{voice_assistant:"disabled"})}})),Object.keys(r).forEach((function(e){switch(e){case"underline_links":"enable"in r.underline_links&&(r.underline_links.enable?(a.addClass("accessibility-enable"),Crm.client_tracking("Accessibility_Interaction",{underline_links:"enabled"})):(a.removeClass("accessibility-enable"),Crm.client_tracking("Accessibility_Interaction",{underline_links:"disabled"})));break;case"reading_focus":if("enable"in r.reading_focus){var t=$L("body");if(r.reading_focus.enable){var i,s,o=r.reading_focus.mask_opacity.toString()+"%";switch(r.reading_focus.focus_mode){case"small":i="10%",s="20%";break;case"medium":i="20%",s="30%";break;case"large":i="30%",s="40%";break;case"custom":i=r.reading_focus.focus_height.toString()+"%",s=r.reading_focus.focus_width.toString()+"%"}t.readingMask({maskHeight:i,maskWidth:s,freezeLayerOpacity:o,zIndex:99999}),Crm.client_tracking("Accessibility_Interaction",{reading_focus:"enabled"})}else t[0].mask&&!1===r.reading_focus.focus_mode&&t.readingMask("destroy");!1===r.reading_focus.enable&&Crm.client_tracking("Accessibility_Interaction",{reading_focus:"disabled"})}}}))}}ariaLandMarkEnable(e){var t=$L("html");delete e.enable,e.contentinfo=e.content_info,delete e.content_info;var i=this.ariaLandMarkParams(e),r={displayValue:I18n.getMsg("crm.landmark.skiplabel1"),observeMenuBeforeOpen:!0,elemProps:i.color,menuOptionsOrder:i.order};$L.landmark.enable(r),t.addClass("ltLandmarkRoot")}ariaLandMarkParams(e){return{color:{banner:{color:e.banner,label:I18n.getMsg("zc.editor.banner")},complementary:{color:e.complementary,label:I18n.getMsg("aria.comp")},contentinfo:{color:e.contentinfo,label:I18n.getMsg("crm.accessibility.vision.aria.option.content")},form:{color:e.form,label:I18n.getMsg("crm.label.Form")},main:{color:e.main,label:I18n.getMsg("aria.main")},navigation:{color:e.navigation,label:I18n.getMsg("crm.pf.journey.naviagtion")},region:{color:e.region,label:I18n.getMsg("setupsearch.countrylocale")},search:{color:e.search,label:I18n.getMsg("crm.globalsearch.search.title")}},order:["main","navigation","complementary","banner","form","search","region","contentinfo"]}}tabIndexChange(){var e=$L(".accessTabIndex");this.accessibilityConfiguration.motor.standard_navigation_order.enable?e.attr("tabindex","0"):e.attr("tabindex","-1")}customErrorColorEnable(e){var t=document.querySelector(".quickCreateCustom");t.style.setProperty("--negativeColor",e),t.style.setProperty("--formBorderError",e)}customErrorColorDisable(){var e=document.querySelector(".quickCreateCustom");e&&(e.style.setProperty("--negativeColor",""),e.style.setProperty("--formBorderError",""))}customClassQuickCreate(e){var t=$L("html");if(e){t.addClass("quickCreateCustom");var i=this.getVariable("customErrorColor");i&&this.customErrorColorEnable(i)}else t.removeClass("quickCreateCustom")}flashEnable(){this.getVariable("flashScreen")&&($L("#flashScreen").addClass("flickerEffect"),setTimeout((function(){$L("#flashScreen").removeClass("flickerEffect")}),2e3))}keyboardShortcutEnableAPICall(e,t){networkUtils.lyteInitiateRequest("/crm/v5/settings/keyboard_shortcuts/actions/enable","POST").then((function(){commonUtils.showHideLoadingDiv(!0),store.findAll("keyboard_shortcuts").then((function(i){i.forEach((function(e){"General"!==e.category&&"Navigation"!==e.category&&"Switch Tabs"!==e.category||Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].bindShortcuts(e.category,e.components)})),Crm.userDetails.isKeyboardShortcutsEnabled=!0,commonUtils.showHideLoadingDiv(!1),"accessibility"===e&&t.keyBoardShortcutPageRender()})).catch((function(e){-1!==e.responseText.search("INTERNAL_ERROR")&&_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.ks.shortcuts.read.err.msg"),ltPropType:"error"}}),commonUtils.showHideLoadingDiv(!1)}))})).catch((function(i){"accessibility"===e?t.setData("keyboardShortcutEnable.enable",!1):"accessibilityShortcut"===e&&t.setData("keyboardShortcut.enable",!1),"ALREADY_ENABLED"===i.responseJSON.keyboard_shortcuts.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.ks.enable.err.alreadyenabled.msg"),ltPropType:"error"}}):(Crm.userDetails.isKeyboardShortcutsEnabled=!1,_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.ks.enable.err.failure.msg"),ltPropType:"error"}}))}))}keyboardShortcutDisableAPICall(e,t){networkUtils.lyteInitiateRequest("/crm/v5/settings/keyboard_shortcuts/actions/enable","DELETE").then((function(){store.peekAll("keyboard_shortcuts").forEach((function(e){Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].unbindShortcuts(e.category,e.components)})),Crm.userDetails.isKeyboardShortcutsEnabled=!1,"accessibility"===e&&t.setData("keyboardShortcutEnable.enable",!1)})).catch((function(i){"accessibility"===e?t.setData("keyboardShortcutEnable.enable",!0):"accessibilityShortcut"===e&&t.setData("keyboardShortcut.enable",!0),"ALREADY_DISABLED"===i.responseJSON.keyboard_shortcuts.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.ks.disable.err.alreadydisabled.msg"),ltPropType:"error"}}):_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.ks.disable.err.failure.msg"),ltPropType:"error"}})}))}showVoiceCommands(e){var t=$L("crm-voice-assistance-commands")[0];if(t&&t.component)t.component.setData("showModal",e);else if(e){var i=networkUtils.returnDependencyFiles(["crm-voice-assistance-commands.js"],ResourceConstants.CRMClient);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-voice-assistance-commands",{showModal:!0},"body")}))}}tabResize(){var e=$L("crm-tab")[0];e&&e.component.resizeMenu()}motionControlSystemSettingObserver(){this.matches?_lyteUiUtils.reduceAnimation():_lyteUiUtils.enableAnimation()}duplicateShortcutCheck(){if(this.getVariable("ariaLandMark").enable)for(var e=store.peekAll("keyboard_shortcuts"),t=0;t<5;t++){var i=e[t].components.findIndex((e=>e.editable&&JSON.stringify(e.key_combination)===JSON.stringify(["Shift","KeyL"])));if(i>-1){var r=e[t].components[i],a=e[t].category,s={};if("Commands"===a)s={keyboard_shortcuts:{shortcuts:[{category:a,components:[{cscript_snippet:{uuid:e[t].components[i].cscript_snippet.uuid},key_combination:[]}]}]}};else if("Switch Tabs"!==a){s={keyboard_shortcuts:{shortcuts:[{category:a,components:[{action:e[t].components[i].action,key_combination:[]}]}]}}}else{s={keyboard_shortcuts:{shortcuts:[{category:a,components:[{module:{api_name:e[t].components[i].api_name,id:e[t].components[i].id},key_combination:[]}]}]}}}networkUtils.lyteInitiateRequest("/crm/v5/settings/keyboard_shortcuts","PUT",{params:JSON.stringify(s)}).then(this.showConflictAlert(r,t,i));break}}}showConflictAlert(e,t,i){_cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:I18n.getMsg("crm.accessibility.shortcut.conflict")+"\n"+I18n.getMsg("crm.accessibility.shortcut.overridden",e.action),ltPropDuration:1e4}}),store.peekAll("keyboard_shortcuts")[t].$.set("components["+i+"].key_combination",[])}}),Lyte.Service.register("globalServices",class{}),Lyte.Service.register("routerServices",class{constructor(){Lyte.addEventListener("onAfterCompleteRouteTransition",function(e){this.postMessageToParentFrame&&this.postMessageToParentFrame(e,"afterRouteTransition")}.bind(this))}postMessageToParentFrame(e,t){window.parent.postMessage({msgType:"CrmRouterServices",currentTransitionInfoObject:e,transitionSource:t})}}),Lyte.registerDataType("date",{extends:"string",serialize:function(e){var t=Utils.isValidDate("yyyy-mm-dd",e,void 0,!0);if(e)return t?e:e&&"string"==typeof e&&e.trim()?apiDateFormat(e,!0):""},deserialize:function(e){if(e&&Utils.isValidDate("yyyy-mm-dd",e)){e=e.replace(/[+-]\d{2}:\d{2}/,"");var t=Lyte.registeredMixins["crux-element-validation"],i=/^(.*)T/.exec(e);if(i&&(e=i[1]),_lyteUiUtils.updateI18n&&!_cruxUtils.isI18nUpdated){["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","June","July","August","September","October","November","December"].forEach((function(e){_lyteUiUtils.updateI18n(e,I18n.getMsg(e))})),_cruxUtils.isI18nUpdated=!0}return t.getDateInUserDatePattern(t.getDateObjectFromString(e,"YYYY-MM-DD"),Crm.userDetails.DATE_PATTERN,void 0,!0)}return e}}),Lyte.registerDataType("datetime",{extends:"string",serialize:function(e){if(e&&Lyte.Router.getRouteInstance()&&("canvas"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName)&&e.indexOf("T")<0)return apiDateTimeFormat(e,!0);if(e){var t=e.replace(/[+-]\d{2}:\d{2}/,"");if(e==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(new Date(t)))return e;var i=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeFormatFromString(e);return i&&Object.keys.length&&i.format&&i.moment&&"YYYY-MM-DDTHH:mm:ss"!==i.format.full?i.moment.format("YYYY-MM-DDTHH:mm:ss"):e}},deserialize:function(e){if(e&&"string"==typeof e&&e.match("T")){e=e.replace(/[+-]\d{2}:\d{2}/,"");var t=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeFormatFromString(e);if(t&&t.format&&t.moment&&t.moment._isValid){let e=t.moment.getDObj();return Utils.getDateInUserDatePattern(e,!0)+" "+Utils.getTimeInUserFormat(e,!0)}}return e}}),Lyte.registerDataType("datetimeorg",{extends:"string",serialize:function(e){if(e){var t=e.replace(/[+-]\d{2}:\d{2}/,"");if(e==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(new Date(t)))return e;var i=e.split("TV");e=i.length>1?i[0]+" "+i[1]:e;var r=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase()),a=Utils.convertUsrtoDefaultDatePattern(i[0],r);if(i[1]){var s=Lyte.registeredMixins["crm-date-datetime-mixin"].getfinalTimeObjectfromTime(i[1]);validationUtils.isNotEmpty(s)&&(a.setHours(s.hrs),a.setMinutes(s.mins))}return Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(a)}},deserialize:function(e){return e&&"string"==typeof e&&e.match("T")?new CrmDate(new Date(e),!0).getDateTimeInUserPattern():e}}),Lyte.registerDataType("multi-picklist",{extends:"string",deserialize:function(e){return e&&"string"!=typeof e&&(e=null!=e[0]&&"string"==typeof e[0]?e.join("; "):e.map((function(e){return e.value})).join("; ")),e},serialize:function(e){var t;try{t=JSON.parse(e)}catch(i){t=e}if(("canvas"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName)&&!Array.isArray(t)||"detail"===Lyte.Router.getRouteInstance().routeName&&!validationUtils.isJson(e))return e=e&&e.split("; ");if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(t){return e.split("; ")}return e}}),Lyte.registerDataType("tax",{extends:"string",deserialize:function(e){var t="",i=e.length;if(e&&i){for(var r=0;r<i;r++)e[r].value&&(t+=e[r].value+";");return t=t.substring(0,t.length-1)}}}),Lyte.registerDataType("territory",{extends:"array",deserialize:function(e){return e}}),Lyte.registerDataType("phone",{extends:"string",deserialize:function(e){var t=e;return"en_US"===Crm.userDetails.COUNTRY_LOCALE&&t&&t.match(/^[0-9]+$/)&&(t="(",10==e.length?t+=e.substring(0,3)+") "+e.substring(3,6)+"-"+e.substring(6,10):9==e.length?t+=e.substring(0,5)+")-"+e.substring(5,9):t=e),t},serialize:function(e){return e?e.replace(/[\u202c]/g,""):e}}),Lyte.registerDataType("user-view-date-time",{extends:"string",deserialize:function(e){if(e){e=e.replace(/[+-]\d{2}:\d{2}/,"");var t=new Date(e),i=(e=e.split("T"))[1].split(":");t.setHours(i[0]),t.setMinutes(i[1]);var r=t,a=Utils.getDateInUsrViewFormat(r),s=(a+=" "+Utils.getTimeInUserFormat(r,!0)).slice(0,3);return a.replace(s,I18n.getMsg(s))}return e}}),Lyte.registerDataType("time-in-minutes",{extends:"string",deserialize:function(e){if(e)return Utils.convertTimeInDoubleToReadableForm(e)}}),Lyte.registerDataType("time-in-hrs",{extends:"string",deserialize:function(e){if(e)return Lyte.registeredMixins["crm-services-mixin"].methods.convertDurationTimeDoubleToUserFormat(e)},serialize:function(e){return e?Lyte.registeredMixins["crm-services-mixin"].methods.convertTimeInHrMinsToDouble(e):e}}),Lyte.registerDataType("millisec-to-time",{extends:"string",deserialize:function(e){return Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().parent&&Lyte.Router.getRouteInstance().parent.parent&&Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()&&Lyte.Router.getRouteInstance().parent.parent.getDynamicParam().indexOf("PathFinder")>-1&&e?Utils.getTimefromMillisecs(e,!0):e?Utils.getTimefromMillisecs(e):void 0}}),Lyte.registerDataType("exchange-rate",{extends:"string",deserialize:function(e){if(e)return Number(e).toFixed(9)}}),Lyte.registerDataType("expected-revenue",{extends:"string",deserialize:function(e){if(void 0!==e)return e+""}}),Lyte.registerDataType("multi-user",{extends:"object",deserialize:function(e){if(e)return e.length?{users:e}:void 0},serialize:function(e){return e?e.users:e}}),Lyte.registerValidator("datetimeValidation",(function(e,t){var i,r,a,s,o,n,l,d=t;t=t&&"string"==typeof t?t.trim():t;var c=this.$.model.fieldList[e];t=t&&"datetime"==c.fieldType&&-1==t.indexOf("TV")&&-1!=t.indexOf("T")?t.split("T")[0]:t;var u=Utils.isValidDate("yyyy-mm-dd",t);if(t){var m=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeObjFromString(t);m.date&&(t=m.dateTimeStr)}if(t&&!u){var p=-1!=(t=-1==(t=t.trim()).indexOf("TV")&&"date"==c.fieldType?t+"TV":t).indexOf("TV")?t.split("TV"):t.split(" ");if(t=p.length>=1?p[0]:"",c.mandatory&&!t)return{code:"ERR02",message:Lyte.errorCodes.ERR02,errorValue:d};if(!t)return!0;var _=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase()),f=Utils.convertUsrtoDefaultDatePattern(t,_);if(t==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(f))return!0;if(!Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),t,void 0,!0))return{code:"ERR03",message:Lyte.errorCodes.ERR03,errorValue:d};if(S(this),i||r){if("start"==l){var y;if((y=this.$.error[s]?Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0:this[s])||"Native__Backstage__Extn__Event_End_Date"!==s||(y=this.$.error[s]?this.$.error[s].value:y),"Native__Backstage__Extn__Event_End_Date"===s&&y&&-1!==y.indexOf("TV")){var g=y.split("TV");g.length>=1&&(y=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),g[0])?g[0]:void 0)}if(y){if("STARTDATETIME"==i?t.split(" ").length>1?Utils.compareDateandTime(Utils.getDateObject(t,w(d)),Utils.getDateObject(y,w(y))):Utils.compareDate(Utils.getDateObject(t,w(d)),Utils.getDateObject(y,w(y))):Utils.compareDate(Utils.getDateObject(t,{}),Utils.getDateObject(y,{}))){if(this.$.error[s]){if((R=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0)||"Native__Backstage__Extn__Event_End_Date"!==s||(R=this.$.error[s].value?this.$.error[s].value:R),"Native__Backstage__Extn__Event_End_Date"===s&&R&&-1!==R.indexOf("TV")){var v=R.split("TV");v.length>=1&&(R=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),v[0])?v[0]:void 0)}R&&("Native__Backstage__Extn__Event_End_Date"===s?this.$.set(s,this.$.error[s].value):this.$.set(s,R))}return!0}return!!(c&&c.fieldID&&(L=store.peekRecord("field",c.fieldID))&&L.read_only)||{code:"ERRDATE01",message:I18n.getMsg("crm.custom.field.less.than.equalto",['"'+o+'"','"'+n+'"'])}}return!0}var h;if((h=this.$.error[a]?Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0:this[a])||"Native__Backstage__Extn__Event_Start_Date"!==a||(h=this.$.error[a]?this.$.error[a].value:h),"Native__Backstage__Extn__Event_Start_Date"===a&&h&&-1!==h.indexOf("TV")){var b=h.split("TV");b.length>=1&&(h=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),b[0])?b[0]:void 0)}if(h){var L;if("ENDDATETIME"==r?t.split(" ").length>1?Utils.compareDateandTime(Utils.getDateObject(h,w(h)),Utils.getDateObject(t,w(d))):Utils.compareDate(Utils.getDateObject(h,w(h)),Utils.getDateObject(t,w(d))):Utils.compareDate(Utils.getDateObject(h,{}),Utils.getDateObject(t,{}))){if(this.$.error[a]){var R;if((R=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0)||"Native__Backstage__Extn__Event_Start_Date"!==a||(R=this.$.error[a]?this.$.error[a].value:R),"Native__Backstage__Extn__Event_Start_Date"===a&&R&&-1!==R.indexOf("TV")){var C=R.split("TV");C.length>=1&&(R=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),C[0])?C[0]:void 0)}R&&("Native__Backstage__Extn__Event_Start_Date"===a?this.$.set(a,this.$.error[a].value):this.$.set(a,R))}return!0}return!!(c&&c.fieldID&&(L=store.peekRecord("field",c.fieldID))&&L.read_only)||{code:"ERRDATE02",message:I18n.getMsg("crm.field.comparision.check",['"'+n+'"','"'+o+'"'])}}return!0}}return S(this),i||r?"start"==l?!(y=this.$.error[s]&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0)||(this.$.set(s,y),!0):!(h=this.$.error[a]&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0)||(this.$.set(a,h),!0):!(c.mandatory&&!t)||{code:"ERR02",message:Lyte.errorCodes.ERR02,errorValue:d};function w(e){var t=new Date(e),i={};return i.hrs=t.getHours(),i.mins=t.getMinutes(),i}function S(t){var d=t.$.model.fieldList[e];if("Native__Backstage__Extn__Event_Start_Date"===e||"Native__Backstage__Extn__Event_End_Date"===e)return i=a="Native__Backstage__Extn__Event_Start_Date",r=s="Native__Backstage__Extn__Event_End_Date",o=t.$.model.fieldList[a].fieldLabel,n=t.$.model.fieldList[s].fieldLabel,void(l=a===e?"start":"end");var c=crmConstants.dateTimeComparisonFieldsMapping.filter((function(e){if(e.start==d.columnName||e.end==d.columnName)return e}));if(c.length&&c[0]){i=c[0].start,r=c[0].end;var u=0;for(var m in t.$.model.fieldList){var p=t.$.model.fieldList[m];if(p.columnName&&p.columnName==i?(a=m,++u,o=p.fieldLabel):p.columnName&&p.columnName==r&&(s=m,++u,n=p.fieldLabel),2==u)break}l=a==e?"start":"end"}}})),Lyte.registerValidator("twitteridValidation",(function(e,t){if(t&&t.trim()){var i=getcurrentFieldAtributes(e,this);return i&&!havevalidLength(i,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidTwitter(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("emailValidation",(function(e,t){if(t&&t.trim()){var i=getcurrentFieldAtributes(e,this);return i&&!havevalidLength(i,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidEmail(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("websiteValidation",(function(e,t){if(t&&t.trim()){var i=getcurrentFieldAtributes(e,this);return i&&!havevalidLength(i,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidWebUrl(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("multiselectdateValidation",(function(e,t){var i={},r={},a=[];if(t){for(var s=t.length,o=0;o<s;o++){var n=t[o];n?$L.moment(n,"YYYY-MM-DD".toUpperCase(),!0).validate()?a.contains(n)?r[o]=I18n.getMsg("crm.alert.duplicate.found")+" "+Utils.getDateInUserDatePattern($L.moment(n).toDate()):a.push(n):r[o]=I18n.getMsg("crm.service.availdate.emptyalert"):r[o]=I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.label.date"))}if(Object.keys(r).length>0)return i.code="MULTISELECTERROR",i.errorDetails=r,i}return!0})),Lyte.registerValidator("multiselecttimeRangeValidation",(function(e,t){if(t){for(var i=t.length,r={},a={},s=0;s<i&&(t[s].hasOwnProperty("From")&&t[s].hasOwnProperty("To"));s++){var o=t[s].From,n=t[s].To;if(void 0!==o&&void 0!==n){if(""===o||""===n){a[s]=I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.events.time"));continue}if(!Utils.isValidTime(o.split(":"))||!Utils.isValidTime(n.split(":"))){a[s]=I18n.getMsg("bh.label.inavlid.time");continue}if(o&&n&&(o=Utils.convertTimeValueTo24HourFormat(o),n=Utils.convertTimeValueTo24HourFormat(n),!CrmDateUtils.compareTime(o,n))){a[s]=I18n.getMsg("crm.service.servicetiming.alert");continue}if(s+1<i){var l=t[s+1].From;l&&n&&Utils.isValidTime(l.split(":"))&&!CrmDateUtils.compareTime(n,l,!0)&&(a[s+1]=I18n.getMsg("crm.service.servicetiming.slotalt"))}}else if(void 0===o||void 0===n){a[s]=I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.events.time"));continue}}if(Object.keys(a).length>0)return r.code="MULTISELECTERROR",r.errorDetails=a,r}return!0})),Lyte.registerValidator("phonenumValidation",(function(e,t){if(t){var i=getcurrentFieldAtributes(e,this);if(i)return havevalidLength(i,t)?Lyte.Component.registeredHelpers.isValidPhonenumber(i,t)||{code:"ERR03",message:Lyte.errorCodes.ERR03}:{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("decimalValidation",(function(e,t){if(t){var i=getcurrentFieldAtributes(e,this);if(!havevalidLength(i,t,!0))return{code:"ERR06",message:Lyte.errorCodes.ERR06};if(i)return validationUtils.decimalLengthCheck(t,i.decimal_place)||{code:"ERR04",message:Lyte.errorCodes.ERR04,allowedDecimal:i.decimal_place,fieldValue:t}}return!0})),Lyte.registerValidator("picklistValidation",(function(e,t){return!((this.$&&this.$.model&&this.$.model.fieldList?this.$.model.fieldList:{})&&this.$.model.fieldList[e]&&this.$.model.fieldList[e].mandatory&&"-None-"==t)||{code:"ERR02",message:Lyte.errorCodes.ERR02}})),Lyte.registerValidator("emptyValueValidation",(function(e,t){var i=this.$.model.fieldList;if(i[e].mandatory&&"fileupload"!==i[e].fieldType){if(["Native__Survey__Extn__Survey","Native__Survey__Extn__Survey_Department","Native__Survey__Extn__Survey_Type"].contains(e)&&(!t||"zsurvey___crm__SYSTEM__NONE"===t))return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"object"==typeof t&&validationUtils.isEmpty(t))return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"string"==typeof t&&!t.trim())return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"string"==typeof t&&"multiselectpicklist"===i[e].fieldType&&-1!=t.indexOf("[")&&-1==t.indexOf("; ")&&!JSON.parse(t).length)return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"string"==typeof t&&"picklist"===i[e].fieldType&&"-None-"===t)return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};var r=getcurrentFieldAtributes(e,this);return!(t&&!havevalidLength(r,t)&&!["SERVICEDURATION"].contains(i[e].columnName))||{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("integerValidation",(function(e,t){if(t){var i=getcurrentFieldAtributes(e,this);return havevalidLength(i,t)?("PROBABILITY"!==i.columnName||t>=0&&t<=100)&&validationUtils.isValidInteger(String(t))||{code:"ERR03",message:Lyte.errorCodes.ERR03}:{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("nonEmptyNoEmoji",(function(e,t){var i=Lyte.customValidator.emptyValueValidation.call(this,e,t);return!0===i&&/([\uD800-\uDBFF][\uDC00-\uDFFF])/.test(t)?{code:"EMOJI_PRESENT",message:"Emojies aren't allowed"}:i})),Lyte.registerValidator("basicFieldLengthValidator",(function(e,t){if(t){var i=getcurrentFieldAtributes(e,this);if(i&&["string","double","integer"].contains(i.type)&&!havevalidLength(i,t))return{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("fileUploadValidation",(function(e,t){if(this.$&&this.$.model&&this.$.model.fieldList?this.$.model.fieldList:null){var i=validationUtils.isEmpty(t);if(i||(i=t.every((e=>"_delete"in e))),this.$.model.fieldList[e]&&this.$.model.fieldList[e].mandatory&&i)return{code:"ERR02",message:Lyte.errorCodes.ERR02}}return!0})),Lyte.registerValidator("SFBulkFieldValidator",(function(){return!0})),Lyte.registerPattern("customEmail",/(^$)|(^([A-Za-z0-9._%\-'+/]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,22})$)/),Lyte.registerPattern("customWebsite",/(^$)|(^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$)/),store.registerModel("recommendations",{default:Lyte.attr("boolean"),id:Lyte.attr("string"),name:Lyte.attr("string"),what_module:Lyte.belongsTo("module",{serialize:"record",inverse:"what_module"}),what_criteria:Lyte.attr("object",{default:null}),whom_module:Lyte.belongsTo("module",{serialize:"record",inverse:"whom_module"}),whom_criteria:Lyte.attr("object",{default:null}),based_module:Lyte.belongsTo("module",{serialize:"record",inverse:"based_module"}),based_timestamp:Lyte.belongsTo("field",{serialize:"record",inverse:"based_timestamp"}),based_criteria:Lyte.attr("object"),is_workflow_enable:Lyte.attr("boolean",{default:!1}),suggestion_type:Lyte.attr("object"),selected_view:Lyte.attr("array"),active:Lyte.attr("boolean"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),first_buy:Lyte.attr("object"),next_buy:Lyte.attr("object"),rebuy:Lyte.attr("object"),customer_also_bought:Lyte.attr("object"),frequently_bought_together:Lyte.attr("object"),first_buy_active:Lyte.attr("boolean"),first_buy_label:Lyte.attr("string"),first_buy_user_type:Lyte.attr("array",{default:[]}),first_buy_notification:Lyte.attr("array",{default:[]}),next_buy_active:Lyte.attr("boolean"),next_buy_label:Lyte.attr("string"),next_buy_user_type:Lyte.attr("array",{default:[]}),next_buy_notification:Lyte.attr("array",{default:[]}),rebuy_active:Lyte.attr("boolean"),rebuy_label:Lyte.attr("string"),rebuy_user_type:Lyte.attr("array",{default:[]}),rebuy_notification:Lyte.attr("array",{default:[]}),customer_also_bought_active:Lyte.attr("boolean"),customer_also_bought_label:Lyte.attr("string"),customer_also_bought_user_type:Lyte.attr("array",{default:[]}),customer_also_bought_notification:Lyte.attr("array",{default:[]}),frequently_bought_together_active:Lyte.attr("boolean"),frequently_bought_together_label:Lyte.attr("string"),frequently_bought_together_user_type:Lyte.attr("array",{default:[]}),frequently_bought_together_notification:Lyte.attr("array",{default:[]}),selected_view_fields_1:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_1"}),selected_view_fields_2:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_2"}),selected_view_fields_3:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_3"})},{actions:{configure_notification:{},feedback:{}}}),store.registerAdapter("recommendations",{namespace:"crm/v2.2/",buildURL:function(e,t,i,r,a,s,o){return a=o&&"/"===o.url[0]?a.slice(0,a.indexOf("/",8))+o.url:a.replace("recommendations","settings/zia/recommendations")},headersForRequest:function(e,t,i,r){var a=this.$super.headersForRequest();return"feedback"===r&&(a["Content-Type"]="application/json;charset=UTF-8"),a},methodForRequest:function(e){return"PATCH"===e?"PUT":e},headersForRequest:function(e,t,i,r){var a=this.$super.headersForRequest();return"configure_notification"===r&&(a["Content-Type"]="application/json;charset=UTF-8"),a}}),store.registerSerializer("recommendations",{normalizeResponse:function(e,t,i,r,a,s,o,n){if(i&&n&&!i.recommendations){var l={};return"updateRecord"===t&&(l.id=i.recommendations.details.id),l.recommendations=i.recommendations,l}if(200===a||201===a){var d=[];return"createRecord"!==t&&"updateRecord"!==t||!i.recommendations[0].details||(i.recommendations=[i.recommendations[0].details]),("findAll"===t||("createRecord"===t||"updateRecord"===t)&&i.recommendations[0].details||"findRecord"===t)&&(i.recommendations.each((function(e){var t=e,i={};if(i.id=t.id,i.name=t.name,i.what_module=t.what_to.module.id,i.based_module=t.based_on.module.id,i.whom_module=t.whom_to.module.id,null!==t.what_to.criteria&&(i.what_criteria=t.what_to.criteria),null!==t.whom_to.criteria&&(i.whom_criteria=t.whom_to.criteria),void 0!==t.based_on.completion_time_field&&void 0!==t.based_on.completion_time_field.id&&(i.based_timestamp=t.based_on.completion_time_field),null!==t.based_on.criteria&&(i.based_criteria=t.based_on.criteria),i.is_workflow_enable=void 0!==t.is_workflow_enable&&t.is_workflow_enable,t.suggestion_type&&(i.suggestion_type=t.suggestion_type,i.first_buy=t.suggestion_type.first_buy,i.first_buy_active=t.suggestion_type.first_buy.active,i.first_buy_label="crm.filter.label.firstbuy"===t.suggestion_type.first_buy.label?I18n.getMsg("crm.filter.label.firstbuy"):t.suggestion_type.first_buy.label,i.first_buy_user_type=t.suggestion_type.first_buy.user_type?t.suggestion_type.first_buy.user_type:[],i.rebuy=t.suggestion_type.rebuy,i.rebuy_active=t.suggestion_type.rebuy.active,i.rebuy_label="crm.filter.label.rebuy"===t.suggestion_type.rebuy.label?I18n.getMsg("crm.filter.label.rebuy"):t.suggestion_type.rebuy.label,i.rebuy_user_type=t.suggestion_type.rebuy.user_type?t.suggestion_type.rebuy.user_type:[],i.next_buy=t.suggestion_type.next_buy,i.next_buy_active=t.suggestion_type.next_buy.active,i.next_buy_label="crm.filter.label.nextbuy"===t.suggestion_type.next_buy.label?I18n.getMsg("crm.filter.label.nextbuy"):t.suggestion_type.next_buy.label,i.next_buy_user_type=t.suggestion_type.next_buy.user_type?t.suggestion_type.next_buy.user_type:[],i.customer_also_bought=t.suggestion_type.customer_also_bought,i.customer_also_bought_active=t.suggestion_type.customer_also_bought.active,i.customer_also_bought_label="crm.filter.label.cwbab"===t.suggestion_type.customer_also_bought.label?I18n.getMsg("crm.filter.label.cwbab"):t.suggestion_type.customer_also_bought.label,i.customer_also_bought_user_type=t.suggestion_type.customer_also_bought.user_type?t.suggestion_type.customer_also_bought.user_type:[],i.frequently_bought_together=t.suggestion_type.frequently_bought_together,i.frequently_bought_together_active=t.suggestion_type.frequently_bought_together.active,i.frequently_bought_together_label="crm.filter.label.fbt"===t.suggestion_type.frequently_bought_together.label?I18n.getMsg("crm.filter.label.fbt"):t.suggestion_type.frequently_bought_together.label,i.frequently_bought_together_user_type=t.suggestion_type.frequently_bought_together.user_type?t.suggestion_type.frequently_bought_together.user_type:[]),t.selected_view&&(i.selected_view=t.selected_view,t.selected_view[0].fields&&t.selected_view[0].fields.length)){var r=t.selected_view[0].fields;i.selected_view_fields_1=r[0].id,i.selected_view_fields_2=r[1].id,i.selected_view_fields_3=r[2].id}i.created_by=t.created_by,i.created_time=t.created_time,i.modified_by=t.modified_by,i.modified_time=t.modified_time,i.active=t.active,d.push(i)})),i.recommendations=d),(("createRecord"===t||"updateRecord"===t)&&i.recommendations[0]||"findRecord"===t)&&("createRecord"===t&&(i.recommendations[0].created_by=i.recommendations[0].created_by?i.recommendations[0].created_by:{id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME},i.recommendations[0].created_time=i.recommendations[0].created_time?i.recommendations[0].created_time:Date.now()),i.recommendations[0].modified_by=i.recommendations[0].modified_by?i.recommendations[0].modified_by:{id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME},i.recommendations[0].modified_time=i.recommendations[0].modified_time?i.recommendations[0].modified_time:Date.now(),i.recommendations=i.recommendations[0]),i}return 403===a||(204===a&&(i.recommendations=[]),204===a&&(i.recommendations=[])),i},serialize:function(e,t,i,r){if(r&&r.payLoad)return r.payLoad;if("createRecord"===e||"updateRecord"===e){var a=[],s={},o=t.recommendations;"updateRecord"===e&&(s.id=o.id),void 0!==o.name&&(s.name=o.name);var n=o.what_module;if(void 0!==n){var l={};l.module={id:n.id,api_name:n.api_name},s.what_to=l}var d=o.what_criteria;void 0!==d&&(s.what_to=s.what_to?s.what_to:{},s.what_to.criteria=d);var c=o.whom_module;if(void 0!==c){var u={};u.module={id:c.id,api_name:c.api_name},s.whom_to=u}var m=o.whom_criteria;void 0!==m&&(s.whom_to=s.whom_to?s.whom_to:{},s.whom_to.criteria=m);var p=o.based_module;if(void 0!==p){var _={};_.module={id:p.id,api_name:p.api_name},s.based_on=_}var f=o.based_timestamp;void 0!==f&&(s.based_on=s.based_on?s.based_on:{},s.based_on.completion_time_field={id:f.id,api_name:f.api_name});var y=o.based_criteria;void 0!==y&&(s.based_on=s.based_on?s.based_on:{},s.based_on.criteria=y);var g={};g.first_buy=void 0!==o.first_buy_active||void 0!==o.first_buy_label||void 0!==o.first_buy_user_type,g.rebuy=void 0!==o.rebuy_active||void 0!==o.rebuy_label||void 0!==o.rebuy_user_type,g.next_buy=void 0!==o.next_buy_active||void 0!==o.next_buy_label||void 0!==o.next_buy_user_type,g.customer_also_bought=void 0!==o.customer_also_bought_active||void 0!==o.customer_also_bought_label||void 0!==o.customer_also_bought_user_type,g.frequently_bought_together=void 0!==o.frequently_bought_together_active||void 0!==o.frequently_bought_together_label||void 0!==o.frequently_bought_together_user_type,(g.first_buy||g.rebuy||g.next_buy||g.customer_also_bought||g.frequently_bought_together)&&(s.suggestion_type={}),Object.keys(g).forEach((function(e){g[e]&&(s.suggestion_type[e]={},void 0!==o[e+"_active"]&&(s.suggestion_type[e].active=o[e+"_active"]),void 0!==o[e+"_label"]&&(s.suggestion_type[e].label=o[e+"_label"]),void 0!==o[e+"_user_type"]&&(s.suggestion_type[e].user_type=o[e+"_user_type"]))}));var v=o.selected_view;void 0!==v&&(s.selected_view=v),void 0!==o.active&&(s.active=o.active),a.push(s),t.recommendations=a}return t},payloadKey:function(e){return e}}),store.registerModel("field_prediction",{id:Lyte.attr("string",{pattern:Lyte.patterns.numeric}),name:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"record",inverse:"module"}),prediction_field:Lyte.belongsTo("field",{serialize:"record",inverse:"prediction_field"}),predict_field:Lyte.belongsTo("field",{serialize:"record",inverse:"predict_field"}),score_to:Lyte.belongsTo("field",{serialize:"record",inverse:"score_to"}),values:Lyte.attr("array"),value:Lyte.attr("boolean"),start_values:Lyte.attr("array"),contrary_values:Lyte.attr("array"),follow_up:Lyte.attr("boolean"),field_contributors:Lyte.hasMany("field",{serialize:"record",inverse:"field_contributors"}),sampling_criteria:Lyte.attr("object"),end_criteria:Lyte.attr("object"),active:Lyte.attr("boolean"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string")}),store.registerAdapter("field_prediction",{namespace:"crm/v2.2/settings/zia",buildURL:function(e,t,i,r,a){return a.replace("field_prediction","predictions")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("field_prediction",{normalizeResponse:function(e,t,i,r,a){if("findRecord"===t||"findAll"===t)if(204===a)i.field_prediction=[];else for(var s=i.predictions.length,o=0;o<s;o++){if(void 0!==i.predictions[o].contribute){var n=i.predictions[o].contribute;delete i.predictions[o].contribute;for(var l=n.length,d=0;d<l;d++)i.predictions[o].field_contributors="fields"===n[d].type?n[d].contributors:[]}i.predictions[o].contrary_values=null===i.predictions[o].contrary_values?[]:i.predictions[o].contrary_values}else"createRecord"!==t&&"updateRecord"!==t||(i.predictions[0].details&&(i.predictions=i.predictions[0].details),"createRecord"===t?i.predictions.created_by={id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME}:i.predictions.modified_by={id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME});return i.field_predictions=i.predictions,delete i.predictions,i},serialize:function(e,t){if(t.prediction=t.field_prediction,delete t.field_prediction,"createRecord"===e||"updateRecord"===e){if(t.prediction.module){var i={};i.id=t.prediction.module.id,i.api_name=t.prediction.module.api_name,t.prediction.module=i}var r=void 0!==t.prediction.predict_field?t.prediction.predict_field.ui_type:"updateRecord"===e?store.peekRecord("field_prediction",t.prediction.id).predict_field.ui_type:null;if(t.prediction.predict_field){var a={};a.id=t.prediction.predict_field.id,a.api_name=t.prediction.predict_field.api_name,t.prediction.predict_field=a}if(r!==CrmField.UITYPES.BOOLEAN_DEF&&r!==CrmField.UITYPES.BOOLEAN_DEF_NOT&&delete t.prediction.value,r!==CrmField.UITYPES.PICK_LIST&&r!==CrmField.UITYPES.STAGE&&delete t.prediction.values,t.prediction.field_contributors){for(var s=t.prediction.field_contributors.length,o=[],n={type:"fields"},l=[],d=0;d<s;d++){var c={};c.id=t.prediction.field_contributors[d].id,c.api_name=t.prediction.field_contributors[d].api_name,l.push(c)}n.contributors=l,o.push(n),t.prediction.contribute=o,delete t.prediction.field_contributors}"updateRecord"===e&&(void 0!==t.prediction.contrary_values&&0===t.prediction.contrary_values.length&&delete t.prediction.contrary_values,void 0!==t.prediction.sampling_criteria&&0===Object.keys(t.prediction.sampling_criteria).length&&(t.prediction.sampling_criteria={_delete:null}),void 0!==t.prediction.end_criteria&&0===Object.keys(t.prediction.end_criteria).length&&(t.prediction.end_criteria={_delete:null})),t.predictions=[],t.predictions.push(t.prediction),delete t.prediction}return t}}),store.registerModel("churn_prediction",{id:Lyte.attr("string",{pattern:Lyte.patterns.numeric}),name:Lyte.attr("string"),customer_module:Lyte.belongsTo("module",{serialize:"record",inverse:"customer_module"}),customer_criteria:Lyte.attr("object"),prediction_field:Lyte.belongsTo("field",{serialize:"record",inverse:"prediction_field"}),score_field:Lyte.belongsTo("field",{serialize:"record",inverse:"score_field"}),payment_module:Lyte.belongsTo("module",{serialize:"record",inverse:"payment_module"}),payment_criteria:Lyte.attr("object"),payment_date:Lyte.belongsTo("field",{serialize:"record",inverse:"payment_date"}),standard_criteria:Lyte.attr("object"),additional_criteria:Lyte.attr("object"),usage_data:Lyte.attr("object"),subscription_based_revenue_model:Lyte.attr("boolean"),subscription_field:Lyte.belongsTo("field",{serialize:"record",inverse:"subscription_field"}),status:Lyte.attr("boolean"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string")}),store.registerAdapter("churn_prediction",{namespace:"crm/v4/settings/zia/predictions",buildURL:function(e,t,i,r,a){return a=a.replace("churn_prediction","churn")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("churn_prediction",{normalizeResponse:function(e,t,i,r,a){if("findRecord"===t||"findAll"===t)if(204===a)i.churn_prediction=[];else for(var s=i.churn_predictions.length,o=0;o<s;o++){var n=i.churn_predictions[o];n.customer_module=n.customer_selection.module,n.customer_criteria=n.customer_selection.criteria,n.prediction_field=n.customer_selection.prediction_field,n.score_field=n.customer_selection.score_field,delete n.customer_selection,n.payment_module=n.payment_selection.module,n.payment_criteria=n.payment_selection.criteria,n.standard_criteria=n.payment_selection.standard_criteria,n.additional_criteria=n.payment_selection.additional_criteria,n.payment_date=n.payment_selection.date_field,delete n.payment_selection,n.status="active"===n.status,n.created_time===n.modified_time&&(n.modified_by=void 0,n.modified_time=void 0)}else"createRecord"!==t&&"updateRecord"!==t||(i.churn_predictions[0].details&&(i.churn_predictions[0].details.status&&(i.churn_predictions[0].details.status="active"===i.churn_predictions[0].details.status),i.churn_predictions=i.churn_predictions[0].details),i.churn_predictions.created_time===i.churn_predictions.modified_time&&(i.churn_predictions.modified_by=void 0,i.churn_predictions.modified_time=void 0),i.churn_prediction=i.churn_predictions);return i},serialize:function(e,t){var i=t.churn_prediction,r={};if("createRecord"===e){r.name=i.name;var a={},s={};s.id=i.customer_module.id,s.api_name=i.customer_module.api_name,a.module=s,a.criteria=i.customer_criteria,r.customer_selection=a;var o={},n={},l={};if(n.id=i.payment_module.id,n.api_name=i.payment_module.api_name,o.module=n,o.criteria=i.payment_criteria,o.standard_criteria=i.standard_criteria,o.additional_criteria=i.additional_criteria,l.id=i.payment_date.id,l.api_name=i.payment_date.api_name,o.date_field=l,r.payment_selection=o,r.subscription_based_revenue_model=i.subscription_based_revenue_model,i.subscription_based_revenue_model){var d={};d.id=i.subscription_field.id,d.api_name=i.subscription_field.api_name,r.subscription_field=d}t.churn_predictions=[],t.churn_predictions.push(r)}if("updateRecord"===e){if(r.id=i.id,void 0!==i.status&&(r.status=i.status?"active":"inactive"),i.customer_criteria)0===Object.keys(i.customer_criteria).length&&(i.customer_criteria={_delete:null}),(a={}).criteria=i.customer_criteria,r.customer_selection=a;o={};if(i.payment_date)(l={}).id=i.payment_date.id,l.api_name=i.payment_date.api_name,o.date_field=l;i.payment_criteria&&(0===Object.keys(i.payment_criteria).length&&(i.payment_criteria={_delete:null}),o.criteria=i.payment_criteria),i.standard_criteria&&(0===Object.keys(i.standard_criteria).length&&(i.standard_criteria={_delete:null}),o.standard_criteria=i.standard_criteria),i.additional_criteria&&(0===Object.keys(i.additional_criteria).length&&(i.additional_criteria={_delete:null}),o.additional_criteria=i.additional_criteria),0!==Object.keys(o).length&&(r.payment_selection=o),(i.usage_data||null===i.usage_data)&&(r.usage_data=i.usage_data),t.churn_predictions=[],t.churn_predictions.push(r)}return delete t.churn_prediction,t}}),store.registerModel("user_picklist_colour_code",{colour_code:Lyte.attr("string"),field:Lyte.belongsTo("field")},{actions:{reset:{}}}),store.registerAdapter("user_picklist_colour_code",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a){return a=a.replace(e,"picklist_colour_codes")},methodForRequest:function(e,t,i,r,a){return"PATCH"===e?"PUT":"reset"===a?"POST":e}}),store.registerSerializer("user_picklist_colour_code",{payloadKey:function(){return"picklist_colour_codes"},serialize:function(e,t){if(t){var i={};return i.picklist_colour_codes=t.user_picklist_colour_code,i}return t},normalizeResponse:function(e,t,i){return"update"===t&&i&&i.picklist_colour_codes&&i.picklist_colour_codes.forEach((function(e,t){i.picklist_colour_codes[t].id=e.details.id})),i}}),store.registerModel("user",{fields:Lyte.attr("array"),name:Lyte.attr("string"),zuid:Lyte.attr("string"),alias:Lyte.attr("string"),customize_info:Lyte.attr("object"),confirm:Lyte.attr("boolean"),date_format:Lyte.attr("string"),decimal_separator:Lyte.attr("string"),number_separator:Lyte.attr("string"),default_tab_group:Lyte.attr("string"),email:Lyte.attr("string"),ezuid:Lyte.attr("string"),first_name:Lyte.attr("string"),full_name:Lyte.attr("string"),imap_status:Lyte.attr("boolean"),last_name:Lyte.attr("string"),profile:Lyte.belongsTo("profile",{inverse:"users",serialize:"record"}),createdByProfile:Lyte.hasMany("profile"),modifiedByProfile:Lyte.hasMany("profile"),createdByUserGroup:Lyte.hasMany("user_group"),modifiedByUserGroup:Lyte.hasMany("user_group"),Reporting_To:Lyte.attr("object"),role:Lyte.belongsTo("role",{serialize:"partial",deepNest:!0}),forecast_data:Lyte.hasMany("forecast_data"),rtl_enabled:Lyte.attr("boolean"),status:Lyte.attr("string"),display_status:Lyte.attr("string"),telephony_enabled:Lyte.attr("boolean"),personal_account:Lyte.attr("boolean"),time_zone:Lyte.attr("string"),phone:Lyte.attr("string"),mobile:Lyte.attr("string"),fax:Lyte.attr("string"),website:Lyte.attr("string"),dob:Lyte.attr("string"),city:Lyte.attr("string"),country:Lyte.attr("string"),street:Lyte.attr("string"),state:Lyte.attr("string"),zip:Lyte.attr("string"),ntc_enabled:Lyte.attr("boolean"),ntc_notification_type:Lyte.attr("array"),language:Lyte.attr("string"),locale:Lyte.attr("string"),country_locale:Lyte.attr("string"),_users:Lyte.hasMany("user"),time_format:Lyte.attr("string"),time_zone:Lyte.attr("string"),theme:Lyte.attr("object"),name_format:Lyte.attr("string"),signature:Lyte.attr("string"),territories:Lyte.hasMany("territory",{inverse:"users"}),category:Lyte.attr("string"),type__s:Lyte.attr("string"),Currency:Lyte.attr("string"),shift_hour:Lyte.hasMany("shift_hour"),effective_shift_hour:Lyte.belongsTo("shift_hour"),current_shift_hour:Lyte.belongsTo("shift_hour")},{actions:{search:{endPoint:"search"},convert:{},get_unassigned:{},get_assigned:{},transfer_and_delete:{},grouped_counts:{},count:{},get_territories:{},reinvite:{}}}),store.registerAdapter("user",{xhrReq:new XMLHttpRequest,namespace:"crm/v7",buildURL:function(e,t,i,r,a,s,o){if(void 0!==i&&void 0!==i.categories?("DeveloperUsers"===i.type&&(i.categories=i.categories+",sandbox_developer"),i.categories.includes("regular_user")&&(i.categories=i.categories+",microsoft,google,microsoft_tenant")):void 0!==i&&void 0!==i.type__s&&"DeveloperUsers"===i.type&&(i.type__s=i.type__s+",Sandbox Developer User"),void 0!==o&&(void 0!==o.categories&&o.categories.includes("regular_user")?o.categories=o.categories+",microsoft,google,microsoft_tenant":void 0!==o[s]&&void 0!==o[s].categories&&o[s].categories.includes("regular_user")&&(o[s].categories=o[s].categories+",microsoft,google,microsoft_tenant"),"DeveloperUsers"===o.type&&o.type__s&&(o.type__s=o.type__s+",Sandbox Developer User")),a=a.replace(e,e+"s"),"action"===t){if("transfer_and_delete"!==s&&"count"!==s&&"get_assigned"!==s&&"get_territories"!==s)for(var n in"grouped_counts"!==s&&(a=a.replace("/actions","")),o)o.hasOwnProperty(n)&&(i[n]=o[n]);if("grouped_counts"!==s&&"get_assigned"!==s||(a=a.replace("v2","v2.2")),"get_territories"===s){var l=o.userId;a=a.replace("actions/get_territories",l+"/territories")}}return void 0===o||void 0===o.tempApiVersion||"V4"!==o.tempApiVersion&&"V2.1"!==o.tempApiVersion&&"V2.2"!==o.tempApiVersion||(a=a.replace("v2","V4"===o.tempApiVersion?"v4":"V2.1"===o.tempApiVersion?"v2.1":"v2.2")),void 0!==i&&void 0!==i.tempApiVersion&&"V4"===i.tempApiVersion&&(a=a.replace("v2","v4")),void 0!==o&&void 0!==o.tempApiVersion&&"V7"===o.tempApiVersion&&(a=a.replace("v6","v7")),void 0!==i.SandboxAccount&&(a=a.replace("crm/","crm/"+crmPortal+"/sandbox/diff/"),delete i.SandboxAccount),"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),"updateRecord"===t&&"liteConvert"!==o&&(a=a.slice(0,a.lastIndexOf("/"))),o&&"usersCount"===o?a=a.replace("users","users/actions/count"):r&&void 0!==r.category&&void 0!==o&&["liteConvert"].includes(o)&&(a=a.concat("/actions/convert")),void 0!==o&&void 0!==o.actual_api&&"unassigned_users"===o.actual_api&&(a=a.replace("/users","/settings/automation/assignment_thresholds/actions/unassigned_users"),i.module=o.other_module,o.temp_ids&&(i.temp_ids=o.temp_ids)),void 0!==o&&"associated_groups"===o.type&&(a=(a=a.replace("v4","v6")).replace("/users","/users/"+o.id+"/actions/associated_groups")),a},methodForRequest:function(e,t,i,r,a){return"action"===t?"transfer_and_delete"===a||"get_assigned"===a?"POST":(i&&i.child_data&&"object"==typeof i.child_data&&(i.child_data=JSON.stringify(i.child_data)),r&&r.child_data&&"object"==typeof r.child_data&&(r.child_data=JSON.stringify(r.child_data)),"GET"):"liteConvert"===r?"POST":"PATCH"===e&&"updateRecord"===t?"PUT":("GET"===e&&i&&i.child_data&&"object"==typeof i.child_data&&(i.child_data=JSON.stringify(i.child_data)),"GET"===e&&r&&r.child_data&&"object"==typeof r.child_data&&(r.child_data=JSON.stringify(r.child_data)),e)},processRequest:function(e,t,i,r,a){var s=this;if("action"===e){if("search"===(i=JSON.parse(i)).type||"count"===i.type)return new Promise((function(t,r){var o=s.xhrReq,n="search"===i.type?"/"+s.namespace+"/users/search?":"/"+s.namespace+"/users/actions/count?";for(var l in"count"===i.type&&a&&(i.customData=a),void 0!==i.customData&&void 0!==i.customData.tempApiVersion&&"V2.1"===i.customData.tempApiVersion?n=n.replace("v2","v2.1"):void 0!==i.customData&&void 0!==i.customData.tempApiVersion&&"V2.2"===i.customData.tempApiVersion&&(n=n.replace("v2","v2.2")),void 0===i.customData||"ActiveLiteUser"!==i.customData.type&&!0!==i.customData.include_lite_users&&"true"!==i.customData.include_lite_users||(n=-1!==n.indexOf("v2.1")?n.replace("v2.1","v2.2"):-1===n.indexOf("v2.2")?n.replace("v2","v2.2"):n),void 0!==i.customData&&void 0!==i.customData.tempApiVersion&&"V4"===i.customData.tempApiVersion&&(n=-1!==n.indexOf("v2.2")?n.replace("v2.2","v4"):n),void 0!==i.customData&&void 0!==i.customData.SandboxAccount&&(n=n.replace("crm/","crm/"+crmPortal+"/sandbox/diff/")),void 0!==a&&void 0!==a.actual_api&&"unassigned_users"===a.actual_api&&(n=n.replace("/users/search","/settings/automation/assignment_thresholds/actions/unassigned_users_search"),i.customData.module=a.other_module,delete i.customData.actual_api,delete i.customData.other_module),i.customData)"tempApiVersion"!==l&&(n+=l+"="+encodeURIComponent(i.customData[l])+"&");o.open("GET",n);var d=store.adapter.application.headersForRequest(e,void 0,i.customData);for(var c in d)o.setRequestHeader(c,d[c]);o.onload=function(){this.status>=200&&this.status<300?t(o.response):r({status:this.status,statusText:o.statusText})},o.onerror=function(){r({status:this.status,statusText:o.statusText})},o.send()}));if(a&&"subordinates"===a.feature&&a.search){var o="/"+s.namespace+"/users/actions/get_assigned",n={get_assigned:a};return new Promise((function(e,t){var i=s.xhrReq;i.open("POST",o);var r=store.adapter.application.headersForRequest();for(var a in r)i.setRequestHeader(a,r[a]);i.onload=function(){200===this.status?e(JSON.stringify(JSON.parse(i.response).get_assigned)):e("")},i.onerror=function(){t({status:this.status,statusText:i.statusText})},i.send(JSON.stringify(n))}))}if(a&&"subordinates"!==a.feature){if(a.group_by)return;if(a.transfer_and_delete)o="/"+s.namespace+"/users/actions/transfer_and_delete";else if(a.get_unassigned)o="/"+s.namespace+"/users/actions/get_unassigned";else if(a.get_assigned)o="/"+s.namespace+"/users/actions/get_assigned";else if(void 0!==a.featureName&&"reinvite"===a.featureName)o="/"+s.namespace+"/users/"+a.userId+"/actions/reinvite";else if(a.getTerritories)return;return new Promise((function(e,t){var i=s.xhrReq;i.open("POST",o);var r=store.adapter.application.headersForRequest();for(var n in r)i.setRequestHeader(n,r[n]);i.onload=function(){this.status>=200&&this.status<300?e(i.response):400===this.status&&i.response?t({status:this.status,statusText:i.response}):t({status:this.status,statusText:i.statusText})},i.onerror=function(){t({status:this.status,statusText:i.statusText})},void 0!==a.featureName&&"reinvite"===a.featureName&&(a={}),i.send(JSON.stringify(a))}))}}else if(a&&a.isFromShiftHours)return new Promise((function(t,i){var r=s.xhrReq,o="/"+s.namespace+"/users?";for(var n in a.param)o+=n+"="+encodeURIComponent(a.param[n])+"&";var l=store.adapter.application.headersForRequest(e,void 0,a.param);for(var d in a.isSandbox&&(l["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid),a&&a.url&&(r=new XMLHttpRequest,o=o.replace(o.split("?")[0],a.url)),r.open("GET",o),l)r.setRequestHeader(d,l[d]);r.onload=function(){this.status>=200&&this.status<300?t(r.response):i({status:this.status,statusText:r.statusText})},r.onerror=function(){i({status:this.status,statusText:r.statusText})},r.send()}))},parseResponse:function(e,t,i,r){return r.get_assigned?r.get_assigned:r}}),store.registerSerializer("user",{varPayloadKey:"users",serializeUserData:function(e){for(var t in e)void 0===e[t]&&(e[t]=null)},normalizeUserData:function(e){for(var t in e)null===e[t]&&(e[t]=void 0)},serialize:function(e,t,i,r,a,s,o){if("action"===e){if("get_assigned"===o){var n={get_assigned:{}};for(key in r)if("filters"===key){n.get_assigned[key]=[];var l,d=r[key];if("string"==typeof r[key]){var c=d.match(/"value"(.*?)\]/g);l=JSON.parse(d);var u=0;for(k of l)if(k.value&&"object"==typeof k.value&&"string"!=typeof k.value[0]){var m=c[u].match(/\[.*?\]/g);if(null===p)continue;u++;var p=m[0].substring(1,m[0].length-1);k.value=p.split(",")}}else l=r[key];n.get_assigned[key]=l}else n.get_assigned[key]=r[key];return n}return"search"===o?{type:"search",customData:r}:"count"===o?{type:"count"}:{}}t.users=[t.user],delete t.user;var _=t.users;return _&&(_.constructor===Array?_.forEach(function(e){this.serializeUserData(e)}.bind(this)):_.constructor===Object&&this.serializeUserData(_)),t},normalizeResponse:function(e,t,i,r,a){if("createRecord"===t){var s=i.users[0];return"success"===s.status&&(s.id=s.details.id,s.email=s.details.email),i.users=i.users[0],i}if("updateRecord"===t&&200===a)i.users={id:r};else if("updateRecord"===t&&400===a)_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:i.message,ltPropDuration:"3000",ltPropShow:!0}});else if(!validationUtils.isEmpty(i)||"findRecord"!==t&&"findAll"!==t){if(i&&void 0!==i.count)i.meta={count:i.count},i.users=[],delete i.count;else if(("findRecord"===t||"findAll"===t)&&window.clientPortalName&&!validationUtils.isEmpty(i))for(var o=Crm.userDetails.NAME_FORMAT.split(","),n=i.users.length,l=o.indexOf("First Name"),d=o.indexOf("Last Name"),c=0;c<n;c++){var u=i.users[c],m=u.last_name?u.last_name:u.first_name;m=l>d?(u.first_name?u.first_name:"")+" "+(u.last_name?u.last_name:""):(u.last_name?u.last_name:"")+" "+(u.first_name?u.first_name:""),i.users[c].full_name=m.trim()}}else i.users=[];var p=i.users;return p&&(p.constructor===Array?p.forEach(function(e){this.normalizeUserData(e)}.bind(this)):p.constructor===Object&&this.normalizeUserData(p)),i},payloadKey:function(){return this.varPayloadKey},normalize:function(e,t,i){if(i){var r=store.peekRecord("user",i.id);i.image_link||!r||r.image_link||(i.image_link="")}if(("findAll"===t||"findRecord"===t)&&void 0!==i){var a=i.territories,s=a?a.length:0;if(s)for(var o=0;o<s;o++)Object.keys(a[o]).includes("manager")&&delete a[o].manager}return i}}),store.registerModel("keyboard_shortcuts",{components:Lyte.attr("array"),category:Lyte.attr("string",{primaryKey:!0})}),store.registerAdapter("keyboard_shortcuts",{namespace:"crm/v5/settings",methodForRequest:function(e){return"PATCH"===e?"PUT":e},buildURL:function(e,t,i,r,a){if(null!==a)return a}}).extends("application"),store.registerSerializer("keyboard_shortcuts",{normalizeResponse:function(e,t,i){var r=store.peekAll("tab_group"),a=store.peekAll("module"),s=[],o=r.find((e=>"0"===e.id));o&&o.modules?s=o.modules:a.length&&(s=a.filter((e=>e.show_as_tab&&e.viewable&&e.visible&&1===e.visibility)));var n=s,l=i.keyboard_shortcuts;l=JSON.parse(JSON.stringify(l));var d="",c=l.shortcuts;function u(e,t){let[i,r]=function(e,t,i){let r,a=-1;return r=e.findIndex((e=>e.category===t)),a=e[r].components.findIndex((e=>e.action===i)),[r,a]}(c,e,t);-1!==i&&-1!==r&&(0!==c[i].components[r].key_combination.length&&(d=d+'{"category":"'+e+'","components":[{"action":"'+t+'","key_combination":[]}]},'),c[i].components.deleteElementAt(r))}featuresAvailable.CSCRIPT_COMMANDS||function(){let e=l.shortcuts,t=e.findIndex((e=>"Commands"===e.category));-1!==t&&e.splice(t,1);let i=e.findIndex((e=>"General"===e.category));if(-1!==i){let t=e[i].components,r=t.findIndex((e=>"Open Command Palette"===e.action));-1!==r&&t.splice(r,1)}}(),featuresAvailable.NEXTGENUI_ENABLED||u("General","Show/Hide Left Menu"),"false"!==isCrmPlusUser||"false"!==isZohoOneUser?u("General","Show/Hide Chat Box"):"Free"===Crm.userDetails.EDITION_NAME?(u("General","Open Notifications"),u("General","Show/Hide Chat Box"),u("Record Details View","Call Now"),u("Record Details View","Add Appointment")):"Standard"===Crm.userDetails.EDITION_NAME&&u("Record Details View","Add Appointment"),"false"!==isSandboxAcc&&u("General","Open Notifications");var m=l.shortcuts.find((e=>"Switch Tabs"===e.category));if(void 0!==m){var p=[];m.components.forEach((e=>{var t,i=n.find((t=>t.api_name===e.module.api_name));if(void 0!==i){var r={};r.action=i.plural_label,r.key_combination=e.key_combination,r.deletable=e.deletable,r.editable=e.editable,r.api_name=i.api_name,r.id=i.id,r.module_name=i.module_name,p.push(r)}else t=e.module.api_name,d=d+'{"category":"Switch Tabs","components":[{"module":{"api_name": "'+t+'"}, "_delete":null}]},'})),m.components=p}if("undefined"==typeof CScript||!CScript){const e=l.shortcuts.findIndex((e=>"Commands"===e.category));-1!==e&&l.shortcuts.splice(e,1)}if(Crm.userDetails.CUSTOMIZE_INFO.hasOwnProperty("keyboard_shortcuts")&&""!==d){var _='{"keyboard_shortcuts":{"shortcuts":['+d+"]}}";networkUtils.lyteInitiateRequest("/crm/v5/settings/keyboard_shortcuts","PUT",{params:_})}var f=[];return l.shortcuts.forEach((e=>f.push(...e.components))),f.forEach((e=>{switch(e.key_combination.toString()){case"":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Blank"});break;case"KeyC,KeyC":Crm.client_tracking("Keyboard Shortcuts",{Combination:"C C"});break;case"KeyC,KeyM":Crm.client_tracking("Keyboard Shortcuts",{Combination:"C M"});break;case"KeyC,KeyO,KeyM":Crm.client_tracking("Keyboard Shortcuts",{Combination:"C O M"});break;case"KeyC,KeyM,KeyD":Crm.client_tracking("Keyboard Shortcuts",{Combination:"C M D"});break;case"Shift,KeyL":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Shift L"});break;case"Alt,KeyL":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Alt L"});break;case"Shift,KeyV":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Shift V"});break;case"Alt,KeyV":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Alt V"});break;case"Alt":Crm.client_tracking("Keyboard Shortcuts",{Combination:"Alt"})}})),l},payloadKey:function(){return"shortcuts"}}),store.registerModel("user_group",{name:Lyte.attr("string"),id:Lyte.attr("string"),description:Lyte.attr("string"),created_time:Lyte.attr("user-view-date-time"),modified_time:Lyte.attr("user-view-date-time"),created_by:Lyte.belongsTo("user",{inverse:"createdByUserGroup"}),modified_by:Lyte.belongsTo("user",{inverse:"modifiedByUserGroup"}),sources:Lyte.attr("array")},{actions:{sources_count:{},sources:{},associations:{},get_unassigned:{},get_assigned:{},grouped_counts:{},search:{endPoint:"search"}}}),store.registerAdapter("user_group",{namespace:"crm/v2/settings/",buildURL:function(e,t,i,r,a,s,o){if(a=a.replace("user_group","user_groups"),i&&i.get_unassigned?a=a.replace("user_groups","user_groups/actions/get_unassigned"):i&&i.get_assigned&&(a=a.replace("user_groups","user_groups/actions/get_assigned")),(o&&o.apiVersion&&!o.count_ui||"createRecord"===t||"deleteRecord"===t||"updateRecord"===t||"get_unassigned"===s||"get_assigned"===s||"grouped_counts"===s)&&(a=a.replace("/v2/","/v7/")),void 0!==i&&o&&"status"===i.group_by){var n=o.id;a=a.replace("user_groups","user_groups/"+n+"/associated_users")}return"action"===t&&"search"===s&&(a=a.replace("/settings/user_groups/actions/search","/Groups__s/search"),o.search=!0),a},methodForRequest:function(e){return"PATCH"===e?"PUT":e},processRequest:function(e,t,i,r,a,s,o,n){if("action"===e){if(a){if(a.sources_count){var l=a.sources_count.id;n="/crm/v7/settings/user_groups/"+l+"/actions/sources_count"}else if(a.sources){e=a.sources.type,l=a.sources.id;if(n="/crm/v7/settings/user_groups/"+l+"/sources?type="+e,a.sources.include){var d=a.sources.include;n+="&include="+d}if(a.sources.page){var c=a.sources.page;n+="&page="+c}if(a.sources.per_page){var u=a.sources.per_page;n+="&per_page="+u}if(a.sources.filters){var m={field:{api_name:"name"},comparator:"contains",value:a.sources.filters.value},p="&filters="+encodeURIComponent(JSON.stringify(m));n+=p}}else if(a.associations){l=a.associations.id;n="/crm/v7/settings/user_groups/"+l+"/actions/associations"}else if(a.search){for(var _ in n.includes("per_page")&&a.per_page&&(n=n.split("?")[0]),n+="?",a)"search"!==_&&(n+=_+"="+encodeURIComponent(a[_])+"&");n=n.slice(0,-1)}else if(i){if((i=JSON.parse(i)).get_unassigned)return n="/crm/v7/settings/user_groups/actions/get_unassigned";if(i.get_assigned)return n="/crm/v7/settings/user_groups/actions/get_assigned"}return new Promise((function(e,t){networkUtils.lyteInitiateRequest(n,"GET").then((function(t){e("object"==typeof t?JSON.stringify(t):"{}")}),(function(e){t(JSON.stringify(e))}))}))}return new Promise((function(e,t){networkUtils.lyteInitiateRequest(n,"GET").then((function(t){e("object"==typeof t?JSON.stringify(t):"{}")}),(function(e){t(JSON.stringify(e))}))}))}},reloadAll:function(e,t){return!(!t||!Object.keys(t).length)||!(e.length>0)}}),store.registerSerializer("user_group",{extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t){return"createRecord"===e||"updateRecord"===e?{user_groups:[t.user_group]}:t&&(t.get_unassigned||t.get_assigned)?t:[e]},normalizeResponse:function(e,t,i){return"create"===t||"createRecord"===t||"updateRecord"===t?((i=i&&i.user_groups?i.user_groups[0]:i)&&i.details&&i.details.id&&(i.id=i.details.id),{user_groups:i}):(!validationUtils.isEmpty(i)||"findRecord"!==t&&"findAll"!==t||(i.user_groups=[]),i)}}),Lyte.Mixin.register("crm-related-list-utils",{mandFields:{},open_act_personality:["CALLSPERSONALITY","EVENTSPERSONALITY","TASKSPERSONALITY","APPOINTMENTSPERSONALITY"],closed_act_personality:["CALLSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","TASKSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"],relatedListVsFiles:{ATTACHMENTSPERSONALITY:{script_files:["crm-image-mixin.js","lyte-colorbox.js","crm-image-preview.js"],css_files:Crm.userDetails.RTL_ENABLED?["crm-image-upload-rtl.css","crm-image-preview.css"]:["crm-image-preview.css"],i18n_files:["ImageUpload"]},SURVEYPERSONALITY:{script_files:["crm-zsurvey-rl-all.js","survey-configuration.js"],css_files:["crm-zsurvey-rl-label.css"]},SUPPORTPERSONALITY:{i18n_files:["zdeskrelatedlist"],script_files:["crm-zdesk-rl-all.js","crm-zdesk-rl-label.js"],css_files:["crm-zdesk-rl-all-wrapper.css"]},CHILDCAMPAIGNSPERSONALITY:{script_files:["crm-child-campaigns.js"],css_files:["crm-child-campaigns.css"],js_files:["zohocrm_customView.js"]},CAMPAIGNSPERSONALITY:{script_files:["crux-lookupfilter-component.js"]},CIRCUITSPERSONALITY:{script_files:["crm-circuits-helper.js","crm-circuits-rl-all.js","crm-circuits-mixin.js","crm-circuits-rl-label.js","crm-circuits-common.js"],css_files:["crm-circuits-rl-all.css"],i18n_files:["circuits"]},VOCPERSONALITY:{script_files:["voc-entity-store.js","voc-common-store.js","voc-common-utils.js","gamescope-grid.js","voc-entity.js","voc-component-store.js"],js_files:["zohocrm_chart.js"]},ZEXPENSEPERSONALITY:{script_files:["crm-zexpense-rl.js","crm-zfinance-rl-utils.js"],css_files:["crm-zexpense-rl.css"]},ZSUBSCRIPTIONSPERSONALITY:{script_files:["crm-subscription-rl.js","crm-zfinance-rl-utils.js"],css_files:["crm-subscription-rl.css"]},RELATEDLISTPERSONALITY:{script_files:["crm-custom-rl.js"],css_files:["crm-custom-rl.css"]},CHECKLISTSPERSONALITY:{script_files:["crm-related-list-checklist.js"],css_files:["crm-relatedlist-checklist.css"]},MESSAGESPERSONALITY:{script_files:["crm-msg-related-list.js","crm-msg-utils.js"],css_files:["crm-msg-related-list.css"]},ZINVOICEPERSONALITY:{script_files:["crm-zfinance-rl.js","crm-zfinance-rl-utils.js"],css_files:["crm-zfinance-rl-all.css","crm-zfinance-stock-info.css"]},VISITSPERSONALITY:{script_files:["crm-salesiq-detail-view.js"]},PROJECTSPERSONALITY:{script_files:["integration/crm-zprojectsrl-store.js","crm-project-detail-view.js","crm-zohoprojects-iframe.js"],css_files:["integration/crm-zprojects-rl-all.css"],i18n_files:["PROJECTS"]},EMAILSPERSONALITY:{script_files:["crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","crm-emailsai-config.js","crm-emailconversation-view.js","crm-email-rl-filter.js","email-summary.js","crm-emailconversation-view-helpers.js","crm-email-activity-suggestions.js"],css_files:["crm-emails-related-list.css","email-summary.css"],less_files:["crm-emailconversation-view.css","crm-email-activity-suggestions.css"],js_files:["zohocrm_customnew.js","zohocrm_lookupBusinessCard.js","zohocrm_emailTrackingStatus.js"],i18n_files:["emailsRelatedList","emailsummary","crrl","emailsForAllModules","emailthreadview","activityv2","FeedbackMechanism","ziaemail","emailintent","Notification"]},SERIESPERSONALITY:{script_files:["series_store.js"]}},seriesSelectedids:[],loadSocial:function(e,t,i){var r=!1,a=[];if(e.accounts.forEach((function(e){"twitter"===e.network&&e.status<=1&&e.perm_type<=3&&a.push(e.id)})),void 0!==e&&void 0!==e.accounts&&e.accounts.length>0){var s=void 0!==e.SOCIALPROFILES?e.SOCIALPROFILES.twitter:"";s=(s=void 0===s?"":s).trim(),a.length>0&&s&&(r=!0)}if(e.new_social){var o=networkUtils.returnDependencyFiles(["crm-social-common-mixins.js","social_related_list_store.js","crm-social-helper.js","social_related_list_store.js","crm-social-related-list-common.js","crm-social-integ-outer-template.js","crm-social-common-models.js","crm-social-setup-models.js"],ResourceConstants.CRMClient);Lyte.injectResources(o,void 0,(function(){var s=Lyte.registeredMixins["crm-social-integration"];e.id||(e.id=Math.floor(1e5*Math.random()+1)),e.brandParent=[],e.personalAcc=[],e.accIdVsPerm=[],e.networkVsBrandId=[],e.brandIdVsDetails=[],$.each(e.accounts,(function(t,i){"brand"===i.type&&i.status<=1&&!e.networkVsBrandId[i.network]?(e.brandParent[i.network]=i.id,e.networkVsBrandId[i.network]=i.brand?i.brand.id:void 0):"Personal"===i.type&&i.status<=1&&(e.personalAcc[i.network]=i.id),e.accIdVsPerm[i.id]=i.perm_type})),void 0!==e.brands&&$.each(e.brands,(function(t,i){i.accounts&&i.accounts.length>0&&(e.brandIdVsDetails[i.id]=i)})),e.module=i,e.record_id=t,store.unloadAll("social_related_list"),store.pushPayload("social_related_list",e),r&&(s.processPersonalAccounts(void 0,e,!0),s.showDMSection(a),s.showTweetSection()),s.fetchSocialRelatedList(e)}))}else networkUtils.loadFeatureScripts(["zohocrm_zsocial.js","zohocrm_zsocialinteg.js",networkUtils.getI18nJSUrl("social")],(function(){r&&(crmSocialInteg.processPersonalAccounts(void 0,e,!0),crmSocialInteg.showDMSection(a),crmSocialInteg.showTweetSection()),crmSocialInteg.twitterIds=a,crmSocialInteraction.fetchSocialRelatedList(e)}))},renderScoringRelList:function(e,t){var i=networkUtils.returnDependencyFiles(["scoring_entityscore.js","scoringrules_store.js","series_store.js"],ResourceConstants.CRMClient);i=(i=(i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringRulesChart")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles(),ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["scoring_entityscore.css"],ResourceConstants.CRMClient));var r=document.querySelector("crm-entityscores-view");null===r?Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-entityscores-view",e,"#scorigRulesTable"),t&&t()})):(r.component.setData(e),t&&t())},getCustomRelatedListsActions:function(e,t){var i={dropdown:[],newCustomRl:[]};1===t&&i.newCustomRl.push({addNewCustomRl:!0,addNewCustomRlLabel:I18n.getMsg("crm.label.add")}),featuresAvailable.Custom_Related_List&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&(i.dropdown.push({"data-cid":"hideRLPersonality",label:I18n.getMsg("crm.button.mass.hide")}),i.dropdown.push({"data-cid":"reorderRLPersonality",label:I18n.getMsg("crm.button.new.reorder")}),(1===t||0===t&&Crm.userDetails.IS_ADMIN)&&i.dropdown.push({"data-cid":"editRLPersonality",label:I18n.getMsg("crm.label.customRL.modifyScript")}),Crm.userDetails.IS_ADMIN&&i.dropdown.push({"data-cid":"deleteRLPersonality",label:I18n.getMsg("crm.label.customRL.uninstall")})),e.actions=i},getProjectsRelatedList:function(e){var t=[];t.push({zcqa:"link_CreateEditprojectbtn1","data-cid":"newProject",classForLeftPanel:"dummyForLeftPanel",label:I18n.getMsg("crm.project.button.newproject")}),t.push({zcqa:"link_CreateEditprojectbtn2","data-cid":"newAssociateProject",label:I18n.getMsg("crm.project.button.associateproject")}),e.actions=t},isNotActivitySubPersonality:function(e,t){return!(Crm.isActivitySplitDone&&("TASKSHISTORYPERSONALITY"===e||"CALLSHISTORYPERSONALITY"===e||"EVENTSHISTORYPERSONALITY"===e||"TASKSPERSONALITY"===e||"EVENTSPERSONALITY"===e||"CALLSPERSONALITY"===e||"APPOINTMENTSPERSONALITY"===e||"APPOINTMENTSHISTORYPERSONALITY"===e)&&!t)},restrictMandatorySortable:function(e){if(Crm.isActivitySplitDone&&!this.isNotActivitySubPersonality(e,"Services"===$L("#module").val()||void 0)){var t="#relatedListCols_"+e+" .sortable ";$L(t+"input[type='checkbox']:disabled").each((function(e,t){$(t.parentElement.parentElement).addClass("actMandColUnSort")})),$L(t).sortable({placeholder:"ui-state-highlight",items:"li:not(.actMandColUnSort)"})}},validateLimit:function(e,t){if(Crm.userDetails.isRelatedListLyteEnabled){var i=e?e.parentElement:void 0;if(t=void 0===t?i.parentElement.parentElement.parentElement.id.split("_")[1]:t,Crm.isActivitySplitDone&&!this.isNotActivitySubPersonality(t,"Services"===$L("#module").val()||void 0)){var r=$L("#relatedListCols_"+t),a=void 0!==e?i:r[0],s=[],o="#relateList_"+(void 0!==e?$L(a)[0].id.split("_")[1]:r.find("ul")[0].id.split("_")[1]);$L(o+" input[type='checkbox']:checked").each((function(e,t){s.push($L(t).val())}));var n=this.mandFields[t]+5,l=r.find(".columnListBtn"),d=r.find("#customize_error");if(s.length>=n){var c=r.width()-38;d.css("width",c+"px"),d.show(),l.addClass("actColumnsDiv");var u=$L("#"+a.id).find(".ccNotSelected");u.addClass("disableColumns"),u.removeClass("enableColumns"),$L(o+" input[type='checkbox']:checked").each((function(e,t){var i=$L(t.parentElement.parentElement);i.addClass("enableColumns"),i.removeClass("disableColumns")})),$L(".disableColumns input[type='checkbox']").attr("disabled","disabled"),$L("#currentRL").find(".ddMenus.boxShadowMask").find("#menuColumnListView").removeClass("oH pR").addClass("oA").css({"max-height":renderingUtils.windowOuterHeight/3-50})}else{l.removeClass("actColumnsDiv"),d.hide(),$L(".disableColumns input[type='checkbox']").removeAttr("disabled","");var m=$L("#"+a.id).find(".ccNotSelected");m.removeClass("disableColumns"),m.addClass("enableColumns")}}}else crmRelatedList.validateLimit(e,t)},getPersonalityModuleObj:function(e){var t=store.peekRecord("related_list",e);if(t)return t},getTaregetString:function(e){var t=this.getPersonalityModuleObj(e);return t?t.personality_name.replace(/_/g,"$").toLowerCase()+"_"+t.id:""},loadRelatedListComponents:function(e,t,i,r,a){if(Crm.renderDVLyteFlow(e))Lyte.triggerEvent("relatedList",{refresh:!0});else{var s=$L("crm-related-list-view")[0];Lyte.Component.registeredComponents["crm-related-list-view"]||Lyte.registeredMixins["crm-detailview-resources-downloader"].getInitialOuterRLResourcesFiles(),s&&s.component&&s.component.$node.remove();let o={module:e,entityId:t,refreshInteg:!0,integData:i,rlMetaData:r,fullPageLyteRender:Crm.renderDVLyteFlow(e)};Object.assign(o,a),Lyte.Component.render("crm-related-list-view",o,"#relatedPageContent")}},reloadPersonality:function(e,t){Lyte.triggerEvent("relatedList",{module:e,scroll:t});var i=Lyte.Globals.get("relatedList");if(Crm.renderDVLyteFlow(Lyte.Globals.get("relatedList.module"))){var r=Lyte.registeredMixins["crm-detailview-common-utils"];r.loadRelatedRecords(r,i.module,i.entityId,e)}else detailView.loadRelatedDetails(i.module,i.entityId,e)},sortRelatedList:function(e,t,i,r){if(Crm.userDetails.isRelatedListLyteEnabled){if(http){var a=e.substr(e.indexOf("#")+1,e.length),s=a.split("_")[1];if("Activities"===s||s.includes("Activities")){var o=a.split("_")[0];s=store.peekAll("related_list").filterBy({personality_name:o})[0].id}var n=a.split("_")[0].replace("$","_").toUpperCase();e.indexOf("#")>-1&&(e=e.substr(0,e.indexOf("#")));var l=!1;if((e+="&pname="+n).indexOf("closeTask.do")>-1){if(r&&!r.getData("hasCompletePermissionForTask"))return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));var d=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);if("string"==typeof d&&(d="true"===d),!d&&"hidden"===$L("#deletepopup").css("visibility")){var c=window.event,u=renderingUtils.getTargetElem(c),m=networkUtils.parseUrl(e).params,p=(c=window.event,u=renderingUtils.getTargetElem(c),new crmRequestPool);return m[csrfParamName]=encodeURIComponent(csrfToken),m.action="showNotifyOwner",void p.initiate({action:Crm.getCrmBasePath()+"/closeTask.do",data:m,type:"POST",success:function(e){$L("#freezeBackGround").css("z-index","30");var t=Crm.isActivitySplitDone?"deleteAction":void 0;showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",u,void 0,"primarybtn",!0,void 0,"true"===e,!1,t),r&&r.setData("showpopover",!1)},error:function(){$L("#freezeBackGround").css("z-index","30"),showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",u,void 0,"primarybtn",!0,void 0,!1,!1)}})}var _=store.peekAll("related_list"),f=_.filterBy({personality_name:"TASKSHISTORYPERSONALITY"}).length||_.filterBy({personality_name:"EVENTSHISTORYPERSONALITY"}).length||_.filterBy({personality_name:"CALLSHISTORYPERSONALITY"}).length;if(_.filterBy({personality_name:"ACTIVITYHISTORYPERSONALITY"}).length||f){switch(n){case"TASKSPERSONALITY":e+=";TASKSHISTORYPERSONALITY";break;case"EVENTSPERSONALITY":e+=";EVENTSHISTORYPERSONALITY";break;case"CALLSPERSONALITY":e+=";CALLSHISTORYPERSONALITY";break;default:e+=";ACTIVITYHISTORYPERSONALITY"}_.filterBy({personality_name:"TASKSPERSONALITY"}).length&&(e+=";TASKSPERSONALITY")}var y=$("#showDontAskOption").prop("checked");y&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&y&&(e+="&isDontAskAgainChecked="+y);var g=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(e+="&isNotifyOwnerChecked="+g),l=!0}e+="&rid="+s;var v=csrfParamName+"="+encodeURIComponent(csrfToken),h=$L("#parentCurrencyISOCode"),b=$L("#parentExchangeRate");void 0!==t&&"false"===t&&(v=""),h[0]&&(e+="&parentCurrencyISOCode="+h.val()),b[0]&&(e+="&parentExchangeRate="+b.val());var L=$L("#portalRListSel").val(),R=$("#portalRListSel option:selected").text();e+="All Portals"!==L?"&portalName="+R+"&allPortals=false":"&allPortals=true";var C="CB_"+s;if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[C]){var w=CustomButtonJSObjectInit.checkBox[C].indexOf(i);CustomButtonJSObjectInit.checkBox[C].splice(w,1);var S=CustomButtonJSObjectInit.checkBox[C].length;$L("#relatedListRecVal_"+s).text(S)}var T=!1;if(l&&(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks"))&&(T=!0,Crm.VR||(Crm.VR={}),Crm.VR.rL_closetask=!0,Crm.VR.ajaxEditFieldLabel="STATUS"),l&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))){renderingUtils.freezeBackground();var m={module:"Tasks",entityId:i,layoutId:""};return T&&(m.includeVR=!0),m[csrfParamName]=encodeURIComponent(csrfToken),void(p=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:m,type:"POST",success:function(t){CFRExec.moveToTempHolder(),returnJson=JSON.parse(t.entityInfo),Crm.jsonDepValues.Tasks=JSON.parse(returnJson.Tasks.fieldDependency),T&&(Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),Crm.VR.entityDetails=returnJson),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list");var r=CFRExec.getTaskCompletedOptionLabel("list"),s=CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",r);if(-1!==s)if(s){hideAnimatePopup("deletepopup");var o={};o.moduleid=i,o.module="Tasks",o.columnName="STATUS",o.fieldValue=r,networkUtils.setCsrfParam(o);var n=objectUtils.URL(e).getParams();o.check={type:"closeTask",from:"relatedList",module:n.module,id:n.id},CFRExec.haltStageChange(o)}else T?new Promise((function(t){t(Lyte.registeredMixins["crm-related-list-utils"].executeVRRule(i,e))})).then((function(t){t||(renderingUtils.removeFreezeLayer(),Lyte.registeredMixins["crm-related-list-utils"].performOperationNdReloadList(e,a,v))})):(renderingUtils.removeFreezeLayer(),Lyte.registeredMixins["crm-related-list-utils"].performOperationNdReloadList(e,a,v));else renderingUtils.removeFreezeLayer()},error:function(){return!1}})}if(l&&T)return renderingUtils.freezeBackground(),(m={module:"Tasks",entityId:i,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),m.onlyEntityDetails=!0,m.includeVR=!0,void(p=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:m,type:"POST",success:function(t){Crm.VR.entityDetails=JSON.parse(t.entityInfo),Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),new Promise((function(t){t(Lyte.registeredMixins["crm-related-list-utils"].executeVRRule(i,e))})).then((function(t){t||(renderingUtils.removeFreezeLayer(),Lyte.registeredMixins["crm-related-list-utils"].performOperationNdReloadList(e,a,v))}))},error:function(){return!1}});r?this.performOperationNdReloadList(e,a,v,r.data):this.performOperationNdReloadList(e,a,v)}("Campaigns"===$L("#module").val()&&$L("#totalContact")[0]||$L("#totalLead")[0])&&loadCampaingSummary()}else sortRelatedList(e,t,i,r)},executeVRRule:function(e,t){return CVRExec.getTaskCompletedUserValue(),CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(i){if(!i){hideAnimatePopup("deletepopup");var r={};r.moduleid=e,r.module="Tasks",r.columnName="STATUS",r.fieldValue="Completed",networkUtils.setCsrfParam(r);var a=objectUtils.URL(t).getParams();return r.check={type:"closeTask",from:"relatedList",module:a.module,id:a.id},a.isNotifyOwnerChecked?r.isNotifyOwnerChecked="true":a.isDontAskAgainChecked&&(r.isDontAskAgainChecked="true"),CVRExec.storeCachedParams(r),!0}return!1}))},performOperationNdReloadList:function(e,t,i,r){commonUtils.showHideLoadingDiv(!0),http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4===http.readyState){hideAnimatePopup("removepopup"),hideAnimatePopup("deletepopup");var i=http.responseText;if(http.status===crmConstants.errorStatusCode)return commonUtils.showHideLoadingDiv(),void renderingUtils.displayPermissionDenied(http);if(validationUtils.isJson(i)&&JSON.parse(i).CannotDelete){commonUtils.showHideLoadingDiv();var a='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg(JSON.parse(i).CannotDelete[0])+'</h2></div><div class="mT10">'+I18n.getMsg(JSON.parse(i).CannotDelete[1])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');renderingUtils.removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";return void renderingUtils.popUpWithFreeze(a)}if(validationUtils.isJson(i)&&"object"!=typeof i&&"PARENT_RECORD_DELETED"===JSON.parse(i).STATUS)return commonUtils.showHideLoadingDiv(),void crmui.showMsgBand("error",I18n.getMsg("crm.record.perform.deleted.revoked"),5e3);if(i.indexOf(":::CampaignMemberDisAssociationException:::")>-1){commonUtils.showHideLoadingDiv();var s=JSON.parse(i);return void renderingUtils.showCustomAlert(s.msg,s.title,!1)}if(i.indexOf("ALERTERROR:::")>-1){var o=i.split("ALERTERROR:::");return commonUtils.showHideLoadingDiv(),o[1].indexOf(I18n.getMsg("crm.security.error"))>-1?void renderingUtils.displayPermissionDenied():void _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:o[1]}})}if(e.indexOf("pname")>-1){var n=objectUtils.URL(e).getParams();!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder(),e.includes("MassDelete.do")&&null!==n&&"EMAILSPERSONALITY"===n.pname&&0===$L("#isFromNewAPI").length&&$L("#selectMails").val("ALL").change();var l=$L("crm-related-list-view")[0],d=l?l.component.getData("module"):$L("#module")[0].value;if(r){if(!r.canvas||"Activities"===!r.list_relation_id){d=n.module;crmTab.deleteFromCache(d),d=n.actModule,crmTab.deleteFromCache(d)}}else if("canvas"===Lyte.Router.getRouteInstance().routeName&&("Tasks"===n.module||"Events"===n.module||"Calls"===n.module&&n.actModule)){d=n.module;crmTab.deleteFromCache(d)}else{var c=n.action,u=n.module,m=n.actModule;"CloseTask"!==c&&crmTab.deleteFromCache(u),crmTab.deleteFromCache(m)}}else!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder();try{if(t){var p=t.split("_");p=p.length>0?p[1]:void 0}Lyte.Globals.get("relatedList.oldAppointments")&&Lyte.triggerEvent("appointmentsReload",{});var _={res:JSON.parse(i)};p&&(_.id=p),Lyte.triggerEvent("relatedList",_)}catch(e){Lyte.triggerEvent("relatedList",{res:i})}commonUtils.showHideLoadingDiv(),showDrillDownPtr(t),refreshFollowDiv()}},http.send(i)},getContactTreeData:function(e,t){var i="crm/v6/"+t+"/"+e+"/__contacts_hierarchy";store.findRecord("dummy",e,{},!1,!1,{url:i}).then(function(t){var i=t.data;if(void 0!==i&&"TOO_MANY_RECORDS"===i.code){var r=Crm.moduleInfo.Contacts.pluralLabel,a=Crm.moduleInfo.Accounts.singularLabel;crmui.showMsgBand("info",I18n.getMsg("crm.contact.hierarchy.view.Tree_not_supported",[$ESAPI.encoder().encodeForHTML(a),$ESAPI.encoder().encodeForHTML(r)]),"10000")}else if(void 0!==i){var s=this.constructTree(i),o=[{value:{Account_Name:{name:i[0].Account_Name.name},isAccount:"true"},children:s}],n=networkUtils.returnDependencyFiles(["crm-contact-hierarchyview.js","lyte-tree.js"],ResourceConstants.CRMClient),l=[];Crm.userDetails.RTL_ENABLED&&(l=networkUtils.returnDependencyFiles(["crm-contact-hierarchyview-rtl.css"],ResourceConstants.CRMClient));var d=n.concat(l);Lyte.injectResources(d,void 0,(function(){Lyte.Component.render("crm-contact-hierarchyview",{treeData:o,currentEntityId:e,isPopUp:!0},"#contactTreePopupId")}))}}.bind(this),(function(e){if("TOO_MANY_RECORDS"===JSON.parse(e.response).code){var t=Crm.moduleInfo.Contacts.pluralLabel,i=Crm.moduleInfo.Accounts.singularLabel;crmui.showMsgBand("info",I18n.getMsg("crm.contact.hierarchy.view.Tree_not_supported",[$ESAPI.encoder().encodeForHTML(i),$ESAPI.encoder().encodeForHTML(t)]),"10000")}}))},constructTree:function(e){for(var t=[],i={},r=e.length,a=0;a<r;a++){var s=e[a],o=s.Reporting_To;(null===o?t:i[o.id]||(i[o.id]=[])).push({value:s})}for(var n=function(e){if(i[e.value.id]){var t=i[e.value.id];e.children=t;for(var r=0,a=t.length;r<a;++r)n(t[r])}},l=(a=0,t.length);a<l;++a)n(t[a]);return t},showRemovePopup:function(e,t,i,r){if(Crm.userDetails.isRelatedListLyteEnabled){$L(".relListMenuDiv").css({visibility:"hidden"});var a=$L(e),s=a.attr("data-stdt"),o=$L.moment().getDObj().getTime(),n=a.attr("data-onclick"),l=a.attr("data-stat");if(void 0===r&&(r=$L("#entityName").val()),s>o&&-1!==parseInt(l)){$L("#remWarningMsg").text(I18n.getMsg("crm.label.event.remove.alert",[r,i]));var d=$L("#notifyButton").show(),c=$L("#dontnotifyButton").show();Lyte.registeredMixins["crm-email-auth-util"].getDomainsAuthNPolicy(),d.off("click").click(event,(function(e){var i;if(!Lyte.registeredMixins["crm-email-auth-util"].showPopUpForEventModule("notifyButton"))if(-1!==n.indexOf("#")?(i=n.substr(0,n.indexOf("#")),n=i+"&isCancelMailNeeded=1"+n.substr(n.indexOf("#"))):n=(i=n)+"&isCancelMailNeeded=1","rl"===t)new Promise((function(e){e(this.sortRelatedList(n))})).then((function(){renderingUtils.stopEvent(e)}));else{var r=a;commonUtils.showHideLoadingDiv(),Events.removeParticipant(n,r),renderingUtils.stopEvent(e)}})),c.off("click").click(event,(function(e){var i;if(commonUtils.showHideLoadingDiv(),-1!==n.indexOf("#")?(i=n.substr(0,n.indexOf("#")),n=i+"&isCancelMailNeeded=0"+n.substr(n.indexOf("#"))):n=(i=n)+"&isCancelMailNeeded=0","rl"===t)new Promise((function(e){e(this.sortRelatedList(n))})).then((function(){renderingUtils.stopEvent(e)}));else{var r=a;commonUtils.showHideLoadingDiv(),Events.removeParticipant(n,r),renderingUtils.stopEvent(e)}})),d.focus()}else{$L("#remWarningMsg").text(I18n.getMsg("crm.label.event.remove.participant.message",[r,i,Events.getModuleName(!0,!1)]));var u=$L("#notifyButton").val(I18n.getMsg("crm.label.event.remove.participant",[r])).show();$L("#dontnotifyButton").hide(),u.removeAttr("data-params").removeAttr("data-cid"),u.off("click").click(event,(function(e){if("rl"===t)new Promise((function(e){e(this.sortRelatedList(n))})).then((function(){renderingUtils.stopEvent(e)}));else{var i=a;commonUtils.showHideLoadingDiv(),Events.removeParticipant(n,i),renderingUtils.stopEvent(e)}}))}showAnimatePopup("removepopup"),e.blur(),event&&renderingUtils.stopEvent(event)}else crmRelatedList.showRemovePopup(e,t,i,r)},getIntegList:function(e,t,i,r,a,s,o,n,l,d,c,u,m,p,_,f,y,g){if(Crm.userDetails.isRelatedListLyteEnabled){var v,h,b,L=Crm.getCrmBasePath()+"/GetIntegrationList.do",R=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),C="action=getIntegList&projectlistrelid="+t+"&module="+a,w=Lyte.Router.getRouteInstance().parent.getDynamicParam(),S=$L("#sendEntityMailLink"),T=S;if("1"===e[0]){var I=$L("#isProjectCalled");(I[0]&&"N"===I.val()||getOpenerObj("isProjectCalled")&&"N"===getOpenerObj("isProjectCalled").value)&&(I[0]?I.val("S"):getOpenerObj("isProjectCalled").value="S");var k=store.peekRecord("module",moduleRecordMapping[a].id).custom_view.id;C+="&reqid="+i+"&returnAnchor="+r+"&cvid="+k+"&portalName="+o+"&msg="+n+"&pageno="+l+"&projId="+d+"&sortorder="+f}if("1"===e[1]){var D="false",A=$L("#mailListRelId");if(A[0]){var E=$L("#mailConfigType");if(E[0]){h=(v=E.val().split("#"))[0];var P=A.val();"1"===h&&v[1]?($L("crm-rl-share-email").length>0&&S.hide(),$L("#maillistid").empty(),document.getElementById(P).innerHTML="<table cellspacing='0' cellpadding='0' width='100%' border='0' class='norec' align='center'><tbody><tr><td valign='center' ><div class='pR30 italic fontsmooth'>"+v[1]+"</div><br/></td></tr></table><br/>"):"2"===h&&v[1]?(D="true",S.hide()):$L("#entIdForZMail")[0]&&(D="true",a&&"Potentials"!==a&&($L("#zmailRS")[0].style.display=""))}else D="true"}if("true"===D){var M=null,O=null,x=null,U=h,N=$L("crm-rl-users-list").length>0,F="true"===$L("#isMailAppsFlow").val(),z=Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),j=$L("#selectMails");j[0]&&(x=j[0]);var V=$L("#dealOnlyDropDown"),q=$L("#contactSelDropdownInAcc"),B=N?q:$L("#contactSelDropdownInAcc :selected");if(null===x||"IMAP_ALL"!==x.value&&"IMAP_ALL"!==x.getAttribute("lt-prop-selected")||"Potentials"===a&&!z||"Accounts"===a&&B.length>0&&("ALL"===B.attr("lt-prop-selected")||"ALL"===B.attr("value")))if("Accounts"===a)B.length>=0&&"ACCOUNTS_ALL"===B.attr("lt-prop-selected")?C+="&mailType=sent_from_crm":B.length>=0&&("ALL"===B.attr("lt-prop-selected")||"ALL"===B.attr("value"))?C+=N?"&mailType=all_contacts_sent_crm_emails":"&mailType=ALLUSERSMAILS":Crm.userDetails.isEmailsForModuleEnabled||null===x||"ALL_MAIL_VIEW"!==x.value&&"ALL_MAIL_VIEW"!==x.getAttribute("lt-prop-selected")?C+="&mailType=sent_from_crm":C+="&mailType=";else if(null===x||"ALL_MAIL_VIEW"!==x.value&&"ALL_MAIL_VIEW"!==x.getAttribute("lt-prop-selected"))if("Potentials"===a&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&"dealsOnly"===V.attr("lt-prop-selected"))C+="&mailType=";else if(null===x||"ALL"===x.value||"ALL"===x.getAttribute("lt-prop-selected")||"Accounts"===a&&B.length>0&&("ALL"===B.attr("lt-prop-selected")||"ALL"===B.attr("value")))C+=N?"&mailType=sent_from_crm":"&mailType=ALLUSERSMAILS";else{var H=x.value?x.value:x.getAttribute("lt-prop-selected");M=H.substring(0,H.indexOf("_")),O=H.substring(H.indexOf("_")+1,H.length)}else C+="&mailType=";else F?C=C+"&mailType="+x.getAttribute("lt-prop-selected"):(C+="&mailType=IMAP_ALLUSERSMAILS","true"===$L("#isALLOptOnly").val()&&(C+="&mailType1=IMAP_CRMMAILS"));var K=c;if("Potentials"===a){var Y=$L("#id");K=c=Y[0]?Y.val():getOpenerObj("id").value,"Potentials"!==a||"dealsOnly"!==V.val()&&"dealsOnly"!==V.attr("lt-prop-selected")||(C+="&isDealsMail=true")}else if(void 0!==B&&B.length>0){var J=$("#addNewIcP_Emails");if(0===J.length)try{J=$("#addNewIcP_"+I18n.getMsg("Emails"))}catch(e){J=$("#newleft_"+g+" .addNewIcP")}"ACCOUNTS_ALL"===B||"ACCOUNTS_ALL"===B.attr("lt-prop-selected")||"ACCOUNTS_ALL"===B.attr("value")?(K=c,Crm.userDetails.isEmailsForModuleEnabled?(S.css("display","inline-block"),J.removeClass("dN")):(S.css("display","none"),J.addClass("hide")),$L("#relatedMailList").hide(),C+="&isAccountsMail=true"):"ALL"!==B.attr("lt-prop-selected")&&"ALL"!==B.attr("value")?(K=void 0===(K=B.attr("value"))?B.attr("lt-prop-selected"):K,U=B.attr("email"),S.css("display","inline-block"),J.removeClass("hide"),$L("#relatedMailList").show()):(K=$L("#id").val(),$L("#relatedMailList").hide(),S.css("display","none"),J.removeClass("dN"),Crm.userDetails.isEmailsForModuleEnabled||J.addClass("hide"),C+="&entityType=allContacts")}else if("Accounts"===a){K=c;var G=q.closest(".newSelect");G[0]&&G.remove(),S[0]&&S.remove();var Z=$L("#relatedMailList");Z[0]&&Z[0].remove(),C+="&isAccountsMail=true"}var W=$L("#entityName").val(),X=$L("#zmailEmail");X[0]&&(U=X.val());var Q="Cases"===a||"Vendors"===a?$L("#zs_EMAIL"):null;if(Q){var ee=$L("#subvalue_EMAIL");ee&&(Q.value=ee.text()),U=Q.value}var te=$L("crm-email-rl-filter");if(("Contacts"===a||"Leads"===a||"Vendors"===a)&&te.length>0){var ie=te.get(0).component,re=ie.getData("emailsSelected"),ae="";if(re&&Crm.userDetails.isCustomEmailPreferencePageEnabled)if("allEmails"===re||"allEmailsSentFrom"===re){for(var se=ie.getData("emailIdOptions"),oe=se.length,ne=0;ne<oe;ne++)"allEmailsSentFrom"!==se[ne].name&&"allEmails"!==se[ne].name&&(ae=ae.concat(se[ne].value).concat(","));""!==ae&&(U=ae)}else U=re=re.split("_")[0];else{var le=store.peekRecord(moduleRecordMapping[a].id,c),de=moduleRecordMapping[a].fields.filter((e=>25===e.ui_type&&"Email"!==e.api_name&&"Secondary_Email"!==e.api_name));if(le){var ce=le.Email;ce&&""!==ce&&(ae=ae.concat(ce).concat(","));var ue=le.Secondary_Email;if(ue&&""!==ue&&(ae=ae.concat(ue).concat(",")),(oe=de.length)>0&&Crm.userDetails.isCustomEmailPreferenceEnabled){for(ne=0;ne<oe;ne++){var me=le[de[ne].api_name];me&&""!==me&&(ae=ae.concat(me).concat(","))}""!==ae&&(U=ae)}}}}C+=void 0!==U?"&listRelationId="+A.val()+"&entId="+K+"&moduleId="+c+"&user_id="+M+"&user_name="+encodeURIComponent(O)+"&searchid="+encodeURIComponent(U)+"&fullname="+encodeURIComponent(W)+"&Zmail=true":"&listRelationId="+A.val()+"&entId="+K+"&moduleId="+c+"&user_id="+M+"&user_name="+encodeURIComponent(O)+"&fullname="+encodeURIComponent(W)+"&Zmail=false"}else{var pe=$L("#zs_EMAIL");if(pe[0]){var _e=$L("#zs_EMAIL1"),fe=$L("#subvalue_EMAIL");_e[0]?pe.val(_e.val()):fe[0]&&pe.val(fe[0].innerHTML)}if(-1===(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6]).indexOf("1"))return}}if("1"===e[2]){var ye=deskInteg.getKeyValueForTicketCriteria();if(!ye)return $L("#deskLoadingDiv div").text(I18n.getMsg("crm.new.label.no.records")),void(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6]);"email"===ye.key&&(C=C+"&"+ye.key+"="+encodeURIComponent(ye.value));var ge=deskInteg.getCurrentTicketType();null!==ge&&(C=C+"&ticketType="+ge),-1===C.indexOf("&moduleId=")&&(C=C+"&moduleId="+w),!1===deskCache.get(w)&&(C+="&deskstats=true")}if("1"===e[3]&&(C=C+"&invoiceListRelationId="+u),"1"===e[4]&&(C=C+"&expenseListRelationId="+m),"1"===e[5]&&(C=C+"&zsubscriptionsListRelationId="+p),"1"===e[3]||"1"===e[4]||"1"===e[5])C=C+"&isRefresh="+(_=void 0!==_&&_)+"&entityId="+c;if("1"===e[6]&&-1===C.indexOf("&entityId=")&&(C=C+"&entityId="+w),C+="&map="+e,Lyte.registeredMixins["crm-email-emotions-mixin"])b=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails();else{var ve=networkUtils.returnDependencyFiles(["email-emotions.js"],ResourceConstants.CRMClient);Lyte.injectResources(ve,void 0).then((function(){b=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails()}))}b&&b.then((function(i){i&&i.zia_config&&Lyte.registeredMixins["crm-email-emotions-mixin"].setEmailsAIVariables(i),networkUtils.loadFeatureScripts(["zohocrm_projectDeatils_list.js"],function(){httphandle.open("POST",L,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),httphandle.onreadystatechange=function(){if(3===httphandle.readyState)try{if(d="["+(d=httphandle.responseText).substring(1)+"]",validationUtils.IsJsonString(d))if(null!==(c=JSON.parse(d))[c.length-1].project&&"1"===e[0]){var i=JSON.parse(c[c.length-1].project);store.pushPayload("zprojects_rl",i.projectList),ZProjects&&ZProjects.errorProject&&(i.errorProject=ZProjects.errorProject),projectProcess(i);var r=parseInt(i.current_filter_count)+1,s=t,o=$L('#RelatedListCommonDiv[ddid="'+s+'"]');r?(r>10&&(r="10+"),r>100&&(r="100+"),$L("#newleft_"+s).find("span.numCountn").addClass("numCountVal").text(r),o.removeClass("noDataFountDetail")):($L("#newleft_"+s).find("span.numCountn").text("").removeClass("numCountVal"),o.addClass("noDataFountDetail")),null!==i&&(e="0"+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]),ZProjects.projectsNavigated=!1}else if(null!==c[c.length-1].mail&&"1"===e[1]){i=JSON.parse(c[c.length-1].mail);if(mailProcess(i),null!==i)if(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6],i.mailRange){var n=i.mailRange;crmRelatedList.mailRange={},crmRelatedList.mailRange[0]=n}else{var l=void 0!==(g=i.mailsList)?g.length:0;g&&g[l-1]&&g[l-1].hasOwnProperty("mail_index")?(Crm.mailIndex={},Crm.mailIndex[0]=g[l-1].mail_index):i.hasOwnProperty("next_index")&&(Crm.mailIndex={},Crm.mailIndex[0]=i.next_index)}}else if(null!==c[c.length-1].support&&"1"===e[2]){null!==(i=JSON.parse(c[c.length-1].support))&&(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6])}else if(null!==c[c.length-1].invoice&&"1"===e[3]){i=JSON.parse(c[c.length-1].invoice);ZInvoice.loadRL("ZINVOICEPERSONALITY",R,u,w,i),null!==i&&(e=e[0]+e[1]+e[2]+"0"+e[4]+e[5]+e[6],"Potentials"===a&&ZInvoice.refreshpotentialEstInvRL(i))}else if(null!==c[c.length-1].expense&&"1"===e[4]){i=JSON.parse(c[c.length-1].expense);ZInvoice.loadRL("ZEXPENSEPERSONALITY",R,m,w,i),null!==i&&(e=e[0]+e[1]+e[2]+e[3]+"0"+e[5]+e[6])}else if(null!==c[c.length-1].zsubscriptions&&"1"===e[5]){i=JSON.parse(c[c.length-1].zsubscriptions);ZInvoice.loadRL("ZSUBSCRIPTIONSPERSONALITY",R,p,w,i),null!==i&&(e=e[0]+e[1]+e[2]+e[3]+e[4]+"0"+e[6])}else null!==c[c.length-1].messages&&"1"===e[6]&&(e=showMessagesList(c[c.length-1].messages,e,y))}catch(e){murphy.error(e)}if(4===httphandle.readyState){var d;d="["+(d=httphandle.responseText).substring(1)+"]";var c,_,f=(c=JSON.parse(d)).length;for(_=0;_<f;_++)if(null!==c[_].project&&"1"===e[0]){i=JSON.parse(c[_].project);store.pushPayload("zprojects_rl",i.projectList),ZProjects&&ZProjects.errorProject&&(i.errorProject=ZProjects.errorProject),projectProcess(i);r=parseInt(i.current_filter_count)+1,s=t,o=$L('#RelatedListCommonDiv[ddid="'+s+'"]');r?(r>10&&(r="10+"),r>100&&(r="100+"),$L("#newleft_"+s).find("span.numCountn").addClass("numCountVal").text(r),o.removeClass("noDataFountDetail")):($L("#newleft_"+s).find("span.numCountn").text("").removeClass("numCountVal"),o.addClass("noDataFountDetail")),null!==i&&(e="0"+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]),ZProjects.projectsNavigated=!1}else if(null!==c[_].mail&&"1"===e[1]){i=JSON.parse(c[_].mail);if(mailProcess(i),null!==i)if(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6],i.mailRange){n=i.mailRange;crmRelatedList.mailRange={},crmRelatedList.mailRange[0]=n}else{var g;l=(g=i.mailsList).length;g&&g[l-1]&&g[l-1].hasOwnProperty("mail_index")?(Crm.mailIndex={},Crm.mailIndex[0]=g[l-1].mail_index):i.hasOwnProperty("next_index")&&(Crm.mailIndex={},Crm.mailIndex[0]=i.next_index)}}else if(null!==c[_].support&&"1"===e[2]){i=JSON.parse(c[_].support);deskInteg.loadDeskintegration(i),null!==i&&(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6])}else if(null!==c[_].invoice&&"1"===e[3]){i=JSON.parse(c[_].invoice);ZInvoice.loadRL("ZINVOICEPERSONALITY",R,u,w,i),null!==i&&(e=e[0]+e[1]+e[2]+"0"+e[4]+e[5]+e[6],"Potentials"===a&&ZInvoice.refreshpotentialEstInvRL(i))}else if(null!==c[_].expense&&"1"===e[4]){i=JSON.parse(c[_].expense);ZInvoice.loadRL("ZEXPENSEPERSONALITY",R,m,w,i),null!==i&&(e=e[0]+e[1]+e[2]+e[3]+"0"+e[5]+e[6])}else if(null!==c[_].zsubscriptions&&"1"===e[5]){i=JSON.parse(c[_].zsubscriptions);ZInvoice.loadRL("ZSUBSCRIPTIONSPERSONALITY",R,p,w,i),null!==i&&(e=e[0]+e[1]+e[2]+e[3]+e[4]+"0"+e[6])}else null!==c[_].messages&&"1"===e[6]&&(e=showMessagesList(c[_].messages,e,y))}Crm.userDetails.detailView_newUI&&$L("#RelatedListCommonDiv #RelatedListDataScrollInteg,#RelatedListCommonDiv #RelatedListDataScroll,#newRelDetailsScroll,#RelatedListCommonDiv #deskIntegDiv").scroll({preventVertical:!0})},httphandle.send(C)}.bind(this))}));try{R&&Crm.SEND_MAIL_BUTTON_HIDE&&(void 0===Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+R]||!Crm.userDetails.permissions["Crm_Implied_Send_Mail_"+R])&&T&&T.length>0&&T.hide()}catch(e){murphy.error(e)}}else getIntegList(e,t,i,r,a,s,o,n,l,d,c,u,m,p,_,f,y,g)},showSrTable:function(){$L("crm-entityscores-view").e[0].component.showSrList()},showSrChart:function(){$L("crm-entityscores-view").e[0].component.showSrChart()},showOnCheckRlActions:function(e){var t="CB_"+e;CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[t]&&CustomButtonJSObjectInit.checkBox[t].length>0&&($L("#ract_"+e+" > a").hide(),$L("#ract_"+e+" > .onCheckRLActions").addClass("tb_newsmallbtn").show())},hideOnCheckRlActions:function(e){var t="CB_"+e;(!CustomButtonJSObjectInit.checkBox||!CustomButtonJSObjectInit.checkBox[t]||!CustomButtonJSObjectInit.checkBox[t].length>0)&&($L("#ract_"+e+" > a").show(),$L("#ract_"+e+" > .onCheckRLActions").hide().removeClass("tb_newsmallbtn"))},renderMemberStatusPopup:function(e){var t=$L("#addCampaignMembersNextButton");t.length&&t.addClass("eventNone op5");var i=networkUtils.returnDependencyFiles(["crm-update-member-status-popup.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-update-member-status-popup.css"],ResourceConstants.CRMClient),a=i.concat(r);Lyte.injectResources(a,void 0,(function(){t.length&&(t.blur(),t.removeClass("eventNone op5")),e.memberStatus=store.peekAll("campaign_status"),Lyte.Component.render("crm-update-member-status-popup",e,"#show")}))},showCampaignStatusDiv:function(e,t){var i={};i.memberStatus=store.peekAll("campaign_status"),i.list_relation_id=e,i.record_id=t.join(";"),i.showPopup=!0,this.renderMemberStatusPopup(i),!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||Crm.renderDVLyteFlow(Lyte.Globals.get("relatedList.module"))||detailView.atnAddClassSelected(event.currentTarget)},addDefaultRelatedList:function(e,t){if(Crm.userDetails.isRelatedListLyteEnabled){var i=CustomRelatedListObj.getCurrentPageDetails("entityId"),r=CustomRelatedListObj.getCurrentPageDetails("module"),a=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addUnselectedRelatedList&module="+r+"&listRelationId="+t+"&entityId="+i,s=csrfParamName+"="+encodeURIComponent(csrfToken);mR(a,(function(){a=Crm.getCrmBasePath()+"/CustomizePage.do?module="+r+"&id="+t+"&entityid="+i+"&from=frmCustomRL",mR(a,(function(e){$L("#topBandPopup").html(e),$L("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.added")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$L("#DefaultRLSuccessMsg").hide()}),2e3);var i=$L("#rlContentChngd");i.length>0&&i.val("true"),CustomRelatedListObj.currentRLId=t,CustomRelatedListObj.currentAction="ADD",reloadRelatedList("reload",!1)}))}),s)}else crmRelatedList.addDefaultRelatedList(e,t)},processCloudPickerAttachmentsResponse:function(e){var t=e.data;if(t||"NO_PERMISSION"!==e.code){for(var i=t.length,r=0,a=!1,s=1024,o=0;o<i;o++){var n=t[o];if("SUCCESS"!==n.code&&(r++,"FILE_SIZE_EXCEEDS"===n.code)){a=!0;var l=n.details.size/1048576;s=Math.round(100*l)/100}}if(r>0){var d=I18n.getMsg("crm.attachment.error.upload",[r]);d+=a?" "+I18n.getMsg("crm.attachment.max.size.reached",[s]):" "+I18n.getMsg("crm.tryagain.message"),crmui.showMsgBand("error",d,1e4)}}else crmui.showMsgBand("error",I18n.getMsg("crm.security.error"),1e4)},addAttachmentsFromCloudPicker:function(e){var t=document.querySelector("crm-cloud-picker").component;t.hidePicker.call(t);var i=e,r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],a=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],s="/crm/v2.2/"+r+"/"+a+"/Attachments",o=i.length;if(o>0){renderingUtils.freezeBackground();var n={data:i},l={attachments:JSON.stringify(n)};"Events"===r?(l.id=a,l.module=r,l.attachTotCnt=$L("#attachTotCnt").val(),s=Crm.getCrmBasePath()+"/fileattach.do",networkUtils.makeRequest(s,"POST",{params:l,success_callback:function(e){if(renderingUtils.removeFreezeLayer(),document.querySelector('crm-related-list-view-header[related-module="Attachments"]')){if(e.startsWith("maxsizereached_")){var t=e.split("maxsizereached_")[1],i=I18n.getMsg("crm.attachment.error.upload",[t])+" "+I18n.getMsg("crm.attachment.max.size.reached",[10]);crmui.showMsgBand("error",i,1e4)}else if(e.startsWith("failure")){t=e.split("failure_")[1],i=I18n.getMsg("crm.attachment.error.upload",[t])+" "+I18n.getMsg("crm.tryagain.message");crmui.showMsgBand("error",i,1e4)}Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()}else{var r=document.createElement("tempDivForAttLink");r.innerHTML=e;var a=getElemById("eventAttachmentDiv");a.appendChild(r),EvalInnerScript(r),a.removeChild(r)}}})):networkUtils.makeRequest(s,"POST",{params:l,success_callback:function(e){renderingUtils.removeFreezeLayer(),Lyte.registeredMixins["crm-related-list-utils"].processCloudPickerAttachmentsResponse(e),Crm.trackSpotLightAction("Cloudpicker Files Attached",{Place:"related list",Count:o}),Lyte.triggerEvent("relatedList",{module:"Attachments"})}})}},getUrlTitle:function(e){var t=$(e).val(),i=$("#invalidUrl");if(""===t)$("#linkattachmentTitle")[0].value="",$("#linkattachmentTitleTr").hide(),$("#attachlinkbtn").prop("disabled",!0),i.hide();else if(validationUtils.isValidWebUrl(t)){i.hide(),commonUtils.showHideLoadingDiv(!0);var r={attachment_url:t};networkUtils.makeRequest("/crm/v2.1/Attachments/actions/process_url","GET",{params:r,success_callback:function(e){commonUtils.showHideLoadingDiv(!1),"error"===e.status?($("#attachlinkbtn").prop("disabled",!0),i.show(),i[0].innerText=I18n.getMsg("crm.custombutton.valid.url.check")):(i.hide(),""===e.process_url.title?$("#linkattachmentTitle")[0].value="Untitled":$("#linkattachmentTitle")[0].value=e.process_url.title,$("#linkattachmentTitleTr").show(),$("#attachlinkbtn").prop("disabled",!1))}})}else i[0].innerText=I18n.getMsg("crm.custombutton.valid.url.check"),i.show()},onUrlInputChange:function(e){Crm.userDetails.isRelatedListLyteEnabled?(clearTimeout(this.timer),this.timer=setTimeout((function(){Lyte.registeredMixins["crm-related-list-utils"].getUrlTitle(e)}),500)):crmRelatedList.onUrlInputChange(e)},hideLinkPopup:function(){Crm.userDetails.isRelatedListLyteEnabled?(hideAnimatePopup("topBandPopup"),!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||Crm.renderDVLyteFlow(Lyte.Globals.get("relatedList.module"))||(detailView.hideDetailviewMenu(!0),detailView.btnRemoveClassSelected(),hideMenu())):crmRelatedList.hideLinkPopup()},addLink:function(e){if(!Crm.userDetails.isRelatedListLyteEnabled)return crmRelatedList.addLink(e);var t=$L("#attachmentUrl").val();if(t.length>3e3)return crmui.showMsgBand("error",I18n.getMsg("maxlenmsg"),"2500"),!1;if(!validationUtils.isValidWebUrl(t))return crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.valid.url.check"),"2500"),!1;var i=Crm.getCrmBasePath()+"/fileattach.do";if(getElemById("attachTotCnt")&&(i+="?attachTotCnt="+getElemById("attachTotCnt").value),"proceed"!==fileAttachSubmitIntercept("attachLink"))return!1;var r={module:$L("#module").val(),id:$L("#id").val(),attachmentUrl:t};return networkUtils.makeRequest(i,"POST",{params:r,success_callback:function(t){if(!e)if("Link already exists"===t)crmui.showMsgBand("error",I18n.getMsg("crm.attach.link.exists"),"2500");else if("invalid_link"===t||""===t)crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.valid.url.check"),"2500");else if(this.hideLinkPopup(),"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName)Lyte.triggerEvent("relatedList",{res:t});else if(document.querySelector('crm-related-list-view-header[related-module="Attachments"]'))Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv();else if(getElemById("attachTotCnt")){var i=document.createElement("tempDivForAttLink");i.innerHTML=t;var r=getElemById("eventAttachmentDiv");r.appendChild(i),EvalInnerScript(i),r.removeChild(i)}else Lyte.triggerEvent("relatedList",{module:"Attachments"})}}),!1},openLinkAndTitleChange:function(e,t){networkUtils.openUrl(t)},importAction:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i=$L(e.target).attr("data-relid"),r=i||$(e.target.closest("lyte-button")).attr("data-relid"),a=this.getPersonalityModuleObj(r),s=$L("crm-related-list-view")[0].component,o={module:encodeURIComponent(a.module.api_name),campaignId:s.getData("entityId"),step:"1"};$L(t).attr("data-params",JSON.stringify(o)),Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:o}).data={itsRelatedModule:"true",dataScope:"myOrgData",currStep:"sourceType",parentModule:encodeURIComponent(s.getData("module")),parentId:s.getData("entityId")}}},importOrgAction:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i=this.getPersonalityModuleObj($L(e.target).attr("data-relid")),r=$L("crm-related-list-view")[0].component,a={module:encodeURIComponent(i.module.api_name),campaignId:r.getData("entityId"),dataScope:"myOrgData"};$L(t).attr("data-params",JSON.stringify(a)),Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:a}).data={currStep:"sourceType",parentId:r.getData("entityId")}}},addAttachmentsFromTeamDrive:function(e){var t=e.callbackDataFromWorkDrive,i=t.filesModel,r=t.permissionModel,a=moduleApiMapping[Lyte.Globals.get("relatedList.module")],s="/crm/v2/"+a+"/"+Lyte.Globals.get("relatedList.entityId")+"/Attachments",o=r.length;if(o>0){for(var n=[],l=Lyte.Globals.get("relatedList.module"),d=moduleRecordMapping[l].id,c=0;c<o;c++){var u=r[c],m=u.link;if(5===u.shareType){var p={entity_id:detailView.entityId,module:d};m=m+"?authId="+$ESAPI.encoder().encodeForURL(JSON.stringify(p))}var _={$link_url:m,File_Name:u.fileName,$resource_id:i[c].id,$type:"teamdrive"};n.push(_);var f={data:n}}if("proceed"!==fileAttachSubmitIntercept("attachFromTeamDrive",n))return!1;("canvas"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.isRelatedListLyteEnabled)&&"entity"===Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{module:"Attachments",category:"links"});var y={attachments:JSON.stringify(f)};"Events"===a?(y.id=Lyte.Globals.get("relatedList.entityId"),y.module=a,y.attachTotCnt=$L("#attachTotCnt").val(),s=Crm.getCrmBasePath()+"/fileattach.do",networkUtils.makeRequest(s,"POST",{params:y,success_callback:function(e){if(document.querySelector('crm-related-list-view-header[related-module="Attachments"]'))Lyte.triggerEvent("relatedList",{module:"Attachments",category:"links"}),refreshFollowDiv();else{var t=document.createElement("tempDivForAttLink");t.innerHTML=e;var i=getElemById("eventAttachmentDiv");i.appendChild(t),EvalInnerScript(t),i.removeChild(t)}}})):networkUtils.makeRequest(s,"POST",{params:y,success_callback:function(){Crm.trackSpotLightAction("Workdrive Files Attached",{Place:"related list",Count:o}),Lyte.triggerEvent("relatedList",{module:"Attachments",category:"links"}),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.workdrive.file.attach.from_WD.success"),ltPropDuration:4e3}})}})}return!1},bindFileUploaderForRelatedListAttachments:function(e){$L(e.save).prop("disabled",!0);$(e.clickable).FileUploader({workdriveUploadData:e.wddetails,isSendToWorkdrive:e.issendtowd,previewsContainer:e.container,createImageThumbnails:!1,needWMSFallback:!0,needVirusFilter:!0,clickable:e.clickable,previewTemplate:e.previewtemplate,uploadMethod:e.uploadmethod,maxFiles:e.uploadlimit,maxFilesize:e.uploadsizelimit,totalFilesize:e.uploadsizelimit,flexSize:e.uploadsizeflex,parallelUploads:e.parallelupload,progressRatio:e.progressratio,fileSizeBase:e.filesizebase,save:e.save,cancel:e.cancel,preventUploadObjDestroy:e.preventUploadObjDestroy,fromSrc:e.fromSrc,init:function(){var t=this;t.on("proceed",(function(t){if(t.preventDefault(),t.stopPropagation(),"proceed"===fileAttachSubmitIntercept("fileUpload",this)){var i=new FormData(document[e.mainform]);if(this.options.isSendToWorkdrive&&document.querySelector('crm-related-list-view-header[related-module="Attachments"]')){var r=this.options.successfullyUploadedFiles,a="";if(r.length>0||failedFiles.length>0)for(var s=r.length,o=0;o<s;o++)a+=","+r[o].resource_id;i.append("temp_resource_ids",a)}else this.getIdsAsFormData("uploadId","uploadIds",i);commonUtils.showHideLoadingDiv(!0);var n;i=new FormData(document[e.mainform]);this.getIdsAsFormData("uploadId","uploadIds",i),commonUtils.showHideLoadingDiv(!0),$.ajax({url:document[e.mainform].action,type:"POST",data:i,contentType:!1,processData:!1,success:(n=this,function(t){let i=t.match(/var failedFilesName = '(.+)';/);if(commonUtils.showHideLoadingDiv(!1),document.querySelector('crm-related-list-view-header[related-module="Attachments"]')){if(Crm.userDetails.isWorkdriveConfigured)if(t.includes("Insufficient Myfolder Storage"))crmui.showMsgBand("error",I18n.getMsg("crm.workdrive.file.attach.insufficient.myfolder.storage.admin"),6e3);else if(t.includes("Storage space exceeded"))crmui.showMsgBand("error",I18n.getMsg("crm.fileuploader.entityattachments.message.507"),6e3);else if(t.includes("Unable to process your request"))crmui.showMsgBand("error",I18n.getMsg("crm.workdrive.file.attach.failure"),6e3);else if(i&&""!==i){let e=i[1];crmui.showMsgBand("error",I18n.getMsg("crm.attachment.error.upload",e),6e3)}else{for(var r="",a=moduleDetailedInfo.modules,s=a.length,o=0;o<s;o++)if("Documents"===a[o].module_name){r=a[o].singular_label;break}if(""!==r){var l=[],d="/crm/org"+Crm.userDetails.ZGID+"/tab/Documents";l.push(r),l.push(d),crmui.showMsgBand("success",I18n.getMsg("crm.workdrive.file.attach.success",l),5e3),$(".crm-msg-cnt").addClass("zwd-suc-msg")}}else _cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:I18n.getMsg("crm.label.function.file.upload.success"),ltPropDuration:1500}});Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()}else $L(e.attachframe).contents().find("body").html(t);$L(n.options.cancel).click()}),error:function(e){return function(){var t=$L(e.options.cancel);t.hide(),_cruxUtils.showMsgBand(e.options.messageType.error,I18n.getMsg("crm.fileuploader.message.uploadfailedretry"),"infinity"),commonUtils.showHideLoadingDiv(!1),t.click()}}(this)}),$L(this.options.save).prop("disabled",!0)}})),t.on("error",(function(e){if(e.previewElement){if(e.virus){var t=$L(e.previewElement).find(".virusAlert");t.css("display","inline-block");var i=t.parent()[0];i.addEventListener("mouseenter",(function(){crmui.showTooltip(I18n.getMsg("crm.fileuploader.ToolTip.virusdetected"))})),i.addEventListener("mouseleave",(function(){crmui.hideTooltip()}))}var r=e.previewElement.querySelector("[data-dz-errormessage]");r&&r.innerHTML.length>20&&$L(r).attr("title",r.innerHTML)}})),t.on("customizepreviewtemplate",(function(e){if(e.previewElement){var t=e.previewElement.querySelector("[data-dz-name]"),i=e.name;i&&i.length>20&&$L(t).attr("title",i);var r="";i&&""!==i&&-1!==i.lastIndexOf(".")&&(r=i.slice(i.lastIndexOf(".")+1)),(t=e.previewElement.querySelector(".dz-filename"))&&$(t).prepend(FileUploader.createElement('<span class="mR15 '+function(e){var t="file";if("txt"===e||"pdf"===e||"html"===e||"xml"===e)return e;var i={png:["jpeg","jpg","gif","png","webp","bmp","svg"],word:["doc","docx","odt","rtf"],excel:["csv","xls","xlsx","ods","xlsm","sxc","tsv"],ppt:["odp","pps","pot","pptx","ppt"],movie:["avi","wmv","mp4","mpeg","mpg","mov","flv","mkv","webm"],mp3:["mp3","ogg","oga","wma","m4p","m4a","au","3gp"],zip:["zip","zipx","tar","gz","z","cab","rar","bz2","lzh","7z","img","iso"]};for(var r in i)if(i.hasOwnProperty(r)&&i[r].indexOf(e)>=0){t=r;break}return t}(r)+'-icon"></span>')),(t=e.previewElement.querySelector("[data-dz-size]"))&&(t.textContent="("+this.options.getFileSize(e.size)+")")}})),t.on("terminate",(function(){if(this.options.isSendToWorkdrive&&document.querySelector('crm-related-list-view-header[related-module="Attachments"]')){var t=this.options.successfullyUploadedFiles,i=this.options.failedUploadedFiles,r=[];if(t.length>0||i.length>0){for(var a=t.length,s=0;s<a;s++)r.push(t[s].resource_id);var o=i.length;for(s=0;s<o;s++)r.push(i[s].resource_id)}var n={};n.params={resource_ids:r[0],record_id:Lyte.Router.getRouteInstance().parent.getDynamicParam()};networkUtils.lyteInitiateRequest("/crm/v2/__internal/workdrive/temporary_files","DELETE",n).then((function(){Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()}))}hideAnimatePopup(e.popupname),setTimeout((function(){$("#attachPopup").remove()}),100)}))},uploadBean:{crmHandback:{entityId:e.entityid,module:e.module,action:e.action},user:{zgid:e.zgid},uploadTo:e.resourcetype,folderId:e.workspace}})},createNewChildCampaign:function(e){if(Crm.userDetails.isRelatedListLyteEnabled){var t=e||event,i=$L(t.target),r=$L("crm-related-list-view")[0].component,a=this.getPersonalityModuleObj(i.attr("data-relid")),s=i.attr("data-layoutid"),o={module:a.module.api_name,primid:r.getData("entityId"),primmodule:r.getData("module"),returnAnchor:a.personality_name.toLowerCase()+"_1458",listRelationId:a.id,recordNum:$L("#recordNum").val(),relmodule:r.getData("module"),fillUpModule:r.getData("module"),entityid:r.getData("entityId"),relmodule:r.getData("module"),entityname:$L("#entityName").val(),isCreateChildCampaign:!0};s&&(o.layoutId=s),Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[a.module.api_name]}).data=o}},newTask:function(e,t){var i=$L("crm-related-list-view")[0].component;Crm.userDetails.isStorageLimitReached?Crm.showStorageExceedPopup():(selectAction("NewTask",this.getTaregetString($L(e.target).attr("data-relid")),i.getData("module"),i.getData("entityId"),t,e),!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||Crm.renderDVLyteFlow(Lyte.Globals.get("relatedList.module"))||detailView.btnAddClassSelected(t))},logCall:function(e,t){var i=$L("crm-related-list-view")[0].component;Crm.userDetails.isStorageLimitReached?Crm.showStorageExceedPopup():(isNewCallView?Crm.globalCreate(e,"relatedlist_new",t,void 0,void 0,void 0,void 0,!0):selectAction("NewCall",this.getTaregetString($L(e.target).attr("data-relid")),i.getData("module"),i.getData("entityId"),t,e),!0!==Crm.userDetails.detailView_newUI||void 0===Crm.userDetails.detailView_newUI||Crm.renderDVLyteFlow(Lyte.Globals.get("relatedList.module"))||detailView.btnAddClassSelected(t))},showPromoPopup:function(e){var t={},i=Lyte.registeredMixins["crm-view-utils"].getIntegCampObject()[e.target.id];if(t.show=!0,t.integTitle=i.name,t.route=i.route,t.iconClass=i.iconClass,Lyte.Component.registeredComponents["crm-integ-promo-popup"])Lyte.Component.render("crm-integ-promo-popup",t,"#show");else{var r=networkUtils.returnDependencyFiles(["crm-integ-promo-popup.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["crm-integ-promo-popup.css"],ResourceConstants.CRMClient),s=r.concat(a);Lyte.injectResources(s,void 0,(function(){Lyte.Component.render("crm-integ-promo-popup",t,"#show")}))}},potentialPopUp:function(e,t){var i=$L("#entityId").attr("value"),r=$L("#cntId").attr("value");void 0===r&&(r=$L("crm-emailsrl-canvas-view").attr("associated-cont-id")),$L(t).closest("tr").attr("tobehidden",!0);var a=Crm.getCrmBasePath()+"/Search.do?searchmodule=Potentials&entityId="+i+"&msgId="+e+"&contactId="+r;commonUtils.openCustomLookup(a,void 0,"topBandPopup",renderingUtils.windowWidth-300)},mailToolTipHvr:function(e,t){if(t){var i=$L(e).offset().top,r=$L(e).offset().left,a=$L(e).outerHeight();setTimeout((function(){$L(".mailDetailToolTip").css({left:r-37,top:i+a+4}).show()}),400)}else $L(".mailDetailToolTip").hide()},fetchCustomRelatedList:function(){$L("crm-custom-rl").each((function(e,t){t.component.executeMethod("reloadRelatedList")}))},setPlayOrPauseMessage:function(e){$L(e).hasClass("icon_pause")?$L(e).attr("title",I18n.getMsg("crm.button.pause")):$L(e).attr("title",I18n.getMsg("crm.button.play"))},triggerLinkDocsView:function(e,t,i,r){if(!Crm.userDetails.isRelatedListLyteEnabled)return triggerLinkDocsView(e,t,i,r);var a;if(-1!==e.indexOf("linkDocs=true")){if(i||(i=renderingUtils.getTargetElem(event)),void 0!==usernameNeeded&&"boolean"==typeof usernameNeeded&&!0===usernameNeeded&&-1===jQuery.inArray("zdoc",usernameNotNeeded))return commonUtils.checkUsernameNeeded((function(){showExportMenu(e,t,attachId,i)}),"zdoc"),!1;var s=objectUtils.URL(e).getParams();(new crmRequestPool).initiate({type:"POST",action:Crm.getCrmBasePath()+"/ZDocs.do?mode=isTrashedDocInZDocs",data:"fileId="+s.fileId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(a){if("true"===trimBoth(a)){var s=I18n.getMsg("crm.trashdoc.alert");return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:s}}),!1}if(["jpeg","jpg","gif","png","webp","bmp","svg"].indexOf(t)>-1)return event.preventDefault(),"fileupload"===r?$L("#fileUploadField_"+i).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}):$L("#relatedList_"+i).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}),renderingUtils.triggerEvent("click",$L("#relatedList_"+i)),!1},error:function(){return!1}})}a="pdf"===t?"pdfViewPlugin":function(){var e={sheet:["excel","xls","csv"],show:["ppt","pptx","pps","odp"],writer:["word","txt","doc","docx","htm","html","sxw","odt","rtf"]};for(var i in e)if(e[i].indexOf(t)>-1)return i}(),"pdf"===t?openSheetForExport(encodeURI(e)+"&downLoadMode=pdfViewPlugin","pdfViewPlugin"):-1===["jpeg","jpg","gif","png","webp","bmp","svg"].indexOf(t)&&openSheetForExport(encodeURI(e)+"&downLoadMode="+a)},showNavigation:function(e,t,i,r){return e>=parseInt(i)||r>=parseInt(i)},getRecipientScrollToId:function(){var e=$L("crm-related-list-view")[0];if(e&&e.component){var t=e.component.getData("relatedList").filter((function(e){return"LEADSPERSONALITY"===e.personality_name||"CONTACTSPERSONALITY"===e.personality_name}));return!(!t||!t.length)&&t[0].id}},splitPersonalitiesCount:function(e,t,i){var r=0;return e.forEach((function(e){"TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY".includes(e.personality_name)?(e.visible&&t.push(e),r++):"TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY".includes(e.personality_name)&&e.visible&&i.push(e)})),r},findActivitySplitPosition:function(e,t,i){var r,a=!0;for(let i=e.length-1;i>=0;i--){let r=e[i];("activity"===t&&"ACTIVITYPERSONALITY"===r.personality_name||"activityHistory"===t&&"ACTIVITYHISTORYPERSONALITY"===r.personality_name)&&Lyte.arrayUtils(e,"removeAt",i,1)}return e.every((function(e,s){("activity"===t&&"TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY".includes(e.personality_name)||"activityHistory"===t&&"TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY".includes(e.personality_name))&&(i.visible=i.visible||e.visible,a&&(i.sequence_number=e.sequence_number,r=s,a=!1))})),r},updateActivityRLDetailBasedOnChilds:function(e,t,i){let r=!1;e.forEach((function(e){("activity"===t&&"TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY".includes(e.personality_name)||"activityHistory"===t&&"TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY".includes(e.personality_name)&&e.visible)&&(r=e.visible)})),i.visible=r},sendNormalMailToMembers:function(e,t){var i=e,r=this.getPersonalityModuleObj(i),a=r.module&&r.module.api_name?r.module.api_name:r.module,s="CB_"+i;if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[s]&&CustomButtonJSObjectInit.checkBox[s].length>0||t&&t.length>0){var o;o=t&&t.length>0?t:CustomButtonJSObjectInit.checkBox[s];var n={from:"relatedList"};n.frommodule=a,n.isCampaignEmail=!0,n.fromRelatedListNormal=!0,n.idList=o.join(";"),n.listRelationId=i,CrmCampaignInteg.CampaignEmailObject=n,CrmCampaignInteg.sendMailToMembers(),crmListView.trackSendMailClickFromRL(a)}else crmui.showMsgBand("error",I18n.getMsg("crm.campaign.member.email.empty"),3e3)},attachFromTeamDrive:function(e,t,i){if(Crm.userDetails.isRelatedListLyteEnabled){var r={WDDomainURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),primaryActionCallBack:Lyte.registeredMixins["crm-related-list-utils"].addAttachmentsFromTeamDrive,closeActionCallBack:Lyte.registeredMixins["crm-related-list-utils"].removeOverallScroll,countToSelectMaxFiles:10,width:"850px",height:"calc( "+renderingUtils.windowHeight+"px - 3rem - 20px )",disableFolderSelection:!1,canShare:!0,service:"ZohoCRM",showSearch:!0,zsoid:crmZgid},a={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0,linkOnly:!0},defaultShare:"teamShare",externalShareTag:"crm_team"};!0===e?(r.countToSelectMaxFiles=t,r.handBackObj={fieldId:fileupload.fieldID},r.primaryActionCallBack=Lyte.registeredMixins["crm-related-list-utils"].addAttachmentFieldFromTeamDrive,r.closeActionCallBack=Lyte.registeredMixins["crm-related-list-utils"].removeOverallScroll,a={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0,linkOnly:!0},defaultShare:"teamShare",externalShareTag:"crm_team"},Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"file upload field"}),i&&(r.customLandingLocation=i)):Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"related list"}),r.shareOptions=a;var s=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([s]),Lyte.injectResources([s],void 0,(function(){(new WorkDrive).showResourcePicker(r)})),$("body").addClass("oH")}else crmRelatedList.attachFromTeamDrive(e,t,i)},removeOverallScroll:function(){$("body").removeClass("oH")},addAttachmentFieldFromTeamDrive:function(e){var t=e.callbackDataFromWorkDrive,i={};i.resources=t.permissionModel;var r=t.handbackobj.fieldId;i.fieldId=r;var a=!1,s=Lyte.registeredMixins["crm-detailcanvas-utils"];s&&(s.isFormViewCommonCheck()||s.isWizardView())&&(a=!0);var o=t.permissionModel,n=o.length;if(n>0){for(var l=[],d=0;d<n;d++){var c={$link_url:(e=o[d]).link,File_Name:e.fileName,$type:"teamdrive"};l.push(c);var u={data:l}}var m=document.getElementById("bp-exec-popup");if(m&&m.ltProp("show")&&document.querySelector("crm-blueprint-exec-attach").component.executeMethod("addTeamDriveAttachments",l),"proceed"!==fileAttachSubmitIntercept("attachFromTeamDrive",l))return!1;var p={attachments:JSON.stringify(u)};p.id=r,p.action="storeTeamDriveAttachments";for(var _=Crm.getCrmBasePath()+"/fileattach.do",f=i.resources.length,y=[],g=0;g<f;g++)y.push(i.resources[g]);networkUtils.makeRequest(_,"POST",{params:p,success_callback:function(e){for(var t=e.teamDriveData,r=t.length,s=0;s<r;s++)for(var o=y.length,n=0;n<o;n++)if(y[n].link===t[s].link){y[n].encryptedUploadId=t[s].encryptedUploadId;break}i.resources=y,fileupload.createAttachElement(i,"FieldAttachmentsTeamDrive",a)}})}return $("body").removeClass("oH"),!1},attachFromCloudPickerForFileupload:function(e,t){detailView.fileuploadfieldId=e,detailView.fileuploadParentModule=t;var i={feature:"FileuploadField",cloud_services:"gdrive,box,skydrive,dropbox,evernote,onedrive",callback:Crm.userDetails.isRelatedListLyteEnabled?this.addAttachmentsFromCloudPickertoFileUpload:crmRelatedList.addAttachmentsFromCloudPickertoFileUpload,max_file_selection:5};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(i.cloud_services="gdrive,box,skydrive,onedrive,dropbox"),Crm.userDetails.GOOGLE_SHARED_DRIVE&&(i.cloud_services="gdrive,googleTD,box,skydrive,onedrive"),Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-cloud-picker-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-cloud-picker-mixin"].loadCloudPicker(i)}))},addAttachmentsFromCloudPickertoFileUpload:function(e){var t=document.querySelector("crm-cloud-picker").component;t.setData("showFreezeLayerAgain",!0),t.hidePicker.call(t);var i=detailView.fileuploadfieldId;fileupload.isSubformField&&(fileupload.fieldID=i,fileupload.rowNum=detailView.rowNum);var r,a=!1,s=Lyte.registeredMixins["crm-detailcanvas-utils"];s&&(s.isFormViewCommonCheck()||s.isWizardView())&&(a=!0,r=$L("crm-canvas-form")[0].component);var o={data:JSON.stringify(e)};o.fieldId=i,o.module=detailView.fileuploadParentModule,o.fromFileUploadField=!0,o.fromGoogleDocs="CloudPicker";var n=Lyte.registeredMixins["crm-uploadfields-mixin"];o.attachedSize=n.getFileUploadAttachedSize(fileupload.cxPropId),o.attachedCount=n.getFileUploadAttachedCount(fileupload.cxPropId),r&&a&&(o.module=r.getData("module_name"));var l=n.getCruxFileUploadCreateComponents(fileupload.cxPropId)[0].component;l.setData("cxPropErrorMessage","");var d=Crm.getCrmBasePath()+"/docsSubmit.do";networkUtils.makeRequest(d,"POST",{params:o,success_callback:function(e){if(renderingUtils.removeFreezeLayer(),null!==t.data&&t.setData("showFreezeLayerAgain",!1),"crm.FileuploadField.size.limitstmt"!==e.trim())if("crm.attachment.name.check"!==e.trim())if("crm.attachment.fileUploadField.Maxcount.check"!==e.trim()){if("crm.attachment.fileUploadField.Mincount.check"!==e.trim()){var i=JSON.parse(e);return $(".zc_fileup_alert").addClass("dNImp"),"crm.FileuploadField.size.limitstmt"===i.message?(l.setData("cxPropErrorMessage",parent.I18n.getMsg("crm.FileuploadField.size.limitstmt")),!1):"crm.attachment.fileUploadField.Maxcount.check"===i.message?(l.setData("cxPropErrorMessage",parent.I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check")),!1):"crm.attachment.fileUploadField.Mincount.check"===i.message?(l.setData("cxPropErrorMessage",parent.I18n.getMsg("crm.attachment.fileUploadField.Mincount.check")),!1):"File not found"===i.message?(l.setData("cxPropErrorMessage",parent.I18n.getMsg("crm.refresh.page")),!1):"crm.attachment.0bytes.file"===i.message?(l.setData("cxPropErrorMessage",parent.I18n.getMsg("crm.FileuploadField.empty.file.error")),!1):void(i.fromFileUpload.length&&fileupload.createAttachElement(i,void 0,a))}_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.attachment.fileUploadField.Mincount.check")}})}else _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check")}});else _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.attachment.name.check")}});else _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.FileuploadField.size.limitstmt")}})}})},docsTabTeamSetupCallback:function(e){var t={},i={};if(void 0!==e.installationObj){var r=e.installationObj.data;t.team_id=r.attributes.team_id,t.wd_org_id=r.attributes.owner,t.installed_id=r.id}i.params=t,networkUtils.lyteInitiateRequest("/crm/v2/settings/workdrive/integrate","POST",i).then((function(){if(null!==Lyte.Router.getRouteInstance().parent.getDynamicParam()&&"Documents"===Lyte.Router.getRouteInstance().parent.getDynamicParam()){var e=document.querySelector("crm-content-libraries");if(e){var t=e.component;t.processAndLoadContentLibraryPage.call(t)}}featuresAvailable.WD_CONTENT_LIBRARY=!0;var i=networkUtils.returnDependencyFiles(["zworkdrive-conf-model.js","crm-related-list-wd-attachments.js"],ResourceConstants.CRMClient);Lyte.injectResources(i,void 0,(function(){var e=$(".newSelect").find("select");store.findAll("workdrive-conf").then((function(t){var i=Lyte.Router.getRouteInstance().routeName;if(void 0===i||"storage"!==i){var r=t[0],a={},s=$("#multipleFieldsEditPop").is(":visible"),o=s?$("#multipleFieldEditModule").val():$L("#module").val();a.module=o,a.moduleApiName=moduleApiMapping[o],a.entityId=s?$("#multipleFieldEditEntityId").val():$L("#entityId").val();var n=!0;store.findAll("workdrive-record-folder",null,null,null,a).then((function(t){var i=crmConstants.FileUploader.relatedListAttachments.previewtemplate,s=!1;if(r.available)if(r.configured){var o=t[0].workdrive_folder_id;if(null===o)return void crmui.showMsgBand("error",I18n.getMsg("crm.workflow.save.error"),5e3);s=!0;var l={};l.id=Lyte.Router.getRouteInstance().parent.getDynamicParam(),l.mod=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();var d=crmConstants.moduleDisplayField[l.mod];void 0===d&&(d=store.peekRecord("module",moduleRecordMapping[l.mod].id).display_field.api_name),a.entityName=store.peekRecord(moduleRecordMapping[l.mod].id,l.id)[d],a.jwtToken=r.web_token,a.parendWorkspaceId=o,crmui.showMsgBand("success","Your Zoho CRM account has been configured successfully with the specified Zoho WorkDrive",5e3)}else if(n=!1,"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())CrmPlusImpl.trigger("handleWorkDriveIntegration");else{var c={wdURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),portalId:crmZgid,productName:"ZohoCRM",appKey:r.app_key,serviceOrgTypeId:5,callbackFn:Lyte.registeredMixins["crm-related-list-utils"].docsTabTeamSetupCallback,signedAppKey:r.signed_app_key,hideLeftPanel:!0},u=RebrandLinkUtil.getProperty("WD_SDK_JS_STATIC_URL");Lyte.removeFromCache([u]),Lyte.injectResources([u],void 0,(function(){(new ZWDSDK).loadOnboarding(c)}))}n?(showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2(e),Lyte.registeredMixins["crm-related-list-utils"].bindFileUploaderForRelatedListAttachments({wddetails:a,issendtowd:s,save:crmConstants.FileUploader.relatedListAttachments.saveElement,uploadmethod:crmConstants.FileUploader.uploadMethod.ZFSNG,acceptedfiles:crmConstants.FileUploader.relatedListAttachments.acceptedfiles,previewtemplate:i,clickable:crmConstants.FileUploader.relatedListAttachments.clickableElement,container:crmConstants.FileUploader.relatedListAttachments.previewElement,cancel:crmConstants.FileUploader.relatedListAttachments.cancelElement,mainform:crmConstants.FileUploader.relatedListAttachments.mainformElement,uploadlimit:crmConstants.FileUploader.relatedListAttachments.uploadLimit,uploadsizeflex:crmConstants.FileUploader.relatedListAttachments.uploadSizeFlex,uploadsizelimit:crmConstants.FileUploader.relatedListAttachments.uploadSizeLimit,parallelupload:crmConstants.FileUploader.relatedListAttachments.parallelUpload,filesizebase:crmConstants.FileUploader.relatedListAttachments.fileSizeBase,progressratio:crmConstants.FileUploader.relatedListAttachments.progressratio,tabload:crmConstants.FileUploader.relatedListAttachments.tabLoadElement,attachframe:crmConstants.FileUploader.relatedListAttachments.targetAttachFrameElement,popupname:crmConstants.FileUploader.relatedListAttachments.popupName,entityid:a.entityId,module:a.module,action:crmConstants.FileUploader.relatedListAttachments.action,resourcetype:crmConstants.Docs.ResourceTypes.ENTITY_ATTACHMENTS,workspace:crmConstants.Docs.WorkSpace.WS_ATTACHMENT_LIBRARY,zgid:Crm.userDetails.ZGID,preventUploadObjDestroy:{prevent:$("#multipleFieldsEditPop").is(":visible"),objBindTo:"#multipleFieldsEditPop"}})):hideAnimatePopup("topBandPopup")}))}else Lyte.Router.getRouteInstance().refresh()}))}))}),(function(){document.querySelector("crm-content-libraries").component.showHideMessageElement.call(self,"#contentLibraryMessageBox","error",!0,I18n.getMsg("crm.mailmerge.internal.error"))}))},updateMXNlookupFieldValue:function(e,t,i,r,a){var s=r,o=$("#multipleFieldsEditPop").is(":visible");if(r&&a)$L("#"+r).val(a);else{var n,l,d=i.mxnfield,c=store.peekRecord("field",d);c.multiselectlookup&&c.multiselectlookup.connectedlookup_apiname&&(n=c.api_name,l=c.multiselectlookup.connectedlookup_apiname),store.findRecord(moduleRecordMapping[t].id,e,{approved:"both",approval_state:"approved,approval_process_pending,approval_process_rejected"}).then((function(e){var i,r=e[0][n];if(i=r.length>0?(i=r.map((function(e){return e[l].name}))).length>2?i[0]+", "+i[1]+".. & "+I18n.getMsg("crm.label.More"):i.join(", "):"",Crm.renderDVLyteFlow(t))for(var a=$("crm-multi-lookup"),o=a.length,c=0;c<o;c++)a[c].component.data.dataKey.includes(d)&&(a[c].component.setData("cxPropDisplayLabel","name"),a[c].component.setData("cxPropFieldArr",r));else{var u=document.querySelectorAll("span[data-fieldid ='"+d+"']")[0];if(void 0===u)return;s=u.id.split("_")[1];var m=$(u.parentElement).data("params");m&&(m.defaultvalue=i),0===$("#subvalue_"+s).length?$L("#value_"+s).text(i):$L("#subvalue_"+s).text(i)}}))}if(multiLookupsView.fieldStatusUpdate(s),s&&3===s.split("_").length){let e=$L("crm-create-fields");var u=e.length,m=s.split("_")[2],p=$("#"+s),_="edit";if(p&&p.closest("#searchCreateDiv").length>0&&(_="quick_create"),o||"quick_create"!==_&&0!==u||"ajaxEdit"===$(p).data("currentstatus"))for(var f=0;f<u;f++){let t=e[f];if(t.id.endsWith(m)){t.component.$node.setData("mxnFldValue",a),t.component.checkLayoutrules(t.component.$node);break}}else{var y=p.val();CFRExec.setValue(m,y,CFRExec.OPERATIONCONSTANT.QUICK_CREATE),CFRExec.isColTriggerLayoutRule&&CFRExec.evalRules(_,!0)}}},setRLCount:function(e){if(!e||!e.parent_relation_name){var t=$L("#newleft_"+e.id).find(".numCountn");e.more_records&&(e.count=e.page?10*e.page+"+":e.count+"+");var i=store.peekRecord("related_list",e.id);e.count?(i&&i[this.data.layoutId]&&!e.actRL&&(i[this.data.layoutId].nodata=!1,this.data.countOfRlRendered<4&&(Lyte.triggerEvent("removeRLviewPort",{id:e.id}),this.setData({countOfRlRendered:this.data.countOfRlRendered+1}))),t.addClass("numCountVal"),t.text(e.count),t.show()):(i&&i[this.data.layoutId]&&!e.actRL&&"oldFlow"===e.from&&(i[this.data.layoutId].nodata=!0),$L(this.$node.querySelector("#relList_Edit_"+e.id)).hide(),t.removeClass("numCountVal"),t.hide())}},getLeftPanelRLInViewPort:function(){var e=$L("crm-related-list")[0];return e?e.component.getData("visibleRelatedList").length:0},loadAppointmentPersonality:function(e,t,i,r,a){a.getData(e+"appReqTriggered")||(a.setData(e+"appReqTriggered",!0),store.findAll("dummy",{action:"getData",pname:e,module:t,id:i},!1,!1,{url:Crm.getCrmBasePath()+"/NewRelatedList.do",method:"GET"}).then((function(s){a.setData(e+"appReqTriggered",!1);var o,n={},l=s[t],d={},c=[],u=Crm.userDetails.actUserRelViewObj.actviewobj?Crm.userDetails.actUserRelViewObj.actviewobj.detail:Crm.userDetails.actUserRelViewObj.detail;if(n.entity_id=i,n.data=[],d.showBlankState=!0,l&&l[r.id]&&(o=l[r.id],n.isshowcol=l[r.id].isShowColumns),o.body&&o.body.data&&(d.showBlankState=!1,n.data.push({label:o.module,module:o.module,parentid:r.id,personality:o.name,zcqa:"customize_"+o.module})),n.module_data=s,n.module_name=t,n.parentid=r.id,n.appointmentAlone=!0,d.entity_id=i,d.layout_id=a.getData("layoutId"),d.rel_module=t,d.relselector=r.personality_name+"_"+r.id,d.txt_ln=152,"APPOINTMENTSPERSONALITY"===r.personality_name?(d.idselector="activity_split_wrapper",d.parent_relation_name="Activities",n.outer_selector="openActivities_customize_outer",n.btn_name="openActivities",d.displayLabel=a.getData("rightPanelLabelApp"),d.activityView=u?u.openActRelView:"ColumnView","TimeLineView"===u.openActRelView?app.store.makeRequest("findRecord","related_list",r.id,{module:t}):"TabView"===u.openActRelView&&(d.showTabViewNoRec=d.showBlankState)):(d.idselector="activity_history_split_wrapper",d.parent_relation_name="Activities_History",n.outer_selector="closedActivities_customize_outer",n.btn_name="closedActivities",d.displayLabel=a.getData("rightPanelLabelAppHist"),d.activityView=u?u.closedActRelView:"ColumnView","TimeLineView"===u.closedActRelView?app.store.makeRequest("findRecord","related_list",r.id,{module:t}):"TabView"===u.closedActRelView&&(d.showTabViewNoRec=d.showBlankState)),a.getData("isClientAccount")){let e=[];e.push(r.id),a.populateCountAndActions(a.getData("module"),a.getData("entityId"),e,void 0,void 0,void 0,a.getData("rlIdVsCount"))}"ColumnView"!==d.activityView&&(d.showBlankState=!1),o.ACTIONS&&o.ACTIONS.length&&o.ACTIONS.forEach((function(e){e["data-cid"]=e.datacid})),d.relActionData={parentid:r.id,data:o.ACTIONS?o.ACTIONS:[]};if(c.push(o),c[0].data=o.body.data,c[0].fields=o.body.fields?o.body.fields:[],c[0].headings=o.body.headings?o.body.headings:[],c[0].info=o.body.info,c[0].body={},c[0].list_relation_id=o.listRelationId,c[0].personality=o.name,c[0].rel_module=t,c[0].entity_id=i,c[0].fields&&c[0].fields.fields){c[0].fields.fields=$u.difference(c[0].fields.fields,["Subject","Event_Title","Appointment_Name","Due_Date","Owner","Start_DateTime","End_DateTime","All_day","Call_Start_Time","Appointment_Start_Time","Member","_bindings"]);var m={};c[0].headings.forEach((function(e){c[0].fields.fields.contains(e.api_name)&&(m[e.api_name]=e)})),c[0].fieldsforrel={},c[0].fieldsforrel[o.name]=m,n.data[0].relatedList=r}d.custData=n,d.subModuleData=c,d.module_data=store.peekRecord(moduleRecordMapping[t].id,i),d.fullPageLyteRender=a.getData("fullPageLyteRender"),d.rlIdVsCount=a.getData("rlIdVsCount"),Lyte.Globals.set("relatedList.oldAppointments",!0);var p=$L("#app_"+d.relselector).find("crm-activity-rel-wrapper");p.length?p[0].setData(d):Lyte.Component.render("crm-activity-rel-wrapper",d,"#app_"+d.relselector),populateRLCount(r.id)})))},setCountFromOldFlow:function(e,t,i){let r=this;store.findAll("dummy",{action:"getAllData",countFlow:"true",id:t,fromIndex:1,module:e},!1,!1,{url:crmBasePath+"/NewRelatedList.do",method:"GET"}).then(function(a){var s=a[e],o=[],n=a.notes;let l=Crm.renderDVLyteFlow(e),d=0,c=0;for(var u in s){let e=s[u].name;!this.isNotActivitySubPersonality(e)&&s[u].hasOwnProperty("count")&&(s[u].count&&o.push(s[u]),this.open_act_personality.includes(e)?d+=s[u].count:this.closed_act_personality.includes(e)&&(c+=s[u].count)),s[u].hasOwnProperty("Count")&&"number"==typeof s[u].Count&&Lyte.triggerEvent("relatedListCountDetail",{count:s[u].Count,id:u,more_records:s[u].Count>10,page:1,from:"oldFlow"})}n&&(l?Lyte.triggerEvent("relatedListCountDetail",{fullCount:n.TotalNotesCount,id:n.LISTRELATIONID}):r.setCountForOldFlow(n.TotalNotesCount)),o.length&&this.activityRLHandlingUtil(o,!1,i,e,t,!0),Lyte.triggerEvent("activityRelatedListCountDetail",{count:d,relation_name:"Activities",has_more:d>10}),Lyte.triggerEvent("activityRelatedListCountDetail",{count:c,relation_name:"Activities_History",has_more:c>10})}.bind(this))},setCountForOldFlow:function(e){var t=$L("#newleft_Notes").find(".numCountn");e?($L(t.eq(0)).text(e),t.addClass("numCountVal"),t.show()):(t.removeClass("numCountVal"),t.hide())},activityRLHandlingUtil:function(e,t,i,r,a,s={}){var o=!1,n=!1,l=Crm.userDetails.actUserRelViewObj.actviewobj?Crm.userDetails.actUserRelViewObj.actviewobj.detail:Crm.userDetails.actUserRelViewObj.detail,d=0,c=0;let u=void 0===s.openActivityRL||s.openActivityRL,m=void 0===s.closeActivityRL||s.closeActivityRL;e.forEach((function(e){var t,a={data:[]},s={data:[]},u={},m={};(m.module=e.module,m.zcqa="customize_"+m.module,m.personality=e.name,m.label="Events"===m.module?"Meetings":m.module,m.parentid=e.listRelationId,m.relatedList=store.peekRecord("related_list",e.listRelationId),-1===e.name.indexOf("HISTORY"))?(a.parentid="Activities",u[m.module]=m,o=!0,"Events"===(t=e.module)&&(t="Meetings"),"Appointments"===t&&(t="Appointments__s"),d+=e.count,i.data.thcAct[t]=e.count,"TimeLineView"!==l.openActRelView&&"TabView"!==l.openActRelView||app.store.makeRequest("findRecord","related_list",e.listRelationId,{module:r,layout_id:i.data.layoutId,include_inner_details:i.innerDetailParam})):(s.parentid="Activities_History",u[m.module+"_History"]=m,n=!0,c+=e.count,"Events"===(t=e.module)&&(t="Meetings"),"Appointments"===t&&(t="Appointments__s"),i.data.thcClosedAct[t]=e.count,"TimeLineView"!==l.closedActRelView&&"TabView"!==l.closedActRelView||app.store.makeRequest("findRecord","related_list",e.listRelationId,{module:r,layout_id:i.data.layoutId,include_inner_details:i.innerDetailParam}));Lyte.Component.registeredHelpers.constructCustomizePopup(a,s,u)})),l&&("TabView"===l.openActRelView&&u&&i.setData({hasDataOpenActivity:o}),"TabView"===l.closedActRelView&&m&&i.setData({hasDataCloseActivity:n})),a||(Lyte.triggerEvent("activityRelatedListCountDetail",{count:d,relation_name:"Activities",has_more:d>10}),Lyte.triggerEvent("activityRelatedListCountDetail",{count:c,relation_name:"Activities_History",has_more:c>10}))},highLightRL:function(e){$L(".relListHead").removeClass("highlight-detailview"),0===e.find(".relListHead").length?e.find(".ntit").addClass("highlight-detailview"):e.find(".relListHead").addClass("highlight-detailview"),setTimeout((function(){e.find(".highlight-detailview").removeClass("highlight-detailview")}),3e3)},scrollToRelatedList:function(e,t){Lyte.Component.viewPortSettings.debounce=200,e?this.scrollToNotes():this.smoothScrollToSpecificRL(t,this.setScrollAfterLoad)},scrollToNotes:function(){var e=$L("#noteDetails");e[0]&&e[0].scrollIntoView({behavior:"smooth"}),this.highLightRL(e)},smoothScrollToSpecificRL:function(e,t){var i=$L("#relatedList"+e),r=store.peekRecord("related_list",""+e),a=$L("crm-related-list-view")[0].component;if("SOCIALPERSONALITY"===r.personality_name){a.setData("isSocialRL",!0);var s=networkUtils.returnDependencyFiles(["crm-social-related-list.js","crm-social-models.js","crm-social-posts.js","crm-social-post-detail-outer.js","crm-social-tab-models.js","crm-social-report-models.js","crm-social-models.js","crm-social-setup-models.js","crm-social-common-models.js","crm-social-tab-rl-common.js","crm-social-post-detail.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);if(Crm.userDetails.RTL_ENABLED){var n=networkUtils.returnDependencyFiles(["crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);l=s.concat(o).concat(n)}else l=s.concat(o);var l=s.concat(o);Lyte.injectResources(l,void 0,(function(){Lyte.registeredMixins["crm-social-integration"].fetchSocialRelatedList(!1)}));var d=$L("#twitter_searchbox");d.length>0&&d.focus()}else a.setData("isSocialRL",!1);i[0]&&(i[0].scrollIntoView({behavior:"smooth"}),t&&t(e),this.highLightRL(i))},setScrollAfterLoad:function(e){Lyte.Globals.set("relatedList.scrollAfterLoad",e)},unenrollSeries:function(e,t){if(Crm.userDetails.isRelatedListLyteEnabled)if(e&&e.$stop_processing)renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else{"object"==typeof t&&(t=Lyte.Globals.get("relatedList.module"));var i=[];if(i.push(Lyte.Router.getRouteInstance().parent.getDynamicParam()),0!==Lyte.registeredMixins["crm-related-list-utils"].seriesSelectedids.length){var r=networkUtils.returnDependencyFiles(["series_store.js","series_mixin.js"],ResourceConstants.CRMClient);r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("relatedRules")],ResourceConstants.CRM)),Lyte.injectResources(r,void 0,(()=>{var e={cadences_ids:Lyte.registeredMixins["crm-related-list-utils"].seriesSelectedids,ids:i};store.triggerAction("cadence","unEnrollSeries",{module:t},{},"POST",e).then((()=>(Lyte.registeredMixins["crm-related-list-utils"].seriesSelectedids=[],"detail"!==Lyte.Router.getRouteInstance().routeName&&crmListView.reloadCurrentListView(),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.entity.unenroll.success",moduleRecordMapping[t].singular_label),ltPropType:"success"}}),"canvas"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName||Lyte.triggerEvent("relatedList",{module:"Entity_Cadences"}),$L("#unenroll").addClass("hide"),$L("#enroll").removeClass("hide"),$L("#filter").removeClass("hide"),$L(".columnadd").removeClass("hide"),$L(".seriesShowOnCheckAction").hide(),$L(".seriesHideOnCheckAction").show(),commonUtils.showHideLoadingDiv(!1),e)),(function(e){Lyte.registeredMixins.series_common.routeErrorHandling(e,!1)}))}))}}else crmRelatedList.unenrollSeries(e)},addSeries:function(e){if(Crm.userDetails.isRelatedListLyteEnabled){if(Crm.seriesEnabled){"object"==typeof e&&(e=Lyte.Globals.get("relatedList.module"));var t={},i=[];t.active="true",t.module=moduleApiMapping[e];var r=Lyte.Globals.get("relatedList.entityId"),a=Crm.getCrmBasePath()+"/NewRelatedList.do?pname=SERIESPERSONALITY&action=getData&module="+e+"&id="+r,s={};s.url=a,s.method="GET",store.findAll("dummy",{},!1,!1,s).then((r=>{var a=r[e];for(var s in crmRelatedList.nameArr=[],a){var o=0,n=a[s].ACTIONS,l=a[s].ACTIONS.length;if(l<1||1===l&&"addSeries"!==n[0]["data-cid"])return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));var d=a[s].heading;for(var c in d)if(o++,"Name"===d[c].FIELDLABEL||"Cadencesid__s"===d[c].SYS_REF_NAME)break;var u=a[s].body;for(var m in u){var p=u[m].CONTENT;p&&!p.contains("Un-enrolled")&&crmRelatedList.nameArr.push(p[o-1])}}store.findAll("cadence",t).then((t=>{for(var r=[],a=t.length,s=0;s<a;s++)crmRelatedList.nameArr&&crmRelatedList.nameArr.includes(t[s].name)||"CUSTOMVIEW"!==t[s].type&&"Custom view"!==t[s].type&&r.push(t[s]);if(i=r,null===document.querySelector("crm-add-to-series")){var o=networkUtils.returnDependencyFiles(["crm-add-to-series.js","series_mixin.js"],ResourceConstants.CRMClient);o=o.concat(networkUtils.returnDependencyFiles(["series_store.js"],ResourceConstants.CRMClient));var n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Series")],ResourceConstants.CRM),l=o.concat(n);Lyte.injectResources(l,void 0,(function(){Lyte.Component.render("crm-add-to-series",{isFromenrol:!0,series_rules:i,module:e},"#show")}))}setTimeout((function(){commonUtils.showHideLoadingDiv(!1)}),100)}),(function(e){403===e.status&&(commonUtils.showHideLoadingDiv(!1),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),10))}))}),(function(e){this.checkOrUncheckTheRuleCheckBox(e.error)}))}}else crmRelatedList.addSeries(e)},OpenSeriesPop:function(e,t,i){if(Crm.userDetails.isRelatedListLyteEnabled){i&&i.stopPropagation();var r=!1;t||(t=this.getSeriesCompletedDateFromRelatedList(e)),""!==t&&"null"!==t&&(r=!0);var a=$("#seriesPop").eq(0);void 0!==a&&a.remove();var s=networkUtils.returnDependencyFiles(["crm-add-to-series.js"],ResourceConstants.CRMClient);s=(s=(s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Series")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles(["series-configs.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["series_store.js"],ResourceConstants.CRMClient)),Lyte.injectResources(s,void 0,(function(){var t={};t.entityId=e,t.entityIdVsDate=detailView.entityIdVsDate,t.cadenceCompleted=r,Lyte.Component.render("crm-series-pop",t,"#mainMenuTabDiv")}))}else crmRelatedList.OpenSeriesPop(e,t,i)},attachFromCL:function(e){store.findAll("workdrive-conf").then((function(t){var i=t[0];let r=e&&"blueprint"===e?$L("crm-blueprint-exec-attach")[0].component.methods.addTeamDriveAttachments:Lyte.registeredMixins["crm-related-list-utils"].addAttachmentsFromTeamDrive;var a={WDDomainURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),primaryActionCallBack:r,countToSelectMaxFiles:10,width:"850px",height:"calc( "+renderingUtils.windowHeight+"px - 3rem - 20px )",disableFolderSelection:!1,canShare:!0,service:"ZohoCRM",showSearch:!0,zsoid:crmZgid,draggableDialog:!1};a.entityId=crmZgid,a.customLandingLocation=i.my_folder_view_id;var s={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0,linkOnly:!0,setByRecord:!0},defaultShare:"teamShare",externalShareTag:"crm_team"};Crm.userDetails.isWorkdriveConfigured&&(s.defaultShare="linkOnly"),Crm.trackSpotLightAction("Documents Picker Click",{Place:"related list"}),a.shareOptions=s;for(var o,n=$("#multipleFieldsEditPop").is(":visible"),l=n?$("#multipleFieldEditModule").val():$("#module").val(),d=n?$("#multipleFieldEditEntityId").val():$("#entityId").val(),c=moduleDetailedInfo.modules,u=c.length,m=0;m<u;m++)if(c[m].module_name===l){o=c[m].id;break}var p="crm.tab.requesters.module.index-module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route?Lyte.Router.getRouteInstance().parent.parent.parent:Lyte.Router.getRouteInstance().parent.parent,_=store.peekRecord(moduleRecordMapping[p.getDynamicParam()].id,Lyte.Router.getRouteInstance().parent.getDynamicParam())[moduleRecordMapping[p.getDynamicParam()].display_field.api_name],f={};f.appKey=i.app_key,f.appToken=i.web_token,f.entityValue=_,f.entityLabel="record",f.module=o,a.entityId=d,a.setByRecordOptions=f;var y=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([y]),Lyte.injectResources([y],void 0,(function(){(new WorkDrive).showResourcePicker(a)}))}))},getInitialRLResources:function(e){var t=[],i=[],r=[],a=[];if(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-related-list-view-header.js","crm-related-list-view-custom-link.js","note_model.js","crux-note.js","crm-notes.js","crm-column-list.js","crux-smart-filter.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-tag.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-list-helpers.js","crm-canvas-core.js","crux-column-list.js","crm-canvas-helpers.js"],ResourceConstants.CRMClient)),Crm.userDetails.isMultiSelectionPopupSupported&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-multi-selection-popup.js"],ResourceConstants.CRMClient))),"Campaigns"===e&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crux-lookupfilter-component.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["zohocrm_CampaignInteg.js"],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Portals")],ResourceConstants.CRM))),featuresAvailable.ZIA_SUMMARY){var s=[];s=(s=(s=s.concat(networkUtils.returnDependencyFiles(["crm-zia-notes-summary.js","crm-notes.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-zia-notes-summary.css","crm-notes.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM)),t=t.concat(s)}a=(a=(a=(a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiSelectPopup")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chronologicalview")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Customization")],ResourceConstants.CRM))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],ResourceConstants.CRM)),r=r.concat(networkUtils.returnDependencyFiles(["crm-list-view-crux.css","crm-related-list-view-header.css"],ResourceConstants.CRMClient)),Crm.userDetails.timelineRevamp&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.js","crm-timeline-helpers.js"],ResourceConstants.CRMClient)),i=i.concat(networkUtils.returnDependencyFiles(["crm-notes-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM))),r=r.concat(networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.css","crm-activity-rel-customize.css"],ResourceConstants.CRMClient)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-activity-rel-rtl.css"],ResourceConstants.CRMClient)));let o=networkUtils.returnDependencyFiles(["crux-note.css","crm-activity-split-allview.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);return o=o.concat(a),o=o.concat(t),o=o.concat(i),o=o.concat(r),o},fetchRLFilesForRelatedListData:function(e){var t=[];return e.forEach(function(e){let i=this.relatedListVsFiles[e.personality_name];if(i&&(i.script_files&&(t=t.concat(networkUtils.returnDependencyFiles(i.script_files.slice(),ResourceConstants.CRMClient))),i.css_files&&(t=t.concat(networkUtils.returnDependencyFiles(i.css_files.slice(),ResourceConstants.CRMClient))),i.less_files&&(t=t.concat(networkUtils.returnDependencyFiles(i.less_files.slice(),ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),i.js_files&&(t=t.concat(networkUtils.returnDependencyFiles(i.js_files.slice(),ResourceConstants.CRM))),i.i18n_files)){let e=i.i18n_files;for(let i of e)t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl(i)],ResourceConstants.CRM))}}.bind(this)),t},checkRLAvailablity:function(e,t,i){let r=!0,a=e.connectedmodule;if(a){let t=store.peekRecord("field",e.mxnfield),s="Crm_Implied_View_"+a;if(r=Crm.userDetails.permissions[s],t&&t.layouts){let e=t.layouts,a=!1;for(let t of e)t.id===i&&(a=!0);r=a}}return r},isAddRelatedListAvailable:function(e){let t=!1;if(Crm.userDetails.permissions.Crm_Implied_Customize_+e&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access&&"true"===RebrandLinkUtil.getProperty("CustomRelatedList")&&Crm.userDetails.isCustomRelatedListSupported&&(["Leads","Accounts","Contacts","Potentials","Campaigns","Vendors","Products","Cases","Bundles"].includes(e)||"custom"===moduleRecordMapping[e].generated_type&&!Lyte.Component.registeredHelpers.isRequesterTeamModule(e))){let e=Crm.userDetails.LICENSE_TYPE;["E","A","C","Z","U"].includes(e)&&(t=!0)}return t},getRelatedListUsingApiName:function(e,t){var i=store.peekAll("related_list").filter((i=>i.href&&i.href.includes(e+"/")&&i.api_name===t));return i?i[0]:void 0},checkAction:function(e,t){var i=t.data_zcqa?t.data_zcqa.toLowerCase():t.zcqa?t.zcqa.toLowerCase():"",r=!1;return"Add"===e&&"newCampaignWithMembers"!==t["data-cid"]?(r=(i.includes("add")||i.includes("create")||i.includes("new"))&&!i.includes("edit")&&"dissociateMxN"!==t["data-cid"])||"newProject"!==t["data-cid"]||(r=!0):"newProject"!==t["data-cid"]&&"newAssociateProject"!==t["data-cid"]&&(r=i.includes("edit")||"dissociateMxN"===t["data-cid"]),r},businessCardJsonApprovalMap:function(e){if(e)switch(e){case"webform_unapproved":return"0";case"approved":return"1";case"approval_process_pending":return"2";case"approval_process_rejected":return"3";case"webform_invalid":return"4";case"webform_invalid_approval":return"5";case"webform_double_optin":return"6";case"review_process_pending":return"7";case"review_process_rejected":return"8";case"merge_pending":return"9";case"zia_vision_pending":return"10";case"zia_vision_rejected":return"12";case"zia_vision_validation":return"13";case"email_parser_waiting":return"14";case"email_parser_rejected":return"15"}},addRelatedListsToDom:function(e,t,i){var r=i||$L("crm-related-list-view")[0],a=r?r.getData("relatedList"):[],s=0;if(a&&(t?a.filter((function(e,i){if(e.personality_name===t)return s=i+1,!0})):e&&a.filter((function(t,i){if(t.id===e)return s=i+1,!0}))),r&&s){var o=r.getData("prevShowElement");o<s&&(s<a.length?(r.setData({isRenderingViewPort:!0}),Lyte.arrayUtils(r.getData("rlViewPortData"),"push",r.getData("relatedList").slice(o,s)),r.setData({prevShowElement:s})):(r.setData({isRenderingViewPort:!1}),Lyte.arrayUtils(r.getData("rlViewPortData"),"push",r.getData("relatedList").slice(o,a.length)),r.setData({prevShowElement:a.length})))}},processRlPreFetch:function(e,t,i,r,a){Lyte.Globals.get("relatedList.rlReqResolved")&&Lyte.Globals.get("relatedList.detailViewAfterRender")&&(i=i||Lyte.Globals.get("relatedList.rlData"),r=r||Lyte.Globals.get("relatedList.layoutId"),a=a||Lyte.Globals.get("relatedList.rlOutlet"),Lyte.Component.render("crm-related-list-view",{module:e,entityId:t,rlMetaReqResponse:i,layoutId:r},a),$L("#remainingList").show())}}),store.registerModel("organization",{id:Lyte.attr("string",{primaryKey:"true"}),domain_name:Lyte.attr("string"),default:Lyte.attr("string"),web_url:Lyte.attr("string"),api_url:Lyte.attr("string"),name:Lyte.attr("string"),type:Lyte.attr("string"),created_time:Lyte.attr("string"),created_by:Lyte.attr("object"),company_logo_id:Lyte.attr("string"),parent_org:Lyte.attr("string")}),store.registerAdapter("organization",{buildURL:function(e,t,i,r,a){return a=a.replace(e,e+"s"),"updateRecord"===t&&(a=a.replace("organizations","__internal/organizations")),a},methodForRequest:function(e){return"PATCH"==e?"PUT":e}}).extends("application"),store.registerSerializer("organization",{payloadKey:function(e){return e+"s"},normalize:function(e,t,i){return"organization"===e&&i&&(i.web_url&&i.web_url.length>0&&(i.web_url+="/tab/Home/begin?ref=manage_organizations"),i.parent_org&&i.parent_org.web_url&&i.parent_org.web_url.length>0&&(i.parent_org.web_url+="/tab/Home/begin?ref=manage_organizations")),i}}),store.registerModel("profile",{id:Lyte.attr("string"),display_label:Lyte.attr("string",{mandatory:!0,validation:"checkSpecialChar"}),name:Lyte.attr("string"),created_by:Lyte.belongsTo("user",{inverse:"createdByProfile"}),modified_by:Lyte.belongsTo("user",{inverse:"modifiedByProfile"}),modified_time:Lyte.attr("user-view-date-time"),created_time:Lyte.attr("user-view-date-time"),description:Lyte.attr("string"),category:Lyte.attr("boolean"),users:Lyte.hasMany("user",{inverse:"profile"}),wizard:Lyte.hasMany("wizard"),permissions_details:Lyte.hasMany("profile-permission",{serialize:"partial",deepNest:!0}),sections:Lyte.attr("array")},{actions:{validate_inventory_dependency:{},get_unassigned:{},get_assigned:{},associated_views:{},search:{}}}),Lyte.registerValidator("checkSpecialChar",(function(e,t){var i=t.replace(/[^~`#%^&*()+|,={};<>[\]\"\\]/g,"").split("");if(i=eliminateDuplicates(i),""==t.trim())return{message:I18n.getMsg("crm.field.none.check",I18n.getMsg("crm.security.profile.name"))};if(0===i.length)return!0;var r=I18n.getMsg("crm.security.profile.name");return{message:1===i.length?I18n.getMsg("crm.clearTextPattern.validationFail.alert",[r,i.join(" ")]):I18n.getMsg("crm.clearTextPattern.validationFail.alert.moreThanOneChar",[r,i.join(" ")])}})),store.registerAdapter("profile",{namespace:"crm/v2.2/settings",xhrReq:new XMLHttpRequest,buildURL:function(e,t,i,r,a,s,o){return a=a.replace("profile","profiles"),Crm.isActivitySplitDone&&"findRecord"===t&&(a=a.replace("/v2.2","/v3")),"action"===t&&(a=i.version?a.replace("/crm/v2.1/settings",i.version):a.replace("/crm/v2.1/settings","/crm/v2.2/settings")),"create"!==t&&"createRecord"!==t||(a=a.replace("profiles","profiles/"+o.cloned_id+"/actions/clone")),"deleteRecord"===t&&o&&o.transfer_to&&(i.transfer_to=o.transfer_to),o&&"5"===o.apiVersion&&(a=a.replace("/v2.2","/v5")),"get_assigned"===s&&void 0!==o&&"changeowner"===o.from&&(a=a.replace("v2.2","v6")),"findRecord"===t&&void 0!==o&&"changeowner"===o.from&&(a=a.replace("v3","v6")),a},reloadAll:function(e,t){return!t||!t.cache},methodForRequest:function(e,t,i,r,a){return"validate_inventory_dependency"===a?"GET":e},processRequest:function(e,t,i,r,a,s){var o=this;if("action"===e&&i){if((i=JSON.parse(i)).get_unassigned&&i.get_unassigned.filters.value)return new Promise((function(t,r){var a=o.xhrReq,n="/"+o.namespace;n=(n+="/profiles/actions/get_unassigned?").replace("v2.1","v2.2"),a.open("POST",n);var l=store.adapter.application.headersForRequest(e,void 0,s);for(var d in l)a.setRequestHeader(d,l[d]);a.onload=function(){this.status>=200&&this.status<300?t(a.response):r({status:this.status,statusText:a.statusText})},a.onerror=function(){r({status:this.status,statusText:a.statusText})},a.send(JSON.stringify(i))}));if("search"===i.type)return a.criteria?new Promise(((e,t)=>{store.findAll("profile").then((function(t){e(JSON.stringify(t.filter((e=>e.name.toLowerCase().startsWith(a.criteria.toLowerCase()))).map((e=>e.$.toJSON()))))}),(function(){t("{}")}))})):Promise.resolve("[]")}}}),store.registerSerializer("profile",{normalizeResponse:function(e,t,i,r,a,s,o){if("create"===t||"createRecord"===t)return{profiles:i.profiles[0].details};if("updateRecord"===t||"deleteRecord"===t)return{};if("findRecord"===t&&(i.profiles=i.profiles?i.profiles[0]:i.profiles),void 0!==o&&void 0!==o.ids){var n=o.ids.split(",");i.profiles=i.profiles.filter((e=>n.contains(e.id)))}return"findAll"===t&&o&&"CUSTOM_HOME"===o.configType&&i&&i.profiles&&(i.profiles=CustomHomePage.filteringDataForComponent(i.profiles,i.profiles.filter((e=>(void 0===CustomHomePage.sharedIdsVsCount[e.id]||CustomHomePage.sharedIdsVsCount[e.id])<CustomHomePage.maxRolesProfilesPerPage)))),i},serialize:function(e,t,i,r,a,s,o){if("action"===e&&"search"===o)return{type:"search",customData:r};if(t){if(t.profiles=t.profile,delete t.profile,"updateRecord"===e||"createRecord"===e){var n=store.peekRecord("profile",t.profiles.id);"updateRecord"!==e||n.custom||"lite_profile"===n.type?"updateRecord"===e&&"lite_profile"===n.type&&this.checkLitePermissions(t.profiles):this.checkAdminPermissions(t.profiles),t.profiles=[t.profiles]}return t}},checkLitePermissions:function(e){var t=e.permissions_details.length,i=0;for(i=0;i<t;i++)store.peekRecord("profile-permission",e.permissions_details[i].id).customizable||(e.permissions_details.splice(i,1),i-=1,t-=1)},checkAdminPermissions:function(e){var t,i,r=e.permissions_details.length,a=0,s=!1,o=store.peekRecord("profile",e.id);for(a=0;a<r;a++)s=!1,i=(t=store.peekRecord("profile-permission",e.permissions_details[a].id)).name.replace("Crm_Implied_",""),(t.module&&"Google_AdWords"===t.module.api_name||-1!==["View_ZInventory_Packages","View_ZSM_Subscriptions","Schedule_Reports","Manage_Reports","Manage_Docs_Folder","Manage_Dashboards","Reply_Messages","Manage_Voice Of Customer","Manage_Voice of the Customer","Manage_Teamspace","Manage_ABM","Create_Team_Module","Manage_Workflow","Manage_Enroll_Series","Manage_UnEnroll_Series","Export_Entity_Cadences","Export_Cadences_Followups"].indexOf(i))&&(s=!0),(i=i.split("_")).pop(),i=i.join("_"),-1!==["View","Create","Edit","Delete","Autolog","View_Invoice","Create_Invoice","Email_Invoice","View_CPQ_Product","Create_CPQ_Product","Edit_CPQ_Product","Delete_CPQ_Product","View_CPQ_Price","Create_CPQ_Price","Edit_CPQ_Price","Delete_CPQ_Price","View_CPQ_Guided","Create_CPQ_Guided","Edit_CPQ_Guided","Delete_CPQ_Guided","View_CPQ_Quotes","Edit_CPQ_Quotes","View_CPQ_Grouped","View_Voc_Record","Create_Team","Associate_Team","Edit_Team","Manage_Workflow","Manage_AR"].indexOf(i)&&(s=!0),-1!=="List_Subordinate".indexOf(i)&&o.name!==crmConstants.adminProfileName&&(s=!0),-1!=="Crm_Implied_Manage_Support_Access".indexOf(t.name)&&o.name!==crmConstants.adminProfileName&&(s=!0),-1!==["Create_ABM","Edit_ABM","Manage_ABM","Delete_ABM","Manage_ABM_Push"].indexOf(i)&&(s=!0),-1!=="Crm_Implied_Export_Reports".indexOf(t.name)&&(s=!0),s||(e.permissions_details.splice(a,1),a-=1,r-=1)}}),store.registerModel("profile-permission",{id:Lyte.attr("string"),display_label:Lyte.attr("string"),enabled:Lyte.attr("boolean"),module:Lyte.attr("object"),name:Lyte.attr("string"),profile:Lyte.hasMany("profile")}),store.registerModel("wizard-element",{_type:Lyte.attr("string"),type:Lyte.attr("string"),id:Lyte.attr("string")}),store.registerModel("layout",{created_by:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),modified_by:Lyte.attr("string"),modified_time:Lyte.attr("string"),name:Lyte.attr("string"),status:Lyte.attr("number"),created_time:Lyte.attr("string"),sections:Lyte.hasMany("section",{serialize:"partial",deepNest:!0}),module:Lyte.belongsTo("module"),fields:Lyte.hasMany("field"),parent_layout:Lyte.attr("string"),profiles:Lyte.attr("array"),container:Lyte.belongsTo("wizard-container"),layout_rule:Lyte.hasMany("layout_rule"),validation_rule:Lyte.hasMany("validation_rule"),show_business_card:Lyte.attr("boolean"),didLoad:function(e){e=this instanceof Record?this:e;Lyte.registeredMixins["crm-module-mixin"].addSubformFieldsintoLyteModel(e.sections)}.on("add")},{actions:{business_card:{},associated:{},customize_bc:{},layoutDeactivateAction:{},layoutDeleteAction:{},layoutActivateAction:{},layoutPermissionAction:{},layoutAssociationAction:{},convert_mapping:{},layoutAssignment:{},associated_profiles:{},layoutsaveaction:{}}}),store.registerAdapter("layout",{namespace:"crm/v2.1/settings",headersForRequest:function(e,t,i){var r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return window.clientPortalName&&(r["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(r["X-CRM-ORG"]=crmZgid),("true"===window.isSandboxAcc&&window.isCanvasProdDiff||"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff)&&(r["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),i&&i.clientPortalSettings&&(r["X-ZOHO-SERVICE"]="crm/client_portal"),i&&i.headers&&i.headers["X-CRM-ORG"]&&(r["X-CRM-ORG"]=i.headers["X-CRM-ORG"]),r},buildURL:function(e,t,i,r,a,s,o){if(a=a.replace(e,e+"s"),"associated"===s||o&&o.applyLayoutId){var n=a.split("layouts");a=n.join("layouts/"+o.layout_id)}else"convert_mapping"==s&&(a=a.replace("/actions",""));if("layoutsaveaction"===s&&(a=a.replace("actions/layoutsaveaction",o.layoutId)),"layoutDeactivateAction"===s&&(a=a.replace("actions/layoutDeactivateAction",o.layoutId+"/actions/activate")),"layoutDeleteAction"===s&&(a=a.replace("actions/layoutDeleteAction",o.layoutId)),"layoutActivateAction"===s&&(a=a.replace("actions/layoutActivateAction",o.layoutId+"/actions/activate")),"layoutPermissionAction"===s&&(a=a.replace("actions/layoutPermissionAction",o.layoutId)),"layoutAssociationAction"===s&&(a=a.replace("actions/layoutAssociationAction",o.layoutId+"/actions/associated")),"layoutAssignment"===s&&(a=a.replace("/actions/layoutAssignment","")),o&&"2.2"===o.apiVersion&&(a=(a=a.replace("crm/v2/settings","crm/v2.2/settings")).replace("crm/v2.1/settings","crm/v2.2/settings")),"business_card"===s){n=a.split("layouts");a=n[0]+"layouts/"+o.layout_id}if("customize_bc"===s&&(a=a.replace("actions/customize_bc",o.layoutId)),o&&"2.2"===o.apiVersion?a=(a=a.replace("crm/v2/settings","crm/v2.2/settings")).replace("crm/v2.1/settings","crm/v2.2/settings"):o&&"4"===o.apiVersion?a=(a=a.replace("crm/v2/settings","crm/v4/settings")).replace("crm/v2.1/settings","crm/v4/settings"):o&&"3"===o.apiVersion?a=(a=a.replace("crm/v2/settings","crm/v3/settings")).replace("crm/v2.1/settings","crm/v3/settings"):o&&"6"===o.apiVersion?a=(a=a.replace("crm/v2/settings","crm/v6/settings")).replace("crm/v2.1/settings","crm/v6/settings"):o&&"7"===o.apiVersion?a=(a=a.replace("crm/v2/settings","crm/v7/settings")).replace("crm/v2.1/settings","crm/v7/settings"):o&&"8"===o.apiVersion&&(a=(a=a.replace("crm/v2/settings","crm/v8/settings")).replace("crm/v2.1/settings","crm/v8/settings")),o&&o.isSandbox){var l=(a=o.hostUrl.url).split("diff/").pop().split("v6/")[0];o.applyLayoutId&&(a=a.concat("/"+o.layout_id)),a=a.replace(l,"")}return"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),"Bundle_Product_Relations__s"!==i.module&&"Bundles__s"!==i.module||(a=Crm.changeBundlesApiVersion(a,"v2.2")),a},methodForRequest:function(e,t,i,r,a){return"associated"===a||"business_card"===a?"GET":"convert_mapping"==a?"PUT":e}}),store.registerSerializer("layout",{serialize:function(e,t,i,r,a,s,o){if("convert_mapping"==o)return{convert_mapping:r.convert_mapping};if("updateRecord"===e&&r&&r.feature&&"customize_bc"===r.feature)t={layouts:[t.layout]};else{if("update"===e)return t;if("layoutAssignment"===o)return t;"associated"===o||r&&r.noPayloadArray||!t||(t.layouts=[t.layouts])}return t},normalize:function(e,t,i,r){return"findAll"!=t&&"findRecord"!=t||!i||this.setProperty(i,r),i},serializeKey:function(e){return e+"s"},normalizeResponse:function(e,t,i,r,a,s,o,n){var l;n&&n.initialload&&store.peekAll("layout").filter((e=>!(e.container||e.module&&e.module.api_name===n.initialload))).forEach((e=>{store.unloadRecord("layout",e.id)}));try{l=moduleRecordMapping[function(e,t){for(var i=e.length,r=0;r<i;r++)if(t(e[r]))return e[r]}(Object.keys(moduleApiMapping),(function(e){return"Potentials"===e?"Potentials"===o.module:moduleApiMapping[e]===o.module}))].id}catch(e){if(n&&n.clientPortalSettings&&"Cannot read property 'id' of undefined"===e.message)throw crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4),e;l=o.module}if(("findAll"===t||"findRecord"===t)&&i.layouts)for(var d=i.layouts.length,c=["hidden","downgraded"],u=[-3,-4],m=0;m<d;m++)!n||n.showHiddenLayouts||-1===u.indexOf(i.layouts[m].status)&&-1===c.indexOf(i.layouts[m].status)&&("campaign_integration"!==i.layouts[m].source||"inactive"!==i.layouts[m].status)?i.layouts[m].module={id:l}:(store.unloadRecord("layout",i.layouts[m].id),i.layouts.splice(m,1),m--,d--);return"updateRecord"!==t&&"update"!==t||(i={layouts:i.details}),i}},{mixins:["crm-module-mixin"]}),store.registerModel("record_locking_configurations",{id:Lyte.attr("string"),restricted_actions:Lyte.attr("array",{watch:!0}),restricted_communications:Lyte.attr("array",{watch:!0}),locking_rules:Lyte.hasMany("locking_rules_mod",{deepNest:!0,serialize:"partial"}),excluded_fields:Lyte.attr("array",{watch:!0}),lock_excluded_profiles:Lyte.attr("array",{watch:!0}),restricted_custom_buttons:Lyte.attr("array",{watch:!0}),lock_type:Lyte.attr("string"),lock_for_portal_users:Lyte.attr("boolean"),locked_for:Lyte.attr("string"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),active:Lyte.attr("boolean")}),store.registerAdapter("record_locking_configurations",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a){return a=a.replace(e,"record_locking_configurations"),"updateRecord"!==t&&"deleteRecord"!==t||(a=a.replace(a.substr(a.indexOf(e),a.length),e),a+="/"+r.id),a},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("record_locking_configurations",{normalizeResponse:function(e,t,i){if("findAll"===t||"findRecord"===t){var r=i.record_locking_configurations,a=r?r[0]:r;return a&&(a.excluded_fields=a.excluded_fields?a.excluded_fields:[],a.restricted_custom_buttons=a.restricted_custom_buttons?a.restricted_custom_buttons:[],a.locking_rules=a.locking_rules?a.locking_rules:[],a.restricted_communications=a.restricted_communications?a.restricted_communications:[],a.lock_excluded_profiles=a.lock_excluded_profiles?a.lock_excluded_profiles:[],a.restricted_actions=a.restricted_actions?a.restricted_actions:[]),{record_locking_configurations:r}}return{record_locking_configurations:i.record_locking_configurations[0].details}},payloadKey:function(){return"record_locking_configurations"},serialize:function(e,t,i,r,a){if("create"===e||"update"===e)return t;if("createRecord"===e||"updateRecord"===e){var s=[],o={};return s.push(t[a]),o[a]=s,o}}}),store.registerModel("locking_rules_mod",{id:Lyte.attr("string"),name:Lyte.attr("string"),lock_existing_records:Lyte.attr("boolean",{default:!1}),criteria:Lyte.attr("object"),_delete:Lyte.attr("boolean")}),store.registerAdapter("locking_rules_mod",{}),store.registerSerializer("locking_rules_mod",{payloadKey:function(){return"locking_rules"}}),store.registerModel("section",{id:Lyte.attr("string"),column_count:Lyte.attr("number"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),sequence_number:Lyte.attr("number"),fields:Lyte.hasMany("field",{serialize:"partial",deepNest:!0}),layout:Lyte.belongsTo("layout")}),store.registerAdapter("section",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,s,o,n){return"updateRecord"===t&&(a=(a=a.replace("section","layouts")).replace("/"+n,"")),a}},{extends:"layout"}),store.registerSerializer("section",{serialize:function(e,t,i,r){if("updateRecord"===e){r&&r.removedFldIds&&t.section.fields&&t.section.fields.forEach((function(e){-1!==r.removedFldIds.indexOf(e.id)&&(e._delete={permanent:!1})})),r&&r.addedFieldVsSeq&&t.section.fields&&t.section.fields.forEach((e=>{r.addedFieldVsSeq.hasOwnProperty(e.id)&&(e.sequence_number=r.addedFieldVsSeq[e.id])}));let e={layouts:[{id:i.layout.id,sections:[{api_name:i.api_name,fields:t.section.fields}]}]};return r&&"customize_bc"===r.feature&&!0===r.isBCEnabled&&(e.layouts[0].show_business_card=!0),e}}}),store.registerModel("field",{id:Lyte.attr("string"),api_name:Lyte.attr("string"),column_name:Lyte.attr("string"),custom_field:Lyte.attr("boolean"),data_type:Lyte.attr("string"),decimal_place:Lyte.attr("string"),field_label:Lyte.attr("string"),length:Lyte.attr("number"),read_only:Lyte.attr("boolean"),show_type:Lyte.attr("number"),ui_type:Lyte.attr("number"),show_type:Lyte.attr("number"),visible:Lyte.attr("boolean"),field_read_only:Lyte.attr("boolean"),default_value:Lyte.attr("string"),required:Lyte.attr("boolean"),system_mandatory:Lyte.attr("boolean"),sequence_number:Lyte.attr("number"),private:Lyte.attr("object"),currency:Lyte.attr("object"),lookup:Lyte.attr("object"),module:Lyte.hasMany("module",{inverse:"fields"}),conversion_mapping:Lyte.attr("object"),layouts:Lyte.hasMany("layout"),custom_view:Lyte.belongsTo("custom_view"),dynamic_field_label:Lyte.attr("string"),vision_fields:Lyte.hasMany("visions",{serialize:null}),section:Lyte.hasMany("section",{inverse:"fields"}),profiles:Lyte.attr("array"),formula:Lyte.attr("object"),rollup_summary:Lyte.attr("object"),pick_list_values:Lyte.attr("array"),conditional_actions:Lyte.hasMany("wizard-conditional-action"),mass_update:Lyte.attr("boolean"),_delete:Lyte.attr("object"),search_layout_module:Lyte.belongsTo("module",{inverse:"search_layout_fields"}),field_read_only:Lyte.attr("boolean"),pick_list_values:Lyte.attr("array"),allowed_modules:Lyte.hasMany("module"),subform_api:Lyte.attr("boolean"),separator:Lyte.attr("boolean"),history_tracking:Lyte.attr("object"),textarea:Lyte.attr("object"),layout_associations:Lyte.attr("array"),score_field:Lyte.hasMany("zia_score",{serialize:null}),score_to:Lyte.hasMany("field_prediction",{serialize:null}),field_contributors:Lyte.hasMany("field_prediction",{serialize:null}),prediction_field:Lyte.hasMany("field_prediction",{serialize:null}),predict_field:Lyte.hasMany("field_prediction",{serialize:null}),prediction_field:Lyte.hasMany("churn_prediction"),score_field:Lyte.hasMany("churn_prediction"),payment_date:Lyte.hasMany("churn_prediction"),subscription_field:Lyte.hasMany("churn_prediction"),based_timestamp:Lyte.hasMany("recommendations",{serialize:null}),selected_view_fields_1:Lyte.hasMany("recommendations",{serialize:null}),selected_view_fields_2:Lyte.hasMany("recommendations",{serialize:null}),selected_view_fields_3:Lyte.hasMany("recommendations",{serialize:null}),segment:Lyte.hasMany("wizard-segment",{inverse:"fields"}),wizsegment:Lyte.hasMany("wizard-segment",{inverse:"fieldsClone"}),colour_code_enabled:Lyte.attr("boolean"),picklist_colour_codes:Lyte.hasMany("user_picklist_colour_code"),multi_module_lookup:Lyte.attr("array"),didLoad:function(){this._type=this.$.model._name}},{actions:{associated:{},fieldPermission:{},fieldPrivacy:{},count:{},fieldsaveaction:{}}}).extends("wizard-element"),store.registerAdapter("field",{namespace:"crm/v2/settings",buildURL:function(e,t,i,r,a,s,o){a=this.$super.buildURL(e,t,i,r,a,s,o);var n="2";if(!o||"2.2"!==o.apiVersion&&"2.1"!==o.apiVersion&&"2.4"!==o.apiVersion&&"4.0"!==o.apiVersion&&"4"!==o.apiVersion&&"6"!==o.apiVersion&&"7"!==o.apiVersion&&"8"!==o.apiVersion||(a=a.replace("crm/v2/settings","crm/v"+o.apiVersion+"/settings"),n=o.apiVersion),o&&(o.isSandboxDiff||"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&o.apiVersion)?a=a.replace("sandbox/diff/v2/settings","sandbox/diff/v"+o.apiVersion+"/settings"):o&&"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&o.apiVersion&&(a=a.replace("production/diff/v2/settings","production/diff/v"+o.apiVersion+"/settings")),"lookup.query_details.criteria"===i.include_inner_details&&(a=a.replace("crm/v2/settings","crm/v2.2/settings")),"fieldPermission"===s?a=a.replace("crm/v"+n+"/settings/field/actions/fieldsPermission","crm/"+crmPortal+"/UpdateFieldPermission.do"):"fieldPrivacy"===s&&(a=a.replace("crm/v"+n+"/settings/field/actions/fieldsPrivacy","crm/"+crmPortal+"/PageLayout.do")),"fieldsaveaction"===s&&(a=a.replace("crm/v8/settings/field/actions/fieldssaveaction","crm/v8/settings/fields")),o&&"5"===o.apiVersion&&(a=a.replace("crm/v2/settings","crm/v"+o.apiVersion+"/settings"),n=o.apiVersion),"Bundle_Product_Relations__s"===i.module||"Bundles__s"===i.module){var l=s&&"count"===s?"v6.1":"v2.2";a=Crm.changeBundlesApiVersion(a,l)}return a},methodForRequest:function(e,t,i,r,a){return"associated"===a||"count"===a?"GET":"fieldPermission"===a||"fieldPrivacy"===a?"POST":e},processRequest:function(e,t,i){if("update"===e){i=JSON.parse(i).fields;var r,a={},s={},o={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return window.clientPortalName&&(o["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(o["X-CRM-ORG"]=crmZgid),i.forEach((function(e){r=store.peekRecord("field",e.id).module[0].api_name,-1===Object.keys(a).indexOf(r)&&(a[r]={},a[r].fields=[]),a[r].fields.push(e)})),new Promise((function(e){for(var t in s={},a)s[t]=networkUtils.sendxhr("/crm/v2.1/settings/fields?module="+t,"PATCH",o,JSON.stringify(a[t]));return Lyte.resolvePromises(s).then((function(t){for(var i in t)e(t[i].response)}))}))}}}).extends("application"),store.registerSerializer("field",{serializeKey:function(e){return e+"s"},serialize:function(e,t,i,r,a,s,o){return"associated"!==o&&"create"!==e&&"count"!==o&&(t=r.payLoad),"fieldPermission"===o||"fieldPrivacy"===o?t=r.payLoad:t&&"associated"!==o&&"create"!==e&&"update"!==e&&(t.fields=[t.fields]),t},normalizeResponse:function(e,t,i,r,a,s,o,n){if(a&&204===a){var l={};return l[e]={},l}if("update"===t)var d=[moduleRecordMapping[o.module]];else d=store.peekAll("module").filterBy({api_name:o.module});if(i&&i.fields&&d.length>0){let e=d[0];!n||!n.hasOwnProperty("include_external_fields")||n.include_external_fields||Crm.userDetails.isStaticSubFormEnabled&&n.isStaticSubform||(i.fields=i.fields.filter((e=>null===e.external))),i.fields.forEach((function(i){if("update"===t&&(i.id=i.details.id,d=store.peekRecord("field",i.details.id).module),"create"===t){if("success"!==i.status)return void(i.$={isError:!0});i.id=i.details.id}i.module=[],i.module[0]=d[0]&&d[0].id?d[0].id:"","FULLNAME"===i.column_name&&["Leads","Contacts"].includes(e.api_name)&&(i.field_label=i.display_label=I18n.getMsg("crm.label.vendor.name",e.singular_label)),"create"!==t&&"update"!==t&&i.api_name.indexOf(".")>-1&&i.api_name.replace(".","__")}))}return i}}),store.registerModel("related_list",{list_label:Lyte.attr("string"),sequence_number:Lyte.attr("string"),display_label:Lyte.attr("string"),api_name:Lyte.attr("string"),module:Lyte.attr("object"),name:Lyte.attr("string"),action:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),href:Lyte.attr("string"),type:Lyte.attr("string"),visibility:Lyte.attr("number"),visible:Lyte.attr("boolean"),sort_order:Lyte.attr("string"),connectedmodule:Lyte.attr("string"),mxnfield:Lyte.attr("string"),linkingmodule:Lyte.attr("string"),record_operations:Lyte.attr("object"),fields:Lyte.attr("array")},{actions:{customize_sort:{},unsort:{}}}),store.registerAdapter("related_list",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,s,o){return a=a.replace(e,e+"s"),o&&o.apiVersion&&(a="2.1"===o.apiVersion?a.replace("crm/v2/settings",Crm.isActivitySplitDone?"crm/v3/settings":"crm/v2.1/settings"):a.replace("crm/v2.2/settings","crm/v"+o.apiVersion+"/settings")),Crm.isActivitySplitDone&&(a=a.replace("/v2.2","/v3"),void 0!==o&&"Chronological"===o.from&&(a=a.indexOf("v2.2")>-1?a.replace("v2.2","v5"):a.indexOf("v2.1")>-1?a.replace("v2.1","v5"):a.replace("v3","v5"))),"updateRecord"===t&&(a=a.substr(0,a.lastIndexOf("/"))),"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),a},methodForRequest:function(e,t,i,r){return"PATCH"==e?"PUT":"action"==t&&r&&r.type?r.type:e}}),store.registerSerializer("related_list",{payloadKey:function(){return"related_lists"},serialize:function(e,t){return t.related_lists=[],t.related_lists[0]=t.related_list,delete t.related_list,t},normalizeResponse:function(e,t,i,r,a,s,o,n){return"updateRecord"==t&&(i.related_lists=i.related_lists[0].details),i.related_lists&&Array.isArray(i.related_lists)&&i.related_lists.forEach((function(e){var t,i,r=o&&o.module?o.module:"";if("Events_history"===e.api_name&&"EVENTSHISTORYPERSONALITY"===e.personality_name&&(e.api_name="Events_History"),"multiselectlookup"==e.type){var a=store.peekAll("field").filterBy({data_type:"multiselectlookup"}).filter((function(t){return t.multiselectlookup.api_name===e.api_name}))[0];a&&(e.mxnfield=a.id,i=a.api_name)}if(e.fields&&e.fields.length>0)if("multiselectlookup"==e.type){t=moduleRecordMapping[e.connectedmodule]?moduleRecordMapping[e.connectedmodule].id:void 0;var s=e.module.id;store.model[t]||store.registerModel(t,{},{extends:"entity"}),store.model[s]||store.registerModel(s,{},{extends:"entity"});var l=store.model[t],d=store.model[s];store.addField(s,i,Lyte.belongsTo(t)),(p={}).id=Lyte.attr("string");for(var c=(_=e.fields).length,u=0;u<c;u++)if(116==_[u].ui_type&&_[u].formula_return_type&&(_[u].formula={return_type:_[u].formula_return_type}),_[u].api_name.split(".").length>1){var m=_[u].api_name.split(".")[1];if(!l.fieldList[m])(y={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(_[u],r),y.fieldID=_[u].id,y.columnName=_[u].column_name,y.fieldType=_[u].data_type,y.displayLabel=_[u].display_label,y.isCustomField=_[u].custom_field,store.addField(t,m,y.type,y)}else if(!d.fieldList[_[u].api_name]){if("subform"!==_[u].data_type&&"static_subform"!==_[u].data_type)(y={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(_[u],r),y.fieldID=_[u].id,y.columnName=_[u].column_name,y.fieldType=_[u].data_type,y.displayLabel=_[u].display_label,y.isCustomField=_[u].custom_field,store.addField(s,_[u].api_name,y.type,y)}}else if(!e.api_name.includes("Chronological")){var p;t=e.module.id,(p={}).id=Lyte.attr("string");var _=e.fields;if(store.model[t]){c=_.length;var f=store.model[t];if(f)for(u=0;u<c;u++){var y;if(!f.fieldList[_[u].api_name])if(116==_[u].ui_type&&_[u].formula_return_type&&(_[u].formula={return_type:_[u].formula_return_type}),"subform"!==_[u].data_type&&"static_subform"!==_[u].data_type)(y={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(_[u],r),y.fieldID=_[u].id,y.columnName=_[u].column_name,y.fieldType=_[u].data_type,y.displayLabel=_[u].display_label,y.isCustomField=_[u].custom_field,store.addField(t,_[u].api_name,y.type,y)}}else{for(var c=_.length,u=0;u<c;u++)116==_[u].ui_type&&_[u].formula_return_type&&(_[u].formula={return_type:_[u].formula_return_type}),"subform"!==_[u].data_type&&"static_subform"!==_[u].data_type&&(p[_[u].api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(_[u],r)),p[_[u].api_name].fieldID=_[u].id,p[_[u].api_name].columnName=_[u].column_name,p[_[u].api_name].fieldType=_[u].data_type,p[_[u].api_name].displayLabel=_[u].display_label,p[_[u].api_name].isCustomField=_[u].custom_field);p.$state=Lyte.attr("string"),p.$transitionid=Lyte.attr("string"),store.registerModel(t,p,{extends:"entity"})}}!Lyte.Router.getRouteInstance()||("entity"!==Lyte.Router.getRouteInstance().parent.routeName||"canvas"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName)&&"views"!==Lyte.Router.getRouteInstance().routeName&&("canvas"!==Lyte.Router.getRouteInstance().parent.routeName||"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName&&"edit"!==Lyte.Router.getRouteInstance().routeName)||Lyte.registeredMixins["crm-detail-view-utils"].getRelatedListActions(e,objectUtils.getMatchedKey(moduleApiMapping,o.module),n?n.record:void 0),Crm.userDetails.isRelatedListLyteEnabled&&Lyte.Router.getRouteInstance()&&"entity"===Lyte.Router.getRouteInstance().parent.routeName&&"detail"===Lyte.Router.getRouteInstance().routeName&&"PROJECTSPERSONALITY"===e.personality_name&&Lyte.registeredMixins["crm-related-list-utils"].getProjectsRelatedList(e),o&&o.layout_id&&(e[o.layout_id]=Lyte.deepCopyObject(e))})),i}}),store.registerModel("entity",{type:Lyte.attr("string"),$approved:Lyte.attr("boolean"),$notes_view:Lyte.attr("array")},{actions:{count:{},grouped_counts:{},custom_buttons:{},related_lists:{},mass_actions:{},add_tags:{},available_actions:{},relatedListmap:{},mass_delete:{},fetchrelatedList:{},remove_tags:{},permit_threshold:{},change_owner:{},reasonForLoss:{},execute:{},blueprint:{},orchestrations:{},pathfinders:{},share:{},public_data:{},follow:{},data_privacy:{},consent_history:{},review_process:{},review_process_history:{},upcoming_actions:{},assign_territories:{},remove_territories:{},get_feature_specific_info:{},associated_territories_count:{},cpq_suggestions:{},cpq_logs_availability:{},convert:{},mass_convert:{},mass_update:{},portal_invite:{},deleted_record:{},related_records_count:{},merge:{},blueprint:{},abm_accounts:{},available_actions:{},pre_validate:{},timelines:{},journeys:{},ownership_history:{},picklist_tracker:{},review:{},approvals:{},record_modification:{},approval_details:{},get_related_records_count:{}}}),store.registerAdapter("entity",{namespace:"crm/v2.2",reloadAll:function(e,t){return!0},methodForRequest:function(e,t,i,r,a){return"convert"===a?"GET"===r.method?"GET":"POST":"consent_history"===a?"GET":"merge"===a&&"POST"===r.method?"POST":"blueprint"===a&&r&&"GET"===r.method||"associated_territories_count"===a||"get_feature_specific_info"===a||"cpq_suggestions"===a||"cpq_logs_availability"===a?"GET":("findAll"==t&&(e="POST"),r&&"Search"===r.type&&"Lookup"===r.from&&i&&i._child_data?"POST":r&&"Search"===r.type&&"Lookup"===r.from||"findAll"===t&&r&&r.isAbmModule?"GET":r&&r.type?r.type:"mass_convert"===a?"GET"===r.method?"GET":"POST":"mass_update"===a?"PUT":"action"==t?"count"==a||"pre_validate"===a||"approvals"===a?"POST":r&&r.type?r.type:"GET":("rlCount"===a&&(e="POST"),e))},buildURL:function(e,t,i,r,a,s,o){if(o&&o.cloneOnEdit&&-1!==a.indexOf("_cloneOnEdit")&&(a=a.replace("_cloneOnEdit","")),"assign_territories"!==s&&"remove_territories"!==s||(a=a.replace("v2.2","v8")),"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),"action"===t&&("associated_territories_count"===s||"get_feature_specific_info"===s))return a=a.replace(e,o.module),o&&o.version&&(a=a.replace("2.2",o.version)),a;if("cpq_suggestions"===s)return a=a.replace(e,o.module+"/"+o.entityId);if("cpq_logs_availability"===s)return a="/crm/v5/__internal/"+o.module+"/"+o.entityId+"/cpq_logs_availability";if("consent_history"===s)return a="/crm/v2/"+o.module+"/"+o.entityId+"/actions/consent_history";if("action"==t&&("add_tags"==s||"remove_tags"==s))return a=a.replace(e,o.module),o.hasOwnProperty("from")&&"list"===o.from&&"Bundles__s"!==o.module&&(a=a.replace("v2.2","v2.1")),a;if("abm_accounts"===s)return a.replace("v2.2/entity/actions/abm_accounts","v4/"+o.moduleApiName+"/"+o.recordId+"/ABM_Accounts");if("data_privacy"===s&&(a=a.replace("v2.2","v2.1")),"approval_details"===s){if(void 0!==o.name)"team_based"===(moduleRecordMapping[o.name]?moduleRecordMapping[o.name].access_type:"")&&(a=a.replace("v2.2","v7"));var n=o.module+"/"+o.entityId;return a=a.replace("entity",n)}if("review"===s){n=o.module+"/"+o.entityId;return a=a.replace("entity",n)}if("approvals"===s){if(i)(c={}).value=i.action&&"string"!=typeof i.action?JSON.stringify(i.action):i.action,Object.defineProperty(i,"_action",c);n=o.module+"/"+o.entityId;return a=(a=a.replace("v2.2","v2")).replace("entity",n)}if("timelines"===s&&!0===o.isFromApprovalProcess){if(i&&(i.filters||i.cross_filters))(c={}).value=i.filters&&"string"!=typeof i.filters?JSON.stringify(i.filters):i.filters,Object.defineProperty(i,"_filters",c),c.value=i.cross_filters&&"string"!=typeof i.cross_filters?JSON.stringify(i.cross_filters):i.cross_filters,Object.defineProperty(i,"_cross_filters",c);n=o.module+"/"+o.entityId;return a=(a=a.replace("v2.2","v5")).replace("entity/actions",n)}if(o&&o.apiVersion&&(a=a.replace("v2.2",o.apiVersion)),"share"==s){var l=o.module+"/"+o.entityId;return a=(a=a.replace(e,l)).replace("v2.2","v3"),"GET"==o.type&&null!=o.param&&(a+="?"+o.param),a}if("public_data"===s){l=o.module+"/"+o.entityId;return a=(a=a.replace(e,l)).replace("v2.2","v6"),"GET"===o.type&&void 0!==o.param&&(a+="?"+o.param),a}if("entity"===e&&"follow"===s){l=o.module+"/"+o.entityId;return a=a.replace(e,l)}if(void 0!==o&&"getRecordBasedTerritory"===o.action_name){l=o.module;return a=(a=a.replace("v2.2","v8")).replace(e,l)}if("convert"===s)return"GET"===o.method?(a=(a=a.replace("v2.2","v5")).replace("entity/actions/convert",moduleRecordMapping.Leads.api_name+"/"+o.id+"/__conversion_options"),i.include_inner_details="preference_field_matched_value.Accounts.unique,preference_field_matched_value.Contacts.unique"):a=(a=a.replace("v2.2","v5")).replace("entity/actions/convert",moduleRecordMapping.Leads.api_name+"/"+o.id+"/actions/convert"),a;if("mass_convert"===s)return a=(a=a.replace("v2.2","v7")).replace("entity",moduleRecordMapping.Leads.api_name);if("merge"===s)return a=(a=a.replace("entity/actions/merge",o.module+"/"+o.id+"/actions/merge")).replace("v2.2","v4");if("deleted_record"===s){var d=o.module;return a=(a=a.replace("entity/actions/deleted_record",d+"/deleted")).replace("v2.2","v2")}if("mass_update"===s)return a=a.replace("entity/actions/mass_update",o.module);if("available_actions"===s)return a=a.replace("entity/actions/available_actions",o.module+"/"+o.entityId+"/actions/available_actions");if("pre_validate"===s)return a=a.replace("entity",o.module);var c,u=store.peekRecord("module",e).api_name;if(o&&o.entityId&&(u=u+"/"+o.entityId),a=a.replace(e,u),null!=o&&null!=o.type&&"Search"==o.type&&(a+="/search","Lookup"!==o.from&&(a=a.replace("v2.2","v2")),i.criteria=o.criteria),"relatedListmap"==s&&o&&o.entityid&&o.relmodule){var m=moduleRecordMapping[o.relmodule].related_lists.filter((function(e){return e.id==o.listRelationId}))[0];if(m){var p=o.relmodule+"/"+o.entityid+"/"+m.api_name+"/"+o.newentityID;a=a.replace(u+"/actions/relatedListmap",p)}}if("fetchrelatedList"==s&&o&&o.entityid&&o.relapiname){var _="/"+o.entityid+"/"+o.relapiname;a=a.replace("/actions/fetchrelatedList",_)}if("change_owner"==s&&o&&o.entityid&&(a=a.replace("/actions/change_owner","/"+o.entityid+"/actions/change_owner")),"reasonForLoss"==s&&o&&o.loss&&(a=a.replace("actions/reasonForLoss",o.entity+"/Notes")),"mass_delete"==s&&(a="/crm/v2/"+u,i.ids=o.ids),"permit_threshold"===s&&(a=a.replace("/v2.2","/v2.1"),o.record_id&&(a=a.replace(u,u+"/"+o.record_id)),i.owner_id=o.owner_id),"blueprint"===s&&(a=a.replace("/v2.2","/v8"),o&&"GET"===o.type&&o.transitionId&&(a=a.replace("/blueprint","/blueprint/"+o.transitionId))),"custom_buttons"==s)o.isKioskBtn?(a=(a=a.replace("/v2.2","/v6")).replace("actions/custom_buttons","actions/execute_custom_buttons"),i.id=o.button_id):o.fromLux?(a=a.replace("/v2.2","/v7").replace("actions/custom_buttons","__internal/actions/custom_buttons"),a+="/"+o.button_id):a+="/"+o.button_id;else if("related_lists"===s&&o.fromLux)a=a.replace("/v2.2","/v7").replace("actions/related_lists","__internal/actions/related_lists"),a+="/"+o.relatedlist_id;else if("mass_actions"==s)a=a.replace("/"+s,""),i.cvid=o.cvid;else if("count"==s){for(var f in o&&o.version&&(a=a.replace("v2.2",o.version),delete o.version),o)"version"!==f&&(i[f]=o[f]);i["X-CRM-FEATURE-NAME"]&&delete i["X-CRM-FEATURE-NAME"],o.actionName="count"}else if("review_process"==s)a=a.replace("/"+s,"/review");else if("review_process_history"==s)a=a.replace("/"+s,"/history_review");else if("upcoming_actions"==s){var y=o.recordId;a=a.replace("actions/"+s,y+"/__"+s)}else if(["timelines","upcoming_actions","journeys","ownership_history","picklist_tracker"].contains(s)){y=o.recordId;if("timelines"==s)a=a.replace("actions/"+s,y+"/"+s);else if("picklist_tracker"==s){var g=o.trackingModule;a=a.replace("actions/"+s,y+"/"+g)}else a=a.replace("actions/"+s,y+"/__"+s);a="timelines"===s&&Crm.userDetails.isSubformTimelineUISupportEnabled&&Crm.userDetails.isSubformTimelineSupportEnabled?a.replace("v2.2","v7"):a.replace("v2.2","v5")}if("execute"===s&&(a=a.replace(a.slice(a.indexOf("/crm/"),a.indexOf("/actions")+1),"/crm/v2/functions/")),"findAll"==t&&(a+="/bulk"),"findAll"===t&&o&&"Search"===o.type&&"Lookup"===o.from&&(a=a.replace("/bulk","")),"findAll"===t&&o&&o.isAbmModule&&(a=a.replace("/bulk","")),i&&i.relationId&&i.relatedId&&store.peekRecord("related_list",i.relationId)&&("Competitors"===store.peekRecord("related_list",i.relationId).api_name?(a=(a=a.replace("bulk",""))+i.relatedId+"/Competitors",delete i.relationId,delete i.relatedId):"picklist_tracker"===store.peekRecord("related_list",i.relationId).action&&(a=(a=a.replace("bulk",""))+i.relatedId+"/"+store.peekRecord("related_list",i.relationId).api_name,delete i.relationId,delete i.relatedId),i&&i.relationId&&i.relatedId&&Crm.isActivitySplitDone)){var v=store.peekRecord("related_list",i.relationId).module,h=null;v&&v.api_name&&(h=v.api_name),void 0!==o&&"Chronological"===o.from&&(a=a.indexOf("v2.2")>-1?a.replace("v2.2","v5"):a.indexOf("v2.1")>-1?a.replace("v2.1","v5"):a.replace("v2","v5")),"Tasks"!==h&&"Events"!==h&&"Calls"!==h&&"Appointments"!==h||(a=a.indexOf("v2.2")>-1?a.replace("v2.2","v3"):a.indexOf("v2.1")>-1?a.replace("v2.1","v3"):a.replace("v2","v3"))}(i.fields&&(i.fields=i.fields.toString()),i&&(i.filters||i.cross_filters)&&!["timelines","upcoming_actions","journeys","ownership_history","picklist_tracker"].contains(s))&&((c={}).value=i.filters&&"string"!=typeof i.filters?JSON.stringify(i.filters):i.filters,Object.defineProperty(i,"_filters",c),c.value=i.cross_filters&&"string"!=typeof i.cross_filters?JSON.stringify(i.cross_filters):i.cross_filters,Object.defineProperty(i,"_cross_filters",c),delete i.filters,delete i.cross_filters);(i&&i.deleteAllUpcomingTaskFromDetailView&&(a=a.substring(0,a.lastIndexOf("/")),delete i.deleteAllUpcomingTaskFromDetailView),i&&i.child_data)&&(o&&o.type&&"Search"===o.type&&(a=a.replace("search","bulk/search")),(c={}).value=i.child_data,Object.defineProperty(i,"_child_data",c),delete i.child_data);if(o&&o.type&&o.module&&o.id&&(a=a+"/"+o.module+"/"+o.id),o&&o.cloneData&&(a+="/"+o.cloneData.parent_id+"/actions/clone"),o&&o.version&&(4===o.version&&(a=a.replace("v2.2","v4")),8===o.version&&(a=a.replace("v2.2","v8"))),o&&o.invRECORDSversion&&(a=a.replace("/v2.2/","/"+o.invRECORDSversion+"/")),"record_modification"===s&&(a=a.replace("v2.2/"+o.module,"v7/"+o.module+"/"+o.id)),"approval_details"===s){if(void 0!==o.name)"team_based"===(moduleRecordMapping[o.name]?moduleRecordMapping[o.name].access_type:"")&&(a=a.replace("v2.2","v7"));a=a.replace(o.module,o.module+"/"+o.id)}return"rlCount"===s&&(a=a.replace("v2.2","v4")),"Bundles"!==idModuleMapping[e]&&"LinkingModuleBundleRel"!==idModuleMapping[e]||(a=Crm.changeBundlesApiVersion(a,"v2.2")),a},headersForRequest:function(e,t,i,r){var a=this.$super.headersForRequest(e,t,i),s=Lyte.Router.getRouteInstance();if(s){var o=s.parent&&s.parent.routeName,n=s.routeName;(a&&"canvas"===o||"canvas"===n||"detailview"===n)&&(a["X-FEATURE"]="canvas"),a&&"custom-view"===o&&"count"===r&&i.fetchType&&(a["X-Request-Intent"]=i.fetchType)}return a&&(i&&(!0===i.businessCard&&"business_card"===t.apply_fields&&s&&"crm.tab.module.entity.detail"===s.transition.info.route&&(delete t.fields,a["X-ZOHO-SERVICE"]="crm/lookupTooltip"),"merge"===i.from&&(a["X-ZOHO-SERVICE"]="crm/deduplication"),i["X-CRM-FEATURE-NAME"]&&(a["X-CRM-FEATURE-NAME"]=i["X-CRM-FEATURE-NAME"])),!a.Range&&i&&i.subformNavigation&&(a.Range=i.subformNavigation),i&&i.businessCard&&(a["X-ZOHO-SERVICE"]="crm/lookupTooltip")),a},parseResponse:function(e,t,i,r){return 204==i.status&&((r=this.super(arguments)).info={},"function"==typeof i.getResponseHeader&&i.getResponseHeader("empty_resource")?r.info.show_begin_page="true"==i.getResponseHeader("empty_resource"):i.headers&&i.headers.empty_resource&&(r.info.show_begin_page="true"==i.headers.empty_resource),"function"==typeof i.getResponseHeader&&i.getResponseHeader("webform_approval_records")?r.info.data_waiting_for_approval="true"==i.getResponseHeader("webform_approval_records"):i.headers&&i.headers.webform_approval_records&&(r.info.data_waiting_for_approval="true"==i.headers.webform_approval_records)),r}}),store.registerSerializer("entity",{preserveTypes_CEC:["date","datetime","multi-picklist","phone","time-in-hrs","time-in-minutes","tax"],serializeKey:function(e,t,i){if(void 0===i||i&&"convert"!==i.action&&"mass_convert"!==i.action&&"mass_update"!==i.action&&"merge"!==i.action)return"data"},normalize:function(e,t,i){if("findAll"===t){var r=store.peekRecord(e,i.id);if(r&&r.$.isDirty()){var a=r.$.getDirtyAttributes()[0],s=r[a],o=store.modelFor(e);o&&o.fieldList&&o.fieldList[a]&&"relation"===o.fieldList[a].type&&r[a]&&r[a].mapBy&&(s=r[a].mapBy("id")),i[a]=s}}for(var n=Object.keys(i),l=n.length,d=0;d<l;d++)n[d].indexOf(".")>-1&&delete i[n[d]];return i},serialize:function(e,t,i,r,a,s,o){if(r&&(r.cloneOnEdit&&(this.setDirtyOriginalValuesToCloneOnEditObj(t,a),t.data=this.stripCloneOnEditInfo(t.data,a)),r.skipblocklistValidation&&(t.escape_blocklist=!0)),"findAll"===e||"action"===e&&("count"===o||"grouped_counts"===o)){t=t||new FormData;var n=s&&s._filters?s._filters:r&&r.filters?r.filters:void 0;n&&(n=n&&"string"!=typeof n?JSON.stringify(n):n,t.append("filters",n));var l=s&&s._cross_filters?s._cross_filters:r&&r.cross_filters?r.cross_filters:void 0;l&&(l=l&&"string"!=typeof l?JSON.stringify(l):l,t.append("cross_filters",l));var d=s&&s._child_data?s._child_data:void 0;return d&&(d=JSON.stringify(d),t.append("child_data",d)),t}if(r&&("single_ajax_edit"===r.feature||"canvas_ajax_edit"===r.feature)){if((i.$.getDirtyAttributes()||[]).forEach((function(e){if("multi-user"===i.$.model.fieldList[e].type){var r=[],a=[],s=i.$.undoStack[e][0].val?i.$.undoStack[e][0].val.users:[],o=i[e]?i[e].users:[],n={},l=store.peekRecord("field",i.$.model.fieldList[e].fieldID).multiuserlookup.connectedlookup_apiname;s.filter((function(e){a.push(e[l].id),n[e[l].id]=e.id}));for(var d={},c=[],u=o.length,m=0;m<u;m++)r.push(o[m][l].id),a.includes(o[m][l].id)||(d[l]={id:o[m][l].id},c.push(d),d={});a.diff(r).filter((function(e){c.push({id:n[e],_delete:"null"})})),t.data[e]=c}else if("tax"===i.$.model.fieldList[e].type)if(delete t.data.id,t.data[e]){var p,_=store.peekAll("field").filter((function(e){return"Tax"===e.api_name}))[0].pick_list_values,f=_.length,y=t.data[e].split(";"),g=y.length;t.data.Tax=[];for(var v=0;v<g;v++){for(var h=0;h<f;h++)_[h].display_value===y[v]&&(p=_[h]);var b={};b.id=p.id,b.value=p.display_value,t.data.Tax.push(b)}}else t.data.Tax="";else t.data&&t.data.hasOwnProperty(e)&&void 0===t.data[e]&&(t.data[e]="")})),i&&i.folAddDirtyAttr&&i.folAddDirtyAttr.length>0){for(var c=i.folAddDirtyAttr,u=c.length,m=0;m<u;m++){j=void 0===(j=i[c[m]])?"":i.folNullValue[m],t.data[c[m]]=j}delete i.folAddDirtyAttr}if(i&&i.folNullValue&&i.folNullValue.length>0){var p=i.folNullValue,_=p.length;for(m=0;m<_;m++)t.data[p[m]]="";delete i.folNullValue}}if("share"==o&&r)return r.share;if(r&&r.$se_module&&(t.data.$se_module=r.$se_module),"add_tags"===o||"remove_tags"===o||"custom_buttons"===o){if(r.isKioskBtn&&!t){t={};var f=[],y={record_ids:r.ids,page_info:null,fields_info:null};f.push(y),t.execute_custom_button=f}if(t&&t.related_list_ids){var g=t.related_list_ids.split(",");t={},r.isKioskBtn||(t.custom_buttons=[],t.custom_buttons.push({related_list_ids:g}))}else{if(("add_tags"===o||"remove_tags"===o)&("list"!==r.from||"Bundles__s"===r.module))return r.tag_names;if(r&&r.fromForm){var v={};return v.custom_buttons=r.custom_buttons,r.cascadedResponse&&(v.cascadedResponse=r.cascadedResponse),v}r.isKioskBtn||(t=new FormData,r&&r.ids&&t.append("ids",r.ids),t.append("tag_names",r.tag_names)),null!=r.over_write&&t.append("over_write",r.over_write)}}else{if("portal_invite"===o)return t;if("destroyRecord"!==e&&"create"!==e&&t&&"convert"!==o&&"mass_convert"!==o&&"mass_update"!==o&&"merge"!==o&&"pre_validate"!==o&&"get_related_records_count"!==o){if(i.$se_module&&t.data&&(t.data.$se_module=i.$se_module),r&&r.$lookupFilterEditData)for(let e in r.$lookupFilterEditData)Crm.curr_sub_Form_DetailS&&-1===Crm.curr_sub_Form_DetailS.apiNames.indexOf(e)&&(t.data[e]=r.$lookupFilterEditData[e]);if(r&&r.cloneData){var h={};for(var b in r.cloneData.dataToSend){var L=store.modelFor(a).fieldList[b];L&&"multiuserlookup"===L.fieldType&&!t.data[b]?h[b]=[]:h[b]=t.data[b]}t.data=[h]}else t.data=[t.data];var R=store.peekRecord("module",i.$.model._name),C=R?"crm-create-layout#"+R.module_name+"LC_layoutNode":"",w=$L(C)[0];function S(e,t,i,r){e.data[0][t].length?e.data[0][t].forEach((function(e){var t;if(!r&&Crm.userDetails.SUBFORM_PERMISSIONS){var a=store.peekRecord(i,e.id);t=a&&!a.$.isNew?a.$.getInitialValues():[]}for(var s in e)e[s]=void 0===e[s]?null:e[s],!t||null!==t[s]||null!==e[s]&&void 0!==e[s]&&""!==e[s]||delete e[s]})):e.data[0][t]=null}if(w=Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()?$L("crm-canvas-form")[0]:w){if(t.skip_mandatory=w.component.data.skipMandatory,r&&r.skipblocklistValidation&&(t.escape_blocklist=!0),t.data[0].hasOwnProperty("__DUMMY_Request_Trigger__FIELD")&&delete t.data[0].__DUMMY_Request_Trigger__FIELD,r&&r.hasOwnProperty("skipPricingDtlsInPayload")){var T=r.pricingDetApiName||"Pricing_Details";r.skipPricingDtlsInPayload&&delete t.data[0][T]}if("createRecord"==e||"create"==e||"updateRecord"==e){r.emptyTrigger&&(t.trigger=[]);var I=t.data[0].$state&&"draft"===t.data[0].$state;if(I)for(var k in t.skip_mandatory=I,i.$.error)i.$.error.hasOwnProperty(k)&&"ERR02"===i.$.error[k].code&&(t.data[0][k]=null);var D=w.component.data.currsubformApinames&&w.component.data.currsubformApinames.length>0?w.component.data.currsubformApinames:Crm.curr_sub_Form_DetailS?Crm.curr_sub_Form_DetailS.apiNames:w.component.data.currsubformApinames;for(var A in D&&D.length&&D.forEach((function(e){var i=t.data[0][e];i&&i.forEach((function(e){delete e.__CUSTOM_sequence_NUMBER__}))})),t.data[0])null==t.data[0][A]&&(t.data[0][A]=null);var E=store.modelFor(a),P=E&&E.fieldList&&E.fieldList.Tax;if(P&&(96===P.uiType||"tax"===P.type)&&"TAX"===P.columnName&&t.data[0].hasOwnProperty("Tax")){var M=[],O=t.data[0].Tax;(O=O&&"string"==typeof O?JSON.parse(O):O)&&O.length?(O.forEach((function(e){var t={id:null};t.value=e,M.push(t)})),t.data[0].Tax=M):t.data[0].Tax=[]}if(E&&E.fieldList){var x=E.fieldList;["Zip_Code","Mailing_Zip","Other_Zip","Zip_Code","Billing_Code","Shipping_Code"].forEach((function(e){var i=x[e];if(i&&-1!=="CODE,MAILINGZIP,OTHERZIP,ZIPCODE,BILLINGCODE,SHIPPINGCODE".indexOf(i.columnName)&&t.data[0].hasOwnProperty(e)){var r=t.data[0][e];if(r&&"string"==typeof r){var a=r.replace(/[~`#%^&*()+={}[\]|\;"<>\\]/g,"");t.data[0][e]=a}}}))}function U(e){return!e||0===e.filter((function(e){return!e.hasOwnProperty("_delete")})).length}function N(e,t){var i,r=[];return e.forEach((function(e){i||(i=Object.keys(e)),i.forEach((function(i){t[i]&&Lyte.Transform[t[i].type]&&(e[i]=Lyte.Transform[t[i].type].serialize(e[i]))})),r.push(e)})),r}function S(e,t,i){e.data[0][t].length?e.data[0][t].forEach((function(e){var t;if(Crm.userDetails.SUBFORM_PERMISSIONS){var r=store.peekRecord(i,e.id);t=r&&!r.$.isNew?r.$.getInitialValues():{}}for(var a in e)e[a]=void 0===e[a]?null:e[a],!t||null!==t[a]||null!==e[a]&&void 0!==e[a]&&""!==e[a]||delete e[a]})):e.data[0][t]=null}if(Crm.curr_sub_Form_DetailS&&Crm.userDetails.isSubformNewComponentEnabled){Crm.curr_sub_Form_DetailS.subRecDetails={},Crm.curr_sub_Form_DetailS.modulesData={};var F=!!i&&i.$.getDirtyAttributes().contains("Currency");Crm.curr_sub_Form_DetailS.apiNames.forEach(function(e){var a=[];if(t.data[0][e]){var s=i[e],o=t.data[0][e],n=s.model._name,l=s.model.fieldList,d=[],c=[];s=[];var u={},m={},p={};r&&(u=r.subformVsCachedRowIds,m=r.subformVsRemovedRowIds,p=r.subformVsNewRowIds),u[e].forEach((function(t){if(-1===m[e].indexOf(t)){var i=store.peekRecord(n,t).$.toJSON();s.push(i)}})),moduleDetailedInfo.modules.forEach((function(t){t.api_name===e&&(Crm.curr_sub_Form_DetailS.modulesData[e]=store.peekRecord("module",t.id))}));var _=Crm.curr_sub_Form_DetailS.modulesData&&Crm.curr_sub_Form_DetailS.modulesData[e]&&Crm.curr_sub_Form_DetailS.modulesData[e].editable;s.forEach((function(e){var t=!1,i=store.peekRecord(n,e.id),r=i.$.getDirtyAttributes();for(var s in l)l[s].fieldID&&-1===["SERIAL_NUMBER","SMCREATORID","CREATEDTIME"].indexOf(l[s].columnName)&&"formula"!==l[s].fieldType&&(e[s]="string"==typeof e[s]?e[s]&&"[]"===e[s]?"":e[s].trim():e[s],((e[s]||0===e[s])&&"picklist"!==l[s].fieldType&&"fileupload"!==l[s].fieldType||e[s]&&"picklist"===l[s].fieldType&&"-None-"!==e[s]||"fileupload"===l[s].fieldType&&!U(e[s]))&&(t="true"!==e.removedRow&&1!=i.$dummyRow)),Crm.userDetails.SUBFORM_PERMISSIONS&&!I&&!_&&!i.$.isNew&&l[s].fieldID&&("formula"===l[s].fieldType||F&&"currency"===l[s].fieldType||"SERIAL_NUMBER"===l[s].columnName)&&r.contains(s)&&delete o.find((function(t){return e.id===t.id}))[s];t&&(d.push(e),e.id&&a.push(e.id)),c.push({isValid:t,id:e.id})}));var f=[],y="crm-create-subformsection#"+R.module_name+"_SubForm_"+e,g=w.querySelector(y),v=[];g&&(g.component.setData("cacheRecordIds",a),v=g.component.getData("newRecordIds")),c.forEach((function(i){if(!i.isValid){f.push(i.id),store.unloadRecord(t.data[0][e].$._model,i.id);var r=v.indexOf(i.id);-1!==r&&Lyte.arrayUtils(v,"remove",r)}})),g&&g.component.setData("newRecordIds",v),d=N(d,l);var h=[];if(Crm.curr_sub_Form_DetailS.orgSubformData&&Crm.curr_sub_Form_DetailS.orgSubformData[e])for(var b=Crm.curr_sub_Form_DetailS.orgSubformData[e].filter((function(t){return-1===f.indexOf(t.id)&&(m[e]&&m[e].contains(t.id)||!a.contains(t.id))})),L=b&&b.length?b.length:0,C=0;C<L;C++){var T={id:b[C].id,_delete:null};h.push(b[C].id),d.push(T)}g&&h.length>0&&g.component.setData("removedRowIds",h);var k=[],D=0;this.subformApiNameVsRecIndices=this.subformApiNameVsRecIndices?this.subformApiNameVsRecIndices:{},this.sfPartialPayLoadRecIds=this.sfPartialPayLoadRecIds?this.sfPartialPayLoadRecIds:{},this.sfPartialPayLoadRecIds[e]=t.data[0][e].mapByKey("$"),this.sfPartialPayLoadRecIds[e]&&this.sfPartialPayLoadRecIds[e].length>0&&(this.sfPartialPayLoadRecIds[e]=this.sfPartialPayLoadRecIds[e].mapByKey("pK")),this.sfPartialPayLoadRecIds[e]&&0!==this.sfPartialPayLoadRecIds[e].length||(this.sfPartialPayLoadRecIds[e]=t.data[0][e].mapByKey("id"));var A=[];d.forEach((function(i,a){var s=!1;t.data[0][e].forEach((function(e){if(e.$.pK===i.id&&A.push(a),e.id===i.id)return s=!0,void(i.hasOwnProperty("_delete")||(i=e))})),(r&&r.cloneData||p&&-1!==p[e].indexOf(i.id))&&delete i.id,s||!i.hasOwnProperty("id")?k[D]=i:i.hasOwnProperty("_delete")?(k[D]={id:i.id},k[D]._delete=i._delete):(k[D]={id:i.id},i.hasOwnProperty("_delete")&&(k[D]._delete=i._delete)),D++})),this.subformApiNameVsRecIndices[e]=A,t.data[0][e]=k,S(t,e,n),Crm.curr_sub_Form_DetailS.subRecDetails[e]=c}else if(!t.data[0][e]&&i[e]&&i[e].length>0){var E=i[e];if(r&&r.cloneData&&r.cloneData.dataToSend&&!r.cloneData.dataToSend[e]){var P=[];n=E.model._name;E.forEach((function(e){P.push(e.id)})),P.forEach((function(e){store.unloadRecord(n,e)})),t.data[0][e]=null}else{l=E.model.fieldList;var M=[];E.forEach((function(e){var t=!1;for(var i in l)l[i].fieldID&&"SERIAL_NUMBER"!==l[i].columnName&&"formula"!=l[i].fieldType&&(e[i]="string"==typeof e[i]?e[i]&&"[]"==e[i]?"":e[i].trim():e[i],((e[i]||0===e[i])&&"picklist"!==l[i].fieldType&&"fileupload"!==l[i].fieldType||e[i]&&"picklist"===l[i].fieldType&&"-None-"!==e[i]||"fileupload"===l[i].fieldType&&!U(e[i]))&&(t="true"!==e.removedRow));t&&M.push({id:e.id})})),t.data[0][e]=M}}}.bind(this))}else if(Crm.curr_sub_Form_DetailS&&!Crm.userDetails.isSubformNewComponentEnabled){Crm.curr_sub_Form_DetailS.subRecDetails={},Crm.curr_sub_Form_DetailS.modulesData={};F=!!i&&i.$.getDirtyAttributes().contains("Currency");Crm.curr_sub_Form_DetailS.apiNames.forEach(function(e){var a=[];if(t.data[0][e]){var s=i[e],o=t.data[0][e],n=s.model.fieldList,l=[],d=[];moduleDetailedInfo.modules.forEach((function(t){t.api_name===e&&(Crm.curr_sub_Form_DetailS.modulesData[e]=store.peekRecord("module",t.id))}));var c=Crm.curr_sub_Form_DetailS.modulesData&&Crm.curr_sub_Form_DetailS.modulesData[e]&&Crm.curr_sub_Form_DetailS.modulesData[e].editable;s.forEach((function(i,r){var s=!1,u=i.$.getDirtyAttributes();for(var m in n)n[m].fieldID&&!["SERIAL_NUMBER","LINETAX"].contains(n[m].columnName)&&"formula"!==n[m].fieldType&&(i[m]="string"==typeof i[m]?i[m]&&"[]"==i[m]?"":i[m].trim():i[m],((i[m]||0===i[m])&&"picklist"!==n[m].fieldType&&"fileupload"!==n[m].fieldType||i[m]&&"picklist"===n[m].fieldType&&"-None-"!==i[m]||"fileupload"===n[m].fieldType&&!U(i[m]))&&(s="true"!==i.removedRow&&1!=i.$dummyRow)),Crm.userDetails.SUBFORM_PERMISSIONS&&!I&&!c&&!i.$.isNew&&n[m].fieldID&&("formula"===n[m].fieldType||F&&"currency"===n[m].fieldType)&&u.contains(m)&&delete o.find((function(e){return i.id===e.id}))[m];s&&(l.push(Crm.userDetails.FIELD_OF_LOOKUP_IN_SUBFORM||Crm.userDetails.SUBFORM_PERMISSIONS?i.$.toJSON():t.data[0][e][r]),a.push(i.id)),d.push({isValid:s,id:i.id})}));var u=[];if(d.forEach((function(i){i.isValid||(u.push(i.id),store.unloadRecord(t.data[0][e].$._model,i.id))})),Crm.curr_sub_Form_DetailS.orgSubformData&&Crm.curr_sub_Form_DetailS.orgSubformData[e])for(var m=Crm.curr_sub_Form_DetailS.orgSubformData[e].filter((function(e){return-1===u.indexOf(e.id)&&!a.contains(e.id)})),p=m&&m.length?m.length:0,_=0;_<p;_++){var f={id:m[_].id,_delete:null};l.push(f)}if(Crm.userDetails.FIELD_OF_LOOKUP_IN_SUBFORM||Crm.userDetails.SUBFORM_PERMISSIONS){var y=[],g=0,v=void 0!==r.subformVsNewRowIds?r.subformVsNewRowIds:[];l=N(l,n),this.subformApiNameVsRecIndices=this.subformApiNameVsRecIndices?this.subformApiNameVsRecIndices:{},this.subformDeletedRowIds=this.subformDeletedRowIds?this.subformDeletedRowIds:{},this.subformModRowType=this.subformModRowType?this.subformModRowType:{};var h=[];this.sfPartialPayLoadRecIds=this.sfPartialPayLoadRecIds?this.sfPartialPayLoadRecIds:{},this.sfPartialPayLoadRecIds[e]=t.data[0][e].mapByKey("$"),this.sfPartialPayLoadRecIds[e]&&this.sfPartialPayLoadRecIds[e].length>0&&(this.sfPartialPayLoadRecIds[e]=this.sfPartialPayLoadRecIds[e].mapByKey("pK")),this.sfPartialPayLoadRecIds[e]&&0!==this.sfPartialPayLoadRecIds[e].length||(this.sfPartialPayLoadRecIds[e]=t.data[0][e].mapByKey("id")),l.forEach((function(i,r){var a=!1;t.data[0][e].forEach((function(e){if(e.$.pK===i.id&&h.push(r),e.id===i.id)return i.hasOwnProperty("_delete")||(i=e),void(a=!0)})),a||v&&v[e]&&-1!==v[e].indexOf(i.id)?(v&&v[e]&&-1!==v[e].indexOf(i.id)&&delete i.id,y[g]=i):i.hasOwnProperty("_delete")?(y[g]={id:i.id},y[g]._delete=i._delete):(y[g]={id:i.id},i.hasOwnProperty("_delete")&&(y[g]._delete=i._delete)),g++})),this.subformApiNameVsRecIndices[e]=h,t.data[0][e]=y,S(t,e,s.model._name)}else l.length?(l.forEach((function(e){for(var t in e)e[t]=null==e[t]?null:e[t]})),t.data[0][e]=l):t.data[0][e]=null;Crm.curr_sub_Form_DetailS.subRecDetails[e]=d}else if((Crm.userDetails.FIELD_OF_LOOKUP_IN_SUBFORM||Crm.userDetails.SUBFORM_PERMISSIONS)&&!t.data[0][e]&&i[e]&&i[e].length>0&&!r.cloneData){var b=i[e],L=(n=b.model.fieldList,[]);b.forEach((function(e){var t=!1;for(var i in n)n[i].fieldID&&"SERIAL_NUMBER"!==n[i].columnName&&"formula"!=n[i].fieldType&&(e[i]="string"==typeof e[i]?e[i]&&"[]"==e[i]?"":e[i].trim():e[i],((e[i]||0===e[i])&&"picklist"!==n[i].fieldType&&"fileupload"!==n[i].fieldType||e[i]&&"picklist"===n[i].fieldType&&"-None-"!==e[i]||"fileupload"===n[i].fieldType&&!U(e[i]))&&(t="true"!==e.removedRow));t&&L.push({id:e.id})})),L.length&&(t.data[0][e]=L,t.data[0][e].forEach((function(e){for(var t in e)e[t]=void 0===e[t]?null:e[t]})))}}.bind(this))}if(t&&t.data&&t.data[0]){for(var z in t.data[0]){var j;(j=t.data[0][z])&&"string"==typeof j&&(j=j.trim(),t.data[0][z]=j)}if(r&&r.skipUnChangedFieldsInPUTApi&&Object.keys(r.skipUnChangedFieldsInPUTApi).length>0)Object.keys(r.skipUnChangedFieldsInPUTApi).forEach((function(e){t.data[0].hasOwnProperty(e)||(t.data[0][e]=r.skipUnChangedFieldsInPUTApi[e])}));if(r&&r.subformVsPopulateSFUnChangedFOLInPUTApi&&Object.keys(r.subformVsPopulateSFUnChangedFOLInPUTApi).length>0)Object.keys(r.subformVsPopulateSFUnChangedFOLInPUTApi).forEach((function(e){if(t.data[0].hasOwnProperty(e)&&t.data[0][e]&&t.data[0][e].length>0&&r.subformVsPopulateSFUnChangedFOLInPUTApi[e]&&Object.keys(r.subformVsPopulateSFUnChangedFOLInPUTApi[e]).length>0){var i=r.subformVsPopulateSFUnChangedFOLInPUTApi[e];t.data[0][e].forEach((function(e){if(e.id){var t=e.id,r=i[t];r&&Object.keys(r).length>0&&Object.keys(r).forEach((function(t){e[t]=r[t]}))}}))}}));if(r&&r.$lookupFilterEditData)for(let e in r.$lookupFilterEditData)!Crm.curr_sub_Form_DetailS||-1===Crm.curr_sub_Form_DetailS.apiNames.indexOf(e)||$.isEmptyObject(r.$lookupFilterEditData[e])||$.isEmptyObject(t.data[0][e])||t.data[0][e].forEach((function(t){var i=r.$lookupFilterEditData[e][t.id];if(t.id&&i)for(let e in i)t[e]=i[e]}))}}}else if(r&&r.subformAPIName){var V=this,q=r.subformAPIName,B=r[q],H=B&&B.cxSubformEdit&&B.cxFilterData?B.cxFilterData:{};if(B&&B.isDetailView){t.data[0][q]||(t.data[0][q]=[]);var K=t.data[0][q],Y=K[0]?K[0]:{id:Object.keys(H)[0]};if(B.records){var J=[],G=B.cxSubformCreate?Y.$.pK:Y.id;B.records.forEach((function(e,t){var i,r=e.id;G!==r?i={id:r}:(V.currentRecIndex=t,i=Y);var a=H[r]?H[r]:{};for(var s in a)i[s]=a[s];J.push(i)})),B.cxSubformDelete&&(Y._delete=null,J.push(Y)),t.data[0][q]=J;var Z=objectUtils.getMatchedKey(moduleApiMapping,q);Z&&moduleRecordMapping[Z]&&S(t,q,moduleRecordMapping[Z].id)}}}}}if("relatedListmap"==o)return{data:[{linkRelatedlist:!0}]};if("reasonForLoss"==o&&r)return{data:[{Note_Content:r.loss,Note_Title:r.stage}]};if("execute"==o&&r&&r.jsonData)return{functions:r.jsonData};if("blueprint"==o&&r)return{blueprint:r.blueprint};if("change_owner"===o&&r&&r.qParams){var W={},X=r.qParams;return W.owner={id:X.owner_id},W.notify=X.notify,X.related_modules&&X.related_modules.length?W.related_modules=X.related_modules:W.related_modules=[],W}if(r&&r.saveJobSheets){var Q,ee=t.data[0],te=r.sectionName,ie=r.LayoutId,re=store.peekRecord("layout",ie).sections,ae=re.length,se=!1;for(m=0;m<ae;m++)if(re[m].name===te){for(var oe=re[m].fields.length,ne=0;ne<oe;ne++){var le=re[m].fields[ne].api_name;if(ee[le]){se=!0;break}!Q&&i[le]&&(Q=le)}break}!se&&Q&&(ee[Q]=i[Q])}r&&r.sendNotificationEmail&&((ee=t.data[0])[r.sendNotificationApiName]=!0);return r&&r.editedMembersValue&&(t.data[0].Members=r.editedMembersValue),r&&r.cloneOnEdit&&t.data.forEach(function(e,i){t[i]=this.stripCloneOnEditInfo(e,a)}.bind(this)),t},payloadKey:function(e,t,i,r,a){return void 0!==a&&"convert"===a.action?"__conversion_options":e},normalizeResponse:function(e,t,i,r,a,s,o,n){i.data&&i.data.forEach((function(e,t){e.hasOwnProperty("transition")&&(e.id=e.transition.id+t),e.hasOwnProperty("$approval_state")&&!e.hasOwnProperty("$approved")&&("approved"===e.$approval_state||"review_process_pending"===e.$approval_state||"review_process_rejected"===e.$approval_state||"merge_pending"===e.$approval_state?e.$approved=!0:e.$approved=!1)}));var l=["date","datetime","multi-picklist","phone","time-in-hrs","time-in-minutes","tax"];if("createRecord"==t||"create"==t||"updateRecord"==t){var d,c=!0,u={};if(u[e]={},u[e]=i.data[0].details,"updateRecord"===t&&o&&!0===o.affected_data_new&&u[e]&&u[e].affected_data&&u[e].affected_data[0]){c=!1;var m,p=store.peekRecord(e,u[e].id),_=store.peekRecord(e,r);if(p.$formatted_currency&&u[e].affected_data[0].$formatted_currency){var f=p.$formatted_currency;Object.assign(f,u[e].affected_data[0].$formatted_currency),u[e].affected_data[0].$formatted_currency=f}if(p.$home_converted_currency&&u[e].affected_data[0].$home_converted_currency){f=p.$home_converted_currency;Object.assign(f,u[e].affected_data[0].$home_converted_currency),u[e].affected_data[0].$home_converted_currency=f}if(void 0!==p.$process_flow&&void 0!==u[e].affected_data[0].$process_flow){f=p.$process_flow;m=u[e].affected_data[0].$process_flow,u[e].affected_data[0].$process_flow=f}var y=i.data[0].details.affected_data[0];Object.assign(u[e],y);var g=n?n.record_dirty_props:void 0,v=p._$.original;u[e].Modified_Time&&(v.Modified_Time=u[e].Modified_Time);var h=store.modelFor(e).fieldList,b=Object.keys(y);if(g)for(var L=g.length,R=0;R<L;R++){var C=g[R];u[e].id!==r&&-1===b.indexOf(C)&&(u[e][C]=_[C]);var w=h[C].type;if(v&&l.indexOf(w)>-1)switch(w){case"date":v[C]=Lyte.Transform.date.serialize(_[C]);break;case"datetime":u[e][C]=Lyte.Transform.datetime.serialize(_[C]),v[C]=u[e][C];break;case"multi-picklist":u[e][C]=Lyte.Transform["multi-picklist"].serialize(_[C]),v[C]=u[e][C];break;case"tax":var S=_[C];if(S)try{v[C]=JSON.parse(S)}catch(e){v[C]=S.split(";")}else v[C]=[];for(var T=[],I=store.peekRecord("field",h[C].fieldID).pick_list_values,k=I.length,D=v[C].length,A=0;A<D;A++){for(var E,P=v[C][A],M=0;M<k;M++){var O=I[M];if(O.display_value===P){(E={}).id=O.id,E.value=O.display_value;break}}E||((E={}).id=null,E.value=P),T.push(E)}v[C]=T,u[e][C]=T;break;case"phone":v[C]=_[C]}if("currency"===h[C].fieldType){var x=_[C];if(null==x){var U=p.$formatted_currency;U&&(delete U[C],Object.assign(u[e],{$formatted_currency:{}}),Object.assign(u[e].$formatted_currency,U)),(U=p.$home_converted_currency)&&(delete U[C],Object.assign(u[e],{$home_converted_currency:{}}),Object.assign(u[e].$home_converted_currency,U))}}}this.updateDetailsForServerUpdatedFields(y,b,v,u,e,l)}if(Crm.curr_sub_Form_DetailS){var N=function(e,t,i){var r=objectUtils.getMatchedKey(moduleApiMapping,e);if(!r&&t){var a=t.fields.filterBy({api_name:e}),s=a?a[0].subform.module:void 0;r=objectUtils.getMatchedKey(moduleApiMapping,s)}var o=moduleRecordMapping[r],n="crm-create-subformsection#"+o.parent_module.api_name+"_SubForm_"+o.api_name,l=$L(n)[0];if(l){var d=l.component,c=d.getData("cacheRecordIds"),u=d.getData("removedRowIds"),m=d.getData("newRecordIds");objectUtils.getKeys(i).forEach((function(e){var t=c.indexOf(e);-1!==t&&(c[t]=i[e],-1!==u.indexOf(e)&&Lyte.arrayUtils(u,"remove",u.indexOf(e),1),-1!==m.indexOf(e)&&Lyte.arrayUtils(m,"remove",m.indexOf(e),1))})),d.setData("cacheRecordIds",c),d.setData("removedRowIds",u),d.setData("newRecordIds",m),Crm.subformVsRemovedRowIds[e]=u,Crm.subformVsCachedRowIds[e]=c,Crm.subformVsNewRowIds[e]=m}},F=(p=store.peekRecord(e,r),Crm.curr_sub_Form_DetailS.apiNames);F.forEach(function(t){var i=p?p[t]:void 0,r=n&&n.wizardButtonRecord&&(n.wizardButtonRecord.transition&&n.wizardButtonRecord.transition.Id||"custom_button"===n.wizardButtonRecord.category),a=Crm.curr_sub_Form_DetailS.subRecDetails?Crm.curr_sub_Form_DetailS.subRecDetails[t]:void 0;if(u[e][t]&&r&&(Crm.curr_sub_Form_DetailS.hasOwnProperty("orgSubformData")||(Crm.curr_sub_Form_DetailS.orgSubformData={}),Crm.curr_sub_Form_DetailS.orgSubformData[t]=[],u[e][t].forEach((function(e){Crm.curr_sub_Form_DetailS.orgSubformData[t].push({id:e.id})}))),a&&a.length){var s=[],o=0;if(i&&i.length>0){u[e][t]&&u[e][t].length?s=JSON.parse(JSON.stringify(u[e][t])):u[e][t]=[];var l={};if(i.forEach((function(i,n){var d=a[n];if(d&&!d.isValid)u[e][t][n]={id:i.id,__dummySubformId__set:!0};else{if(i&&i.__dummySubformId__set&&delete i.__dummySubformId__set,s[o]){r&&(l[i.id]=s[o].id),u[e][t][n]={id:s[o].id};var c=$L("crm-create-layout")[0],m=$L("crm-canvas-form")[0];!c&&m&&(c=m);var p=i.id;if(c&&c.component.data.fileuploadFieldsData){delete c.component.data.fileuploadFieldsData[t][p];var _=s[o];c.component.data.moduleData.fields.filter((e=>e.api_name===t))[0].section[0].fields.filter((e=>"fileupload"===e.data_type)).forEach((e=>{var r=Lyte.registeredMixins["crm-uploadfields-mixin"].getFileDataInCruxFormat(_[e.api_name]),a=c.component.data.fileuploadFieldsData[t];a||(a={}),a[_.id]||(a[_.id]={}),0===r.length?(a[_.id][e.api_name]=[],i[e.api_name]&&delete i[e.api_name]):(a[_.id][e.api_name]=r,i[e.api_name]=_[e.api_name])}))}}o++}})),(Crm.userDetails.isSubformNewComponentEnabled||Crm.userDetails.FIELD_OF_LOOKUP_IN_SUBFORM||Crm.userDetails.SUBFORM_PERMISSIONS)&&this.sfPartialPayLoadRecIds&&this.sfPartialPayLoadRecIds[t]&&this.sfPartialPayLoadRecIds[t].length>0){var d=[];this.sfPartialPayLoadRecIds[t].forEach(function(e){d.push({id:l[e]?l[e]:e})}.bind(this)),u[e][t]=d}}}if(Crm.userDetails.isSubformNewComponentEnabled&&objectUtils.getLength(l)>0){var c=store.peekRecord("module",e);N(t,c,l)}}.bind(this))}else if(n&&n.subformAPIName){var z=n.subformAPIName,$=n[n.subformAPIName];$?($.cxSubformCreate||$.cxSubformEdit?u[e][z]=u[e][z][this.currentRecIndex]:delete u[e][z],d=!0):n.cxSubformEdit&&(d=!0)}return n&&n.cloneOnEdit&&c&&this.setDirtyValuesFromCloneOnEdit(e,t,u,n),Crm.userDetails.isSubformNewComponentEnabled&&d&&this.syncFormulaOrAggValue(u[e]),void 0!==m&&(u[e].affected_data[0].$process_flow=m),u}if("findAll"==t||"findRecord"==t){if(i[e]=i.data?i.data:[],delete i.data,"findRecord"==t){var j=i[e]?i[e][0]:void 0;de.call(this,j),n&&n.isWizardReloadRecord&&this.deSerializeEntityData(j,e)}else void 0!==i[e]&&i[e].forEach(function(e){de.call(this,e)}.bind(this));if(Crm.userDetails.isSubformNewComponentEnabled){var V=store.modelFor(e).fieldList,q=store.peekRecord("module",e).api_name;if("Quoted_Items"===q||"Ordered_Items"===q||"Purchase_Items"===q||"Invoiced_Items"===q)for(var B=i[e],H=B.length,K=0;K<H;K++){var Y=B[K],J=Y.Product_Name,G=J?J.id:void 0,Z=Crm.productIdVsDetails[G];if(!Z&&G){var W=store.peekRecord(moduleRecordMapping.Products.id,G);W&&((Z={}).Layout=W.Layout,Z.Product_Code=W.Product_Code,Z.Qty_Ordered=W.Qty_Ordered,Z.Qty_in_Stock=W.Qty_in_Stock,Z.Reorder_Level=W.Reorder_Level,Z.Tax=W.Tax,Z.Taxable=W.Taxable,Z.Unit_Price=W.Unit_Price,Z.id=W.id,Z.name=W.name)}Z&&(Crm.productIdVsDetails[G]=Z,Y.Product_Name=Z)}if(n&&(n.fromDetailRoute||n.fromCanvasDetailRoute)){var X=store.peekRecord("module",e);for(var r in i[e][0])if(V[r]&&V[r].cusRelationFldType&&"subform"===V[r].cusRelationFldType){var Q=i[e][0][r],ee=objectUtils.getMatchedKey(moduleApiMapping,r);if(!ee&&X){var te=X.fields.filterBy({api_name:r}),ie=te?te[0].subform.module:void 0;ee=objectUtils.getMatchedKey(moduleApiMapping,ie)}var re=moduleRecordMapping[ee],ae=Q.length;if(ae>0&&re){var se="crm-create-subformsection#"+re.parent_module.module_name+"_SubForm_"+re.api_name,oe=$L(se)[0];void 0!==oe&&oe.setData("serializeData",!0);for(var ne=0;ne<ae;ne++){var le=Q[ne];store.unloadRecord(re.id,le.id),store.pushPayload(re.id,le)}}}}}arguments[7]&&arguments[7].module&&"Attachments"==arguments[7].module&&(i[e][0].id=i[e][0].details.id)}function de(t){if(t){var a=Object.keys(t),s=a.length,o=store.modelFor(e),l=o.fieldList;i.meta||(i.meta={}),i.meta.original||(i.meta.original={}),t._$||(t._$={}),t._$.original||(t._$.original={});for(var d=this.preserveTypes_CEC,c=0;c<s;c++)null===t[a[c]]&&(t[a[c]]=void 0),l[a[c]]&&(t[a[c]]||0===t[a[c]])&&d.indexOf(l[a[c]].type)>-1?i.meta.original[a[c]]=t._$.original[a[c]]=t[a[c]]:t[a[c]]&&t[a[c]].length&&l[a[c]]&&"relation"===l[a[c]].type&&"hasMany"===l[a[c]].relType&&(i.meta.original[a[c]]=t._$.original[a[c]]=Lyte.deepCopyObject(t[a[c]].slice(0)));var u=o.relations,m=store.peekRecord(e,r);for(var p in u){var _=u[p];if(_&&_.length&&"hasMany"==_[0].relType&&(null!=t[_[0].relKey]&&null!=t[_[0].relKey]||t.hasOwnProperty(_[0].relKey)&&(t[_[0].relKey]=[]),n&&"detailView"!==n.requestFrom&&n.resetSubformDataForEntity&&m&&m.hasOwnProperty(_[0].relKey)&&Array.isArray(m[_[0].relKey])&&m[_[0].relKey].length)){var f=m[_[0].relKey].model&&m[_[0].relKey].model._name||void 0;store.modelFor(f)&&store.unloadAll(f,m[_[0].relKey])}}}}return i},updateDetailsForServerUpdatedFields:function(e,t,i,r,a,s){var o=store.modelFor(a).fieldList;if(t)for(var n=t.length,l=0;l<n;l++){var d=t[l];if(r[a][d]=e[d],o[d]&&i){var c=o[d].type;s.indexOf(c)>-1&&(i[d]=e[d])}}},syncFormulaOrAggValue:function(e){var t=e.affected_data&&e.affected_data[0]?e.affected_data[0]:void 0;t&&objectUtils.getKeys(t).forEach((function(i){var r=t[i];void 0!==r&&(e[i]=r)}))},extractMeta:function(e,t,i,r,a){return a&&a.businessCard&&e.fields&&(e.info=e.info?e.info:{},e.info.fields=e.fields),e.info},serializeRecord:function(e,t,i){return i&&i.__dummySubformId__set&&delete t.id,t},stripCloneOnEditInfo:function(e,t){if(e){e.id&&-1!==e.id.indexOf("_cloneOnEdit")&&(e.id=e.id.replace("_cloneOnEdit",""));var i=store.modelFor(t).fieldList;for(var r in e)if(i[r].cusRelationFldType&&"subform"===i[r].cusRelationFldType)for(var a=e[r].length,s=0;s<a;s++)e.id&&e[r][s].id&&-1!==e[r][s].id.indexOf("_cloneOnEdit")&&(e[r][s].id=e[r][s].id.replace("_cloneOnEdit",""))}return e},setDirtyOriginalValuesToCloneOnEditObj:function(e,t){if(e&&e.data.id&&-1!==e.data.id.indexOf("_cloneOnEdit")){var i=this.preserveTypes_CEC,r={};for(var a in e.data)i.contains(store.modelFor(t).fieldList[a].type)&&(r[a]=e.data[a]);store.peekRecord(t,e.data.id).$.set("cloneOnEdit_originalData",r)}},setDirtyValuesFromCloneOnEdit:function(e,t,i,r){if(r&&r.cloneOnEdit&&"updateRecord"===t&&i&&i[e]){for(var a=i[e],s=store.peekRecord(e,a.id+"_cloneOnEdit"),o=s.$.getDirtyAttributes(),n=o.length,l={},d=0;d<n;d++)s.hasOwnProperty("cloneOnEdit_originalData")&&s.cloneOnEdit_originalData.hasOwnProperty(o[d])?l[o[d]]=s.cloneOnEdit_originalData[o[d]]:l[o[d]]=s[o[d]];l.id=a.id,store.pushPayload(e,l),store.unloadRecord(e,a.id+"_cloneOnEdit")}},deSerializeEntityData:function(e,t){if(e&&e._$){let r=e._$.original||{},a=store.modelFor(t).fieldList;for(let s in r){let r=a[s].type;if("relation"===r&&"hasMany"===a[s].relType){let r=store.peekRecord(t,e.id)[s].model.fieldList;e[s].forEach((e=>{for(let t in e)r[t]&&i(e,t,r[t].type)}))}else i(e,s,r)}}function i(e,t,i){if("multi-picklist"===i){let i=e[t];i&&Array.isArray(i)&&(e[t]=JSON.stringify(i))}}}}),store.registerModel("custom_view",{display_value:Lyte.attr("string"),default:Lyte.attr("boolean"),criteria:Lyte.attr("object"),system_name:Lyte.attr("string"),id:Lyte.attr("string"),name:Lyte.attr("string"),access_type:Lyte.attr("string"),category:Lyte.attr("string"),fields:Lyte.attr("array"),filter:Lyte.hasMany("filter"),favorite:Lyte.attr("string")},{actions:{favourite:{endPoint:"favourite"},convert:{},change_sort:{},customize_wrap_text:{endPoint:"customize_wrap_text"},customize_width:{endPoint:"customize_width"},reset_width:{endPoint:"reset_width"},pin_unpin_fields:{endPoint:"pin_unpin_fields"}}}),store.registerAdapter("custom_view",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,s,o){if(o&&o.version&&(a=a.replace("v2.2",o.version)),!i||"Tasks"!==i.module&&"Events"!==i.module&&"Calls"!==i.module||(a=a.replace("/v2.1","/v3")),a=a.replace(e,e+"s"),"updateRecord"==t){var n=store.peekRecord("custom_view",r.id);n.sort_order?r.sort_order=n.sort_order:delete r.sort_order}else"deleteRecord"===t&&(a=a.substr(0,a.lastIndexOf("/")));if("action"!==t||"customize_width"!==s&&"reset_width"!==s)if("action"===t&&"pin_unpin_fields"===s)a=a.replace("settings/custom_views","settings/custom_views/"+o.id);else for(var l in o)"isDelete"!==l&&"unloadCustomview"!==l&&"version"!==l&&(i[l]=o[l]);else a=a.replace("settings/custom_views","__internal/settings/custom_views/"+o.id);return a},methodForRequest:function(e,t,i,r,a){return"PATCH"===e||"change_sort"===a||"customize_wrap_text"===a||"customize_width"===a||"reset_width"===a||"pin_unpin_fields"===a?"PUT":r&&!0===r.isDelete?"DELETE":e}}),store.registerSerializer("custom_view",{normalizeResponse:function(e,t,i,r,a,s,o,n){if(!i)return i=[];if("findAll"===t&&o.favourite&&i&&i.custom_views&&i.custom_views.sort(((e,t)=>e.favorite-t.favorite)),("findAll"===t||"findRecord"===t)&&i.info&&i.info.translation){var l=i.info.translation;for(var d in l)app.cvCategory?app.cvCategory[d]||(app.cvCategory[d]=l[d]):(app.cvCategory={},app.cvCategory.Favorites=I18n.getMsg("Favorites"),app.cvCategory[d]=l[d])}var c=!n||void 0===n.unloadCustomview||n.unloadCustomview;if("findAll"===t&&c)for(var u=store.peekAll("custom_view"),m=u.length,p=0;p<m;p++)u[p].module.api_name==o.module&&(store.unloadRecord("custom_view",u[p].id),m--,p--);return delete i.categories,"findRecord"==t?i.custom_views?i.custom_views=i.custom_views[0]:i={}:"updateRecord"==t&&200==a&&(i.custom_views={id:r}),i.custom_views&&i.custom_views.module&&(i.custom_views.module_default=i.custom_views.module),"findAll"!==t||i.custom_views||(i.custom_views=[]),i},normalize:function(e,t,i){return"findAll"==t&&(null==i.sort_by&&delete i.sort_by,null==i.sort_order&&delete i.sort_order),i},serialize:function(e,t,i,r,a,s,o){return"action"!=e&&t.custom_views&&"unsort"==t.custom_views.sort_order&&(delete t.custom_views.sort_order,t.custom_views.sort_by=null),"change_sort"===o||"customize_wrap_text"===o||"customize_width"===o||"pin_unpin_fields"===o?{custom_views:[r]}:("updateRecord"==e?t.custom_views=[t.custom_views]:"findRecord"==e&&t.custom_views&&(t.custom_views=t.custom_views[0]),t)},serializeKey:function(e){return e+"s"}}),store.registerModel("tag",{created_by:Lyte.attr("object"),created_time:Lyte.attr("string"),id:Lyte.attr("string"),modRefId:Lyte.attr("string"),modified_by:Lyte.attr("object"),modified_time:Lyte.attr("string"),module_name:Lyte.attr("string"),name:Lyte.attr("string"),color_code:Lyte.attr("string")},{actions:{records_count:{},merge:{},add_tags:{},remove_tags:{}}}),store.registerAdapter("tag",{namespace:"crm/v2.2/settings",methodForRequest:function(e,t,i,r){return"create"===t?"POST":"update"===t?"PATCH":"action"!==t||"add_tags"!==r.action&&"remove_tags"!==r.action?"action"===t&&void 0!==r&&r.module?(i.module=r.module,"GET"):e:"POST"},buildURL:function(e,t,i,r,a,s,o){return a=a.replace(e,e+"s"),"delete"===t&&o?a=a+"/"+o.id:"action"!==t||"add_tags"!==s&&"remove_tags"!==s?"action"===t&&o.id&&(a=(a=a.slice(0,a.indexOf("tag")+5))+o.id+"/actions/merge"):(a=(a=(a=a.slice(0,a.indexOf("tag")+5))+o.id+"/actions/"+s).replace("settings/"+e+"s",o.module),"remove_tags"===s&&(a=a.replace("v2.2","v2.1")+"?tag_names="+encodeURIComponent(o.tag_names)+"&fromClient="+!0)),"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),a}}),store.registerSerializer("tag",{normalizeResponse:function(e,t,i,r,a,s,o){var n=Lyte.Router.getRouteInstance();if("create"===t){for(var l=i.tags.length,d=[],c=0;c<l;c++)i.tags[c].details.module_name=o.modulename,i.tags[c].details.message||(i.tags[c].details.message=i.tags[c].message),i.tags[c].details.module_name=o&&o.module?o.module:n.getQueryParams().module,Lyte.arrayUtils(d,"push",i.tags[c].details),i.tags[c].module_name=o.module;return{tags:d}}if("findAll"===t)for(l=i.tags.length,c=0;c<l;c++)i.tags[c].module_name=o&&o.module?o.module:n.getQueryParams().module;else if("update"===t)return{tags:i.tags[0].details};return i},serializeKey:function(e){return e+"s"},serialize:function(e,t,i,r,a,s,o){if("merge"===o)return{tags:[{conflict_id:i.id,modified_time:i.modified_time}]};if("update"===e)return{tags:[{name:void 0===t.tags[0].name?i[0].name:t.tags[0].name,color_code:t.tags[0].color_code,id:t.tags[0].id,modified_time:i.modified_time}]};if("create"===e){for(var n=[],l=t.tags.length,d=0;d<l;d++){var c={name:t.tags[d].name,color_code:t.tags[d].color_code};n.push(c)}return{tags:n}}}}),store.registerModel("role",{api_name:Lyte.attr("string"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),users:Lyte.hasMany("user",{inverse:"role"}),admin_user:Lyte.attr("string"),reporting_to:Lyte.belongsTo("role",{serialize:"partial"}),forecast_manager:Lyte.belongsTo("user",{serialize:"id",inverse:"null"}),children:Lyte.hasMany("role",{inverse:"reporting_to"}),share_with_peers:Lyte.attr("boolean"),description:Lyte.attr("string"),_children:Lyte.hasMany("role",{inverse:"_children"}),forecast_data:Lyte.hasMany("forecast_data")},{actions:{deleted_associated_roles:{}}}),store.registerAdapter("role",{namespace:"crm/v2.2/settings/",reloadAll:function(e,t){return!(!t||!Object.keys(t).length)||(!(e.length>0)||!e[0].display_label)},buildURL:function(e,t,i,r,a,s,o){return o&&o.version&&(a=a.replace("v2.2",o.version)),a=a.replace(e,e+"s"),o&&"delete"===o.type?a=a+"/"+o.id:"updateRecord"===t&&r&&r.id&&(a=a.substring(0,a.indexOf("/"+r.id))),i&&"parent_roles"===i.type&&i.id&&(a=a+"/"+i.id+"/__parent_roles"),a},methodForRequest:function(e,t,i,r,a){return"action"===t&&"deleted_associated_roles"===a?"GET":"PATCH"===e||r&&"update"===r.type?"PUT":e}}),store.registerSerializer("role",{extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t,i){var r={};if("create"===e||"updateRecord"===e||"update"===e){var a=t.role&&t.role.length?t.role.length:1;r="create"===e?Lyte.deepCopyObject(t.role[a-1]):t.role;var s=i[a-1]?i[a-1].reporting_to:i.reporting_to,o=i[a-1]?i[a-1].forecast_manager:i.forecast_manager;if(s&&s.id){var n="create"===e?{name:s.name,id:s.id}:{id:s.id};void 0!==s._transfer_conflicting_users_to&&(n._transfer_conflicting_users_to=s._transfer_conflicting_users_to),r.reporting_to=n}if(o&&o.id){var l="create"===e?{name:o.name,id:o.id}:{id:o.id};r.forecast_manager=l}return t.roles=[r],delete t.role,t}return[t]},normalizeResponse:function(e,t,i,r,a,s,o){return"create"===t||"createRecord"===t||"updateRecord"===t?((i=i&&i.roles?i.roles[0]:i)&&i.details&&i.details.id&&(i.id=i.details.id),{roles:i}):("findAll"===t&&o&&"CUSTOM_HOME"===o.configType&&i&&i.roles&&(i.roles=CustomHomePage.filteringDataForComponent(i.roles,i.roles.filter((e=>(void 0===CustomHomePage.sharedIdsVsCount[e.id]||CustomHomePage.sharedIdsVsCount[e.id])<CustomHomePage.maxRolesProfilesPerPage)))),i)},serializeEmptyRelation:!0}),store.registerModel("territory",{name:Lyte.attr("string"),manager:Lyte.belongsTo("user",{serialize:"id"}),reporting_to:Lyte.belongsTo("territory",{inverse:"children",serialize:"id"}),id:Lyte.attr("string"),description:Lyte.attr("string"),permission_type:Lyte.attr("string"),account_rule_criteria:Lyte.attr("object"),deal_rule_criteria:Lyte.attr("object"),lead_rule_criteria:Lyte.attr("object"),children:Lyte.hasMany("territory",{inverse:"reporting_to"}),users:Lyte.hasMany("user",{inverse:"territories"}),forecast_data:Lyte.hasMany("forecast_data"),created_by:Lyte.belongsTo("user"),created_time:Lyte.attr("string"),modified_by:Lyte.belongsTo("user"),modified_time:Lyte.attr("string")},{actions:{associated_users_count:{},deleted_associated_territories:{},associated_users:{},run_rules:{},create_territories:{},update_territories:{},removedUsersfromTerritory:{},addUserToTerritory:{},transfer_and_delete:{},get_assigned:{},get_unassigned:{}}}),store.registerAdapter("territory",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,s,o){return a=a.replace("territory","territories"),o&&o.version&&(a=a.replace("v2.2",o.version)),"action"!==t||"associated_users_count"!==s&&"associated_users"!==s?"action"===t&&"create_territories"===s?a=a.replace("/actions/create_territories",""):"action"===t&&"update_territories"===s?a=o&&o.id?a.replace("/actions/update_territories","/"+o.id):a.replace("/actions/update_territories",""):"action"!==t||"removedUsersfromTerritory"!==s&&"addUserToTerritory"!==s?"action"===t&&"run_rules"===s&&(a=a.replace("v2.2","v8")):a=a.replace("/actions/"+s,"/"+o.id+"/users"):("associated_users"===s&&(a=a.replace("/actions/associated_users","/users")),o&&(o.type&&(i.type=o.type),o.type__s&&(i.type__s=o.type__s))),a},methodForRequest:function(e,t,i,r,a){if("action"===t){if("associated_users_count"===a||"deleted_associated_territories"===a||"associated_users"===a)return"GET";if("addUserToTerritory"===a||"removedUsersfromTerritory"===a)return r.type}else if("updateRecord"===t)return r.type?r.type:"PUT";return e},reloadAll:function(e,t,i){return!(!i||!i.makeRequest)||(!(!t||!Object.keys(t).length)||!(e.length>0))},parseResponse:function(e,t,i,r){return"action"===e&&r&&r.users&&r.users.length>0&&store.pushPayload("user",r.users),r}}),store.registerSerializer("territory",{varPayloadKey:"territories",payloadKey:function(){return this.varPayloadKey},extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t,i){if("createRecord"===e)return(r=i.territories[0]).reporting_to={id:r.reporting_to.id},{territories:[r]};if("updateRecord"===e){var r={};return i.$.getDirtyAttributes().forEach((function(e){"_children"!==e&&(r[e]="reporting_to"===e?{id:i[e].id}:"manager"===e?i[e]&&i[e].id?{id:i[e].id,_add_old_manager_as_user:i[e]._add_old_manager_as_user}:null:i[e])})),{territories:[r]}}return void 0!==t?t:[e]},normalizeResponse:function(e,t,i){return"createRecord"!==t&&"updateRecord"!==t||(i.territories=i.territories[0].details),i},normalizeRecord:function(e,t){return t.manager&&(t.users||(t.users=[]),t.users.push({id:t.manager.id})),t}}),store.registerModel("forecast_data",{id:Lyte.attr("string"),Forecast_Name:Lyte.belongsTo("Forecast"),Parent_Item:Lyte.belongsTo("forecast_data"),children:Lyte.hasMany("forecast_data",{inverse:"children"}),users:Lyte.hasMany("forecast_data",{inverse:"users"}),User:Lyte.belongsTo("user"),Role:Lyte.belongsTo("role"),Territory:Lyte.belongsTo("territory"),Reporting_To:Lyte.belongsTo("user"),Forecast_Category:Lyte.attr("object"),Forecast_Quota:Lyte.attr("object")}),store.registerAdapter("forecast_data",{namespace:"crm/v2.2",buildURL:function(e,t,i,r,a){return a=a.replace("forecast_data","Forecasts/forecast_data")},headersForRequest:function(e,t,i){var r=this.$super.headersForRequest(e,t,i);return r.Accept="application/json",r["Content-type"]="application/json; charset=utf-8",r}}).extends("application"),store.registerSerializer("forecast_data",{payloadKey:function(e){return e}}),store.registerModel("filter",{id:Lyte.attr("string"),custom_view:Lyte.belongsTo("custom_view",{serialize:"record"}),criteria:Lyte.attr("object"),cross_filters:Lyte.attr("array"),name:Lyte.attr("string"),sequence_number:Lyte.attr("number")},{actions:{reorder:{endPoint:"reorder"}}}),store.registerAdapter("filter",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,s,o){return a=a.replace("/filter","/custom_views/"+o.cvid+"/filters"),"delete"!=t&&"deleteRecord"!=t||(i.ids=o.filter_id),"deleteRecord"==t&&(a=a.replace("/"+o.filter_id,"")),"findRecord"!=t&&(i.module=o.module),"reorder"===s&&(a=a.replace("/v2.2","/v6")),a},methodForRequest:function(e,t,i,r,a){return"delete"==t?"DELETE":"updateRecord"===t||"reorder"===a?"PUT":e}}),store.registerSerializer("filter",{normalizeResponse:function(e,t,i,r,a,s,o){if("create"==t){var n={};(n=i.filters[0].details).module_name=o&&o.module?o.module:"",n.count=void 0,i.filters=n}else if("updateRecord"==t){(n={}).id=i.filters[0].details.id,i.filters=n}else if("findAll"===t)for(var l=i.filters?i.filters.length:0,d=0;d<l;d++)i.filters[d].module_name=o&&o.module?o.module:"",i.filters[d].count=void 0;else"findRecord"==t&&i.filters&&i.filters[0]&&(i.filters[0].criteria=i.filters[0].criteria?i.filters[0].criteria:void 0,i.filters[0].cross_filters=i.filters[0].cross_filters?i.filters[0].cross_filters:void 0);return null==i&&(i={filter:[]}),this.$super.normalizeResponse(e,t,i)},serialize:function(e,t,i,r,a,s,o){if("reorder"===o&&(t={filter:r.filter}),t.filters=t.filter,delete t.filter,"updateRecord"==e){var n=t.filters;delete t.filters,t.filters=[],t.filters[0]=n}return t}}),store.registerModel("tab_group",{name:Lyte.attr("string"),modules:Lyte.hasMany("module"),profiles:Lyte.hasMany("profile"),default:Lyte.attr("boolean"),visible:Lyte.attr("string")}),store.registerAdapter("tab_group",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a){return"updateRecord"==t&&(a=a.slice(0,a.lastIndexOf("/"))),a+"s"}}),store.registerSerializer("tab_group",{serializeKey:function(e){return e+"s"},serialize:function(e,t){return"updateRecord"==e&&(t.tab_groups=[t.tab_groups]),t},normalizeResponse:function(e,t,i,r,a){return"updateRecord"==t&&200==a&&(i.tab_groups={id:r}),i}}),store.registerModel("visions",{id:Lyte.attr("string"),name:Lyte.attr("string"),active:Lyte.attr("boolean"),vision_module:Lyte.belongsTo("module",{serialize:"record",inverse:"vision_module"}),criteria:Lyte.attr("object"),vision_fields:Lyte.belongsTo("field",{serialize:"record",inverse:"vision_fields"}),failure_action:Lyte.attr("array",{default:[{type:I18n.getMsg("crm.zia.vision.update.record"),key:"do_not_create"},{type:I18n.getMsg("crm.zia.vision.image.approve"),key:"image_approval"},{type:I18n.getMsg("crm.zia.vision.record.approve"),key:"record_approval"},{type:I18n.getMsg("crm.zia.vision.image.without"),key:"create_without_image"}]}),desired_set:Lyte.attr("object",{}),undesired_set:Lyte.attr("object",{}),training_details:Lyte.attr("object",{}),pattern_criteria:Lyte.attr("object",{}),action:Lyte.attr("object",{}),model_score:Lyte.attr("string"),validation_type:Lyte.attr("string"),layout:Lyte.attr("object"),learn_type:Lyte.attr("string")},{actions:{total_records:{},resubmit_record:{},approval_recordCount:{},record_approvals:{},approval_count:{},approval_counts:{},status:{},approvals:{},approval:{},approvals_images:{},reviews:{},delete_record:{},bulk_reviews:{},add_Image_to_learning:{},model_information:{},get_images:{},delete_image_zips:{},delete_images:{},gallery_feedback:{},gallery_list:{},gallery_images:{},delete_zips:{}}}),store.registerAdapter("visions",{namespace:"crm/v3/",buildURL:function(e,t,i,r,a,s,o){switch(s){case"record_approvals":a=a.replace("visions/actions/record_approvals","settings/zia/visions/approvals");break;case"resubmit_record":a=a.replace("visions/actions/resubmit_record",o.moduleName+"/"+o.recordId+"/actions/vision_resubmit");break;case"approval_recordCount":a=a.replace("visions/actions/approval_recordCount","settings/zia/visions/approvals/actions/group_count");break;case"total_records":a=a.replace("visions/actions/total_records","settings/zia/visions/approvals/actions/total_records");break;case"approval_counts":a=a.replace("visions/actions/approval_counts","settings/zia/visions/approvals/actions/count");break;case"approval_count":a=a.replace("visions/actions/approval_count","settings/zia/visions/"+o.id+"/approvals/actions/count");break;case"status":a=a.replace("visions/actions/status","settings/zia/visions/"+o.id);break;case"approvals":a=a.replace("visions/actions/approvals","settings/zia/visions/"+o.id+"/approvals");break;case"approval":a=a.replace("visions/actions/approval","settings/zia/visions/"+o.id+"/approvals/"+o.approval_id);break;case"approvals_images":a=a.replace("visions/actions/approvals_images","settings/zia/visions/"+o.id+"/approvals");break;case"bulk_reviews":var n="record_approval"===o.failure_action?"vision_record_approvals":"vision_image_approvals";a=a.replace("visions/actions/bulk_reviews",o.moduleObj.api_name+"/"+o.recordObj.id+"/actions/"+n);break;case"delete_record":a=a.replace("visions/actions/delete_record",o.moduleObj.api_name+"/"+o.recordObj.id+"/actions/vision_record_approvals");break;case"reviews":a=a.replace("visions/actions/reviews","settings/zia/visions/approvals/"+o.id+"/actions/review");break;case"add_Image_to_learning":a=a.replace("visions/actions/add_Image_to_learning","settings/zia/visions/"+o.id+"/images/actions/push_to_learning");break;case"model_information":a=a.replace("visions/actions/model_information","settings/zia/visions/"+o.id+"/model_information");break;case"get_images":a=a.replace("visions/actions/get_images","settings/zia/visions/"+o.id+"/images?filters="+o.filters);break;case"delete_image_zips":a=a.replace("v3/visions/actions/delete_image_zips","zia/visions/v3/image_zips");break;case"delete_images":a=a.replace("visions/actions/delete_images","settings/zia/visions/"+o.id+"/images/actions/delete_images");break;case"gallery_feedback":a=a.replace("visions/actions/gallery_feedback","settings/zia/visions/actions/gallery_feedback");break;case"gallery_list":a=a.replace("visions/actions/gallery_list","settings/zia/visions/gallery_models").replace("/v3/","/v7/")+"?action="+o.action;break;case"gallery_images":a=a.replace("visions/actions/gallery_images","settings/zia/visions/"+o.config_id+"/gallery_images").replace("/v3/","/v7/")+"?label_id="+o.label_id;break;case"delete_zips":a=a.replace("visions/actions/delete_zips","settings/zia/visions/data_sets").replace("/v3/","/v7/")+"?ids="+o.ids;break;default:a=a.replace("visions","settings/zia/visions")}return a},methodForRequest:function(e,t,i,r,a){return"PATCH"===e?"PUT":"record_approvals"===a||"approval_recordCount"===a||"total_records"===a||"approval_counts"===a||"approval_count"===a||"approvals"===a||"approval"===a||"approvals_images"===a||"model_information"===a||"get_images"===a?"GET":"status"===a||"reviews"===a||"bulk_reviews"===a||"add_Image_to_learning"===a?"PUT":"resubmit_record"===a||"delete_images"===a||"gallery_feedback"===a?"POST":"delete_record"===a||"delete_image_zips"===a?"DELETE":e}}),store.registerSerializer("visions",{normalizeResponse:function(e,t,i,r,a){if("createRecord"!==t&&"updateRecord"!==t||!i.visions[0]){if(("findRecord"===t||"findAll"===t)&&204===a)return i;if(("findAll"===t||"findRecord"===t)&&i.visions[0]){o=[];var s=[{type:"crm.zia.vision.update.record",key:"do_not_create"},{type:"crm.zia.vision.image.approve",key:"image_approval"},{type:"crm.zia.vision.record.approve",key:"record_approval"},{type:"crm.zia.vision.image.without",key:"create_without_image"}];i.visions.map((function(e,t){o[t]=e,o[t].vision_module=e.module,o[t].vision_fields=e.field,s.map((function(e){o[t].failure_action!==e.key||(o[t].action={type:e.type,key:e.key})})),o[t].failure_action=s,delete o[t].module,delete o[t].field})),(i={}).visions=o}}else{var o={};o=i.visions[0].details,(i={}).visions=o}if("findRecord"===t){if(i.visions[0].undesired_set)n(i.visions[0].undesired_set.labels);if(i.visions[0].desired_set)n(i.visions[0].desired_set.labels);if(i.visions[0].training_details)n(i.visions[0].training_details.labels)}function n(e){e.forEach((e=>{var t=[];e.$model_details&&(e.$model_details.forEach((e=>{"custom"===e.type&&(e.type="upload"),t.push(e)})),e.model_tags=t,e.model_details=e.$model_details,delete e.$model_details)}))}return i},serialize:function(e,t,i,r,a,s,o){if("createRecord"===e||"updateRecord"===e){var n=[],l=objectUtils.cloneObject(t.visions);l.vision_fields&&(l.field={id:l.vision_fields.id,api_name:l.vision_fields.api_name}),l.vision_module&&(l.module={id:l.vision_module.id,api_name:l.vision_module.api_name}),l.action&&(l.failure_action=l.action.key),"object_detection"!==i.validation_type&&"match_detect"!==i.validation_type&&("createRecord"===e?l.training_details=null:delete l.training_details,l.desired_set&&(l.desired_set=Object.keys(l.desired_set).length>0?l.desired_set:null),l.undesired_set&&(l.undesired_set=Object.keys(l.undesired_set).length>0?l.undesired_set:null)),"image_validation"!==i.validation_type&&"match_detect"!==i.validation_type&&("createRecord"===e?(l.desired_set=null,l.undesired_set=null):(delete l.desired_set,delete l.undesired_set)),delete l.action,delete l.vision_fields,delete l.vision_module,n.push(l);var d={};return d.visions=n,d}return"status"===o?(t={}).visions=r.statusJson:"reviews"===o||"bulk_reviews"===o?(t={},"record_approval"===r.failure_action?t.vision_record_approvals=r.reviewJson:t.vision_image_approvals=r.reviewJson):"model_information"===o?(t={}).id=r.id:"add_Image_to_learning"===o?(t={}).images=r.images:"delete_images"===o||"delete_image_zips"===o?(t={},t=r.delete_request_body):"gallery_feedback"===o&&(t={},t=r.request_body),t},payloadKey:function(e){return e},getLabelComparators:function(e){var t=[],i={};return i.comparator=e.group_operator,e.group.forEach((e=>{void 0===e.group_operator?(i.id=e.label.id,t.push(i)):t=t.concat(getLabelComparators(e))})),t}}),store.registerModel("wizard",{id:Lyte.attr("string"),name:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"record"}),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),modified_by:Lyte.attr("string"),created_by:Lyte.attr("string"),active:Lyte.attr("boolean"),profiles:Lyte.hasMany("profile",{serialize:"partial"}),containers:Lyte.hasMany("wizard-container",{serialize:"partial",deepNest:!0}),portal_user_types:Lyte.hasMany("user_type",{serialize:"partial"}),didLoad:function(e){function t(e,t){"object"!=typeof t||e.find((e=>e.id===t.id))||e.push(t),"string"!=typeof t||e.contains(t)||e.push(t)}e=this instanceof Record?this:e;var i,r=!1,a=!1,s=e.containers;s&&(e.layouts=[],s.forEach((function(s){e.layouts.push({id:s.layout.id,name:s.layout.name}),s.chart_data&&(s.chart_data.connections&&s.chart_data.connections.length&&!s.chart_data.screen_connections&&(s.chart_data.screen_connections={},s.chart_data.connections.forEach((function(e){s.chart_data.screen_connections[e.id]=e}))),s.chart_data.connections=[]),s.screens&&(s.fields=[],s.field_array=[],s.custom_buttons_array=[],s.subform_fields=[],s.screens.forEach((function(o){o.segments=o.segments||[],o.segments.forEach((function(o){switch(o.type){case"subforms":var n={};if(n.id=Lyte.attr("string"),r=!1,a=!1,o.fields.forEach((function(e){"subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type?(r=!0,i=e.subform&&e.subform.id,t(s.fields,e.api_name),t(s.field_array,e)):e.subform||(n[e.api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(e)),n[e.api_name].fieldID=e.id,n[e.api_name].uiType=e.ui_type,n[e.api_name].columnName=e.column_name,n[e.api_name].fieldType=e.data_type,n[e.api_name].length=e.length,n[e.api_name].displayLabel=e.display_label,n[e.api_name].isCustomField=e.custom_field,"SERIAL_NUMBER"==e.column_name&&(a=!0)),e.subform&&"subform"!==e.data_type&&"static_subform"!==e.data_type&&t(s.subform_fields,e)})),!store.model[i]&&r&&e.module){var l={};l.__parent_module__=Lyte.belongsTo(e.module.id),store.registerModel(i,l,{extends:"entity"})}if(store.model[i]&&r&&Lyte.Component.registeredHelpers.isNotEmpty(n))for(var d in a||(n.__CUSTOM_sequence_NUMBER__={type:"string"}),n.removedRow={type:"string"},n)store.addField(i,d,n[d].type,n[d]);break;case"fields":o.fields&&o.fields.forEach((function(e){t(s.fields,e.api_name),t(s.field_array,e)}));break;case"composite":o.elements&&o.elements.forEach((function(e){"field"===e._type&&(t(s.fields,e.api_name||e.name),t(s.field_array,e))}));break;case"buttons":o.buttons.forEach((function(e){if(e.hide=!1,e.category||(e.category="wizard_button"),"custom_button"===e.category&&s.custom_buttons_array.push(e.id),e.target_screen&&!validationUtils.isEmpty(e.target_screen)){var t={};t.target_screen=e.target_screen,t.source_button={id:e.id,display_label:e.display_label},s.chart_data.connections.push(t)}}))}}))})))})))}.on("add")},{actions:{associated_places:{}}}),store.registerAdapter("wizard",{namespace:"crm/v6/settings",headersForRequest:function(e,t,i){var r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return window.clientPortalName&&(r["X-CRMPORTAL"]=window.clientPortalName),i&&i.headers&&i.headers["X-CRM-ORG"]&&(r["X-CRM-ORG"]=i.headers["X-CRM-ORG"]),("true"===window.isSandboxAcc&&window.isCanvasProdDiff||"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff)&&(r["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),r},buildURL:function(e,t,i,r,a,s,o){if(o&&o.hostUrl&&o.hostUrl.url)if((a=o.hostUrl.url).match("sandbox/diff")||a.match("production/diff")){let e=a.split("diff/").pop().split("v5/")[0];if(1===a.match(new RegExp(e,"g")).length)a=a.replace(e,"");else{let t=0;a=a.replaceAll(e,(e=>++t>=2?"":e))}}else{var n=a.split("crm/").pop().split("v5/")[0];a=a.replace(n,"")}else a="action"===t&&"associated_places"===s?a.replace("wizard","wizards").replace("/actions/associated_places","/"+o.id+"/actions/associated"):a.replace("wizard","wizards");return"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),a}}),store.registerSerializer("wizard",{normalizeResponse:function(e,t,i){if(!i)return null;if(!i.wizards)return i.wizard=[],i;if(i.wizard=i.wizards,i.wizard[0]&&i.wizard[0].code&&"error"!==i.wizard[0].status)i.wizard=i.wizard[0].details;else if("findAll"===t||"findRecord"===t){var r=this;i.wizards.forEach((function(e){e=r.responseParser(e,t);var i=store.peekRecord("wizard",e.id),a=[];i&&i.containers&&(a=i.containers.map((function(e){return e.id}))),i&&(e.containers.forEach((function(t){if(!a.contains(t.layout.id))var i={id:t.layout.id,name:t.layout.name,wizard:[e.id],layout:t.layout};store.pushPayload("wizard-container",i||t)})),delete e.containers)})),i.wizard=i.wizards}return delete i.wizards,i},serialize:function(e,t,i,r,a,s,o){if("action"===e&&"associated_places"===o)return[e];if("deleteRecord"!==e){if("createRecord"===e&&(t.wizard.active=!0,t.wizard.module={id:t.wizard.module.id,api_name:t.wizard.module.api_name}),t.wizard.hasOwnProperty("profiles")){let e=[];t.wizard.profiles.forEach((function(t){const i=store.peekRecord("profile",t.id);i&&("removed"===t.$.partialType?e.push({id:i.id,_delete:null}):e.push({id:i.id,name:i.name}))})),delete t.wizard.profiles,t.wizard.profiles=e}if(t.wizard.hasOwnProperty("portal_user_types")){var n=[];t.wizard.portal_user_types.forEach((function(e){var t=store.peekRecord("user_type",e.id);t&&("removed"===e.$.partialType?n.push({id:t.id,_delete:!0}):n.push({id:t.id,name:t.name}))})),delete t.wizard.portal_user_types,t.wizard.portal_user_types=n}t.wizard.hasOwnProperty("containers")&&t.wizard.containers.forEach((function(t){let i=store.peekRecord("wizard-container",t.$.pK);"removed"!==t.$.partialType?(i.layout&&(t.layout={id:i.layout.id,name:i.layout.name}),t.screens&&t.screens.forEach((function(t){"removed"===t.$.partialType?t._delete=null:(t.hasOwnProperty("active")&&delete t.active,"added"===t.$.partialType?t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(t.$.pK):"removed"===t.$.partialType?t.id=t.$.pK:"modified"===t.$.partialType&&1==Object.keys(t).length&&(t.sequence_number=store.peekRecord("wizard-screen",t.$.pK).sequence_number,t.id=t.$.pK),t.segments&&t.segments.forEach((function(t){if("removed"===t.$.partialType?t.id=t.$.pK:"modified"===t.$.partialType&&1==Object.keys(t).length&&(t.sequence_number=store.peekRecord("wizard-segment",t.$.pK).sequence_number,t.id=t.$.pK),"removed"===t.$.partialType)t._delete=null;else if("added"===t.$.partialType||"modified"===t.$.partialType){let r=store.peekRecord("wizard-segment",t.$.pK);if("composite"===r.type){let i=[];if(t.elements||void 0!==t.fieldReorder){t.elements=t.elements||[];{let e=t.elements.filter((e=>"removed"===e.$.partialType)).map((e=>e.id)),i=t.elements.filter((e=>"removed"!==e.$.partialType)).map((e=>e.id));t.elements=t.elements.filter((t=>!(e.includes(t.id)&&i.includes(t.id))))}t.elements.forEach((function(e){if(!r.$.isNew&&"removed"===e.$.partialType){var t=store.peekRecord(e.$.polymorphicType,e.id);if(i.push({resource:{id:e.id},type:"field"===e.$.polymorphicType?"field":"query_component",_delete:null}),t&&"First_Name"===t.api_name){var a=store.peekAll("field").filter((function(e){return"Salutation"===e.api_name})),s=a&&a.length?a[0]:void 0;s&&i.push({resource:{id:s.id,name:s.api_name},_delete:null,type:t.$.model._name})}}})),r.elements.forEach((function(e){if(e[t.$.pK].sequence_number!==e[t.$.pK].orig_sequence_number){if("First_Name"===e.api_name){var r=store.peekAll("field").filter((function(e){return"Salutation"===e.api_name})),a=r&&r.length?r[0]:void 0;a&&i.push({resource:{id:a.id,name:a.api_name},sequence_number:0,type:e.$.model._name})}var s={};if("field"===e.$.model._name?s={type:e.$.model._name,resource:{id:e.id,name:e.api_name},sequence_number:e[t.$.pK].sequence_number}:(t.type="composite",s={type:"query_component",resource:{id:e.id,name:e.name},sequence_number:e[t.$.pK].sequence_number}),"Salutation"===e.api_name)return;i.push(s)}}))}delete t.fieldReorder,delete t.buttons,delete t.fields,delete t.content,i.length>0?t.elements=i:"createRecord"!==e&&"updateRecord"!==e||(t.elements=null)}else if("subforms"===r.type){var i=[];(t.fields||r.$.isNew)&&r.fields.forEach((function(e){if(500===e.ui_type){var t=store.peekRecord("field",e.id);i.push({id:t.id,api_name:t.api_name,sequence_number:1})}})),r.$.isNew&&(t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(r.$.pK)),delete t.buttons,delete t.fields,delete t.content,i.length?t.fields=i:"createRecord"==e&&(t.fields=null)}else"buttons"===r.type?(t.buttons&&t.buttons.forEach((function(t){if(t.hasOwnProperty("selected")&&delete t.selected,"removed"===t.$.partialType)t._delete=null;else{t.$.isNew?t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(t.$.pK):t.id=t.$.pK,t.hasOwnProperty("criteria")&&validationUtils.isEmpty(t.criteria)&&(t.$.isNew||"added"==t.$.partialType?delete t.criteria:t.criteria=null);var i=store.peekRecord("wizard-button",t.$.pK);if(t.hasOwnProperty("profiles")){var r=[];t.profiles.forEach((e=>{let t=store.peekRecord("profile",e.id);i.$.isNew||"removed"!==e.$.partialType||r.push({id:t.id,_delete:null}),"modified"!==e.$.partialType&&"added"!==e.$.partialType||r.push({id:t.id,name:t.name})})),t.profiles=r}if(t.visibility&&"show"==t.visibility&&i.criteria&&("createRecord"==e?delete t.criteria:t.criteria=null),t.criteria&&!t.visibility&&(t.visibility=i.visibility),i.transition&&i.transition.Id){t.transition={id:i.transition.Id,name:i.transition.Name};var a=store.peekRecord("transition",i.transition.Id);if(a&&a.Actions){var s=wizardTransitionHandler.getAssociatedActions(i.transition.Id);0==s.Alert.length&&0==s.Deluge.length&&0==s.Webhook.length&&(t.transition={id:i.transition.Id,_delete:null})}}if(i.target_screen&&!validationUtils.isEmpty(i.target_screen)){var o=store.peekRecord("wizard-screen",i.target_screen.$.pK);i.target_screen.$.isNew?t.target_screentemp={reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(o.$.pK),display_label:o.display_label}:t.target_screentemp={id:o.$.pK,display_label:o.display_label},t.target_screen=t.target_screentemp,delete t.target_screentemp}}})),delete t.fields,delete t.content):r.$.isNew&&"widget"===r.type?(t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(r.$.pK),t.widget={},t.widget.id=r.widget.widgets_id,t.widget.name=r.widget.name,delete t.widget.widgets_id):r.$.isNew&&"text_label"===r.type&&(t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(r.$.pK))}})),t.conditional_rules&&t.conditional_rules.forEach((function(e){"removed"!==e.$.partialType?e.actions&&e.actions.forEach((function(e){var t=store.peekRecord("wizard-conditional-action",e.$.pK);if("removed"===e.$.partialType)e._delete=null;else if("added"===e.$.partialType&&"show_subforms"===e.type){store.peekRecord("wizard-segment",t.segment.$.pK).$.isNew&&(e.segment.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(e.segment.$.pK))}else if("added"!==e.$.partialType||"show_text_component"!==e.type&&"show_widget"!==e.type)if("added"===e.$.partialType&&"set_value"===e.type)e.value=t.value;else if(("modified"===e.$.partialType||t.$.isModified)&&"set_lock"===t.type||"added"===e.$.partialType&&"set_lock"===e.type){var i=[],r=[],a=[],s=[];e.exempted_profiles&&e.exempted_profiles.forEach((function(e){if("removed"===e.$.partialType){var t={id:e.id,_delete:!0};a.push(e.id),i.push(t)}})),e.exempted_portal_user_types&&e.exempted_portal_user_types.forEach((function(e){if("removed"===e.$.partialType){var t={id:e.id,_delete:!0};s.push(e.id),r.push(t)}}));for(var o=t.exempted_profiles,n=o?o.length:0,l=0;l<n;l++){var d=o[l];if(!a.contains(d.id)){var c={id:d.id};i.push(c)}}e.exempted_profiles=i;for(var u=t.exempted_portal_user_types,m=u?u.length:0,p=0;p<m;p++){var _=u[p];if(!s.contains(_.id)){var f={id:_.id};r.push(f)}}e.exempted_portal_user_types=r,e.field={id:t.field.id},e.type="set_lock"}else"modified"!==e.$.partialType&&!t.$.isModified||"set_value"!==t.type||(e.field={id:t.field.id},e.value=t.value,e.type="set_value");else{if(store.peekRecord("wizard-segment",t.segment.$.pK).$.isNew){var y=Lyte.Component.registeredHelpers.returnReferenceFormat(e.segment.$.pK);e.segment={},e.segment.reference_id=y}}})):e._delete=null})))})),t.chart_data={},t.chart_data.nodes=[],t.chart_data.connections=[],t.chart_data.color_palette=i.chart_data.color_palette,i.chart_data.nodes.forEach((function(e){var i;i=e.screen.id?store.peekRecord("wizard-screen",e.screen.id):store.peekRecord("wizard-screen",Lyte.Component.registeredHelpers.returnActualId(e.screen.reference_id));var r={};r.pos_x=e.pos_x,r.pos_y=e.pos_y,r.start_node=e.start_node,i.$.isNew?r.screen={reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(i.id),display_label:e.screen.display_label}:r.screen={id:i.id,display_label:e.screen.display_label},t.chart_data.nodes.push(r)})),i.chart_data.connections.forEach((function(e){var i={},r={},a={};e.transition&&e.transition.transition_id&&(a.transition=e.transition),i=(r=e.source_button.id?store.peekRecord("wizard-button",e.source_button.id):store.peekRecord("wizard-button",Lyte.Component.registeredHelpers.returnActualId(e.source_button.reference_id))).$.isNew?{reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(r.$.pK),display_label:e.source_button.display_label}:{id:r.id,display_label:e.source_button.display_label},a.source_button=i;var s,o={};(s=e.target_screen.id?store.peekRecord("wizard-screen",e.target_screen.id):store.peekRecord("wizard-screen",Lyte.Component.registeredHelpers.returnActualId(e.target_screen.reference_id))).$.isNew?o.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(s.$.pK):o.id=s.id,o.display_label=s.display_label,a.target_screen=o,t.chart_data.connections.push(a)}))):(t.layout={id:t.id,_delete:null},delete t.id)}))}return{wizards:[t.wizard]}},payloadKey:function(e,t){if("findAll"==t||"findRecord"==t)return e},responseParser:function(e,t){let i={};return e.hasOwnProperty("portal_user_types")&&e.portal_user_types||(e.portal_user_types=[]),e.hasOwnProperty("profiles")&&e.profiles||(e.profiles=[]),e.hasOwnProperty("containers")&&e.containers.forEach((function(e){e.screens&&e.screens.forEach((function(e){e.segments&&e.segments.forEach((function(e){if("composite"===e.type){var t=[];e.fields=[],e.elements.forEach((function(i){var r=Object.assign({},i);if(r.id=i.resource.id,r.name=i.resource.name,"query_component"===i.type){if(i._type="wizard-query-component","field"===i.resource.search_parameters[0].target_resource_type){let e=i.resource.search_parameters[0].target_resource.id,t=store.peekRecord("field",e);t&&133===t.ui_type&&Object.assign(i.resource.search_parameters[0].target_resource.lookup,t.lookup)}const t=store.pushPayload("wizard-query-component",i.resource);if(t.type="query_component",t.active=!validationUtils.isEmpty(i.resource.search_parameters),i.resource.search_parameters){const e=i.resource.search_parameters.length;for(let r=0;r<e;r++)if(!i.resource.search_parameters[r].active){t.active=!1;break}}(r=i.resource)[e.id]={sequence_number:i.sequence_number,orig_sequence_number:i.sequence_number},r._type="wizard-query-component"}else r._type="field",e.fields.push({id:i.resource.id}),r[e.id]={sequence_number:r.sequence_number,orig_sequence_number:r.sequence_number},i.resource.ui_type&&(r.data_type=i.resource.data_type,r.ui_type=i.resource.ui_type,r.field_label=i.resource.field_label,r.disabledElement=!0);t.push(r)})),e.elements=t}else"fields"===e.type||"subforms"===e.type?(store.addField("field",e.id,"object"),e.elements=[],e.fields.forEach((function(t){t[e.id]={sequence_number:t.sequence_number,orig_sequence_number:t.sequence_number},"Product_Name"===t.api_name&&t.lookup&&t.lookup.show_fields&&(t.lookup.show_fields=t.lookup.show_fields.filter((e=>"Product_Code"===e.field.api_name))),t._type="field",e.elements.push(t)}))):"buttons"==e.type?e.buttons.forEach((function(e){e.transition&&e.transition.id&&(store.pushPayload("transition",{Id:e.transition.id,Name:e.transition.name,button:e.id}),delete e.transition),e.profiles||(e.profiles=[])})):"widget"===e.type&&(e.widget.widgets_id=e.widget.id,store.pushPayload("widget",e.widget))}))})),e.chart_data&&!e.chart_data.connections&&(e.chart_data.connections=[]),i[e.id]=e.screens||[]})),"findAll"===t&&(e.layoutVsScreens=i),e}}),Lyte.Component.registerHelper("returnReferenceFormat",(function(e){return"{{"+e+"}}"})),Lyte.Component.registerHelper("returnActualId",(function(e){return e.replace("{{","").replace("}}","")})),store.registerModel("wizard-container",{id:Lyte.attr("string"),layout:Lyte.belongsTo("layout",{serialize:"partial"}),screens:Lyte.hasMany("wizard-screen",{serialize:"partial",deepNest:!0}),wizard:Lyte.hasMany("wizard"),chart_data:Lyte.attr("object")}),store.registerModel("wizard-screen",{id:Lyte.attr("string"),reference_id:Lyte.attr("string"),display_label:Lyte.attr("string"),segments:Lyte.hasMany("wizard-segment",{serialize:"partial",deepNest:!0}),container:Lyte.belongsTo("wizard-container"),button:Lyte.hasMany("wizard-button"),conditional_rules:Lyte.hasMany("wizard-conditional-rule",{serialize:"partial",deepNest:!0}),conditional_actions:Lyte.hasMany("wizard-conditional-action"),_displaylabelObserver:function(){this.name=this.display_label}.observes("display_label").on("init")}),store.registerModel("wizard-segment",{id:Lyte.attr("string"),sequence_number:Lyte.attr("number"),type:Lyte.attr("string"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),fieldReorder:Lyte.attr("boolean"),column_count:Lyte.attr("number"),elements:Lyte.hasMany("wizard-element",{serialize:"partial",polymorphic:!0,deepNest:!0}),widget:Lyte.belongsTo("widget"),fields:Lyte.hasMany("field",{serialize:"partial",deepNest:!0}),query_components:Lyte.hasMany("wizard-query-component",{serialize:"partial"}),content:Lyte.attr("string",{default:""}),buttons:Lyte.hasMany("wizard-button",{serialize:"partial",deepNest:!0}),screen:Lyte.belongsTo("wizard-screen"),conditional_actions:Lyte.hasMany("wizard-conditional-action"),tab_traversal:Lyte.attr("string",{default:"left_to_right"}),didLoad:function(){var e=this instanceof Record?this:e;if("fields"!==e.type&&"composite"!==e.type||e.elements||store.pushPayload("wizard-segment",{id:e.id,elements:[]}),"subforms"===e.type){e.aggregateNewFields=e.fields.filter((e=>e.module&&e.subform&&"subform"!==e.data_type&&"static_subform"!==e.data_type));let t=e.fields.find((e=>"subform"===e.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===e.data_type));t&&(e.subformId=t.subform&&t.subform.id,e.subform_apiname=t.api_name,e.subformApiName=t.api_name)}}.on("init"),_displaylabelObserver:function(){"text_label"!==this.type&&(this.name=this.display_label)}.observes("display_label").on("init")}),store.registerModel("wizard-button",{id:Lyte.attr("string"),reference_id:Lyte.attr("string"),sequence_number:Lyte.attr("number"),display_label:Lyte.attr("string"),criteria:Lyte.attr("object"),target_screen:Lyte.belongsTo("wizard-screen"),type:Lyte.attr("string"),category:Lyte.attr("string"),resource:Lyte.attr("object"),message:Lyte.attr("object"),color:Lyte.attr("string"),background_color:Lyte.attr("string"),shape:Lyte.attr("string"),transition:Lyte.belongsTo("transition"),visibility:Lyte.attr("string"),segment:Lyte.belongsTo("wizard-segment"),profiles:Lyte.hasMany("profile",{serialize:"partial",deepNest:!0}),show_summary_on:Lyte.attr("string")}),store.registerModel("transition",{Id:Lyte.attr("string",{primaryKey:!0}),Name:Lyte.attr("string"),LayoutId:Lyte.attr("string"),Module:Lyte.attr("string"),Actions:Lyte.attr("object"),button:Lyte.belongsTo("wizard-button")}),store.registerModel("wizard-conditional-rule",{query_id:Lyte.attr("string",{primaryKey:!0}),criteria:Lyte.attr("object"),screen:Lyte.belongsTo("wizard-screen"),actions:Lyte.hasMany("wizard-conditional-action",{serialize:"partial",deepNest:!0}),execute_on:Lyte.attr("string")}),store.registerModel("wizard-conditional-action",{id:Lyte.attr("string"),rule:Lyte.belongsTo("wizard-conditional-rule"),type:Lyte.attr("string"),field:Lyte.belongsTo("field",{serialize:"partial",deepNest:!0}),segment:Lyte.belongsTo("wizard-segment",{serialize:"partial"}),screen:Lyte.belongsTo("wizard-screen"),value:Lyte.attr("string"),exempted_profiles:Lyte.hasMany("profile",{serialize:"partial",deepNest:!0}),exempted_portal_user_types:Lyte.hasMany("user_type",{serialize:"partial",deepNest:!0})}),store.registerModel("wizard-query-parameter",{id:Lyte.attr("string"),name:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"partial"}),comparator:Lyte.attr("string"),target_resource:Lyte.belongsTo("field",{serialize:"partial"}),target_resource_type:Lyte.attr("string"),parent_component:Lyte.belongsTo("wizard-query-component"),actions:Lyte.hasMany("wizard-query-action")}),store.registerModel("wizard-query-component",{id:Lyte.attr("string"),name:Lyte.attr("string"),type:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"partial"}),search_parameters:Lyte.hasMany("wizard-query-parameter",{serialize:"record",deepNest:!0}),segment:Lyte.belongsTo("wizard-segment",{inverse:"query_components"}),didLoad:function(){this._type=this.$.model._name,this.type="query_component"}},{actions:{execute:{}}}).extends("wizard-element"),store.registerAdapter("wizard-query-component",{namespace:"crm/v4/settings",buildURL:function(e,t,i,r,a,s,o){return a="action"===t&&"execute"===s?a.replace("wizard-query-component","query_components/"+o.component):a.replace("wizard-query-component","query_components")}}),store.registerSerializer("wizard-query-component",{normalizeResponse:function(e,t,i){return i.query_components?(i["wizard-query-component"]="findAll"===t?i.query_components:i.query_components[0],delete i.query_components,i):(i["wizard-query-component"]=[],i)},serializeKey:function(){return"query_components"},serialize:function(e,t,i,r,a,s,o){return"execute"===o?{execute:[{executor:{id:r.executor},value:r.searchTerm}]}:{query_components:[t.query_components]}},payloadKey:function(){return"wizard-query-component"}}),store.registerModel("wizard-query-action",{id:Lyte.attr("string"),search_parameter:Lyte.belongsTo("wizard-query-parameter",{serialize:"partial"}),executor:Lyte.belongsTo("wizard-screen",{serialize:"record"}),type:Lyte.attr("string"),category:Lyte.attr("string"),sequence_number:Lyte.attr("number"),arguments:Lyte.attr("array"),criteria:Lyte.attr("object"),needsCriteria:Lyte.attr("boolean"),didLoad:function(e){(e=this instanceof Record?this:e).criteria?e.needsCriteria=!0:e.needsCriteria=!1}.on("add","change")}),store.registerAdapter("wizard-query-action",{namespace:"crm/v4/settings",buildURL:function(e,t,i,r,a){return a=a.replace("wizard-query-action","query_actions")}}),store.registerSerializer("wizard-query-action",{serializeKey:function(){return"query_actions"},serialize:function(e,t){const i=this;if("deleteRecord"!==e){if(Array.isArray(t.query_actions))return t.query_actions.forEach((function(t){i.preparePayload(t,e)})),{query_actions:t.query_actions};{let r=t.query_actions;return i.preparePayload(r,e),{query_actions:[t.query_actions]}}}return{query_actions:[t.query_actions]}},payloadKey:function(e){if(e)return e},normalizeResponse:function(e,t,i){return i.query_actions?(i["wizard-query-action"]=i.query_actions.sort((function(e,t){return e.sequence_number-t.sequence_number})),"updateRecord"!==t&&"createRecord"!==t||(i["wizard-query-action"]=i.query_actions[0]),delete i.query_actions,i):(i["wizard-query-action"]=[],i)},preparePayload:function(e,t){let i=store.peekRecord("wizard-query-action",e.id||e.$.pK);e.query_component={id:i.search_parameter.parent_component.id},e.executor={id:i.executor&&i.executor.id},e.arguments&&e.arguments.length&&e.arguments.forEach((function(e){e.screen?e.screen={id:e.screen.id}:e.widget&&wizardUtil&&(wizardUtil.reload=!0)})),"createRecord"===t&&delete e.id}}),store.registerModel("dummy",{},{actions:{showModuleInfo:{},isModuleAccessable:{},moduleListPage:{},rlCount:{},dummyAction:{},kioskExecution:{},kioskAssociation:{},emailSummary:{}}}),store.registerAdapter("dummy",{buildURL:function(e,t,i,r,a,s,o){return a="/"===o.url[0]?a.slice(0,a.indexOf("/",8))+o.url:a.slice(0,a.indexOf("/",8)+1)+o.url,"false"===window.isSandboxAcc&&window.isCanvasSandboxDiff&&(a=a.replace("/crm/","/crm/v2/sandbox/diff/")),"true"===window.isSandboxAcc&&window.isCanvasProdDiff&&(a=a.replace("/crm/","/crm/v2/production/diff/")),a},methodForRequest:function(e,t,i,r){return r.method?r.method:"PATCH"===e?"PUT":e},headersForRequest:function(e,t,i){var r=i.customHeadersOnly?{}:this.$super.headersForRequest(),a=i?i.headers:void 0;if(i.hasOwnProperty("contentType")&&(r["Content-Type"]=i.contentType),!r.hasOwnProperty("X-CRM-ORG")){var s=store.peekAll("organization");s&&s.length>0&&(r["X-CRM-ORG"]=s[0].id)}if(a)for(var o in a)r[o]=a[o];return i&&(i.isSandboxDiff||i.isProductionDiff)&&(r["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),i&&"/zgssearch/fetchHandlerInfo"===i.url&&delete r["X-ZCSRF-TOKEN"],r}}),store.registerSerializer("dummy",{payloadKey:function(e){return e},serialize:function(e,t,i,r){var a=r.formData;if(r.payLoad)return r.payLoad;if(r.formData&&("showReviewPopup"===r.isFrom||"exportAdminTool"===r.isFrom||"voiceAssistance"===r.isFrom))return r.formData;if(a){var s=[];for(var o in a)s.push(encodeURIComponent(o)+"="+encodeURIComponent(a[o]));return s=s.join("&")}},normalizeResponse:function(e,t,i,r,a,s,o,n){if(i&&null!=n&&("POST"===n.method||"PUT"===n.method||"DELETE"===n.method)&&!i.dummy){var l={};return i.id="dummy",l.dummy=i,l}if(i&&void 0!==n&&n.hasOwnProperty("workflow_rules")&&!i.dummy){l={};return i.id="dummy",l.dummy=i,l}return i}}),store.registerModel("shift_hour",{break_hours:Lyte.attr("array"),details:Lyte.attr("array"),holiday:Lyte.attr("array"),id:Lyte.attr("string"),name:Lyte.attr("string"),same_as_everyday:Lyte.attr("boolean"),shift_days:Lyte.attr("array"),timezone:Lyte.attr("string"),users:Lyte.hasMany("user",{serialize:"partial"})}),store.registerAdapter("shift_hour",{namespace:"crm/v2/settings/business_hours",methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("shift_hour",{serialize:function(e,t){return t.shift_hours=[t.shift_hour],delete t.shift_hour,t},weekDays:[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],normalizeResponse:function(e,t,i,r,a){if("updateRecord"===t&&200===a){var s=i.shift_hours[0].details?i.shift_hours[0].details.id:"";delete i.shift_hours,i.shift_hours={id:s}}else 204===a&&(i[e]=void 0);var o=store.peekRecord("user",Crm.userDetails.USER_ID);if(("findAll"===t||"findRecord"===t)&&i.shift_hours&&o){function n(e,t,i){return"0"===t||"00"===t?"12"+i+" "+I18n.getMsg("AM"):t>12?(t-12<10?"0"+(t-12):t-12)+i+" "+I18n.getMsg("PM"):e+" "+I18n.getMsg("AM")}function l(e){for(var t=e.length,i=1;i<t;i++)if(e[i]&&this.weekDays.indexOf(I18n.getMsg(e[i]))!==this.weekDays.indexOf(I18n.getMsg(e[i-1]))+1)return!1;return!0}function d(e,t){for(var i,r,a=[],s=0,d=e.length+2,c=1,u=0;c<d&&(c!==d-1&&l.call(this,e.slice(s,c))||(c=c===d-1?c:c-1,a[u]={days:e.slice(s,c)},o.time_format.indexOf("a")>-1?(i=n(t[0],t[0].slice(0,t[0].indexOf(":")),t[0].slice(t[0].indexOf(":"))),r=n(t[1],t[1].slice(0,t[1].indexOf(":")),t[1].slice(t[1].indexOf(":"))),a[u].workHour=" ("+i+" - "+r+")"):a[u].workHour=" ("+t[0]+" - "+t[1]+")",u++,s=c,!(c>d-2)));c++);var m=a.length;for(c=0;c<m;c++)a[c].shiftInterval=a[c].days.length>1?I18n.getMsg(a[c].days[0])+" - "+I18n.getMsg(a[c].days[a[c].days.length-1]):I18n.getMsg(a[c].days[0]);return a}var c,u,m,p,_,f,y,g=i.shift_hours,v=g.length;if(g&&g[0]&&"error"!==g[0].status)for(var h=0;h<v;h++){if(g[h].continuousWorkDays=l.call(this,g[h].shift_days),g[h].continuousWorkDays?g[h].shiftInterval=g[h].shift_days.length>1?I18n.getMsg(g[h].shift_days[0])+" - "+I18n.getMsg(g[h].shift_days[g[h].shift_days.length-1]):I18n.getMsg(g[h].shift_days[0]):!g[h].continuousWorkDays&&g[h].same_as_everyday&&(g[h].nonContinuousWorkDays=d.call(this,g[h].shift_days,g[h].details)),p=g[h].details,o.time_format.indexOf("a")>-1&&g[h].same_as_everyday)c=n(p[0],p[0].slice(0,p[0].indexOf(":")),p[0].slice(p[0].indexOf(":"))),u=n(p[1],p[1].slice(0,p[1].indexOf(":")),p[1].slice(p[1].indexOf(":"))),g[h].workHour=" ("+c+" - "+u+")";else if(-1===o.time_format.indexOf("a")&&g[h].same_as_everyday)g[h].workHour=" ("+p[0]+" - "+p[1]+")";else if(o.time_format.indexOf("a")>-1&&!g[h].same_as_everyday){_=p.length;for(var b=0;b<_;b++)f=p[b].shift_timing[0],y=p[b].shift_timing[1],c=n(f,f.slice(0,f.indexOf(":")),f.slice(f.indexOf(":"))),u=n(y,y.slice(0,y.indexOf(":")),y.slice(y.indexOf(":"))),p[b].workHour=" ("+c+" - "+u+")"}else{_=p.length;for(b=0;b<_;b++)p[b].workHour=" ("+p[b].shift_timing[0]+" - "+p[b].shift_timing[1]+")"}m=g[h].users?g[h].users.length:0;for(b=0;b<m;b++)g[h].users[b].effective_from?g[h].users[b].effective_shift_hour=g[h].id:g[h].users[b].current_shift_hour=g[h].id}}return i}}),store.registerModel("search-history",{record:Lyte.attr("object"),module:Lyte.attr("object"),source:Lyte.attr("string")}),store.registerAdapter("search-history",{namespace:"crm/v2",buildURL:function(e,t,i,r,a){return a=a.replace(e,"recent_items")}}),store.registerSerializer("search-history",{normalizeResponse:function(e,t,i){return i.search_history=i.recent_items,i}}),store.registerModel("layout_rule",{layout:Lyte.belongsTo("layout")}),store.registerAdapter("layout_rule",{buildURL:function(e,t,i,r,a,s,o){return a=a.replace(e,"layouts/"+o+"/rules")},namespace:"crm/v4.1/settings"}),store.registerSerializer("layout_rule",{normalizeResponse:function(e,t,i,r,a,s,o,n){if(Lyte.Component.registeredHelpers.isEmpty(i))return{layout_rule:[]};for(var l=i.rules.length,d=0;d<l;d++)i.rules[d].hasOwnProperty("id")||(i.rules[d].id=n+"_"+d),i.rules[d].layout=n;return i},payloadKey:function(){return"rules"}}),store.registerModel("validation_rule",{active:Lyte.attr("boolean"),created_time:Lyte.attr("string"),execution_type:Lyte.attr("string"),field_validation:Lyte.attr("boolean"),field:Lyte.belongsTo("field",{serialize:"record"}),associated_function:Lyte.attr("object"),generated_type:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),layout:Lyte.belongsTo("layout"),modified_by:Lyte.belongsTo("user",{serialize:"record"}),modified_time:Lyte.attr("string"),source:Lyte.attr("string"),validation_type:Lyte.attr("string"),conditions:Lyte.attr("array")},{actions:{rule_dependencyData:{},records_count:{endpoint:"records_count"}}}),store.registerAdapter("validation_rule",{namespace:"crm/v2.1/settings",buildURL:function(e,t,i,r,a,s,o){a=a.replace("validation_rule","validation_rules");return("action"===t&&"records_count"===s||o&&"v2.2"===o.version||"updateRecord"===t||"createRecord"===t)&&(a=a.replace("v2.1","v2.2")),o&&o.id&&"delete"===t&&(a=a+"/"+o.id),o&&o.actions&&"rule_dependencyData"===o.actions&&(a=a+"/actions/"+o.actions),a},methodForRequest:function(e,t,i,r,a){return"rule_dependencyData"===a?"GET":"create"===t?"POST":e},parseResponse:function(e,t,i,r,a){if(r&&a&&a.layout_id)for(var s=a.layout_id,o=r.validation_rules?r.validation_rules.length:0,n=0;n<o;n++)r.validation_rules[n].layout=s;return r}}),store.registerSerializer("validation_rule",{normalizeResponse:function(e,t,i){return"create"===t||"createRecord"===t||"updateRecord"===t?((i=i&&i.validation_rules?i.validation_rules[0]:i)&&i.details&&i.details.id&&(i.id=i.details.id),{validation_rule:i}):Lyte.Component.registeredHelpers.isNotEmpty(i)?(i[e]=i.validation_rules?i.validation_rules:[],delete i.validation_rules,i):(i[e]=[],i)},serialize:function(e,t){return"updateRecord"===e&&(t.validation_rules=[t.validation_rule],delete t.validation_rule),"createRecord"===e?(t.validation_rules=[t.validation_rule],delete t.validation_rule,Lyte.deepCopyObject(t)):t},payloadKey:function(e){if(e)return e}}),store.registerModel("widget",{widgets_id:Lyte.attr("string",{primaryKey:!0}),file_name:Lyte.attr("string"),hosting:Lyte.attr("string"),permissions:Lyte.attr("object"),name:Lyte.attr("string"),base_url:Lyte.attr("string"),description:Lyte.attr("string"),active:Lyte.attr("boolean"),source:Lyte.attr("string"),type:Lyte.attr("string"),associated_places:Lyte.attr("array",{default:[]}),segment:Lyte.hasMany("wizard-segment",{serialize:"partial",deepNest:!0})}),store.registerAdapter("widget",{namespace:"crm/v2/settings",buildURL:function(e,t,i,r,a,s,o){for(var n in o)i[n]=o[n];return a.replace("widget","widgets")}}),store.registerSerializer("widget",{normalizeResponse:function(e,t,i){return"findAll"!=t&&"findRecord"!=t||i?i:{widget:[]}},payloadKey:function(){return"crm_widgets"}}),store.registerModel("stage",{id:Lyte.attr("string"),display_label:Lyte.attr("string"),forecast_category:Lyte.attr("object"),forecast_type:Lyte.attr("string"),name:Lyte.attr("string"),probability:Lyte.attr("number"),sequence_number:Lyte.attr("number")}),store.registerAdapter("stage",{namespace:"crm/v2/settings"}),store.registerSerializer("stage",{}),store.registerModel("accessibility",{id:Lyte.attr("string"),interaction:Lyte.attr("object"),motor:Lyte.attr("object"),vision:Lyte.attr("object"),accessibility_meta:Lyte.attr("array")},{actions:{reset:{},fetch:{},update:{}}}),store.registerAdapter("accessibility",{namespace:"crm/v7/settings",buildURL:function(e,t,i,r,a,s){return"action"===t&&("fetch"===s?a=a.replace(/\/actions\/fetch$/,""):"update"===s&&(a=a.replace(/\/actions\/update$/,""))),a},methodForRequest:function(e,t,i,r,a){if("action"===t){if("reset"===a||"update"===a)return"PUT";if("fetch"===a)return"GET"}else if("create"===t||"createRecord"===t)return"PUT";return e}}),store.registerSerializer("accessibility",{normalizeResponse:function(e,t,i){return i&&i[e]&&(i[e].id="1accessibility",i[e].accessibility_meta="accessibility_meta"in i?i.accessibility_meta:void 0),i},serialize:function(e,t,i,r,a,s,o){return"create"===e||"createRecord"===e?i:"action"===e&&"update"===o?r:t}});
