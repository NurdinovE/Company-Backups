Lyte.Component.register("crm-prediction-canvas-detail-page",{_template:'<template tag-name="crm-prediction-canvas-detail-page"> <template is="if" value="{{isTitleNeeded}}"><template case="true"> <span id="title" class="dIPredictionlabel crmHeadingColor crm-medium-large-font-size crm-font-bold dIB mB5 w100_per">{{getI18n(\'crm.predictions.feature.label\')}}</span> </template></template> <crm-field-prediction-result prediction="{{prediction}}" is-canvas="true" is-new-view="true"></crm-field-prediction-result> <div class="crmNotFoundColor dIB lh18 vaM w100_per aligncenter mB20" style="font-size: 12px;text-align: center;display: none" id="noResultPrediction"> <div class="dIB vaM">{{getI18n(\'crm.zia.no.record.prediction\')}}</div> </div> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]},{type:"text",position:[5,1,0]}],_observedAttributes:["prediction","module","layoutId","record","meta_info","isNewView"],data:function(){return{prediction:Lyte.attr("array",{default:[]}),module:Lyte.attr("string"),layoutId:Lyte.attr("string"),record:Lyte.attr("object"),meta_info:Lyte.attr("object"),isNewView:Lyte.attr("boolean")}},didConnect:function(){var e=this,t=e.getData("module"),i=e.getData("record"),a=store.peekAll("field"),o=e.getInsightsV2(moduleRecordMapping[t],i.id,{keys:"predictions_data",include_inner_details:"predictions_data.output.critical_fields.field_label"},null,"prediction");if(o)o.then((function(t){if(t&&t.zia_insights&&t.zia_insights.predictions_data){for(var o=e.$node,n=o.getData("prediction"),s=n.length,r=[],l=0;l<s;l++)r.push(n[l].id);var p=t.zia_insights.predictions_data,d=null!==p?p.length:0;if(null!==p&&p.length>0)for(var c=[CrmField.UITYPES.BOOLEAN_DEF_NOT,CrmField.UITYPES.BOOLEAN_DEF],m=[CrmField.UITYPES.CURRENCY,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP],u=0;u<d;u++){var y=p[u],f={};f.id=y.prediction.id,f.name=y.prediction.name,f.trend=y.output.trend,y.output.critical_fields&&(f.critical_fields=y.output.critical_fields);for(var v=y.prediction,g=a.length,_=0;_<g;_++){if(a[_].id===v.predict_field.id&&(f.label=a[_].field_label),a[_].id===v.prediction_field.id&&i[a[_].api_name]){var x=parseInt(a[_].ui_type);if(f.value=i[a[_].api_name],!e.getData("isTitleNeeded")&&m.indexOf(x)>-1){var b=Crm.userDetails,h=i[a[_].api_name],N=returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:b.BASE_CURRENCY?b.BASE_CURRENCY:b.defaultCurrencyISOCode;featuresAvailable.MultiCurrency&&void 0!==b.CURRENCY_DETAILS[N]?returnJson.entityMapJson.EXCHANGERATE&&returnJson.entityMapJson.EXCHANGERATE.defaultvalue?f.value=currencyUtils.returnValueInDefaultCurrency(N,h,Crm.userDetails.CURRENCY_DETAILS[N].decimals,parseFloat(returnJson.entityMapJson.EXCHANGERATE.defaultvalue),x,void 0):f.value=currencyUtils.returnValueInDefaultCurrency(N,h,Crm.userDetails.CURRENCY_DETAILS[N].decimals,void 0,x,void 0):f.value=currencyUtils.returnValueInDefaultCurrency(N,h,void 0,void 0,x,void 0)}}v.score_to&&a[_].id===v.score_to.id&&i[a[_].api_name]&&(f.score=i[a[_].api_name])}!r.contains(f.id)&&f.label&&f.value&&"null"!==f.value&&(c.indexOf(x)>-1?void 0!==f.score&&Lyte.arrayUtils(o.component.getData("prediction"),"push",f):f.value&&Lyte.arrayUtils(o.component.getData("prediction"),"push",f))}0!==(I=$L(e.$node).find("#noResultPrediction")).length&&(o.component.getData("prediction").length?I.hide():I.show())}else{var I;0!==(I=$L(e.$node).find("#noResultPrediction")).length&&I.show()}}));else{var n=$L(e.$node).find("#noResultPrediction");0!==n.length&&n.css("display","block")}}},{mixins:["crm-prediction-utils","zia-insights-utils"]}),Lyte.Component.register("crm-field-prediction-result",{_template:'<template tag-name="crm-field-prediction-result"> <template is="if" value="{{expHandlers(prediction.length,\'>\',0)}}"><template case="true"> <div class="dIB h100_per w100_per"> <div class="flexAlignCenter spaceBetween"> <div class="crm-font-bold crmHeadingColor {{if(isCanvas,\'vH\',\'\')}} crm-medium-large-font-size">{{getI18n("crm.predictions.feature.label")}}</div> <lyte-navigator on-next="{{method(\'onNextPrediction\')}}" on-previous="{{method(\'onPreviousPrediction\')}} " lt-prop-yield="true" lt-prop-value="1" lt-prop-records="100" lt-prop-perpage="5"> <template is="registerYield" yield-name="navigatorYield"> <div class="dF"> <div class="{{if(expHandlers(currentIndex,\'==\',0),\'crm_rDet_predict_arrows op4\',\'cP\')}}"> <div data-zcqa="previous_predictions" class=" lyteNavigator lyteIconSingleBack lyteSingleBack {{if(expHandlers(currentIndex,\'==\',0),\'peNone \',\'\')}} "></div> </div> <div class="{{if(expHandlers(currentIndex,\'==\',expHandlers(prediction.length,\'-\',1)),\'crm_rDet_predict_arrows op4\',\'cP\')}}"> <div data-zcqa="next_predictions" class=" lyteNavigator lyteIconSingleFront lyteSingleFront {{if(expHandlers(currentIndex,\'==\',expHandlers(prediction.length,\'-\',1)),\'peNone \',\'\')}}"></div> </div> </div> </template> </lyte-navigator> </div> <div class=" w100_per oH dIB"> <div class="crm_rDet_predict_subcontainer dF spaceBetween pR h100_per" style="width: calc( 100% * {{prediction.length}}); {{if(isRTLEnabled,\'right\',\'left\')}}: calc( -100% * {{currentIndex}})"> <template is="for" items="{{prediction}}" item="predi" index="index"> <div class=" pR dIB" style="width: calc( 100% / {{prediction.length}});"> <crux-form-component class="cruxFormViewComponent mT20"> <template is="registerYield" yield-name="cruxFormComponent"> <div class="crmFormComponentRow"> <div class="lyteLabel">{{predi.label}}</div> <div class="lyteField"> <template is="if" value="{{predi.uitype}}"><template case="true"> {{getDateTime(predi.value,predi.uitype)}} </template><template case="false"> {{predi.value}} </template></template> </div> </div> <template is="if" value="{{predi.score}}"><template case="true"> <div class="crmFormComponentRow"> <div class="lyteLabel">{{getI18n("crm.prediction.analytics.chart.active.score")}}</div> <div class="lyteField">{{predi.score}}</div> </div> </template></template> <template is="if" value="{{ifNotEquals(predi.trend,&quot;neutral&quot;)}}"><template case="true"> <div class="crmFormComponentRow"> <div class="lyteLabel noLabelPadding">{{getI18n("crm.intelligence.trend")}}</div> <div class="lyteField"> <template is="if" value="{{ifEquals(predi.trend,&quot;up&quot;)}}"><template case="true"> <div class=" w30 boxBB h17 crm_rDet_predict_trend_up br30 flexAlignCenter jcCenter"> <span class="zcicncss-marketup zcicn-cssIcons zcicn_green_mask"></span> </div> </template><template case="false"><template is="if" value="{{ifEquals(predi.trend,&quot;down&quot;)}}"><template case="true"> <div class=" w30 boxBB h17 crm_rDet_predict_trend_down br30 flexAlignCenter jcCenter"> <span class="zcicncss-marketdown zcicn-cssIcons zcicn_red_mask"></span> </div> </template></template></template></template> </div> </div> </template></template> </template> </crux-form-component> <template is="if" value="{{isNotEmpty(predi.critical_fields)}}"><template case="true"> <div class="mT25 bg_crmBg2 br10 w100_per p20 boxBB"> <div class="dF "> <crmutil-icon icon-name="bulb-reg-colored" icon-class="zcicn-bulb-reg-colored mT2"></crmutil-icon> <div class="mL10"> <div class="crmHeadingColor crm-font-bold lh22">{{getI18n("crm.prediction.critical_fields")}}</div> <div class="mL14 mT13"> <template is="for" items="{{predi.critical_fields}}" item="critical_field" index="index"> <div class="crm_rDet_predict_enhance_items crmParagraphColor pR {{if(expHandlers(index,\'==\',0),\'\',\'mT10\')}}">{{critical_field.field_label}}</div> </template> </div> </div> </div> </div> </template></template> <div class="crmLinkColor mT20 alignRight"> <span class="cP" data-zcqa="reasoningLink" id="getTheFactsDiv{{predi.id}}" onclick="{{action(\'getFacts\',this,predi.id)}}">{{getI18n("crm.login.learn.more")}}</span> </div> </div> </template> </div> </div> <template is="if" value="{{ifEquals(isNewView,true)}}"><template case="true"> <lyte-popover lt-prop-show="{{lbind(predorginShow)}}" lt-prop-scrollable="true" lt-prop-origin-elem="#{{predorginElem}}" lt-prop-wrapper-class="prediction_findfactors" lt-prop-content-padding="0px 0px" id="prediction_findfactors" lt-prop-freeze="false" lt-prop-width="287px" lt-prop-close-on-body-click="true" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="predictionHeader pT15 pB10 pL25 pR25 w100_per"> <div data-zcqa="predictionName_reason" class="crm-font-bold crmHeadingColor wbBreakWord crm-subheading-font-size ">{{name}}</div> </div> <div class="predictiondropContainer pL25 pR25 pT25 pB20 w100_per"> <template is="if" value="{{expHandlers(if_gt_len(positive,0),\'||\',if_gt_len(negative,0))}}"><template case="true"> <template is="if" value="{{if_gt_len(positive,0)}}"><template case="true"> <div class="mB15"> <crmutil-icon icon-name="emoji-smile" icon-class="zcicn-emoji-smile zcicn-green-bg-filled mR5 zcicn16"></crmutil-icon> <span data-zcqa="positive_reason" class="vaM mL1 crm-font-semibold reasoningSubTitleText crm-base-font-size crmHeadingColor">{{getI18n("crm.prediction.reason.positive")}}</span></div> <ul class="p0 m0 mB20"> <template is="for" items="{{positive}}" item="factor" index="index"> <li class="pL20 mB5 lh24 crm-font-regular reasoningSubTitleText crm-base-font-size crmBaseColor posListGreen mL5 wbBreakWord"> {{factor.field.field_label}}<template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;less_than&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} {{getI18n("crm.condition.less")}} </template><template case="false"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;greater_than&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} {{getI18n("crm.condition.greater")}} </template><template case="false"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;equal&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} </template><template case="false"> {{getI18n("between")}} </template></template></template></template></template></template><template is="if" value="{{expHandlers(factor.values,\'!=\',&quot;&quot;)}}"><template case="true"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;between&quot;)}}"><template case="true">{{factor.values[0]}} to {{factor.values[1]}}</template><template case="false">{{factor.values}}</template></template></template><template case="false">{{getI18n("crm.condition.a.value.empty")}}</template></template> </li> </template> </ul> </template></template> <template is="if" value="{{if_gt_len(negative,0)}}"><template case="true"> <div class="mB15"> <crmutil-icon icon-name="emoji-sad" icon-class="zcicn-emoji-sad zcicn16 zcicn-red-bg-filled mR5"></crmutil-icon> <span data-zcqa="negative_reason" class="vaM crm-font-semibold reasoningSubTitleText crm-base-font-size crmHeadingColor mL1">{{getI18n("crm.prediction.reason.negative")}}</span></div> <ul class="p0 m0"> <template is="for" items="{{negative}}" item="factor" index="index"> <li class="pL20 mB5 lh24 crm-font-regular negListRed crmBaseColor reasoningSubTitleText crm-base-font-size mL5 wbBreakWord"> {{factor.field.field_label}}<template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;less_than&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} {{getI18n("crm.condition.less")}} </template><template case="false"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;greater_than&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} {{getI18n("crm.condition.greater")}} </template><template case="false"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;equal&quot;)}}"><template case="true"> {{getI18n("crm.label.is")}} </template><template case="false"> {{getI18n("between")}} </template></template></template></template></template></template><template is="if" value="{{expHandlers(factor.values,\'!=\',&quot;&quot;)}}"><template case="true"><template is="if" value="{{expHandlers(factor.comparator,\'===\',&quot;between&quot;)}}"><template case="true">{{factor.values[0]}} to {{factor.values[1]}}</template><template case="false">{{factor.values}}</template></template></template><template case="false">{{getI18n("crm.condition.a.value.empty")}}</template></template> </li> </template> </ul> </template></template> </template><template case="false"> <div class="crm-font-regular crmLabelColor reasoningSubTitleText crm-base-font-size">{{getI18n("crm.prediction.reason.none")}}</div> </template></template> </div> </lyte-popover-content> </template> </lyte-popover> </template></template> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,3]},{type:"registerYield",position:[1,1,3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]}]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,3,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width: calc( 100% * '","prediction.length","'); '",{type:"helper",value:{name:"if",args:["isRTLEnabled","'right'","'left'"]}},"': calc( -100% * '","currentIndex","')'"]}}}},{type:"attr",position:[1,3,1,1]},{type:"for",position:[1,3,1,1],dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width: calc( 100% / '","prediction.length","');'"]}}}},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"text",position:[1,3,0]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[]}},default:{}}]}},default:{}}]}},default:{}}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"attr",position:[1,1,3,3,1]},{type:"for",position:[1,1,3,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}]}},default:{}},{type:"attr",position:[1,5,1]},{type:"text",position:[1,5,1,0]}]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3,1]},{type:"for",position:[3,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,4]},{type:"if",position:[1,4],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[0]},{type:"text",position:[2]}]},false:{dynamicNodes:[{type:"text",position:[0]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[0]}]}},default:{}}]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,0]},{type:"attr",position:[3,1]},{type:"for",position:[3,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,4]},{type:"if",position:[1,4],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[0]},{type:"text",position:[2]}]},false:{dynamicNodes:[{type:"text",position:[0]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[0]}]}},default:{}}]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}],_observedAttributes:["currentIndex","prediction","isCanvas","isNewView","record","module","layout_id","meta_info","name","tabId","recordId","positive","negative","predorginElem","predorginShow","isRTLEnabled"],data:function(){return{currentIndex:Lyte.attr("number",{default:0}),prediction:Lyte.attr("array"),isCanvas:Lyte.attr("boolean",{default:!1}),isNewView:Lyte.attr("boolean"),record:Lyte.attr("object"),module:Lyte.attr("string"),layout_id:Lyte.attr("string"),meta_info:Lyte.attr("object"),name:Lyte.attr("string"),tabId:Lyte.attr("string"),recordId:Lyte.attr("string"),positive:Lyte.attr("array",{default:[]}),negative:Lyte.attr("array",{default:[]}),predorginElem:Lyte.attr("string"),predorginShow:Lyte.attr("boolean"),isRTLEnabled:Lyte.attr("boolean",{default:Crm.userDetails.RTL_ENABLED})}},actions:{getFacts:function(e,t){var i,a=this;if(this.getData("prediction").filter((function(e){e.id===t&&(i=e.name)})),this.setData("name",i),!this.getData("tabId")||!this.getData("recordId")){var o=this.getData("tabid"),n=this.getData("recordid");this.setData("tabId",o),this.setData("recordId",n)}commonUtils.showHideLoadingDiv(!0),store.findRecord("dummy",t,{},void 0,!1,{url:"crm/v2.2/__internal/"+store.peekRecord("module",this.getData("tabId")).api_name+"/"+this.getData("recordId")+"/actions/prediction_reasoning?prediction_id="+t+"&include_inner_details=positive_facts.reasoning_fields.field.field_label,negative_facts.reasoning_fields.field.field_label"}).then((function(e){void 0!==e.reasoning?(Crm.client_tracking("Zia Reasoning",{Operation:"Factors Available"}),a.setData("positive",e.reasoning.positive_facts.reasoning_fields),a.setData("negative",e.reasoning.negative_facts.reasoning_fields)):Crm.client_tracking("Zia Reasoning",{Operation:"Factors Not Available"}),a.setData("predorginElem","getTheFactsDiv"+t),a.setData("predorginShow",!0),commonUtils.showHideLoadingDiv(!1)}),(function(){Crm.client_tracking("Zia Reasoning",{Operation:"Factors Not Available"}),a.setData("predorginElem","getTheFactsDiv"+t),a.setData("predorginShow",!0),commonUtils.showHideLoadingDiv(!1)}))}},methods:{onNextPrediction:function(){var e=this.getData("currentIndex");this.setData("currentIndex",e+1)},onPreviousPrediction:function(){var e=this.getData("currentIndex");this.setData("currentIndex",e-1)}}});
