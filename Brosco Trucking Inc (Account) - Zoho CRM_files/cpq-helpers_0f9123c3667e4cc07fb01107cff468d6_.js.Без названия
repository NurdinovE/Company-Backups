Lyte.Component.registerHelper("checkSelected",(function(e,t){return e===t?"true":"false"})),Lyte.Component.registerHelper("isCpqDashboardConfigEditable",(function(){return Crm.userDetails.permissions.Crm_Implied_Edit_CPQ_Quotes_dashboard&&Crm.userDetails.permissions.Crm_Implied_Manage_Dashboards})),Lyte.Component.registerHelper("hasPriceRuleEditPermission",(function(){return!0!=!Crm.isCpqActivated()&&Crm.userDetails.permissions.Crm_Implied_Edit_CPQ_Price_Rules})),Lyte.Component.registerHelper("cpqGsgetmaxWidthClass",(function(e){return e>125||e>90?"w90_per":""})),Lyte.Component.registerHelper("hasProductConfiguratorEditPermission",(function(){return!0!=!Crm.isCpqActivated()&&Crm.userDetails.permissions.Crm_Implied_Edit_CPQ_Product_Configurator})),Lyte.Component.registerHelper("getLabelForCPQModulesFromMixin",(function(e,t){return this.component.getLabelForCPQModules(e,t)})),Lyte.Component.registerHelper("compareCPQRulesLimit",(function(e,t){return this.component.comparePCPRLimit(e,t)})),LyteComponent.registerHelper("getTrimmedDisplayLabelForPRCurrencyAndNumberField",(function(e,t){if(void 0!==e&&void 0!==t){var r=e.field_label;return void 0!==e.custom_field&&!0===e.custom_field&&r.length>t?r.substring(0,t)+"..":r}})),LyteComponent.registerHelper("getTrimmedDisplayLabelForPRPercentageFieldAndModule",(function(e){if(void 0!==e)return e.length>14?e.substring(0,14)+"..":e})),Lyte.Component.registerHelper("getModulePluralLabelByAPIName",(function(e,t){var r=Object.values(moduleRecordMapping).find((t=>t.api_name===e));return r?r.plural_label:t?t.name:""})),Lyte.Component.registerHelper("getCurrency",(function(){var e=Crm.userDetails.BASE_CURRENCY?Crm.userDetails.BASE_CURRENCY:Crm.userDetails.DEFAULT_ORG_CURRENCY?Crm.userDetails.DEFAULT_ORG_CURRENCY.symbol:Crm.userDetails.defaultOrgCurrency;return Crm.userDetails.CURRENCY_DETAILS[e]?Crm.userDetails.CURRENCY_DETAILS[e].symbol:e})),LyteComponent.registerHelper("getCpqHelpUrl",(function(){return RebrandLinkUtil.getProperty("KB_CRM_URL")+"/cpq/articles/what-is-cpq"})),Lyte.Component.registerHelper("checkForGSTitleEllipsis",(function(e,t,r,i){if("listview"===i)var o=$L("#zcpqGsTitleDummySpan").text(t),a=parseInt(o.outerWidth());else if("createpage"===i)o=$L("#zcpqGsQuestionDummySpan").text(t),a=parseInt(o.outerWidth());return"e"===r&&a>=e?"mw"+e:"c"===r&&a>=e?"elipse_toE":"t"===r&&a>=e?t:""})),Lyte.Component.registerHelper("getCPQHowItWorksUrl",(function(){return RebrandLinkUtil.getProperty("KB_CRM_URL")+"cpq/articles/how-it-works"})),Lyte.Mixin.register("cpq-rules-util",{setFinalItemsForPR:function(e,t,r){this.setData("finalProductsForPR["+e+"].fields",[]),this.setData("finalProductsForPR["+e+"].fields",this.getData("noneArrayForFields")),this.setData("finalProductsForPR["+e+"].disabled",[]),"Direct"===r?this.setPRActionPanelDirectInputNone(t[e]):"Volume"===r&&(this.setData("PRProductAndBundleRowsCount."+t[e].productId,[]),Lyte.arrayUtils(this.getData("PRProductAndBundleRowsCount."+t[e].productId),"push","row"),$L("#pricingTypeDropDown_"+t[e].productId)[0].ltProp("selected","none"),this.initialiseVolumeActionInputs(t[e].productId)),this.showAndHidePercentageFieldsDropdown(t[e].productId,"none")},onFailureShowAlert:function(e){$L("#configuratormessagebox")[0].ltProp({type:"error",message:e,show:!0}),commonUtils.showHideLoadingDiv(!1)},setMarginsFromMixin:function(){this.getData("cpqPcArray.length")>=1&&this.getData("cpqActionArray.length")>=1&&$L("crm-productconfigurator-header")[0].component.setData("isPcProcessing",!1),$L("div.lyteExpTableOrigTableInnerWrap").scrollLeft(0),this.executeMethod("setMarginForCards")},setFieldBasedComparator_mixin:function(e,t){"integer"!==e.data_type&&"bigint"!==e.data_type&&"double"!==e.data_type||!e.crypt||null===e.crypt||(t=[{system:"${EMPTY}",display:_cruxUtils.getI18n("is empty")},{system:"${NOTEMPTY}",display:_cruxUtils.getI18n("is not empty")}]);return t},resetCriteriaEditor:function(){let e=this.getData("addItemFrom");if("fromAddItems"===e||"commonCrt"===e){var t="#testCriteria";this.setData("isAllQuotesConditionalCriteriaSelected",!1),$L(t)[0].getData("showEdit")&&$L(t)[0].resetCriteria()}},removeDropdownErrorMessage:function(e){renderingUtils.hideLyteErrorMessages(e),e.removeClass("lyteErrorBorder")},removeErrorMessages:function(e){var t=$L(e+" .lyteField");renderingUtils.hideLyteErrorMessages(t),t.removeClass("lyteErrorBorder")},constructDropDownOption:function(e,t){var r={};if(t&&e.action_type&&(r.type=e.action_type),e.module&&(r.module={},r.module.name=this.getModulePluralLabelByAPIName(e.module.api_name,e.module),r.module.value=e.module.id),e.layout&&(r.layout={},r.layout.name=e.layout.name,r.layout.value=e.layout.id),!t&&e.subform_module){r.subform={};let t=this.getModulePluralLabelByAPIName(e.subform_module.api_name,e.subform_module);r.subform.name=t||e.subform_module.name,r.subform.value=e.subform_module.id}return t&&e.field.module&&(r.subform={},r.subform.name=this.getModulePluralLabelByAPIName(e.field.module.api_name,e.field),r.subform.value=e.field.module.id),t&&e.field&&(r.field={},r.field.name=e.field.name,r.field.value=e.field.id),r},resetPRfieldFilter:function(){var e=$L("#PRFieldsListDropdown")[0];e.setData("ltPropSelected","Field - All"),e.setData("ltPropDisabled",!0),this.setData("fieldFilteredArray",[])},getDropDownOptions:function(e,t){for(var r,i=this.getData("options"),o=i.length,a=[],s=0;s<o;s++)"module"===e&&i[s].module?a.push(i[s].module):"layout"===e&&i[s].layout&&i[s].module.value===t?("Standard"===i[s].layout.name&&(i[s].layout.name=I18n.getMsg("Standard")),a.push(i[s].layout)):"subform"===e&&i[s].subform&&i[s].layout.value===t?a.push(i[s].subform):"PRfields"===e&&i[s].field&&i[s].subform.value===t&&a.push(i[s].field);switch(r=a.filter(((e,t,r)=>t===r.findIndex((t=>JSON.stringify(t.value)===JSON.stringify(e.value))))),e){case"module":Lyte.arrayUtils(this.getData("dropdownOption"),"push",r);break;case"layout":Lyte.arrayUtils(this.getData("layoutDropDownOption"),"push",r);break;case"subform":Lyte.arrayUtils(this.getData("subFormDropDownOption"),"push",r);break;case"PRfields":Lyte.arrayUtils(this.getData("fieldPRDropdownOption"),"push",r)}},setPRRelatedDropdowns:function(e){"priceRules"===this.getData("cpqRuleType")&&this.setData({disableCurrencyField:e,disableRangeField:e,"createRulePopup[6].isDisable":e,"createRulePopup[7].isDisable":e})},getRemoveSelectedCurrencyFieldFromPercentageFields:function(e,t){for(var r=[],i=e.length,o=0;o<i;o++){var a=e[o];if(a.id!==t.id)if(void 0!==a.formula&&void 0!==a.formula.expression&&a.formula.expression.includes(t.api_name)){var s=Lyte.deepCopyObject(e[o]);s.class="pointerEvents",r.push(s)}else r.push(Lyte.deepCopyObject(e[o]))}return r},getParentAndSubModules:function(e){for(var t={},r=[this.getData("noneArrayForModules[0]")],i=e.length,o=0;o<i;o++){let r;if(!0===(s=e[o]).viewable&&!0===s.visible&&null==s.private_profile&&"org_based"===s.access_type&&(r=!0),("subform"===s.generated_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===s.generated_type)&&r&&"team_based"!==s.access_type){var a=s.parent_module&&s.parent_module.id;a&&(t[a]=t[a]||[],t[a].push(Lyte.deepCopyObject(s)))}}for(o=0;o<i;o++){var s;"ZohoCPQ__s"!==(s=e[o]).api_name&&t[s.id]&&"team_based"!==s.access_type&&r.push(Lyte.deepCopyObject(s))}this.setData("modulesListInCrm",r),this.setData("parentModulesArray",r),this.setData("parentAndSubModuleObject",t),this.getDataforPriceRules(!1,null)},onRulesModuleSelected:function(e,t,r){if(e&&t){this.setData("parentModuleSelected",t);var i=Object.values(moduleRecordMapping).find((e=>e.id===t));if(i&&this.setData("parentModuleSelectedRecord",i),this.setData("layoutsForSelectedModule",[]),this.setData("layoutSelected",""),this.setData("submodulesForSelectedModule",this.getData("noneArrayForSubModules")),this.setData("subModuleSelected",""),this.setData("lookupModules",this.getData("noneArrayForLookup")),this.setData("lookUpSelected",""),"priceRules"===this.getData("cpqRuleType")&&(this.setData("PRCurrencyFieldsArray",this.getData("noneArrayForCurrencyField")),this.setData("PRNumberFieldsArray",this.getData("noneArrayForCurrencyField"))),"none"!==t)commonUtils.showHideLoadingDiv(!0),store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/settings/fields?module="+this.getData("parentModuleSelectedRecord").api_name+"&type=all",method:"GET"}).then(function(e){this.setData("selectedModuleFields",e.fields.filter((e=>17!==e.show_type&&0!==e.show_type))),this.executeMethod("changeNextButton",r,!0,!0)}.bind(this)),this.getLayoutsForSelectedModule();else this.setData("layoutsForSelectedModule",this.getData("noneArrayForLayouts")),this.executeMethod("changeNextButton",r,!0,!0)}},getLayoutsForSelectedModule:function(){var e=Crm.userDetails.PROFILE_ID;store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/settings/layouts?module="+this.getData("parentModuleSelectedRecord").api_name,method:"GET"}).then(function(t){commonUtils.showHideLoadingDiv(!1);var r=[],i=t.layouts.length;for(let o=0;o<i;o++){let i=t.layouts[o].profiles,a=i.length;for(let s=0;s<a;s++)i[s].id===e&&"inactive"!==t.layouts[o].status&&r.push(t.layouts[o])}r.length>0?(Lyte.arrayUtils(this.getData("layoutsForSelectedModule"),"push",Lyte.deepCopyObject(this.getData("noneArrayForLayouts"))),Lyte.arrayUtils(this.getData("layoutsForSelectedModule"),"push",Lyte.deepCopyObject(r))):this.onFailureShowAlert(I18n.getMsg("cpq.layout.fetch.error"))}.bind(this),function(){this.onFailureShowAlert(I18n.getMsg("cpq.layout.fetch.error"))}.bind(this))},onRulesLayoutSelected:function(e,t,r){e&&t&&(commonUtils.showHideLoadingDiv(!0),this.setData("layoutSelected",t),this.setData("subModuleSelected",""),this.setData("submodulesForSelectedModule",[]),this.setData("lookupModules",this.getData("noneArrayForLookup")),this.setData("lookUpSelected",""),"priceRules"===this.getData("cpqRuleType")&&(this.setData("PRCurrencyFieldsArray",this.getData("noneArrayForCurrencyField")),this.setData("PRNumberFieldsArray",this.getData("noneArrayForCurrencyField"))),"none"!==t?this.getLayoutDataForSelectedLayout():(commonUtils.showHideLoadingDiv(!1),this.setData("submodulesForSelectedModule",this.getData("noneArrayForSubModules")),this.executeMethod("changeNextButton",!1,r,!0)))},getLayoutDataForSelectedLayout:function(){var e=this;store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/settings/layouts/"+e.getData("layoutSelected")+"?module="+e.getData("parentModuleSelectedRecord").api_name,method:"GET"}).then((function(t){if(t.layouts&&t.layouts.length>0){for(var r=[],i=[],o=t.layouts[0].sections,a=o.length,s=0;s<a;s++)if(!0===o[s].isSubformSection&&"used"===o[s].type){for(var l=!1,d=o[s].fields,n=[],u=d.length,p=0;p<u;p++){let t;if("lookup"===d[p].data_type){let r=e.getModuleObjectByApiName(d[p].lookup.module.api_name);t=!(!0===r.viewable&&!0===r.visible),t||l||(l=!0)}if(("subform"===d[p].data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===d[p].data_type)&&null!==d[p].subform)for(var c in moduleRecordMapping)if(moduleRecordMapping.hasOwnProperty(c)&&moduleRecordMapping[c].id===d[p].subform.id){r.push(d[p]);break}t||n.push(d[p])}o[s].fields=n,l&&i.push(Lyte.deepCopyObject(o[s]))}if(i.length>0){Lyte.arrayUtils(e.getData("submodulesForSelectedModule"),"push",Lyte.deepCopyObject(e.getData("noneArrayForSubModules"))),Lyte.arrayUtils(e.getData("submodulesForSelectedModule"),"push",Lyte.deepCopyObject(r)),e.setData("subformFieldsArray",i),e.setData("disableSubform",!1);var g="priceRules"===e.getData("cpqRuleType")?"#createCpqPRCompRow":"#createCpqPCCompRow"}else{g="priceRules"===e.getData("cpqRuleType")?"#PR":"#PC";$L(`${g}LayoutsDropdown`)[0].setData("cxPropErrorMessage",I18n.getMsg("cpq.createpop.nolayouts.found")),e.setData("disableSubform",!0)}}else e.onFailureShowAlert(I18n.getMsg("cpq.layout.fetch.error"));commonUtils.showHideLoadingDiv(!1),e.executeMethod("changeNextButton",!1,e.getData("disableSubform"),!0)}),(function(){e.onFailureShowAlert(I18n.getMsg("cpq.layout.fetch.error"))}))},getModuleRecordUsingSubformFieldId:function(e){var t=this.getData("submodulesForSelectedModule").find((t=>t.id===e));for(var r in moduleRecordMapping)if(moduleRecordMapping.hasOwnProperty(r)&&moduleRecordMapping[r].id===t.subform.id)var i=moduleRecordMapping[r];return i},onRulesSubModuleSelected:function(e,t){if(this.setData("lookupModules",[]),this.setData("lookupDropDownModules",[]),this.setData("lookUpSelected",""),e&&t){if(commonUtils.showHideLoadingDiv(!0),"none"!==t){var r=this.getModuleRecordUsingSubformFieldId(t);r&&this.setData("selectedSubModuleRecord",r),this.setData("subModuleSelected",r.id);var i=this.getData("subformFieldsArray"),o=[],a=this.getData("lookupModules"),s=[],l=this.getData("noneArrayForLookup"),d=this.getData("cpqRuleType");for(var n of i)if(0!==n.fields.length)for(var u of n.fields)if(u.id===t){"priceRules"===d&&this.getCurrencyAndNumberAndPercentageFields(Lyte.deepCopyObject(n.fields)),o=this.removeAggregateFieldsFromSubFormFields(n.fields);var p=this.getLookUpFieldsForRules(n.fields);p.length>0&&(a=a.concat(Lyte.deepCopyObject(l),p),s=s.concat(Lyte.deepCopyObject(l),this.getLookUpFieldsForRulesDropdown(n.fields))),this.setData("lookupDropDownModules",a),this.setData("lookupModules",s);break}this.checkAllAvailableForCreatePop(),this.setData("subModuleFields",o)}let e=this.getData("lookupDropDownModules").length;("none"===t||e<1)&&this.setData({PRCurrencyFieldsArray:this.getData("noneArrayForCurrencyField"),PRNumberFieldsArray:this.getData("noneArrayForCurrencyField"),lookupDropDownModules:this.getData("noneArrayForLookup"),subModuleSelected:"",lookUpSelected:""}),commonUtils.showHideLoadingDiv(!1)}},checkAllAvailableForCreatePop:function(){var e=this.getData("cpqRuleType");let t=1===this.getData("PRCurrencyFieldsArray").length,r=1===this.getData("PRNumberFieldsArray").length&&"Volume"===this.getData("prActionType");var i=$L("#PRNumberFieldDropdown")[0];if("priceRules"===e&&i&&i.setData("cxPropErrorMessage",""),0===this.getData("lookupModules").length){this.setData("lookupModules",this.getData("noneArrayForLookup"));var o="priceRules"===e;o&&(this.setData("PRCurrencyFieldsArray",this.getData("noneArrayForCurrencyField")),this.setData("PRNumberFieldsArray",this.getData("noneArrayForCurrencyField")));let t=$L(`${o?"#PR":"#PC"}SubModulesDropdown`)[0];""===t.getData("cxPropErrorMessage")&&t.setData("cxPropErrorMessage",I18n.getMsg("cpq.createpop.nolookup.found")),this.setData("disableLookup",!0)}else"priceRules"===e&&t?($L("#PRSubModulesDropdown")[0].setData("cxPropErrorMessage",I18n.getMsg("cpq.createpop.nosubform.found")),this.setData("disableLookup",!0)):"priceRules"===e&&r&&i.setData({cxPropSelected:"0",cxPropErrorMessage:I18n.getMsg("cpq.pr.error.norangefield")})},removeAggregateFieldsFromSubFormFields:function(e){return e.filter((e=>null===e.subform))},getLookUpFieldsForRulesDropdown:function(e){return e.filter((e=>"lookup"===e.data_type&&e.lookup&&e.lookup.module&&e.lookup.module.id&&"Price_Book_Name"!==e.api_name)).map((e=>{var t=Lyte.deepCopyObject(e);return this.addCpqKeysinLookupObject(t)}))},getLookUpFieldsForRules:function(e){this.setData("islookupused",!1);var t=this.getData("cpqRuleType"),r=this.getData("response")?this.getData("response").find((e=>e.module.id===this.getData("parentModuleSelected")&&e.layout.id===this.getData("layoutSelected")&&("productConfigurator"===t?e.subform_module.id:e.field.module.id)===this.getData("subModuleSelected"))):void 0,i=[],o=[];const a=new Set,s=["QuotedItems","OrderedItems","InvoicedItems","PurchaseItems"];for(var l of s)moduleRecordMapping[l]&&a.add(moduleRecordMapping[l].id);if(a.has(this.getData("subModuleSelected"))?(moduleRecordMapping.Products&&!0===moduleRecordMapping.Products.viewable&&moduleRecordMapping.Products.visible&&(o=e.filter((e=>"lookup"===e.data_type&&e.lookup&&e.lookup.module&&"Products"===e.lookup.module.api_name&&!0===e.system_mandatory))),this.setData("isSysMandatory",!0)):(o=e.filter((e=>"lookup"===e.data_type&&e.lookup&&e.lookup.module&&e.lookup.module.id&&"Price_Book_Name"!==e.api_name)),this.setData("isSysMandatory",!1)),r)for(var d=o.length,n=0;n<d;n++){let e=this.getModuleObjectByApiName(r.entity_lookup.module.api_name).module_name;if(o[n].id===r.entity_lookup.id&&moduleRecordMapping[e]&&!0===moduleRecordMapping[e].viewable&&!0===moduleRecordMapping[e].visible){i[0]=[o[n]],this.setData("islookupused",!0);break}}else i[0]=o;return commonUtils.showHideLoadingDiv(!1),r&&0===i.length?($L(`${"productConfigurator"===t?"#PC":"#PR"}SubModulesDropdown`)[0].setData("cxPropErrorMessage",I18n.getMsg("cpq.createpop.lookup.unused",r.entity_lookup.name)),[]):i[0].map((e=>{var t=Lyte.deepCopyObject(e);return this.addCpqKeysinLookupObject(t)}))},getCurrencyAndNumberAndPercentageFields:function(e){var t=[],r=this.getData("noneArrayForCurrencyField");t=t.concat(Lyte.deepCopyObject(r),Lyte.deepCopyObject(t));var i=[];i=i.concat(Lyte.deepCopyObject(r),Lyte.deepCopyObject(i));for(var o=[],a=e.length,s=0;s<a;s++){var l=Lyte.deepCopyObject(e[s]);if(null===l.subform){if(l.crypt&&null!==l.crypt)continue;this.getData("supportedUITypesForCurrencyField").includes(l.ui_type)?(this.getData("unSupportedAPINamesForCurrency").includes(l.api_name)&&"Quoted_Items"===this.getData("selectedSubModuleRecord").api_name||t.push(l),o.push(l)):this.getData("supportedUITypesForNumberField").includes(l.ui_type)&&!this.getData("unSupportedColumnNamesForNumber").includes(l.column_name)?i.push(l):116===l.ui_type&&void 0!==l.formula&&void 0!==l.formula.return_type&&"currency"===l.formula.return_type&&o.push(l)}}this.setData("PRCurrencyFieldsArray",[]),this.setData("PRNumberFieldsArray",[]),this.setData("PRPercentageFieldsArray",[]),this.setData("lookupModules",[]),t.length>0&&this.setData("PRCurrencyFieldsArray",Lyte.deepCopyObject(t)),i.length>0&&(this.setData("PRNumberFieldsArray",Lyte.deepCopyObject(i)),this.setData("fieldSelected","0")),o.length>0&&this.setData("PRPercentageFieldsArray",Lyte.deepCopyObject(o)),commonUtils.showHideLoadingDiv(!1)},addCpqKeysinLookupObject:function(e){var t=Lyte.deepCopyObject(this.getModuleObjectById(e.lookup.module.id)),r=Lyte.deepCopyObject(e);return t.cpqlookupfield=r,t.cpqlookUpFieldId=e.id,t.cpqLabel=`${t.singular_label} - ${e.field_label}`,t.cpqPluralLabel=`${e.field_label} - ${t.plural_label}`,t.cpqApiName=e.api_name,t.cpqName=e.display_label,t},onLookUpFieldSelected:function(e,t){void 0!==e&&this.setData("lookUpSelected",t)},createRules:function(){var e="priceRules"===this.getData("cpqRuleType"),t=e?"#pricerule":"#productconfigurator",r=$L(`${t}name .lyteField`),i=$L(`${t}description .lyteField`),o=this.getData("PRRecordNames"),a=this.getData("PCRecordNames"),s=$L(`${t}name`)[0].getData("ltPropValue").trim()||"",l=$L(`${t}description`)[0].getData("ltPropValue").trim()||"",d=this.getData("prActionType");this.validateName(s,e?o:a,r,e,d)&&this.validateDescription(i,l,1e3)&&(e?(Crm.client_tracking("CPQ-Price rules-Next button in Create PR popup"),this.setData("ruleName",s),this.setData("ruleDescription",l),this.setData("prListToDetailMode","create"),this.getQuoteFields()):(Crm.client_tracking("CPQ-Price rules-Next button in Create PC popup"),Lyte.Router.transitionTo("crm.settings.section.zohocpq.configurator-create",this.data.configuratorInfo.dynamicParam).data=this.createPCTransitionObject(s,l)))},validateName:function(e,t,r,i,o){switch(renderingUtils.hideLyteErrorMessages(r),r.removeClass("lyteErrorBorder"),e||(e=""),e=e.trim(),!0){case""===e:return renderingUtils.showLyteErrorMessage(I18n.getMsg("cpq.pr.inlineerror.rulename.emptyerror"),r),!1;case e.length>50:return renderingUtils.showLyteErrorMessage(I18n.getMsg("cpq.pr.inlineerror.rulename.maxreached"),r),!1;case/[+()*&^%#]/.test(e):return renderingUtils.showLyteErrorMessage(I18n.getMsg("crm.alert.label.special.characters"),r),!1;case t.includes(e.toLowerCase()):return renderingUtils.showLyteErrorMessage(I18n.getMsg("cpq.pr.duplicateNameError"),r),!1;case i&&(!o||""===o):return this.showMessage("error",I18n.getMsg("cpq.pr.inlineerror.ruletype.typeunselected")),!1;default:return!0}},validateDescription:function(e,t,r){return renderingUtils.hideLyteErrorMessages(e),e.removeClass("lyteErrorBorder"),t||(t=""),t=t.trim(),this.setData("priceRuleDescription",t),!(t.length>r)||(renderingUtils.showLyteErrorMessage(I18n.getMsg("cpq.pr.inlineerror.ruledescription.maxreached"),e),!1)},createPCTransitionObject:function(e,t){var r=this.getData("layoutsForSelectedModule").find((e=>e.id===this.getData("layoutSelected"))),i=this.getData("lookupModules").find((e=>e.cpqlookUpFieldId===this.getData("lookUpSelected"))),o={name:e,description:t},a={id:this.getData("layoutSelected"),record:r},s={id:this.getData("lookUpSelected"),record:i},l={api_name:this.getData("selectedSubModuleRecord").api_name,fields:this.getData("subModuleFields"),record:this.getData("selectedSubModuleRecord")},d={api_name:this.getData("parentModuleSelectedRecord").api_name,record:this.getData("parentModuleSelectedRecord"),fields:this.getData("selectedModuleFields")},n=this.getTransitionObject(null);return n.headers=o,n.selectedModuleData=d,n.selectedLayoutData=a,n.selectedSubModuleData=l,n.selectedLookupData=s,n},checkIfPrimaryFieldIsUnused:async function(e,t,r){var i=store.peekRecord("field",e,{module:t});if(i||(i=store.findRecord("field",e,{module:t},!1,void 0,{apiVersion:"2.2"}),await i.then((function(e){i=e[0]}),(function(){}))),"unused"===i.type)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("cpq.listview.status.active.lookup.unused"),ltPropType:"error"}});else{var o=this.getData("bundleListIndex");"productConfigurator"===this.getData("cpqRuleType")?(Crm.client_tracking("CPQ-Product configurator-Activate radio button in list view"),this.deactivateProdutConfigurator(o,"activate")):"priceRules"===this.getData("cpqRuleType")&&(Crm.client_tracking("CPQ-Price rules-Activate radio button in list view"),this.deactivatePriceRules(r,"activate"))}},checkIfPrimaryFieldsAreUnused:function(e){let t=$L("crm-productconfigurator-header")[0];t&&t.component.setData("switchToViewMode",!0),this.setData({switchToViewMode:!0,unusedFieldsInfoContent:e}),unusedFieldsInfoModal.ltProp("show",!0),$L("#messagebox")[0].ltProp("show",!1)},checkProfilePermission:function(e){let t=Crm.userDetails.PROFILE_ID;return!!e.find((e=>e.id===t))},applyFilterForRecords:function(e,t){var r=$L("#"+e)[0].component,i=r.getFilterCriteria(),o=this.getData("addItemFrom"),a="add_line_item"===o||"suggest_line_item"===o||"line_item_field_update"===o;if(!i.isValdationFailure){if(i.queryParams){this.data.filterCri=i.queryParams;var s=i.queryParams.filters;if(s&&(this.data.filters=i.queryParams.filters,s.group&&s.group.length>4)){let e=s.group.filter((e=>e.field.api_name.includes(".")));if(e=e.length,e>5)return void this.showDefaultMessage("error",I18n.getMsg("crm.title.max.lookup.fields"))}var l=r.data.checked,d="";if(l.length>0){var n=l.length;d+=l[n-1].display_field_label;for(var u=n-2;u>=0;u--)d+=", ",d+=l[u].display_field_label}this.setData({filterApplied:d,isFilterApplied:!0}),this.callFilterMethod(t,a,e)}else this.getData("isFilterApplied")&&(this.data.filterCri={},this.callFilterMethod(t,a,e),this.setData("isFilterApplied",!1));this.setData({isApplyFilter:!1,isHeightApplied:!1}),this.setHeightBasedOnRuleType(t,e)}},callFilterMethod:function(e,t,r){"productConfigurator"===e?this.executeMethod("getFilteredRecords",this.getData("selectedLookupData.module_name"),!t,r):this.executeMethod("getFilteredRecords",this.getData("lookupModuleSelectedData"),r)},onFilterClearForRecords:function(e,t){if(this.data.filters={},this.data.cross_filters={},this.data.filterCri={},$L("#"+e)[0].component.resetFields(),this.getData("isFilterApplied")){if("productConfigurator"===t){var r=this.getData("addItemFrom"),i="add_line_item"===r||"suggest_line_item"===r||"line_item_field_update"===r;this.executeMethod("getFilteredRecords",this.getData("selectedLookupData.module_name"),!i)}else this.executeMethod("getFilteredRecords",this.getData("lookupModuleSelectedData"));this.setData("isFilterApplied",!1),this.setAppliedFilterSummary(e)}this.setHeightBasedOnRuleType(t,e),this.setData({isApplyFilter:!1,isHeightApplied:!1})},setHeightBasedOnRuleType:function(e,t){"productConfigurator"===e?("smartFilterID"===t&&this.methods.setHeightProductConfigSMBody(),"smartFilterActionPanel"===t&&this.methods.setHeightPCActionSMBody()):this.methods.setHeightPRulesSMBody()},showHideFilterForRecords:function(e,t,r,i){e=$L(e);var o=document.getElementById(t).children[0].children[0];e.hasClass("activeLabel")?(e.removeClass("activeLabel"),o.classList.remove("filterEnableReq"),"productConfigurator"===i?this.setData("isFilterActive."+r,!1):this.setData("isFilterActive",!1)):(e.addClass("activeLabel"),o.classList.add("filterEnableReq"),"productConfigurator"===i?this.setData("isFilterActive."+r,!0):this.setData("isFilterActive",!0))},constructFilterParam:function(e,t,r){if(this.getData("isFilterApplied")&&(this.getData("filterCri").filters||this.getData("filterCri").cross_filters))if(t.cross_filters=JSON.stringify(this.getData("filterCri").cross_filters),this.getData("filterCri").filters&&this.getData("filterCri").filters.group){e.group||(e.group_operator="AND",e.group=[]);for(var i=this.getData("filterCri").filters.group,o=i.length,a=0;a<o;a++)e.group.push(i[a]);t.filters=e}else e.group&&this.getData("filterCri").filters?(e.group.push(this.getData("filterCri").filters),t.filters=e):t.filters=this.getData("filterCri").filters;if(this.getData("isSearchApplied")&&""!==this.getData("searchDataString")){var s;if(this.getData("addItemUsage.isPrdCodeAvail"))s={group_operator:"OR",group:[{field:{api_name:"Product_Name"},comparator:"contains",value:this.getData("searchDataString")},{comparator:"contains",field:{api_name:"Product_Code"},value:this.getData("searchDataString")}]};else{s={field:{api_name:moduleRecordMapping[r].display_field.api_name},comparator:"contains",value:this.getData("searchDataString")}}e.group?(e.group.push(s),t.filters=e):t.filters?(e.group_operator="AND",e.group=[],e.group.push(t.filters),e.group.push(s),t.filters=e):t.filters=s}},getHeaderFieldsForFilter:function(e,t,r,i,o,a){let s=e.module_name?e.module_name:e,l=e.api_name?e.api_name:this.getModuleObjByModuleName(s).api_name;var d=store.peekRecord("module",moduleRecordMapping[s].id,{include:"include=lookup_field_properties,related_lists"});if(d.lookup_field_properties){var n=this.getHeaderFromField(d.lookup_field_properties.fields,d.fields);this.removeYieldNameFromHeaderFields(n),"productConfigurator"===a?this.getRecords(e,1,i,n,t,r,o):this.getRecords(l,1,t,r)}},setPRActionPanelDirectInputNone:function(e){$L("#dropDown_"+e.productId)[0].ltProp("selected","none");var t=$L("#input_"+e.productId)[0];t.ltProp("value",""),t.ltProp("disabled",!0)},setCpqPrDiscountDivHide:function(){var e=$L("#cpqPrDiscountDiv");$L("#cpqPrSetDiscountPop").get(0).ltProp("show",!1),e.find(".cpqInitialStage").addClass("hide"),e.find(".cpqPrAddedItems").removeClass("hide")},hidePricingTypeDropdownForError(e,t){var r=e+t,i=$L(r+this.getData("lyteDropButton"));return renderingUtils.hideLyteErrorMessages(i),i.removeClass("lyteErrorBorder"),$L(r)[0].getData("ltPropSelected")},hideFromToErrorMsgForVBAction:function(e,t,r){if(!this.getData("isShowDiscountExecuting")){var i=$L(e+t+"_"+r+" .lyteField");renderingUtils.hideLyteErrorMessages(i),i.removeClass("lyteErrorBorder");var o=$L(e+t+"_"+r)[0].getData("ltPropValue");if(this.enableSaveForActions(),o&&""!==o){var a=this.getDigitsCount(o),s=this.getDecimalDigitsCount(o);if(a>this.getData("maxDigitsForVolumeValue"))return void renderingUtils.showLyteErrorMessage(this.getData("quantityDigitsErrorMessage"),i);if(s>this.getData("maxDecimalDigitsForVolumeValue"))return void renderingUtils.showLyteErrorMessage(this.getData("quantityDecimalDigitsErrorMessage"),i);"#vbvalueto_"===e&&this.validateRangeToValue(o,s,t,r,"modify")}}},setProductActiveStatusForPR:function(e){let t=e.find((e=>"Product_Active"===e.api_name&&void 0!==e.visible&&!0===e.visible));this.setData("isProductActiveFieldPresentForPR",!!t)},checkSubformFieldIsUnused:function(e,t){var r=!0;return t.forEach((function(t){t.isSubformSection&&t.fields.forEach(function(t){t.subform&&t.subform.id===e&&(r=!1)}.bind(this))})),r},getModuleObjByModuleName:function(e){return moduleRecordMapping[e]},getModuleObjectById:function(e){return Object.values(moduleRecordMapping).find((t=>t.id===e))},getModuleObjectByApiName:function(e){return Object.values(moduleRecordMapping).find((t=>t.api_name===e))},getModulePluralLabelByAPIName:function(e,t){let r=Object.values(moduleRecordMapping).find((t=>t.api_name===e));return r?r.plural_label:t?t.name:""},check:function(e,t,r){return""===e?(this.showErrorForDirectAction(I18n.getMsg("cpq.pr.invalidvalue"),t,r),!0):parseFloat(e)<=0&&(this.showErrorForDirectAction(I18n.getMsg("cpq.prActionPart.valuelessthanzeroerror"),t,r),!0)}});
