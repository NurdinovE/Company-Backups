var requestObj=null;Lyte.Component.register("crm-entity-lookup",{_template:'<template tag-name="crm-entity-lookup"> <lyte-popover id="popoverTest" lt-prop-wrapper-class="columnCustomizeWrap {{if(fromSalesInbox,\'fromSalesInbox\',\'\')}}" lt-prop-placement="bottom" lt-prop-show-close-button="false" lt-prop-freeze="false" lt-prop-origin-elem="#coloumnSelectOrg" on-before-close="{{method(&quot;checkForLookupAlert&quot;)}}"> <template is="registerYield" yield-name="popover"> <div id="columnList" style=";position:fixed;z-index:2" class="ddMenuss fromModuleLookup"></div> </template> </lyte-popover> <lyte-menu lt-prop-yield="true" id="sortablePossibilityList" lt-prop-show="{{showSortableOptions}}" lt-prop-query=".sortableColumn" lt-prop-wrapper-class="{{if(fromSalesInbox,\'fromSalesInbox\',\'\')}}" on-menu-click="{{method(\'sortColumnsInLookup\')}}" on-close="{{method(\'sortColumnsClose\')}}"> <template is="registerYield" yield-name="yield"> <lyte-menu-body> <template is="for" items="{{availableSort}}" item="item" index="index"> <lyte-menu-item data-value="{{item}}"> <lyte-menu-label>{{item}} </lyte-menu-label> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <div id="id_1"> <template is="registerYield" yield-name="createYield"> <lyte-button lt-prop-appearance="default" data-zcqa="btn_Lookup_CreateNewRecord" lt-prop-class="outlineprimaryflat mR0" class="pR" onclick="{{action(\'openQuickCreate\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("New")}} {{singularModName}} </template> </lyte-button> </template> <lyte-modal id="lookupListPopup" lt-prop-bind-to-body="{{ltPropBindToBody}}" lt-prop-width="90%" lt-prop-class="crmBoxModal" lt-prop-wrapper-class="lookupListTable {{if(fromSalesInbox,\'fromSalesInbox\',\'\')}}" lt-prop-show-close="false" lt-prop-allow-multiple="true" lt-prop-show="{{lbind(showCopy)}}" lt-prop-prevent-focus="true" on-close="{{method(\'backgroundCloseFunc\')}}" on-before-close="{{method(\'customStyleRemoval\')}}" on-show="{{method(\'tableStyleProperty\')}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{expHandlers(showSubjLookup,\'!\')}}"><template case="true"> <crux-lookup-filter-view cx-prop-aria="{{isAccessibilityConfigSupported}}" cx-prop-from="entityLookup" lookup-url-for-campaign="{{lbind(lookupUrlForCampaign)}}" show="{{lbind(showCopy)}}" disp-init="{{dispInit}}" on-data-loaded="{{method(\'onDataLoaded\')}}" mod-id="{{modId}}" is-single="{{isSingle}}" cx-prop-header="{{cxPropHeader}}" display-field="{{lbind(displayField)}}" record="{{lbind(record)}}" cx-prop-return-full-object-on-get="true" selected-single="{{reqData.id}}" parent-module="{{reqData.parentModule}}" lookup-field-id="{{reqData.fieldid}}" lookup-single="{{lbind(selectedRecordName)}}" on-value-change="{{method(\'setFieldValue\')}}" temp-close="{{lbind(tempClose)}}" render-lookup-view="{{renderLookupView}}" related-record-data="{{relatedRecordData}}" default-criteria="{{defaultCriteria}}" default-criteria-str="{{defaultCriteriaStr}}" disable-related-to="{{disableRelatedTo}}" current-selected-record="{{lbind(currentSelectedRecord)}}" cx-prop-create-yield="{{lbind(isQuickCreateAllowed)}}" flush-view="{{lbind(flushView)}}" cx-prop-field="{{parentModuleData}}" cx-prop-default-fields="{{defaultFields}}" field-of-lookup-val="{{lbind(fieldOfLookupVal)}}" cx-prop-additional-params="{{additionalParam}}" before-request-change-data="{{method(\'changeRequestData\',reqData)}}"> <template is="registerYield" yield-name="createYield"> <lyte-button lt-prop-id="button_id" lt-prop-appearance="default" data-zcqa="btn_Lookup_CreateNewRecord" lt-prop-class="outlineprimaryflat mR0" class="pR" onclick="{{action(\'openQuickCreate\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("New")}} {{singularModName}} </template> </lyte-button> </template> </crux-lookup-filter-view> </template><template case="false"> <crm-picklist-lookup module-id="{{modId}}" field-id="{{fieldId}}" selected-record="{{reqData.id}}" on-data-loaded="{{method(\'onDataLoaded\')}}" show="{{lbind(showCopy)}}" on-value-change="{{method(\'setFieldValue\')}}"> </crm-picklist-lookup> </template></template> </template> </lyte-modal> </div> <lyte-alert id="validationAlert" lt-prop-id="AlertBtn" lt-prop="{&quot;buttons&quot; : [{&quot;id&quot;:&quot;custom_alert_button&quot;,&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;{{getI18n(&quot;crm.button.ok&quot;)}}&quot;,&quot;appearance&quot;:&quot;primary&quot;}]}" lt-prop-button-position="center" lt-prop-wrapper-class="lookupFilterAlert" lt-prop-yield="true" lt-prop-top="0px" lt-prop-content-align="center" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="alert"> <lyte-alert-content class="pB25 crm-base-font-size crm-font-bold fs">{{alertMsg}} </lyte-alert-content> </template> </lyte-alert> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[5,3]},{type:"registerYield",position:[5,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]},{type:"text",position:[3]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[5,3]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]}],_observedAttributes:["defaultFields","allFieldsNeeded","parentModuleData","selectedRecordName","fieldObj","lookupUrlForCampaign","showSubjLookup","fieldOfLookupVal","currentSelectedRecord","record","defaultCriteria","defaultCriteriaStr","singleRelatedToObj","ltPropBindToBody","flushView","renderLookupView","modId","focusFlag","relatedToPopulate","disableRelatedTo","selectedRelatedRecordId","firstLoading","searchValue","searchApplied","fieldId","isQuickCreateAllowed","showCopy","ltPropShow","backCallMade","reqData","parentReqData","baseCurrency","flag","isLinkingModule","showSortableOptions","show","headerJson","bodyContent","slicedBodyContent","slicedFrom","slicedTo","defaultSearchRecLimit","bodyList","selectedList","dropDownForFilter","module","parentModule","currentModuleColumns","newModel","accDetails","productId","isfromOutlookRightPanel","currencyIsoCode","fromSearchCreate","fromAutDealCreate","fromQuickCreate","previous_sort_column","sortOrderString","sortColumnString","singularModName","isFilterApplied","lookupColsUpdated","criteriaObj","appliedCriteriaObj","fieldObj","relatedDropdown","fromIndex","toIndex","lastIndex","columnCustHgt","defaultToIndex","hasMoreRecords","fromSalesInbox","selectedId","currentPage","primaryColumn","requestCompleted","multiLookup","selectedIds","relatedRecordData","isRelatedRecords","forLookupofLookup","formatDetails","moduleRefName","decimalFldUITypeArr","timeFormat","datePattern","filterForUser","showAllRecords","relatedDomId","defaultSort","availableSort","errorMsg","searchBarDisplayMsg","quickCreateUnsupportedModules","LookupDatatypeVsUiType","colAdd","onScrollAction","resetCriteriaFlag","$campaign_type","alertMsg","disableFilterLink","filterApplyClicked","additionalParam","isAccessibilityConfigSupported","clientAccount"],data:function(){return{defaultFields:Lyte.attr("object",{default:{}}),allFieldsNeeded:Lyte.attr("boolean",{default:!1}),parentModuleData:Lyte.attr("object",{default:{}}),selectedRecordName:Lyte.attr("string",{default:""}),fieldObj:Lyte.attr("object",{default:{}}),lookupUrlForCampaign:Lyte.attr("string",{default:""}),showSubjLookup:Lyte.attr("boolean",{default:!1}),fieldOfLookupVal:Lyte.attr("array",{default:[]}),currentSelectedRecord:Lyte.attr("object",{default:{}}),record:Lyte.attr("array",{default:[]}),defaultCriteria:Lyte.attr("array",{default:[]}),defaultCriteriaStr:Lyte.attr("string",{default:""}),singleRelatedToObj:Lyte.attr("object",{default:{}}),ltPropBindToBody:Lyte.attr("boolean",{default:!1}),flushView:Lyte.attr("boolean",{default:!1}),renderLookupView:Lyte.attr("boolean",{default:!1}),modId:Lyte.attr("string",{default:""}),focusFlag:Lyte.attr("boolean",{default:!1}),relatedToPopulate:Lyte.attr("boolean",{default:!0}),disableRelatedTo:Lyte.attr("boolean",{default:!1}),selectedRelatedRecordId:Lyte.attr("string",{default:""}),firstLoading:Lyte.attr("boolean",{default:!1}),searchValue:Lyte.attr("string",{default:""}),searchApplied:Lyte.attr("boolean",{default:!1}),fieldId:Lyte.attr("string"),isQuickCreateAllowed:Lyte.attr("boolean",{default:!1}),showCopy:Lyte.attr("boolean",{default:!1}),ltPropShow:Lyte.attr("boolean",{default:!1}),backCallMade:Lyte.attr("boolean",{default:!1}),reqData:Lyte.attr("object",{default:{}}),parentReqData:Lyte.attr("object",{default:{}}),baseCurrency:Lyte.attr("string",{default:Crm.userDetails.BASE_CURRENCY}),flag:Lyte.attr("boolean",{default:!1}),isLinkingModule:Lyte.attr("boolean",{default:!1}),showSortableOptions:Lyte.attr("boolean",{default:!1}),show:Lyte.attr("boolean",{default:!1}),headerJson:Lyte.attr("array",{default:[]}),bodyContent:Lyte.attr("array",{default:[]}),slicedBodyContent:Lyte.attr("array",{default:[]}),slicedFrom:Lyte.attr("number",{default:0}),slicedTo:Lyte.attr("number",{default:10}),defaultSearchRecLimit:Lyte.attr("number",{default:500}),bodyList:Lyte.attr("array",{default:[]}),selectedList:Lyte.attr("array",{default:[]}),dropDownForFilter:Lyte.attr("array",{default:[]}),module:Lyte.attr("string",{default:""}),parentModule:Lyte.attr("string",{default:""}),currentModuleColumns:Lyte.attr("object",{default:{}}),newModel:Lyte.attr("boolean",{default:!0}),accDetails:Lyte.attr("object",{default:{}}),productId:Lyte.attr("string",{default:""}),isfromOutlookRightPanel:Lyte.attr("boolean",{default:!1}),currencyIsoCode:Lyte.attr("string",{default:""}),fromSearchCreate:Lyte.attr("boolean",{default:!1}),fromAutDealCreate:Lyte.attr("boolean",{default:!1}),fromQuickCreate:Lyte.attr("boolean",{default:!1}),previous_sort_column:Lyte.attr("string",{default:""}),sortOrderString:Lyte.attr("string",{default:""}),sortColumnString:Lyte.attr("string",{default:""}),singularModName:Lyte.attr("string",{default:""}),isFilterApplied:Lyte.attr("boolean",{default:!1}),lookupColsUpdated:Lyte.attr("boolean",{default:!1}),criteriaObj:Lyte.attr("object",{default:{}}),appliedCriteriaObj:Lyte.attr("object",{default:{}}),fieldObj:Lyte.attr("object",{default:{}}),relatedDropdown:Lyte.attr("array",{default:[]}),fromIndex:Lyte.attr("number",{default:1}),toIndex:Lyte.attr("number",{default:10}),lastIndex:Lyte.attr("number",{default:1}),columnCustHgt:Lyte.attr("string",{default:""}),defaultToIndex:Lyte.attr("number",{default:10}),hasMoreRecords:Lyte.attr("boolean",{default:!0}),fromSalesInbox:Lyte.attr("boolean",{default:!1}),selectedId:Lyte.attr("number",{default:0}),currentPage:Lyte.attr("string",{default:""}),primaryColumn:Lyte.attr("string",{default:""}),requestCompleted:Lyte.attr("boolean",{default:!0}),multiLookup:Lyte.attr("array",{default:[]}),selectedIds:Lyte.attr("string",{default:""}),relatedRecordData:Lyte.attr("array",{default:[]}),isRelatedRecords:Lyte.attr("boolean",{default:!1}),forLookupofLookup:Lyte.attr("boolean",{default:!1}),formatDetails:Lyte.attr("object",{default:{}}),moduleRefName:Lyte.attr("string",{default:""}),decimalFldUITypeArr:Lyte.attr("array",{default:[36,38,39,40,77,143,144,145,117]}),timeFormat:Lyte.attr("string",{default:"12"}),datePattern:Lyte.attr("string",{default:"MM-DD-YYYY"}),filterForUser:Lyte.attr("array",{default:[{id:"AllUsers",category:I18n.getMsg("crm.label.all")},{id:"ActiveUsers",category:I18n.getMsg("Active")},{id:"DeactiveUsers",category:I18n.getMsg("Inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("Unconfirmed")},{id:"DeletedUsers",category:I18n.getMsg("crm.label.deleted")}]}),showAllRecords:Lyte.attr("boolean",{default:!1}),relatedDomId:Lyte.attr("string",{default:""}),defaultSort:Lyte.attr("array",{default:[I18n.getMsg("crm.column.sort.asc"),I18n.getMsg("crm.column.sort.desc")]}),availableSort:Lyte.attr("array",{default:[]}),errorMsg:Lyte.attr("string",{default:""}),searchBarDisplayMsg:Lyte.attr("string",{default:""}),quickCreateUnsupportedModules:Lyte.attr("array",{default:["subjname","CustomModule5005","CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5008","CustomModule5006","CustomModule5007","CustomModule5009","CustomModule5010","PriceBooks","Quotes","SalesOrders","PurchaseOrders","Invoices","Activities","Appointments","Services"]}),LookupDatatypeVsUiType:Lyte.attr("object",{default:{Text:[CrmField.UITYPES.SINGLE_LINE,CrmField.UITYPES.SKYPE_FIELD,CrmField.UITYPES.TEXT_FIELD,CrmField.UITYPES.TWITTER,CrmField.UITYPES.FIRST_NAME,CrmField.UITYPES.LAST_NAME,CrmField.UITYPES.TASK_SUBJECT,CrmField.UITYPES.MULTI_LINE_CF,CrmField.UITYPES.TEXT_AREA,CrmField.UITYPES.WEBSITE,CrmField.UITYPES.EMAIL],DateTime:[CrmField.UITYPES.DATE_TIME1,CrmField.UITYPES.CREATED_TIME,CrmField.UITYPES.DATETIME,CrmField.UITYPES.DATE_TIME2,CrmField.UITYPES.DATE_TIME_LONG],Date:[CrmField.UITYPES.DATE,CrmField.UITYPES.DATE_LONG],Integer:[CrmField.UITYPES.NUMERIC_FIELD,CrmField.UITYPES.LONG_INTEGER],Currency:[CrmField.UITYPES.CURRENCY],Double:[CrmField.UITYPES.AGGREGATE_FIELD,CrmField.UITYPES.PERCENT,CrmField.UITYPES.DECIMAL,CrmField.UITYPES.BIG_DECIMAL],PickList:[CrmField.UITYPES.PICK_LIST,CrmField.UITYPES.STAGE,CrmField.UITYPES.RECORD_CURRENCY,98,999],Lookup:[CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.POTENTIAL_ID,CrmField.UITYPES.SALESORDER_ID,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.QUOTE_ID,CrmField.UITYPES.ROLE_NAME,CrmField.UITYPES.PRODUCT_HANDLE,CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.MULTISELECT_LOOK_UP],Boolean:[CrmField.UITYPES.BOOLEAN_DEF,CrmField.UITYPES.BOOLEAN_DEF_NOT],MultiSelect:[CrmField.UITYPES.MULTI_PICK_LIST],Phone:[CrmField.UITYPES.PHONE],Owner:[CrmField.UITYPES.OWNER,CrmField.UITYPES.CREATED_BY,CrmField.UITYPES.USERLOOKUP],Layout:[CrmField.UITYPES.LAYOUT],AutoNumber:[CrmField.UITYPES.AUTONUMBER]}}),colAdd:Lyte.attr("boolean",{default:!0}),onScrollAction:Lyte.attr("boolean",{default:!0}),resetCriteriaFlag:Lyte.attr("boolean",{default:!1}),$campaign_type:Lyte.attr("string"),alertMsg:Lyte.attr("string",{default:"Please enter valid data"}),disableFilterLink:Lyte.attr("boolean",{default:!0}),filterApplyClicked:Lyte.attr("boolean",{default:!1}),additionalParam:Lyte.attr("object",{default:{}}),isAccessibilityConfigSupported:Lyte.attr("boolean",{default:Crm.userDetails.isAccessibilityConfigSupported&&!featuresAvailable.NEXTGENUI_ENABLED}),clientAccount:Lyte.attr("boolean",{default:!(void 0===window.clientPortalName||!window.clientPortalName)})}},didDestroy:function(){var e=$L("#lookupListPopup")[0];e&&e.ltProp("show",!1)},setDefaultCriteria:function(e,t){if("Products"===e){let e="(Product_Active:equals:true)";this.data.reqData.defaultCriteriaStr&&(e="(("+this.data.reqData.defaultCriteriaStr+")and("+e+"))"),this.setData("defaultCriteriaStr",e)}else if(e===crmModuleConstants.Accounts&&t===crmModuleConstants.Accounts&&void 0!==window[t]&&("edit"===window[t].currentStatus||"view"===window[t].currentStatus)&&"PARENTACCOUNTID"===this.data.reqData.colname&&window[t].entityId||"Crm_Contacts_REPORTINGTOCONTACTID"===this.data.reqData.labelName&&window[t]&&window[t].entityId&&("edit"===window[t].currentStatus||"view"===window[t].currentStatus)){let e="(id:not_equal:"+window[t].entityId+")";this.data.reqData.defaultCriteriaStr&&(e="(("+this.data.reqData.defaultCriteriaStr+")and("+e+"))"),this.setData("defaultCriteriaStr",e)}else this.data.reqData.defaultCriteriaStr?this.setData("defaultCriteriaStr",this.data.reqData.defaultCriteriaStr):this.setData("defaultCriteriaStr","")},addAdditionalFieldsToLookup:function(e,t,a){var i=!!(this.data.reqData.colname&&this.data.reqData.colname.indexOf("CF")>0),o={};if(i||"PARENTACCOUNTID"===this.data.reqData.colname||"Accounts"!==e)if(i||"Contacts"!==e)if("Campaigns"===e)o.api_names=["$campaign_type"];else if(i||"Leads"!==e&&"Vendors"!==e){if(t&&"Products"===e){o.api_names=["Unit_Price","Qty_in_Stock","Qty_Ordered","Product_Code","Taxable","Layout","Tax","$taxable"];var r=this.data.reqData.labelName,l=$(document.getElementById(r));(s=this.referenceFieldMethod(l,{}))&&(o.id=Object.keys(s),o.api_names=["Unit_Price","Qty_in_Stock","Qty_Ordered","Product_Code","Taxable","Layout","Tax","$taxable"])}else if(a){var s;r=this.data.reqData.labelName,l=$(document.getElementById(r));(s=this.referenceFieldMethod(l,{}))&&(o.id=Object.keys(s))}}else o.api_names=["Street","City","State","Country","Zip_Code","Email"];else o.api_names=["Mailing_City","Mailing_Zip","Mailing_Country","Mailing_State","Mailing_Street","Other_City","Other_Zip","Other_Country","Other_State","Other_Street","Account_Name","Email"];else o.api_names=["Billing_City","Billing_Code","Billing_Country","Billing_State","Billing_Street","Shipping_City","Shipping_Code","Shipping_Country","Shipping_State","Shipping_Street"];o.api_names?(o.api_names.push("Currency"),o.api_names.push("Layout")):o.api_names=["Currency","Layout"],this.setData("defaultFields",o)},referenceFieldMethod:function(e,t){var a={},i=e.closest("tr").find("td"),o=!!Object.keys(Crm.userDetails.CURRENCY_DETAILS).length;if(o){var r=document.getElementById("Crm_"+this.data.reqData.parentModule+"_CURRENCYISOCODE"),l=r?r.value:void 0;if(l){var s=t.Currency,d=Crm.userDetails.CURRENCY_DETAILS[s],n=d?d.er:1,u=d?d.decimals:void 0;n=void 0!==u?Number(n).toFixed(u):n;var c=Crm.userDetails.CURRENCY_DETAILS[l],m=c?c.er:1,p=c?c.decimals:void 0}}for(var h of i){var f=$(h).find("input"),D=$(h).find("textarea");for(var g of f)if(g.dataset&&g.dataset.refered_from_fieldid){if(g.dataset.refered_from_fieldid.split("_")[1]!=this.data.reqData.fieldid)continue;var C=g.dataset.refered_from_fieldid.split("_")[2],y=(L=store.peekRecord("field",C))&&L.api_name;if("currency"===(L&&L.data_type)&&o&&m)b=void 0!==(b=(b=t[y])&&n?b/n*m:void 0)&&void 0!==p?Number(b).toFixed(p):void 0,a[C]=void 0!==b?b:"";else a[C]=t[y]?t[y]:""}for(var I of D)if(I.dataset&&I.dataset.refered_from_fieldid){if(I.dataset.refered_from_fieldid.split("_")[1]!=this.data.reqData.fieldid)continue;var L,b;C=I.dataset.refered_from_fieldid.split("_")[2],y=(L=store.peekRecord("field",C))&&L.api_name;if("currency"===(L&&L.data_type)&&o&&m)b=void 0!==(b=(b=t[y])&&n?b/n*m:void 0)&&void 0!==p?Number(b).toFixed(p):void 0,a[C]=void 0!==b?b:"";else a[C]=t[y]?t[y]:""}}return a},serviceRelatedRecords:["crm.filter.temp.avail","crm.filter.all.services","crm.filter.avail.service","crm.filter.temp.service","crm.filter.notuse.service"],submitAdvancedSearchFilter:function(){var e=this.getFilterParams();void 0!==e&&!1!==e&&(this.setData("fromIndex",1),this.setData("toIndex",e.length>0?this.getData("defaultSearchRecLimit"):this.getData("defaultToIndex")),$L(".entityLookupTable .lyteTableScroll").scrollLeft(0),this.setData("filterApplyClicked",!0),this.openCustomLookup(this.data.reqData.parentModule,this.data.reqData.labelName,this.data.reqData.labelName,this.data.reqData.searchModule,this.data.reqData.fieldVal,this.getData("sortColumnString"),this.getData("sortOrderString"),e))},validateFilterInput:function(e,t,a,i,o){if("equals"!=t&&"not_equal"!=t&&"null"==e||"string"==typeof e&&/^[`~!@#$%^&*()\-_=+\\|\][{}'";:/?.,><]+$/.test(e.trim()))return this.openAlert(I18n.getValueForFields("crm.field.valid.check",a)),!1;if("N"===o&&!validationUtils.isValidNumber(e))return this.openAlert(I18n.getValueForFields("crm.field.valid.check",a)),!1;if(this.getData("LookupDatatypeVsUiType").Date.contains(i)||this.getData("LookupDatatypeVsUiType").DateTime.contains(i))if("between"===t){if(!Utils.isValidDate(this.getData("formatDetails").datePattern,e[0])||!Utils.isValidDate(this.getData("formatDetails").datePattern,e[1]))return this.openAlert(I18n.getValueForFields("crm.field.valid.check",a)),!1;var r=Utils.getDateObject(e[0],""),l=Utils.getDateObject(e[1],"");if(!Utils.compareDate(r,l))return this.openAlert(a+":"+I18n.getValueForFields("crm.cal.sch.date.val")),!1}else if(!Utils.isValidDate(this.getData("formatDetails").datePattern,e))return this.openAlert(I18n.getValueForFields("crm.field.valid.check",a)),!1;if((this.getData("LookupDatatypeVsUiType").Date.contains(i)||this.getData("LookupDatatypeVsUiType").DateTime.contains(i)||"DT"===o||"D"===o)&&!Utils.isValidDate(this.getData("formatDetails").datePattern,e))return this.openAlert(I18n.getValueForFields("crm.field.valid.check",a)),!1;if("between"===t)if(this.getData("LookupDatatypeVsUiType").Date.contains(i)||this.getData("LookupDatatypeVsUiType").DateTime.contains(i)){r=Utils.getDateObject(e[0],""),l=Utils.getDateObject(e[1],"");if(!Utils.compareDate(r,l))return this.openAlert(a+":"+I18n.getValueForFields("crm.cal.sch.date.val")),!1}else if(e[0]>e[1])return this.openAlert(a+":"+I18n.getValueForFields("crm.cal.sch.date.val")),!1;return!0},openAlert:function(e){this.setData("alertMsg",e),$L("#validationAlert")[0].ltProp("show",!0)},addRemoveOptionToCriteriaObject:function(e){var t=e[2],a=e[3].$node,i=$(a).closest("lyte-th").data("bodyfieldval");this.getData("criteriaObj")[i].value=t.toString()},ResetCriteriaObject:function(e){for(var t={},a=e||this.getData("headerJson"),i=a.length,o=0;o<i;o++){var r={value:""},l=this.data.LookupDatatypeVsUiType,s=a[o].UITYPE;l.DateTime.contains(s)||l.Date.contains(s)||l.Integer.contains(s)||l.Currency.contains(s)||l.Double.contains(s)?(r.value1="",r.value2="",l.DateTime.contains(s)&&(r.time="",r.time1="",r.time2="")):(100==s||209==s||208==s||207==s||l.PickList.contains(s)||96==s||a[o].userType)&&(r.value=new Array,r.condition="contains"),r.condition="",t[a[o].bodyKey]=r}Lyte.Component.set(this.data,"criteriaObj",t),""===this.getData("searchValue")&&this.getData("toIndex")===this.getData("defaultSearchRecLimit")&&(this.setData("fromIndex",1),this.setData("toIndex",this.getData("defaultToIndex")))},showcopyobs:function(e){e.newValue?(this.openCustomLookup(this.data.reqData.parentModule,this.data.reqData.labelName,this.data.reqData.labelName,this.data.reqData.searchModule,this.data.reqData.fieldVal),this.setData("firstLoading",!0)):this.setData("firstLoading",!1)}.observes("ltPropShow"),isMultiSelectDropDownType:function(e){return 209==e||208==e||207==e||2==e||26==e||96===e||999===e},isEmpty:function(e){if("number"==typeof e||"boolean"==typeof e)return!1;if(null==e)return!0;if("string"==typeof e)return 0===e.trim().length;if(void 0!==e.length)return 0==e.length;var t=0;for(var a in e)e.hasOwnProperty(a)&&t++;return 0==t},getFilterParams:function(){var e=this.getData("criteriaObj"),t=this.getData("headerJson"),a=t.length,i=this.data.searchValue;if("subjname"==this.getData("module"))return i;for(var o={},r=new Array,l=0,s=0;l<a;l++){var d=e[t[l].bodyKey],n={},u="",c=d.condition,m=!1;if("between"===c&&d.value1&&d.value2){if((u=new Array)[0]=d.value1,u[1]=d.value2,!this.validateFilterInput([d.value1,d.value2],c,t[l].FIELDLABEL,t[l].UITYPE,t[l].filterdetails.TYPE))return renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",t[l].FIELDLABEL)),!1}else if("empty"==c||"notempty"==c)c="empty"==c?"equals":"not_equal",u="null",m=!0;else if(t[l].userType&&null!=d.value&&""!=d.value){var p=new Array,h=0,f="[]"!==d.value?d.value.length:0;for(h=0;h<f;h++)p[h]=d.value[h].id;u=p,c="in"}else!this.getData("decimalFldUITypeArr").contains(t[l].UITYPE)||"greater_than"!=c&&"less_than"!=c&&">"!=c&&"<"!=c||null==d.value||""==d.value?d.value&&(u=d.value):!d.value.indexOf(".")>-1&&(u=parseFloat(d.value).toFixed(1));if("DT"==t[l].filterdetails.TYPE)if("between"===c&&d.value1&&d.value2){if(!this.validateFilterInput([d.value1,d.value2],c,t[l].FIELDLABEL,t[l].UITYPE,t[l].filterdetails.TYPE))return!1}else if(d.value&&!this.validateFilterInput(d.value,c,t[l].FIELDLABEL,t[l].UITYPE,t[l].filterdetails.TYPE))return!1;if(t[l].isPrimaryField&&""!=i.trim()){if(!this.validateFilterInput(i.trim(),c,t[l].FIELDLABEL,t[l].UITYPE,t[l].filterdetails.TYPE))return!1;o.api_name=t[l].bodyKey,o.condition="starts_with",i=i.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),o.searchword=encodeURIComponent(i),o.uiType=t[l].UITYPE,o.isPrimarySearch=!0,r[s++]=o}if(this.isEmpty(u)||100!=t[l].UITYPE&&(!this.isMultiSelectDropDownType(t[l].UITYPE)||m)?"T"===t[l].filterdetails.TYPE&&"string"==typeof u&&(u=u.replace(/\\/g,"\\\\").replace(/"/g,'\\"')):(u=(u=JSON.parse(u).join()).replace(/\\/g,"\\\\").replace(/"/g,'\\"'),c="in"),!this.isEmpty(u)&&"-None-"!==u&&"[]"!==u&&("None"!==u||" T"===t[l].filterdetails.TYPE)){if("DT"!=t[l].filterdetails.TYPE&&!this.validateFilterInput(d.value,c,t[l].FIELDLABEL,t[l].UITYPE,t[l].filterdetails.TYPE))return!1;n.api_name=t[l].bodyKey,n.condition=c,n.type=t[l].filterdetails.TYPE,n.searchword=encodeURIComponent(u),n.isPrimarySearch=!1,n.uiType=t[l].UITYPE,r[s++]=n}}return r},updateLookUpView:function(){var e=[];$("#columnListId input:checked").each((function(t,a){e.push($(a).val())}));var t=$(".lookupCriteriaFilter"),a=$(".advanceFilter");t.is(":visible")&&(a.removeClass("lookupFilterOpen"),this.clearFilter()),e=e.join(";");var i=Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=updateLookupView&cust_disp_module="+this.data.ParentModule+"&sellist= "+encodeURIComponent(e)+"&frmmodule="+this.getData("reqData").lookupModule+"&from=createEntity",o={};o[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:i,type:"POST",data:o,success:function(){$L("#popoverTest")[0].ltProp("show",!1),this.setData("lookupColsUpdated",!0),this.data.currentModuleColumns.columns=void 0;var e=this.getFilterParams();if(!e)return!1;this.openCustomLookup(this.data.reqData.parentModule,this.data.reqData.labelName,this.data.reqData.labelName,this.data.reqData.searchModule,null,this.data.sortColumnString,this.data.sortOrderString,e)}.bind(this),error:function(e){406==e.status&&e.responseText&&($("#lookupSelectCol").text(e.responseText),$(".columnCustomizeWrap").addClass("decreaseIndex"),$("#lookupCrt").css("display","none"),renderingUtils.freezeBackground(),showAnimatePopupp("lookupErrorMsg"),$L(".freezeLayer").css("z-index","35"))}})},showColumnListByColumns:function(e,t){e.from="createEntity",e.save="multiLookupsView.updateLookupView();",e.cancel="hideAnimatePopup('columnList');sE()",e.divid="columnListId",e.currentmodule=t;var a=Handlebars.templates.columnList(e);delete e.from;var i=$("#columnList.fromModuleLookup"),o=($("#notificationCenterContainer"),$("#addColumn")),r=$(document).width()-(o.offset().left+o.width());$(document).off("menuItemClicked"),i.html(a).addClass("pFixed dBImp");var l=$("#columnListId");l.sortable({helper:"clone",stop:function(e,t){var a=t.item.find('input[type="checkbox"]');a.length&&(a.prop("disabled",!0),setTimeout((function(){var e=a.attr("ismandatory");(!e||"true"!=e&&"LASTNAME"!=a.attr("value").split("#")[1])&&a.prop("disabled",!1)}),300))}}),crmListView.rowClick("lookupview"),l.find("input:checked").length>=10?l.find("label input:not(:checked)").attr("disabled","disabled").closest("li").addClass("disable"):l.find("label  input:not(:disabled)").removeAttr("disabled").closest("li").removeClass("disable"),l.find("li").find("input").each((function(){-1!=$(this).attr("value").indexOf("LASTNAME")&&($(this).removeAttr("ismandatory"),$(this).attr("disabled",!1))}));var s=$("#menuColumnListView");s.css({"max-height":"230px"}),thirdPartyUtils.bindPerfectScroll(s,{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1}),Crm.userDetails.RTL_ENABLED&&i.css({"min-width":r,zindex:"12 !important"}),this.setData("currentModuleColumns.columns",e.columns),this.setData("currentModuleColumns.currentModule",t),i.find("li").find('input[type="checkbox"]').off("click").click((function(){var e=$(this);e.prop("checked")&&$("#columnListId input:checked").length>Search.MAX_COL_CNT&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.max.cvcols.reached",Search.MAX_COL_CNT)),e.prop("checked",!1))})),i.find(".newgraybtn").attr("onclick","$L('#popoverTest')[0].ltProp('show',false);sE();")},setRelatedToDropdown:function(e,t,a){var i=[];"string"==typeof e&&(e=JSON.parse(e));var o=[],r=Crm.moduleInfo[this.getData("reqData").searchModule];if(o[0]=r.translatedPluralLabel,e.accounts){for(var l=e.accounts,s=l.length,d=0;d<s;d++){var n={};o[1]=l[d].name,n.name=I18n.getMsg("crm.related.contact.account",o),n.id=l[d].id,n.apiName=l[d].apiName,i.push(n)}"REPORTINGTOCONTACTID"!==this.getData("reqData").colname?((n={}).name=I18n.getMsg("crm.label.show")+" "+I18n.getMsg("crm.allcontact.show",o[0]),n.id="all",i.push(n),this.setData("disableRelatedTo","false")):this.setData("disableRelatedTo","true")}else if("Services"===this.getData("reqData").searchModule){s=this.serviceRelatedRecords.length;for(var u=0;u<s;u++){(n={}).name=I18n.getMsg(this.serviceRelatedRecords[u]),n.id=u,n.apiName="Status",i.push(n)}}else{(n={}).name=I18n.getMsg("crm.related.contact.show",o[0]),n.id=this.data.singleRelatedToObj.id,n.apiName=this.data.singleRelatedToObj.apiName,i.push(n),(n={}).name=I18n.getMsg("crm.label.show")+" "+I18n.getMsg("crm.allcontact.show",o[0]),n.id="all",i.push(n)}this.setData("relatedRecordData",i)},showRelatedRecords:function(){this.setData("focusFlag",!0),this.setData("relatedToPopulate",!1),this.setData("fromIndex",1),this.setData("toIndex",this.getData("defaultToIndex"));var e="all"===this.getData("selectedRelatedRecordId");this.setData("showAllRecords",e),this.rollbackFilter(),this.submitAdvancedSearchFilter(!1),$("crm-entity-lookup")[0].component.methods.tableHeightSet()},setDataFromResponse:function(e,t,a){commonUtils.showHideLoadingDiv(!1);var i=renderingUtils.windowWidth/100*5,o=$(".entityLookupTable");if(this.setData("formatDetails",e.formatDetails),this.setData("timeFormat",e.formatDetails.timeFormat.indexOf("a")>0?"12":"24"),this.setData("datePattern",e.formatDetails.datePattern.toUpperCase()),this.setData("lastIndex",e.lastIndex),this.getData("relatedToPopulate")&&(this.getData("accDetails").length>0||Object.keys(this.getData("accDetails")).length>0||this.getData("isRelatedRecords")),this.setData("isLinkingModule",!1),void 0===e.body)return this.setData("hasMoreRecords",!1),void this.toggleForward(!1);var r=this.getData("lookupColsUpdated");if((this.getData("headerJson").length<=0||r||this.getData("moduleRefName")!==e.moduleRefName)&&(this.setData("colAdd",!1),this.ResetCriteriaObject(e.headers),this.setData("headerJson",e.headers),this.setData("colAdd",!0),$(".advanceFilter").removeClass("lookupFilterOpen"),$L(".lookupCriteriaFilter").hide(),this.setData("lookupColsUpdated",!1)),""==e.body)this.setData("bodyContent",[]),this.setData("slicedBodyContent",[]),this.setData("slicedFrom",0),this.setData("slicedTo",this.getData("defaultToIndex"));else{this.setData("bodyContent",e.body);var l=e.body;this.getData("searchApplied")&&(r&&e.body.length>this.getData("slicedFrom")?l=e.body.slice(this.getData("slicedFrom"),this.getData("slicedTo")):(l=e.body.slice(0,this.getData("defaultToIndex")),this.setData("slicedFrom",0),this.setData("slicedTo",this.getData("defaultToIndex")))),this.setData("slicedBodyContent",l)}if(1!=this.getData("fromIndex")&&""!==e.body||(this.setData("fieldId",e.fieldId),this.setData("isFilterApplied",e.isFilterConfigured),this.getData("isLinkingModule")&&"confirmationPage"!=e.mlaction&&this.setData("bodyList",e.body),this.setData("moduleRefName",e.moduleRefName),this.setData("module",e.module),e.parentModule&&this.setData("parentModule",e.parentModule),this.setData("newModel",e.newModel),this.setData("productId",e.productId),this.setData("isfromOutlookRightPanel",e.isfromOutlookRightPanel),this.setData("currencyIsoCode",e.currencyISOCode),this.setData("previous_sort_column",e.previous_sort_column),this.setData("flag",!0),this.setData("currentPage",e.mlaction)),this.setData("singularModName",e.singularModName),null!=this.getData("reqData").fromRelatedList&&1==this.getData("reqData").fromRelatedList&&null!=e.successmsg&&reloadCurrentEntityView(window[this.getData("module")].entityId,this.getData("module")),e.fromSearchCreate&&this.setData("fromSearchCreate",e.fromSearchCreate),(this.getData("reqData").fromaddcamppopup||"Services"==e.module)&&(e.isQuickCreateAllowed=!1),"Products"==this.getData("moduleRefName"))this.setData("searchBarDisplayMsg",I18n.getMsg("crm.lookup.searchby",this.getData("singularModName"))+(e.isProductCodeVisible?"/"+I18n.getMsg("Product Code",this.getData("singularModName")):""));else if("Quotes"==this.getData("moduleRefName")||"Sales_Orders"==this.getData("moduleRefName")||"Invoices"==this.getData("moduleRefName")||"Purchase_Orders"==this.getData("moduleRefName")){for(var s=this.getData("headerJson").length,d=0;d<s;d++)if(this.getData("headerJson")[d].isPrimaryField){var n=[];n.push(this.getData("singularModName")),n.push(this.getData("headerJson")[d].FIELDLABEL),this.setData("searchBarDisplayMsg",I18n.getMsg("crm.lookup.searchby.placeholder.searchDisplayMsg",n));break}}else for(s=this.getData("headerJson").length,d=0;d<s;d++)if(this.getData("headerJson")[d].isPrimaryField){this.setData("searchBarDisplayMsg",I18n.getMsg("crm.lookup.searchby.placeholder",this.getData("headerJson")[d].FIELDLABEL));break}this.setData("isQuickCreateAllowed",e.isQuickCreateAllowed),this.setData("primaryColumn",e.primaryColumn),$(".lookupFetchLoad").hide(),this.setData("requestCompleted",!0),this.setData("hasMoreRecords",e.hasMoreRecords);var u=$("#norec");e.Error?(u.show(),this.setData("errorMsg",e.Error)):0==this.getData("bodyContent").length?(u.show(),this.setData("reqparams",a),this.setData("errorMsg",I18n.getMsg("crm.module.empty.message","subjname"==this.getData("module")?I18n.getMsg("crm.tasks.subject"):I18n.getMsg(this.getData("module"))))):u.hide(),this.toggleForward(e.hasMoreRecords||this.getData("searchApplied")&&e.body.length>this.getData("slicedTo")),this.toggleBackward(this.getData("fromIndex")>1||this.getData("searchApplied")&&this.getData("slicedFrom")>1),$(".lookupListTable .lyteModal").css({right:i,left:i,width:"auto"});var c=this.getData("sortColumnString"),m=o.find(".lyteTableScroll").eq(0);if(o.find("lyte-th").removeClass("lookupSortdesc lookupSortAsc"),""!==c){var p=$L(".entityLookupTable lyte-thead lyte-tr").find("lyte-th[data-coloumn="+c+"]"),h=this.getData("sortOrderString");"sort_asc"===h?p.addClass("lookupSortAsc"):"sort_desc"===h&&p.addClass("lookupSortdesc")}if(!1===this.getData("onScrollAction")){var f=$L(".lookupFieldList .lyteTableScroll");Crm.userDetails.RTL_ENABLED?f.scrollTop(tableTop+1).scrollLeft(tableLeft+1):f.scrollTop(0).scrollLeft(0),$L(".entityLookupTable .lyteTableScroll").resetScrollbar()}e.showOperators&&$(".hideOperators").removeClass("hideOperators"),(o=$(".entityLookupTable")).length>0&&(m.scrollLeft=0,$(".lyteTableFixed").css("left","0"),!1===this.getData("onScrollAction")&&(m.scrollTop=0,this.setData("lookupColsUpdated",!1)),this.setData("onScrollAction",!1)),t&&t(),this.getData("firstLoading")&&(setTimeout((function(){$L("[name=fldValue]").attr("lt-prop-focus",!0)}),100),this.setData("firstLoading",!1)),this.getData("filterApplyClicked")&&(this.setData("filterApplyClicked",!1),this.setData("appliedCriteriaObj",Lyte.deepCopyObject(this.getData("criteriaObj"))),this.setData("disableFilterLink",!0)),this.getData("focusFlag")&&($("[name=fldValue]").attr("lt-prop-focus",!0),this.setData("focusFlag",!1))},rollbackFilter:function(){this.getData("disableFilterLink")||(this.setData("criteriaObj",Lyte.deepCopyObject(this.getData("appliedCriteriaObj"))),setTimeout(function(){this.setData("disableFilterLink",!0)}.bind(this),0))},toggleForward:function(e){e?$L("#navigateForward").removeClass("next_disabled").addClass("next"):$L("#navigateForward").removeClass("next").addClass("next_disabled")},toggleBackward:function(e){e?$L("#navigateBack").removeClass("previous_disabled").addClass("previous"):$L("#navigateBack").removeClass("previous").addClass("previous_disabled")},makeRequest:function(e,t,a){null!=requestObj&&(requestObj.abort(),delete Crm.REQUEST_QUEUE[e+"---"+t],requestObj=null),$L("#navigateBack, #navigateForward").addClass("pEvents");var i=$.ajax({url:e,type:"POST",data:t,success:function(e){"error"===e.status?(commonUtils.showHideLoadingDiv(!1),crmui.showMsgBand("error",I18n.getMsg("crm.lookup.advance.error.msg"),5e3)):this.setDataFromResponse(e,a,t),$L("#navigateBack, #navigateForward").removeClass("pEvents"),$L(".entityLookupTable .lyteTableScroll").resetScrollbar()}.bind(this),error:function(e){commonUtils.showHideLoadingDiv(!1),401===e.status&&(renderingUtils.displayPermissionDenied(),$("crm-entity-lookup")[0].component.setData("ltPropShow",!1)),$L("#navigateBack, #navigateForward").removeClass("pEvents")}});requestObj=i},getRelatedRecordDetailsForProducts:function(e){var t="",a=$("#Crm_"+e+"_VENDORID");if(a[0]&&a.data("id")&&this.getData("reqData").subformdisplaylabel&&Crm.isLineItemSubFormModule(this.getData("reqData").subformdisplaylabel)){t="&productId="+a.data("id");var i={accounts:[]};i.accounts[0]={},i.accounts[0].id=a.data("id"),i.accounts[0].name=a.val(),i.accounts[0].apiName="Vendor_Name",this.setData("accDetails",i),this.setData("isRelatedRecords",!0)}return t},getRelatedRecordDetails:function(e,t){var a,i={},o="";i.accounts=[];var r,l=0,s=[];if((r="Cases"===e?$("#Crm_"+e+"_WHOID"):$("#Crm_"+e+"_CONTACTID"))[0]&&(a=r.data("id"))){if(a&&"null"!==a){s[l]=a,i.accounts[l]={},i.accounts[l].id=a,i.accounts[l].name=r.val();var d=Crm.moduleInfo[r.data("lookupModule")].singularLabel;i.accounts[l].apiName=d+"_Name",l+=1}a=this.getData("selectedRelatedRecordId")&&"all"!==this.getData("selectedRelatedRecordId")?this.getData("selectedRelatedRecordId"):s[0]}(s.length>0?(o=o+"&productId="+(a=s[0])+"&accDetails="+encodeURIComponent(JSON.stringify(i)),this.setData("accDetails",i),this.setData("isRelatedRecords",!0)):(this.setData("accDetails",{}),this.setData("isRelatedRecords",!1)),"Potentials"===t||"Quotes"===t||"SalesOrders"===t)&&((r=$("#Crm_"+e+"_ACCOUNTID"))[0]&&r.data("id")&&(o=o+"&accountId="+r.data("id"),this.data.singleRelatedToObj.id=r.data("id"),this.data.singleRelatedToObj.apiName="Account_Name",this.setData("isRelatedRecords",!0),this.setData("accDetails",{})));return o},getRelatedRecordDetailsForContacts:function(e,t){var a,i="",o=!1;if(/Calls|Tasks|Events/.test(e)){var r=$("#Crm_"+e+"_SEID_select");if(r[0]&&r[0].cxProp&&(o=!0),"Accounts"===(o?r[0].cxProp("selected"):$("#Crm_"+e+"_SEID_label_select").val()||r.val())&&(a=$("#Crm_"+e+"_SEID").data("id"))&&(this.data.singleRelatedToObj.id=a,this.data.singleRelatedToObj.apiName="Account_Name",i="&productId="+a,this.setData("isRelatedRecords",!0)),this.getData("reqData").productFldId&&this.setData("relatedDomId",this.getData("reqData").productFldId),""===i&&this.getData("relatedDomId")&&""!==this.getData("relatedDomId")){var l=this.getData("relatedDomId");if(void 0!==l){var s=$(document.getElementById(l)).val();if("vendorName"===l||"property(vendorName:Vendor Name)"===l){var d=$("[name='property(vendorName:Vendor Name)']");a=d?d.value:""}else a=s||null;"null"!==a&&a&&(this.data.singleRelatedToObj.id=a,this.data.singleRelatedToObj.apiName="Account_Name",i="&productId="+a,this.setData("isRelatedRecords",!0))}}}else{var n={accounts:[]},u=0,c=[];if((b=$("#Crm_"+e+"_ACCOUNTID"))[0])(a=b.data("id"))&&a&&"null"!==a&&(c[u]=a,n.accounts[u]={},n.accounts[u].id=a,n.accounts[u].name=b.val(),n.accounts[u].apiName="Account_Name",u+=1);else if(null==b[0]&&"Crm_Contacts_REPORTINGTOCONTACTID"!==t){if((b=$("#subvalue_ACCOUNTID"))[0])"null"!==(a=b.data("params")?b.data("params").id:null)&&a&&"detailView"==b.data("cid")&&(c[u]=a,n.accounts[u]={},n.accounts[u].id=a,n.accounts[u].name=b[0].text,n.accounts[u].apiName="Account_Name",u+=1);else if(null!=this.getData("reqData").productFldId){let e=$.escapeSelector(this.getData("reqData").productFldId);if("null"!==(a=$("[id='"+e+"']").val())&&a)return this.data.singleRelatedToObj.apiName="Account_Name",this.data.singleRelatedToObj.id=a,i="&productId="+a,this.setData("isRelatedRecords",!0),this.setData("accDetails",{}),i}}if("Crm_Contacts_REPORTINGTOCONTACTID"!==t){var m=e.substring(0,e.length-1),p=m.toUpperCase()+"CF";if(0==m.indexOf("CustomModule")){var h=e.split("CustomModule");p=h[1]<=50?"COBJ"+h[1]+"CF":"COBJCF"}var f="a[id^='subvalue_"+p+"']",D=$(f),g=D.length,C=g>0;0!=D.length||"detailView"==D.eq(0).data("cid")&&null!=D.eq(0).data("cid")||(f="input[id^='Crm_"+e+"_"+p+"']",g=(D=$(f)).length,C=!(D.length>0));for(var y=0;y<g;y++){var I=D.eq(y);if(C){if("Accounts"===(I.data("params")?I.data("params").module:null)){var L=I.data("params").id,b=I.text();L&&b&&(c.contains(L)||(c[u]=L,n.accounts[u]={},n.accounts[u].id=L,n.accounts[u].name=b,n.accounts[u].apiName="Account_Name",u+=1))}}else if("Accounts"===I.data("lookupModule")){L=I.data("id"),b=I.val();L&&b&&(c.contains(L)||(c[u]=L,n.accounts[u]={},n.accounts[u].id=L,n.accounts[u].name=b,n.accounts[u].apiName="Account_Name",u+=1))}}}else if("Crm_Contacts_REPORTINGTOCONTACTID"===t&&void 0!==window[e]&&"view"===window[e].currentStatus){(b=$("#subvalue_ACCOUNTID"))[0]&&"null"!==(a=JSON.parse(b[0].dataset.params).id)&&a&&(c[u]=a,n.accounts[u]={},n.accounts[u].id=a,n.accounts[u].name=b[0].text,n.accounts[u].apiName="Account_Name",u+=1)}c.length>0||""!==i?(i=i+"&productId="+(a=this.getData("selectedRelatedRecordId")&&"all"!==this.getData("selectedRelatedRecordId")?this.getData("selectedRelatedRecordId"):c[0])+"&accDetails="+encodeURIComponent(JSON.stringify(n))+"&accountid="+a+"&accountname="+encodeURIComponent(n.accounts[0].name),this.setData("isRelatedRecords",!0),this.setData("accDetails",n)):(this.setData("accDetails",{}),this.setData("isRelatedRecords",!1))}return i},quickCreateRelatedListHandle:function(e,t,a){a&&("Contacts"===e?this.getRelatedRecordDetailsForContacts(a,t):"Campaigns"===e||"Potentials"===e||"Quotes"===e||"SalesOrders"===e?this.getRelatedRecordDetails(a,e):"Services"===e?this.setData("isRelatedRecords",!0):"Products"===e&&this.getRelatedRecordDetailsForProducts(a))},openCustomLookup:async function(e,t,a,i,o,r,l,s){commonUtils.showHideLoadingDiv(show);var d=this.getData("fieldObj");if(e=e||(d.module?d.module:""),i=i||d.searchmodule,this.data.reqData.isInitialLoad=!0,Crm.userDetails.isDynamicLookupFilterEnabled&&!Lyte.Router.getRouteInstance("crm.settings.import")){let a=$("crm-create-layout"),i=$L("crm-canvas-form"),o=$L("#createEntityForm").is(":visible")&&!(this.data.reqData.cid&&"showLookup"===this.data.reqData.cid),r=$L("#dealCreateConfigurationModal").is(":visible"),l=$("#multipleFieldsEditPop").is(":visible"),s=$L("#formRuleMandatoryFields").is(":visible"),d=$L("#VRAjaxEdit").is(":visible");var n;this.getData("reqData").fieldId||this.getData("reqData").fieldid?n=this.getData("reqData").fieldId?this.getData("reqData").fieldId:this.getData("reqData").fieldid:r&&(this.getData("reqData")&&(this.getData("reqData").isFromAppointmentsPreference="true"),(this.getData().fieldId||this.getData().fieldid)&&(n=this.getData().fieldId?this.getData().fieldId:this.getData().fieldid));let D=store.peekRecord("field",n);if(D&&D.lookup&&D.lookup.query_details&&D.lookup.query_details.query_id&&!r){var u="create"!==this.getData("initRoute")?Lyte.Router.getRouteInstance().transition.info.dynamicParams[1]:void 0,c=store.peekRecord("module",moduleRecordMapping[e].id).fields;let r;c||(c=await store.findAll("field",{module:moduleRecordMapping[e].api_name,type:"all"},!1,void 0,{apiVersion:"4"}));var m={};if(!(window[e]&&"edit"===window[e].currentStatus||"create"===window[e].currentStatus||"clone"===window[e].currentStatus||Lyte.Router.getRouteInstance().transition.info.route.includes("create")||Lyte.Router.getRouteInstance().transition.info.route.includes("edit")||Lyte.Router.getRouteInstance().transition.info.route.includes("clone"))||o||l){if(o||l){m={};let a=!1;if(l){let i=$("#"+t);if(a=void 0!==i.data("subformsectionlabel")&&""!==i.data("subformsectionlabel"),a){p={};let t=moduleRecordMapping[Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].id==subFormTabId}))];p.subformApiName=t.api_name,p.subformTabId=subFormTabId,p.subformTabName=t.module_name,p.isSubformField=a,p.index=i.attr("id").split("_")[4];let o=await this.loadChildRelationShip(p,e);c=store.peekRecord("module",moduleRecordMapping[e].id).fields,c=o.concat(c)}}if(crmTemplate.iterateGroupFieldsAndGetFieldValues(D.lookup.query_details.criteria,c,m,e,p),l){let e="fieldsContainer_header"===$L("#multipleFieldsEditPop #duringTabs").find(".sel").attr("id");l&&e&&(m.id=detailView.entityId)}}}else{if(r=a[0]?a[0].component.getData().dataBind:i[0]?i[0].component.getData().record:void 0,this.getData("reqData").subformApiName){var p={subformApiName:this.getData("reqData").subformApiName,indexVal:this.getData("reqData").indexVal};let t=await this.loadChildRelationShip(p,e);c=c.concat(t)}var h=store.peekRecord("field",n),f={};h&&h.lookup&&h.lookup.query_details&&h.lookup.query_details.query_id&&(r?this.iterateGroupFieldsAndGetFieldValuesFromRecordData(h.lookup.query_details.criteria,r,f,c,e,p):crmTemplate.iterateGroupFieldsAndGetFieldValues(h.lookup.query_details.criteria,c,f,e)),m=f,void 0===window[e]||"edit"!==window[e].currentStatus&&"view"!==window[e].currentStatus||(m.id=u)}!u&&e&&window[e]&&"view"===window[e].currentStatus&&(u=detailView.entityId,m.id=u),"view"===window[e].currentStatus&&0===Object.keys(m).length&&((s||d)&&crmTemplate.iterateGroupFieldsAndGetFieldValues(D.lookup.query_details.criteria,c,m,e),m.id=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1]),this.setData("additionalParam",{child_data:m})}}if("ownername"===i&&Crm.userDetails&&Crm.userDetails.PERSONAL_ACCOUNT)return;this.setData("isRelatedRecords",!1),this.getData("reqData").parentModule||this.setData("parentModule",e);var D=this.getData("showAllRecords"),g="",C=null,y=$L(".lookupFieldList .lyteTableScroll"),I=y.scrollLeft(),L=y.scrollTop();null===o&&(o=""),this.setData("requestCompleted",!1);var b=$("#Crm_"+e+"_CURRENCYISOCODE").val();if((b=d&&d.currencyISOCode?d.currencyISOCode:$("#Crm_"+e+"_CURRENCYISOCODE").val())||(b=$("#subvalue_CURRENCYISOCODE").html()),b||(b=""),this.setData("currencyIsoCode",b),"Contacts"===i&&null==this.data.reqData.labelId||"Contacts"===i&&this.getData("reqData").productFldId)g=this.getRelatedRecordDetailsForContacts(e,t);else if("Campaigns"!==i&&"Potentials"!==i&&"Quotes"!==i&&"SalesOrders"!==i||null!=this.data.reqData.labelId)"Services"===i&&null==this.data.reqData.labelId?(this.setData("isRelatedRecords",!0),""!=this.getData("selectedRelatedRecordId")&&!Number.isNaN(parseInt(this.getData("selectedRelatedRecordId")))&&parseInt(this.getData("selectedRelatedRecordId"))<=this.serviceRelatedRecords.length&&(g="&serviceStatusFilter="+this.getData("selectedRelatedRecordId"))):"Products"===i&&null==this.data.reqData.labelId&&(g=this.getRelatedRecordDetailsForProducts(e));else var v=!(!(g=this.getRelatedRecordDetails(e,i))||"Campaigns"!==i);!0===this.getData("fromSearchCreate")&&(C=$("#layoutdetails").val()),D&&(g="");var T="";i===crmModuleConstants.Accounts&&e===crmModuleConstants.Accounts&&void 0!==window[e]&&("edit"===window[e].currentStatus||"view"===window[e].currentStatus)&&window[e].entityId,"Campaigns"===i&&"Campaigns"===e&&this.getData("reqData").fromaddcamppopup&&window[e]&&window[e].entityId&&(T="&campaignId="+window[e].entityId);var R=Crm.getCrmBasePath()+"/Search.do?searchmodule="+this.getData("reqData").lookupModule+"&fldName="+t+"&fldId="+t+"&fldLabel="+a+"&fldValue="+o+g+"&currencyISOCode="+b+T+"&newModel=true";(this.getData("reqData")&&this.getData("reqData").fromaddcamppopup||crmTemplate.fromAddToCampaignTool)&&(R+="&addToCampaign=true"),R+="&parentLayoutId="+C+"&parentModule="+e,R=networkUtils.getPortalURL(R),null==window[e]||"edit"!==window[e].currentStatus&&"view"!==window[e].currentStatus||(R+="&entityId="+window[e].entityId),null!=r&&null!=r&&""!=r&&(R+="&sortOrderString="+l+"&sortColumnString="+r,this.setData("sortOrderString",l),this.setData("sortColumnString",r)),this.data.reqData.subformsectionlabel&&(R+="&isSubFormField=true"),1==this.getData("fromSearchCreate")?R+="&fromSearchCreate=true":1==this.getData("fromAutDealCreate")&&(R+="&fromAutDealCreate=true"),R+="&fieldId="+this.getData("reqData").fieldid,this.setData("fieldId",this.getData("reqData").fieldid),R+="&openInAdvSearch=true",void 0!==s&&s.length>0?("searchcriteria="+("subjname"===this.getData("module")?s:JSON.stringify(s)),R+="&luceneSearch=true",this.setData("searchApplied",!0)):this.setData("searchApplied",!1);var S=$("[cscript-tag='"+$ESAPI.encoder().encodeForJavaScript(this.getData("reqData").sysrefname)+"']").attr("data-criteria");CScriptLib&&S&&""!==S&&(R+="&filtercriteria="+encodeURIComponent(S)),(this.getData("accDetails").length>0||Object.keys(this.getData("accDetails")).length>0||this.getData("isRelatedRecords"))&&this.setRelatedToDropdown(this.getData("accDetails")),this.getData("relatedDropdown")&&this.getData("relatedDropdown").length&&null==this.data.reqData.labelId&&this.setData("relatedRecordData",this.getData("relatedDropdown")),this.setDefaultCriteria(i,e),this.getData("quickCreateUnsupportedModules").contains(i)||this.getData("fromSearchCreate")?this.setData("isQuickCreateAllowed",!1):this.setData("isQuickCreateAllowed",!0),this.getData("reqData").fromaddcamppopup&&this.setData("isQuickCreateAllowed",!1),v&&(null==store.modelFor(moduleRecordMapping.Contacts.id)&&(store.registerModel(moduleRecordMapping.Contacts.id,{},{extends:"entity"}),this.dummyStoreRegistered=!0),this.setData("lookupUrlForCampaign",R));var k=document.getElementsByTagName("crux-lookup-filter-view")[0];let E=this.getData("isQuickCreateAllowed")&&Lyte.Component.registeredHelpers.showAddRecord(i);k&&"entityLookup"===k.component.data.cxPropFrom?(k.setData("cxPropCreateYield",E),k.component.init()):(this.setData("isQuickCreateAllowed",E),this.setData("ltPropBindToBody",!0)),!1===this.getData("onScrollAction")&&(Crm.userDetails.RTL_ENABLED?y.scrollTop(L+1).scrollLeft(I+1):y.scrollTop(0).scrollLeft(0),$L(".entityLookupTable .lyteTableScroll").resetScrollbar())},closeThisLookupPop:function(){var e=$("[name=fldValue]");void 0!==e.attr("lt-prop-value")&&e.attr("lt-prop-value",""),document.getElementById("lookupListPopup").ltProp({show:!1}),this.backgroundCloseFunc(),this.setData("ltPropBindToBody",!1)},methods:{setFieldValue:function(e){var t=e.displayName,a=e.id,i=document.querySelector(".fromLyteFields"),o=$("#Crm_Cases_PHONE"),r=$("#Crm_Cases_EMAIL"),l=$("#topBandPopup"),s=l.is(":visible"),d=$("#lookupPopup").is(":visible"),n=this.getData("reqData"),u=this.getData("parentReqData"),c=this.getData("fromSearchCreate");if(c||validationUtils.isEmpty(u)||!validationUtils.isEmpty(n)||(this.setData("reqData",u),n=u),"subjname"===this.getData("module")){var m=$("#task_subject");m.val(t),$L("#task_subject").data("id",a),"object"==typeof Crm&&Crm.isZiaOwnerRecommendationEnabled&&m.trigger("loadzor")}else if(this.getData("reqData").isFrmZBModule)this.zbIntegrationSelectForAccountAndVendor(a,t);else if(!0===this.getData("newModel")){var p,h,f,D=n.lookupModule,g=window[n.module]?window[n.module].currentStatus:"view",C=n.labelName;"Crm_Events_CONTACTID"!==C&&"Crm_Events_SEID"!==C||(f="events");var y=$(document.getElementById(C));if(y[0]&&"INPUT"!==y[0].tagName){let e=$.escapeSelector(C),t=$("[id="+e+"]");for(var I=t.length,L=0;L<I;L++)if("INPUT"===t[L].tagName){y=t.eq(L);break}}var b=this.getData("reqData").parentModule;Crm.moduleName=b||"";var v=this.getData("currentSelectedRecord"),T=!!(y[0]&&y.data("colname")&&y.data("colname").indexOf("CF")>0);if(T||"PARENTACCOUNTID"===this.data.reqData.colname||"Accounts"!==D?T||"Contacts"!==D?T||"Leads"!==D?T||"Vendors"!==D||(v.addressInfo={STREET:v.Street?v.Street:null,CITY:v.City?v.City:null,STATE:v.State?v.State:null,COUNTRY:v.Country?v.Country:null,ZIPCODE:v.Zip_Code?v.Zip_Code:null}):v.addressInfo={LANE:v.Street?v.Street:null,CITY:v.City?v.City:null,STATE:v.State?v.State:null,COUNTRY:v.Country?v.Country:null,CODE:v.Zip_Code?v.Zip_Code:null}:v.addressInfo={BILLINGCITY:v.Mailing_City,BILLINGCODE:v.Mailing_Zip,BILLINGCOUNTRY:v.Mailing_Country,BILLINGSTATE:v.Mailing_State,BILLINGSTREET:v.Mailing_Street,SHIPPINGCITY:v.Other_City,SHIPPINGCODE:v.Other_Zip,SHIPPINGCOUNTRY:v.Other_Country,SHIPPINGSTATE:v.Other_State,SHIPPINGSTREET:v.Other_Street,CURRENCYISOCODE:v.Currency}:v.addressInfo={BILLINGCITY:v.Billing_City,BILLINGCODE:v.Billing_Code,BILLINGCOUNTRY:v.Billing_Country,BILLINGSTATE:v.Billing_State,BILLINGSTREET:v.Billing_Street,SHIPPINGCITY:v.Shipping_City,SHIPPINGCODE:v.Shipping_Code,SHIPPINGCOUNTRY:v.Shipping_Country,SHIPPINGSTATE:v.Shipping_State,SHIPPINGSTREET:v.Shipping_Street,CURRENCYISOCODE:v.Currency},("SalesOrders"===b&&"Quotes"===D&&!T||"Invoices"===b&&"SalesOrders"===D&&!T||"Invoices"===b&&"Quotes"===D&&!T)&&"view"!==g)Crm.fillFormObject(encodeURIComponent(t),a,D,null,b,void 0,$("#layoutDetails").val());else{h=p=y,p.val(t.trim()),p.is("textarea")&&p.css({height:p[0].scrollHeight-8});var R=h.data("dependfield"),S=null;R&&(S=h.data("id")),h.data("id",a),"leContModName"===C&&$(this.getDomValByIdOrName("property(leContModId)")).attr("value",a),"modname"===C&&$(this.getDomValByIdOrName("property(modid)")).attr("value",a);var k=n.labelId;if(k){$(this.getDomValByIdOrName(k)).attr("value",a);var E=$L(this.getDomValByIdOrName(k))[0];E&&E.classList.contains("mUpdateCruxLookupComp")&&E.component.setData("cxPropValue",{name:t,id:a})}$(p)&&$(p).data()&&$(p).attr({"data-selectedlookupvalue":$(p).val(),"data-selectedid":$(p).data().id});var _=v.Account_Name;if(!!Lyte.Router.getRouteInstance("crm.settings.migration.index.map-fields")){for(var P=y.length,F=y.eq(0).data(),w=1;w<P;w++)Object.assign(y.eq(w).data(),F);var O,A=F.fieldMappingInfo.split("_"),N=parseInt(A[1]),M=A[2],U=$L("crm-dm-field-mapping")[N],q=11;U?(q=(O=(U=U.component).getData("fieldRows")[M]).getFileIndex(),C.toString().length?$L(".fieldListForModule:visible").find("lyte-tr")[M].className="migFieldReplaceAdded":$L(".fieldListForModule:visible").find("lyte-tr")[M].className=""):O=(U=$L("crm-dm-assign-default")[0]).getData("defaultRows")[M],O.setDefault({name:t,id:a}),U.setData("dirtyIndex",Object.assign({},{index:q}))}var x=y.data("colname");if("Contacts"===D&&_&&void 0!==x&&x.indexOf("CF")<0&&!this.getData("fieldObj.module")){var B="Contact Name"===C?"Account Name":C.replace(x,"ACCOUNTID"),Y=this.getDomValByIdOrName(B);if((!Y||Y&&!Y.length)&&(Y=this.getDomValByIdOrName(C.replace(x,"SEID"))),Y&&crmTab.tabList.contains("Accounts")){var j=_.name+"",V=_.id+"",G=this.getDomValByIdOrName(B+"_label_select");if(G&&"Accounts"===$(G).val())"null"===j&&(j="",V=""),""===$(Y).val()&&$(Y).val(unescape(j)).data("id",V);else if(null!==V&&"null"!==V&&""===$(Y).val()){var Q=$(Y).attr("id");$("#"+Q+"_label_select").val("Accounts").trigger("change.select2"),$(Y).val(unescape(j)).data("id",V)}}Y&&$(Y).data()&&$(Y).attr({"data-selectedlookupvalue":$(Y).val(),"data-selectedid":$(Y).data().id})}if("Contacts"===D&&0===C.indexOf("CID")){var J=$("#property\\("+C+"\\)");void 0!==J&&J.val(a);var z=C.replace("CID",""),H=$("#accNameInConRoleAdd_"+z);if(H)void 0!==_&&(j=_.name+""),void 0!==j&&"null"!==j?H.text(j):H.empty()}if(void 0!==x&&x.indexOf("CF")<0&&v&&v.addressInfo&&b&&!this.getData("fieldObj.module")&&Object.values(v.addressInfo).length!=Object.values(v.addressInfo).filter((e=>null==e)).length&&Crm.fillAddressinfo(this.getData("parentModule"),v.addressInfo),"Contacts"===D&&"Cases"===b&&void 0!==x&&x.indexOf("CF")<0&&!this.getData("fieldObj.module")){var Z=v.Phone?v.Phone:"",W=v.Email?v.Email:"";Z&&"null"!==Z&&o.length>0&&""===o.val()&&o.val(Z),W&&"null"!==W&&r.length>0&&""===r.val()&&r.val(W)}var K=Crm.isLineItemSubFormModule(y.data("subformdisplaylabel"));if(K&&p.attr("id").indexOf("PRODUCTID")>-1){var X={};X.Product_Name=v.Product_Name,X.id=v.id,X.Unit_Price=v.Unit_Price,X.Qty_in_Stock=v.Qty_in_Stock,X.Qty_Ordered=v.Qty_Ordered,X.Product_Code=v.Product_Code,X.Taxable=null!=v.$taxable?v.$taxable:null!=v.Taxable&&v.Taxable,X.LAYOUTID=v.Layout,X.Tax=Crm.getPrdTaxDetails(v.Tax,!0),p.attr("prdDetails",JSON.stringify(X)),Crm.handleProductLineItemUpdate(p),v.Product_Code&&""!==v.Product_Code&&p.data("lineitemprodcode")?p.val(t.replace(/(\r\n|\n|\r)/gm," ").concat(" ("+v.Product_Code+")").trim()):p.val(t.replace(/(\r\n|\n|\r)/gm," "))}var ee={},te=this.getData("fieldOfLookupVal").length;for(L=0;L<te;L++){var ae=this.data.fieldOfLookupVal[L].related_field;ee[ae.id]=this.data.currentSelectedRecord[ae.api_name],"object"==typeof ee[ae.id]&&ee[ae.id].id&&ee[ae.id].name&&(ee[ae.id].ID=ee[ae.id].id,ee[ae.id].Name=ee[ae.id].name,delete ee[ae.id].id,delete ee[ae.id].name)}var ie=Lyte.Router.getRouteInstance("crm.tab.module")?Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam():void 0;if(!$("#VRAjaxEdit").is(":visible")){var oe=$L("#createEntityForm"),re=$L("#qCreate"),le=$("#multipleFieldsEditPop");if(oe.is(":visible")||re.is(":visible")||le.is(":visible")||!ie||"view"!==window[ie].currentStatus||$("#multipleFieldsEditPop:visible").length>0){if(K&&X&&moduleRecordMapping.Products.fields){ee=this.referenceFieldMethod(p,v);var se=moduleRecordMapping.Products.fields.find((e=>"Taxable"==e.api_name));ee&&se&&se.id&&(ee[se.id]=v.Taxable)}else y&&y.data&&y.data("subformsectionlabel")&&(ee=this.referenceFieldMethod(p,v));Crm.setRefFieldValues(p,a,ee,void 0,"lookuppopup")}else{var de={};de.currency=this.data.currentSelectedRecord.Currency;var ne=this.getData("reqData").fieldid,ue=this.data.currentSelectedRecord.Layout?this.data.currentSelectedRecord.Layout.id:void 0;ue?(de.curLayoutFields=store.peekRecord("layout",ue)?store.peekRecord("layout",ue).fields:void 0,!de.curLayoutFields||!de.curLayoutFields.length&&this.getData("reqData").lookupModule?store.findRecord("layout",this.data.currentSelectedRecord.Layout.id,{module:this.getData("reqData").lookupModule},!0,!0,{apiVersion:"2.2"}).then(function(e){de.curLayoutFields=e[0].fields,de.curLayoutFields=de.curLayoutFields?de.curLayoutFields.map((function(e){return e.id})):[],fieldOfLookup.getReferFromFieldIdVsColumnName(ee,ne,a,de)}.bind(this)):(de.curLayoutFields=de.curLayoutFields?de.curLayoutFields.map((function(e){return e.id})):[],fieldOfLookup.getReferFromFieldIdVsColumnName(ee,ne,a,de))):fieldOfLookup.getReferFromFieldIdVsColumnName(ee,ne,a,de)}}if(C.indexOf("txtListPrice")>-1&&h.val(a),"events"===f){"Accounts"===D&&(p.attr("recId",a),Events.relAccId!==a&&(Events.relAccMod=!0,Events.relAccName=t),Events.relAccId=a);var ce=v.addressInfo;ce&&Events.setAddressInfo(ce,D)}if("Events"!==b||"Leads"!==D&&"Contacts"!==D)"Potentials"===D&&"rLEmail"===$('[name="source"]').val()||"Potentials"===D&&"rLEmail"===n.source?("Contacts"===D&&(Crm.userDetails.isRelatedListLyteEnabled?this.reloadPersonality("Deals"):reloadPersonality("potentialspersonality")),EntityEmail.changeDealForEmail("associateDeal",C,a,t)):"Tasks"!==D||"Leads"!==b&&"Contacts"!==b||"Crm_Tasks_CONTACTID"!==C?"Calls"!==D||"Leads"!==b&&"Contacts"!==b||"Crm_Calls_CONTACTID"!==C?"PriceBooks"===D&&"null"!==t&&null!==t&&(h.value=a,p.value=t):crmBstTime.showSuggestionForCreateCall():crmBstTime.showSuggestionForCreateTask();else{var me=$("#Events_fldRow_PARTICIPANTID").length>0,pe=v.Email,he=2===Events.createEditJson.isApproved||3===Events.createEditJson.isApproved,fe=!(!(he&&"detailView"===Events.evtCreateFrom&&Events.createEditJson.recordFieldsEditAllowed&&Events.createEditJson.record_modification)||0!==Events.createEditJson.record_modification.length&&!Events.createEditJson.record_modification.contains("PARTICIPANTID"))||!he;if(pe&&"null"!==pe&&me&&fe){var De=$("#addpartCheckbox");$("#addpartCheck").show(),$("#addpartCheckboxTitle").text(I18n.getMsg("crm.event.add.contact",[t])),De.attr({recId:a,module:D,onclick:"Events.addRelatedParticipant($(this),'"+a+"','"+D+"')"})}else $("#addpartCheck").hide()}if(R&&S!==a){var ge=h.data("fieldid");ProcessFlow.getDuringTransitionDependentFields(a,ge),V&&Y&&$(Y).data("dependfield")&&ProcessFlow.getDuringTransitionDependentFields(V,$(Y).data("fieldid"))}s&&""!==l.html()&&!this.data.fromSalesInbox&&hideAnimatePopup("topBandPopup",!0),d&&hideAnimatePopup("lookupPopup",!0),$(p).effect("highlight",{},1e3)}if("Campaigns"===D&&void 0!==v.$campaign_type){var Ce=document.querySelector("crm-add-to-campaign-popup");if(Ce){var ye=v.$campaign_type,Ie=Ce.getData("showPopup"),Le=$("#AddToCampaign_CampaignType");if(Ie&&Le&&Le.length>0){var be={campaignType:ye,selectedCampaign:a,buttonLabel:I18n.getMsg("crm.button.save")};5===ye?be.buttonLabel=I18n.getMsg("crm.survey.label.sendsurvey"):4===ye&&(be.buttonLabel=I18n.getMsg("crm.label.next")),Ce.setData(be)}}}"Campaigns"===D&&crmTemplate.fromAddToCampaignTool&&(Lyte.Router.transitionTo({route:"crm.tab.module.actions.add-to-campaigns",dynamicParams:[crmListView.getObject().module],queryParams:{"entity-id":a}}),delete crmTemplate.fromAddToCampaignTool),$(p)&&$(p).data()&&($(p).attr({"data-selectedlookupvalue":$(p).val(),"data-selectedid":$(p).data().id}),this.getData("fromSearchCreate")&&"object"==typeof Crm&&Crm.isZiaOwnerRecommendationEnabled&&$(p).trigger("loadzor")),this.getData("fromAutDealCreate")&&document.querySelector("crm-appointment-preference").component.executeMethod("closeEntityLookup",D,t,a),$(p).trigger("create_edit_clone_DomChange",this).focus()}if(i&&i.component&&!c){var ve=i.component;ve.setData({selectedSingleId:""}),ve.invAutoFill=!0;var Te=ve.getData("moduledataUicomp.api_name");"Events"===ve.getData("modulenameUicomp")&&"What_Id"===Te&&"Contacts"===ve.getData("whatIdSelectedOption")&&(Te="Who_Id"),"Events"===ve.getData("modulenameUicomp")||"Who_Id"!==Te||"Leads"!==ve.getData("currentRelatedToOption")||ve.onWhoIdOptionChange||(Te="What_Id");var Re={name:e.displayName,id:a};Lyte.Component.set(i.component.getData("dataBind"),Te,Re),i.component.setData({editInit:!1,newLookupcreated:!0,selectedSingleId:a}),i.classList.remove("fromLyteFields")}this.closeThisLookupPop()},onDataLoaded:function(){this.setData("showCopy",!0)},checkForLookupAlert:function(){var e=$("#columnList.fromModuleLookup"),t=$("#lookupErrorMsg").is(":visible");if(e.length>0&&t)return!1},clearInput:function(e,t){t.$node.querySelector("input").setValue("")},sortColumnsInLookup:function(e){var t=$L(".sortableColumn"),a=t.closest("lyte-th").data("position"),i=this.getData("headerJson")[a],o=i.ColumnName,r=i.isSortable;if(this.getData("bodyContent").length>0)if(r){var l=null,s=null;"Unsort"!==e?("Last Name"==o?(l="Last Name##COL",o="Last Name##COL"):l=o,s="Asc"==e?"sort_asc":"sort_desc"):(s="",l=""),this.setData("sortOrderString",s),this.setData("sortColumnString",""),this.rollbackFilter();var d=this.getFilterParams();if(!1===d)return!1;this.setData("fromIndex",1),this.setData("toIndex",d.length>0?this.getData("defaultSearchRecLimit"):this.getData("defaultToIndex")),this.openCustomLookup(this.data.reqData.parentModule,this.data.reqData.labelName,this.data.reqData.labelName,this.data.reqData.searchModule,this.data.reqData.fieldVal,l,s,d)}else renderingUtils.showCustomAlert(I18n.getMsg("crm.sort.alert"));t.removeClass("sortableColumn")},showRelatedRecords:function(){this.showRelatedRecords()},backgroundCloseFunc:function(){this.backgroundCloseFunc()},customStyleRemoval:function(e){$("#zIndexStyleSheet").remove(),e&&27===e.keyCode&&this.cancelLookupPopClose(this)},addRemoveOptionToCriteriaObject:function(){this.addRemoveOptionToCriteriaObject(arguments)},sortColumnsClose:function(){this.setData("showSortableOptions",!1),$L(".sortableColumn").removeClass("sortableColumn")},closeThisLookupPop:function(){this.closeThisLookupPop()},tableHeightSet:function(){var e=2.5*renderingUtils.windowHeight/4;$(".entityLookupTable").css("max-height",e)},tableStyleProperty:function(){this.tableStyleProperty()},changeRequestData:function(e,t){e.isFromAppointmentsPreference&&delete t.query_id,e.isInitialLoad?delete e.isInitialLoad:Crm.userDetails.isAPIRelevanceSortingEnabled&&Crm.userDetails.apiRelevanceSortingEnabledModules.includes(e.searchModule)&&(t.isRelevance=!0)}},cancelLookupPopClose:function(){var e,t=$("#searchCreatePopup"),a=$("#createEditCallDiv"),i=$("#eventCreatePopup"),o=$("#qCreate"),r=$("#ctinotifier"),l=$("#ctiapi_activitys_create_task");return t.is(":visible")&&t[0].childElementCount>0?e=t:a.is(":visible")&&a[0].childElementCount>0?e=a:i.is(":visible")&&i[0].childElementCount>0?e=i:o.is(":visible")&&o[0].childElementCount>0?e=o:r.is(":visible")&&r[0].childElementCount>0?e=r:l.is(":visible")&&l[0].childElementCount>0&&(e=l),void 0===e},tableStyleProperty:function(){$L("#filterbox").focus();var e=$("crm-entity-lookup")[0],t=renderingUtils.windowHeight/2,a=Crm.isFromSalesInbox,i=$(".lookupFieldList"),o=i.height()+35,r=e.getData("headerJson").length,l=$("#norec"),s=$L(".lookupCriteriaLabelWrap").last().outerHeight();e.component.setData("columnCustHgt",s+"px"),a&&this.setData("fromSalesInbox",a),r>=6?i.find("lyte-table-structure").addClass("bigLookupTable"):i.find("lyte-table-structure").removeClass("bigLookupTable"),o>=t?$(".lookupFetchingWrap").addClass("moreRecordsTable"):$(".lookupFetchingWrap").removeClass("moreRecordsTable"),e.getData("bodyContent").length<1?l.show():l.hide()},backgroundCloseFunc:function(){if(!1===this.getData("forLookupofLookup")?$(".lookupListTable").removeClass("forSearchCreateLookup"):this.setData("forLookupofLookup",!1),this.dummyStoreRegistered&&(delete this.dummyStoreRegistered,store.unregisterModel(moduleRecordMapping.Contacts.id)),this.setData("fieldOfLookupVal",[]),this.setData("flushView",!0),this.setData("allFieldsNeeded",!1),this.setData("lookupUrlForCampaign",""),this.setData("ltPropBindToBody",!1),this.setData("ltPropShow",!1),this.setData("relatedDomId",""),this.setData("additionalParam",{}),$("#columnList.fromModuleLookup").removeClass("dBImp"),"PRODUCTDETAILS"===this.getData("reqData").colname){var e=$("#hrow"+this.getData("reqData").rownumber);e.hasClass("hide")&&e.remove()}this.setData("relatedToPopulate",!0),this.setData("fromIndex",1),this.setData("toIndex",this.getData("defaultToIndex")),this.setData("slicedFrom",0),this.setData("slicedTo",this.getData("defaultToIndex")),this.setData("bodyContent",[]),this.setData("slicedBodyContent",[]),this.setData("selectedList",[]),this.setData("searchValue",""),this.setData("currencyIsoCode",""),this.setData("relatedRecordData",[]),this.setData("accDetails",{}),this.setData("fromSearchCreate",!1),this.setData("fromQuickCreate",!1),this.setData("fromAutDealCreate",!1),$("#columnList").html(""),$("body").removeClass("bodyWrapper"),this.getData("isLinkingModule")&&this.getData("selectedIds").length>0?this.setData("currentpage","EditPage"):this.setData("currentpage","viewPage"),this.ResetCriteriaObject(),this.setData("appliedCriteriaObj",Lyte.deepCopyObject(this.getData("criteriaObj"))),this.setData("flag",!1),this.setData("sortColumnString",""),this.setData("sortOrderString",""),this.setData("showAllRecords",!1),this.setData("reqData","{}"),this.setData("resetCriteriaFlag",!1),this.setData("selectedRelatedRecordId",""),this.setData("searchApplied",!1)},clearFilter:function(){this.ResetCriteriaObject.call(this),$(".advanceFilter").removeClass("lookupFilterOpen"),$(".lookupCriteriaFilter").hide(),this.setData("resetCriteriaFlag",!1)},layersAnalystAgent:function(e,t,a,i,o){"subjname"===a.lookupModule?e.setData({showSubjLookup:!0,module:"subjname",modId:moduleRecordMapping.Tasks.id,reqData:a,fieldId:a.fieldid}):e.setData({showSubjLookup:!1,reqData:a,modId:moduleRecordMapping[a.lookupModule].id,singularModName:moduleRecordMapping[a.lookupModule].singular_label,module:""});var r=$(document.getElementById(a.labelName));if(r)var l=Crm.isLineItemSubFormModule(r.data("subformdisplaylabel")),s=!(l||!r.data("subformsectionlabel"));this.addAdditionalFieldsToLookup(a.lookupModule,l,s);var d=a.labelName?this.getDomValByIdOrName(a.labelName):"";this.setData("selectedRecordName",d&&d.val()?d.val():""),a.isFrmZBModule&&a.selectedRecordName&&this.setData("selectedRecordName",a.selectedRecordName),!a.id&&d&&"subjname"===a.lookupModule?a.id=d.data("id"):!a.id&&d&&(a.id=$(d).data("id"));var n,u=$("#searchCreatePopup"),c=$("#createEditCallDiv"),m=$("#eventCreatePopup"),p=$("#qCreate"),h=$("#ctinotifier"),f=$("#ctiapi_activitys_create_task"),D=document.getElementById("lookupListPopup"),g=$("#ctinotifier_center"),C=$("#subSecondaryPopup");if(this.data.reqData.fieldid){var y=store.peekRecord("field",a.fieldid);!y&&this.data.reqData.parentModule?store.findRecord("module",moduleRecordMapping[this.data.reqData.parentModule].id,void 0,void 0,void 0,{getFields:!0}).then(function(e){e&&e[0].fields&&(y=store.peekRecord("field",this.data.reqData.fieldid))&&this.setData("parentModuleData",Lyte.deepCopyObject(y))}.bind(this)):y&&this.setData("parentModuleData",Lyte.deepCopyObject(y))}u.is(":visible")&&u[0].childElementCount>0?n=u:c.is(":visible")&&c[0].childElementCount>0?n=c:m.is(":visible")&&m[0].childElementCount>0?n=m:p.is(":visible")&&p[0].childElementCount>0?n=p:h.is(":visible")&&h[0].childElementCount>0?n=h:f.is(":visible")&&f[0].childElementCount>0?n=f:g.is(":visible")&&g[0].childElementCount>0?n=g:C.is(":visible")&&C[0].childElementCount>0&&(n=C),void 0!==i&&e.setData("fromAutDealCreate",i),void 0!==t&&e.setData("fromSearchCreate",t),o&&this.clearFilter(),Crm.isFromSalesInbox?D.ltProp({wrapperClass:"lookupListTable fromSalesInbox",offset:{top:"0px",left:"center"}}):D.ltProp({wrapperClass:"lookupListTable",offset:{top:"0px",left:"center"}}),e.data.ltPropShow&&(e.data.ltPropShow=!1),e.setData("ltPropShow",!0),$("#zIndexStyleSheet").remove(),setTimeout(function(){if(void 0!==n)parseInt(n.css("z-index"))}.bind(e),200)},zbIntegrationSelectForAccountAndVendor(e,t){if("Potentials"!==this.getData("reqData").searchModule&&"Potentials"!==this.data.parentReqData.searchModule){var a=Crm.getCrmBasePath()+"/connectzb",i={entityType:ZBLookUpUtil.zbFromCRMURLType,formatType:"json",module:ZBLookUpUtil.searchModuleName,crmEntityId:e};4===ZBLookUpUtil.zbFromCRMURLType&&(a=Crm.getCrmBasePath()+"/connectzs",i={actionNumber:ZBLookUpUtil.zbFromCRMURLType,formatType:"json",crmModule:ZBLookUpUtil.searchModuleName,crmEntityID:e}),"Vendors"===i.module||"Vendors"===i.crmModule?ZBLookUpUtil.vendorID=e:"Accounts"===i.module||"Accounts"===i.crmModule?(ZBLookUpUtil.accountID=e,ZBLookUpUtil.contactID="",ZInvoice.potentialLinkingObj.accountID=e,ZInvoice.potentialLinkingObj.contactID=""):(ZBLookUpUtil.contactID=e,ZBLookUpUtil.accountID="",ZInvoice.potentialLinkingObj.accountID="",ZInvoice.potentialLinkingObj.contactID=e);var o=$(this);o.data("requestRunning")||(o.data("requestRunning",!0),jQuery.ajax({url:a,data:i,type:"POST",success:function(e){var t;if(0!==(t="object"==typeof e?e:JSON.parse(e)).code)ZInvoice.showMessage(t.message);else{var a=$("#zBooksIframe");a&&a[0].contentWindow.InvoiceUtil&&a[0].contentWindow.InvoiceUtil.updateFieldsInEntityCreatePage(t,ZBLookUpUtil.zbFromCRMURLType)}},error:function(){o.data("requestRunning",!1)},complete:function(){o.data("requestRunning",!1)}}))}else $("#zBooksIframe")[0].contentWindow.InvoiceUtil.updatePotentialInEntityCreatePage(t,e)},getDomValByIdOrName:function(e){try{var t=$L("#"+e)}catch(a){t||(t=$L('[name ="'+e+'"]'))}return t},actions:{checkBrowserBack:function(){var e=$L("crm-entity-lookup")[0].component;e.getData("backCallMade")||(e.closeThisLookupPop(),e.setData("backCallMade",!0),setTimeout(function(){e.setData("backCallMade",!1)}.bind(e),1e3))},closeThisLookupPop:function(){this.closeThisLookupPop()},navigateRecords:function(e){if(this.rollbackFilter(),this.getData("searchApplied")){var t=!1;if(e?this.getData("slicedTo")<this.getData("bodyContent").length&&(this.setData("slicedFrom",this.getData("slicedTo")),this.setData("slicedTo",this.getData("slicedTo")+this.getData("defaultToIndex")),t=!0,this.toggleForward(this.getData("slicedTo")<this.getData("bodyContent").length),this.toggleBackward(this.getData("slicedFrom")>0)):this.getData("slicedFrom")>0&&(this.setData("slicedTo",this.getData("slicedFrom")),this.setData("slicedFrom",this.getData("slicedFrom")-this.getData("defaultToIndex")),t=!0,this.toggleBackward(this.getData("slicedFrom")>0),this.toggleForward(this.getData("slicedTo")<this.getData("bodyContent").length)),t&&(this.setData("slicedBodyContent",this.getData("bodyContent").slice(this.getData("slicedFrom"),this.getData("slicedTo"))),!1===this.getData("onScrollAction"))){var a=$L(".lookupFieldList .lyteTableScroll");Crm.userDetails.RTL_ENABLED?a.scrollTop(tableTop+1).scrollLeft(tableLeft+1):a.scrollTop(0).scrollLeft(0),$L(".entityLookupTable .lyteTableScroll").resetScrollbar()}}else{(t=e?this.getData("hasMoreRecords"):this.getData("fromIndex")>this.getData("defaultToIndex"))&&(e?(this.setData("fromIndex",this.getData("toIndex")+1),this.setData("toIndex",this.getData("toIndex")+this.getData("defaultToIndex"))):(this.setData("fromIndex",this.getData("fromIndex")-this.getData("defaultToIndex")),this.setData("toIndex",this.getData("toIndex")-this.getData("defaultToIndex"))),this.openCustomLookup(this.data.reqData.parentModule,this.data.reqData.labelName,this.data.reqData.labelName,this.data.reqData.searchModule,this.data.reqData.fieldVal,this.getData("sortColumnString"),this.getData("sortOrderString")))}},showColumnList:function(e){sE(e),$L("#popoverTest")[0].ltProp("show",!0);var t=this.data.module,a=$("#columnList.fromModuleLookup"),i=$(".lookupListTable .lyteTableScroll"),o=$(".lookupListTable .lyteModal").css("z-index"),r=i.height()/100*95,l=$L("#menuColumnListView");if(e.preventDefault(),!a.hasClass("dBImp")){var s=this.data.currentModuleColumns;void 0===s.columns||s.currentmodule!=t?(new crmRequestPool).doAjax(Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=show&frmmodule="+this.getData("reqData").lookupModule+"&cust_disp_module="+this.data.parentModule+"&from=createEntity&nocache="+(new Date).getTime(),function(e){s.columns=e.columns,this.showColumnListByColumns(s,this.data.module)}.bind(this)):this.showColumnListByColumns(s,this.data.module)}var d=$("#columnlistsearch");""!=d.val()&&(d.val(""),searchColumnList("columnListId",document.createEvent("MouseEvent"),"")),setTimeout((function(){r>230&&(a.css("z-index",o),a.find("#menuColumnListView").css("max-height",r),d.focus()),l.scrollTop(0)}),400)},openQuickCreate:function(){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var e=$("#lookupListPopup"),t=this.getData("reqData");this.setData("parentReqData",t);var a=Crm.getCrmBasePath()+"/QuickCreateAction.do?module="+this.getData("reqData").lookupModule+"&searchmodule="+this.getData("reqData").lookupModule+"&fldName="+this.data.reqData.labelName+"&fldId="+(this.data.reqData.labelId?this.data.reqData.labelId:this.data.reqData.labelName)+"&fldLabel="+this.getData("reqData").lookupModule+"&fldValue="+this.data.reqData.fieldVal+"&newModel="+this.data.newModel;if(this.data.fieldId&&(a+="&folLookupFieldId="+this.data.fieldId),this.data.productId&&(a+="&productId="+this.data.productId),this.getData("fieldObj")&&this.getData("fieldObj").layoutId?a+="&folLayoutId="+this.getData("fieldObj").layoutId:Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().getQueryParams()&&Lyte.Router.getRouteInstance().getQueryParams().layoutId?a+="&folLayoutId="+Lyte.Router.getRouteInstance().getQueryParams().layoutId:"undefined"!=typeof returnJson&&returnJson&&returnJson.layoutIdOfEntity&&returnJson.module===t.module&&(a+="&folLayoutId="+returnJson.layoutIdOfEntity),"null"!=this.getData("accDetails")&&this.getData("accDetails").length>0&&(a+="&accDetails="+this.data.accDetails),"Crm_Contacts_REPORTINGTOCONTACTID"===this.data.reqData.labelName)if(this.getData("accDetails")&&this.getData("accDetails").accounts)a+="&accountid="+this.getData("accDetails").accounts[0].id+"&accountname="+encodeURIComponent(this.getData("accDetails").accounts[0].name);else if(this.data.relatedDropdown&&this.data.relatedDropdown.length){var i=Object.keys(this.data.relatedDropdown[0]).find((e=>e.indexOf("Crm_")>-1)),o=i?this.data.relatedDropdown[0][i].name:"";a+="&accountid="+this.data.relatedDropdown[0].id+"&accountname="+encodeURIComponent(o)}a+="&openInAdvSearch=true",a=networkUtils.getPortalURL(a),1==this.getData("isfromOutlookRightPanel")&&(a+="&isfromOutlookRightPanel=true"),1==this.getData("fromAutDealCreate")&&(a+="&fromAutDealCreate=true");var r=$("#entityLookupdiv"),l=r.find('[name="source"]').val();if("rLEmail"===l){var s=r.find('[name="contactId"]').val();a=a+"&source="+l+"&contactId="+s}if("rLEmail"!==l&&"rLEmail"===t.source){s=t.contactId;a=a+"&source="+t.source+"&contactId="+s}""!=this.getData("currencyIsoCode").trim()&&(a=a+"&currencyISOCode="+this.getData("currencyIsoCode").trim());var d=null==this.getData("fromSearchCreate")?"topBandPopup":"lookupPopup";$("#"+d).removeClass("zcrm-show").css({top:"0px",display:"none","z-index":"10002"}).width(""),$("#searchCreatePopup").removeClass("fromAutoComplete");var n=$L(".fromLyteFields")[0];n&&n.component&&(n.component.data.fldId===this.data.reqData.labelId||n.component.data.fldId===this.data.reqData.labelName)&&n.component.setData("fromAutocomplete",!1),void 0!==Crm.userDetails.VALIDATIONRULEAVAILABLE&&!0!==Crm.userDetails.VALIDATIONRULEAVAILABLE||Crm.downloadValidationRules(a,this.getData("reqData.lookupModule"),(function(){commonUtils.openCustomLookup(a,void 0,"searchCreatePopup",(function(){$L(".massUpdateModalWrapper")[0]||$("lyte-modal-freeze").css("z-index","10001")}))})),e[0].ltProp("show",!1)}},submitAdvancedSearchFilter:function(){clearTimeout(this._timeout),1==this.getData("ltPropShow")&&(this._timeout=setTimeout(function(){this.submitAdvancedSearchFilter.call(this)}.bind(this),300))}}},{mixins:["crm-lookup-filter-mixin","crm-related-list-utils"]});
