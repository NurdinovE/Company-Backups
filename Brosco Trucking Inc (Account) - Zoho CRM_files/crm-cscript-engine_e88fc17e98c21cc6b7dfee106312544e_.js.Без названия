Lyte.Component.register("crm-cscript",{_template:'<template tag-name="crm-cscript"> <template is="if" value="{{expHandlers(available,\'&amp;&amp;\',expHandlers(_cscript._is_preview_frame,\'!\'))}}"><template case="true"> <lyte-modal lt-prop-show="{{cscriptPaneShow}}" lt-prop-wrapper-class="cscriptPane" lt-prop-width="60%" lt-prop-height="100%" lt-prop-show-close-button="false" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromRight&quot;,&quot;duration&quot;:&quot;.4&quot;}" lt-prop-freeze="true" lt-prop-offset="{&quot;right&quot;:&quot;0&quot;,&quot;top&quot;:&quot;0&quot;}" lt-prop-dimmer="{&quot;opacity&quot;:&quot;.2&quot;}" lt-prop-overlay-close="true" on-close="{{method(\'show_btn\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="cscriptPaneHead"> <div class="csPanelHeader clearFix"> <span class="crm-font-bold csPanelTitleTxt">{{getI18n(\'crm.setup.system.cscript\')}}</span> <span class="csCloseIcon svgIcons fR" role="button" lt-prop-aria-keydown="true" onclick="{{action(\'panel\',false)}}" tabindex="0" aria-label="{{getI18n(\'crm.button.close\')}}" lt-prop-title="{{getI18n(\'crm.button.close\')}}"></span> </div> </lyte-modal-header> <lyte-modal-content class="cscriptPaneModal"> <crm-cscript-record-view is_proxy="{{lbind(is_proxy)}}" page_uuid="{{lbind(page_uuid)}}"></crm-cscript-record-view> </lyte-modal-content> </template> </lyte-modal> <span class="cscriptTagShow {{if(cscriptTagShow,\'\',\'dN\')}}" onclick="{{action(\'panel\',true)}}" data-zcqa="cscriptTag"> <span class="cScriptrotate crm-font-regular">{{getI18n(\'crm.setup.system.cscript\')}}</span> </span> </template></template> <lyte-modal lt-prop-wrapper-class="CSflyout" lt-prop-show="{{lbind(widget_type_map.CScriptFlyout.display)}}" lt-prop-bind-to-body="true" lt-prop-allow-multiple="true" lt-prop-height="auto" lt-prop-width="auto" lt-prop-max-height="80%" lt-prop-max-width="50%" lt-prop-scrollable="true" lt-prop-freeze="false" lt-prop-draggable="true" lt-prop-close-on-escape="false" lt-prop-overlay-close="false" on-close="{{method(\'close_pop\',\'CScriptFlyout\')}}" lt-prop-show-close-button="{{flyout.close_icon}}" lt-prop-transition="{&quot;animation&quot;:&quot;{{modal_anim_type(flyout.animation_type)}}&quot;,&quot;duration&quot;:&quot;{{flyout.animation_dur}}&quot;}" lt-prop-offset="{{flyout.offset}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{isNotEmptyString(flyout.header)}}"><template case="true"> <lyte-modal-header class="wbBreakAll mR20">{{flyout.header}}</lyte-modal-header> </template></template> <lyte-modal-content class="CSflyoutCont p0"></lyte-modal-content> </template> </lyte-modal> <lyte-popover lt-prop-wrapper-class="CSflyoutPopOver" lt-prop-origin-elem="{{callout.target}}" lt-prop-duration="{{callout.animation_dur}}" lt-prop-allow-multiple="true" lt-prop-freeze="false" lt-prop-close-on-body-click="{{callout.close_on_body_click}}" lt-prop-show="{{lbind(widget_type_map.CScriptCallout.display)}}" lt-prop-scrollable="true" lt-prop-force-scroll="true" lt-prop-close-on-escape="true" lt-prop-height="auto" lt-prop-width="auto" lt-prop-max-height="80%" lt-prop-max-width="40%" on-close="{{method(\'close_pop\',\'CScriptCallout\')}}" lt-prop-type="callout" lt-prop-show-close-button="{{callout.close_icon}}"> <template is="registerYield" yield-name="popover"> <template is="if" value="{{isNotEmptyString(callout.header)}}"><template case="true"> <lyte-popover-header><span class="cscript_popover_header dIB ellipsistext" lt-prop-title="{{callout.header}}">{{callout.header}}</span></lyte-popover-header> </template></template> <lyte-popover-content class="CScalloutCont p0 pR"></lyte-popover-content> </template> </lyte-popover> <lyte-modal lt-prop-wrapper-class="CSwidget" lt-prop-show="{{lbind(widget_type_map.CScriptWidget.display)}}" lt-prop-bind-to-body="true" lt-prop-height="auto" lt-prop-max-height="100%" lt-prop-width="auto" lt-prop-max-width="100%" lt-prop-scrollable="true" lt-prop-overlay-close="false" lt-prop-freeze="true" lt-prop-close-on-escape="{{widget.close_on_escape}}" on-close="{{method(\'close_pop\',\'CScriptWidget\')}}" lt-prop-show-close-button="{{widget.close_icon}}" lt-prop-transition="{&quot;animation&quot;:&quot;{{modal_anim_type(widget.animation_type)}}&quot;,&quot;duration&quot;:&quot;{{widget.animation_dur}}&quot;}" lt-prop-offset="{{widget.offset}}" on-before-close="{{method(&quot;on_before_close_pop&quot;)}}"> <template is="registerYield" yield-name="modal"> <template is="if" value="{{isNotEmptyString(widget.header)}}"><template case="true"> <lyte-modal-header>{{widget.header}}</lyte-modal-header> </template></template> <lyte-modal-content class="CSwidgetCont p0"></lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"text",position:[3,1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"text",position:[1,0,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[7]}],_observedAttributes:["page_uuid","is_proxy","cscriptTagShow","cscriptPaneShow","available","cscript","widget_type_map","widget","flyout","callout","restrict_close"],data:function(){CScriptComp=!0;var e={close_icon:!0,close_on_escape:!1,offset:{top:"0px",left:"center"},animation_type:1,animation_dur:".4"},t={close_icon:!0,offset:{right:"20px",top:"center"},animation_type:2,animation_dur:".4",close_on_exit:!0},i={close_icon:!0,close_on_body_click:!0,animation_type:2,animation_dur:"400"};return{page_uuid:Lyte.attr("string"),is_proxy:Lyte.attr("boolean"),cscriptTagShow:Lyte.attr("boolean",{default:!1}),cscriptPaneShow:Lyte.attr("boolean",{default:!1}),available:Lyte.attr("boolean",{default:!1}),cscript:Lyte.attr("object"),widget_type_map:Lyte.attr("object",{default:{CScriptFlyout:{default:t,config:"flyout",display:!1},CScriptCallout:{default:i,config:"callout",display:!1},CScriptWidget:{default:e,config:"widget",display:!1}}}),widget:Lyte.attr("object",{default:e}),flyout:Lyte.attr("object",{default:t}),callout:Lyte.attr("object",{default:i}),restrict_close:Lyte.attr("boolean",{default:!0})}},cscript_promise:{},widget:function(e){const t=this;return{display:function(i=!0,r){if(i&&t.setData("restrict_close",!0),Lyte.objectUtils(t.getData("widget_type_map")[e],"add","display",i),!i&&!r)return new Promise((i=>{t.cscript_promise[e]=i}))},apply:function(i){for(var r in i)Lyte.objectUtils(t.getData(t.getData("widget_type_map")[e].config),"add",r,i[r])},applyDefaults:function(){t.setData(t.getData("widget_type_map")[e].config,JSON.parse(JSON.stringify(t.getData("widget_type_map")[e].default)))}}},methods:{show_btn:function(){this.setData("cscriptPaneShow",!1)},on_before_close_pop:function(){const e=$L("#widget_popup_crux")[0];if(e&&this.getData("restrict_close")){const t=e.contentWindow.document.getElementsByTagName("crm-create-layout");if(t.length)return $L(t)[0].component.widget_can_close()}return!0},close_pop:async function(e){this.cscript_promise[e]?(this.cscript_promise[e](),this.cscript_promise[e]=void 0):await AppHandler.close_widget(e,!0,void 0)}},actions:{panel:function(e){if(e){const e=this;CScriptComp&&e.setData({page_uuid:_cscript._info?_cscript._info.uuid:_cscript._info,is_proxy:!1}),Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cscript")],ResourceConstants.CRM)[0]],void 0,(function(){e.setData("cscriptPaneShow",!0)}))}else this.setData("cscriptPaneShow",!1)}}}),Lyte.Component.registerHelper("modal_anim_type",(function(e){switch(e){case 1:return"slideFromTop";case 2:return"slideFromRight";case 3:return"slideFromLeft";case 4:return"slideFromBottom";case 5:return"fadeIn";case 6:return"zoom"}})),store.registerModel("proxy_request",{id:Lyte.attr("string",{primaryKey:!0}),method:Lyte.attr("string"),url:Lyte.attr("string"),content:Lyte.attr("string"),headers:Lyte.attr("object"),parameters:Lyte.attr("object")}),store.registerAdapter("proxy_request",{namespace:"crm/v2.2/__internal"}),store.registerSerializer("proxy_request",{payloadKey:function(){return"proxy_requests"},serialize:function(e,t){return t.proxy_requests=[t.proxy_request],t.proxy_request=void 0,t},normalizeResponse:function(e,t,i){return i.proxy_requests=i.proxy_requests[0],i.proxy_requests.id="temp",i}});var _cscript={_dot_sdk:void 0,_info:void 0,_definition:void 0,_ehc_counter:15,_exclude_list:["log"],_unsupported_modules:["Services__s","Appointments__s","Tasks","Events","Calls","Forecasts"],_preview:void 0,_cscriptapi:!1,_dependent_apis:!1,_digest:void 0,_snippet_uuid:void 0,_snippet_records:{},_is_preview_engine_loaded:!1,_is_preview_page:void 0,_navigation_data:null,_global_custom_data:null,_is_initial_loader_present:void 0,_handlers:void 0,_default_handlers:["AppHandler","UIHandler","RequestHandler"],_hotEngine:{_engine:void 0,_init:void 0,_info:void 0,_isOnInit:void 0,_list:[]},_dhEngine:{_engine:void 0,_init:void 0,_isOnInit:void 0,_info:void 0,_handlers:void 0,_engine_conf:void 0,_isdh:!0,_execution_logs:[],_is_preview:void 0,_result_promise:{}},_globalEngine:{_engine:void 0,_init:void 0,_isOnInit:void 0,_init_uuid:null,_state:{},_is_logging_enabled:!1,_local_logs:[]},_is_preview_frame:window.frameElement&&window.frameElement.attributes.cscriptpreview&&"true"===window.frameElement.attributes.cscriptpreview.value,isMac:navigator.userAgent.includes("Mac")},CScript={Engine:{Global:void 0,Hot:void 0,DH:void 0},LOGGER:{DEFAULT:1,INFO:2,EXECUTION:3},RestartHandler:function(){murphy.error(new Error("Restarted"))},InitializeDH:async function(){if(_cscript._dhEngine._engine=new DXEngine("datahub"),!_cscript._engine_conf){let e=networkUtils.returnDependencyFiles(["cscript/async-await-lib-handler.js"],ResourceConstants.CRMClient)[0],t={time_out_in_milliseconds:1e4};validationUtils.isValidWebUrl(e)?t.prescript_uri=e:t.prescript_uri=document.location.origin+networkUtils.returnDependencyFiles(["cscript/async-await-lib-handler.js"],ResourceConstants.CRMClient)[0],_cscript._engine_conf=t}await CScript.Engine.DH.Init(!0)},ExecutionHandler:function(e){_cscript._is_preview_frame&&window.parent.document.dispatchEvent(new CustomEvent("CSCRIPT_PREVIEW",{detail:e}))},getRequestHandler:async e=>async function(t){let i=e._handlers?e._handlers:_cscript._handlers;var r=i.length,a="_0_";try{for(var n=0;n<r;n++)if(self[i[n]]&&self[i[n]][t.request.action]){a=await self[i[n]][t.request.action].call(t.request,t.snippet_id);break}if(void 0===a||"_0_"!==a)return e._isdh?(void 0===a?a={}:"string"==typeof a&&(a={rawXml:a}),e._engine.dispatchResponse(t,a)):e._engine.dispatchResponse(t,a);throw CScript.Error("unsupported action")}catch(i){if(murphy.error(i),i&&"ZDKError"===i.name)return void e._engine.dispatchResponse(t,i.message,!0);e._engine.dispatchResponse(t,"internal api error",!0)}},ErrorHandler:function(e){murphy.error(e)},UI:{Show:function(){CScriptComp&&!_cscript._preview&&_cscript._definition&&_cscript._definition.display_tag&&$L("crm-cscript")[0].component.setData({available:Crm.userDetails.IS_CONFIRMED_IN_IAM&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access,cscriptTagShow:!0})},Hide:function(){CScriptComp&&$L("crm-cscript")[0].component.setData("available",!1)}},BootLoader:async function(e){!0==!e&&!_cscript._cscriptapi&&await store.findAll("cscript")},FilePicker:function(e){_cscript._info=store.peekAll("cscript").filterBy(e)[0],_cscript._globalEngine._state.file_picker=e,_cscript._globalEngine._state.cscript_info=JSON.stringify(_cscript._info),CScript.Utils.Murphy.log(CScript.LOGGER.INFO,CScript.Utils.Murphy.log_file_picker_details,_cscript._info)},DefinitionPicker:function(e,t){t.selectors.every((t=>e["$"+t.name]))&&t.selectors.length>(_cscript._definition&&_cscript._definition.length||0)&&(_cscript._definition=t,_cscript._is_preview_page=_cscript._is_preview_frame&&_cscript._preview&&CScript.Utils.compare(e,_cscript._preview.selectors),this.FilePicker(e))},isEngineWarm:function(e){return e&&(!event||"message"!==event.type)},Freeze:function(e){return Object.getOwnPropertyNames(e).forEach((function(t){var i=e[t];null!==i&&"object"==typeof i&&CScript.Freeze(i)})),Object.freeze(e)},DeepFreeze:function(e,t){Object.defineProperty(globalThis,e,{value:CScript.Freeze(t),enumerable:!1,configurable:!1,writable:!1})},Boot:async function(e,t,i){await this.BootLoader(t),e._engine.preScriptURI(_cscript._engine_conf.prescript_uri).onLoad((async function(){this.requestHandler(await CScript.getRequestHandler(e)).errorHandler(t?CScript.Engine.DH.ErrorHandler:CScript.ErrorHandler).onExecutionStart(t?CScript.Engine.DH.ExecutionHandler:CScript.ExecutionHandler).onExecutionTimeout(t?CScript.Engine.DH.ExecutionHandler:CScript.ExecutionHandler).onExecutionEnd(t?CScript.Engine.DH.ExecutionHandler:CScript.ExecutionHandler).onExecutionError(t?CScript.Engine.DH.ExecutionHandler:CScript.ExecutionHandler).logHandler(CScript.ExecutionHandler).isDevelopment(Crm.env.isDevelopment).isDebugMode(Crm.env.isDevelopment||_cscript._preview).setTimeout(_cscript._engine_conf.time_out_in_milliseconds),i&&this.trackerHandler(t?CScript.Engine.DH.TrackerHandler:CScript.Engine.Global.TrackerHandler)})).onRestart(this.RestartHandler),e._init=!0},Error:function(...e){class t extends Error{constructor(e={},...i){super(...i),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="ZDKError",this.meta=e}}return new t({},e)},Preview:{Reset:function(e,t){if(_cscript._preview=e,UIHandler.clearAlert(),UIHandler.unfreeze(),t)switch(Lyte.Router.getRouteInstance().transition.info.route){case"crm.tab.module.custom-view.list":case"crm.tab.module.custom-view.kanban":case"crm.tab.module.custom-view.canvas":crmListView.reloadCurrentListView();break;case"crm.tab.module.entity.canvas":reinitCscriptDV();default:const e=Lyte.Router.getRouteInstance().transition;(e.data||(e.data={})).skipDirtyCheck=!0,Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0})}else Lyte.Router.transitionTo(e.preview_route);"commands"===e.page_name&&CScript.Engine.Hot.Restart(),e.is_fallback_route&&CScript.Engine.Global.Restart()},Init:async function(e){_cscript._preview=e;const t=document.querySelector("#wms_notebook_container");t&&(t.style.cssText="height: 80vh !important");const i=document.querySelector(".cscriptTagShow");i&&(i.style.display="None"),window.parent._cscript._load_hotengine_in_preview&&CScript.Engine.Hot.Init(),CScript.Engine.Global.Init()},dispatchLoad:function(e,t){window.parent.document.dispatchEvent(new CustomEvent("CSCRIPT_PREVIEW",{detail:{type:e,is_console_enabled:t}}))}},InitializeHot:async function(){await Lyte.injectResources([networkUtils.returnDependencyFiles(["cscript/crm-cscript-engineHot.js","lyte-shortcut.js"],ResourceConstants.CRMClient)]),await CScript.Engine.Hot.Utils.loadList(),_cscript._hotEngine._engine=new DXEngine("commands"),_cscript._crm_rendered&&!_cscript._hotEngine._init&&(await CScript.Engine.Hot.Init(),_cscript._hotEngine._jsonobj&&0!==Object.keys(_cscript._hotEngine._jsonobj).length&&Lyte.registeredMixins["crm-cscript-global-mixin"]&&Lyte.registeredMixins["crm-cscript-global-mixin"].addCSDivInWMS())},Initialize:async function(){window.CScriptLib=!0,_cscript._globalEngine._engine=new DXEngine;const e=await store.findAll("cscript");_cscript._cscriptapi=!0;let t=e.find((e=>"commands"===e.definition_name));!CScript.Engine.Hot&&(t||_cscript._is_preview_frame&&window.parent._cscript._load_hotengine_in_preview)&&await CScript.InitializeHot()},WidgetHandler:function(e){if("function"==typeof e.callback)if(e.data&&e.data.action)switch(e.data.action){case"get_zdk_url":e.callback(networkUtils.returnDependencyFiles(["devex/libraries/cscript-widget.js"],ResourceConstants.CRMClient)[0]);break;case"close_widget":AppHandler.close_widget(e.config._type,!1,e.data.response),e.callback(!0);break;case"notify_response":const{data:t,uuid:i}=e.data.message;if(t&&i){const r=WidgetHandler.EventNotifier.flyoutPromises[i];r&&r.resolver(t),e.callback(!0)}else e.callbackFailure&&e.callbackFailure();break;default:e.callbackFailure&&e.callbackFailure()}else e.callbackFailure&&e.callbackFailure()},Utils:{get_pages:function(e){return app._cscript_registry._cat_pages[e]},get_categories:async function(){if(app._cscript_registry._categories)return app._cscript_registry._categories;const e=[],t=[];for(var i of Object.keys(app._cscript_registry._definitions))for(var r of app._cscript_registry._definitions[i])e.push(r),t.push(await r.enabled());const a=await Promise.all(t);for(var[n,o]of(app._cscript_registry._categories=[],a.entries()))!0===o&&(app._cscript_registry._cat_pages[e[n].category.value]||(app._cscript_registry._cat_pages[e[n].category.value]=[],app._cscript_registry._categories.push(e[n].category)),app._cscript_registry._cat_pages[e[n].category.value].push({name:e[n].name,unique_name:e[n].unique_name,route_name:e[n].route_name,sequence:e[n].sequence}));let s={Module:1,Commands:2},c=app._cscript_registry._categories.find((e=>"Commands"===e.value));if(c){let e=store.peekAll("cscript").filterBy({definition_name:"commands"});c.is_max_script_created=e.length&&e[0].snippet_count===Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT,c.is_max_script_created&&(c.tooltip=I18n.getMsg("crm.cscript.commands.script.limit.message",Crm.userDetails.CSCRIPT_SNIPPETS_LIMIT))}return app._cscript_registry._categories.sort(((e,t)=>s[e.value]-s[t.value]))},get_config_by_apiname:function(e){for(var t of Object.keys(app._cscript_registry._definitions))for(var i of app._cscript_registry._definitions[t])if(i.unique_name===e)return i},get_all_configs:function(){const e={};for(var t of Object.keys(app._cscript_registry._definitions))for(var i of app._cscript_registry._definitions[t])e[i.unique_name]=i;return e},compare:function(e,t){if(!e||!t||"object"!=typeof e||"object"!=typeof t)return!1;var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(key of i)if(e[key]!==t[key])return!1;return!0},is_cscript_available:function(){return Crm.userDetails.IS_CONFIRMED_IN_IAM&&Crm.userDetails.permissions.Crm_Implied_Advanced_Dev_Access},is_uploadfields_event_enabled:function(){return Crm.userDetails.CSCRIPT_UPLOADFIELDS_EVENTS},is_subform_event_enabled:function(){return Crm.userDetails.CSCRIPT_SUBFORM_EVENTS},is_blueprint_aftertransition_event_enabled:function(){return Crm.userDetails.BLUEPRINT_AFTERTRANSITION_CS},Murphy:{log:function(e,t,...i){if(Crm.userDetails.CSCRIPT_INFO_LOGGING_LEVEL>=e&&["US","EU","AU","CA","IN","JP","China","SA"].includes(RebrandLinkUtil.getProperties("DeploymentLocation").DeploymentLocation))try{t.call(this,i)}catch(e){return}},log_state_info:function(e){this.construct_state_info(e),this._pushLog(_cscript._globalEngine._state)},construct_state_info:function(e){try{return _cscript._globalEngine._state.is_error=!0,_cscript._globalEngine._state.message=e,_cscript._globalEngine._state.isOnInit=_cscript._globalEngine._isOnInit,_cscript._globalEngine._state.cscriptapi=_cscript._cscriptapi,_cscript._globalEngine._state.definition=_cscript._definition&&_cscript._definition.unique_name,_cscript._globalEngine._state}catch(e){return}},log_init_details:function(){this._pushLog(this.construct_init_payload())},construct_init_payload:function(){const e=Lyte.Router.getRouteInstance().transition.info;return{init_route_info:JSON.stringify({route:e.route,queryParams:e.queryParams,dynamicParams:e.dynamicParams}),is_engine_created:void 0!==_cscript._globalEngine._engine&&void 0!==_cscript._globalEngine._engine&&null!==_cscript._globalEngine._engine}},log_file_picker_details:function(e){this._pushLog(this.construct_file_picker_payload(e[0]))},construct_file_picker_payload:function(e){if(e)return{file_picker_page_info:{selectors:JSON.stringify(e.selectors),route_info:_cscript._globalEngine._state.file_picker}}},log_execution_details:function(e){this._pushLog(this.construct_execution_info_payload(e[0]))},construct_execution_info_payload:function(e){const t=e.originalEvent&&e.originalEvent.data;let i=t&&t[1],r=t&&t[0]&&t[0].intercept,a=i&&i.splice(0,1);return{execution_state:e.type,message_uuid:e.originalEvent&&e.originalEvent.messageUID,snippet_id:e.snippet_id,isEngineWarm:_cscript._globalEngine._state.is_engine_warm,script_event_info:JSON.stringify({is_intercept:r,event:a,arguments:i}),value:e.originalEvent&&e.originalEvent.value}},log_execution_triggers:function(e){this._pushLog(this.construct_execution_trigger_payload(e[0]))},construct_execution_trigger_payload:function(...e){return{isEngineWarm:_cscript._globalEngine._state.is_engine_warm,execution_trigger_info:JSON.stringify({window_event:{type:event&&event.type},event:e[0],event_args:e.slice(1)})}},_ajaxhelp:function(e){if(navigator.sendBeacon){var t=e.data,i={method:e.type,headers:{"content-type":"application/json","x-remote-user":""},body:t};navigator.sendBeacon(e.url,i.body)}},_pushLog:function(e){try{let t={zuid:crmZuid,zgid:crmZgid,uuid:_cscript._globalEngine._init_uuid,type:"cscript_execution"};t=$L.extend(t,e),_cscript._globalEngine._is_logging_enabled&&_cscript._globalEngine._local_logs.push(t);let i=murphy.sendUserInfo();i&&i.appDomain&&i.appKey&&this._ajaxhelp({type:"POST",url:"https://"+i.appDomain+"/murphy/"+i.appKey+"/clientlog?logtype=jslogs",data:JSON.stringify(t),dataType:"json",success:function(){},error:function(){}})}catch(e){return}}},loadAsyncAwait:function(){Lyte.injectResources([networkUtils.returnDependencyFiles(["cscript/convert-to-asyncawait.js"],ResourceConstants.CRMClient)])}},Accessibility:{getList:function(){return _cscript&&_cscript._hotEngine&&_cscript._hotEngine._list||[]},getCallback:function(e){return()=>{Lyte.registeredMixins["crm-keyboard-shortcutsmixin"].freezeBgCheck()||CScript.Engine.Hot.dispatchEvent("onInvoke",e,void 0,void 0)}},getUnassignedScripts:function(e){let t=e.find((e=>"Commands"===e.category)),i=t&&t.components.map((e=>e.cscript_snippet.uuid))||[];return _cscript&&_cscript._hotEngine&&_cscript._hotEngine._list.filter((e=>!i.includes(e.scriptId)&&e.scriptId.length>11))||[]},getNamefromId:function(e){let t=_cscript&&_cscript._hotEngine&&_cscript._hotEngine._list.find((t=>t.scriptId===e));return t&&t.scriptName||"Unavailable Script"}}};store.registerModel("cscript",{uuid:Lyte.attr("string",{primaryKey:!0}),definition_name:Lyte.attr("string"),selectors:Lyte.attr("object"),static_resources:Lyte.attr("array"),consolidated_code_url:Lyte.attr("string")}),store.registerAdapter("cscript",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a){return a.replace("actions/static_resource","static_resource").replace("settings/cscript","settings/cscript_pages")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("cscript",{serialize:function(e,t){return"createRecord"!==e&&"updateRecord"!==e||(t.cscript_pages=[t.cscript],delete t.cscript),t},payloadKey:function(e){return e+"_pages"},normalizeResponse:function(e,t,i){if("updateRecord"===t)(i=i.cscript_pages[0]).uuid=i.details.uuid;else if(i&&i.cscript_pages){const e=i.cscript_pages.length>0&&CScript.Utils.get_all_configs();i.cscript_pages.forEach((function(t){t.$route=e[t.definition_name]&&e[t.definition_name].route_name,t.selectors&&Object.keys(t.selectors).forEach((function(e){"Module"===e&&"Deals"===t.selectors[e].id&&(t.selectors[e].id="Potentials"),t["$"+e]=t.selectors[e].id}))})),_cscript._engine_conf=i.cscript_pages_configuration}else i={cscript_pages:[]};return i}}),store.registerModel("cscript_snippets",{uuid:Lyte.attr("string",{primaryKey:!0}),name:Lyte.attr("string"),description:Lyte.attr("string"),script_event:Lyte.attr("object"),content:Lyte.attr("object"),modified_by:Lyte.attr("object"),created_by:Lyte.attr("object"),cscript_page:Lyte.attr("object"),size:Lyte.attr("number"),revision:Lyte.attr("number"),active:Lyte.attr("boolean"),presence:Lyte.attr("boolean"),precedence:Lyte.attr("number")}),store.registerAdapter("cscript_snippets",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,n,o){return"update"===t||"delete"===t?o&&o.precedence?a+"/actions/precedence":a+"/"+r[0].uuid:(o&&o.hostUrl&&(a=(a=o.hostUrl.url).replace(a.match("sandbox/diff")?a.split("diff/").pop().split("v2.2/")[0]:a.split("crm/").pop().split("v2.2/")[0],"")),a)},headersForRequest:function(e,t,i){var r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return i&&i.headers&&i.headers["X-CRM-ORG"]&&(r["X-CRM-ORG"]=i.headers["X-CRM-ORG"]),r},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("cscript_snippets",{serialize:function(e,t,i,r){return"updateRecord"===e&&(t.cscript_snippets=[t.cscript_snippets]),r&&r.commit_message&&(t.cscript_snippets[0].commit_message=r.commit_message),t},normalize:function(e,t,i){return"update"!==t&&"create"!==t&&"delete"!==t||(i.uuid=i.details.uuid),i},normalizeResponse:function(e,t,i,r,a){if(200!==a&&201!==a&&"findAll"===t){renderingUtils.displayPermissionDenied();const e=document.querySelectorAll("crm-cscript")[0];e&&e.component.setData({cscriptPaneShow:!1,cscriptTagShow:!1})}else"updateRecord"===t?(i=i.cscript_snippets[0]).uuid=i.details.uuid:"findAll"!==t&&"findRecord"!==t||200!==a?204===a&&(i={cscript_snippets:[]}):i.cscript_snippets.forEach((e=>{const t=e.content.source_code_url.split("/filerevision/")[1];e.revision=t?t.split("/")[0].substring(1):1}));return i},payloadKey:function(e){return e+""}}),store.registerModel("static_resources",{id:Lyte.attr("string",{primaryKey:!0}),name:Lyte.attr("string",{minLength:1,mandatory:!0,pattern:/[^\s]+/}),description:Lyte.attr("string"),url:Lyte.attr("string"),modified_by:Lyte.attr("object"),modified_time:Lyte.attr("string"),created_by:Lyte.attr("object"),created_time:Lyte.attr("string"),size:Lyte.attr("number"),type:Lyte.attr("string")},{actions:{getUsage:{endPoint:"storage_details"}}}),store.registerAdapter("static_resources",{namespace:"crm/v2.2/settings",buildURL:function(e,t,i,r,a,n,o){return o&&o.page_uuid?a.replace("static_resource","cscript_pages")+"/"+o.page_uuid+"/static_resource":(o&&o.hostUrl&&(a=(a=o.hostUrl.url).replace(a.match("sandbox/diff")?a.split("diff/").pop().split("v2.2/")[0]:a.split("crm/").pop().split("v2.2/")[0],"")),a.replace("actions/storage_details","storage_details"))},headersForRequest:function(e,t,i){var r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return i&&i.headers&&i.headers["X-CRM-ORG"]&&(r["X-CRM-ORG"]=i.headers["X-CRM-ORG"]),r},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("static_resources",{normalizeResponse:function(e,t,i){return"updateRecord"===t||"createRecord"===t?(i.static_resources=i.static_resources[0],i.static_resources.id=i.static_resources.details.id):"findAll"!==t||i.static_resources||(i.static_resources=[]),i},serialize:function(e,t,i,r){if("createRecord"===e||"updateRecord"===e){var a=new FormData,n={static_resources:[{}]};return t.static_resources.name&&(n.static_resources[0].name=t.static_resources.name),(t.static_resources.description||""===t.static_resources.description)&&(n.static_resources[0].description=t.static_resources.description),a.append("content",JSON.stringify(n)),r&&r.file_ip&&(a.append("file1",r.file_ip),a.append("file2",r.file_out),a.append("file3",r.file_map)),a}return t},payloadKey:function(e){return e+""}}),store.registerModel("trusted_domains",{id:Lyte.attr("string",{primaryKey:!0}),name:Lyte.attr("string",{mandatory:!0,pattern:/[^\s]+/}),description:Lyte.attr("string"),url:Lyte.attr("string",{pattern:/^\s*(htt(p|ps):\/\/)?(\*\.)?([a-zA-Z0-9][a-zA-Z0-9-]*\.)+[a-zA-Z]{2,}?\s*$/i,mandatory:!0}),modified_by:Lyte.attr("object"),modified_time:Lyte.attr("string"),created_by:Lyte.attr("object"),created_time:Lyte.attr("string"),active:Lyte.attr("boolean")}),store.registerAdapter("trusted_domains",{namespace:"crm/v2.2/settings",methodForRequest:function(e){return"PATCH"===e?"PUT":e},headersForRequest:function(e,t,i){var r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return i&&i.headers&&i.headers["X-CRM-ORG"]&&(r["X-CRM-ORG"]=i.headers["X-CRM-ORG"]),r},buildURL:function(e,t,i,r,a,n,o){return o&&o.hostUrl&&(a=(a=o.hostUrl.url).replace(a.match("sandbox/diff")?a.split("diff/").pop().split("v2.2/")[0]:a.split("crm/").pop().split("v2.2/")[0],"")),a.replace("trusted_domainss","trusted_domains")}}),store.registerSerializer("trusted_domains",{normalizeResponse:function(e,t,i,r,a){return 204===a&&(i.trusted_domains=[]),"updateRecord"!==t&&"createRecord"!==t||(i.trusted_domains=i.trusted_domains[0],i.trusted_domains.id=i.trusted_domains.details.id),"updateRecord"!==t&&"createRecord"!==t&&"deleteRecord"!==t||setTimeout((()=>{CScript.Engine.DH.Restart()}),"50"),i},payloadKey:function(e){return e+""},serialize:function(e,t){return t.trusted_domains=[t.trusted_domains],("updateRecord"===e&&t.trusted_domains[0].url||"createRecord"===e)&&(t.trusted_domains[0].url=t.trusted_domains[0].url.replace(/htt(ps|p):\/\//,"")),t}});var RequestHandler=function(){var e=function(e){if(void 0!==e)return e.content&&(e.content="object"==typeof e.content?JSON.stringify(e.content):e.content),e.method||(e.method="GET"),_cscript._ehc_counter>0||e.isDH?(!e.isDH&&_cscript._ehc_counter--,store.createRecord("proxy_request",e).$.save()):{proxy_request:{code:"LIMIT_EXCEEDED",status:"error",message:"limit_exceeded"}}},t=function(e){if(void 0!==e)return new Promise((function(t,i){var r={};!0!==e.isFile&&"save"!==e.isFile||"GET"!==e.method||(r={responseType:"blob"});var a={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":e.service||"crm/cscript","X-CRM-ORG":Crm.currentZgid};e.avoid_default_headers&&(a={}),e.headers&&e.headers.forEach((function(e,t){a[t]=e}));var n={url:e.url,data:e.body,type:e.method,headers:a,xhrFields:r},o=[200,201,204];if((!0===e.isFile||"save"===e.isFile)&&"POST"===e.method){var s=new FormData;if(e.body instanceof File)s.append("file",e.body);else{var c=Object.keys(e.body)[0];s.append(c,e.body[c])}n.data=s,n.contentType=!1,n.processData=!1}$L.ajax(n).done((function(r,a,n){if(o.indexOf(n.status)>-1)if(!0!==e.isFile&&"save"!==e.isFile||"GET"!==e.method)"GET"===e.method&&void 0===r?t(e.is_raw_response?{response:n.responseJSON||n.responseText,status_code:n.status,headers:n.getAllResponseHeaders()}:{data:[]}):t(e.is_raw_response?{response:n.responseJSON||n.responseText,status_code:n.status,headers:n.getAllResponseHeaders()}:r);else if(void 0===r)t(e.is_raw_response?{response:r,status_code:n.status,headers:n.getAllResponseHeaders()}:r);else{var s,c=n.getResponseHeader("Content-Disposition");if(c&&-1!==c.indexOf("attachment")){var l=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(c);null!==l&&l[1]&&(s=(s=l[1].replace(/['"]/g,"")).replace("UTF-8","")),s=decodeURIComponent(s)}if((!0===e.body||null===e.body)&&!window.Encryptionenabled){const e=document.createElement("a");e.style.display="none",e.download=s,e.href=window.URL.createObjectURL(r),e.click()}t(e.is_raw_response?{response:n.responseText,status_code:n.status,headers:n.getAllResponseHeaders()}:new File([r],s))}else i(CScript.Error(JSON.stringify(e.is_raw_response?{response:n.responseJSON||n.responseText,status_code:n.status,headers:n.getAllResponseHeaders()}:r)))})).fail((function(r,a){e.is_raw_response&&t({response:r.responseJSON||r.responseText,status_code:r.status,headers:r.getAllResponseHeaders()}),i(CScript.Error(a.responseText))}))}))};return{api_dispatch:function(){return t(this.data)},http_request:async function(){try{return await e(this.req_data)}catch(e){return{proxy_request:JSON.parse(e.response).proxy_requests[0]}}}}}(),CreatePageHandler=function(){var e={Form:{Read:function(t){var i=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(i){var r={};return r.is_zdk_beta=t&&"1.0-beta"===t.version,Lyte.registeredMixins["crm-create-mixin"].cscriptReadFormClientHandler(i,r)}var a=$("form[name='createEntityNewForm']").eq(0),n=a.find("[cscript-tag]").not("option [cscript-tag]").not(".subformTabl [cscript-tag]").not("[type='hidden']").not("[type='button']").not("[cscript-tag^=__]"),o=e.Form.GetValue(n),s=a.find(".subformTabl"),c=t&&"1.0-beta"===t.version;s.length>0&&$.each(s,(function(t,i){var r=i.getAttribute("sub-data"),a=$(i).find("tbody tr"),n="true"===$(i).attr("islineitemsf"),s=[];$.each(a,(function(){var t=$(this).find("[cscript-tag]"),i=e.Form.GetValue(t);n&&i&&i.Product_Name&&i.Product_Name.name&&c&&(i.Product_Id=i.Product_Name.id,i.Product_Name=i.Product_Name.name),s.push(i)})),o[r]=s}));var l={hdnProductId:"ID",txtProduct:"Name",itemDescription:"Description",txtListPrice:"ListPrice",hdnUnitPrice:"UnitPrice",txtQty:"NewQuantity",hdnOldQty:"OldQuantity",hdnQtyStock:"InStock",discount:"Discount",discPc:"DiscountPerItem",discount:"Discount",tax:"Tax",prdTaxDet:"TaxDetection",netTotal:"Total"},p=$("#linesTbody tr"),u=[];$.each(p,(function(e,t){var i=(t=$(t)).attr("id").replace("hrow",""),r=t.find("input"),a={};$.each(r,(function(e,t){var r=(t=$(t)).attr("id").replace(i,""),n=l[r],o=t.val();n&&(a[n]=o)})),u.push(a)}));var d={Data:o};return u&&u.length>0&&(d.LineItems=u),d},Write:async function(t,i,r,a){var n,o,s=["First_Name"];t&&t.$data?(n=t.$data,o=t.$lineItems):n=t;var c=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(c)await Lyte.registeredMixins["crm-create-mixin"].formHandlerWrapperForLyteConversion(c,n,void 0,r,i,a);else{if(n){var l=$("#subFrmaddRowBtn");jQuery.each(n,(function(t,i){var r=$("table[sub-data='"+t+"']");if(r.length>0){var a=r.attr("id").split("_")[1],n=Array.isArray(i);if(null===i||n&&!i.length)crmTemplate.resetSubformRows(a);else if(n){for(var o=crmCommonModule.createEditJson.module,c=i&&i.length,p="true"===r.attr("islineitemsf"),u=r.find("tbody tr"),d=u.length;d++<c;)crmTemplate.addSubFromRow(l,a,o,"2");u=r.find("tbody tr"),$.each(u,(function(r,a){for(objKey in i[r]){var n=$(a).find("[cscript-tag='"+objKey+"']").not("[disabled]")[0];p&&"Product_Name"===objKey&&(productDetails.setPrdDetailsForWidget(n,i[r]),i[r].Product_Name.name=i[r].Product_Code?i[r].Product_Name.name+" ("+i[r].Product_Code+")":i[r].Product_Name.name),n&&e.Form.PutValue(t,i[r][objKey],n,p)}}))}}else{var _;(_=s.includes(t)?$("[cscript-tag='"+t+"'][data-content-type='Text']").not("[disabled]")[0]:$("[cscript-tag='"+t+"']").not("[disabled]")[0])&&e.Form.PutValue(t,i,_)}}))}if(o){var p=o[0],u={ISTAXABLE:!0,PRODUCTCODE:void 0,PRODUCTID:void 0,PRODUCTNAME:void 0,QUANTITY:0,QUANTITY_IN_DEMAND:0,QUANTITY_IN_STOCK:0,UNITPRICE:0,USAGE_UNIT:"Box",VENDORID:"null"},d=$.extend({},u,p);productDetails.addSave(d)}}},GetValue:function(e){var t={};return $.each(e,(function(e,i){var r=(i=$(i)).attr("cscript-tag"),a=null;if(i&&i.is(":visible")){var n=i.prop("type"),o=i.attr("data-content-type");switch(n){case"text":if("Lookup"===o){var s=i.val(),c=i.data("id");s&&c?((a={}).name=s,a.id=c):a=null}else a=i.val()||null;break;case"checkbox":a=i.is(":checked");break;default:"Lookup"===o?133===i.data().uitype?(s=i.val(),c=i.data("id"),a=s&&c?{name:s,id:c}:null):store.peekRecord("user",i.data("id"))&&(a={id:i.data("id"),name:store.peekRecord("user",i.data("id")).full_name}):a=26===i.data().uitype?Crm.getDealsStageValue(i.val()):i[0]instanceof HTMLSpanElement?i.text():3!==i.data().uitype&&110!==i.data().uitype||"CRUX-TEXT-AREA-COMPONENT"!==i[0].tagName?i.val()||null:i[0].component.getValue()}}t[r]=a})),t},PutValue:function(e,t,i,r){var a=(i=$(i)).prop("type"),n=i.attr("data-content-type");if(!i.data().readonly&&117!==i.data().uitype&&116!==i.data().uitype)switch(a){case"text":if("Lookup"===n)if(t){if(t.constructor===Object){var o=t.id,s=t.name;i.data("id",o),i.val(s)}}else i.data("id",""),i.val("");else if(r&&i.data()&&"Discount"===i.data().sysrefname){let e="percentage",r=0,a=0;if(t){let n=parseFloat($(productDetails.sfFldIdSuffix+"TOTAL_"+i.closest("tr").data("data-rowid")).val());if("string"==typeof t&&t.indexOf("%")>-1){if(r=t.slice(0,-1),""===r||isNaN(r))return;n&&(a=n*r/100)}else{if(isNaN(t))return;e="dirPrice",a=t}}(null===t||t||0===t)&&(a=productDetails.getRoundOff(i,a),i.parent().parent().parent().parent().find(".directPrice").val(a),i.attr({percentage:r,discType:e}),i.val(a),renderingUtils.triggerEvent("change",i))}else t?i.val((""+t).slice(0,i.data().maxlength)):i.val(t),renderingUtils.triggerEvent("change",i);break;case"textarea":"Lookup"===n?t&&t.constructor===Object?(i.data("id",t.id),i.val(t.name),renderingUtils.triggerEvent("change",i)):(i.data("id",""),i.val("")):i.val(t);break;case"checkbox":"boolean"==typeof t&&i.prop("checked",t);break;case"select-multiple":Array.isArray(t)&&(populatePicklist(i,t),i.val(t),renderingUtils.triggerEvent("change",i));break;case"select-one":if(t){if("string"==typeof t){const e=i.data();if(26===e.uitype)(t=e.values.find((e=>e.html===t)))&&i.val()!=t.value&&(populatePicklist(i,[t]),i.val(t.value),renderingUtils.triggerEvent("change",i));else{let r=e.values.contains(t);if(r||2!==e.uitype)r&&i.val()!=t&&(populatePicklist(i,[t]),i.val(t),renderingUtils.triggerEvent("change",i));else{let r=e.values.find((e=>e&&e.content===t));r&&i.val()!=r.content&&(populatePicklist(i,[r]),i.val(t),renderingUtils.triggerEvent("change",i))}}}}else i.val(null).trigger("change");break;default:"Lookup"===n&&8===i.data().uitype&&(t?t.constructor===Object&&store.peekRecord("user",t.id)&&(i[0].component?i[0].component.data.isFieldLookup?(i[0].component.executeMethod("folUserDropdown"),setTimeout((function(){i[0].component.executeMethod("onSelect",event,store.peekRecord("user",t.id))}),1e3)):i[0].component.executeMethod("onSelect",event,store.peekRecord("user",t.id)):(i.data("id",t.id),i.val(store.peekRecord("user",t.id).full_name))):(i.data("id",""),i.val(""))),3!==i.data().uitype&&110!==i.data().uitype||"CRUX-TEXT-AREA-COMPONENT"!==i[0].tagName||i[0].component.setData("cxPropValue",t)}}},Subform:{Get:function(e){const t=Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("get",{api_name:e});if(t)return t;if(0===$L(`[id^='secDiv_'][cscript-tag='${e}']`).length)throw CScript.Error(`No such subform present: ${e}`);return{api_name:e}},Write:async function(t,i,r,a,n){var o,s,c=["First_Name"];n&&n.$data?(o=n.$data,s=n.$lineItems):o=n;var l=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(l)await Lyte.registeredMixins["crm-create-mixin"].formHandlerWrapperForLyteConversion(l,o,void 0,t,i,a,r);else{if(o){var p=$("#subFrmaddRowBtn");jQuery.each(o,(function(t,i){var r=$("table[sub-data='"+t+"']");if(r.length>0){for(var a=r.attr("id").split("_")[1],n=crmCommonModule.createEditJson.module,o=i.length,s="true"===r.attr("islineitemsf"),l=r.find("tbody tr"),u=l.length;u++<o;)crmTemplate.addSubFromRow(p,a,n,"2");l=r.find("tbody tr"),$.each(l,(function(r,a){for(objKey in i[r]){var n=$(a).find("[cscript-tag='"+objKey+"']").not("[disabled]")[0];s&&"Product_Name"===objKey&&(productDetails.setPrdDetailsForWidget(n,i[r]),i[r].Product_Name.name=i[r].Product_Code?i[r].Product_Name.name+" ("+i[r].Product_Code+")":i[r].Product_Name.name),n&&e.Form.PutValue(t,i[r][objKey],n)}}))}else{var d;(d=c.includes(t)?$("[cscript-tag='"+t+"'][data-content-type='Text']").not("[disabled]")[0]:$("[cscript-tag='"+t+"']").not("[disabled]")[0])&&e.Form.PutValue(t,i,d)}}))}if(s){var u=s[0],d={ISTAXABLE:!0,PRODUCTCODE:void 0,PRODUCTID:void 0,PRODUCTNAME:void 0,QUANTITY:0,QUANTITY_IN_DEMAND:0,QUANTITY_IN_STOCK:0,UNITPRICE:0,USAGE_UNIT:"Box",VENDORID:"null"},_=$.extend({},d,u);productDetails.addSave(_)}}},GetField:function(e,t){const i=Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("get_field",{field_name:t,api_name:e});if(i)return i;if(0===$L("[id^='secDiv_'][cscript-tag="+e+"]").find("[cscript-tag="+t+"]").length)throw CScript.Error(`No such field present: ${t}`);return{api_name:t,parent:e}},SetCriteria:async function(e,t,i,r){if(null==i||""===i)throw CScript.Error("invalid criteria");i.startsWith("(")||""===i||(i="("+i+")");const a={criteria:i,...r&&r.filterOnSearch&&{filterOnSearch:r.filterOnSearch}},n=await Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_criteria",{field_name:t,api_name:e,criteria:i,config:r});if(n)return n;var o=$L("[id^='secDiv_'][cscript-tag="+e+"]").find("[cscript-tag="+t+"]");await CriteriaHandler.init(o.data("lookup-module")),CriteriaHandler.validate(i),o.each(((e,t)=>{$(t).attr({"data-criteria":JSON.stringify(a),"data-criteria-obj":JSON.stringify(CriteriaHandler.convert_to_search_criteria_json(i,"adv_lookup_criteria"))}),$(t).siblings().find("[data-cid='showLookup']").attr("data-criteria",JSON.stringify(a))}));var s=$("[cscript-tag="+e+"]").find("table[id^=subform_]"),c=JSON.parse(s.data("data-fields"));const l=c.find((e=>e.sysRefName===t));l&&(l.criteria=JSON.stringify(a)),s.data("data-fields",JSON.stringify(c))},ReadOnly:function(e,t,i){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_readonly",{field_name:e,api_name:t,value:i})||!1},Mandate:function(e,t,i){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_mandatory",{field_name:e,api_name:t,value:i})||!1},Visible:function(e,t,i){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_visible",{field_name:e,api_name:t,value:i})||!1},Info:function(e,t,i){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_info",{field_name:e,api_name:t,value:i})||!1},RowReadOnly:function(e,t,i){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_row_readonly",{api_name:e,index:t,value:i})||!1},DeleteRow:function(e,t){var i=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript();if(i)try{Lyte.registeredMixins["crm-create-mixin"].deleteSubformRowHandler(i,e,t)}catch(e){throw CScript.Error(e)}},CellReadOnly:function(e,t,i,r){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_cell_readonly",{field_name:i,api_name:e,index:t,value:r})||!1},ShowError:function(e,t,i,r){return Lyte.registeredMixins["crm-create-mixin"].executeCscriptSubformHandlers("set_error",{field_name:i,api_name:e,index:t,message:r})||!1},validate:function(e,t,i){var r=Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript(),a=r.component.getData("moduleName")||r.component.getData("module_name");let n=$L("#"+a+"_SubForm_"+e)[0];if(t>n.component.getData("maximumRows"))throw CScript.Error(`Row index ${t} exceeds the maximum subform row limit of ${n.component.getData("maximumRows")}`);if(t+i>n.component.getData("maximumRows"))throw CScript.Error(`The input rows of size ${i} cannot be inserted, as it exceeds maximum subform row limit of ${n.component.getData("maximumRows")}`)}},Button:{Click:function(e){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptButtonHandlers(e,"Click"):$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]")[0].click()},Enable:function(e){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptButtonHandlers(e,"Enable"):$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]").attr("disabled",!1)},Disable:function(e){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptButtonHandlers(e,"Disable"):$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]").attr("disabled",!0)},Show:function(e){$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]").removeClass("vH")},Hide:function(e){$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]").addClass("vH")},SetValue:function(e,t){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptButtonHandlers(e,"SetValue",t):$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]").attr("value",t)},GetAll:function(){return[{api_name:"record_save",type:"system"},{api_name:"record_cancel",type:"system"},{api_name:"record_save_and_new",type:"system"}]},getSingleButton:function(e){return["record_save","record_cancel","record_save_and_new"].contains(e.api_name)?{api_name:e.api_name,type:"system"}:null},getValue:function(e){if(Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript())return Lyte.registeredMixins["crm-create-mixin"].executeCscriptButtonHandlers(e,"GetValue")||$("form[name='createEntityNewForm'] input[cscript-tag="+e+"]")[0].value}},Field:{Read:function(t){var i=e.Form.Read().Data[t];return void 0===i?null:i},Write:async function(t,i){var r={};r[t]=i,await e.Form.Write(r)},SetCriteria:async function(e,t,i){if(null==t||""===t)throw CScript.Error("invalid criteria");if(t.startsWith("(")||""===t||(t="("+t+")"),!await Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("SetCriteria",{field_name:e,criteria:t,config:i})){var r=$L("[cscript-tag='"+e+"']"),a=r.attr("data-content-type");if(!["Lookup","Multiselect Lookup","User Lookup","Pick List","Multiselect Picklist"].includes(a))throw CScript.Error("criteria can be set only to Lookup and Picklist fields");{const a={criteria:t,...i&&i.filterOnSearch&&{filterOnSearch:i.filterOnSearch}},c=r.attr("data-uitype");if("8"===c||"221"===c){await CriteriaHandler.init("Users"),CriteriaHandler.validate(t);var n,o=$("crm-user-wrapper[cscript-tag='"+e+"']")[0].component;n=""!==o.getData("userCriteria")?JSON.parse(o.getData("userCriteria")):[];const i=CriteriaHandler.convert_to_search_criteria(CriteriaHandler.convert_to_filter_criteria(t,"lookup_criteria"),"lookup_criteria");n.push(...CriteriaHandler.convert_to_search_criteria_json(i,"lookup_criteria")),o.setData("userCriteria",JSON.stringify(n));var s=o.getData("userSearchCriteria");s=""!==s?s+" and "+t:t,o.setData("userSearchCriteria",s),$L("[cscript-tag='"+e+"']").find("crux-user-lookup")[0].component.data.cxPropSearchCriteria=s,$L("[cscript-tag='"+e+"']").find("crux-user-lookup")[0].component.data.cxPropCriteria=JSON.stringify(n)}else if("2"===c||"100"===c)CriteriaHandler.generic_validate(t,10,new Set(["in"]),new Set(["id"])),r.attr("cscript_criteria",t),r.children("option").length>1&&r.removeClass("dataPopulated");else{await CriteriaHandler.init(r.data("lookup-module")),CriteriaHandler.validate(t);const e=CriteriaHandler.convert_to_search_criteria_json(t,"adv_lookup_criteria");r.attr({"data-criteria":JSON.stringify(a),"data-criteria-str":t}),r.data({criteria:a,"criteria-obj":e}),r.siblings().find("[data-cid='showLookup']").attr("data-criteria",JSON.stringify(a)),"445"===c&&($("#ownerNameLookup_"+r.attr("id")).remove(),InfoForDisplay=void 0)}}}},SetSuggestions:function(e,t){var i=Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("SetSuggestions",{field_name:e,suggestions:t});if(i)return i;throw CScript.Error("unsupported in inventory modules")},GetSuggestions:function(e){var t=Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("GetSuggestions",{field_name:e});if(t)return t;throw CScript.Error("unsupported in inventory modules")},GetOptions:function(e){var t=Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("GetOptions",{field_name:e});if(t)return t;var i=$L("[cscript-tag='"+e+"']");if(2===i.data("uitype")||100===i.data("uitype")){var r=i.data("picklistmap");const e=i.attr("cscript_criteria"),t=e?CriteriaHandler.generic_filter(r.map((e=>({id:e.oldvalue||e.optionId||e}))),e,new Set(["id"])).map((e=>e.id)):[];var a=[];return r.forEach((e=>{var i=e.optionId?e.optionId:e.oldvalue;i?a.push({id:i,actual_value:e.systemvalue,display_value:e.uservalue,filtered:t.indexOf(i)>-1}):a.push({actual_value:e.systemvalue,display_value:e.uservalue})})),a}throw CScript.Error("action supported only for picklist and multiselect picklist fields")},SetOptions:function(e,t){if(!Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("SetOptions",{field_name:e,options:t})){var i=$L("[cscript-tag='"+e+"']");if(2!==i.data("uitype")&&100!==i.data("uitype"))throw CScript.Error("action supported only for picklist and multiselect picklist fields");var r=[];t.forEach((e=>{e.id&&r.push(e.id)})),i.attr("filteredoptions",r),(t=i.children("option")).length>1&&(i.removeClass("dataPopulated"),t.each((function(){$(this).attr("cscript-tag")&&$(this).remove()})))}},field_set_folder_id:async function(e,t,i){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()&&Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("SetWdFolderPath",{field_name:e,folderId:t,source:i})}},Input:{Error:function(e){if(Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript())Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("ERROR",e);else{var t=$("[cscript-tag='"+e.field_name+"']");commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(e.message),t)}},Mandate:function(e){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("MANDATE",e):$("[cscript-tag='"+e.field_name+"']").parent().parent().find(".labelTabCreate").addClass("newmandatory csx")},UnMandate:function(e){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("UNMANDATE",e):$("[cscript-tag='"+e.field_name+"']").parent().parent().find(".labelTabCreate.newmandatory.csx").removeClass("newmandatory csx")}},Input2:{Error:function(e,t){if(Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript())Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("ERROR",{field_name:e,message:t});else{var i=$("[cscript-tag='"+e+"']");commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(t),i)}},Message:function(e,t){var i=$("[cscript-tag='"+e+"']");commonUtils.showErrorMsg($ESAPI.encoder().encodeForHTML(t),i),$("#errorMsg_"+i.attr("id")).attr("style",(function(e,t){return(t||"")+"color: #009fff !important;"}))},Focus:function(e){$("[cscript-tag='"+e+"']").focus()},setRequired:function(e,t){Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript()?Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("setRequired",{field_name:e,value:t}):store.peekAll("field",store.peekAll("module").find((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])).api_name).find((t=>t.api_name===e)).system_mandatory||(t?$("[cscript-tag='"+e+"']").parent().parent().find(".labelTabCreate").addClass("newmandatory csx"):$("[cscript-tag='"+e+"']").parent().parent().find(".labelTabCreate.newmandatory.csx").removeClass("newmandatory csx"))},MaxLength:function(e,t){if(Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript())Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("MaxLength",{field_name:e,value:t});else{var i=$("[cscript-tag='"+e+"']");3!==i.data().uitype&&110!==i.data().uitype||"CRUX-TEXT-AREA-COMPONENT"!==i[0].tagName?i.attr("maxlength",t).attr("data-cscript-maxlength",t):i[0].component.set("cxPropMaxlength",10)}},ReadOnly:function(e,t){let i="string"==typeof e?e:e.name;if(Lyte.registeredMixins["crm-create-init-mixin"].getLyteCreateComponentForCscript())Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("ReadOnly",{field_name:i,value:t,subform_field_name:e.subform_field_name});else{var r=$("[cscript-tag='"+i+"']");if(3!==r.data().uitype&&110!==r.data().uitype||"CRUX-TEXT-AREA-COMPONENT"!==r[0].tagName){var a="checkbox"===r.attr("type")?"disabled":"readonly";!0===t?(r.attr(a,t),r[0].offsetParent.offsetParent.classList.add("readonlyF")):(r.removeAttr(a),r[0].offsetParent.offsetParent.classList.remove("readonlyF"))}else r[0].set("cxPropDisabled",!0)}},Visibility:function(e,t){if(Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("Visibility",{field_name:e,value:t}))return;const i=$("[cscript-tag='"+e+"']");if("-1"===i.attr("tabindex"))throw CScript.Error("no such field present - "+e);if(i.attr("id").startsWith("secDiv"))throw CScript.Error("visibility action cannot be applied for subform");if(!1!==i.data("mandate")&&"false"!==i.data("mandate"))throw CScript.Error("visibility action not applicable to mandatory fields");var r=$("[cscript-tag='__"+e+"']");t?r.show():r.hide(),i.data("cscript_visibility",!!t)},Info:function(e,t){if(!Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("Info",{field_name:e,value:t})){var i=$("[cscript-tag='"+e+"']").data("colname"),r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],a=$("#Crm_"+r+"_"+i+"_label"),n=$('<i class="icon_roundinfo infotoolTip mL5 dIB vaM cP" fldtooltip="'+t+'"></i>');a.append(n),a.addClass("containTooltip"),crmTemplate.bindFldTooltip()}},ToolTip:function(e,t){Lyte.registeredMixins["crm-create-mixin"].executeCscriptUIHandlers("Title",{field_name:e,value:t})||$("[cscript-tag='"+e+"']").attr("title",t)},getSingleField:function(t){const i=e.Form.Read(t).Data;return i&&i.hasOwnProperty(t.field_name)?{api_name:t.field_name}:null}},Page:{Info:function(){const e=Lyte.Router.getRouteInstance().transition.info;let t;if(e.dynamicParams){if(t=store.peekAll("module").filter((function(t){return t.module_name===e.dynamicParams[0]}))[0],!t)return;t=t.api_name}switch(e.route){case"crm.tab.reports.view":var i=$(".report_name");return{report_name:i.length>0?i.text():""};case"crm.tab.module.entity.clone":return{module:t,layout_id:e.queryParams.layoutId,parent_record_id:e.dynamicParams[1],name:"record_clone"};case"crm.tab.module.entity.edit":case"crm.tab.module.entity.detail":return{module:t,layout_id:e.queryParams.layoutId,record_id:e.dynamicParams[1],name:"record_edit"};case"crm.tab.module.create":return{module:t,layout_id:e.queryParams.layoutId,name:"record_create"};default:return{}}},Record:function(){return AppHandler._getRecord(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],Lyte.Router.getRouteInstance().transition.info.dynamicParams[1])}},Component:{layoutSwitchComp:"record-create-layout-switch",GetComponents:function(){return"crm.tab.module.create"===Lyte.Router.getRouteInstance().transition.info.route?[this.layoutSwitchComp]:[]},Show:function(e){if(e!==this.layoutSwitchComp)throw new CScript.Error(`setVisibility is not supported for ${e}`);$L("#ddvalueforDisp").css("display","block"),$L("#intgddvalueforDisp").css("display","block")},Hide:function(e){if(e!==this.layoutSwitchComp)throw new CScript.Error(`setVisibility is not supported for ${e}`);$L("#ddvalueforDisp").css("display","none"),$L("#intgddvalueforDisp").css("display","none")}}};return{button_enable:function(){e.Button.Enable(this.api_name)},button_disable:function(){e.Button.Disable(this.api_name)},button_show:function(){e.Button.Show(this.api_name)},button_hide:function(){e.Button.Hide(this.api_name)},button_click:function(){e.Button.Click(this.api_name)},button_set_value:function(){e.Button.SetValue(this.api_name,this.value)},button_list:function(){return e.Button.GetAll()},field_mandate:function(){e.Input.Mandate(this)},field_unmandate:function(){e.Input.UnMandate(this)},field_write:async function(){if("1.0"===this.version)await e.Field.Write(this.field_name,this.value);else{var t=Object.keys(this.req_data)[0];await e.Field.Write(t,this.req_data[t])}},field_read:function(){return e.Field.Read(this.field_name)},field_focus:function(){e.Input2.Focus(this.field_name)},field_blur:function(){e.Input2.Blur(this.field_name)},field_set_step:function(){e.Input2.Step(this.field_name,this.value)},field_get_step:function(){return e.Input2.getStep(this.field_name)},field_get_required:function(){return e.Input2.isRequired(this.field_name)},field_set_required:function(){e.Input2.setRequired(this.field_name,this.value)},field_set_max_length:function(){e.Input2.MaxLength(this.field_name,this.value)},field_get_max_length:function(){return e.Input2.getMaxLength(this.field_name)},field_set_read_only:function(){e.Input2.ReadOnly(this.field_name,this.value)},field_get_read_only:function(){return e.Input2.getReadOnly(this.field_name)},subform_set_column_readonly:function(){e.Subform.ReadOnly(this.field_name,this.parent,this.value)},subform_set_column_mandatory:function(){e.Subform.Mandate(this.field_name,this.parent,this.value)},subform_set_column_visibility:function(){e.Subform.Visible(this.field_name,this.parent,this.value)},subform_set_column_info:function(){e.Subform.Info(this.field_name,this.parent,this.message)},cell_set_readonly:function(){e.Subform.CellReadOnly(this.api_name,this.index,this.field_name,this.value)},cell_set_error:function(){e.Subform.ShowError(this.api_name,this.index,this.field_name,this.value)},field_set_disabled:function(){e.Input2.Disabled(this.field_name,this.value)},field_info_add:function(){e.Input2.Info(this.field_name,this.message)},field_message_add:function(){e.Input2.Info(this.field_name,this.color,this.message)},field_tooltip_add:function(){e.Input2.ToolTip(this.field_name,this.message)},field_visibility:function(){e.Input2.Visibility(this.field_name,this.value)},subform_set_criteria:async function(){await e.Subform.SetCriteria(this.parent,this.field_name,this.criteria,this.config)},field_set_criteria:async function(){await e.Field.SetCriteria(this.field_name,this.criteria,this.config)},field_set_folder_id:async function(){await e.Field.field_set_folder_id(this.field_name,this.value,this.source)},field_get_options:function(){return e.Field.GetOptions(this.field_name)},field_set_options:function(){return e.Field.SetOptions(this.field_name,this.options)},form_cancel:function(){e.Form.Cancel()},form_save:function(){e.Form.Save()},form_read:function(){return e.Form.Read(this).Data},form_write:function(){return e.Form.Write(this.req_data)},msg_inline:function(){e.Input.Error(this)},msg_inline:function(){e.Input.Error(this)},field_set_error:function(){e.Input2.Error(this.field_name,this.value)},page_info:function(){return e.Page.Info.bind(this)()},get_record:function(){return e.Page.Record()},get_field_read:function(){return e.Input2.getSingleField(this)},get_button_apiname:function(){return e.Button.getSingleButton(this)},button_get_value:function(){return e.Button.getValue(this.api_name)},subform_read:function(){return e.Form.Read(this).Data[this.api_name]},subform_write:function(){return this.validate&&e.Subform.validate(this.subform_api_name,0,this.req_data[this.subform_api_name].length),e.Form.Write(this.req_data)},subform_get_field:function(){return e.Subform.GetField(this.subform_api_name,this.field_name)},subform_get:function(){return e.Subform.Get(this.api_name)},get_subform_row:function(){let t=e.Form.Read(this).Data[this.api_name];return t&&t.length>this.index?{api_name:this.api_name,index:this.index}:null},subform_read_row:function(){return e.Form.Read(this).Data[this.api_name][this.index]},subform_write_row:function(){return e.Subform.Write(this.api_name,this.index,void 0,"writeRow",this.values)},set_row_readonly:function(){return e.Subform.validate(this.subform_api_name,this.index,0),e.Subform.RowReadOnly(this.subform_api_name,this.index,this.value)},subform_delete_row:function(){return e.Subform.validate(this.subform_api_name,this.index,0),e.Subform.DeleteRow(this.subform_api_name,this.index)},subform_add_row:function(){return e.Subform.validate(this.subform_api_name,this.index||0,this.values.length),e.Subform.Write(this.subform_api_name,this.index,void 0,"add",this.values)},get_subform_cell:function(){let t=e.Form.Read(this).Data[this.parent];return t[this.index]&&t[this.index].hasOwnProperty(this.api_name)&&{parent:this.parent,index:this.index,api_name:this.api_name}||null},subform_read_cell:function(){return e.Form.Read(this).Data[this.parent][this.index][this.api_name]},subform_write_cell:function(){return e.Subform.Write(this.parent,this.index,this.api_name,"writeCell",this.value)},field_get_suggestions:function(){return e.Field.GetSuggestions(this.field_name)},field_set_suggestions:function(){return e.Field.SetSuggestions(this.field_name,this.suggestions)},component_list:function(){return e.Component.GetComponents()},component_show:function(){e.Component.Show(this.name)},component_hide:function(){e.Component.Hide(this.name)},refresh_page:function(){Lyte.registeredMixins["crm-cscript-global-mixin"].client_refresh(this.config)}}}(),CriteriaHandler=function(){var e={UIFilterMap:{text:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},email:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},website:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},phone:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},currency:{comparators:["equal","not_equal","greater_than","lesser_than","less_equal","greater_equal","between","not_between"],values:["${EMPTY}"]},integer:{comparators:["equal","not_equal","greater_than","lesser_than","less_equal","greater_equal","between","not_between"],values:["${EMPTY}"]},double:{comparators:["equal","not_equal","greater_than","lesser_than","less_equal","greater_equal","between","not_between"],values:["${EMPTY}"]},boolean:{comparators:["equal"],values:[]},picklist:{comparators:["equal","not_equal"],values:["${EMPTY}"]},multiselectpicklist:{comparators:["equal","not_equal"],values:["${EMPTY}"]},lookup:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},ownerlookup:{comparators:["equal","not_equal"],values:[]},multiselectlookup:{comparators:["equal","not_equal","contains","not_contains","starts_with","ends_with"],values:["${EMPTY}"]},date:{comparators:["equal","not_equal","greater_than","lesser_than","less_equal","greater_equal","between"],values:["${EMPTY}"]},datetime:{comparators:["less_equal","greater_than","lesser_than","greater_equal","between"],values:["${EMPTY}"]},encrypted:{comparators:["equal","not_equal"],values:["${EMPTY}"]},id:{comparators:["equal","in"]}},SearchValueVsUIValueMap:{null:"${EMPTY}"},UIValueVsSearchValueMap:{"${EMPTY}":"null"},SearchcomparatorVsUIComparatorMap:{equals:"equal",not_equals:"not_equal"},UIComparatorVsSearchComparatorMap:{equal:"equals",not_equal:"not_equals"},advanced_filter_system_unsupported_types:["multiselectlookup"],advanced_filter_system_defined_fields:{},operators:{old_search:["equals","in","starts_with"],new_search:["equals","not_equal","greater_equal","greater_than","less_equal","lesser_than","starts_with","in","between"]},equivalent_search_operators:{starts_with:"contains"},userFieldsVsComparators:{id:["equals","not_equals","in","not_in"],country:["equals","not_equals","like","not_like","contains","not_contains"],role:["equals","not_equals"],"role.id":["equals","not_equals"],"role.name":["equals","not_equals","like","not_like","contains","not_contains"],reporting_to:["equals","not_equals"],"reporting_to.id":["equals","not_equals"],"reporting_to.zuid":["equals","not_equals"],"reporting_to.userid":["equals","not_equals"],"reporting_to.email":["equals","not_equals"],city:["equals","not_equals","like","not_like","contains","not_contains"],locale:["equals","not_equals","like","not_like","contains","not_contains"],Isonline:["equals","not_equals"],street:["equals","not_equals","like","not_like","contains","not_contains"],alias:["equals","not_equals","like","not_like","contains","not_contains"],state:["equals","not_equals","like","not_like","contains","not_contains"],fax:["equals","not_equals","like","not_like","contains","not_contains"],country_locale:["equals","not_equals","like","not_like","contains","not_contains"],first_name:["equals","not_equals","like","not_like","contains","not_contains"],email:["equals","not_equals","like","not_like","contains","not_contains"],created_time:["equals","not_equals","greater_equal","greater_than","less_equal","less_than","between","not_between"],Modified_Time:["equals","not_equals","greater_equal","greater_than","less_equal","less_than","between","not_between"],website:["equals","not_equals","like","not_like","contains","not_contains"],time_format:["equals","not_equals","like","not_like"],profile:["equals","not_equals","in","not_in"],"profile.name":["equals","not_equals","like","not_like","contains","not_contains"],"profile.id":["equals","not_equals","in","not_in"],mobile:["equals","not_equals","like","not_like","contains","not_contains"],last_name:["equals","not_equals","like","not_like","contains","not_contains"],time_zone:["equals","not_equals","like","not_like","contains","not_contains"],created_by:["equals","not_equals"],"created_by.id":["equals","not_equals"],"created_by.name":["equals","not_equals"],Modified_By:["equals","not_equals"],"Modified_By.id":["equals","not_equals"],"Modified_By.name":["equals","not_equals"],zuid:["equals","not_equals"],confirm:["equals","not_equals"],territories:["in","not_in"],phone:["equals","not_equals","like","not_like","contains","not_contains"],dob:["equals","not_equals","like","not_like","contains","not_contains"],status:["equals","not_equals","like","not_like","contains","not_contains"],admin_user:["equals","not_equals"],forecast_manager:["in","not_in"]},userTypesVsComparators:{text:["equals","not_equals","like","not_like","contains","not_contains"],email:["equals","not_equals","like","not_like","contains","not_contains"],website:["equals","not_equals","like","not_like","contains","not_contains"],phone:["equals","not_equals","like","not_like","contains","not_contains"],currency:["equals","not_equals","greater_equal","greater_than","less_equal","less_than"],integer:["equals","not_equals","greater_equal","greater_than","less_equal","less_than"],double:["equals","not_equals","greater_equal","greater_than","less_equal","less_than"],boolean:["equals","not_equals"],picklist:["equals","not_equals","like","not_like","contains","not_contains"],multiselectpicklist:["in","not_in","contains","not_contains"],lookup:["equals","not_equals"],date_time:["equals","not_equals","greater_equal","greater_than","less_equal","less_than","between","not_between"]},module_name:"",init:async function(t){if(e.module_name=t,e.fieldsMap={id:{data_type:"id",lookup:void 0,encrypted:!1,visible:!0}},!moduleRecordMapping[t]||!moduleRecordMapping[t].fields||!moduleRecordMapping[t].fields.length){const e=await store.findAll("field",{module:moduleApiMapping[t]||"Users"});"Users"===t&&(moduleRecordMapping[t]={fields:e})}return moduleRecordMapping[t].fields.forEach((function(t){e.fieldsMap[t.api_name]={data_type:t.data_type,lookup:t.lookup.module?t.lookup.module.api_name:void 0,encrypted:null!==t.crypt,visible:t.visible,custom_field:t.custom_field}})),!0},check_valid_comparator_for_uifilter:function(t,i,r,a,n){if(e.UIFilterMap.hasOwnProperty(t)){if(a&&!a.visible)throw CScript.Error("User doesn't have permission to field - "+n);if(a&&a.encrypted&&!e.UIFilterMap.encrypted.comparators.contains(i))throw CScript.Error("Invalid Comparator - "+i);if(a&&a.encrypted&&!e.UIFilterMap.encrypted.values.contains(r))throw CScript.Error("Invalid Value - "+r);if(!e.UIFilterMap[t].comparators.contains(i))throw CScript.Error("Invalid Comparator - "+i);if("lookup"===t&&-1===n.indexOf(".")){if(!["equal","not_equal"].includes(i))throw CScript.Error("Invalid Comparator - "+i);if("${EMPTY}"!==r)throw CScript.Error("Invalid Value - "+r)}if(Object.keys(e.UIValueVsSearchValueMap).contains(r)&&!e.UIFilterMap[t].values.contains(r))throw CScript.Error("Invalid Value - "+r)}},comparator_value_converter:(t,i)=>(i?("Users"===e.module_name?e.SearchcomparatorVsUIComparatorMap.hasOwnProperty(t.comparator)&&(t.comparator=e.SearchcomparatorVsUIComparatorMap[t.comparator]):e.UIComparatorVsSearchComparatorMap.hasOwnProperty(t.comparator)&&(t.comparator=e.UIComparatorVsSearchComparatorMap[t.comparator]),e.UIValueVsSearchValueMap.hasOwnProperty(t.value)&&(t.value=e.UIValueVsSearchValueMap[t.value])):(e.SearchcomparatorVsUIComparatorMap.hasOwnProperty(t[1])&&(t[1]=e.SearchcomparatorVsUIComparatorMap[t[1]]),e.SearchValueVsUIValueMap.hasOwnProperty(t[2])&&(t[2]=e.SearchValueVsUIValueMap[t[2]])),t),critera_pre_process:function(e){const t=e.match(/\(/g),i=e.match(/\)/g);if(t&&i&&t.length===i.length)return e;throw CScript.Error("invalid criteria")},parse_criteria:function(e){return e.split(/(\([^)^(]+\)|\sand\s|\sor\s|\(|\)| )/)},data_comparator:function(e,t,i){if(void 0===e)return!1;switch(i){case"equals":return e===t;case"not_equals":return e!==t;case"starts_with":return e.startsWith(t);case"ends_with":return e.endsWith(t);case"contains":return-1!==e.indexOf(t);case"not_contains":return-1===e.indexOf(t);case"greater_than":return e>t;case"lesser_than":return e<t;case"less_equal":return e<=t;case"greater_equal":return e>=t;case"in":return new Set(t.split(",")).has(e);case"between":if(2!==(r=t.split(",")).length)throw CScript.Error("between operator expects value in format - 'num1,num2'");return r[0]<=e&&e<=r[1];case"not_between":var r;if(2!==(r=t.split(",")).length)throw CScript.Error("not_between operator expects value in format - 'num1,num2'");return r[0]>=e||e>=r[1]}},type_evaluator:function(t,i,r,a){if(!e.fieldsMap[i])throw CScript.Error("Invalid field name: "+i);switch(e.fieldsMap[i].data_type){case"lookup":case"ownerlookup":return!!(t[i]&&(e.data_comparator(t[i].id,a,r)||t[i].name&&e.data_comparator(t[i].name,a,r)));case"integer":case"double":case"boolean":let n;try{n=JSON.parse(a)}catch(e){n=a}return e.data_comparator(t[i],n,r);case"date":const o=Crm.userDetails.DATE_PATTERN.toUpperCase(),s=$L.moment(a,o);return!!s._isValid&&e.data_comparator($L.moment(t[i],o).time(),s.time(),r);case"datetime":const c=Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.replace(" a"," A"),l=$L.moment(a,c);return!!l._isValid&&e.data_comparator($L.moment(t[i],c).time(),l.time(),r);default:return e.data_comparator(t[i],a,r)}},evaluate_stack:function(e){return"and"===e[1]?e[0]&&e[2]:e[0]||e[2]},filter_record:function(t,i){var r=!1,a=[];return e.parse_criteria(i).forEach((function(i){if(i=i.trim(),/^(\(*.+:*.+:*.+\))$/.test(i)){const[r,n,...o]=i.substring(1,i.length-1).split(":");a.push(e.type_evaluator(t,r,n,o.join(":")))}else if("and"===i||"or"===i)a.push(i);else if("("===i)a.push(i);else if(")"===i){for(var r=[],n=a.pop();"("!==n;)r.push(n),n=a.pop();a.push(e.evaluate_stack(r))}})),1===a.length&&(r=a[0]),r},generic_deserialize:function(t){var i={};t=e.critera_pre_process(t),e.parse_criteria(t).forEach((function(t){if(t=t.trim(),/^(\(*.+:*.+:*.+\))$/.test(t)){var r=t.substring(1,t.length-1).split(":");if(3!==r.length)throw CScript.Error("invalid criteria - "+t);r=e.comparator_value_converter(r,!1);var a=e.convert_value_serialize(r[0],r[2],i.hasOwnProperty(r[0]),r[1]);if(i[r[0]])if(Array.isArray(i[r[0]].value))i[r[0]].value.push(a);else{if(!e.advanced_filter_system_defined_fields.hasOwnProperty(r[0]))throw CScript.Error("only once criteria can be applied to field - "+r[0]);i[r[0]].value=[i[r[0]].value,a]}else i[r[0]]={field:{api_name:r[0]},comparator:r[1],value:a}}else if("not"===t)throw CScript.Error("NOT operator not allowed")}));var r=Object.keys(i);if(r.length>1){var a=[];return r.forEach((function(e){a.push(i[e])})),{group_operator:"and",group:a}}if(1===r.length)return i[r[0]]},generic_filter:function(t,i,r){return i=e.critera_pre_process(i),t.filter((function(t){var a=[];return e.parse_criteria(i).forEach((function(i){if(i=i.trim(),/^(\(*.+:*.+:*.+\))$/.test(i)){const[n,o,s,...c]=i.substring(1,i.length-1).split(":");if(c.length||r&&!r.has(n))throw CScript.Error("invalid criteria - "+i);a.push(e.data_comparator(r?t[n]:t,s,o))}else if("and"===i||"or"===i)a.push(i);else if("("===i)a.push(i);else if(")"===i){for(var n=[],o=a.pop();"("!==o;)n.push(o),o=a.pop();a.push(e.evaluate_stack(n))}})),1===a.length&&a[0]}))},filter:function(t,i){i=e.critera_pre_process(i);var r=[];return t.forEach((function(t){e.filter_record(t,i)&&r.push(t)})),r},convert_value_serialize:function(t,i,r,a,n){if(!e.fieldsMap)return i;switch(e.get_field_data_type(t)){case"tag":var o;if(store.peekAll("tag").forEach((e=>{e.name===i&&(o={id:e.id,name:i,color_code:e.color_code},o=r?o:[o])})),!o)throw CScript.Error("Invalid tag - "+i);return o;case"ownerlookup":case"userlookup":case"multiselectlookup":if("null"===i)i="${EMPTY}";else if(isNaN(i)||isNaN(parseFloat(i)))throw CScript.Error(`Invalid id - ${i}`);return n?r?i:[i]:r?{id:i}:[{id:i}];case"picklist":case"multiselectpicklist":return i="null"===i?"${EMPTY}":i,r?i:[i];case"currency":case"integer":return i=-1!==i.indexOf(",")?i.split(","):i;case"text":case"email":case"website":case"phone":case"lookup":return"null"===i?"${EMPTY}":i;case"datetime":if(1===(i=i.split(",")).length&&"between"===a)throw CScript.Error("between operator expects value in format - '2025-06-08T00:00:00,2025-06-09T00:00:00'");return i.forEach((e=>{if(19!==e.length||"Invalid Date"===$L.moment(e).toDate())throw CScript.Error(`Invalid datetime - ${e}`)})),i;default:return i}},search_deserialize:function(t,i){var r={};return t=e.critera_pre_process(t),e.parse_criteria(t).forEach((function(t){if(t=t.trim(),/^(\(*.+:*.+:*.+\))$/.test(t)){var a=t.substring(1,t.length-1).split(":");a[2]=a.splice(2).join(":"),a=e.comparator_value_converter(a,!0);var n=e.convert_value_serialize(a[0],a[2],r.hasOwnProperty(a[0]),a[1],!0);if(r[a[0]])Array.isArray(r[a[0]].value)?r[a[0]].value.push(n):e.advanced_filter_system_defined_fields.hasOwnProperty(a[0])&&(r[a[0]].value=[r[a[0]].value,n]);else{if("lookup_criteria"===i){const t=e.equivalent_search_operators[a[1]];t&&(a[1]=t)}r[a[0]]="adv_lookup_criteria"===i?{api_name:a[0],comparator:a[1],value:n}:{field:a[0],comparator:a[1],value:n}}}else if("not"===t)throw CScript.Error("NOT operator not allowed")})),Object.keys(r).map((e=>r[e]))},serialize:function(t,i){const r=["lookup_criteria","adv_lookup_criteria"].includes(i);var a={};t=e.critera_pre_process(t),e.parse_criteria(t).forEach((function(t){if(t=t.trim(),/^(\(*.+:*.+:*.+\))$/.test(t)){var n=t.substring(1,t.length-1).split(":");n[2]=n.splice(2).join(":");var o=e.get_field_data_type(n[0],"advanced_filter"===i);n=e.comparator_value_converter(n,r);var s=e.get_field_config(n[0]);!r&&e.check_valid_comparator_for_uifilter(o,n[1],n[2],s,n[0]);var c=e.convert_value_serialize(n[0],n[2],a.hasOwnProperty(n[0]),n[1],r);if(a[n[0]])if(Array.isArray(a[n[0]].value))a[n[0]].value.push(c);else{if(!e.advanced_filter_system_defined_fields.hasOwnProperty(n[0]))throw CScript.Error("only one criteria can be applied to field - "+n[0]);a[n[0]].value=[a[n[0]].value,c]}else{var l="adv_lookup_criteria"===i?n[0]:{api_name:n[0]};if("lookup_criteria"===i){const t=e.equivalent_search_operators[n[1]];t&&(n[1]=t)}a[n[0]]={["adv_lookup_criteria"===i?"api_name":"field"]:l,comparator:n[1],value:c}}}else if("not"===t)throw CScript.Error("NOT operator not allowed")}));var n=Object.keys(a);if(n.length>1){var o=[];return n.forEach((function(e){o.push(a[e])})),{group_operator:"and",group:o}}if(1===n.length)return a[n[0]]},get_field_config:function(t){var i={},r=e.fieldsMap[t];return i.encrypted=!!r&&r.encrypted,i.visible=!r||r.visible,i},get_field_data_type:function(t,i){try{return"Tag"===t?"tag":(t=i&&-1!==t.indexOf(".")?t.split(".")[0]:t,e.fieldsMap[t]?e.fieldsMap[t].data_type:e.advanced_filter_system_defined_fields[t])}catch(e){throw CScript.Error("Invalid api_name - "+t)}},criteria_single_deserialize:function(t){var i=e.get_field_data_type(t.field.api_name);if(t=e.comparator_value_converter(t,!0),["lookup","ownerlookup","picklist","multiselectpicklist","userlookup"].contains(i)&&Array.isArray(t.value)){var r=[];t.value.forEach((function(e){switch(i){case"lookup":case"ownerlookup":case"userlookup":"${CURRENTUSER}"===e.name&&(e.id=Crm.userDetails.USER_ID),r.push(`(${t.field.api_name}:${t.comparator}:${e.id})`);break;case"picklist":case"multiselectpicklist":r.push(`(${t.field.api_name}:${t.comparator}:${e})`)}}));var a="("+r[0];if((o=r.length)>1)for(var n=1;n<o;n++)a+=" or "+r[n];return a+=")"}if("Tag"===t.field.api_name){var o;if(r=[],["null","${NOTEMPTY}"].includes(t.value)?r.push(`${t.field.api_name}:${t.comparator}:${t.value}`):t.value.forEach((function(e){r.push(`(${t.field.api_name}:${t.comparator}:${e.name})`)})),a="("+r[0],(o=r.length)>1)for(n=1;n<o;n++)a+=" or "+r[n];return a+=")"}return t.value=Array.isArray(t.value)?t.value.toString():t.value,`(${t.field.api_name}:${t.comparator}:${t.value})`},deserialize:function(t){if(t.hasOwnProperty("group")){var i=[];t.group.forEach((function(t){t.hasOwnProperty("group")?i.push(e.deserialize(t)):i.push(e.criteria_single_deserialize(t))}));var r=" and ";t.hasOwnProperty("group_operator")&&(r=t.group_operator);var a="("+i[0],n=i.length;if(n>1)for(var o=1;o<n;o++)a+=r+i[o];return a+=")"}return e.criteria_single_deserialize(t)},check_valid_comparator_for_search_criteria:function(t,i,r,a){if("Users"===e.module_name)if(e.fieldsMap.hasOwnProperty(a)&&e.fieldsMap[a].custom_field){if(-1===(e.userTypesVsComparators.hasOwnProperty(t)?e.userTypesVsComparators[t]:[]).indexOf(i))throw CScript.Error("Operator not supported - "+i)}else{if(!e.userFieldsVsComparators.hasOwnProperty(a))throw CScript.Error("Field not supported - "+a);if(-1===e.userFieldsVsComparators[a].indexOf(i)&&!e.equivalent_search_operators[i])throw CScript.Error("Operator not supported - "+i)}else{if(-1===(r?e.operators.new_search:e.operators.old_search).indexOf(i))throw CScript.Error("Operator not supported - "+i);if(e.UIFilterMap.hasOwnProperty(t)&&(e.SearchcomparatorVsUIComparatorMap.hasOwnProperty(i)&&(i=e.SearchcomparatorVsUIComparatorMap[i]),!e.UIFilterMap[t].comparators.contains(i)))throw CScript.Error("Invalid Comparator - "+i)}},generic_validate:function(t,i=10,r=new Set(["equals"]),a){if(!t)throw CScript.Error("invalid criteria - "+t);var n=0;if(e.parse_criteria(e.critera_pre_process(t)).forEach((function(e){if(e=e.trim(),/^(\(*.+:*.+:*.+\))$/.test(e)){if((n+=1)>i)throw CScript.Error(`limit for no. of criteria ${i} has exceeded`);const[t,o,...s]=e.substring(1,e.length-1).split(":");if(s.length>1||a&&!a.has(t))throw CScript.Error("invalid criteria - "+e);if(!r.has(o))throw CScript.Error(`${o} operator not allowed`)}else if("not"===e)throw CScript.Error("NOT operator not allowed")})),0===n)throw CScript.Error("invalid criteria - "+t)},validate_lookups:async function(t){for(let i of e.parse_criteria(e.critera_pre_process(t))){const t=i.trim(),r=t.substring(1,t.length-1).split(":")[0];if(-1!==r.indexOf(".")){const[t,i]=r.split(".");if(i!==(await store.findRecord("module",store.peekAll("module").find((i=>i.api_name===e.fieldsMap[t].lookup)).id))[0].fields.find((e=>e.display_field)).api_name)throw CScript.Error(`field not supported - ${r}`)}}},validate:function(t,i,r){if(!t)throw CScript.Error("invalid criteria - "+t);t=e.critera_pre_process(t);var a=e.parse_criteria(t),n=0;if(a.forEach((function(t){if(t=t.trim(),/^(\(*.+:*.+:*.+\))$/.test(t)){if(n+=1,r&&n>10)throw CScript.Error("limit for no. of criteria 10 has exceeded");if(!r&&n>5)throw CScript.Error("limit for no. of criteria 5 has exceeded");let[a,o,...s]=t.substring(1,t.length-1).split(":");if(!s.join(":").trim())throw CScript.Error(`${a} field cannot be empty`);const c=e.get_field_data_type(a,r);if(void 0===c)throw CScript.Error("invalid field - "+a);if(r&&e.advanced_filter_system_unsupported_types.includes(c))throw CScript.Error("field not supported - "+a);r||e.check_valid_comparator_for_search_criteria(c,o,i,a)}else if("not"===t)throw CScript.Error("NOT operator not allowed")})),0===n)throw CScript.Error("invalid criteria - "+t)}};return{init:function(t){return e.init(t)},filter_records:function(t,i){return e.filter(t,i)},generic_filter:function(t,i,r){return e.generic_filter(t,i,r)},generic_deserialize:function(t){return e.generic_deserialize(t)},convert_to_filter_criteria:(t,i)=>e.serialize(t,i),convert_to_search_criteria_json:(t,i)=>e.search_deserialize(t,i),convert_to_search_criteria:t=>e.deserialize(t),pre_process:t=>e.critera_pre_process(t),generic_validate(t,i,r,a){e.generic_validate(t,i,r,a)},validate(t,i,r){e.validate(t,i,r)},validate_lookups:async function(t){await e.validate_lookups(t)}}}(),AppHandler=function(){var e={Variable:{Get:function(e){switch(e){case"user":return function(){const e=store.peekRecord("user",Crm.userDetails.USER_ID),t=["id","zuid","email","date_format","first_name","full_name","last_name","role","profile"];return Object.keys(e).filter((function(e){return t.includes(e)})).reduce(((t,i)=>{switch(i){case"role":case"profile":t[i]=e[i].id&&e[i].name?{id:e[i].id,name:e[i].name}:void 0;break;default:t[i]=e[i]}return t}),{})}();case"org":return function(){function e(e){return Object.keys(e).filter((function(e){return["id","domain_name","name","type"].includes(e)})).reduce(((t,i)=>(t[i]=e[i],t)),{})}const t=store.peekRecord("organization",crmZgid);return t?e(t):new Promise((function(t){store.findRecord("organization",crmZgid).then((function(i){t(e(i[0]))}))}))}();case"url":return window.location.href;case"environment":return function(){const e=store.peekRecord("organization",crmZgid);return e?e.type:new Promise((function(e){store.findRecord("organization",crmZgid).then((function(t){e(t[0].type)}))}))}();case"deployment":return"China"===(t=Crm.userDetails.DEPLOYMENT)?"CN":t;case"geolocation":return new Promise((function(e){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){const i=new Set(["latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed"]);var r={};for(var a in t.coords)i.has(a)&&(r[a]=t.coords[a]);e(r)}),(function(){e()}))}));case"selectedValue":return{value:window.getSelection().toString()}}var t}},getCalloutTarget:function(e){const t=Lyte.Router.getRouteInstance().transition,i=t.target,r=t.info.dynamicParams[0];switch(i){case"crm.tab.module.custom-view.list":throw CScript.Error("callout not supported in list page");case"crm.tab.module.entity.canvas":throw CScript.Error("callout not supported in canvas page")}const a=store.peekAll("field").find((t=>t.api_name===e.api_name&&t.module[0].module_name===r));if(!a)throw CScript.Error("invalid target");if("subform"===a.data_type||Crm.userDetails.isStaticSubFormEnabled&&"static_subform"===a.data_type)throw CScript.Error("callout not supported for subform");switch(i){case"crm.tab.module.entity.detail":const e=`#textarea_${a.column_name}`,t=`#value_${a.column_name}`,i=$(`${e}:visible`).length,r=$(`${t}:visible`).length;if(!i&&!r)throw CScript.Error("invalid target");return i?e:t;case"crm.tab.module.create":case"crm.tab.module.entity.clone":case"crm.tab.module.entity.edit":const n=`[cscript-tag='${a.api_name}']`,o=`#${a.module[0].module_name}_fldRow_${a.column_name}`,s=$(`${n}:visible`).length,c=$(`${o}:visible`).length;if(!s&&!c)throw CScript.Error("invalid target");return c?o:n;case"crm.tab.module.create.canvas":case"crm.tab.module.entity.edit.canvas":case"crm.tab.module.entity.clone.canvas":const l=document.querySelector("crm-canvas-form");if(l){const e=".canvasselectablefield.canvas-element-apiname-"+a.api_name;if(l.querySelector(e))return e;throw CScript.Error("invalid target")}default:throw CScript.Error("callout not supported")}},getWidget:function(e,t){let i;const r=WidgetHandler.WidgetConfig&&WidgetHandler.WidgetConfig.Popup;if(t){if(i=r&&Object.values(r).find((e=>e.API_NAME===t)),!i)throw CScript.Error(`invalid api name - ${t}`)}else if(i="undefined"!=typeof WidgetHandler&&r&&r[e],!i)throw CScript.Error(`invalid id - ${e}`);return i},copyToClipboard:function(e){try{if(!navigator||!navigator.clipboard)throw CScript.Error("Failed to copy text to clipboard. Clipboard not supported for this browser");navigator.clipboard.writeText(e)}catch(e){throw CScript.Error("Failed to copy text to clipboard")}}};const t={record_list:{route:"crm.tab.module.custom-view.list",dynamicParams:["module","custom_view_id"]},record_detail:{route:"crm.tab.module.entity",dynamicParams:["module","record_id"]},record_create:{route:"crm.tab.module.create",dynamicParams:["module"]},record_clone:{route:"crm.tab.module.entity.clone",dynamicParams:["module","record_id"]},record_edit:{route:"crm.tab.module.entity.edit",dynamicParams:["module","record_id"]},tab:{route:"crm.tab.module.index-module"}};return{variable:function(){return e.Variable.Get(this.key)},copy_clipboard:function(){return e.copyToClipboard(this.text)},navigation_data:function(){return _cscript._navigation_data||null},open_widget_by_id:function(){var t;if(Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("widget"),"crux"===this.type){if(app.isMenuless)throw CScript.Error("invalid action");var i;if(this.config.crux.module&&window.moduleApiMapping)for(var r=Object.keys(moduleApiMapping),a=r.length,n=0;n<a;n++)if(moduleApiMapping[r[n]]===this.config.crux.module){i=r[n];break}if(["record_create","record_clone","record_edit"].includes(this.api_name)){var o,s;if((s=!!["Activities","Events","Calls","Appointments__s"].includes(this.config.crux.module)||s)||!(o=i&&moduleRecordMapping[i])||o.quick_create&&"Activities"!==o.module_name&&!(2&o.visibility||4&o.visibility)||(s=!0),s)throw CScript.Error("unsupported module");if(!o)throw CScript.Error("invalid module")}t={ID:this.type,NAME:"CRUX",ISACTIVE:!0,START_URL:CruxHandler.getFrameURL(this.api_name,this.config.crux,i)}}else"widget"===this.type&&(t=e.getWidget(this.id,this.api_name));return WidgetHandler.Popup.render(t,this.data,this.config,"CScriptWidget"),new Promise((function(e,t){_cscript._wP={resolve:e,reject:t}}))},close_widget:async function(e,t,i,r){const a="undefined"!=typeof WidgetHandler&&("CScriptCallout"===e?"_wcP":"CScriptWidget"===e?"_wP":"_flyout");if(a)switch(await WidgetHandler.Popup.close(e,t,r),e){case"CScriptFlyout":delete _cscript._flyout;break;case"CScriptCallout":delete _cscript._callout;case"CScriptWidget":t?_cscript[a]&&_cscript[a].reject(CScript.Error("widget_closed")):_cscript[a]&&_cscript[a].resolve(i),delete _cscript[a]}},create_flyout:function(){return!_cscript._flyout&&(_cscript._flyout={name:this.name,config:this.config},!0)},get_flyout:function(){return _cscript._flyout&&_cscript._flyout.name===this.name},open_callout:async function(){Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("callout");const t=e.getWidget(this.id,this.api_name);return this.target&&"field"===this.target.type&&(this.target=e.getCalloutTarget(this.target)),_cscript._callout&&await AppHandler.close_widget("CScriptCallout",!0,void 0),_cscript._callout={id:this.id},WidgetHandler.Popup.render(t,this.data,{...this.config,target:this.target},"CScriptCallout"),new Promise((function(e,t){_cscript._wcP={resolve:e,reject:t}}))},open_flyout:async function(){if(Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("flyout"),_cscript._flyout&&_cscript._flyout.name===this.name){const t=e.getWidget(this.id,this.api_name);return this.id?_cscript._flyout.id=this.id:_cscript._flyout.api_name=this.api_name,await WidgetHandler.Popup.render(t,this.data,_cscript._flyout.config,"CScriptFlyout"),!0}return!1},notify_flyout:function(){return!(!_cscript._flyout||_cscript._flyout.name!==this.name||"undefined"==typeof WidgetHandler)&&(e.getWidget(_cscript._flyout.id,_cscript._flyout.api_name)&&WidgetHandler.EventNotifier[this.config&&this.config.wait?"notify_and_wait":"notify"](CrmWidget.Popup,this.data))},close_flyout:async function(){return!(!_cscript._flyout||_cscript._flyout.name!==this.name||"undefined"==typeof WidgetHandler)&&(e.getWidget(_cscript._flyout.id,_cscript._flyout.api_name)&&await AppHandler.close_widget("CScriptFlyout",!1,void 0),!0)},_getRecord:function(e,t){return store.peekRecord(moduleRecordMapping[e].id,t)},refresh_page:function(){Lyte.registeredMixins["crm-cscript-global-mixin"].client_refresh(this.config)},open_window:function(){try{const e=this.url.startsWith("/")?"":new URL(this.url).protocol,t=["http:","https:",""].includes(e)?this.url:"https://"+this.url;networkUtils.openUrl(t)}catch(e){throw CScript.Error(`Invalid URL - ${this.url}`)}},route_navigate:async function(){let e={...Lyte.deepCopyObject(t[this.page]),page:this.page};if(!e.route)throw CScript.Error(`unsupported page - ${e.page}`);const i={...this.params};let r;if(i.module){if(r=store.peekAll("module").find((e=>e.api_name===i.module)),!r)throw CScript.Error(`no such module present - ${i.module}`);r=(await store.findRecord("module",r.id))[0],i.module=r.module_name}if(i.layout_id){let t=await Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions({Module:i.module}),r=t&&t.find((e=>e.value===i.layout_id));if(!r||!r.value)throw CScript.Error(`no such layout present for ${i.module} module - ${i.layout_id}`);e.queryParams={layoutId:r.value}}if("tab"===e.page){if(moduleRecordMapping[i.module].web_link)return void CrmWidgets.Utils.lyteTransitTo(i.module,this.data,e.route,this.target);e={...Lyte.deepCopyObject(t.record_list),page:"record_list"}}if(i.custom_view_id||"record_list"===e.page){if(i.custom_view_id&&!await store.findRecord("custom_view",i.custom_view_id,{module:r.api_name}))throw CScript.Error(`no such custom view present - ${i.custom_view_id}`);i.custom_view_id=i.custom_view_id||r.default_view.id}if(e.dynamicParams)for(const[t,r]of e.dynamicParams.entries()){if(!i[r])throw CScript.Error(`mandatory param missing: ${r}`);e.dynamicParams[t]=i[r]}if("_blank"===this.target&&i.custom_data){let t=i.layout_id?{layoutId:i.layout_id}:void 0;openNewTab(Lyte.Router.getURL(e),"widgets","get",t,!0)}else{if("_blank"===this.target)return void networkUtils.openUrl(Lyte.Router.getURL(e),"_blank");{const t=Lyte.Router.getRouteInstance().transition;(t.data||(t.data={})).skipDirtyCheck=!0;const i=Lyte.Router.getRouteInstance().transition.info;("record_detail"===e.page&&"crm.tab.module.entity.detail"===i.route||e.route===i.route)&&i.dynamicParams.every(((t,i)=>t===e.dynamicParams[i]))&&(e.queryParams&&i.queryParams.layoutId===e.queryParams.layoutId||!e.queryParams)?Lyte.Router.getRouteInstance().refresh():Lyte.Router.transitionTo(e)}}Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions().find((e=>e.name===i.module||e.value===i.module))&&(_cscript._global_custom_data={...i.custom_data})}}}(),CruxHandler=(Lyte.addEventListener("CruxFrameListener",(function(e){app.isMenuless&&frameElement&&window.parent&&window.origin===window.parent.origin&&window.parent.postMessage({msgType:"CruxFrame",actionDetails:e})})),window.addEventListener("message",(e=>{if(e.origin===window.origin&&e.data.msgType&&"CruxFrame"===e.data.msgType&&["edit","clone","create"].includes(e.data.actionDetails.currentPage))if("cancel"===e.data.actionDetails.buttonAction)AppHandler.close_widget(e.source.frameElement.attributes._type.value,!0);else if("save"===e.data.actionDetails.buttonAction||"saveAndNew"===e.data.actionDetails.buttonAction){var t={records:[{id:e.data.actionDetails.saveResponse.id,$approval_state:e.data.actionDetails.saveResponse.$approval_state}]};AppHandler.close_widget(e.source.frameElement.attributes._type.value,!1,t,!0)}}),!1),{getFrameURL:function(e,t,i){return window.location.protocol+"//"+window.location.host+function(t){var r={},a=Crm.getCrmBasePath(),n={menuless:!0};Object.assign(n,t.queryParams||{});try{var o=i||t.module;switch(e){case"record_create":r.route="crm.tab.module.create",r.dynamicParams=[o],t.canvas_id&&(r.route="crm.tab.module.create.canvas",r.dynamicParams.push(t.canvas_id)),r.queryParams=n,a=Lyte.Router.getURL(r);break;case"record_edit":case"record_clone":r.route="record_edit"===e?"crm.tab.module.entity.edit":"crm.tab.module.entity.clone",r.dynamicParams=[o,t.record_id],t.canvas_id&&(r.route="record_edit"===e?"crm.tab.module.entity.edit.canvas":"crm.tab.module.entity.clone.canvas",r.dynamicParams.push(t.canvas_id)),r.queryParams=n,a=Lyte.Router.getURL(r);break;case"record_detail":r.route="crm.tab.module.entity.detail",r.dynamicParams=[o,t.record_id],t.canvas_id&&(r.route="crm.tab.module.entity.canvas",r.dynamicParams.push(t.canvas_id)),r.queryParams=n,a=Lyte.Router.getURL(r)}}catch(e){a=""}return a}(t)}}),UIHandler=function(){var e={Screen:{Freeze:function(){var e=$L("body > .cscript-freezelayer");if(!e.length){var t=document.createElement("div");t.classList.add("cscript-freezelayer"),t.classList.add("dNImp"),$L("body").append(t),e=$L(t)}e.removeClass("dNImp")},UnFreeze:function(){$L("body > .cscript-freezelayer").addClass("dNImp")}},Message:{Toast:function(e,t){["info","error","warning","success"].includes(e)?crmui.showMsgBandWithMarkdown(e,$L.markdown(t||""),4e3):crmui.showMsgBandWithMarkdown("info",$L.markdown(t||""),4e3)},clearAlertElement:async function(){var t=await e.Message.getAlertElement();t&&t.component.executeMethod("hide")},getAlertElement:function(){const e=$L("crm-cscript-alert");return e.length?e[0]:new Promise((async e=>{await Lyte.injectResources([networkUtils.returnDependencyFiles(["cscript/crm-cscript-alert.css"],ResourceConstants.CRMClient)[0],networkUtils.returnDependencyFiles(["cscript/crm-cscript-alert.js"],ResourceConstants.CRMClient)[0]]),Lyte.Component.render("crm-cscript-alert",{},"body"),e($L("crm-cscript-alert")[0])}))},Confirm:function(t){const{message:i,accept_message:r,reject_message:a}=t;return new Promise((async function(t){(await e.Message.getAlertElement()).component.executeMethod("showConfirm",$L.markdown(i||"",{image:{class:"cs-alertImageLoading",onload:"javascript: UIHandler.removeLoadingIcon();",onerror:"javascript: UIHandler.removeLoadingIcon();"}}).innerHTML,r,a,t)}))},Alert:function(t){const{message:i,heading:r,accept_message:a}=t;return new Promise((async function(t){(await e.Message.getAlertElement()).component.executeMethod("showAlert",$L.markdown(i||"",{image:{class:"cs-alertImageLoading",onload:"javascript: UIHandler.removeLoadingIcon();",onerror:"javascript: UIHandler.removeLoadingIcon();"}}).innerHTML,r,a,t)}))},Input:function(t){const{options:i,heading:r,accept_message:a,reject_message:n}=t;return new Promise((async function(t){(await e.Message.getAlertElement()).component.executeMethod("getInput",i,r,a,n,t)}))},ConfirmUI:function(e){return new Promise((function(t){var i={val:e.reject_message||I18n.getMsg("crm.button.cancel"),fn:function(){t(!1)}},r={val:e.accept_message||I18n.getMsg("crm.yes.proceed"),fn:function(){t(!0)}};renderingUtils.showCustomConfirmMessageNewModel($ESAPI.encoder().encodeForHTML(e.message),r,i)}))},ShowLoader:async function(t){if(await Lyte.injectResources([networkUtils.returnDependencyFiles(["cscript-loader/crm-cscript-loader.css","crm-ui-loaders.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),networkUtils.returnDependencyFiles(["cscript/crm-cscript-loader.js","crm-ui-loaders.js"],ResourceConstants.CRMClient)]),e.Message.HideLoader(),"standard"!==t.template){let e;"dot-spinner"===t.template?t.selector=e="#show":e=t&&t.selector||"body",Lyte.Component.render("crm-cscript-loader",t,e),$("body").addClass("oH")}else _cscript._is_loader_present=!0,commonUtils.showHideLoadingDiv(!0)},HideLoader:function(){if($("body").removeClass("oH"),_cscript._is_initial_loader_present)UIHandler.hide_initial_loader();else{var e=$L("crm-cscript-loader")[0];e&&e.component&&e.component.removeElement(),_cscript._is_loader_present&&(commonUtils.showHideLoadingDiv(!1),delete _cscript._is_loader_present)}},AlertUI:function(e){return new Promise((function(t){renderingUtils.showCustomAlert($ESAPI.encoder().encodeForHTML(e.message),void 0,void 0,(function(){t()}))}))}},Page:{Info:function(){const e=Lyte.Router.getRouteInstance().transition.info.route;if("crm.tab.reports.view"===e){var t=$(".report_name");return{report_name:t.length>0?t.text():""}}return"crm.tab.module.create"===e?{module:store.peekAll("module").filter((function(e){return e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]}))[0].api_name}:"crm.tab.module.entity.edit"===e||"crm.tab.module.entity.detail"===e?{module:store.peekAll("module").filter((function(e){return e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]}))[0].api_name,id:Lyte.Router.getRouteInstance().transition.info.dynamicParams[1]}:{}},Record:function(){return store.peekRecord(moduleRecordMapping[Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]].id,Lyte.Router.getRouteInstance().transition.info.dynamicParams[1])}}};return{freeze:function(){e.Screen.Freeze()},unfreeze:function(){e.Screen.UnFreeze()},page_info:function(){return e.Page.Info()},get_record:function(){return e.Page.Record()},msg_band:function(){Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("message band"),e.Message.Toast(this.type,this.message)},confirm:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("message confirmation"),e.Message.Confirm(this)},alert:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("messsage alert"),e.Message.Alert(this)},get_input:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].isLoaderPresent("getinput"),e.Message.Input(this)},clearAlert:function(){return e.Message.clearAlertElement()},show_loader:async function(){return e.Message.ShowLoader(this)},hide_loader:function(){return e.Message.HideLoader()},show_initial_loader:function(){try{if(!Crm.userDetails.CSCRIPT_PRELOAD||_cscript._is_initial_loader_present)return;_cscript._is_initial_loader_present=!0,$L("body").addClass("oH");return $("#show").append('<div id="initialLoaderCScript" class="cs_initial_loading"> <div class="cs_initial_loader_alignCenter"> <span class="cs_initial_loader_gif"></span> </div> </div>'),void $(".dummy_Body").hide()}catch(e){murphy.error(e)}},hide_initial_loader:function(){try{if(!Crm.userDetails.CSCRIPT_PRELOAD||!_cscript._is_initial_loader_present)return;return $("#initialLoaderCScript").remove(),$L("body").removeClass("oH"),void(_cscript._is_initial_loader_present&&delete _cscript._is_initial_loader_present)}catch(e){murphy.error(e)}},removeLoadingIcon:function(){$L(".cs-alertImageLoading").removeClass("cs-alertImageLoading")}}}();CScript.Engine.Global={Init:async function(e){try{if(window.Worker)if(CScript.Utils.Murphy.log(CScript.LOGGER.EXECUTION,CScript.Utils.Murphy.log_init_details),_cscript._globalEngine._init_uuid=_cscript._globalEngine._init_uuid||Math.floor(1e7+9e7*Math.random()),!_cscript._globalEngine._isOnInit&&Lyte.Router.getRouteInstance()){clearTimeout(this.callEngineInit),_cscript._globalEngine._isOnInit=!0,!_cscript._globalEngine._init&&await CScript.Boot(_cscript._globalEngine,!1,!0);var t=Lyte.Router.getRouteInstance().transition,i=app._cscript_registry._definitions[t.target];if(i&&(i.forEach((async function(e){if(e.enabled()){let o={$route:t.data.isWizardDraft?"crm.tab.module.create":e.route_name,definition_name:t.data.isWizardDraft?"module_wizard_create":e.unique_name};for(selector of e.selectors){var i=selector.key.split(":"),r=i[0],a=i[1],n=i[2];switch(r){case"$dynamicParam":o["$"+selector.name]=Lyte.Router.getRouteInstance(a).transition.info.dynamicParams[n];break;case"$queryParam":o["$"+selector.name]=t.info.queryParams[a];break;case"$transitionData":o["$"+selector.name]=t.data[a];break;case"$layoutId":const e=moduleRecordMapping[t.info.dynamicParams[0]].id,i=store.peekRecord(e,t.info.dynamicParams[1]);i.$layout_id?o["$"+selector.name]=i.$layout_id.id:i.Layout?o["$"+selector.name]=i.Layout.id:o["$"+selector.name]=store.peekRecord("module",e).layouts[0].id}}CScript.DefinitionPicker(o,e)}})),_cscript._definition)){CScript.UI.Show(),_cscript._handlers=(_cscript._definition.handlers||[]).concat(_cscript._default_handlers);const t=_cscript._info;if(_cscript._is_preview_frame&&!_cscript._is_preview_engine_loaded)return _cscript._is_preview_engine_loaded=!0,_cscript._globalEngine._isOnInit=!1,void CScript.Preview.dispatchLoad("engine_load");if(_cscript._is_preview_frame&&_cscript._preview&&t||t&&!_cscript._is_preview_frame||_cscript._is_preview_page){var r;if(e?!e.is_restart&&UIHandler.show_initial_loader():UIHandler.show_initial_loader(),t)try{var a=await fetch(t.consolidated_code_url);r=await a.json(),_cscript._is_preview_page&&(r=Object.assign(r,_cscript._preview.snippet),_cscript._preview.sorted_snippets.forEach(((e,t)=>{r[e].precedence=t+1})))}catch(e){throw murphy.error(e),_cscript._globalEngine._state.fetch_error=e.message,new Error("Failed to fetch")}else r=_cscript._preview.snippet;_cscript._dependent_apis||(await Promise.all([store.findAll("trusted_domains"),store.findAll("static_resources")]),_cscript._dependent_apis=!0),await _cscript._globalEngine._engine.onStart((function(){if(this.loadVariables("trusted_domains",store.peekAll("trusted_domains").filter((function(e){return e.active})).map((function(e){return e.url}))),_cscript._is_preview_page||t&&t.static_resources&&t.static_resources.length>0){var e=(_cscript._is_preview_page&&_cscript._preview.static_resources||t.static_resources).map((function(e){return e.id})),i={};for(x of(store.peekAll("static_resources").map((function(t){e.includes(t.id)&&(i[t.id]=t.compiled_file_uri)})),e))this.importScripts(i[x])}else murphy.error(new Error("issue with cscript info/static resource")),CScript.Utils.Murphy.log(CScript.LOGGER.DEFAULT,CScript.Utils.Murphy.log_state_info,"issue with cscript info/static resource");this.loadScripts(r),_cscript._is_preview_frame&&CScript.Preview.dispatchLoad("preview_load",!0)})).start();try{for([snippet_uuid,record]of Object.entries(r)){Object.keys(record).forEach((e=>{"content"!==e&&(_cscript._snippet_uuid_vs_event_map[snippet_uuid]||(_cscript._snippet_uuid_vs_event_map[snippet_uuid]={}),_cscript._snippet_uuid_vs_event_map[snippet_uuid][e]=record[e])}))}}catch(e){murphy.error(e)}return}}}else Lyte.Router.getRouteInstance()||(this.callEngineInit=setTimeout((async function(){await CScript.Engine.Global.Init()}),3e3));else _cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:"Scripting is not supported in your browser.",ltPropDuration:"4000"}})}catch(e){murphy.error(e),CScript.Utils.Murphy.log(CScript.LOGGER.DEFAULT,CScript.Utils.Murphy.log_state_info,e.message)}finally{_cscript._globalEngine._isOnInit=!1}},Destroy:function(){CScript.Engine.Global.Flush(),UIHandler.unfreeze(),CScript.UI.Hide();var e=$L("crm-cscript")[0];if(void 0!==e&&e.component){const i=e.component;var t=i.getData("flyout");t.id&&t.close_on_exit&&AppHandler.close_widget("CScriptFlyout",!1,void 0),i.getData("callout").id&&AppHandler.close_widget("CScriptCallout",!0,void 0)}_cscript._navigation_data=null,UIHandler.hide_loader()},Restart:async function(){CScript.Engine.Global.Flush(),await CScript.Engine.Global.Init({is_restart:!0}),CScript.Utils.Murphy.log(CScript.LOGGER.EXECUTION,CScript.Utils.Murphy.log_init_details)},Flush:function(){_cscript._globalEngine._engine&&(_cscript._globalEngine._engine.terminateNow(),_cscript._globalEngine._engine.flushListeners("started"),_cscript._is_preview_frame&&window.parent.document.dispatchEvent(new CustomEvent("CSCRIPT_PREVIEW",{detail:{type:"execution_terminated"}}))),_cscript._definition=void 0,_cscript._handlers=_cscript._default_handlers,delete _cscript._wP,_cscript._info=void 0,_cscript._ehc_counter=15,_cscript._snippet_uuid_vs_event_map={},_cscript._globalEngine._init_uuid=null,_cscript._globalEngine._state={}},dispatchEvent:function(...e){CScript.Utils.Murphy.log(CScript.LOGGER.EXECUTION,CScript.Utils.Murphy.log_execution_triggers,e),_cscript._global_custom_data&&(_cscript._navigation_data=_cscript._global_custom_data,_cscript._global_custom_data=null),_cscript._globalEngine._state.is_engine_warm=CScript.isEngineWarm(_cscript._globalEngine._engine),_cscript._globalEngine._state.is_engine_warm&&_cscript._globalEngine._engine.dispatchEvent({intercept:!1},e)},dispatchIEvent:async function(...e){return CScript.Utils.Murphy.log(CScript.LOGGER.EXECUTION,CScript.Utils.Murphy.log_execution_triggers,e),_cscript._globalEngine._state.is_engine_warm=CScript.isEngineWarm(_cscript._globalEngine._engine),!_cscript._globalEngine._state.is_engine_warm||!_cscript._info&&!_cscript._preview||_cscript._globalEngine._engine.dispatchEvent({intercept:!0},e)},dispatchForcedEvent:function(...e){return CScript.Utils.Murphy.log(CScript.LOGGER.EXECUTION,CScript.Utils.Murphy.log_execution_triggers,e),_cscript._globalEngine._engine&&_cscript._globalEngine._engine.dispatchEvent({intercept:!1},e)},TrackerHandler:function(e){if(e.value){let t=e.value.snippet_id&&_cscript._snippet_uuid_vs_event_map[e.value.snippet_id];const i={status:e.value.status,event:t&&t.event,type:t&&t.event_type,page:_cscript._definition&&_cscript._definition.unique_name,speed:e.value.speed};t&&t.namespace&&(i.namespace=t.namespace.slice(-2)%50),Crm.client_tracking("cscript_execution_snippets_stat",i),Crm.trackSpotLightAction(e.value.feature_name,e.value)}}};
