Lyte.Component.register("crm-zdesk-rl-label",{_template:'<template tag-name="crm-zdesk-rl-label"> <table width="100%" cellspacing="0" cellpadding="0" class="relCenterBg"> <tbody> <tr height="25"> <td> <span class="dF aiCenter"> <span name="supportpersonality_{{related_list_id}}" id="supportpersonality_{{related_list_id}}" class="relListHead">{{display_label}}</span> <template is="if" value="{{expHandlers(expHandlers(type,\'==\',&quot;CANVAS&quot;),\'&amp;&amp;\',expHandlers(Crm.userDetails.isRLCountSupportedForCanvas,\'===\',true))}}"><template case="true"> <span id="RL_dataCount_{{related_list_id}}" data-zcqa="zDRLCount"></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(type,\'==\',&quot;CANVAS&quot;),\'&amp;&amp;\',expHandlers(rlCount,\'!==\',&quot;0&quot;))}}"><template case="true"> <span class="zdeskRLCount" data-zcqa="zDRLCount">{{rlCount}}</span> </template></template></template></template> <template is="if" value="{{fromDetailLyte}}"><template case="true"> <template is="if" value="{{refreshIconShow}}"><template case="true"> <div class="cP mL8 {{if(refreshIconLoadingShow,\' tb_small_loader vmiddle ref_loading\',\' tb_small_loader vmiddle ref_complete\')}}{{if(refreshIconDisable,\' eventNone\',\'\')}}" id="deskRefresh" onclick="{{action(\'reload\')}}"> <span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span> </div> </template></template> </template><template case="false"> <div class="dIB pL10"> <template is="if" value="{{refreshIconShow}}"><template case="true"> <div class="{{if(refreshIconLoadingShow,\' tb_small_loader vaM ref_loading\',\' tb_small_loader vaM ref_complete\')}}{{if(refreshIconDisable,\' op5 eventNone\',\'\')}}" id="deskRefresh" onclick="{{action(\'reload\')}}"> <span class="ld_init"></span> <span class="ld_process"></span> </div> </template></template> </div> </template></template> </span> </td> </tr> </tbody> </table> </template>',_dynamicNodes:[{type:"attr",position:[1,1,1,1,1,1]},{type:"text",position:[1,1,1,1,1,1,0]},{type:"attr",position:[1,1,1,1,1,3]},{type:"if",position:[1,1,1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,1,1,1,5]},{type:"if",position:[1,1,1,1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}],_observedAttributes:["module","entity_id","related_list_id","display_label","refreshIconLoadingShow","refreshIconDisable","refreshIconShow","rlCount","type","fromDetailLyte"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),display_label:Lyte.attr("string"),refreshIconLoadingShow:Lyte.attr("boolean",{default:!1}),refreshIconDisable:Lyte.attr("boolean",{default:!1}),refreshIconShow:Lyte.attr("boolean",{default:!1}),rlCount:Lyte.attr("string",{default:"0"}),type:Lyte.attr("string"),fromDetailLyte:Lyte.attr("boolean",{default:Crm.userDetails.isRelatedListLyteEnabled})}},actions:{reload:function(){var t=document.querySelector("crm-zdesk-rl-body").component,e=this,a=t.getData("module"),s=t.getData("entityId"),i=t.getData("datePattern");if(Crm.trackSpotLightAction("ZDesk - Ticket Refresh"),i){this.setData("refreshIconLoadingShow",!0);var o=t.getCurrentTicketType(a),l={pageToken:0,ticketType:o,module:a,moduleId:s,deskstats:!0,action:"refreshData"},r=t.getKeyValueForTicketCriteria();validationUtils.isEmpty(r)?this.setData("refreshIconLoadingShow",!1):(l[r.key]=r.value,store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:t.getData("url_desk"),method:"POST"},l).then((function(a){var s=a.dummy;if(validationUtils.isNotEmpty(s)){t.actions.clearSelect.call(t),t.initializeData(),t.updateDetailsForRL(s.SupportObj);var i=t.getData("ticketsStatsLinkShow"),l=t.getData("deskTicketsSummaryShow"),r=t.getData("ticketStatsLinkText"),n=t.getData("totalTickets");if(s.hasOwnProperty("ticketPotentials")&&t.setData("ticketPotentials",s.ticketPotentials),s.hasOwnProperty("ticketStats")&&null!==s.ticketStats)if("Products"===t.getData("module")){var d=s.ticketStats.encryptedProductId;t.setData("desk_encryptedProductId",d)}else t.setData("ticketStats",s.ticketStats),t.summarizeTickets(s,!0,l,n,i,r);commonUtils.showHideLoadingDiv(),t.setData("data",s.tickets),t.setData("ticketKeys",s.ticketKeys),t.setData("ticketHeadings",s.ticketHeadings),t.setData("ticketFields",s.ticketFields),null!==document.querySelector("#ticketFilterSelect")&&document.querySelector("#ticketFilterSelect").ltProp("selected",o),t.setData("rowCountVis",s.tickets?s.tickets.length:0),s.hasOwnProperty("page")&&t.executeMethod("setLyteNavigatorValues",s)}commonUtils.showHideLoadingDiv(),e.setData("refreshIconDisable",!0),e.setData("refreshIconLoadingShow",!1)})))}}},methods:{}});
