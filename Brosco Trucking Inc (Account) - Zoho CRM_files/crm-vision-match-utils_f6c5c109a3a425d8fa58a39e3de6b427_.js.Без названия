Lyte.Mixin.register("crm-vision-match-utils",{setcriteriaTextPatternForMatch:function(e){var t=$L("crm-ziavision-trainingdetails-criteria")[0].component,a=t.getData("match_pattern_holder_array"),i=t.getData("is_desired_selected_in_ui")?"matched":"not matched";if(t.setData("match_criteria_pattern_text_array",[]),1===a.length)n();else if(2===a.length)n(),l();else if(a.length>2){n(),l();for(var r=a.length,s=3;s<=r;s++)d(s-1)}function n(){var e=a[0].criteriaIndex+" is "+i;Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"insertAt",0,e),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"push",")"),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"unshift","(")}function l(){var e=a[1].criteriaIndex+" is "+i;Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"insertAt",2,"or"),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"insertAt",3,e)}function d(e){var r=a[e].criteriaIndex+" is "+i;Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"push","or"),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"push",r),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"push",")"),Lyte.arrayUtils(t.getData("match_criteria_pattern_text_array"),"unshift","(")}a.length>0&&this.setTrainDataForMatch(e)},updateLabelNameChangeForMatch:function(e,t){var a=$L("crm-ziavision-creationpage");if(e-=1,a[0].component.getData("is_edit_page")){var i=a[0].component.$node.getData("visions"),r=$L("crm-ziavision-trainingdetails-criteria"),s=$L(".vision_training_criteria_header_img"),n=r[0].component.data.is_desired_selected_in_ui,l=s.length;if(l>0)for(var d=0;d<l;d++)if(e===d){var _=s[d].component.data,o=_.label_id,c=_.files_arr,h=c?c.length:0,m=i.desired_set,p=i.undesired_set;if(n&&m&&m.labels&&m.labels.length>0)for(var g=(u=m.labels).length,y=0;y<g;y++){if(o===(v=u[y]).id){if((L={}).id=o,L.name=t,h>0)for(var f=0;f<h;f++)if(c[f].file_id){L.model_tags=c;break}v=L,u[y]=v,m.labels=u,i.$.set("desired_set",null),i.$.set("desired_set",m),i.$.isModified=!0;break}}else if(p&&p.labels&&p.labels.length>0){var u;for(g=(u=p.labels).length,y=0;y<g;y++){var v;if(o===(v=u[y]).id){var L;if((L={}).id=o,L.name=t,h>0)for(f=0;f<h;f++)if(c[f].file_id){L.model_tags=c;break}v=L,u[y]=v,p.labels=u,i.$.set("undesired_set",null),i.$.set("undesired_set",p),i.$.isModified=!0;break}}}}}},setTrainDataForMatch:function(e){e||(e=!1);var t=[],a=[],i=$L(".vision_training_criteria_header_img"),r=i.length,s=$L("crm-ziavision-creationpage"),n=$L("crm-ziavision-trainingdetails-criteria"),l=n[0].component.data.is_desired_selected_on_pageload,d=n[0].component.data.is_undesired_selected_on_pageload,_=s[0].component.getData("is_edit_page"),o=[],c=[],h=_&&e,m=n[0].component.data.is_desired_selected_in_ui,p=s[0].component.data.visions;if(l&&n[0].component.data.is_undesired_selected_in_ui)o=p.existingDesired_set;if(d&&n[0].component.data.is_desired_selected_in_ui)c=p.existingUnDesired_set;var g=o.length,y=c.length;if(r>0){for(var f=0;f<r;f++){var u=i[f].component.data,v=[],L=[],b=u.is_desired_selected_in_ui,D=u.files_arr,U=D.length;if(U>0){for(var x=0;x<U;x++){var $=!1;if(D[x].file_id||D[x].isDelete)if(D[x].isDelete&&(D[x]._delete=null,delete D[x].is_zip_added_in_edit_page,$=!0),D[x].hasOwnProperty("isDelete")&&(delete D[x].is_zip_added_in_edit_page,D[x].hasOwnProperty("isDelete")||delete D[x].isDelete),h)if($){if(g>0)for(var M=0;M<g;M++)D[x].type!==o[M].type&&D[x].type!==o[M].source_type||v.push(D[x]);if(y>0)for(M=0;M<y;M++)D[x].type!==c[M].type&&D[x].type!==c[M].source_type||L.push(D[x])}else m?v.push(D[x]):L.push(D[x]);else{var z=!1,I=!1;if(!D[x].file_id){if(g>0)for(M=0;M<g;M++)D[x].type!==o[M].type&&D[x].type!==o[M].source_type||(v.push(D[x]),z=!0);if(y>0)for(M=0;M<y;M++)D[x].type!==c[M].type&&D[x].type!==c[M].source_type||(L.push(D[x]),I=!0)}z||I||(b&&m?v.push(D[x]):L.push(D[x]))}else e&&0===v.length&&0===L.length&&(l?L.push(D[x]):v.push(D[x]))}var A;if(v.length>0)if(v.length>0)(A={}).name=u.label_name,u.label_id&&(A.id=u.label_id),_&&u.api_name&&u.api_name.trim().length>0&&(A.api_name=u.api_name),A.model_tags=v,t.push(A);else this.isLabelNameChanged(A)&&t.push(A);if(L.length>0)if(L.length>0)(A={}).name=u.label_name,u.label_id&&(A.id=u.label_id),_&&u.api_name&&u.api_name.trim().length>0&&(A.api_name=u.api_name),A.model_tags=L,a.push(A);else this.isLabelNameChanged(A)&&a.push(A)}}var T=n[0].component.data.removed_image_validation_label_details;t=Lyte.registeredMixins["crm-vision-match-utils"].processRemovedLabelDet(t,T),a=Lyte.registeredMixins["crm-vision-match-utils"].processRemovedLabelDet(a,T);var k=s[0].component.$node.getData("visions"),F={},P={};e&&0===t.length&&0===a.length||(k.$.set("undesired_set",null),k.$.set("desired_set",null),t.length>0&&(F.labels=t,k.$.set("desired_set",F)),a.length>0&&(P.labels=a,k.$.set("undesired_set",P)))}},isLabelNameChanged:function(e){var t=$L("crm-ziavision-creationpage")[0].component.data.visions,a=t.desired_set?t.desired_set.labels?t.desired_set.labels:t.undesired_set&&t.undesired_set.labels?t.undesired_set.labels:void 0:void 0;if(a)for(var i=a.length,r=0;r<i;r++){var s=a[r];if(e.id===s.id&&e.name!==s.name)return!0}},processRemovedLabelDet:function(e,t){if(t&&t.length>0)for(var a=t.length,i=0;i<a;i++)if(t[i].isDelete){var r={};r.id=t[i].labelId,r._delete=null,e.push(r)}return e},delIncriteriaArrayForMatch(e,t,a){var i,r=$L("crm-ziavision-trainingdetails-criteria")[0].component,s=r.data.match_pattern_holder_array,n=s.length;if(0===e.data.files_arr.length||0===t)for(var l=0;l<n;l++){if(s[l].criteriaIndex===e.getData("label_index")){Lyte.arrayUtils(r.getData("match_pattern_holder_array"),"removeAt",l,1),i=l,"label"===a&&d();break}if(s[l].criteriaIndex>e.getData("label_index")){i=l,d();break}}function d(){for(var e=s.length,t=i;t<e;t++){var a=s[l];a.criteriaIndex=a.criteriaIndex-1,Lyte.arrayUtils(r.getData("match_pattern_holder_array"),"replaceAt",t,a)}}},labelsToTextPatternMatch(e,t){var a=e.length,i=[],r=t?"matched":"not matched";if(1===a)n();else if(2===a)n(),l();else if(a>2){n(),l();for(var s=3;s<=a;s++)d(s-1)}function n(){var t;t="matched"===r?I18n.getMsg("crm.zia.vision.is.matched",e[0].name):I18n.getMsg("crm.zia.vision.is.not.matched",e[0].name),Lyte.arrayUtils(i,"insertAt",0,t),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}function l(){var t;t="matched"===r?I18n.getMsg("crm.zia.vision.is.matched",e[1].name):I18n.getMsg("crm.zia.vision.is.not.matched",e[1].name),Lyte.arrayUtils(i,"insertAt",2,"or"),Lyte.arrayUtils(i,"insertAt",3,t)}function d(t){var a;a="matched"===r?I18n.getMsg("crm.zia.vision.is.matched",e[t].name):I18n.getMsg("crm.zia.vision.is.not.matched",e[t].name),Lyte.arrayUtils(i,"push","or"),Lyte.arrayUtils(i,"push",a),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}return i},labelsToTextPatternMatchForEdit(e,t){var a=e.length,i=[],r=t?"matched":"not matched";if(1===a)n();else if(2===a)n(),l();else if(a>2){n(),l();for(var s=3;s<=a;s++)d(s-1)}function n(){var t=e[0].api_name.match(/\d+/).toString()+" is "+r;Lyte.arrayUtils(i,"insertAt",0,t),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}function l(){var t=e[1].api_name.match(/\d+/).toString()+" is "+r;Lyte.arrayUtils(i,"insertAt",2,"or"),Lyte.arrayUtils(i,"insertAt",3,t)}function d(t){var a=e[t].api_name.match(/\d+/).toString()+" is "+r;Lyte.arrayUtils(i,"push","or"),Lyte.arrayUtils(i,"push",a),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}return i}});
