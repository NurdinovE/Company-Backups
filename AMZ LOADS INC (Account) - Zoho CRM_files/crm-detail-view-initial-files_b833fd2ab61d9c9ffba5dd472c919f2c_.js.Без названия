Lyte.Mixin.register("crm-detailview-common-utils",{blueprintFldId:void 0,visitFldColumn:["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"],view_unsupported_columns:["UNSUBSCRIBEDMODE","UNSUBSCRIBEDTIME","CONSENTID","LASTENRICHEDTIME","ENRICHMENT_STATUS","QUALIFICATIONDURATION","LASTACTIVITYTIME","MODIFIEDTIME","CREATEDTIME","SALESDURATION","SHAREDTO","DEALDURATION","S_MODIFIEDTIME","SENDNOTIFICATION","BEST_TIME","SE_STATUS","RESCHEDULEDTIME","CANCELLEDTIME"],showLock_supported_fields:{Appointments:["SERVICEID","APPOINTMENTDATEANDTIME","APPOINTMENTDURATION","APPOINTMENTADDRESS","RESCHEDULECOUNT","RESCHEDULEDFROM","RESCHEDULEDTO"],Campaigns:["PARENT_CAMPAIGNID"],Tasks:["CLOSEDTIME"]},ajaxEdit_unsupported_fields:{Leads:["LASTNAME"],Contacts:["LASTNAME"],Appointments:["APPOINTMENTNAME","APPOINTMENTLOCATION","SMOWNERID","SEID"],Calls:["CONTACTID","SEID","CALLSTARTDATETIME","CALLDURATION","REMINDAT"],Events:["CONTACTID","SEID","ALLDAYEVENT","STARTDATETIME","ENDDATETIME","REMINDINVITEESAT","REMINDAT","MEETING_VENUE","MEETING_PROVIDER","CHECKINCREATEDTIME"]},detailview_unsupported_fields:{Tasks:["SENDNOTIFICATION"],Appointments:["ENDTIME","REMINDER","APPOINTMENTSTATUS","JOBSHEETSECTION","ISJOBSHEETCREATED"],Services:["MXNDUMMYCOLUMN_SERVICE","JOBSHEETSECTION"],Calls:["CALLDURATIONINSEC","SYSTEMCF2"],Events:["PARTICIPANTID","RECURRING","CHECKINOWNERID","CHECKINCOMMENT","CHECKINSTREET","CHECKINCITY","CHECKINSTATE","CHECKINCOUNTRY","CHECKINLATITUDE","CHECKINLONGITUDE","CHECKINZIPCODE","CHECKINADDRESS","CHECKINSTATUS"]},customize_bc_unsupported_modules:["Calls","Events"],rightPanelFields:{Leads:["COMPANY","PHONE","MOBILE","EMAIL"],Contacts:["ACCOUNTID","PHONE","MOBILE","EMAIL"]},rightPanelFieldsIcons:{COMPANY:"company-colored",ACCOUNTID:"company-colored",PHONE:"phone-green-filled",MOBILE:"call-blue-filled",EMAIL:"mail-envolope"},show_empty_supported_fieldtypes:["rollup_summary","formula"],rightPanelSupportedModules:["Tasks","Events","Calls"],open_activity_personality:["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"],rp_personality_vs_details:{TASKSPERSONALITY:{sort_col:"Due_Date",sort_ord:"asc"},EVENTSPERSONALITY:{sort_col:"Start_DateTime",sort_ord:"asc"},CALLSPERSONALITY:{sort_col:"Call_Start_Time",sort_ord:"asc"},APPOINTMENTSPERSONALITY:{sort_col:"Appointment_Start_Time",sort_ord:"asc"},CASESPERSONALITY:{sort_col:"Modified_Time",sort_ord:"desc"}},rp_deal_summary_fields:["POTENTIALNAME","STAGE","AMOUNT","CLOSINGDATE","CURRENCYISOCODE","EXCHANGERATE","PROBABILITY"],approved_constants:["approved","merge_pending","approval_process_pending","approval_process_rejected","review_process_pending","review_process_rejected"],zia_unsupported_modules:["Visits","Forecasts"],best_time_unsupported_status:["zia_vision_pending","zia_vision_rejected","zia_vision_validation"],modulesWithRelModules:{Accounts:["Contacts","Potentials"],Leads:["Tasks","Products"],Contacts:["Potentials","Tasks","Products"],Potentials:["Contacts","Tasks","Products"],Products:["Vendors","Potentials"],PurchaseOrders:["Vendors","Tasks"],Vendors:["Contacts","Products","Tasks","PurchaseOrders"],Quotes:["Accounts","Contacts","Potentials","Tasks"],Cases:["Contacts","Tasks"],SalesOrders:["Accounts","Contacts","Potentials","Tasks"],Invoices:["Accounts","Contacts","Tasks"]},canvasUnSupportedModules:Crm.userDetails.isCanvasActivitySupportEnabled?["Visits","Activities","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"]:["Visits","Activities","Tasks","Events","Calls","Services__s","Appointments__s","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"],integrations_customfields:{Campaigns:["Native__Survey__Extn__Survey_Department","Native__Survey__Extn__Survey_Type","Native__Survey__Extn__Survey","Native__Survey__Extn__Survey_URL","Native__Survey__Extn__Department_ID","Native__Backstage__Extn__Event_Name","Native__Backstage__Extn__Event_Start_Date","Native__Backstage__Extn__Event_Language","Native__Backstage__Extn__Brand","Native__Backstage__Extn__Event_Location","Native__Backstage__Extn__Event_Category","Native__Backstage__Extn__Event_End_Date","Native__Backstage__Extn__Backstage_Portal","Native__Backstage__Extn__Event_Type","Native__Webinar__Extn__Webinar_Launch_URL","Native__Webinar__Extn__Webinar_Registration_URL"]},initiateModelRequests:function(e,t,a,i,o,s,r){var n=store.peekRecord(moduleRecordMapping[a].id,i);if("Messages"===a)return e=store.peekRecord("module",moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()].id);var l=store.peekRecord("module",moduleRecordMapping[a].id),d=l.api_name,c=null;c=n.$layout_id?n.$layout_id.id:n.Layout?n.Layout.id:l.layouts[0].id,e||(e={});var u=t&&-1!==t.indexOf("all_components");if(u&&!s&&(e.record_with_meta_info=store.findRecord(moduleRecordMapping[a].id,i,Crm.get_params_for_getRecord()).then((function(e){return e[0]?e:void this.renderPermissionDenied(i,a)}),(function(){renderingUtils.displayPermissionDenied()}))),this.actions_api_neededModule(a)&&(u||!t||-1!==t.indexOf("record_actions"))&&!r&&(e.detailview_buttons=store.triggerAction("entity","available_actions",{module:d,entityId:i})),(!t||-1!==t.indexOf("layout_meta")||-1!==t.indexOf("business_card"))&&(e.layout_response=this.initiateLayoutRequestForRecord(n,l,c)),(!t||-1!==t.indexOf("related_list"))&&!a.includes("Orchestration")&&!a.includes("PathFinder")){let t={apiVersion:5};t.record=store.peekRecord(moduleRecordMapping[a].id,i),e.related_list=app.store.makeRequest("findAll","related_list",{module:d,layout_id:c},!1,!0,t)}if(moduleRecordMapping[a]&&d&&!store.peekRecord("features-status",d)&&["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&!Crm.userDetails.isSandbox&&!["Visits","Forecasts"].includes(d)&&(e.zia_features_config=store.findAll("features-status",{module:d,group:"zia",page:1,per_page:20},!0)),(u||!t||-1!==t.indexOf("ziavision"))&&featuresAvailable.hasOwnProperty("ZiaVision")&&featuresAvailable.ZiaVision&&!r){var p=Lyte.registeredMixins["zia-insights-utils"],_={keys:"vision_data"};e.zia_features_config?e.zia_insights=e.zia_features_config.then((()=>p.getInsights(moduleRecordMapping[a],i,_,null,"zia_vision"))):e.zia_insights=p.getInsights(moduleRecordMapping[a],i,_,null,"zia_vision")}if(!(t&&-1===t.indexOf("custom_buttons")||"Calls"===a||"Services"===a||"Appointments"===a||"Activities"===a||a.startsWith("Orchestration")||a.startsWith("PathFinder")||r)){const t=Lyte.registeredMixins["crm-view-utils"];store.clearCachedQuery("custom_button",{module:d}),e.custom_buttons=new Promise((e=>{store.findAll("custom_button",{module:d,fields:"id,name,description,profiles,layouts,action,sequence_number,position,user_types"},!0,void 0,{apiVersion:6}).then((i=>{const o={position:"view",layoutId:c,moduleName:a};e(t.filterButtonData(i,o))})).catch((()=>e([])))}))}var m=(!t||-1!==t.indexOf("layout_rule"))&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(a));if(m){if(m=!1,Crm.userDetails.LR_updated_mods&&Crm.userDetails.LR_updated_mods.contains(a))m=!0,Crm.userDetails.LR_updated_mods.splice(Crm.userDetails.LR_updated_mods.indexOf(a),1);else{var f=store.peekAll("layout_rule"),v=[];f&&f.forEach((function(e){e.layout&&e.layout.id===c&&v.push(e)})),e.layoutRule={layout_rule:v},0===v.length&&(m=!0)}m&&(e.layoutRule=store.findAll("layout_rule",{module:d},!1,!1,c))}var h=(!t||-1!==t.indexOf("validation_rule"))&&(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(a));if(h){if(h=!1,Crm.userDetails.VR_updated_mods&&Crm.userDetails.VR_updated_mods.contains(a))h=!0,Crm.userDetails.VR_updated_mods.splice(Crm.userDetails.VR_updated_mods.indexOf(a),1);else{f=store.peekAll("validation_rule");var g=[];f&&f.forEach((function(e){e.layout&&e.layout.id===c&&g.push(e)})),e.validationRule=g,0===g.length&&(h=!0)}h&&(e.validationRule=store.findAll("validation_rule",{layout_id:c,module:d,download_rules:!0},!1).then((function(e){return e}),(function(){return[]})))}var y=!!n&&n.$process_flow,E=!!n&&(n.$locked_for_me&&!n.$editable);!((u||!t||-1!==t.indexOf("blueprint_exec_info"))&&n.$process_flow)||E||s||(e.blueprint_exec_info=n.$.triggerAction("blueprint").then((function(e){return e}),function(e){var t=JSON.parse(e.response);t&&t.code&&"INVALID_DATA"===t.code&&t.message&&"the id given seems to be invalid"===t.message&&"Leads"===d&&(Lyte.Router.transitionTo({route:"crm.tab.module.entity.convert",dynamicParams:[a,i]}).data={fromSrc:"blueprint"})}.bind(this))),E&&y&&(e.blueprint_exec_info=store.findAll("dummy",{features:"Blueprints"},!1,!1,{url:"/crm/v6/"+d+"/"+i+"/actions/get_feature_specific_info",method:"GET"}).then((function(e){return{blueprint:e.data[0].feature_info[0].details}}))),moduleRecordMapping.LockingInformation&&(u||!t||-1!==t.indexOf("locking_configuration"))&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES&&Crm.userDetails.LOCKING_CONFIG_SUPPORTED_MODULES.contains(a)&&(e.locking_configuration=store.findAll("record_locking_configurations",{module:d},!0),n.Locked__s&&(e.lockedRecordDetails=store.findAll("dummy",void 0,!1,!1,{url:"/crm/v2.2/"+d+"/"+i+"/Locking_Information__s",method:"GET"}).then((function(e){var t=networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.js"],ResourceConstants.CRMClient);return t=t.concat(networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(t),e}),(function(){})),e.lockingInfoFields=store.findAll("field",{module:moduleRecordMapping.LockingInformation.api_name},!0,!0,{apiVersion:"2.2"}))),e.ziaOwnerRecommendationEnabled=!1,"assigned_by_zia"===n.$zia_owner_assignment&&(u||!t||-1!==t.indexOf("zia_owner_recommendation"))&&Crm.isZiaOwnerRecommendationEnabled&&(e.ziaOwnerRecommendationEnabled=store.findAll("owner_suggestion_configuration",{module:moduleRecordMapping[a].api_name},!1,!0).then((function(e){return e&&e[0].enabled&&e[0].enabled_for_current_user}),(function(){return!1})));var C=!1;n.$stop_processing||void 0===n.$approval_state||("review_process_pending"!==n.$approval_state||Crm.userDetails.CLIENT_ACCOUNT)&&"review_process_rejected"!==n.$approval_state||(C=!0,e.review_process_data=store.triggerAction("entity","review",{module:d,entityId:i}).then((function(e){return e}),(function(){}))),n.$stop_processing||void 0===n.$approval_state||"approval_process_pending"!==n.$approval_state&&"approval_process_rejected"!==n.$approval_state||!1!==C||(e.approval_process_data=store.triggerAction("entity","approval_details",{module:d,name:a,entityId:i}).then((function(e){return e}),(function(){})),"Record rejected successfully"!==o&&"approval_process_rejected"!==n.$approval_state||(e.timeline_info=store.triggerAction("entity","timelines",{module:d,entityId:i,isFromApprovalProcess:!0},{per_page:1,filters:{field:{api_name:"source"},comparator:"in",value:["approval_process"]}}).then((function(e){return e}))));var b=store.peekRecord("features","detailview_customization");return!(b&&b.moduleApiName===d||this.canvasUnSupportedModules.indexOf(d)>-1||l.module_name.includes("Orchestration")||l.module_name.includes("PathFinder"))&&!r&&(e.detailview_customization=store.findAll("features",{module:d,api_names:"detailview_customization"})),n.hasOwnProperty("Email")&&"Cases"!==d&&!r&&(e.blocked_info=store.findAll("dummy",{features:"blocked_emails"},!1,!1,{url:"/crm/v6/"+d+"/"+i+"/actions/get_feature_specific_info",method:"GET"}).then((e=>e),(()=>null))),e.unsubscribed_emails_info=this.getRecordUnsubscribedEmailsData(n,l),Lyte.resolvePromises(e)},getRecordUnsubscribedEmailsData:function(e,t){let a=[];return(["Leads","Contacts","Vendors"].indexOf(t.module_name)>-1||t.module_name.startsWith("CustomModule"))&&(t.fields.each((function(t){"email"===t.data_type&&e[t.api_name]&&(a=e[t.api_name])})),a.length>0)?store.findAll("dummy",{features:"unsubscribed_emails"},!1,!1,{url:"/crm/v6/"+t.api_name+"/"+e.id+"/actions/get_feature_specific_info",method:"GET"}).then((function(e){return e.data&&e.data.length&&e.data[0].features_info&&e.data[0].features_info&&e.data[0].features_info[0].details&&e.data[0].features_info[0].details&&e.data[0].features_info[0].details.length?e.data[0].features_info[0].details:null}),(function(){return null})):null},actions_api_neededModule:function(e){return!e.startsWith("Orchestration")&&!e.startsWith("PathFinder")},initiateLayoutRequestForRecord:function(e,t,a,i){var o={moduleSet:!0,peekField:!1,setLayFldPropForNormalSecAlone:!0};return a?o.layoutId=a:e.Layout?o.layoutId=e.Layout.id:e.Layout||(o.layoutId=t.layouts[0].id),i&&(i.layoutId=o.layoutId),store.findRecord("module",t.id,{},void 0,!0,o)},initiate_related_record:function(e,t,a,i,o,s,r,n,l){var d={relatedId:e.id,relationId:t.id,per_page:a,page:i};Object.assign(d,Crm.get_params_for_getRecord()),d.approved="both",d.approval_state=s,delete d.converted,l&&(d.sort_by=l,r&&(d.sort_order=r)),o.rp_personality_vs_details&&o.rp_personality_vs_details[t.personality_name]&&(d.sort_order=r||o.rp_personality_vs_details[t.personality_name].sort_ord,d.sort_by=o.rp_personality_vs_details[t.personality_name].sort_col),store.model[t.module.id]||store.registerModel(t.module.id,{},{extends:"entity"});var c={};return n&&(c.filters=n),app.store.makeRequest("findAll",t.module.id,d,void 0,!0,c)},triggerRequest:function(e){switch(e.case){case"activity_rel_module":for(var t=this.getData("request_information")?this.getData("request_information"):{},a={},i=this.data.right_panel_info.rp_records,o=i.length,s=0;s<o;s++){var r=i[s];if("Projects"!==r.record_module){var n=r.record_module,l=moduleRecordMapping[n].id;store.model[l]||store.registerModel(l,{},{extends:"entity"}),t[l]||moduleRecordMapping[n]&&moduleRecordMapping[n].fields&&0!==moduleRecordMapping[n].fields.length&&moduleRecordMapping[n].layouts&&0!==moduleRecordMapping[n].layouts.length||(t[l]=store.findRecord("module",l,void 0,void 0,void 0,{allowMultiple:!0}).then((function(e){return e}),(function(){}))),t[r.id]||(t[r.id]=store.findRecord(l,r.id,Crm.get_params_for_getRecord()).then((function(e){return e}),(function(){}))),a[l]=t[l],a[r.id]=t[r.id]}}this.setData("request_information",t),e.requestObj=a,Lyte.resolvePromises(t).then(function(t){this.setData("request_information",t),e.callBackFunc&&e.callBackFunc(t)}.bind(this));break;case"activity_rel_module_layout":var d=e.record,c=(n=e.module,l=moduleRecordMapping[n].id,store.peekRecord("module",l)),u=this.getData("request_information_layout");if(!u){var p=this,_={moduleSet:!0,peekField:!1,setLayFldPropForNormalSecAlone:!0,allowMultiple:!0};d.Layout?_.layoutId=d.Layout.id:d.Layout||(_.layoutId=c.layouts[0].id),u=store.findRecord("module",c.id,{},void 0,!0,_).then((function(e){return p.setData("request_information_layout",void 0),e})),this.setData("request_information_layout",u)}e.requests.layoutReq=u}},set_view_port_time:function(e,t){if(Lyte.Component.viewPortSettings&&t){var a=Object.keys(e.meta_info.fieldColumnNameMap);Lyte.Component.viewPortSettings.debounce=a>200?100:a>100?50:0}},reloadForCampaign:function(){var e=document.querySelector("crm-campaign-analytics");e&&e.setData({reInit:!e.getData("reInit"),isLoading:!0});var t=document.querySelector("crm-backstage-detail-charts");t&&t.setData({reloadRevenueChart:!t.getData("reloadRevenueChart")});var a=document.querySelector("crm-zcampaign-create-progress-info");a&&!document.querySelector("crm-zcampaign-detailview-component").getData("skipReload")&&a.setData({reLoad:!a.getData("reLoad")})},loadRelatedRecords:function(e,t,a,i,o){"Campaigns"===t&&i&&this.reloadForCampaign(),e.modulesWithRelModules[t]&&!Crm.userDetails.CLIENT_ACCOUNT&&$("#newRelDetails").length>0&&new Promise((function(o){o(e.requestForRelatedRecords(t,a,i))})).then((function(s){s=s.dummy?s.dummy:s;var r=$L("crm-detailview-related-record"),n=$L("#newRelDetails");if(o&&i&&r[0]){var l=r[0].component.getData("relatedRecord"),d=l.findIndex((e=>e.module===i));d>=0?s.length>0?Lyte.arrayUtils(l,"replaceAt",d,s[0]):Lyte.arrayUtils(l,"removeAt",d,1):Lyte.arrayUtils(l,"push",s[0]),0===l.length?n.addClass("dN"):n.removeClass("dN")}else s&&s.length>0&&e.downloadRelatedRecordsJSFiles((function(){Lyte.Component.render("crm-detailview-related-record",{relatedRecord:s,entityId:a,module:t},"#newRelDetails"),n.removeClass("dN")}))}))},requestForRelatedRecords:function(e,t,a){var i={action:"getRelatedDetails"};return i.module=e,i.entityId=t,a&&(i.relModule=a),store.findAll("dummy",i,!1,!1,{url:Crm.getCrmBasePath()+"/EntityCustomization.do",method:"POST"})},downloadRelatedRecordsJSFiles:function(e){var t=networkUtils.returnDependencyFiles(["crm-detailview-related-record.js"],ResourceConstants.CRMClient);return t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-detailview-related-record.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles(["crm_finance_suite.js"],ResourceConstants.CRM)),Lyte.injectResources(t,void 0,e)},allowNavigation:function(e,t){if("undefined"!=typeof crmNavig&&crmNavig)if(e){var a=e.cvid&&"null"!==e.cvid?e.cvid:t;if(a=e.stageId?a+"#"+e.stageId:a,(i=crmNavig[a])&&i.recordId&&i.recordId.length>0)return!0}else{var i;a="null"!==businessCardJson.hidden.cvid?businessCardJson.hidden.cvid:detailView.currentModule;if(a=businessCardJson.hidden.stageId?a+"#"+businessCardJson.hidden.stageId:a,(i=crmNavig[a])&&i.recordId&&i.recordId.length>0)return!0}return!1},renderPermissionDenied:function(e,t){Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-permission-error.js","crm-recyclebin-revamp-models.js"],ResourceConstants.CRMClient),void 0,(function(){Crm.userDetails.CLIENT_ACCOUNT?($L("#show").empty(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName,isEntityPresence:1},"#show")):app.store.makeRequest("findRecord","recycle_bin",e,void 0,void 0,void 0,{version:"v6"}).then((function(e){var a=-1;e&&e[0]&&(a=(e=e[0]).module.id===moduleRecordMapping[t].id?0:-1),$L("#show").empty(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName,isEntityPresence:a},"#show")}))}))},checkAndOpenLocateMap:function(e,t,a,i){var o=!0;Crm.baiduAvailable&&"true"===Crm.baiduAvailable&&Crm.baiduUrl||(o=!1);for(var s="",r=this.getMapInputFields(a,i),n=r.length,l=0;l<n;l++)s=s+" "+this.getFieldValueForMapUrl(e,t[r[l]]);""!==s.trim()?(s=encodeURIComponent(s),findMap(s,o?"Baidu":"")):_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropDuration:"3000",ltPropMessage:I18n.getMsg("crm.field.address.empty.check")}})},getMapInputFields:function(e,t){var a="true"===Crm.baiduAvailable;switch(e){case"Leads":return a?["LANE","CITY","STATE","COUNTRY"]:["LANE","CITY","STATE","CODE","COUNTRY"];case"Vendors":return a?["STREET","CITY","STATE","COUNTRY"]:["STREET","CITY","STATE","CODE","COUNTRY"];case"Contacts":if("mailing_address"===t)return a?["MAILINGCOUNTRY","MAILINGSTATE",,"MAILINGCITY","MAILINGSTREET"]:["MAILINGSTREET","MAILINGCITY","MAILINGSTATE","MAILINGZIP","MAILINGCOUNTRY"];if("other_address"===t)return a?["OTHERCOUNTRY","OTHERSTATE","OTHERCITY","OTHERSTREET"]:["OTHERSTREET","OTHERCITY","OTHERSTATE","OTHERZIP","OTHERCOUNTRY"];break;case"Accounts":case"Quotes":case"Invoices":case"SalesOrders":case"PurchaseOrders":if("billing_address"===t)return a?["BILLINGCOUNTRY","BILLINGSTATE","BILLINGCITY","BILLINGSTREET"]:["BILLINGSTREET","BILLINGCITY","BILLINGSTATE","BILLINGCODE","BILLINGCOUNTRY"];if("shipping_address"===t)return a?["SHIPPINGCOUNTRY","SHIPPINGSTATE","SHIPPINGCITY","SHIPPINGSTREET"]:["SHIPPINGSTREET","SHIPPINGCITY","SHIPPINGSTATE","SHIPPINGCODE","SHIPPINGCOUNTRY"]}},getAddressOptions:function(e){if("Contacts"===e){var t=[],a={};a.name=I18n.getMsg("crm.label.mailingaddress"),a.api_name="mailing_address",t.push(a);var i={};return i.name=I18n.getMsg("crm.label.otheraddress"),i.api_name="other_address",t.push(i),t}if("Accounts"===e||Crm.isInventoryModule(e)){t=[];var o={};o.name=I18n.getMsg("crm.label.billing.address"),o.api_name="billing_address",t.push(o);var s={};return s.name=I18n.getMsg("crm.label.shipping.address"),s.api_name="shipping_address",t.push(s),t}},getFieldValueForMapUrl:function(e,t){return t&&e[t[1]]?e[t[1]]:""},reloadCurrentEntityView:function(){var e=$L("crm-detail-view")[0].component.data.unique_listener_id;Lyte.triggerEvent("detail_view_listener_"+e,{componentsToBeReloaded:["all_components"]})},refreshComponents:function(e,t){var a=this.getData("module"),i=this.getData("layoutId");if(e.layout_response){var o=e.layout_response[0].layouts.filter((function(e){return e.id===i}));this.setData({layout:o[0],layout_response:e.layout_response})}for(var s=Crm.userDetails.isSubformNewComponentEnabled?document.querySelectorAll("crux-subform"):void 0,r=t.length,n=$L("crm-rl-share-email"),l=document.querySelector("crm-detailview-tag"),d=0;d<r;d++)switch(t[d]){case"all_components":this.setData("zia_insights",e.zia_insights);var c=store.peekRecord(moduleRecordMapping[this.getData("module")].id,this.getData("entityId")),u={};u.layout=this.getData("layout"),u.layoutId=i,u.record=c,u.module=a,u.header_model={},u.locking_configuration=e.locking_configuration,u.lockedRecordDetails=e.lockedRecordDetails,u.lockingInfoFields=e.lockingInfoFields,u.review_process_data=e.review_process_data,u.approval_process_data=e.approval_process_data,u.timeline_info=e.timeline_info,u.detailview_buttons=e.detailview_buttons,u.cscript_properties=this.getData("cscript_properties"),this.parseBusinessCardFields(u,a),this.parseContentJson(u);var p={};if(p.record=c,p.record_changed=!0,p.business_card_section=u.business_card_section,p.content_json=u.content_json,p.header_model=u.header_model,this.setData(p),Lyte.triggerEvent("detail_view_rules_execution_listener_"+this.getData("unique_listener_id"),{features:["layout_rule"]}),this.setData({locking_configuration:u.locking_configuration,lockedRecordDetails:u.lockedRecordDetails,review_process_data:u.review_process_data,approval_process_data:u.approval_process_data}),"Activities"===Crm.activityGrp[a]&&(this.formRightPanelData(u,a),this.setData("show_right_panel",u.show_right_panel),u.show_right_panel)){var _={};_.right_panel_info=u.right_panel_info,this.setData(_)}this.reApplyCsriptProps(),Lyte.triggerEvent("refreshTimelineInteractions");break;case"record_actions":c=this.getData("record");e.record=c,e.module=a,this.parseRecordActions(e,a),this.setData("detailview_buttons",e.detailview_buttons);break;case"data_privacy":Lyte.objectUtils(this.getData("dataPrivacyReloadflag"),"add","reloadNeeded",!0);break;case"related_list":this.setData("related_list",e.related_list),Lyte.triggerEvent("relatedList",{refresh:!0});break;case"approval_process_exec_info":this.refreshApprovalProcessComponent(this.getData("fresh_record"),a,e.review_process_data);case"blueprint_exec_info":this.reloadBlueprintComponents(e.blueprint_exec_info);break;case"bp_updated_tags":if(l){var m=Lyte.Router.getRouteInstance().currentModel.record.Tag,f=l.component.data.displaytags.length;Lyte.arrayUtils(l.component.data.displaytags,"splice",0,f,m)}break;case"business_card":c=store.peekRecord(moduleRecordMapping[this.getData("module")].id,this.getData("entityId"));var v={};v.layout=this.getData("layout"),v.layoutId=i,v.record=c,v.module=a,v.header_model={},v.cscript_properties=this.getData("cscript_properties");var h=this.getData("content_json.show_info");this.parseBusinessCardFields(v,a),this.parseContentJson(v),this.setData("business_card_section",v.business_card_section);var g=objectUtils.cloneObject(h);g.show_business_card=v.content_json.show_info.show_business_card,this.setData("content_json.show_info",g);break;case"wmsFieldUpdate":var y=this.getData("wmsUpdatedFieldValues"),E=y.updatedValuesMap,C=y.updatedOriginalValuesMap;if(0!==Object.keys(E).length){var b=this.getData("entityId"),L=moduleRecordMapping[this.getData("module")].id;c=store.peekRecord(L,b);e.updatedValuesMap.id=b;var I={};if(I=E,void 0!==C&&0!==Object.keys(C).length&&(I._$={},I._$.original=C),store.pushPayload(moduleRecordMapping[this.getData("module")].id,I),y.updatedValuesMap={},y.updatedOriginalValuesMap={},this.setData({wmsUpdatedFieldValues:y,record:store.peekRecord(L,b),record_changed:!0}),Crm.userDetails.isSubformNewComponentEnabled&&moduleRecordMapping[this.getData("module")]&&moduleRecordMapping[this.getData("module")].fields){var D=[],R=y.highlightFields&&y.highlightFields.fieldsHLMap?y.highlightFields.fieldsHLMap:[];moduleRecordMapping[this.getData("module")].fields.forEach((function(e){e.subform&&500!==e.ui_type&&-1!==R.indexOf(e.id)&&D.push(e.api_name)})),D.length>0&&s.forEach((function(e){e.highlightAggregateField(D)}))}}break;case"emails_rl":var T=this.getData("content_json")?this.getData("content_json").recordLockingDetails:void 0;n.length>0&&n[0].component.setData("isSendMailRestricted",!!(T&&T.isLockedForMe&&T.restricted_communications&&T.restricted_communications.contains("send_mail")))}},cscript_action_details:function(e){e.event&&"field"===e.event&&this.handleCScriptFieldEvents(e)},handleCScriptFieldEvents:function(e){var t=e.promise?e.promise:void 0;try{switch(e.type){case"set_criteria":if(e.field&&e.config){const t=this.getData("cscript_properties"),{...a}=e.config;this.setData(`cscript_properties.${e.field}`,{...t[e.field]&&{...t[e.field]},...a})}break;case"masking":if(e.field&&e.config){this.setPropertyForMasking(e);var a=this.data.content_json.meta_info.fieldvsEditType;Lyte.objectUtils(a,"add",e.field,"showEmpty")}break;case"get_value":e.field&&this.getFieldViewValue(e.field,e.valueObj);break;case"max_length":e.field&&e.config&&this.handleFieldPropertyForCsript(e,"length",void 0);break;case"read_only":if(e.field&&e.config){this.handleFieldPropertyForCsript(e,"read_only",(function(e,t){var a=e.handleMouseActions(t,e.getData("record"),e.getData("module"),e.getData("layoutId"),e.getData("content_json.recordLockingDetails"));Lyte.objectUtils(e.getData("content_json.meta_info.fieldvsEditType"),"add",t.api_name,a)}))}break;case"add_tooltip":e.field&&e.config&&this.handleCsriptToolTip(e);break;case"add_info_icon":if(e.field&&e.config){var i={name:e.config.type,value:e.config.value};e.config.value=i,this.handleFieldPropertyForCsript(e,"tooltip",void 0)}break;case"show_hide":if(e.field&&e.config){var o=this.getData("cscript_properties"),s=o[e.field]?objectUtils.cloneObject_new(o[e.field]):{};s.visible=e.config.value,this.setData("cscript_properties."+e.field,s)}}t&&t.resolve()}catch(e){t&&t.reject(e)}},reApplyCsriptProps:function(){this.data.field_apiname_map||this.populateFldApiNameMap(this.data.layout,this);var e=this.getData("cscript_properties");if(e)for(var t=Object.keys(e),a=t.length,i=0;i<a;i++)if(e[t[i]]&&e[t[i]].style){var o=store.peekRecord("field",this.data.field_apiname_map[t[i]]),s=$L("#ajaxEdit_"+o.column_name);s&&s.css(e[t[i]].style)}},handleCsriptToolTip:function(e){this.data.field_apiname_map||this.populateFldApiNameMap(this.data.layout,this);var t=this.getData("cscript_properties"),a=t[e.field]?objectUtils.cloneObject_new(t[e.field]):{};a.value_tooltip=e.config.value,this.setData("cscript_properties."+e.field,a);var i=this.getData("content_json.meta_info.fieldVsTooltip");Lyte.objectUtils(i,"add",this.data.field_apiname_map[e.field],e.config.value)},handleCsriptPropertyChange:function(e,t){var a=e?e.path:void 0;if(a&&t){var i=this.getData("sectionFieldsArray");if(i||(i=[],t.detailviewColumns.forEach((function(e){e.forEach((function(e){i.push(e.api_name)}))})),this.setData("sectionFieldsArray",i)),i.indexOf(a)>-1){var o=this.getData("cscriptPropertiesObserver");o=!o,this.setData("cscriptPropertiesObserver",o)}}},getFieldViewValue:function(e,t){this.data.field_apiname_map||this.populateFldApiNameMap(this.data.layout,this);const a=store.peekRecord("field",this.data.field_apiname_map[e]);if(a&&![CrmField.UITYPES.FILE_UPLOAD,CrmField.UITYPES.IMAGE_UPLOAD].includes(a.ui_type)){const i=this.getData("record")[e];t.value=DetailViewHandler.Utils.serialize_field(i,a.data_type,void 0,void 0,a)}},setPropertyForMasking:function(e){var t=this.getData("cscript_properties"),a=t[e.field]?objectUtils.cloneObject_new(t[e.field]):{},i={};i.character=e.config.character,i.length=e.config.length,i.reverse=e.config.reverse,a.masking_info=i,this.setData("cscript_properties."+e.field,a)},handleFieldPropertyForCsript:function(e,t,a){var i=this.getData("cscript_properties"),o=i[e.field]?objectUtils.cloneObject_new(i[e.field]):{};o[t]=e.config.value;var s=this.getData("old_meta_properties"),r=s[e.field]?objectUtils.cloneObject_new(s[e.field]):{},n=this.getData("content_json.viewable_sections");this.updateFieldProperty(n,t,e,r,this,a),n=[this.getData("business_card_section")],this.updateFieldProperty(n,t,e,r,this,a),this.setData("cscript_properties."+e.field,o)},updateFieldProperty:function(e,t,a,i,o,s){e.forEach((function(e){e.detailviewColumns&&e.detailviewColumns.forEach((function(e){e&&e.forEach((function(e){e.api_name===a.field&&(void 0===i[t]&&(i[t]=e[t],o.setData("old_meta_properties."+a.field,i)),Lyte.objectUtils(e,"add",t,a.config.value),s&&s(o,e))}))}))}))},handleMouseActions:function(e,t,a,i,o){var s=this.showEditIcon(t,a),r="ownerlookup"===e.data_type?t.$locked_for_me&&o&&o.restricted_actions&&o.restricted_actions.contains("change_owner"):!t.$editable&&o&&o.isLockedForMe&&!(o.fieldIds&&o.fieldIds.contains(e.id)),n="approval_process_pending"===t.$approval_state,l=["showEmpty","showEdit","showLock"];if(void 0!==this.blueprintFldId&&e.id===this.blueprintFldId)return l[2];if(this.show_empty_supported_fieldtypes.contains(e.data_type))return l[0];if(s){if("Stage"!==e.api_name&&e[i]&&e[i].pick_list_values&&e[i].pick_list_values[0].maps.length>0)return l[0];if(this.integrations_customfields[a]&&this.integrations_customfields[a].contains(e.api_name))return l[2];if(e.read_only&&("Closing_Date"===e.api_name&&"Potentials"===a||"Reporting_To"===e.api_name&&"Contacts"===a))return l[2];if("Contacts"===a&&"Reporting_To"===e.api_name&&!t.Account_Name)return l[0];if("Calls"===a&&"Voice_Recording__s"===e.api_name&&t.$telephony_call)return l[2];if(("Territories"===e.api_name||"Territory"===e.api_name)&&parseInt(e.ui_type)===CrmField.UITYPES.TERRITORY)return r?l[0]:l[1];if(t&&t.$approved||!t.$approved&&"Owner"===e.api_name||"approval_process_rejected"===t.$approval_state||"Services"===a||"Appointments"===a)return"Layout"===e.api_name&&"Rejected"===t.$review?l[0]:("Layout"===e.api_name&&(d=this.layoutEditPermissionCheck(a,t)),"Layout"===e.api_name&&!d||-1!==this.visitFldColumn.indexOf(e.column_name)||this.blueprintFldId&&this.blueprintFldId===e.id||e.read_only||"Expected_Revenue"===e.api_name&&"Potentials"===a||"Handler"===e.api_name||"Layout"===e.api_name&&t.$process_flow||"ownerlookup"===e.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+a]?l[2]:r?l[0]:l[1])}else{var d;if("Layout"===e.api_name&&(d=this.layoutEditPermissionCheck(a,t)),("Territories"===e.api_name||"Territory"===e.api_name)&&parseInt(e.ui_type)===CrmField.UITYPES.TERRITORY)return l[0];if("Layout"===e.api_name&&!d||-1!==this.visitFldColumn.indexOf(e.column_name)||this.blueprintFldId&&this.blueprintFldId===e.id||e.read_only||"Expected_Revenue"===e.api_name&&"Potentials"===a||"Handler"===e.api_name||"Layout"===e.api_name&&t.$process_flow||"ownerlookup"===e.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+a])return l[2];if(t&&"read_only"===t.$sharing_permission)return l[2];if("ownerlookup"===e.data_type){if(t.$stop_processing)return l[0];if("read_only"===t.$sharing_permission)return l[2];if(r)return l[0];if(Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+a])return l[1]}if(r)return l[0];if(n)return l[2]}},showEditIcon:function(e,t){return!!store.peekRecord("module",moduleRecordMapping[t].id).editable&&("crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.info.route&&((!e||"Review in Progress"!==e.$review&&"Pending for Review"!==e.$review&&"Pending for ReReview"!==e.$review)&&(!(e.$stop_processing||!e.$editable&&!e.$locked_for_me)&&(!!Crm.userDetails.permissions["Crm_Implied_Edit_"+t]&&(!e||"read_only"!==e.$sharing_permission)))))},layoutEditPermissionCheck:function(e,t){if("approved"!==t.$approval_state&&"approval_process_rejected"!==t.$approval_state)return!1;if("Campaigns"===e&&t.Layout&&["Zoho Webinar","Zoho Survey","Zoho Campaigns","Zoho Backstage"].indexOf(t.Layout.name)>-1)return!1;var a=moduleRecordMapping[e].layouts.filter((function(e){return"Standard"!==e.name}));if(t.Layout&&"Standard"!==t.Layout.name)return!0;for(var i=a.filter((function(e){return e.status>=0||"active"===e.status})),o=i.length,s=0,r=0;r<o;r++)i[r].profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length>0&&s++;return s>0},execute_layoutRules:function(e,t,a){var i=t.rules_execution_result.lr_exec_result;this.LRfieldvsShowType={},this.LRfieldvsMandate={},this.LRsectionvsShowType={},this.LRsubformvsShowType={},this.LRfieldvsShowTypePassed={};var o=t.layout,s=t.layout_rule&&t.layout_rule.layout_rule?t.layout_rule.layout_rule:[],r=t.layoutId,n=this,l={view_type:"view"};l.layoutMeta=t.layout,s.length>0&&s.forEach((function(t){if((t.layout.id?t.layout.id:t.layout)===r){var i=o.fields.filter((function(e){return e.id===t.primary_field.id}))[0];i&&i.visible&&(i.view_type.edit||"default"===t.generated_type&&i.view_type.view)&&n.handleOneLayoutRule(a,t.queries,e,l)}})),i.LRfieldvsShowType=this.LRfieldvsShowType,i.LRfieldvsMandate=this.LRfieldvsMandate,i.LRsectionvsShowType=this.LRsectionvsShowType,i.LRsubformvsShowType=this.LRsubformvsShowType},handleOneLayoutRule:function(e,t,a,i){var o=[];if(t)for(var s=t.length,r=0;r<s;r++){var n=t[r];n.actions&&n.actions.length>0&&o.push(n.actions),this.handleOneLayoutRuleQuery(e,n,a,i)}},handleOneLayoutRuleQuery:function(e,t,a,i){var o=t.criteria;if(t.actions&&t.actions.length){var s=e.checkCriteriaMatch(o,a,void 0,void 0,e,i);void 0===s&&(s=!1),this.triggerLayoutRuleActions(e,t,a,s,i)}},triggerLayoutRuleActions:function(e,t,a,i,o){if(t.actions)for(var s=t.actions.slice().reverse(),r=s.length,n=0;n<r;n++){var l=s[n];switch(l.type){case"Mandatory_Fields":case"Show_Fields":if(l.fields)for(var d=l.fields.length,c=0;c<d;c++){var u=l.fields[c];this.handleLayoutRuleActions(l.type,l,u,a,e,i,o)}break;case"Show_Sections":if(l.sections){var p=l.sections.length;for(c=0;c<p;c++){var _=l.sections[c];this.handleLayoutRuleActions(l.type,l,_,a,e,i,o)}}break;case"Show_Subforms":if(l.subforms){var m=l.subforms.length;for(c=0;c<m;c++){_=l.subforms[c];this.handleLayoutRuleActions(l.type,l,_,a,e,i,o)}}}}},handleLayoutRuleActions:function(e,t,a,i,o,s,r){var n,l=r.layoutMeta;if(l=l.sections,"Show_Sections"===t.type){var d=l.filter((function(e){if(e.type&&"used"===e.type)return e.name===a}));n=d[0]}else"Show_Subforms"===t.type?l.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){e.api_name===a&&(n=e)}))})):l.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){if(e.id===a.id)return n=e,e}))}));if(n){var c=n;switch(e){case"Mandatory_Fields":if("First_Name"===n.api_name&&("Leads"===n.module[0].api_name||"Contacts"===n.module[0].api_name))break;c.id!==this.blueprintFldId&&n.visible&&(s?this.LRfieldvsMandate[c.api_name]="true":this.LRfieldvsMandate[c.api_name]&&"true"===this.LRfieldvsMandate[c.api_name]||(this.LRfieldvsMandate[c.api_name]="false"));break;case"Show_Fields":if("First_Name"===n.api_name&&("Leads"===n.module[0].api_name||"Contacts"===n.module[0].api_name))break;var u="show"===this.LRfieldvsShowType[c.api_name],p="hide"===this.LRfieldvsShowType[c.api_name],_=Lyte.registeredMixins["crm-detailview-parser"].getSectionNameWithoutSpace(n.section[0].api_name),m="hide"===this.LRsectionvsShowType[_];!s||this.LRfieldvsShowTypePassed[c.api_name]&&"yes"===this.LRfieldvsShowTypePassed[c.api_name]?s||"yes"===this.LRfieldvsShowTypePassed[c.api_name]||(this.LRfieldvsShowTypePassed[c.api_name]="no"):this.LRfieldvsShowTypePassed[c.api_name]="yes",m&&(s=!1),u||p?!s||u||m||this.suffleLRfields(c,!0):this.LRfieldvsShowType[c.api_name]=s?"show":"hide";break;case"Show_Sections":_=Lyte.registeredMixins["crm-detailview-parser"].getSectionNameWithoutSpace(c.api_name);var f="show"===this.LRsectionvsShowType[_],v="hide"===this.LRsectionvsShowType[_],h=this;f||v?s&&!f&&this.suffleLRsections(_,!0,c):(this.LRsectionvsShowType[_]=s?"show":"hide",c.fields.forEach((function(e){var t="no"!==h.LRfieldvsShowTypePassed[e.api_name];h.LRfieldvsShowType[e.api_name]=s&&t?"show":"hide"})));break;case"Show_Subforms":var g=Lyte.registeredMixins["crm-detailview-parser"].getSectionNameWithoutSpace(c.api_name),y="show"===this.LRsubformvsShowType[g],E="hide"===this.LRsubformvsShowType[g];y||E?s&&!y&&this.suffleLRsubforms(g,!0):this.LRsubformvsShowType[g]=s?"show":"hide"}}},suffleLRfields:function(e,t){var a="show"===this.LRfieldvsShowType[e.api_name],i="hide"===this.LRfieldvsShowType[e.api_name];t?(a||(this.LRfieldvsShowType[e.api_name]="show"),i&&(this.LRfieldvsShowType[e.api_name]="show")):(i||(this.LRfieldvsShowType[e.api_name]="hide"),a&&(this.LRfieldvsShowType[e.api_name]="hide"))},suffleLRsubforms:function(e,t){var a="show"===this.LRsubformvsShowType[e],i="hide"===this.LRsubformvsShowType[e];t?(a||(this.LRsubformvsShowType[e]="show"),i&&(this.LRsubformvsShowType[e]="show")):(i||(this.LRsubformvsShowType[e]="hide"),a&&(this.LRsubformvsShowType[e]="hide"))},suffleLRsections:function(e,t,a){var i="show"===this.LRsectionvsShowType[e],o="hide"===this.LRsectionvsShowType[e];if(t?(i||(this.LRsectionvsShowType[e]="show"),o&&(this.LRsectionvsShowType[e]="show")):(o||(this.LRsectionvsShowType[e]="hide"),i&&(this.LRsectionvsShowType[e]="hide")),a){var s=this;a.fields.forEach((function(e){if(s.LRfieldvsShowTypePassed[e.api_name]||o){var a="no"!==s.LRfieldvsShowTypePassed[e.api_name];s.LRfieldvsShowType[e.api_name]=t&&a?"show":"hide"}}))}},isViewableField:function(e,t,a){if("Leads"===t||"Contacts"===t){if("LASTNAME"===e.column_name)return!0;if("FULLNAME"===e.column_name)return!1}return-1===this.view_unsupported_columns.indexOf(e.column_name)&&(!!(e.column_name.startsWith("SYSEXTERNAL")&&e.virtual_field&&e.visible&&e.view_type&&!1===e.view_type.view)||!(e.view_type&&!1===e.view_type.view||!e.visible||this.detailview_unsupported_fields[t]&&this.detailview_unsupported_fields[t].contains(e.column_name))&&(e.ui_type!==CrmField.UITYPES.TAGS&&!("Calls"===t&&["CALLERIDOUTBOUND","CALLTHROUGHINBOUND"].includes(e.column_name)&&!a[e.api_name])))},isAjaxEditableField:function(e,t,a){var i,o=(i="string"==typeof e?store.peekRecord("field",e):e).column_name;if(this.ajaxEdit_unsupported_fields[t]&&this.ajaxEdit_unsupported_fields[t].contains(o))return!1;if("RRULE"===i.data_type||"ALARM"===i.data_type||"CURRENCYISOCODE"===o||"Potentials"===t&&"PROBABILITY"===o||"PriceBooks"===t&&"PRICINGMODEL"===o||"WIZARDID"===o||"S_MODIFIEDTIME"===o)return!1;if(t===moduleApiMapping.Tasks&&("CONTACTID"===i.column_name||"SEID"===i.column_name))return!1;if(-1!==this.visitFldColumn.indexOf(i.column_name))return!0;if("Events"===t&&("SMOWNERID"===i.column_name||"LOCATION"===i.column_name)&&a.$meeting_details)return!1;if("Calls"===t){if(a.$telephony_call&&("Voice_Recording__s"===i.api_name||"To_Number__s"===i.api_name||"From_Number__s"===i.api_name))return!1;if(a.$calendar_booking_call&&"To_Number__s"===i.api_name)return!1;if("Owner"===i.api_name)return!!this.isOpenCall(a)&&(i.read_only=!1,!0)}return i.view_type.edit},openAjaxEdit:function(e,t,a){var i=$L("crm-detail-view")[0].component;if(!i||!0!==i.getData("ajax_edit_in_progress")){var o=this.getData("meta_info");if(void 0!==o.fieldvsEditType&&"showEdit"===o.fieldvsEditType[t.api_name]){switch(t.ui_type!==CrmField.UITYPES.MULTISELECT_LOOK_UP&&i.setData("ajax_edit_in_progress",!0),t.ui_type){case CrmField.UITYPES.LAYOUT:return void Lyte.registeredMixins["crm-detail-view-utils"].showLayoutPopup(this.getData("module"),this.getData("layout_id"),this.getData("record").id,!1,this.getData("unique_listener_id"));case CrmField.UITYPES.MULTISELECT_LOOK_UP:var s=this.getData("record"),r=store.peekRecord("related_list",t.multiselectlookup.id),n={},l={};return l.fldName=t.id,multiLookupsView.frameMLJSON(l),n.entityId=s.id,n.parentModule=this.getData("module"),n.link="edit",n.relatedlist=!0,n.searchmodule=moduleApiVsNameMapping[t.multiselectlookup.connected_module.api_name],n.select=!0,n.fldName=t.id,n.fldId=t.id,n.linkingmodule=r.linkingmodule,n.relid=t.multiselectlookup.id,void multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",n);case CrmField.UITYPES.OWNER:var d=this;return store.findAll("user").then(function(e){e.length>1?Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-mass-action-mixin.js"],ResourceConstants.CRMClient),void 0,(function(){d.massAction("change_owner",d.getData("module"),{ids:d.getData("record").id,from:"detail_view",old_owner_id:d.getData("record").Owner.id,unique_id:d.getData("unique_listener_id")},void 0,void 0,"change_owner")})):_cruxUtils.showCustomMessage({params:{ltPropType:"warning",ltPropMessage:I18n.getMsg("crm.changeOwner.not.available"),ltPropDuration:"3000",ltPropShow:!0}})}.bind(this)),void i.setData({ajaxEditPlace:void 0,ajaxEditField:void 0,ajaxEditFieldMeta:void 0,ajax_edit_in_progress:!1})}if(!a){var c=$L("#"+t.$ids.value_containerId);if("textarea"===t.component_data_type){if((m=(_=c.find("crux-text-area-component"))[0].component).resized=!1,m.data.cxPropValue){var u=c.outerHeight();u=u>71?u:71;var p=_.find(".cxTextareaShowMore");u=p.length>0&&p.text()===m.data.cxPropShowLess?u-(p.height()+_.find("lyte-popover").height()):u,m.setData({cxPropHeight:u+"px",cxPropTextAreaResize:{vertical:"true"}})}}else if("richtext"===t.component_data_type){var _,m;(m=(_=c.find("crm-richtext-component"))[0].component).setData("cxPropEditorInitialHeight",c.outerHeight()),m.getData("viewIsMax")&&m.setData({viewIsMax:!1,cxPropDefaultMaximize:!0})}c.parents(".dv_field_valueCont").addClass("dv_fieldEditEnable"),i.setData("pre_ajax_edit_info",{});var f=c[0].children[0];if("boolean"===t.component_data_type)f=c[0].querySelector("crux-boolean-component");else if("imageupload"===t.component_data_type)f=c[0].querySelector("crux-image-component");else if("fileupload"===t.component_data_type)this.checkIfFileUploadEmpty(t,[]);else if("userlookup"===t.component_data_type){let e=t.api_name,a=o.fieldvsQuery[e];if(a){let i=JSON.parse(a),s={};if(t&&t.lookup&&t.lookup.query_details&&t.lookup.query_details.criteria&&this.isDynamicCriteriaInvolved(t.lookup.query_details.criteria)){let e=store.peekRecord("module",moduleRecordMapping[this.data.module].id).fields;this.iterateGroupFieldsAndGetFieldValuesFromRecordData(t.lookup.query_details.criteria,this.data.record,s,e,this.data.module,void 0,void 0),s.id=this.data.record.id,i.query_id||(i.query_id=t.lookup.query_details.query_id),i.child_data=s}o.fieldvsQuery[e]=JSON.stringify(i),Lyte.objectUtils(o.fieldvsQuery,"add",e,JSON.stringify(i)),f.setData("cxPropQueryParam",JSON.stringify(i))}}f.cxProp("from","create"),c[0].parentElement.setData("ajaxEditMode",!0),this.focusField(f,t);var v=$L("#saveCancelSpan_"+t.$ids.saveCancelContainerId);v.removeClass("dN"),v.addClass("dF"),$L(".verify_"+t.$ids.valueId).removeClass("dN"),i.$node.querySelectorAll("crux-subform").forEach((function(e){e.component.setData("cxPropDisableAjaxEdit",!0)}))}i.setData("ajaxEditPlace",e),i.setData({ajaxEditField:t.column_name,ajaxEditFieldMeta:t})}}},focusField:function(e,t){switch(t.data_type){case"picklist":case"integer":if("integer"===t.data_type&&"SERVICEDURATION"!==t.column_name)setTimeout((function(){e.focus()}),10);else e.querySelector("lyte-dropdown")&&setTimeout((function(){e.focus()}),10);break;case"multiselectpicklist":e.querySelector("lyte-dropdown")&&setTimeout((function(){e.focus()}),10);break;case"userlookup":var a=e.querySelector("lyte-dropdown");a&&a.toggle();break;case"imageupload":return void $L(e).closest(".dv_iu_wrap").focus();case"fileupload":e.querySelector("lyte-button").focus();break;case"textarea":if("richtext"!==t.component_data_type){var i=e.querySelector("textarea");i.focus(),setTimeout((function(){i.click()}),200)}break;case"lookup":default:e.focus();break;case"text":e.querySelector("lyte-autocomplete")?setTimeout((function(){e.focus()}),10):e.focus()}},closeAjaxEdit:function(e){if(this.getData("ajax_edit_in_progress")){if(this.setData("save_ajax_edit_in_progress",!1),$L(".vr_topErrMsgBox").length&&_cruxUtils.removeCustomMessage(),this.getData("rules_execution_result.vr_exec_result")&&this.setData("rules_execution_result.vr_exec_result",{}),this.data.ajaxEditFieldMeta&&this.data.ajaxEditFieldMeta.$ids){let n=$L("#"+this.data.ajaxEditFieldMeta.$ids.valueId);var t=n.outerHeight();if(n=n[0],"textarea"===this.data.ajaxEditFieldMeta.component_data_type&&n.component.data.cxPropValue){n.component.setData("cxPropLineClamp",0);var a=n.component.resized?16:0,i=t-(a=n.component.data.cxPropShowMoreEnabled?a+34:a);i<18&&(i=18),n.component.setData("cxPropHeight",i+"px")}n.cxProp("from","view"),n.setData({isError:!1,cxPropErrorMessage:""}),$L("#"+this.data.ajaxEditFieldMeta.$ids.value_containerId)[0].parentElement.setData("ajaxEditMode",!1);var o=$L("#saveCancelSpan_"+this.data.ajaxEditFieldMeta.$ids.saveCancelContainerId);o.removeClass("dF"),o.addClass("dN"),$L(".verify_"+this.data.ajaxEditFieldMeta.$ids.valueId).addClass("dN");var s=n.closest("crm-detailview-fields");if(s[0]?s=s[0].setData("verifyText",""):s&&s.setData("verifyText",""),o[0]&&o[0].previousElementSibling&&$L(o[0].previousElementSibling).removeClass("dv_transBorder"),$L(".dv_fieldEditEnable").removeClass("dv_fieldEditEnable"),e){var r={};r.place=this.data.ajaxEditPlace,r.column_name=this.data.ajaxEditFieldMeta.column_name,this.setData("pre_ajax_edit_info",r)}}var n=store.peekRecord(moduleRecordMapping[this.getData("module")].id,this.getData("entityId"));if(n.$.rollBack(),this.setData({record:n,record_changed:!0}),this.data.ajaxEditFieldMeta&&"fileupload"===this.data.ajaxEditFieldMeta.component_data_type&&this.checkIfFileUploadEmpty(this.data.ajaxEditFieldMeta,this.data.record[this.data.ajaxEditFieldMeta.api_name]),this.setData({ajaxEditPlace:void 0,ajaxEditField:void 0,ajaxEditFieldMeta:void 0,ajax_edit_in_progress:!1}),this.skipPortalCheckNeeded=!1,this.$node.querySelectorAll("crux-subform").forEach((function(e){e.component.setData("cxPropDisableAjaxEdit",!1)})),!e){var l=$L("crm-change-owner");l.is(":visible")&&l[0].component.closeModal()}}},handleMouseOver:function(){!0!==this.getData("ajax_edit_in_progress")||this.getData("editModeEnable")?!this.getData("ajax_edit_in_progress")&&this.getData("editModeEnable")&&this.setData("editModeEnable",!1):this.setData("editModeEnable",!0)},handleAjaxSaveAction:async function(){if(this.getData("ajax_edit_in_progress")){var e,t=$L("#"+this.getData("ajaxEditFieldMeta").$ids.valueId);if(t[0].component.setData("cxPropClearErrorMessage",!1),!this.getData("visionSuccessRateProcessed")&&t[0].component.data.cxPropField&&t[0].component.data.cxPropField.ui_type&&556===t[0].component.data.cxPropField.ui_type){var a=Lyte.registeredMixins["crm-vision-create"];if(a)if(a.successRateFeedbackPopupNewFlow(this,Crm.renderDVLyteFlow(this.data.module),"detail"))return}var i=t.closest("crm-detailview-fields");if(i[0].getData("field_validation")&&i[0].setData({verifyText:"",verifyButton:"",verifyDisabled:!1}),i[0].getData("vr_exec_result")&&i[0].setData("vr_exec_result",{}),CScriptLib&&void 0!==t[0].component.data.cxPropValue){var o=t[0].component.data.cxPropValue;void 0===o&&(o="");const{id:e,data_type:a}=this.getData("ajaxEditFieldMeta");if(!0!==await CScript.Engine.Global.dispatchIEvent("onBeforeUpdate",e,DetailViewHandler.Utils.serialize_field(JSON.parse(JSON.stringify(o)),a,void 0,void 0,void 0,!0)))return}if("true"!==window.isSandboxAcc&&!this.skipPortalCheckNeeded&&void 0!==this.getData("portalsUserTypeId")){let e=this,a=function(){e.skipPortalCheckNeeded=!0,e.handleAjaxSaveAction()},i=i=>{let o=store.peekRecord("field",i.invitation_field.id);if(this.getData("ajaxEditFieldMeta").api_name===o.api_name){var s=t[0].component.data.cxPropValue,r=this.data.record.Email,n=this.data.record.id;let l=function(){t[0].component.data.cxPropValue=r,e.closeAjaxEdit()};if(""===s.trim())return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("custmr.prtl.inv.field.emt",o.display_label),ltPropType:"error",ltPropDuration:3e3}}),void l();if(s.trim()!==r){let e=networkUtils.returnDependencyFiles(["zohocrm_clientPortalMiscFuncs.js"],ResourceConstants.CRM);return void Lyte.injectResources({parent:e},void 0,(function(){CPMF.showInvitaitonFieldEditMessagePopUp(n,i.id,a,l)}))}}a()},o=store.peekRecord("user_type",this.getData("portalsUserTypeId"));return o&&o.invitation_field?void i(o):void store.findAll("user_type").then((e=>{i(e.find((e=>e.id===this.getData("portalsUserTypeId"))))}))}if("Tasks"===this.data.module&&"STATUS"===this.data.ajaxEditField){var s=this;if(t[0].component.data.pickListValues.filter((e=>e.actual_value===crmConstants.taskCompleted))[0].display_value===t[0].component.data.cxPropValue){var r=this.data.record.Owner.id!==Crm.userDetails.USER_ID;return void crmTasks.showMarkAsCompletedPopup(!1,r,t,s)}}if("Tasks"===this.data.module&&"DUEDATE"===this.data.ajaxEditField){var n=this.data.content_json.meta_info.fieldColumnNameMap.RECURRING[1];if(this.data.record[n]){var l=crmTasks.convertRruleToMap(this.data.record[n].RRULE),d=$L.moment(l.DTSTART).toDate().getTime(),c=l.UNTIL?l.UNTIL:void 0;c=(c="-1"===c?this.getEndDateForNeverEndingTask(l):$L.moment(c).toDate()).getTime();var u=$L.moment(t[0].component.data.cxPropValue,Crm.userDetails.DATE_PATTERN.toUpperCase()).toDate().getTime();if(u<d||u>c){s=this;var p=$L("crm-recurringToSingle-popup"),_={renderPop:!0,ajaxObject:t,detailViewComp:s,startDate:CrmDateUtils.convertDateToUserPattern(d,void 0,!0),endDate:CrmDateUtils.convertDateToUserPattern(c,void 0,!0),isSingleTask:!1};return void(0===p.length?p.push(Lyte.Component.render("crm-recurringToSingle-popup",_,"#basic")):p[0].setData(_))}}}if("Services"===this.data.module)if("SERVICEDURATION"===this.data.ajaxEditField)if("none"===t[0].component.getData("pickListValues").filter((e=>e.display_value===t[0].component.getData("cxPropValue")))[0].actual_value)t[0].component.setData("cxPropNoneKeyword","None");else{var m=Lyte.registeredMixins["crm-services-mixin"].getDurationAndServiceTimingDependencyDetailsForDurationEdit(this.data.layout.fields,this.data.record,t[0].component.data.cxPropValue,!0);if(!1===m.isValid||m.isdurationNotAvailable)return void _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.service.dur.less.avail",moduleRecordMapping.Services.singular_label)}})}else if("BASEPRICE"===this.data.ajaxEditField&&t[0].component.data.cxPropValue<0)return void t[0].component.setData("cxPropErrorMessage",I18n.getMsg("crm.service.price.field.greater.than.equalto"));if("Bundles"===this.data.module&&"BUNDLECODE"===this.data.ajaxEditField){if(t[0].component.getValue().includes(" "))return void t[0].component.setData("cxPropErrorMessage",I18n.getMsg("bundles.field.space.alert",this.data.ajaxEditFieldMeta.display_label))}"Potentials"===this.data.module&&"STAGE"===this.data.ajaxEditField&&(e=this.setOnChangeFieldValue(t[0].component.getValue(),this.data.ajaxEditFieldMeta,e)),this.validateAndSaveAjaxEdit(t,e),this.skipPortalCheckNeeded=!1}},validateAndSaveAjaxEdit:function(e,t,a,i){var o,s,r=e[0].component;if(r.setData("cxPropClearErrorMessage",!1),i&&r.data.cxPropField.subform&&this.isInventoryModule(this.getData("module"))){var n=r.data.cxPropField.column_name;o=-1!==["DISCOUNT","TAX"].indexOf(n),s="ADJUSTMENT"===n}var l="multiselectlookup"===r.data.cxPropField.data_type,d=l||o||s?r.data.cxPropValue:r.getValue(),c=r.getData("cxPropField");d=this.getProcessedFieldValue(d,c,this.getData("fresh_record"));var u=!l&&!o&&r.validate(),p={isError:!1,isValid:!0};return!(!o&&!u&&(p.isValid=!1,"lookup"!==c.component_data_type&&"multiselectlookup"!==c.component_data_type))&&(this.getData("save_ajax_edit_in_progress")?void 0:(a||this.setData("save_ajax_edit_in_progress",!0),!this.validateRecordForSave(d,c,this.getData("fresh_record"),this.getData("module"),p,this.getData("content_json.meta_info.fieldColumnNameMap"),e[0])||p.isError?(r.setData({cxPropErrorMessage:p.message,isError:!0}),this.setData("save_ajax_edit_in_progress",!1),!1):!!a||void this.createLayoutValidationRuleObjAndExecute(c,d,r,t,i)))},open_ajax_edit_popup:function(e){if(e&&"field_of_lookup"===e.feature&&e.fieldVsValue){if(Object.keys(e.fieldVsValue).length<1)return;var t;if(e.fromOwnerLookup?(this.setData("ajax_edit_in_progress",!0),t=$L("#owner_SMOWNERID")):t=$L("#"+this.getData("ajaxEditFieldMeta").$ids.valueId),!this.getData("ajax_edit_in_progress"))return;this.validateAndSaveAjaxEdit(t,e.fieldVsValue)}e&&"direct_save"===e.case&&this.createLayoutValidationRuleObjAndExecute(e.field,e.value,void 0,void 0,void 0,e)},createLayoutValidationRuleObjAndExecute:function(e,t,a,i,o,s){var r={};r.actual_value=t,r.field=e,r.moduleInfo=this.getData("moduleData"),r.entityData=[this.data.fresh_record];var n=t===this.data.record[e.api_name];if(!n){var l=!t&&!this.data.record[e.api_name];switch(e.data_type){case"integer":case"currency":case"double":if(l)break;n=l;break;case"fileupload":n=l||!t.length;break;default:n=l}}if(n)this.closeAjaxEdit();else{Object.defineProperty(r.entityData,"$",{value:{meta:r.entityData[0]._$}}),r.layoutData=this.getData("layout_response"),r.customDataFeature="single_ajax_edit",r.onSaveCsriptEventName="onBeforeMandatoryFormSave",r.getEntityData=!1,r.skipFreezeLayer=!0,r.newAffectedDataNeeded=!0,r.skipHeaderChangeAllTime=!0,r.otherFieldValues=s&&s.otherFieldValues?s.otherFieldValues:i,r.otherPropertyObj=s,r.customReturnData={},r.isRequiredAdditionalInfo=!0,r.layoutRule=this.getData("layoutRule")?this.getData("layoutRule").layout_rule:[],r.validationRule=this.getData("validationRule");var d=this.getData("content_json")?this.getData("content_json").recordLockingDetails:void 0;r.editableFieldsRL=d&&d.isLockedForMe&&d.restricted_actions&&d.restricted_actions.contains("update")?d.fieldIds:void 0,r.callback={getEntitySaveQp:function(){return{affected_data_new:!0}},onSave:function(r,n,l){"error"===n?(this.setData("save_ajax_edit_in_progress",!1),o?o.cancel(void 0,r):this.handleAjaxErrorResponse(r,this.createLayoutValidationRuleObjAndExecute.bind(this,e,t,a,i))):this.handleAjaxEditResponse(r,n,l,o,s)}.bind(this),onCancel:function(e){o?o.cancel(e?void 0:this):this.closeAjaxEdit(),s&&s.callback&&s.callback.cancel()}.bind(this),onError:function(t,i){if(this.setData("save_ajax_edit_in_progress",!1),a){var r=a.getData("cxPropField");(!r||202!==r.ui_type&&333!==r.ui_type)&&$L(a.$node).focus()}var n=$L("crm-task-markascompleted-popup")[0],l=n?n.component.data:void 0;if(i&&t){var d=Lyte.registeredMixins["crm-validationrule-utils"],c={displayType:!0};c.taskClose=!!l&&l.closeTaskFromDetailView,d.onErrorMsgDisplay(t,this,a,c,s),o&&o.cancel(this)}else if(t&&t.message)if(l&&l.closeTaskFromDetailView){var u=$L("crm-task-invalid-popup");0===u.length?u.push(Lyte.Component.render("crm-task-invalid-popup",{message:t.message,renderPop:!0},"#basic")):u[0].setData({message:t.message,renderPop:!0}),o?o.cancel():this.closeAjaxEdit(),s&&s.callback&&s.callback.error(t)}else{if(a){var p=$ESAPI.encoder().encodeForHTMLAttribute(t.message);a.setData({cxPropErrorMessage:p,isError:!0})}o&&o.cancel(),s&&s.callback&&s.callback.error(t)}else if(t&&t.response){let i=JSON.parse(t.response);_self.handleFieldSpecificAjaxEditError(i.data?i.data[0]:i,e,a),_self.handleAjaxEditError(i.data?i.data[0]:i)}}.bind(this),onBeforeSaveFailure:function(s,r,n){var l=s.response?JSON.parse(s.response):{};if(l&&l.data&&l.data[0]&&l.data[0].details&&l.data[0].details.api_name===e.api_name){this.setData("save_ajax_edit_in_progress",!1);var d=e.subform&&o&&o.subformAjaxField&&a?a.$node:void 0;return this.handleAjaxErrorResponse(s,this.createLayoutValidationRuleObjAndExecute.bind(this,e,t,a,i),d),n&&(n(),o&&o.cancel()),commonUtils.showHideLoadingDiv(),!0}}.bind(this)},r.subformAjaxField=o?o.subformAjaxField:void 0,r.requestFrom="detailView",this.setData("valErrorDetails",{}),this.executeLayoutValidationRuleForQuickCreate(r)}},handleAjaxEditResponse:function(e,t,a,i,o){this.setData("save_ajax_edit_in_progress",!1);var s=this.getData("module");if("success"===t){var r=moduleRecordMapping[s].id;if(!e)return void(i?i.save(this):this.closeAjaxEdit());if(e[r]){var n=e[r],l=store.peekRecord(r,n.id),d=a&&a.record_dirty_props?l.$.model.fieldList[a.record_dirty_props[0]]:null;!d||444!==d.uiType&&445!==d.uiType?this.afterSaveAjaxEdit(e,t,a,i,o):store.findRecord(this.data.moduleData.id,n.id).then(function(){this.afterSaveAjaxEdit(e,t,a,i,o)}.bind(this))}}else{if(e.data&&"MAPPING_MISMATCH"===e.data[0].code&&"Pipeline"===e.data[0].details.mapped_field)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.pipeline.empty.detailview.disable")}});if("NO_PERMISSION"===e.code||e.data[0]&&"NO_PERMISSION"===e.data[0].code||e.data&&"RECORD_IN_BLUEPRINT"===e.data[0].code||e.data&&"CANNOT_PERFORM_ACTION"===e.data[0].code||e.data&&"MAPPING_MISMATCH"===e.data[0].code)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.security.error")}});if(e.data&&e.data[0]&&"RECORD_LOCKED"===e.data[0].code&&"Sorry, you cannot perform this operation as the record is locked."===e.data[0].message)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.record.locking.permission.denied")}})}},afterSaveAjaxEdit:function(e,t,a,i,o){var s=this.getData("module"),r=moduleRecordMapping[s].id,n=e[r],l=this.getData("tobe_highlighted_fields"),d=this.data.content_json.meta_info.fieldAPINameVsIdMap,c=Math.floor(1e3*Math.random());if(n.affected_data)for(let e in n.affected_data[0])d[e]&&116===d[e][1]&&Lyte.objectUtils(l,"add",e,c);this.setData("tobe_highlighted_fields",l);var u=store.peekRecord(r,n.id),p=!!(n&&n.affected_data&&n.affected_data[0]&&"$approved"in n.affected_data[0])&&n.affected_data[0].$approved;this.updateRecordForModuleSpecificCases(u,this.getData("ajaxEditField"),s,this.getData("content_json.meta_info.fieldColumnNameMap"),p);var _=$L("crux-image-component");if(_&&_.length>0){let e=_.length;for(var m=0;m<e;m++){let e=_[m].component,t=e.getData("cxPropField.api_name"),a=this.constructImageDataFromServer(u[t],s,u.id,e.getData("cxPropField.id"));u[t]=this.constructImageSrcWithExistingData(a,_[m].component.getData("images")),_[m].closest("crm-detailview-fields").component.setData("imageUploadTrackingData",u[t])}}if(n.affected_data&&void 0!==n.affected_data[0].$process_flow&&!0===n.affected_data[0].$process_flow?this.refreshProcessLayer(u):this.setData("fresh_record",u),n.affected_data&&!0===n.affected_data[0].$approved?this.refreshApprovalProcessLayer(u,s):this.setData("fresh_record",u),"Tasks"!==s&&this.setData("record",objectUtils.cloneObject(u)),setTimeout(this.removeHighlightedFields,5e3,c),this.setData("record_edited",!0),Lyte.triggerEvent("refreshTimelineInteractions"),Lyte.triggerEvent("detail_view_rules_execution_listener_"+this.getData("unique_listener_id"),{features:["layout_rule"]}),this.updateDetailsRelatedToUpdatedFields(u,a,s),this.data.ajaxEditFieldMeta){var f=this.data.ajaxEditFieldMeta;if("Calls"===s&&"Voice_Recording__s"===f.api_name){$L("#"+this.data.ajaxEditFieldMeta.$ids.valueId)[0].setData("cxPropLoadingError","")}"Email"!==f.api_name&&"Secondary_Email"!==f.api_name||this.handleEmailFieldUpdate(this.data)}i?i.save(this):this.closeAjaxEdit(!0),o&&o.callback&&o.callback.save(e,t),Lyte.triggerEvent("cxRecordUpdated",{id:this.data.record.id})},updateDetailsRelatedToUpdatedFields:function(e,t,a){var i=e.$.model.fieldList;if(t&&t.record_dirty_props){for(var o=t.record_dirty_props.length,s=!1,r=0;r<o;r++){var n=i[t.record_dirty_props[r]];if(n){var l=store.peekRecord("field",n.fieldID);if(l){var d=l.lookup?l.lookup.module:null;if(moduleRecordMapping.Accounts&&d&&d.api_name===moduleRecordMapping.Accounts.api_name){if("SalesOrders"!==a&&"Invoices"!==a&&"Quotes"!==a||this.loadRelatedRecords(this,a,e.id,"Accounts",!0),"Account_Name"===l.api_name){var c=this.data.content_json.meta_info.fieldvsEditType;e.Account_Name?Lyte.objectUtils(c,"add","Reporting_To","showEdit"):Lyte.objectUtils(c,"add","Reporting_To","showEmpty")}s=!0}if(Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&Lyte.registeredMixins.smart_prompt_handler.detailLyteFieldCheck(a,l.column_name,l,e)){var u=this.data.content_json.meta_info,p={};p[l.api_name]=!0,Lyte.objectUtils(u,"add","smart_prompt_field",p)}l.history_tracking&&Lyte.triggerEvent("relatedList",{module:moduleApiVsNameMapping[l.history_tracking.module.api_name],scroll:!1})}}}if(s){var _=this.data.content_json.meta_info.moduleVsLookupFields?this.data.content_json.meta_info.moduleVsLookupFields.Contacts:[];if(_){var m=objectUtils.cloneObject_new(this.data.content_json.meta_info.fieldVsRelatedRecInfo),f=objectUtils.cloneObject_new(this.data.content_json.meta_info.fieldVsRelatedRecords);for(o=_.length,r=0;r<o;r++){var v=store.peekRecord("field",this.data.content_json.meta_info.fieldColumnNameMap[_[r]][0]);this.getRelatedRecordInfoForLookup(m,f,v,e,this.data.content_json.meta_info.fieldColumnNameMap,this.data.content_json.meta_info.moduleVsLookupFields)}this.setData({"content_json.meta_info.fieldVsRelatedRecords":f,"content_json.meta_info.fieldVsRelatedRecInfo":m})}}}},handleAjaxErrorResponse:function(e,t,a){this.handleRecordEditErrorResponse(e,this.getData("module"),this.getData("ajaxEditFieldMeta"),t,a)},updateRecordForModuleSpecificCases:function(e,t,a,i,o){if(("Cases"===a||"Solutions"===a)&&"ADDCOMMENT"===t){var s=e[i[t][1]],r={};r.commented_by=e[i.MODIFIEDBY[1]].name,r.commented_time=CrmDateUtils.convertDateTimetoISOFormat(e[i.MODIFIEDTIME[1]]),r.comment_content=s;var n=e[i.COMMENTCONTENTS[1]]?e[i.COMMENTCONTENTS[1]]:[];n.push(r);var l={};l.id=e.id,l[i[t][1]]=null,l[i.COMMENTCONTENTS[1]]=n,i.COMMENTCOUNT&&(l[i.COMMENTCOUNT[1]]=n.length),store.pushPayload(moduleRecordMapping[a].id,l)}if("Tasks"===a){var d=i.REMINDAT[1];e[d]=this.data.record[d],this.updateFieldsForTask(e,o,this)}if(!("Calls"!==a||e.Who_Id||e.What_Id||"FROMNUMBER"!==t&&"TONUMBER"!==t)){var c,u=this.getCallType(e),p=!1;if("Outbound"===u&&"TONUMBER"===t?(c=e.To_Number__s,p=!0):"Outbound"!==u&&"FROMNUMBER"===t&&(c=e.From_Number__s,p=!0),p){var _=c||I18n.getMsg("crm.activities.call.unknown.entityname");this.setData("defaultValue",_);var m=document.getElementById("kanban_"+e.id);m||(m=document.getElementById("cvcard_"+e.id)),m&&(m.component.setData("phoneNo",c),m.component.setData("phoneNumber",c),m.component.setData("phoneId",this.getPhoneId(c)))}}if("Potentials"===a)if("STAGE"===t){var f=objectUtils.cloneObject(this.data.content_json.meta_info.fieldvsOptions);this.populateFieldVsOptionsForField(this.data.ajaxEditFieldMeta,this.data.layoutId,f,e),this.setData({"content_json.meta_info.fieldvsOptions":f})}else"CLOSINGDATE"===t&&Lyte.triggerEvent("salesSummaryInfo",{module:a,entityId:e.id})},getLookupIconClass:function(e,t){switch(e.data_type){case"userlookup":t.icon="zcicncss-usersearch zcicn-cssIcons";break;case"lookup":moduleApiVsNameMapping[e.lookup.module.api_name]&&(t.icon="zcicncss-"+moduleApiVsNameMapping[e.lookup.module.api_name].toLowerCase()+" zcicn-cssIcons","custom"===moduleRecordMapping[moduleApiVsNameMapping[e.lookup.module.api_name]].generated_type&&(t.icon="zcicncss-custommodule zcicn-cssIcons"))}},updateFieldsForTask:function(e,t,a){showHideLockIcon(e.id,t);var i=a.data.ajaxEditFieldMeta.column_name,o=e[a.data.ajaxEditFieldMeta.api_name],s=a.data.transitionData&&"kanbanview"===a.data.transitionData.view,r=a.data.transitionData&&(a.data.transitionData.fromDetailView||a.data.transitionData.fromActivityListView||a.data.transitionData.fromActSubModuleListView),n=a.data.content_json.meta_info.fieldColumnNameMap.REMINDAT[1];if(e[n]=a.data.record[n],"STATUS"===a.data.ajaxEditFieldMeta.column_name){Lyte.triggerEvent("detail_view_listener_"+a.getData("unique_listener_id"),{componentsToBeReloaded:["record_actions"]});var l=a.data.ajaxEditFieldMeta.pick_list_values.filter((e=>e.actual_value===crmConstants.taskCompleted));if(e.Status===l[0].display_value){var d='Lyte.registeredMixins["crm-detailview-common-utils"].createFollowUpTask("'+encodeURIComponent(JSON.stringify(e.Who_Id))+'","'+encodeURIComponent(JSON.stringify(e.What_Id))+'","'+encodeURIComponent(e.$se_module)+'")';_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.create.followup.task.new",d),ltPropType:"success",ltPropDuration:1e4,ltPropYield:!0}}),s&&$L("#listViewClose_"+e.id).addClass("dN")}else s&&$L("#listViewClose_"+e.id).removeClass("dN")}if(s||r||"STATUS"===i||"PRIORITY"===i||"SUBJECT"===i||"DUEDATE"===i){var c;if("DUEDATE"===i){var u=$L("crm-recurringtosingle-popup")[0];if(u&&u.getData("isSingleTask")){e[a.data.content_json.meta_info.fieldColumnNameMap.RECURRING[1]]=void 0,u.setData("isSingleTask",!1);var p=$L("crm-detailview-header")[0].component,_=objectUtils.cloneObject(p.data.recordDetails);_.recevent=void 0,Lyte.Component.set(p.data,"recordDetails",_)}if(o)(o=$L.moment(o,Crm.userDetails.DATE_PATTERN.toLocaleUpperCase()).toDate())<$L.moment().toDate().setHours(0,0,0,0)&&(e[n]=void 0),c=o.getFullYear()===$L.moment().toDate().getFullYear()?Utils.getDateInGivenPattern(o,"mmm dd"):Utils.getDateInGivenPattern(o,"mmm dd, yyyy")}var m=a.data.content_json.meta_info.fieldColumnNameMap[i][1];s?this.updateTaskRecord(e.id,i,m,o,c):r&&(o="DUEDATE"===i&&c?c:o,$L(".lp_"+m+"_"+e.id).text(o).attr("title",o)),a.setData("record",objectUtils.cloneObject(e))}},updateTaskRecord:function(e,t,a,i,o){var s=$L("#recordid_"+e);if(0!==s.length)if(""===i&&(o=""),"DUEDATE"===t){var r=s.find(".overDueTask");r.html(o);var n=$L.moment().toDate();if(n.setHours(0,0,0,0),(l=$L.moment(i,Crm.userDetails.DATE_PATTERN.toLocaleUpperCase()).toDate())<n){n=$L.moment().toDate();var l=$L.moment(i,Crm.userDetails.DATE_PATTERN.toLocaleUpperCase()).toDate(),d=Math.floor((n.getTime()-l.getTime())/864e5);d=d>1?I18n.getMsg("crm.label.overdue.late.days",d):I18n.getMsg("crm.label.overdue.late.day",d),s.find(".overdue").html(d),r[0].classList.add("crmNegativeColor")}else r[0].classList.remove("crmNegativeColor")}else $L(".kv_"+a+"_"+e).text(i).attr("title",i)},doSingleRecordWFKafkaHandling:function(e,t){var a=("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route?$L("crm-detailview-canvas")[0]:$L("crm-detail-view")[0]).component,i=a.data,o=i.entityId;if(e.entityId===o){var s=i.singleRecordKafkaWFOffload,r=!1;s&&void 0!==s.refreshInWms&&s.refreshInWms&&(s.refreshInWms=!1,r=!0),s&&void 0!==s.approvalCaseOffloading&&s.approvalCaseOffloading&&(s.approvalCaseOffloading=!1,r=!0),r&&(a.setData("singleRecordKafkaWFOffload",s),this.callLyteRefresh(this))}if($L("#automationSchNotificationPopup."+t)[0]){$L("#automationSchNotificationPopup").remove();var n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("automationActionsNotification")],ResourceConstants.CRM);Lyte.injectResources(n,void 0,(function(){var e={};e.message=I18n.getMsg("crm.automation.workflow.notification.completed.message"),e.status="success",automationActionsNotificationScheduler.addOrUpdateWFPopupStatus(e,I18n.getMsg("crm.automation.workflow.notification.completed.title"))}))}},hideElementsForKafkaWorkFlow:function(e){"Activities"===Crm.activityGrp[e]||($L(".cclinkRelContainer").hide(),$L(".dv_slideIconWrapper").hide(),$L(".crm-detailview-tag").hide(),$L("#dvinfoContainer").hide(),$L("#relatedPageContent").hide(),$L(".ziacardContainer").hide(),$L("#noteDetails").hide(),$L("#blueprintLayerDiv").hide(),$(".dv_body_wrapper").append('<div id="baseOverlay" class="baseOverlay zI10""></div>'),$L(".dv_body_wrapper").addClass("pR"),"detail"===Lyte.Router.getRouteInstance().routeName&&$("#basic").addClass("pointerEveNone"))},callLyteRefresh:function(e){Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):308===Lyte.Router.getRouteInstance().transition.state||200===Lyte.Router.getRouteInstance().transition.state?(Lyte.Router.getRouteInstance().refresh(),$("#basic").removeClass("pointerEveNone")):setTimeout((function(){e.callLyteRefresh(e)}),500)},singleRecordKafkaWFOffload:function(e,t,a){if(void 0!==e){var i=e.component,o=i.data,s=void 0!==o.singleRecordKafkaWFOffload?o.singleRecordKafkaWFOffload:{};if(void 0===s.refreshInWms&&(s.refreshInWms=!1),void 0===s.currOffloadingJobId&&(s.currOffloadingJobId=a.currOffloadingJobId),s.refreshInWms=a.refreshInWms,i.setData("singleRecordKafkaWFOffload",s),a.refreshInWms){var r=Lyte.registeredMixins["crm-detailview-common-utils"];return"crm.tab.module.entity.canvas"!==Lyte.Router.getRouteInstance().transition.info.route&&r.hideElementsForKafkaWorkFlow(t),void(automationActionsNotificationScheduler.singleRecordOffloadTimeout=setTimeout((function(){if(o.singleRecordKafkaWFOffload.refreshInWms){var e=o.singleRecordKafkaWFOffload;e.refreshInWms=!1,automationActionsNotificationScheduler.showAutomationSchNotificationProgress(e.currOffloadingJobId),Crm.client_tracking("clientSingleRecordAutomationSchNotificationPopup"),r.callLyteRefresh(t)}}),3e3))}}},constructFieldUpdateHighlightValues:function(e,t){var a=e.updateMap,i=a.updatedValuesMap,o=a.updatedOriginalValuesMap,s=a.highlightFields,r=a.updatedTitleFields,n=a.isLayoutFieldUpdated,l=t.data,d=void 0!==l.wmsUpdatedFieldValues?l.wmsUpdatedFieldValues:{};void 0===d.updatedValuesMap&&(d.updatedValuesMap={}),void 0===d.updatedOriginalValuesMap&&(d.updatedOriginalValuesMap={});var c=void 0!==d.highlightFields?d.highlightFields:d.highlightFields={},u=void 0!==c.titleHLMap?c.titleHLMap:c.titleHLMap=[],p=void 0!==c.bcHLMap?c.bcHLMap:c.bcHLMap=[],_=void 0!==c.fieldsHLMap?c.fieldsHLMap:c.fieldsHLMap=[];c.titleHLMap=Array.from(new Set(u.concat(r))),c.bcHLMap=Array.from(new Set(p.concat(s))),c.fieldsHLMap=Array.from(new Set(_.concat(s)));var m=Lyte.Router.getRouteInstance().transition.info;if(i&&this.mergeJSon(d.updatedValuesMap,i),o&&this.mergeJSon(d.updatedOriginalValuesMap,o),this.mergeJSon(d.updatedOriginalValuesMap,o),n&&(d.isPageRefreshNeeded=!0),e.isKioskRefresh&&Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&(e.isKioskRefresh.isBluePrint||e.isKioskRefresh.isCommandCenter||e.isKioskRefresh.isWaitingForApproval||e.isKioskRefresh.isLocked||e.isKioskRefresh.isConverted)&&(d.isPageRefreshNeeded=!0),t.setData({updateMap:a,wmsUpdatedFieldValues:d}),"crm.tab.module.entity.canvas"===m.route?Lyte.registeredMixins["crm-detailcanvas-utils"].postCreate(e):this.postCreate(!1),e.isApprovalProcessRefreshAfterCf&&l.record.$approved){var f=l.module,v=l.record;$L("crm-detailview-content")[0].componetn.data.isApprovalProcessRender&&this.refreshApprovalProcessComponent(v,f,void 0,!0)}if(l.record.$process_flow){var h=l.blueprint_exec_info.blueprint.process_info.field.api_name;Object.keys(e.updateMap.updatedValuesMap).indexOf(h)>-1&&this.refreshProcessLayer(l.fresh_record)}},removeHighlightedFields(e){var t=$L("crm-detail-view")[0];if(t&&t.component){var a=t.component.getData("tobe_highlighted_fields");for(var i in a)a[i]===e&&Lyte.objectUtils(a,"add",i,0)}},postCreate:function(e,t){var a=$L("crm-detail-view")[0].component,i=a.data,o=void 0===i.fieldUpdateHighlightTimeout||null===i.fieldUpdateHighlightTimeout;if(o||e){var s=i.wmsUpdatedFieldValues;void 0===s&&t&&(s=t,a.setData("wmsUpdatedFieldValues",s));var r=s.updatedValuesMap,n=s.updatedOriginalValuesMap,l=Lyte.registeredMixins["crm-detailview-common-utils"];s.isPageRefreshNeeded?(s.isPageRefreshNeeded=!1,l.callLyteRefresh(),setTimeout((function(){l.postCreate(!0,s)}),1300)):void 0!==r&&0!==Object.keys(r).length?(o&&a.setData("fieldUpdateHighlightTimeout",3e3),Lyte.triggerEvent("detail_view_listener_"+a.getData("unique_listener_id"),{isWMSFieldUpdate:!0,updatedValues:{updatedValuesMap:r,updatedOriginalValuesMap:n}}),Lyte.triggerEvent("detail_view_rules_execution_listener_"+a.getData("unique_listener_id"),{features:["layout_rule"]}),l.fieldUpdateHighlight(a),$L(".dvLastUpdate").addClass("wfFieldHighlight"),setTimeout((function(){$L(".dvLastUpdate").removeClass("wfFieldHighlight")}),1e4),setTimeout((function(){l.postCreate(!0)}),3e3)):a.setData("fieldUpdateHighlightTimeout",null)}},fieldUpdateHighlight:function(e){var t=e.data,a=void 0!==t.wmsUpdatedFieldValues?t.wmsUpdatedFieldValues:t.wmsUpdatedFieldValues={},i=void 0!==a.highlightFields?a.highlightFields:a.highlightFields={},o=Lyte.registeredMixins["crm-detailview-common-utils"],s=void 0!==i.titleHLMap?i.titleHLMap:i.titleHLMap=[],r=void 0!==i.bcHLMap?i.bcHLMap:i.bcHLMap=[],n=void 0!==i.fieldsHLMap?i.fieldsHLMap:i.fieldsHLMap=[];0!==s.length&&(i.titleHLMap=o.checkingFieldAndHighlighting("title",s,o)),0!==r.length&&(i.bcHLMap=o.checkingFieldAndHighlighting("business_card",n,o)),0!==n.length&&(i.fieldsHLMap=o.checkingFieldAndHighlighting("view",n,o)),e.setData("wmsUpdatedFieldValues",a)},checkingFieldAndHighlighting:function(e,t,a){for(var i=[],o=t.length,s=$L("#titlecard_LASTNAME"),r=0;r<o;r++){var n=store.peekRecord("field",t[r]);if(void 0!==n){var l,d=objectUtils.cloneObject(n);if(Lyte.registeredMixins["crm-detailview-parser"].populateFieldAttributes(n,d,e),void 0!==(l="title"===e&&"First_Name"===n.api_name?s:$L("#"+d.$ids.valueId))[0]){var c=l[0].closest("crm-detailview-fields").component;if("title"===e)a.doFieldHighlight(c);else{let e=$L("#"+d.$ids.fld_containerId);a.isFieldsVisible(e)?a.doFieldHighlight(c):i.push(t[r])}}}}return i},doFieldHighlight:function(e){var t=e.getData("field");t&&t.$classes&&(Lyte.objectUtils(e.getData("field").$classes,"add","is_highlight",!0),null!==e.fieldHighlightTimeout&&clearTimeout(e.fieldHighlightTimeout),e.fieldHighlightTimeout=setTimeout(function(){Lyte.objectUtils(e.getData("field").$classes,"add","is_highlight",!1),e.fieldHighlightTimeout=null}.bind(e),1e4))},isFieldsVisible:function(e){var t,a=e.offset().top,i=a+e.outerHeight(),o=$L(window).scrollTop(),s=o+renderingUtils.windowHeight,r=$L(".dv_header_wrapper")[0];return r&&(t=(r=r.getBoundingClientRect()).height+r.top),i>o&&a<s&&t<a},handleBodyClickEvent:function(e){e&&Lyte.registeredMixins["crm-create-mixin"]&&Lyte.registeredMixins["crm-create-mixin"].createglobalhide(e),this.handleBodyClickForDVPage(e)},handleBodyClickForDVPage:function(e){if($L("#eventCreatePopup").is(":visible")){var t=$L("#Crm_Events_ENDDATETIME_TimeOption_List");if(t&&t.is(":visible"))t[0].remove();else{var a=$L("#Crm_Events_STARTDATETIME_TimeOption_List");if(a&&a.is(":visible"))a[0].remove();else{var i=$L("#eventMultipleRemindersDiv");i.is(":visible")&&i.hide()}}var o=$L("#Calendar")[0],s=$L("#qCreate"),r=null;if(r=(r=renderingUtils.getTargetElem(e))||document.getElementById("show"),o&&"block"===o.style.display&&"block"!==s[0].style.display&&!tkveventajax&&("calenderDueDate"!==r.id&&"headervaluetkv_Due Date"!==r.id||headerTextAreaEnd&&""===headerTextAreaEnd.innerHTML)&&crmCalendar.close(),r&&"showMenu"!==r.id&&"showSubMenu"!==r.id&&"export"!==r.id&&"locateMap"!==r.id&&"copyAddress"!==r.id&&"btnExport"!==r.id&&"moreTools"!==r.id&&"btnConvert"!==r.id&&"newAttach"!==r.id&&"sndMail_Top"!==r.id&&"sndMail_Buttom"!==r.id){var n=$("div[name='ownerNameLookup']"),l=r.parentElement;if(r.getAttribute&&"searchUserLookupUl"!==r.getAttribute("name")&&"ownerNameLookupSpan"!==r.getAttribute("name")&&"searchUserLookup"!==r.getAttribute("name")&&n[0]&&/block|/.test(n[0].style.display)&&!/hostSearch/.test(r.id)&&"hostSrcBox"!==r.id&&"Crm_Events_SMOWNERID"!==r.id&&(!l||"searchUserLookup"!==l.getAttribute("name"))){n.hide(),$(".popup-model-content,.pp-content").removeClass("oH");var d=n.attr("data-fieldName");$('input[id^="hostSearch_temp_searchuser"]').removeAttr("onclick");var c=$("#"+d),u=c.prev("input");d&&void 0!==u.val()&&""===u.val()&&c.children("ul").children("input").css("display",""),$(".focusFieldNewUpdate").removeClass("focusFieldNewUpdate")}if(/hostSearch/.test(r.id)){var p=$("#"+r.id),_=p.is("[readonly]"),m=p.parent().parent().attr("id");_?$("#ownerNameLookup_"+m).css("display","none"):$("#ownerNameLookup_"+m).css("display","")}}}var f=$L(".zCampOpiontDD");f.length>0&&f[0].remove(),this.handleBodyClickForCallsPopup(e),Crm.menu.hideMenu(e),crmui.toolTip_hide()},handleBodyClickForCallsPopup:function(e){if($L("#createEditCallDiv").is(":visible")||$L("#updateCallStatus").is(":visible")){var t=$L("#Calendar")[0],a=$L("#qCreate"),i=renderingUtils.getTargetElem(e);i=i||document.getElementById("show"),t&&"block"===t.style.display&&"block"!==a[0].style.display&&!tkveventajax&&("calenderDueDate"!==i.id&&"headervaluetkv_Due Date"!==i.id||headerTextAreaEnd&&""===headerTextAreaEnd.innerHTML)&&crmCalendar.close()}},mergeJSon:function(e,t){for(var a in t)e[a]=t[a]},isOpenCall:function(e){var t,a=e.Outgoing_Call_Status;return store.peekRecord("module",moduleRecordMapping.Calls.id).fields.forEach((function(e){"Outgoing_Call_Status"===e.api_name&&e.pick_list_values.forEach((function(e){e.display_value===a&&(t=e.actual_value)}))})),"Scheduled"===t||"Overdue"===t},getCallType:function(e){var t,a=e.Call_Type;return store.peekRecord("module",moduleRecordMapping.Calls.id).fields.forEach((function(e){"Call_Type"===e.api_name&&e.pick_list_values.forEach((function(e){e.display_value===a&&(t=e.actual_value)}))})),t},getPhoneId:function(e){return e&&(e=(e=0===(e=e.replaceAll(/[^a-zA-Z0-9]/g,"")).indexOf("0")?e.substring(1):e).replace(/./g,(e=>crmCallsNew.alpha_mappings[e.toUpperCase()]||e))),e},isAvailableSectionForCallType:function(e,t){var a=this.getCallType(t);return("Inbound"!==a||"Outcome Of Outgoing Call"!==e)&&("Outbound"!==a||"Reason For Incoming Call"!==e)},copyLink:function(e){var t=document.createElement("input");t.id="dummyinputEleId",t.style.height=0,document.getElementsByTagName("body")[0].appendChild(t),t.value=e,document.querySelector("#dummyinputEleId").select(),document.execCommand("copy"),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.label.consent.link.copied"),ltPropType:"info",ltPropDuration:"2000",ltPropOffset:{top:"50px"}}}),document.body.removeChild(t)},createFollowUpTask:function(e,t,a){if(_cruxUtils.removeCustomMessage(),e="undefined"!==e?JSON.parse(decodeURIComponent(e)):void 0,t="undefined"!==t?JSON.parse(decodeURIComponent(t)):void 0,a="undefined"!==a?decodeURIComponent(a):void 0,Crm.userDetails.TaskPopup){var i,o=e?e.id:t?t.id:void 0;e?i="Contacts":t&&(i=a),crmRelatedList.relTaskCreate(void 0,o,void 0,i)}else{quickTask.init();var s=e?e.id:void 0,r=e?e.record_module:void 0,n=t?t.id:void 0,l={fromCreate:"QuickCreate",module:"Tasks",isFollowupTask:!0};l.relmodule=l.primmodule="null"!==r?r:void 0,l.id=l.entityid="null"!==s?s:void 0;var d=!0;e?(l.relmodule="Contacts",l.primmodule="Contacts"):!e&&t&&"Leads"===a&&(l.relmodule="Leads",l.primmodule="Leads",d=!1,s=t.id),t&&d&&(l.modsel=a),n&&s!==n&&(l.mode="followUpDV",l.modsel=t.record_module,l.modid=n,l.modname=t?t.name:void 0);var c=new crmRequestPool,u=Crm.getCrmBasePath()+"/QCreate.do",p={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};c.initiate({action:u,type:"POST",headers:p,data:l,success:function(e){if(-1!==e.indexOf("Permission denied"))renderingUtils.displayPermissionDenied();else{Q.loadResponse(e);var t=$("#followup").offset(),a=$("#qCreate");a.css({top:t.top-30,left:t.left-(a.width()+10),display:"block"}),renderingUtils.freezeBackground(),renderingUtils.ShakeDivInfreeze("qCreate","left",20,100)}},error:void 0})}},constructZiaOwnerRecommendationDetails:function(e,t,a){if(e.zia_insights_keys){var i=e.zia_insights_keys;if(i&&i.zia_suggested_users_data){var o={recommendedOwner:i.zia_suggested_users_data[0].zia_suggested_users[0]};if(o.recommendedOwner){o.zia_owner_assignment=t.$zia_owner_assignment;for(var s=JSON.parse(JSON.stringify(i.zia_suggested_users_data[0].fields_considered)),r=s.length,n=[],l=0;l<r;l++)s[l].field&&store.peekRecord("field",s[l].field.id)&&n.push(s[l]);if((r=n.length)>0){var d=[];for(l=0;l<r;l+=2){var c=[],u=store.peekRecord("field",n[l].field.id);if(s[l].field.field_label=u.field_label,c.push(s[l]),l<r-1){var p=store.peekRecord("field",n[l+1].field.id);s[l+1].field.field_label=p.field_label,c.push(s[l+1])}d.push(c)}return o.fcGrp=d,o.module=a,o.entityId=t.id,o.currentOwnerId=t.Owner.id,o.type="show_reasoning",moduleRecordMapping[a].fields.forEach((function(e){"Owner"===e.api_name&&(o.ownerFieldLabel=e.field_label,o.ownerFieldObj=e)})),!$L("crm-zia-reasoning-popover")[0]&&$L("#zor-popup")[0]&&Lyte.Component.render("crm-zia-reasoning-popover",o,"#zor-popup"),o}}}}},handleEmailFieldUpdate:function(e){store.findAll("dummy",{features:"blocked_emails"},!1,!1,{url:"/crm/v6/"+e.module+"/"+e.entityId+"/actions/get_feature_specific_info",method:"GET"}).then((e=>{if($L(".emailUnblocking.Secondary_Email").addClass("hide"),$L(".emailUnblocking.Email").addClass("hide"),Lyte.Router.getRouteInstance().currentModel.blocked_info=e,e&&e.data[0]&&e.data[0].features_info&&e.data[0].features_info[0]&&e.data[0].features_info[0].details){let i=e.data[0].features_info[0].details;for(var t=i.length,a=0;a<t;a++)$L(".emailUnblocking."+i[a].field.api_name).removeClass("hide")}}))},checkIfFileUploadEmpty:function(e,t){t&&t.length&&e&&e.$ids&&e.$ids.fld_containerId?$L("#"+e.$ids.fld_containerId).find(".dv_info_label").addClass("mT8"):$L("#"+e.$ids.fld_containerId).find(".dv_info_label").removeClass("mT8")},refreshApprovalProcessComponent:function(e,t,a,i){var o=$("crm-detail-view")[0].component,s=$L("crm-detailview-content")[0].component,r=o.data;if(i||void 0!==e.$approval_state&&("approval_process_pending"===e.$approval_state||"approval_process_rejected"===e.$approval_state)&&void 0===a){var n=store.peekRecord("module",moduleRecordMapping[t].id).api_name,l=e.id;store.triggerAction("entity","approval_details",{module:n,name:t,entityId:l}).then((function(t){r.approval_process_data=t,i&&(e.$approval_state="approval_process_pending",e.$approved=!1,s.setData("record",e),r.record=e);var a=o.constructApprovalDetails(r);r.content_json.approvalProcessDetails=a,s.setData("approval_details",a);var n={};n.content_json=r.content_json,o.setData(n),r.approval_process_data=void 0,o.setData("approval_process_data",t)}),(function(){})),"approval_process_rejected"===e.$approval_state&&(detailViewModel.timeline_info=store.triggerAction("entity","timelines",{module:n,entityId:l,isFromApprovalProcess:!0},{per_page:1,filters:{field:{api_name:"source"},comparator:"in",value:["approval_process"]}}).then((function(e){return e})))}},refreshApprovalProcessLayer:function(e,t){store.findRecord(moduleRecordMapping[t].id,e.id,Crm.get_params_for_getRecord()).then((function(e){return Lyte.triggerEvent("detail_view_listener_"+$L("crm-detail-view")[0].component.getData("unique_listener_id"),{componentsToBeReloaded:["all_components"],approveDetails:void 0,isFromApprovalProcess:!0}),e}),(function(){}))},refreshProcessLayer:function(e){var t=$L("crm-detail-view")[0],a=document.querySelector("crm-detailview-content");e.$.triggerAction("blueprint").then((function(i){Lyte.Router.getRouteInstance().currentModel.blueprint_exec_info=i;var o=i.blueprint.process_info.field.id;if(t.component.blueprintFldId||($L("crm-detail-view")[0].component.blueprintFldId=o),e.$process_flow){var s=document.querySelector("crm-blueprint-layer");if(s)if(Lyte.Component.registeredComponents["crm-blueprint-layer"])s.component.executeMethod("setBlueprintData",i,!0);else r=(r=(r=[]).concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.js","crm-blueprint-exec-mixin.js","crux-criteria-component.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),Lyte.injectResources(r,void 0,(function(){s.component.executeMethod("setBlueprintData",i,!0)}))}else{var r;if(e.$process_flow=!0,Lyte.Component.registeredComponents["crm-blueprint-layer"])t.setData({fresh_record:e,record:objectUtils.cloneObject(e)}),$L("#blueprintLayerDiv")[0].scrollIntoView({behavior:"smooth",block:"start"});else r=(r=(r=[]).concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.js","crm-blueprint-exec-mixin.js","crux-criteria-component.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-blueprint-exec-rtl.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))),Lyte.injectResources(r,void 0,(function(){t.setData({fresh_record:e,record:objectUtils.cloneObject(e)}),$L("#blueprintLayerDiv")[0].scrollIntoView({behavior:"smooth",block:"start"})}))}if("Tasks"===t.getData("module")&&i.blueprint.process_info.field.api_name&&"Status"===i.blueprint.process_info.field.api_name){var n=$L("#btn_close_task")[0];n&&n.classList.add("dN")}Lyte.objectUtils(a.component.data.meta_info.fieldvsEditType,"add",i.blueprint.process_info.field.api_name,"showLock"),Lyte.objectUtils(a.component.data.meta_info.fieldVsTooltip,"add",o,I18n.getMsg("blueprint.field.lock.tooltip"))}),(function(i){if(i.response){var o=JSON.parse(i.response);if(o.code&&"RECORD_NOT_IN_PROCESS"===o.code){e.$process_flow=!1,t.setData({fresh_record:e,record:objectUtils.cloneObject(e)});var s=Lyte.Router.getRouteInstance().currentModel;if(s&&s.blueprint_exec_info&&s.blueprint_exec_info.blueprint){var r=Lyte.Router.getRouteInstance().currentModel.blueprint_exec_info.blueprint;Lyte.objectUtils(a.component.data.meta_info.fieldvsEditType,"add",r.process_info.field.api_name,"showEdit")}}}}));var i=e.id;if(e.$orchestration){var o=document.querySelector("crm-orchestration-detailview-pop");void 0!==o&&o.component.executeMethod("renderOrchestrationLayer",i)}if(e.$pathfinder){var s=document.querySelector("crm-pathfinder-detailview-pop");void 0!==s&&s.component.executeMethod("renderPathFinderLayer",i)}},setCscriptDataForLyteContainer:async function(e,t){if(e?$L(e)[0]:void 0){var{value:a,fldInfo:i,dataBind:o,moduleName:s,source:r}=t,n=async function(t){var n=$L(e)[0],l=n.component;if(l&&t){var d=Lyte.registeredMixins["crm-create-mixin"].filterValidPickListValues(o.$layout_id.id,i),c=$L("crm-blueprint-exec-fields#Crm_"+s+"_"+i.column_name+"_field crux-picklist-component")[0].component;if("string"==typeof a){d.filter((function(e){return e.display_value===a}))[0]&&(c.setData("cxPropValue",a),"Blueprint"===r&&(c.setData("cxPropErrorMessage",""),await l.executeMethod("checkPicklistDependency",n,void 0,a)),l.getMethods("getDropdownvalue")&&(delete o.skipCscriptTrigger,await l.executeMethod("getDropdownvalue",{},a,!0)))}else{var u=d.filter((function(e){return a.contains(e.display_value)})).mapByKey("display_value");u.length?(c.setData("cxPropValue",u),"Blueprint"===r&&c.setData("cxPropErrorMessage","")):a&&!a.length&&l.setData("fieldData",[])}}};if(i){let t=$L(e)[0].component;switch(i.data_type){case"userlookup":case"ownerlookup":var l=$L(e+" crux-user-dropdown")[0].component;if(a&&a.id){const e=store.peekRecord("user",a.id)||(await store.findRecord("user",a.id))[0];if(e){var d={id:e.id,full_name:e.full_name||e.name};l.setData("cxPropSelected",d.id),l.setData("cxPropSelectedUser",d)}}else a||(l.setData("cxPropSelected",""),l.setData("cxPropSelectedUser",void 0));break;case"multiuserlookup":case"multiselectlookup":break;case"lookup":if(a&&a.name&&a.id){d={id:a.id,name:a.name};var c=$L(e+" crux-lookup-component")[0].component;await c.executeMethod("triggerOnValueChange",d),"Blueprint"===r&&(c.setData("cxPropErrorMessage",""),await t.executeMethod("getLookupModuleFieldValues",d));break}if(!a){let t=$L(e)[0];t&&t.setData({lookupSingle:"",selectedSingle:{},selectedSingleId:"",fieldData:void 0})}break;case"multiselectpicklist":Array.isArray(a)&&await n.call(this,!0);break;case"picklist":(a=a&&"string"==typeof a&&a.trim()?a:"-None-")&&"string"==typeof a&&await n.call(this,!0);break;case"integer":case"currency":case"double":0===a||a&&!isNaN(a)?"currency"===i.data_type||"double"===i.data_type?t.setData("fieldData",Number(Number(a).toFixed(i.decimal_place))):t.setData("fieldData",Number(a)):null===a&&t.setData("fieldData",void 0),"PROBABILITY"!==i.column_name&&"AMOUNT"!==i.column_name||formComp&&Lyte.registeredMixins["crm-create-mixin"].setExpectedRevenue.call(formComp.component);break;case"boolean":t.setData("fieldData",a+""=="true");break;case"datetime":var u=$L.moment(Lyte.Transform.datetime.serialize(a));if(u){var p=Lyte.registeredMixins["crm-create-mixin"].getDateTimeForForm(u.getDObj(),!0);""===a&&(p=""),p.indexOf("TV")>-1&&(p=p.replace("TV","T")),$L(e+" crux-date-time-component")[0].component.setData("cxPropValue",p);var _={};_.moduleName=s,_.value=p,_.fldMeta=i,Lyte.registeredMixins["crm-create-mixin"].triggerCScriptUIUpdate(_)}break;case"date":a=null!=a?""+a:"",$L(e+" crux-date-component")[0].component.setData("cxPropValue",a);break;default:if("string"===i.json_type){if(a=null!=a?""+a:"",t.setData("fieldData",a.slice(0,i.length)),3===i.ui_type||110===i.ui_type){let t=$L(e)[0];t&&t.component&&t.component.increaseHeight(!0)}}else t.setData("fieldData",a)}}}},setOnChangeFieldValue:function(e,t,a){var i=store.peekRecord(moduleRecordMapping[this.getData("module")].id,this.getData("entityId"));if(i&&t&&t.pick_list_values){var o=t.pick_list_values.filter((function(t){return t.display_value===e}));if(o&&o.length){var s=o[0].probability;i.$.set("Probability",s),void 0!==a&&"object"==typeof a||(a={}),Object.assign(a,{Probability:s})}}return a}},{mixins:["crm-lookup-filter-mixin"]}),Lyte.Mixin.register("crm-detailview-parser",{afterModelHandler:function(e){if(e.converted_detail)return void 0!==e.converted_detail[0].Converted_Account&&(e.accountObj=e.converted_detail[0].Converted_Account),void 0!==e.converted_detail[0].Converted_Contact&&(e.contactObj=e.converted_detail[0].Converted_Contact),void 0!==e.converted_detail[0].Converted_Deal&&(e.dealObj=e.converted_detail[0].Converted_Deal),void("Leads"===e.module?(e.Leads=e.converted_detail[0],e.singularModName=moduleRecordMapping.Leads.singular_label,e.acntsingularModName=moduleRecordMapping.Accounts.singular_label,e.cntsingularModName=moduleRecordMapping.Contacts.singular_label,e.dealsingularModName=moduleRecordMapping.Deals.singular_label,e.fromConvertAction=!1,e.converted=!0,e.detailview_page=!0):(e.Leads=e.converted_detail[0],e.singularModName=moduleRecordMapping[e.module].singular_label,e.linkingObj=e.converted_detail[0].$converted_detail,e.linkingMoodulesingularModName=moduleRecordMapping[e.converted_detail[0].$converted_detail.module].singular_label,e.linkingMoodulepurlModName=moduleRecordMapping[e.converted_detail[0].$converted_detail.module].plural_label,e.fromConvertAction=!1,e.converted=!0,e.detailview_page=!0));if(e.validationRule){var t=e.validationRule,a=t.length,i={};for(let e=0;e<a;e++){var o=t[e];o.field_validation&&(i[o.field.api_name]=o.id)}e.fieldValidationDet=i}if(e.messages)return validationUtils.isEmpty(e.messages)&&(this.model.messages.error=!0),e.module="Messages",e.transitionData=objectUtils.cloneObject(this.transition.data),e.transitionData.recordId=this.transition.info.dynamicParams[1],this.constructComponentJson(e),void commonUtils.showHideLoadingDiv(!0);"Meetings"===e.module&&(e.module="Events"),e.transitionData=objectUtils.cloneObject(this.transition.data),void 0!==this.getQueryParams().sub_module&&"Activities"===e.module&&(e.parent_module=e.module,e.module=this.getQueryParams().sub_module),e.related_list||(e.related_list=[]),e.record=store.peekRecord(moduleRecordMapping[e.module].id,e.entId),e.detailview_buttons?e.detailview_buttons.actions.forEach((function(t){"portal_user_preference"===t.name&&(e.portalsUserTypeId=t.details.user_type.id)})):e.detailview_buttons={};var s=e.record.id+"_"+Math.floor(100*Math.random())+1;e.unique_listener_id=s;var r,n=store.peekRecord("module",moduleRecordMapping[e.module].id);e.module_sysrefname=n.api_name,r=e.record.$layout_id?e.record.$layout_id.id:e.record.Layout?e.record.Layout.id:n.layouts[0].id,e.layoutId=r,e.layout=e.layout_response[0].layouts.filter((function(t){return t.id===e.layoutId})),e.layout=e.layout[0],e.currentInstObjKey=this.getDynamicCurrentInstanceObjKey({actionName:"dv_lyte"});var l=Lyte.registeredMixins["crm-create-init-mixin"];l&&e.currentInstObjKey&&l.generateCurrentInstanceObject({instanceObjKey:e.currentInstObjKey,moduleData:n,moduleSections:e.layout.sections,moduleFields:n.fields}),e.cscript_properties={},this.constructComponentJson(e);var d=e.layoutRule;if("Calls"===e.module&&d&&Lyte.registeredMixins["crm-call-form-mixin"].removeMandatoryFromLayoutRules(d.layout_rule,"Who_Id"),d&&d.layout_rule){for(var c=d.layout_rule.length,u=0;u<c;u++)d.layout_rule[u].id=e.layoutId+"_"+u,d.layout_rule[u].layout=e.layoutId;store.pushPayload("layout_rule",d.layout_rule)}e.layout_rule=d,e.rules_execution_result={lr_exec_result:{}},this.data||(this.data={}),this.data.currentInstObjKey=e.currentInstObjKey,this.execute_layoutRules(e.record,e,this);var p=this.transition.data.affected_data;if(delete this.transition.data.affected_data,!1===Lyte.Router.history.fromHistory&&p){var _=e.tobe_highlighted_fields,m=e.content_json.meta_info.fieldAPINameVsIdMap,f=Math.floor(1e4*Math.random());for(let e in p[0])!m[e]||116!==m[e][1]&&118!==m[e][1]||Lyte.objectUtils(_,"add",e,f);e.tobe_highlighted_fields=_,setTimeout(this.removeHighlightedFields,5e3,f)}var v=this.fetchFilesForRenderingUsingData(e,moduleRecordMapping[e.module].related_lists);return Lyte.resolvePromises({filesResolved:Lyte.injectResources(v)})},constructComponentJson:function(e){var t=e.module;if(this.formHeaderData(e),e.messages)return this.parseBusinessCardFieldsForMessages(e),void this.formRightPanelData(e,t);"Events"!==e.sub_module&&this.parseBusinessCardFields(e,t),this.parseRecordActions(e,t),this.parseContentJson(e),this.populateLeftPanelInfo(e),this.formRightPanelData(e,t)},formRightPanelData:function(e,t){if("Activities"===Crm.activityGrp[t]){e.show_right_panel=!0;var a={};if(l=e.record.Who_Id?e.record.Who_Id:e.record.What_Id){var i=e.record.Who_Id&&e.record.Who_Id.id?crmModuleConstants.Contacts:moduleApiVsNameMapping[e.record.$se_module];this.populateRPShowInfo(a,i,t)}else e.show_right_panel=!1;var o=[];if(l){var s=l;s.record_module=i,o.push(s)}if(e.record.Who_Id&&e.record.What_Id){var r=e.record.What_Id;r.record_module=moduleApiVsNameMapping[e.record.$se_module],o.push(r)}if(e.record.$in_project_sync){var n={};n.id=e.record.id,n.name=I18n.getMsg("crm.project.integration.title"),n.record_module=moduleRecordMapping.Projects.module_name,o.push(n)}this.populateRPInfoModel(l,i,a,e,o)}if("Messages"===t){e.show_right_panel=!0;var l;a={};if(l=e.messages.record.sender){i=e.messages.record.sender?moduleApiVsNameMapping[e.messages.record.semodule]:crmModuleConstants.Contacts;this.populateRPShowInfo(a,i,t)}this.populateRPInfoModel(l,i,a,e)}},populateRPInfoModel:function(e,t,a,i,o){var s={};s.entity_name=e?e.name:void 0,s.rel_record_id=e?e.id:void 0,s.module=e?t:void 0,i.right_panel_info={},i.right_panel_info.module=t,i.right_panel_info.record_info=s,i.right_panel_info.show_info=a,o&&(i.right_panel_info.rp_records=o)},populateRPShowInfo:function(e,t,a){t===crmModuleConstants.Leads||t===crmModuleConstants.Contacts?(e.show_conversation_tab=!0,"Activities"!==Crm.activityGrp[a]&&(e.show_timeline_tab=!0)):t&&"Projects"!==t&&"Activities"!==Crm.activityGrp[a]&&(e.show_timeline_tab=!0),e.show_info_tab=!0},formHeaderData:function(e){e.header_model={}},formNavigationData:function(e,t){var a={};return a.id=e.recordId,a.recordNum=e.recordNum,a.cvid=e.cvid,a.userId=Crm.userDetails.USER_ID,a.module=t,a.fromIndex=e.FROM_INDEX,a.toIndex=e.TO_INDEX,e&&e.stageId&&(a.stageId=e.stageId),this.appendActivityNavigationData(t,a),JSON.stringify(a)},appendActivityNavigationData:function(e,t){"Activities"===Crm.activityGrp[e]&&("Activities"===e||(t.fromActSubModuleListView="true"),t.fromActivityListView="true",t.fromDetailView=!0)},parseContentJson:function(e){e.user_id=Crm.userDetails.USER_ID;var t,a,i,o,s,r=e.layout,n=e.layoutId,l=e.record,d=e.module,c=moduleRecordMapping[d],u=e.cscript_properties?e.cscript_properties:{},p=[],_=[],m=[],f=[],v={},h={},g={},y={},E={},C={},b={},L={},I={},D={},R={},T={},M={};this.populatePickListOptionsAsMapDependency(r.sections,l,n,h,D,M,R,T);var w=this.populateLockingInfo(e,c),S=r.sections;this.generateCurrentInstanceObject({instanceObjKey:e.currentInstObjKey,moduleSections:S});var k=S.length,A=!1,N=0,O=0,F=0,x=document.createElement("canvas"),P=getComputedStyle(document.querySelector(":root")),U=x.getContext("2d");U.font=`1.4rem ${P.getPropertyValue("--crm-font-regular")}`;var j=Lyte.Router.getRouteInstance().transition&&Lyte.Router.getRouteInstance().transition.isRequesterDV;if(e.record.$process_flow){var $=$L("crm-blueprint-layer");void 0!==e.blueprint_exec_info?this.blueprintFldId=e.blueprint_exec_info.blueprint.process_info.field_id:$.length>0&&(this.blueprintFldId=$[0].getData("processInfo").field.id),y[this.blueprintFldId]=I18n.getMsg("blueprint.field.lock.tooltip")}for(var V=0;V<k;V++){var H=S[V];if("used"===H.type){if("default"===H.generated_type){if("Record Image"===H.name){H.fields&&H.fields[0]&&(e.header_model.isProfileImageAccessible=!!H.fields[0].visible&&H.fields[0].visible,e.header_model.isProfileImageReadOnly=H.fields[0].read_only);continue}if("Quick create"===H.name||"Business Card"===H.name)continue;if(this.isSkipableDefaultSection(d,H,l))continue}H.contId=this.getSectionNameWithoutSpace(H.name);var B,Y=2===H.column_count,q=[],W=[],G=H.fields;B=n+"_"+H.id,this.sectionFldKey=B,G=G.sort(function(e,t){return e[this.sectionFldKey].sequence_number-t[this.sectionFldKey].sequence_number}.bind(this)),delete this.sectionFldKey;for(var z=!1,K=G.length,J=0,Z=0;Z<K;Z++){var Q=G[Z];if(!H.isSubformSection||(!z&&"SERIAL_NUMBER"!==Q.column_name&&!Q.subform&&Q.visible&&Q.view_type.view&&(z=!0),Q.subform)){var X=objectUtils.cloneObject(Q);if(this.populateFieldAttributes(Q,X,"view",d,l),this.populateCsriptPropInToField(X,u,v,y),"STAGE"===Q.column_name&&(i=!0,m=Q[n]&&Q[n].pick_list_values&&Q[n].pick_list_values.length?Q[n].pick_list_values:[]),"PIPELINE"===Q.column_name&&(o=!0,Q[n]&&Q[n].pick_list_values&&Q[n].pick_list_values.length)){var ee=Q[n].pick_list_values.filter((function(e){if(e.display_value===l.Pipeline)return e}));ee.length&&ee[0].maps&&ee[0].maps.length&&(f=ee[0].maps[0].pick_list_values)}if("CTIVOICEURL"===Q.column_name&&"Calls"===d&&(X.preview=!0),Crm.userDetails.IS_SMART_PROMPT_AVAILABLE&&Lyte.registeredMixins.smart_prompt_handler.detailLyteFieldCheck(d,Q.column_name,Q,l)&&(E[Q.api_name]=!0),A||"Segment_Label"!==Q.api_name||13!==Q.show_type||(A=!0),this.populateFOL(Q,I),this.getDefaultCriteriaForLookupField(C,d,Q,l),this.getRelatedRecordInfoForLookup(b,L,Q,l,D,M),h[Q.api_name]&&0!==h[Q.api_name].length||!Q[n]||!Q[n].pick_list_values||(h[Q.api_name]=Q[n].pick_list_values),Q.pick_list_values&&Q.pick_list_values.length>0){var te=this.checkAndAppendOptionToPicklist(l[Q.api_name],h[Q.api_name],Q);h[Q.api_name]=te}if(Q.colour_code_enabled&&"Events"===d&&Crm.calPreferences.USERCOLOURCODE&&(h[Q.api_name].forEach((function(e){Crm.calPreferences.USERCOLOURCODE[e.id]&&(e.colour_code=Crm.calPreferences.USERCOLOURCODE[e.id])})),X.pick_list_values.forEach((function(e){Crm.calPreferences.USERCOLOURCODE[e.id]&&(e.colour_code=Crm.calPreferences.USERCOLOURCODE[e.id])}))),Q.lookup&&Q.lookup.query_details){var ae=Q.lookup.query_details,ie={};ie.query_id=ae.query_id,g[Q.api_name]=JSON.stringify(ie)}if("CLOSINGDATE"===Q.column_name&&Q.read_only&&(s=!0),"CURRENCYISOCODE"===Q.column_name&&(t=Q.api_name),"EXCHANGERATE"===Q.column_name&&(a=Q.api_name),Q.ui_type!==CrmField.UITYPES.TAGS||j||(e.header_model.tag_supported_mod=!0),this.isViewableField(Q,d,l)){J++;var oe=this.getDVFieldLabelWidthColumnWise(Q.field_label,U);if(Y&&(Q[B].sequence_number+1)%2==1?(W.push(X),oe>F&&(F=oe)):(q.push(X),oe>O&&(O=oe)),this.showLock_supported_fields[e.module]&&this.showLock_supported_fields[e.module].contains(Q.column_name))v[Q.api_name]="showLock";else if(this.isAjaxEditableField(X,d,l)||X.read_only){var se=this.handleMouseActions(X,l,e.module,r.id,w);v[Q.api_name]=se}X[n]&&X[n].required&&(X[n].isLayoutConfigLevelMandatory=!0)}else{var re=this.handleMouseActions(Q,l,e.module,r.id,w);this.handleNonViewAbleField(e,X,v,re)}}}if(!H.isSubformSection||z){var ne=[];ne.push(q),Y&&ne.push(W),(q.length||W.length)&&(H.detailviewColumns=ne,N>100?_.push(H):p.push(H),N+=J)}}}if(o&&m.length&&f.length&&(f=this.getStages(f,m)),0!==e.header_model.title_card_fields.length){var le=Lyte.Component.registeredHelpers.getFieldViewValue(e.header_model.title_card_fields[0],l,d,!0);le&&"multi_module_lookup"===e.header_model.title_card_fields[0].data_type&&(le=le.name),e.entity_name=le}var de={};de.currency_apiname=t,de.exchangerate_apiname=a,de.show_strip=i,de.pipeline_enabled=o,de.stage_object={},de.stage_object.record_stages=o?f:m,de.stage_object.closing_date_readonly=s,de.fieldvsEditType=v,de.fieldvsOptions=h,de.fieldvsQuery=g,de.fieldvsdefaultCriteria=C,de.folFieldDetails=I,de.fieldColumnNameMap=D,de.moduleVsLookupFields=M,de.fieldAPINameVsIdMap=R,de.fieldVsRelatedRecInfo=b,de.fieldVsRelatedRecords=L,de.subordinate_listing_needed=!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users,de.isSegmentAvailable=A,de.fieldVsTooltip=y,de.smart_prompt_field=E,de.phone_new_view=Crm.userDetails.isPhoneNoNewView,de.ziaOwnerRecommendationEnabled=e.ziaOwnerRecommendationEnabled,e.tobe_highlighted_fields=T;var ce=void 0!==e.transitionData&&e.transitionData.kafkaWFData,ue=!1;ce&&(ue=ce.refreshInWms);var pe={};pe.show_business_card=r.show_business_card&&!d.startsWith("Orchestration")&&!0==!d.startsWith("PathFinder"),e.nobcFieldsVisible&&(pe.show_business_card=!1),pe.show_section_info=!ue&&!0===Crm.userDetails.CUSTOMIZE_INFO.show_detail_view,pe.show_timeline_tab=!ue&&!Crm.userDetails.CLIENT_ACCOUNT,pe.show_data_privacy_tab=!ue&&this.canWeShowDataPrivacyTab(e.detailview_buttons?e.detailview_buttons.actions:[]),pe.show_tab_header=!ue&&!j;var _e=Crm.userDetails.LICENSE_TYPE,me={};me.premium_user="U"===_e||"A"===_e||"E"===_e||"C"===_e||"Z"===_e,c.presence_sub_menu&&!0===c.visible&&"linking"!==c.generated_type&&this.zia_unsupported_modules.indexOf(d)<0&&(me.prediction_supported=!0,me.churn_supported=!0,me.recommend_supported=!0,"Leads"!==d&&"Potentials"!==d&&"Deals"!==d||(me.zia_score_supported=!0),"Potentials"!==d&&"Deals"!==d&&"Leads"!==d||(me.nba_supported=!0),!Crm.userDetails.isBestTimeEnabled||"Leads"!==d&&"Contacts"!==d&&"Deals"!==d&&"Potentials"!==d||-1!==this.best_time_unsupported_status.indexOf(l.$approval_state)||(me.best_time_supported=!0),(d===moduleRecordMapping.Leads.module_name||d===moduleRecordMapping.Contacts.module_name||moduleRecordMapping.Calls&&d===moduleRecordMapping.Calls.module_name)&&(me.zia_call_analytics_supported=!0),"Leads"!==d&&"Contacts"!==d||!moduleRecordMapping[d].isCompetitorMentionEnabled||(me.competitor_mentions_supported=!0));var fe={isKioskAssocLimitReached:!1},ve={};void 0!==e.approval_process_data&&(ve.approval_state=e.record.$approval_state,ve.showRespondLink=e.record.$approval.approve,ve.delegateDeactivate=e.record.$approval.delegate,ve.hasresubmitLink=e.record.$approval.resubmit,ve=this.constructApprovalDetails(e));var he=this.constructReviewDetails(e),ge=p.length>=1?p:_;ge.length>=1&&void 0!==e.review_process_data&&this.constructFieldIndexing(he,ge);var ye={};ye.viewable_sections=p,ye.columnwise_fld_width=[O,F],ye.after_render_sections=_,ye.show_info=pe,ye.meta_info=de,ye.zia_info=me,ye.kiosk_info=fe,ye.recordLockingDetails=w,ye.approvalProcessDetails=ve,ye.reviewProcessDetails=he,e.content_json=ye},populateCsriptPropInToField:function(e,t,a,i){if(t&&t[e.api_name])for(var o=t[e.api_name],s=Object.keys(o),r=s.length,n=0;n<r;n++){var l=s[n];switch(l){case"tooltip":e.tooltip||(e.tooltip={}),e.tooltip.name=o[l].name,e.tooltip.value=o[l].value;break;case"masking_info":a&&!a[e.api_name]&&(a[e.api_name]="showEmpty");break;case"value_tooltip":i&&!i[e.id]&&(i[e.id]=o[l]);break;case"length":case"read_only":e[l]=o[l]}}},isSkipableDefaultSection:function(e,t,a){switch(e){case"Events":if("Event Quick View"===t.name||"Event Additional Information"===t.name||"Event Information"===t.name&&t.fields.filterBy({column_name:"SMCREATORID"}).length)return!0;break;case"Services":return"Availability Information"===t.name;case"Calls":return!this.isAvailableSectionForCallType(t.name,a);case"PriceBooks":return"Pricing Details"===t.name&&!a.Pricing_Model}return!1},getDVFieldLabelWidthColumnWise:function(e,t){var a=t.measureText(e).width;return a>170&&(a=170),a},handleNonViewAbleField:function(e,t,a,i){t.ui_type===CrmField.UITYPES.TERRITORY&&1===Crm.userDetails.TMENABLED&&Crm.userDetails.TERRITORY_COUNT_BASED_USER>1&&(e.business_card_section.detailviewColumns[0].push(t),a[t.api_name]=i)},populateLeftPanelInfo:function(e){var t=e.module,a=[],i={};if("Activities"===Crm.activityGrp[t]||t.startsWith("Orchestration")||t.startsWith("PathFinder")||this.transition.isRequesterDV)i.show_panel=!1,i.show_open_icon=!1;else{var o=void 0!==e.transitionData&&e.transitionData.kafkaWFData,s=!1;o&&(s=o.refreshInWms),s||a.push("list"),"Potentials"===t&&a.push("summary"),"Services"===t||"Appointments"===t||Crm.userDetails.LITE.IS_LITE_USER||a.push("link"),a.push("followers"),i.leftPanelItems=a,Crm.userDetails.CUSTOMIZE_INFO.show_left_panel?(i.show_panel=!0,i.tool_tip_label=I18n.getMsg("crm.accessibility.hide.detail.panel")):(i.show_panel=!1,i.tool_tip_label=I18n.getMsg("crm.accessibility.show.detail.panel")),i.show_open_icon=!0}i.loadExistingCount=!0,e.left_panel_info=i},populatePickListOptionsAsMapDependency:function(e,t,a,i,o,s,r,n){for(var l=e.length,d=0;d<l;d++){var c=e[d];if("used"===c.type&&("default"!==c.generated_type||"Record Image"!==c.name&&"Quick create"!==c.name&&"Business Card"!==c.name))if(c.isSubformSection)c.fields.forEach((function(e){500!==e.ui_type&&e.subform&&(r[e.api_name]=[e.id,e.ui_type],n[e.api_name]=0)}));else for(var u=c.fields,p=u.length,_=0;_<p;_++){var m=u[_];o[m.column_name]=[m.id,m.api_name],r[m.api_name]=[m.id,m.ui_type],n[m.api_name]=0;var f=m.lookup;if("lookup"===m.data_type&&f&&f.module){var v=moduleApiVsNameMapping[f.module.api_name],h=s[v];h||(h=[]),h.push(m.column_name),s[v]=h}this.populateFieldVsOptionsForField(m,a,i,t)}}},populateFieldVsOptionsForField:function(e,t,a,i){var o=e[t];if(o&&o.pick_list_values)for(var s=o.pick_list_values,r=s.length,n=0;n<r;n++){var l=s[n];if(i&&l&&l.maps&&(!i[e.api_name]&&"-None-"===l.display_value||i[e.api_name]===l.display_value))for(var d=l.maps,c=d.length,u=0;u<c;u++){var p=d[u];a[p.api_name]=p.pick_list_values}}},getSectionNameWithoutSpace:function(e){return e?e.replace(/ |'/g,"_"):""},parseBusinessCardFieldsForMessages:function(e){for(var t=[],a=e.fields,i=a.length,o=0;o<i;o++){var s=a[o],r=objectUtils.cloneObject(s);"sender__s"===s.api_name&&(r.api_name="sender",this.populateFieldAttributes(s,r,"title"))}t.push(r),e.header_model.isProfileImageAccessible=!0,e.header_model.title_card_fields=t},parseBusinessCardFields:function(e,t){var a=e.layout?e.layout:e.business_card,i=e.layoutId,o=e.record,s=e.cscript_properties?e.cscript_properties:{},r=["Leads","Contacts","Accounts","Potentials","Campaigns","Cases","Products","PurchaseOrders","PriceBooks"],n=["Campaigns"],l=[],d=[],c=this.getBusinessCardSection(a);e.business_card||(e.header_business_card=c);var u=c.fields,p=u.length;"Calls"===t&&(p=6);var _=i+"_"+c.id;u.sort((function(e,t){return e[_].sequence_number-t[_].sequence_number}));for(var m=0;m<p;m++){var f=u[m],v=objectUtils.cloneObject(f);if(v[i]&&v[i].required&&(v[i].isLayoutConfigLevelMandatory=!0),f.visible)switch(this.populateFieldAttributes(f,v,"business_card",t,o),this.populateCsriptPropInToField(v,s),f[_].sequence_number){case 1:if("Calls"===t){if(void 0!==e.record[v.api_name]||"Leads"===e.record.$se_module&&void 0!==e.record.What_Id){d.push(v);var h=objectUtils.cloneObject(v);l.push(h),this.populateFieldAttributes(f,h,"title",t,o);break}d.push(v)}else l.push(v),this.populateFieldAttributes(f,v,"title",t,o);break;case 2:if(r.contains(t)){l.push(v),this.populateFieldAttributes(f,v,"title",t,o);break}if("Calls"===t&&0===l.length&&void 0!==e.record[v.api_name]){d.push(v);h=objectUtils.cloneObject(v);l.push(h),this.populateFieldAttributes(f,h,"title",t,o);break}d.push(v);break;case 3:if(n.contains(t)){l.push(v),this.populateFieldAttributes(f,v,"title",t,o);break}d.push(v);break;default:d.push(v)}}e.header_model.title_card_fields=l,0===l.length&&"Calls"===e.module&&this.populateDefaultValue(e),0===d.length&&(e.nobcFieldsVisible=!0);var g=[];g.push(d),e.business_card_section={},e.business_card_section.name=c.name,e.business_card_section.contId=this.getSectionNameWithoutSpace(c.name),e.business_card_section.detailviewColumns=g},getBusinessCardSection:function(e){for(var t,a=(t=e[0]?e[0].sections:e.sections).length,i=0;i<a;i++){var o=t[i];if(o&&"Business Card"===o.api_name)return o}},populateFieldAttributes:function(e,t,a,i,o,s){var r={},n={},l={};switch(this.getLookupIconClass&&this.getLookupIconClass(t,l),t.component_data_type=t.data_type,t.ui_type){case CrmField.UITYPES.LAYOUT:case CrmField.UITYPES.WIZARD:t.component_data_type="layout";break;case CrmField.UITYPES.SKYPE_FIELD:t.component_data_type="skype";break;case CrmField.UITYPES.TERRITORY:t.component_data_type="territory";break;case CrmField.UITYPES.FAX:t.component_data_type="fax_phone";break;case CrmField.UITYPES.TWITTER:t.component_data_type="twitter";break;case CrmField.UITYPES.DATA_PARAM:t.component_data_type=t.rollup_summary.return_type;break;case CrmField.UITYPES.RICHTEXT:t.component_data_type="richtext";break;default:"formula"===t.data_type&&(t.component_data_type=t.formula.return_type),"STARTDATETIME"!==e.column_name&&"ENDDATETIME"!==e.column_name||"Events"!==i||!0!==o.All_day||(t.component_data_type="date"),"Activities"===Crm.activityGrp[i]&&("CONTACTID"===e.column_name&&"Calls"===i||"SEID"===e.column_name)&&(t.component_data_type="activity_mml"),"Events"!==i||1234!==e.ui_type&&104!==e.ui_type?1234===e.ui_type&&(t.component_data_type="remindat"):t.component_data_type="multi_reminder","CTIVOICEURL"===e.column_name&&(t.component_data_type="voicenote")}var d=e.column_name;switch(s&&(d=s+"_"+d),a){case"view":r.valueZcqa="value_"+e.display_label,r.valueIputZcqa=e.display_label,r.labelZcqa="dtVw_lbl_"+e.column_name,r.fldLblManZcqa="mandate_ast_"+e.column_name,n.valueId="subvalue_"+d,n.labelId="labelTD_"+d,n.ajaxEdit_containerId="ajaxEdit_"+d,n.value_containerId="value_"+d,n.fld_containerId="mouseArea__"+d,n.fldLblManId="mandate_ast_"+d,n.saveCancelContainerId=a+"_"+d,n.fldAjxSaveId=a+"_"+d,n.fldAjxCancelId=a+"_"+d,r.fldAjxSaveZcqa="saveAjaxEdit_"+a+"_"+d,r.fldAjxCancelZcqa="cancelAjaxEdit_"+a+"_"+d,r.fldAjxEditIconZcqa="edit_icon_"+a+"_"+d,l.is_highlight=!1;break;case"business_card":r.valueZcqa="bc_value_"+e.display_label,r.valueIputZcqa=e.display_label,r.labelZcqa="bc_dtVw_lbl_"+e.column_name,r.fldLblManZcqa="mandate_ast_"+e.column_name+"_header",n.valueId="headervalue_"+e.column_name,n.labelId="headerlabel_"+e.column_name,n.ajaxEdit_containerId="headerAjaxEdit_"+e.column_name,n.value_containerId="header_"+e.column_name,n.fld_containerId="bc_mouseArea__"+e.column_name,n.fldLblManId="mandate_ast_"+e.column_name+"_header",n.saveCancelContainerId=a+"_"+d,n.fldAjxSaveId=a+"_"+d,n.fldAjxCancelId=a+"_"+d,r.fldAjxSaveZcqa="saveAjaxEdit_"+a+"_"+d,r.fldAjxCancelZcqa="cancelAjaxEdit_"+a+"_"+d,r.fldAjxEditIconZcqa="edit_icon_"+a+"_"+d,l.is_highlight=!1;break;case"title":r.valueZcqa="value_"+e.column_name,r.labelZcqa="titlecard_dtVw_lbl_"+e.column_name,n.valueId="titlecard_"+e.column_name,n.labelId="titlecard_labelTD_"+e.column_name,n.containerId="titlecard_mouseArea__"+e.column_name,n.value_containerId="title_"+e.column_name,n.fld_containerId="tc_mouseArea__"+e.column_name,l.is_highlight=!1;break;case"ajaxpopup":r.valueZcqa="ajaxPop_"+e.display_label,n.valueId="ajaxPop_Crm_"+i+"_"+e.column_name,n.labelId="ajaxPop_"+n.valueId+"_label",n.containerId="ajaxPop_"+i+"_fldRow_"+e.column_name;break;case"right_panel":r.valueZcqa="rp_value_"+e.display_label,r.labelZcqa="rp_dtVw_lbl_"+e.column_name,n.valueId="rpvalue_"+e.column_name,n.labelId="rplabel_"+e.column_name,n.value_containerId="rightPanel_"+e.column_name,n.fld_containerId="rp_mouseArea__"+e.column_name,l.rp_bcIcon=this.rightPanelFieldsIcons[e.column_name];break;case"right_panel_deal_summary":r.valueZcqa="rp_ds_value_"+e.display_label,r.labelZcqa="rp_ds_dtVw_lbl_"+e.column_name,n.valueId="rp_ds_value_"+e.column_name,n.labelId="rp_ds_label_"+e.column_name,n.value_containerId="rP_dealSum_"+e.column_name,n.fld_containerId="rP_dealSum__mouseArea__"+e.column_name}t.$ids=n,t.$zcqa=r,t.$classes=l},parseRecordActions:function(e){var t=e.detailview_buttons;if(t&&t.actions){var a,i=t.actions,o=i.length,s=0,r=!1,n=!1;"Calls"!==e.module&&"Appointments"!==e.module||i.forEach((function(e){"clubbed_button"===e.type&&(n=!0)}));for(var l=0;l<o;l++){if("delete"===i[l].name&&"review_process_rejected"===e.record.$approval_state&&(e.detailview_buttons.actions[l].type="button"),"enrich_data"===i[l].name&&e.enrich_data&&(e.show_enrich_strip=!0),"icon"===i[l].type&&"shared_icon"===i[l].name){e.shared_details=i[l].details;var d=$ESAPI.encoder().encodeForHTML(e.shared_details.shared_by.name);e.shared_details.sharedUserName=d,e.shared_details.shared_user_count=e.shared_details.shared_user_count-1,e.detailview_buttons.actions.splice(l,1),o-=1}if("call"===i[l].name&&(r=!0),"button"===i[l].type&&("send_mail"===i[l].name||"send_dm"===i[l].name)){if(a)(u={}).display_label=i[l].display_label,u.name=i[l].name,u.type="clubbed_button",u.category="1",a.club_actions.push(u);else(a={}).display_label=i[l].display_label,a.name=i[l].name,a.type="clubbed_button",a.category="1",a.club_actions=[],a.hide=!0;s=l+1}if(!n&&"Calls"===e.module&&"0"===i[l].category)if(a){(u={}).display_label=i[l].display_label,u.name=i[l].name,u.type="clubbed_button",u.category="1",a.club_actions.push(u)}else{(a={}).display_label=i[l].display_label,a.name=i[l].name,a.type="clubbed_button",a.category="1",a.club_actions=[];var c=Lyte.Component.registeredHelpers.whichPBService();"ZPB"!==c&&"CRM_TELEPHONY"!==c||(a.hide=!0),s=l}if(!n&&"Appointments"===e.module&&("mark_as_completed"===i[l].name||"reschedule"===i[l].name||"cancel"===i[l].name)){var u;if(a)(u={}).display_label=i[l].display_label,u.name=i[l].name,u.type="clubbed_button",u.category="1",a.club_actions.push(u);else(a={}).display_label=i[l].display_label,a.name=i[l].name,a.type="clubbed_button",a.category="1",a.club_actions=[];e.detailview_buttons.actions.splice(l,1),o-=1,l-=1}if("team_based"===moduleRecordMapping[e.module].access_type&&"Requesters"===moduleRecordMapping[e.module].private_profile.name){t.actions={};break}if("meet_now"===i[l].name||"schedule_online_meeting"===i[l].name){let t=!1;if(!Crm.calPreferences||!Crm.calPreferences.MEETINGPREFDETAILS||"Leads"!==e.module&&"Contacts"!==e.module||"Free"===Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME||Crm.userDetails.LITE.IS_LITE_USER||(t=!0),t){if("meet_now"===i[l].name){var p=JSON.parse(Crm.calPreferences.MEETINGPREFDETAILS);let e=p.length;if(e>1){var _=[];for(let t=0;t<e;t++){let e=p[t].toolName,a={name:e,display_label:Events.displayToolName[e],toolType:"provider"};_.push(a)}i[l].sub_actions=_}else 1===e&&(i[l].toolName=p[0].toolName)}}else e.detailview_buttons.actions.splice(l,1),o-=1,l-=1}}var m=i.length;for(l=0;l<m;l++){if(i[l]&&"send_dm"===i[l].name){i.splice(l,1);break}i[l]&&"send_mail"===i[l].name&&l+1<m&&"send_mail"===i[l+1].name&&i.splice(l,1)}if(!a||!a.name||"send_mail"!==a.name&&"send_dm"!==a.name||"Leads"!==e.module&&"Contacts"!==e.module||i.splice(s-1,0,a),!r&&("Leads"===e.module||"Contacts"===e.module||"Calls"===e.module)){var f={category:"1",display_label:I18n.getMsg("Call"),name:"call",type:"button"};i.splice(s,0,f)}!n&&a&&"Calls"===e.module&&i.splice(s+1,0,a),!n&&a&&"Appointments"===e.module&&i.splice(0,0,a)}},parseRightPanelData:function(e,t){for(var a=[],i={},o={},s=t.sections,r=s.length,n=this.rightPanelFields[e],l=e===crmModuleConstants.Leads||e===crmModuleConstants.Contacts,d=0;d<r;d++){var c=s[d];if(c.fields)for(var u=(_=c.fields).length,p=0;p<u;p++){o[(m=_[p]).column_name]=[m.id,m.api_name]}if(l||"default"===c.generated_type&&"Business Card"===c.name){if(l){if("used"!==c.type)continue;if("default"===c.generated_type&&("Record Image"===c.name||"Quick create"===c.name||"Business Card"===c.name))continue}var _;for(u=(_=c.fields).length,p=l?0:1;p<u;p++){var m=_[p];if(!(l&&n.indexOf(m.column_name)<0)){var f=objectUtils.cloneObject(m);this.populateFieldAttributes(m,f,"right_panel"),a.push(f)}}}}i.fieldColumnNameMap=o,this.setData("meta_info",i),this.setData("info_fields",a)},parseAndSetCurrencyValue:function(e,t,a,i,o,s){var r,n=[],l=(n=featuresAvailable.MultiCurrency&&void 0!==Crm.userDetails.CURRENCY_DETAILS[e]?returnJson.entityMapJson.EXCHANGERATE&&returnJson.entityMapJson.EXCHANGERATE.defaultvalue?currencyUtils.returnValueInDefaultCurrencyAsArray(e,t,Crm.userDetails.CURRENCY_DETAILS[e].decimals,parseFloat(returnJson.entityMapJson.EXCHANGERATE.defaultvalue)):currencyUtils.returnValueInDefaultCurrencyAsArray(e,t,Crm.userDetails.CURRENCY_DETAILS[e].decimals):currencyUtils.returnValueInDefaultCurrencyAsArray(e,t))[0];featuresAvailable.MultiCurrency&&a.Currency&&Crm.userDetails.BASE_CURRENCY!==a.Currency&&(l=n[1],(r=a.$home_converted_currency?Lyte.deepCopyObject(a.$home_converted_currency):{})[i]=n[0].trim(),Lyte.objectUtils(a,"add","$home_converted_currency",r));(r=a.$formatted_currency?Lyte.deepCopyObject(a.$formatted_currency):{})[i]=l.trim();var d=isNaN(r[i]);if(d&&delete r[i],Lyte.objectUtils(a,"add","$formatted_currency",r),Crm.userDetails.isSubformNewComponentEnabled){var c=isNaN(t)||d?void 0:parseFloat(t);c=o&&s?s:c;var u={id:a.id};u[i]=""===c?void 0:c,store.pushPayload(a.$.model._name,u)}else Lyte.objectUtils(a,"add",i,isNaN(t)||d?void 0:parseFloat(t))},processOneLayoutRules:function(e,t,a,i){var o=e.sections,s=e.fields,r=Lyte.registeredMixins["crm-create-mixin"];t.forEach((function(e){var t=s.filter((function(t){return t.id===e.primary_field.id}))[0];t&&t.visible&&e.queries.forEach((function(e){var t=r.checkCriteriaMatchForCanvas(e.criteria,a,r);e.actions.forEach((function(e){"Show_Fields"===e.type&&e.fields.forEach((function(e){var a=s.filter((function(t){return t.id===e.id}))[0];a&&t!==a.view_type[i]&&(t?(a.view_type[i]=!0,a.isHiddenInLR=!1):(a.view_type[i]=!1,a.isHiddenInLR=!0))})),"Show_Sections"===e.type&&e.sections.forEach((function(e){var a=o.filter((function(t){return t.name===e}))[0];a&&(a.isHiddenInLR=!t)}))}))}))}))},getStages:function(e,t){for(var a=e.length,i=[],o=0;o<a;o++)i.push(e[o].id);return e=[],i.forEach((function(a){t.filter((function(t){t.id===a&&e.push(t)}))})),e},getRecurringInfoForTask:function(e){if(e){var t=crmTasks.convertRruleToMap(e.RRULE),a=t.FREQ,i=t.INTERVAL,o=CrmDateUtils.convertDateToUserPattern(t.DTSTART,void 0,!0),s=t.UNTIL?t.UNTIL:void 0;"-1"===s&&(s=this.getEndDateForNeverEndingTask(t)),s=CrmDateUtils.convertDateToUserPattern(s,void 0,!0);var r="",n={1:"First",2:"Second",3:"Third",4:"Fourth",5:"Last","-1":"Last"},l={1:"Sunday",2:"Monday",3:"Tuesday",4:"Wednesday",5:"Thursday",6:"Friday",7:"Saturday"};switch(a){case"DAILY":r=I18n.getMsg("crm.event.day2",[i,o,s]);break;case"WEEKLY":for(var d="",c=["SU","MO","TU","WE","TH","FR","SA"],u=t.BYDAY.split(","),p=u.length,_=0;_<p;_++){var m=c.indexOf(u[_])+1;d+=""===d?I18n.getMsg(l[""+m]):","+I18n.getMsg(l[""+m])}r=I18n.getMsg("crm.every.week",[d,o,s,i]);break;case"MONTHLY":_=0;if(h=t.BYMONTHDAY)r=I18n.getMsg("crm.every.month1",[h,i,o,s]);else{h=t.BYSETPOS,h=I18n.getMsg("lowercase"+n[h].toLowerCase());var f=t.BYDAY,v=(c=["SU","MO","TU","WE","TH","FR","SA"]).indexOf(f)+1;v=I18n.getMsg(l[""+v]),r=I18n.getMsg("crm.every.month2",[h,v,i,o,s])}break;case"YEARLY":var h=t.BYMONTHDAY,g=I18n.getMsg({1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}[t.BYMONTH]);if(h)r=I18n.getMsg("crm.every.year1",[h,g,o,s]);else{f=t.BYDAY;c=["SU","MO","TU","WE","TH","FR","SA"],h=t.BYSETPOS,h=I18n.getMsg("lowercase"+n[h].toLowerCase());v=c.indexOf(f)+1;v=I18n.getMsg(l[""+v]),r=I18n.getMsg("crm.every.year2",[h,v,g,o,s])}}return r}},getEndDateForNeverEndingTask:function(e){var t=e.FREQ,a=parseInt(e.INTERVAL),i=$L.moment(e.DTSTART).toDate();switch(t){case"DAILY":if(e.BYDAY)for(var o=a*(crmConstants.recurringEndDateLimit[t.toLowerCase()]-1),s=e.BYDAY;o>0;){i.setDate(i.getDate()+1);const e=["SU","MO","TU","WE","TH","FR","SA"][i.getDay()];s.includes(e)&&o--}else i.setDate(i.getDate()+a*(crmConstants.recurringEndDateLimit[t.toLowerCase()]-1));break;case"WEEKLY":crmTasks.setPossibleEndDateForWeekly(i,e.BYDAY.split(","),a,!0);break;case"MONTHLY":case"YEARLY":var r,n,l;if(r=e.BYMONTHDAY,n="YEARLY"===t?parseInt(e.BYMONTH)-1:void 0,r)r=parseInt(r),l=1;else{l=2;var d=parseInt(e.BYSETPOS);d=-1===d?5:d;var c=["SU","MO","TU","WE","TH","FR","SA"].indexOf(e.BYDAY)+1;r=crmTasks.getmonthspecificday(i,c,d)}crmTasks.setPossibleEndDateForMonthlyOrYearly(i,l,a,r,d,c,t,n)}return i},canWeShowDataPrivacyTab:function(e){if(!e)return!1;let t=e.length;for(let a=0;a<t;a++)if(e[a]&&"data_privacy"===e[a].name)return e.splice(a,1),!0;return!1},populateLockingInfo:function(e,t,a){var i={allowed_fields:[],fieldIds:[],recordDtl:{LockedReason:""},isLocked:!1,restricted_actions:[],restricted_communications:[],restricted_custom_buttons:[]},o=t.fields.filter((function(e){return"ISLOCKED"===e.column_name}))[0];o=o?o.api_name:o,i.lockedFieldApiName=o;var s=e.locking_configuration,r=e.lockedRecordDetails?e.lockedRecordDetails.data:void 0,n=e.record,l=!1,d="Pending for Review"===n.$review||"Pending for ReReview"===n.$review||"Review in Progress"===n.$review||"zia_vision_pending"===n.$approval_state||"zia_vision_validation"===n.$approval_state||"approval_process_pending"===n.$approval_state;if(n&&(n[o]||a)&&!n.$stop_processing&&s&&!d){var c,u,p,_=Crm.userDetails.permissions["Crm_Implied_Lock_"+e.module],m=_,f=r?r.length:0,v=[],h=[],g=[],y=[],E=!1;n&&n[o]&&(_=!1,l=n.$locked_for_me);var C=e.lockingInfoFields;C&&C.length&&(C=C.filter((function(e){return"Lock_Source__s"===e.api_name}))),C=C&&C[0]?C[0].pick_list_values:void 0;for(var b=s.length,L=0;L<b;L++){var I=s[L];if("automatic"!==I.lock_type&&a&&(p=!0),r&&f){var D=r.filter((function(e){return e.Record_Locking_Configuration_Id__s===I.id}));if(D&&D.length){if(l){var R=!0;if("all_profiles"!==I.locked_for)for(var T=I.lock_excluded_profiles?I.lock_excluded_profiles.length:0,M=0;M<T;M++){if(I.lock_excluded_profiles[M].name===Crm.userDetails.PROFILE_NAME){R=!1;break}}R&&y.push(I.id)}for(var w=0;w<f;w++){var S=D[w],k=C?C.filter((function(e){return e.display_value===S.Lock_Source__s})):void 0;"Automatic"===(k=k&&k[0]?k[0].actual_value:void 0)?(u="automatic",g.push(I)):"Manual"===k&&"automatic"!==u&&(u="manual","orchestration"===I.feature_type?(E=!0,h.push(I)):"record_locking"!==I.feature_type||E||v.push(I))}}}}if(a&&(i.isLockAllowed=_&&p),u){c="automatic"===u?g:"manual"===u&&E?h:v;var A=[];if(i.isLocked=!0,c&&c.length){var N=!0;for(L=0;L<f;L++){var O=c.filter((function(e){return e.id===r[L].Record_Locking_Configuration_Id__s}));if(O){if(O=O[0],l&&!y.contains(O.id))continue;if(O.excluded_fields=O.excluded_fields?O.excluded_fields:[],N&&(i.allowed_fields=O.excluded_fields,i.recordDtl.Locked_Time=r[L].Locked_Time__s,N=!1),i.allowed_fields=i.allowed_fields.intersection(O.excluded_fields),l){O.restricted_actions&&(i.restricted_actions=Array.from(new Set(i.restricted_actions.concat(O.restricted_actions)))),O.restricted_communications&&(i.restricted_communications=Array.from(new Set(i.restricted_communications.concat(O.restricted_communications))));var F=O.restricted_custom_buttons?O.restricted_custom_buttons.map((e=>e.id)):[];i.restricted_custom_buttons=Array.from(new Set(i.restricted_custom_buttons.concat(F)))}if($L.moment(i.recordDtl.Locked_Time).toDate()>$L.moment(r[L].Locked_Time__s).toDate()&&(i.recordDtl.Locked_Time=r[L].Locked_Time__s),"manual"===u)i.recordDtl.lock_type="manual",i.recordDtl.LockedBy=r[L].Locked_By__s?r[L].Locked_By__s.name:void 0,i.recordDtl.LockedReason=r[L].Locked_Reason__s,i.recordDtl.id=r[L].id,i.isUnLock=Crm.userDetails.IS_ADMIN||r[L].Locked_By__s.id===Crm.userDetails.USER_ID;else if("automatic"===u){i.recordDtl.lock_type="automatic";var x=O.locking_rules.filter((function(e){return e.id===r[L].Record_Locking_Rule_Id__s}));x&&x[0]&&A.push(x[0].name)}}}var P=l&&i.restricted_actions.contains("update");i.fieldIds=[];var U=i.allowed_fields?i.allowed_fields.length:0;i.fieldNames=U>0?"":"-";for(var j=0;j<U;j++){var V=store.peekRecord("field",i.allowed_fields[j].id);V&&(P&&i.fieldIds.push(V.id),i.fieldNames+=V.field_label,U-1!==j&&(i.fieldNames+=", "))}var H=A.length;i.recordDtl.Locked_Time=Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(i.recordDtl.Locked_Time)),H>0&&(i.recordDtl.LockedReason=A),i.canViewDetails=!Crm.userDetails.CLIENT_ACCOUNT,i.isLockedForMe=l,i.lockToolPerm=m}}}if("Tasks"===t.api_name&&!a){var B,Y="true"===$("#iskanbanview").val(),q=I18n.getMsg("crm.record.lock.record.locked");B=Y?'<span id="reclock_'+n.id+'" class="iconlock_ap zcrm_svgIcons recordLockingiconlock_ap mL5" lt-prop-title=\''+q+'\' lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span>':'<span id="reclock_'+n.id+'" class="dIB mL8 zcrm_svgIcons rlc_lockIcon vat" lt-prop-title=\''+q+'\' lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span>',l&&0===$("#reclock_"+n.id).length?Y?$(".kv_Name_"+n.id).after(B):$(".lp_Subject_"+n.id).after(B):l||$("#reclock_"+n.id).remove()}return i},constructReviewDetails:function(e){var t={};if(void 0!==e.review_process_data){for(var a,i=e.review_process_data.review.process_fields,o=e.review_process_data.review.record.status,s=e.review_process_data.review.rule.id,r=void 0!==i?i.length:0,n=0,l=0,d=0,c=!1,u="none",p={},_={},m=[],f={},v=0;v<r;v++){var h=i[v].subform_records;if(void 0!==h){var g=i[v].api_name,y=this.getSubformFieldStatus(h,n,l,d);f[g]=y.subformRecordIdVsRpFldStatus,n+=y.totalCount,l+=y.approvedCount,d+=y.rejectedCount;for(var E=h.length>0?h[0].process_fields:{},C=E.length,b=0;b<C;b++)m.push(E[b].id)}else{var L=i[v].id,I=i[v].api_name,D=i[v].status;p[L]=I,_[L]=D,"Approved"===D?l++:"Rejected"===D&&d++,n++,m.push(L)}}"Rejected"===o&&(c=!0),(a=l+d)>0&&a!==n&&!c&&(u="block");var R={};R.module=e.module,R.id=e.record.id,R.calleeObj="Crm",R.clickId="deleteEntity",t.rpdeleteParams=R,t.fieldVsName=p,t.fieldVsStatus=_,t.subformNameVsRecordRpFldStatus=f,t.approvedCount=l,t.rejectedCount=d,t.reviewedCount=a,t.totalCount=n,t.record_status=o,t.isResubmit=c,t.ruleId=s,t.styledisplay=u,t.reviewFields=m}else t.styledisplay="none","Pending for Review"===e.record.$review||"Review in Progress"===e.record.$review?t.record_status="pending_for_review":"Pending for ReReview"===e.record.$review&&(t.record_status="pending_for_re-review");return t},getSubformFieldStatus:function(e,t,a,i){for(var o={},s={},r=e.length,n=0;n<r;n++){for(var l=e[n].process_fields,d=void 0!==l?l.length:0,c=e[n].id,u={},p={},_=0;_<d;_++){var m=l[_];if(void 0!==m){var f=m.api_name,v=m.id,h=m.status;u[v]=f,p[v]=h,"Approved"===h?a++:"Rejected"===h&&i++}t++}s[c]=p}return o.totalCount=t,o.approvedCount=a,o.rejectedCount=i,o.subformRecordIdVsRpFldStatus=s,o},constructFieldIndexing:function(e,t){var a={},i={};this.allFieldIndexing=1,this.fieldIndexing=1;for(var o=t.length,s=0;s<o;s++){var r,n=t[s],l=[],d=[],c={};n.isSubformSection&&(a[r=n.fields.filter((function(e){return e.subform}))[0].api_name]=this.setSubformFieldIndexing(n.fields,e.subformNameVsRecordRpFldStatus[r])),void 0!==n.detailviewColumns?(l=void 0!==n.detailviewColumns[0]?n.detailviewColumns[0]:[],d=void 0!==n.detailviewColumns[1]?n.detailviewColumns[1]:[]):l=n.fields;for(var u=n.fields.length,p=0,_=0,m=0;m<u;m++)(m%2==0||0===d.length)&&p<l.length?(this.setFieldIndexing(l[p],e.reviewFields,e.fieldVsStatus,c),p++):m%2!=0&&_<d.length&&(this.setFieldIndexing(d[_],e.reviewFields,e.fieldVsStatus,c),_++);n.isSubformSection&&Object.keys(c)&&(i[r]=c)}e.subformNameVsRecordFieldIndexing=a,e.subformNameVsAggFieldIndexing=i},setFieldIndexing:function(e,t,a,i){t.contains(e.id)&&(e.allFieldIndexing=this.allFieldIndexing++,"yet_to_review"===a[e.id]&&(e.fieldIndexing=this.fieldIndexing++),e.subform&&(i[e.id]={},i[e.id].allFieldIndexing=e.allFieldIndexing,"yet_to_review"===a[e.id]&&(i[e.id].fieldIndexing=e.fieldIndexing)))},setSubformFieldIndexing:function(e,t){var a={};for(var i in t){for(var o=e.length,s={},r=t[i],n=0;n<o;n++){var l=e[n];void 0!==r[l.id]&&(s[l.id]={},s[l.id].allFieldIndexing=this.allFieldIndexing++,"yet_to_review"===r[l.id]&&(s[l.id].fieldIndexing=this.fieldIndexing++))}a[i]=s}return a},constructApprovalDetails:function(e){var t=Crm.userDetails.APPROVALPROCESS_EVERYONE,a={},i=e.approval_process_data.approval_process,o=i.length,s=null,r=[],n=0,l=0,d={status:"2"},c=[],u=[],p={},_={},m="",f="",v={},h={},g=[],y=i[0].allow_cc_during_rejection,E=i[0].allow_cc_during_approval;a.approval_state=e.record.$approval_state,a.showRespondLink=e.record.$approval.approve,a.delegateDeactivate=e.record.$approval.delegate,a.overall_approval_config=e.approval_process_data.approval_process[0].overall_approval_config,"anyone"===a.overall_approval_config?a.totalApproverLevel=1:a.totalApproverLevel=o;for(var C=0;C<o;C++){var b=i[C].approval_status,L=t?b.length:1,I=i[C].approver;s=i[C].rejection_type;var D=[],R=0,T=0,M=0,w=[],S=[];g.push(I.type),t&&void 0===b.length&&"pending"===b.status?R=1:null!==i[C].user_approval_config&&(l=1,T=1);for(var k=0;k<L;k++){var A=t||!t&&b.length?b[k].user.name:I.resource.name,N=t||!t&&b.length?b[k].delegated_user:b.delegated_user,O=t||!t&&b.length?b[k].status:b.status;if(N&&D.push(A),T&&(_[A]="https://contacts.csez.zohocorpin.com/file?ID=15955884&fs=thumb"),"anyone"===a.overall_approval_config)R=1,w.push(A),"rejected"===O&&(m=A,f=A),null===i[C].user_approval_config&&(w=[]);else if("everyone"===i[C].user_approval_config||null===i[C].user_approval_config){switch(O){case"pending":w.push(A),R=1;break;case"rejected":w.push(A),m=A,f=A,R=1;break;case"approved":S.push(A),M++}null===i[C].user_approval_config&&(w=[],S=[])}else switch(O){case"approved":S.push(A),M++,R=0;break;case"rejected":w.push(A),m=A,f=A,R=1;break;default:R=1,w.push(A)}}R&&n++;var F="";"users"!==I.type&&"record_owner"!==I.type&&"reporting_manager"!==I.type&&void 0!==b.length&&R&&(F="splitername"+M+"/"+b.length),I.hasOwnProperty("resource")?(r.push(I.resource.name),F=I.resource.name+F):(r.push("Level"+I.level),F="Level"+I.level+F);var x=!1;T&&(v[F+"delegateUsers"]=D),""===m?(c.push(F),R&&"2"===d.status&&u.push(F),S.length!==b.length&&0!==R||(x=!0,S=[])):(d.warnUser=F,d.iconUser=f,d.status="3",u=[],m="");var P=[];(T||null===i[C].user_approval_config)&&(P.push(w),P.push(S),P.push(x),h[F]=P)}a.currLevel=i.length-n;i.length;var U=-1;a.overall_approval_config.includes("_sequential")&&a.currLevel,l||(d.usersArray={}),void 0!==h&&Object.keys(h).forEach((function(e){U++,"3"!==d.status&&"users"===g[U]||(p[e]=h[e][0],p["apr-"+e]=h[e][1],"3"===d.status&&(p["isApproved-"+e]=h[e][2]))})),d.isPortalUser="true","anyone"===a.overall_approval_config||a.overall_approval_config.includes("_parallel")?d.parllel="true":d.parllel="2",d.currLevel=a.currLevel+1,d.fullUserList=c,d.fullUserMapDelegate=v,d.activeUserList=u,d.usersArray=p,d.userIcon=_;var j="2",$=[],V={};if("current_approver_decide"===s?j="3":null===s&&(j="1"),"3"===j)for(C=a.currLevel;C>=0;C--){$.push((C+1).toString());var H=r[C];0===C?H+=" (Start from first)":C===a.currLevel?H+=" (Current Stage)":C===a.currLevel-1&&(H+=" (Previous Stage)"),V[C+1]=H}d.rejectorsType=j,d.approverList=$,d.rejectorObj=V,d.rejectActionCC=y,d.approveActionCC=E;var B={approversNameList:d};if(a.thisObj=B,a.hasresubmitLink=e.record.$approval.resubmit,a.hasresubmitLink&&void 0!==e.timeline_info){var Y=e.timeline_info.timelines[0].automation_details.approval_process,q=void 0!==Y?Y.comments:Y;void 0===q&&(q="N/A"),a.comments=q}return a},populateDefaultValue:function(e){var t,a=e.business_card?e.business_card[0].fields:e.header_business_card.fields,i=!1,o=e.record.Call_Type;a.forEach((function(e){"Call_Type"===e.api_name&&e.pick_list_values.forEach((function(e){e.display_value===o&&(t=e.actual_value)}))})),"Outbound"===t&&(i=!0),i&&!isCallerInfoDisabled&&e.record.To_Number__s?(e.defaultValue=e.record.To_Number__s,e.record.$phone_number=e.record.To_Number__s):i||isCallerInfoDisabled||!e.record.From_Number__s?!Crm.userDetails.CALLS_PREFERENCE&&e.record.$phone_number?e.defaultValue=e.record.$phone_number:e.defaultValue=I18n.getMsg("crm.activities.call.unknown.entityname"):(e.defaultValue=e.record.From_Number__s,e.record.$phone_number=e.record.From_Number__s)}});
