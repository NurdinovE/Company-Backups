var detailView={affectedData:{},durationOfHighlightingFormulaField:1e4,taskStatusMap:{},lastTimelineDate:void 0,currentModule:void 0,prevModule:void 0,labelToCol:{},readOnlyField:!1,depKeys:{},depValueJson:{},selValueJson:{},entityId:void 0,changedBCJson:void 0,BCkeyVsArrayIndex:{},"tableSet ":!1,makeRequest:!0,recordLocked:!1,recordLockingDetails:{},isWFExecInKafka:!1,isKioskRefresh:!1,isKioskExecution:!1,refreshInWms:!1,Type:void 0,kafkaWFStatus:void 0,currentStatus:void 0,refreshCanvasView:void 0,refreshTimer:void 0,lastScrollLeft:void 0,lastScrollTop:void 0,pmEmailInfoIcon:void 0,pmEmailRes:void 0,pmEmailBounceType:void 0,secEmailInfoIcon:void 0,secEmailRes:void 0,secEmailBounceType:void 0,leftRightMovement:0,imageUploadFieldRenderedCount:0,isImageModified:{},leftRightMoveUpdate:0,Service_needed_Details:void 0,layoutId:0,serviceAvailabiltyData:{},fieldUpdateJson:[],FieldUpdateAvailable:!1,Currmodule:void 0,oldfieldUpdateJson:[],fadeOutTimerValue:[],visibleviewJson:[],currWFOffloadingJobIds:[],currOffloadingJobId:void 0,approvalCaseOffloading:!1,singleRecordLyteOffloading:!1,isMassupdatePopupLoading:!1,isSingleRecordChangeOwnerPopupLoading:!1,isRecordConverted:!1,isBlueprintPageRefresh:!1,updateMap:{},columnVsUpdateDetails:{},unprocessedValueMap:{},updateSourceFrom:void 0,currency:{},dateTimeFormat:{},originElem:void 0,highligthaddd:!1,popUpPresent:!1,socialVisible:!1,isDelugeAvailable:!1,isPopShown:!0,constVisibl:void 0,updatedLayoutId:void 0,getThumbnailDataMap:{},popupclosed:!0,cloneupdateMap:{},cfDatefield:{},entityID:void 0,phoneField:[],adminapproval:"",entityIdVsDate:{},comments:"-",approverpop:{},listApprover:"",rejectionStage:1,hreFJson:{},appObj:void 0,approverbusiinessObj:{},multilineJSON:{},multilineRender:{},optAction:"rejectRecord",relatedPersonalityList:{PRODUCTSPERSONALITY:"Products",ACTIVITYPERSONALITY:"Tasks",TASKSPERSONALITY:"Tasks",CONTACTSROLESPERSONALITY:"Contact Roles",POTENTIALSPERSONALITY:"Potentials",CONTACTSPERSONALITY:"Contacts",LEADSPERSONALITY:"Leads"},modulesWithRelModules:{Accounts:["Contacts","Potentials"],Leads:["Tasks","Products"],Contacts:["Potentials","Tasks","Products"],Potentials:["Contacts","Tasks","Products"],Products:["Vendors","Potentials"],PurchaseOrders:["Vendors","Tasks"],Vendors:["Contacts","Products","Tasks","PurchaseOrders"],Quotes:["Accounts","Contacts","Potentials","Tasks"],Cases:["Contacts","Tasks"],SalesOrders:["Accounts","Contacts","Potentials","Tasks"],Invoices:["Accounts","Contacts","Tasks"]},isDataPrivacyModified:!1,activityModules:["Tasks","Events","Calls"],isApproved:!0,reRenderTimeline:[!1,!1],macroDivStatus:!1,CLEAR_INTERVAL_ID:!1,headerRecordUpdateNotRequiredUIypes:[4,5,6,7,8,9,10,12,13,15,16,41,42,43,44,51,55,132,133,134,135,136,208,210,220,221,333,445,444,500,207,118,556,555],lyte_headerDataHolder:{},restrictedLinks:[],restrictedRelatedLists:{},cscriptFieldAttribs:{},cscriptButtonAttribs:{},vision_data:void 0,deletedEntityImgPhotoId:void 0,showVisionHelpZiaOfRecImg:!1,profileImgPhotoId:void 0,haveSpotEdited:!1,isSubformAjaxOpened:!1,updatedColumnNameWithValue:{},affectedFormulaFieldsForSubformInCanvas:[],meetingProvidersEnabled:[],recordEditSaveTrackData:{prevSaveTime:0,currentSaveTime:0,prevAjaxSaveTime:0,currentAjaxSaveTime:0,prevEditTime:0,currentEditTime:0,prevAjaxEditTime:0,currentAjaxEditTime:0},entityInfoCall:function(e,t,i,a,n,s,r){var o,l,d,c,u,m,p;if(!r){for(var v in r={},e=decideGetHtml(e),o=objectUtils.URL(e).getParams().module,l=getObj("module")?getObj("module").value:"",commonUtils.showHideLoadingDiv(!0),d=o||l,c=networkUtils.parseUrl(e).params)c[v]=decodeURIComponent(c[v]);u=Crm.lyteHeaderNeeded(c.module),m="",e.split(/advSearchCnt|GSearch|ChangeOwner.do/).length>1&&(t=e.split("?"),e=t[0],t=t[1]),null!=t?(m=t,m+="&newModel=true"):m="newModel=true",p=objectUtils.parseURLParamString(m),r.urlModule=o,r.modValue=l,r.urlParams=c,r.setCacheMod=d,r.lyteHeaderModule=u,r.args=m,r.postData=p}return new Promise((function(t){if("undefined"!=typeof Detail_API_Optimisation&&Detail_API_Optimisation&&void 0!==showEntityReqRes&&void 0!==showEntityReqRes[r.urlParams.id]&&window.location.origin+e==showEntityReqUrl)$("#privacyFreezePop").remove(),crmTemplate.downloadedContentLoaded=!1,showEntityReqRes[r.urlParams.id].then((function(o){commonUtils.showHideLoadingDiv(!1),a&&a(o,e,r,n,s,i),t(o)}));else{var o=new crmRequestPool;o.followOrder=!0,crmTemplate.downloadedContentLoaded=!1,o.initiate({action:e,type:"POST",data:r.postData,beforeSend:function(e){$("#privacyFreezePop").remove(),1==Crm.isPageLoad&&(e.setRequestHeader("is-Page-Load","true"),Crm.isPageLoad=!1)},complete:function(){commonUtils.showHideLoadingDiv(!1)},success:function(o){a&&a(o,e,r,n,s,i),t(o)},error:function(t){return ajaxNewError(e,t),!1}})}})).then((function(e){return e}))},successEntityCallback:function(e,t,i,a,n,s){var r=i.urlParams;if(i.lyteHeaderModule){if("object"==typeof e&&"true"===e.DRAFTED_ENTITY)return Lyte.Router.getRouteInstance().transition.abort(),void Lyte.Router.getRouteInstance().transitionTo("crm.tab.module.entity.edit",r.module,r.id);e=detailView.convertMessageHandlingForAutomationActionConvert(e),null!=(o=ajaxNewAfterResponse(e,t,i.setCacheMod,i.args,a,n,i.params,r,i.urlModule,s))&&!o||!returnJson||s||(!Crm.userDetails.isRelatedListLyteEnabled||Lyte.Globals.get("relatedList.refreshed"))&&Crm.userDetails.isRelatedListLyteEnabled||(Crm.userDetails.isRelatedListLyteEnabled&&Lyte.Globals.set("relatedList.refreshed",!0),detailView.loadRelatedPageContent(r.module,r.id)),i.layoutRuleReqOver&&CFRExec.evalRules("view",!0)}else{if("object"==typeof e&&"true"===e.DRAFTED_ENTITY)return Lyte.Router.getRouteInstance().transition.abort(),void Lyte.Router.getRouteInstance().transitionTo("crm.tab.module.entity.edit",r.module,r.id);var o;e=detailView.convertMessageHandlingForAutomationActionConvert(e),null!=(o=ajaxNewAfterResponse(e,t,i.setCacheMod,i.args,a,n,i.params,i.urlParams,i.urlModule,s))&&!o||!returnJson||s||(!Crm.userDetails.isRelatedListLyteEnabled||Lyte.Globals.get("relatedList.refreshed"))&&Crm.userDetails.isRelatedListLyteEnabled||(Crm.userDetails.isRelatedListLyteEnabled&&Lyte.Globals.set("relatedList.refreshed",!0),detailView.loadRelatedPageContent(r.module,r.id))}detailView.pageRefreshHandlingForApprovalTransition(),CScriptLib&&detailView.invokeClientScript()},load:function(e,t,i,a,n,s,r,o){returnJson=void 0;var l=objectUtils.URL(e).getParams().module;s&&(s=Crm.lyteHeaderNeeded(l)),a=a||"show",Utils.showCount=0;l=objectUtils.URL(e).getParams().module;var d=getObj("module")?getObj("module").value:"",c=l||d,u=networkUtils.parseUrl(e).params;for(var m in u)u[m]=decodeURIComponent(u[m]);var p={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},v=store.peekAll("module").find((function(e){return e.module_name===u.module})).api_name;if(Crm.userDetails.ValidationAlertPreference){var g="/crm/v2.2/"+v+"/"+u.id+"/actions/get_feature_specific_info";store.findAll("dummy",{features:"validation_rules"},!1,!1,{url:g,method:"GET",headers:p}).then((function(e){Crm.valFeatureSpecinfo=e.data[0].features_info[0].details}))}var f="";e.split(/advSearchCnt|GSearch|ChangeOwner.do/).length>1&&(t=e.split("?"),e=t[0],t=t[1]),null!=t?(f=t,f+="&newModel=true"):f="newModel=true";var h=objectUtils.parseURLParamString(f),C={module:decodeURIComponent(u.module),id:u.id,fromIndex:1};if(getObj("messageValue"))var w=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&messageValue="+getObj("messageValue").value;else w=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData";var y=document.getElementById("relNEID"),_="";if(y&&/^[0-9]+$/.test(y.value)&&(_="&neid="+y.value),w+=_,getObj("parentCurrencyISOCode")&&getObj("parentExchangeRate")&&(w+="&parentCurrencyISOCode="+getObj("parentCurrencyISOCode").value+"&parentExchangeRate="+getObj("parentExchangeRate").value),getObj("zproject_errorcode")&&""!=getObj("zproject_errorcode").value&&"null"!=getObj("zproject_errorcode").value&&(w+="&errorcode="+getObj("zproject_errorcode").value),getObj("zproject_not_added_clients")&&""!=getObj("zproject_not_added_clients").value&&"null"!=getObj("zproject_not_added_clients").value&&(w+="&zproject_not_added_clients="+getObj("zproject_not_added_clients").value),"Potentials"==C.module){var b=$("#cntId");b.length>0&&"null"!==b.val()&&(w+="&relCntId="+b.val())}var I={};if(s){if(featuresAvailable.hasOwnProperty("ZiaVision")&&featuresAvailable.ZiaVision){var T=Lyte.registeredMixins["zia-insights-utils"],L=moduleRecordMapping[C.module],D=T.getInsights(L,C.id,{keys:"vision_data"},null,"zia_vision");I.zia_insights=D}I.detailview_buttons=store.triggerAction("entity","available_actions",{module:moduleRecordMapping[C.module].api_name,entityId:C.id}).then((function(e){if(e)return e}),(function(e){murphy.error(e)})),I.record=store.findRecord(moduleRecordMapping[C.module].id,C.id,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0})}var E=Crm.lyteHeaderNeeded(u.module),R=!1,A={};A.urlModule=l,A.modValue=d,A.urlParams=u,A.setCacheMod=c,A.lyteHeaderModule=E,A.args=f,A.postData=h,A.layoutRuleReqOver=!1;R=!1;r?(r(o,e,A,i,a,n),R=!0):(Lyte.resolvePromises(I).then((function(e){s&&E&&(detailView.lyte_headerDataHolder.detailview_buttons=e.detailview_buttons)})),detailView.entityInfoCall(e,t,n,detailView.successEntityCallback,i,a,A));var M=new crmRequestPool;n||((void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(u.module))&&(h.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},M.initiate({type:"GET",action:e,data:h,dataType:"json",success:function(e){null!==e&&(A.layoutRuleReqOver=!0,CFRExec.init(e,u.module,"view"),CFRExec.promptIfMandatory=!1,E&&!R||CFRExec.evalRules("view",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),detailView.refreshInWms||(Crm.userDetails.isRelatedListLyteEnabled?Lyte.Globals.get("relatedList.refreshed")||(Lyte.Globals.set("relatedList.refreshed",!0),Lyte.registeredMixins["crm-related-list-utils"].loadRelatedListComponents(C.module,C.id)):M.addUp({action:w,type:"GET",data:C,success:function(e){if(crmRelatedList.load(C.module,C.id,e,!1),"Accounts"===C.module)(t=$('div[ddname="CONTACTSPERSONALITY"]')).find("[id^=norec_]").length>0&&t.find("[id=contactTreePopup]").addClass("disabledArow");else if("Contacts"===C.module){var t;(t=$('div[ddname="REPORTINGCONTACTSPERSONALITY"]')).find("[id^=norec_]").length>0&&t.find("[id=contactTreePopup]").addClass("disabledArow")}}}))),detailView.rlLogAdded=!1},showalert:function(e){var t=approvalProcess.roleResp.role.grouped_counts.length;if(0!==t)for(var i=0;i<t;i++)if(approvalProcess.roleResp.role.grouped_counts[i].role.id===e)return approvalProcess.roleResp.role.grouped_counts[i].count},onBluePrintPickListHover:function(e){var t=e.currentTarget,i=I18n.getMsg("blueprint.field.lock.tooltip");$L(t).attr({"lt-prop-title":i,"lt-prop-tooltip-config":'{"position" : "bottom"}'})},parllelPopShow:function(e){var t=$(e+" #ApproverTypeList #approverTypes"),i=t.attr("approvertype"),a="";void 0!==t[0]?a=t[0].innerText:o=!0;var n=t.attr("approverId"),s=0;s="Groups"===a||"10"===i?t.attr("approverCount"):"Role"!==a&&"9"!==i||2!==approvalProcess.lastRoleCheck?0:detailView.showalert(n);var r="icon_"+(e=e.split("#")[1]),o=!0;if("Levels"!==a&&"11"!==i&&"12"!==i||(o=!1),"Groups"===a||"10"===i)return a="Group",void(approvalProcess.groupCheck=approvalProcess.myJobsReject(!0,r,a,o,n));var l=$("#parllelapproverid").eq(0);void 0!==l&&l.remove();var d=networkUtils.returnDependencyFiles(["crm-approval-process-parllelpopover.js"],ResourceConstants.CRMClient),c=networkUtils.returnDependencyFiles(["crm-approval-process-parllelpopover.css"],ResourceConstants.CRMClient);c=(c=c.concat(d)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM)),Lyte.injectResources(c,void 0,(function(){Lyte.Component.render("crm-approval-process-parllelpopover",{show:!0,orginElem:r,scrolTop:!1,group:a,grouporRole:o,isCountExceed:s>10},"body")}))},loadRelatedPageContent:function(e,t){var i=returnJson.relListLabelsJson.relListLabelJson.length;if(Crm.userDetails.isRelatedListLyteEnabled)returnJson.relListLabelsJson&&"Events"!==e&&(Lyte.Component.render("crm-related-list-view",{module:e,entityId:t},"#relatedPageContent"),$("#projects_sort")&&thirdPartyUtils.bindSelect2("#projects_sort"),$("#portalRList")&&thirdPartyUtils.bindSelect2("#portalRList select"));else{for(var a=[],n=0;n<i;n++)a[n]=returnJson.relListLabelsJson.relListLabelJson[n].name.toLowerCase()+"_"+returnJson.relListLabelsJson.relListLabelJson[n].id;if(crmRelatedList.personalityArr=a.join("||"),returnJson.relListLabelsJson){var s=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(s),$("#projects_sort")&&thirdPartyUtils.bindSelect2("#projects_sort"),$("#portalRList")&&thirdPartyUtils.bindSelect2("#portalRList select")}}},customizeRelatedList:function(e,t){if(getObj("entityId")&&"Save"==e)return doAjaxUpdateForm("relatedPageContent",document.relListSeqForm,(function(){hideAnimatePopup("topBandPopup");var e=$("#module").val();e&&store.clearCachedQuery("related_list",{module:EmailComposeUtil.getApiNameForModule(e)}),CScriptLib&&detailView.invokeClientScript()}),void 0,t)},createPrintTemplate:function(e,t){Handlebars.registerPartial("uiTypeTemplatePrint",Handlebars.templates.uiTypeTemplatePrint),t||(t="leftPanel");var i=businessCardJson.hidden.module;if(e=removeRFMSegmentationCustomFields(e,i),businessCardJson.terrDetails&&(e[i].terrDetails=businessCardJson.terrDetails),e[i].entityid&&(this.entityId=e[i].entityid),!e[i].section.length){var a=e[i].section;e[i].section=[],e[i].section[0]=a}for(var n=0;n<e[i].section.length;n++){var s=e[i].section[n].FL;if(e[i].section[n].module=i,"Events"==i&&(e[i].section[n].layout=2),"Appointments"==i&&e[i].section[n].section_id>3&&(e[i].section[n].displaylabel=I18n.getMsg("Job Sheet Information")),!s.length){var r=[];r[0]=s,e[i].section[n].FL=r}}for(n=0;n<e[i].section.length;n++){s=e[i].section[n];var o=parseInt(s.layout);e[i].section[n].splFL=[];for(var l=0;l<o;l++){var d=[];for(k=l;k<s.FL.length;){if("Calls"==i&&"CONTACTID"==s.FL[k].colname){var c="";c=isNewCallView?I18n.getMsg("crm.activities.call.label.fromto"):I18n.getMsg("Who Id"),e[i].section[n].FL[k].displaylabel=c}"CALLOWNER"!=s.FL[k].colname&&"CALLOWNER"!=s.FL[k].colname&&"LASTACTIVITYTIME"!=s.FL[k].colname&&"SALUTATION"!=s.FL[k].colname&&111!=s.FL.uiType||(s.FL[k]=!0),"Tasks"==i&&"RECURRING"==s.FL[k].colname&&(s.FL[k].defaultvaluereadable=detailView.getReadableRecurringPattern(s.FL[k].defaultvalue)),d.push(s.FL[k]),k+=o}e[i].section[n].splFL[l]=d}}e[i].section;if("Events"==i){var u=[];for(n=0;n<e[i].section.length;n++)"Event Information"!=e[i].section[n].name&&u.push(e[i].section[n]);e[i].section=u}org.owasp.esapi.ESAPI.initialize();var m=$("#pdfPreviewFrame").contents(),p=m.find("[name='viewentityform']");if("Events"==i){this.changedBCJson=this.processBCJson(businessCardJson);var v=Handlebars.templates.eventPrintBC;if(this.changedBCJson.Fields.LOCATION){var g=this.changedBCJson.Fields.LOCATION.meetingToolName;g&&""!=g&&(this.changedBCJson.Fields.LOCATION.defaultvalue=I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[g]))}this.changedBCJson.MEETING_BRIDGE_ENABLED=Crm.userDetails.MEETING_BRIDGE_ENABLED;var f=v(this.changedBCJson);p.prepend(f)}"Calls"==i&&isNewCallView&&(e[i].section=crmCallsNew.getSections(e[i].section,e.entMetaData.callDirection)),e[i].isLockedFromProcessing="";var h=(0,Handlebars.templates.crmDetailView)(e[i]);if("Events"==i?m.find("[id=fullInfoDiv]").prepend(h):p.prepend(h),"Services"==i){businessCardJson.serviceAvailabilityViewJSON.serviceavailabilitydetails.forPrint=!0;var C,w=businessCardJson.serviceAvailabilityViewJSON.serviceavailabilitydetails;w.isbusinesstiming?"custom"===w.businessJSON.type&&w.businessJSON.same_as_everyday&&(C=w.businessJSON.details.split("-"),"HH:mm"===Crm.userDetails.TIME_FORMAT&&(C[0]=Utils.convertTimeValueTo24HourFormat(C[0]),C[1]=Utils.convertTimeValueTo24HourFormat(C[1])),w.serviceTimeInUserFormat=C[0]+" - "+C[1]):w.serviceTimeInUserFormat=w.servicetime,Lyte.Component.render("crm-services-availability",{returnedJsonval:businessCardJson.serviceAvailabilityViewJSON.serviceavailabilitydetails},"#serviceAvailabilityViewDiv");var y=$("#serviceAvailabilityViewDiv");m.find("#serviceAvailabilityViewDivForPrint").append(y.outerHTML()),y.remove()}if("Calls"==i&&m.find("#rowTR_ISCALLBILLABLE").remove(),"Services"===i&&m.find("#rowTR_JOBSHEETSECTION").remove(),detailView.tableSet=!1,$("#dv-button-layer").prepend($(".dvbtnlayer")),Crm.isInventoryModule(i)&&productDetails.initInventoryView(e),e[i].fieldDependency&&e[i].fieldValues){var _=JSON.parse(e[i].fieldDependency),b=JSON.parse(e[i].fieldValues);detailView.depKeys=objectUtils.getKeys(_),detailView.depValueJson=_,detailView.selValueJson=b}"PriceBooks"==i&&0==e.entityMapJson.PRICINGDETAILS.pricingDetails.length&&m.find("[id='secHead_Pricing Details']").parent().hide();var I=m.find("crux-image-component"),T=I.length;Lyte.registeredMixins["crm-uploadfields-mixin"].thumbnailRequestForDV(i,I,this.entityId);for(n=0;n<T;n++){var L=I[n].component.getData("cxPropValue"),D=I[n].id.split("_")[1],E=I[n].component.getData("cxPropId");Lyte.registeredMixins["crm-uploadfields-mixin"].combineImageDataWithSrc(L,D,!1,E,null,m)}},stageClickHandler:function(e){$(e).find(".dv_statge_title").hide();var t=$(e),i=$("#stageContain").find(".lineStage .order-step");if(t.length>0&&i.length>1&&i<=10)stageClickBelowten(e);else if(t.length>0){var a=t.find(".sToolTipBottom").find("select"),n=t.attr("data-value").split(":");stageClickBelowNormal(t,a,n,e)}},getEntityTaskSync:function(e,t){var i=!1;store.peekAll("module").forEach((function(e){"Projects"===e.api_name&&e.visible&&(i=!0)}));var a=$(".projectsTaskSyncBtn");if(i){var n=Lyte.Router.getRouteInstance().parent.getDynamicParam();if("undefined"!=typeof businessCardJson&&businessCardJson&&businessCardJson.isProjectTask)isProjectAvailable(void 0,t,void 0,void 0,n),a.hide();else if(void 0!==n){var s=store.peekRecord("crm-project-sync-task",n);if(!s||s&&"TASK_NOT_SYNCED"===s.code){var r=$("#Crm_Tasks_CONTACTID_WhoId_select option:selected").val(),o=$("#Crm_Tasks_CONTACTID").val();"Accounts"===t||"Potentials"===t?"Contacts"===r&&""===o?store.findAll("crm-project-sync-task",{task_id:n,entity_id:e,module:t,isTaskSync:!1},!1).then((function(e){"TASK_NOT_SYNCED"===e.code&&null!==e.firstSelectedProject?a.show():a.hide(),detailView.setProjectTaskSyncResponse(n,e)}),(function(){a.hide()})):a.hide():"Contacts"===t?store.findAll("crm-project-sync-task",{task_id:n,entity_id:e,module:t,isTaskSync:!1},!1).then((function(e){"TASK_NOT_SYNCED"===e.code&&null!==e.firstSelectedProject?a.show():a.hide(),detailView.setProjectTaskSyncResponse(n,e)}),(function(){a.hide()})):a.hide()}else a.hide()}}else a.hide()},mapProjectPriority:function(e){return e="High"==e||"Highest"==e?"High":"Low"==e||"Lowest"==e?"Low":"Normal"==e?"Medium":"None"},loadCrmServiceUtils:function(e,t,i,a,n,s,r,o,l){Lyte.injectResources(networkUtils.returnDependencyFiles(["servapp_preferences_model.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.resolvePromises({filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["business_hours-model.js","crm-services-appointments.js"],ResourceConstants.CRMClient))),appPref:store.findAll("servapp_preferences",{},!1,!0,{module:"Appointments"})}).then((function(d){Lyte.registeredMixins["crm-appointments-mixin"].scheduledAppMoreOption(e,t,i,a,n,s,d.appPref,r,o,l||e.dataset.params)}))}))},renderCalendarBookingOptions:function(e){commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-calendar-booking-helper.js","calendar-bookings-model.js","crm-calendar-booking-dependency.js","crm-calendar-booking-resources.js","crm-calendar-booking-detailview.js","crm-calendar-booking-mixin.js","crm-calendar-booking-form-mixin.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CalendarBooking")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["crm-calendar-booking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)))}).then((function(){Lyte.registeredMixins["crm-calendar-booking-mixin"].renderRelatedListOptions(e)}))},setProjectTaskSyncResponse:function(e,t){var i=store.peekRecord("crm-project-sync-task",e);i.$.set("client_name",t.client_name),i.$.set("clientcompany_id",t.clientcompany_id),i.$.set("clientuser_id",t.clientuser_id),i.$.set("firstSelectedProjectId",t.firstSelectedProject),i.$.set("module",t.module),i.$.set("isB2C",t.isB2C),i.$.set("relatedEntityID",t.relatedEntityID),t.start_date&&t.end_date&&(i.$.set("is_strict_project",t.is_strict_project),i.$.set("start_date",t.start_date),i.$.set("end_date",t.end_date))},renderZiaScore:function(e,t){if(e){var i=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.js"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles(["zia/scoring_rule/zia-score-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaScore")],ResourceConstants.CRM),o=i.concat(a).concat(n).concat(s).concat(r);Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-zia-score-result",{zia_score:{}},"#ziaScoreDetails")})).then((function(){for(var i=document.querySelector("crm-zia-score-result").component,a=e.length,n=$L("#ziaScoreDetails"),s=0;s<a;s++){var r=e[s].scoring_rule,o=e[s].output;i.setData("record_id",returnJson[idModuleMapping[returnJson.tabId]].entityid),i.setData("record_name",returnJson[idModuleMapping[returnJson.tabId]].entityName),i.setData("record_owner",t.entityMapJson.SMOWNERID.defaultvalue);var l=idModuleMapping[returnJson.tabId];i.setData("module_name",l),i.setData("module_label",moduleRecordMapping[l].singular_label),i.setData("id",r.id),i.setData("name",r.name);for(var d=Object.keys(t.entityMapJson),c=d.length,u=0;u<c;u++)if(t.entityMapJson[d[u]].fieldid===r.score_field.id){r=o.score;i.setData("score",r),$("#subvalue_"+d[u]).html(r),i.scoreChart(),n.show();break}}}))}},renderZiaNba:function(e,t){if(e){var i=$L("#nbaDetails"),a=networkUtils.returnDependencyFiles(["nba-detail-page.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["zia/nba/nba-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],ResourceConstants.CRM),r=networkUtils.returnDependencyFiles(["zia/nbx/crm-nba-mixins.js"],ResourceConstants.CRMClient),o=a.concat(s).concat(n).concat(r);Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-nba-detail-page",{nextBestAction:{}},"#nbaDetails")})).then((function(){var a=document.querySelector("crm-nba-detail-page"),n=e[0],s=Lyte.registeredMixins["crm-nba-utils"].getSuggestionData(n,t);a.component.setData("next_best_action",s.next_best_action),a.component.setData("is_nba_available",s.is_nba_available),a.component.setData("suggestion",s.suggestion),a.component.setData("duration",s.duration),a.component.setData("module",s.module),a.component.setData("currentmodule",t);var r="Leads"===t?"Leads":"Potentials";a.component.setData("currentrecord",{id:returnJson[r].entityid,name:returnJson[r].entityName}),a.component.setData("mentioneddetails",s.mentioned_details),a.component.setData("trigerobj",s.triger_obj),i.show()}))}},loadZiaDependentComponents:function(e,t){var i=$L("#predictionDetails"),a=$L("#churnDetails"),n=["Visits","Forecasts"],s=store.peekAll("module").filter((function(e){if(!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type&&n.indexOf(e.module_name)<0)return e})).filter((function(t){if(t.module_name===e)return t}));if(i.length>0&&["US","EU","IN","JP","China","AU","CSEZ","CA","SA"].contains(Crm.userDetails.DEPLOYMENT)&&["A","U","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&s.length>0){var r=this,o=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.js","zia/prediction/builder/churn-prediction-result.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["recommendation-util.js","crm-recommendation-details-newview.js","zia-helpers.js"],ResourceConstants.CRMClient),d=networkUtils.returnDependencyFiles(["zia/prediction/builder/field-prediction-result.css","zia/prediction/builder/churn-prediction-result.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),c=networkUtils.returnDependencyFiles(["recommendation-details-page.css","crm-recommendation-details-newview.css"],ResourceConstants.CRMClient),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reasoning"),"zohocrm_lookupBusinessCard.js",networkUtils.getI18nJSUrl("SimilarityRecommendation")],ResourceConstants.CRM),m=networkUtils.returnDependencyFiles(["similarity-details-page.js","zia-helpers.js"],ResourceConstants.CRMClient),p=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),v=networkUtils.returnDependencyFiles(["zohocrm_chart.js"],ResourceConstants.CRM),g=networkUtils.returnDependencyFiles(["crm_analytics.css"],ResourceConstants.CRM);o=o.concat(networkUtils.returnDependencyFiles(["crm-besttime-new.js","besttime_zia_new_model.js","zia_reminder_model.js"],ResourceConstants.CRMClient)),d=d.concat(networkUtils.returnDependencyFiles(["crm-besttime-new.css"],ResourceConstants.CRMClient));var f=o.concat(d).concat(l).concat(c).concat(m).concat(p).concat(u).concat(v).concat(g);Lyte.injectResources(f,void 0,(function(){Lyte.Component.render("crm-field-prediction-result",{prediction:[],isNewView:!0,recordid:returnJson[e].entityid,tabid:returnJson.tabId},"#predictionDetails"),Lyte.Component.render("crm-churn-prediction-result",{prediction:[]},"#churnDetails"),"Potentials"===e||"Leads"!==e&&"Contacts"!==e||Lyte.Component.render("crm-besttime-new",{module:e,seid:returnJson[e].entityid,viewType:"DetailsPage"},"#bestTimeToContactDiv")})).then((function(){Crm.userDetails.detailView_newUI||crmBstTime.setPosition(),Lyte.registeredMixins["zia-insights-utils"].invokeZiaInsightsAPI(moduleRecordMapping[e],returnJson[e].entityid).then((function(n){for(var s={},o=n.length,l=0;l<o;l++)s=Object.assign(s,n[l].zia_insights);var d=s,c=d.similarity_data?d.similarity_data:void 0;if(c){var u=document.querySelector("crm-similarity-result"),m=c[0].output;m.sort((function(e,t){return t.score-e.score})),u.component.setData({module:moduleRecordMapping[e],similarities:m,similarityConfig:c[0].similarity});var p=document.querySelector("#similarityDetailUi");u.component.methods.loader(p,u.component)}var v=d.recommendation_data?d.recommendation_data[0]:void 0;if(v){var g=v.output;if(g.length){var f=document.querySelector("crm-recommendation-details-newview"),h=g[0],C=v.recommendation,w=store.createRecord("recommendations-details");w.$.set("recommendation_id",C.id),w.$.set("name",C.name),w.$.set("first_buy",h.first_buy),w.$.set("next_buy",h.next_buy),w.$.set("rebuy",h.rebuy),w.$.set("frequently_bought_together",h.frequently_bought_together),w.$.set("customer_also_bought",h.customer_also_bought),w.$.set("whom_to",C.whom_to),w.$.set("what_to",C.what_to),w.$.set("based_on",C.based_on),f.component.setData("recommendationsDetails",w),f.component.dataPageInitLoader(f.component,f.component.getData("e //No I18nntity_module"),w)}}detailView.renderZiaNba(d.next_best_action_data,moduleRecordMapping[e].api_name);var y=document.querySelector("crm-churn-prediction-result"),_=d.churn_predictions_data;if(y&&y.component&&_)for(var b=_.length,I=0;I<b;I++){for(var T=_[I].churn_prediction,L={id:T.id,name:T.name},D=(x=Object.keys(t.entityMapJson)).length,E=0;E<D;E++)t.entityMapJson[x[E]].fieldid===T.score_field.id&&(L.label=L.label?L.label:I18n.getMsg("crm.zia.prediction.churn.result.nonsub"),L.value=t.entityMapJson[x[E]].defaultvalue),T.prediction_field&&t.entityMapJson[x[E]].fieldid===T.prediction_field.id&&(L.label=t.entityMapJson[x[E]].defaultvalue+" "+I18n.getMsg("crm.zia.prediction.churn.result.sub"));var R=!T.prediction_field||L.label!==I18n.getMsg("crm.zia.prediction.churn.result.nonsub");L.value&&R&&(Lyte.arrayUtils(y.component.getData("churn_prediction"),"push",L),a.css("display","block"))}var A=document.querySelector("crm-field-prediction-result");if(d&&A){for(var M=A.getData("prediction"),S=M.length,V=[],N=0;N<S;N++)V.push(M[N].id);var $=d.predictions_data,P=$?$.length:0;if($&&$.length>0)for(var O=[CrmField.UITYPES.BOOLEAN_DEF_NOT,CrmField.UITYPES.BOOLEAN_DEF],k=[CrmFieldConstants.DATE1,CrmFieldConstants.DATE_LONG,CrmFieldConstants.DATE2,CrmField.UITYPES.DATE_TIME1,CrmFieldConstants.DATE3,CrmFieldConstants.DATETIME_EVENT_START],J=[CrmField.UITYPES.CURRENCY,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP],U=0;U<P;U++){var F=$[U],B={id:F.prediction.id,name:F.prediction.name,trend:F.output.trend};F.output.critical_fields&&(B.critical_fields=F.output.critical_fields);var x,j=F.prediction;for(D=(x=Object.keys(t.entityMapJson)).length,E=0;E<D;E++){if(t.entityMapJson[x[E]].fieldid===j.predict_field.id&&(B.label=t.entityMapJson[x[E]].displaylabel),t.entityMapJson[x[E]].fieldid===j.prediction_field.id){var H=parseInt(t.entityMapJson[x[E]].uitype);B.value=t.entityMapJson[x[E]].defaultvalue,k.indexOf(H)>-1&&(B.uitype=H),J.indexOf(H)>-1&&(B.value=t.entityMapJson[x[E]].displayValue)}j.score_to&&t.entityMapJson[x[E]].fieldid===j.score_to.id&&(B.score=t.entityMapJson[x[E]].defaultvalue)}!V.contains(B.id)&&B.label&&B.value&&(O.indexOf(H)>-1?B.score&&(Lyte.arrayUtils(A.component.getData("prediction"),"push",B),i.css("display","block")):B.value&&(Lyte.arrayUtils(A.component.getData("prediction"),"push",B),i.css("display","block")))}}detailView.renderZiaScore(d.scoring_rule_data,t);var z=store.peekRecord(moduleRecordMapping[e].id,r.entityId);if(d.competitor_mentions_data&&d.competitor_mentions_data.output&&("Leads"===e||"Contacts"===e)&&moduleRecordMapping[e].isCompetitorMentionEnabled&&z&&z.Email){var G=[];G=(G=(G=(G=(G=G.concat(networkUtils.returnDependencyFiles(["crm-competitors-utilities.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-competitormention-widget.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-ui-loaders.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-competitormention-widget.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CompetitorAlertsWidget")],ResourceConstants.CRM));var W=r.entityId,Y=z.Email;Lyte.injectResources(G,void 0,(function(){Lyte.Component.render("crm-competitormention-widget",{entityId:W,module:e,entityEmail:Y,competitorInsight:d.competitor_mentions_data.output},"#competitorDetails")}))}document.querySelector("crm-besttime-new")&&d.best_mode_data&&Lyte.triggerEvent("bestModeFlexListener",d.best_mode_data)}))})),Crm.userDetails.detailView_newUI||crmBstTime.setPosition()}},createTemplate:function(t,i){var a;detailView.isSubformAjaxOpened=!1,t=removeRFMSegmentationCustomFields(t,detailView.currentModule),Lyte.registeredMixins.pathfinder&&(t=Lyte.registeredMixins.pathfinder.removePathFinderId(t,detailView.currentModule));var n=$("#requesterDetailPage"),s=$("#dv-button-layer");if(!(Mt=$("#iskanbanview").val())){var r=$("#rp_td"),o=r.find("#rPSelect select");o.data("select2")&&thirdPartyUtils.unbindChildSelect2(o);var l=r.clone();if($("#rightPanel").length>0&&r.hide(),!Crm.userDetails.CLIENT_ACCOUNT){var d=$("#taskDetailsPart").find("#taskDetailsUI");if(d.length>0){d.append(l);var c=d.find("#rPSelect select");c.data("select2")||thirdPartyUtils.bindSelect2(c)}}if(Crm.isActivitySplitDone){var u=l.find("#activity_right_panel_new_1");if(u&&u.length){var m=r.find("crm-activity-right-panel");if(m&&m.length){var p=m[0].getData();u.children("crm-activity-right-panel")[0].remove(),Lyte.Component.render("crm-activity-right-panel",p,"#activity_right_panel_new_1")}}}}var v=[CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.USERLOOKUP,CrmField.UITYPES.MULTISELECT_LOOK_UP,CrmField.UITYPES.CURRENCY,CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.SALESORDER_ID,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.POTENTIAL_ID,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP];if(Crm.userDetails.CLIENT_ACCOUNT){var g,f=t[businessCardJson.hidden.module].section;if(f&&f.length)for(var h=f.length,C=0;C<h;C++){var w=(g=f[C]?f[C].FL:void 0)?g.length:0;if(w){for(var y=0;y<w;y++)g[y].isClientPortalUser=!0,g[y].clientPortalName=Crm.userDetails.CLIENT_PORTAL_NAME;t[businessCardJson.hidden.module].section[C].FL=g}else g&&(g.isClientPortalUser=!0,g.clientPortalName=Crm.userDetails.CLIENT_PORTAL_NAME,t[businessCardJson.hidden.module].section[C].FL=g)}else{var _=(g=t[businessCardJson.hidden.module].section?t[businessCardJson.hidden.module].section.FL:void 0)?g.length:0;if(_){for(y=0;y<_;y++)g[y].isClientPortalUser=!0,g[y].clientPortalName=Crm.userDetails.CLIENT_PORTAL_NAME;t[businessCardJson.hidden.module].section.FL=g}else g&&(g.isClientPortalUser=!0,g.clientPortalName=Crm.userDetails.CLIENT_PORTAL_NAME,t[businessCardJson.hidden.module].section.FL=g)}}i||(i="leftPanel");var b=$("#"+i);if(0!=b.length){var I=detailView.currentModule=businessCardJson.hidden.module;if("Calls"===I&&isNewCallView){var T=networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],ResourceConstants.CRM);Lyte.injectResources(T,void 0,(function(){}))}if(void 0!==t.validationRuleJSONData&&CVRExec.init(t.validationRuleJSONData,I,"edit"),Crm.validationRuleJSONData&&Crm.validationRuleJSONData[I]){var L=Crm.validationRuleJSONData[I].validation_rules;L&&L.length>0&&L.forEach((function(e){if(e.field_validation){var i=e.field.column_name;if(t.entityMapJson[i]){t.entityMapJson[i].field_validation=!0;var a=t[I].section,n=1;Array.isArray(a)&&(n=t[I].section.length);for(var s=0;s<n;s++){var r=t[I].section[s]?t[I].section[s].FL:t[I].section.FL;if(r instanceof Array)for(var o=r.length,l=0;l<o;l++)i===r[l].colname&&(r[l].field_validation=!0);else i===r.colname&&(r.field_validation=!0)}}}}))}if(businessCardJson.terrDetails&&(t[I].terrDetails=businessCardJson.terrDetails),t[I].entityid&&(this.entityId=t[I].entityid),void 0!==window[I]&&(window[I].currentStatus="view",window[I].entityId=this.entityId),"1"===businessCardJson.isApproved&&t.layout_jsonarrayObj){if(null!=t.entityMapJson.LAYOUTID){var D=t.entityMapJson.LAYOUTID.defaultid,E=t.layout_jsonarrayObj,R=E.activeLayoutCnt,A=E.layout_jsonarrayObj,M=A.length;if(businessCardJson.userInRole.allowEditProf&&t.changeLayoutPermission)if(R>1)t.layout_jsonarrayObj.showChange=!0;else for(y=0;y<M;y++)A[y].LAYOUTID!==D&&A[y].STATUS&&(t.layout_jsonarrayObj.showChange=!0);var S=E.currLayoutId;for(y=0;y<M;y++)if(A[y].LAYOUTID===S){"12"===A[y].SOURCE&&(t.layout_jsonarrayObj.showChange=!1);break}}businessCardJson.layout_jsonarrayObj=t.layout_jsonarrayObj}businessCardJson.isLayoutAccessible=t.isLayoutAccessible,businessCardJson.isOldScoreView=!isMultiScoreAvail,businessCardJson.isProfileImageAccessible=!1;var V=t[I].section.length;for(C=0;C<V;C++){if(void 0!==t[I].section[C]&&"Record Image"===t[I].section[C].name&&null!==t[I].section[C].FL){businessCardJson.isProfileImageAccessible=!0,businessCardJson.isProfileImageReadOnly="true"===t[I].section[C].FL.readonly||!businessCardJson.hidden.SECURITY_EDIT_ALLOWED,s.removeClass("pB5 pT5");break}void 0!==t[I].section[C]&&"Record Image"!==t[I].section[C].name&&(businessCardJson.isProfileImageAccessible=!1,s.addClass("pB5 pT5"))}Handlebars.registerPartial("uiTypeTemplate",Handlebars.templates.uiTypeTemplate),Handlebars.registerPartial("toolTipTemplate",Handlebars.templates.toolTipTemplate),Handlebars.registerPartial("callButton",Handlebars.templates.CallButton),Handlebars.registerPartial("detailViewTags",Handlebars.templates.DetailViewTags),Handlebars.registerPartial("eventParticipantsListInner",Handlebars.templates.eventParticipantsListInner),detailView.bindScroll(I),this.sectionInit(t,I),this.changedBCJson=this.processBCJson(businessCardJson),ProcessFlow.recordIdVsTransitionDetails[this.entityId]=t.TransitionDetails,t[I].forDetailView="true";var N=!!(t.TransitionDetails&&t.TransitionDetails.Transitions&&t.TransitionDetails.Transitions.length>0),P=!(!t.TransitionDetails||!t.TransitionDetails.ProcessFieldId||null==t.TransitionDetails.ProcessFieldId);detailView.orchestrationDetailsArray=t.OrchTransDtls,detailView.pathfinderDetailsArray=t.PathFinderDtls,I.startsWith("PathFinder")&&(detailView.pathfinderDetailsArray=[]),this.changedBCJson.isTransitionAvailable=N,this.changedBCJson.isRecordInBlueprint=P;var O,k=!1,J=objectUtils.getValueFromObj(t,["entityMapJson","STAGE","fieldid"]),U=objectUtils.getValueFromObj(t,["TransitionDetails","ProcessFieldId"]);if("Potentials"===I&&J&&U&&(k=P&&J===U),detailView.profileImgPhotoId=t.entMetaData.photoID,this.changedBCJson.isStageProcessField=k,noteChk=this.changedBCJson.userInRole.notesPermission+"",Notes&&null!=Notes.noteChk&&(Notes.noteChk=noteChk),Crm.jsonSelectValues[I]=this.changedBCJson.jsonSelectValues,detailView.handleLockedRecord(),Crm.jsonDepValues[I]=this.changedBCJson.jsonValuesDep,jsonSelectValuesPotentials=this.changedBCJson.jsonSelectValuesPotentials,allowEditProf=this.changedBCJson.userInRole.allowEditProf,this.changedBCJson.title&&(document.title=this.changedBCJson.title),this.changedBCJson.modAndView="Calls"==I?isNewCallView?"Calls_NEW":"Calls_OLD":I,"Events"==I){if(!Crm.userDetails.CLIENT_ACCOUNT){var F=Handlebars.templates.eventParticipantsList(t);$("#right_invUserDetails")[0].innerHTML=F}t.entityMapJson.SEID&&"Accounts"==t.entityMapJson.SEID.entitymodule&&(Events.relAccId=t.entityMapJson.SEID.defaultid,Events.relAccName=t.entityMapJson.SEID.defaultvalue,Events.relAccMod=!0),this.changedBCJson.showStartMeeting=t.showStartMeeting;var B=returnJson.entMetaData.meeting_detials?JSON.parse(returnJson.entMetaData.meeting_detials):null;if(null!=B)B.recorded_details&&(this.changedBCJson.recordedDetailsAvail=!0);this.changedBCJson.meeting_data=t.meeting_detials,this.changedBCJson.isCanvasActivitySupportEnabled=Crm.userDetails.isCanvasActivitySupportEnabled,O=Handlebars.templates.EventBCViewTemplate,setTimeout((function(){thirdPartyUtils.bindPerfectScroll(".added_OnlyevtParticipants"),thirdPartyUtils.bindPerfectScroll("#tabContent_invited"),$("#tabContent_invited").find(".attendedInvitees").closest("li").remove()}),100)}else this.changedBCJson.showBusinessCard="Events"!==I&&!I.startsWith("Orchestration")&&!I.startsWith("PathFinder")&&"Calls_NEW"!==this.changedBCJson.modAndView,this.changedBCJson.isOrchestration=I.startsWith("Orchestration"),this.changedBCJson.isPathFinder=I.startsWith("PathFinder"),this.changedBCJson.crmAppName=Crm.appName,"Potentials"==this.changedBCJson.module&&null!=detailView.changedBCJson.crtdTimeNew&&(this.changedBCJson.crtdTime=detailView.changedBCJson.crtdTime,this.changedBCJson.createdstagedate=detailView.changedBCJson.crtdTimeNew),O=Handlebars.templates.BussinessCard;if(this.changedBCJson.hidden.hasOwnProperty("score")){var x=parseInt(parseInt(this.changedBCJson.hidden.score)/3.125).toString();this.changedBCJson.hidden.chartScore=x}if("Tasks"===I&&t.TransitionDetails){var j=ProcessFlow.recordIdVsTransitionDetails[this.entityId];t.entityMapJson&&t.entityMapJson.STATUS&&this.changedBCJson&&this.changedBCJson.securityEditAllowedAndNotCompleted&&t.entityMapJson.STATUS.fieldid===j.ProcessFieldId&&(this.changedBCJson.securityEditAllowedAndNotCompleted=!1)}if("Tasks"===I&&t.entityMapJson.STATUS&&"true"===t.entityMapJson.STATUS.readonly&&t.entityMapJson&&t.entityMapJson.STATUS&&this.changedBCJson&&this.changedBCJson.securityEditAllowedAndNotCompleted&&(this.changedBCJson.securityEditAllowedAndNotCompleted=!1),"Tasks"===I&&this.changedBCJson&&this.changedBCJson.securityEditAllowedAndNotCompleted&&(2===t.isApproved||3===t.isApproved)&&(this.changedBCJson.securityEditAllowedAndNotCompleted=!1),"Potentials"!=I&&"Leads"!=I||!this.changedBCJson.BCViewObject||(this.changedBCJson.BCViewObject=this.changedBCJson.BCViewObject.filter((function(e){return"PREDICTIONSCORE"!==e.colname}))),"Events"==I&&null!=returnJson.entMetaData.meeting_detials&&""!=returnJson.entMetaData.meeting_detials){var H=JSON.parse(returnJson.entMetaData.meeting_detials);if("yes"==this.changedBCJson.showStartMeeting||this.changedBCJson.isInvitedEvent){var z=new Date(returnJson.entityMapJson.STARTDATETIME.defaultvalue),G=new Date(returnJson.entityMapJson.ENDDATETIME.defaultvalue),W=new Date(z.getTime()-3e5),Y=(new Date(z.getTime()-9e5),new Date),q=Y>=W&&Y<G;"yes"==this.changedBCJson.showStartMeeting&&(this.changedBCJson.hostId==Crm.userDetails.USER_ID?this.changedBCJson.meetingBtnType="START":this.changedBCJson.isInvitedEvent&&q&&(this.changedBCJson.meetingBtnType="JOIN")),this.changedBCJson.isInvitedEvent&&q&&(H.showLinkUrl=!0)}this.changedBCJson.Fields.LOCATION&&(this.changedBCJson.Fields.LOCATION.defaultvalue="online"),this.changedBCJson.meetingLocation=I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[H.meeting_toolName]),this.changedBCJson.meetingDetails=H}if(t.Campaigns)for(var Z in this.changedBCJson.backstageeventid=t.Campaigns.backstageeventid,this.changedBCJson.budgetedcost=t.entityMapJson.BUDGETEDCOST&&t.entityMapJson.BUDGETEDCOST.defaultvalue?t.entityMapJson.BUDGETEDCOST.defaultvalue:0,this.changedBCJson.exchangeRate=t.entMetaData.EXCHANGERATE,validationUtils.isEmpty(this.changedBCJson.exchangeRate)||(this.changedBCJson.budgetedcost=this.changedBCJson.budgetedcost*this.changedBCJson.exchangeRate),t.entityMapJson)"Native__Backstage__Extn__Event_Start_Date"===t.entityMapJson[Z].sysRefName&&(this.changedBCJson.eventStartDate=t.entityMapJson[Z].defaultvalue);this.changedBCJson.IS_CLIENT_ACCOUNT=t.relListLabelsJson.IS_CLIENT_ACCOUNT||Crm.userDetails.CLIENT_ACCOUNT,this.changedBCJson.salesSummaryDetails=t.relListLabelsJson.salesSummaryDetails,Crm.isActivitySplitDone&&Lyte.Router.getRouteInstance().parent&&Lyte.Router.getRouteInstance().parent.parent&&"Tasks"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()&&(this.changedBCJson.isFromTasks=!0),!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-abm-configuration.js"],ResourceConstants.CRMClient),void 0,(function(){var e=Lyte.registeredMixins["crm-abm-utils"].getAccountConfiguration(),t=store.peekAll("module").find((function(e){return e.module_name===detailView.currentModule})).api_name;e?e.then((()=>{crmTab.ABMConfiguredModule===Lyte.Router.getRouteInstance().parent.parent.currentModel.module.api_name&&(detailView.changedBCJson.isABMWidgetAllowed=!0,Lyte.registeredMixins["crm-abm-utils"].injectABMWidgetResources())})):detailView.changedBCJson.isABMWidgetAllowed?Lyte.registeredMixins["crm-abm-utils"].injectABMWidgetResources():crmTab.ABMConfiguredModule===t&&(detailView.changedBCJson.isABMWidgetAllowed=!0,Lyte.registeredMixins["crm-abm-utils"].injectABMWidgetResources())})),a=store.peekAll("module").find((function(e){return e.module_name===I})).api_name,this.changedBCJson.isABMWidgetAllowed=!Crm.userDetails.CLIENT_ACCOUNT&&crmTab.isABMConfigured&&crmTab.ABMConfiguredModule===a,this.changedBCJson.IS_MEETINGBRIDGE_ENABLED=Crm.userDetails.MEETING_BRIDGE_ENABLED,this.changedBCJson.isCanvasActivitySupportEnabled=Crm.userDetails.isCanvasActivitySupportEnabled,"Tasks"===I&&detailView.showFollowUpTask&&(this.changedBCJson.showFollowUpTask=!0,delete detailView.showFollowUpTask);var K=O(this.changedBCJson);if(this.changedBCJson.isApproved>1&&null!=this.changedBCJson.isApproved?$(".DetailsPageRevampBox").addClass("isApproved"):$(".DetailsPageRevampBox").removeClass("isApproved"),b.append(K),!businessCardJson.isDetailViewBCEnabled&&businessCardJson.isMPLMigrationCompleted&&$("#businesscardDtls").hide(),"Tasks"==I&&Crm.userDetails.TaskPopup&&!Crm.userDetails.CLIENT_ACCOUNT&&document.getElementById("newAddFollowUp").addEventListener("click",(function(){crmRelatedList.relTaskCreate(this,entityID,void 0,void 0,"followup")})),$("div[id=markPopups]").empty(),"Services"==I){Crm.businessJSON=t.businessJSON;var X,Q=t.entityMapJson.SERVICESTATUS.defaultvalue,ee=this.changedBCJson.serviceAvailabilityViewJSON.serviceavailabilitydetails;this.changedBCJson.ServiceStatus=renderingUtils.getPickListDefaultValToActualValDetailView(t.entityMapJson.SERVICESTATUS),ee.isbusinesstiming?"custom"===ee.businessJSON.type&&ee.businessJSON.same_as_everyday&&(X=ee.businessJSON.details.split("-"),"HH:mm"===Crm.userDetails.TIME_FORMAT&&(X[0]=Utils.convertTimeValueTo24HourFormat(X[0]),X[1]=Utils.convertTimeValueTo24HourFormat(X[1])),ee.serviceTimeInUserFormat=X[0]+" - "+X[1]):ee.serviceTimeInUserFormat=ee.servicetime,ee.unavailableField=Q;var te=!!t.entityMapJson.MXNDUMMYCOLUMN_SERVICE;this.changedBCJson.serviceAvailabilityViewJSON.serviceavailabilitydetails.EDIT_ALLOWED_SA=this.changedBCJson.hidden.EDIT_ALLOWED_SA;for(var ie=null,ae=t[I].section.length,ne=0;ne<ae;ne++)if("Availability Information"==t[I].section[ne].systemName){ie=t[I].section[ne];break}var se=$("#markPopups"),re=Handlebars.templates.ServiceModuleUtils();if(se.html(re),Lyte.Component.render("crm-services-availability",{returnedJsonval:this.changedBCJson.serviceAvailabilityViewJSON.serviceavailabilitydetails,isMemberFieldAvailable:te},"#serviceAvailabilityViewDiv"),te){var oe=t.entityMapJson.MXNDUMMYCOLUMN_SERVICE.selectedid.split(",");Lyte.Component.render("crm-user-list",{displayIds:oe,header:[{systemValue:"full_name",displayValue:I18n.getMsg("crm.zti.label.user"),yield:!1},{systemValue:"role",displayValue:I18n.getMsg("cob.role"),yield:!1},{systemValue:"email",displayValue:I18n.getMsg("zoho.email"),yield:!1},{systemValue:"profile",displayValue:I18n.getMsg("Profile"),yield:!1},{systemValue:"status",displayValue:I18n.getMsg("Status"),yield:!1}]},"#serviceMemberList"),$("#ServiceMultiUserComponent").length>0&&document.getElementById("ServiceMultiUserComponent").setMethods("onAssign",(function(e){detailView.saveServiceMembers(e)}))}detailView.serviceAvailabiltyData.serviceAvailabiltySection=ie,detailView.serviceAvailabiltyData.detailViewJson=t}if("Appointments"==I){if(Crm.businessJSON=t.businessJSON,Crm.holidays=t.holidays,Crm.businessJSON.business_days){if((he=Crm.businessJSON.business_days.length)>0&&he<7){var le=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(y=0;y<he;y++)le.removeFirstOccurenceOfElement(Crm.businessJSON.business_days[y]);Crm.businessJSON.closedDay=le}}else Crm.businessJSON.closedDay=[];(se=$("#markPopups")).empty();re=Handlebars.templates.ServiceModuleUtils();se.html(re);var de,ce,ue,me=null,pe=null,ve=null,ge=t.entityMapJson.APPOINTMENTSTATUS&&t.entityMapJson.APPOINTMENTSTATUS.defaultvalue!==I18n.getMsg("Cancelled");detailView.currencyDetails=t.currencyDetails;var fe=t[I].section.length;for(ne=0;ne<fe;ne++){if("Reschedule Information"==t[I].section[ne].systemName){var he=(me=t[I].section[ne]).FL.length;for(y=0;y<he;y++)"RESCHEDULEDFROM"===me.FL[y].colname&&(me.FL[y].readonly="true")}if(ge&&"Cancellation Information"==t[I].section[ne].systemName){he=(pe=t[I].section[ne]).FL.length;t[I].section[ne].sectionFieldLength=he}if("Appointment Information"===t[I].section[ne].systemName){var Ce=t[I].section[ne];for(he=Ce.FL?Ce.FL.length:0,y=0;y<he;y++)"APPOINTMENTDATEANDTIME"==Ce.FL[y].colname&&(ve=Ce.FL[y],ce=ne,de=y),"REMINDER"==Ce.FL[y].colname&&(ue=Ce.FL[y].reminderTime)}t[I].section[ne].section_id>3&&(t[I].section[ne].displaylabel=I18n.getMsg("Job Sheet Information"))}if(ue&&de&&(t[I].section[ce].FL[de].reminderTime=ue),detailView.AppSection=ve,detailView.rescheduleAppSection=me,detailView.cancelAppSection=pe,detailView.Service_needed_Details=t.Service_needed_Details,ge&&pe){var we=pe.FL.length,ye=$("#appointmentCancelDivFields");for(0==$(ye).is(":empty")&&$(ye).empty(),ne=0;ne<we;ne++)"Cancelled_By"==pe.FL[ne].sysRefName||pe.FL[ne].isExternalField||$(ye).append(crmTemplate.createFieldRow(t.layout_jsonarrayObj.sysLayoutId,I,void 0,Object.assign({},pe.FL[ne])));var _e=ye.find("select");_e&&_e.length&&thirdPartyUtils.bindSelect2(_e)}}if(t.dataParamDetails&&(detailView.dataParamDetails=t.dataParamDetails,detailView.dataParamDetails.isLoaded=!0,detailView.dataParamDetails.isUpdated=!1,detailView.dataParamDetails.isoCode=t.entMetaData.recordISOCode,detailView.dataParamDetails.recordInfo=Object.assign({},store.peekRecord(moduleRecordMapping[I].id,businessCardJson.entityid))),"Calls"==I&&isNewCallView)Lyte.Component.render("calls-businesscard",{bcfieldsArray:this.changedBCJson.BCViewObject,metadata:t.entMetaData,activityId:this.changedBCJson.entityid,recordingType:this.changedBCJson.recordingType,recordingUrlArray:this.changedBCJson.recordingUrl,isNewDetailView:Crm.userDetails.detailView_newUI},"#lyteBCard"),$("#callsdtTag").html(Handlebars.templates.DetailViewTags(this.changedBCJson));else{var be;if("undefined"!=typeof businessCardJson&&(!0===businessCardJson.showRespondLink||businessCardJson.waitingusers))be=(be=(be=(be=networkUtils.returnDependencyFiles(["crm-approval-process-menu.js","approvalprocess-mixins.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("approvalprocess")],ResourceConstants.CRM)),Lyte.injectResources(be,void 0,(function(){Lyte.Component.render("crm-approval-process-menu",{show:"true",query:"#respondApproval",thisObj:businessCardJson},"#ApprovalProcess"),Lyte.Component.render("crm-approval-process-rejectorlistshow",{show:"true",query:"#approvalStagepop",thisObj:businessCardJson,fromdetailview:!0,approverList:businessCardJson.approversNameList.fullUserList},"#approvalStagepop")}));if("undefined"!=typeof businessCardJson&&businessCardJson.waitingusers,"undefined"!=typeof businessCardJson&&"3"===businessCardJson.isApproved)be=(be=(be=networkUtils.returnDependencyFiles(["crm-approval-process-menu.js"],ResourceConstants.CRMClient)).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],ResourceConstants.CRMClient)),Lyte.injectResources(be,void 0,(function(){Lyte.Component.render("crm-approval-process-menu",{show:"true",query:"#respondApproval",thisObj:businessCardJson},"#ApprovalProcess"),Lyte.Component.render("crm-approval-process-rejectorlistshow",{show:"true",query:"#approvalStagepop",thisObj:businessCardJson,fromdetailview:!0,approverList:businessCardJson.approversNameList.fullUserList},"#approvalStagepop")})),$("#newleft_UpdatedTime").addClass("vaBottom mR5")}if(!n.length)if(store.peekRecord("features-status",moduleRecordMapping[I].api_name))this.loadZiaDependentComponents(I,t);else{var Ie=this;store.findAll("features-status",{module:moduleRecordMapping[I].api_name,group:"zia",page:1,per_page:20}).then((function(e){e&&Ie.loadZiaDependentComponents(I,t)}))}if(Crm.isKioskEnabled&&t.associated_kiosks&&t.associated_kiosks.length>0&&(Lyte.registeredMixins.kiosk_execute.renderKiosk(t,t[I].entityid,I),Lyte.registeredMixins.kiosk_execute.previewKiosk()),"Campaigns"==I&&networkUtils.loadFeatureScripts(["zohocrm_CampaignInteg.js","zohocrm_crmListViewInPopupTemplate.js"],(function(){CrmCampaignInteg.init(returnJson,void 0)})),!N||detailView.recordLocked||detailView.refreshInWms||detailView.changedBCJson.recordLockingDetails&&businessCardJson.isEditRestricted)void 0!==detailView.orchestrationDetailsArray&&detailView.orchestrationDetailsArray.length&&detailView.orchestrationDetailsArray.length&&Lyte.injectResources(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-detailview-pop.js"],ResourceConstants.CRMClient)).then((function(){var e={orchestrations:detailView.orchestrationDetailsArray,isbothactive:!1},t=Handlebars.templates.TransitionButtonLayer(e);$("#pb_processButtonLayer").append(t)})),void 0!==detailView.pathfinderDetailsArray&&detailView.pathfinderDetailsArray.length&&detailView.pathfinderDetailsArray.length&&Lyte.injectResources(networkUtils.returnDependencyFiles(["setup/pathfinder/crm-pathfinder-detailview-pop.js"],ResourceConstants.CRMClient)).then((function(){var e={pathfinders:detailView.pathfinderDetailsArray,isbothactive:!1},t=Handlebars.templates.TransitionButtonLayer(e);$("#pb_processButtonLayer").append(t),void 0!==detailView.orchestrationDetailsArray&&detailView.orchestrationDetailsArray.length||$L("#pfDetailViewPopData").removeClass("pT15")}));else{if(ProcessFlow.recordIdVsTransitionDetails[this.entityId]=t.TransitionDetails,(j=ProcessFlow.getBlueprintButtonLayerDetails(ProcessFlow.recordIdVsTransitionDetails[this.entityId],this.entityId)).orchestrations=detailView.orchestrationDetailsArray,j.pathfinders=detailView.pathfinderDetailsArray,j.isApproved=detailView.isApproved,Lyte.injectResources(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Blueprint")],ResourceConstants.CRM),void 0,void 0),detailView.orchestrationDetailsArray&&detailView.orchestrationDetailsArray.length||detailView.pathfinderDetailsArray&&detailView.pathfinderDetailsArray.length)(detailView.orchestrationDetailsArray&&detailView.orchestrationDetailsArray.length||detailView.pathfinderDetailsArray&&detailView.pathfinderDetailsArray.length)&&(j.isbothactive=!0,Lyte.injectResources(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-detailview-pop.js","setup/pathfinder/crm-pathfinder-detailview-pop.js"],ResourceConstants.CRMClient)).then((function(){var e=Handlebars.templates.TransitionButtonLayer(j);$("#pb_processButtonLayer").append(e),void 0!==detailView.orchestrationDetailsArray&&detailView.orchestrationDetailsArray.length||$(".pbconfigProcess")[0]||$L("#pfDetailViewPopData").removeClass("pT15")})));else{var Te,Le=Handlebars.templates.TransitionButtonLayer(j);$("#pb_processButtonLayer").html(Le),$("#InnerTransDivider .ptContainer").each((function(){var e=$(this);Te=Math.round(e.outerWidth())-18,e.find(".ptButton").css("max-width",Te)}))}j.IsCriteriaTransEnabled&&(ProcessFlow.initBlueprintLyteHoverCard(!1,"InnerTransDivider","bp_hoverCardDiv",!1),ProcessFlow.setMouseEventForDisabledTransitions())}var De=!1;if(Crm.userDetails.permissions["Crm_Implied_Merge_"+I]&&(De=!0),this.changedBCJson.profPerm=De,"Products"===I)this.changedBCJson.FindAndMergePerm=Crm.userDetails.FindAndMergePerm;else if("Potentials"===I){var Ee=returnJson.entityMapJson.STAGE.stageId,Re=returnJson.entityMapJson.STAGE.val.length;for(y=0;y<Re;y++){if(Ee===(st=returnJson.entityMapJson.STAGE.val[y].stageId))"Open"===returnJson.entityMapJson.STAGE.val[y].fctype&&(this.changedBCJson.openStageType=!0)}}I.startsWith("CustomModule")?this.changedBCJson.custModCheck=!0:this.changedBCJson.custModCheck=!1;var Ae=Handlebars.templates.DetailPageMenu;if(moduleRecordMapping.SalesOrders&&(this.changedBCJson.haveSOPermission=moduleRecordMapping.SalesOrders.visible,this.changedBCJson.SalesOrderSingularLabel=moduleRecordMapping.SalesOrders.singular_label),moduleRecordMapping.Invoices&&(this.changedBCJson.haveInvoicesPermission=moduleRecordMapping.Invoices.visible,this.changedBCJson.InvoiceSingularLabel=moduleRecordMapping.Invoices.singular_label),moduleRecordMapping.SalesOrders&&moduleRecordMapping.Invoices&&(this.changedBCJson.isConvertButtonNeeded=moduleRecordMapping.SalesOrders.visible||moduleRecordMapping.Invoices.visible),this.changedBCJson.isInvoiceBooksCustomModule)Ae=Handlebars.templates.DetailPageMenuZBModule;this.changedBCJson.colorCode&&(t[I].color_code=this.changedBCJson.colorCode),t[I].isLockedFromProcessing=this.changedBCJson.isLockedFromProcessing,t[I].isClientPortalUser=Crm.userDetails.CLIENT_ACCOUNT,t[I].layout_jsonarrayObj=t.layout_jsonarrayObj;var Me=getDomWidthCalculation(t[I].section,"detail");t[I].isSubformRowCountEnhancementDone=Crm.userDetails.isSubformNewComponentEnabled;var Se=Handlebars.templates.crmDetailView(t[I]);if("Tasks"===I||"Calls"===I||"Events"===I)var Ve=36;else Ve=17;this.changedBCJson.isInReviewProcess="false",this.changedBCJson.inVisionApproval="false","10"!==this.changedBCJson.isApproved&&"12"!==this.changedBCJson.isApproved&&"13"!==this.changedBCJson.isApproved||(this.changedBCJson.inVisionApproval="true"),t[I].rpRecordDetls&&(this.changedBCJson.isInReviewProcess="true"),t[I].isRpEnabled&&(this.changedBCJson.isRpEnabled="true");var Ne=$(".newBusinessCardView .forceHyphen"),$e=$(Se),Pe=$e.find("#subform_value_ITEMDESCRIPTION"),Oe=Pe.length;for(y=0;y<Oe;y++){var ke=Pe.eq(y),Je=document.createElement("span"),Ue=document.createElement("hr");$(Ue).css({"border-color":"#ffffff00"}),Je.append(Ue);var Fe=ke.closest("tr"),Be=Fe.find("#subform_value_PRODUCTID").closest("td")[0];if(Be)ke.find("pre").text()&&(Be.append(Je),Be.append(ke.closest("div")[0]));Fe.find("td.itemDescElm").remove()}var xe=$e.find(".forceHyphen"),je=xe.length;if(je>0)for(var He=0;He<je;He++){""!==xe.html().trim()&&xe.removeClass("forceHyphen")}if(Ne.length>0)""!==Ne.html().trim()&&Ne.removeClass("forceHyphen");$e.find(".contInfoTab_0 .labelTab, .singleColLayout .labelTab").addClass("columnCal1"),$e.find(".contInfoTab_1 .labelTab").addClass("columnCal2"),$e.find(".columnCal1").css("width",Me[0]+Ve+"px"),$e.find(".columnCal2").css("width",Me[1]+Ve+"px");var ze=$("#preHTMLContainer"),Ge=$("#fullInfoDiv");for(V=t[I].section.length,C=0;C<V;C++)void 0!==moduleRecordMapping[I]&&"team_based"===moduleRecordMapping[I].access_type&&"Requesters"===moduleRecordMapping[I].private_profile.name&&n&&t[I].section[C].layout;Ge.children("div").addClass("rq_dblWrap"),ze.html($e);var We="",Ye="";if(void 0!==detailView.affectedData&&"changeOwner"in detailView.affectedData){var qe=detailView.affectedData.changeOwner;detailView.affectedData={};var Ze=qe.length;for(y=0;y<Ze;y++)We+="#value_"+qe[y]+",",Ye+="#header_"+qe[y]+","}else if(void 0!==detailView.affectedData&&2===detailView.affectedData.length&&"OtherThanGlobalAndFieldEdit"===detailView.affectedData[1]||"Tasks"!==I&&"Events"!==I&&void 0!==detailView.affectedData&&Object.keys(detailView.affectedData).length>0){var Ke=[];for(let e in detailView.affectedData[0])Ke.push(e);detailView.affectedData={};var Xe=returnJson.entityMapJson;for(var Qe in Xe){var et=Xe[Qe].colname;116===parseInt(Xe[Qe].uitype)&&Ke.includes(Xe[Qe].sysRefName)&&(We+="#value_"+et+",",Ye+="#header_"+et+",")}Crm.userDetails.isSubformNewComponentEnabled&&Ke.length>0&&document.querySelectorAll("crux-subform").forEach((function(e){e.highlightAggregateField(Ke)}))}else if(void 0!==detailView.affectedData&&detailView.affectedData.length>0){var tt=detailView.affectedData;detailView.affectedData={},tt.forEach((function(e){We+="#value_"+e+",",Ye+="#header_"+e+","}))}""!==We&&""!==Ye&&(We=We.substring(0,We.length-1),Ye=Ye.substring(0,Ye.length-1),$L(".fr_highLightFormulaField").removeClass("fr_highLightFormulaField"),setTimeout((function(){$L(We).addClass("fr_highLightFormulaField"),$L(Ye).addClass("fr_highLightFormulaField"),We="",Ye=""}),10)),"Tasks"!==I&&"Calls"!==I&&"Events"!==I||ze.find(".detailViewContainer").addClass(I);var it=window.location.hostname.split(".");try{if(t[I].subforms&&Crm.isCpqActivated()&&!window.clientPortalName)Lyte.resolvePromises([store.triggerAction("entity","cpq_suggestions",{module:moduleRecordMapping[I].api_name,entityId:t[I].entityid},{group_by:"field",limit_per_group:"50"}),store.triggerAction("entity","cpq_logs_availability",{module:moduleRecordMapping[I].api_name,entityId:t[I].entityid})]).then(function(e){var i=t[I].subforms.section,a=i.length;if(!Crm.userDetails.isSubformNewComponentEnabled)for(var n=0;n<a;n++){var s=".subFormSec_"+i[n].subFormTabId+" .subFrmTablWrapper";$(s).before('<div id="cpq_sugg_'+i[n].subFormTabId+'"></div>')}setTimeout(function(){for(var n=store.peekRecord(moduleRecordMapping[I].id,Lyte.Router.getRouteInstance().transition.data.recordId),s=0;s<a;s++){Lyte.Component.render("crm-cpq-appliedrules",{baseModule:I},"#cpq_sugg_"+i[s].subFormTabId).component.executeMethod("loadData",e[0],i[s].subFormName,t[I].entityid,n,e[1])}}.bind(this),50)}.bind(this))}catch(t){murphy.error(e)}void 0===moduleRecordMapping.ZohoCPQ||!Crm.isCpqActivated()||it.includes("sandbox")||void 0!==clientPortalName||"Products"!==I&&"Bundles"!==I&&"Quotes"!==I&&"SalesOrders"!==I&&"PurchaseOrders"!==I&&"Invoices"!==I&&"PriceBooks"!==I||setTimeout((function(){Lyte.Component.render("crm-cpq-breadcrumb",{},"#cpq-breadcrumb")}),200),Lyte.registeredMixins["crm-uploadfields-mixin"]&&Lyte.registeredMixins["crm-uploadfields-mixin"].setShowPreviewMethodForAllFileUploadFieldCruxComponents(),ze.find(".uitype_555 , .uitype_20").addClass("noBorderDetailStyle"),ze.find(".uitype_20").addClass("noHoverDetailStyle"),ze.find(".uitype_555").addClass("fileUploadAjaxWrap");var at=ze.find(".imageUploadHead"),nt=at.length;nt&&(detailView.getThumbnailDataMap={},Lyte.registeredMixins["crm-uploadfields-mixin"].thumbnailRequestForDV(I,at,this.entityId));for(y=0;y<nt;y++){var st=at[y].component.getData("cxPropValue"),rt=at[y].component.getData("cxPropId"),ot=at[y].id.split("_")[1];Lyte.registeredMixins["crm-uploadfields-mixin"].combineImageDataWithSrc(st,ot,!0,rt),Lyte.registeredMixins["crm-uploadfields-mixin"].getCruxImageUploadComponents(rt,"view").setMethods({onPreviewClose:function(){detailView.isImageModified[this.getData("cxPropId")]&&$L("#crmspanid").click()},onRemove:function(){detailView.isImageModified[this.getData("cxPropId")]=!0},onEdit:function(){detailView.isImageModified[this.getData("cxPropId")]=!0},onCropSuccess:function(e,t){return detailView.isImageModified[this.getData("cxPropId")]=!0,Lyte.registeredMixins["crm-uploadfields-mixin"].onCropSuccess(e,t)},onValidationImageClick:function(e){var t=this.$node.getAttribute("colName"),i=moduleRecordMapping[I].fields.filterBy({column_name:t})[0];return Lyte.registeredMixins["crm-uploadfields-mixin"].openFeaturePopup(e.id,e.state,!1,!0,i.id,I,entityID.value,this.$node.getAttribute("api_name"))}})}var lt=v.length;for(y=0;y<lt;y++)221==v[y]?ze.find(".uitype_"+v[y]).addClass("lookupFieldCreate userLookupNewUI "):ze.find(".uitype_"+v[y]).addClass("lookupFieldCreate ");var dt=$("#zcampDiv");if(dt.length>0&&$("#tableId").after(dt),void 0!==t.formRuleJSONData&&(CFRExec.init(t.formRuleJSONData,I,"view"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)),returnJson.backTo&&(this.changedBCJson.backTo=returnJson.backTo),this.changedBCJson.isChatConfigured&&("Baihui"===Crm.brandName?this.changedBCJson.brandName="China":this.changedBCJson.brandName=Crm.brandName),"Calls"===I&&isNewCallView&&!Crm.userDetails.DETAIL_VIEW_HEADER_LYTE){s.empty();var ct=Lyte.Component.registeredHelpers.whichPBService();Lyte.Component.render("calls-dpmenu",{detailViewJson:this.changedBCJson,isActivitySplitDone:Crm.isActivitySplitDone,metadata:t.entMetaData,pbServiceName:ct},"#dv-button-layer"),$("#secDiv_Call_Information").hide(),Crm.userDetails.CLIENT_ACCOUNT&&0===$L("#secDiv_Purpose_Of_Outgoing_Call,#secDiv_Outcome_Of_Outgoing_Call,#secDiv_Reason_For_Incoming_Call").length&&$L(".showhideDetailsDivEle").addClass("dN")}else{if("Calls"===I&&isNewCallView&&$("#secDiv_Call_Information").hide(),"Services"==I){if(Crm.businessJSON=t.businessJSON,Crm.holidays=t.holidays,Crm.holidays.selectedDate=[],Crm.businessJSON.business_days){if((he=Crm.businessJSON.business_days.length)>0&&he<7){for(le=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],y=0;y<he;y++)le.removeFirstOccurenceOfElement(Crm.businessJSON.business_days[y]);Crm.businessJSON.closedDay=le}}else Crm.businessJSON.closedDay=[];this.changedBCJson.SERVICESTATUS=t.entityMapJson.SERVICESTATUS,detailView.ServiceAvailMax_Date=businessCardJson.serviceAvailabilityViewJSON.serviceavailabilitydetails.ServiceAvailMax_Date,detailView.ServiceAvailMin_Date=businessCardJson.serviceAvailabilityViewJSON.serviceavailabilitydetails.ServiceAvailMin_Date,this.changedBCJson.markasUnavailNeed=!0,(detailView.ServiceAvailMax_Date&&new Date(detailView.ServiceAvailMax_Date).getTime()-((new Date).getTime()+6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE))<-864e5||detailView.ServiceAvailMin_Date&&new Date(detailView.ServiceAvailMin_Date).getTime()>=(new Date).getTime()+6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE)||"Not in Use"===renderingUtils.getPickListDefaultValToActualValDetailView(t.entityMapJson.SERVICESTATUS))&&(this.changedBCJson.markasUnavailNeed=!1)}else if("Appointments"==I){var ut=$("a#changeOwnerIco"),mt=$("#value_SMOWNERID,#headervalue_SMOWNERID");$("#mouseArea__APPOINTMENTFOR,#mouseArea__SERVICEID,#mouseArea__APPOINTMENTDATEANDTIME,#mouseArea__APPOINTMENTDURATION,#mouseArea__APPOINTMENTADDRESS").addClass("readOnlyFld"),$("#mouseArea__RESCHEDULEDBY,#mouseArea__CANCELLEDBY").removeClass("readOnlyFld"),$("#headervalue_APPOINTMENTDATEANDTIME,#headervalue_SERVICEID").addClass("lockIconBC"),ut.length>0&&ut.remove(),mt.length>0&&mt.addClass("without-after"),t.entityMapJson.APPOINTMENTSTATUS&&(this.changedBCJson.AppStatus=renderingUtils.getPickListDefaultValToActualValDetailView(t.entityMapJson.APPOINTMENTSTATUS),this.changedBCJson.APPOINTMENTSTATUS=t.entityMapJson.APPOINTMENTSTATUS),Lyte.registeredMixins["crm-appointments-mixin"].appointmentPreferences=this.changedBCJson.appointmentPreferences,Lyte.registeredMixins["crm-appointments-mixin"].servicePreferences=this.changedBCJson.servicePreferences,Object.keys(t.Service_needed_Details).length>0&&(this.changedBCJson.SERVICESTATUS=t.Service_needed_Details.Status.systemvalue,this.changedBCJson.serviceId=t.Service_needed_Details.id,this.changedBCJson.canAddJobSheet=this.changedBCJson.servicePreferences.job_sheet_enabled&&t.Service_needed_Details.Job_Sheet_Section__s&&"false"===t.entityMapJson.ISJOBSHEETCREATED.defaultvalue&&this.changedBCJson.hidden.EDIT_ALLOWED_SA&&"Completed"===this.changedBCJson.AppStatus,this.changedBCJson.JobSheetSection=this.changedBCJson.canAddJobSheet?t.Service_needed_Details.Job_Sheet_Section__s.uservalue:null,detailView.Service_needed_Details.EDIT_ALLOWED_SA=this.changedBCJson.hidden.EDIT_ALLOWED_SA),$("#mouseArea__ENDTIME").parent().remove(),$("#mouseArea__JOBSHEETSECTION").parent().remove(),$("#mouseArea__ISJOBSHEETCREATED").parent().remove()}if(detailView.recordLocked){ut=$("a#changeOwnerIco");var pt=$("a#changeLayoutIco"),vt=$("#value_SMOWNERID,#headervalue_SMOWNERID,#value_LAYOUTID,#headervalue_LAYOUTID");ut.length>0&&ut.remove(),pt.length>0&&pt.remove(),vt.length>0&&vt.addClass("lockedRecordEnb")}this.makeFieldLocked();var gt=t[I].rpRecordDetls;if(gt){var ft="none";if(t&&Object.keys(gt).length>1){gt.reviewedCount=gt.rpApprFields+gt.rpRejFields,gt.reviewedCount>0&&gt.reviewedCount!==gt.rpTotalFields&&!gt.isResubmit&&(ft="block");var ht={};ht.module=I,ht.id=this.entityId,ht.calleeObj="Crm",ht.clickId="deleteEntity",gt.rpdeleteParams=ht}gt.styledisplay=ft,this.changedBCJson.rpRecordDtls=gt,businessCardJson.rpRecordDtls=gt}else if(!this.recordLocked&&Crm.userDetails.isRpCustomFunctionEnabled&&"7"===this.changedBCJson.isApproved){var Ct=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(Ct,void 0,(function(){Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:moduleRecordMapping&&moduleRecordMapping[I]?moduleRecordMapping[I].plural_label:I},"#dv-button-layer"),$L("#rpFunctionInProgress").e.ltProp("show",!0),renderingUtils.showFreezeLayer()}))}else gt||(this.changedBCJson.rpModuleName=t[I].rpModuleName,businessCardJson.rpModuleName=t[I].rpModuleName);Crm.jsonSelectValues[I]=businessCardJson.jsonSelectValues,businessCardJson.IS_CLIENT_ACCOUNT=Crm.userDetails.CLIENT_ACCOUNT,(Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyPrefEnabledModules.contains(returnJson.relListLabelsJson.module)||Crm.userDetails.isHipaaFeatureEnabled&&Crm.userDetails.isHipaaPrivacyEnabled&&Crm.userDetails.hipaaEnabledModules.contains(returnJson.relListLabelsJson.module))&&(businessCardJson.PRIVACYPREF_ENABLED_MODULE=!0),returnJson[returnJson.relListLabelsJson.module].rpRecordDetls&&(businessCardJson.isInReviewProcess="true"),returnJson.relListLabelsJson&&(businessCardJson.canShowDataPrivacyTab=returnJson.relListLabelsJson.canShowDataPrivacyTab),Crm.isActivitySplitDone&&(this.changedBCJson.isActivitySplitDone=!0),returnJson.record_actions&&returnJson.business_card_meta||s.html(Ae(this.changedBCJson));var wt=Handlebars.templates.DetailViewInnerTabs(businessCardJson);if(returnJson.hideDetailsViewInnerTabs){$L("#DetailViewInnerTabs").hide(),$L("#backArrowDV").hide();var yt=$L(".dv_header_container.dF")[0];yt&&(wt=wt.trimEnd(),yt.append($L(wt).find("#detailViewApprovalMessageDiv")[0]))}else $("#DetailViewInnerTabs").html(wt);detailView.currentModule&&detailView.currentModule.indexOf("CustomModule500")>-1&&$("#newleft_History").addClass("disable")}if(detailView.doDetailViewTagsRendering(t),detailView.tableSet=!1,"Events"==I){var _t=$("#eventsAddnInfo"),bt=(F=$("#right_invUserDetails"),$("#detailviewTags"));_t.find(F).remove(),Ge.before(F),bt.length?bt.after(_t):Ge.after(_t),this.populateDVTitle();var It={};It.id=detailView.changedBCJson.entityid,It.status=detailView.changedBCJson.eventStatus;var Tt=returnJson.entityMapJson.EVENTSTARTDATETIME?returnJson.entityMapJson.EVENTSTARTDATETIME.defaultvalue:returnJson.entityMapJson.STARTDATETIME.defaultvalue,Lt=returnJson.entityMapJson.EVENTENDDATETIME?returnJson.entityMapJson.EVENTENDDATETIME.defaultvalue:returnJson.entityMapJson.ENDDATETIME.defaultvalue;It.start=new Date(Tt),It.end=new Date(Lt),It.title=returnJson.entityMapJson.SUBJECT.defaultvalue,It.invMailType=detailView.changedBCJson.invMailType,Events.currentEventObjectInView=It,$("#leftPanel").after($("#plugin"))}if("Potentials"==I){var Dt=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MultiPipelines")],ResourceConstants.CRM),Et=networkUtils.returnDependencyFiles(["crm-detail-view-utils.js"],ResourceConstants.CRMClient).concat(Dt);Lyte.injectResources(Et,void 0,(function(){var e;SalesSummaryInfo={},SalesSummaryInfo.DEALDURATION=returnJson.entMetaData.DEALDURATION,SalesSummaryInfo.SALESDURATION=returnJson.entMetaData.SALESDURATION,SalesSummaryInfo.QUALIFICATIONDURATION=returnJson.entMetaData.QUALIFICATIONDURATION;var i=$("#stageContain");i.length>0&&(i.empty(),Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent());var a,n=i.find(".lineStage .order-step"),s=i.find(".lineStage"),r=$("#mouseArea__STAGE").data("params");if(r&&r.defaultvalue){var o=r.defaultvalue.indexOf(":"),l=[r.defaultvalue.substr(0,o),r.defaultvalue.substr(o+1)];a=r.stageId;var d=l[1];e=returnJson.entityMapJson.STAGE.val instanceof Array?returnJson.entityMapJson.STAGE.val.filter((function(e){if(e.pbty===l[0]&&e.content===l[1]||e.stageId===a&&e.content===l[1])return e})):returnJson.entityMapJson.STAGE.val}else{d=$("#subvalue_STAGE").text();e=returnJson.entityMapJson.STAGE.val instanceof Array?returnJson.entityMapJson.STAGE.val.filter((function(e){if(e.content===d)return e})):returnJson.entityMapJson.STAGE.val}var c=$("li[data-stageid="+a+"]"),u=c.find(".sToolTipBottom").find("select"),m=d;e.length?(m=e[0].pbty+":"+e[0].content,e[0].stageId&&i.find('li[data-stageid=""]').remove(),i.find('li[data-value="'+$.escapeSelector(m)+'"]').length<=0&&(m=returnJson.entityMapJson.STAGE.defaultvalue)):m=returnJson.entityMapJson.STAGE.defaultvalue,$("#potclosedv").val(m),thirdPartyUtils.bindSelect2("#potclosedv"),PStageDiv=n.length-1,i.length>0&&setWidthHeightStageObject(i,n,s),$("#flw_div").addClass("dN"),stageSelectBind(u,c),k||s.on("click",".order-step",(function(){$("#stageContain").hasClass("disableNavigator")||(CVRExec&&(CVRExec.prevStage=$("#stageContain li.active").attr("data-stageid")),detailView.stageClickHandler(this))})),s.on("mouseenter",".order-step",(function(){if($("#stageContain").hasClass("disableNavigator"))crmui.showTooltip(I18n.getMsg("crm.pipeline.detailview.disable"),void 0,"center",this);else{var e=$(this);e.prev(),e.next()}})),s.on("mouseleave",".order-step",(function(){crmui.hideTooltip()})),"0:-None-"===m?(i.find('li[data-value="'+$.escapeSelector(m)+'"]').remove(),i.find("li").removeClass("enable").removeClass("active").addClass("inactive")):detailView.stageClickHandler(i.find('li[data-value="'+$.escapeSelector(m)+'"]')),i.find("#subvalue_CLOSINGDATE").text($("#value_CLOSINGDATE").text().trim()),(!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"undefined"!=typeof allowEditProf&&!1===allowEditProf)&&i.find("li").removeAttr("onclick").off("click"),t.entityMapJson.ACCOUNTID&&(ZInvoice.potentialDetails.accountID=t.entityMapJson.ACCOUNTID.defaultid),t.entityMapJson.CONTACTID&&(ZInvoice.potentialDetails.contactID=t.entityMapJson.CONTACTID.defaultid),ZInvoice.potentialDetails.potentialName=t.entityMapJson.POTENTIALNAME.defaultvalue}))}if("Contacts"===I&&t.entityMapJson.ACCOUNTID&&(ZInvoice.contactDetails.accountID=t.entityMapJson.ACCOUNTID.defaultid),"PriceBooks"==I){var Rt=$("#secDiv_Pricing_Details");t.entityMapJson.PRICINGDETAILS&&0==t.entityMapJson.PRICINGDETAILS.pricingDetails.length&&Rt.hide(),t.entityMapJson.PRICINGMODEL&&t.entityMapJson.PRICINGMODEL.defaultvalue||Rt.hide()}if(!0!==Crm.userDetails.DETAIL_VIEW_HEADER_LYTE&&detailView.createAvatar(),setTimeout((function(){detailView.afterRenderMultilineField()}),300),"Activities"==Crm.activityGrp[I]){var At=$("#cvTable"),Mt=$("#iskanbanview"),St=$("#customlinks"),Vt=$("#dvinner");setTimeout((function(){var e=renderingUtils.getHeightFromTabLayer(),t=s.outerHeight();e-=t,"true"===Mt.val()&&At.length&&(e-=At.parent().outerHeight()),Vt.css({"box-sizing":"border-box","max-height":e,position:"relative",overflow:"hidden"}),0===$("#rightPanel").length&&"true"!=Mt.val()&&$("#backArrowDV").parent().removeClass("hide");let i=!0;var a;try{a=window.parent.document}catch(e){i=!1}var n="undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus();if(i&&n){var r=$(a).height(),o=$("#taskKanbanViewContainer.kanbanDetailview_rewamp");e=r-$("#tabLayer:visible").outerHeight()-t-26;var l=$("#annoncement");e=l.length?e-l.outerHeight():e,Vt.css({"box-sizing":"border-box","max-height":e,position:"relative",overflow:"hidden"}),o.css("height","calc(100vh - 40px)")}Vt.removeClass("pB0").addClass("pB30"),Crm.userDetails.isCanvasActivitySupportEnabled?(thirdPartyUtils.unbindPerfectScroll("#dvinner"),$L("#dvinner").scroll()):thirdPartyUtils.bindPerfectScroll("#dvinner",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),Vt.addClass("oH")}),300),loadTimeBasedActions(1,this.entityId,I,"upcomingActionsDiv"),St.length&&$("#dv_cus_links").append(St)}else if(this.changedBCJson.showDateTime&&"null"!==this.changedBCJson.showDateTime&&!returnJson.hideDetailsViewInnerTabs){0==$(".last-updated").length&&$("#topSectionTitle").append('<span class="last-updated" id="newleft_UpdatedTime">'+I18n.getMsg("crm.calendar.lastsyncat")+" : "+I18n.getMsg("crm.general.a.while.ago")+"</span>"),$(".last-updated").html("<span>"+I18n.getMsg("crm.calendar.lastsyncat")+" : "+$ESAPI.encoder().encodeForHTML(this.changedBCJson.showDateTime)+"</span>"),detailView.lastupdateChecking()}if(detailView.formatDetailViewStrip(I,t[I]),Crm.isInventoryModule(I)&&productDetails.initInventoryView(t),t[I].fieldDependency&&t[I].fieldValues){var Nt=JSON.parse(t[I].fieldDependency),$t=JSON.parse(t[I].fieldValues);detailView.depKeys={},detailView.depValueJson={},detailView.selValueJson={},"object"==typeof Nt&&(detailView.depKeys=objectUtils.getKeys(Nt),detailView.depValueJson=Nt,detailView.selValueJson=$t)}if(!Crm.lyteHeaderNeeded(detailView.currentModule)){var Pt=$L(".photoUploadSec"),Ot=$L(".lnPhoto"),kt=this.changedBCJson.hidden.vision_approvals;if(!validationUtils.isEmpty(kt)){Ot.find("img").hide();var Jt=Crm.getVisionMyJobsDependency(),Ut=this;Lyte.injectResources(Jt,void 0,(function(){kt.Record_Image&&(Pt.addClass("cP"),Crm.client_tracking("Zia Vision Entity Validation Failure",{type:kt.Record_Image[0].failure_action}),"image_processing"===kt.Record_Image[0].failure_action?(Ot.addClass("lnPhoto_ziaVision lnPhoto_ziaVision_processing"),Pt.attr({onclick:"detailView.renderVisionErrorPopUp('"+kt.Record_Image[0].failure_action+"')",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.processing.image")+"')",onmouseleave:"crmui.hideTooltip();"}),Lyte.Component.render("crm-zia-vision-error-popup",{action:kt.Record_Image[0].failure_action},"#zia-vision-popup")):(Ot.addClass("lnPhoto_ziaVision"),Pt.attr({onclick:"detailView.renderVisionErrorPopUp('"+kt.Record_Image[0].failure_action+"','"+Ut.changedBCJson.hidden.module+"','"+Ut.changedBCJson.hidden.id+"','"+kt.Record_Image[0].vision_id+"','"+kt.Record_Image[0].visionApproval_id+"',"+!1+","+!0+")",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.validation.failure.msg")+"')",onmouseleave:"crmui.hideTooltip();"}),Lyte.Component.render("crm-zia-vision-error-popup",{action:kt.Record_Image[0].failure_action,moduleName:Ut.changedBCJson.hidden.module,isDetailPage:!0,entityId:Ut.changedBCJson.hidden.id,visionId:kt.Record_Image[0].vision_id,approvalId:kt.Record_Image[0].visionApproval_id},"#zia-vision-popup")))}))}}detailView.vision_data=returnJson.zia_insights&&returnJson.zia_insights.zia_insights_keys?returnJson.zia_insights.zia_insights_keys.vision_data:void 0;var Ft=$("#changeOwnerIco");"2"==this.changedBCJson.isApproved&&Ft.length>0&&Ft.hide(),"Calls"==I&&($("#headerlabel_ISCALLBILLABLE").parent().remove(),$("#mouseArea__ISCALLBILLABLE").remove()),$("#seterritories").mouseenter((function(){time=setTimeout((function(){$("#territorydetails").slideDown("slow",(function(){$(this).mouseleave((function(){$(this).slideUp("slow",(function(){$(this).hide()}))}))}))}),1e3)})).mouseleave((function(){clearTimeout(time)}));var Bt=document.getElementById("relContactInfo");if(Bt&&(entContInfo=Bt.innerHTML,$("#relContactInfo").empty()),this.changedBCJson.isInvoiceBooksCustomModule&&(Ge.hide(),$("#bcWraperDiv").hide(),$("#showhideDetailsDiv").hide(),setTimeout((function(){ZInvoice.contactZBAndLoadEntityDetails(I,detailView.changedBCJson.zbPKID,"zbCMDetailsIframe")}),1e3)),$(".tabDiv .labelVal").dblclick((function(){$(".userSelectionNone").removeClass("userSelectionNone"),$(this).prev().addClass("userSelectionNone")})),$(".tabDiv .labelTab").dblclick((function(){$(".userSelectionNone").removeClass("userSelectionNone"),$(this).next().addClass("userSelectionNone")})),crmTemplate.bindFldTooltip(),Crm.bindEventForUserBCView(),"Calls"==I&&!isNewCallView){var xt=$("#businessView"),jt=xt.find(".greenbtn"),Ht=xt.next("div").find("link-to"),zt=xt.closest("td"),Gt=jt.width()||0;Gt=Gt+(Ht.width()||0)+50;this.changedBCJson.phoneDetails;zt.css("width",Gt+"px")}if($("#addAssociateCont,#callButtonContainer").html(""),$("#dvinner").scroll($L.debounce((function(){$("#addAssociateCont,.ddM").hide()}),500,!0)),returnJson.TransitionDetails&&returnJson.TransitionDetails.ProcessFieldId){var Wt=$("#changeLayoutIco");Wt.closest(".dblClk").addClass("readOnlyFld"),Wt.hide()}hideLoadingDiv(),crmTemplate.downloadedContentLoaded=!0,$.isEmptyObject(Crm.layoutRuleJSONData)||(CFRExec.init(Crm.layoutRuleJSONData,I,"view"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)),setTimeout((function(){$(".subFrmAggTablWrapper").css({"max-width":$("#dvinner").width()}),hide("crmspanid")}),200),0==detailView.changedBCJson.isProfileImageAccessible&&s.css("min-height","50px")}},renderHeader:function(){var e=Lyte.Router.getRouteInstance().transition.data;if(!e.recordId&&(647980920===Crm.userDetails.ZGID||710453124===Crm.userDetails.ZGID)){var t={};t.message=e,murphy.addCustomTracking(t),murphy.error(new Error("Mandatory info not available for refresh"))}var i=businessCardJson.hidden.module;returnJson[i].entityid&&(this.entityId=returnJson[i].entityid);for(var a,n=!1,s=returnJson[i].section.length,r=0;r<s;r++)if(void 0!==returnJson[i].section[r]&&"Record Image"===returnJson[i].section[r].name&&null!==returnJson[i].section[r].FL){n=!0,a=returnJson[i].section[r].FL.fieldid;break}var o={};o.business_card=returnJson.business_card_meta,o.header_model={},"team_based"===store.peekRecord("module",moduleRecordMapping[i].id).access_type?o.header_model.tag_supported_mod=!Crm.userDetails.CLIENT_ACCOUNT&&void 0!==returnJson.entityMapJson.TAGMODULEREFID&&"Requesters"!==store.peekRecord("module",moduleRecordMapping[i].id).private_profile.name:o.header_model.tag_supported_mod=!Crm.userDetails.CLIENT_ACCOUNT&&void 0!==returnJson.entityMapJson.TAGMODULEREFID;var l="A"===Crm.userDetails.LICENSE_TYPE?3:"P"===Crm.userDetails.LICENSE_TYPE?1:5;returnJson.associated_kiosks&&returnJson.associated_kiosks.length-1>=l&&(o.isKioskAssocLimitReached=!0),o.meta_info={},o.module=i,o.recordDetails={},o.recordDetails.recevent=businessCardJson.recevent,o.recordDetails.delOpt=businessCardJson.delOpt,o.record=store.peekRecord(moduleRecordMapping[i].id,this.entityId),o.record_num=e.recordNum,!o.record&&detailView.lyte_headerDataHolder.primary_module&&(o.record=store.peekRecord(moduleRecordMapping[detailView.lyte_headerDataHolder.primary_module].id,this.entityId)),o.record.$editable&&("approval_process_pending"===o.record.$approval_state||"approval_process_rejected"===o.record.$approval_state&&0!==businessCardJson.hidden.EditFieldsType&&a)&&(o.inApRecordImageEditAllowed="approval_process_rejected"===o.record.$approval_state&&1===businessCardJson.hidden.EditFieldsType,"approval_process_pending"===o.record.$approval_state&&(o.dataBind=store.peekRecord(moduleRecordMapping[i].id,this.entityId))),o.detailview_buttons=objectUtils.cloneObject(returnJson.record_actions),o.custom_buttons=returnJson.custom_buttons,o.entityId=this.entityId,o.layoutId=returnJson.dv_layoutId,o.fields_data=returnJson.entityMapJson,o.zia_insights=returnJson.zia_insights,o.isProfileImageAccessible=n,o.navigation_data={};var d={};d.id=this.entityId,d.recordNum=e.recordNum,d.cvid=e.cvid,d.userId=Crm.userDetails.USER_ID,d.module=i,businessCardJson.hidden&&businessCardJson.hidden.stageId&&(d.stageId=businessCardJson.hidden.stageId);var c=Lyte.registeredMixins["crm-detailview-parser"];"Activities"===Crm.activityGrp[i]&&(c.appendActivityNavigationData(i,d),$("#kventitydetailspage #dv-button-layer").eq(0).removeClass("dN"),$("#rp_td").removeClass("dN")),o.navigation_data=JSON.stringify(d),(c=Lyte.registeredMixins["crm-detailview-parser"]).parseBusinessCardFields(o,i),"Tasks"===i&&(o.isProjectTask=businessCardJson.isProjectTask),"Appointments"===i&&Object.keys(returnJson.Service_needed_Details).length>0&&(businessCardJson.AppStatus=renderingUtils.getPickListDefaultValToActualValDetailView(returnJson.entityMapJson.APPOINTMENTSTATUS),businessCardJson.canAddJobSheet=returnJson.servicePreferences.job_sheet_enabled&&returnJson.Service_needed_Details.Job_Sheet_Section__s&&"false"===returnJson.entityMapJson.ISJOBSHEETCREATED.defaultvalue&&businessCardJson.hidden.EDIT_ALLOWED_SA&&"Completed"===businessCardJson.AppStatus,businessCardJson.JobSheetSection=businessCardJson.canAddJobSheet?returnJson.Service_needed_Details.Job_Sheet_Section__s.uservalue:null,o.recordDetails.sectionName=businessCardJson.JobSheetSection),c.parseRecordActions(o,i),$("#dv-button-layer").empty(),Lyte.Component.render("crm-detailview-header",o,"#dv-button-layer");var u=$("crm-detailview-tag");if(u&&u[0]){var m=u[0].component,p=m.calculateTagsComponentWidth(m.getData("module"));m.setData("tagscompwidth",p)}},populateTagsData:function(e){var t=businessCardJson.hidden.module;e[t].entityid&&(this.entityId=e[t].entityid),CrmTags.clientJSON={},CrmTags.clientJSON.tagUsedCount=0,e.TAGMODULEREFID&&(Crm.jsonSelectValues[t]=businessCardJson.jsonSelectValues,Crm.jsonSelectValues[t].TAGMODULEREFID=e.TAGMODULEREFID,CrmTags.clientJSON.tagUsedCount=e.TAGMODULEREFID.length),e.tagLimit&&(CrmTags.clientJSON.editionCount=e.tagLimit),e.tagRecordLimit&&(CrmTags.clientJSON.recordTagCount=e.tagRecordLimit),e.entityMapJson.TAGMODULEREFID&&(CrmTags.clientJSON.value=e.entityMapJson.TAGMODULEREFID.defaultvalue.split("||")),this.recordLocked=e.isRecLocked,this.isApproved=e.isApproved,CrmTags.clientJSON.isRecLocUnGDPR=e.isRecLocked},populateReviewProcessInfo:function(e){var t=businessCardJson.hidden.module,i=e[t].rpRecordDetls;if(i){var a="none";if(e&&Object.keys(i).length>1){i.reviewedCount=i.rpApprFields+i.rpRejFields,i.reviewedCount>0&&i.reviewedCount!==i.rpTotalFields&&!i.isResubmit&&(a="block");var n={};n.module=t,n.id=this.entityId,n.calleeObj="Crm",n.clickId="deleteEntity",i.rpdeleteParams=n}i.styledisplay=a,businessCardJson.rpRecordDtls=i}},renderVisionErrorPopUp:function(e,t,i,a,n,s,r){var o=$("crm-zia-vision-error-popup");0!=o.length&&o.remove(),s||(s=!1);var l=networkUtils.returnDependencyFiles(["lyte-selector.js","crm-vision-image-utils.js"],ResourceConstants.CRMClient);Lyte.injectResources(l,void 0,(function(){Lyte.Component.render("crm-zia-vision-error-popup",{isDetailPage:r,isOnClick:!0,action:e,moduleName:moduleRecordMapping[t].api_name,entityId:i,visionId:a,approvalId:n,isEdit:s},"#zia-vision-popup"),Crm.userDetails.permissions.Crm_Implied_Approve_Actions&&"do_not_create"!==e&&"create_without_image"!==e&&"image_processing"!==e||$L("#visionModal")[0].ltProp("show",!0)}))},editClosingDate:function(){!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||returnJson.entityMapJson.CLOSINGDATE&&"true"===returnJson.entityMapJson.CLOSINGDATE.readonly||"false"===String(allowEditProf)||(globalfieldlabel="CLOSINGDATE",globalvaluespanid="stageIndicator_CLOSINGDATE",globaltextareapanid="stageInditextarea_CLOSINGDATE",globaltextboxpanid="Crm_Potentials_CLOSINGDATE",itsonview=!1,detailView.readOnlyField=!1,ajaxEdit())},sectionInit:function(e,t){if(!e[t].section.length){var i=e[t].section;e[t].section=[],e[t].section[0]=i}for(var a=0;a<e[t].section.length;a++){if(Crm.userDetails&&(e[t].section[a].personalAccount=Crm.userDetails.PERSONAL_ACCOUNT,"null"!==e[t].section[a].subFormTabId&&Crm.userDetails.SUBFORM_PERMISSIONS)){var n=!1;if(e[t].subforms.section.forEach((function(i,s){i.subFormTabId!==e[t].section[a].subFormTabId||moduleRecordMapping[i.subFormName]&&!moduleRecordMapping[i.subFormName].viewable&&(e[t].subforms.section.deleteElementAt(s),e[t].section.deleteElementAt(a),a-=1,n=!0)})),n)continue}var s=e[t].section[a].FL;if(s&&Array.isArray(s)?s.forEach((e=>{"Connected_To__s"===e.sysRefName&&"132"===e.uitype&&(e.readonly="true")})):s&&null!==s&&"object"==typeof s&&"Connected_To__s"===s.sysRefName&&"132"===s.uitype&&(s.readonly="true"),e[t].section[a].module=t,"Events"==t&&(e[t].section[a].layout=2),!s.length){var r=[];r[0]=s,e[t].section[a].FL=r}var o=e[t].section[a],l=parseInt(o.layout);e[t].section[a].splFL=[];for(var d=0;d<l;d++){var c=[];for(k=d;k<o.FL.length;)"CALLOWNER"!=o.FL[k].colname&&"CALLOWNER"!=o.FL[k].colname&&"LASTACTIVITYTIME"!=o.FL[k].colname&&"SALUTATION"!=o.FL[k].colname&&111!=o.FL.uiType||(o.FL[k]=!0),"PREDICTIONSCORE"==o.FL[k].colname&&("Leads"==t&&!Crm.userDetails.isLeadPredictionEnabled||"Potentials"==t&&!Crm.userDetails.isDealPredictionEnabled)&&(o.FL[k]=!0),"Tasks"==t&&"RECURRING"==o.FL[k].colname&&(o.FL[k].defaultvaluereadable=detailView.getReadableRecurringPattern(o.FL[k].defaultvalue)),c.push(o.FL[k]),k+=l;e[t].section[a].splFL[d]=c}}e[t].section;if("Activities"==Crm.activityGrp[t])if($('[id="timeLine_dv"]:visible').length&&$('[id="timeLine_dv"]:visible').click(),"Calls"==t&&isNewCallView)e[t].section=crmCallsNew.getSections(e[t].section,e.entMetaData.callDirection);else{var u=[];for(a=0;a<e[t].section.length;a++)"Event Information"!=e[t].section[a].name&&u.push(e[t].section[a]);e[t].section=u}"Users"!==t&&"Appointments"!==t&&e.entityMapJson.SEID&&returnJson.entityMapJson.SEID.defaultvalue&&e.entityMapJson.SEID.lookupmodule&&Crm.moduleInfo[e.entityMapJson.SEID.lookupmodule]&&(e.entityMapJson.SEID.displaylabel=Crm.moduleInfo[e.entityMapJson.SEID.lookupmodule].translatedSingularLabel)},processBCJson:function(e){var t,i,a=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:void 0,n=returnJson.entityMapJson.EXCHANGERATE?returnJson.entityMapJson.EXCHANGERATE.defaultvalue:void 0,s=(this.getCurrencySymbol(a),!1),r=e.hidden.module;e.BCview&&(i="string"==typeof e.BCview?JSON.parse(e.BCview):e.BCview,e.BCViewObject=i),e.hidden.id=e.entityid;var o=JSON.stringify(returnJson.entityMapJson),l=JSON.parse(o);e.showCounts=Crm.userDetails.CUSTOMIZE_INFO.SHOW_COUNTS;for(var d=0;i&&d<i.length;d++){var c=e.BCViewObject[d],u=c.sumSeq;l[c.colname]?e.BCViewObject[d]=l[c.colname]:returnJson.productLineItems&&(e.BCViewObject[d]=c,e.BCViewObject[d].defaultvalue=returnJson.productLineItems.INVENTORYTOTALVALUES?currencyUtils.returnValueInDefaultCurrency(a,returnJson.productLineItems.INVENTORYTOTALVALUES[c.colname],void 0,n):""),e.BCViewObject[d].forBC=!0,e.BCViewObject[d].sumSeq=u,e.BCViewObject[d].module=r,"SCORE"===e.BCViewObject[d].colname&&(e.hidden.score=e.BCViewObject[d].defaultvalue),"Appointments"===r&&"0"===u&&(e.BCViewObject[d].notField=!0),detailView.BCkeyVsArrayIndex[c.colname]=d,0==d&&"SCORE"!==e.BCViewObject[d].colname&&(s=!0,c.uitype===CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY&&e.BCViewObject[d].defaultvalue2?e.hidden.entityName=returnJson[r].entityName=e.BCViewObject[d].defaultvalue2.trim():e.hidden.entityName=returnJson[r].entityName=e.BCViewObject[d].defaultvalue.trim()),s||1!=d||(e.hidden.entityName=returnJson[r].entityName=e.BCViewObject[d].defaultvalue.trim()),"Tasks"===r&&"CONTACTID"===c.colname&&"Leads"===l.CONTACTID.lookupmodule&&(e.BCViewObject[d].defaultvalue="")}if(Crm.userDetails.isEmailsForModuleEnabled&&(e.hidden.entIdForZMail=e.hidden.id),e.EMAIL_PATTERN_VALID){var m=l.EMAIL?l.EMAIL.defaultvalue:void 0,p=l.ADDN_EMAIL?l.ADDN_EMAIL.defaultvalue:void 0;"Potentials"===r&&returnJson.entityMapJson.CONTACTID&&(m||(m=returnJson.entityMapJson.CONTACTID.priEmail),p||(p=returnJson.entityMapJson.CONTACTID.EntMail)),e.hidden.primEmail=m,e.hidden.secondMail=p,e.hidden.entIdForZMail=e.hidden.id,m&&!validationUtils.isValidEmail(m)&&(e.EMAIL_PATTERN_VALID=!1),p&&""!==p&&m&&""!==m&&e.EMAIL_PATTERN_VALID&&validationUtils.isValidEmail(p)?m=m+","+p:p&&""!==p&&validationUtils.isValidEmail(p)&&(m=p,e.EMAIL_PATTERN_VALID=!0),m&&""!==m&&"null"!==m&&e.CUSTOM_EMAILS?m=m+","+e.CUSTOM_EMAILS:e.CUSTOM_EMAILS&&(m=e.CUSTOM_EMAILS),e.hidden.zmailEmail=m,m&&!e.EMAIL_PATTERN_VALID?e.hidden.mailConfigType="1#"+I18n.getMsg("crm.primary.secondary.no.valid.email"):"false"===e.isZMailConfig||"Potentials"===r||m&&""!=m&&"null"!=m?e.hidden.mailConfigType=m:e.hidden.mailConfigType="2#"+I18n.getMsg("crm.new.label.no.records")}if(l.CONTACTID||l.WHOID){var v=l.CONTACTID?l.CONTACTID:l.WHOID;e.hidden.cntId=e.hidden.entIdForZMail=e.relContId=e.contactId=v.defaultid,e.hidden.associatedContName=e.relContName=v.defaultvalue,e.relContAccName=v.accName,e.relContModule=e.relatedModule=v.lookupmodule,e.hidden.accountId=e.relAccId=v["actName:Account Name"],l.ACCOUNTID&&(e.hidden.accountId=l.ACCOUNTID.defaultid),e.hidden.accountId="null"==e.hidden.accountId?"":e.hidden.accountId,e.hidden.associatedContEmail=e.relContEmail=v.priEmail,e.relContMobile=v.mobile,e.relContPhone=v.phone}if("Potentials"==r&&l.ACCOUNTID&&"null"!=l.ACCOUNTID.defaultid&&!e.hidden.accountId&&(e.hidden.accountId=l.ACCOUNTID.defaultid),"Calls"===e.relatedModule){var g=l.SEID?l.SEID:null;g&&"Accounts"===g.lookupmodule&&"null"!==g.defaultid&&(e.relatedModule=g.lookupmodule,e.contactId=g.defaultid)}if(returnJson.Calls&&(returnJson.Calls.isOutboundAllowed||window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()||isNewCallView)){var f=Object.create(e);if(returnJson.Calls.phoneDetails)f.phoneNo=returnJson.Calls.phoneDetails.relatedPhoneNo,f.ctiprotocol=returnJson.Calls.phoneDetails.ctiprotocol,f.ctiprotocolvalue=returnJson.Calls.phoneDetails.ctiprotocolvalue,f.ZPBCallAllowed=!returnJson.Calls.isOutboundAllowed;else{var h=$(".ctiapi_unknown_phone_noActivity");h.length&&e.callStatus.toUpperCase()==="missed".toUpperCase()&&(f.phoneNo={},f.phoneNo.Phone=h.text().trim(),e.relatedModule="Unknown",f.ZPBCallAllowed=!returnJson.Calls.isOutboundAllowed)}e.phoneDetails=f}e.module=r;var C="display:none",w="crm.button.show.details";(e.isOpenDV||"Events"===r||e.iskanbanview||"Calls"===r&&isNewCallView||r.startsWith("Orchestration")||r.startsWith("PathFinder"))&&(C="display:block;",w="crm.button.hide.details"),this.detailsPageMenu(e),e.lookback||e.MultiValPop?e.clickId="backOneLevel":e.clickId="tab";if(e.hidden.SECURITY_EDIT_ALLOWED||"dvnorBtn dvcbtn",e.hidden.SECURITY_EDIT_ALLOWED&&(e.editAllowedMod=e.module),e.deleteAllowed=e.hidden.SECURITY_DELETE_ALLOWED,Crm.userDetails.CLIENT_ACCOUNT&&e.deleteAllowed&&(e.deleteAllowed=Lyte.Component.registeredHelpers.checkPermission("Crm_Implied_Delete",r)),e.isRecordLocked=e.hidden.IS_RECORD_LOCKED,e.isSendMailLocked=e.hidden.IS_SENDMAIL_LOCKED,e.hidden.CONVERT_ALLOWED&&(e.convertAllowedMod=e.module),0==e.isApproved&&(e.approvedZeroMod=e.module),"Calls"==r&&(e.isCallerCalleeMailLocked=e.hidden.IS_CALLERCALLEE_MAIL_LOCKED),"Tasks"==r&&l.STATUS){if(objectUtils.getKeys(detailView.taskStatusMap).length<1)for(var y=l.STATUS.picklistmap,_=0;_<y.length;_++){var b=y[_].systemvalue,I=y[_].uservalue;detailView.taskStatusMap[b]=I}var T=detailView.taskStatusMap[crmConstants.taskCompleted];e.completedValue=T,l.STATUS.defaultvalue===T&&(e.taskCompleted=!0),l.STATUS.defaultvalue!==T&&e.hidden.SECURITY_EDIT_ALLOWED&&!1!==e.userInRole.allowEditProf&&(e.securityEditAllowedAndNotCompleted=!0)}!e.isClosedEvent&&"1"!=e.invMailType&&e.eventStatus==crmConstants.EVENT_STATUS_PREPARED&&parseInt(e.totalInvCnt)>0?e.eventStatusPrepared=!0:parseInt(e.totalInvCnt)>0&&(e.eventStatus==crmConstants.EVENT_STATUS_CONFIRMED||e.eventStatus==crmConstants.EVENT_STATUS_LOC_CHANGED||e.eventStatus==crmConstants.EVENT_STATUS_TIME_CHANGED||e.eventStatus==crmConstants.EVENT_STATUS_TIMELOC_CHANGED)&&!e.isClosedEvent&&1==e.hidden.SECURITY_EDIT_ALLOWED&&(e.eventStatusOtherThanPrepared=!0);for(_=0;e.BCViewObject&&_<e.BCViewObject.length;_++){u=e.BCViewObject[_].sumSeq;var L=e.BCViewObject[_].uitype,D=returnJson.entityMapJson.TYPE?returnJson.entityMapJson.TYPE.defaultvalue:"";"3"==u&&"Campaigns"===r&&(e.BCViewObject[_].sumSeq3Campaigns=!0),"2"==u&&-1!==["Leads","Contacts","Accounts","Potentials","Campaigns","Cases","Products","PurchaseOrders","PriceBooks"].indexOf(e.module)&&(e.BCViewObject[_].sumSeq2InListedModules=!0,e.BCViewObject[_].readonly=!1),"Appointments"===r&&"SERVICEID"===e.BCViewObject[_].colname?(e.ser_buss_card=objectUtils.cloneObject(e.BCViewObject[_]),e.ser_buss_card.colname="topSectionTitle_SERVICEID",e.BCViewObject[_].notField&&delete e.BCViewObject[_]):"Appointments"!==r||"APPOINTMENTFOR"!==e.BCViewObject[_].colname&&"SEID"!==e.BCViewObject[_].colname||(e.app_buss_card=objectUtils.cloneObject(e.BCViewObject[_]),e.app_buss_card.colname="topSection_APPOINTMENTFOR",e.BCViewObject[_].notField&&delete e.BCViewObject[_]),"4"!=u||-1===["Invoices","Quotes","SalesOrders","Visits","Vendors","Solutions"].indexOf(e.module)&&-1===e.module.indexOf("CustomModule")&&-1===e.module.indexOf("LinkingModule")&&-1===e.module.indexOf("Services")&&-1===e.module.indexOf("Appointments")||(e.BCViewObject[_].sumSeqLastUpdated=!0),1e3==u&&e.entityTerrDetails&&(e.BCViewObject[_].sumSeqTerrDetails=!0),"208"==L&&e.layout_jsonarrayObj&&e.userInRole.allowEditProf&&(e.BCViewObject[_].showChange=e.layout_jsonarrayObj.showChange,e.layout_jsonarrayObj.showChange&&(e.BCViewObject[_].readonly=!1)),"4"==u&&-1!==["Zoho Backstage","Zoho Webinar","Google AdWords"].indexOf(D)&&(e.BCViewObject[_].sumSeqLastUpdated=!0)}(e.isAuditFound||e.crtdTime!==e.lastActivity||e.isLastActivityRecordFound&&e.crtdTime==e.lastActivity)&&(e.isLastActivityTimeFound=!0),e.hideBC=!Crm.userDetails.CUSTOMIZE_INFO.BC_View||Crm.userDetails.CUSTOMIZE_INFO.BC_View;var E=!(!Crm.userDetails.isFeedsEnabled||"undefined"==typeof moduleRecordMapping||!moduleRecordMapping)&&moduleRecordMapping[r].feeds_required;("Tasks"===r||"Events"===r||"Calls"===r)&&"undefined"!=typeof moduleRecordMapping&&moduleRecordMapping&&moduleRecordMapping.Activities&&1==moduleRecordMapping.Activities.show_as_tab&&(E=!!Crm.userDetails.isFeedsEnabled&&moduleRecordMapping.Activities.feeds_required),null!=e.ownerId&&Crm.userDetails.USER_ID!==e.ownerId&&E&&(e.isOwnerCondition=!0),(e.hidden.seTerritoryCount>=1&&"Potentials"==e.module||e.hidden.seTerritoryCount>=e.hidden.terrLimitForRecord)&&(e.TerrDisplayCondition=!0),e.isZSocialAccessible&&e.hideBC&&(e.displaySocialElementsCondition=!0),e.isSocialEnabled&&e.userInRole.socialAllowed&&(e.socialEnabledAndAllowed=!0);var R="maininfo";if(("Events"==r||e.iskanbanview)&&(R+=" p0"),e.dvStyle=C,e.shTitle=w,e.mainInfClass=R,e.isProfileImageAccessible&&("null"!==e.hidden.photoID?(t=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+r+"&entityId="+e.entityid+"&actionName=readImage&fileId="+e.hidden.photoID,t=networkUtils.getPortalURL(t)):t="Accounts"==r?networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM):networkUtils.getImageUrl("nophoto.png",ResourceConstants.CRM),e.imgSrc=t,e.photoFileId=e.hidden.photoID,t=networkUtils.getPortalURL(t)),"Events"==r&&(e.Fields=l,e.Fields.CONTACTID&&e.Fields.SEID&&e.Fields.SEID.defaultid==e.Fields.CONTACTID.defaultid&&("null"!==e.Fields.CONTACTID.defaultid?e.noRelatedFields=!0:e.noLookupsInBC=!0),e.eventStatus==crmConstants.EVENT_STATUS_CANCELED&&(e.eventStatusCancelled=!0),e.isInvitedEvent&&e.eventStatus!=crmConstants.EVENT_STATUS_CANCELED&&e.eventStatus!=crmConstants.EVENT_STATUS_PREPARED&&(e.invitedEventNotCancelled=!0),(!e.inviteStatusCode||e.inviteStatusCode&&0==e.inviteStatusCode)&&(e.statusNullOrZero=!0),e.dispDtArr1&&(e.dispTimeArr0=e.dispDtArr1.split("-")[0],e.dispTimeArr1=e.dispDtArr1.split("-")[1]),e.leadContIdVal=l.CONTACTID?l.CONTACTID.defaultid:void 0,Crm.userDetails.MEETING_BRIDGE_ENABLED&&Crm.userDetails.LITE.IS_LITE_USER&&(e.eventStatusOtherThanPrepared=void 0)),e.isPaidUser=Crm.userDetails.ISPAID_USER,"Events"===r||e.iskanbanview||(e.notEventAndKanbanView=!0),"Potentials"===r){var A={module:"Potentials"};A.currentField=l.STAGE,crmTemplate.setFieldData(A),e.stagevalues=detailView.getStageValues(l.STAGE.val),e.disableStageNavigator=returnJson.Potentials.disableStageNavigator,e.currentstageval=Crm.getDealsStageValue(A.currentField.defaultvalue)}return"Services"===r&&(e.isServiceAvailable=!0===l.IS_SERVICE_AVAILABLE),e.allowNavigation=detailView.allowNavigation(),e},showLayoutPopup:function(e,t,i){Lyte.registeredMixins["crm-detail-view-utils"].showLayoutPopup(e,t,i)},getCurrencySymbol:function(e){return e&&Crm.userDetails.CURRENCY_DETAILS&&Crm.userDetails.CURRENCY_DETAILS[e]&&Crm.userDetails.CURRENCY_DETAILS[e].symbol?Crm.userDetails.CURRENCY_DETAILS[e].symbol:Crm.userDetails.defaultOrgCurrency?Crm.userDetails.defaultOrgCurrency:"$"},allowNavigation:function(){if("undefined"!=typeof crmNavig){var e="null"!=businessCardJson.hidden.cvid?businessCardJson.hidden.cvid:detailView.currentModule;e=businessCardJson.hidden.stageId&&"undefined"!==businessCardJson.hidden.stageId?e+"#"+businessCardJson.hidden.stageId:e;var t=crmNavig[e];if(t&&t.recordId&&t.recordId.length>0)return!0}return!1},detailsPageMenu:function(e){e.moduleName="Activities"==Crm.activityGrp[e.module]?"Activities":e.module,e.loginName=Crm.userDetails.LOGIN_NAME,e.userid=Crm.userDetails.USER_ID;var t="Leads"==e.module||"Contacts"==e.module||"Account"==e.module;returnJson.entityMapJson.PHONE&&""!=returnJson.entityMapJson.PHONE.defaultvalue&&t&&returnJson.entityMapJson.PHONE.iscallallowed&&(Crm.userDetails.TELEPHONY_ENABLED&&returnJson.entityMapJson.PHONE.outbound?e.teleCallAllowed=!0:window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()&&(e.ZPBCallAllowed=!0),e.phone=returnJson.entityMapJson.PHONE.defaultvalue,e.leContModId=returnJson.entityMapJson.PHONE.defaultvalue),e.customizePermission="team_based"===moduleRecordMapping[e.module].access_type?Crm.userDetails.permissions[Crm.splittedPermission.Crm_Implied_Customize_Zoho_CRM+e.module]:Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM;var i="Crm_Implied_Export_"+e.module;e.exportPermission=Crm.userDetails.permissions[i],Crm.userDetails.MEETING_BRIDGE_ENABLED||!Crm.calPreferences||!Crm.calPreferences.MEETINGPREFDETAILS||"Leads"!==e.module&&"Contacts"!==e.module||"L"===Crm.userDetails.LICENSE_TYPE||"N"===Crm.userDetails.LICENSE_TYPE||"F"===Crm.userDetails.LICENSE_TYPE||Crm.userDetails.LITE.IS_LITE_USER?Crm.userDetails.MEETING_BRIDGE_ENABLED&&(e.meetingtoolAvl=!0):e.meetingtoolAvl=!0,e.partnerBrand=Crm.userDetails.PARTNERBRAND,e.showMailMerge&&!Crm.userDetails.CLIENT_ACCOUNT&&(e.writerAllowed=!0),e.showInConvert=!1;var a=store.peekRecord(returnJson.tabId,e.entityid);if(e.sendClientInvitation){var n=a&&a.$approved,s=!(!a||!a.$approval)&&a.$approval.resubmit;e.invitePermission=e.sendClientInvitation&&(n||s),e.showInConvert=!1}else e.sendClientReInvitation&&(e.reInvitePermission=!0,e.showInConvert=!0);e.canViewPortalPreference&&a&&a.$approved&&(e.showInConvert=!0,e.portalPreference=!0,e.canDeactivateUser?e.deActivateClient=!0:e.canActivateUser&&(e.activateClient=!0),e.canChangeUserType&&(e.canChangeUserType=!0))},mouseover:function(e,t,i){if(!detailView.isSubformAjaxOpened){var a=(e=$(e)).attr("data-params"),n=(e.attr("id"),a?JSON.parse(a):null),s=$("#module").val();if(n){var r=n.readonly;(/\b(8|11|20|39|40|55|111|116|117|127|207|118)\b/.test(n.uitype)||"4"===n.uitype&&("Events"===s||"Tasks"===s)||/\b(32|36|38|143|144|145)\b/.test(n.uitype)&&"true"===n.isaggrfield)&&(r="true"),$.isEmptyObject(detailView.depKeys)||(-1!==detailView.depKeys.indexOf(n.colname)&&(r="true"),"Potentials"!==s||"STAGE"!==n.colname||businessCardJson.isStageProcessField||(r="false"));var o="true"==n.isSystemMandate;"Users"!=s&&handleMouseOver(n.uitype,n.colname,r,o,"",n.maxlength,t,n.isExternalField,n.fieldid,e,i)}}},mouseout:function(e){hide("crmspanid")},hideFieldBorder:function(){$(".fieldHover").removeClass("fieldHover"),hide("crmspanid")},showFieldBorder:function(){var e=$("#"+globalvaluespanid);1==e.parent().hasClass("tabDiv")&&0==e.parent("lyte-td").hasClass("tabDiv")?$("#"+globalvaluespanid).addClass("fieldHover"):$("#"+globalvaluespanid).parent().addClass("fieldHover")},populateDVTitle:function(){var e=$("#eventBCdataTd");if($("#eventBCdataTd").length){if($("#dv_title").append(e.html()),"undefined"!=typeof businessCardJson&&!0===businessCardJson.showRespondLink){var t=networkUtils.returnDependencyFiles(["crm-approval-process-menu.js"],ResourceConstants.CRMClient);t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.js"],ResourceConstants.CRMClient))).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],ResourceConstants.CRMClient)),Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-approval-process-menu",{show:"true",query:"#respondApproval",thisObj:businessCardJson},"#ApprovalProcess"),Lyte.Component.render("crm-approval-process-rejectorlistshow",{show:"true",query:"#approvalStagepop",thisObj:businessCardJson,approverList:businessCardJson.approversNameList.fullUserList},"#approvalStagepop")}))}"undefined"!=typeof businessCardJson&&businessCardJson.waitingusers}else{$("#dv_title").append($(".dvTitle"));var i=$(".dvHeaderVal");if(i.length&&i.length>0)for(var a=0;a<i.length;a++)$("#dv_title").append("<span class='pL10 pR10 crmLabelColor'>-</span>"),$("#dv_title").append(i[a])}Crm.userDetails.CLIENT_ACCOUNT||Lyte.Component.render("crm-detailview-tag",{module:"Events"},"#dv_title"),e.html(""),$L("crm-detailview-tag").addClass("eventsTag")},customizeBC:function(){if(checkForChange()){var e=$("#dvBusinessCardVisibility");e.addClass("eventNone");var t=getObj("bcmodule").value,i=getObj("selList").length,a=e.find(".radio_button");if(i>5)return renderingUtils.showCustomAlert(I18n.getMsg("crm.business.card.alert")),e.removeClass("eventNone"),!1;if(0==i&&a.hasClass("on_state"))return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.business.card.alert.min.limit")}}),e.removeClass("eventNone"),!1;let s=$L("crm-detailview-section");if(0!==s.length){let e=[],t=$L("#selList")[0];for(let a=0;a<i;a++){let i=t.options[a].value,n=store.peekRecord("field",i);n.view_type&&!1===n.view_type.view||!n.visible||e.push(i)}s[0].component.setData("crntbc_fld_ids",e),Lyte.triggerEvent("cxRecordUpdated",{id:s[0].component.getData("record").id})}var n="show";return"Activities"===Crm.activityGrp[t]&&(n="true"===$("#iskanbanview").val()?"entitypopup":"taskDetailsPart",n=$("#"+n).length?n:"show"),doAjaxUpdateForm(n,document.sumSeqForm,(function(){CFRExec&&CFRExec.evalRules("view",!0),hideAnimatePopup("topBandPopup"),CScriptLib&&detailView.invokeClientScript()}))}return!1},replaceDataParams:function(e,t){if("crm.tab.module.custom-view.kanban"!==Lyte.Router.getRouteInstance().transition.info.route){var i=$("#mouseArea__"+e).data("params");if("object"==typeof t){for(var a=objectUtils.getKeys(t),n=0;n<a.length;n++)i[a[n]]=t[a[n]],returnJson.entityMapJson[e][a[n]]=t[a[n]];i.default&&i.default[0]&&(i.default[0]={},i.default[0].html=t.defaultvalue,i.default[0].value=t.defaultvalue)}else"250"!==i.uitype?i.defaultvalue=t.length>0?replaceSplChrs(t):t:i.defaultvalue=t,i.default&&i.default[0]&&(i.default[0]={},i.default[0].html=i.defaultvalue,i.default[0].value=i.defaultvalue),returnJson.entityMapJson[e].defaultvalue=i.defaultvalue;"26"!==i.uitype&&i.attrObj&&(delete i.attrObj,delete i.dataObj,delete i.timeAttrObj,delete i.timeDataObj),"33"==i.uitype&&(i.dbPhoneValue=i.defaultvalue),$("#mouseArea__"+e).attr("data-params",""),$("#mouseArea__"+e).attr("data-params",JSON.stringify(i)),detailView.changedBCJson.BCViewObject&&(detailView.changedBCJson.BCViewObject[detailView.BCkeyVsArrayIndex[e]]=i)}},detailViewTags:function(e){CrmTags.clientJSON={},CrmTags.clientJSON.tagUsedCount=0,returnJson.TAGMODULEREFID&&(Crm.jsonSelectValues[e].TAGMODULEREFID=returnJson.TAGMODULEREFID,CrmTags.clientJSON.tagUsedCount=returnJson.TAGMODULEREFID.length),returnJson.tagLimit&&(CrmTags.clientJSON.editionCount=returnJson.tagLimit),returnJson.tagRecordLimit&&(CrmTags.clientJSON.recordTagCount=returnJson.tagRecordLimit),returnJson.entityMapJson.TAGMODULEREFID&&(CrmTags.clientJSON.value=returnJson.entityMapJson.TAGMODULEREFID.defaultvalue.split("||")),this.recordLocked=returnJson.isRecLocked,CrmTags.clientJSON.isRecLocUnGDPR=returnJson.isRecLocked;var t=Handlebars.templates.DetailViewTags();$("#detailviewTags").html(t)},setTitleforEllipsis:function(e,t){var i=$(e);i.removeAttr("title"),e.offsetWidth<Math.floor(e.scrollWidth)&&e.offsetWidth!=Math.floor(e.scrollWidth)&&(t?i.off("mouseenter").on("mouseenter",(function(){var e=$(this);crmui.showTooltip($.trim(e.text()),!1,"",this)})).off("mouseleave").on("mouseleave",(function(){crmui.hideTooltip()})):i.attr("title",$.trim(i.text())))},formNewLeftPanel:function(e){null==$ESAPI&&org.owasp.esapi.ESAPI.initialize();$("#newLeftPanel");"Potentials"===(t=returnJson.relListLabelsJson.module)&&(returnJson.relListLabelsJson.SalesSummaryInfo={},null!=moduleRecordMapping.Leads?returnJson.relListLabelsJson.singularLead=moduleRecordMapping.Leads.singular_label:returnJson.relListLabelsJson.singularLead=void 0);var t=returnJson.relListLabelsJson.module;if(Crm.jsonSelectValues[t]=businessCardJson.jsonSelectValues,returnJson.relListLabelsJson.IS_CLIENT_ACCOUNT=Crm.userDetails.CLIENT_ACCOUNT,Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyPrefEnabledModules.contains(returnJson.relListLabelsJson.module)&&(returnJson.relListLabelsJson.PRIVACYPREF_ENABLED_MODULE=!0),returnJson.relListLabelsJson.showRelatedList=!(t.startsWith("Orchestration")||t.startsWith("PathFinder")),returnJson[returnJson.relListLabelsJson.module].rpRecordDetls&&(returnJson.relListLabelsJson.isInReviewProcess="true"),returnJson.relListLabelsJson&&returnJson.relListLabelsJson.relListLabelJson){var i=Handlebars.templates.LeftPanel(returnJson.relListLabelsJson);$("#newlpdiv").html(i)}if(detailView.detailViewTags(t),setTimeout((function(){for(var e=$(".bgLi a"),t=e.length,i=0;i<t;i++)detailView.setTitleforEllipsis(e.eq(i)[0],!0)}),1500),e||detailView.doDetailViewTagsRendering(returnJson),!Crm.renderDVLyteFlow(t)){var a=$(".showhideDetailpanel").find("span");void 0!==businessCardJson.dVLeftPanelVisibilty&&null!==businessCardJson.dVLeftPanelVisibilty&&!1===businessCardJson.dVLeftPanelVisibilty||t.startsWith("Orchestration")||t.startsWith("PathFinder")?($("#panelTab").addClass("panelTabWithOutLeftPanel"),$(".dvLeftPanel_show").addClass("dvLeftPanel_close").removeClass("dvLeftPanel_show"),a.removeClass("fCollapseIn"),a.addClass("fCollapseOut")):($("#panelTab").removeClass("panelTabWithOutLeftPanel"),$(".dvLeftPanel_close").addClass(".dvLeftPanel_show").removeClass("dvLeftPanel_show"),a.removeClass("fCollapseOut"),a.addClass("fCollapseIn")),setTimeout((function(){$(".collapse-view").addClass("detailViewCollapse"),$("#panelTab td.w230").addClass("newDetailLeftPanelTd"),$("#newLeftPanel").addClass("newDetailLeftPanel"),crmLayout.Resize.DetailpageResize(),thirdPartyUtils.titleForEllipsis(".relListLbl");var e=$("[ddname='SOCIALPERSONALITY']");e.find(".stickyOptions").removeClass("stickyOptions"),e.find(".stickyTitle").removeClass("stickyTitle")}),301)}},showHideDetailViewLeftPanel:function(e,t){if(!t||13===t.keyCode){$("html").addClass("oH");var i=$("#newInfoDiv"),a=$("#dvinner"),n=$("#dv-button-layer");i.addClass("newInfoDivTrans");var s=renderingUtils.windowWidth,r=$(e),o=!r.hasClass("fCollapseIn");r.toggleClass("fCollapseIn"),r.toggleClass("fCollapseOut"),$("#panelTab").toggleClass("panelTabWithOutLeftPanel"),r.hasClass("fCollapseOut")?(r[0].setAttribute("aria-label",I18n.getMsg("crm.accessibility.show.detail.panel")),r[0].setAttribute("lt-prop-title",I18n.getMsg("crm.accessibility.show.detail.panel"))):(r[0].setAttribute("aria-label",I18n.getMsg("crm.accessibility.hide.detail.panel")),r[0].setAttribute("lt-prop-title",I18n.getMsg("crm.accessibility.hide.detail.panel"))),o?s-250:s,null!=businessCardJson.dVLeftPanelVisibilty&&null!=businessCardJson.dVLeftPanelVisibilty&&(businessCardJson.dVLeftPanelVisibilty=o);var l=Crm.getCrmBasePath()+"/EntityCustomization.do",d={action:"showHideDetailViewLeftPanel",dvAction:o};d[csrfParamName]=encodeURIComponent(csrfToken),mR(l,(function(){}),d),a.css("overflow","hidden"),renderingUtils.windowWidth<1040?($("#dvinner").css({width:"1000px"}),n.css("width","950px")):($("#dvinner").css({width:"100%"}),n.css("width","calc(100% - 50px)")),setTimeout((function(){$("html").removeClass("oH"),i.removeClass("newInfoDivTrans"),n.removeClass("newInfoDivTrans"),crmLayout.Resize.DetailpageResize()}),350)}},formFollowersDiv:function(e,t,i){var a="",n=0,s=$("#followersInfo"),r=$("#followersCnt");if(!1===i){var o="#dv_followers_"+e;s.find(o).remove(),n=-1;var l=0;if(r.length&&r.text())l=parseInt(r.text().replace("(","").replace(")","").trim());l=l+n>e.length?e.length:l+n,r.html("  ("+l+")"),0===l?$("#followersDiv").hide():$("#followersDiv").show()}else Crm.getUserDetailsMap(!0,(function(o){if(!0===i){if(o[e]){var l=o[e];a=a+"<img src='"+$ESAPI.encoder().encodeForHTML(l.avatar)+"' class='userlistphoto w32' onmouseout='renderingUtils.zctt.hidett();' id='dv_followers_"+e+"' onmouseover='renderingUtils.zctt.showtt(\" "+$ESAPI.encoder().encodeForJavaScript(l.name)+"\")' >",s.append(a),n=1}}else{for(var d=$("#flw_cnt").length?parseInt($("#flw_cnt").val()):0,c=!t&&e.length>10?10:e.length,u=d;u<c;u++){var m=e[u];if(o[m]&&0===s.find("#dv_followers_"+m).length){l=o[m];a=a+"<img src='"+$ESAPI.encoder().encodeForHTML(l.avatar)+"' class='userlistphoto w32' id='dv_followers_"+m+"' onmouseout='renderingUtils.zctt.hidett();' onmouseover='renderingUtils.zctt.showtt(\" "+$ESAPI.encoder().encodeForJavaScript($ESAPI.encoder().encodeForHTML(l.name))+"\")' >",n++}}$("#flw_cnt").val(d+n),s.append(a),e.length>10&&!t?$("#morefollowers").show():$("#morefollowers").hide()}var p=0;if(r.length&&r.text())p=parseInt(r.text().replace("(","").replace(")","").trim());p=p+n>e.length?e.length:p+n,r.html("  ("+p+")"),0===p?$("#followersDiv").hide():$("#followersDiv").show()}))},addNote:function(e){if(Crm.userDetails.isRelatedListLyteEnabled){detailView.scrollToRelatedList(void 0,!0,"",!0);var t=$L("crux-note");t&&t[0]&&($L("#dvinner").scrollTo(t.find(".notesTextInputBoxWrap"),{duration:1e3,offset:{top:-100}}),t[0].openNoteEditor())}else{"newleft_History"===$("#detailViewTabs").find("li.sel").attr("id")&&detailView.switchTab(void 0,"Info");var i=$("#toggleNotes");if(void 0!==i&&0!==i.length){var a=$L("#dvinner"),n=$("#notes-element-parent");0==$("#toggleNotes:visible").length?Notes.toggleNotes():a.animate({scrollTop:n.offset().top-a.offset().top+a.scrollTop()-100},1e3),Notes.initNote("open"),renderingUtils.stopEvent(e),sE(e)}}},scrollToRelatedList:function(e,t,i,a){if(i&&$(i.target).hasClass("attachmentsLeftPanelAddition"))return renderingUtils.stopEvent(i),void i.stopPropagation();$(".relListHead").removeClass("highlight-detailview"),$(".leftnavEnable").removeClass("leftnavEnable");var n=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());n&&$("html").removeClass("Devices");var s=$("#detailViewTabs").find("li.sel").attr("id");"newleft_History"!==s&&"newleft_DataPrivacy"!==s||detailView.switchTab(void 0,"Info");var r=t?$("#noteDetails"):$('div[ddid="'+e+'"]').length?$('div[ddid="'+e+'"]'):$("#"+e);if(r.length){var o=100,l=r.offset().top;$(".activeTitle").length&&(o=$(".activeTitle").offset().top,$(".activeTitle").removeClass("activeTitle"));var d=Math.abs(Math.ceil(l-o));(d>300||d<50)&&(d=200),r.addClass("activeTitle");var c=$L("#dvinner"),u=c.offset().top,m=c.scrollTop();if(Crm.userDetails.isRelatedListLyteEnabled){var p=store.peekRecord("related_list",e),v=p?p.personality_name:"";if(0!==r.find(".relListHead").length||a||v&&"RELATEDLISTPERSONALITY"===v){var g=r.closest("crm-custom-rl");r.find("crm-related-list-view-header").length||v&&"RELATEDLISTPERSONALITY"===v&&g&&g[0]&&!g[0].getData("lyteViewPort")?r.find(".relListHead").addClass("highlight-detailview"):(Lyte.Globals.set("relatedList.scrollAfterLoad",e),setTimeout((function(){"RELATEDLISTPERSONALITY"===v&&(r=t?$("#noteDetails"):$('div[ddid="'+e+'"]').length?$('div[ddid="'+e+'"]'):$("#"+e)),r.find(".relListHead").addClass("highlight-detailview")}),500))}else r.find(".ntit").addClass("highlight-detailview")}else 0==r.find(".relListHead").length?r.find(".ntit").addClass("highlight-detailview"):r.find(".relListHead").addClass("highlight-detailview");detailView.rlLogAdded||(murphy.addCustomTracking({message:"RelatedList Accessed through Left Panel Click",type:"custom event"}),detailView.rlLogAdded=!0),$("#dvinner").animate({scrollTop:l-u+m-100},d),i&&renderingUtils.stopEvent(i),setTimeout((function(){r.find(".highlight-detailview").removeClass("highlight-detailview"),n&&$("html").addClass("Devices")}),3e3)}},switchTab:function(e,t){$L(".fr_highLightFormulaField").removeClass("fr_highLightFormulaField"),e&&$(e).addClass("activeTabCl").closest("li").addClass("sel");var i=$("#dv-button-layer");if(detailView.currentTabView=t,"Info"===t){if(detailView.isDataPrivacyModified){var a=Lyte.Router.getRouteInstance(),n=a.transition,s=a.refresh();null!=n&&null!=n.data&&(s.data=n.data),detailView.isDataPrivacyModified=!1}else $("#newHistoryDiv").css("display","none"),$("#newleft_History").find("a").removeClass("activeTabCl").closest("li").removeClass("sel"),$("#newDataPrivacyDiv").css("display","none"),$("#entity_dataPrivacy_link").removeClass("activeTabCl").closest("li").removeClass("sel"),$("#newleft_Info").find("a").addClass("activeTabCl").closest("li").addClass("sel"),$("#newInfoDiv").css("display",""),$("#dvinner").animate({scrollTop:2},100),detailView.dvtabBackAni($("#newleft_Info"));detailView.dataParamDetails&&detailView.dataParamDetails.isUpdated&&(refreshFollowDiv(),detailView.dataParamDetails.isUpdated=!1),featuresAvailable.ZIA_SUMMARY&&Crm.isSupportedModuleForZiaSummary(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])&&Notes.injectNotesSummaryComponent("timeLine")}else if("DataPrivacy"===t){$("#newInfoDiv").css("display","none"),$("#newHistoryDiv").css("display","none"),i.removeClass("dvheaderScrollFIxed"),$("#newleft_Info").find("a").removeClass("activeTabCl").closest("li").removeClass("sel"),$("#newleft_History").find("a").removeClass("activeTabCl").closest("li").removeClass("sel"),$("#newDataPrivacyDiv").css("display",""),detailView.dvtabBackAni($("#newleft_DataPrivacy"));var r=$("#dataPrivacyBodyElem"),o=$L.debounce(detailView.detailViewPrivacyScrollHandler,1);r.off("scroll",o).on("scroll",o),r.animate({scrollTop:0},100),crmLayout.Resize.DetailpageResizeRevamp()}else i.removeClass("dvheaderScrollFIxed"),$("#newDataPrivacyDiv").css("display","none"),$("#entity_dataPrivacy_link").removeClass("activeTabCl").closest("li").removeClass("sel"),$("#newInfoDiv").css("display","none"),$("#newHistoryDiv").css("display",""),$("#newleft_Info").find("a").removeClass("activeTabCl").closest("li").removeClass("sel"),detailView.dvtabBackAni($("#newleft_History")),$("#timelineDiv").animate({scrollTop:0},100),crmLayout.Resize.DetailpageResizeRevamp()},createAvatar:function(){var e=$(".dvemptyImgContainer");if(e.length){var t=["-21px -20px","-110px -20px","-200px -20px","-290px -20px","-20px -110px","-110px -110px","-200px -110px","-290px -110px"],i=t[Math.floor(Math.random()*t.length)];e.css("background-position",i);var a=$(".dvTitle").find(".bCardHover").text().trim();if(returnJson&&returnJson.entMetaData&&returnJson.entMetaData.saltName&&a.startsWith(returnJson.entMetaData.saltName)){var n=returnJson.entMetaData.saltName.length;a=a.substr(n).trim()}var s=document.querySelector("crm-detail-view-avatarupload");s&&(a=s.getData("entityName")),e.html(a.substring(0,1));var r=e.length;$(".lnPhoto").mouseenter((function(){r&&$("#imgContainer").css({"font-size":"0px"})})),$(".lnPhoto").mouseleave((function(){r&&$("#imgContainer").css({"font-size":""})}))}},detailViewScrollHandler:function(){var e,t,i=detailView.module?detailView.module:$("#module").val(),a={},n=$("#dv-button-layer"),s=$(".calculaterInfo"),r=($("#ContactsviewEntity"),$("#DetailViewInnerTabs")),o=$("#newLeftPanel");i&&"Activities"!==Crm.activityGrp[i]&&$("#detailViewButtonLayerMainTableContainer").height();$(".dvTitle").height();var l,d=$L("#dvinner"),c=$L(".detailview_add_tag.noFreeze").length,u=$(".emailTrackingDiv");if(u.length&&u.remove(),d.scrollTop()>=50)if(n.length>0&&void 0!==n&&0===$("dvheaderScrollFIxed").length&&0!==$("#dv-button-layer .crm-detailview-tag").length){if(0==$(".dvheaderScrollFIxed").length&&0==c){$(".page_initial_loading_hide").addClass("oH");var m=d.outerHeight(),p=o.outerHeight();n.addClass("dvheaderScrollFIxed");var v=m+25,g=p+25;d.css({"max-height":"",height:v}),o.css({height:g}),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300)}r.length&&r.addClass("dvtabsFixed")}else{if($("#detailViewButtonLayerDummyTableRow").find(".toBeShown").removeClass("detailView_hidden").addClass("detailView_visible"),$("#detailViewButtonLayerDummyTableRow").find("#topSectionTitle").addClass("pT5"),$("#detailViewButtonLayerMainTableContainer").addClass("detailView_hidden"),i)if("Events"==i)$("#detailViewButtonLayerMainTableRow").find(".eventHostDiv").show();n.addClass("dv_shadow")}else if(n.length>0&&null!=n){if($(".dvheaderScrollFIxed").length>0){m=d.outerHeight(),g=(p=o.outerHeight())-25,v=m-25;$(".page_initial_loading_hide").addClass("oH"),n.removeClass("dvheaderScrollFIxed"),d.css({height:v}),o.css({height:g}),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300)}r.length&&r.removeClass("dvtabsFixed")}else{if($("#detailViewButtonLayerDummyTableRow").find(".toBeShown").removeClass("detailView_visible").addClass("detailView_hidden"),$("#detailViewButtonLayerMainTableContainer").removeClass("detailView_hidden"),i)if("Events"==i)$("#detailViewButtonLayerMainTableRow").find(".eventHostDiv").hide();n.removeClass("dv_shadow")}if(($("#zfStockTable").is(":visible")||$("#zfShipmentTable").is(":visible")||$("#zfReceivablesTable").is(":visible"))&&$("#zfStockTable,#zfShipmentTable,#zfReceivablesTable").hide(),hide("crmspanid"),$("#dropDownMenu").hide(),$("#dropDownMenu1").hide(),$("#qCreate").is(":empty")?hide("summaryfield"):hide("summaryfield",!0),Lyte.registeredMixins.kiosk_execute.previewKiosk(),Crm.userDetails.isRelatedListLyteEnabled||fetchCustomRelatedList(),Crm.userDetails.isFinanceIntegPresent&&(ZInvoice.loadRelatedList(),ZInvoice.loadSubscriptionsRL(),ZInvoice.loadExpenseRl()),returnJson&&returnJson.relListLabelsJson&&returnJson.relListLabelsJson.relListLabelJson&&$.each(returnJson.relListLabelsJson.relListLabelJson,(function(e,t){"LINKEDIN_SALES_NAVIGATOR_PERSONALITY"===t.name&&(l=!0)})),!i||"Leads"!==i&&"Contacts"!==i&&"Accounts"!==i&&"Potentials"!==i||(Crm.userDetails.permissions.Crm_Implied_LinkedIn_Sales_Navigator_Integration||l)&&networkUtils.loadFeatureScripts(["zcrm4.js","zcrm_detailviewNew.js","zcrm_footer_initial_and_detailviewNew.js",networkUtils.getI18nJSUrl("salesnavigator")],(function(){SalesNavigator.loadSalesNavigator()})),i&&("Leads"===i||"Contacts"===i||"Accounts"===i))if(Crm.userDetails.isRelatedListLyteEnabled?Lyte.Globals.get("relatedList.new_social")&&Lyte.Globals.get("relatedList.socialLoaded"):crmRelatedList.new_social){var f,h=networkUtils.returnDependencyFiles(["crm-social-related-list.js","crm-social-models.js","crm-social-posts.js","crm-social-post-detail-outer.js","crm-social-tab-models.js","crm-social-report-models.js","crm-social-models.js","crm-social-setup-models.js","crm-social-common-models.js","crm-social-tab-rl-common.js","crm-social-post-detail.js","crm-social-convo-inner-new.js"],ResourceConstants.CRMClient),C=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);if(Crm.userDetails.RTL_ENABLED){var w=networkUtils.returnDependencyFiles(["crm-social-related-list-rtl.css"],ResourceConstants.CRMClient);f=h.concat(C).concat(w)}else f=h.concat(C);Lyte.injectResources(f,void 0,(function(){detailView.socialVisible||(Lyte.registeredMixins["crm-social-integration"].fetchSocialRelatedList(!1),detailView.socialVisible=!0)}))}else networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("social"),"zohocrm_zsocial.js","zohocrm_zsocialinteg.js"],(function(){crmSocialInteraction.fetchSocialRelatedList()}));if(s.is(":visible")&&s.hide(),e=$L("#fullInfoDiv"),d.scrollTop()>=e.offset().top+e.outerHeight()+80&&(t=$L("#ABMDetailViewWidget"),detailView.changedBCJson.isABMWidgetAllowed&&t.length&&!t[0].hasChildNodes()&&(a.crmAccountId=detailView.entityId,a.moduleName=i,Lyte.Component.render("crm-detail-view-abm-widget",a,"#ABMDetailViewWidget"))),!detailView.rlLogAdded){var y=$L("#remainingList")[0],_=new IntersectionObserver((function(e){e&&e[0]&&e[0].intersectionRatio>0&&y&&!detailView.rlLogAdded&&(detailView.rlLogAdded=!0,murphy.addCustomTracking({message:"Related List accessed through body scroll",type:"custom event"}),_.unobserve(y))}));y&&_.observe(y)}},detailViewPrivacyScrollHandler:function(){var e=$("#dv-button-layer"),t=$("#DetailViewInnerTabs");if($L("#dataPrivacyBodyElem").scrollTop()>=10){var i=$L(".detailview_add_tag.noFreeze").length;e.length>0&&null!=e&&0==$("dvheaderScrollFIxed").length&&(0==$(".dvheaderScrollFIxed").length&&0==i&&($(".page_initial_loading_hide").addClass("oH"),e.addClass("dvheaderScrollFIxed"),detailView.setDetailViewNewLeftPanelPropOnScroll()),t.length&&t.addClass("dvtabsFixed"),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300))}else e.length>0&&null!=e&&($(".dvheaderScrollFIxed").length>0&&(detailView.setDetailViewNewLeftPanelProp(),e.removeClass("dvheaderScrollFIxed"),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300)),t.length&&t.removeClass("dvtabsFixed"))},bindScroll:function(e){e||(e=detailView.module?detailView.module:$("#module").val()),e&&"Activities"!==Crm.activityGrp[e]&&(thirdPartyUtils.unbindPerfectScroll("#dvinner"),detailView.setDetailViewNewInfoDivProp());var t=$("#dvinner");detailView.lastScrollLeft=0,detailView.lastScrollTop=0;var i=$L.debounce(detailView.detailViewScrollHandler,1);t.off("scroll",i).on("scroll",i),Crm.userDetails.isCanvasActivitySupportEnabled&&e&&"Activities"===Crm.activityGrp[e]&&(thirdPartyUtils.unbindPerfectScroll("#dvinner"),$L("#dvinner").scroll())},detailViewRelatedListDataScrollHandler:function(){$("#sortrellist_div").hide()},setWidthRecommendation:function(e){var t=$(e).find(".newRelDetailsTd"),i=$(".slider").outerWidth(),a=0;detailView.leftRightMoveUpdate=0,detailView.leftRightMovement=0,t.each((function(){a=a+$(this).outerWidth()+40,i<a&&(detailView.leftRightMovement=detailView.leftRightMovement+1)})),$(".slider-list").width(a),i<a&&($(".next-prev-arrow-recommendation").show(),$(".slider").addClass("boxShadowNeeded"))},loadRelatedDetails:function(e,t,i){if(!Crm.renderDVLyteFlow(e)){if("Campaigns"===e&&i){var a=document.querySelector("crm-campaign-analytics");a&&a.setData({reInit:!a.getData("reInit"),isLoading:!0});var n=document.querySelector("crm-backstage-detail-charts");n&&n.setData({reloadRevenueChart:!n.getData("reloadRevenueChart")});var s=document.querySelector("crm-zcampaign-create-progress-info");s&&(document.querySelector("crm-zcampaign-detailview-component").getData("skipReload")||s.setData({reLoad:!s.getData("reLoad")}))}if(!(!detailView.modulesWithRelModules[e]||0==$("#newRelDetails").length||i&&-1===detailView.modulesWithRelModules[e].indexOf(i)||Crm.userDetails.CLIENT_ACCOUNT)){var r=Crm.getCrmBasePath()+"/EntityCustomization.do?action=getRelatedDetails&module="+e+"&entityId="+t;i&&!("Campaigns"===e&&("Contacts"===i||"Leads"===i))?r+="&relModule="+i:i=void 0,"Campaigns"==e&&(i||ZCampaigns.showWebinarLoading()),(new crmRequestPool).initiate({action:r,type:"POST",success:function(a){if("Campaigns"!=e){$(".newRelDetails.pb_processDiv").addClass("mBm15");var n=$("#newRelDetails").addClass("newRelDetails").show();if("false"!=a&&"FAILURE"!=a.STATUS){$("#activationInfo").hide(),$("#newFcLink").show();var s=a.length?Handlebars.templates.RelatedDetails(a):"";if(i){var r=n.find("td[id='newRelModule_"+i+"']");if(r.length)s?r.html($(s).find("td[id='newRelModule_"+i+"']").html()):r.remove();else if(""==n.html())n.html(s);else if(s){var o=n.find(".slider-list");o.length?(o.parents(".newRelDetails").css({margin:"30px 0px"}),o.append($(s).find("td[id='newRelModule_"+i+"']")),detailView.setWidthRecommendation(o)):n.find(".newRelDetailsTable").eq(0).find("tr").eq(0).append($(s).find("td[id='newRelModule_"+i+"']"))}}else{n.html(s);var l=n.find(".slider-list");l.length&&(l.parents(".newRelDetails").css({margin:"30px 0px"}),detailView.setWidthRecommendation(l))}$(s).find("#zfReceivablesLabel").length&&($("#salesDIV,#receivablesDIV,#payablesDIV,#payablesDIV,#noInfoMsg,#summaryHdr").hide(),ZInvoice.financeDetails.module=e,ZInvoice.financeDetails.entityId=t,ZInvoice.financeDetails.isRefresh=!0)}0==n.find(".slider-list").length&&(""!=n.html()&&0!=n.find("table").eq(0).find("td").length||(n.removeClass("newRelDetails").hide(),$(".newRelDetails.pb_processDiv").removeClass("mBm15")))}else i?"Leads"===i||"Contacts"===i?ZCampaigns.updateWebinarLeadContactInfo(i,a[0]):"Potentials"!==i&&"Deals"!==i||!a[0]||ZCampaigns.updateWebinarDealInfo(a[0]):ZCampaigns.fillWebinarInfo(a)},error:function(e){}})}}},showCustomLinkFavoriteImg:function(e){$(e).parent().prepend('<span class="detLftLinkIcon svgIconsImg"></span>'),$(e).remove()},setEventLocation:function(e){if(!$("#meetingInclude").prop("checked"))if("Leads"==e&&Events.addressInfo[e]&&""!=Events.addressInfo[e].trim())Events.setLocation(e);else{e=$("#module").val();mainJson={"Mailing Address":["MAILINGSTREET","MAILINGCITY","MAILINGSTATE","MAILINGZIP","MAILINGCOUNTRY"],"Other Address":["OTHERSTREET","OTHERCITY","OTHERSTATE","OTHERZIP","OTHERCOUNTRY"],"Billing Address":["BILLINGSTREET","BILLINGCITY","BILLINGSTATE","BILLINGCODE","BILLINGCOUNTRY"],"Shipping Address":["SHIPPINGSTREET","SHIPPINGCITY","SHIPPINGSTATE","SHIPPINGCODE","SHIPPINGCOUNTRY"]};var t="value_",i="",a="",n="";if("Contacts"==e){if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){if(v=store.peekRecord(moduleRecordMapping[e].id,Lyte.Router.getRouteInstance().parent.getDynamicParam())){for(var s=["Mailing_Street","Mailing_City","Mailing_State","Mailing_Zip","Mailing_Country"],r=["Other_Street","Other_City","Other_State","Other_Zip","Other_Country"],o=s.length,l=r.length,d=0;d<o;d++)i+=void 0!==v[s[d]]?v[s[d]]+", ":"";for(d=0;d<l;d++)a+=void 0!==v[r[d]]?v[r[d]]+", ":""}}else{for(d=0;d<mainJson["Mailing Address"].length;d++)""!=getMapParameter(t+mainJson["Mailing Address"][d]).trim()&&(i+=getMapParameter(t+mainJson["Mailing Address"][d])+", ");for(d=0;d<mainJson["Other Address"].length;d++)""!=getMapParameter(t+mainJson["Other Address"][d]).trim()&&(a+=getMapParameter(t+mainJson["Other Address"][d])+", ")}""!=i.trim()&&(i=i.slice(0,i.length-2),i+=".",Events.addressInfo.contactBilAddr=i),""!=a.trim()&&(a=a.slice(0,a.length-2),a+=".",Events.addressInfo.contactShipAddr=a)}else if("Accounts"==e||"SalesOrders"==e){if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){if(v=store.peekRecord(moduleRecordMapping[e].id,Lyte.Router.getRouteInstance().parent.getDynamicParam())){var c=["Billing_Street","Billing_City","Billing_State","Billing_Code","Billing_Country"],u=["Shipping_Street","Shipping_City","Shipping_State","Shipping_Code","Shipping_Country"],m=c.length,p=u.length;for(d=0;d<m;d++)i+=void 0!==v[c[d]]?v[c[d]]+", ":"";for(d=0;d<p;d++)a+=void 0!==v[u[d]]?v[u[d]]+", ":""}}else{for(d=0;d<mainJson["Billing Address"].length;d++)""!=getMapParameter(t+mainJson["Billing Address"][d]).trim()&&(i+=getMapParameter(t+mainJson["Billing Address"][d])+", ");for(d=0;d<mainJson["Shipping Address"].length;d++)""!=getMapParameter(t+mainJson["Shipping Address"][d]).trim()&&(a+=getMapParameter(t+mainJson["Shipping Address"][d])+", ")}""!=i.trim()&&(i=i.slice(0,i.length-2),i+=".",Events.addressInfo.accountBilAddr=i),""!=a.trim()&&(a=a.slice(0,a.length-2),a+=".",Events.addressInfo.accountShipAddr=a)}else{var v,g="LANE";if("Vendors"==e&&(g="STREET"),n="","crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route)(v=store.peekRecord(moduleRecordMapping[e].id,Lyte.Router.getRouteInstance().parent.getDynamicParam()))&&(v.Street&&(n=v.Street+", "),v.City&&(n+=v.City+", "),v.State&&(n+=v.State+", "),v.Zip_Code&&(n+=v.Zip_Code+", "),v.Country&&(n+=v.Street));else""!=getMapParameter("value_"+g).trim()&&(n=getMapParameter("value_"+g)+", "),""!=getMapParameter("value_CITY").trim()&&(n=n+getMapParameter("value_CITY")+", "),""!=getMapParameter("value_STATE").trim()&&(n=n+getMapParameter("value_STATE")+", "),""!=getMapParameter("value_CODE").trim()&&(n=n+getMapParameter("value_CODE")+", "),""!=getMapParameter("value_COUNTRY").trim()&&(n+=getMapParameter("value_COUNTRY"));""!=n.trim()&&(n=n.slice(0,n.length-2),n+=".",Events.addressInfo[e]=n)}Events.setLocation(e)}},showApproveRejectPop:function(e,t,i,a,n,s){var r=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(r,void 0,(function(){$L(".rPgoNxtRev").removeClass("rPgoNxtRev");var r=$L("#rpFldIcon"),o=$L(e).data("newsubformcomponent"),l=$L(e).attr("data-rpicon");$L("#rpFldStatusIcon").removeAttr("id","rpFldStatusIcon"),$L(e).attr("id","rpFldStatusIcon");var d,c,u=$L("crm-reviewprocess-reviewpop").e;u.length>0&&u.each((function(){$(this).remove()})),d=a?".mouseArea__"+a+"_"+t:"#mouseArea__"+t;var m=e.closest("crm-detail-view-subform");if(o&&m&&s){var p=m.component.getData("recordFieldIdVsReturnJsonFieldObj");c=p[s]?Handlebars.helpers.getData(p[s]):void 0}else c=e.closest(d).getAttribute("data-params");c=JSON.parse(c),i&&i.entityId&&(i=i.entityId);var v={module:n=n||c.module,recordId:i},g={},f=c.LINKINGMODULE_ID;a?(g.field=a+"."+c.sysRefName,g.subform_record_id=e.dataset.id.split("_")[0],f=g.subform_record_id?g.subform_record_id:c.LINKINGMODULE_ID,g.subform_record_id=f):g.field=c.sysRefName,store.findRecord("reviewprocesspop",i,g,void 0,!1,v).then((function(s){var o=s;o&&(o=o.reviewprocesspop.history);var u="";555!=c.uitype&&556!=c.uitype&&(u=c.defaultvalue.trim()),u&&c.type&&"Date"===c.type&&(u=Utils.getDateInUserDatePattern(new Date(u))),u&&c.type&&"DateTime"===c.type&&(u=Utils.getDateTimeInUserFormat(new Date(u),!0)),"26"===c.uitype&&(u=c.stageValue),Lyte.Component.render("crm-reviewprocess-reviewpop",{dataAttributesId:d,fieldUIType:c.uitype,displaylabel:c.displaylabel,columnName:t,displayValue:u,review_history:o,field_apiName:c.sysRefName,moduleName:n,entityId:i,subformId:a,subformRcrID:f,resonForRejections:$L("#rpReasonForRejection").data("rpresnforrejctn")},"#rpFldStatusIcon"),$L("#approveRejectPopBox")[0].ltProp({show:!0,closeOnBodyClick:!0}),$L(e).hasClass("rpApproveRejIcon")?($L("#rPapproveMsg , #rPrejectMsg").hide(),$L("#rPappRejForm").show(),setTimeout((function(){$L(".postMsgCmt")[0].value="",$L(".postMsgCmt")[1].value="",$(".postMsgCmt").focus()}),100)):$L(e).hasClass("rpRejectIcon")?($L("#rPapproveMsg, #rPappRejForm").hide(),$L("#rPrejectMsg ,#rPRejForm").show(),$L(".RPlatestCmt").removeClass("RPlatestCmt"),$L(".rPMsgBlock").eq(0).addClass("RPlatestCmt"),setTimeout((function(){$(".postMsgCmt").focus()}),100)):$L(e).hasClass("rpApproveIcon")&&($L("#rPrejectMsg , #rPappRejForm , #rPRejForm").hide(),$L("#rPapproveMsg").show()),r.val(l);var m=parseInt($L(e).closest("div .RPfldRow").attr("data-rpfld")),p=$L("[data-rpfld='1']"),v=parseInt(p.find(".rpApproveRejIcon").attr("data-rpicon")),g=$L(".rpApproveRejIcon").length;m===g||!m&&parseInt(l)>=v?($L(".rpNxt").addClass("disable"),1!==m?$L(".rpPrv").removeClass("disable"):$L(".rpPrv").addClass("disable")):1===m||!m&&parseInt(l)<=v?(1!==g&&$L(".rpNxt").removeClass("disable"),$L(".rpPrv").addClass("disable")):$L(".rpPrv,.rpNxt").removeClass("disable")}))}))},RPResubmitBtn:function(e,t,i){var a=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(a,void 0,(function(){$("#rpBtnResubmit").prop("disabled",!0);var e=store.createRecord("reviewprocesspop",{}),a=t;e.$.save({module:a,recordId:i,resubmit:!0}).then((function(){if(0===$(".rp_resubmitRefresh").length){$(".rpHeaders").append('<lyte-messagebox class="rp_resubmitRefresh" lt-prop-type = "info" lt-prop-duration="6500"></lyte-messagebox>')}var e=$L(".rp_resubmitRefresh")[0];e.ltProp("message",I18n.getMsg("crm.rp.record.resubmit")),e.ltProp("show",!0),setTimeout((function(){Utils.windowLocationReload()}),1e3),$L("#pendingRereview").show(),$L("#pendingRpIcon").show(),$L("#rpBtnResubmit").hide(),$L("#rpBtnDelete").hide(),$L("#editRecordbtn").hide()})).catch((function(e){"CANNOT_PERFORM_ACTION"==JSON.parse(e.responseText).code?(Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:a,entityId:entityId},"#detailViewButtonLayerMainTable"),$L("#rpFieldReviewedPop").e.ltProp("show",!0),$L("#rpRecordReviewedUserMsg").hide(),$L("#rpFielddReviewedUserMsg").hide(),$L("#rpFieldSubmittedMsg").show()):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}))}))},showusers:function(e,t){var i="defaultId_"+e,a=".hoverPop_"+e,n=null,s=Lyte.Router.getRouteInstance().transition.info.route,r=$L("crm-approval-process-rejectorlistshow")[0].component;void 0!==r.data.thisObj?n=r.data.thisObj:("undefined"==typeof businessCardJson||void 0!==s&&"crm.tab.module.entity.canvas"===s)&&(n=Lyte.Router.getRouteInstance().currentModel.entityDetails);var o=n.approversNameList.fullUserMapDelegate[t+"delegateUsers"];void 0===o&&(o=[]);var l=n.approversNameList.usersArray[t],d=n.approversNameList.usersArray["apr-"+t],c=n.approversNameList.parllel,u=$L("crm-approval-process-waitinguser");if(void 0!==u[1]&&u[1].remove(),u&&0!==u.length&&void 0!==l&&0!==l.length)(u=u[0]).setData("approverList",l),u.setData("userNameLists",n.approversNameList.userIcon),u.setData("aprApproverList",d),u.setData("parllel",c),u.setData("currUser",n.approversNameList.userName),u.setData("isgroup",!0),u.setData("query",a),u.setData("id",i),u.setData("delegate",o),u.setData("iconUser",n.approversNameList.iconUser);else if(void 0!==l&&0!==l.length){var m=$("#popId").eq(0);void 0!==m&&m.remove();var p=networkUtils.returnDependencyFiles(["crm-approval-process-waitinguser.js"],ResourceConstants.CRMClient),v=(v=networkUtils.returnDependencyFiles(["crm-approval-process-waitinguser.css"],ResourceConstants.CRMClient)).concat(p);c=!0,Lyte.injectResources(v,void 0,(function(){Lyte.Component.render("crm-approval-process-waitinguser",{show:"true",query:a,parllel:c,approverList:l,aprApproverList:d,currUser:n.approversNameList.userName,userNameLists:n.approversNameList.userIcon,delegate:o,isgroup:!0,iconUser:n.approversNameList.iconUser,id:i},a)}))}else u[0]},RPrejectBtn:function(e,t,i){var a=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(a,void 0,(function(){var e=parseInt($L("#rpReviewsCount")[0].textContent),a=parseInt($("#rpReviewedCount").text());Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:t,entityId:i,notReviewedFields:e-a,rjctdFields:parseInt($("#rpRejCount").text()),apprFields:parseInt($("#rpAppCount").text()),resonForRejections:$L("#rpReasonForRejection").data("rpresnforrejctn")},"#dv-button-layer"),$L("#rpReasonRejPop").e.ltProp({wrapperClass:"reviewPopWrapper",width:"500px",show:!0,showCloseButton:!1}),$("#rpReasonRejaddCmtLink").show()}))},rpNxtRev:function(){var e,t,i,a,n,s,r=$L(".rpNxt"),o=$L(".rpPrv"),l=$L("#rpFldIcon"),d=$L(".rPgoNxtRev"),c=parseInt(l.val())+1,u=$L(".data-rpicon"+c),m=u.attr("data-rpfld"),p=renderingUtils.windowHeight,v=$L("#dvinner"),g=v.scrollTop(),f=v.offset().top,h=u.offset().top,C=h+u.outerHeight()+g+100,w=C-p,y=Crm.userDetails.isSubformNewComponentEnabled?u.closest("crm-detail-view-subform").length>0:u.closest("table").is(".subformTabl");if(y&&(t=(e=Crm.userDetails.isSubformNewComponentEnabled?u.closest(".subformParentSection"):u.closest(".subFrmTablWrapper")).width(),i=e.offset().left,s=(b=(a=u.offset().left)-(n=i+t))+u.width()+e.scrollLeft()),C>p)v.scrollTop(w);else if(h<=f){v.scrollTop(0);var _=h-f;v.scrollTop(_)}if(y)if(a>=n)e.scrollLeft(s);else if(a<=i){e.scrollLeft(0);var b=a-i;e.scrollLeft(b)}l.val(c),m?(m=parseInt(m),d.removeClass("rPgoNxtRev"),u.addClass("rPgoNxtRev"),m<$L(".rpApproveRejIcon").length&&m>1?o.removeClass("disable"):m>=$L(".rpApproveRejIcon").length&&(1!==m&&o.removeClass("disable"),r.addClass("disable"))):detailView.rpNxtRev()},rpPrvRev:function(){var e,t,i,a,n,s=$L(".rpNxt"),r=$L(".rpPrv"),o=$L(".rpApproveRejIcon").length,l=$L("#rpFldIcon"),d=$L(".rPgoNxtRev"),c=parseInt(l.val())-1,u=$L(".data-rpicon"+c),m=u.attr("data-rpfld"),p=$L("#dvinner"),v=renderingUtils.windowHeight,g=u.offset().top,f=p.scrollTop(),h=p.offset().top,C=g+u.outerHeight()+f+100,w=C-v,y=Crm.userDetails.isSubformNewComponentEnabled?u.closest("crm-detail-view-subform").length>0:u.closest("table").is(".subformTabl");if(y&&((e=Crm.userDetails.isSubformNewComponentEnabled?u.closest(".subformParentSection"):u.closest(".subFrmTablWrapper")).width(),t=e.offset().left,b=(i=u.offset().left)-(a=$("#preHTMLContainer").width()),n=u.offset().left-renderingUtils.windowWidth+u.outerWidth()),C>v)p.scrollTop(w);else if(g<=h){p.scrollTop(0);var _=g-h;p.scrollTop(_)}if(y)if(i>=a)$("#dvinner").scrollLeft(n);else if(i<=t){e.scrollLeft(0);var b=i-t;e.scrollLeft(b)}l.val(c),m?(m=parseInt(m),d.removeClass("rPgoNxtRev"),u.addClass("rPgoNxtRev"),m>1&&m<o&&s.removeClass("disable"),1===m&&(m!==o&&s.removeClass("disable"),r.addClass("disable"))):detailView.rpPrvRev()},updatedDiffCheck:function(){var e,t=[];e=document.querySelector("crm-entityscores-view")?$L("crm-entityscores-view").e[0].component.getData("entity_scoresTemp"):[];for(var i=(e=detailView.scoreValueOld?detailView.scoreValueOld:e).length,a=detailView.body.length,n=0;n<a;n++)for(var s=detailView.body[n].Scoring_Rule.id,r=0;r<i;r++){if(s===e[r].Scoring_Rule.id)0+detailView.body[n].Score!==0+e[r].Score&&t.push(s)}if(0===a&&i>0)for(r=0;r<i;r++)null!==e[r].Score&&t.push(e[r].Scoring_Rule.id);return $u.union(detailView.arry,t)},updateScoreField:function(){var e={entity_scores:detailView.body,module:detailView.currentModule};detailView.arry=detailView.updatedDiffCheck();var t=Lyte.Router.getRouteInstance().parent.getDynamicParam();Crm.userDetails.USER_ID===detailView.currency.userD&&e&&t===detailView.entityID&&document.querySelector("crm-entityscores-view")&&detailView.arry.length>0&&(e.layout_id=detailView.layoutId,"null"===detailView.layoutId&&(e.layout_id=store.peekRecord("module",moduleRecordMapping[detailView.currentModule].id).layouts[0].id),Lyte.registeredMixins["crm-related-list-utils"].renderScoringRelList(e,(function(){var e="canvas"===Lyte.Router.getRouteInstance().routeName||detailView.scoreValueOld?2e3:0;setTimeout((function(e){for(var t=e.length,i=0;i<t;i++)$L("#"+e[i]).addClass("bg_noteBgColor");detailView.scoreValueOld=void 0,$("#dvinner").scroll($L.debounce(detailView.disableScoreSec,500,!0)),setTimeout(detailView.disableScoreSec)}),e,detailView.arry)})))},disableScoreSec:function(){var e=$("#scorigRulesTable");detailView.visibleArea(e)&&setTimeout((function(){detailView.disableHighlightScore(detailView.arry),detailView.arry=[]}),1e4),$("#detailViewButtonLayerMainTableRow")[0]||setTimeout((function(){detailView.disableHighlightScore(detailView.arry),detailView.arry=[]}),1e4)},disableHighlightScore:function(e){var t=e.length,i=$("#value_MODIFIEDBY"),a=$("#headervalue_MODIFIEDBY");$("#newleft_UpdatedTime").css("background-color","transparent"),i.css("background-color","transparent"),a.css("background-color","transparent");for(var n=0;n<t;n++)$L("#"+e[n]).removeClass("bg_noteBgColor")},showReason:function(){var e=document.getElementById("viewRsn");e.ltProp("show")?e.ltProp("show",!1):e.ltProp("show",!0)},showAdminPop:function(){var e="canvas"===Lyte.Router.getRouteInstance().routeName?Lyte.Router.getRouteInstance().currentModel.entityDetails:"undefined"!=typeof businessCardJson?businessCardJson:void 0,t="2"!==e.approversNameList.parllel,i=$L("crm-approval-process-executionpop");i&&0!==i.length&&(i=i[0]).remove();var a=networkUtils.returnDependencyFiles(["crm-approval-process-executionpop.js"],ResourceConstants.CRMClient);a=a.concat(networkUtils.returnDependencyFiles(["crm-approval-process-executionpop.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT)),Lyte.injectResources(a,void 0,(function(){Lyte.Component.render("crm-approval-process-executionpop",{show:"true",query:"#takeOverApproval",userNameLists:e.approversNameList.fullerUserId,waitingArr:e.approversNameList.pendingForApprovalStage,parllel:t,fulluserList:e.approversNameList.fullUserList,approvers:e.approversNameList.waitingForApproval},"#takeOverApproval"),$L("#takeOverPopUp")[0].setData("ltPropShow",!0)}))},setScoreRulePreviousData:function(){document.querySelector("crm-entityscores-view")&&(detailView.scoreValueOld=$L("crm-entityscores-view").e[0].component.getData("entity_scoresTemp"))},updateField:function(){!Crm.isActivitySplitDone||"Activities"!==Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||"Tasks"!==detailView.Currmodule&&"Events"!==detailView.Currmodule&&"Calls"!==detailView.Currmodule||(detailView.Currmodule="Activities");var e=detailView.Currmodule,t=Lyte.Router.getRouteInstance("crm.tab.module");void 0!==t&&(e=t.getDynamicParam()),detailView.Currmodule===e&&(detailView.isDelugeAvailable?setTimeout((function(){detailView.postCreate()}),3e3):"true"==RebrandLinkUtil.getProperty("IS_LOCAL_ZOHO")?detailView.renderPostCreate(1):detailView.postCreate())},renderPostCreate:function(e){if(e<3){e+=1;var t=detailView.fieldUpdateJson;if(t&&t.length>0){var i=$("#value_"+t[0]+" #subvalue_"+t[0]);i&&i.length>0?detailView.postCreate():setTimeout((function(){detailView.renderPostCreate(e)}),3e3)}}else detailView.postCreate()},pageRefreshHandlingForDetailView:function(){detailView.pageRefreshHandlingForApprovalTransition()||detailView.pageRefreshHandlingForLayoutUpdate()},pageRefreshHandlingForApprovalTransition:function(){return!!detailView.updateMap.isWaitingForApproval&&(detailView.updateMap.isWaitingForApproval=!1,detailView.postCreate(),!0)},pageRefreshHandlingForLayoutUpdate:function(){return!!detailView.updateMap.isPageRefreshForWmsUpdate&&(detailView.updateMap.isFromAfterRefresh=!0,detailView.updateMap.isPageRefreshForWmsUpdate=!1,detailView.postCreate(),!0)},isPageRefreshReqForWmsUpdate:function(){var e=!1;if(detailView.fieldUpdateJson)for(var t=detailView.fieldUpdateJson.length,i=0;i<t;i++){var a=detailView.fieldUpdateJson[i];if("canvas"===Lyte.Router.getRouteInstance().routeName){var n=store.peekAll("field").filter((function(e){return e&&e.column_name===a}))[0];if(("221"===(n=n?n.ui_type:null)||"8"===n||"208"===n)&&detailView.columnVsUpdateDetails&&detailView.columnVsUpdateDetails[a]){e=!0;break}}else{var s=$("#mouseArea__"+a);if(a&&s.length>0&&detailView.columnVsUpdateDetails&&detailView.columnVsUpdateDetails[a]){var r=s.data("params");if(r&&["208"].includes(r.uitype)&&r.defaultid!==detailView.columnVsUpdateDetails[a].id){e=!0;break}}}}return e},doLyteRefresh:function(){_cruxUtils.removeCustomMessage(),detailView.callLyteRefresh(detailView.currentModule)},postCreate:function(){detailView.cloneupdateMap={};var e=Lyte.Router.getRouteInstance().parent.getDynamicParam(),t="true"===$("#iskanbanview").val(),i=$L("#mouseArea__SMOWNERID").data("params"),a=void 0!==detailView.updateMap.$zia_owner_assignment?detailView.updateMap.$zia_owner_assignment:"owner_recommendation_unavailable";if(void 0!==detailView.fieldUpdateJson&&detailView.fieldUpdateJson.length>0&&e===detailView.entityID){var n=detailView.isPageRefreshReqForWmsUpdate();if(null!=detailView.updateMap.isWaitingForApproval&&detailView.updateMap.isWaitingForApproval&&(1==detailView.isApproved||"canvas"===Lyte.Router.getRouteInstance().routeName&&"approval_process_pending"!=store.peekRecord(moduleRecordMapping[detailView.currentModule].id,detailView.entityId).$approval_state))return void(Collaboration.isKioskCompAvail()||!Lyte.registeredMixins.kiosk_execute||Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):reloadCurrentEntityView());if(n&&!detailView.updateMap.isFromAfterRefresh)return void(Collaboration.isKioskCompAvail()||Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):(detailView.updateMap.isPageRefreshForWmsUpdate=!0,detailView.callLyteRefresh(detailView.currentModule)));if(detailView.isBlueprintRefreshAfterCf&&ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray,detailView.pathfinderDetailsArray),"canvas"===Lyte.Router.getRouteInstance().routeName){var s=detailView.fieldUpdateJson.length;return setTimeout((function(e){for(var t=0;t<e;t++)$(".fieldupdate_"+detailView.fieldUpdateJson[t]).addClass("fieldupdate-highlight");if(Crm.userDetails.isSubformNewComponentEnabled&&moduleRecordMapping[detailView.currentModule]&&moduleRecordMapping[detailView.currentModule].fields){var i=[];moduleRecordMapping[detailView.currentModule].fields.forEach((function(e){e.subform&&500!==e.ui_type&&-1!==detailView.fieldUpdateJson.indexOf(e.column_name)&&i.push(e.api_name)})),i.length>0&&document.querySelectorAll("crux-subform").forEach((function(e){e.highlightAggregateField(i)}))}$L(".fieldupdate_MODIFIEDTIME").addClass("fieldupdate-highlight"),$L(".fieldupdate_MODIFIEDBY").addClass("fieldupdate-highlight"),setTimeout((function(){$L(".fieldupdate-highlight").removeClass("fieldupdate-highlight")}),3e3),detailView.fieldUpdateJson=[]}),1e3,s),detailView.updatedColumnNameWithValue={},!1}if(returnJson&&returnJson.entityMapJson){s=detailView.fieldUpdateJson.length;for(var r=0;r<s;r++){var o=detailView.fieldUpdateJson[r];o&&returnJson.entityMapJson[o]&&(["36","77","143","144","145"].includes(returnJson.entityMapJson[o].uitype+"")&&detailView.unprocessedValueMap[o]&&(detailView.unprocessedValueMap[o]=detailView.unprocessedValueMap[o]+""),returnJson.entityMapJson[o].defaultvalue=void 0!==detailView.unprocessedValueMap[o]?detailView.unprocessedValueMap[o]:void 0!==detailView.updateMap[o]?detailView.updateMap[o]:"","Potentials"===detailView.Currmodule&&"STAGE"===o&&(returnJson.entityMapJson[o].plainValue=Crm.getDealsStageValue(returnJson.entityMapJson[o].defaultvalue)),detailView.columnVsUpdateDetails[o]&&["221","8","133","208"].includes(returnJson.entityMapJson[o].uitype)&&(returnJson.entityMapJson[o].defaultid=detailView.columnVsUpdateDetails[o].id),"SMOWNERID"===o&&(returnJson.entityMapJson[o].defaultid=detailView.currency.SMOWNERIDownerID,"assigned_by_zia"===a&&(returnJson.entityMapJson[o].zia_owner_assignment="assigned_by_zia")))}}var l=$("#entityName").val(),d="crmui.hideTooltip()",c="crmLookupBusinessCard.showLookupDetails(this)",u=detailView.fieldUpdateJson.contains("EMAILOPTOUT");if(Crm.userDetails.USER_ID===detailView.currency.userD){var m=Crm.lyteHeaderNeeded(detailView.currentModule);detailView.wfLyteHeaderValue=m;var p=Lyte.Router.getRouteInstance().transition.info,v=p&&p.queryParams&&"Events"===p.queryParams.sub_module;v||(v="Events"===p.dynamicParams[0]);var g,f,h=$("#FreezeLayer").is(":visible"),C=$L("#value_SMOWNERID").find("#ownerName_id"),w=$("#detailViewButtonLayerMainTableRow")[0];m&&(w=(g=$("#dv-button-layer"))[0]);var y=void 0!==detailView.hreFJson;w&&(f=(w=w.getBoundingClientRect()).height+w.top);var b=$("#dvinner"),I=$("#fieldHighlightId"),T=I.eq(0);void 0!==T&&T.remove();h=$("#FreezeLayer").is(":visible");var L=$("#newleft_UpdatedTime");L.css("background-color","transparent");var D,E,R=$("#value_SMOWNERID #ownerName_id"),A=$("#headervalue_SMOWNERID #ownerName_id"),M=[],S=[],V=objectUtils.cloneObject_new(detailView.fieldUpdateJson),N=detailView.getVisibleComponentIds(b,V),P=V.length,O=!1,k=$("#value_MODIFIEDBY"),J=$("#headervalue_MODIFIEDBY");k.css("background-color","transparent"),J.css("background-color","transparent");var U=$("#stageContain");detailView.fadeOutHighLight(),P>0&&(L.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),k.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),J.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"})),detailView.oldfieldUpdateJson=[];var F,B=detailView.fadeOutTimerValue.length;for(r=0;r<B;r++)clearTimeout(detailView.fadeOutTimerValue[r]);if(m){var x=g.find("crm-detailview-header")[0];x&&(F=x.component.getData("record"))}var j=[],H=!1;for(r=0;r<P;r++){var z=void 0!==detailView.hreFJson[V[r]];if("SMOWNERID"===V[r]){var G=$("#headervalue_"+V[r]+" #ownerName_id");if(0==R.length){var W="#hostNameLinkEventTop #ownerName_id";$(W).length>0&&(R=$("#dvinner "+W),G=$("#detailViewButtonLayerMainTableRow "+W))}G.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),R.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"})}var Y=detailView.updateMap[V[r]],q=detailView.dateTimeFormat[V[r]],Z=$("span#subvalue_"+V[r]);if("-None-"===Y&&returnJson&&returnJson.entityMapJson){var K=V[r];if(returnJson.entityMapJson[K]){var X=returnJson.entityMapJson[K].uitype;2!=X&&26!=X||(Y="")}}if(void 0===Y)Y="";else if(""!==Y&&("DUEDATE"===V[r]&&!isNaN(Number(Y))||detailView.cfDatefield&&detailView.cfDatefield[V[r]]&&(!isNaN(Number(detailView.cfDatefield[V[r]]))||"delugeFieldUpdate"===detailView.updateSourceFrom))){K=V[r];var Q=store.peekAll("field").filter((function(e){return e&&e.column_name===K}))[0];if((Q=Q?Q.ui_type:null)&&202===Q&&Y&&"number"==typeof Y){var ee=$L.moment(Y,void 0,{timezone:"GMT"}).format("DD-MM-YYYY");if(ee){var te=(ee=ee.split("-"))[0]+" "+(ee[1]-1)+" "+ee[2];Y=crmCalendar.convertToUserDatePattern(te,Crm.userDetails.DATE_PATTERN.toUpperCase())}else Y=Utils.getDateInGivenPattern($L.moment(Y).toDate())}else Y=Utils.getDateInGivenPattern($L.moment(Y).toDate())}else q&&(Y=""!==q?detailView.dateTimePattern(q,V[r]):"");if(""!==Y&&detailView.phoneField&&detailView.phoneField.contains(V[r])){var ie='asyncFn(crmCallsNew.getClick2CallPromise,"'+detailView.entityID+'","'+detailView.Currmodule+'","'+$ESAPI.encoder().encodeForJavaScript(l)+"\",'',\""+Y+'")';D="<zpb-phone number= "+Y+" module= "+detailView.Currmodule+" recordid="+detailView.entityID+" callbackparamfn="+ie+' lyte-rendered="" class="bCardHover"><a class="pH2 cxSkipFocusable" title="Call" click="zpb-phone => telcall(event,number)"></a>\t</zpb-phone> <span class="phoneRtl" data-zcqa="value_"'+V[r]+'id="subvalue_"'+V[r]+">"+Y+"</span>",E="<zpb-phone number= "+Y+" module= "+detailView.Currmodule+" recordid="+detailView.entityID+" callbackparamfn="+ie+' lyte-rendered="" class=""><a class="pH2 cxSkipFocusable" title="Call" click="zpb-phone => telcall(event,number)"></a></zpb-phone><span class="bCardHover phoneRtl vaM" data-zcqa="" id="subvalue_"'+V[r]+">"+Y+"</span>"}else D="",E="";var ae=$("#value_"+V[r]);idYes="#yes_"+V[r],idno="#no_"+V[r];var ne=$(idYes),se=$(idno),re=$("#detailViewButtonLayerDummyTableRow #headervalue_"+V[r]+" "+idYes).css("background-color","transparent"),oe=$("#detailViewButtonLayerDummyTableRow #headervalue_"+V[r]+" "+idno).css("background-color","transparent"),le=$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" "+idYes).css("background-color","transparent"),de=$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" "+idno).css("background-color","transparent"),ce=$("#value_"+V[r]+" "+idYes),ue=$("#value_"+V[r]+" "+idno);if(ne.length>0)if("true"===detailView.updateMap[V[r]]){var me,pe="<span id = subvalue_yesId> </span>",ve="<span id=yes_"+V[r]+' width="13px" height="12px" class="yes nohyphon" style="background-color: transparent; padding: 0px 5px; display: inline-block; top : 0 "></span>';if(re.length>0){re.remove();var ge=$("#detailViewButtonLayerDummyTableRow #headervalue_"+V[r]+" #subvalue_yesId");ge.remove(),$("#detailViewButtonLayerDummyTableRow #headervalue_"+V[r]+" .busniess_card_Hover").append(pe),(ge=$("#detailViewButtonLayerDummyTableRow #headervalue_"+V[r]+" #subvalue_yesId")).append(ve),ge.css({background:"var(--detailViewHighLightBg)",padding:"5px",display:"inline-block","line-height":"0"}),$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" "+idYes+"#yesId").css({display:"inline-block","background-color":"var(--detailViewHighLightBg)",padding:"0 5px"})}if(le.length>0)le.remove(),(me=$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" #subvalue_yesId")).remove(),$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" .busniess_card_Hover").append(pe),(me=$("#detailViewButtonLayerMainTableRow #headervalue_"+V[r]+" #subvalue_yesId")).append(ve),me.css({background:"var(--detailViewHighLightBg)",padding:"5px",display:"inline-block","line-height":"0"}),le.css({display:"inline-block","background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),le.append("<span id=subvalue_"+V[r]+"></span>");ce.remove(),(me=$("#value_"+V[r]+" #subvalue_yesId")).remove(),ae.append(pe),(me=$("#value_"+V[r]+" #subvalue_yesId")).append(ve),me.css({background:"var(--detailViewHighLightBg)",padding:"5px",display:"inline-block","line-height":"0"}),se.css("display","none"),oe.css("display","none"),ue.css("display","none"),de.css("display","none")}else oe.length>0&&oe.css({display:"inline-block","background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),de.length>0&&de.css({display:"inline-block","background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),ue.css({display:"inline-block","background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),se.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}),le.css("display","none"),re.css("display","none"),ce.css("display","none"),_,ne.css("display","none");else{var fe=$("#headervalue_"+V[r]+" #subvalue_"+V[r]);if(0===fe.length){var he=$("#header_"+V[r]+" #headervalue_"+V[r]);if(he.length>0)(ye=he[0].querySelector("crm-richtext-component"))?ye.component.setData("cxPropValue",Y):he[0].innerHTML=$ESAPI.encoder().encodeForHTML(Y)}var Ce=$("#textarea_"+V[r]+"#Crm_"+detailView.Currmodule+"_"+V[r]);Ce.length>0&&Ce.attr("value",Y),m&&$("#busDV_"+V[r]).css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"});var we=m?$("#fullInfoDiv #subvalue_"+V[r]).length:$("#subvalue_"+V[r]).length;if(ae.length>0&&0===we){var ye=ae[0].querySelector("crm-richtext-component");if("SMOWNERID"===V[r]){if("assigned_by_zia"===a){var _e=$L("#headervalue_"+V[r]);if("owner_recommendation_available"===i.zia_owner_assignment){var be="#otherRecommendationZiaIcon",Ie="#otherRecommendationZiaIconBC",Te=$L(be)[0];(Le=$L(Ie)[0]).outerHTML="",Te.outerHTML=""}(ae=$L("#value_"+V[r]))[0].innerHTML="",ae[0].innerHTML='<span purpose="showUserBC" data-params="{&quot;userId&quot;:&quot;'+this.currency.userD+'&quot;,&quot;reqFrom&quot;: &quot;assigned_by_zia&quot;}" id="ownerName_id" data-zcqa="value_SMOWNERID" onmouseover="detailView.showZiaReasoningPopover( \'aBZiaIcon\' , \''+this.currentModule+'\', \'show_reasoning\')"><span id="aBZiaIcon"><crmutil-icon icon-name="zia-logo" icon-class="zcicn-zia-logo zcicn_4a8de9 mR4" class="zRspacing " lyte-rendered=""> <svg class="zcicn_embedSvg zcicn-zia-logo zcicn_4a8de9 mR4"> <use href="#zcicn-zia-logo"></use> </svg> </crmutil-icon><span id="aBZPop" class="w80_per"><lyte-text lt-prop-value=\''+Y+'\' class="w70_per" mouseenter="lyte-text => mouse" mouseover="lyte-text => over(event)" lt-prop-title="" lyte-rendered="">'+Y+"</lyte-text></span></span></span><a class=\"crmLinkColor cP\" id=\"changeOwnerIco\" href=\"javascript:void(null)\" onclick=\"newShowLookUp('ownerName','ownerId','AssignedTo','ownername','fromentityview','','',$('#cvid').val(),'null','','"+this.currency.userD+"','','',$('#module').val())\"></a>",_e[0].innerHTML="",_e[0].innerHTML='<span class="bCardHover cDefault w100_per" purpose="showUserBC" data-params="{&quot;userId&quot;:&quot;'+this.currency.userD+'&quot;,&quot;reqFrom&quot;: &quot;assigned_by_zia&quot;}" id="ownerName_id" data-zcqa="" onmouseover="detailView.showZiaReasoningPopover(\'aBZiaIconBC\' ,\''+this.currentModule+'\',\'show_reasoning\')"><span id="aBZiaIconBC" class="w100_per" ><crmutil-icon icon-name="zia-logo" icon-class="zcicn-zia-logo zcicn_4a8de9 mR4" class="zRspacing "></crmutil-icon><span id="aBZPopBC" class="ziaAssignMax"><lyte-text lt-prop-value=\''+Y+"' ></lyte-text></span></span></span><a class=\"crmLinkColor cP\" id=\"changeOwnerIco\" href=\"javascript:void(null)\" onclick=\"newShowLookUp('ownerName','ownerId','AssignedTo','ownername','fromentityview','','',$('#cvid').val(),'null','','"+this.currency.userD+"','','',$('#module').val())\"></a>",detailView.ziaRecommendation={}}else if(R[0].innerText=Y,"owner_recommendation_unavailable"===a){be="#otherRecommendationZiaIcon",Ie="#otherRecommendationZiaIconBC",Te=$L(be);var Le=$L(Ie);void 0!==Te[0]&&void 0!==Le[0]&&(Te=Te[0],(Le=Le[0]).outerHTML="",Te.outerHTML="")}}else if(ye)ye.component.setData("cxPropValue",Y);else{var De="<span id=subvalue_"+V[r]+">"+Y+"</span>";ae[0].innerHTML="",ae.append(De)}}if(fe.length>0){ye=fe[0].querySelector("crm-richtext-component");if("SMOWNERID"===V[r])A[0].innerText=$ESAPI.encoder().encodeForHTML(Y);else if(ye)ye.component.setData("cxPropValue",Y);else{var Ee,Re=$("#detailViewButtonLayerMainTableRow #topSectionTitle #headervalue_"+V[r]);if(0===$("#detailViewButtonLayerMainTableRow #topSectionTitle #headervalue_"+V[r]+" #subvalue_"+V[r]).length)if(void 0!==$("#value_"+V[r]+" #subvalue_"+V[r]).eq(0)&&(Ee=Y),void 0!==Re[0]&&(Ee=Y,Re[0].innerHTML=""),void 0!==Ee){De="<span id=subvalue_"+V[r]+">"+Ee+"</span>";Re.append(De)}fe.not(".colorAppliedPicklist").css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"});var Ae=fe.children("zpb-phone");""!==Y&&0==Ae.length&&E.length>0&&fe.length>0&&void 0!==fe[0]&&(fe[0].innerHTML="",fe.append(E));var Me=$("#headervalue_"+V[r]+" #subvalue_"+V[r]);"Tasks"===detailView.currentModule&&"DUEDATE"===V[r]&&void 0!==Me[0]&&Me[0].innerText?Me[0].innerText=Y:void 0!==fe[0].innerText&&(fe[0].innerText=Y),"PRE"===fe[0].tagName&&(fe.addClass("DV_textAreaLineClamp"),detailView.afterRenderMultilineField(fe,"",!0))}}_e=$("#headervalue_"+V[r]);if(0!==(Me=$("#headervalue_"+V[r]+" #subvalue_"+V[r])).length){if(y&&z&&detailView.hreFJson[V[r]].length>1)if(Me.attr("href",detailView.hreFJson[V[r]]),void 0!==detailView.hreFJson[V[r]+"_module"])(Ue={}).module=detailView.hreFJson[V[r]+"_module"],Ue.id=detailView.hreFJson[V[r]+"_id"],Me.attr({"data-params":JSON.stringify(Ue),href:detailView.hreFJson[V[r]]}),void 0===Me.attr("onmouseout")&&Me.attr({onmouseout:d,onmouseenter:c});else Me[0].innerText="",(Fe=document.createElement("a")).href=detailView.hreFJson[V[r]],Fe.id="subvalueUrl_"+V[r],Fe.className="link weblinkAcc",Fe.rel="noopener noreferrer",Fe.target="_blank",Me[0].appendChild(Fe),$("#headervalue_"+V[r]+" #subvalue_"+V[r]+" #subvalueUrl_"+V[r])[0].innerText=Y}else if(y&&z&&0!==_e.length){var Se=_e;if(Se[0].innerText="",Se.addClass("busniess_card_Hover"),(Fe=document.createElement("a")).href=detailView.hreFJson[V[r]],Fe.id=e="subvalue_"+V[r],Fe.className="link weblinkAcc",Fe.rel="noopener noreferrer",Fe.target="_blank",Se[0].appendChild(Fe),(Me=$("#headervalue_"+V[r]+" #subvalue_"+V[r]))[0].innerText=Y,void 0!==detailView.hreFJson[V[r]+"_module"])(Ue={}).module=detailView.hreFJson[V[r]+"_module"],Ue.id=detailView.hreFJson[V[r]+"_id"],Me.attr({"data-params":JSON.stringify(Ue),href:detailView.hreFJson[V[r]]}),Fe.className="bCardHover",void 0===Se.attr("onmouseout")&&Me.attr({onmouseout:d,onmouseenter:c})}if(!V[r]||"FIRSTNAME"!==V[r]&&"LASTNAME"!==V[r]||"Leads"!==detailView.currentModule&&"Contacts"!==detailView.currentModule||Lyte.objectUtils(F,"add","First_Name",""),m&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson[V[r]]){var Ve=returnJson.entityMapJson[V[r]],Ne=Ve.uitype;if(36===parseInt(Ne)||143===parseInt(Ne)||145===parseInt(Ne)||144===parseInt(Ne)){var $e=Lyte.registeredMixins["crm-detailview-parser"],Pe=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:Crm.userDetails.BASE_CURRENCY?Crm.userDetails.BASE_CURRENCY:void 0;$e.parseAndSetCurrencyValue(Pe,Ve.defaultvalue,F,Ve.sysRefName,Ve.isaggrfield,detailView.updatedColumnNameWithValue[Ve.colname]),"true"===Ve.isaggrfield&&j.push(Ve.sysRefName)}else if("TAGMODULEREFID"!==Ve.colname&&Crm.userDetails.isSubformNewComponentEnabled&&-1===detailView.headerRecordUpdateNotRequiredUIypes.indexOf(parseInt(Ne))){var Oe=detailView.updatedColumnNameWithValue[Ve.colname];if("true"===Ve.isaggrfield&&j.push(Ve.sysRefName),"Last_Name"!==Ve.sysRefName||"Leads"!==detailView.currentModule&&"Contacts"!==detailView.currentModule||(Oe=Y),F){var ke={id:F.id};ke[Ve.sysRefName]=""===Oe?void 0:Oe,store.pushPayload(F.$.model._name,ke)}}else Crm.userDetails.isSubformNewComponentEnabled||-1!==detailView.headerRecordUpdateNotRequiredUIypes.indexOf(parseInt(Ne))||Lyte.objectUtils(F,"add",Ve.sysRefName,""===Y?void 0:Y)}var Je=$("#value_"+V[r]+" #subvalue_"+V[r]);if(Je.length>0){var Ue,Fe;if(!1!==H||"Potentials"!==detailView.Currmodule||"STAGE"!==V[r]&&"PIPELINE"!==V[r]||Je[0].innerText==Y||(H=!0),(ye=Je[0].querySelector("crm-richtext-component"))?ye.component.setData("cxPropValue",Y):(Je[0].innerText=Y,Je.not(".colorAppliedPicklist").css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"})),detailView.addToolTip(Je,Y),y&&z&&detailView.hreFJson[V[r]].length>3)if(void 0!==detailView.hreFJson[V[r]+"_module"])(Ue={}).module=detailView.hreFJson[V[r]+"_module"],Ue.id=detailView.hreFJson[V[r]+"_id"],Je.attr({"data-params":JSON.stringify(Ue),href:detailView.hreFJson[V[r]]}),void 0===Je.attr("onmouseout")&&Je.attr({onmouseout:d,onmouseenter:c});else Je[0].innerText="",(Fe=document.createElement("a")).href=detailView.hreFJson[V[r]],Fe.id="subvalueUrl_"+V[r],Fe.className="link weblinkAcc",Fe.rel="noopener noreferrer",Fe.target="_blank",Je[0].appendChild(Fe),$("#value_"+V[r]+" #subvalue_"+V[r]+" #subvalueUrl_"+V[r])[0].innerText=Y;"PRE"===Je[0].tagName&&(Je.addClass("DV_textAreaLineClamp"),detailView.afterRenderMultilineField(Je,"",!0))}var Be=$("#value_"+V[r]+" #subvalue1_"+V[r]);Be.length>0&&(Be[0].innerText=Y,Be.css({"background-color":"var(--detailViewHighLightBg)",padding:"0 5px"}));var xe=$("#value_"+V[r]);0===xe.children("zpb-phone").length&&""!==Y&&D.length>0&&void 0!==xe[0]&&(xe[0].innerHTML="",xe.append(D))}ae.css("background-color","var(--detailViewHighLightBg)"),$("#header_"+V[r]).css("background-color","var(--detailViewHighLightBg)");var je=detailView.updateMap.colorCode_fieldID;if(je){var He=detailView.updateMap.colorCode,ze=$("#detailView_"+detailView.entityID);t&&(ze=$("#kanban_"+detailView.entityId));var Ge=ze.find(".activitesColor"),We=$("#detailViewButtonLayerMainTable").find(".activitesColor");if(He){var Ye=$("[data-fieldid="+je+"]"),qe=Ye.closest(".tabDiv").find(".activitesColor");if(qe.length>0)qe.css("background-color",He);else $('<span class="dIB activitesColor activitesColor_dv" id="selectColorComponent" style="background:'+He+'"></span>').insertBefore(Ye.find("span"));if(Ge.length>0)Ge.css("background-color",He);else{var Ze=$("#cvlist_"+detailView.entityID);Ze.length>0&&Ze.find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+detailView.entityID+'" style="background: '+He+'"></span>')}We.length>0?We.css("background-color",He):$("#eventNameDiv").append('<span class="activitesColor eventColor_dv" data-zcqa="eventTemplecolor" style="background: '+He+'"></span>')}else $("#selectColorComponent").remove(),Ge.remove(),We.remove()}var Ke=$("#mouseArea__"+V[r]);if(!v&&Ke&&Ke.data("params")&&Ke.data("params").colorcode_enabled)if(detailView.updateMap[V[r]]&&(""===detailView.updateMap[V[r]]||"-None-"===detailView.updateMap[V[r]]))Z.attr({class:"colorAppliedPicklist colorAppliedPKNone",style:""});else if(detailView.updateMap.coloumnVsColorCodeMap&&detailView.updateMap.coloumnVsColorCodeMap[V[r]]){He=detailView.updateMap.coloumnVsColorCodeMap[V[r]];Z.attr({class:"colorAppliedPicklist",style:getPLStyleObj(He)})}else if(returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson[V[r]]){var Xe=returnJson.entityMapJson[V[r]].picklistmap;if(Xe){var Qe=Xe.filter((function(e){return e.uservalue===Y}));null!=Qe&&Qe.length>0&&Qe[0].colorCode&&Z.attr({class:"colorAppliedPicklist",style:getPLStyleObj(Qe[0].colorCode)})}}if(Ke.length>0){var et=detailView.cfDatefield[V[r]+"_defaultValue"],tt=detailView.currency[V[r]];void 0!==tt?(Ke.data("params").defaultvalue=tt+"",Ke.data("params").plainValue=tt+"",void 0!==Ke.data("params").dbPhoneValue&&(Ke.data("params").dbPhoneValue=tt+"")):void 0!==et&&et.length>0?(Ke.data("params").defaultvalue=et,Ke.data("params").plainValue=et):(void 0!==Ke.data("params").dbPhoneValue&&(Ke.data("params").dbPhoneValue=Y),Ke.data("params").defaultvalue=Y,Ke.data("params").plainValue=Y),detailView.columnVsUpdateDetails&&detailView.columnVsUpdateDetails[V[r]]&&["221","8","133","208"].includes(Ke.data("params").uitype)&&(Ke.data("params").defaultid=detailView.columnVsUpdateDetails[V[r]].id)}if("SMOWNERID"===V[r]){var it=C.attr("data-params");(it=JSON.parse(it)).userId=detailView.currency.SMOWNERIDownerID,void 0!==a&&(it.reqFrom=a,i.zia_owner_assignment=a),it=JSON.stringify(it),C.attr("data-params",it),C[0].innerText=Y,R.attr("data-params",it)}if("STAGE"===V[r]&&"Potentials"===detailView.Currmodule){var at=detailView.updateMap.PROBABILITY+":"+Y,nt=U.find('li[data-value="'+$.escapeSelector(at)+'"]');detailView.stageClickHandler(nt)}}if(!0===H){var st=$L("crm-stage-detailview");st&&st.length&&(st[0].remove(),Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent())}document.querySelectorAll("crux-subform").forEach((function(e){e.highlightAggregateField(j)})),detailView.fieldUpdateJson=[];var rt,ot=N.length,lt=[];for(r=0;r<ot;r++){var dt={};dt.fieldName=N[r],dt.addedTime=(new Date).getTime(),lt.push(dt)}if(ot>0&&(rt=detailView.getFirstValue(N)),!O&&!detailView.isPopShown&&ot>0&&void 0!==rt){$("#yes_"+detailView.constVisibl);var ct=rt[0].getAttribute("id"),ut=($("#no_"+detailView.constVisibl),ct.split("_"));"#subvalue_"+ut[1],detailView.rendercomponentLyte("header_",ut[1],f)&&(O=!0),!O&&detailView.rendercomponentLyte("headervalue_",ut[1],f)&&(O=!0),!O&&detailView.rendercomponentLyte("value_",ut[1],f)&&(O=!0),O&&!h&&($("#basic").addClass("peNone"),b.css("pointer-events","auto"),b.children().addClass("peNone"))}if(detailView.isPopShown&&detailView.timeoutForFieldUpdate(lt),b.on("scroll",$L.debounce((function(){var e,t=(M=detailView.getVisibleComponentIds("dvinner",V)).length,i=!1,a=detailView.wfLyteHeaderValue?$("#dv-button-layer")[0]:$("#detailViewButtonLayerMainTableRow")[0];if(a&&(e=(a=a.getBoundingClientRect()).height+a.top),!O&&!detailView.isPopShown){var n=detailView.getFirstValue(M);if(void 0!==n){var s=n[0].getAttribute("id"),r=s.split("_");detailView.wfLyteHeaderValue?$("#dv-button-layer #"+s).length:$("#detailViewButtonLayerMainTableRow #"+s).length;detailView.rendercomponentLyte("header_",r[1],e)&&(O=!0,i=!0),!O&&detailView.rendercomponentLyte("header_",r[1],e)&&(O=!0,i=!0),!O&&detailView.rendercomponentLyte("value_",r[1],e)&&(O=!0,i=!0)}}var o=$L("crm-workflow-fields-update-popup")[0];o&&(o=o.component);for(var l=0;l<t;l++){var d={};d.fieldName=M[l],d.addedTime=(new Date).getTime(),S.push(d)}if(detailView.isPopShown&&detailView.timeoutForFieldUpdate(S),detailView.popUpPresent&&detailView.highligthaddd&&o&&o.setData("orginElem",detailView.originElem),detailView.popUpPresent&&!detailView.highligthaddd&&!detailView.isPopShown){var c=$("#"+detailView.originElem).offset().top;!detailView.highligthaddd&&e&&e<c&&(void 0!==T?(0===T.length&&(T=I.eq(0)),T.remove(),Lyte.Component.render("crm-workflow-fields-update-popup",{show:!0,orginElem:detailView.originElem,scrolTop:!1},"body")):o&&o.setData({orginElem:detailView.originElem,show:!0}),detailView.highligthaddd=!0)}i&&!h&&($("#basic").addClass("peNone"),b.css("pointer-events","auto"),b.children().addClass("peNone"))}),500)),detailView.cloneupdateMap=objectUtils.cloneObject_new(detailView.updateMap),detailView.updateMap={},detailView.updatedColumnNameWithValue={},detailView.unprocessedValueMap={},detailView.updateSourceFrom=void 0,detailView.cfDatefield={},detailView.oldfieldUpdateJson=objectUtils.cloneObject_new(V),u){var mt=$("#value_EMAILOPTOUT"),pt=mt.find(".unsubInfo");if(pt){var vt=mt.find("#subvalue_yesId");if(vt){var gt=vt.find("#yes_EMAILOPTOUT");gt.removeAttr("style"),pt.before(gt),vt.css("display","none")}}}}}detailView.FieldUpdateAvailable=!1,detailView.hreFJson={},setTimeout((function(){(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(detailView.currentModule))&&(CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0))}),1100)},rendercomponentLyte:function(e,t,i){var a,n,s=$("#yes_"+detailView.constVisibl),r=$("#no_"+detailView.constVisibl),o=$("#"+e+t);if("SMOWNERID"===detailView.constVisibl){if(t="SMOWNERID",(o=$("#"+e+"SMOWNERID")).length>0){n=e+t,n+=" #headervalue_SMOWNERID";var l=(c=$("#"+n)).offset().top;if(detailView.visibleArea(c)&&i<l)return detailView.rendercomponent(n),!0;o="value_SMOWNERID #ownerName_id";var d=$("#"+o);if(d.length>0){n=o;l=(c=d).offset().top;if(detailView.visibleArea(c)&&i<l)return detailView.rendercomponent(n),!0}}else if("Events"===detailView.currentModule){n="dvinner #hostNameLinkEventTop #ownerName_id";var c=$("#"+n);if(detailView.visibleArea(c))return detailView.rendercomponent(n),!0;n="detailViewButtonLayerMainTableRow #hostNameLinkEventTop #ownerName_id";c=$("#"+n);if(detailView.visibleArea(c))return detailView.rendercomponent(n),!0}}else if(o.length>0){n=e+t;l=(c=$("#"+n)).offset().top;if(detailView.visibleArea(c)&&i<l)return detailView.rendercomponent(n),!0}(s.length>0&&"true"===detailView.updateMap[detailView.constVisibl]||r.length>0)&&(a="value_"+detailView.constVisibl);l=(c=$("#"+a)).offset().top;return!!(a&&$(detailView.visibleArea(c))&&i<l)&&(detailView.rendercomponent(a),!0)},rendercomponent:function(e){Lyte.registeredMixins.kiosk_execute&&!Lyte.registeredMixins.kiosk_execute.isKioskExecution()&&(detailView.popUpPresent=!0,detailView.highligthaddd=!0,detailView.originElem=e,Lyte.Component.render("crm-workflow-fields-update-popup",{show:!0,orginElem:detailView.originElem,scrolTop:!1},"body"),$("#fieldHighlightId")[0].component.setData({ltPropShow:!0}))},timeoutForFieldUpdate:function(e){detailView.fadeOutTimerValue.push(setTimeout((function(){$("#newleft_UpdatedTime").css("background-color","transparent");for(var t=e.length,i=$("#value_MODIFIEDBY"),a=$("#headervalue_MODIFIEDBY"),n=0;n<t;n++){if((new Date).getTime()-e[n].addedTime>=1e4){$("#value_"+e[n].fieldName).css("background-color","transparent"),$("#header_"+e[n].fieldName).css("background-color","transparent"),$("#busDV_"+e[n].fieldName).css("background-color","transparent");var s="#yes_"+e[n].fieldName,r="#no_"+e[n].fieldName,o=$(s),l=$(r);if(o.length>0){$("#detailViewButtonLayerDummyTableRow #headervalue_"+e[n].fieldName).css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+e[n].fieldName+" #subvalue_yesId").css("background-color","transparent"),$("#detailViewButtonLayerDummyTableRow #headervalue_"+e[n].fieldName+" #subvalue_yesId").css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+e[n].fieldName).css("background-color","transparent"),$("#value_"+e[n].fieldName+" "+s).css("background-color","transparent"),$("#value_"+e[n].fieldName+"  #subvalue_yesId").css("background-color","transparent"),$("#value_"+e[n].fieldName+" "+r).css("background-color","transparent"),$("#detailViewButtonLayerDummyTableRow #headervalue_"+e[n].fieldName+" "+s).css("background-color","transparent");var d=$("#detailViewButtonLayerDummyTableRow #headervalue_"+e[n].fieldName+" "+r);d.css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+e[n].fieldName+" "+s).css("background-color","transparent");var c=$("#detailViewButtonLayerMainTableRow #headervalue_"+e[n].fieldName+" "+r);c.css("background-color","transparent"),$("#value_"+e[n].fieldName+" "+s).css("background-color","transparent"),$("#value_"+e[n].fieldName+" "+r).css("background-color","transparent"),o.css("background-color","transparent"),l.css("background-color","transparent"),"PriceBooks"===detailView.Currmodule&&(d&&d.length>0&&(d[0].innerText=""),c&&c.length>0&&(c[0].innerText=""))}i.css({"background-color":"transparent",padding:"0 5px"}),a.css({"background-color":"transparent",padding:"0 5px"});var u=$("#headervalue_"+e[n].fieldName);if(u.length>0&&("SMOWNERID"===e[n].fieldName&&$("#headervalue_SMOWNERID #ownerName_id").css({"background-color":"transparent",padding:"0 5px"}),$("#subvalue_"+e[n].fieldName).length>0&&$("#headervalue_"+e[n].fieldName+" #subvalue_"+e[n].fieldName).not(".colorAppliedPicklist").css("background-color","transparent"),u.css("background-color","transparent")),"SMOWNERID"===e[n].fieldName){var m="#hostNameLinkEventTop #ownerName_id",p=$("#dvinner "+m),v=$("#detailViewButtonLayerMainTableRow "+m);p.length>0&&(p.css({"background-color":"transparent",padding:"0 5px"}),v.css({"background-color":"transparent",padding:"0 5px"}))}"SMOWNERID"===e[n].fieldName&&$("#value_SMOWNERID #ownerName_id").css({"background-color":"transparent",padding:"0 5px"}),$("#value_"+e[n].fieldName).css("background-color","transparent"),$("span#subvalue_"+e[n].fieldName).not(".colorAppliedPicklist").css("background-color","transparent"),$("#subvalue_"+e[n].fieldName).not(".colorAppliedPicklist").css("background-color","transparent"),$("#value_"+e[n].fieldName+" #subvalue1_"+e[n].fieldName).css("background-color","transparent")}}}),1e4))},addToolTip:function(e,t){var i=e.attr("onmouseenter");i&&i.length>0&&("crmui.showTooltip"===i.split("(")[0]&&(e.removeAttr("onmouseenter"),e.attr("onmouseenter","crmui.showTooltip('"+t+"')")))},updateTimerValue:function(){var e=detailView.oldfieldUpdateJson.length;$("#newleft_UpdatedTime").css("background-color","transparent");var t=$("#value_SMOWNERID #ownerName_id"),i=$("#headervalue_SMOWNERID #ownerName_id");$("#detailViewButtonLayerMainTableRow #headervalue_COMPANY").css("background-color","transparent");for(var a=$("#value_MODIFIEDBY"),n=$("#headervalue_MODIFIEDBY"),s=0;s<e;s++){var r="#yes_"+detailView.oldfieldUpdateJson[s],o="#no_"+detailView.oldfieldUpdateJson[s],l=$(r),d=$(o);if($("#value_"+detailView.oldfieldUpdateJson[s]).css("background-color","transparent"),$("#header_"+detailView.oldfieldUpdateJson[s]).css("background-color","transparent"),l.length>0){$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" "+r).css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" #subvalue_yesId").css("background-color","transparent"),$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" #subvalue_yesId").css("background-color","transparent");var c=$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" "+o);c.css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" "+r).css("background-color","transparent");var u=$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[s]+" "+o);u.css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[s]+"  #subvalue_yesId").css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[s]+" "+o).css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[s]+" "+r).css("background-color","transparent"),l.css("background-color","transparent"),d.css("background-color","transparent"),"PriceBooks"===detailView.Currmodule&&(c&&c.length>0&&(c[0].innerText=""),u&&u.length>0&&(u[0].innerText=""))}var m=$("#headervalue_"+detailView.oldfieldUpdateJson[s]);if(m.length>0){if("SMOWNERID"===detailView.oldfieldUpdateJson[s]){i.css({"background-color":"transparent",padding:"0 5px"});var p="#hostNameLinkEventTop #ownerName_id",v=$("#dvinner "+p),g=$("#detailViewButtonLayerMainTableRow "+p);v.length>0&&(v.css({"background-color":"transparent",padding:"0 5px"}),g.css({"background-color":"transparent",padding:"0 5px"}))}$("#subvalue_"+detailView.oldfieldUpdateJson[s]).length>0&&$("#headervalue_"+detailView.oldfieldUpdateJson[s]+" #subvalue_"+detailView.oldfieldUpdateJson[s]).not(".colorAppliedPicklist").css("background-color","transparent"),m.css("background-color","transparent")}a.css({"background-color":"transparent",padding:"0 5px"}),n.css({"background-color":"transparent",padding:"0 5px"}),"SMOWNERID"===detailView.oldfieldUpdateJson[s]&&t.css({"background-color":"transparent",padding:"0 5px"}),$("#value_"+detailView.oldfieldUpdateJson[s]+" #subvalue_"+detailView.oldfieldUpdateJson[s]).not(".colorAppliedPicklist").css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[s]+" #subvalue1_"+detailView.oldfieldUpdateJson[s]).css("background-color","transparent")}},getVisibleComponentIds:function(e,t){for(var i=t.length,a=[],n=$("#value_SMOWNERID"),s="#hostNameLinkEventTop #ownerName_id",r=$("#dvinner "+s),o=$("#detailViewButtonLayerMainTableRow "+s),l=document.getElementById("hostNameLinkEventTop"),d=0;d<i;d++){var c=$("#headervalue_"+t[d]),u=c;"SMOWNERID"===t[d]&&(detailView.visibleArea(n)&&a.push(t[d]),r.length>0&&detailView.visibleArea(r)&&a.push(t[d]),o.length>0&&detailView.visibleArea(o)&&a.push(t[d]),l&&a.push(t[d])),c.length>0&&($("#subvalue_"+t[d]).length>0&&(c=$("#headervalue_"+t[d]+" #subvalue_"+t[d]),detailView.visibleArea(c)&&a.push(t[d])),detailView.visibleArea(u)&&a.push(t[d])),c=$("#value_"+t[d]),detailView.visibleArea(c)&&a.push(t[d])}return a},getId:function(e){var t,i=$("#detailViewButtonLayerMainTableRow #headervalue_"+e),a=$("#headervalue_"+e),n=$("#subvalue_"+e),s=$("#yes_"+e),r=$("#value_"+e+" #subvalue_"+e),o=$("#no_"+e),l=$("#subvalue1_"+e),d=$("#value_SMOWNERID #ownerName_id");if("SMOWNERID"===e){if(detailView.visibleArea(a))return a;if(t=$("#value_SMOWNERID"),detailView.visibleArea(t))return t;if(d.length>0&&detailView.visibleArea(d))return d;var c="#hostNameLinkEventTop #ownerName_id",u=$("#dvinner "+c),m=$("#detailViewButtonLayerMainTableRow "+c);return u.length>0?u:m}if(0==i.length&&a.length>0&&detailView.visibleArea(a))t=a;else if(0==i.length&&n.length>0&&detailView.visibleArea(n))t=n;else if(s.length>0&&detailView.visibleArea(s)&&"none"!==s.css("display"))t=s;else if(o.length>0&&detailView.visibleArea(o))t=o;else if(l.length>0&&detailView.visibleArea(l))t=l;else if(r.length>0&&detailView.visibleArea(r))return r;return t},getMaxval:function(e){for(var t=e.length,i=0,a=0;a<t;a++){var n=e[a],s=detailView.getId(n);s&&s!==n&&s.offset().top>i&&(i=s.offset().top)}return i},getFirstValue:function(e){for(var t,i=e.length,a=detailView.getMaxval(e),n=0;n<i;n++){var s=detailView.getId(e[n]);if(s){var r=s.offset().top;r<=a+10&&r>0&&(a=r,t=s,detailView.constVisibl=e[n])}}return t},mergeJSon:function(e,t){for(var i in t)e[i]=t[i]},visibleArea:function(e){var t,i=e.offset().top,a=i+e.outerHeight(),n=$L(window).scrollTop(),s=n+renderingUtils.windowHeight,r=$("#detailViewButtonLayerMainTableRow")[0];return detailView.wfLyteHeaderValue&&(r=$("#dv-button-layer")[0]),r&&(t=(r=r.getBoundingClientRect()).height+r.top),a>n&&i<s&&t<i},dateTimePattern:function(e,t){var i=null,a=e.indexOf(":"),n=e.substring(0,a-3),s=e.substring(a-2,e.length).split(" "),r=s[0].split(":"),o=parseInt(r[0]),l=r[1],d=s[1];"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(o=Utils.convertTimeTo24HoursFormat(o,d)),i=n?Utils.getDateObject(n,{hrs:o,mins:l}):"";var c=$("#mouseArea__"+t).data("params");return"undefined"!=typeof returnJson&&void 0!==c&&void 0!==c.defaultvalue&&void 0!==returnJson.entityMapJson&&void 0!==returnJson.entityMapJson[t]&&detailView.replaceDataParams(t,i+""),i&&""!==i?Utils.getDateTimeInUserFormat(i,!0):""},fadeOutHighLight:function(){var e=detailView.oldfieldUpdateJson.length,t=$("#newleft_UpdatedTime"),i=$("#value_MODIFIEDBY"),a=$("#headervalue_MODIFIEDBY");t.css("background-color","transparent"),i.css("background-color","transparent"),a.css("background-color","transparent");var n=$("#value_SMOWNERID #ownerName_id"),s=$("#headervalue_SMOWNERID #ownerName_id");n.css("background-color","transparent"),s.css("background-color","transparent");for(var r=0;r<e;r++){$("#value_"+detailView.oldfieldUpdateJson[r]).css("background-color","transparent"),$("#header_"+detailView.oldfieldUpdateJson[r]).css("background-color","transparent");var o="#yes_"+detailView.oldfieldUpdateJson[r],l="#no_"+detailView.oldfieldUpdateJson[r],d=$(o),c=$(l);if(d.length>0){$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]).css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" #subvalue_yesId").css("background-color","transparent"),$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" #subvalue_yesId").css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]).css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[r]+" "+o).css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[r]+"  #subvalue_yesId").css("background-color","transparent"),$("#value_"+detailView.oldfieldUpdateJson[r]+" "+l).css("background-color","transparent"),$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" "+o).css("background-color","transparent");var u=$("#detailViewButtonLayerDummyTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" "+l);u.css("background-color","transparent"),$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" "+o).css("background-color","transparent");var m=$("#detailViewButtonLayerMainTableRow #headervalue_"+detailView.oldfieldUpdateJson[r]+" "+l);m.css("background-color","transparent"),d.css("background-color","transparent"),c.css("background-color","transparent"),"PriceBooks"===detailView.Currmodule&&(u&&u.length>0&&(u[0].innerText=""),m&&m.length>0&&(m[0].innerText=""))}var p=$("#headervalue_"+detailView.oldfieldUpdateJson[r]);p.length>0&&($("#subvalue_"+detailView.oldfieldUpdateJson[r]).length>0&&$("#headervalue_"+detailView.oldfieldUpdateJson[r]+" #subvalue_"+detailView.oldfieldUpdateJson[r]).not(".colorAppliedPicklist").css("background-color","transparent"),p.css("background-color","transparent")),$("#value_"+detailView.oldfieldUpdateJson[r]+" #subvalue_"+detailView.oldfieldUpdateJson[r]).not(".colorAppliedPicklist").css("background-color","transparent")}},showRecordLockedDetails:function(){$L("#lockedRecordDetailsPopover")[0].ltProp("show",!0),setTimeout((function(){$L(".lockedRecordDetailsPopoverContent").scrollTop(0)}),10)},showRecordLockingPopup:function(e,t,i,a,n){var s=networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-detail-view-record-locking-popup.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));Lyte.injectResources(s,void 0,(function(){var s=$L("crm-detail-view-record-locking-popup");s.length&&s[0].remove();var r={show:!0,module:e.moduleName?e.moduleName:e,entityId:t,entityName:i};r.recordId=n&&n.recordDtl?n.recordDtl.id:void 0,r.isEdit=a,a&&(r.reason=r.oldReason=trimBoth($L("#recordLockedReason").text())),Lyte.Component.render("crm-detail-view-record-locking-popup",r,"canvas"===Lyte.Router.getRouteInstance().routeName?"#detailcanvascontainer":!0===Crm.userDetails.DETAIL_VIEW_HEADER_LYTE?"#dv-button-layer":"#detailViewButtonLayerDiv")}))},makeFieldLocked:function(){if(detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails){if(businessCardJson.isChangeOwnerLocked){for(var e=$L("a#changeOwnerIco"),t=$L("#value_SMOWNERID,#headervalue_SMOWNERID"),i=e.length,a=0;a<i;a++)e[a].remove();t.length>0&&t.addClass("lockedRecordEnb")}if(businessCardJson&&businessCardJson.isEditRestricted){var n=$L("a#changeLayoutIco");for(t=$L("#value_LAYOUTID,#headervalue_LAYOUTID"),i=n.length,a=0;a<i;a++)n[a].remove();t.length>0&&t.addClass("lockedRecordEnb")}}},makeStageFieldsLocked:function(e,t){if("detail"===Lyte.Router.getRouteInstance().routeName&&detailView.changedBCJson&&detailView.changedBCJson.recordLockingDetails&&businessCardJson&&businessCardJson.isEditRestricted&&(!detailView.changedBCJson.recordLockingDetails.fieldIds.length||!detailView.changedBCJson.recordLockingDetails.fieldIds.contains(t))){e.className+=" rlc_Lock",$(e).find(".labelValCreate input").attr("disabled",!0),$(e).find(".labelValCreate select").attr("disabled",!0),$(e).on("mouseover",(function(){$(event.target).hasClass("tabDivCreate")||renderingUtils.zctt.showtt(I18n.getMsg("crm.locking.field.locked"))})),$(e).on("mouseout",(function(){$("#tooltip-zc").hide(),$(event.target).hasClass("tabDivCreate")||renderingUtils.zctt.hidett()}))}},handleLockedRecord:function(){var e=!1;if(["2","7","13","10"].indexOf(this.changedBCJson.isApproved)<0&&!this.changedBCJson.isLockedFromProcessing&&detailView.recordLockingDetails&&detailView.recordLockingDetails.lockingConfigJSON){var t=Crm.userDetails.permissions["Crm_Implied_Lock_"+businessCardJson.module],i=t;Crm.userDetails.DETAIL_VIEW_HEADER_LYTE||(i=i&&["12","3","8"].indexOf(this.changedBCJson.isApproved)<0);var a,n,s,r=detailView.recordLockingDetails.lockedRecordDetails,o=r?r.length:0,l=[],d=[],c=[],u=[],m=!1,p=!1,v=store.peekRecord(moduleRecordMapping[detailView.currentModule].id,detailView.entityId);v&&v.Locked__s&&(p=!0,e=v.$locked_for_me);var g=detailView.recordLockingDetails.lockingInfoFields;g&&g.length&&(g=g.filter((function(e){return"Lock_Source__s"===e.api_name}))),g=g&&g[0]?g[0].pick_list_values:void 0;for(var f=detailView.recordLockingDetails.lockingConfigJSON.length,h=0;h<f;h++){var C=detailView.recordLockingDetails.lockingConfigJSON[h];if("automatic"!==C.lock_type&&(s=!0),r&&o&&p){var w=r.filter((function(e){return e.Record_Locking_Configuration_Id__s===C.id})),y=w?w.length:0;if(y>0){if(e){var _=!0;if("all_profiles"!==C.locked_for)for(var b=C.lock_excluded_profiles?C.lock_excluded_profiles.length:0,I=0;I<b;I++){if(C.lock_excluded_profiles[I].name===Crm.userDetails.PROFILE_NAME){_=!1;break}}_&&u.push(C.id)}for(var T=0;T<y;T++){var L=w[T],D=g?g.filter((function(e){return e.display_value===L.Lock_Source__s})):void 0;"Automatic"===(D=D&&D[0]?D[0].actual_value:void 0)?(n="automatic",c.push(C)):"Manual"===D&&"automatic"!==n&&(n="manual","orchestration"===C.feature_type?(m=!0,d.push(C)):"record_locking"!==C.feature_type&&"find_and_merge"!==C.feature_type||m||l.push(C))}}}}if(Crm.userDetails.DETAIL_VIEW_HEADER_LYTE||(detailView.changedBCJson.isLockAllowed=i&&s),n){var E=[],R={allowed_fields:[],fieldIds:[],recordDtl:{LockedReason:""},isLocked:!0,restricted_actions:[],restricted_communications:[],restricted_custom_buttons:[]};if((a="automatic"===n?c:"manual"===n&&m?d:l)&&a.length){var A=!0;for(h=0;h<o;h++){var M=a.filter((function(e){return e.id===r[h].Record_Locking_Configuration_Id__s}));if(M){if(M=M[0],e&&!u.contains(M.id))continue;if(M.excluded_fields=M.excluded_fields?M.excluded_fields:[],A&&(R.allowed_fields=M.excluded_fields,R.recordDtl.Locked_Time=r[h].Locked_Time__s,A=!1),R.allowed_fields=R.allowed_fields.intersection(M.excluded_fields),e){M.restricted_actions&&(R.restricted_actions=Array.from(new Set(R.restricted_actions.concat(M.restricted_actions)))),M.restricted_communications&&(R.restricted_communications=Array.from(new Set(R.restricted_communications.concat(M.restricted_communications))));var S=M.restricted_custom_buttons?M.restricted_custom_buttons.map((e=>e.id)):[];R.restricted_custom_buttons=Array.from(new Set(R.restricted_custom_buttons.concat(S)))}if($L.moment(R.recordDtl.Locked_Time).toDate()>$L.moment(r[h].Locked_Time__s).toDate()&&(R.recordDtl.Locked_Time=r[h].Locked_Time__s),"manual"===n&&"find_and_merge"===r[h].Feature_Type__s)R.recordDtl.lock_type="manual",R.recordDtl.LockedReason=I18n.getMsg("crm.record.lock.reason.for.find.and.merge.one"),R.recordDtl.feature_type=r[h].Feature_Type__s,R.recordDtl.id=r[h].id;else if("manual"===n)R.recordDtl.lock_type="manual",R.recordDtl.LockedBy=r[h].Locked_By__s?r[h].Locked_By__s.name:void 0,R.isUnLock=Crm.userDetails.IS_ADMIN||r[h].Locked_By__s&&r[h].Locked_By__s.id===Crm.userDetails.USER_ID,R.recordDtl.LockedReason=r[h].Locked_Reason__s,R.recordDtl.id=r[h].id;else if("automatic"===n){R.recordDtl.lock_type="automatic";var V=M.locking_rules.filter((function(e){return e.id===r[h].Record_Locking_Rule_Id__s}));V&&V[0]&&E.push(V[0].name)}}}if(e&&"canvas"!==Lyte.Router.getRouteInstance().routeName){for(var N in detailView.changedBCJson.customButtonMap&&(detailView.changedBCJson.customButtonMap.cbArray=detailView.changedBCJson.customButtonMap.cbArray?detailView.changedBCJson.customButtonMap.cbArray.filter((function(e){return!R.restricted_custom_buttons.contains(e.key)})):detailView.changedBCJson.customButtonMap.cbArray),returnJson.relListLabelsJson.customButtonJson)returnJson.relListLabelsJson.customButtonJson.hasOwnProperty(N)&&"boolean"!=typeof returnJson.relListLabelsJson.customButtonJson[N]&&(returnJson.relListLabelsJson.customButtonJson[N]=returnJson.relListLabelsJson.customButtonJson[N].filter((function(e){return!R.restricted_custom_buttons.contains(e.key)})));detailView.restrictActionsAndCommunications(R)}R.fieldIds=[];var P=R.allowed_fields?R.allowed_fields.length:0;R.fieldNames=P>0?"":"-";for(var O=0;O<P;O++){var k=store.peekRecord("field",R.allowed_fields[O].id);k&&(businessCardJson&&businessCardJson.isEditRestricted&&R.fieldIds.push(k.id),R.fieldNames+=k.field_label,P-1!==O&&(R.fieldNames+=", "))}"automatic"===n&&(R.recordDtl.LockedReason=E),R.canViewDetails=!Crm.userDetails.CLIENT_ACCOUNT,R.recordDtl.Locked_Time=Utils.getDateInLocaleDefaultFormat(Utils.ISO8601toDateObject(R.recordDtl.Locked_Time)),R.isLockedForMe=e,R.lockToolPerm=t,detailView.changedBCJson.recordLockingDetails=R}}if("Tasks"===this.changedBCJson.module){var J,U="true"===$("#iskanbanview").val(),F=U?$("#recordid_"+this.changedBCJson.entityid):$("#cvlist_"+this.changedBCJson.entityid),B=I18n.getMsg("crm.record.lock.record.locked");J=U?'<span id="reclock_'+this.changedBCJson.entityid+'" class="iconlock_ap zcrm_svgIcons recordLockingiconlock_ap mL5" lt-prop-title=\''+B+'\' lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span>':'<span id="reclock_'+this.changedBCJson.entityid+'" class="dIB mL8 zcrm_svgIcons rlc_lockIcon vaT" lt-prop-title=\''+B+'\' lt-prop-tooltip-config=\'{"position":"bottom","appearance":"box","keeptooltip":"true","margin":"5"}\'></span>',e?0===$("#reclock_"+this.changedBCJson.entityid).length&&(U?F.find("#name").after(J):F.find("#lp_Subject").after(J)):$("#reclock_"+this.changedBCJson.entityid).remove()}}},restrictActionsAndCommunications:function(e){e.restricted_actions.contains("update")&&(businessCardJson.isStageLineRestricted=!0,businessCardJson.isEditRestricted=!0,businessCardJson.isProfileImageReadOnly=!0),e.restricted_actions.contains("convert")&&(businessCardJson.convertAllowedMod=""),e.restricted_actions.contains("delete")&&(businessCardJson.deleteAllowed=!1),e.restricted_actions.contains("change_owner")&&(businessCardJson.isChangeOwnerLocked=!0),e.restricted_actions.contains("tags")&&(CrmTags.clientJSON.isTagsRestricted=!0),e.restricted_communications&&e.restricted_communications.contains("send_mail")&&(businessCardJson.isEmailRestricted=!0),e.restricted_communications&&e.restricted_communications.contains("send_survey")&&(businessCardJson.isSendSurveyLocked=!0),e.restricted_communications&&e.restricted_communications.contains("send_portal_invitation")&&(businessCardJson.isPortalInviteLocked=!0)},formatDetailViewStrip:function(e,t){var i=t.rpRecordDetls,a=$("#dv-button-layer");if(a.addClass("pB0"),"Leads"==e||"Accounts"==e||"Contacts"==e?a.addClass("pB0"):"Calls"==e||"Tasks"==e?a.removeClass("pB0").addClass("pB10"):"Events"==e&&a.removeClass("pB0").addClass("pB5"),"Activities"!=Crm.activityGrp[e]){if((e.startsWith("Orchestration")||e.startsWith("PathFinder"))&&(a.find("#editRecordbtn").closest("div").addClass("hide"),a.find("td #CustomizeTools").addClass("hide")),i){if(i.reviewedCount===i.rpTotalFields&&!i.isResubmit&&i.rpRejFields>0){var n=networkUtils.returnDependencyFiles(["crm-reviewprocess-detail.js","lyte-progressbar.js","reviewprocess.js"],ResourceConstants.CRMClient).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-detailView.css"],ResourceConstants.CRMClient));Lyte.injectResources(n,void 0,(function(){Lyte.Component.render("crm-reviewprocess-reviewpop",{resonForRejections:i.reasonForRejection,moduleName:e,entityId:i.rpdeleteParams.id},"#detailViewButtonLayerMainTable"),$L("#rpReasonRejPop").e.ltProp({wrapperClass:"reviewPopWrapper",width:"500px",show:!0,showCloseButton:!1})}))}if(0===i.reviewedCount){var s=store.peekAll("custom_view").filter((function(t){return t.module.module_name===e}));if(s.length>1)0===s.filter((function(t){return t.module.name===e+"in Review"})).length&&store.findAll("custom_view",{module:i.module})}void 0===i.rpApprFields&&void 0===i.rpRejFields&&$("#rpApprovedRejectedStats").remove(),(i.reviewedCount&&0!==i.reviewedCount||i.isResubmit)&&(a.find("#rPpendingStatus").hide(),a.find("#pendingRereview").hide(),a.find("#pendingRpIcon").hide())}}else e&&"Events"==e&&a.find("#topSectionTitle").remove()},showInput:function(){var e=[],t=$("#module").val(),i=[];CrmTags.clientJSON.newlyAdded=[],CrmTags.clientJSON.selectedIds=[],CrmTags.clientJSON.inputVal="",CrmTags.clientJSON&&CrmTags.clientJSON.value&&(i=CrmTags.clientJSON.value),t&&""!=t&&(e=Crm.jsonSelectValues[t].TAGMODULEREFID),thirdPartyUtils.unbindChildSelect2($("#tagInput"));var a=CrmTags.unbindSelectEvent("detailViewSelect");if(CrmTags.populateOptions(e,a,i),CrmTags.processSelector("detailViewSelect"),$("#tagInputButtonsDiv").find(".savebtn").attr("disabled","disabled").addClass("cA").removeClass("cP").css("opacity","0.4"),$("#detailViewTagInputBox ul li.add_icon").hasClass("disable"))return event.preventDefault(),!1;var n=$("#tagui");$("#addTagListIcon").hide(),n.find("#detailViewTagFieldArea").show(),$("li.tagList").hide(),$("div#addTagDiv").hide(),$("li.newTag").show();var s=n.find("#detailViewTagInputList");s.show(),s.find(".select2-search__field").focus(),n.find("#addTagListIcon").hide(),n.find("#tagInputButtonsDiv").show(),$("#detailViewTagInputBox").css({border:"1px solid var(--br_c0c6cc)",padding:"0px"}),itsonview=!0,detailView.changeMarginForSelect2(),Crm.trackSpotLightAction("Tagging - Detail View Plus Click",{Module:t})},changeModifiedTime:function(e){if(null!=getElemById("value_MODIFIEDBY")){var t=$("#value_MODIFIEDBY").find("span");$(t[1]).text(e),$(t[0]).text(Crm.userDetails.DISPLAY_NAME)}if(null!=getElemById("headervalue_MODIFIEDBY")){t=$("#headervalue_MODIFIEDBY").find("span");$(t[1]).text(e),$(t[0]).text(Crm.userDetails.DISPLAY_NAME)}},constructTagList:function(e,t,i){var a=e.length,n=$("#detailViewTagInputList");if(i){a=i.length;for(var s=null,r=0;r<a;r++)if(s=i[r].id,e.contains(s)){var o=Crm.jsonSelectValues[t].TAGMODULEREFID.filter((function(e){return e.id==s}));detailView.doConstructListForGivenId(n,s,t,o[0])}}else for(r=0;r<a;r++){o=Crm.jsonSelectValues[t].TAGMODULEREFID.filter((function(t){return t.id==e[r]}));detailView.doConstructListForGivenId(n,e[r],t,o[0])}},doConstructListForGivenId:function(e,t,i,a){var n=$("<li></li>",{class:"dIB tagList fL perm cP"}).insertBefore(e);n.css("margin-top","0px"),$("<a></a>",{href:CrmTags.getTagLinkUrl(a,i),text:CrmTags.clientJSON.existingTags[t],target:"_blank"}).appendTo(n).css("color","#000"),!Crm.userDetails.ISROMODE&&CrmTags.clientJSON.permission&&$("<span></span>",{class:"ico-close-small svgIcons dIB closeIcon vaT",id:"span_"+t,onclick:"detailView.removeTagfromRecord(this)"}).appendTo(n)},doDetailViewTagsRendering:function(e){CrmTags.clientJSON.featureAvailable=!0,CrmTags.clientJSON.isInReview=!1,e.isTagsFeatureEnabled&&e.isTagFieldVisible&&e.isTagsFeatureAvailable?(CrmTags.clientJSON.isWaitingForApproval=!1,$("#tagui").hasClass("waitingForApproval")?(CrmTags.clientJSON.permission=!1,CrmTags.clientJSON.isWaitingForApproval=!0):null==detailView.changedBCJson?CrmTags.clientJSON.permission=e.tagsPermission:CrmTags.clientJSON.permission=e.tagsPermission&&detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED,!CrmTags.clientJSON.isWaitingForApproval&&CrmTags.clientJSON.isRecLocUnGDPR&&(CrmTags.clientJSON.permission=!1,CrmTags.clientJSON.isWaitingForApproval=!0),$("#tagui").hasClass("isinReview")&&(CrmTags.clientJSON.isInReview=!0),detailView.processTagField()):e.isTagsFeatureEnabled&&e.isTagFieldVisible&&!e.isTagsFeatureAvailable&&CrmTags.clientJSON.value&&CrmTags.clientJSON.value.length>0?(CrmTags.clientJSON.permission=!1,e.isTagsFeatureAvailable||(CrmTags.clientJSON.featureAvailable=!1),detailView.processTagField()):($("#tagui").remove(),$("#callsdtTag_section").remove(),$("#detailviewInfo").remove())},changeMouseEvents:function(e){detailView.pmEmailInfoIcon&&detailView.pmEmailRes&&$(detailView.pmEmailInfoIcon).insertAfter("span#value_EMAIL a").attr("data",detailView.pmEmailRes).attr("bounce_Type",detailView.pmEmailBounceType).attr("bounce_Category",detailView.pmEmailBounceCategory).attr("unblock_Count",detailView.pmEmailUnblockCount).attr("is_Primary",!0).attr("unblock_Count",detailView.pmEmailUnblockCount).attr("email_Address",$L("#subvalue_EMAIL").text()),detailView.secEmailInfoIcon&&detailView.secEmailRes&&$(detailView.secEmailInfoIcon).insertAfter("span#value_ADDN_EMAIL a").attr("data",detailView.secEmailRes).attr("bounce_Type",detailView.secEmailBounceType).attr("bounce_Category",detailView.secEmailBounceCategory).attr("unblock_Count",detailView.secEmailUnblockCount).attr("is_Primary",!1).attr("email_Address",$L("#subvalue_ADDN_EMAIL").text());var t=$("#addTagListIcon").find(".addIcon");isSandboxAcc&&"true"==isSandboxAcc?t.on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.tags.sandbox.not.supported"),!1,"center",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})):CrmTags.clientJSON.permission?Crm.userDetails.ISROMODE?t.css("cursor","not-allowed"):(t.on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.label.add.tags"),!1,"center",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})),t.closest("li").removeClass("disable"),t.attr("onclick","detailView.showInput(this)")):(CrmTags.clientJSON.featureAvailable?CrmTags.clientJSON.isWaitingForApproval?(t.css("cursor","default"),t.closest("li").css("cursor","default")):t.on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.tags.detailview.create.no.permission.msg"),!1,"left",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})):t.on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.tags.records.downgrade.free.edition"),!1,"left",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})),t.closest("li").addClass("disable"),t.removeAttr("onclick"))},removeTagfromRecord:function(e,t){var i=$("#module").val(),a=returnJson[i].entityid.split(","),n=[];if(null!=e){var s=$(e).attr("id"),r=s.split("_")[1];r&&CrmTags.clientJSON.existingTags[r]&&n.push(CrmTags.clientJSON.existingTags[r])}else if(null!=t&&CrmTags.clientJSON.existingTags)for(var o=t.length,l=CrmTags.clientJSON.existingTags,d=0;d<o;d++)null!=l[t[d]]&&n.push(l[t[d]]);if(0==n.length)return!1;var c=CrmTags.getTagNames(n),u="/crm/v2/"+moduleRecordMapping[i].api_name+"/"+a+"/actions/remove_tags?tag_names="+encodeURIComponent(c)+"&fromClient="+!0,m={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:u,type:"post",headers:m,success:function(a){var n=a.data,o=$("#addTagListIcon"),l=$("#detailViewTagInputBox #existingTag"),d=o.position().top,c=o.position().left;if(n&&n.length>0&&-1!=n[0].message.indexOf("tags updated successfully")){null!=e&&(CrmTags.clientJSON.value.splice(CrmTags.clientJSON.value.indexOf(r),1),detailView.changeMouseEvents(CrmTags.clientJSON.value.length),$("#"+s).parent("li.tagList").remove());var u=$("#detailViewTagInputBox").find("#existingTag").find("> li.tagList");if(null!=t&&(CrmTags.clientJSON.value=[],u.remove(),detailView.changeMouseEvents(0)),(null==e&&null!=t||!u||u&&0==u.length)&&($("div#addTagDiv").show(),o.hide(),$("#detailViewTagFieldArea").hide()),returnJson.entityMapJson.TAGMODULEREFID){var m=CrmTags.getDBFormatValue(CrmTags.clientJSON.value);returnJson.entityMapJson.TAGMODULEREFID.defaultvalue=m}d<10&&c<600?(o.css("margin-top","0px"),l.find("li.tagList").css("margin-top","2px")):d>8&&c<25&&(l.find(".removed").remove(),o.css("margin-top","0px"),l.find("li.tagList").last().css("margin-top","3px")),detailView.changeModifiedTime(n[0].details.modifiedTime),itsonview=!1,refreshFollowDiv(),crmTab.deleteFromCache(i),Crm.trackSpotLightAction("Tagging - Detail View Remove Click",{Module:i})}else crmui.showMsgBand("info",I18n.getMsg("crm.tags.add.unsuccessful"),1e3,"")},error:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.unable.to.process"),I18n.getMsg("crm.label.small.tags"),!1)}})},saveTagtoRecordAfterCreation:function(e,t){var i=CrmTags.clientJSON.selectedIds;if(0==i.length&&null!=CrmTags.clientJSON.value&&CrmTags.clientJSON.value.length>0){var a=CrmTags.getTagsArray(!0);a.length>0&&detailView.removeTagfromRecord(null,a)}else{if(0==i.length)return detailView.cancelTag(),!1;var n="";i.length>0&&(n=CrmTags.getTagNames(i));var s="/crm/v2/"+moduleRecordMapping[e].api_name+"/"+t+"/actions/add_tags?over_write="+!0+"&fromClient="+!0+"&tag_names="+encodeURIComponent(n),r={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:s,type:"post",headers:r,success:function(t){var a=t.data;if(a&&a.length>0&&-1!=a[0].message.indexOf("tags updated successfully")){$("#detailViewTagInputBox").css({border:"1px solid transparent"});var n=[];$("#detailViewTagInputList").hide(),$("#tagInputButtonsDiv").hide();var s=$("li.tagList");if(s.remove(),a[0].details.tags&&(n=CrmTags.getRefIdJSONArray(a[0].details.tags)),detailView.constructTagList(n,e),detailView.changeMouseEvents(n.length),$("#detailViewSelect").select2("close"),n.length>0?(s.show(),$("#addTagListIcon").show()):($("div#addTagDiv").show(),$("#addTagListIcon").hide()),detailView.changeModifiedTime(a[0].details.modifiedTime),CrmTags.clientJSON.value=n,returnJson.entityMapJson.TAGMODULEREFID){var r=CrmTags.getDBFormatValue(n);returnJson.entityMapJson.TAGMODULEREFID.defaultvalue=r}CrmTags.clientJSON.selectedIds=[],CrmTags.clientJSON.newlyAdded=[],itsonview=!1,refreshFollowDiv(),crmTab.deleteFromCache(e),Crm.trackSpotLightAction("Tagging - Detail View Save",{Module:e,Count:i.length})}else"RECORD_IN_APPROVAL_PROCESS"==t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):"LOCKED_FOR_MERGE"==t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.merge.sch.actiondenied")):crmui.showMsgBand("info",I18n.getMsg("crm.tags.add.unsuccessful"),1e3,"")},error:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.unable.to.process"),I18n.getMsg("crm.label.small.tags"),!1)}})}},saveTagtoRecord:function(){var e=$("#module").val(),t=returnJson[e].entityid.split(","),i=0;if(!detailView.checkSelect2InputValAndAdd())return!1;if(null!=CrmTags.clientJSON.newlyAdded&&CrmTags.clientJSON.newlyAdded.length>0){var a=CrmTags.getPostDataForTagsCreation(),n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/settings/tags?module="+moduleRecordMapping[e].api_name+"&fromPage=view",type:"post",data:a,headers:n,success:function(a){store.unloadAll("tag");var n=a.tags,s=Crm.jsonSelectValues[e].TAGMODULEREFID;if(CrmTags.validateSymbol(a),n&&n.length>0){i=n.length;for(var r=0;r<i;r++){var o=n[r].details;if(o.name){CrmTags.clientJSON.existingTags[o.modRefId]=o.name,CrmTags.clientJSON.nameVsId[o.name.toLowerCase()]=o.modRefId,CrmTags.clientJSON.existingNames.push(o.name);var l={};l.id=o.modRefId,l.name=o.name,l.tagId=o.id,s.push(l),CrmTags.clientJSON.selectedIds.push(o.name)}}$("#detailViewTagInputBox").css({padding:"0px"}),Crm.jsonSelectValues[e].TAGMODULEREFID=s,crmTab.deleteFromCache(e),Crm.trackSpotLightAction("Tagging - Detail View Tags Create",{Module:e,Count:i})}detailView.saveTagtoRecordAfterCreation(e,t)},error:function(){detailView.saveTagtoRecordAfterCreation(e,t)}})}else detailView.saveTagtoRecordAfterCreation(e,t)},changeMarginForSelect2:function(){$("#detailViewTagInputList ul.select2-selection__rendered li.select2-selection__choice").each((function(){$(this).position().top>10?($(this).attr("style","margin-top:0px"),$(".detailView_tag_Select span.select2").find("li.select2-search--inline").attr("style","margin-top:3px !important")):($(this).css("margin-top","0px"),$(".detailView_tag_Select span.select2").find("li.select2-search--inline").attr("style","margin-top:0px"))}))},checkSelect2InputValAndAdd:function(){var e=$("#detailViewSelect").next("span.select2-container").find("input.select2-search__field"),t=e.val();if(null!=t&&""!=t&&(t=t.trim()).length>0){if(!t.length>25)return setTimeout((function(){e.val(t).focus()}),100),!1;if(!CrmTags.checkCharacter(t)||!CrmTags.checkExistingNames(t,!0,!1,!0))return setTimeout((function(){e.val(t).focus()}),100),!1;if(!CrmTags.checkTagEditionAndRecordLimitCount(!0,"detailViewSelect",CrmTags.clientJSON.tagUsedCount,!1,!0,!0))return e.focus(),!1;CrmTags.clientJSON.newlyAdded.push(t)}return!0},cancelTag:function(){$("#detailViewTagInputList").hide(),$("#tagInputButtonsDiv").hide();var e=$("li.tagList");e&&e.length>0?(e.show(),$("#addTagListIcon").show()):($("div#addTagDiv").show(),$("#addTagListIcon").hide(),$("#detailViewTagFieldArea").hide()),CrmTags.unbindSelectEvent("detailViewSelect"),CrmTags.clientJSON.selectedIds=[],CrmTags.clientJSON.newlyAdded=[],$("#detailViewTagInputBox").css({border:"1px solid transparent"}),itsonview=!1,Crm.trackSpotLightAction("Tagging - Detail View Cancel Click",{Module:$("#module").val()})},processTagField:function(){var e=[],t={},i=[],a=$("#module").val();CrmTags.clientJSON.existingTags={},CrmTags.clientJSON.nameVsId={},CrmTags.clientJSON.existingNames=[],a&&""!=a&&(i=Crm.jsonSelectValues[a].TAGMODULEREFID);for(var n=i.length,s=0;s<n;s++)t=i[s],CrmTags.clientJSON.existingTags[t.id]=t.name,CrmTags.clientJSON.nameVsId[t.name.toLowerCase()]=t.id,CrmTags.clientJSON.existingNames.push(t.name);var r=$("div#addTagDiv");CrmTags.clientJSON&&CrmTags.clientJSON.value&&(n=(e=CrmTags.processTagValueAndGetArray(e,a)).length,detailView.constructTagList(e,a,i),detailView.changeMouseEvents(n),n>0&&(r.hide(),$("#detailViewTagFieldArea").css("display","block")),$("#detailViewTagInputList").hide()),CrmTags.checkAndChangeMouseEvents(r),1==detailView.recordLocked&&r.addClass("disable eventNone")},fetchingZiaRecommendation:!1,ziaRecommendation:{},triggerZiaInsightsAPItoFetchZiaSuggestedUsers:function(e,t,i,a,n,s,r,o,l,d){var c={keys:"zia_suggested_users_data",include_inner_details:e};return Lyte.registeredMixins["zia-insights-utils"].getInsightsV2(moduleRecordMapping[t],returnJson[t].entityid,c).then((function(e){var t=e&&e.zia_insights?e.zia_insights:void 0;if(t&&t.zia_suggested_users_data){for(var l=!0,c=t.zia_suggested_users_data[0].zia_suggested_users,u=c.length,m=0;m<u&&l;m++){var p=c[m];p.assignment_allowed?(o.recommendedOwner=p,Lyte.arrayUtils(c,"removeAt",m,1),o.otherRecommendations=c,l=!1):p.thresholdExpired=!0}l&&(o.recommendedOwner=p);for(var v=JSON.parse(JSON.stringify(t.zia_suggested_users_data[0].fields_considered)),g=v.length,f=[],h=0;h<g;h++){if(v[h].field)store.peekRecord("field",v[h].field.id)&&f.push(v[h])}if((g=f.length)>0){var C=[];for(h=0;h<g;h+=2){var w=[],y=store.peekRecord("field",f[h].field.id);if(f[h].field.field_label=y.field_label,w.push(f[h]),h<g-1){var _=store.peekRecord("field",f[h+1].field.id);f[h+1].field.field_label=_.field_label,w.push(f[h+1])}C.push(w)}if("show_recommendation"===n&&(detailView.changedBCJson.ownerId!==o.recommendedOwner.user.id?d!==o.recommendedOwner.user.id&&o.recommendedOwner.assignment_allowed&&(o.currentUserId=o.recommendedOwner.user.id,o.thresholdExpforCU=!0,o.noOR=!0):(o.noRec=!0,o.noOR=!0)),o.isQC=!1,o.fcGrp=C,detailView.ziaRecommendation=JSON.parse(JSON.stringify(o)),o.originElement="#"+i,o.originElem="#"+i,o.ownerFieldLabel=s,o.type=n,o.entityId=a.entityId,o.module=a.moduleName,"show_reasoning"!==n){o.showZORPop=!0;var b=$L(o.originElement);o.topVal=b.offset().top,o.leftVal=b.offset().left,Lyte.Component.render("crm-zia-reasoning-popover",o,r)}else Lyte.injectResources([networkUtils.returnDependencyFiles(["lyte-hovercard.js"],ResourceConstants.CRMClient)[0]],void 0,(function(){Lyte.Component.render("crm-zia-reasoning-popover",o,r)}));detailView.fetchingZiaRecommendation=!1}commonUtils.showHideLoadingDiv(!1)}else commonUtils.showHideLoadingDiv(!1)}),(function(){commonUtils.showHideLoadingDiv(!1)}))},showZiaReasoningPopover:function(e,t,i,a,n){var s,r;switch(e){case"aBZiaIconBC":s="#aBZPopBC",e="header_SMOWNERID",r="assigned_by_zia";break;case"aBZiaIcon":s="#aBZPop",e="value_SMOWNERID",r="assigned_by_zia"}var o={};if(!detailView.fetchingZiaRecommendation){if(validationUtils.isEmpty(detailView.ziaRecommendation)){detailView.fetchingZiaRecommendation=!0,commonUtils.showHideLoadingDiv(!0);var l=t.moduleName?t.moduleName:detailView.currentModule;return this.triggerZiaInsightsAPItoFetchZiaSuggestedUsers("zia_suggested_users_data.zia_suggested_users.user.name,zia_suggested_users_data.zia_suggested_users.user.role,zia_suggested_users_data.zia_suggested_users.user.profile,zia_suggested_users_data.zia_suggested_users.user.email,zia_suggested_users_data.zia_suggested_users.user.mobile,zia_suggested_users_data.zia_suggested_users.user.phone,zia_suggested_users_data.zia_suggested_users.user.zuid,zia_suggested_users_data.zia_suggested_users.user.image_link",l,e,t,i,a,s,o,r,n)}var d=$L("crm-zia-reasoning-popover")[0];if((o=Lyte.deepCopyObject(detailView.ziaRecommendation)).originElement="#"+e,o.originElem="#"+e,o.ownerFieldLabel=a,o.type=i,o.entityId=t.entityId?t.entityId:detailView.entityId,o.module=t.moduleName?t.moduleName:detailView.currentModule,o.isQC=!1,"show_reasoning"!==i){o.showZORPop=!0;var c=$L(o.originElement),u=c.offset().top,m=c.offset().left}var p=$L("#zorTabs")[0];p&&p.openTab("recommendedUser"),void 0!==d?(d.setData("offset",{top:u+"px",left:m+"px"}),d.setData("originElement",o.originElement),d.setData("originElement",o.originElem),d.setData("ownerFieldLabel",o.ownerFieldLabel),d.setData("type",o.type),d.setData("entityId",o.entityId),d.setData("module",o.module),d.setData("ltPropShow",!0),d.setData("showZORPop",!0),d.setData("isQC",!1)):(o.topVal=u,o.leftVal=m,Lyte.Component.render("crm-zia-reasoning-popover",o,s))}},showUnsubInfoMsgTooltip:function(e){var t;if(Crm.isUnsubscribeEnabled){var i="-",a=$(e).attr("data-param"),n=JSON.parse(a);n.mode&&(i=I18n.getMsg(n.mode)),t="<p class='crm-small-font-size'>"+I18n.getMsg("crm.unsubscribed.mode")+": "+i+"<br>"+I18n.getMsg("crm.unsubscribed.time")+": "+n.time+"</p>"}else t="<p class='crm-small-font-size'>"+I18n.getMsg("crm.emailoptout.consentform.info")+"</p>";crmui.showTooltip(t,!0)},refreshPageForSingleRecordWorkFlow:function(e){if(detailView.refreshInWms){var t=e.entityId.toString(),i=e.ruleType.toString(),a="Activities"===Crm.activityGrp[i],n=Lyte.Router.getRouteInstance().transition.info,s=n.dynamicParams[0],r=n.dynamicParams[1],o="Activities"===Crm.activityGrp[s];if(t==r&&(i==s||a&&o)){var l=$(".ks_loading_new");if(a&&0==l.length)return detailView.kafkaWFStatus="waiting_for_loading",void setTimeout((function(){detailView.refreshPageForSingleRecordWorkFlow(e)}),2500);"crm.tab.module.entity.canvas"==n.route&&(detailView.kafkaWFStatus="kafka_refresh",detailView.callLyteRefresh(i)),("crm.tab.module.entity.detail"==n.route||$("#iskanbanview").val()&&$("#entitypopup .ks_loading_new").length>0)&&(detailView.kafkaWFStatus="kafka_refresh",detailView.callLyteRefresh(i))}else detailView.refreshInWms=!1}},convertMessageHandlingForAutomationActionConvert:function(e){if(detailView.isRecordConverted||detailView.isBlueprintPageRefresh){if(e.includes("convertLeadActionDiv1")){var t=$(e);t.find("#convertLeadActionDiv1").addClass("dN"),t.find("#convertLeadActionDiv2").addClass("dN"),t.find("#automationActionRecordConvertDiv1").removeClass("dN"),t.find("#automationActionRecordConvertDiv2").removeClass("dN"),e=t[0].outerHTML}detailView.isRecordConverted=!1,detailView.isBlueprintPageRefresh=!1}return e},reloadSingleRecordKafkaWF:function(e,t){if(Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution())Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0);else{for(var i,a=crmNavig[crmNavig.customViewKey].recordId.length,n=1;n<a;n++)if(null!=crmNavig[crmNavig.customViewKey].recordId[n]&&crmNavig[crmNavig.customViewKey].recordId[n].id==e){i=n;break}if(308==Lyte.Router.getRouteInstance().transition.state||200==Lyte.Router.getRouteInstance().transition.state)Lyte.Router.getRouteInstance().refresh().data={cvid:crmNavig.customViewKey.split("#")[0],recordNum:i};else setTimeout((function(){detailView.callLyteRefresh(t)}),500)}},callLyteRefresh:function(e){Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution()?Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0):(clearTimeout(detailView.refreshTimer),detailView.refreshInWms=!1,detailView.isWFExecInKafka=!1,detailView.refreshCanvasView=!1,"detail"==Lyte.Router.getRouteInstance().routeName&&void 0!==crmNavig.customViewKey?detailView.reloadSingleRecordKafkaWF(Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],"Activities"==Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]?e:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]):308==Lyte.Router.getRouteInstance().transition.state||200==Lyte.Router.getRouteInstance().transition.state?Lyte.Router.getRouteInstance().refresh():setTimeout((function(){detailView.callLyteRefresh(e)}),500),$("#basic").removeClass("peNone"),"Events"==e&&Events.showEventSuccessMessage(detailView.currentStatus,void 0,!0))},hideElementsForKafkaWorkFlow:function(e){var t=$("#fullInfoDiv"),i=$(".showhideDetailsDivEle"),a="Activities"===Crm.activityGrp[e];if(detailView.kafkaWFStatus="kafka_wf_loading",a){if($("#eventsAddnInfo, #right_invUserDetails, #remainingList,.upcomingActionsDivEle, #upcomingActionsTitle, #upcomingActionsDiv, #fromTaskPage").hide(),$("#editRecordbtn, #CustomizeTools").hide(),$("#existingTag .tagList span").hide(),$("#addTagListIcon").addClass("disable"),"Events"==e)t.empty().after("<div class='mT50'><div class='ks_loading_new' style='top:50%;left:50%'></div></div>");else if("Tasks"==e){if(t.hide(),"true"==$("#iskanbanview").val())$("#rp_td").hide(),$("#cvEditSave").empty().css("display","none"),$("#entitypopup").html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>').show();else"detail"===Lyte.Router.getRouteInstance().routeName&&$("#basic").addClass("peNone"),$("#dv_cus_links, #noteDetails, #showhideDetailsDiv, #closeTaskTr, #rPSelect, #rp_parent, #flw_div").hide(),$("#BodyContent").append('<div class="ks_loading_new pA" style="top:50%;left:35%"></div>')}else if("Calls"==e){if($(".completed, #rp_parent").hide(),t.hide(),$("#rightPanel").length&&$("#detailCView").length)$("#taskDetailsPart").html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>').show();else $("#showhideDetailsDiv, #noteDetails, #dv_cus_links").hide(),$("#BodyContent").append('<div class="ks_loading_new pA" style="top:50%;left:35%"></div>'),detailView.refreshInWms=!1}}else{$("#leftPanel").append('<div id="baseOverlay" class="baseOverlay"></div>');var n=$L("#infoDiv>div"),s=n.length;if(s>0){var r=$L(".dv_header_wrapper")[0];$L("crm-left-panel").addClass("dN"),$L(".dv_content_tab-head").addClass("dN"),$L(".dv_content_wrapper")[0].classList.add("pR"),r.classList.add("pR");var o=document.createElement("div");o.id="baseOverlay",o.className="baseOverlay baseOverlayDetailView",r.appendChild(o);for(var l=0;l<s;l++)n[l].classList.contains("cardview-container")||n[l].classList.add("dN");"detail"===Lyte.Router.getRouteInstance().routeName&&$("#basic").addClass("pointerEveNone")}else{t.hide(),null!=detailView.changedBCJson&&(detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED=!1),$("#newlpdiv, .lpDiv").hide(),detailView.isWFExecInKafka?$("#dv_leftPanel_showHide,#bestTimeToContactDiv").hide():$("#changeOwnerIco,#dv_leftPanel_showHide,#newleft_UpdatedTime,#bestTimeToContactDiv,.newDetailLeftPanelTd,.busniesscard_width").hide(),i.hide(),$("#dv-button-layer .dvmo , #navigtd,#predictionDetails,#lp_salesSummaryDiv,.recommendationDetailUi").addClass("vH"),$("#navigtd,#predictionDetails,#lp_salesSummaryDiv,.recommendationDetailUi").hide(),$("#addTagListIcon").addClass("disable"),$("#existingTag .tagList span").hide(),$("#ApprovalProcess").hide(),$("#newRelDetails, #showhideDetailsDiv, #noteDetails, #remainingList, .calliconOuter, #BestTimeDetailsPage").hide(),$("#bestTimeDayDropDown, #bestTimeToolTip, #pb_processButtonLayer").hide(),$("#leftPanel #crmspanid").hide(),$L(".scorigRulesTable").hide(),"detail"==Lyte.Router.getRouteInstance().routeName&&$("#basic").addClass("peNone"),"Potentials"==$("#module").val()&&$("#stageContain").hide(),$("#leftPanel").append('<div id="baseOverlay" class="baseOverlay"></div>')}}detailView.refreshTimer=setTimeout((function(){detailView.refreshInWms&&(detailView.kafkaWFStatus="timer_refresh",detailView.callLyteRefresh(e))}),15e3,e)},isKafkaRefreshForActivitiesPage:function(e){var t=!1;if(isWFKafkaUser()&&detailView.refreshInWms){var i=Lyte.Router.getRouteInstance().transition.info.route;if("crm.tab.module.entity.detail"==i)t=!0;else{var a=window[e].currentStatus;detailView.refreshInWms="crm.tab.module.custom-view.kanban"==i||"crm.tab.module.entity.edit"==i||"crm.tab.module.entity.clone"==i||"edit"==a||"clone"==a,detailView.refreshInWms&&(commonUtils.showHideLoadingDiv(!1),detailView.hideElementsForKafkaWorkFlow(e),t=!0)}}return t},getStageValues:function(e){var t=returnJson.Potentials.fieldDependency?JSON.parse(returnJson.Potentials.fieldDependency):void 0,i=returnJson.entityMapJson.PIPELINE?returnJson.entityMapJson.PIPELINE.defaultvalue:"";if(!(returnJson.entityMapJson.PIPELINE&&t&&t.PIPELINE&&t.PIPELINE.STAGE&&t.PIPELINE.STAGE[i]))return returnJson.entityMapJson.PIPELINE&&t&&t.PIPELINE&&t.PIPELINE.STAGE&&(t.PIPELINE.STAGE[""===i?"-None-":i]=""===i?e.map((function(e){return e.html})):[returnJson.entityMapJson.STAGE.stageValue],returnJson.Potentials.fieldDependency=JSON.stringify(t),returnJson.Potentials.disableStageNavigator=""!==i),e;for(var a=[],n=e.length,s=returnJson.entityMapJson.STAGE.stageValue,r=0;r<n;r++){var o=e[r].value?e[r].value.indexOf(":"):-1,l=o>-1?e[r].value.substr(o+1):void 0;if(l){var d=t.PIPELINE.STAGE[i].indexOf(l);0!=a.length&&a[d]&&a[d].value.substr(a[d].value.indexOf(":")+1)===l||d>-1&&(a[d]=e[r])}}if(!t.PIPELINE.STAGE[i].contains(s)){var c=e.find((function(e){return s==e.value.substr(e.value.indexOf(":")+1)}));c&&a.push(c)}return a},converMinToHourAndMin:function(e){var t=[];if(!isNaN(e)||void 0!==e||0!==e){var i=e/60,a=Math.floor(i),n=60*(i-a),s=Math.round(n);t.push(a),t.push(s)}return t},constructDurationTxt:function(e,t){return e&&0!=e?1!==e||t&&0!==t?e>=1&&(!t||0===t)?I18n.getMsg("crm.service.duration.hrs",e):1===e&&t&&t>=0?1===t?I18n.getMsg("crm.service.duration.hour.minute",[e,t]):I18n.getMsg("crm.service.duration.hour.minutes",[e,t]):e>=1&&t&&t>=0?1===t?I18n.getMsg("crm.service.duration.hours.minute",[e,t]):I18n.getMsg("crm.service.duration.hours.minutes",[e,t]):void 0:I18n.getMsg("crm.service.duration.hr",e):1===t?I18n.getMsg("crm.service.duration.minute",t):I18n.getMsg("crm.service.duration.minutes",t)},setDetailViewNewLeftPanelProp:function(){var e=$("#dv-button-layer"),t=$("#newLeftPanel"),i=renderingUtils.getHeightFromTabLayer();if(i-=e.outerHeight(),t.removeClass("oH"),isChatEnabled||(i-=28),t.css("height",i).addClass("oH pR"),thirdPartyUtils.bindLyteScroll("#newLeftPanel",{preventHorizontal:!0}),Crm.userDetails.isRelatedListLyteEnabled){var a=$L("crm-related-list-view")[0];a&&a.component&&a.component.showViewPortRelatedLists()}},setDetailViewNewLeftPanelPropOnScroll:function(){var e=$("#dv-button-layer"),t=$("#newLeftPanel"),i=detailView.tabsLayerHeight;i-=e.outerHeight(),t.removeClass("oH"),t.css("height",i+32).addClass("oH pR"),thirdPartyUtils.bindLyteScroll("#newLeftPanel",{preventHorizontal:!0})},setDetailViewNewInfoDivProp:function(){var e=$("#dv-button-layer"),t=$("#dvinner"),i=$("#DetailViewInnerTabs"),a=($("#newLeftPanel"),$("#newInfoDiv")),n=renderingUtils.windowWidth,s=detailView.tabsLayerHeight,r=i.outerHeight(),o=e.outerHeight();if(i.is(":visible")?s-=o+r:s-=o,$(".showhideDetailpanelIcon").hasClass("fCollapseIn"))var l=n-260;else l=n;a.css("overflow","hidden"),t.css("overflow","hidden"),n<1040&&(l=1e3,a.css("overflow","auto")),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&(s-=10,$("#leftPanel").css("min-height","initial")),isChatEnabled||(s-=28),featuresAvailable.NEXTGENUI_ENABLED?t.css({width:n<1040?l:"auto",height:s,overflow:"auto","box-sizing":"border-box"}):t.css({width:l,height:s,overflow:"auto","box-sizing":"border-box"})},dataPrivacyHeight:function(){var e=$("#DetailViewInnerTabs"),t=e.offset().top+e.outerHeight()+60,i=renderingUtils.windowHeight-t;$("#dataPrivacyBodyElem").addClass("oA").css("height",i)},datatimeLineHeight:function(){if(!Crm.userDetails.timelineRevamp){var e=$("#DetailViewInnerTabs"),t=$("#timelineDiv"),i=e.offset().top+e.outerHeight()+60,a=renderingUtils.windowHeight-i;t.addClass("oA").css("height",a)}},dvtabBackAni:function(e){var t=$(e),i=t.width(),a=t.height();if(void 0!==t.position())t.position().left;var n=t.prevAll(".innertabsli"),s=$("#tabsInnerBackAni"),r=(t.find("a").text(),3);n.length&&n.each((function(){r=r+parseInt($(this).outerWidth(!0))+3})),0==r&&(r=3),$(".DetailViewInnerTabs").removeClass("dvtabsFixed"),Crm.userDetails.RTL_ENABLED?s.css({width:i,right:r,height:a}):s.css({width:i+2,left:r,height:a})},lastupdateChecking:function(){var e=$(".last-updated-status"),t=e.find(".bCardHover");e.hasClass("bCardHover")&&(t=e),0==t.length&&(t=e);var i=$(".last-updated");""!=t.text()&&""!=i.text()?e.addClass("enableBefore"):e.removeClass("enableBefore")},hideDetailviewMenu:function(e){var t=$(".leftnavEnable");if(t.length){var i=$(".eventActionsMenu");!t.length||1!=e&&0!=i.is(":visible")||(t.removeClass("leftnavEnable"),i.hide())}},btnAddClassSelected:function(e){detailView.btnRemoveClassSelected(),$(e).addClass("btnSelected")},btnRemoveClassSelected:function(){$(".btnSelected").removeClass("btnSelected")},atnAddClassSelected:function(e){$(e).addClass("atnSelected"),$(e).closest("tr").addClass("rowSelected")},atnRemoveClassSelected:function(e){$(".atnSelected").removeClass("atnSelected"),$(".rowSelected").removeClass("rowSelected"),$(".actSettings").removeClass("actSettings")},setCurrentStageSetOnChange:function(){detailView.setCurrentSelectStage()},setCurrentStageSetReload:function(){setTimeout((function(){detailView.setCurrentSelectStage()}),1e3)},setCurrentSelectStage:function(){var e=$(".lineStage"),t=$(".lineStage li.sliderActive").index(),i=e.find("li").length;if(e.length&&null!=e){var a=$(".sliderActive"),n=a.prevAll(),s=0;if(Crm.userDetails.RTL_ENABLED)if(t==i-1)e.animate({scrollLeft:0},1e3,(function(){detailView.navCheckenableReload()}));else{e.next("li");var r=e.scrollLeft(),o=a.offset().left;e.animate({scrollLeft:o+r-200},1e3,(function(){detailView.navCheckenableReload()}))}else n.length?(n.each((function(){s+=$(this).outerWidth(!0)})),e.animate({scrollLeft:s-a.outerWidth(!0)},1e3,(function(){detailView.navCheckenableReload()}))):e.animate({scrollLeft:0},1e3,(function(){detailView.navCheckenableReload()}))}},satgeSliderNextNavClick:function(){var e=$(".lineStage");if(e.length){var t=document.getElementById("lineStage").scrollWidth,i=e.scrollLeft(),a=e.width(),n=t-i-15,s=parseInt(e.width()/3),r=$(".prev-slider"),o=$(".next-slider");Crm.userDetails.RTL_ENABLED?r.css("pointer-events","none"):o.css("pointer-events","none"),n>a&&e.animate({scrollLeft:i+s},1e3,(function(){detailView.navCheckenableReload(),Crm.userDetails.RTL_ENABLED?r.css("pointer-events",""):o.css("pointer-events","")}))}},satgeSliderPrevNavClick:function(){var e=$(".lineStage");if(e.length){var t=e.scrollLeft();Crm.userDetails.RTL_ENABLED?$(".next-slider").css("pointer-events","none"):$(".prev-slider").css("pointer-events","none"),t>=0&&detailView.rtlCheckStageClick()}},navCheckenableReload:function(){var e=$(".lineStage");if(e.length){var t=document.getElementById("lineStage").scrollWidth,i=e.scrollLeft(),a=e.width(),n=t-i-15,s=$(".prev-slider"),r=$(".next-slider");i>0&&n>a?s.add(r).removeClass("disableslider"):i>0&&n<a?(s.removeClass("disableslider"),r.addClass("disableslider")):0===i&&n>a?(s.addClass("disableslider"),r.removeClass("disableslider")):0===i&&n<a?(Crm.userDetails.RTL_ENABLED,s.add(r).addClass("disableslider")):0!=i&&n>a&&s.add(r).removeClass("disableslider").css("pointer-events","")}},rtlCheckStageClick:function(){var e=$(".lineStage"),t=e.scrollLeft(),i=parseInt(e.width()/3);$("html").hasClass("firefox"),e.animate({scrollLeft:t-(i+350)},1e3,(function(){Crm.userDetails.RTL_ENABLED?$(".next-slider").css("pointer-events",""):$(".prev-slider").css("pointer-events",""),detailView.navCheckenableReload()}))},scrollToPos:function(e,t,i,a){var n=e.scrollTop,s=t-n,r=0,o=function(){r+=20;var t=detailView.easeInOutQuad(r,n,s,i);e.scrollTop=t,r<i&&setTimeout(o,20)};o(),a()},easeInOutQuad:function(e,t,i,a){return(e/=a/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},scrollDataProcessingPop:function(e){void 0===e&&(e=$("#reqOptionDetailview"));var t=$("#consentLawfuldetails"),i=renderingUtils.windowHeight,a=t.offset().top,n=$L("#dataPrivacyBodyElem"),s=t.outerHeight()+20;if(i-a<s){var r=s-(i-a),o=n.scrollTop()+r;o<0&&(o=0),t.addClass("dataProcessAnime"),detailView.scrollToPos(n[0],o,300,(function(){t.css({top:a-r}),setTimeout((function(){t.removeClass("dataProcessAnime")}),300)}))}},loadTimeLineDetailsOnScroll:function(e,t,i){if("timeline"===t){var a=document.querySelector("crm-timeline-history");if(a){var n=a.component;n&&n.executeMethod("loadTimelineOnScroll",e)}}else if("journey"===t){var s=document.querySelector("crm-journeys-all-view").component;s&&s.executeMethod("getJourneysOnScroll",e,i)}},navigateToTimeline:function(e){var t=$L("#timelineDiv"),i=$L(e).find(".tl_notesAddedFromTl,.tl_hasLog");if(void 0!==i){var a=i[0].getAttribute("id").split("_")[2],n=Lyte.Router.getRouteInstance().parent.getDynamicParam(),s="#timeline_"+a,r=i[0].getAttribute("token"),o=$("#newleft_History")[0];if(Crm.client_tracking("Timeline & Interactions -Timeline Entry Notes Click"),detailView.reRenderTimeline[0]=!0,$L(s).length>0){detailView.reRenderTimeline[0]=!1,detailView.switchTab(o,"Timeline");var l=document.querySelector("crm-timeline-history").component;"journey"===document.querySelector("crm-timeline-tab").component.data.currentTab&&$("#timelineSectionTab")[0].openTab("timeline"),l.scrollToTimelineLog(a)}else if(Lyte.Component.registeredComponents["crm-timeline-tab"]&&t.find("crm-timeline-tab").length>0)t.html(""),Lyte.Component.render("crm-timeline-tab",{token:r,navigationLogId:a,requestFromNotes:!0,"record-id":n,module:detailView.currentModule},"#timelineDiv"),detailView.switchTab(o,"Timeline");else{commonUtils.showHideLoadingDiv(!0);var d=detailView.getTimelineRelatedFiles();Lyte.injectResources(d,void 0,(function(){t.html(""),Lyte.Component.render("crm-timeline-tab",{token:r,navigationLogId:a,requestFromNotes:!0,"record-id":n,module:detailView.currentModule},"#timelineDiv"),detailView.switchTab(o,"Timeline")}))}}},renderTimeLineDetails:function(e){var t=$L("#timelineDiv");if(Lyte.Component.registeredComponents["crm-timeline-tab"]&&t.find("crm-timeline-tab").length>0){var i=document.querySelector("crm-timeline-tab").component,a=i.data.currentTab;if(i.setData("requestFromNotes",!1),detailView.reRenderTimeline[0]&&"timeline"===a)$("#tl_renderDiv").html(""),$("#jr_renderDiv").html(""),detailView.switchTab(e,"Timeline"),i.executeMethod("afterRender"),detailView.reRenderTimeline[0]=!1;else if(detailView.reRenderTimeline[1]&&"journey"===a){$("#jr_renderDiv").html(""),$("#tl_renderDiv").html(""),detailView.switchTab(e,"Timeline");var n={id:"journey"};i.executeMethod("onBeforeOpenTab",n),detailView.reRenderTimeline[1]=!1}else detailView.switchTab(e,"Timeline")}else{commonUtils.showHideLoadingDiv(!0);var s=detailView.getTimelineRelatedFiles();Lyte.injectResources(s,void 0,(function(){$L("#timelineDiv").html("");var t=Lyte.Router.getRouteInstance().parent.getDynamicParam();Lyte.Component.render("crm-timeline-tab",{module:detailView.currentModule,"record-id":t},"#timelineDiv"),detailView.switchTab(e,"Timeline"),crmInteraction.addLyteTabInteraction(document.querySelector("#timelineSectionTab"))}))}},getTimelineRelatedFiles:function(){var e=networkUtils.returnDependencyFiles(["crm-timelines.js","crm-timeline-helpers.js","lyte-dateselect.js","lyte-daterangepicker.js","crux-note.js","crm-permission-dropdown.js","lyte-sticky.js","lyte-hovercard.js","crm-setup-data.js","note_model.js","crm-ui-loaders.js","crm-notes-timeline.js","crm-notes.js","crm-converted-lead-timeline.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-permission-dropdown.css"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-timeline.css","crux-note.css","crm-ui-loaders.css","crm-converted-lead-timeline.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("timeline")],ResourceConstants.CRM),n=e.concat(t);return n=(n=n.concat(i)).concat(a)},converMinToHourAndMin:function(e){var t=[];if(!isNaN(e)||void 0!==e||0!==e){var i=e/60,a=Math.floor(i),n=60*(i-a),s=Math.round(n);t.push(a),t.push(s)}return t},constructDurationTxt:function(e,t){return e&&0!==e?1!==e||t&&0!==t?e>=1&&(!t||0===t)?I18n.getMsg("crm.service.duration.hours",e):1===e&&t&&t>=0?1===t?I18n.getMsg("crm.service.duration.hour.minute",[e,t]):I18n.getMsg("crm.service.duration.hour.minutes",[e,t]):e>=1&&t&&t>=0?1===t?I18n.getMsg("crm.service.duration.hours.minute",[e,t]):I18n.getMsg("crm.service.duration.hours.minutes",[e,t]):void 0:I18n.getMsg("crm.service.duration.hour",e):1===t?I18n.getMsg("crm.service.duration.minute",t):I18n.getMsg("crm.service.duration.minutes",t)},getMinDiffDays:function(e,t){var i=Math.abs(e.getTime()-t.getTime());return Math.floor(i/864e5)},populateDiffDays:function(e,t){var i=e.length,a=0,n=new Map;if(i>1)for(a=0;a<i;a++){if(a!==i-1){var s=detailView.getDateFromUTCFormat(e[a].audited_time),r=$L.moment(s).toDate(),o=detailView.getDateFromUTCFormat(e[a+1].audited_time),l=$L.moment(o).toDate();e[a].diff_days=detailView.getMinDiffDays(r,l),e[a].audited_time_formatted=I18n.getMsg(CrmDateUtils.convertDateToUserPattern(r,"MMM",!0))+" "+CrmDateUtils.convertDateToUserPattern(r,"D"),e[a+1].audited_time_formatted=I18n.getMsg(CrmDateUtils.convertDateToUserPattern(l,"MMM",!0))+" "+CrmDateUtils.convertDateToUserPattern(l,"D")}if("milestone"!==e[a].type){var d=0;n.has(e[a].medium)&&(d=n.get(e[a].medium)),n.set(e[a].medium,d+1)}if("milestone"===e[a].type||a===i-1){if(1!==e[a].id){var c={};c.duration=e[a].duration,c.total_count=0,c.medium_wise_count=[],t&&(t[a===i-1?Object.keys(t).length+1:e[a].id-1]=c)}n=new Map}}else if(i>0){s=detailView.getDateFromUTCFormat(e[a].audited_time),r=$L.moment(s).toDate();e[a].audited_time_formatted=I18n.getMsg(CrmDateUtils.convertDateToUserPattern(r,"MMM",!0))+" "+CrmDateUtils.convertDateToUserPattern(r,"D")}},getDateFromUTCFormat:function(e){return e.split("T")[0]+" "+e.split("T")[1].substr(0,8)},afterRenderMultilineField:function(e,t,i){var a,n=I18n.getMsg("crm.wf.summary.label.ShowInstantActions"),s=!0;if(t){a=e;var r=detailView.multilineJSON[t];r&&"less"===r&&(s=!1)}else a=$("pre.DV_textAreaLineClamp");i&&(a=e);for(var o,l=a.length,d=[],c=0;c<l;c++){var u=(o=a[c]).scrollHeight,m=o.offsetHeight,p=o.id;p=p.replace("subvalue_","mouseArea__");var v=detailView.multilineRender[t],g=!1;if(u>m&&!o.nextElementSibling&&(!v||u>v))g=!0;else if(o.nextElementSibling)d.push(o.nextElementSibling),u>v&&(g=!0);else if(u===m&&t&&u>126){n=I18n.getMsg("crm.wf.summary.label.HideInstantActions");var f='<a class="showMoreLink less" onclick="toggleTextArea(this,\''+p+"', "+!1+')">'+n+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-up-md-mask zcicn-cssIcons zcicn-rotate-180 zcicn_blue_mask eventNone'></span></a>";o.insertAdjacentHTML("afterend",f)}if(g&&o.textContent){f='<a class="showMoreLink more" onclick="toggleTextArea(this,\''+p+"', "+!0+')">'+n+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-down-md-mask zcicn-cssIcons zcicn_blue_mask eventNone'></span></a>";o.insertAdjacentHTML("afterend",f)}}var h=d.length;for(c=0;c<h;c++)d[c].remove();t&&setTimeout((function(){if(o){var e=$(o),i=o.scrollHeight,a=o.offsetHeight,s=detailView.multilineRender[t];if(o.textContent){if(s&&i>s){var r=e[0].nextElementSibling;if(r&&r.classList.contains("more"))s-=r.offsetHeight+11;else if(!r){var l='<a class="showMoreLink more" onclick="toggleTextArea(this,\''+p+"', "+!0+')">'+n+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-down-md-mask zcicn-cssIcons zcicn_blue_mask eventNone'></span></a>";o.insertAdjacentHTML("afterend",l)}e.addClass("DV_textAreaLineClamp"),e.css("height",s+"px")}else if(i>a&&s&&i<s&&!o.nextElementSibling){n=I18n.getMsg("crm.wf.summary.label.HideInstantActions");l='<a class="showMoreLink less" onclick="toggleTextArea(this,\''+p+"', "+!1+')">'+n+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-up-md-mask zcicn-cssIcons zcicn-rotate-180 zcicn_blue_mask eventNone'></span></a>";o.insertAdjacentHTML("afterend",l),e.css("height",i+"px")}}else e.css("height","18px")}}),20),s||a.removeClass("DV_textAreaLineClamp")},invokeClientScript:function(){try{if("undefined"!=typeof DetailViewHandler&&"crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route){detailView.restrictedLinks.forEach((e=>{DetailViewHandler.link_disable.call({id:e})}));for(const[e,t]of Object.entries(detailView.restrictedRelatedLists))DetailViewHandler.related_list_visibility.call({id:e,name:t,value:!1});for(const[e,t]of Object.entries(detailView.cscriptFieldAttribs))t.mask&&DetailViewHandler.field_mask.call({field_name:e,config:t.mask}),t.style&&DetailViewHandler.field_style_add.call({field_name:e,style_config:t.style}),t.maxLength&&DetailViewHandler.field_set_max_length.call({field_name:e,config:t.maxLength}),t.readOnly&&DetailViewHandler.field_set_read_only.call({field_name:e,value:t.readOnly}),(t.visible||!1===t.visible)&&DetailViewHandler.field_visibility.call({field_name:e,value:t.visible}),t.tooltip&&DetailViewHandler.field_tooltip_add.call({field_name:e,message:t.tooltip}),t.info&&DetailViewHandler.field_info_add.call({field_name:e,message:t.info}),t.criteria&&t.criteria.criteria&&DetailViewHandler.field_set_criteria.call({field_name:e,criteria:t.criteria.criteria,config:t.criteria.config});for(const[e,t]of Object.entries(detailView.cscriptButtonAttribs))t.isDisabled&&DetailViewHandler.button_disable.call({id:t.button_id,api_name:t.button_name}),t.label&&DetailViewHandler.button_set_value.call({id:t.button_id,api_name:t.button_name,value:t.label})}}catch(e){murphy.error(e)}},interceptSavePotentialSave:async function(){if(!CScriptLib)return savePotentialPopup("popup");var e=formValuesForClosedWonLost();if(!0===await CScript.Engine.Global.dispatchIEvent("onBeforeMandatoryFormSave",void 0,e))return savePotentialPopup("popup")}};function toggleTextArea(e,t,i){var a,n=e.previousSibling,s=n.id;s=s.replace("subvalue_","mouseArea__"),e.remove();var r=!0,o=n.scrollHeight,l=n.offsetHeight;i&&o<=l&&(r=!1);var d=$(n);if(i?(d.css("height",n.scrollHeight+"px"),n.classList.remove("DV_textAreaLineClamp"),a='<a class="showMoreLink less" onclick="toggleTextArea(this,\''+s+"',false)\">"+I18n.getMsg("crm.wf.summary.label.HideInstantActions")+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-up-md-mask zcicn-cssIcons zcicn-rotate-180 zcicn_blue_mask eventNone'></span></a>"):(n.classList.add("DV_textAreaLineClamp"),d.css("height",""),a='<a class="showMoreLink more" onclick="toggleTextArea(this,\''+s+"',true)\">"+I18n.getMsg("crm.wf.summary.label.ShowInstantActions")+"<span class='dIB vaM mL3 showMoreLinkIcon zcicn-arrow-solid-down-md-mask zcicn-cssIcons zcicn_blue_mask eventNone'></span></a>"),r&&n.insertAdjacentHTML("afterend",a),!i){var c=$L("#dvinner"),u=c.scrollTop()-d.height()+d.offset().top-200;c.scrollTop(u)}}function alertDeleteEntityImage(e,t,i,a){var n=$("#photoID").val(),s="undefined"!=typeof returnJson&&returnJson.layout_jsonarrayObj?returnJson.layout_jsonarrayObj.currLayoutId:null;("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck())&&(n=$L("#img_"+$L("#entityId")[0].value)[0].getAttribute("data-fileid"),s=Lyte.Router.getRouteInstance().currentModel.layoutId);"crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route&&Crm.renderDVLyteFlow(t)&&(s=Lyte.Router.getRouteInstance().currentModel.layoutId);var r,o=document.querySelector("#visionErrorChk"),l=!!o&&o.checked;if("crm.tab.module.create.canvas"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.entity.clone.canvas"===Lyte.Router.getRouteInstance().transition.info.route)r=t+"_"+e+"_photo",store.peekRecord(moduleRecordMapping[t].id,e).$.set("Record_Image",void 0),deleteEntityImage(r,t,!1);else if(""!==e&&void 0!==e)if("edit"===a){$(".lnPhoto").append($("<input>").attr({type:"hidden",name:"deleteEntityImage"}).val(n)),detailView.deletedEntityImgPhotoId=n,r=t+"_"+e+"_photo";var d=$("crm-create-entity");d&&d[0]&&d[0].setData("isRecordImgRemoved",!0),deleteEntityImage(r,t,!0)}else{var c=Crm.getCrmBasePath()+"/EntityImageAttach.do?actionName=deleteImage&action_module="+t+"&fileId="+n+"&entityId="+e+"&layoutId="+s+"&vision_validation_error="+l,u=csrfParamName+"="+encodeURIComponent(csrfToken);mR(c,(function(i){"true"==i&&deleteEntityImage(r=t+"_"+e+"_photo",t,!1)}),u)}else deleteEntityImage(r=t+"_photo",t,!0)}function getCreateAvatarUploadComp(){return $L("crm-create-avatarupload")[0]}function getDetailViewAvatarUploadComp(){return $L("crm-detail-view-avatarupload")[0]}function deleteEntityImage(e,t,i){$("#deletepopup").hide();var a,n=$L("#zv_confirmModal")[0];n&&n.ltProp("show",!1),$("#freezeBackGround").hide(),$("body").removeClass("oH");var s=$("img[id='"+e+"']");ResourceConstants.IMAGES.CRM;"Accounts"!==t?($("div[id='imgContainer']").addClass("dvemptyImgContainer emptyLCPhoto "),s.remove(),a=networkUtils.getImageUrl("user_profile_lightmode.svg",ResourceConstants.CRM)):($("div[id='imgContainer']").addClass("emptyAccLogo"),s.attr("src",networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM)),a=networkUtils.getImageUrl("companylogonew.svg",ResourceConstants.CRM));var r=$("<img>").attr("src",a).attr("id",e).attr("data-image-mode","true");if(i){$("#preHTMLContainer_"+t).find("#imgContainer").removeClass("dvemptyImgContainer").html(r);var o=$L("crm-create-layout#"+t+"LC_layoutNode")[0];o&&o.component.setData("recordImagePhotoId","")}else"Accounts"!==t?(getDetailViewAvatarUploadComp()&&getDetailViewAvatarUploadComp().component.setData("recordImage",null),detailView.createAvatar()):$("#detailViewButtonLayerMainTable").find("#imgContainer").removeClass("dvemptyImgContainer").html(r);null!=customViewObject&&customViewObject.isCustomizedView&&"Users"!=t&&"Org"!=t&&(getCreateAvatarUploadComp()||crmTab.deleteFromCache(t));if($("#imageSrc").val(a),$("#photoID").val(""),$(".lnPhoto").removeClass("lnUpPhotoHover").addClass("lnPhotoHover"),$(".photoUploadSec").removeAttr("id"),$L(".lnPhoto").removeClass("lnPhoto_ziaVision"),refreshFollowDiv(),i&&getCreateAvatarUploadComp()?getCreateAvatarUploadComp().component.executeMethod("syncLatestAvatar"):getDetailViewAvatarUploadComp()&&getDetailViewAvatarUploadComp().component.executeMethod("syncLatestAvatar"),crmTab.checkPresenceInCache(t)&&("canvas"===Lyte.Router.getRouteInstance().routeName&&delete crmTab.cacheObj[t],"detail"===Lyte.Router.getRouteInstance().routeName&&crmTab.deleteFromCache(t)),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck())for(var l=$L("#entityId")[0].value,d=document.querySelectorAll("#img_"+l),c=d.length,u=0;u<c;u++){d[u].setAttribute("data-fileid",null);var m=d[u].parentNode,p=Lyte.Router.getRouteInstance().currentModel&&Lyte.Router.getRouteInstance().currentModel.entityDetails&&Lyte.Router.getRouteInstance().currentModel.entityDetails.entityName[0],v=Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()&&"crm.tab.module.entity.edit.canvas"!==Lyte.Router.getRouteInstance().transition.info.route?networkUtils.getImageUrl("profile_image_canvas.svg",ResourceConstants.CRM):networkUtils.getImageUrl("image_profile_canvas_new.svg",ResourceConstants.CRM);d[u].setAttribute("src",v);var g=["linear-gradient(180deg, #CB92BA 0%, #C882A8 34.38%, #F7778C 76.64%, #D57391 86.95%, #AB6D97 100%)","linear-gradient(180deg, #2D99FF 0%, #DFDBC9 50.52%, #FF6A77 100%)","linear-gradient(180deg, #2D99FF 0%, #D78F78 50.52%, #FF7E31 81.77%, #FFA71B 100%)","linear-gradient(180deg, #0058A0 0%, #009CDB 50.52%, #0065A1 81.77%, #0596CE 100%)"],f=Math.floor(Math.random()*g.length);d[u].style["background-image"]=g[f];var h=document.createElement("span");h.classList.add("display_letter"),h.setAttribute("id","nonrellistProfileImage_canvas"),h.textContent=p;var C=m.lastElementChild;C.parentNode.insertBefore(h,C.nextSibling),document.getElementById("previewPhoto_crm-csript").remove()}}function checkOptionsForImage(e,t,i){var a=$("#photoID").val(),n=$("#imageSrc").val();if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()&&t){var s=$L("#img_"+t);a=s[0].getAttribute("data-fileid"),n=s[0].getAttribute("src"),!store.peekRecord(moduleRecordMapping[e].id,t).$.isNew||n!==networkUtils.getImageUrl("profile_image_canvas.svg",ResourceConstants.CRM)&&n!==networkUtils.getImageUrl("image_profile_canvas_new.svg",ResourceConstants.CRM)||(n="",t=void 0)}var r=ResourceConstants.CRM;return""!==a&&null!==a&&"null"!==a||""!==n&&null!==n&&"null"!==n&&n!==networkUtils.getImageUrl("companylogonew.svg",r)&&n!==networkUtils.getImageUrl("user_profile_lightmode.svg",r)&&n!==networkUtils.getImageUrl("image_pholder_lightmode.svg",r)&&n!==networkUtils.getImageUrl("nophoto.png",r)&&n!==networkUtils.getImageUrl("image_profile_canvas_new.svg",r)?($(".profOptionList").removeClass("dN").show(),!0):(showUploadPhoto(e,t,i),!1)}function previewPhoto(e){var t=$("#imageSrc").val(),i=$("#photoID").val();if(e){var a=$L('crm-detail-view-avatarupload[entity-id="'+e+'"]');t=a.find("#imageSrc").val(),i=a.find("#photoID").val()}if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route||Lyte.registeredMixins["crm-detailcanvas-utils"]&&Lyte.registeredMixins["crm-detailcanvas-utils"].isFormViewCommonCheck()){e||(e=$L("#entityId")[0].value);var n=$L("#img_"+e);i=n[0].getAttribute("data-fileid"),t=n[0].getAttribute("src")}var s=ResourceConstants.CRM;""!==t&&null!==t&&"null"!==t&&t!==networkUtils.getImageUrl("companylogonew.svg",s)&&t!==networkUtils.getImageUrl("user_profile_lightmode.svg",s)&&t!==networkUtils.getImageUrl("image_pholder_lightmode.svg",s)&&t!==networkUtils.getImageUrl("nophoto.png",s)&&t!==networkUtils.getImageUrl("profile_image_canvas.svg",s)&&(!$("#profileImagePreviewDiv"+i)+t.length&&$("body").append(renderingUtils.createHTML({name:"a",attr:{id:"profileImagePreviewDiv"+i,name:"profileImagePreviewDiv",class:"cboxElement",href:t}})),$("#profileImagePreviewDiv"+i).colorbox({photo:!0,href:t+"&downLoadMode=true",onClosed:function(){$("html, body").scrollTop(0)}}),$("#profileImagePreviewDiv"+i).trigger("click"),$(".profOptionList").addClass("dN"))}function changeUsersToCreatorViews(e){var t=e+"_selectUsers",a=e+"_chkBox",n=getObj(t).selectedIndex,s=getObj(t).options[n].value;if("allUsers"==s){if(null==getObj(a).length){var r=getObj(a).value+"_"+e;getObj(r).style.display="block"}for(i=0;i<getObj(a).length;i++){r=getObj(a)[i].value+"_"+e;getObj(r).style.display="block"}}else if("selectedUsers"==s){if(null==getObj(a).length)if(getObj(a).checked){r=getObj(a).value+"_"+e;getObj(r).style.display="block"}else{var r=getObj(a).value+"_"+e;getObj(r).style.display="none"}for(i=0;i<getObj(a).length;i++)if(getObj(a)[i].checked){r=getObj(a)[i].value+"_"+e;getObj(r).style.display="block"}else{r=getObj(a)[i].value+"_"+e;getObj(r).style.display="none"}}else if("nonSelectedUsers"==s){if(null==getObj(a).length)if(getObj(a).checked){r=getObj(a).value+"_"+e;getObj(r).style.display="none"}else{r=getObj(a).value+"_"+e;getObj(r).style.display="block"}for(i=0;i<getObj(a).length;i++)if(getObj(a)[i].checked){r=getObj(a)[i].value+"_"+e;getObj(r).style.display="none"}else{r=getObj(a)[i].value+"_"+e;getObj(r).style.display="block"}}}function showDVAction(e){$("#fromTaskPage").length?$("#fromTaskPage").find("#rp_parent").show():$("#rp_parent").show(),$("#timeLineContainerDV").hide(),$(".tb_newmenu a").removeClass("sel"),$(e).addClass("sel")}function showSendMail(e){var t,i,a,n,s="";if(e&&$(e).attr("data-params")){var r=JSON.parse($(e).attr("data-params"));i=r.id,a=r.module;s="null"!==r.relatedContactId?r.relatedContactId:"";if((t=$("#relatedList_"+i).text())&&""!=t||(t=$("#listView_"+i).text()),"Contacts"===$("#module").val()){var o=$("#subvalue_EMAIL").text();n=$("#entityName").val()}else if($("#relatedDetails_"+s).length){var l=$("#relatedDetails_"+s);o="Not Given"===(o=l.attr("data-mailId"))?"":o,n=l.text()}else $("#viewEntityCI_"+s).length&&(n=$("#viewEntityCI_"+s).text(),o=$("#rpContInfo").find("#relContEmail").text())}else if(Crm.renderDVLyteFlow()){var d=$L("crm-detail-view")[0].component.data,c=d.fresh_record.Contact_Name,u=store.peekRecord(moduleRecordMapping.Contacts.id,c.id),m=u;s=c.id,n=c.name;var p=d.record;t=p.Subject,a=$detailsViewDetails.module,i=p.id,void 0===u?(u=store.findRecord(moduleRecordMapping.Contacts.id,c.id)).then((function(e){e&&e.length>0&&(o=e[0].Email)})):(s=m.id,n=m.Full_Name,o=m.Email)}else{detailView.changedBCJson.relContId&&"null"!=detailView.changedBCJson.relContId&&(s=detailView.changedBCJson.relContId,n=detailView.changedBCJson.relContName,o=detailView.changedBCJson.relContEmail);var v=$("#displayColName").val();t=$("#subvalue_"+v).text().trim(),a=$("#module").val(),i=$("#id").val()}if(""==s||"null"==s||isEmailValidInAssocCont(n,null,o,"Contacts")){null!=store.peekRecord("emails_rl_user","shared_users_"+i)&&store.deleteRecord("emails_rl_user","emails_"+i);var g=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(i)+"&module="+encodeURIComponent(a)+"&contactNameId="+encodeURIComponent(s)+"&flag=false&fileName="+encodeURIComponent(t)+"&action=sendMail";g=networkUtils.getPortalURL(g),adjustScreenAndOpen(g,a)}}function showDivMailOpt(e){var t=getObj("dropDownMailCnt"),i=t.style.top,a=$("#dropDownMailCnt"),n=$("#customizedd");if(Crm.userDetails.RTL_ENABLED){var s="";n.length&&(s=n.outerWidth()),a.css({left:s,right:"initial"})}a.css("top",i-70),t.style.display="block",t.style.position="absolute"}function mailoption(e){var t=$("#dropDownMailCnt");t&&t.length>0&&t.hide();var i=$("#id").val(),a=detailView.changedBCJson.hidden.displayColName,n=$("#value_"+a).length>0?$("#value_"+a).text().trim():"",s=getObj("module").value,r=returnJson.entityMapJson.CONTACTID?returnJson.entityMapJson.CONTACTID.defaultid:"";"null"==r&&(r="");var o=returnJson.entityMapJson.VENDORID?returnJson.entityMapJson.VENDORID.defaultid:"";"null"==o&&(o="");var l=document.getElementById("customizedd");if(l&&(l.style.display="none"),"ContactMailList"==e){if(""!=r&&"null"!=r&&!isEmailValidInAssocCont(getObj("associatedContName"),getObj("associatedContEmail")))return;var d=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(i)+"&module="+encodeURIComponent(s)+"&contactNameId="+encodeURIComponent(r)+"&vendorId="+encodeURIComponent(o)+"&flag=false&fileName="+encodeURIComponent(n)+"&action=sendMail";adjustScreenAndOpen(d)}else{d=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(i)+"&module="+encodeURIComponent(s)+"&contactNameId="+encodeURIComponent(r)+"&vendorId="+encodeURIComponent(o)+"&flag=true&fileName="+encodeURIComponent(n)+"&action=sendMail";adjustScreenAndOpen(d)}}function showMacroWithDelay(e,t,i,a,n,s,r,o,l,d,c){if(""!=$("#divMacro").html()&&$("#divMacro").html()!=I18n.getMsg("crm.load")+"...")$("#divMacro").show();else{macroDivStatus=!0;var u=$("#customizedd").offset().left,m=$L(window).scrollTop(),p=$("#divMacro").width(),v=$("#cutomizeMacroLink").offset().top;$("#divMacro").html(I18n.getMsg("crm.load")+"..."),$("#divMacro").css({"font-size":"small",position:"absolute",display:"block",top:v-m+"px",left:u-p+"px"}),CLEAR_INTERVAL_ID=setTimeout((function(){showMacroOptions(e,t,i,a,n,s,r,o,l,d,c)}),500)}}function showMacroOptions(e,t,i,a,n,s,r,o,l,d,c){return Macro.showMacroOptions(e,t,i,a,n,s,r,o,l,d,c)}function cancelPotentialPopup(e){if("crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route)return crmListView.updateStageError(crmListView.haltStateParams.curStageId,crmListView.haltStateParams.prevStageId),hideAnimatePopup("subSecondaryPopup",!0),void renderingUtils.removeFreezeLayer();e||hideAnimatePopup("subSecondaryPopup",!0);var t=$($("#value_STAGE")[0]).text()||$($("#subvalue_STAGE")[0]).text();t=t.trim();var i=returnJson.entityMapJson.STAGE.val.filter((function(e){if(e.content===t)return e})),a=t;i.length&&(a=i[0].pbty+":"+t),$("#potclosedv").val(a).trigger("change.select2"),$("#stageContain").find('li[data-value="'+a+'"]').trigger("click"),setProbabilityInAjaxEdit(a),"crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route&&Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent(),CFRExec&&(CFRExec.relatedEntityMap={},CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0)),delete Crm.VR}function showConvertQuoteMenu(e,t){t?$("#dropDownMenuCnt").css({left:"0px",display:"block",top:"32px",position:"absolute"}):$("#dropDownMenuCnt").css({left:renderingUtils.findPosX(e)+"px",display:"block",top:renderingUtils.findPosY(e)+e.offsetHeight+"px",position:"fixed"})}function createFollowUpTask(){quickTask.init();var e=returnJson.entityMapJson.CONTACTID?returnJson.entityMapJson.CONTACTID.defaultid:void 0,t=returnJson.entityMapJson.CONTACTID?returnJson.entityMapJson.CONTACTID.lookupmodule:void 0,i=returnJson.entityMapJson.SEID?returnJson.entityMapJson.SEID.defaultid:void 0,a=returnJson.entityMapJson.SEID?returnJson.entityMapJson.SEID.lookupmodule:void 0,n=Crm.getCrmBasePath()+"/QCreate.do",s={module:"Tasks"};s.id=s.entityid="null"!==e?e:void 0,s.relmodule=s.primmodule="null"!==t?t:void 0,s.fromCreate="QuickCreate",s.isFollowupTask=!0,"null"!==i&&e!==i&&(s.mode="followUpDV",s.modsel=a,s.modid=i,s.modname=returnJson.entityMapJson.SEID?returnJson.entityMapJson.SEID.defaultvalue:void 0),networkUtils.setCsrfParam(s),mR(n,(function(e){if(-1!=e.indexOf("Permission denied"))renderingUtils.displayPermissionDenied();else{Q.loadResponse(e);$("#completedTask")[0];var t=$("#followup").offset();$("#qCreate").show().css({top:t.top-30,left:t.left-($("#qCreate").width()+10)}),renderingUtils.freezeBackground(),$("#FreezeLayer").css("opacity",".1"),renderingUtils.ShakeDivInfreeze("qCreate","left",20,100)}}),s)}function createRLFromLeftPanel(e,t){var i=$(".atch-droplist");$(".leftnavEnable").removeClass("leftnavEnable"),"newleft_History"===$("#detailViewTabs").find("li.sel").attr("id")&&detailView.switchTab(void 0,"Info");var a=$("div[ddid="+e+"]"),n=a.attr("ddname"),s=!("APPOINTMENTSPERSONALITY"!==n||"Services"!==module.value&&Crm.isActivitySplitDone)||void 0;if(!a.length&&Crm.userDetails.isRelatedListLyteEnabled){var r=store.peekRecord("related_list",e);n=r?r.personality_name:""}if("ACTIVITYPERSONALITY"==n||"ATTACHMENTSPERSONALITY"==n){Crm.menu.hideMenu();var o=$("#options_"+e).css("z-index",300),l={};if(l.id="options_"+e,l.clickSelector="a","ACTIVITYPERSONALITY"!==n&&Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality(n,s))Crm.menu.createMenu(t,l);else{l.hideOnMenuClick=!1,l.setDefaultPos=!1,Crm.menu.createMenu(t,l);var d=$(renderingUtils.getTargetElem(t)),c=$("#dv-button-layer"),u=d.offset(),m=d.position(),p=u.top;if(c.length){var v=c.outerHeight(),g=40,f=0;"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&(f=35),g-=f,($("#zbModuleTabLayer").is(":visible")||$("#zohoExpenseTabLayer").is(":visible"))&&(g=80-f),p-=v+g}m.left=m.left+d[0].offsetWidth,renderingUtils.windowWidth<$(o).width()+m.left&&(m.left=m.left+d[0].offsetWidth),o.css({position:"absolute",display:"none",top:p+"px",left:m.left+"px"}),o.bind("onBeforeClose",(function(e,t){}))}}else if(Lyte.registeredMixins["crm-related-list-utils"].isNotActivitySubPersonality(n,s))if("SUPPORTPERSONALITY"==n){var h=document.querySelector("crm-zdesk-rl-body").component;h.actions.showCreateTicketPopup.call(h)}else if("SERIESPERSONALITY"===n)Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].addSeries(Lyte.Globals.get("relatedList.module")):crmRelatedList.addSeries(crmRelatedList.Module);else if("CHILDCAMPAIGNSPERSONALITY"==n){var C=t.target;$(C).data("relid",e),CustomView.showCampSubMenu(C,"leftPanelRLCreate")}else if(isnewCalendarBookingEnabled&&"CALENDARBOOKINGSPERSONALITY"===n)Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.calendar-booking.create-calendar-booking",queryParams:{module:moduleApiMapping.Appointments,type:"team"}}).data={from:"serviceRelatedList",serviceId:crmRelatedList.EntityId};else{var w=a.find(".dummyForLeftPanel").length;a.find(".dummyForLeftPanel")[w-1].click()}else{var y=$L("crm-activity-rel-actions")[0];if(y){var _=(d=$(renderingUtils.getTargetElem(t)))[0].getAttribute("id");"openActPop"===y.component.getData("open-act-pop-key")?(y.setData("showPopover",!1),setTimeout((function(){y.setData("originElem","[id='"+_+"']"),y.setData("closeOnBodyClick",!0),y.setData("showPopover",!0)}),450)):(y.setData("originElem","[id='"+_+"']"),y.setData("closeOnBodyClick",!0),y.setData("showPopover",!0))}}$("#newleft_"+e).addClass("leftnavEnable"),$(i).is(":visible")&&i.hide(),renderingUtils.stopEvent(t)}function exportPDF(e,t,i){if(!e&&i&&$(i).attr("data-params")){var a=JSON.parse($(i).attr("data-params"));e=a.module,t=a.id}var n=Crm.getCrmBasePath()+"/tab/"+e+"/"+t+"/export-pdf?flag=false&module="+e;adjustScreenAndOpen(n,e)}function getRelatedEntitiesDetails(e,t,i,a,n){var s="relEntDetailsTab_"+t+"_"+a+"_"+i,r="relEntDetailsDiv_"+t+"_"+a+"_"+i,o="moreLink_"+t+"_"+a+"_"+i;if(!n&&$("#"+r).length>0)$("#relEntDetailsContainerDiv").children().hide(),$("#relEntDetailsContainerDiv").show(),$("#"+r).show();else if(http){var l="module="+e+"&id="+t+"&action=getDetails&requestedModule="+a+"&type="+i+"&fromIndex="+(n=n||1),d=Crm.getCrmBasePath()+"/RelatedEntity.do";http.open("POST",d,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){var l=http.responseText,d=JSON.parse(l),c=(0,Handlebars.templates.RelatedEntitiesDetails)(d);if($("#relEntDetailsContainerDiv").children().hide(),$("#relEntDetailsContainerDiv").show(),1===n){var u=a===i?a:a+"-"+i;$("#relEntDetailsContainerDiv").append("<div id="+r+' class="pR newStyleAct"><div class="largeClose svgIcons ico-close op8 cP hide" onclick=showHideNew("relEntDetailsContainerDiv");showHideNew("'+r+'")></div><div class="darkSecHead hide">'+u+'</div><div class="maxH550 oA"><span class="arrowUpAct"></span><table id='+s+' class="newStyleAct newtable pR">'+c+"</table></div></div>")}else $(c).appendTo("#"+s);if($("#"+r).show(),d.body.length>=10){$("#"+o).remove();var m='<div id="'+o+'" class="aligncenter hotlink cP" onclick=getRelatedEntitiesDetails("'+e+'","'+t+'","'+i+'","'+a+'",'+(n+10)+")>show more..</div>";$("#"+r).append(m)}else $("#"+o).remove()}},http.send(l)}return!1}function checkCompetitorSplChars(e,t,i){var a=getClrTxtPtnResChars(e,/[^~`#%^&*()+={}[\]|\;"<>\\]/g).join(", ");return""===a||("competitorname"===t?renderingUtils.displayErrorDiv(t,void 0,I18n.getMsg("crm.competitor.name.splchar.error",a),i):"strenghts"===t?renderingUtils.displayErrorDiv(t,void 0,I18n.getMsg("crm.strengths.name.splchar.error",a),i):"weaknesses"===t&&renderingUtils.displayErrorDiv(t,void 0,I18n.getMsg("crm.weakness.name.splchar.error",a),i),!1)}function removeCompetitorErrorMsg(e,t){var i=document.getElementById(e);i&&(i.remove(),$(t).closest("tr").removeClass("form_err_fld"))}function competitorInputValidator(e){if(""!==e.value)return checkCompetitorSplChars(e.value,e.name,e)}function saveCompetitorValidate(e,t){var i=$("#create_competitor").find(".errorMsgDesc");if(i.closest(".errorFieldP").removeClass("errorFieldP"),i.remove(),pageValidate(void 0,"inline")){var a=document.getElementsByName("competitorname")[0],n=document.getElementsByName("strenghts")[0],s=document.getElementsByName("weaknesses")[0],r=/[~^`#%^&*()+={}[\]|\;"<>\\]/g;if(r.test(a.value))return competitorInputValidator(a);if(removeCompetitorErrorMsg("displayContent_competitorname",a),r.test(n.value))return competitorInputValidator(n);if(removeCompetitorErrorMsg("displayContent_strenghts",n),r.test(s.value))return competitorInputValidator(s);if(removeCompetitorErrorMsg("displayContent_weaknesses",s),n&&n.value.length>250)return commonUtils.showErrorMsg(e,$(n)),!1;if(s&&s.value.length>250)return commonUtils.showErrorMsg(t,$(s)),!1;var o=getObj("fieldname"),l=getObj("fieldlabel"),d=getObj("fielddatatype");o.parentNode.removeChild(o),l.parentNode.removeChild(l),d.parentNode.removeChild(d),hideAnimatePopup("topBandPopup",!0);var c=commonUtils.formData2QueryString(document.CreateCompetitorForm);$(document.CreateCompetitorForm).find('input[name="returnAnchor"]').value;mR(document.CreateCompetitorForm.action,(function(e){var t=$('div[ddname="COMPETITORSPERSONALITY"]').attr("ddid");"PERMISSION_DENIED"===JSON.parse(e).STATUS&&crmui.showMsgBand("error",I18n.getMsg("crm.security.permission.denied"),5e3),e&&t&&!Crm.userDetails.isRelatedListLyteEnabled&&crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e),Lyte.triggerEvent("relatedList",{res:e}),showDrillDownPtr("competitorspersonality_"+t)}),c)}return!1}function closePotentialFromDV(e,t,i){var a=$("crm-stage-detailview");if(!$("#stageContain").hasClass("disableNavigator")){if("crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route&&(detailView.changedBCJson&&detailView.changedBCJson.hidden&&!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"false"===String(allowEditProf)))return void(a.length>0&&Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent());$("#potclosedv").find("option[value='"+$.escapeSelector(e)+"']").prop("selected",!0);var n=$("#Crm_Potentials_STAGE");if($("#multipleFieldsEditPop").is(":visible")&&0==n.length&&"Deals"!=detailView.currentModule&&"Potentials"!=detailView.currentModule)return;n.find("option[value='"+$.escapeSelector(e)+"']").prop("selected",!0);var s=e.indexOf(":"),r=e.substring(s+1),o=e.substr(0,s);if("edit"===t){(u={}).notespermission=(Crm.userDetails.permissions.Crm_Implied_Create_Notes||!1)+"",u.shownotes="Closed Lost"===n.find("option:selected").attr("data-fctype")||"",u.colorcode_enabled=n.data("colorcode_enabled"),u.url=Crm.getCrmBasePath()+"/settings/modules/Potentials/layouts/"+returnJson.layout_jsonarrayObj.currLayoutId,u.dateMsg=I18n.getMsg("December")+" 1, 2022";var l=Handlebars.templates.PotentialClose(u);if($("#subSecondaryPopup").html(l),showAnimatePopup("subSecondaryPopup"),"edit"===t&&$("#subSecondaryPopup").find("#savePotentialspopup").removeAttr("onclick").click((function(){var e=$("#potclosenotes").val();e&&(Crm.requestParam.description=e),Crm.requestParam.subject=r,Crm.requestParam.type="CloseFromEdit";var t=$("#savePotentialsBtn");t.attr("onclick","crmTemplate.handleButtonClick(event,this,true)"),renderingUtils.triggerEvent("click",t),hideAnimatePopup("subSecondaryPopup",!0)})),n.data("colorcode_enabled")){var d=n.data("colorcode");$("#potentialClose_stagecolor").css("background-color",d),$("#stageVal_div").addClass("colorEnabledPicklist")}return void $("#temp_stageVal").text(r)}if(returnJson.entityMapJson.STAGE.val instanceof Array?actStage=returnJson.entityMapJson.STAGE.val.filter((function(e){if(e.content===r)return a.length&&(document.getElementById("stageWonDropdownLyte").ltProp("show",!1),document.getElementById("stageLostDropdownLyte").ltProp("show",!1)),e})):actStage=returnJson.entityMapJson.STAGE.val,!actStage.length)return;if($($("#value_STAGE")[0]).text()&&$($("#value_STAGE")[0]).text().trim()===r)return;if("-None-"===actStage[0].content)return void alert(I18n.getMsg("crm.stage.empty"));if("Closed Won"!==actStage[0].fctype&&"Closed Lost"!==actStage[0].fctype)return new Promise((function(t){t(savePotentialPopup("DV",void 0,void 0,e))}));if("kanbanview"!==t&&a.length>0&&(document.getElementById("stageMenuDropdownLyte").ltProp("show",!1),document.getElementById("stageWonDropdownLyte").ltProp("show",!1),document.getElementById("stageLostDropdownLyte").ltProp("show",!1)),$("#subSecondaryPopup").find("#closedWon:visible").length){var c=$("#subSecondaryPopup").find("#closedWon");return void("0"===o?c.find("#potnotesdiv").show():c.find("#potnotesdiv").hide())}var u={},m=$("#mouseArea__AMOUNT"),p=$("#mouseArea__CLOSINGDATE"),v=$("#mouseArea__REASON_FOR_LOSS");u.showamount=returnJson.entityMapJson.AMOUNT?"true":"false",u.showdate=returnJson.entityMapJson.CLOSINGDATE?"true":"false",u.dateMsg=I18n.getMsg("December")+" 30, 2022",u.showreasonForLoss=returnJson.entityMapJson.REASON_FOR_LOSS&&"Closed Lost"===actStage[0].fctype?"true":"false",u.userDetailRFL=Crm.userDetails.ReasonForLoss,u.showNote="false",u.url=Crm.getCrmBasePath()+"/settings/modules/Potentials/layouts/"+returnJson.layout_jsonarrayObj.currLayoutId,Crm.userDetails.rflNote&&!Crm.userDetails.ReasonForLoss&&"Closed Lost"===actStage[0].fctype&&(u.showNote="true"),"false"!==u.showreasonForLoss||Crm.userDetails.ReasonForLoss||(u.notespermission="true",u.shownotes=("Closed Lost"===actStage[0].fctype)+"","kanbanview"!==t?u.notespermission=(businessCardJson.userInRole.notesPermission||!1)+"":"kanbanview"===t&&(u.notespermission=(Crm.userDetails.permissions.Crm_Implied_Create_Notes||!1)+""));l=Handlebars.templates.PotentialClose(u);$("#subSecondaryPopup").html(l),$("#freezeBackGround,#subSecondaryPopup").attr("onclick","hideMenu()"),showAnimatePopup("subSecondaryPopup");var g,f,h,C=returnJson;if(C.module="Potentials","true"===u.showamount){var w=m.data("params");C.currentField=w,w&&(w.defaultvalue=w.plainValue?w.plainValue:w.defaultvalue,g=w.defaultvalue),C.currentField="kanbanview"===t?returnJson.entityMapJson.AMOUNT:C.currentField;var y=crmTemplate.createFieldRow(1,"Potentials",void 0,C.currentField,C,!0);detailView.makeStageFieldsLocked(y,C.currentField.fieldid),$("#temp_amount").replaceWith(y)}if("true"===u.showdate){var _=p.data("params");C.currentField=_,_&&(f=_.defaultvalue),C.currentField="kanbanview"===t?returnJson.entityMapJson.CLOSINGDATE:C.currentField;var b=crmTemplate.createFieldRow(1,"Potentials",void 0,C.currentField,C,!0);detailView.makeStageFieldsLocked(b,C.currentField.fieldid),$("#temp_date").replaceWith(b)}if("true"===u.showreasonForLoss){var I=v.data("params");C.currentField=I,I&&(I.defaultvalue=I.plainValue?I.plainValue:I.defaultvalue,h=I.defaultvalue),C.currentField="kanbanview"===t?returnJson.entityMapJson.REASON_FOR_LOSS:C.currentField;var T=crmTemplate.createFieldRow(1,"Potentials",void 0,C.currentField,C,!0);detailView.makeStageFieldsLocked(T,C.currentField.fieldid),$("#temp_rfl").replaceWith(T),$L("#Crm_Potentials_REASON_FOR_LOSS").removeClass("selNone")}var L=$("#mouseArea__STAGE");C.currentField=L.data("params"),C.currentField="kanbanview"===t?returnJson.entityMapJson.STAGE:C.currentField;var D=crmTemplate.createFieldRow(1,"Potentials",void 0,C.currentField,C,!0);$(D).find(".labelValCreate").addClass("disabled eventNone"),detailView.makeStageFieldsLocked(D,C.currentField.fieldid),$("#temp_stage").replaceWith(D);var E=$("#closedWon").find("#Crm_Potentials_STAGE");E.addClass("fromPopup"),$("#closedWon").find(".newCustSel").removeClass("newCustSel").addClass("newChosenSel"),$("#closedWon").find(".newCustSelVal").remove();var R=$("#closedWon #Crm_Potentials_STAGE").val();if(R!=e){var A=$([]),M=$(document.createElement("option"));A=A.add(M.clone().attr("value",e).prop("text",Crm.getDealsStageValue(e))),$("#closedWon #Crm_Potentials_STAGE").append(A)}if(!0===E.data("colorcode_enabled")){var S=E.parent().parent();if(S.addClass("colorEnabledPicklist"),"-None-"===R||""===R?S.addClass("colorEnabledPKNone"):S.removeClass("colorEnabledPKNone"),R!==e){var V=getPickListColorCode(Crm.getDealsStageValue(e),C.currentField.val,!0);S.find(".activitesColor").css("background-color",V)}}if($("#closedWon #Crm_Potentials_STAGE").val(e),thirdPartyUtils.bindSelect2("#closedWon #Crm_Potentials_STAGE"),$("#subSecondaryPopup .fieldsContainer .labelTabCreate").addClass("columnCal1"),select2ChangesInFields("#subSecondaryPopup"),"true"===u.showdate){p=$("#closedWon #Crm_Potentials_CLOSINGDATE");var N=new Date;N.setHours(0,0,0,0),p.data("dateObj",N),crmTemplate.bindEventsToDateField.call(p)}if(0==n.length&&(n=$("#Crm_Potentials_STAGE")),n.attr("disabled","disabled"),C[C.module].fieldDependency="kanbanview"===t?returnJson[C.module].fieldDependency:C[C.module].fieldDependency,C[C.module].fieldDependency&&(Crm.fieldDependency[C.module]=JSON.parse(C[C.module].fieldDependency)),crmTemplate.setDependentFields(C.module,"view",void 0,!0),i&&renderingUtils.triggerEvent("change",n),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Potentials"))&&CFRExec&&(CFRExec.valChangesNeedsLayoutRuleEval("STAGE")&&CFRExec.evalAjaxEditForLayoutRule("Potentials","STAGE",e,!0),"true"===u.showamount&&CFRExec.valChangesNeedsLayoutRuleEval("AMOUNT")&&CFRExec.evalAjaxEditForLayoutRule("Potentials","AMOUNT",g,!0),"true"===u.showdate&&CFRExec.valChangesNeedsLayoutRuleEval("CLOSINGDATE")&&CFRExec.evalAjaxEditForLayoutRule("Potentials","CLOSINGDATE",f,!0),"true"===u.showreasonForLoss&&CFRExec.valChangesNeedsLayoutRuleEval("REASON_FOR_LOSS")&&CFRExec.evalAjaxEditForLayoutRule("Potentials","REASON_FOR_LOSS",h,!0),CScriptLib&&"undefined"!=typeof DetailViewHandler)){var P=formValuesForClosedWonLost();CScript.Engine.Global.dispatchForcedEvent("onMandatoryFormLoad",void 0,P)}$("#subSecondaryPopup .fieldsContainer .labelTabCreate").addClass("columnCal1"),renderingUtils.labelWidthFixed("","subSecondaryPopup"),sE()}}function formValuesForClosedWonLost(){var e={};return $L("#closedWon").find("[cscript-tag]:not(option)").each(((t,i)=>{var a=$L(i).attr("cscript-tag");a.startsWith("__")||(e[a]=DetailViewHandler.mandatory_form_read(a))})),e}function savePotentialPopup(e,t,i,a){commonUtils.setErrVerifyContHeightToParent(!1,!1,!0);var n=$("#potclosestage").val(),s=returnJson.Potentials.entityid,r=$("#potclosenotes").val(),o="/crm/v2/",l=!1,d=!1;if("crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route&&(d=!0),"DV"===e){n=a||$("#potclosedv").val();var c=$("#mouseArea__STAGE").data("params"),u={};u.fieldValue=n,u.module="Potentials",u.fieldLabel=c.label,u.moduleid=s,u.uitype=c.uitype,u.tableName="undefined",u.columnName=c.colname;var m=[c.colname],p=!1;if(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Potentials")){p=!0,Crm.VR||(Crm.VR={}),Crm.VR.entityDetails=returnJson?objectUtils.cloneObject(returnJson):returnJson,Crm.VR.ajaxEditFieldLabel="STAGE";var v=n;v.indexOf(":")>-1&&(v=Crm.getDealsStageValue(v)),CVRExec.storeStageValue(v);var g=u;g.check={type:"DetailStageView",from:"DetailStageView",module:"Potentials",id:s},networkUtils.setCsrfParam(g),CVRExec.storeCachedParams(g)}if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Potentials")){if(CFRExec&&CFRExec.evalAjaxEditForLayoutRule("Potentials","STAGE",n,!0))return void sE();checkForValidationRule(p,e,o,u,c,n,l,m)}else checkForValidationRule(p,e,o,u,c,n,l,m)}else if("popup"===e){var f,h=$("#closedWon").find(".labelValCreate").find(":input[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^=Crm_],crux-text-area-component[id^='Crm_']").not("input[id$='_TimeOption']").filter(":visible"),C=[],w=$("#Crm_Potentials_STAGE");n=w.val();for(f=0;f<h.length;f++)C.push($(h[f]).attr("id"));var y=Crm.validateEntityAndShowErrorMsg(C,"Potentials",!0);if(!y)return;y&&new Promise((function(e){e(CVRExec.validateRulesForStagePopUpSave(i))})).then((function(i){if(!i)return $("#Crm_Potentials_CLOSINGDATE").change((function(){$("#savePotentialspopup").removeClass("pEvents")})),void $("#Crm_Potentials_STAGE").change((function(){$("#savePotentialspopup").removeClass("pEvents")}));delete Crm.VR;var a=!1,c="",u={};u.moduleid=s,u.module="Potentials",t&&(u.$validation_rule_action=t);var m=[],p=0,v=$("#Crm_Potentials_AMOUNT"),g=d?v.data():$("#mouseArea__AMOUNT").data("params");if(g&&"true"!==g.readonly||d&&returnJson.entityMapJson.AMOUNT&&"true"!==returnJson.entityMapJson.AMOUNT.readonly){var f=d?returnJson.entityMapJson.AMOUNT.defaultvalue:g.defaultvalue,h=v.val();f!==(h=h||null)&&(u["fieldValue"+(0===p?"":p)]=h,u["fieldLabel"+(0===p?"":p)]=g.label,u.uitype=g.uitype,u["columnName"+(0===p?"":p)]=g.colname,m[p]=g.colname,p++,d&&$("#listView_"+s).closest("li").find(".sv_AMOUNT").data("amountValue",h))}var C=d?w.data():$("#mouseArea__STAGE").data("params"),y=d?Crm.getDealsStageValue(returnJson.entityMapJson.STAGE.defaultvalue):C.defaultvalue,_=Crm.getDealsStageValue(n);(d||y!==_)&&(u["fieldValue"+(0===p?"":p)]=n,u["fieldLabel"+(0===p?"":p)]=C.label,u.uitype=C.uitype,u["columnName"+(0===p?"":p)]=C.colname,a=!0,m[p]=C.colname,p++);var b=d?$("#Crm_Potentials_CLOSINGDATE").data():$("#mouseArea__CLOSINGDATE").data("params");if(b&&"true"!==b.readonly||d&&returnJson.entityMapJson.CLOSINGDATE&&"true"!==returnJson.entityMapJson.CLOSINGDATE.readonly){var I=d?new Date(returnJson.entityMapJson.CLOSINGDATE.defaultvalue):new Date(b.defaultvalue),T=$("#Crm_Potentials_CLOSINGDATE").data("dateObj");T.setHours(0,0,0,0),I.getTime()!==T.getTime()&&(u["fieldValue"+(0===p?"":p)]=$("#Crm_Potentials_CLOSINGDATE").val(),u["fieldLabel"+(0===p?"":p)]=b.label,u["columnName"+(0===p?"":p)]=b.colname,m[p]=b.colname,p++)}var L,D="";for(var E in"crm.tab.module.custom-view.kanban"!==Lyte.Router.getRouteInstance().transition.info.route||C.val||(C.val=C.values),C.val)if(C.val[E].value===n){D=C.val[E].fctype;break}for(var R in!0===a&&"Closed Lost"===D&&(r&&(u.description=r),u.subject=Crm.getDealsStageValue(n)),Crm.requestParamWithColname)"STAGE"!==R&&"CLOSINGDATE"!==R&&"AMOUNT"!==R&&(L=0===p?"fieldValue":"fieldValue"+p,u[0===p?"columnName":"columnName"+p]=R,u[L]=Crm.requestParamWithColname[R],m[p]=R,p++,l=!0),c=""===c?c+R+"##"+Crm.requestParamWithColname[R]+"##"+R:c+"||"+R+"##"+Crm.requestParamWithColname[R]+"##"+R;if(Crm.userDetails.clientLoggerNeedAccount){var A={type:"custom event"};A.message=JSON.stringify(u),murphy.addCustomTracking(A),murphy.error(new Error("Deal record update details 2"))}if(2!==detailView.isApproved)savePotentialPopupAction(e,o,u,g,C,b,n,l,m);else{var M=Lyte.registeredMixins.approvalprocess.constructPayloadFromDetailViewTemplate(u,u.module);Lyte.registeredMixins.approvalprocess.saveRecordWithApprovalResponse(businessCardJson.hidden.APPROVALBUTTONS,M,"DVS")}}))}}function savePotentialPopupAction(e,t,a,n,s,r,o,l,d){var c="Potentials",u=$("#multipleFieldsEditPop").is(":visible");a[csrfParamName]=csrfToken,a.type="CloseFromDV",delete a.check,(new crmRequestPool).doAjax1(t,(function(t){var o,m,p,v;if(CVRExec.storeCachedParams(void 0),null!=t.data&&null!=t.data[0]&&null!=t.data[0].details&&null!=t.data[0].details.affected_data&&(detailView.affectedData=t.data[0].details.affected_data,detailView.affectedData[1]="OtherThanGlobalAndFieldEdit"),"string"==typeof t)o=t.split("AJAX::::"),O=trim(o[1]),k=o[2],k=revertSplChrs(k),B=trim(o[5]),date=o[6],uiFormulaVals=trim(o[7]),x=trim(o[8]),H=trim(o[9]),m=o[10].trim(),p=o[11].trim();else{if(t.responseJSON){var g=t.responseJSON;if("MANDATORY_NOT_FOUND"===g.code||g.data&&"MANDATORY_NOT_FOUND"===g.data[0].code)return commonUtils.showErrorMsg(I18n.getMsg("crm.field.valid.check",[cm_fl.data("displaylabel")]),cm_fl),void(itsonview=!0);if(g.data&&"MAPPING_MISMATCH"===g.data[0].code&&"Pipeline"===g.data[0].details.mapped_field&&""===returnJson.entityMapJson.PIPELINE.defaultvalue){var f="DV"!==e;return f?commonUtils.showErrorMsg(I18n.getMsg("crm.pipeline.empty.detailview.disable"),errorDiv):crmui.showMsgBand("error",I18n.getMsg("crm.pipeline.empty.detailview.disable"),2e3),void(f||cancelPotentialPopup(!0))}if("NO_PERMISSION"===g.code||g.data&&"RECORD_IN_BLUEPRINT"===g.data[0].code||g.data&&"CANNOT_PERFORM_ACTION"===g.data[0].code||g.data&&"MAPPING_MISMATCH"===g.data[0].code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),hideAnimatePopup("subSecondaryPopup",!0),void reloadCurrentEntityView(detailView.entityId,detailView.currentModule);if("Internal Server Error"===g.message||g.data[0].message&&"invalid data"===g.data[0].message)return void renderingUtils.displayPermissionDenied(null,null,g.message);if(g.data&&"NOT_ALLOWED"===g.data[0].code)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.alert.can.not.edit.email"));if(g.data&&g.data[0]&&"RECORD_LOCKED"===g.data[0].code&&"Sorry, you cannot perform this operation as the record is locked."===g.data[0].message)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.record.locking.permission.denied"));if("duplicate data"===g.data[0].message){var h={},C=g.data[0].details,w=returnJson.entityMapJson,y="",_="",b=g.data[0].details.api_name;for(var I in w)w[I].sysRefName===b&&(_=w[I].displaylabel,y=w[I].colname);var T=C.duplicate_record;h.FIELDLABEL=_,h.OWNERNAME=T.Owner.name,h.MODULE=c,h.RECORDS={},h.COUNT=C.more_records?2:1,h.ZUID=T.Owner.zuid,delete T.Owner;var L={};L.ENTITYID=T.id,delete T.id;var D=[];if(Object.keys(T).length>1){var E=Crm.userDetails.NAME_FORMAT;E=E.split(",");var R=[];E.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),T[e]&&R.push(T[e])})),L.ENTITYNAME=R.join(" "),L.ENTITYNAMEFORPOPOVER=R.join(" ")}else for(var A in T)L.ENTITYNAME=T[A],L.ENTITYNAMEFORPOPOVER=T[A];D.push(L),h.RECORDS=D,commonUtils.hideDuplicateErrorMsg("viewentityform"),itsonview=!0;var M=commonUtils.getDuplicateErrorMsg(h,!1);return commonUtils.showErrorMsg(M,$("#Crm_Potentials_"+y),c),void commonUtils.showHideLoadingDiv()}if("DUPLICATE_LINKING_DATA"===g.data[0].code){var S=g.data[0].details.duplicate_record,V=S.id,N=S.Name,P=I18n.getMsg("crm.linking.module.duplicate.warning",[$ESAPI.encoder().encodeForHTML(c),$ESAPI.encoder().encodeForHTML(V),$ESAPI.encoder().encodeForHTML(N),$ESAPI.encoder().encodeForHTML(Crm.getCrmBasePath())]);return renderingUtils.showCustomAlert(P,"",!0),commonUtils.hideDuplicateErrorMsg("viewentityform"),void(itsonview=!0)}}if("crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route){if("saveDenied"===crmListView.updateStageSuccess(a.moduleid,c,crmListView.haltStateParams.curStageId,crmListView.haltStateParams.prevStageId,t,"popupsave"))return;hideAnimatePopup("subSecondaryPopup"),renderingUtils.removeFreezeLayer()}var O=!(!(o=t).data||"success"!==o.data[0].status);if(!O)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));var k=o.outputValue;k=revertSplChrs(k);var J=(C=o.data[0].details).Modified_By.name,U=C.Modified_By.id,F=C.Modified_Time;F=new Date(F.substring(0,F.length-6)),F=Utils.convertDateToGivenPattern("D, d M yy",F)+" "+Utils.getTimeInUserFormat(F,!0);var B="<span purpose='showUserBC'  data-params='{\"userId\":\""+U+"\"}' >"+$ESAPI.encoder().encodeForHTML(J)+"</span><br><span class='crm-small-font-size fontSmooth crmNotFoundColor crm-font-regular'>"+F+"</span>",x="",j="",H="",z=null!==o.data[0].details.affected_data&&o.data[0].details.affected_data[0];if(z&&"Expected_Revenue"in z&&(H=z.Expected_Revenue),m=null!=z.Sales_Cycle_Duration?z.Sales_Cycle_Duration:"",p=null!=z.Overall_Sales_Duration?z.Overall_Sales_Duration:"",z){delete z.id;var G=returnJson.entityMapJson;for(var I in G){var W=G[I].uitype,Y=G[I].colname,q=z[G[I].sysRefName];if(z&&G[I].sysRefName in z){var Z=$("#mouseArea__"+Y),K=$("#value_"+Y),X=$("#subvalue_"+Y),Q=$("#headervalue_"+Y);if(36===parseInt(W)||143===parseInt(W)||145===parseInt(W)||144===parseInt(W)){var ee=featuresAvailable.MultiCurrency,te=Crm.userDetails,ie=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:te.BASE_CURRENCY?te.BASE_CURRENCY:void 0;q=ee&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ie]?currencyUtils.returnValueInDefaultCurrency(ie,q,Crm.userDetails.CURRENCY_DETAILS[ie].decimals):currencyUtils.returnValueInDefaultCurrency(ie,q),"Expected_Revenue"===G[I].sysRefName&&($("#value_"+Y).html(q),$("#headervalue_"+Y).html(q))}if(K.length>0||X.length>0){if(null!==Z&&"2"===Z.data("params").uitype){var ae=$("span#subvalue_"+Y);if(ae.html(q),ae.hasClass("colorAppliedPicklist")){var ne=returnJson.entityMapJson[Y].picklistmap;if(ne){var se=ne.filter((function(e){return e.uservalue===q}));void 0!==se&&se.length>0&&se[0].colorCode&&ae.attr({class:"colorAppliedPicklist",style:getPLStyleObj(se[0].colorCode)})}}}else K.html(q),X.html(q),Q.html(q);if(null!==Z&&"date"===Z.data("params").formulaType){var re=Utils.convertFrom8601DateFormat(q);Utils.convertToUserTimezone(re);var oe=Utils.getDateInUserDatePattern(re,!0);K.html(oe),X.html(oe),Q.html(oe)}else if(null!==Z&&"datetime"===Z.data("params").formulaType){re=new Date(q);Utils.convertToUserTimezone(re);var le=Utils.getDateTimeInUserFormat(re,!0,!0);K.html(le),X.html(le),Q.html(le)}else if(null!==Z&&"number"===Z.data("params").formulaType)q=q.toString(),K.html(q.replace(/,/g,"")),X.html(q.replace(/,/g,"")),Q.html(q.replace(/,/g,""));else if(null!==Z&&"boolean"===Z.data("params").formulaType)q=q.toString(),K.html(q),X.html(q),Q.html(q);else if(null!==Z&&"currency"===Z.data("params").formulaType){ee=featuresAvailable.MultiCurrency,te=Crm.userDetails,ie=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:te.BASE_CURRENCY?te.BASE_CURRENCY:void 0;q=ee&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ie]?currencyUtils.returnValueInDefaultCurrency(ie,q,Crm.userDetails.CURRENCY_DETAILS[ie].decimals):currencyUtils.returnValueInDefaultCurrency(ie,q),K.html(q),X.html(q),Q.html(q)}"FORECASTCATEGORY"!==Y&&"FORECAST_CATEGORY"!==Y&&"REASON_FOR_LOSS"!==Y||(Z.data("params").defaultvalue=q)}if(delete z[I.sysRefName],0===!z.length&&555!==parseInt(uitype))break}}}ee=featuresAvailable.MultiCurrency,te=Crm.userDetails,ie=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:te.BASE_CURRENCY?te.BASE_CURRENCY:void 0;for(var de=(ve=k.split("||")).length,ce=0;ce<de;ce++){var ue=ve[ce].split("##")[1]||ve[ce];n&&d[ce]===n.colname&&(j=x=ue)}if(ee&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ie]?(H=currencyUtils.returnValueInDefaultCurrency(ie,H,Crm.userDetails.CURRENCY_DETAILS[ie].decimals),x=currencyUtils.returnValueInDefaultCurrency(ie,x,Crm.userDetails.CURRENCY_DETAILS[ie].decimals)):(H=currencyUtils.returnValueInDefaultCurrency(ie,H),x=currencyUtils.returnValueInDefaultCurrency(ie,x)),z&&z.$process_flow&&detailView.currentModule&&detailView.entityId)if($("#pb_processButtonLayerInner").length>0){if(Lyte.registeredMixins.kiosk_execute&&Lyte.registeredMixins.kiosk_execute.isKioskExecution())return void Lyte.registeredMixins.kiosk_execute.setKioskRefreshLoad(!0);ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray,detailView.pathfinderDetailsArray)}else{if(!a.subject||!a.description||"crm.tab.module.entity.detail"!==Lyte.Router.getRouteInstance().transition.info.route)return hideAnimatePopup("subSecondaryPopup",!0),void reloadCurrentEntityView(detailView.entityId,detailView.currentModule);l=!0}}if(O&&l&&!a.subject&&!a.description)return hideAnimatePopup("subSecondaryPopup",!0),void reloadCurrentEntityView(detailView.entityId,detailView.currentModule);var me=Crm.lyteHeaderNeeded("Potentials");if(me){var pe=$("#dv-button-layer").find("crm-detailview-header")[0];pe&&(v=pe.component)}var ve=k.split("||");for(ce=0;ce<ve.length;ce++){ue=ve[ce].split("##")[1]||ve[ce];if(d[ce]===s.colname){var ge=ue.split(":"),fe="";if(1==ge.length)fe+=ge[0];else for(i=1;i<ge.length;i++)fe+=i===ge.length-1?ge[i]:ge[i]+":";var he=$("#mouseArea__"+d[ce]).data("params"),Ce=fe;if(he&&he.colorcode_enabled)Ce="<span id='subvalue_STAGE' data-zcqa='colorcode_dv_revamp' class='colorAppliedPicklist' style='"+getPicklistStyleObj(fe,he.val,!0)+"'>"+fe+"</span>";Crm.calculateExpectedRevenue(),$("[id=subvalue_"+d[ce]+"],[id=headervalue_"+d[ce]+"],[id=value_"+d[ce]+"]").html(Ce),$("#potclosedv").val(replaceSplChrs(ue)).trigger("change.select2"),"crm.tab.module.custom-view.kanban"!==Lyte.Router.getRouteInstance().transition.info.route&&(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("DealHistory"):reloadPersonality("potstagehistpersonality"));var we={defaultvalue:ue,plainValue:fe};detailView.replaceDataParams("STAGE",we)}else if(n&&d[ce]===n.colname){if(me){if(v){var ye=v.getData("record");Lyte.registeredMixins["crm-detailview-parser"].parseAndSetCurrencyValue(ie,j,ye,n.sysRefName)}$("[id=headervalue_"+d[ce]+"]").html(x),$("#fullInfoDiv [id=subvalue_"+d[ce]+"]").html(x)}else $("[id=subvalue_"+d[ce]+"],[id=headervalue_"+d[ce]+"]").html(x);var _e=getObj("actualValue_"+d[ce]),be=$("#value_"+d[ce]);if(be.html(ue),be.data("value")&&be.data("value",x),_e){_e.value=x;var Ie=be;Ie.empty(),be&&(Ie.html(x),Ie.data("value",currencyUtils.getCurrencyWithoutSeperator(x)))}H&&""!=H&&($("#value_EXPECTEDREVENUE").empty(),getObj("value_EXPECTEDREVENUE")&&(getObj("value_EXPECTEDREVENUE").innerHTML=H,$("span[id='headervalue_EXPECTEDREVENUE']").empty(),$("span[id='headervalue_EXPECTEDREVENUE']").html(H)));var Te=currencyUtils.getCurrencyWithoutSeperator(ue),Le={defaultvalue:Te,plainValue:Te};detailView.replaceDataParams(d[ce],Le)}else if(r&&d[ce]===r.colname){m&&(SalesSummaryInfo.DEALDURATION=m,SalesSummaryInfo.SALESDURATION=p,loadSalesSummary());var De=ue;-1!==ue.indexOf("##")&&void 0===ue.split("##")[1]||""===ue.split("##")[1]?(ue="",De=""):ue=crmCalendar.getDateObjectFromGivenDateString(ue)+"",$("#headervalue_"+d[ce]).html(De),$("#subvalue_"+d[ce]).html(De),$("#value_"+d[ce]).html(De),$("#stageIndicator_"+d[ce]).html(De),detailView.replaceDataParams(d[ce],ue)}$("#mouseArea__"+d[ce]).removeClass("errorFieldP"),$("#labelTD_"+d[ce]).removeClass("newmandatory")}if(void 0!==o.derivedFields){var Ee=o.derivedFields;for(var A in Ee)$("[id='subvalue_"+A+"']").html(Ee[A])}$('[id="value_MODIFIEDBY"]').html(B);Crm.getCrmBasePath();if("crm.tab.module.custom-view.kanban"!==Lyte.Router.getRouteInstance().transition.info.route&&crmTab.deleteFromCache("Potentials"),refreshFollowDiv(),a.subject&&a.description&&("crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route)){if("crm.tab.module.custom-view.kanban"===Lyte.Router.getRouteInstance().transition.info.route||businessCardJson.userInRole.notesPermission)if("string"==typeof t){var Re=o.slice(-1);$L("crux-note")[0]&&Crm.userDetails.isRelatedListLyteEnabled?(store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})}))):Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,Re,!1,$("#note_subject"),$("#noteContextTxt"))}else{var Ae={};Ae.Note_Title=a.subject,Ae.Note_Content=a.description,Ae.Parent_Id=a.moduleid,Ae.se_module=a.module;var Me={};(D=[]).push(Ae),Me.data=D;var Se={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(Se["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:"/crm/v2/Notes",type:"POST",data:JSON.stringify(Me),headers:Se,contentType:"application/json",success:function(e){var t={};t.noteTitle=$ESAPI.encoder().encodeForHTML(a.subject),t.noteContent=$ESAPI.encoder().encodeForHTML(a.description),t.relModuleName=Ae.se_module,t.isEditAllowed=!0,t.createdDate="now",t.modifiedDate="now",t.mainEntId=Ae.Parent_Id,t.nId=e.data[0].details.id,t.isDelAllowed=!0,t.noteContentWithRegex=$ESAPI.encoder().encodeForHTML(a.description),t.modiName=e.data[0].details.Modified_By.name,t.seId=void 0===Ae.se_moduleid?Ae.Parent_Id:Ae.se_moduleid,t.dispModuleName=void 0===returnJson[Ae.se_module].rpModuleName?Ae.se_module:returnJson[Ae.se_module].rpModuleName,t.i18nModName=void 0===returnJson[Ae.se_module].rpModuleName?Ae.se_module:returnJson[Ae.se_module].rpModuleName,t.mainEntityName=returnJson[Ae.se_module].entityName,t.CONTACTSURL=Crm.userDetails.contactServerUrl+"/file";var i=new Date(e.data[0].details.Created_Time);t.createdDateFull=Utils.convertDateToGivenPattern("M d",i)+" "+Utils.getTimeInUserFormat(i,!0);var n=new Date(e.data[0].details.Modified_Time);if(t.modifiedDateFull=Utils.convertDateToGivenPattern("M d",n)+" "+Utils.getTimeInUserFormat(n,!0),t.modifiedZuid=Crm.userDetails.ZUID,t.clientPortalName=void 0!==window.clientPortalName?window.clientPortalName:"",t.clientPortalUrlContext="portal",t.isSharedToClient=!!$("#sharetoclient").prop("checked"),$L("crux-note")[0]&&Crm.userDetails.isRelatedListLyteEnabled?(store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})}))):Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,t,!1,$("#note_subject"),$("#noteContextTxt")),O&&l&&"crm.tab.module.custom-view.kanban"!==Lyte.Router.getRouteInstance().transition.info.route)return hideAnimatePopup("subSecondaryPopup"),void reloadCurrentEntityView(detailView.entityId,detailView.currentModule)},error:function(e){if("MAX_RECORDS_LIMIT_REACHED"===e.responseJSON.code||"MAX_LIMIT_REACHED"===e.responseJSON.code){var t=networkUtils.returnDependencyFiles(["datastorage.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")],ResourceConstants.CRM),n=t.concat(i).concat(a);Lyte.injectResources(n,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"Notes_Create"},"#mics_tipDiv")}))}}})}}else if(u)l=!1;else if((void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Potentials")||void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Potentials"))&&"crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route)return hideAnimatePopup("subSecondaryPopup",!0),void reloadCurrentEntityView(detailView.entityId,detailView.currentModule);if("DV"===e){var Ve=$("#potclosedv");Ve.find("[data-remove]").remove(),Ve.val(replaceSplChrs(k)).trigger("change.select2")}else{var Ne=$("#Crm_Potentials_STAGE").val();$("#stageContain").find('li[data-value="'+Ne+'"]').trigger("click"),$("#stageContain").find("#subvalue_CLOSINGDATE").text($("#value_CLOSINGDATE").text())}hideAnimatePopup("subSecondaryPopup",!0),CFRExec&&(CFRExec.promptIfMandatory=!0),"string"==typeof g?""!=o[15]&&"true"==o[15]?reloadCurrentEntityView():CFRExec&&CFRExec.evalRules("view",!0):o.data[0].details.affected_data&&o.data[0].details.affected_data[0].$approved?reloadCurrentEntityView():CFRExec&&CFRExec.evalRules("view",!0),detailView.setCurrentStageSetOnChange(),"crm.tab.module.entity.detail"===Lyte.Router.getRouteInstance().transition.info.route&&Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent()}),a,(function(e){returnJson.entityMapJson.STAGE.val.filter((function(e){if(e.content===$($("#value_STAGE")[0]).text())return e}));$("#potclosedv").val(o.pbty+":"+o.content).trigger("change.select2"),alert(I18n.getMsg("game.common.error")),hideAnimatePopup("subSecondaryPopup",!0)}))}function checkForValidationRule(e,t,i,a,n,s,r,o){if(e)return CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Potentials","STAGE",!0,!0))})).then((function(e){if(!e)return $("crm-stage-detailview").length>0&&Lyte.injectResources(networkUtils.returnDependencyFiles(["crm-detail-view-utils.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent()})),void sE();savePotentialPopupAction(t,i,a,void 0,n,void 0,s,r,o)}));savePotentialPopupAction(t,i,a,void 0,n,void 0,s,r,o)}function changeColorPotentialStage(e){var t=$(e).val();$("#stageContain").find(".order-step").each((function(){if(t===$(this).attr("data-value"))return $(".wh11Class").removeClass("wh11Class"),$(".wh7Class").removeClass("wh7Class"),CFRExec&&(CFRExec.revertPotentials=!0),$(this).trigger("click"),$(this).removeClass("currentActive"),!1}))}function setWidthHeightStageObject(e,t,i){$("#newInfoDiv").is(":visible")&&(i.css({width:e.width()-75+"px"}),i.outerWidth(),t.length,$("#lineStageDiv,.createdstagedate,.Deal-date,.sliderActive .dv_statge_title").show());detailView.navCheckenableReload()}function stageClickBelowten(e){var t=$(e),i=$(".sToolTipBottom"),a=t.find(i),n=$(a).find("select"),s=t.attr("data-value").split(":"),r=$("#stageContain");$(".lineStage li").removeClass("sliderActive");if($("body").append('<div class="crm-base-font-size crm-font-regular dIB calculateWidthHere"></div>'),"-None-"!==s[1]){var o=t.find(".Stooltip").text();t.removeAttr("data-line").removeClass("inactive").removeClass("sliderActive").addClass("active").addClass("sliderActive").attr("data-line",o),i.addClass("hide"),a.removeClass("hide"),i.find("select").html(""),n.html($("#potclosedv").html()),n.find("option").prop("selected",!1),n.find("option").each((function(){if($(this).val()===t.attr("data-value"))return $(this).prop("selected",!0),$(".calculateWidthHere").text($(this).text()),!1})),thirdPartyUtils.bindSelect2(n),changeStageEnableDisable(r,t,e,s),$(".dv_statge_title").show(),$(".sliderActive.active").find(".dv_statge_title").hide(),a.addClass("show")}}function stageClickBelowNormal(e,t,i,a){var n=$("#stageContain"),s=$(".sToolTipBottom"),r=e.find(s);if($(".lineStage li").removeClass("sliderActive"),$("body").append('<div class="crm-base-font-size crm-font-regular dIB calculateWidthHere"></div>'),"-None-"!==i[1]){var o=e.find(".Stooltip").text();e.removeAttr("data-line").removeClass("inactive").removeClass("enable").removeClass("sliderActive").addClass("active").addClass("sliderActive").attr("data-line",o),s.addClass("hide"),r.removeClass("hide"),s.find("select").html(""),t.html($("#potclosedv").html()),t.find("option").prop("selected",!1),t.find("option").each((function(){if($(this).val()===e.attr("data-value"))return $(this).prop("selected",!0),$(".calculateWidthHere").text($(this).text()),!1})),thirdPartyUtils.bindSelect2(t),changeStageEnableDisable(n,e,a,i),$(".dv_statge_title").show(),$(".sliderActive.active").find(".dv_statge_title").hide(),r.addClass("show")}}function stageSelectBind(e,t){var i=$(".sToolTipBottom");i.addClass("hide"),i.find("select").html(""),e.html($("#potclosedv").html()),e.find("option").prop("selected",!1),e.find("option").each((function(){if($(this).val()===t.attr("data-value"))return $(".calculateWidthHere").text($(this).text()),$(this).prop("selected",!0),!1})),thirdPartyUtils.bindSelect2(e)}function changeStageEnableDisable(e,t,i,a){0===e.find("li[data-stageid]").length||0===e.find('li[data-stageid!=""]').length||$(i).attr("data-stageid")?(t.prevAll("li").removeClass("inactive").removeClass("active").addClass("enable"),t.nextAll("li").removeClass("enable").removeClass("active").addClass("inactive")):(t.prevAll("li").removeClass("enable").removeClass("active").addClass("inactive"),t.nextAll("li").removeClass("enable").removeClass("active").addClass("inactive")),$(".calculateWidthHere").remove()}function searchMapLocation(e,t){if("true"==Crm.baiduAvailable)var i=["MAILINGCOUNTRY","MAILINGSTATE",,"MAILINGCITY","MAILINGSTREET"],a=["OTHERCOUNTRY","OTHERSTATE","OTHERCITY","OTHERSTREET"],n=["BILLINGCOUNTRY","BILLINGSTATE","BILLINGCITY","BILLINGSTREET"],s=["SHIPPINGCOUNTRY","SHIPPINGSTATE","SHIPPINGCITY","SHIPPINGSTREET"];else i=["MAILINGSTREET","MAILINGCITY","MAILINGSTATE","MAILINGZIP","MAILINGCOUNTRY"],a=["OTHERSTREET","OTHERCITY","OTHERSTATE","OTHERZIP","OTHERCOUNTRY"],n=["BILLINGSTREET","BILLINGCITY","BILLINGSTATE","BILLINGCODE","BILLINGCOUNTRY"],s=["SHIPPINGSTREET","SHIPPINGCITY","SHIPPINGSTATE","SHIPPINGCODE","SHIPPINGCOUNTRY"];$("#module").val();mainJson={"Mailing Address":i,"Other Address":a,"Billing Address":n,"Shipping Address":s};var r="";if(mainJson[e])for(var o=0;o<mainJson[e].length;o++)r+=getMapParameter("value_"+mainJson[e][o])+" ";""!=r.trim()?findMap(encodeURIComponent(r),t):alert(I18n.getMsg("crm.field.address.empty.check"))}function setProbabilityInAjaxEdit(e){e.substring(e.indexOf(":")+1,e.length);e=e.substring(0,e.indexOf(":"));var t=$("#value_PROBABILITY"),i=$("#headervalue_PROBABILITY");if(t.length>0){var a=t[0];$(a).empty(),a.innerHTML=e}else pbty=e;if(i.length>0){var n=i[0];$(n).empty(),n.innerHTML=e}else pbty=e}function showAdInfo(e,t){$(e).offset();$("#"+t).css({display:"block"})}function showPopupMenu(e,t,i,a,n,s){Events.isEnabledProviders((function(e){0===e.length&&($("#meetNowClick").hide(),$("#scheduleMeetingClick").hide()),detailView.meetingProvidersEnabled=e})),Crm.menu.createMenu(n,t),$("#"+t).bind("onBeforeShow",(function(t,n){var r=renderingUtils.getTargetElem(n),o=$(r).offset(),l=r.offsetWidth,d=r.offsetHeight,c=o.top,u=o.left,m=$(this).outerWidth(),p=$(this).outerHeight(),v=0,g=0,f=getObj("dv-button-layer"),h=$(".task-detailview");if(f&&"fixed"===f.style.position&&(g=$L(window).scrollTop()),(f&&"fixed"===f.style.position||h&&h.length>0&&featuresAvailable.NEXTGENUI_ENABLED)&&(v=document.getElementById("show").offsetLeft),"true"===$("#iskanbanview").val()&&"CustomizeTools"===$(r).attr("id")){var C=$(r).position();c=C.top,u=C.left}s&&(r.className=s),null===i||"left"===i?Crm.userDetails.RTL_ENABLED?this.style.left=u+l-m-v+"px":this.style.left=u-v+"px":Crm.userDetails.RTL_ENABLED?this.style.left=u-v+"px":this.style.left=u+l-m-v+"px",this.style.top=null===a||"bottom"===a?c+d-g+"px":c-p-g+"px",e.parentNode.className="clickDropDown"})).bind("onBeforeClose",(function(e,t){$(this).unbind("onBeforeClose").unbind("onBeforeShow"),$(this).parents("span").eq(0).attr("class","normalDropDown")})),$(e).hasClass("showAct")&&$(e).addClass("borAct")}function showHideRPanel(e){var t=$("#rp_parent"),i=!Crm.userDetails.CUSTOMIZE_INFO||null==Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL||Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL;if(void 0===e||Crm.userDetails.CLIENT_ACCOUNT||updateCustomization(CustomizationName.RIGHT_PANEL,!i,(function(){i=null==Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL||Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL,showHideRPanel()})),void 0===e){var a=document.getElementById("dv-button-layer");document.getElementById("detailrelatedMainlinks");t.length&&a&&(0==i?($("#expIcon").removeClass("expand").addClass("nonExpand"),$("#rp_td").hide(),"true"===$("#iskanbanview").val()?$(".kanbanTaskDetailCenterContainer").css("width","100%"):$("#rp_td").width("")):($("#expIcon").removeClass("nonExpand").addClass("expand"),$("#rp_td").show(),"true"===$("#iskanbanview").val()?$(".kanbanTaskDetailCenterContainer").css("width","75%"):$("#rp_td").width("300px")))}}function loadCampaingSummary(){if(relatedDetailsEle=document.getElementById("relatedDetails"),moduleObj=getObj("module"),idObj=getObj("id"),moduleObj&&idObj){module=moduleObj.value,id=idObj.value;var e=Crm.getCrmBasePath()+"/CampaignMemberStatusDetails.do?module="+module+"&id="+id;new AjaxAPI({id:"campaignSummary",url:e,callbackFn:function(){var e=getObj("relContactInfo");if(e&&""!=e.value){swapContent(entContInfo,"rpContInfo");var t=getObj("rpBox");t&&(t.style.display="")}}}).post()}}function swapContent(e,t){var i=document.getElementById(t),a=$("#taskRightBox");i&&""!=e?(a.show(),$(i).empty(),i.innerHTML=e):a&&a.style&&(a.style.display="none")}function showLocateMapMenu(e){var t=$("#locateMap"),i=t.offset().top,a=t.outerHeight()+10,n=$("#dv-button-layer"),s=$L(".crm-leftmenu-tab"),r=t.offset().left;if(i=featuresAvailable.NEXTGENUI_ENABLED?i+50:i,n.length&&(menuOuterheight=n.outerHeight(),tabsOuterHeight=$("#DetailViewInnerTabs").outerHeight(),i-=menuOuterheight+tabsOuterHeight),!Crm.userDetails.RTL_ENABLED&&featuresAvailable.NEXTGENUI_ENABLED&&s&&s.length>0&&(r-=s.outerWidth()),"Contacts"==e)$("#dropDownMenu").css({display:"block",left:r,top:i+a});else if("Accounts"==e||Crm.isInventoryModule(e)){$("#dropDownMenu1").css({display:"block",left:r,top:i+a})}else if("Leads"==e||"Vendors"==e){var o="LANE";"Vendors"==e&&(o="STREET");var l="";if(null!=Crm.baiduAvailable&&"true"==Crm.baiduAvailable&&null!=Crm.baiduUrl){if(""==(l=getMapParameter("value_"+o)+" "+getMapParameter("value_CITY")+" "+getMapParameter("value_STATE")+" "+getMapParameter("value_COUNTRY")).trim())return void alert(I18n.getMsg("crm.field.address.empty.check"));l=encodeURIComponent(l),findMap(l,"Baidu")}else{if(""==(l=getMapParameter("value_"+o)+" "+getMapParameter("value_CITY")+" "+getMapParameter("value_STATE")+" "+getMapParameter("value_CODE")+" "+getMapParameter("value_COUNTRY")).trim())return void alert(I18n.getMsg("crm.field.address.empty.check"));l=encodeURIComponent(l),findMap(l)}}}function requestApproval(e,t,i,a){var n=Crm.getCrmBasePath()+"/approvalProcess.do?action=requestApproval&entityId="+e+"&module="+t,s=csrfParamName+"="+$ESAPI.encoder().encodeForURL(csrfToken);mR(n,(function(t){"success"===t?(alert(i),getElemById("iskanbanview")&&"true"===getElemById("iskanbanview").value?Crm.goToKanbanViewEntity(void 0,getElemById("recordid_"+e),!0,!0):reloadCurrentEntityView(void 0,void 0,void 0,!0)):(a=I18n.getMsg("crm.approval.not.required.pop"),alert(a),reloadCurrentEntityView(void 0,void 0,void 0,!1))}),s)}function evalCustomLink(e,t,i){var a=$L("crm-detail-view")[0];i=i||(a?a.component.data.record.id:document.getElementById("id").value),window.open(networkUtils.getOrgSpecificURL(Crm.getCrmBasePath()+"/OpenCustomLink.do?action=openLink&seId="+i+"&module="+t+"&cusLnkId="+e,"_blank")).opener=null}function isTimeBasedActionSupported(e){return-1!=jQuery.inArray(e,["E","A","C","Z","U"])}function getTimeLine(e,t){detailView.datatimeLineHeight(),$(".tb_newmenu a").removeClass("sel"),t=t||"sel",$(e).addClass(t);var i=detailView.currentModule,a=returnJson[i].entityid,n=(i&&("Activities"===Crm.activityGrp[i]||i.startsWith("Orchestration")||i.startsWith("PathFinder")),i&&"Activities"===Crm.activityGrp[i]),s=$("#timeLineContainerDataDV");if(CrmTags.hasOwnProperty("edited")&&CrmTags.edited?(CrmTags.edited=!1,detailView.makeRequest=!0):detailView.dataParamDetails&&detailView.dataParamDetails.isUpdated&&(detailView.dataParamDetails.isUpdated=!1,detailView.makeRequest=!0),""!==trimBoth(s.html()))return s.show(),void($("#fromTaskPage").length?$("#fromTaskPage").find("#rp_parent").hide():($("#rp_parent").hide(),thirdPartyUtils.bindPerfectScroll("#timelineDiv",{wheelSpeed:1,preventOnEnd:!0}),$("#timelineDiv").addClass("oH"),detailView.switchTab(e,"Timeline")));detailView.makeRequest=!0,n||loadTimeBasedActions(1,a,i,"upcomingActionsDiv"),loadTimeLineDetails(e,t,!1)}function loadTimeLineDetails(e,t,i){var a=$("#dv-button-layer"),n=$("#DetailViewInnerTabs");if(1==detailView.makeRequest){var s=detailView.currentModule,r=returnJson[s].entityid;s&&Crm.activityGrp[s];detailView.makeRequest=!0;$("#timeLineContainerDataDV li[class^=timeline_]").length;if(detailView.makeRequest&&$L(e).scrollTop()>=$(e).get(0).scrollHeight-$(e).get(0).clientHeight-800){$L(e).scrollTop(),$(e).get(0).scrollHeight,$(e).get(0).clientHeight;var o=0;i&&(o=$("#sameDate").val());var l=Crm.getCrmBasePath()+"/KanbanViewEntity.do?action=get_timeline&module="+s+"&entityId="+r+"&signals=true&fromRange="+o;crmNTCGlobal.lastNotificationIdInRecordTimeline=i?crmNTCGlobal.lastNotificationIdInRecordTimeline:"",""!==crmNTCGlobal.lastNotificationIdInRecordTimeline&&(l=l+"&notificationid="+crmNTCGlobal.lastNotificationIdInRecordTimeline),mR(l,(function(t){var a=$("#timeLineContainerDataDV"),n=$L("#timelineDiv").scrollTop();try{t=JSON.parse(t)}catch(e){}t.length>=51?$("#loadMoreTimeLine").show():$("#loadMoreTimeLine").hide(),crmTab.isZBCustomModule(s)&&(t=JSON.parse(ZInvoice.constructTimeline(t,s)),$("#newInfoDiv").height($("#newInfoDiv").height()-50)),$("#timeLine_dv").attr("onclick","getTimeLine(this)");var r=Handlebars.templates.Timeline;if($("#fromTaskPage").length)$("#fromTaskPage").find("#rp_parent").hide(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&a.height(renderingUtils.windowHeight-a.offset().top-50),a.html(r(t)).show(),a.height(renderingUtils.windowHeight-a.offset().top-50);else{t.sort((function(e,t){var i=new Date(e.ToolTipDate.replace(" ","T"));return new Date(t.ToolTipDate.replace(" ","T"))-i}));for(var o=Handlebars.compile('<div class="timeLineHistInner pR"><div class="timeLineHistDate pB20">{{formattedDate}}</div><ul class="timeLineHistDataList timelineLogsUl">{{{liHtml}}}</ul></div>'),l=Handlebars.compile('<li class="timeline_{{action}} {{module}}"><span class="timeLineHistTime crm-font-regular crm-small-font-size fL">{{DisplayTime}}</span>  <span class="crm-font-regular crm-base-font-size fL timeLineHistCont pR wbBreakWord">{{{displayContent}}}</span></li>'),d=Handlebars.compile('<li class="timeline_{{action}} {{module}}"><span class="timeLineHistTime ziaHistTime crm-font-regular crm-small-font-size fL">{{DisplayTime}}</span>  <span class="crm-font-regular crm-base-font-size fL timeLineHistCont pR wbBreakWord mT5">{{{displayContent}}}</span></li>'),c=Handlebars.compile('<li class="timeline_{{action}} {{module}} "><span class="timeLineHistTime crm-font-regular crm-small-font-size fL">{{DisplayTime}}</span>  <span class="crm-font-regular crm-base-font-size fL timeLineHistCont pR wbBreakWord">{{{getDisplayContentForSignalsInTimeline this}}}</span></li>'),u="",m=(t.length>50||t.length,t.length>=51&&t.length,t.length,void 0),p=!1,v=0,g=0;g<t.length;g++){var f="";t[g].hasOwnProperty("source")&&"SalesSignals"===t[g].source?(f=c(t[g]),m=void 0===m?t[g].ToolTipDate:m,crmNTCGlobal.lastNotificationIdInRecordTimeline=m>t[g].ToolTipDate?t[g].notificationId:crmNTCGlobal.lastNotificationIdInRecordTimeline,crmNTCGlobal.temp[v++]=t[g].notificationId):t[g].hasOwnProperty("action")&&"ZiaScore"===t[g].action?(f=d(t[g])):(f=l(t[g])),u+=f;var h=new Date(t[g].ToolTipDate.replace(" ","T"));if(i&&0===g&&null!=h&&h.getDate()==$L.moment(detailView.lastTimelineDate).toDate().getDate()&&null!=h&&h.getMonth()==$L.moment(detailView.lastTimelineDate).toDate().getMonth()&&(p=!0),g===t.length-1||null!=h&&h.getDate()!=$L.moment(t[g+1].ToolTipDate.replace(" ","T")).toDate().getDate()||null!=h&&h.getMonth()!=$L.moment(t[g+1].ToolTipDate.replace(" ","T")).toDate().getMonth()){var C="";if(g===t.length-1&&(detailView.lastTimelineDate=t[g].ToolTipDate.replace(" ","T")),i){if(p){var w=a.find(".timelineLogsUl");$(w[w.length-1]).append(u),p=!1}else C={formattedDate:t[g].DisplayDate,liHtml:u},a.append(o(C));setTimeout((function(){i=!1}),10)}else C={formattedDate:t[g].DisplayDate,liHtml:u},$(a).append(o(C));u=""}}if(t.length>=50){if($("#sameDate").length){var y=$("#sameDate").val();if(y.indexOf("_")>-1){var _=y.split("_");$("#sameDate").val(_[0]+"_"+(parseInt(_[1])+1))}}else{var b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("id","sameDate"),b.setAttribute("value","_1"),$(a).append(b)}if(detailView.makeRequest=!0,t[t.length]&&new Date(t[t.length].ToolTipDate).getDate()==new Date(t[t.length-1].ToolTipDate).getDate()){var I=parseInt($("#sameDate").val().split("_")[1])+1;$("#sameDate").val("true_"+I)}}else detailView.makeRequest=!1,$("#loadMoreTimeLine").hide();a.show(),$("#rp_parent").hide();$("#timelineDiv");thirdPartyUtils.unbindPerfectScroll("#timelineDiv"),thirdPartyUtils.bindPerfectScroll("#timelineDiv",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1}),$("#newInfoDiv").addClass("oH"),i||detailView.switchTab(e,"Timeline"),$("#upcomingActionsDiv").addClass("timeLineNorec")}setTimeout(function(){$L("#timelineDiv").scrollTop(n)}.bind(n),10)}))}$("#timeLine_dv").removeAttr("onclick")}if($L("#timelineDiv").scrollTop()>=10){var d=$L(".detailview_add_tag.noFreeze").length;a.length>0&&null!=a&&0==$("dvheaderScrollFIxed").length&&(0==$(".dvheaderScrollFIxed").length&&0==d&&($(".page_initial_loading_hide").addClass("oH"),a.addClass("dvheaderScrollFIxed"),detailView.setDetailViewNewLeftPanelPropOnScroll()),n.length&&n.addClass("dvtabsFixed"),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300))}else a.length>0&&null!=a&&($(".dvheaderScrollFIxed").length>0&&(detailView.setDetailViewNewLeftPanelProp(),a.removeClass("dvheaderScrollFIxed")),n.length&&n.removeClass("dvtabsFixed"),setTimeout((function(){$(".page_initial_loading_hide").removeClass("oH")}),300))}function showROI(e){var t;$(e).is(":checked")?($("#closed_camp_roi").addClass("hide"),$("#open_camp_roi").removeClass("hide"),t=parseInt($("#open_camp_roi").text()),$("#pipeline_span,#pipeline_div").removeClass("dN").addClass("dIB")):($("#open_camp_roi").addClass("hide"),$("#closed_camp_roi").removeClass("hide"),$(e).attr("checked",!0),t=parseInt($("#closed_camp_roi").text()),$("#pipeline_span,#pipeline_div").addClass("dN").removeClass("dIB")),t>0?$("#roi_icon").removeClass("marAttrRedArrow").addClass("marAttrGreenArrow"):0==t?$("#roi_icon").removeClass("marAttrRedArrow marAttrGreenArrow"):$("#roi_icon").removeClass("marAttrGreenArrow").addClass("marAttrRedArrow")}function showHideDetail(){var e="true",t=document.getElementById("iskanbanview"),i=$("#fullInfoDiv"),a=$("#showHideDetail");if($("span").removeClass("highlightNewLookupField"),i.length>0&&a.length>0&&(i.is(":visible")?i.is(":visible")&&($("#showhideDetailsDiv").removeClass("showhideDetailsDivHide"),t&&"true"===t.value&&$("#taskMore").removeClass("dotIconTkvViewed"),e="false",$("#fullInfoDiv").slideUp({complete:detailView.bindScroll}),$("#showHideDetail").removeClass("hideDetailArrow"),$("#showHideDetail").html(I18n.getMsg("crm.button.show.details")),$(".showhideDetailsDivEleInner").attr("onclick","showHideDetail()").addClass("cP"),setTimeout((function(){$(".dvdetailshidden").show()}),300)):(t&&"true"===t.value&&$("#taskMore").addClass("dotIconTkvViewed"),e="true",$("#showhideDetailsDiv").addClass("showhideDetailsDivHide"),$("#fullInfoDiv").slideDown({complete:detailView.bindScroll}),$("#showHideDetail").addClass("hideDetailArrow"),$("#showHideDetail").html(I18n.getMsg("crm.button.hide.details")),$(".dvdetailshidden").hide(),$(".showhideDetailsDivEleInner").attr("onclick","").removeClass("cP")),!Crm.userDetails.CLIENT_ACCOUNT)){var n=Crm.getCrmBasePath()+"/EntityCustomization.do",s={action:"openDv",dvAction:e};s[csrfParamName]=encodeURIComponent(csrfToken),mR(n,(function(e){}),s)}}function showCurrentTab(){var e=getObj("menuContent"),t=getObj("menuincreate");t&&($(e).empty(),e.innerHTML=t.innerHTML)}function navigateCV(e){var t=(pageObj=document.getElementsByName("pfrom")[0])?pageObj.value:null,i=getObj("cvFromIndex"),a=getObj("cvToIndex");if(null===t||"null"===t||crmNavig[crmNavig.customViewKey]){if(-1!==crmHistory.getPrevListView().route.indexOf("search")){!l&&i&&a&&(l=i.value,d=a.value);var n=parseInt(d)-parseInt(l)+1;e&&"next"===e?(l=parseInt(d)+1,d=parseInt(d)+n):e&&"previous"===e&&(l=parseInt(l)-n,d=parseInt(d)-n);var s=crmNavig.fetchNextSetUrl(l,d,crmHistory.getPrevListView().url,crmNavig.customViewKey,void 0,"true");mR(s,(function(e){placeRes(e,void 0,s)}),void 0,void 0,void 0,"true"),crmNavig.parseCurrentListView("true")}else if(crmNavig[crmNavig.customViewKey].rpURl){var r=networkUtils.parseUrl(crmNavig[crmNavig.customViewKey].rpURl);l=$("input[name=fromIndex]"),d=$("input[name=toIndex]");l.length&&d.length&&(l=parseInt(l[0].value),d=parseInt(d[0].value)),i&&a&&(l=i.value,d=a.value);n=parseInt(d)-parseInt(l)+1;(e&&"next"===e||e&&"previous"===e)&&(r.params[e]=!0),r.params.FROM_INDEX=l,r.params.TO_INDEX=d,delete r.params.forRp,(_=$("#cvRangeValue"))&&(r.params.range=parseInt(_.val()));var o=networkUtils.constructUrl(Crm.getCrmBasePath()+"/"+r.action+".do",r.params);(new crmRequestPool).initiate({type:"GET",url:o,dataType:"text",success:function(e){placeRes(e,void 0,o),crmNavig.parseCurrentListView("true")}})}else if(cvUrlInfo.hasOwnProperty("CV_URL")){o=decodeURIComponent(cvUrlInfo.CV_URL);new AjaxAPI({id:"rightPanel",url:o,callbackfn:function(){assignRurl()}}).get()}}else{var l,d,c="&pfrom="+t,u="",m="&FROM_INDEX="+(l="1")+"&TO_INDEX="+(d="10"),p="",v="",g="",f="",h=getObj("cvid");if("cv"==t)(h=getObj("cvid"))&&"null"!=h.value&&(f="&cvid="+h.value),(h=crmListView.getObject()).module===Crm.activityGrp[params.module]&&crmListView.getAdvSearchCrtFromCVObject(params);else if("rel"==t){var C=document.getElementsByName("pn")[0],w=document.getElementsByName("peId")[0],y=document.getElementsByName("bMod")[0];null!=C&&"null"!=C.value&&(p="&pn="+C.value),null!=w&&"null"!=w.value&&(v="&peId="+w.value),null!=y&&"null"!=y.value&&(g="&bMod="+y.value)}i&&a&&(l=i.value,d=a.value,m="&FROM_INDEX="+l+"&TO_INDEX="+d),h&&"null"!=h.value&&null!=h.value&&"&cvid="+h.value,"next"==e?u="next=true":"previous"==e&&(u="previous=true");var _=$("#cvRangeValue"),b="";_&&(b="&range="+parseInt(_.val())),Lyte.injectResources(networkUtils.returnDependencyFiles(["phone-entity.js","call-fromto-field.js","calls-cvcard.js","crux-lookupfilter-component.js","crux-column-list.js","entity-field.js","businesscard_model.js"],ResourceConstants.CRMClient),void 0,(function(){var e=Crm.getCrmBasePath()+"/RelActCV.do?"+u+c+f+p+v+g+m+b;(new crmRequestPool).initiate({type:"GET",url:e,dataType:"text",success:function(t){placeRes(t,void 0,e)}})}))}thirdPartyUtils.bindPerfectScroll("#rightPanelInfo",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1}),$("#rightPanelInfo").addClass("oH")}function openBusinessInfoPopup(e){var t=networkUtils.returnDependencyFiles(["skyeye-account.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("skyeye")],ResourceConstants.CRM),a=networkUtils.returnDependencyFiles(["crm-skyeye-account.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),n=t.concat(i).concat(a);Lyte.injectResources(n,void 0,(function(){var t=store.peekRecord("skyeye_account",e);void 0===t?(commonUtils.showHideLoadingDiv(!0),store.findAll("skyeye_account",{source_id:e}).then((function(e){commonUtils.showHideLoadingDiv(!1),e.length>0?Lyte.Component.render("skyeye-popup",{skyeyeAccountData:e[0]},"#topBandPopup"):($L(".noDataTTWrapper").addClass("noDataTTShow"),setTimeout((function(){$L(".noDataTTWrapper").removeClass("noDataTTShow")}),5e3))}))):Lyte.Component.render("skyeye-popup",{skyeyeAccountData:t},"#topBandPopup")}))}function setInfoIconNearEmailFeild(e,t,i,a,n,s,r,o){var l="<crmutil-icon data-zcqa='ebm_block_icon_"+$L("#id").val()+"' icon-name='alert-filled' icon-class='zcicn-alert-filled zcicn12  zcicn_sandal' id='bounceicon' onmouseenter='showBounceMsgTooltip(this)' onmouseleave='$(\"#newToolTipPop\").remove()' class ='bmPrimaryEmail mL5 cP vaM emailUnblocking'></crmutil-icon>";if(detailView.pmEmailRes=void 0,detailView.pmEmailBounceType=void 0,detailView.pmEmailInfoIcon=void 0,detailView.secEmailRes=void 0,detailView.secEmailBounceType=void 0,detailView.secEmailInfoIcon=void 0,e&&"null"!==e){var d=$L(l).removeClass("fR mT3").addClass("dIB");detailView.pmEmailRes=e,detailView.pmEmailBounceType=i,detailView.pmEmailBounceCategory=n,detailView.pmEmailUnblockCount=r,detailView.pmEmailInfoIcon=d,setTimeout((function(){0!==$L("#value_EMAIL").length&&0===$L("#value_EMAIL .emailUnblocking").length&&$(d).insertAfter("span#value_EMAIL a").attr("data",e).attr("bounce_Type",i).attr("bounce_Category",n).attr("unblock_Count",r).attr("is_Primary",!0),d=$L(l).removeClass("fR mT3 bmPrimaryEmail").addClass("dIB bmHeaderPrimaryEmail"),0===$L("#headervalue_EMAIL .emailUnblocking").length&&$(d).insertAfter("#header_EMAIL #subvalue_EMAIL").attr("data",e).attr("bounce_Type",i).attr("bounce_Category",n).attr("unblock_Count",r).attr("is_Primary",!0).attr("email_Address",$L("#subvalue_EMAIL").text())}),200)}else $("#value_EMAIL .emailUnblocking").remove("#value_EMAIL .emailUnblocking "),$("#headervalue_EMAIL .emailUnblocking").remove("#headervalue_EMAIL .emailUnblocking");if(t&&"null"!==t){var c=$L(l).removeClass("fR mT3 bmPrimaryEmail bmHeaderPrimaryEmail").addClass("dIB bmSecondaryEmail");detailView.secEmailRes=t,detailView.secEmailBounceType=a,detailView.secEmailBounceCategory=s,detailView.secEmailUnblockCount=o,detailView.secEmailInfoIcon=c,setTimeout((function(){0!==$L("#value_ADDN_EMAIL").length&&0===$L("#value_ADDN_EMAIL .emailUnblocking").length&&$(c).insertAfter("span#value_ADDN_EMAIL a").attr("data",t).attr("bounce_Type",a).attr("bounce_Category",s).attr("unblock_Count",o).attr("is_Primary",!1),c=$L(l).removeClass("fR mT3 bmPrimaryEmail bmHeaderPrimaryEmail bmSecondaryEmail").addClass("dIB bmHeaderSecondaryEmail"),0===$L("#headervalue_ADDN_EMAIL .emailUnblocking").length&&$(c).insertAfter("#headervalue_ADDN_EMAIL #subvalue_ADDN_EMAIL").attr("data",t).attr("bounce_Type",a).attr("bounce_Category",s).attr("unblock_Count",o).attr("is_Primary",!1).attr("email_Address",$L("#subvalue_ADDN_EMAIL").text())}),200)}else $("#value_ADDN_EMAIL .emailUnblocking").remove("#value_ADDN_EMAIL .emailUnblocking "),$("#headervalue_ADDN_EMAIL .emailUnblocking").remove("#headervalue_ADDN_EMAIL .emailUnblocking")}function showBounceMsgTooltip(e){$("#newToolTipPop").remove();var t=$L(e).attr("data"),i="false"!==$L(e).attr("is_Primary"),a=i?detailView.pmEmailBounceType:detailView.secEmailBounceType,n=i?detailView.pmEmailBounceCategory:detailView.secEmailBounceCategory,s=i?detailView.pmEmailUnblockCount:detailView.secEmailUnblockCount,r=$L(e).attr("email_Address"),o="<p>"+I18n.getMsg("crm.detailview.email.bounce.category")+".</p>",l=I18n.getMsg("crm.detailview.field.tooltip.bounceheading")+":",d="."+$L(e).attr("class").split(/\s+/).find((e=>e.includes("Email")));"6"!==a&&"7"!==a&&"8"!==a&&"9"!==a&&"10"!==a?Crm.userDetails.EMAIL_BOUNCE_MANAGEMENT?EmailUnblocking.unblockEmail(r,i,t,n,a,s,moduleApiMapping[$L("#module").val()],$L("#id").val(),d):$("body").append('<div id="newToolTipPop" style="z-index: 100;" class="p15"><div class="tooltipPointerArrow"></div> <span class="crm-font-xbold crm-small-font-size fL cBoth">'+o+'</span><span class="crm-font-xbold crm-small-font-size mT10 fL cBoth mB5">'+l+'</span><p class="crm-font-regular crm-small-font-size cBoth">'+t+"</p></div>"):$("body").append('<div id="newToolTipPop" style="z-index: 100;" class="p15"><div class="tooltipPointerArrow"></div><p class="crm-font-xbold crm-small-font-size fL cBoth">'+I18n.getMsg(t)+"</p></div>");var c=$(e).offset();if(crmNTC.windowSize.wwidth>c.left+$("#newToolTipPop").outerWidth())$("#newToolTipPop").css({top:c.top+$(e).outerHeight()+10,left:c.left-10});else{$("#newToolTipPop").css({top:c.top+$(e).outerHeight()+10,right:"10px"});var u=c.left-$("#newToolTipPop").offset().left;$(".tooltipPointerArrow").css({left:u})}}function getDataPrivacy(e,t){detailView.dataPrivacyHeight(),$(".tb_newmenu a").removeClass("sel"),t=t||"sel",$(e).addClass(t);var i=$("#dataPrivacyContainerDiv");""!==trimBoth(i.html())?(i.show(),detailView.switchTab(e,"DataPrivacy")):networkUtils.loadFeatureScripts(["zcrm_dataprivacy_view_new.js"],(function(){DataPrivacy.loadDataPrivacy(e)})),"undefined"!=typeof DataPrivacy&&($("li[data-zcqa='consentProcessingDetail']").click(),DataPrivacy.resetConsentCounters())}function setUnsubscribeInfoBusinessCardEmailField(e){if(e&&Crm.isUnsubscribeEnabled)for(var t=e.split("~::~"),i=t.length-1,a=0;a<i;a++){var n=t[a].split("=");$("#headervalue_"+n[0]+" .svgErrorIcon").remove();var s="<i id='bounceicon' onclick='sE(event);' onmouseenter='showUnsubscribeInfoTooltip(this)' data-mode='"+n[2]+"' data-time='"+n[1]+"' onmouseleave='$(\"#newToolTipPop\").remove()' class ='unsubscribeInfo svgIconsImg svgErrorIcon mL3 fR mT3 vaT mT5'></i>",r=$(s).removeClass("fR mT3").addClass("dIB");if(0!==$("#headervalue_"+n[0]).length){var o=$("span#headervalue_"+n[0]),l=o.find("a");o.addClass("unsubsInfoWrap"),l.append(r.attr("data-mode",n[2]).attr("data-time",n[1]))}}}function setUnsubscribeInfoNearEmailField(e){if(e&&Crm.isUnsubscribeEnabled){for(var t=e.split("~::~"),i=t.length-1,a=0;a<i;a++){var n=t[a].split("=");$("#value_"+n[0]+" .svgErrorIcon").remove();var s="<i id='bounceicon' onclick='sE(event);' onmouseenter='showUnsubscribeInfoTooltip(this)' data-mode='"+n[2]+"' data-time='"+n[1]+"' onmouseleave='$(\"#newToolTipPop\").remove()' class ='unsubscribeInfo svgIconsImg svgErrorIcon mL3 fR mT3 vaT mT5'></i>",r=$(s).removeClass("fR mT3").addClass("dIB");if(0!==$("#value_"+n[0]).length){var o=$("span#value_"+n[0]),l=o.find("a");o.addClass("unsubsInfoWrap"),l.append(r.attr("data-mode",n[2]).attr("data-time",n[1]))}}setTimeout((function(){setUnsubscribeInfoBusinessCardEmailField(e),$("#headervalue_EMAILOPTOUT").find("#yes_EMAILOPTOUT").addClass("unsubsOptoutCard"),$("#value_EMAILOPTOUT").find("#yes_EMAILOPTOUT").addClass("unsubsOptoutDetails")}),10)}}function showUnsubscribeInfoTooltip(e){var t=$(e),i=t.attr("data-time"),a=t.attr("data-mode");a&&(a=I18n.getMsg(a));var n=I18n.getMsg("crm.unsubscription.reason.tooltip"),s="<p class='crm-small-font-size'>"+I18n.getMsg("crm.unsubscribed.mode")+": "+a+"<br>"+I18n.getMsg("crm.unsubscribed.time")+": "+i+"</p>",r=t.offset(),o=r.left,l=t.outerHeight();$("body").append('<div id="newToolTipPop" style="z-index: 100;width:auto;" class="p15"><div class="tooltipPointerArrow"></div><span class="crm-font-bold crm-small-font-size fL cBoth">'+n+"</span><br>"+s+"</div>");var d=$("#newToolTipPop");if(crmNTC.windowSize.wwidth>o+d.outerWidth())d.css({top:r.top+l+10,left:o-10});else{d.css({top:r.top+l+10,right:"10px"});var c=o-d.offset().left;$(".tooltipPointerArrow").css({left:c})}}function updateRecordUnsubscribeInfo(e,t,i,a){e&&setUnsubscribeInfoNearEmailField(e);var n=$("#no_EMAILOPTOUT"),s=$(".unsubInfo");if(t){var r=$("#mouseArea__EMAILOPTOUT");if(i){var o=[];o[0]="value_EMAILOPTOUT",o[1]="headervalue_EMAILOPTOUT";for(var l=o.length,d=0;d<l;d++){var c=$("#"+o[d]);if(c&&c.length>0){for(var u,m=c.find("#yes_EMAILOPTOUT"),p=c.find("span"),v=p.length,g=0;g<v;g++){var f=p.eq(g),h=f.attr("id");if(h&&"no_EMAILOPTOUT"==h){u=f;break}}if(m.addClass("unsubsOptout"),m.css({display:"inline-block"}),a)c.find(".unsubInfo").remove(),$("<span id='emailOptOutInfo' class='unsubInfo' data-param='"+a+"' onmouseover='detailView.showUnsubInfoMsgTooltip(this);' onclick='sE(event);' onmouseout='crmui.hideTooltip();'></span>").insertAfter(m),u.hide();else u.show()}}r.data("params").defaultvalue="true"}else{r.length&&(r.data("params").defaultvalue="false");var C=s?s.length:0;for(d=0;d<C;d++){var w=s[d];$(w.previousElementSibling).hide(),w.remove()}}}a&&i?n.hide():n.show()}Handlebars.registerHelper("isClientPortal",(function(){return!!Crm.userDetails.CLIENT_ACCOUNT})),Handlebars.registerHelper("isRelatedListRequiredInLeftPanel",(function(e,t){return"NOTESPERSONALITY"===e.name||"Appointments_Rescheduled_History__s"===moduleApiMapping[e.module]||moduleRecordMapping.CalendarBookings&&e.module===moduleRecordMapping.CalendarBookings.module_name&&(!Crm.userDetails.permissions.Crm_Implied_Manage_CalendarBooking||"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME)?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("isRelatedListRequiredInDetailView",(function(e,t){return"NOTESPERSONALITY"===e.name||"Appointments_Rescheduled_History__s"===moduleApiMapping[e.module]||"JOBSHEETSPERSONALITY"===e.name&&!CSU.isJobSheetSupported||moduleRecordMapping.CalendarBookings&&e.module===moduleRecordMapping.CalendarBookings.module_name&&(!Crm.userDetails.permissions.Crm_Implied_Manage_CalendarBooking||"SupportProfileInternal"===Crm.userDetails.PROFILE_NAME)?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("canChangeOwner",(function(e,t,i){return"true"==e.readonly||!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+t]||Crm.userDetails.PERSONAL_ACCOUNT||void 0!==detailView.recordLocked&&1==detailView.recordLocked?i.inverse(this):i.fn(this)})),Handlebars.registerHelper("getClassForStage",(function(e){var t="";return e&&("Closed Won"===e.fctype?t+="PStageclosedWon":"Closed Lost"===e.fctype&&(t+="PStageclosedLost")),t})),Handlebars.registerHelper("showSendMail",(function(e,t){if(e&&["Leads","Contacts","Accounts","Potentials","Vendors","Cases","Quotes","SalesOrders","PurchaseOrders","Invoices"].indexOf(e)>0||0===e.indexOf("CustomModule")||0===e.indexOf("LinkingModule")&&!crmTab.isZBCustomModule(e)&&!crmTab.isZSCustomModule(e))return t.fn(this)})),Handlebars.registerHelper("checkCurrentModule",(function(e,t){return detailView&&detailView.currentModule===e||$("#module").val()===e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("addDatZcqaChk",(function(e,t,i){for(var a=e.length,n=0;n<a;n++)if(e&&"PROCESSID"===e[n].COLUMNNAME){if(i){a=i.body.length;for(var s=0;s<a;s++)if(i.body[s].ENTITYID===t)return $ESAPI.encoder().encodeForHTML(i.body[s].CONTENT[n])}return!1}})),Handlebars.registerHelper("addDatZcqa",(function(e,t,i){var a=e.length;if(!Crm.userDetails.permissions.Crm_Implied_Manage_UnEnroll_Series)return!0;if(i&&i.isLocked)return!0;for(var n=0;n<a;n++)if(i&&("ENDDATE"===e[n].COLUMNNAME||"MEMBER_STATUS"===e[n].COLUMNNAME))for(var s=i.body.length,r=0;r<s;r++)if(i.body[r].ENTITYID===t){if("ENDDATE"===e[n].COLUMNNAME&&""!==i.body[r].CONTENT[n]||"MEMBER_STATUS"===e[n].COLUMNNAME&&"Un-enrolled"===i.body[r].CONTENT[n])return!0;break}return!1})),Handlebars.registerHelper("addOnClick",(function(e,t,i){if(e&&"CrmEntitySeries"===e[t].TABLENAME&&"PROCESSID"===e[t].COLUMNNAME)return Crm.userDetails.isRelatedListLyteEnabled?"Lyte.registeredMixins['crm-related-list-utils'].OpenSeriesPop("+JSON.stringify(i)+")":"crmRelatedList.OpenSeriesPop("+JSON.stringify(i)+")"})),Handlebars.registerHelper("toggleTextarea",(function(e,t){e.forBC&&(e.layout="2");var i=e.defaultvalue;return new Handlebars.SafeString(renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(i)))})),Handlebars.registerHelper("getClassForLVDataDV",(function(e,t,i,a){var n="list"==a?e.ui_type:e[t].UITYPE,s="list"==a?e.SYS_REF_NAME:e[t].SYS_REF_NAME;if(!a){if("SMOWNERID"===e[t].COLUMNNAME||"SMCREATORID"===e[t].COLUMNNAME||"MODIFIEDBY"===e[t].COLUMNNAME)return"lv_data_textfield lv_data_username";if(isnewCalendarBookingEnabled&&"CALFORMSTATUS"===e[t].COLUMNNAME)return"lv_data_textfield "+s;if(36==n||77==n||116==n&&"DOUBLE"==e[t].TYPE)return"lv_data_currency alignRight"}return 25==n?"lv_data_email":"CrmEntitySeries"===e[t].TABLENAME&&"PROCESSID"===e[t].COLUMNNAME?"lv_data_textfield link":127==n||1==n||4==n||133==n||9==n||5==n||13==n?"lv_data_textfield "+s:33==n||6==n||7==n||35==n||124==n||200==n?"lv_data_phone":32==n||38==n||52==n||333==n||786==n||14==n||24==n||202==n?"lv_data_number":3==n||110===n?"lv_data_desc":"lv_data_textfield"})),Handlebars.registerHelper("getImageDataForCrux",(function(e,t){if(t&&"setup"!==this.currentStatus&&"clientPortal"!==this.isFrom){var i="vlabel_"+e.colname,a=Lyte.registeredMixins["crm-uploadfields-mixin"].getCruxImageUploadComponents(i,"view"),n=a?a.getData("images"):[];return JSON.stringify(n)}if(!e.defaultvalue)return{};var s=e.module;s||(s=e.extraDetails.module);var r=Lyte.registeredMixins["crm-uploadfields-mixin"].constructImageDataFromServer(e.defaultvalue,s,detailView.entityId,e.fieldid);return JSON.stringify(r)})),Handlebars.registerHelper("setToolTipForZiaVision",(function(e){return"setup"===this.currentStatus?"":(t=e.defaultvalue?e.defaultvalue:Lyte.registeredMixins["crm-uploadfields-mixin"].getCruxImageUploadComponents("vlabel_"+e.colname,"view"),Lyte.registeredMixins["crm-uploadfields-mixin"].setTooltipValue(t));var t})),Handlebars.registerHelper("getMaximumAllowedSize",(function(e){return Lyte.registeredMixins["crm-uploadfields-mixin"].formatBytes(e.maximum_allowed_size)})),Handlebars.registerHelper("setAttachmentsUrl",(function(e,t){return"setup"===this.currentStatus?"":JSON.stringify(Lyte.registeredMixins["crm-uploadfields-mixin"].setAttachmentsUrl(e,t))})),detailView.getCurrentCampaignType=function(){return returnJson.Campaigns&&returnJson.Campaigns.CAMPAIGN_TYPE?returnJson.Campaigns.CAMPAIGN_TYPE:0},detailView.isCampaignStripNeeded=function(){return!Crm.userDetails.CLIENT_ACCOUNT&&-1!==[0,1,2,3,4,5,7].indexOf(detailView.getCurrentCampaignType())},detailView.isZohoCampaign=function(){return-1!==[1,2,3,6,8].indexOf(detailView.getCurrentCampaignType())},detailView.isZohoSurveyCampaign=function(){return 5===detailView.getCurrentCampaignType()},detailView.isZohoSurveyCampaignAndSurveyEnabled=function(){return detailView.isZohoSurveyCampaign()&&detailView.isZohoSurveyEnabled()},detailView.isZohoSurveyEnabled=function(){return returnJson.Campaigns&&returnJson.Campaigns.surveyEnabled&&1==returnJson.Campaigns.surveyEnabled},detailView.isSurveyOrWebinarCampaign=function(){return-1!==[4,5].indexOf(detailView.getCurrentCampaignType())},detailView.isIntegCampaign=function(){return-1!=[1,2,3,4,5,7,8].indexOf(detailView.getCurrentCampaignType())},detailView.isBackstageCampaign=function(){return 7==detailView.getCurrentCampaignType()&&returnJson.Campaigns&&returnJson.Campaigns.backstageIntegEnabled},detailView.showEmailPopup=function(){return detailView.isSurveyOrWebinarCampaign()},Handlebars.registerHelper("isZohoCampaign",(function(e){return detailView.isZohoCampaign()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isCampaignStripNeeded",(function(e){return detailView.isCampaignStripNeeded()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("moduleShowHide",(function(e){return Crm.userDetails.MODULE_LIST[e]?"show":"hide"})),Handlebars.registerHelper("isUnsentZohoCampaign",(function(e){return-1!==[6,8].indexOf(detailView.getCurrentCampaignType())?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isSurveyEnabled",(function(e){return detailView.isZohoSurveyEnabled()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("getColorCodePLParentClass",(function(e,t){if(!detailView.apiNameVsColName||!detailView.apiNameVsColName[t])return"";var i=returnJson.entityMapJson[detailView.apiNameVsColName[t]];return i&&i.colorcode_enabled?e&&""!==(e+"").trim()&&"-None-"!==e?"colorAppliedPicklist":"colorAppliedPicklist colorAppliedPKNone":""})),Handlebars.registerHelper("isRichtextField",(function(e,t){var i=detailView.currentModule;if(!i){var a=$L("#module");if(a.length>0)i=a[0].value;else{var n=$L("crm-detail-view-data-privacy");n.length>0&&n[0].component&&(i=n[0].component.getData("module"))}}if(!i)return t.inverse(this);var s=store.peekAll("field",{module:Crm.moduleInfo[i].apiname}).filter((function(t){return t.api_name===e}))[0];return s&&250===s.ui_type?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("isZohoSurveyCampaignAndSurveyEnabled",(function(e){return detailView.isZohoSurveyCampaignAndSurveyEnabled()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("isBackstageCampaign",(function(e){return detailView.isBackstageCampaign()?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("setServiceDuration",(function(e){var t=detailView.converMinToHourAndMin(parseInt(e));return t.length>1?detailView.constructDurationTxt(t[0],t[1]):""})),Handlebars.registerHelper("FormatValueDisplay",(function(e,t){return e&&80==e.uitype?Handlebars.helpers.setServiceDuration(t):e&&132==e.uitype&&t?Handlebars.helpers.safeEncodeHTML(t)+" - <i>"+Handlebars.helpers.safeEncodeHTML(e.defaultvalue1)+"</i>":Handlebars.helpers.safeEncodeHTML(t)})),detailView.getReadableRecurringPattern=function(e){var t="";if(""!=e){var i=e.split("*#");if("weekly"==i[0]){var a=null,n=1,s=null;1==(f=i[2].split("^")).length?(a=3,s=Utils.getDateInUserDatePattern(new Date(parseInt(f[0])))):"-1"==f[0]?a=1:(a=2,n=f[0]);var r=i[4],o=i[3].split("^^");if(1==o.length&&1==r)t=1==a?I18n.getMsg("crm.recurrence.week.option1"):2==a?I18n.getMsg("crm.recurrence.week.option1.end2",n):I18n.getMsg("crm.recurrence.week.option1.end3",s);else{var l="",d=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],c=o.length,u=!1,m=[0,0,0,0,0,0,0,0];if(c>4&&7!=c){u=!0;for(var p=0;p<c;p++)m[o[p]-1]=1}if(u)for(var v=0;v<7;v++)m[v]||(l=l+d[v]+",");else for(var g=0;g<c;g++)l=l+d[o[g]-1]+",";l=l.substring(0,l.length-1),t=1==r?u?1===a?I18n.getMsg("crm.recurrence.week.except.custom.option1",l):2===a?I18n.getMsg("crm.recurrence.week.except.custom.option1.end2",[l,n]):I18n.getMsg("crm.recurrence.week.except.custom.option1.end3",[l,s]):1===a?I18n.getMsg("crm.recurrence.week.custom.option1",l):2===a?I18n.getMsg("crm.recurrence.week.custom.option1.end2",[l,n]):I18n.getMsg("crm.recurrence.week.custom.option1.end3",[l,s]):u?1===a?I18n.getMsg("crm.recurrence.week.except.custom.option2",[r,l]):2===a?I18n.getMsg("crm.recurrence.week.except.custom.option2.end2",[r,l,n]):I18n.getMsg("crm.recurrence.week.except.custom.option2.end3",[r,l,s]):1===a?I18n.getMsg("crm.recurrence.week.custom.option2",[r,l]):2===a?I18n.getMsg("crm.recurrence.week.custom.option2.end2",[r,l,n]):I18n.getMsg("crm.recurrence.week.custom.option2.end3",[r,l,s])}}else{var f;if(1==(f=i[3].split("^")).length?(a=3,s=Utils.getDateInUserDatePattern(new Date(parseInt(f[0])))):"-1"==f[0]?a=1:(a=2,n=f[0]),"daily"==i[0]){r=i[4];t=1==i[1]||1==r?1==a?I18n.getMsg("crm.recurrence.daily.option1"):2==a?I18n.getMsg("crm.recurrence.daily.option1.end2",n):I18n.getMsg("crm.recurrence.daily.option1.end3",s):1==a?I18n.getMsg("crm.recurrence.daily.custom.option1",r):2==a?I18n.getMsg("crm.recurrence.daily.custom.option1.end2",[r,n]):I18n.getMsg("crm.recurrence.daily.custom.option1.end3",[r,s])}else if("monthly"==i[0]){var h=i[1];r=1==h?i[5]:i[6];if(1==h&&1==r)t=1==a?I18n.getMsg("crm.recurrence.month.option1"):2==a?I18n.getMsg("crm.recurrence.month.option1.end2",n):I18n.getMsg("crm.recurrence.month.option1.end3",s);else if(1==h){var C=i[4];t=1==a?I18n.getMsg("crm.recurrence.month.custom.option1.recur",[r,C]):2==a?I18n.getMsg("crm.recurrence.month.custom.option1.recur.end2",[r,C,n]):I18n.getMsg("crm.recurrence.month.custom.option1.recur.end3",[r,C,s])}else{i[4]="-1"===i[4]?"6":i[4];var w=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercasefifth"),I18n.getMsg("lowercaselast")];d=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];t=1==r?1==a?I18n.getMsg("crm.recurrence.month.custom.option2",[w[i[4]-1],d[i[5]-1]]):2==a?I18n.getMsg("crm.recurrence.month.custom.option2.end2",[w[i[4]-1],d[i[5]-1],n]):I18n.getMsg("crm.recurrence.month.custom.option2.end3",[w[i[4]-1],d[i[5]-1],s]):1==a?I18n.getMsg("crm.recurrence.month.custom.option2.recur",[r,w[i[4]-1],d[i[5]-1]]):2==a?I18n.getMsg("crm.recurrence.month.custom.option2.recur.end2",[r,w[i[4]-1],d[i[5]-1],n]):I18n.getMsg("crm.recurrence.month.custom.option2.recur.end3",[r,w[i[4]-1],d[i[5]-1],s])}}else if("yearly"==i[0]){var y=i[1];r=1==y?i[6]:i[7];if(1==y)t=1==a?I18n.getMsg("crm.recurrence.yearly.option1"):2==a?I18n.getMsg("crm.recurrence.yearly.option1.end2",n):I18n.getMsg("crm.recurrence.yearly.option1.end3",s);else{w=[I18n.getMsg("lowercasefirst"),I18n.getMsg("lowercasesecond"),I18n.getMsg("lowercasethird"),I18n.getMsg("lowercasefourth"),I18n.getMsg("lowercasefifth"),I18n.getMsg("lowercaselast")],d=[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")];var _=[I18n.getMsg("January"),I18n.getMsg("February"),I18n.getMsg("March"),I18n.getMsg("April"),I18n.getMsg("May"),I18n.getMsg("June"),I18n.getMsg("July"),I18n.getMsg("August"),I18n.getMsg("September"),I18n.getMsg("October"),I18n.getMsg("November"),I18n.getMsg("December")];i[4]="-1"===i[4]?"6":i[4],t=1==a?I18n.getMsg("crm.recurrence.yearly.custom.option2",[w[i[4]-1],d[i[5]-1],_[i[6]]]):2==a?I18n.getMsg("crm.recurrence.yearly.custom.option2.end2",[w[i[4]-1],d[i[5]-1],_[i[6]],n]):I18n.getMsg("crm.recurrence.yearly.custom.option2.end3",[w[i[4]-1],d[i[5]-1],_[i[6]],s])}}}}return t},detailView.showBtnoptDD=function(e){"Appointments"===detailView.currentModule&&Lyte.resolvePromises({filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_services.js"],ResourceConstants.CRM).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")],ResourceConstants.CRM)).concat(networkUtils.returnDependencyFiles(["business_hours-model.js","crm-services-appointments.js","servapp_preferences_model.js"],ResourceConstants.CRMClient)))});e=$(e);var t=$(".ddM"),i=e.offset().top+e.outerHeight(),a=e.offset().left-$(".rep_runreportPop").outerWidth()+25,n=$("#editOptdropdown");n.is(":visible")?n.hide():(n.css({top:i,left:a}).show(),t.hide())},detailView.showMoreContactDetails=function(e){$("#newRelModule_"+e).find("table").css({display:"block"}),$("#showMore_"+e).css({display:"none"})};