Lyte.Mixin.register("crm-vision-validation",{getDeleteDetails:function(){var e={};e["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken,e["X-CRM-ORG"]=crmZgid;var a=window.location.host;return window.clientPortalName&&(e["X-CRMPORTAL"]=window.clientPortalName),{url:"https://"+a+"/crm/zia/visions/v3/image_zips",headers:e}},isUploadedImagesCountExceeded:function(){var e=$L("#desktopVision")[0].component.data.files_attached_in_desktop,a=0;if(e){for(var i=e.length,s=!1,t=0;t<i;t++){var l=e[t];"success"===l.status?a+=l.count:s=!0}return!0===s&&$L("#file_attach_Vision")[0].ltProp("disabled",!0),a}},deleteUploadData:function(e,a,i){return new Promise((function(){$L.ajax({url:e.url,type:"DELETE",headers:e.headers,data:JSON.stringify(a),xhrFields:{withCredentials:!0},success:function(e){commonUtils.showHideLoadingDiv(!1);var s=e.response;if(s.deleted_tag_ids&&s.deleted_tag_ids.length===a.tag_ids.length){if(!i)return;i()}},error:function(){commonUtils.showHideLoadingDiv(!1)}})}))},showSampleImages:function(e,a,i){var s=e.getData("visionId"),t=[];if(a){function l(e,a){var i=e.model_details?e.model_details.findIndex((e=>"gallery"===e.type)):-1,s={};return s.id=e.id,s.name=e.name,s.has_gallery=i>=0,s.sub_config_type=a.capitalize(),s}var d={};i?(a.training_details&&a.training_details.labels&&a.training_details.labels.forEach((e=>{i===e.id&&(d=l(e,"detect"))})),a.desired_set&&a.desired_set.labels&&a.desired_set.labels.forEach((e=>{i===e.id&&(d=l(e,"match"))})),a.undesired_set&&a.undesired_set.labels&&a.undesired_set.labels.forEach((e=>{i===e.id&&(d=l(e,"match"))}))):(a.training_details&&a.training_details.labels&&a.training_details.labels.forEach((e=>{t.push(l(e,"detect"))})),a.desired_set&&a.desired_set.labels&&a.desired_set.labels.forEach((e=>{t.push(l(e,"match"))})),a.undesired_set&&a.undesired_set.labels&&a.undesired_set.labels.forEach((e=>{t.push(l(e,"match"))})),d=t[0])}if(d){function n(a){if(a){var i=a.images?function(e){var a=[];if(e)for(var i=e.length,s=0;s<i;s++){var t=e[s],l={};l.image_url=t.url,a.push(l)}return a}(a.images):a;e.setData("validationImages",[]),e.setData("validationImages",i.slice(0,6)),$L("#visionSamplesModal")[0].ltProp("show",!0)}}i||(e.setData("sample_selected_label_name",""),e.setData("sample_selected_label_id",""),e.setData("sample_images_label_arr",[]),e.setData("sample_selected_label_name",d.name),e.setData("sample_selected_label_id",d.id),e.setData("sample_images_label_arr",t)),d.has_gallery?Lyte.registeredMixins["crm-vision-image-utils"].getGalleryImages(s,d.id,n):Lyte.registeredMixins["crm-vision-image-utils"].getVisionImages(s,["trained"],[d.id],void 0,["upload","suggestion"]).then((e=>{var a={};e&&Object.keys(e).length>0?a=e:a.images=[],n(a)}))}},deleteImagesCall:function(e){var a=this.getDeleteDetails();this.deleteUploadData(a,e)},getAllLabelIdsOfVision(e){var a=[];return e.training_details&&e.training_details.labels&&e.training_details.labels.forEach((e=>{var i={};i.name=e.name,i.id=e.id,i.sub_config_type=e.validation_type.split("_")[0],a.push(i)})),e.desired_set&&e.desired_set.labels&&e.desired_set.labels.forEach((e=>{var i={};i.name=e.name,i.id=e.id,i.sub_config_type=e.validation_type.split("_")[0],a.push(i)})),e.undesired_set&&e.undesired_set.labels&&e.undesired_set.labels.forEach((e=>{var i={};i.name=e.name,i.id=e.id,i.sub_config_type=e.validation_type.split("_")[0],a.push(i)})),a}});
