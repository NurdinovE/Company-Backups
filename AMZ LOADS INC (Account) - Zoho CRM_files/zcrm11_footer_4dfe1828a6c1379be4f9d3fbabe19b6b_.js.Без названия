!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).tagsPopUpUtility=e({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l=null!=t?t:{},s=e.escapeExpression;return' <div id="addTagsDiv" class=\'newPopup w600 p0 newPopupStyleEle\' style="min-width:400px;display:none;"> <div class="fR pR pT20 pR40"> <i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onClick=\'crmListView.handleTagOpEvent("cancel","add")\'></i></div> <div id="addTagSub" class="pp-header">'+s(a.getI18n.call(l,"crm.label.add.tags",{name:"getI18n",hash:{},data:i}))+'</div> <div class=\'pp-content t_pop_body pL30 pR30 pB10 pT30\'> <div class="selected cchosen dIB vaM t_tag_section w100_per boxBB pT0 pB0"> <select multiple name=\'tagSel\' id="addTagsSel" class="chosen-select js-example-basic-multiple js-example-programmatic-multi" style="width: 350px;"></select> </div> <div class="pT20 dIB t_options"> <label class="newCustomchkbox-md vaM dIB fL"> <input type="checkbox" name="overWriteRecords"><span class="chkbxIcon"></span></label> <span class="dIB fL pL5 lh18">'+s(a.getI18n.call(l,"crm.tag.record.overwrite",{name:"getI18n",hash:{},data:i}))+'</span> </div> </div> <div class="popup-model-footer pR"> <div class="footer_tagline pA crm-small-font-size mT7 top10" style="color:#a4a4a4;">'+s(a.getI18n.call(l,"crm.tags.separate.info",{name:"getI18n",hash:{},data:i}))+"</div> <input type='button' class='newgraybtn globalCancel' onClick='crmListView.handleTagOpEvent(\"cancel\",\"add\")' value='"+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+"' > <input type='button' class='primarybtn globalSave mR1' onClick='crmListView.handleTagOpEvent(\"save\",\"add\")' value='"+s(a.getI18n.call(l,"crm.button.save",{name:"getI18n",hash:{},data:i}))+'\' id=\'addTagButton\' > </div> </div> <div id ="removeTagsDiv" class=\'newPopup w600 p0 newPopupStyleEle\' style="display:none;"> <div class="fR pR pT20 pR40"><i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onClick=\'crmListView.handleTagOpEvent("cancel","remove")\'></i></div> <div id="" class="pp-header">'+s(a.getI18n.call(l,"crm.label.remove.tags",{name:"getI18n",hash:{},data:i}))+'</div> <div class="pp-content t_pop_body pL30 pR30 pB10 pT30"> <div class="cchosen customSelectFrm dIB vaM t_tag_section w100_per boxBB newBradius"> <select multiple name=\'tagSel\' id="removeTagsSel" class="chosen-select" style="width: 275px;"></select> </div> <p class="pT20">'+s(a.getI18n.call(l,"crm.remove.tag.info",{name:"getI18n",hash:{},data:i}))+"</p> </div> <div class=\"popup-model-footer\"> <input type='button' class='newgraybtn' onClick='crmListView.handleTagOpEvent(\"cancel\",\"remove\")' value='"+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+"' > <input type='button' class='redbtn mR1' onClick='crmListView.handleTagOpEvent(\"save\",\"remove\")' value='"+s(a.getI18n.call(l,"crm.button.remove",{name:"getI18n",hash:{},data:i}))+'\' id=\'removeTagButton\' > </div> </div> <div id="maximumReach" class=\'newPopup w600 p0\'> <div class="pA pR pT10 pR10 top0 right0"><i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onclick="crmui.hidePopup(\'maximumReach\')"></i></div> <div class=\'pp-content reached_maximum aligncenter\'> <p id=\'firstMsg\' class="crm-base-font-size pT5 pB5"></p> <p id=\'secondMsg\' class="crm-base-font-size pT5 pB5"></p> <input type="submit" class="btn primarybtn mR0 mT10" value="'+s(a.getI18n.call(l,"crm.button.ok",{name:"getI18n",hash:{},data:i}))+'" onclick="crmui.hidePopup(\'maximumReach\')"> </div> </div>   <div class="newPopup w40_per p0 newPopupStyleEle" id="addtagManagePop" style="height: auto; overflow: auto; max-height: 700px;"> <div class="fR pR pT20 pR40"><i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onclick="CrmTags.handleManagePopup(\'cancel\')"></i></div> <div class="pp-header">'+s(a.getI18n.call(l,"crm.label.add.tags",{name:"getI18n",hash:{},data:i}))+'</div> <input type=\'hidden\' value=\'\'  id=\'addModule\'></input> <div class="pp-content" style="overflow:auto;padding:5px 40px 5px 30px !important;"> <div class="selected cchosen dIB vaM addedTags newBoderStyle newBradius w100_per boxBB focusEleFielEnable"> <label id=\'addedElements\' class="addedElements dN"></label> <input type="text" id=\'addTag\' class="addTag mT5 borderNone crm-small-font-size pL5 pR5 h25 lh24" placeholder=\''+s(a.getI18n.call(l,"crm.label.enter.tag",{name:"getI18n",hash:{},data:i}))+'\' onkeydown="CrmTags.saveNewTags(event)" maxlength="25" onfocus="crmTemplate.applyFocusInputBox(this, event)" onblur="crmTemplate.applyFocusInputBox(this, event)"></input> </div> </div> <div id="createtabGroupFooter" class="pp-footer" style="padding:15px 40px 20px 30px;"> <div class="footer_tagline pA crm-small-font-size" style="color:#a4a4a4;">'+s(a.getI18n.call(l,"crm.tags.separate.info",{name:"getI18n",hash:{},data:i}))+'</div> <input data-zcqa="btn_tab_cancel" type="button" class="newgraybtn" name="Cancel" value=\''+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+'\' onclick="CrmTags.handleManagePopup(\'cancel\')"> <input data-zcqa="btn_tab_save" type="submit" class="primarybtn" value=\''+s(a.getI18n.call(l,"crm.button.save",{name:"getI18n",hash:{},data:i}))+'\' onclick="CrmTags.handleManagePopup(\'save\')"> </div> </div> <div class="newPopup w40_per p0" id="MergeOption" style="box-sizing:border-box; height:auto;"> <div class="p20 aligncenter dIB"> <div id="tagname"></div> <div class="dIB w100_per pT25 pB25"><span>'+s(a.getI18n.call(l,"crm.label.tag.merge.confirm",{name:"getI18n",hash:{},data:i}))+'</span></div> <div class="dIB w100_per mB15" id="options"> <span class="newgraybtn" onclick="CrmTags.handleCancel(\'MergeOption\')">'+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+'</span> <span class="primarybtn fromDeletePopup" onclick="CrmTags.mergeTag()">'+s(a.getI18n.call(l,"crm.button.tag.merge.proceed",{name:"getI18n",hash:{},data:i}))+'</span> </div> </div> </div> <div class="newPopup w40_per newPopupStyleEle" id="deleteOption" style="box-sizing:border-box; height:auto;"> <div class="p20 aligncenter dIB"> <div id="tagname"></div> <div class="dIB pT25 pB25 w100_per" id=\'deleteInfo\'></div> <div class="dIB w100_per" id="Doptions"> <span class="newgraybtn dIB" onclick="CrmTags.handleCancel(\'deleteOption\')">'+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+"</span> <span class=\"redbtn fromDeletePopup dIB\" onclick='CrmTags.doDelete()'>"+s(a.getI18n.call(l,"crm.button.yes.delete",{name:"getI18n",hash:{},data:i}))+'</span> </div> </div> </div> <div class="newPopup ppTop p0" id="tagDelete" style="width:450px;z-index:1000;display:none;position:absolute;"> <div class="formBldPopHd" id="delfldhd">'+s(a.getI18n.call(l,"crm.tag.deletion.pop.heading",{name:"getI18n",hash:{},data:i}))+'</div> <div class="p30 pT0"> <span id="deleteInfo1" class="crm-font-regular fontSmooth crm-base-font-size crmParagraphColor dIB"></span> <div id=\'deleteDetails\' class="mT20 p15 infoCont" style="overflow:auto;height:200px;"> <div id="wfTrighead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.workflow.rules",{name:"getI18n",hash:{},data:i}))+" ( "+s(a.getI18n.call(l,"crm.workflow.rule.rule.trigger",{name:"getI18n",hash:{},data:i}))+' )</div> <div id="wfTrigdiv" class="ncff" style="display:none;"></div> <div id="wfCrihead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.workflow.rules",{name:"getI18n",hash:{},data:i}))+" ( "+s(a.getI18n.call(l,"crm.workflow.rule.criteria",{name:"getI18n",hash:{},data:i}))+' )</div> <div id="wfCridiv" class="ncff" style="display:none;"></div> <div id="alertCriteriahead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.label.approval.send.alert",{name:"getI18n",hash:{},data:i}))+" ( "+s(a.getI18n.call(l,"crm.workflow.rule.criteria",{name:"getI18n",hash:{},data:i}))+' )</div> <div id="alertCriteriadiv" class="ncff" style="display:none;"></div> <div id="kioskshead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.setup.system.kiosk",{name:"getI18n",hash:{},data:i}))+'</div> <div id="kiosksdiv" class="ncff" style="display:none;"></div> <div id="wfFUhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.workflow.field.update",{name:"getI18n",hash:{},data:i}))+'</div> <div id="wfFUdiv" class="ncff" style="display:none;"></div> <div id="wftagActionhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.tag.deletion.pop.tag.action.content",{name:"getI18n",hash:{},data:i}))+'</div> <div id="wftagActiondiv" class="ncff" style="display:none;"></div> <div id="lockingRuleshead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.record.label.rules",{name:"getI18n",hash:{},data:i}))+'</div> <div id="lockingRulesdiv" class="ncff" style="display:none;"></div> <div id="cvhead" style="display:none;" class="denyHead crm-font-regular" >'+s(a.getI18n.call(l,"crm.fielddelete.customview",{name:"getI18n",hash:{},data:i}))+'</div> <div id="cvdiv" class="ncff" style="display:none;"> </div> <span id="similaritydelhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.setup.system.ziasimilarity",{name:"getI18n",hash:{},data:i}))+'</span> <div id="similaritydeldiv" style="display:none;"> </div> <span id="recommendationdelhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.zia.config.org.category.recomendation",{name:"getI18n",hash:{},data:i}))+'</span> <div id="recommendationdeldiv" style="display:none;"> </div> <span id="ziacallanalyticsdelhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.setup.system.ziacallanalytics",{name:"getI18n",hash:{},data:i}))+'</span> <div id="ziacallanalyticsdeldiv" style="display:none;"> </div> <div id="ziaSimilarityhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.setup.system.ziasimilarity",{name:"getI18n",hash:{},data:i}))+'</div> <div id="ziaSimilaritydiv" class="ncff" style="display:none;"></div> <div id="ZiaCallTranscripthead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.setup.system.ziacalltranscription",{name:"getI18n",hash:{},data:i}))+'</div> <div id="ZiaCallTranscriptdiv" class="ncff" style="display:none;"></div> <div id="territoryhead" style="display:none;"  class="crm-font-regular denyHead" >'+s(a.getI18n.call(l,"crm.territory.territories",{name:"getI18n",hash:{},data:i}))+'</div> <div id="territorydiv" class="ncff" style="display:none;"> </div> <div id="autofollowhead" style="display:none;"  class="crm-font-regular denyHead" >'+s(a.getI18n.call(l,"crm.label.automate.followup",{name:"getI18n",hash:{},data:i}))+'</div> <div id="autofollowdiv" class="ncff" style="display:none;"> </div> <div id="approvalRuleCrihead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.label.approvalProcess",{name:"getI18n",hash:{},data:i}))+'</div> <div id="approvalRuleCridiv" class="ncff" style="display:none;"></div> <div id="assRuleHead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.common.menu.assignmentRules",{name:"getI18n",hash:{},data:i}))+'</div> <div id="assRuleDiv" class="ncff" style="display:none;"></div> <div id="assRestHead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.label.assignment.restrictions",{name:"getI18n",hash:{},data:i}))+'</div> <div id="assRestDiv" class="ncff" style="display:none;"></div> <div id="caseHead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.pricing.case.escalation.rules",{name:"getI18n",hash:{},data:i}))+'</div> <div id="caseEscDiv" class="ncff" style="display:none;"></div> <div id="bPRulehead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.tags.delete.popup.blue.print.criteria",{name:"getI18n",hash:{},data:i}))+'</div> <div id="bPRulediv" class="ncff" style="display:none;"></div> <div id="bPTransRulehead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.tags.delete.popup.blue.print.transition.criteria",{name:"getI18n",hash:{},data:i}))+'</div> <div id="bPTransRulediv" class="ncff" style="display:none;"></div> <div id="bPTransActionhead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.tags.delete.popup.blue.print.transition.action",{name:"getI18n",hash:{},data:i}))+'</div> <div id="bPTransActiondiv" class="ncff" style="display:none;"></div> <div id="orchTransRulehead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.orchestration.tag.delete.transition.criteria",{name:"getI18n",hash:{},data:i}))+'</div> <div id="orchTransRulediv" class="ncff" style="display:none;"></div> <div id="pfTransRulehead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"pf.touchpoint.criteria.setup",{name:"getI18n",hash:{},data:i}))+'</div> <div id="pfTransRulediv" class="ncff" style="display:none;"></div> <div id="scoringRulehead" class="denyHead crm-font-regular" style="display:none;" ></div> <div id="scoringRulediv" class="ncff" style="display:none;"></div> <div id="scoringRuleNewhead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.label.scoring.rules",{name:"getI18n",hash:{},data:i}))+'</div> <div id="scoringRuleNewdiv" class="ncff" style="display:none;"></div> <div id="autoresponseruleNewhead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.autoresponse.rules",{name:"getI18n",hash:{},data:i}))+'</div> <div id="autoresponseruleNewdiv" class="ncff" style="display:none;"></div> <div id="automationdiv" class="ncff" style="display:none;"></div> <div id="canvasrulehead" class="denyHead crm-font-regular" style="display:none;">'+s(a.getI18n.call(l,"crm.canvas.rule.title","Canvas",{name:"getI18n",hash:{},data:i}))+'</div> <div id="canvasruledeldiv" class="ncff" style="display:none;"> </div> <div id="reportshead" class="denyHead crm-font-regular" style="display:none;">'+s(a.getI18n.call(l,"crm.report.reports",{name:"getI18n",hash:{},data:i}))+'</div> <div id="reportsdiv" class="ncff" style="display:none;"> </div> <div id="dbComponentshead" class="denyHead crm-font-regular" style="display:none;">'+s(a.getI18n.call(l,"crm.label.analytical.dashboard.components",{name:"getI18n",hash:{},data:i}))+'</div> <div id="dbComponentsdiv" class="ncff" style="display:none;"> </div> <div id="abmConfighead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.abm.configuration",{name:"getI18n",hash:{},data:i}))+'</div> <div id="abmConfigdiv" class="ncff" style="display:none;"></div> <div id="abmSegmenthead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.abm.segments",{name:"getI18n",hash:{},data:i}))+'</div> <div id="abmSegmentdiv" class="ncff" style="display:none;"></div> <div id="abmSegmentCampaignsListCriteriahead" class="denyHead crm-font-regular" style="display:none;" >'+s(a.getI18n.call(l,"crm.abm.segments.push.contacts",a.getAbmContactModulePluralName.call(l,{name:"getAbmContactModulePluralName",hash:{},data:i}),a.getBrandName.call(l,{name:"getBrandName",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+'</div> <div id="abmSegmentCampaignsListCriteriadiv" class="ncff" style="display:none;"></div> <div id="vochead" class="denyHead crm-font-regular hide">'+s(a.getI18n.call(l,a.getDisplayModuleName.call(l,"Voice of the Customer",!1,{name:"getDisplayModuleName",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+'</div> <div id="lookupFilterhead" style="display:none;" class="denyHead crm-font-regular">'+s(a.getI18n.call(l,"crm.label.lookup.fields",{name:"getI18n",hash:{},data:i}))+" ("+s(a.getI18n.call(l,"criteria",{name:"getI18n",hash:{},data:i}))+')</div> <div id="lookupFilterdiv" class="ncff" style="display:none;"></div> <div id="vocdiv" class="ncff" style="display:none;"></div> <div id="voc_componentshead" class="denyHead crm-font-regular hide">'+s(a.getI18n.call(l,"voc.dashboard.components.header",{name:"getI18n",hash:{},data:i}))+'</div> <div id="voc_componentsdiv" class="ncff" style="display:none;"></div> <div id="sharingRuleshead" style="display:none;" class="denyHead crm-font-regular" >'+s(a.getI18n.call(l,"crm.security.sharing.rules.used.heading",{name:"getI18n",hash:{},data:i}))+'</div> <div id="sharingRulesdiv" class="ncff" style="display:none;"></div> <div id="portalsCriteriaDetailshead" style="display:none;" class="denyHead crm-font-regular" >'+s(a.getI18n.call(l,"portal.usertype.criteria.field.deletion.deny.match.with.values",{name:"getI18n",hash:{},data:i}))+'</div> <div id="portalsCriteriaDetailsdiv" class="ncff" style="display:none;"></div> </div> <div id="deleteInfo2" class="crm-font-regular fontSmooth crm-small-font-size crmLabelColor dIB mT20">'+s(a.getI18n.call(l,"crm.tags.delete.popup.info",{name:"getI18n",hash:{},data:i}))+'</div> </div> <div class="popup-model-footer aligncenter tgl pT0"> <input id="btnclos"  type="button" value="'+s(a.getI18n.call(l,"crm.button.ok",{name:"getI18n",hash:{},data:i}))+'" class="primarybtn"  onClick="CrmTags.handleCancel(\'tagDelete\')"></input> </div> </div>   <div class="newPopup w600 p0 newPopupStyleEle" id="wfAddTagsDiv"> <div class="fR pR pT20 pR40"> <i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onclick="wfTags.showHideTaggingOption(\'cancel\',\'add\')"></i> </div> <div class="pp-header"> <p>'+s(a.getI18n.call(l,"crm.label.add.tags",{name:"getI18n",hash:{},data:i}))+'</p> </div> <div class="pp-content" style="padding:0px 30px 30px 30px;overflow: hidden;"> <div class="selected cchosen dIB vaM wf_addTag w100_per br_border1"> <select id=\'wfAddTags\' class="js-example-basic-multiple js-example-tags js-example-programmatic-multi dIB addtags" multiple tabindex="-1" aria-hidden="true"></select> </div> <div class="pT20 dIB t_options"> <label class="newCustomchkbox-md vaM dIB fL"> <input type="checkbox" name="overWriteRecords" id="wfTagOverWriteRecords" onClick="wfTags.showOrHideOverwriteInfo();"> <span class="chkbxIcon"></span> </label> <span class="dIB fL pL5 crm-small-font-size">'+s(a.getI18n.call(l,"crm.tags.wf.overwrite.content",{name:"getI18n",hash:{},data:i}))+'</span> <span class="fL pL20 dN crm-font-regular crmNotFoundColor crm-extra-small-font-size" id="wfOverWrite_span" style="padding-top:2px;">'+s(a.getI18n.call(l,"crm.tags.overwrite.workflow.info",{name:"getI18n",hash:{},data:i}))+'</span> </div> </div> <div class="pp-footer">  <input type="button" id="cancelAddTags" class="newgraybtn" value="'+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+'" onclick="wfTags.showHideTaggingOption(\'cancel\',\'add\')"> <input type="button" id="saveAddTags" class="primarybtn" value="'+s(a.getI18n.call(l,"crm.button.save",{name:"getI18n",hash:{},data:i}))+'" onclick="wfTags.showHideTaggingOption(\'save\',\'add\')"> </div> </div> <div class="newPopup w600 p0 newPopupStyleEle" id="wfRemoveTagsDiv" style="min-width:720px;"> <div class="fR pR pT20 pR20"><i class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 dIB" onclick="wfTags.showHideTaggingOption(\'cancel\',\'remove\')"></i></div> <div class="pp-header"> <p>'+s(a.getI18n.call(l,"crm.label.remove.tags",{name:"getI18n",hash:{},data:i}))+'</p> </div> <div class="pp-content" style=\'overflow: hidden;\'> <div class="selected cchosen dIB vaM wf_removeTag w100_per br_border1"> <select id=\'wfRemoveTags\' class="js-example-basic-multiple js-example-tags js-example-programmatic-multi dIB" multiple tabindex="-1" aria-hidden="true"></select> </div> </div> <div class="pp-footer"> <input type="button" id="cancelRemoveTags" class="newgraybtn" value="'+s(a.getI18n.call(l,"crm.button.cancel",{name:"getI18n",hash:{},data:i}))+'" onclick="wfTags.showHideTaggingOption(\'cancel\',\'remove\')"> <input type="button" id="saveRemoveTags" class="primarybtn" value="'+s(a.getI18n.call(l,"crm.button.save",{name:"getI18n",hash:{},data:i}))+"\" onclick=\"wfTags.showHideTaggingOption('save','remove')\"> </div> </div>  "},useData:!0})}();var rightPanelObj={entityId:"",currentModule:"",rpCachedList:null,activeRightPanel:null,url:Crm.getCrmBasePath()+"/KanbanViewEntity.do",rpTabOrder:null,rpParentContainer:"kso_rightPanel_Card",rpSearchEmailAddr:null,caller:null,featureName:null,outlookNewWindow:null,rightPanelBaseUrl:null,publicDomainList:null,fromPotential:null,potentialId:null,newSocial:!1,loadSocial:!0,isMailAppsUser:!1,isMailAppsEnabledOrg:!1,rightPanelSource:"crm",loadEmailDetailView:null,taskModule:"",isStorageLimitReached:Crm.userDetails.isStorageLimitReached,rpTabNameVsId:{conversation:"krp_Conversation_Container",info:"krp_Rightpanel_InfoContainer",timeline:"krp_Rightpanel_TimelineContainer"},rpTabNameVsInnerContainerId:{conversation:"krp_Conversation_InnerContainer",info:"krp_Rightpanel_InfoInnerContainer",timeline:"krp_Rightpanel_TimelineInnerContainer"},rpTabNameVsI18NKey:{conversation:"crm.kanbanview.rightpanel.title.conversation",info:"crm.kanbanview.rightpanel.title.info",timeline:"crm.kanbanview.rightpanel.title.timeline"},rpTabNameVsAction:{conversation:"get_conversation",info:"get_entity_info",timeline:"get_timeline"},rpTabVsTemplateName:{conversation:"Conversation",info:"EntityInfo",timeline:"Timeline"},conversationsOrder:["social","mail","supportOrCases","messages"],conversationsVsDivId:{social:"krp_social_conversation",mail:"krp_mail_conversation",supportOrCases:"krp_support_or_cases_conversation",messages:"krp_message_conversation"},registerPartials:function(){Handlebars.registerPartial("heading",Handlebars.templates.heading),Handlebars.registerPartial("body",Handlebars.templates.body),Handlebars.registerPartial("navigateByRecords",Handlebars.templates.navigateByRecords),Handlebars.registerPartial("noRecordsFound",Handlebars.templates.noRecordsFound)},detailRightPanel:function(e,t,a,n,i,l){if(moduleRecordMapping[$$rightPanel.currentModule]&&Promise.resolve(store.findAll("related_list",{module:moduleRecordMapping[$$rightPanel.currentModule].api_name})),"Projects"!==$$rightPanel.currentModule||Handlebars.templates.ProjectsRightPanel)if("Calls"!==$$rightPanel.currentModule||l)if($(".commonRightPanel").length)$$rightPanel.detailRightPanelKV(e,t,a,n);else{var s=!1,r=$("#"+this.rpParentContainer+" #"+e),o=r.attr("cursor");if(r.removeAttr("cursor"),void 0!==o?$(crmSocial.timeLineViewMore).html("<img src='"+networkUtils.getImageUrl("moreloading1_lightmode.gif",ResourceConstants.CRM)+"' class='w16 h16' data-image-mode='true'>"):void 0===a||void 0!==a&&!a?s=$$rightPanel.showEntityDetailsIfAlreadFetched(e,t):void 0!==a&&a&&this.prerequisitesSettings(),!s){var c=this.getParams(t);void 0!==o&&(c+="&cursor="+o),null!==this.caller&&(c+="&caller="+this.caller),("undefined"==typeof crmSocialUtil||void 0===crmSocialUtil.perm||objectUtils.getLength(crmSocialUtil.perm)<1)&&("undefined"==typeof zsoTab||void 0===zsoTab.accounts||objectUtils.getLength(zsoTab.accounts)<1)&&(c+="&perm=false"),"rp_parent"!==this.rpParentContainer&&"task_rightpanel_container"!==this.rpParentContainer||(c+="&isNeedNotes=false"),$("#"+this.rpParentContainer+" .krp_tabs").removeClass("sel"),$("#"+this.rpParentContainer+" #"+e).addClass("sel"),void 0===o&&$("#"+this.rpParentContainer+" #krp_loading_div").css({height:$$rightPanel.windowHt-85}).show(),mR($$rightPanel.url,(function(e){i?(i.responseData=e,i.dummyPromise.then((function(e){e?$$rightPanel.resolveTimeLine(e,o,t,n,i):$$rightPanel.resolveTimeLine(i.responseData,o,t,n,i)}))):$$rightPanel.resolveTimeLine(e,o,t,n,i)}),c,(function(e){if(555===e.status){var t=e.responseText?e.responseText:I18n.getMsg("crm.security.error");t=$ESAPI.encoder().encodeForHTML(t),$("#"+$$rightPanel.rpParentContainer+" #kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+t+"</h4></div>"),$("#"+$$rightPanel.rpParentContainer+" #krp_loading_div").hide()}$(".outlookqCreate").length&&$$rightPanel.bindClickEventForOutlook()}),"false")}}else{var d=networkUtils.returnDependencyFiles(["calls-lyte-voicenote.js","lyte-voicenote.js","lyte-multislider.js"],ResourceConstants.CRMClient),m=networkUtils.returnDependencyFiles(["lyte-ui-voicenote.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),p=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("calls_detailview")],ResourceConstants.CRM),u=d.concat(m).concat(p);Lyte.injectResources(u,void 0,(function(){$$rightPanel.detailRightPanel(e,t,a,n,i,!0)}))}else networkUtils.loadFeatureScripts(["zohocrm_projectrightpaneltemplate.js"],(function(){$$rightPanel.detailRightPanel(e,t,a,n)}))},afterRender:function(){var e="undefined"!=typeof socialKanbanView&&socialKanbanView.windowHeight?socialKanbanView.windowHeight-76:renderingUtils.windowHeight-85;if("undefined"==typeof socialKanbanView){var t=$("#rPSelect"),a=$("#cvpadding"),n=$("#wmstoolbar"),i=$("#rp_parent");t.is(":visible")&&t.parent().outerHeight(),a.is(":visible")&&a.outerHeight(),n.is(":visible")&&n.outerHeight(),e-=i.offset().top}$("#"+this.rpParentContainer+" #krp_Conversation_Container").css("height",e)},detailRightPanelKV:function(e,t,a,n){var i=!1,l=$("#"+e),s=l.attr("cursor");if(l.removeAttr("cursor"),void 0!==s?$(crmSocial.timeLineViewMore).html("<img src='"+networkUtils.getImageUrl("moreloading1_lightmode.gif",ResourceConstants.CRM)+"' class='w16 h16' data-image-mode='true'>"):void 0===a||void 0!==a&&!a?i=$$rightPanel.showEntityDetailsIfAlreadFetched(e,t):void 0!==a&&a&&this.prerequisitesSettings(),!i){var r=this.getParams(t);void 0!==s&&(r+="&cursor="+s),null!==this.caller&&(r+="&caller="+this.caller),("undefined"==typeof crmSocialUtil||void 0===crmSocialUtil.perm||objectUtils.getLength(crmSocialUtil.perm)<1)&&("undefined"==typeof zsoTab||void 0===zsoTab.accounts||objectUtils.getLength(zsoTab.accounts)<1)&&(r+="&perm=false"),"rp_parent"!==this.rpParentContainer&&"task_rightpanel_container"!==this.rpParentContainer||(r+="&isNeedNotes=false"),$(".krp_tabs").removeClass("sel"),$("#"+e).addClass("sel"),void 0===s&&$("#krp_loading_div").css({height:$$rightPanel.windowHt-85}).show(),s&&(r+="&cursor="+s),a&&(r+="&firsttime=true"),mR($$rightPanel.url,(function(i){try{var l=JSON.parse(i);l.mailRange&&($$rightPanel.mailRange=l.mailRange),l.new_social?networkUtils.loadFeatureScripts(["zcrm_zsoInteg.js",networkUtils.getI18nJSUrl("social")],(function(){void 0===s&&$$rightPanel.postDetailRightPanelKV(l,t,n,e),$$rightPanel.afterRenderKV(i,a),void 0!==l.interactions&&zsoTab.processRightPanel(l)})):networkUtils.loadFeatureScripts(["zohocrm_zsocial.js","zohocrm_zsocialinteg.js",networkUtils.getI18nJSUrl("social")],(function(){Handlebars.registerPartial("SocialConversations",Handlebars.templates.SocialConversations),Handlebars.registerPartial("PostTemplate",Handlebars.templates.PostTemplate),Handlebars.registerPartial("twPost",Handlebars.templates.twPost),void 0!==l.permissions&&crmSocialUtil.processPermissions(l),void 0!==l.social_timeline&&(l.social_timeline=crmSocialUtil.processPostForKanbanView(l.social_timeline)),void 0!==s?($(crmSocial.timeLineViewMore).parent().remove(),$("#krpSocTimeline").append(Handlebars.templates.PostTemplate(l.social_timeline))):void 0!==l.interactions&&(Handlebars.registerPartial("twPostActions",Handlebars.templates.twPostActions),Handlebars.registerPartial("fbPostActions",Handlebars.templates.fbPostActions),l.interactions=crmSocialUtil.processPostForKanbanView(l.interactions)),void 0===s&&$$rightPanel.postDetailRightPanelKV(l,t,n,e),$$rightPanel.afterRenderKV(i)}))}catch(e){console.error(e),$("#"+$$rightPanel.rpParentContainer).html(i),$("#krp_loading_div").hide();var r=$("#notAccessibleMsgContainer");r.removeClass("leadbox"),r.css("padding-left","30px"),$(".kso_CautionLeft,.kso_CautionRight").attr("style",""),$(".kso_CautionRight").find("h2").css({"margin-top":"15px","text-align":"center","line-height":"28px"}),$(".kso_CautionLeft").parent("div").css("margin","0 auto")}}),r,(function(e){var t=$(".outlookqCreate").length;switch(e.status){case 555:var a=e.responseText?e.responseText:I18n.getMsg("crm.security.error");$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+a+"</h4></div>"),$("#krp_loading_div").hide();break;case 556:$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+I18n.getMsg("crm.convert.lead.converted.already",moduleRecordMapping[EmailSendingUtil.LEADS].singular_label)+"</h4></div>"),$("#krp_loading_div").hide();break;case 554:$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+I18n.getMsg("crm.label.lead.view.converted",I18n.getMsg("Lead"))+"</h4></div>"),$("#krp_loading_div").hide();break;case 553:$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+I18n.getMsg("crm.rightpanel.record.delete")+"</h4></div>"),$("#krp_loading_div").hide();break;case 552:var n=t?I18n.getMsg("crm.outlook.record.delete.message",[Crm.getCrmBasePath()]):I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()]);$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+n+"</h4></div>"),$("#krp_loading_div").hide();break;case 560:$("#kso_social_rightpanel").html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+I18n.getMsg("crm.record.zia.not.approved")+"</h4></div>"),$("#krp_loading_div").hide()}t.length&&$$rightPanel.bindClickEventForOutlook()}),"false")}},afterRenderKV:function(e,t){if(t)if($("#social_parent_div").length)$("#kso_rightPanel_Card").after(e);else{var a=$("#rp_parent"),n=$("#feedsFollowUpDetails");a&&!n?a.html(e):n?n.after(e):$("#kso_rightPanel_Card").after(e)}else{n=$("#feedsFollowUpDetails");$("#social_parent_div").length?$("#kso_rightPanel_Card").after(e):n?n.after(e):$("#kso_rightpanel_title").after(e)}$("#krp_loading_div").hide(),$(".outlookqCreate").length&&$$rightPanel.bindClickEventForOutlook()},getParams:function(e){var t="action="+this.rpTabNameVsAction[e]+"&module="+$$rightPanel.currentModule;return!this.loadSocial&&this.conversationsOrder.contains("social")&&this.conversationsOrder.splice(0,1),"conversation"===e&&(t+="&requiredConversations="+this.conversationsOrder.join()),"timeline"===e&&$("#social_parent_div").length>0&&this.loadSocial&&(t+="&social=true"),"Colleagues"===$$rightPanel.currentModule||"UnMatched"===$$rightPanel.currentModule?t+="&emailid="+$$rightPanel.rpSearchEmailAddr:t+="&entityId="+$$rightPanel.entityId,$(".outlookqCreate").length&&(t+="&isfromOutlookRightPanel=true"),Crm.isFromSalesInbox&&(t+="&isFromSalesInbox=true"),t},showEntityDetailsIfAlreadFetched:function(e,t){if(this.rpCachedList&&-1===$.inArray(this.activeRightPanel,this.rpCachedList)&&this.rpCachedList.push(this.activeRightPanel),this.rpCachedList&&$.inArray(t,this.rpCachedList)>-1)return this.activeRightPanel=t,$("#"+this.rpParentContainer+" .krp_containers").hide(),$("#"+this.rpParentContainer+" .krp_tabs").removeClass("sel"),$("#"+this.rpParentContainer+" #"+e).addClass("sel"),$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t]).show(),!0},loadMore:function(e,t){var a="action="+t;if(a+="&module="+$$rightPanel.currentModule,a+="&index="+$(e).attr("index"),"load_more_mails"===t)if("Colleagues"===$$rightPanel.currentModule||"UnMatched"===$$rightPanel.currentModule)if($$rightPanel.isMailAppsEnabledOrg||$$rightPanel.isMailAppsUser){var n=$("#curr_selected_view"),i=n.attr("userId");if("-2"===i){var l=n.attr("mailType");if("imap_all"===l?a+="&mailAppsmailType=1":"pop_all"===l?a+="&mailAppsmailType=2":"all_mail"===l&&(a+="&mailAppsmailType=4"),$$rightPanel.mailRange)a+="&mmRange="+(s=$$rightPanel.mailRange).mmRange,a+="&mailapiRange="+s.mailapiRange}else a+="-1"===i?"&mailAppsmailType=0":"&mailAppsmailType=3";a+="&mailsOwnerId="+$(e).attr("mailsOwnerId")}else{var s;if(a+="&mailsOwnerId="+$(e).attr("mailsOwnerId"),$$rightPanel.mailRange)a+="&cassRangeEnd="+(s=$$rightPanel.mailRange).cassRangeEnd,a+="&lastMailTime="+s.lastMailTime}else a+="&mailsOwnerId="+$(e).attr("mailsOwnerId");"Colleagues"===$$rightPanel.currentModule||"UnMatched"===$$rightPanel.currentModule?a+="&emailid="+$$rightPanel.rpSearchEmailAddr:a+="&entityId="+$$rightPanel.entityId,$(".outlookqCreate").length&&(a+="&isfromOutlookRightPanel=true"),mR($$rightPanel.url,(function(e){e=JSON.parse(e),$$rightPanel.postLoadMore(e,$$rightPanel.getCorrespondingKeys(t))}),a,"","false")},postLoadMore:function(e,t){e.mailRange&&($$rightPanel.mailRange=e.mailRange),$("#"+t.containerId).append(Handlebars.templates[t.template](e));var a=$("#"+t.loadMoreId);e[t.limit]===e[t.count]?(a.parent().show(),a.attr("index",e[t.index])):a.parent().hide(),$$rightPanel.setPerfectScrollBar(this.rpTabNameVsId[this.activeRightPanel],this.rpTabNameVsInnerContainerId[this.activeRightPanel],!0),$(".outlookqCreate").length&&$$rightPanel.bindClickEventForOutlook()},getCorrespondingKeys:function(e){var t={};return"load_more_mails"===e||"get_mails"===e?(t.index="mailConversationsIndex",t.limit="mailConversationsLimit",t.count="mailConversationsCount",t.containerId="kso_mails_list",t.loadMoreId="kso_mails_view_more",t.template="MailConversations"):"load_more_cases"===e?(t.index="supportOrCasesIndex",t.limit="supportOrCasesLimit",t.count="supportOrCasesCount",t.containerId="kso_cases_list",t.loadMoreId="kso_cases_view_more",t.template="Cases"):"refreshNotesOnCreatingNew"===e?(t.index="notesIndex",t.limit="notesLimit",t.count="notesCount",t.containerId="kso_notes_list",t.loadMoreId="kso_notes_view_more",t.template="Notes"):"load_more_activities"===e||"refreshActivitiesOnCreatingNew"===e?(t.index="activitiesIndex",t.limit="activitiesLimit",t.count="activitiesCount",t.containerId="kso_activities_list",t.loadMoreId="kso_activities_view_more",t.template="Activities"):"load_more_potentials"!==e&&"refreshPotentialOnCreatingNew"!==e||(t.index="potentialsIndex",t.limit="potentialsLimit",t.count="potentialsCount",t.containerId="kso_potentials_list",t.loadMoreId="kso_potentials_view_more",t.template="Potentials"),t},prerequisitesSettings:function(){if(Handlebars.registerPartial("MailConversations",Handlebars.templates.MailConversations),Handlebars.registerPartial("Cases",Handlebars.templates.Cases),Handlebars.templates.PostTemplate&&(Handlebars.registerPartial("SocialConversations",Handlebars.templates.SocialConversations),Handlebars.registerPartial("PostTemplate",Handlebars.templates.PostTemplate),Handlebars.registerPartial("twPost",Handlebars.templates.twPost)),Notes.registerPartial(),$(".commonRightPanel").length?Handlebars.registerPartial("Notes",Handlebars.templates.CrmNotes_RightPanel):Handlebars.registerPartial("Notes",Handlebars.templates.CrmNotes_DetailsPage),Handlebars.registerPartial("Potentials",Handlebars.templates.Potentials),Handlebars.registerPartial("Activities",Handlebars.templates.Activities),"social_parent"!==this.rpParentContainer&&$("#"+this.rpParentContainer).html(Handlebars.templates.RightPanels({IS_CLIENT_ACCOUNT:Crm.userDetails.CLIENT_ACCOUNT})),$("#"+this.rpParentContainer+" .krp_tabs").addClass("hide"),null!==this.rpTabOrder&&this.rpTabOrder.length>=1)for(var e=this.rpTabOrder.length,t=0;t<e;t++){var a="#"+this.rpParentContainer+" #krp_tab"+(t+1);$(a).html(I18n.getMsg(this.rpTabNameVsI18NKey[this.rpTabOrder[t]])),$(a).attr("tabName",this.rpTabOrder[t]),$(a).removeClass("hide")}},get_contactid_by_potentialid:function(e){var t="action=get_contactid_by_potentialid&entityId="+e,a=null;return mR($$rightPanel.url,(function(e){a=$.trim(e)}),t,"","false",!0),a},postDetailRightPanelKV:function(e,t,a,n){var i="rp_parent"===this.rpParentContainer,l=$("#"+this.rpTabNameVsId[t]),s=i&&(l+":visible").length?renderingUtils.windowHeight-l.offset().top:window.innerHeight-85,r=renderingUtils.windowHeight,o=this.rpTabVsTemplateName[t],c=l.offset().top,d=$(".krp_tabMenu"),m=d.outerHeight(),p=d.width(),u=$("#socialTimeline").width(),g=l.closest("#ldKanbanPop").offset().top;$(".krp_containers").hide(),"undefined"!=typeof deskInteg&&deskInteg.populateIntegDetails(e.supportObj),Notes.addRightPanelClass(e);var h=Handlebars.templates[o](e);if(this.rpTabOrder[0]===t)$("#kso_rightpanel_title").after(h);else if(this.rpTabOrder[1]===t){$("#"+this.rpTabNameVsId[this.rpTabOrder[0]]).after(h);var C=$("#krp_sel_mail_user");if("MailClient"===this.featureName&&"Conversation"===o){var f=C.attr("userId"),_=$("#krp_mail_users").find("a");$(_).each((function(){$(this).attr("userId")===f&&(C.html($(this).html().trim()),$(this).addClass("krp_sel_user_mark"))}))}}else if(this.rpTabOrder[2]===t){var N=$("#"+this.rpTabNameVsId[this.rpTabOrder[1]]);N.length>0?N.after(h):$("#"+this.rpTabNameVsId[this.rpTabOrder[0]]).after(h)}this.alignConversations(t),this.activeRightPanel=t,$("#"+this.rpTabNameVsId[t]).css({height:s,overflow:"auto"}),$$rightPanel.setPerfectScrollBar(this.rpTabNameVsId[this.activeRightPanel],this.rpTabNameVsInnerContainerId[this.activeRightPanel],!0);var v=$("#feedsFollowUpDetails"),T=$("#visits_parent_div").length;if(v.length>0&&v.is(":visible")||T>0){if(T.length>0)var E=r-(g+m);else E=r-c;l.attr("style","height:"+E+"px !important;"),$("#"+this.rpTabNameVsInnerContainerId[this.activeRightPanel]).css({height:"auto"}),l.perfectScrollbar("destroy"),l.perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}).addClass("oH");var I=$(".krp_tabMenu a:visible");$(".krp_tabMenu").find("a")&&2===I.length&&I.width(p/2-1)}if("timeline"===t&&void 0!==e.social_timeline){$$rightPanel.setPerfectScrollBar("krp_socialTimelineContainer","krp_socialTimelineInner");var P=u;$("#crmTimeline").css({left:P})}if("info"===t&&e.activitiesLimit&&e.activitiesLimit===e.activitiesCount){var S=$("#kso_activities_view_more");S.parent().show(),S.attr("index",e.activitiesIndex)}$("#krp_loading_div").hide(),$("#"+t).show(),i&&"info"===t?$("#krp_Rightpanel_InfoContainer").find("#noteDetails").remove():"info"===t&&e.isNotesRLPresent&&(Notes.processNotes(),Notes.initNote("open")),void 0!==a&&a(),$$rightPanel.showEntityDetailsIfAlreadFetched(n,t),$$rightPanel.setPerfectScrollBar($$rightPanel.rpTabNameVsId[$$rightPanel.activeRightPanel],$$rightPanel.rpTabNameVsInnerContainerId[$$rightPanel.activeRightPanel],!0)},postDetailRightPanel:function(e,t,a){e.IS_CLIENT_ACCOUNT=Crm.userDetails.CLIENT_ACCOUNT;var n="rp_parent"===this.rpParentContainer,i=n&&$("#"+this.rpTabNameVsId[t]+":visible").length?renderingUtils.windowHeight-$("#"+this.rpTabNameVsId[t]).offset().top:renderingUtils.windowHeight-105,l=renderingUtils.windowHeight,s=$("#"+this.rpTabNameVsId[t]),r=s.offset().top,o=$("#kso_rightpanel_title");0===r&&(r=$("#"+this.rpParentContainer+":visible")?$("#"+this.rpParentContainer).offset().top+o.outerHeight():170);var c=s.closest("#ldKanbanPop").offset().top,d=$(".krp_tabMenu").outerHeight(),m=$("#socialTimeline").width(),p=$("#krp_loading_div").offset().top,u=$("#taskDetailsPart");u.length&&(p=u.position().top+70);var g=renderingUtils.windowHeight-r;if(0==p)g=renderingUtils.windowHeight-190;$("#"+$$rightPanel.rpParentContainer+" .krp_containers").hide(),e.supportObj&&"undefined"!=typeof deskInteg&&deskInteg.populateIntegDetails(e.supportObj);var h=this.rpTabVsTemplateName[t];Notes.addRightPanelClass(e),e.showPotentials=!1,store.peekAll("related_list").filter((function(t){t.visible&&"POTENTIALSPERSONALITY"===t.personality_name&&"Contacts"===$$rightPanel.currentModule&&(e.showPotentials=!0)}));var C=Handlebars.templates[h](e),f=$("#dv_right_panel_timeline_tab");if(Crm.userDetails.DETAIL_VIEW_LYTE&&f&&"Tasks"===$$rightPanel.taskModule)f.append(C);else if(this.rpTabOrder[0]===t)$("#"+$$rightPanel.rpParentContainer+" #kso_rightpanel_title").after(C);else if(this.rpTabOrder[1]===t)$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[this.rpTabOrder[0]]).after(C);else if(this.rpTabOrder[2]===t){var _=$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[this.rpTabOrder[1]]);_.length>0?_.after(C):$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[this.rpTabOrder[0]]).after(C)}$$rightPanel.taskModule="",this.alignConversations(t),this.activeRightPanel=t,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI?Crm.isActivitySplitDone?$("#"+this.rpTabNameVsId[t]).css({height:g-28,overflow:"auto"}):$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t]).css({height:g-28,overflow:"auto"}):$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t]).css({height:i,overflow:"auto"}),"info"===t&&$("#crmEmailOuterContainerDiv").is(":visible")||Crm.isActivitySplitDone||$$rightPanel.setPerfectScrollBar(this.rpTabNameVsId[this.activeRightPanel],this.rpTabNameVsInnerContainerId[this.activeRightPanel],!0);var N=$("#feedsFollowUpDetails"),v=$("#visits_parent_div");if(N.length>0&&N.is(":visible")||v.length>0){if(v.length>0)var T=l-(c+d);else T=l-r;$("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t]).attr("style","height:"+T+"px !important;"),$("#"+this.rpParentContainer+" #"+this.rpTabNameVsInnerContainerId[this.activeRightPanel]).css({height:"auto"}),thirdPartyUtils.unbindPerfectScroll("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t]),thirdPartyUtils.bindPerfectScroll("#"+this.rpParentContainer+" #"+this.rpTabNameVsId[t],{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!1})}if(setTimeout((function(){if("Calls"===$("#module").val()){var e=$("#dv-button-layer"),t=$("#leftPanel"),a=$("#dvinner"),n=renderingUtils.windowHeight-(e.offset().top+e.outerHeight()+30);t.css({height:n,"max-height":n}),a.css({height:n,"max-height":n})}}),500),"timeline"===t&&void 0!==e.social_timeline){var E=m;$("#crmTimeline").css({left:E})}if(n&&"info"===t&&e.activitiesLimit&&e.activitiesLimit===e.activitiesCount){var I=$("#kso_activities_view_more");I.parent().show(),I.attr("index",e.activitiesIndex)}if($("#"+this.rpParentContainer+" #krp_loading_div").hide(),$("#"+this.rpParentContainer+" #"+t).show(),n&&"info"===t?$("#krp_Rightpanel_InfoContainer").find("#noteDetails").remove():"info"===t&&(Notes.processNotes(),""===Notes.noteFullSection&&(Notes.noteFullSection=$("#note_parent_td").html())),"info"===t&&crmBstTime.isSupportedModule($$rightPanel.currentModule)&&crmBstTime.detailsViewShow({id:$$rightPanel.entityId,relModule:$$rightPanel.currentModule},crmBstTime.showBestTimeOnRightPanelNew),void 0!==a&&a(),e.messages){var P={};P.entityId=$$rightPanel.entityId,P.module=e.module,P.messages=e.messages,Lyte.Component.render("crm-msg-right-panel",P,"#krp_message_conversation")}},alignConversations:function(e){if("conversation"===e){for(var t=$("#"+this.rpTabNameVsInnerContainerId.conversation),a="",n=this.conversationsOrder.length,i=0;i<n;i++)a+=$("#"+this.conversationsVsDivId[this.conversationsOrder[i].trim()])[0].outerHTML;$(t).html(a),this.sortMailAddOnUsers()}},sortMailAddOnUsers:function(){if(1===$("#krp_mail_users").length){$.each(["krp_not_conversed_list","krp_imap_users"],(function(e,t){var a=$("#"+t);if(1===a.length){var n=a.find("a").sort((function(e,t){return e.innerHTML.toLowerCase()>t.innerHTML.toLowerCase()?1:-1}));a.html(n)}}))}},setPerfectScrollBar:function(e,t,a){if(!1===$("#feedsFollowUpDetails").is(":visible")||0===$("#visits_parent_div").length){var n=$("#"+t),i=$("#"+e);if(i[0]){var l=i[0].scrollHeight;thirdPartyUtils.unbindPerfectScroll("#"+e),n.css({height:"1px"}),n.css({height:"auto"}),void 0===a&&i.css({height:$$rightPanel.windowHt-83}),n.css({height:l}),i.css({overflow:"hidden"}),$("#feedParentDiv").is(":visible")||thirdPartyUtils.bindPerfectScroll("#"+e,{wheelSpeed:1,preventOnEnd:!1,preventHorizontal:!1})}}},getMails:function(e){var t=$(e.target).closest("a"),a=$(t).attr("userId"),n=$("#krp_sel_mail_user").attr("userId"),i=$.trim($(t).attr("username")),l=!1;$$rightPanel.isMailAppsEnabledOrg||$$rightPanel.isMailAppsUser?"-2"===a?t.attr("mailType")===$("#curr_selected_view").attr("mailType")&&(l=!0):n===a&&(l=!0):n===a&&(l=!0);if(l)return $("#krp_mail_users").hide(),!1;var s="entityId="+$$rightPanel.entityId;if(s+="&module="+$$rightPanel.currentModule,s+="&action=get_mails",s+="&mailsOwnerId="+a,$$rightPanel.isMailAppsEnabledOrg||$$rightPanel.isMailAppsUser){var r=$("#curr_selected_view");if("-2"===a){var o=t.attr("mailType");"imap_all"===o?s+="&mailAppsmailType=1":"pop_all"===o?s+="&mailAppsmailType=2":"all_mail"===o&&(s+="&mailAppsmailType=4"),r.attr("mailType",o)}else s+="-1"===a?"&mailAppsmailType=0":"&mailAppsmailType=3";r.attr("userId",a)}mR($$rightPanel.url,(function(e){e=JSON.parse(e),$$rightPanel.postGetMails(e,$$rightPanel.getCorrespondingKeys("get_mails"),a,i)}),s,"","false")},showDropDown:function(e){var t=$(e).position().top,a=renderingUtils.windowWidth-($(e).offset().left+$(e).outerWidth()-10),n=$("#krp_mail_users");$(".krp_sel_user_mark").removeClass("krp_sel_user_mark");var i=$("#krp_sel_mail_user").attr("userId"),l=n.find("a");if($$rightPanel.isMailAppsEnabledOrg||$$rightPanel.isMailAppsUser){var s=$("#curr_selected_view");if("-2"===s.attr("userId")){var r=s.attr("mailType");l.each((function(){$(this).attr("mailType")===r&&$(this).addClass("krp_sel_user_mark")}))}else $(l).each((function(){$(this).attr("userId")===i&&$(this).addClass("krp_sel_user_mark")}))}else l.each((function(){$(this).attr("userId")===i&&$(this).addClass("krp_sel_user_mark")}));n.css({top:t+16,right:a}),n.show()},postGetMails:function(e,t,a,n){$("#"+t.containerId).html(Handlebars.templates[t.template](e));var i=$("#"+t.loadMoreId);e[t.limit]===e[t.count]?(i.parent().show(),i.attr("index",e[t.index])):i.parent().hide(),$$rightPanel.setPerfectScrollBar(this.rpTabNameVsId[this.activeRightPanel],this.rpTabNameVsInnerContainerId[this.activeRightPanel],!0),i.attr("mailsOwnerId",a);var l=$("#krp_sel_mail_user");l.attr("userId",a),l.text(n),$("#krp_mail_users").hide()},refreshOnCreatingNewEntity:function(e,t){var a=null;if("Potentials"===e?a=$$rightPanel.getCorrespondingKeys("refreshPotentialOnCreatingNew"):"Activities"===e?($("#krp_activities_create_new").hide(),a=$$rightPanel.getCorrespondingKeys("refreshActivitiesOnCreatingNew")):"Notes"===e&&(a=$$rightPanel.getCorrespondingKeys("refreshNotesOnCreatingNew")),Crm.isActivitySplitDone&&"Activities"===e||"Tasks"===e||"Events"===e||"Calls"===e){var n=$L("crm-activity-right-panel")[0],i="Appointments"===t.module?"Open_Appointments__s":t.module;n.getData("entity_id")===t.entityId&&n.setData(i,t.right_panel_data[i])}if(null!==a){$("#"+a.containerId).html(Handlebars.templates[a.template](t));var l=$("#"+a.loadMoreId);t[a.limit]===t[a.count]?(l.parent().show(),l.attr("index",t[a.index])):l.parent().hide(),$$rightPanel.setPerfectScrollBar(this.rpTabNameVsId[this.activeRightPanel],this.rpTabNameVsInnerContainerId[this.activeRightPanel],!0)}$(".outlookqCreate").length&&$$rightPanel.bindClickEventForOutlook()},showCreateActivitiesLabels:function(e){var t=$(e).position(),a=$("#krp_activities_create_new").width();$(".commonRightPanel").length||(a+=30);var n=$("#krp_activities_create_new"),i=n.find(".qcpopuparrow");Crm.userDetails.RTL_ENABLED&&0==$(".kanbanTaskDetailRightContainer").length?(n.css({left:t.left+47,top:t.top-4,border:"1px solid #c0c6cc"}),i.css({left:"-11px",right:"inherit"})):(n.css({left:t.left-(a-9),top:t.top-10,border:"1px solid #c0c6cc"}),i.css({right:"-11px"})),n.show(),$(".outlookqCreate").length&&$$rightPanel.setFocusForOutlookCustomPane()},getFeed:function(e,t,a){e=$(e),$("#krp_Conversation_InnerContainer").find(".krp_old_conversation > #response").html("").css("display","none"),e.parents("#krp_social_conversation").find(".kso_action_Layer").attr("style","visibility: hidden !important");var n=e.siblings();n.removeClass("bg_crmBg6 socreply_bg"),e.parents("#kso_interactions_list").siblings(".krp_old_conversation").removeClass("bg_crmBg6"),e.siblings("#kso_interactions_list").find(".krp_old_conversation").removeClass("bg_crmBg6");var i=e.attr("b_id");if(a&&"facebook"!==t)var l=e.attr("t_id");else{l=e.attr("p_id");if(a)var s=e.attr("t_id")}$("#feed_detail_outer_div").addClass("highlight"),setTimeout((function(){$("#feed_detail_outer_div").removeClass("highlight")}),1500);var r="action=get_feed&brid="+i+"&feedid="+l+"&network="+t+"&bio=true";if("twitter"===t){var o=e.attr("f_cnt"),c=e.attr("re_cnt");void 0!==o&&""!==o&&(r+="&favorite_count="+o),void 0!==c&&""!==c&&(r+="&retweet_count="+c),void 0!==(d=e.attr("c_cnt"))&&""!==d&&(r+="&reply_count="+d)}else{var d,m=e.attr("l_cnt");void 0!==m&&""!==m&&(r+="&like_count="+m),void 0!==(d=e.attr("c_cnt"))&&""!==d&&(r+="&comment_count="+d)}n.removeClass("bg_crmBg6"),e.addClass("bg_crmBg6"),a&&(r+="&message=true");var p=e.attr("e_id");""!==p&&(r+="&entity_id="+p);var u=$(".outlookqCreate").length;u&&(r+="&isfromOutlookRightPanel=true"),1===$(".kanbansocialrightcontainer").length&&$("#kso_rightPanel_Card").css({"z-index":"22"}),u?$$rightPanel.openNewWindowFromOutlook(crmSocial.url+"?"+r,662,700):mR(crmSocial.url,(function(e){"MailClient"===$$rightPanel.featureName&&(Handlebars.registerPartial("CommentTemplate",Handlebars.templates.CommentTemplate),Handlebars.registerPartial("ReplyList",Handlebars.templates.ReplyList),Handlebars.registerPartial("twReply",Handlebars.templates.twReply),Handlebars.registerPartial("ReplyToComment",Handlebars.templates.ReplyToComment),Handlebars.registerPartial("ConvoTemplate",Handlebars.templates.ConvoTemplate),Handlebars.registerPartial("fbPostDetail",Handlebars.templates.fbPostDetail),Handlebars.registerPartial("twPostDetail",Handlebars.templates.twPostDetail),Handlebars.registerPartial("gpPostDetail",Handlebars.templates.gpPostDetail));var n=$.parseJSON(e);n.thread_id=a&&"facebook"===t?l:s,n=crmSocialUtil.processPostForDetailView(n);var i=$("#social_main").outerHeight(),r=$("#feed_detail_inner_div").children().eq(1).outerHeight(),o=$("#kso_feed_hd"),c=o.outerHeight(),d=(I=$("#feed_detail_inner_div #response")).width(),m=I.find(".imgwth").outerWidth(!0),p=I.find(".btnwth").outerWidth(),u=$("#feed_detail_head").height(),g=$L("#feed_detail_head_outer"),h=$("#kso_social_rightpanel").outerWidth(),C=$("#kanbanViewSkeletonContainer").outerHeight(),f=$("#feed_detail_outer_div"),_=$("#feed_detail_outer_div #response").outerHeight(),N=$("#emailClientMenubar"),v=N.offset().top,T=N.outerHeight();if("twitter"===t){c+=o.next().outerHeight();var E=$("#kso_feed_hd .followArrow");E.length>0&&$("#folwHandle").css("left",E.position().left-97)}f.html(Handlebars.templates.PostDetail(n)),$("#feed_detail_close").show().addClass("addClose"),$("#kso_rightpanel_freezelayer").hide(),g.css("height",i-r-c-24),thirdPartyUtils.unbindPerfectScroll("#feed_detail_head_outer"),$$rightPanel.setPerfectScrollBar("feed_detail_head_outer","feed_detail_head",!0);var I=$("#feed_detail_inner_div #response");if("MailClient"===$$rightPanel.featureName){$("#social_interaction_container, #feed_detail_outer_div").show(),$("#socialConversationFreeze").css({width:EmailTabHomeUtil.ViewPortWidth-h,height:EmailTabHomeUtil.ViewPortHeight,"z-index":"20",display:"block"}),f.css({top:v+T,right:h,height:C}),g.css("height",C-c-_-60),$("#etleftNavContainer, .sbLogo").addClass("ptrNone");var P=d-m-p-10;$(".txtwth").css("width",P)}void 0!==n.data&&void 0!==n.data[0]&&"message"===n.data[0].type&&g.scrollTop(u)}),r,"","false")},bindScrollForMailUsers:function(){var e=$("#krp_mail_users"),t=$("#kso_social_rightpanel");if(e.height()>t.height()){var a=$("#krp_mail_users")[0].scrollHeight,n=t.height();$("#krp_mail_users_inner").css({height:a}),e.css({overflow:"hidden",height:n-200}),thirdPartyUtils.bindPerfectScroll("#krp_mail_users",{wheelSpeed:1,preventOnEnd:!0})}},setPopupPosition:function(e){var t=renderingUtils.windowHeight,a=$("#qCreate").outerHeight();$("#qCreate").hasClass("outlookqCreate")?setTimeout((function(){$("select.select[name='property(saltName)']").attr("id","saltNms");var a=$("#rightNewPopup .qcFields");a.css({"max-height":t-150}),"krp_activities_create_new"===$(e).attr("id")&&$("#eventCreatePopup").css("top","50px"),a.perfectScrollbar({wheelSpeed:1,wheelPropagation:!0}).addClass("oH pR"),$$rightPanel.bindEventsForoutlookpanel()}),30):setTimeout((function(){var n=$(e).offset(),i=$("#qCreate"),l=i.offset(),s=l.top-(a+l.top+50-t);$(".qcpopuparrow,.arrwLeft").hide(),a+l.top+26>t&&(i.css("top",s),$("#qCreate .qcpopuparrow").css({position:"fixed",top:n.top-4,left:n.left-17}),$("#rightNewPopup .qcFields").css({"max-height":t-120}),s<0&&i.css("top","0px"))}),500)},loadMoreDescription:function(e,t){"projects"===t&&($("#projectDesc").removeClass(".krp_ellipsis_3_line"),$("#kso_projDesc_view_more").hide())},bindClickEventForOutlook:function(){if($(".outlookqCreate").length){var e=$(".newWindowLink,.proflink");e.unbind("click"),e.click((function(e){e.preventDefault(),e.stopPropagation(),$$rightPanel.openNewWindowFromOutlook(this.href,800,1200)}))}},openNewWindowFromOutlook:function(e,t,a){try{$$rightPanel.outlookNewWindow&&!$$rightPanel.outlookNewWindow.closed?($$rightPanel.outlookNewWindow.resizeTo(a,t+52),$$rightPanel.outlookNewWindow.focus(),$$rightPanel.outlookNewWindow.location.replace(networkUtils.getOrgSpecificURL(e))):($$rightPanel.outlookNewWindow=window.open(networkUtils.getOrgSpecificURL(e),"_blank","location=no,toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,menubar=no,resizable=no,left=0,top=0,width="+a+",height="+t),$$rightPanel.outlookNewWindow.isFromOutlookPlugin=!0)}catch(n){$$rightPanel.outlookNewWindow=window.open(networkUtils.getOrgSpecificURL(e),"_blank","location=no,toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,menubar=no,resizable=no,left=0,top=0,width="+a+",height="+t),$$rightPanel.outlookNewWindow.isFromOutlookPlugin=!0}},bindEventsForoutlookpanel:function(){var e=$("#leContModSel,#modsel").parents(".tabDivCreate");e.find(".quicklabel").addClass("hide"),e.find(".labelValCreate").addClass("w100_per");var t=$("#timeClearLink");t.parents(".labelValCreate").find("input").css("font-size","13px");var a=$("#compCalDiv");a.find(".newtimefrmt,input").css("font-size","13px"),a.find("input[maxlength=120]").css("width","70px"),a.parents(".tabDivCreate").addClass("compcalpar"),$("#timerButtonDiv").find("span").css("display","none"),$("#recurringDiv").find("table").first().addClass("wf_form_UI wf_form_focus w100_per").css("border-collapse","collapse"),$("#RemindAtdiv").find("table").first().addClass("wf_form_UI wf_form_focus w100_per").css("border-collapse","collapse"),$("#RemindAtdiv").find("table").find("td br").remove(),$("#daily1,#weekly1,#monthly1,#yearly1").addClass("mT10").removeClass("pL5");var n=$(".uSelN").parents(".quicklabel.labelTabCreate");n.addClass("w100_per"),n.next(".labelValCreate").remove();var i=t.parents(".tabDivCreate");i.find(".quicklabel").css({width:"30%"}),i.find(".quicklabel").next(".labelValCreate").css({width:"70%"}),a.find(".quicklabel").css({width:"30%"}),a.find("input").unbind("blur"),$(".cancelRemindAt").click((function(){"300px"===$("#quickRemindAt").css("left")&&$("#task_subject").focus()})),$(".newtimefrmt,.newtimefrmt input").click((function(){$("#timesData").find("#sdiv").show().css({left:$(this).offset().left,top:$(this).offset().top+20})}));var l=$("#leContModSel").closest("form").prop("name"),s=getElm(l,"leContModSel");"Contacts"===$(s).val()?$(getElm(l,"modsel")).closest(".tabDivCreate").show():$(getElm(l,"modsel")).closest(".tabDivCreate").hide(),$(s).change((function(){"Leads"===$(this).val()?$(getElm(l,"modsel")).closest(".tabDivCreate").hide():$(getElm(l,"modsel")).closest(".tabDivCreate").show()})),$(".qAmorearrow").text("");var r=$("#whichCallDiv").find("tbody"),o="";r.find("td").each((function(){o=o+"<tr><td>"+$(this).html()+"</td></tr>"})),$("#Crm_Events_ENDDATETIME_TimeOption").on("click",(function(){$("#Crm_Events_ENDDATETIME_TimeOption_List").css("left",parseInt($("#Crm_Events_ENDDATETIME_TimeOption_List").css("left"))-40)})),$('input[placeholder="MM/dd/yyyy"]').each((function(){""===$(this).val()&&$(this).parent().find(".plHld").show()})),$("#Calendar").on("click",".cdate",(function(){$('input[placeholder="MM/dd/yyyy"]').each((function(){""===$(this).val()&&$(this).parent().find(".plHld").show()}))})),$(".plHld").click((function(e){$(this).hide(),renderingUtils.triggerEvent("click",$(this).next("input")),sE(e)})),$("#quickRecurring").click((function(){$('input[placeholder="MM/dd/yyyy"]').each((function(){""===$(this).val()&&$(this).parent().find(".plHld").show()}))})),$('input[placeholder="MM/dd/yyyy"]').each((function(){$(this).attr("oninput","$$rightPanel.inputElementValueChanged(this)")})),$('input[placeholder="MM/dd/yyyy"]').on("input",(function(){var e=$(this).parent().find(".plHld");""===$(this).val()?e.show():e.hide()})),r.html("").append(o)},inputElementValueChanged:function(e){$(e).parent().find(".plHld").hide()},autoPopulateEntityInformation:function(e){var t="",a="",n="",i="",l="",s=$("#qCreate"),r=$("#"+EmailTabHomeUtil.detailViewParent).find("iframe").contents().find("#"+EmailTabHomeUtil.currentThreadMailDetailContainer);if(Q.entityInfo)t=Q.entityInfo.email,a=Q.entityInfo.name,n=Q.entityInfo.account?Q.entityInfo.account:"",i=Q.entityInfo.phone?Q.entityInfo.phone:"";else if($(r).find(".fromAddr")||$(r).find(".toAddr")){t=$("#unknownConvertbuttonDiv").attr("convertemail");var o=$(r).find(".etMailerNameFromHeader").val();a=o||$(r).find(".etSignLastname").val(),n=$(r).find(".etSignAccount").val(),i=$(r).find(".etSignPhone").val()}if(""!==t&&null!==t){if(a&&"null"!==a||(a=t.substring(0,t.indexOf("@"))),(!n||"null"===n)&&null!==(n=t.substring(t.indexOf("@")+1,t.lastIndexOf(".")))&&""!==n&&-1!==n.indexOf(".")){var c=n.substring(n.lastIndexOf(".")+1);null!==c&&""!==c&&"co"===c&&(n=n.substring(0,n.lastIndexOf(".")))}if(l=-1!==t.indexOf("@")?t.split("@")[1]:"","Leads"===e)if(null===$$rightPanel.publicDomainList){jQuery.ajax({type:"GET",url:Crm.getCrmBasePath()+"/View.do",data:"action=get_publicdomain_list",success:function(r){$$rightPanel.publicDomainList=$.parseJSON(r),n=$$rightPanel.publicDomainList.hasOwnProperty(l)?"":n,$$rightPanel.setVariablesForAutoPopulateEntityInformation(s,t,i,e,n,a)}})}else n=$$rightPanel.publicDomainList.hasOwnProperty(l)?"":n,$$rightPanel.setVariablesForAutoPopulateEntityInformation(s,t,i,e,n,a);else $$rightPanel.setVariablesForAutoPopulateEntityInformation(s,t,i,e,n,a)}},setVariablesForAutoPopulateEntityInformation:function(e,t,a,n,i,l){if(e.find('input[name="property(Email)"]').val(t),e.find('input[name="property(Phone)"]').val(a),"Leads"===n)e.find('input[name="property(Company)"]').val(i);else{var s=e.find('input[name="property(Account Name)"]');s.val(i),i&&$$rightPanel.showCreateAccountIfNotExists(i,s)}e.find('input[name="property(Last Name)"]').val(l)},showCreateAccountIfNotExists:function(e,t){var a={criteria:"(Account_Name:equals:"+e+")"},n=networkUtils.lyteInitiateRequest("/crm/v2.2/Accounts/search","GET",{params:a}),i=t.parent();n.then((function(t){if(null!=t&&t.data&&t.data.length>0){var a=t.data[0].id,n=t.data[0].Account_Name,l=$("[name='property(Account Name)']");l.val(n.trim()),l.data("id",a),l.attr({"data-selectedlookupvalue":l.val(),"data-selectedid":l.data().id})}else{var s=i.closest("form").prop("name").toString();$("[id='Account Name']").after('<span class="cP dIB ico-close-small2 mR5 svgIcons vaM clearAccountName" onclick="$$rightPanel.clearAutoSuggestedAccount();"></span>');var r='<div id="sIlookFieldSrcWrap" class="sIlookFieldSrcWrap"><div id="sIlookupFieldAddNew" class="lookupFieldAddNew p10 bg_white zi29 pR br_top_border4 cP"><span class="crmLinkColor cP pL10 dIB" onclick="$$rightPanel.createNewAccount(&quot;'+s+"&quot;, undefined, &quot;"+e+'&quot;);">+ '+I18n.getMsg("crm.quickcreate.account.new")+"</span></div></div>";i.append(r)}}))},postionInfoDiv:function(){var e=$(".ac_noteWidth"),t=$("#Contacts_fldRow_ACCOUNTID .labelValCreate"),a=t.innerHeight(),n=t.offset();e.appendTo("body"),e.css({top:n.top+a,left:n.left})},clearAutoSuggestedAccount:function(){$("[id='Account Name']").val(""),$("#sIlookFieldSrcWrap").remove(),$(".clearAccountName").remove()},createNewAccount:function(e,t,a){t=null==t?"":t;var n="",i=$("[id='Account Name']").data("fieldid"),l=$("#qCreate").find("[name=layoutId]").val();e&&(n=Crm.getCrmBasePath()+"/QuickCreateAction.do?targetForm=createEntityForm0&module=Accounts&searchmodule=Accounts&layoutId="+t+"&fldName=Account+Name&fldId=property%28actName%3AAccount+Name%29&fldLabel=Account+Name&folLookupFieldId="+i+"&folLayoutId="+l+"&isAutoSuggestionFromEmail=true",Crm.userDetails.isLookupAdvancedSearchEnabled&&(n+="&openInAdvSearch=true")),$(".outlookqCreate").length&&(n+="&isfromOutlookRightPanel=true",$$rightPanel.outlookNewWindow=window.open(networkUtils.getOrgSpecificURL(n),"_blank","location=no,toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,menubar=no,resizable=no,left=0,top=0,width=800,height=1200"),setTimeout((function(){$$rightPanel.outlookNewWindow.$("#Crm_Accounts_ACCOUNTNAME").val(a)}),3e3)),Crm.isFromSalesInbox&&commonUtils.openCustomLookup(n,[],"topBandPopup",null,null,null,null,null,(function(){""!=t&&(renderingUtils.showFreezeLayer(),$("#freezeBackGround").css("z-index","30")),$("#topBandPopup").css("z-index","249"),$("#Crm_Accounts_ACCOUNTNAME").val(a)}))},getRightPanel:function(e){"outlook"===e.rightPanelSource&&($("#module").attr("value",a),$("#entityId").attr("value",t)),void 0!==e.isMailAppsUser&&($$rightPanel.isMailAppsUser=e.isMailAppsUser,$$rightPanel.isMailAppsEnabledOrg=e.isMailAppsUser);var t=e.entityId?e.entityId:null,a=e.module?e.module:null,n=e.relEntityId?e.relEntityId:null,i=e.fromAddr?e.fromAddr:null,l=e.toAddr?e.toAddr:null,s="outlook"===e.rightPanelSource?e.fromAddr:EmailTabHomeUtil.getEmailToCreateEntity(i,l);$$rightPanel.fromPotential=null,$$rightPanel.potentialId=null,$$rightPanel.fromPotential="Potentials"===a||null,$$rightPanel.potentialId="Potentials"===a?t:null,t="Potentials"===a?n:t,a="Potentials"===a?"Contacts":a,delete $$rightPanel.rpCachedList,$$rightPanel.rpCachedList=new Array,delete $$rightPanel.rpTabOrder,"Colleagues"===a||"UnMatched"===a?($$rightPanel.rpSearchEmailAddr=encodeURIComponent(s),$$rightPanel.rpTabOrder=["conversation"],$$rightPanel.conversationsOrder=["mail"]):($$rightPanel.rpTabOrder=["info","conversation","timeline"],$$rightPanel.conversationsOrder=["mail","supportOrCases","social"]),$$rightPanel.currentModule=a,$$rightPanel.entityId=t,$$rightPanel.rpParentContainer="entityInfoOuterDiv",$$rightPanel.featureName="MailClient",Crm.isFromSalesInbox&&($$rightPanel.caller="salesinbox"),"UnMatched"===a?$$rightPanel.detailRightPanel("krp_tab1",$$rightPanel.rpTabOrder[0],!0,EmailTabHomeUtil.appendCreateEntityAfterMailFetch(i,l)):"Colleagues"===a?$$rightPanel.detailRightPanel("krp_tab1",$$rightPanel.rpTabOrder[0],!0,EmailTabHomeUtil.adjustRightpanelTab):$$rightPanel.detailRightPanel("krp_tab1",$$rightPanel.rpTabOrder[0],!0)},showLinkedInInfo:function(e,t){var a=Crm.getCrmBasePath()+"/SalesNavigator.do",n={action:"get_widgets"};n.module=t,n.entity_id=e;var i=$("#linked_in_container");($("#krp_Rightpanel_InfoInnerContainer").hide(),i.removeClass("dN"),void 0===i.attr("added"))&&(new crmRequestPool).initiate({action:a,data:n,success:function(e){e=JSON.parse(e);var t=RebrandLinkUtil.getProperty("LINKEDIN_URL"),a="";if(e.entity_linkedin_id){var n=$("#subvalue_EMAIL").text(),l=$(".krp_commonlink").text();a=t+"profile-matching/?apiKey="+e.client_id+"&profile=lead&crmSourceType=ZOHO&crmOrgId="+Crm.userDetails.ZGID+"&crmRecordId="+e.entity_linkedin_id+"&version=2.1&modules=TopCard2,Icebreakers,GetIntroduced,RelatedLeads&isInlineMode=false&sat="+e.sat_token,1===l.split(" ").length?a+="&firstName="+encodeURIComponent(l.split(" ")[0]):2===l.split(" ").length&&(a+="&firstName="+encodeURIComponent(l.split(" ")[0])+"&lastName="+encodeURIComponent(l.split(" ")[1])),void 0!==n&&""!==n&&(a+="&email="+encodeURIComponent(n))}if(e.entity_linkedin_id){var s=Math.floor(i.width()+17);i.css("height","640px"),e.entity_url=a;var r='<iframe src="'+$ESAPI.encoder().encodeForHTMLAttribute(e.entity_url)+'" width="'+s+'" height="640px" frameborder="0" type="text/html"></iframe>';$("#iframeForLinkedin").html(r),i.attr("added",!0),$$rightPanel.linkedinPanelLoaded=!0}}})},showCrmInfo:function(){$("#linked_in_container").addClass("dN"),$("#krp_Rightpanel_InfoInnerContainer").show()},setFocusForOutlookCustomPane:function(){window&&window.external&&void 0!==window.external.focus&&window.external.focus()},showFollowers:function(e,t){var a=$(".flrs").offset().top-$("#krp_Rightpanel_InfoContainer").offset().top,n=$(".followers");a>150&&n.height()>150&&"150px"!==n.css("max-height")&&n.css("max-height","150px"),$("."+t).show()},init:function(e){if(e){window.isSandboxAcc=e.isSandboxAcc,window.InfoForPartialLoad=e.InfoForPartialLoad,Crm.isFromSalesInbox=e.isFromSalesInbox,Crm.env={},Crm.env.isDevelopment=e.isDevelopment,Crm.env.corsParams=e.corsParams,crmConstants.contactsPhotoURL=e.contactsPhotoURL,crmConstants.staticVersion=e.staticVersion,crmConstants.buildId=e.buildId,crmConstants.subVersion=e.subVersion,crmConstants.compression=e.compression,Crm.partnerName=e.partnerName,Crm.brandName=e.brandName,Crm.isApache=e.isApache,Crm.isCompression=e.isCompression,Crm.baiduAvailable=e.baiduAvailable,Crm.baiduUrl=e.baiduUrl,Crm.calPreferences=e.calPreferences,Crm.userDetails=e.userDetails,Crm.userDetails.jsLocation="China"===Crm.userDetails.DEPLOYMENT?"china/":"",Crm.userDetails.MODULE_LIST="object"!=typeof Crm.userDetails.MODULE_LIST?JSON.parse(Crm.userDetails.MODULE_LIST):Crm.userDetails.MODULE_LIST,Crm.moduleInfo=Crm.userDetails.MODULE_LIST,Crm.userDetails.data_storage=e.data_storage,Crm.userDetails.isStorageLimitReached=e.isStorageLimitReached,Notes.noteChk=e.noteChk,$$rightPanel.rightPanelBaseUrl=e.rightPanelBaseUrl,$$rightPanel.crmStaticPath=e.jsStaticPath,e.rightPanelSource&&($$rightPanel.rightPanelSource=e.rightPanelSource,Q.source=e.rightPanelSource),window.moduleApiMapping={},window.idModuleMapping={},window.moduleRecordMapping={},window.moduleApiVsNameMapping={};var t=e.tabs;crmTab.tabList=JSON.parse(t),timeFormat=Crm.userDetails.TIME_FORMAT;var a=e.moduleDetailedInfo;store.pushPayload("module",a.modules),window.Appointments&&void 0===window.Appointments.setStatus&&(window.Appointments=void 0,window.Appointments=Crm.getModuleObj("Appointments")),window.Tasks=void 0,window.Tasks=Crm.getModuleObj("Tasks"),org.owasp.esapi.ESAPI.initialize(),commonUtils.bindDocumentEvents(),crmCalendar.init(),Events.init(),RebrandLinkUtil.setProperties(e.rebrandClientProperties),EmailTabHomeUtil.getViewPort(),"Mozilla"===$L.userAgent.browser&&(Events.reminderNotificationImgUrl="/event_reminder_feed_firefox.png"),$$rightPanel.registerPartials()}},resolveTimeLine:function(e,t,a,n,i){try{var l=JSON.parse(e);if(l.mailRange&&($$rightPanel.mailRange=l.mailRange),l.messages){var s=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["crm-msg-right-panel.js"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmrelatedlist")],ResourceConstants.CRM);Lyte.injectResources(r.concat(s).concat(o))}if(void 0!==l.isMailAppsEnabledOrg&&($$rightPanel.isMailAppsEnabledOrg=l.isMailAppsEnabledOrg),void 0!==l.isMailAppsUser&&($$rightPanel.isMailAppsUser=l.isMailAppsUser),"Projects"===l.module){var c=Handlebars.templates.ProjectsRightPanel(l);return $("#krp_loading_div").hide(),$("#kso_rightpanel_title").after(c),void $("#krp_Rightpanel_InfoContainer").show()}l.new_social&&(this.newSocial=!0),this.newSocial?networkUtils.loadFeatureScripts(["zcrm_zsoInteg.js",networkUtils.getI18nJSUrl("social")],(function(){void 0===t&&($("#krp_loading_div").css({height:$$rightPanel.windowHt-85}).show(),$$rightPanel.postDetailRightPanel(l,a,n),$$rightPanel.afterRender(),$$rightPanel.renderSplitActivity(l,a)),void 0!==l.interactions&&zsoTab.processRightPanel(l),Crm.bindEventForUserBCView()}),"undefined"!=typeof zsoTab):networkUtils.loadFeatureScripts(["zohocrm_zsocial.js","zohocrm_zsocialinteg.js",networkUtils.getI18nJSUrl("social")],(function(){Handlebars.registerPartial("SocialConversations",Handlebars.templates.SocialConversations),Handlebars.registerPartial("PostTemplate",Handlebars.templates.PostTemplate),Handlebars.registerPartial("twPost",Handlebars.templates.twPost),void 0!==l.permissions&&crmSocialUtil.processPermissions(l),void 0!==l.social_timeline&&(l.social_timeline=crmSocialUtil.processPostForKanbanView(l.social_timeline)),void 0!==t?($(crmSocial.timeLineViewMore).parent().remove(),$("#krpSocTimeline").append(Handlebars.templates.PostTemplate(l.social_timeline))):(void 0!==l.interactions&&(Handlebars.registerPartial("twPostActions",Handlebars.templates.twPostActions),Handlebars.registerPartial("fbPostActions",Handlebars.templates.fbPostActions),l.interactions=crmSocialUtil.processPostForKanbanView(l.interactions)),$("#"+this.rpParentContainer+" #krp_loading_div").css({height:$$rightPanel.windowHt-85}).show(),$$rightPanel.postDetailRightPanel(l,a,n),$$rightPanel.afterRender(),$$rightPanel.renderSplitActivity(l,a))}),"undefined"!=typeof crmSocial),Crm.bindEventForUserBCView()}catch(t){$$rightPanel.rejectTimeLine(e)}$(".outlookqCreate").length&&$$rightPanel.bindClickEventForOutlook()},rejectTimeLine:function(e){$("#"+$$rightPanel.rpParentContainer).html(e),$("#"+this.rpParentContainer+" #krp_loading_div").hide();var t=$("#notAccessibleMsgContainer");t.removeClass("leadbox"),t.css("padding-left","30px"),$(".kso_CautionLeft,.kso_CautionRight").attr("style",""),$(".kso_CautionRight").find("h2").css({"margin-top":"15px","text-align":"center","line-height":"28px"}),$(".kso_CautionLeft").parent("div").css("margin","0 auto")},renderSplitActivity:function(e,t){var a=networkUtils.returnDependencyFiles(["crm-activity-right-panel.js"],ResourceConstants.CRMClient),n=networkUtils.returnDependencyFiles(["crm-activity-right-panel.css"],ResourceConstants.CRMClient);a=a.concat(n),Lyte.injectResources(a,(function(e){"error"===e.type&&crmui.showMsgBand("error",I18n.getMsg("crm.zes.mobile.error.internal"),5e3)}),(function(){if(Crm.isActivitySplitDone&&e&&e.right_panel_data&&"timeline"!==t){e.right_panel_data.entity_id=e.entityId,e.right_panel_data.rel_module=e.module,$L("#activity_right_panel_new")[0].setAttribute("id","activity_right_panel_new_1");var a=store.peekAll("related_list").filter((function(t){return t&&t.href&&moduleRecordMapping[e.module]&&t.href.includes(moduleRecordMapping[e.module].api_name)}));a&&$$rightPanel.renderActivitiesInRightPanel(a,e.right_panel_data)}}))},renderActivitiesInRightPanel:function(e,t){var a=[],n=[];a.push("TASKSPERSONALITY"),a.push("EVENTSPERSONALITY"),a.push("CALLSPERSONALITY"),a.push("APPOINTMENTSPERSONALITY"),e.filter((function(e){a.indexOf(e.personality_name)>-1&&e.visible&&"default"===e.type&&n.push(e.id)})),n.length>0&&Lyte.Component.render("crm-activity-right-panel",t,"#activity_right_panel_new_1")},hideElemOnMouseOut:function(e){setTimeout((function(){$("#"+e).hide()}),500)}};$(document).ready((function(){rightPanelObj.windowHt=renderingUtils.windowHeight}));var $$rightPanel="object"==typeof $$rightPanel?$.extend(rightPanelObj,$$rightPanel):rightPanelObj;Handlebars.registerHelper("getFormattedPhoneNo",(function(e){var t=e;return t&&t.length&&"en_US"==Crm.userDetails.COUNTRY_LOCALE&&t.match(/[0-9]/)&&(t="(",10==e.length?t+=e.substring(0,3)+") "+e.substring(3,6)+"-"+e.substring(6,10):9==e.length?t+=e.substring(0,5)+")-"+e.substring(5,9):t=e),t})),window.onresize=function(){$$rightPanel.windowHt=renderingUtils.windowHeight},function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.Activities=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{};return" "+(null!=(l=a.ifEquals.call(s,null!=t?t.activityType:t,"Events",{name:"ifEquals",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.ifEquals.call(s,null!=t?t.activityType:t,"Tasks",{name:"ifEquals",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.ifEquals.call(s,null!=t?t.activityType:t,"Calls",{name:"ifEquals",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))?l:"")+" "},2:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <tr>  <td class="w25 vaT"><span class="op5 mT3"><crmutil-icon icon-name="events" icon-class="zcicn-events crmBaseIcon "></crmutil-icon></span></td> <td class="PickListColTd"> <div class="crm-small-font-size fontSmoothAntialiased pR"> '+(null!=(l=a.ifNotEquals.call(s,null!=t?t.colorcode:t,"",{name:"ifNotEquals",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))?l:"")+' <a href="'+r(a.getCrmBasePath.call(s,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+r(o(null!=t?t.activityId:t,t))+"&module="+r(o(null!=t?t.activityType:t,t))+'" class="krp_link crm-base-font-size crm-font-semibold mB5" target="_blank">'+r(o(null!=t?t.subject:t,t))+'</a> </div> <div class="crm-small-font-size fontSmoothAntialiased"> <span class="crm-small-font-size feedsGrayclr">'+r(o(null!=t?t.startDate:t,t))+'</span> <span class="pL10 pR10 crm-small-font-size feedsGrayclr">-</span> <span class="crm-small-font-size feedsGrayclr">'+r(o(null!=t?t.endDate:t,t))+"</span> </div> </td> </tr> "},3:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <span class="evtPickColdot"  style="width: 8px;height: 8px;border-radius: 9px;background: '+s(l(null!=t?t.colorcode:t,t))+';top: 5px;left: -10px;display: inline-block;position:absolute;" data-zcqa="rightPanel_color_'+s(l(null!=t?t.subject:t,t))+'"></span> '},5:function(e,t,a,n,i){var l=e.escapeExpression,s=e.lambda;return' <tr>  <td class="w20 vaT"><span class="op5 dF mT5"><crmutil-icon icon-name="tasks" icon-class="zcicn-tasks crmBaseIcon "></crmutil-icon></span></td> <td class="vaT"> <div class="crm-small-font-size fontSmoothAntialiased dF feedsColumn"> <a href="'+l(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+l(s(null!=t?t.activityId:t,t))+"&module="+l(s(null!=t?t.activityType:t,t))+'" class="krp_link crm-base-font-size crm-font-semibold mB5" target="_blank">'+l(s(null!=t?t.subject:t,t))+'</a> <small class="crm-small-font-size feedsGrayclr">'+l(s(null!=t?t.endDate:t,t))+"</small></div> </td> </tr> "},7:function(e,t,a,n,i){var l=e.escapeExpression,s=e.lambda;return' <tr>  <td class="w20 vaT"><span class="op5 dF mT5"><crmutil-icon icon-name="calls" icon-class="zcicn-calls crmBaseIcon "></crmutil-icon></span></td> <td class="vaT"> <div class="crm-small-font-size fontSmoothAntialiased dF feedsColumn"> <a href="'+l(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+l(s(null!=t?t.activityId:t,t))+"&module="+l(s(null!=t?t.activityType:t,t))+'" class="krp_link crm-base-font-size crm-font-semibold mB5" target="_blank">'+l(s(null!=t?t.subject:t,t))+'</a> <small class="crm-small-font-size feedsGrayclr">'+l(s(null!=t?t.endDate:t,t))+"</small></div> </td> </tr> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return" "+(null!=(l=a.each.call(null!=t?t:{},null!=t?t.activities:t,{name:"each",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+" "},useData:!0}),t.Cases=e({1:function(e,t,a,n,i,l,s){var r,o=e.lambda,c=e.escapeExpression,d=null!=t?t:{};return' <div class="krp_each_mail_container" onclick="$(this).find(\'.krp_support_cases_link\')[0].click();sE(event);"> <span class="krp_mail_sender_info_container"> <div class="krp_mail_sender_info"> <div class="krp_mail_date" title="'+c(o(null!=t?t.SENTTIME_ToolTip:t,t))+'">'+c(o(null!=t?t.SENTTIME:t,t))+"</div> "+(null!=(r=a.ifEquals.call(d,null!=s[1]?s[1].supportOrCasesClue:s[1],"support",{name:"ifEquals",hash:{},fn:e.program(2,i,0,l,s),inverse:e.program(4,i,0,l,s),data:i}))?r:"")+' </div> <div class="krp_mail_sub_att_container"> <div class="krp_mail_subject"> <span class="krp_mail_sender1">'+c(o(null!=(r=null!=t?t.agent:t)?r.lastName:r,t))+'</span> <span class="pL10 pR10">&middot;</span> '+(null!=(r=a.if.call(d,null!=t?t.threadCount:t,{name:"if",hash:{},fn:e.program(6,i,0,l,s),inverse:e.noop,data:i}))?r:"")+" "+c(o(null!=t?t.ticketNumber:t,t))+" </div> </div> </span> </div> "},2:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a class="krp_support_cases_link whois" href="javascript:deskInteg.showDeskPopupForWidgets(\''+s(l(null!=t?t.id:t,t))+'\')" onclick="sE(event)"> '+s(l(null!=t?t.subject:t,t))+" </a> "},4:function(e,t,a,n,i){var l=e.escapeExpression,s=e.lambda;return' <a href="'+l(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?module=Cases&id="+l(s(null!=t?t.caseid:t,t))+"\" onclick=\"Events.checkForPublicFields('Cases', '"+l(s(null!=t?t.caseid:t,t))+'\', event);" class="krp_support_cases_link krp_link whois" target="_blank" onclick="sE(event)">'+l(s(null!=t?t.subject:t,t))+"</a> "},6:function(e,t,a,n,i){var l=e.escapeExpression;return" "+l(e.lambda(null!=t?t.threadCount:t,t))+" "+l(a.getI18n.call(null!=t?t:{},"crm.social.one.or.many.threads",{name:"getI18n",hash:{},data:i}))+'<span class="pL10 pR10">&middot;</span> '},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i,l,s){var r;return" "+(null!=(r=a.each.call(null!=t?t:{},null!=t?t.supportOrCases:t,{name:"each",hash:{},fn:e.program(1,i,0,l,s),inverse:e.noop,data:i}))?r:"")+" "},useData:!0,useDepths:!0}),t.Conversation=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div id="krp_social_conversation" class="p20"> '+(null!=(l=a.if.call(s,null!=t?t.new_social:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+' <div class="borderBottomNone"> <div class="krp_right_heading borderBottomNone">'+e.escapeExpression(a.getI18n.call(s,"crm.label.social.convo",{name:"getI18n",hash:{},data:i}))+'</div> </div> <div id="kso_interactions_list" class="socInteractionDetAll p0"> '+(null!=(l=a.if.call(s,null!=t?t.interactions:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(11,i,0),data:i}))?l:"")+" </div> </div> "},2:function(e,t,a,n,i){var l;return' <div class="socFilDropDown profileIds mB20" ids=""> <span class="dIB vaM crm-small-font-size crmNotFoundColor">Brand:</span> <div class="newSelect dIB vaM mL10"> <select id="socFilterByBrands" class="socFilterByBrands crm-small-font-size" tabindex="-1" aria-hidden="true" onchange="zsoTab.connectionBrandChange(\'right_panel\')"> '+(null!=(l=a.each.call(null!=t?t:{},null!=t?t.brands:t,{name:"each",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))?l:"")+" </select> </div> </div> "},3:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <option value="'+r(s(null!=t?t.id:t,t))+'" '+(null!=(l=a.if_eq.call(null!=t?t:{},i&&i.index,0,{name:"if_eq",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))?l:"")+" >"+r(s(null!=t?t.name:t,t))+"</option> "},4:function(e,t,a,n,i){return"selected"},6:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.new_social:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))?l:"")+" "},7:function(e,t,a,n,i){return" "},9:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.SocialConversations,t,{name:"SocialConversations",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},11:function(e,t,a,n,i){return' <div class="feedsGrayclr crm-base-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.nsocial.no.interactions",{name:"getI18n",hash:{},data:i}))+"</div> "},13:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <div class="borderBottomNone"> '+(null!=(l=a.ifEquals.call(s,null!=t?t.isMailAddonActive:t,"true",{name:"ifEquals",hash:{},fn:e.program(14,i,0),inverse:e.program(16,i,0),data:i}))?l:"")+" "+(null!=(l=a.ifEquals.call(s,null!=t?t.isMailAddonActive:t,"true",{name:"ifEquals",hash:{},fn:e.program(21,i,0),inverse:e.noop,data:i}))?l:"")+' </div> <div id="kso_mails_list" onclick="sE(event)"> '+(null!=(l=e.invokePartial(n.MailConversations,t,{name:"MailConversations",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+' </div> <div class="aligncenter pR '+r(a.ifEqualsGetStyle.call(s,null!=t?t.mailConversationsCount:t,null!=t?t.mailConversationsLimit:t,"showViewMore",{name:"ifEqualsGetStyle",hash:{},data:i}))+'" style=" height:0px;"> <a id="kso_mails_view_more" href="javascript:;" onclick="$$rightPanel.loadMore(this, \'load_more_mails\')" class="krp_graylink krp_morearrow" mailsOwnerId="'+r(o(null!=t?t.mailsOwnerId:t,t))+'" index="'+r(o(null!=t?t.mailConversationsIndex:t,t))+'" > '+r(a.getI18n.call(s,"crm.nsocial.tab.view.more",{name:"getI18n",hash:{},data:i}))+" </a> </div> "},14:function(e,t,a,n,i){var l=e.escapeExpression,s=e.lambda;return' <div class="krp_right_heading borderBottomNone"> '+l(a.getI18n.call(null!=t?t:{},"crm.zcampaign.mail",{name:"getI18n",hash:{},data:i}))+' <div class="fR crm-small-font-size cP" onclick="$(\'#krp_mail_users\').show(); sE(event)"> <span class="dArw"></span> <span class="fR krp_black_txt crm-small-font-size" userId="'+l(s(null!=t?t.currentUserId:t,t))+'" id="krp_sel_mail_user"> '+l(s(null!=t?t.currentUserName:t,t))+" </span> </div> </div> "},16:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.showMailConversationTitle:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.program(19,i,0),data:i}))?l:"")+" "},17:function(e,t,a,n,i){return' <div class="krp_right_heading borderBottomNone"> '+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.zcampaign.mail",{name:"getI18n",hash:{},data:i}))+" </div> "},19:function(e,t,a,n,i){return' <div class="krp_right_heading borderBottomNone"> '+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.label.all.sent",{name:"getI18n",hash:{},data:i}))+" </div> "},21:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div style="right:12px;" class="krp_ddM pA dN zi10" id="krp_mail_users" data-close="true" onclick="$$rightPanel.getMails(event);$$rightPanel.bindScrollForMailUsers()"> <div id="krp_mail_users_inner"> <input type="hidden" name="curr_selected_view" id="curr_selected_view" userId="'+e.escapeExpression(e.lambda(null!=t?t.currentUserId:t,t))+'" mailType="" /> '+(null!=(l=a.if.call(s,null!=t?t.isMailAppsUser:t,{name:"if",hash:{},fn:e.program(22,i,0),inverse:e.program(29,i,0),data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.conversedWith:t,{name:"if",hash:{},fn:e.program(31,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.each.call(s,null!=t?t.conversedWith:t,{name:"each",hash:{},fn:e.program(33,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.notConversedWith:t,{name:"if",hash:{},fn:e.program(35,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.each.call(s,null!=t?t.notConversedWith:t,{name:"each",hash:{},fn:e.program(37,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.notConversedWith:t,{name:"if",hash:{},fn:e.program(39,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.imapPublicUsers:t,{name:"if",hash:{},fn:e.program(41,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.each.call(s,null!=t?t.imapPublicUsers:t,{name:"each",hash:{},fn:e.program(43,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.imapPublicUsers:t,{name:"if",hash:{},fn:e.program(39,i,0),inverse:e.noop,data:i}))?l:"")+" </div> </div> "},22:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <a href="javascript:;" userId="-1" username="'+r(a.getI18n.call(s,"crm.label.all.sent",{name:"getI18n",hash:{},data:i}))+'"> '+r(a.getI18n.call(s,"crm.label.all.sent",{name:"getI18n",hash:{},data:i}))+" </a> "+(null!=(l=a.if.call(s,null!=t?t.isALLOptOnly:t,{name:"if",hash:{},fn:e.program(23,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.isAllImapPresent:t,{name:"if",hash:{},fn:e.program(25,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.isAllPopPresent:t,{name:"if",hash:{},fn:e.program(27,i,0),inverse:e.noop,data:i}))?l:"")+" "},23:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;" userId="-2" mailType="all_mail" data-zcqa="emc_User_'+s(l(null!=t?t.ALL_MAIL_VIEW:t,t))+'" username="'+s(l(null!=t?t.ALL_MAIL_VIEW:t,t))+'"> '+s(l(null!=t?t.ALL_MAIL_VIEW:t,t))+" </a> "},25:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;" userId="-2" mailType="imap_all" data-zcqa="emc_User_'+s(l(null!=t?t.IMAP_ALL:t,t))+'" username="'+s(l(null!=t?t.IMAP_ALL:t,t))+'"> '+s(l(null!=t?t.IMAP_ALL:t,t))+" </a> "},27:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;" userId="-2" mailType="pop_all" data-zcqa="emc_User_'+s(l(null!=t?t.POP_ALL:t,t))+'" username="'+s(l(null!=t?t.POP_ALL:t,t))+'"> '+s(l(null!=t?t.POP_ALL:t,t))+" </a> "},29:function(e,t,a,n,i){var l=null!=t?t:{},s=e.escapeExpression;return' <a href="javascript:;" userId="-1"  username="'+s(a.getI18n.call(l,"crm.label.all.sent",{name:"getI18n",hash:{},data:i}))+'"> '+s(a.getI18n.call(l,"crm.label.all.sent",{name:"getI18n",hash:{},data:i}))+" </a> "},31:function(e,t,a,n,i){return' <span class="crmLabelColor">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.zmail.public.users",null!=t?t.brandName:t,{name:"getI18n",hash:{},data:i}))+"</span> "},33:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;" userId="'+s(l(null!=t?t.userId:t,t))+'" username="'+s(l(null!=t?t.userName:t,t))+'">'+s(l(null!=t?t.userName:t,t))+"*</a> "},35:function(e,t,a,n,i){return' <span class="crm-extra-small-font-size crmLabelColor">----------</span> <span id="krp_not_conversed_list" class="p0"> '},37:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;" userId="'+s(l(null!=t?t.userId:t,t))+'" username="'+s(l(null!=t?t.userName:t,t))+'">'+s(l(null!=t?t.userName:t,t))+"</a> "},39:function(e,t,a,n,i){return" </span> "},41:function(e,t,a,n,i){return' <span class="crmLabelColor">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"IMAP Shared Users",{name:"getI18n",hash:{},data:i}))+'</span> <span id="krp_imap_users" class="p0"> '},43:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a href="javascript:;"  userId="'+s(l(null!=t?t.userId:t,t))+'" username="'+s(l(null!=t?t.userName:t,t))+'">'+s(l(null!=t?t.userName:t,t))+"</a> "},45:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.supportOrCasesClue:t,{name:"if",hash:{},fn:e.program(46,i,0),inverse:e.noop,data:i}))?l:"")+" "},46:function(e,t,a,n,i){var l,s=null!=t?t:{};return" "+(null!=(l=a.ifEquals.call(s,null!=t?t.supportOrCasesClue:t,"support",{name:"ifEquals",hash:{},fn:e.program(47,i,0),inverse:e.program(49,i,0),data:i}))?l:"")+' <div id="kso_cases_list" class="cBoth"> '+(null!=(l=a.if.call(s,null!=t?t.supportOrCases:t,{name:"if",hash:{},fn:e.program(53,i,0),inverse:e.program(55,i,0),data:i}))?l:"")+" </div> "+(null!=(l=a.ifEquals.call(s,null!=t?t.supportOrCasesCount:t,null!=t?t.supportOrCasesLimit:t,{name:"ifEquals",hash:{},fn:e.program(63,i,0),inverse:e.noop,data:i}))?l:"")+" "},47:function(e,t,a,n,i){return' <div class="krp_right_heading borderBottomNone">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.social.open.support",{name:"getI18n",hash:{},data:i}))+"</div> "},49:function(e,t,a,n,i){var l;return" "+(null!=(l=a.ifEquals.call(null!=t?t:{},null!=t?t.supportOrCasesClue:t,"case",{name:"ifEquals",hash:{},fn:e.program(50,i,0),inverse:e.noop,data:i}))?l:"")+" "},50:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <div class="krp_right_heading borderBottomNone fL">'+r(a.getI18n.call(s,"Open",{name:"getI18n",hash:{},data:i}))+" "+r(e.lambda(null!=t?t.casesDispName:t,t))+"</div> "+(null!=(l=a.unless.call(s,null!=t?t.supportOrCasesViewPermi:t,{name:"unless",hash:{},fn:e.program(51,i,0),inverse:e.noop,data:i}))?l:"")+" "},51:function(e,t,a,n,i){return' <span class="krp_warning_icon fL mL5 mT4"></span> '},53:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.Cases,t,{name:"Cases",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},55:function(e,t,a,n,i){var l;return" "+(null!=(l=a.ifEquals.call(null!=t?t:{},null!=t?t.supportOrCasesClue:t,"support",{name:"ifEquals",hash:{},fn:e.program(56,i,0),inverse:e.program(58,i,0),data:i}))?l:"")+" "},56:function(e,t,a,n,i){return' <div class="feedsGrayclr crm-base-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.social.empty.support",{name:"getI18n",hash:{},data:i}))+"</div> "},58:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.supportOrCasesViewPermi:t,{name:"if",hash:{},fn:e.program(59,i,0),inverse:e.program(61,i,0),data:i}))?l:"")+" "},59:function(e,t,a,n,i){return' <div class="feedsGrayclr crm-base-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.social.empty.cases","cases",{name:"getI18n",hash:{},data:i}))+"</div> "},61:function(e,t,a,n,i){return' <div class="feedsGrayclr crm-base-font-size mB20 mT8 fL">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.krp.insufficient.permission",null!=t?t.casesDispName:t,{name:"getI18n",hash:{},data:i}))+"</div> "},63:function(e,t,a,n,i){var l=e.escapeExpression;return' <div class="mT10 aligncenter pR" style="height:0px;"> <a href="javascript:;" id="kso_cases_view_more" onclick="$$rightPanel.loadMore(this, \'load_more_cases\')" index="'+l(e.lambda(null!=t?t.supportOrCasesIndex:t,t))+'" class="krp_graylink krp_morearrow"> '+l(a.getI18n.call(null!=t?t:{},"crm.nsocial.tab.view.more",{name:"getI18n",hash:{},data:i}))+" </a> </div> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div id="krp_Conversation_Container" class="pR krp_containers"> <div id="krp_Conversation_InnerContainer">  '+(null!=(l=a.unless.call(s,null!=t?t.hideSocial:t,{name:"unless",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+'   <div id="krp_mail_conversation" class="pT20 pR20 pB20 pL20 boxBB"> <input id="isNewMailRLEnabled" value="'+e.escapeExpression(e.lambda(null!=t?t.isNewMailRLEnabled:t,t))+'" class="hide"/> '+(null!=(l=a.if.call(s,null!=t?t.isMailAddonActive:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))?l:"")+' </div>   <div id="krp_support_or_cases_conversation" class="p20"> '+(null!=(l=a.ifEquals.call(s,null!=t?t.module:t,"Contacts",{name:"ifEquals",hash:{},fn:e.program(45,i,0),inverse:e.noop,data:i}))?l:"")+' </div>  <div id="krp_message_conversation" class="p20"> </div> </div> </div>  '},usePartial:!0,useData:!0}),t.EntityInfo=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <td width="48" class="pR10 vaT" valign="top"> <div data-id="online-entity-'+(null!=(l=e.lambda(null!=t?t.entityId:t,t))?l:"")+'" class="krp-profile-pic '+(null!=(l=a.addOnlineClass.call(s,null!=t?t.module:t,null!=t?t.entityId:t,{name:"addOnlineClass",hash:{},data:i}))?l:"")+'"> '+(null!=(l=a.if.call(s,null!=(l=null!=t?t.info:t)?l.photo_id:l,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))?l:"")+" </div> </td> "},2:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <img src="'+r(a.getCrmBasePath.call(s,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityImageAttach.do?action_module="+r(a.encodeURL.call(s,null!=t?t.module:t,{name:"encodeURL",hash:{},data:i}))+"&entityId="+r(e.lambda(null!=t?t.entityId:t,t))+"&actionName=readImage&fileId="+r(a.encodeURL.call(s,null!=(l=null!=t?t.info:t)?l.photo_id:l,{name:"encodeURL",hash:{},data:i}))+'" /> '},4:function(e,t,a,n,i){return' <img src="'+e.escapeExpression(a.getCrmImageUrl.call(null!=t?t:{},"nophoto.png",{name:"getCrmImageUrl",hash:{},data:i}))+'"> '},6:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <link-to lt-prop-route="crm.tab.module.entity" lt-prop-dp=\'["Activities","'+r(s(null!=t?t.entityId:t,t))+'"]\' lt-prop-qp =\'{"sub_module" : "'+r(s(null!=t?t.module:t,t))+'"}\' lt-prop-class="krp_commonlink crm-base-font-size feedsInfoUserName" lt-prop-target="_blank">'+r(s(null!=(l=null!=t?t.info:t)?l.full_name:l,t))+"</link-to> "},8:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <link-to lt-prop-route="crm.tab.module.entity" lt-prop-dp=\'["'+r(s(null!=t?t.module:t,t))+'","'+r(s(null!=t?t.entityId:t,t))+"\"]' onclick=\"Events.checkForPublicFields('"+r(a.encodeJS.call(null!=t?t:{},null!=t?t.module:t,{name:"encodeJS",hash:{},data:i}))+"', '"+r(s(null!=t?t.entityId:t,t))+'\', event);" lt-prop-class="krp_commonlink crm-base-font-size feedsInfoUserName" lt-prop-target="_blank">'+r(s(null!=(l=null!=t?t.info:t)?l.full_name:l,t))+"</link-to> "},10:function(e,t,a,n,i){return' <span class="feedsmoduleName crm-small-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},null!=t?t.moduleSingularName:t,{name:"getI18n",hash:{},data:i}))+"</span> "},12:function(e,t,a,n,i){return' <span class="feedsmoduleName crm-small-font-size">'+e.escapeExpression(e.lambda(null!=t?t.moduleSingularName:t,t))+"</span> "},14:function(e,t,a,n,i){var l;return" "+(null!=(l=a.unless.call(null!=t?t:{},null!=t?t.IS_CLIENT_ACCOUNT:t,{name:"unless",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))?l:"")+" "},15:function(e,t,a,n,i){var l;return" "+(null!=(l=a.unless.call(null!=t?t:{},null!=t?t.isRecordLocked:t,{name:"unless",hash:{},fn:e.program(16,i,0),inverse:e.noop,data:i}))?l:"")+" "},16:function(e,t,a,n,i){var l;return" "+(null!=(l=a.unless.call(null!=t?t:{},null!=t?t.isSendMailLocked:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))?l:"")+" "},17:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return'  <input href="javascript:;" tabindex="0" aria-label="'+r(a.getI18n.call(s,"crm.button.license.sendMail",{name:"getI18n",hash:{},data:i}))+'" lt-prop-aria-keydown="true" onclick="sE(event);EntSendMail(\''+r(a.encodeJS.call(s,null!=t?t.module:t,{name:"encodeJS",hash:{},data:i}))+"','"+r(o(null!=t?t.entityId:t,t))+"','','','true');\" type=\"button\" value=\""+r(a.getI18n.call(s,"crm.button.license.sendMail",{name:"getI18n",hash:{},data:i}))+'" class="newbutton primarybtn bt-smallprimarybtn dIB cP m10 mL0"> <span class="hide" id="subvalue_EMAIL" name="subvalue_Email">'+r(o(null!=(l=null!=t?t.info:t)?l.email:l,t))+'</span> <input type="hidden" value="'+r(o(null!=t?t.module:t,t))+'" name="whoidmodule" id="whoidmodule">  '},19:function(e,t,a,n,i){return' <tr > <td class="w20" valign="middle"><div class="blockedImageSec dIB vaT"> <span class="lockedInfoIco_dv dIB pR5"></span> </div> </td> <td><div class="dIB vaT"> <p class="crmNegativeColor crm-small-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.privacy.listview.consent.locked",{name:"getI18n",hash:{},data:i}))+"</p> </div> </td> </tr> "},21:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <div class="feedsInfoInnerEle"> <table cellspacing="0" cellpadding="0" class="contactInfo" width="100%"> <tr> <td class="w20" valign="top"><div class="kanbanviewImages cName"></div></td> '+(null!=(l=a.if.call(s,null!=(l=null!=t?t.info:t)?l.accountId:l,{name:"if",hash:{},fn:e.program(22,i,0),inverse:e.program(24,i,0),data:i}))?l:"")+' </tr> <tr> <td class="w20"><div class="kanbanviewImages lPhone"></div></td> <td><div class="crm-base-font-size crmLabelColor color_14161D">'+r(a.getFormattedPhoneNo.call(s,null!=(l=null!=t?t.info:t)?l.phone:l,{name:"getFormattedPhoneNo",hash:{},data:i}))+'</div></td> </tr> <tr> <td class="w20"><div class="kanbanviewImages mPhone"></div></td> <td><div class="crm-base-font-size crmLabelColor color_14161D">'+r(a.getFormattedPhoneNo.call(s,null!=(l=null!=t?t.info:t)?l.mobile:l,{name:"getFormattedPhoneNo",hash:{},data:i}))+'</div></td> </tr> <tr> <td class="w20"><div class="kanbanviewImages mailId"></div></td> <td><div class="crm-base-font-size crmLabelColor color_14161D"><a class="link dvemaillink" href="mailto:'+r(o(null!=(l=null!=t?t.info:t)?l.email:l,t))+'">'+r(o(null!=(l=null!=t?t.info:t)?l.email:l,t))+'</a></div></td> </tr> </table> <input id="entityName" type="hidden" name="entityName" value="'+r(o(null!=(l=null!=t?t.info:t)?l.full_name:l,t))+'"> </div> '},22:function(e,t,a,n,i){var l,s=e.escapeExpression,r=e.lambda;return' <td> <div class="crm-base-font-size crmLabelColor color_14161D"> <a href="'+s(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+s(r(null!=(l=null!=t?t.info:t)?l.accountId:l,t))+"&module=Accounts\" onclick=\"Events.checkForPublicFields('Accounts', '"+s(r(null!=(l=null!=t?t.info:t)?l.accountId:l,t))+'\', event);" class="krp_link krp_graylink1" target="_blank"> '+s(r(null!=(l=null!=t?t.info:t)?l.account_name:l,t))+' </a> <input id="accountId" type="hidden" name="accountId" value="'+s(r(null!=(l=null!=t?t.info:t)?l.accountId:l,t))+'"> <input id="accountName" type="hidden" name="accountName" value="'+s(r(null!=(l=null!=t?t.info:t)?l.account_name:l,t))+'"> </div> </td> '},24:function(e,t,a,n,i){var l;return' <td><div class="crm-base-font-size crmLabelColor color_14161D">'+e.escapeExpression(e.lambda(null!=(l=null!=t?t.info:t)?l.account_name:l,t))+"</div></td> "},26:function(e,t,a,n,i){var l;return' <div class="feedsInfoEle boxBB w100_per pB15"> <table cellspacing="0" cellpadding="0" class="contactInfo mT10" width="100%"> '+(null!=(l=a.each.call(null!=t?t:{},null!=(l=null!=t?t.info:t)?l.bcDetails:l,{name:"each",hash:{},fn:e.program(27,i,0),inverse:e.noop,data:i}))?l:"")+' </table> <input id="entityName" type="hidden" name="entityName" value="'+e.escapeExpression(e.lambda(null!=(l=null!=t?t.info:t)?l.full_name:l,t))+'"> </div> '},27:function(e,t,a,n,i){var l;return' <tr> <td class="w100"><div class="crm-base-font-size feedsTextclr">'+e.escapeExpression(e.lambda(null!=t?t.labelName:t,t))+'</div></td> <td><div class="crm-base-font-size feedsTextclr"> '+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.colorCode:t,{name:"if",hash:{},fn:e.program(28,i,0),inverse:e.program(30,i,0),data:i}))?l:"")+" </div></td> </tr> "},28:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <span data-zcqa="colorcode_'+r(s(null!=t?t.labelName:t,t))+'" class="colorAppliedPicklist" style="'+r(a.getPLStyleObj.call(null!=t?t:{},null!=t?t.colorCode:t,null!=t?t.labelValue:t,{name:"getPLStyleObj",hash:{},data:i}))+'">'+(null!=(l=s(null!=t?t.labelValue:t,t))?l:"")+"</span> "},30:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.audioComp:t,{name:"if",hash:{},fn:e.program(31,i,0),inverse:e.program(33,i,0),data:i}))?l:"")+" "},31:function(e,t,a,n,i){var l;return' <calls-lyte-voicenote recording-url="'+(null!=(l=e.lambda(null!=t?t.labelValue:t,t))?l:"")+'"></calls-lyte-voicenote> '},33:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.isRTF:t,{name:"if",hash:{},fn:e.program(34,i,0),inverse:e.program(36,i,0),data:i}))?l:"")+" "},34:function(e,t,a,n,i){return' <crm-richtext-component cx-prop-from = "view" cx-prop-value="'+e.escapeExpression(e.lambda(null!=t?t.labelValue:t,t))+'" show-more-button = "false"></crm-richtext-component> '},36:function(e,t,a,n,i){var l;return" "+(null!=(l=e.lambda(null!=t?t.labelValue:t,t))?l:"")+" "},38:function(e,t,a,n,i){return' <li class="p5 pL10 pR10">'+e.escapeExpression(e.lambda(t,t))+"</li> "},40:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.showPotentials:t,{name:"if",hash:{},fn:e.program(41,i,0),inverse:e.noop,data:i}))?l:"")+" "},41:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <div class="fontSmoothAntialiased dF spaceBetween pT15"> <span class="krp_right_heading borderNone">'+r(a.getI18n.call(s,null!=t?t.potentialsSingularName:t,{name:"getI18n",hash:{},data:i}))+" "+r(a.getI18n.call(s,"crm.label.summary",{name:"getI18n",hash:{},data:i}))+"</span> "+(null!=(l=a.if.call(s,null!=t?t.showCreatePotentials:t,{name:"if",hash:{},fn:e.program(42,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.unless.call(s,null!=t?t.potentialsViewPermi:t,{name:"unless",hash:{},fn:e.program(44,i,0),inverse:e.noop,data:i}))?l:"")+" </div> "+(null!=(l=a.if.call(s,null!=t?t.potentialsViewPermi:t,{name:"if",hash:{},fn:e.program(46,i,0),inverse:e.program(53,i,0),data:i}))?l:"")+" "},42:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression,o=null!=t?t:{};return' <a href="#" class="krp_graylink" id="krp_potential_create_new" onclick="Q.createPotentialForContact(\''+r(s(null!=t?t.entityId:t,t))+"','"+r(a.encodeJS.call(o,null!=(l=null!=t?t.info:t)?l.full_name:l,{name:"encodeJS",hash:{},data:i}))+"','"+r(s(null!=(l=null!=t?t.info:t)?l.accountId:l,t))+"','"+r(a.encodeJS.call(o,null!=(l=null!=t?t.info:t)?l.account_name:l,{name:"encodeJS",hash:{},data:i}))+"', 'krp');\"> + "+r(a.getI18n.call(o,"crm.label.new",{name:"getI18n",hash:{},data:i}))+"</a> "},44:function(e,t,a,n,i){return' <span class="krp_warning_icon fL mL5 mT4"></span> '},46:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div class="pB10 fL cBoth w100_per mT15 mB10 br_bottom_border4" id="kso_potentials_list" onclick="sE(event)"> '+(null!=(l=a.if.call(s,null!=t?t.potentials:t,{name:"if",hash:{},fn:e.program(47,i,0),inverse:e.program(49,i,0),data:i}))?l:"")+" </div> "+(null!=(l=a.ifEquals.call(s,null!=t?t.potentialsCount:t,null!=t?t.potentialsLimit:t,{name:"ifEquals",hash:{},fn:e.program(51,i,0),inverse:e.noop,data:i}))?l:"")+" "},47:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.Potentials,t,{name:"Potentials",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},49:function(e,t,a,n,i){return' <div class="crmNotFoundColor aligncenter w100_per">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.krp.no.records.found",null!=t?t.potentialsDispName:t,{name:"getI18n",hash:{},data:i}))+"</div> "},51:function(e,t,a,n,i){var l=e.escapeExpression;return' <div class="aligncenter pR cBoth mB10" style=" /*height:0px;*/"> <a href="javascript:;" onclick="$$rightPanel.loadMore(this, \'load_more_potentials\')" id="kso_potentials_view_more" class="krp_morearrow krp_graylink" index=\''+l(e.lambda(null!=t?t.potentialsIndex:t,t))+"' > "+l(a.getI18n.call(null!=t?t:{},"crm.nsocial.tab.view.more",{name:"getI18n",hash:{},data:i}))+" </a> </div> "},53:function(e,t,a,n,i){return' <div class="crmLabelColor cBoth mB20 mT8 fL"> '+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.krp.insufficient.permission",null!=t?t.potentialsDispName:t,{name:"getI18n",hash:{},data:i}))+" </div> "},55:function(e,t,a,n,i){var l,s=null!=t?t:{};return"  "+(null!=(l=a.if.call(s,a.isActivitySplitNotDone.call(s,{name:"isActivitySplitNotDone",hash:{},data:i}),{name:"if",hash:{},fn:e.program(56,i,0),inverse:e.noop,data:i}))?l:"")+"  "},56:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <div class="fontSmoothAntialiased mT15 borderBottomNone pR activeOpenEle dF mB15"> <span class="fL krp_right_heading borderBottomNone pB0">'+r(a.getI18n.call(s,"crm.mapMarker.lable.openactivities",null!=t?t.activitiesDispName:t,{name:"getI18n",hash:{},data:i}))+'</span> <a href="javascript:;" id="rightPanelCreateActLabel" class="fR krp_graylink" style="font-style: normal;" onclick="sE(event); $$rightPanel.showCreateActivitiesLabels(this)"> + '+r(a.getI18n.call(s,"crm.label.new",{name:"getI18n",hash:{},data:i}))+" </a> "+(null!=(l=a.unless.call(s,null!=t?t.activitiesViewPermi:t,{name:"unless",hash:{},fn:e.program(44,i,0),inverse:e.noop,data:i}))?l:"")+' <div id="krp_activities_create_new" class="quickCreateLink fR zi1" onclick="sE(event)" data-close="true"> <div style="right: -11px; top: 7px;" class="qcpopuparrow qcRight"></div> '+(null!=(l=a.ifEquals.call(s,a.getUserDetail.call(s,"TaskPopup",{name:"getUserDetail",hash:{},data:i}),!0,{name:"ifEquals",hash:{},fn:e.program(57,i,0),inverse:e.program(59,i,0),data:i}))?l:"")+' <a class="addnewListOpt boxBB cP" href="javascript:;" onclick="Events.globalCreate(event,\'krp\', this)"> '+r(a.getI18n.call(s,a.getModuleDisplayName.call(s,!1,!0,{name:"getModuleDisplayName",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+' </a><br> <a class="addnewListOpt boxBB cP" href="javascript:;" onclick="Q.selectAction(\'NewCall\', this,\''+r(o(null!=t?t.module:t,t))+"' ,'"+r(o(null!=t?t.entityId:t,t))+"', 'krp', null, null, this, event); \"> "+r(a.getI18n.call(s,"Calls",{name:"getI18n",hash:{},data:i}))+" </a> </div> </div> "+(null!=(l=a.if.call(s,null!=t?t.activitiesViewPermi:t,{name:"if",hash:{},fn:e.program(61,i,0),inverse:e.program(66,i,0),data:i}))?l:"")+' <div class="krp_sep cBoth"></div> '},57:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <a class="addnewListOpt boxBB cP" href="javascript:;" onclick="crmRelatedList.relTaskCreate(this,\''+r(a.encodeJS.call(s,null!=t?t.entityId:t,{name:"encodeJS",hash:{},data:i}))+"','"+r(a.encodeJS.call(s,null!=(l=null!=t?t.info:t)?l.full_name:l,{name:"encodeJS",hash:{},data:i}))+"','"+r(a.encodeJS.call(s,null!=t?t.module:t,{name:"encodeJS",hash:{},data:i}))+"')\"  > "+r(a.getI18n.call(s,"Tasks",{name:"getI18n",hash:{},data:i}))+" </a> <br/> "},59:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <a class="addnewListOpt boxBB cP" href="javascript:;" onclick="Q.selectAction(\'NewTask\', this,\''+s(l(null!=t?t.module:t,t))+"' ,'"+s(l(null!=t?t.entityId:t,t))+"', 'krp');\"> "+s(a.getI18n.call(null!=t?t:{},"Tasks",{name:"getI18n",hash:{},data:i}))+" </a> <br/> "},61:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression;return' <div class="mB20 mT5 cBoth" onclick="sE(event)"> <table cellspacing="0" id="kso_activities_list" cellpadding="0" class="contactInfo"> '+(null!=(l=a.if.call(s,null!=t?t.activities:t,{name:"if",hash:{},fn:e.program(62,i,0),inverse:e.program(64,i,0),data:i}))?l:"")+' </table> </div> <div class="aligncenter pR cBoth mB10" style="display:none;"> <a href="javascript:;" onclick="$$rightPanel.loadMore(this, \'load_more_activities\')" id="kso_activities_view_more" class="krp_morearrow krp_graylink" index=\''+r(e.lambda(null!=t?t.activitiesIndex:t,t))+"' > "+r(a.getI18n.call(s,"crm.nsocial.tab.view.more",{name:"getI18n",hash:{},data:i}))+" </a> </div> "},62:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.Activities,t,{name:"Activities",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},64:function(e,t,a,n,i){return' <tr> <td class="pT20 feedslableclr crm-small-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.krp.no.records.found",null!=t?t.activitiesDispName:t,{name:"getI18n",hash:{},data:i}))+"</td> </tr> "},66:function(e,t,a,n,i){return' <div class="crmLabelColor cBoth mB20 mT8 fL">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.krp.insufficient.permission",null!=t?t.activitiesDispName:t,{name:"getI18n",hash:{},data:i}))+"</div> "},68:function(e,t,a,n,i){var l;return' <div id="noteDetails" class="pR pT0 pR20 pB20 pL20 br_bottom_border3 dIB w100_per boxBB" name="noteDetails"> '+(null!=(l=e.invokePartial(n.Notes,t,{name:"Notes",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+' </div> <div class="cBoth"></div> '},70:function(e,t,a,n,i){var l,s=null!=t?t:{};return" "+(null!=(l=a.if.call(s,a.isActivitySplitDone.call(s,{name:"isActivitySplitDone",hash:{},data:i}),{name:"if",hash:{},fn:e.program(71,i,0),inverse:e.noop,data:i}))?l:"")+" "},71:function(e,t,a,n,i){return' <div id="activity_right_panel_new" class="w100_per p20 boxBB"> </div> '},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression,o=null!=t?t:{};return' <input type="hidden" name="id" id="id" value="'+r(s(null!=t?t.entityId:t,t))+'">  <div id="krp_Rightpanel_InfoContainer" class="pR krp_containers"> <div> <div class="feedsInfoDetails"> <table cellspacing="0" cellpadding="0" width="100%" class="feedsinfoTableUserEle"> <tr> '+(null!=(l=a.ifCondLogic.call(o,null!=t?t.module:t,"=","Leads","||",null!=t?t.module:t,"=","Contacts",{name:"ifCondLogic",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+' <td> <div class="feedsInfoUserWraper w100_per"> '+(null!=(l=a.ifAnyMatch.call(o,null!=t?t.module:t,"=","Events",null!=t?t.module:t,"=","Tasks",null!=t?t.module:t,"=","Calls",{name:"ifAnyMatch",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))?l:"")+" "+(null!=(l=a.isNotCustomizedSystemModule.call(o,null!=t?t.module:t,{name:"isNotCustomizedSystemModule",hash:{},fn:e.program(10,i,0),inverse:e.program(12,i,0),data:i}))?l:"")+" </div>  "+(null!=(l=a.if.call(o,null!=t?t.isSendMailModule:t,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))?l:"")+" </td> </tr> "+(null!=(l=a.if.call(o,null!=t?t.isRecordLocked:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))?l:"")+" </table> "+(null!=(l=a.if.call(o,null!=t?t.isDisplayCustomerBC:t,{name:"if",hash:{},fn:e.program(21,i,0),inverse:e.program(26,i,0),data:i}))?l:"")+' <div class="feedsInfoFollow mT10"> <span class="fblink dIB cP pR flrs feedsfollowEle mT0" tabindex="0"  aria-label="'+r(s(null!=(l=null!=t?t.info:t)?l.followCount:l,t))+" "+r(a.getI18n.call(o,"crm.ln.lable.followers",{name:"getI18n",hash:{},data:i}))+'" onmouseover="$$rightPanel.showFollowers(this,\'followers\')" onmouseout="$$rightPanel.hideElemOnMouseOut(\'krp_followers\');"> '+r(s(null!=(l=null!=t?t.info:t)?l.followCount:l,t))+" "+r(a.getI18n.call(o,"crm.ln.lable.followers",{name:"getI18n",hash:{},data:i}))+' <div id="krp_followers" class="followers pA zi10 oA" onmouseover="thirdPartyUtils.unbindPerfectScroll(\'#krp_Rightpanel_InfoContainer\');" onmouseout="thirdPartyUtils.enablePerfectScroll(\'krp_Rightpanel_InfoContainer\')" > <ul class="m0 p0"> '+(null!=(l=a.each.call(o,null!=(l=null!=t?t.info:t)?l.followUsers:l,{name:"each",hash:{},fn:e.program(38,i,0),inverse:e.noop,data:i}))?l:"")+' </ul> </div> </span> <div class="alignRight"> <a href="'+r(a.getCrmBasePath.call(o,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+r(s(null!=t?t.entityId:t,t))+"&module="+r(a.encodeURL.call(o,null!=t?t.module:t,{name:"encodeURL",hash:{},data:i}))+'" onclick="Events.checkForPublicFields(\''+r(a.encodeJS.call(o,null!=t?t.module:t,{name:"encodeJS",hash:{},data:i}))+"', '"+r(s(null!=t?t.entityId:t,t))+'\', event);" tabindex="0" aria-label="'+r(a.getI18n.call(o,"crm.label.moreinfo",{name:"getI18n",hash:{},data:i}))+'" lt-prop-aria-keydown="true" class="krp_graylink vaT feedsfollowEle" target="_blank" >'+r(a.getI18n.call(o,"crm.label.moreinfo",{name:"getI18n",hash:{},data:i}))+'</a> </div> </div> <div id="bestTimeRP"></div>  <div class="bestTimebgWrapper"> '+(null!=(l=a.ifEquals.call(o,null!=t?t.module:t,"Contacts",{name:"ifEquals",hash:{},fn:e.program(40,i,0),inverse:e.noop,data:i}))?l:"")+" </div> "+(null!=(l=a.isDisplayActivitiesSection.call(o,null!=t?t.module:t,{name:"isDisplayActivitiesSection",hash:{},fn:e.program(55,i,0),inverse:e.noop,data:i}))?l:"")+"  "+(null!=(l=a.if.call(o,null!=t?t.notesPermission:t,{name:"if",hash:{},fn:e.program(68,i,0),inverse:e.noop,data:i}))?l:"")+"  </div> </div> "+(null!=(l=a.isDisplayActivitiesSection.call(o,null!=t?t.module:t,{name:"isDisplayActivitiesSection",hash:{},fn:e.program(70,i,0),inverse:e.noop,data:i}))?l:"")+" </div>  "},usePartial:!0,useData:!0}),t.MailConversations=e({1:function(e,t,a,n,i){var l;return" "+(null!=(l=a.each.call(null!=t?t:{},null!=t?t.mailConversations:t,{name:"each",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+" "},2:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression,o=null!=t?t:{};return'  <div data-isunread="'+r(s(null!=t?t.isUnread:t,t))+'" class="kso_eachMailContainer krp_old_conversation kso_mail_read_status" \n             onclick="viewMail(\''+r(s(null!=t?t.apiMsgId:t,t))+"','"+r(s(null!=t?t.mailType:t,t))+"','"+r(a.getI18n.call(o,"crm.button.close",{name:"getI18n",hash:{},data:i}))+"','"+r(a.getMailSentOrReceived.call(o,null!=t?t.FN:t,{name:"getMailSentOrReceived",hash:{},data:i}))+"',false,undefined, "+r(s(null!=t?t.isUnread:t,t))+", '"+r(a.encodeJS.call(o,null!=t?t.userid:t,{name:"encodeJS",hash:{},data:i}))+"', this,undefined,undefined,undefined,undefined,undefined,undefined,'activity')\"> "+(null!=(l=a.ifEquals.call(o,null!=t?t.MailStatus:t,"Scheduled",{name:"ifEquals",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))?l:"")+' <span class="krp_mail_sender_info_container"> <div class="krp_mail_sender_info"> <div class="krp_mail_date crmLabelColor" title="'+r(s(null!=t?t.SENTTIME_ToolTip:t,t))+'">'+r(s(null!=t?t.SENTTIME:t,t))+'</div> <div class="krp_link kso_email_read'+r(s(null!=t?t.S:t,t))+' whois maxW160 tOE oH">'+r(s(null!=t?t.SN:t,t))+'</div> </div> <div class="krp_mail_sub_att_container"> '+(null!=(l=a.if.call(o,null!=t?t.A:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))?l:"")+' <div class="krp_mail_subject">'+r(s(null!=t?t.SB:t,t))+'</div> </div> </span> <div class="cBoth"></div> </div> '},3:function(e,t,a,n,i){return' <span class="krp_mail_status_container krp_scheduled" onclick="sE(event)"></span> '},5:function(e,t,a,n,i){var l;return" "+(null!=(l=a.ifEquals.call(null!=t?t:{},null!=t?t.MailStatus:t,"Failed",{name:"ifEquals",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))?l:"")+" "},6:function(e,t,a,n,i){return' <span class="krp_mail_status_container krp_failed" onclick="sE(event)"></span> '},8:function(e,t,a,n,i){var l;return" "+(null!=(l=a.ifEquals.call(null!=t?t:{},null!=t?t.FN:t,"Sent",{name:"ifEquals",hash:{},fn:e.program(9,i,0),inverse:e.program(11,i,0),data:i}))?l:"")+" "},9:function(e,t,a,n,i){return' <span class="krp_mail_status_container krp_outgoing" onclick="sE(event)"></span> '},11:function(e,t,a,n,i){return' <span class="krp_mail_status_container krp_incoming" onclick="sE(event)"></span> '},13:function(e,t,a,n,i){return' <div class="krp_mail_attachment"></div> '},15:function(e,t,a,n,i){var l;return" "+(null!=(l=a.unless.call(null!=t?t:{},null!=t?t.dontShowMailEmptyMessage:t,{name:"unless",hash:{},fn:e.program(16,i,0),inverse:e.noop,data:i}))?l:"")+" "},16:function(e,t,a,n,i){return' <div class="feedsGrayclr crm-base-font-size">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.social.empty.mail.conversations",{name:"getI18n",hash:{},data:i}))+"</div> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.mailConversations:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(15,i,0),data:i}))?l:"")+" "},useData:!0}),t.Potentials=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <div class="mB15"> <div class="crm-small-font-size '+r(a.getClass.call(s,null!=t?t.forecastType:t,{name:"getClass",hash:{},data:i}))+' dIB"> <a href="'+r(a.getCrmBasePath.call(s,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?id="+r(o(null!=t?t.potentialId:t,t))+"&module=Potentials\" onclick=\"Events.checkForPublicFields('Potentials', '"+r(o(null!=t?t.potentialId:t,t))+'\', event);" class="krp_link" target="_blank">'+r(o(null!=t?t.potentialName:t,t))+"</a> "+(null!=(l=a.ifCondLogic.call(s,null!=t?t.amount:t,"!=",void 0,"&&",null!=t?t.amount:t,"!=","null",{name:"ifCondLogic",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+' </div> <div class="mT6 crm-small-font-size pL25 fontSmoothAntialiased"> '+(null!=(l=a.if.call(s,null!=t?t.stage:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.closingDate:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))?l:"")+" </div> </div> "},2:function(e,t,a,n,i){var l;return' <span class="crmLabelColor dIB">&middot;</span> '+(null!=(l=a.if.call(null!=t?t:{},null!=t?t.symbolNAmt:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))?l:"")+" "},3:function(e,t,a,n,i){return' <span class="crmNegativeColor crm-small-font-size dIB">'+e.escapeExpression(e.lambda(null!=t?t.symbolNAmt:t,t))+"</span> "},5:function(e,t,a,n,i){return' <span class="crmNegativeColor crm-small-font-size dIB">'+e.escapeExpression(a.formatCurrencyValue.call(null!=t?t:{},null!=t?t.amount:t,null!=t?t.currencyisocode:t,{name:"formatCurrencyValue",hash:{},data:i}))+"</span> "},7:function(e,t,a,n,i){var l;return" "+(null!=(l=a.ifEquals.call(null!=t?t:{},null!=(l=null!=t?t.stage:t)?l.colorcode_enabled:l,!0,{name:"ifEquals",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))?l:"")+" "},8:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <span data-zcqa="colorcode_'+r(s(null!=(l=null!=t?t.stage:t)?l.stage:l,t))+'" class="crmNotFoundColor crm-small-font-size colorAppliedPicklist" style="'+r(a.getPLStyleObj.call(null!=t?t:{},null!=(l=null!=t?t.stage:t)?l.colorCode:l,{name:"getPLStyleObj",hash:{},data:i}))+'">'+r(s(null!=(l=null!=t?t.stage:t)?l.stage:l,t))+"</span> "},10:function(e,t,a,n,i){var l;return' <span class="crmNotFoundColor crm-small-font-size">'+e.escapeExpression(e.lambda(null!=(l=null!=t?t.stage:t)?l.stage:l,t))+"</span> "},12:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_nq.call(null!=t?t:{},null!=t?t.closingDate:t,"null",{name:"if_nq",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))?l:"")+" "},13:function(e,t,a,n,i){return' <span class="crmNotFoundColor">&middot;</span> <span class="crmNotFoundColor crm-small-font-size">'+e.escapeExpression(a.getISODateFormatToDate.call(null!=t?t:{},null!=t?t.closingDate:t,{name:"getISODateFormatToDate",hash:{},data:i}))+"</span> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return" "+(null!=(l=a.each.call(null!=t?t:{},null!=t?t.potentials:t,{name:"each",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+" "},useData:!0}),t.RightPanelBestTime=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div class="bestTimebgWrapper"> '+(null!=(l=a.if.call(s,null!=t?t.nextImmediateTime:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+' <div class="fL  mB5 w100_per dIrightPanelTags"> '+(null!=(l=a.if.call(s,null!=t?t.oldTime:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.each.call(s,null!=t?t.nextTimes:t,{name:"each",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))?l:"")+" </div> </div> "},2:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return' <div class="fontSmoothAntialiased mT5 borderBottomNone dB"> <span class="krp_right_heading borderBottomNone w100_per dIB crm-base-font-size feedsTextclr">'+r(a.getI18n.call(s,"crm.best.time.next.best.time",{name:"getI18n",hash:{},data:i}))+'</span> </div> <div class="mB10"> <span class="crm-font-bold diRightpanelBTimTime pR mB5 fL pL20 mR5 '+r(o(null!=t?t.nextImmediateTimelevel:t,t))+'" >'+r(o(null!=t?t.nextImmediateTime:t,t))+'</span> <span class="crm-font-regular  diRightpanelBTremTime fL" >('+r(o(null!=t?t.nextImmediateTimeInNL:t,t))+")</span> "+(null!=(l=a.if.call(s,null!=t?t.showRightpanelRemTime:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))?l:"")+' <div class="cBoth"></div> </div> '},3:function(e,t,a,n,i){return' <span class="dIIconTime fL mT5 mL5 cP" onclick="crmBstTime.showRightpanelRemTime(this)"></span> '},5:function(e,t,a,n,i){return' <span class="crm-font-regular crm-base-font-size fL mR5 bestTimeTag pL20 pR timeDi cDefault  mT5 ">'+e.escapeExpression(e.lambda(null!=t?t.oldTime:t,t))+"</span> "},7:function(e,t,a,n,i){var l=e.lambda,s=e.escapeExpression;return' <span class="crm-font-regular crm-base-font-size fL mR5 bestTimeTag pL20 pR timeDi cDefault mT5 '+s(l(null!=t?t.bestTimeLevel:t,t))+'">'+s(l(null!=t?t.bestTime:t,t))+"</span> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return" "+(null!=(l=a.checkBestTimePermission.call(null!=t?t:{},"Crm_Implied_View_Result_BestTime",{name:"checkBestTimePermission",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")},useData:!0}),t.RightPanels=e({1:function(e,t,a,n,i){return' <a id="krp_tab2" class="krp_tabs" lt-prop-aria-keydown="true" href="javascript:;" onclick="$$rightPanel.detailRightPanel(this.id, $(this).attr(\'tabName\'))"></a> <a id="krp_tab3" class="krp_tabs last" lt-prop-aria-keydown="true" href="javascript:;" onclick="$$rightPanel.detailRightPanel(this.id, $(this).attr(\'tabName\'))"></a> '},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return'<div class="social_rightpanel pR" id="kso_social_rightpanel">  <div class="boxBB tb_newmenu w100_per" id="kso_rightpanel_title"> <a id="krp_tab1" class="krp_tabs sel" lt-prop-aria-keydown="true" href="javascript:;" onclick="$$rightPanel.detailRightPanel(this.id, $(this).attr(\'tabName\'))"></a> '+(null!=(l=a.unless.call(null!=t?t:{},null!=t?t.IS_CLIENT_ACCOUNT:t,{name:"unless",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+' <div class="cBoth"></div> </div>   <div id="krp_loading_div" class="pA"> <div class="ks_loading_new pA" style="top:30%"></div> </div> </div> '},useData:!0}),t.SocialConversations=e({1:function(e,t,a,n,i){var l,s=null!=t?t:{};return" "+(null!=(l=a.each.call(s,null!=(l=null!=t?t.interactions:t)?l.data:l,{name:"each",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=(l=null!=t?t.interactions:t)?l.cursor:l,{name:"if",hash:{},fn:e.program(32,i,0),inverse:e.noop,data:i}))?l:"")+" "},2:function(e,t,a,n,i){var l,s=null!=t?t:{},r=e.escapeExpression,o=e.lambda;return" "+(null!=(l=a.if_eq.call(s,null!=t?t.network:t,"twitter",{name:"if_eq",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))?l:"")+' <div class="pA"> <img src="'+r(a.getCrmImageUrl.call(s,"spacer.gif",{name:"getCrmImageUrl",hash:{},data:i}))+'" class="'+r(a.getClass.call(s,null!=t?t.network:t,{name:"getClass",hash:{},data:i}))+' gs" vspace="3"> </div> <div class="fR crmLabelColor" title="'+r(o(null!=t?t.title_time:t,t))+'">'+r(o(null!=t?t.disp_time:t,t))+'</div> <div class="pR40 pL20"> <div class="krp_mail_sender mB5"> '+(null!=(l=a.if_eq.call(s,null!=t?t.network:t,"twitter",{name:"if_eq",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))?l:"")+' </div> </div> <div class="kso_from_text1 mB5">'+(null!=(l=o(null!=t?t.action:t,t))?l:"")+"</div> "+(null!=(l=a.if_eq.call(s,null!=t?t.network:t,"twitter",{name:"if_eq",hash:{},fn:e.program(19,i,0),inverse:e.program(21,i,0),data:i}))?l:"")+" "+(null!=(l=a.if_eq.call(s,null!=t?t.network:t,"twitter",{name:"if_eq",hash:{},fn:e.program(27,i,0),inverse:e.program(29,i,0),data:i}))?l:"")+" </div> "},3:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return" <div class=\"krp_old_conversation kso_li\" onclick=\"sE(event); $$rightPanel.getFeed(this, 'twitter', '"+r(s(null!=t?t.convo:t,t))+'\');" p_id="'+r(s(null!=t?t.id_str:t,t))+'" c_id="'+r(s(null!=t?t.comment_id:t,t))+'" t_id="'+r(s(null!=t?t.thread_id:t,t))+'" b_id="'+r(s(null!=t?t.brid:t,t))+'" pro_id="'+r(s(null!=(l=null!=t?t.user:t)?l.id_str:l,t))+'" m_name="'+r(s(null!=(l=null!=t?t.user:t)?l.module:l,t))+'" e_id="'+r(s(null!=(l=null!=t?t.user:t)?l.entityid:l,t))+'" u_name="'+r(s(null!=(l=null!=t?t.user:t)?l.screen_name:l,t))+'" u_id="'+r(s(null!=(l=null!=t?t.user:t)?l.id_str:l,t))+'" f_cnt="'+r(s(null!=t?t.favoriters_count:t,t))+'" re_cnt="'+r(s(null!=t?t.retweet_count:t,t))+'" c_cnt="'+r(s(null!=t?t.repliers_count:t,t))+'" b_img="'+r(s(null!=t?t.br_img:t,t))+'" b_name="'+r(s(null!=t?t.br_name:t,t))+'"> '},5:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"facebook",{name:"if_eq",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))?l:"")+" "},6:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return" <div class=\"krp_old_conversation kso_li\" onclick=\"sE(event); $$rightPanel.getFeed(this, 'facebook', '"+r(s(null!=t?t.convo:t,t))+'\');" p_id="'+r(s(null!=t?t.id:t,t))+'" c_id="'+r(s(null!=t?t.comment_id:t,t))+'" t_id="'+r(s(null!=t?t.thread_id:t,t))+'" b_id="'+r(s(null!=t?t.brid:t,t))+'" pro_id="'+r(s(null!=(l=null!=t?t.from:t)?l.id:l,t))+'" m_name="'+r(s(null!=(l=null!=t?t.from:t)?l.module:l,t))+'" e_id="'+r(s(null!=(l=null!=t?t.from:t)?l.entityid:l,t))+'" l_cnt="'+r(s(null!=t?t.likes_count:t,t))+'" c_cnt="'+r(s(null!=t?t.comments_count:t,t))+'" b_img="'+r(s(null!=t?t.br_img:t,t))+'" b_name="'+r(s(null!=t?t.br_name:t,t))+'"> '},8:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"googleplus",{name:"if_eq",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))?l:"")+" "},9:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return" <div class=\"krp_old_conversation kso_li\" onclick=\"sE(event); $$rightPanel.getFeed(this, 'googleplus', '"+r(s(null!=t?t.convo:t,t))+'\');" p_id="'+r(s(null!=t?t.id:t,t))+'" c_id="'+r(s(null!=t?t.comment_id:t,t))+'" t_id="'+r(s(null!=t?t.thread_id:t,t))+'" b_id="'+r(s(null!=t?t.brid:t,t))+'" pro_id="'+r(s(null!=(l=null!=t?t.actor:t)?l.id:l,t))+'" m_name="'+r(s(null!=(l=null!=t?t.actor:t)?l.module:l,t))+'" e_id="'+r(s(null!=(l=null!=t?t.actor:t)?l.entityid:l,t))+'" l_cnt="'+r(s(null!=(l=null!=(l=null!=t?t.object:t)?l.plusoners:l)?l.totalItems:l,t))+'" c_cnt="'+r(s(null!=(l=null!=(l=null!=t?t.object:t)?l.replies:l)?l.totalItems:l,t))+'" b_img="'+r(s(null!=t?t.br_img:t,t))+'" b_name="'+r(s(null!=t?t.br_name:t,t))+'"> '},11:function(e,t,a,n,i){var l,s=e.escapeExpression,r=e.lambda;return' <a href="'+s(a.getRebrandKey.call(null!=t?t:{},"TW_URL",{name:"getRebrandKey",hash:{},data:i}))+"/"+s(r(null!=(l=null!=t?t.user:t)?l.screen_name:l,t))+'" class="whois krp_link" target="_blank"  onclick="sE(event)">'+s(r(null!=(l=null!=t?t.user:t)?l.name:l,t))+"</a> "},13:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"facebook",{name:"if_eq",hash:{},fn:e.program(14,i,0),inverse:e.program(16,i,0),data:i}))?l:"")+" "},14:function(e,t,a,n,i){var l,s=e.escapeExpression,r=e.lambda;return' <a href="'+s(a.getRebrandKey.call(null!=t?t:{},"FB_URL",{name:"getRebrandKey",hash:{},data:i}))+"/"+s(r(null!=(l=null!=t?t.from:t)?l.id:l,t))+'" target="_blank" class="whois krp_link" onclick="sE(event)">'+s(r(null!=(l=null!=t?t.from:t)?l.name:l,t))+"</a> "},16:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"googleplus",{name:"if_eq",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))?l:"")+" "},17:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <a href="'+r(s(null!=(l=null!=t?t.actor:t)?l.url:l,t))+'" target="_blank" class="whois krp_link" onclick="sE(event)">'+r(s(null!=(l=null!=t?t.actor:t)?l.displayName:l,t))+"</a> "},19:function(e,t,a,n,i){var l;return' <div class="krp_mail_subject">'+(null!=(l=e.lambda(null!=t?t.text:t,t))?l:"")+"</div> "},21:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"facebook",{name:"if_eq",hash:{},fn:e.program(22,i,0),inverse:e.program(24,i,0),data:i}))?l:"")+" "},22:function(e,t,a,n,i){var l;return' <div class="krp_mail_subject">'+(null!=(l=e.lambda(null!=t?t.message:t,t))?l:"")+"</div> "},24:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"googleplus",{name:"if_eq",hash:{},fn:e.program(25,i,0),inverse:e.noop,data:i}))?l:"")+" "},25:function(e,t,a,n,i){var l;return' <div class="krp_mail_subject">'+(null!=(l=e.lambda(null!=t?t.title:t,t))?l:"")+"</div> "},27:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.twPostActions,t,{name:"twPostActions",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},29:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if_eq.call(null!=t?t:{},null!=t?t.network:t,"facebook",{name:"if_eq",hash:{},fn:e.program(30,i,0),inverse:e.noop,data:i}))?l:"")+" "},30:function(e,t,a,n,i){var l;return" "+(null!=(l=e.invokePartial(n.fbPostActions,t,{name:"fbPostActions",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+" "},32:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression,o=null!=t?t:{};return" <div id='social_int_cursor' class='aligncenter pT5'> <a id=\"social_int_more\" onclick=\"crmSocialInteraction.fetchSocialInteractions('all','"+r(s(null!=(l=null!=t?t.interactions:t)?l.entityid:l,t))+"', '"+r(s(null!=(l=null!=t?t.interactions:t)?l.cursor:l,t))+'\');" class="crm-extra-small-font-size" href="javascript:void(0);"> '+r(a.getI18n.call(o,"crm.nsocial.tab.show.more",{name:"getI18n",hash:{},data:i}))+' </a> <img id="social_int_more_loading" class="dN pL30" src="'+r(a.getCrmImageUrl.call(o,"social_loading.gif",{name:"getCrmImageUrl",hash:{},data:i}))+'" style="display: none;"> </div> '},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l;return" "+(null!=(l=a.if.call(null!=t?t:{},null!=(l=null!=t?t.interactions:t)?l.data:l,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+" "},usePartial:!0,useData:!0}),t.Timeline=e({1:function(e,t,a,n,i){return' <div class="timeline_tab_hed" id="kso_rightpanel_title"> <a id="krp_timeline_tab1" class="timeline_tab bg_white" href="javascript:;" onclick="crmSocial.timelineTab(this);" tabname="twitter">Twitter</a> <a id="krp_timeline_tab2" class="timeline_tab" href="javascript:;" onclick="crmSocial.timelineTab(this);" tabname="pulse">CRM</a> </div> '},3:function(e,t,a,n,i){var l;return' <div id="socialTabTimeline" class="pR w100_per"> <div id="socialTimeline" class="pA w100_per"> <div id="krp_socialTimelineContainer" class="pR"> <div id="krp_socialTimelineInner"> <ul id="krpSocTimeline" class="m0 p0 twitTimeline pA" style="width:100%"> '+(null!=(l=e.invokePartial(n.PostTemplate,null!=t?t.social_timeline:t,{name:"PostTemplate",data:i,helpers:a,partials:n,decorators:e.decorators}))?l:"")+' </ul> </div> </div> </div> <div id="crmTimeline" class="pA w100_per"> <div id="krp_Rightpanel_TimelineInnerContainer">  <div id="userTimeline" class="pA w100_per"> '+(null!=(l=a.each.call(null!=t?t:{},null!=t?t.user_timeline:t,{name:"each",hash:{},fn:e.program(4,i,0),inverse:e.program(6,i,0),data:i}))?l:"")+" </div> </div> </div> </div> "},4:function(e,t,a,n,i){var l,s=e.lambda,r=e.escapeExpression;return' <div class="krp_entity_timeline_item"> <div class="krp_timeline_time cP" title="'+r(s(null!=t?t.SENTTIME_ToolTip:t,t))+'">'+r(s(null!=t?t.SENTTIME:t,t))+'</div> <div class="krp_entity_timeline_item_content"> <div class="krp_timeline_arrow"></div> <div class="krp_entity_timeline_subject">'+(null!=(l=s(null!=t?t.displayContent:t,t))?l:"")+"</div> </div> </div> "},6:function(e,t,a,n,i){return' <div class="p20 feedslableclr">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.label.no.last.activity.done",{name:"getI18n",hash:{},data:i}))+"</div> "},8:function(e,t,a,n,i){var l;return'  <div id="krp_Rightpanel_TimelineInnerContainer"> '+(null!=(l=a.each.call(null!=t?t:{},t,{name:"each",hash:{},fn:e.program(4,i,0),inverse:e.program(6,i,0),data:i}))?l:"")+" </div> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l,s=null!=t?t:{};return' <div id="krp_Rightpanel_TimelineContainer" class="pR krp_containers"> '+(null!=(l=a.if.call(s,null!=t?t.social_timeline:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+" "+(null!=(l=a.if.call(s,null!=t?t.social_timeline:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(8,i,0),data:i}))?l:"")+" </div>"},usePartial:!0,useData:!0})}();var SalesSignals=SalesSignals||{};SalesSignals.page=0,SalesSignals.lastIndex=0,SalesSignals.signalsData={},SalesSignals.moreSignalsData={},SalesSignals.moreNotifications=0,SalesSignals.minimumToggleWidth=1280,signalWindow=$(window),$(document).ready((function(){SalesSignals.windowSize={wwidth:signalWindow.width(),wheight:signalWindow.height()}})),SalesSignals.loadNotificationsContainer=function(e){SalesSignalsWrapper.clearNotificationCountInCache(),SalesSignalsWrapper.isSignalIFrameOpen=!0,Handlebars.registerPartial("cvNotificationShowMore",Handlebars.templates.cvNotificationShowMore),Handlebars.registerPartial("notificationGroups",Handlebars.templates.notificationGroups),Handlebars.registerPartial("notificationGroup",Handlebars.templates.notificationGroup),Handlebars.registerPartial("signalBusinessCard",Handlebars.templates.signalBusinessCard),Handlebars.registerPartial("signalBusinessCardContent",Handlebars.templates.signalBusinessCardContent),Handlebars.registerPartial("signalDetailViewTemplate",Handlebars.templates.signalDetailViewTemplate),Handlebars.registerPartial("uiTypeTemplate",Handlebars.templates.uiTypeTemplate);var t=null,a=new crmRequestPool;SalesSignals.page=1;var n="/crm/v2/signals/notifications?page="+SalesSignals.page,i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":e};a.initiate({action:n,headers:i,data:"",type:"GET",success:function(e){if(void 0!==e)if((e=crmNTCGlobal.convert(e)).global=!0,crmNTCGlobal.isCrmNotificationCenterEmpty=e.info.is_empty,e.group_notifications&&e.group_notifications.length>0){e.group_notifications=crmNTC.sortByAuditTime(e.group_notifications),SalesSignals.moreNotifications=e.info.more_notifications,t=Handlebars.templates.globalSignal(e),$("#handlebarReplacement").html(t),$("#notificationGroupList").find(".ntc-unread").find(".notificationgrpListRow").css("background-color","white");var a=Handlebars.templates.cvNotificationShowMore(e);$("#globalNotificationShowMore").html(a)}else t=Handlebars.templates.emptySignalNotification(),$("#handlebarReplacement").html(t);window.parent.SalesSignalsWrapper.setHeightForNotificationBox()}})},SalesSignals.getTotalCount=function(){if("99+"===SalesSignals.live_global_notifications_count)return"99+";var e=parseInt(SalesSignals.live_global_notifications_count);return SalesSignals.roundCount(e)},SalesSignals.roundCount=function(e){return e>99?"99+":e},SalesSignals.ntcShowMore=function(e){var t=$(e).closest(".ntc-detailv-detail"),a=parseInt(t.find(".ntc-detailv-para")[0].scrollHeight);t.find(".ntc-detailv-para").css({height:SalesSignals.maxShowMoreHt}),t.removeClass("ntc-detailv-wrap").addClass("ntc-detailv-expanded"),t.find(".ntc-detailv-para").css({height:a}),t.find(".ntc-det-more").hide()},SalesSignals.showSignalSidePopup=function(e,t,a){Handlebars.registerPartial("signalIframeDetailView",Handlebars.templates.signalIframeDetailView);var n=Handlebars.templates.signalBusinessCard({entityObj:a});$("#signalBusinessCard").html(n),Handlebars.registerPartial("signalDetailViewTemplate",Handlebars.templates.signalDetailViewTemplate);var i=Handlebars.templates.signalDetailView({entityObj:a,notificationObjs:t});$("#ntcDivContent").html(i)},SalesSignals.globalNotificationScroll=function(){SalesSignals.globalScrollFlag=!0;var e=$L("#handlebarReplacement"),t=e[0].scrollHeight,a=e.scrollTop();if(e.height()==t-a){var n=$("#notificationGrpList"),i=$("#globalNotificationShowMore button"),l=n.outerHeight()+n.offset().top;if(i.length)l+15>i.offset().top&&renderingUtils.triggerEvent("click",i)}},SalesSignals.handleMessage=function(e){var t=e.notification;SalesSignals.prependGlobalNotification(t)},SalesSignals.prependGlobalNotification=function(e){var t=crmNTCGlobal.convert(e);if(0!=$("#notificationGroupList").length){Handlebars.registerPartial("notificationGroup",Handlebars.templates.notificationGroup);var a=Handlebars.templates.notificationGroups(t);$(a).hide().prependTo("#notificationGroupList").slideDown("slow")}else $("#notificationList").html(Handlebars.templates.globalSignal(t)).removeClass("pR oH");$("#notificationGroupList").find(".ntc-unread").find(".notificationgrpListRow").css("background-color","white")},SalesSignals.showIframeDetailView=function(){var e=$("#showSignalPopIframe"),t=$("#handlebarReplacement"),a=$("#signalsMainContainer");Crm.userDetails.RTL_ENABLED?e.css({left:"360px"}):e.css({right:"360px"}),t.addClass("signal-notification-open"),a.addClass("signal-showdetail-open"),$("#freezeBackGround").on("click",(function(){$("#qCreate").is(":empty")&&"none"===$("#eventCreatePopup").css("display")&&!SalesSignalsWrapper.isSignalDetailViewPopup&&SalesSignals.closeIframeDetailView()}))},SalesSignals.closeIframeDetailView=function(){$("#notificationGroupList").find(".ntc-entity-active").find(".notificationgrpListRow").css("background-color","##f5f5f5");var e=$(document.getElementById("showSignalPopIframe")),t=$("#signalsMainContainer"),a=e.outerWidth();Crm.userDetails.RTL_ENABLED?e.css({left:"-"+a+"px"}):e.css({right:"-"+a+"px"}),t.hasClass("signal-showdetail-open")||t.removeClass("signal-showdetail-open"),t.find(".ntc-entity-group").removeClass("ntc-entity-active")},SalesSignals.closeGlobalNotifications=function(){SalesSignalsWrapper.isSignalIFrameOpen=!1,SalesSignals.closeIframeDetailView(),SalesSignalsWrapper.closeNotificationView()};var SalesSignalsWrapper=SalesSignalsWrapper||{};SalesSignalsWrapper.loadSignalIframeView=function(e,t){SalesSignalsWrapper.isSignalIFrameOpen=!0;t=Crm.getCrmBasePath()+"/SalesSignalsComponent.do?actionname=LoadSalesSignalsComponent";var a=renderingUtils.tabLayerTop()+parseInt(renderingUtils.tabLayerOuterHeight())+28;crmNTCGlobal.signalIframeHeight=renderingUtils.windowHeight-a;var n=$("<iframe>",{name:"signalsIframe",src:t,id:"crmNTCDetailIframe",frameborder:0,scrolling:"no",height:crmNTCGlobal.signalIframeHeight,width:"100%",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",load:function(){$("#loadMsg").hide();var e=window.signalsIframe.$("#freezeBackGround");e.addClass("tbFreezelayer").fadeIn(),SalesSignalsWrapper.setHeightForNotificationBox(),SalesSignalsWrapper.initEventListenerFromParent(),e.on("click",(function(){window.signalsIframe.$("#signalsMainContainer").hasClass("signal-showdetail-open")||SalesSignalsWrapper.closeNotificationView()}))}});$("#freezeBackGround").fadeIn();var i=$("#showSignalIframeContent");i.html('<div class="pR" style=""><div class="SocialArrow newSettingsArrow" style="left: auto; right: 186px;"></div> <span onclick="crmNTCDetailView.hideSignalIframePopup(); sE(event)" style="float:right;display:none;right: 80px;top: 25px;z-index:1;text-align:center;" class="newPopupCloseIcon svgIcons ico-close-small2 cP op8 pA"></span> </div> <div id=signalIframeContainer class="signal-iframe-container"> <div id="loadMsg" class="aligncenter signal-iframe-loading"><div class="dIB"><span class="ntc-loader" style="display:block"></span></div></div> <div id="signalDummyContent" class="signalPopupInnerDiv pR" style="display: block;"></div> </div>'),$("#signalDummyContent").html(n);var l=$("#showSignalIframePop");i.find("#loadMsg").hide(),i.show(),l.length&&l.is(":visible")&&i.css({top:l.css("top")}),i.find(".popup-model-content").removeClass("signal-popup-error")},SalesSignalsWrapper.setHeightForNotificationBox=function(){var e=$("#showSignalIframeContent"),t=e.find("iframe"),a=e.find("iframe").contents(),n=a.find("#signalsMainContainer"),i=a.find("#signalsInnerContainer"),l=a.find("#showSignalPopIframe"),s=a.find("#handlebarReplacement"),r=a.find("#notificationGrpList"),o=renderingUtils.windowWidth,c=parseInt(.25*o),d=parseInt(.65*o),m=s.find(".ntc-notification-head").outerHeight(),p=renderingUtils.tabLayerTop()+parseInt(renderingUtils.tabLayerOuterHeight())+28;crmNTCGlobal.signalIframeHeight=renderingUtils.windowHeight-p;var u=crmNTCGlobal.signalIframeHeight-(30+m);t.css({height:crmNTCGlobal.signalIframeHeight}),i.css({width:o}),n.css({width:c}),l.css({width:d}),n.addClass("signal-wrapper-active"),r.css({height:u}),thirdPartyUtils.bindPerfectScroll(r,{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!0})},SalesSignalsWrapper.updateSignalsCount=function(e){},SalesSignalsWrapper.closeNotificationView=function(){$("#showSignalIframeContent").removeClass("signal-iframe-active"),SalesSignalsWrapper.isSignalIFrameOpen=!1,SalesSignalsWrapper.triggerFunctionFromIframeParent("closeSignalsNotificationOuterContainer")},SalesSignalsWrapper.clearNotificationCountInRedis=function(){SalesSignalsWrapper.isSignalIFrameOpen=!1,SalesSignalsWrapper.triggerFunctionFromIframeParent("clearNotificationCountInRedis")},SalesSignalsWrapper.triggerFunctionFromIframeParent=function(e,t){var a=null;a=""==t||null==t?window.location.protocol.toString()+"//"+window.location.href.toString().split("/")[2]:t.sourceUrl,top.postMessage(e,a)},SalesSignalsWrapper.receiveMessage=function(e){var t=window.location.protocol.toString()+"//"+window.location.href.toString().split("/")[2];if(e.origin===t)switch(e.data){case"closeSignalsNotificationOuterContainer":SalesSignalsWrapper.closeSignalsNotificationOuterContainer();break;case"clearNotificationCountInRedis":SalesSignalsWrapper.clearNotificationCountInCache()}},SalesSignalsWrapper.initEventListenerFromParent=function(){window.addEventListener("message",SalesSignalsWrapper.receiveMessage,!1)},SalesSignalsWrapper.closeSignalsNotificationOuterContainer=function(){SalesSignalsWrapper.isSignalIFrameOpen=!1,$("#showSignalIframeContent").removeClass("signal-iframe-open").hide(),window.removeEventListener("message",SalesSignalsWrapper.receiveMessage),$("#freezeBackGroundSignals").removeClass("tbFreezelayer").fadeOut()},SalesSignalsWrapper.clearNotificationCountInCache=function(){var e=new crmRequestPool,t={action:"resetSalesSignalsCount"};t[csrfParamName]=csrfToken,e.initiate({action:Crm.getCrmBasePath()+"/NotificationCenter.do",data:t,success:function(e){e.global=!0}})};var crmNTC={};crmNTC.ntcEnabled=Crm.userDetails.NTC_ENABLED,crmNTC.isSigSerNamespaceMigCompleted=Crm.userDetails.NTC_SIG_SER_NAMESPACE_MIG_COMPLETED,crmNTC.ZOHO_EXTENSION_TYPE=2,crmNTC.ZOHO_USER_EXTENSION_TYPE=4,crmNTC.EXT_EMAILTRACKING="zoho.email",crmNTC.EXT_EMAILINSIGHTS="zoho.emailinsight",crmNTC.EXT_TELEPHONY="zoho.telephony",crmNTC.EXT_SURVEY="zoho.survey",crmNTC.EXT_CAMPAIGNS="zoho.campaign",crmNTC.EXT_SALESIQ="zoho.livedesk",crmNTC.EXT_SUPPORT="zoho.support",crmNTC.EXT_FACEBOOK="Facebook",crmNTC.EXT_TWITTER="Twitter",crmNTC.EXT_BACKSTAGE="zoho.backstage",crmNTC.EXT_WEBINAR="zoho.webinar",crmNTC.EXT_MESSAGE="Message",crmNTC.EXT_EMAILTRACKING_NEW="Email",crmNTC.EXT_EMAILINSIGHTS_NEW="EmailInsight",crmNTC.EXT_TELEPHONY_NEW="Telephony",crmNTC.EXT_SURVEY_NEW="Survey",crmNTC.EXT_CAMPAIGNS_NEW="Campaign",crmNTC.EXT_SALESIQ_NEW="Livedesk",crmNTC.EXT_SUPPORT_NEW="Support",crmNTC.EXT_FACEBOOK_NEW="Facebook",crmNTC.EXT_TWITTER_NEW="Twitter",crmNTC.EXT_BACKSTAGE_NEW="Backstage",crmNTC.EXT_WEBINAR_NEW="Webinar",crmNTC.MAIL_INCOMING="zoho.email.incoming",crmNTC.MAIL_INCOMING_COMPETITORS_ALERT="zoho.email.incoming.competitors",crmNTC.SURVEY_RESPONDED="zoho.survey.responded",crmNTC.SURVEY_VISITED="zoho.survey.visited",crmNTC.MAILTRACKING_OPEN="zoho.emailinsight.open",crmNTC.MAILTRACKING_CLICK="zoho.emailinsight.click",crmNTC.MAILTRACKING_BOUNCE="zoho.emailinsight.bounce",crmNTC.CAMPAIGN_OPEN="zoho.campaign.open",crmNTC.CAMPAIGN_CLICK="zoho.campaign.click",crmNTC.CAMPAIGN_BOUNCE="zoho.campaign.bounce",crmNTC.CAMPAIGN_SOFT_BOUNCE="zoho.campaign.soft.bounce",crmNTC.CALL_MISSED="zoho.telephony.missed",crmNTC.CALL_NOT_PICKUP="zoho.telephony.notpicked",crmNTC.SALESIQ_CHAT_MISSED="zoho.livedesk.missedchat",crmNTC.SALESIQ_NEW_VISIT_LEAD="zoho.livedesk.newvisit.lead",crmNTC.SALESIQ_NEW_VISIT_CONTACT="zoho.livedesk.newvisit.contact",crmNTC.SALESIQ_NEW_VISIT_POTENTIAL="zoho.livedesk.newvisit.potential",crmNTC.SALESIQ_NEW_VISIT_CUSTOMER="zoho.livedesk.newvisit.customer",crmNTC.SUPPORT_NEW_TICKET="zoho.support.newticket",crmNTC.SUPPORT_NEW_TICKET_LEAD="zoho.support.newticket.lead",crmNTC.SUPPORT_NEW_TICKET_CONTACT="zoho.support.newticket.contact",crmNTC.SUPPORT_NEW_TICKET_POTENTIAL="zoho.support.newticket.potential",crmNTC.SUPPORT_NEW_TICKET_CUSTOMER="zoho.support.newticket.customer",crmNTC.SUPPORT_TICKET_STATUS_CHANGE="zoho.support.ticket.status.change",crmNTC.SUPPORT_NEW_RATING="zoho.support.new.rating",crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE="zoho.support.ticket.priority.change",crmNTC.SUPPORT_TICKET_OVERDUE="zoho.support.ticket.overdue",crmNTC.SUPPORT_TICKET_ESCALATED="zoho.support.ticket.escalated",crmNTC.SUPPORT_NEW_COMMENT_MENTION="zoho.support.newcomment.mention",crmNTC.SUPPORT_NEW_COMMENT="zoho.support.newcomment",crmNTC.SUPPORT_NEW_COMMENT_LEAD="zoho.support.newcomment.lead",crmNTC.SUPPORT_NEW_COMMENT_CONTACT="zoho.support.newcomment.contact",crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL="zoho.support.newcomment.potential",crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER="zoho.support.newcomment.customer",crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP="zoho.support.newcomment.supportrep",crmNTC.SUPPORT_NEW_RESPONSE="zoho.support.newresponse",crmNTC.SUPPORT_NEW_RESPONSE_LEAD="zoho.support.newresponse.lead",crmNTC.SUPPORT_NEW_RESPONSE_CONTACT="zoho.support.newresponse.contact",crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL="zoho.support.newresponse.potential",crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER="zoho.support.newresponse.customer",crmNTC.SOCIAL_FB_NEW_POST="facebook.newpost",crmNTC.SOCIAL_FB_NEW_COMMENT="facebook.newcomment",crmNTC.SOCIAL_FB_NEW_LIKE="facebook.like",crmNTC.SOCIAL_FB_DM="facebook.message",crmNTC.SOCIAL_TW_MENTION="twitter.mention",crmNTC.SOCIAL_TW_REPLY="twitter.reply",crmNTC.SOCIAL_TW_DM="twitter.message",crmNTC.MAIL_INCOMING_NEW="Email_Incoming__s",crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW="Email_Incoming_Competitors__s",crmNTC.SURVEY_RESPONDED_NEW="Survey_Responded__s",crmNTC.SURVEY_VISITED_NEW="Survey_Visited__s",crmNTC.MAILTRACKING_OPEN_NEW="EmailInsight_Open__s",crmNTC.MAILTRACKING_CLICK_NEW="EmailInsight_Click__s",crmNTC.MAILTRACKING_BOUNCE_NEW="EmailInsight_Bounce__s",crmNTC.CAMPAIGN_OPEN_NEW="Campaign_Open__s",crmNTC.CAMPAIGN_CLICK_NEW="Campaign_Click__s",crmNTC.CAMPAIGN_BOUNCE_NEW="Campaign_Bounce__s",crmNTC.CAMPAIGN_SOFT_BOUNCE_NEW="Campaign_Soft_Bounce__s",crmNTC.CALL_MISSED_NEW="Telephony_Missed__s",crmNTC.SALESIQ_CHAT_MISSED_NEW="Livedesk_MissedChat__s",crmNTC.SUPPORT_NEW_TICKET_NEW="Support_NewTicket__s",crmNTC.SUPPORT_NEW_TICKET_LEAD_NEW="Support_NewTicket_Lead__s",crmNTC.SUPPORT_NEW_TICKET_CONTACT_NEW="Support_NewTicket_Contact__s",crmNTC.SUPPORT_NEW_TICKET_POTENTIAL_NEW="Support_NewTicket_Potential__s",crmNTC.SUPPORT_NEW_TICKET_CUSTOMER_NEW="Support_NewTicket_Customer__s",crmNTC.SUPPORT_TICKET_STATUS_CHANGE_NEW="Support_TicketStatusChange__s",crmNTC.SUPPORT_NEW_RATING_NEW="Support_NewRating__s",crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE_NEW="Support_TicketPriorityChange__s",crmNTC.SUPPORT_TICKET_OVERDUE_NEW="Support_TicketOverdue__s",crmNTC.SUPPORT_TICKET_ESCALATED_NEW="Support_TicketEscalated__s",crmNTC.SUPPORT_NEW_COMMENT_MENTION_NEW="Support_NewComment_Mention__s",crmNTC.SUPPORT_NEW_COMMENT_NEW="Support_NewComment__s",crmNTC.SUPPORT_NEW_COMMENT_LEAD_NEW="Support_NewComment_Lead__s",crmNTC.SUPPORT_NEW_COMMENT_CONTACT_NEW="Support_NewComment_Contact__s",crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL_NEW="Support_NewComment_Potential__s",crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER_NEW="Support_NewComment_Customer__s",crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP_NEW="Support_NewComment_SupportRep__s",crmNTC.SUPPORT_NEW_RESPONSE_NEW="Support_NewResponse__s",crmNTC.SUPPORT_NEW_RESPONSE_LEAD_NEW="Support_NewResponse_Lead__s",crmNTC.SUPPORT_NEW_RESPONSE_CONTACT_NEW="Support_NewResponse_Contact__s",crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL_NEW="Support_NewResponse_Potential__s",crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER_NEW="Support_NewResponse_Customer__s",crmNTC.SOCIAL_FB_NEW_POST_NEW="Facebook_NewPost__s",crmNTC.SOCIAL_FB_NEW_COMMENT_NEW="Facebook_NewComment__s",crmNTC.SOCIAL_FB_NEW_LIKE_NEW="Facebook_NewLike__s",crmNTC.SOCIAL_FB_DM_NEW="Facebook_Message__s",crmNTC.SOCIAL_TW_MENTION_NEW="Twitter_Mention__s",crmNTC.SOCIAL_TW_REPLY_NEW="Twitter_Reply__s",crmNTC.SOCIAL_TW_DM_NEW="Twitter_Message__s",crmNTC.SOCIAL_TW_RETWEET="twitter.retweet",crmNTC.SOCIAL_TW_FAVORITE="twitter.favorite",crmNTC.PLATFORM_EXTENSION_SIGNAL="platform.extension.signal",crmNTC.MESSAGE_NEWMESSAGE="Message_NewMessage__s",crmNTC.MESSAGE_READ="Message_Read__s",crmNTC.BACKSTAGE_PURCHASED="zoho.backstage.purchased",crmNTC.BACKSTAGE_CHECKEDIN="zoho.backstage.checkedin",crmNTC.BACKSTAGE_CANCELLED="zoho.backstage.cancelled",crmNTC.BACKSTAGE_PURCHASED_NEW="Backstage_Purchased__s",crmNTC.BACKSTAGE_CHECKEDIN_NEW="Backstage_Checkedin__s",crmNTC.BACKSTAGE_CANCELLED_NEW="Backstage_Cancelled__s",crmNTC.WEBINAR_REGISTERED="zoho.webinar.registered",crmNTC.WEBINAR_ATTENDED="zoho.webinar.registered",crmNTC.WEBINAR_REGISTERED_NEW="Webinar_Registered__s",crmNTC.WEBINAR_ATTENDED_NEW="Webinar_Attended__s",crmNTC.extNewVsOldNamespaceMapping={},crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_EMAILTRACKING_NEW]=crmNTC.EXT_EMAILTRACKING,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_EMAILINSIGHTS_NEW]=crmNTC.EXT_EMAILINSIGHTS,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_TELEPHONY_NEW]=crmNTC.EXT_TELEPHONY,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_SURVEY_NEW]=crmNTC.EXT_SURVEY,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_CAMPAIGNS_NEW]=crmNTC.EXT_CAMPAIGNS,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_SALESIQ_NEW]=crmNTC.EXT_SALESIQ,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_SUPPORT_NEW]=crmNTC.EXT_SUPPORT,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_FACEBOOK_NEW]=crmNTC.EXT_FACEBOOK,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_TWITTER_NEW]=crmNTC.EXT_TWITTER,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_BACKSTAGE_NEW]=crmNTC.EXT_BACKSTAGE,crmNTC.extNewVsOldNamespaceMapping[crmNTC.EXT_WEBINAR_NEW]=crmNTC.EXT_WEBINAR,crmNTC.newVsOldNamespaceMapping={},crmNTC.newVsOldNamespaceMapping[crmNTC.MAIL_INCOMING_NEW]=crmNTC.MAIL_INCOMING,crmNTC.newVsOldNamespaceMapping[crmNTC.SURVEY_RESPONDED_NEW]=crmNTC.SURVEY_RESPONDED,crmNTC.newVsOldNamespaceMapping[crmNTC.SURVEY_VISITED_NEW]=crmNTC.SURVEY_VISITED,crmNTC.newVsOldNamespaceMapping[crmNTC.MAILTRACKING_OPEN_NEW]=crmNTC.MAILTRACKING_OPEN,crmNTC.newVsOldNamespaceMapping[crmNTC.MAILTRACKING_CLICK_NEW]=crmNTC.MAILTRACKING_CLICK,crmNTC.newVsOldNamespaceMapping[crmNTC.MAILTRACKING_BOUNCE_NEW]=crmNTC.MAILTRACKING_BOUNCE,crmNTC.newVsOldNamespaceMapping[crmNTC.CAMPAIGN_OPEN_NEW]=crmNTC.CAMPAIGN_OPEN,crmNTC.newVsOldNamespaceMapping[crmNTC.CAMPAIGN_CLICK_NEW]=crmNTC.CAMPAIGN_CLICK,crmNTC.newVsOldNamespaceMapping[crmNTC.CAMPAIGN_BOUNCE_NEW]=crmNTC.CAMPAIGN_BOUNCE,crmNTC.newVsOldNamespaceMapping[crmNTC.CAMPAIGN_SOFT_BOUNCE_NEW]=crmNTC.CAMPAIGN_SOFT_BOUNCE,crmNTC.newVsOldNamespaceMapping[crmNTC.CALL_MISSED_NEW]=crmNTC.CALL_MISSED,crmNTC.newVsOldNamespaceMapping[crmNTC.SALESIQ_CHAT_MISSED_NEW]=crmNTC.SALESIQ_CHAT_MISSED,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_TICKET_NEW]=crmNTC.SUPPORT_NEW_TICKET,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_TICKET_LEAD_NEW]=crmNTC.SUPPORT_NEW_TICKET_LEAD,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_TICKET_CONTACT_NEW]=crmNTC.SUPPORT_NEW_TICKET_CONTACT,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_TICKET_POTENTIAL_NEW]=crmNTC.SUPPORT_NEW_TICKET_POTENTIAL,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_TICKET_CUSTOMER_NEW]=crmNTC.SUPPORT_NEW_TICKET_CUSTOMER,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_TICKET_STATUS_CHANGE_NEW]=crmNTC.SUPPORT_TICKET_STATUS_CHANGE,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RATING_NEW]=crmNTC.SUPPORT_NEW_RATING,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE_NEW]=crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_TICKET_OVERDUE_NEW]=crmNTC.SUPPORT_TICKET_OVERDUE,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_TICKET_ESCALATED_NEW]=crmNTC.SUPPORT_TICKET_ESCALATED,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_MENTION_NEW]=crmNTC.SUPPORT_NEW_COMMENT_MENTION,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_NEW]=crmNTC.SUPPORT_NEW_COMMENT,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_LEAD_NEW]=crmNTC.SUPPORT_NEW_COMMENT_LEAD,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_CONTACT_NEW]=crmNTC.SUPPORT_NEW_COMMENT_CONTACT,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL_NEW]=crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER_NEW]=crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP_NEW]=crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RESPONSE_NEW]=crmNTC.SUPPORT_NEW_RESPONSE,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RESPONSE_LEAD_NEW]=crmNTC.SUPPORT_NEW_RESPONSE_LEAD,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RESPONSE_CONTACT_NEW]=crmNTC.SUPPORT_NEW_RESPONSE_CONTACT,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL_NEW]=crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL,crmNTC.newVsOldNamespaceMapping[crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER_NEW]=crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_FB_NEW_POST_NEW]=crmNTC.SOCIAL_FB_NEW_POST,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_FB_NEW_COMMENT_NEW]=crmNTC.SOCIAL_FB_NEW_COMMENT,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_FB_NEW_LIKE_NEW]=crmNTC.SOCIAL_FB_NEW_LIKE,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_FB_DM_NEW]=crmNTC.SOCIAL_FB_DM,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_TW_MENTION_NEW]=crmNTC.SOCIAL_TW_MENTION,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_TW_REPLY_NEW]=crmNTC.SOCIAL_TW_REPLY,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_TW_DM_NEW]=crmNTC.SOCIAL_TW_DM,crmNTC.newVsOldNamespaceMapping[crmNTC.SOCIAL_TW_DM_NEW]=crmNTC.SOCIAL_TW_DM,crmNTC.newVsOldNamespaceMapping[crmNTC.BACKSTAGE_PURCHASED_NEW]=crmNTC.BACKSTAGE_PURCHASED,crmNTC.newVsOldNamespaceMapping[crmNTC.BACKSTAGE_CHECKEDIN_NEW]=crmNTC.BACKSTAGE_CHECKEDIN,crmNTC.newVsOldNamespaceMapping[crmNTC.BACKSTAGE_CANCELLED_NEW]=crmNTC.BACKSTAGE_CANCELLED,crmNTC.newVsOldNamespaceMapping[crmNTC.WEBINAR_REGISTERED_NEW]=crmNTC.WEBINAR_REGISTERED,crmNTC.newVsOldNamespaceMapping[crmNTC.WEBINAR_ATTENDED_NEW]=crmNTC.WEBINAR_ATTENDED,crmNTC.SUPPORT_NEW_TICKET_TYPES=[crmNTC.SUPPORT_NEW_TICKET_LEAD,crmNTC.SUPPORT_NEW_TICKET_CONTACT,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER,crmNTC.SUPPORT_NEW_TICKET_LEAD_NEW,crmNTC.SUPPORT_NEW_TICKET_CONTACT_NEW,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER_NEW],crmNTC.SUPPORT_NEW_COMMENT_TYPES=[crmNTC.SUPPORT_NEW_COMMENT_MENTION,crmNTC.SUPPORT_NEW_COMMENT_LEAD,crmNTC.SUPPORT_NEW_COMMENT_CONTACT,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER,crmNTC.SUPPORT_NEW_COMMENT_MENTION_NEW,crmNTC.SUPPORT_NEW_COMMENT_LEAD_NEW,crmNTC.SUPPORT_NEW_COMMENT_CONTACT_NEW,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER_NEW],crmNTC.SUPPORT_NEW_RESPONSE_TYPES=[crmNTC.SUPPORT_NEW_RESPONSE_LEAD,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER,crmNTC.SUPPORT_NEW_RESPONSE_LEAD_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT_NEW,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER_NEW],crmNTC.SUPPORT_TYPES=[crmNTC.SUPPORT_NEW_TICKET_LEAD,crmNTC.SUPPORT_NEW_TICKET_CONTACT,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER,crmNTC.SUPPORT_TICKET_STATUS_CHANGE,crmNTC.SUPPORT_NEW_RATING,crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE,crmNTC.SUPPORT_TICKET_OVERDUE,crmNTC.SUPPORT_TICKET_ESCALATED,crmNTC.SUPPORT_NEW_COMMENT_MENTION,crmNTC.SUPPORT_NEW_COMMENT_LEAD,crmNTC.SUPPORT_NEW_COMMENT_CONTACT,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER,crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP,crmNTC.SUPPORT_NEW_RESPONSE_LEAD,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER,crmNTC.SUPPORT_NEW_TICKET_LEAD_NEW,crmNTC.SUPPORT_NEW_TICKET_CONTACT_NEW,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER_NEW,crmNTC.SUPPORT_TICKET_STATUS_CHANGE_NEW,crmNTC.SUPPORT_NEW_RATING_NEW,crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE_NEW,crmNTC.SUPPORT_TICKET_OVERDUE_NEW,crmNTC.SUPPORT_TICKET_ESCALATED_NEW,crmNTC.SUPPORT_NEW_COMMENT_MENTION_NEW,crmNTC.SUPPORT_NEW_COMMENT_LEAD_NEW,crmNTC.SUPPORT_NEW_COMMENT_CONTACT_NEW,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER_NEW,crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP_NEW,crmNTC.SUPPORT_NEW_RESPONSE_LEAD_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT_NEW,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER_NEW],crmNTC.FB_TYPES=[crmNTC.SOCIAL_FB_NEW_POST,crmNTC.SOCIAL_FB_NEW_COMMENT,crmNTC.SOCIAL_FB_NEW_LIKE,crmNTC.SOCIAL_FB_DM,crmNTC.SOCIAL_FB_NEW_POST_NEW,crmNTC.SOCIAL_FB_NEW_COMMENT_NEW,crmNTC.SOCIAL_FB_NEW_LIKE_NEW,crmNTC.SOCIAL_FB_DM_NEW],crmNTC.TWITTER_TYPES=[crmNTC.SOCIAL_TW_MENTION,crmNTC.SOCIAL_TW_REPLY,crmNTC.SOCIAL_TW_DM,crmNTC.SOCIAL_TW_RETWEET,crmNTC.SOCIAL_TW_FAVORITE,crmNTC.SOCIAL_TW_MENTION_NEW,crmNTC.SOCIAL_TW_REPLY_NEW,crmNTC.SOCIAL_TW_DM_NEW],crmNTC.EMAIL_TYPES=[crmNTC.MAIL_INCOMING,crmNTC.MAIL_INCOMING_COMPETITORS_ALERT,crmNTC.MAILTRACKING_OPEN,crmNTC.MAILTRACKING_CLICK,crmNTC.MAILTRACKING_BOUNCE,crmNTC.MAIL_INCOMING_NEW,crmNTC.MAILTRACKING_OPEN_NEW,crmNTC.MAILTRACKING_CLICK_NEW,crmNTC.MAILTRACKING_BOUNCE_NEW],crmNTC.CAMPAIGN_TYPES=[crmNTC.CAMPAIGN_OPEN,crmNTC.CAMPAIGN_CLICK,crmNTC.CAMPAIGN_BOUNCE,crmNTC.CAMPAIGN_SOFT_BOUNCE,crmNTC.CAMPAIGN_OPEN_NEW,crmNTC.CAMPAIGN_CLICK_NEW,crmNTC.CAMPAIGN_BOUNCE_NEW,crmNTC.CAMPAIGN_SOFT_BOUNCE_NEW],crmNTC.SURVEY_TYPES=[crmNTC.SURVEY_RESPONDED,crmNTC.SURVEY_VISITED,crmNTC.SURVEY_RESPONDED_NEW,crmNTC.SURVEY_VISITED_NEW],crmNTC.FEATURES={SALES_SIGNALS:1,LEAD_SCORING:2,NOTIFY_VIA_CHAT:4},crmNTC.predefinedSignals=[crmNTC.MAIL_INCOMING,crmNTC.MAILTRACKING_OPEN,crmNTC.MAILTRACKING_CLICK,crmNTC.MAILTRACKING_BOUNCE,crmNTC.CALL_MISSED,crmNTC.SURVEY_RESPONDED,crmNTC.SALESIQ_CHAT_MISSED,crmNTC.CAMPAIGN_OPEN,crmNTC.CAMPAIGN_CLICK,crmNTC.CAMPAIGN_BOUNCE,crmNTC.CAMPAIGN_BOUNCE,crmNTC.SUPPORT_NEW_TICKET_LEAD,crmNTC.SUPPORT_NEW_TICKET_CONTACT,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER,crmNTC.SUPPORT_TICKET_STATUS_CHANGE,crmNTC.SUPPORT_NEW_RATING,crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE,crmNTC.SUPPORT_TICKET_OVERDUE,crmNTC.SUPPORT_TICKET_ESCALATED,crmNTC.SUPPORT_NEW_COMMENT_MENTION,crmNTC.SUPPORT_NEW_COMMENT_LEAD,crmNTC.SUPPORT_NEW_COMMENT_CONTACT,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER,crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP,crmNTC.SUPPORT_NEW_RESPONSE_LEAD,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER,crmNTC.SOCIAL_FB_NEW_POST,crmNTC.SOCIAL_FB_NEW_COMMENT,crmNTC.SOCIAL_FB_NEW_LIKE,crmNTC.SOCIAL_FB_DM,crmNTC.SOCIAL_TW_MENTION,crmNTC.SOCIAL_TW_REPLY,crmNTC.SOCIAL_TW_DM,crmNTC.MAIL_INCOMING_NEW,crmNTC.MAILTRACKING_OPEN_NEW,crmNTC.MAILTRACKING_CLICK_NEW,crmNTC.MAILTRACKING_BOUNCE_NEW,crmNTC.CALL_MISSED_NEW,crmNTC.SURVEY_RESPONDED_NEW,crmNTC.SALESIQ_CHAT_MISSED_NEW,crmNTC.CAMPAIGN_OPEN_NEW,crmNTC.CAMPAIGN_CLICK_NEW,crmNTC.CAMPAIGN_BOUNCE_NEW,crmNTC.CAMPAIGN_SOFT_BOUNCE_NEW,crmNTC.SUPPORT_NEW_TICKET_LEAD_NEW,crmNTC.SUPPORT_NEW_TICKET_CONTACT_NEW,crmNTC.SUPPORT_NEW_TICKET_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_TICKET_CUSTOMER_NEW,crmNTC.SUPPORT_TICKET_STATUS_CHANGE_NEW,crmNTC.SUPPORT_NEW_RATING_NEW,crmNTC.SUPPORT_TICKET_PRIORITY_CHANGE_NEW,crmNTC.SUPPORT_TICKET_OVERDUE_NEW,crmNTC.SUPPORT_TICKET_ESCALATED_NEW,crmNTC.SUPPORT_NEW_COMMENT_MENTION_NEW,crmNTC.SUPPORT_NEW_COMMENT_LEAD_NEW,crmNTC.SUPPORT_NEW_COMMENT_CONTACT_NEW,crmNTC.SUPPORT_NEW_COMMENT_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_COMMENT_CUSTOMER_NEW,crmNTC.SUPPORT_NEW_COMMENT_SUPPORT_REP_NEW,crmNTC.SUPPORT_NEW_RESPONSE_LEAD_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CONTACT_NEW,crmNTC.SUPPORT_NEW_RESPONSE_POTENTIAL_NEW,crmNTC.SUPPORT_NEW_RESPONSE_CUSTOMER_NEW,crmNTC.SOCIAL_FB_NEW_POST_NEW,crmNTC.SOCIAL_FB_NEW_COMMENT_NEW,crmNTC.SOCIAL_FB_NEW_LIKE_NEW,crmNTC.SOCIAL_FB_DM_NEW,crmNTC.SOCIAL_TW_MENTION_NEW,crmNTC.SOCIAL_TW_REPLY_NEW,crmNTC.SOCIAL_TW_DM_NEW,crmNTC.MESSAGE_NEWMESSAGE,crmNTC.MESSAGE_READ],crmNTC.url=Crm.getCrmBasePath()+"/NotificationCenter.do",crmNTC.globalToggleFlag=0,$(document).ready((function(){crmNTC.windowSize={wwidth:renderingUtils.windowWidth,wheight:renderingUtils.windowHeight}})),crmNTC.showFullNotifications=function(e){$(e).find(".vmore").remove(),$(e).find(".nc-rtime").show();var t=$(e).closest("li");if(crmNTC.globalToggleFlag=0,crmNTCDetailView.resetToggleClass(),!t.attr("data-ntc-isRead")){if(t.find("li").map((function(){var e=$(this),t=e.attr("data-ntcobj");if(void 0!==t&&!(t=JSON.parse(t)).ISSEEN)return e.attr("data-notification-id")})).toArray().length>0){var a=e.parentElement.dataset.ntcEntityid;crmNTC.markRead(a)}t.removeClass("cursorpointer").find(".notificationgrpListRow").addClass("ntc-visited")}},crmNTC.markRead=function(e){var t="/crm/v2/signals/notifications/actions/read?record_id="+e,a=new crmRequestPool,n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};a.initiate({action:t,headers:n,data:"",type:"PUT",success:function(e,t){$("[data-ntc-entityId="+t+"]").attr("data-ntc-isread",!0);var a=e.notifications.details.count;crmNTCGlobal.signals_count=crmNTCGlobal.signals_count-a,crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.live_global_notifications_count-a,crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.live_global_notifications_count<=0?0:crmNTCGlobal.live_global_notifications_count,crmNTCGlobal.updateNotificationCount()}})},crmNTC.sortByAuditTime=function(e){return e.sort((function(e,t){var a=new Date(e.lastAuditedTime.replace(" ","T"));return new Date(t.lastAuditedTime.replace(" ","T"))-a}))},crmNTC.getNTCFullDateTime=function(e){e=e.replace(" ","T");var t=new Date(e),a=new Date,n=Utils.getTimeInUserFormat(t,!0),i="M d,";return t.getFullYear()!=a.getFullYear()&&(i="M d, yy"),$.datepicker.formatDate(i,t)+" "+n},crmNTC.isSignalDetailViewVisible=function(){var e=$("#showSignalPop");return!!(e.is(":visible")&&e.length>0)},crmNTC.quickCreate=function(e,t,a,n,i,l){Crm.trackSpotLightAction("CRM Signals - Quick Create Click",{Operation:e}),"NewEvent"===e?Events.globalCreate(i,t,l,"",!1,n):"NewCall"===e&&isNewCallView&&Crm.globalCreate(i,t,l,"",n),"NewAppointment"===e?Events.globalCreate(i,t,"Appointments"):Q.selectAction(e,t,a,n,t,!1,void 0,l,i)},crmNTC.positionQcreatePopup=function(){var e=$("#qCreate");(e.css({display:"block",position:"absolute",width:"475px",left:"550px",top:"100px"}),0!==e.length)&&(renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:".1"}));renderingUtils.ShakeDivInfreeze("qCreate","left",20,100)},crmNTC.positionEventQcreatePopup=function(){var e=$("#eventCreatePopup");(e.css({display:"block",position:"absolute",width:"475px",left:"550px",top:"300px"}),e.attr("onclick","sE(event)"),0!==e.length)&&(renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:".1"}));renderingUtils.ShakeDivInfreeze("eventCreatePopup","left",20,100)},crmNTC.positionAppointmentcreatePopup=function(){var e=$("#appointmentCreate");(e.attr("onclick","sE(event)"),0!==e.length)&&(renderingUtils.freezeBackground(),$("#FreezeLayer").css({opacity:".1"}))},crmNTC.showQuickCreateSuccessMsg=function(e){var t=e.entityId,a=e.entityModule;void 0===a&&(a=e.module);var n=a;"Events"===a&&(n=Events.getModuleName(!0,!0,!1)),"Appointments"===a&&crmui.hidePopup("appointmentCreate"),Crm.trackSpotLightAction("CRM Signals - Quick Create Success",{Operation:a}),crmui.showMsgBand("success",I18n.getMsg("crm.signal.entity.quick.create.success",[I18n.getMsg(n),t,a,Crm.getCrmBasePath()]),3e3)},crmNTC.notifyBodyEleWidth=function(){var e=$("#notificationGroupList");if(e.length&&e.is(":visible")){var t=e.find(".notificationgrpListRow").eq(0),a=parseInt(t.css("width"))-160;e.find(".notifyBodyEle .ntcTxtShort").css({width:a})}},crmNTC.getSupportedChannelsCount=function(e,t){var a=1;return e&&(a+=1),void 0!==t&&t.isSlackAvailableForSignals&&t.hasOwnProperty("selectedteam")&&void 0!==t.selectedteam&&(a+=1),a};var crmNTCGlobal=crmNTCGlobal||{};function loadZohoCustomSignalIcons(){var e=$("img.lazy"),t=e.toArray(),a=!1,n=0,i=function(){!1===a&&0==n&&(a=!0,setTimeout((function(){var e=0,l=t.length;0===t.length&&(document.removeEventListener("scroll",i),window.removeEventListener("resize",i),window.removeEventListener("orientationchange",i));for(var s=0;s<l;s++){var r=t[s];if(r.getBoundingClientRect().top<=window.innerHeight&&r.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(r).display&&(e++,!0,r.src=r.dataset.src,r.classList.remove("lazy"),e>=5))break}t=t.filter((function(e){return $(e).hasClass("lazy")})),n+=e,a=!1}),200))};e.bind("load",(function(){n>0&&n--,0==n&&i()})).each((function(){this.complete&&$(this).trigger("load")})),document.addEventListener("scroll",i),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),i()}crmNTCGlobal.page=0,crmNTCGlobal.isCrmNotificationCenterEmpty=crmNTCGlobal.isCrmNotificationCenterEmpty||!1,crmNTCGlobal.signals_count=0,crmNTCGlobal.feeds_count=0,crmNTCGlobal.new_feeds_count=0,crmNTCGlobal.live_global_notifications_count=0,crmNTCGlobal.globalScrollFlag=crmNTCGlobal.globalScrollFlag||!1,crmNTCGlobal.isGlobalScrollLoading=crmNTCGlobal.isGlobalScrollLoading||!1,crmNTCGlobal.isSocialConfigChanged=!0,crmNTCGlobal.isSocialRunning=!1,crmNTCGlobal.lastIndex=0,crmNTCGlobal.isSalesSignalsComponentOpenForCrmPlus=!1,crmNTCGlobal.end_page=0,crmNTCGlobal.lastNotificationIdInRecordTimeline="",crmNTCGlobal.temp=[],crmNTCGlobal.manageSignalNewFunc={},crmNTCGlobal.createSigBuffer={},crmNTCGlobal.updateSigBuffer={},crmNTCGlobal.emailsAI={},crmNTCGlobal.emailsAISelfMarketing=function(){crmNTCGlobal.emailsAI.isFromSelfMarketing=!0;var e=networkUtils.returnDependencyFiles(["crm-emailsai-selfmarketing.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-emailsai-selfmarketing.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),a=e.concat(t);Lyte.injectResources(a,void 0,(function(){Lyte.Component.render("crm-emailsai-selfmarketing",{isFromSalesSignal:!0},"#cns")}))},crmNTCGlobal.getStatusOfSalesSignalsComponentInCrmPlus=function(){"object"==typeof CrmPlusImpl&&(void 0===CrmPlusLib.isInNewSalesSignalsView||0==CrmPlusLib.isInNewSalesSignalsView?crmNTCGlobal.isSalesSignalsComponentOpenForCrmPlus=!1:1==CrmPlusLib.isInNewSalesSignalsView&&(crmNTCGlobal.isSalesSignalsComponentOpenForCrmPlus=!0))},crmNTCGlobal.renderGlobalNotification=function(){var e=[],t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],ResourceConstants.CRM);e=(e=e.concat(networkUtils.returnDependencyFiles(["crm_feeds.css"],ResourceConstants.CRM))).concat(t),Lyte.injectResources(e,void 0,function(){("undefined"==typeof CrmPlusImpl||"undefined"!=typeof CrmPlusImpl&&!CrmPlusImpl.isLoadedInCrmplus())&&(hideMenu(),Activities.RemainderHideOnly());var e=$(window).scrollLeft(),t=$("#notificationscontainer"),a=t.css("width"),n=t.css("height"),i=$("#notificationscontainer .SocialArrow"),l=$("#feeds_notification_container .zcicncss-notifyTopbar"),s=l.offset().left,r=l.outerWidth(),o=$("#nc-tabs-menu"),c=$("#feeds #notifications_inner"),d=$("#GNCSettings"),m=$L("body"),p=$L("#freezeBackGround");$(".notifiactionIcon").addClass("notifiactionIconH");var u=Crm.userDetails.NTC_ENABLED;crmNTCGlobal.getStatusOfSalesSignalsComponentInCrmPlus(),u&&crmNTCGlobal.isSalesSignalsComponentOpenForCrmPlus&&(u=!1);var g=!1;void 0!==Crm.userDetails.MODULE_LIST.Feeds&&("undefined"==typeof CrmPlusImpl||"undefined"!=typeof CrmPlusImpl&&!CrmPlusImpl.isLoadedInCrmplus()?g=!Crm.userDetails.PERSONAL_ACCOUNT&&Crm.userDetails.MODULE_LIST.Feeds.visible:(g=!Crm.userDetails.PERSONAL_ACCOUNT&&Crm.userDetails.MODULE_LIST.Feeds.visible,"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&Crm.userDetails.PERSONAL_ACCOUNT&&(g=Crm.userDetails.MODULE_LIST.Feeds.visible)));if(featuresAvailable.NEXTGENUI_ENABLED){var h=$L(".crm-leftmenu-tab"),C=$L(".ts-fxd-sc"),f=$L(".leftMenuModules"),_=$L(".zHAppMask"),N=$L("#leftZappsMenu");_&&_.length>0&&(zmwp.HamburgerMenu.remove(),N&&N.length>0&&N.removeClass("lft-Zapps-active")),f&&f.length>0&&h&&h.length>0&&h.addClass("leftmenu-noindex"),C&&C.length>0&&C.addClass("lftmnu-fxd-ntfn")}var v=$("#showOneFeed");if(t.hasClass("open")||v.is(":visible"))t.removeClass("open"),crmNTCGlobal.closeGlobalNotifications(),v.css("display","none");else{var T=Handlebars.templates.centralNotifications({ntc_enabled:u,feeds_enabled:g});if($("#notifications_inner").html(T),Crm.userDetails.RTL_ENABLED){var E=s+r/2-11;i.css({right:"auto !important",left:E})}else{var I=renderingUtils.windowWidth+e-(s+r);i.css({left:"auto",right:I})}t.addClass("open");var P=document.querySelector("crm-left-menu");if(P&&(P=P.component).actions.updateNavActiveClassForBottomMenu("leftPaneNotification",!0),crmNTC.globalToggleFlag=0,crmNTCGlobal.setNTCContainerHt(),c.css("height",renderingUtils.windowHeight-(o+3)),d.css({width:a,height:n,top:"0px",right:"0px"}),u){var S=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.js"],ResourceConstants.CRMClient),b=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.css"],ResourceConstants.CRMClient);Lyte.injectResources(S.concat(b),void 0,(function(){crmNTCGlobal.fetchGlobalNotifications()}))}else g&&getUNSNotificationList();t.is(":visible")&&m.css("overflow","hidden"),crmui.modalZIndex("nonLyte",t[0],"open")}this.hideSidePopup();var w=$("#conditionalFieldRightSection"),y=$("#validationRuleRightSection");w.length&&w.css("right","-650px"),y.length&&y.hide(),featuresAvailable.NEXTGENUI_ENABLED&&t.hasClass("open")&&(renderingUtils.showFreezeLayer(),p.css({opacity:.5}),p.attr("onclick","crmNTCGlobal.closeGlobalNotifications();"))}.bind(this))},crmNTCGlobal.hideSidePopup=function(){"block"===$("#emailalert").css("display")&&closealertMail("emailalert");var e=$("#showOneFeed"),t=$("#showSignalPop");$("#notificationGroupList li.left-Arrow-ntc").length>0&&$(".left-Arrow-ntc").hide(),e.is(":visible")&&e.hide(),t.is(":visible")&&t.hide().removeClass("signal-open"),featuresAvailable.NEXTGENUI_ENABLED||renderingUtils.hideFreezeLayer()},crmNTCGlobal.setNTCContainerHt=function(){setTimeout((function(){var e=$("#notificationscontainer"),t=$("#wmstoolbar"),a=t.is(":visible")&&t.length?t.outerHeight():29;crmNTC.globalToggleFlag=0;var n=parseInt(renderingUtils.tabLayerOuterHeight())+renderingUtils.tabLayerTop();$("body").hasClass("zcrmInsideCRMPlus")&&(n=0),e.css({top:n,height:renderingUtils.windowHeight-(n+a)})}),200)},crmNTCGlobal.tabAction=function(e){var t=$(e);t.addClass("sel"),t.siblings().removeClass("sel"),this.hideSidePopup()},crmNTCGlobal.setNotificationHeight=function(){var e=renderingUtils.tabLayerOuterHeight(),t=$("#wmstoolbar"),a=t.is(":visible")&&t.length?t.outerHeight():29,n=parseInt(renderingUtils.windowHeight-parseInt(e+renderingUtils.tabLayerTop()+a))-parseInt($("#nc-tabs-menu").outerHeight()+$("#notifySett").outerHeight());$("#notifications_inner #notificationGrpList").css({height:n}),thirdPartyUtils.bindPerfectScroll("#notificationGrpList",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!0});var i=$("#GNCSettings .signalSettings_Inner_Tbl");if(i.is(":visible")&&i.length){var l=renderingUtils.windowHeight-(parseInt(e)+125);i.css("height",l).perfectScrollbar({wheelSpeed:60,wheelPropagation:!1,suppressScrollX:!0})}crmNTC.notifyBodyEleWidth()},crmNTCGlobal.getAuditedTimeForRecentNotification=function(e){for(var t=e[0].audited_time,a=e.length,n=0;n<a;n++){var i=e[n].audited_time;i>t&&(t=i)}return t},crmNTCGlobal.convert=function(e){var t={};t.info=e.info,t.group_notifications=[];var a={},n={},i=0;void 0!==e.notifications&&(i=e.notifications.length);for(var l=0;l<i;l++){var s=e.notifications[l].record;if(void 0!==s){var r=s.id,o=e.notifications[l].module,c={};c.record=s,c.module=o,void 0===n.record_id&&(n[r]=c),delete e.notifications[l].record,delete e.notifications[l].module;var d=e.notifications[l];void 0===a[r]&&(a[r]=[]),a[r].push(d)}}for(var m in n)if(n.hasOwnProperty(m)){var p={},u=n[m].record.id;p.record=n[m].record,p.module=n[m].module,p.notifications=a[u],p.lastAuditedTime=crmNTCGlobal.getAuditedTimeForRecentNotification(p.notifications),t.group_notifications.push(p)}return t},crmNTCGlobal.fetchGlobalNotifications=function(){commonUtils.showHideLoadingDiv(!0);var e=new crmRequestPool;crmNTCGlobal.page=1;var t="/crm/v2/signals/notifications?page="+crmNTCGlobal.page,a={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};e.initiate({action:t,headers:a,data:"",type:"GET",success:function(e){if(crmNTCGlobal.start_page=1,crmNTCGlobal.end_page=1,crmNTCGlobal.isCrmNotificationCenterEmpty=e.info.is_empty,e=crmNTCGlobal.convert(e),commonUtils.showHideLoadingDiv(),e.global=!0,crmNTC.new_social=e.info.new_social,e.group_notifications&&e.group_notifications.length>0){e.group_notifications=crmNTC.sortByAuditTime(e.group_notifications),thirdPartyUtils.unbindChildEvents("#notificationList",!0,!0,!1),$("#notificationList").html(Handlebars.templates.globalSignal(e)).removeClass("pR oH"),crmNTCGlobal.setNotificationHeight(),$("#globalNotificationShowMore").html(Handlebars.templates.cvNotificationShowMore(e)),crmNTCGlobal.globalScrollFlag=e.info.more_records||!1,crmNTCGlobal.lastIndex=e.info.last_index||0;var t=window.location.href.split("="),a=$("#notifySett .notify-setting");"notificationSettings"===t[2]?a.removeAttr("onclick").attr("onclick","crmNTCGlobal.closeGlobalNotifications();"):a.removeAttr("onclick").attr("onclick","crmNTCGlobal.showGlobalSettings();"),crmNTCGlobal.live_global_notifications_count=e.live_ntc_count||0,crmNTCGlobal.updateNotificationCount(),loadZohoCustomSignalIcons()}else $("#notificationList").html(Handlebars.templates.emptySignalNotification())}})},crmNTCGlobal.resetLiveGlobalNotificationsCount=function(e){var t=new crmRequestPool,a={action:"resetLiveGlobalNotificationsCount",signals_count:crmNTCGlobal.signals_count,feeds_count:crmNTCGlobal.feeds_count};a[csrfParamName]=csrfToken,t.initiate({action:crmNTC.url,data:a,success:function(t){crmNTCGlobal.live_global_notifications_count=t.live_ntc_count||0,e&&e()}})},crmNTCGlobal.fetchNotificationsCount=function(e){var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/signals/notifications/actions/count",headers:t,type:"GET",data:"",success:function(t){crmNTCGlobal.signals_count=t.notifications.unseen_ntc_count||0,crmNTCGlobal.live_global_notifications_count=t.notifications.live_ntc_count||0,e&&e()}})},crmNTCGlobal.setGlobalNotificationCount=function(e){e||(e=0),crmNTCGlobal.feeds_count=e,crmNTCGlobal.fetchNotificationsCount(crmNTCGlobal.updateNotificationCount)},crmNTCGlobal.roundCount=function(e){var t=$L("#feeds_notification");return featuresAvailable.NEXTGENUI_ENABLED&&t&&t.length>0&&e>99&&t.addClass("feedNotifyCountPlus"),e>99?"99+":e},crmNTCGlobal.getTotalCount=function(){if("99+"===crmNTCGlobal.live_global_notifications_count)return"99+";var e=parseInt(crmNTCGlobal.live_global_notifications_count);return crmNTCGlobal.roundCount(e)},crmNTCGlobal.updateNotificationCount=function(){var e=crmNTCGlobal.getTotalCount(),t=parseInt(crmNTCGlobal.feeds_count),a=$("#feeds_notification");t>0||parseInt(e)>0?(0==e&&(e=t),a.show().text(e)):a.hide(),crmNTCGlobal.getStatusOfSalesSignalsComponentInCrmPlus(),crmNTCGlobal.isSalesSignalsComponentOpenForCrmPlus?crmplusImplTriggerActions("setNotificationCount",["general",crmNTCGlobal.feeds_count]):crmplusImplTriggerActions("setNotificationCount",["general",e]),crmNTCGlobal.resetFeedsCount(),crmNTCGlobal.resetSignalsCount()},crmNTCGlobal.resetFeedsCount=function(){var e=$("#feeds_count");crmNTCGlobal.feeds_count&&"0"!==crmNTCGlobal.feeds_count?e.show().text(crmNTCGlobal.feeds_count):e.hide()},crmNTCGlobal.resetSignalsCount=function(){var e=$("#signals_count");crmNTCGlobal.signals_count&&parseInt(crmNTCGlobal.signals_count)>0?e.show().text(crmNTCGlobal.signals_count):e.hide()},crmNTCGlobal.incrNotificationsCount=function(){crmNTCGlobal.signals_count=crmNTCGlobal.signals_count+1,crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.live_global_notifications_count+1},crmNTCGlobal.showGlobalSettings=function(){var e=new crmRequestPool,t={action:"getNotificationSettings"};t[csrfParamName]=csrfToken,e.initiate({action:crmNTCSettings.url,data:t,success:function(e){var t=$("#tabLayer").outerHeight();(e=JSON.parse(e)).global=!0;var a=$("#notificationscontainer .newPopupCloseIcon"),n=$("#GNCSettings");n.html(Handlebars.templates.NotificationSettings(e)).show(),a.removeAttr("onclick").attr("onclick","crmNTCGlobal.closeGlobalSettings(this);");var i=renderingUtils.windowHeight-(t+125);n.find(".signalSettings_Inner_Tbl").css("height",i),thirdPartyUtils.bindPerfectScroll("#GNCSettings .signalSettings_Inner_Tbl",{wheelSpeed:60,preventOnEnd:!0,preventHorizontal:!0}),thirdPartyUtils.bindSelect2(".chosenSel")}}),this.hideSidePopup(),Crm.trackSpotLightAction("CRM Signals - Signal Settings",{Place:"Bell Icon",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME})},crmNTCGlobal.globalNotificationScroll=function(){if(loadZohoCustomSignalIcons(),crmNTCGlobal.globalScrollFlag&&!crmNTCGlobal.isGlobalScrollLoading){var e=$("#notificationGrpList"),t=$("#globalNotificationShowMore").find(".newwhitebtn"),a=e.outerHeight()+e.offset().top;if(t.length)a+15>t.offset().top&&renderingUtils.triggerEvent("click",t)}},crmNTCGlobal.fetchMoreGlobalNotifications=function(){crmNTC.isGlobalScrollLoading=!0,crmNTCGlobal.page=crmNTCGlobal.page+1;var e=$("#globalNotificationShowMore");e.html("<img src='"+networkUtils.getImageUrl("moreloading1_lightmode.gif",ResourceConstants.CRM)+"' class='w16 h16' data-image-mode='true'>"),commonUtils.showHideLoadingDiv(!0);var t=new crmRequestPool,a="/crm/v2/signals/notifications?page="+crmNTCGlobal.page,n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};t.initiate({action:a,headers:n,data:"",type:"GET",success:function(t){crmNTCGlobal.end_page=crmNTCGlobal.end_page+1,(t=crmNTCGlobal.convert(t)).global=!0,$("#notificationGrpList #notificationGroupList").append(Handlebars.templates.notificationGroups(t)),e.html(Handlebars.templates.cvNotificationShowMore(t)),thirdPartyUtils.bindPerfectScrollUpdate("#notificationGrpList"),commonUtils.showHideLoadingDiv(),crmNTCGlobal.globalScrollFlag=t.info.more_records||!1,crmNTCGlobal.lastIndex=t.info.last_index||0,crmNTC.isGlobalScrollLoading=!1,crmNTC.notifyBodyEleWidth()}})},crmNTCGlobal.closeGlobalNotifications=function(){var e=$("#notificationscontainer"),t=$L("body");if(featuresAvailable.NEXTGENUI_ENABLED&&e.hasClass("open")&&(renderingUtils.hideFreezeLayer(),crmui.modalZIndex("nonLyte",e[0],"close")),e.removeClass("open"),0==e.is(":visible")&&t.css("overflow","auto"),$("#showSignalPop").hide().removeClass("signal-open"),$("#showOneFeed").hide(),t.css("overflow","auto"),featuresAvailable.NEXTGENUI_ENABLED){var a=document.querySelector("crm-left-menu");a&&(a=a.component).actions.updateNavActiveClassForBottomMenu("leftPaneNotification",!1);var n=$(".crm-leftmenu-tab"),i=$L(".ts-fxd-sc");n.length>0&&n.removeClass("leftmenu-noindex"),i&&i.length>0&&i.removeClass("lftmnu-fxd-ntfn")}},crmNTCGlobal.closeGlobalSettings=function(e){$("#GNCSettings").hide(),$(e).removeAttr("onclick").attr("onclick","crmNTCGlobal.closeGlobalNotifications();")},crmNTCGlobal.call=function(e,t,a,n){if(Crm.trackSpotLightAction("CRM Signals - Call"),Crm.userDetails.TELEPHONY_ENABLED)ctiApiNotifier.click2Call(e,Crm.userDetails.ZGID,Crm.userDetails.USER_ID,t,"",a,n);else if(window.ZPB&&ZPB.clickToDial.isEnabled())crmCallsNew.initiateCallViaZPB(e,t,a,n);else{var i=commonUtils.getPlainPhoneNo(e);i=0==i.indexOf("+")?i.substring(1):i,Utils.windowLocationHref("tel:+"+i+"?call")}},crmNTCGlobal.isEntityOnline=function(e,t){return"undefined"!=typeof CrmTracking&&CrmTracking.isEntityOnline(e,t)},crmNTCGlobal.getChatLink=function(e,t){return"undefined"!=typeof CrmTracking?CrmTracking.getChatLink(e,t):""},crmNTCGlobal.startChat=function(e,t){if("undefined"!=typeof CrmTracking){var a=CrmTracking.getChatLink(e,t);""!==a&&networkUtils.openUrl(a)}},crmNTCGlobal.getNTCIconClass=function(e){var t=e.signal.namespace;return t.includes(crmNTC.EXT_EMAILTRACKING+".")||t.includes(crmNTC.EXT_EMAILTRACKING_NEW+".")?"mail-envolope":t.includes(crmNTC.EXT_EMAILINSIGHTS+".")||t.includes(crmNTC.EXT_EMAILINSIGHTS_NEW+".")?"mail-tracking":t.includes(crmNTC.EXT_SURVEY)||t.includes(crmNTC.EXT_SURVEY_NEW)?"survey-responce":t.includes(crmNTC.EXT_TELEPHONY)||t.includes(crmNTC.EXT_TELEPHONY_NEW)?"call-missed":t.includes(crmNTC.EXT_SALESIQ)||t.includes(crmNTC.EXT_SALESIQ_NEW)?"chat-conversation":t.includes(crmNTC.EXT_CAMPAIGNS)||t.includes(crmNTC.EXT_CAMPAIGNS_NEW)?"announcement":t.includes(crmNTC.EXT_SUPPORT)||t.includes(crmNTC.EXT_SUPPORT_NEW)?"support-avatar":t.includes("facebook")||t.includes("Facebook")?"social-facebook":t.includes("twitter")||t.includes("Twitter")?"social-twiter":t.includes(crmNTC.EXT_BACKSTAGE)||t.includes(crmNTC.EXT_BACKSTAGE_NEW)?"backstage":t.includes(crmNTC.EXT_WEBINAR)||t.includes(crmNTC.EXT_WEBINAR_NEW)?"zoho-meeting":t.includes(crmNTC.MESSAGE_NEWMESSAGE)||t.includes(crmNTC.MESSAGE_READ)?"whatsup":"mail-envolope"},crmNTCGlobal.markAllAsRead=function(){var e=$(".notificationgrpListRow");if(e.length!==$(".ntc-visited").length){Crm.trackSpotLightAction("CRM Signals - Mark All As Read",{Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME});var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/signals/notifications/actions/read",headers:t,data:"",type:"PUT",success:function(){if($(".ntc-entity-group").attr("data-ntc-isRead",!0),e.addClass("ntc-visited"),crmNTCGlobal.signals_count=0,crmNTCGlobal.updateNotificationCount(),SalesSignalsWrapper.isSignalIFrameOpen){var t=$("#notificationGroupList").find(".ntc-unread");t.find(".notificationgrpListRow").css("background-color","#EDF0F4"),t.find(".notiNumCount").css("color","#555").css("border","#c3c3c3"),t.find(".notC").css("border","1px #c3c3c3 solid")}crmNTCGlobal.lastIndex=0}})}},crmNTCGlobal.getCrmPrefix=function(){return Crm.getCrmBasePath()},crmNTCGlobal.openNotificationActionInPopup=function(e){networkUtils.openUrl(networkUtils.getOrgSpecificURL(e),"notificationAction","toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,resizeable=yes,menubar=no,width=934,height=598,top=145,left=145")},crmNTCGlobal.showFreezeLayerForSignals=function(){var e=$("#FreezeLayerSignals");e.css("display","block"),e.addClass("freezeLayeroverPopupForSignals")},crmNTCGlobal.hideFreezeLayerForSignals=function(){var e=$("#FreezeLayerSignals");e.css("display","none"),e.removeClass("freezeLayeroverPopupForSignals")},crmNTCGlobal.updateCusFunCallBack=function(e,t,a){Lyte.registeredMixins.managesignals.updateFunctionSuccessCallBack(e,t,a)},crmNTCGlobal.createWidSuccessCallBack=function(e,t){Lyte.registeredMixins.managesignals.handleWidgetCreate(e,t)},crmNTCGlobal.updateWidSuccessCallBack=function(e,t){Lyte.registeredMixins.managesignals.handleWidgetUpdate(t.widgets.id,e),crmNTCGlobal.closePopupAndOpenSigPanel("CrmWidgetsForm",e)},crmNTCGlobal.closePopupAndOpenSigPanel=function(e,t){Lyte.registeredMixins.managesignals.closePopupAndOpenSigPanel(e,t)},crmNTCGlobal.getPageLoadDataForWidget=function(e,t){var a={record:{}};return a.record.id=t.entityId,a.record.module=t.module,a.record.name=t.fullName,a.record.email=t.entityEmail,a.signal={},a.signal.id=e.signal.id,a.signal.namespace=e.signal.namespace,a.data=e.metadata,a};var crmNTCDetailView=crmNTCDetailView||{};crmNTCDetailView.supportPortalName="",crmNTCDetailView.supportZgid="",crmNTCDetailView.newDesk=!1,crmNTCDetailView.maxShowMoreHt=150,crmNTCDetailView.loadUptoCount,crmNTCDetailView.lastLoadedCount,crmNTCDetailView.globalScrollFlag,crmNTCDetailView.minimumToggleWidth=1280,crmNTCDetailView.socialSignalsQueue=[],crmNTCDetailView.iframeLoadedNtcIds=[],crmNTCDetailView.showFullDetailView=function(e,t){if(!crmNTCGlobal.emailsAI||!crmNTCGlobal.emailsAI.isFromSelfMarketing){var a=this,n=networkUtils.returnDependencyFiles(["crm-lyte-editor-pannel.js","crm-richtext-resources.js"],ResourceConstants.CRMClient),i=networkUtils.returnDependencyFiles(["crm-richtext-resources-less.css","lyte-ui-editor.css"],ResourceConstants.LESSDEFAULT),l=networkUtils.returnDependencyFiles(["lyte-ui-emoji.css"],ResourceConstants.CRMClient),s=n.concat(l).concat(i).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("richtext")],ResourceConstants.CRM));Lyte.injectResources(s,void 0,(function(){if(SalesSignalsWrapper.isSignalIFrameOpen&&($("#notificationGroupList").find(".ntc-entity-active").find(".notificationgrpListRow").css("background-color","#EDF0F4"),SalesSignals.showIframeDetailView()),featuresAvailable.NEXTGENUI_ENABLED){var n=$L(".ts-fxd-sc");n&&n.length>0&&n.hasClass("lftmnu-fxd-ntfn")&&n.removeClass("lftmnu-fxd-ntfn")}if(crmNTCDetailView.loadUptoCount=10,crmNTCDetailView.lastLoadedCount=10,crmNTCDetailView.globalScrollFlag=!1,$(".notifyBodyEle").removeClass("on"),t&&-1!==t&&t>=crmNTCDetailView.loadUptoCount&&(crmNTCDetailView.loadUptoCount=t+1,crmNTCDetailView.lastLoadedCount=t+1),!SalesSignalsWrapper.isSignalIFrameOpen&&!featuresAvailable.NEXTGENUI_ENABLED){var i=$("#freezeBackGround");i.addClass("tbFreezelayer"),renderingUtils.showFreezeLayer(),i.on("click",(function(){var e=$("#freezeBackGround");crmNTCDetailView.closeDetailView(),($("#showOneFeed").is(":visible")||$("#showSignalPop").is(":visible"))&&e.off("click").attr("onclick","javascript:sE(event);")}))}var l=(e=$(e)).closest(".ntc-entity-group"),s=l.data("ntc-entityobj"),r=e.find(".innerNotify li:lt("+crmNTCDetailView.loadUptoCount+")"),o=$.map(r,(function(e){e=$(e);var t=JSON.parse(e.attr("data-ntcobj"));return t.NOTIFICATIONID=e.data("notification-id"),t}));e.find(".innerNotify li").length>crmNTCDetailView.loadUptoCount&&(crmNTCDetailView.globalScrollFlag=!0),SalesSignalsWrapper.isSignalIFrameOpen&&($("#ntcDivContent").show(),$("#signalBusinessCard").show(),$("#showSignalPopIframe").fadeIn()),$(".ntc-entity-active").removeClass("ntc-entity-active"),l.addClass("ntc-entity-active");var c=l.hasClass("ntc-unread");c&&l.removeClass("ntc-unread"),SalesSignalsWrapper.isSignalIFrameOpen?SalesSignals.showSignalSidePopup(e,o,s):a.showSignalSidePopup(e,o,s);var d=s.entityId,m=s.moduleSysRefName,p=s.assosciatedModuleName,u=s.is_appointment_enabled,g=EmailSendingUtil.isSendMailPermissionAvailableForCurrentProfile(m);s.isSendMailAvailable=g,crmNTCDetailView.populateBusinessCard(d,m,p,u),crmNTCDetailView.populateDetailView(o,s,c),crmNTCDetailView.iframeLoadedNtcIds=[],crmNTCDetailView.loadWidgetsInViewPort(),SalesSignalsWrapper.isSignalIFrameOpen||crmNTCDetailView.SetSignalDetailHeight()}))}},crmNTCDetailView.showMoreSignalsDetails=function(){var e=0,t=$(".ntc-entity-group.ntc-entity-active"),a=t.find("div.notificationgrpListRow"),n=t.data("ntc-entityobj"),i=a.find(".innerNotify li").length,l=a.find(".innerNotify li:gt("+(crmNTCDetailView.lastLoadedCount-1)+")"),s=$.map(l,(function(t){if(++e<=crmNTCDetailView.loadUptoCount){t=$(t);var a=JSON.parse(t.attr("data-ntcobj"));return a.NOTIFICATIONID=t.data("notification-id"),a}}));crmNTCDetailView.lastLoadedCount=parseInt(crmNTCDetailView.lastLoadedCount)+parseInt(crmNTCDetailView.loadUptoCount);var r=Handlebars.templates.signalDetailViewTemplate({notificationObjs:s});$("#ntcInnerDivContent").append(r),crmNTCDetailView.populateDetailView(s,n),crmNTCDetailView.SetSignalDetailHeight(),i<=crmNTCDetailView.lastLoadedCount&&(crmNTCDetailView.globalScrollFlag=!1)},crmNTCDetailView.closeDetailView=function(){"block"===$("#emailalert").css("display")&&closealertMail("emailalert");var e=$("#showOneFeed"),t=$("#showSignalPop"),a=featuresAvailable.NEXTGENUI_ENABLED;if(e.is(":visible")||t.is(":visible")){e.hide(),t.hide(),t.empty(),a||renderingUtils.hideFreezeLayer(),crmNTC.globalToggleFlag=0,crmNTCDetailView.resetToggleClass(),crmNTCDetailView.iframeLoadedNtcIds=[];var n=$("#freezeBackGround");$(".ntc-entity-group").removeClass("ntc-entity-active"),a||(n.removeClass("tbFreezelayer"),n.removeAttr("onclick"),n.off("click").attr("onclick","javascript:sE(event);")),$("html").css({overflow:""})}if(a){var i=$L(".ts-fxd-sc");i&&i.length>0&&!i.hasClass("lftmnu-fxd-ntfn")&&i.addClass("lftmnu-fxd-ntfn")}},crmNTCDetailView.populateDetailView=function(e,t,a){for(var n=e.length,i=0;i<n;i++){var l=e[i];crmNTCDetailView.populateDetailViewContent(l,t,a)}crmNTCDetailView.populateSocialDetailView()},crmNTCDetailView.populateSocialDetailView=function(){0!==crmNTCDetailView.socialSignalsQueue.length&&("undefined"==typeof crmSocial?crmNTCDetailView.loadSocialJS(crmNTCDetailView.renderSocialSignalsDetails):crmNTCDetailView.renderSocialSignalsDetails())},crmNTCDetailView.populateDetailViewContent=function(e,t,a){var n=e.signal.namespace;if(n===crmNTC.MAIL_INCOMING||n===crmNTC.MAIL_INCOMING_NEW||n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT||n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW)if(!1===e.ISSEEN&&a)crmNTCDetailView.showMailContent(e,t);else{var i=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.js","crm-competitors-utilities.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.css"],ResourceConstants.CRMClient);Lyte.injectResources(i.concat(l),void 0,(function(){crmNTCDetailView.mailDetailView(e,t)}))}else if(-1!=crmNTC.SURVEY_TYPES.indexOf(n))crmNTCDetailView.surveyDetailView(e,t);else if(-1!==[crmNTC.MAILTRACKING_OPEN,crmNTC.MAILTRACKING_CLICK,crmNTC.MAILTRACKING_BOUNCE,crmNTC.MAILTRACKING_OPEN_NEW,crmNTC.MAILTRACKING_CLICK_NEW,crmNTC.MAILTRACKING_BOUNCE_NEW].indexOf(n))crmNTCDetailView.mailDetailView(e,t);else if(n===crmNTC.SALESIQ_CHAT_MISSED||n===crmNTC.SALESIQ_CHAT_MISSED_NEW)crmNTCDetailView.missedChatDetailView(e,t);else if(-1!==[crmNTC.CAMPAIGN_OPEN,crmNTC.CAMPAIGN_CLICK,crmNTC.CAMPAIGN_BOUNCE,crmNTC.CAMPAIGN_SOFT_BOUNCE,crmNTC.CAMPAIGN_OPEN_NEW,crmNTC.CAMPAIGN_CLICK_NEW,crmNTC.CAMPAIGN_BOUNCE_NEW,crmNTC.CAMPAIGN_SOFT_BOUNCE_NEW].indexOf(n))crmNTCDetailView.campaignDetailView(e,t);else if(-1!=crmNTC.SUPPORT_TYPES.indexOf(n))crmNTCDetailView.supportDetailView(e,t);else if(-1!=crmNTC.FB_TYPES.indexOf(n)||-1!=crmNTC.TWITTER_TYPES.indexOf(n)){var s={notificationObj:e,entityObj:t};crmNTCDetailView.socialSignalsQueue.push(s)}else n===crmNTC.CALL_MISSED||n===crmNTC.CALL_MISSED_NEW?crmNTCDetailView.missedCallDetailView(e,t):e.signal.namespace===crmNTC.PLATFORM_EXTENSION_SIGNAL?crmNTCDetailView.platformExtensionSignal(e,t):e.signal.namespace===crmNTC.MESSAGE_NEWMESSAGE||e.signal.namespace===crmNTC.MESSAGE_READ?crmNTCDetailView.businessMessageDetailView(e,t):crmNTCDetailView.commonDetailView(e,t)},crmNTCDetailView.commonDetailView=function(e,t){var a=Handlebars.templates.signalCommonDetailView({notificationObj:e,entityObj:t});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.populateBusinessCard=function(e,t,a,n){var i="/crm/v2.2/"+t+"/"+e,l={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:i,data:"apply_fields=business_card&include=fields",type:"GET",headers:l,success:function(e){if(e){for(var i=[],l=e.fields,s=e.data[0],r=l.length,o=Crm.userDetails.TELEPHONY_ENABLED,c=0;c<r;c++){var d=l[c],m=s[d.api_name];if(d.uitype=d.ui_type,d.displaylabel=d.field_label,d.zcqaId="value_"+d.field_label,d.colname=d.column_name,d.forBC=!0,d.separator&&m&&(m=Search.formatNumber(m.toString())),d.defaultvalue=m,d.displayValue=m,d.outbound=o,null!==m&&"object"==typeof m&&(d.defaultid=m.id,d.defaultvalue=m.name,d.displayValue=m.name),void 0!==d.lookup.module&&void 0!==d.lookup.module.api_name)if(t===Crm.userDetails.MODULE_LIST.Visits.module_name)d.lookupmodule=a;else{var p=d.lookup.module.id,u=store.peekRecord("module",p).module_name;d.lookupmodule=u}118==d.uitype&&(d.returntype=d.rollup_summary.return_type),d.fromss=!0;var g=EmailSendingUtil.isSendMailPermissionAvailableForCurrentProfile(t);i.push({fieldObj:d,forBC:!0,module:t,is_appointment_enabled:n,isSendMailAvailable:g})}var h=$(Handlebars.templates.signalBusinessCardContent(i));$("#ntcBcContent").html(h),crmNTCDetailView.SetBcDivDetailHeight()}}})},crmNTCDetailView.showSignalSidePopup=function(e,t,a){var n=$("#notificationscontainer").css("top"),i=$L("#notificationscontainer").css("zIndex"),l=$("#wmstoolbar"),s=l.length?l.innerHeight():28,r=Handlebars.templates.signalDetailView({entityObj:a,notificationObjs:t});Handlebars.registerPartial("signalIframeDetailView",Handlebars.templates.signalIframeDetailView);var o=Handlebars.templates.signalWidgetPopupContainer();$("html").css({overflow:"hidden"}),$("#notificationDiv").append(o),$("#showSignalPop").html(r).css({top:n,display:"block",bottom:s,overflow:"initial"}).addClass("signal-open"),i&&$("#showSignalPop").html(r).css({zIndex:i})},crmNTCDetailView.SetSignalDetailHeight=function(){setTimeout((function(){var e=renderingUtils.windowHeight,t=renderingUtils.tabLayerOuterHeight()+renderingUtils.tabLayerTop(),a=$("#ntcDivContent"),n=$("#wmstoolbar"),i=n.length?n.innerHeight():28,l=parseInt(e-(36+t+i));crmNTC.windowSize.wwidth=renderingUtils.windowWidth,a.css({height:l}),$("#showSignalPop").css({top:t}),crmNTCDetailView.resetToggleClass()}),300)},crmNTCDetailView.resetToggleClass=function(){if(0===crmNTC.globalToggleFlag){var e=$("#showSignalPop"),t=$("#ntcDivContent"),a=e.find(".ntc-businessCard").attr("id");crmNTCDetailView.minimumToggleWidth>crmNTC.windowSize.wwidth?(e.addClass("signal-bc-hidden"),$("#"+a).addClass("oH").css({width:"0"}),t.css({"margin-left":"0",width:"100%"})):(e.removeClass("signal-bc-hidden"),t.css({"margin-left":"",width:""}),$("#"+a).removeClass("oH ntc-businessCard-toggled ntc-bc-simpletoggle").css({width:""}))}},crmNTCDetailView.SetBcDivDetailHeight=function(){var e,t,a,n,i=$(".signalPopContent"),l=$(".ntc-bc-header"),s=$("#wmstoolbar");e=$("#tabLayer").innerHeight(),t=s.length?s.innerHeight():28,a=parseInt(renderingUtils.windowHeight-(e+t));var r=i.css("padding-top"),o=i.css("padding-bottom"),c=l.innerHeight(),d=$("#ntcBcContent"),m=void 0===d.css("padding-top")?"0px":d.css("padding-top"),p=void 0===d.css("padding-bottom")?"0px":d.css("padding-bottom");n=a-(c+parseInt(r)+parseInt(o)+parseInt(m)+parseInt(p)),d.css({height:n}),thirdPartyUtils.bindPerfectScroll("#ntcBcContent",{wheelSpeed:1,preventOnEnd:!0,preventHorizontal:!0}),$("#freezeBackGround").css({height:"",width:""})},crmNTCDetailView.showMailContent=function(e,t){var a=e.metadata,n=e.signal.namespace,i=a.MID,l=a.USERID?a.USERID:Crm.userDetails.USER_ID,s=t.module,r=t.entityId,o="Sent",c="ALLUSERSMAILS";n!==crmNTC.MAIL_INCOMING&&n!==crmNTC.MAIL_INCOMING_NEW&&n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT&&n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||(o="Received",c=a.mailType);var d=t.entityEmail,m=t.entitySecondaryEmail,p=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=viewMail",u="";"NULL"===m||void 0===m?(u+="&msgid="+i+"&user_id="+l+"&module="+s+"&entId="+r+"&mailType="+c+"&sentOrReceived="+o+"&flag=false&source=signalDetailView&notificationId="+e.id,d&&"NULL"!==d&&(u+="&entEmailId="+encodeURIComponent(d))):u+="&msgid="+i+"&user_id="+l+"&module="+s+"&entId="+r+"&mailType="+c+"&sentOrReceived="+o+"&entEmailId="+encodeURIComponent(d)+"&secondaryEmailId="+encodeURIComponent(m)+"&flag=false&source=signalDetailView&notificationId="+e.id,"di-notification"!==e.from||n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT&&n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||(u+="&isZiaNotificationsView=true"),u+="&"+csrfParamName+"="+encodeURIComponent(csrfToken);var g="";"NULL"===m||void 0===m?(g+="viewMailForSignal('"+i+"','"+l+"','"+s+"','"+r+"','"+c+"','"+o+"','"+d+"',true,undefined",(n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT||n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||Crm.userDetails.EMAIL_THREAD_VIEW)&&("di-notification"===e.from?g+=",'"+e.id+"',true":g+=",'"+e.id+"',false",n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT&&n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||(g+=",true")),g+=")"):(g+="viewMailForSignal('"+i+"','"+l+"','"+s+"','"+r+"','"+c+"','"+o+"','"+d+"',true,'"+m+"'",(n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT||n===crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||Crm.userDetails.EMAIL_THREAD_VIEW)&&("di-notification"===e.from?g+=",'"+e.id+"',true":g+=",'"+e.id+"',false",n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT&&n!==crmNTC.MAIL_INCOMING_COMPETITORS_ALERT_NEW||(g+=",true")),g+=")");var h=new crmRequestPool;commonUtils.showHideLoadingDiv(!0),h.initiate({action:p,data:u,success:function(t){commonUtils.showHideLoadingDiv(!1);var a="";try{a=JSON.parse(t).message}catch(e){a=""}if(""!==a){var i=$("#ntc-detailv-content-"+e.id),l=Handlebars.templates.signalErrorMessage({notificationType:n,error_message:a});i.html(l)}else{i=$("#ntc-detailv-content-"+e.id);var s=Handlebars.templates.signalEmailContent({notificationObj:e,mailPoupupLink:g});i.html(s);var r=$("#emailDetailIframeContent"+e.id);r.on("load ",(function(){setTimeout((function(){document.getElementById("emailDetailIframeContent"+e.id).contentWindow.document.write(t)}),0),i.removeClass("p20").addClass("mB20"),r.contents().find("body").css("overflow","hidden");e.id;setTimeout((function(e){var t=$("#emailDetailIframeContent"+e),a=t.contents(),n=$("#ntcEmailIframeWrap"+e);a.find("body").css("margin","0");var i=n.width(),l=a.width(),s=parseInt(a.height())+10;a.find(".emailDetailContentDivOuter").removeAttr("style","");var r=a.find("#ntcIframeEmailContentDiv");if(r.length){var o=$("#ntcInnerDivContent").width(),c=$(".ntc-emailframe").css("padding-left"),d=r[0].scrollWidth;t.css({width:l,height:s}).show();var m=parseInt(o)-parseInt(c);d>i&&(t.addClass("hasPerfectScrollbar"),r.css({width:m}),thirdPartyUtils.bindPerfectScroll(r,{wheelSpeed:1,preventOnEnd:!1,preventHorizontal:!1}))}}),200)}))}}})},crmNTCDetailView.showMailContentInner=function(e,t){var a=$("#ntc-detailv-content-"+e.NOTIFICATIONID);a.find(".ntc-foot-links").hide(),a.find(".ntc-busyBtn").show(),crmNTCDetailView.showMailContent(e,t),Crm.trackSpotLightAction("CRM Signals - View EMail")},crmNTCDetailView.mailDetailView=function(e,t){var a=Handlebars.templates.signalEmailDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.surveyDetailView=function(e,t){var a=Handlebars.templates.signalSurveyDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.missedChatDetailView=function(e,t){var a=Handlebars.templates.signalMissedChatDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a),crmNTCDetailView.setShowMoreLink(e.id)},crmNTCDetailView.missedCallDetailView=function(e,t){var a=Handlebars.templates.signalMissedCallDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.campaignDetailView=function(e,t){var a=Handlebars.templates.signalCampaignDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.supportDetailView=function(e,t){var a=Handlebars.templates.signalSupportDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.businessMessageDetailView=function(e,t){e.metadata.message=decodeURIComponent(e.metadata.message.replace(/\+/g,"%20")),e.metadata.message=e.metadata.message.length>200?e.metadata.message.substring(0,200)+"...":e.metadata.message;var a=Handlebars.templates.signalBusinessMessageDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.socialDetailView=function(e,t){crmNTCDetailView.includeSocialBasicInfo(e),crmSocialUtil.processPostForSalesSignals(e);var a=Handlebars.templates.signalSocialDetailView({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a),crmNTCDetailView.setShowMoreLink(e.id)},crmNTCDetailView.platformExtensionSignal=function(e,t){var a=Handlebars.templates.signalPlatformExtension({entityObj:t,notificationObj:e});$("#ntc-detailv-content-"+e.id).html(a)},crmNTCDetailView.includeSocialBasicInfo=function(e){var t=e.signal.namespace,a=e.metadata;-1!=crmNTC.FB_TYPES.indexOf(t)?(a.network="facebook",t!==crmNTC.SOCIAL_FB_DM&&t!==crmNTC.SOCIAL_FB_DM_NEW||(a.convo=!0)):-1!=crmNTC.TWITTER_TYPES.indexOf(t)&&(a.network="twitter",a.text=a.message,t!==crmNTC.SOCIAL_TW_DM&&t!==crmNTC.SOCIAL_TW_DM_NEW||(a.type="message"),delete a.message)},crmNTCDetailView.getSocialNetworkType=function(e){var t="twitter",a=e.NOTIFICATIONTYPE;return-1!=crmNTC.FB_TYPES.indexOf(a)&&(e.metadata.network="facebook",t=e.metadata.network),t},crmNTCDetailView.campaignDetailViewPopup=function(e,t,a,n){var i="//"+RebrandLinkUtil.getProperty("ZCAMPAIGNURL")+"/"+t+"&crmgnum="+Crm.userDetails.ZGID;if(crmNTCDetailView.loadIframeDetailView(e,i),Crm.trackSpotLightAction("CRM Signals - View Campaign"),void 0===t||""===t)crmNTCDetailView.loadCampaignPreviewUrl(e,a,n);else{i="//"+RebrandLinkUtil.getProperty("ZCAMPAIGNURL")+"/"+t+"&crmgnum="+Crm.userDetails.ZGID;crmNTCDetailView.loadIframeDetailView(e,i)}},crmNTCDetailView.supportDetailPopupView=function(e,t){if(""!==crmNTCDetailView.supportPortalName&&""!==crmNTCDetailView.supportZgid){if(null!==crmNTCDetailView.supportPortalName&&null!==crmNTCDetailView.supportZgid)if(Crm.trackSpotLightAction("CRM Signals - View Support"),crmNTCDetailView.newDesk)deskInteg.showDeskPopupForWidgets(t);else{var a=Crm.userDetails.isCrmPlusDomain?window.location.host:document.domain.includes("zcrm.zoho")?RebrandLinkUtil.getProperty("ZCRMURL"):RebrandLinkUtil.getProperty("CRMURL"),n=RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+a,i="//"+RebrandLinkUtil.getProperty("ZSUPPORTURL")+"/support/"+crmNTCDetailView.supportPortalName+"/ShowEntityInfo.do?module=Cases&id="+t+"&isCrmCall=true&crmsupportzgid="+crmNTCDetailView.supportZgid+"&showThreads=true&frameorigin="+n;crmNTCDetailView.loadIframeDetailView(e,i)}}else crmNTCDetailView.populateSupportIntegDetails(crmNTCDetailView.supportDetailView,e,t)},crmNTCDetailView.surveyDetailPopupView=function(e,t,a,n){Crm.trackSpotLightAction("CRM Signals - View Survey");var i=crmNTCDetailView.processSurveyEmail(n),l="//"+RebrandLinkUtil.getProperty("ZSURVEYURL")+"/view_crm_response.do?uniqueid="+t+"&responseid="+a+"&zcrmemail="+encodeURIComponent(i)+"&sales_signal_view=true";crmNTCDetailView.loadIframeDetailView(e,l)},crmNTCDetailView.socialDetailViewPopup=function(e){if(Crm.trackSpotLightAction("CRM Signals - View Social",{Network:n}),"Twitter_Message__s"===(e=JSON.parse(e)).NOTIFICATIONTYPE||"Facebook_Message__s"===e.NOTIFICATIONTYPE){var t=Handlebars.templates.signalPopupDetailView(),a=$("#signalPopupViewContent");a.html(t),crmNTCDetailView.setDetailViewPopupHeight()}var n=crmNTCDetailView.getSocialNetworkType(e);if(e.metadata.brand_id){var i=networkUtils.returnDependencyFiles(["crm-social-helper.js","crm-social-related-list.js","crm-social-common-models.js","crm-social-convo-inner-new.js","crm-social-post-detail-outer.js","crm-social-post-detail.js","crm-social-signal-models.js"],ResourceConstants.CRMClient),l=networkUtils.returnDependencyFiles(["crm-social-common.css"],ResourceConstants.CRMClient),s=i.concat(l).concat(networkUtils.returnDependencyFiles(["crm-social-related-list.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT));Lyte.injectResources(s,void 0,(function(){if($("#signalPopupViewContent .popup-model-content").addClass("p0"),e.metadata.thread_id){(t=Lyte.registeredMixins["crm-social-integration"]).getMessageDetail(void 0,e.metadata.brand_id,n,e.metadata.thread_id,void 0,e.metadata.post_id,"sales_signals")}else{var t=Lyte.registeredMixins["crm-social-tab_actions"],a=e.metadata.tweet_id?e.metadata.tweet_id:e.metadata.post_id;t.getParentPost(e.metadata.brand_id,a,void 0,n,void 0,void 0,!1,"sales_signals")}}))}else{var r=crmNTCDetailView.getSocialParams(e);(new crmRequestPool).initiate({action:crmSocial.url,data:r,success:function(t){var i=JSON.parse(t);if(i.error){var l=null,s=i.error;"notAdmin"===s?(l="crm.nsocial.start.denied",s="crm.signal.error.social.permission.text"):"no_data"===s?(l="crm.tw.err.admin.title",s="crm.social.integ.error.tweet.notfound"):(l="crm.signal.error.social.acc.deleted.heading.text",s="facebook"===n?"crm.signal.error.social.fb.account.removed.text":"crm.signal.error.social.tw.account.removed.text");var r=Handlebars.templates.signalErrorMessage({notificationType:"social",error_heading:l,error_message:s});a.find(".popup-model-content").addClass("signal-popup-error"),(c=$("#signalPopupInnerDiv")).html(r),a.find("#loadMsg").hide()}else{e.metadata.fb_conversation_id&&(i.thread_id=e.metadata.thread_id);var o=a.find("#feed_detail_head").outerHeight();a.find("#loadMsg").hide(),i=crmSocialUtil.processPostForDetailView(i),crmNTCDetailView.socialRegisterPartial(),i.isSignalDetailView=!0;var c=$L("#signalPopupInnerDiv");a.find(".popup-model-content").removeClass("signal-popup-error"),c.html(Handlebars.templates.PostDetail(i)).find("#feed_detail_inner_div").wrap('<div id="feed_detail_outer_div"></div>'),c.find("#feed_detail_outer_div").css("overflow","hidden"),crmNTCDetailView.socialDetailViewPopupHt(),a.find("#feed_detail_head_outer").animate({scrollTop:o},800),c.find("#feed_detail_head_outer").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1})}}})}},crmNTCDetailView.socialDetailViewPopupHt=function(){var e,t,a=null,n=null,i=null,l=$("#signalPopupViewContent").find(".popup-model-content"),s=parseInt(l.innerHeight())-(parseInt(l.css("padding-top"))+parseInt(l.css("padding-bottom"))),r=(a=$("#signalPopupInnerDiv")).find("#response.ntcReply"),o=a.find(".kso_feed_hd").outerHeight(),c=$("#kso_feed_hd").innerHeight(),d=r.show().outerHeight();a.css({height:s}),r.show(),n=a.find("#feed_detail_outer_div"),i=a.find("#feed_detail_head_outer"),n.css({height:s}),t=parseInt(d);var m=parseInt(c),p=parseInt(o);e=parseInt(s-(t+m+p)),i.css({height:e}),thirdPartyUtils.unbindPerfectScroll("#ntcDivContent"),$("#ntcDivContent").removeClass("ps-container oH"),i.addClass("oH"),a.find("#feed_detail_head_outer").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!0}).addClass("oH"),setTimeout((function(){i.css({height:e})}),300)},crmNTCDetailView.loadIframeDetailView=function(e,t){var a=$("<iframe>",{src:t,id:"crmNTCDetailIframe",frameborder:0,scrolling:"auto",height:"480",width:"100%",load:function(){$("#loadMsg").hide()}}),n=Handlebars.templates.signalPopupDetailView(),i=$("#signalPopupViewContent");i.html(n),$("#signalPopupInnerDiv").html(a),crmNTCDetailView.setDetailViewPopupHeight(),i.find(".popup-model-content").removeClass("signal-popup-error")},crmNTCDetailView.setDetailViewPopupHeight=function(){var e=$("#signalPopupViewContent"),t=SalesSignalsWrapper.isSignalIFrameOpen?$("#showSignalPopIframe"):$("#showSignalPop"),a=t.css("top"),n=renderingUtils.windowOuterHeight-175,i=parseInt(t.css("width"))-60;e.find(".popup-model-content").css({"max-height":n+"px",width:i}),e.find("iframe").css({height:n-60}),e.show(),showAnimatePopup("signalPopupViewContent"),t.length&&t.is(":visible")&&e.css({top:a}),renderingUtils.freezeBackground(),$("#FreezeLayer").css({display:"block",opacity:".1","z-index":31})},crmNTCDetailView.hideDetailViewPopup=function(){hideAnimatePopup("signalPopupViewContent"),$("#signalPopupViewContent").empty(),$("#SignalWidgetPopup").empty(),$("#FreezeLayer").fadeOut().css({"z-index":""})},crmNTCDetailView.socialRegisterPartial=function(){Handlebars.registerPartial("CommentTemplate",Handlebars.templates.CommentTemplate),Handlebars.registerPartial("ReplyList",Handlebars.templates.ReplyList),Handlebars.registerPartial("twReply",Handlebars.templates.twReply),Handlebars.registerPartial("ReplyToComment",Handlebars.templates.ReplyToComment),Handlebars.registerPartial("ConvoTemplate",Handlebars.templates.ConvoTemplate),Handlebars.registerPartial("fbPostDetail",Handlebars.templates.fbPostDetail),Handlebars.registerPartial("twPostDetail",Handlebars.templates.twPostDetail),Handlebars.registerPartial("gpPostDetail",Handlebars.templates.gpPostDetail)},crmNTCDetailView.getFbParams=function(e){var t={network:"facebook"},a=e.metadata;t.feedid=a.post_id;var n=e.NOTIFICATIONTYPE;return n!==crmNTC.SOCIAL_FB_DM&&n!==crmNTC.SOCIAL_FB_DM_NEW||(t.message=!0,t.feedid=a.fb_conversation_id),t},crmNTCDetailView.getTwParams=function(e){var t={network:"twitter"},a=e.metadata;return t.feedid=a.tweet_id,e.NOTIFICATIONTYPE===crmNTC.SOCIAL_TW_DM&&(t.message=!0,t.feedid=a.thread_id),t},crmNTCDetailView.getSocialParams=function(e){var t={},a=e.NOTIFICATIONTYPE;-1!=crmNTC.FB_TYPES.indexOf(a)?t=crmNTCDetailView.getFbParams(e):-1!=crmNTC.TWITTER_TYPES.indexOf(a)&&((t=crmNTCDetailView.getTwParams(e)).bio=!0);var n=e.metadata;return t.brid=n.brid,t.action="get_feed",t},crmNTCDetailView.populateSocialPermissions=function(e){var t={action:"get_permissions"};(new crmRequestPool).initiate({action:crmSocial.url,data:t,success:function(t){var a=JSON.parse(t);void 0!==a.permissions&&(crmSocialUtil.perm={},$.each(a.permissions,(function(e,t){crmSocialUtil.perm[e]=t}))),e()}})},crmNTCDetailView.ntcShowMore=function(e){var t=$(e).closest(".ntc-detailv-detail"),a=t.find(".ntc-detailv-para"),n=parseInt(a[0].scrollHeight);a.css({height:crmNTCDetailView.maxShowMoreHt}),t.removeClass("ntc-detailv-wrap").addClass("ntc-detailv-expanded"),a.css({height:n}),t.find(".ntc-det-more").hide()},crmNTCDetailView.populateSupportIntegDetails=function(e,t,a){var n=Crm.getCrmBasePath()+"/NotificationCenterDetailView.do?action=getSupportIntegDetails";(new crmRequestPool).initiate({action:n,data:{},success:function(n){n.supportPortalName&&n.supportZgid?(crmNTCDetailView.supportPortalName=n.supportPortalName,crmNTCDetailView.supportZgid=n.supportZgid,crmNTCDetailView.newDesk=!1):n.newDesk&&n.portalName?(crmNTCDetailView.supportPortalName=n.portalName,crmNTCDetailView.supportZgid=n.crmsupportzgid,crmNTCDetailView.newDesk=!0,deskInteg.populateIntegDetails(n)):(crmNTCDetailView.supportPortalName=null,crmNTCDetailView.supportZgid=null,crmNTCDetailView.newDesk=null),e&&e(t,a)}})},crmNTCDetailView.processSurveyEmail=function(e){return-1!==e.indexOf(":::")?e.split(":::")[1]:e},crmNTCDetailView.showDetailView=function(e){var t=null,a=$(e);$(".notifyBodyEle").removeClass("on"),a.addClass("on");var n=parseInt($("li.on").index()),i=a.data("notification-id"),l=$("#ntc-detailv-"+i);if(crmNTC.isSignalDetailViewVisible()?l.length<=0&&($("#showSignalPop").hide(),t=a.closest(".notificationgrpListRow"),crmNTCDetailView.showFullDetailView(t,n)):(t=a.closest(".notificationgrpListRow"),crmNTCDetailView.showFullDetailView(t,n)),l.length>0){var s=$(".nc-dlabel");s.removeClass("highlight-detailview"),$L("#ntcDivContent").scrollTo(l,{duration:200}),l.find(".nc-dlabel").addClass("highlight-detailview"),setTimeout((function(){s.removeClass("highlight-detailview")}),5e3)}},crmNTCDetailView.getDetailViewSocialParams=function(e){var t={},a=e.signal.namespace;t.NOTIFICATIONTYPE=a;var n={};return e.metadata.brand_id&&(n.brand_id=e.metadata.brand_id),-1!=crmNTC.FB_TYPES.indexOf(a)?(n.brid=e.metadata.brid,n.post_id=e.metadata.post_id,a!==crmNTC.SOCIAL_FB_DM&&a!==crmNTC.SOCIAL_FB_DM_NEW||(n.fb_conversation_id=e.metadata.fb_conversation_id,n.thread_id=e.metadata.thread_id),t.metadata=n):-1!=crmNTC.TWITTER_TYPES.indexOf(a)&&(n.brid=e.metadata.brid,n.tweet_id=e.metadata.tweet_id,"Twitter_Message__s"===a&&(n.thread_id=e.metadata.thread_id),t.metadata=n),t},crmNTCDetailView.setShowMoreLink=function(e){if(crmNTC.isSignalDetailViewVisible()){var t=0,a=$("#ntc-detailv-content-"+e),n=a.find(".ntc-detailv-para");n.length&&(t=n[0].scrollHeight),t>crmNTCDetailView.maxShowMoreHt&&(a.addClass("ntc-detailv-wrap"),a.find(".ntc-foot-links").before('<a href="javascript:;" class="crm-base-font-size showMoreLink cP" onclick="crmNTCDetailView.ntcShowMore(this)">See More</a>'))}},crmNTCDetailView.showSignalActivityDiv=function(e){var t=$(e),a=$("#signalsActivityDiv"),n=parseInt(t.position().left+t.outerWidth()/2-a.innerWidth()/2),i=parseInt(t.position().top+t.outerHeight()+10);a.css({top:i,left:n}),a.toggle()},crmNTCDetailView.loadCampaignPreviewUrl=function(e,t,a){var n="//"+RebrandLinkUtil.getProperty("ZCAMPAIGNURL")+"/api/contact/cmpinfo?contactid="+t+"&campaignid="+a+"&crmgnum="+Crm.userDetails.ZGID;(new crmRequestPool).initiate({action:n,data:{},type:"GET",crossDomain:!0,success:function(t){var a=(t=JSON.parse(t)).campaignprevirew;crmNTCDetailView.loadIframeDetailView(e,a)}})},crmNTCDetailView.showMoreSignalsDetailsOnScroll=function(){crmNTCDetailView.loadWidgetsInViewPort(),crmNTCDetailView.globalScrollFlag&&crmNTCDetailView.showMore()&&(crmNTCDetailView.showMoreSignalsDetails(),Crm.trackSpotLightAction("CRM Signals - Notf Scrolling"))},crmNTCDetailView.storeIdForLoadedIframes=function(){crmNTCDetailView.iframeLoadedNtcIds.push(event.target.id.split("_")[1])},crmNTCDetailView.loadWidgetsInViewPort=function(){for(var e=$(".ntcPlatformIframeWrap"),t=e.length,a=0;a<t;a++){var n=(r=e[a]).id.split("_")[1],i=crmNTCDetailView.iframeLoadedNtcIds.contains(n),l=renderingUtils.isElementInViewport(r);if(!i&&l){var s="ntcPlatformIframeSwitch_"+n;document.getElementById(s).click();var r,o="signalPlatformIframeContent_"+n;(r=document.getElementById(o)).onload=crmNTCDetailView.storeIdForLoadedIframes}}},crmNTCDetailView.showMore=function(){var e=$L("#ntcDivContent");return e[0].scrollHeight-e.scrollTop()-15<=e.outerHeight()},crmNTCDetailView.toggleSignalBusinessCard=function(){crmNTC.globalToggleFlag=1;var e=$("#ntcDivContent"),t=$("#showSignalPop"),a=t.find(".ntc-businessCard");a.hasClass("ntc-businessCard-toggled")?(a.css({width:a.data("exp-width")}),e.css({"margin-left":"",width:""}),a.removeClass("ntc-bc-simpletoggle ntc-businessCard-toggled"),t.removeClass("signal-bc-hidden"),a.delay("1000").css({width:"",border:""})):(a.data("exp-width",parseInt(a.css("width"))-1),t.addClass("signal-bc-hidden"),a.addClass("oH ntc-businessCard-toggled ntc-bc-simpletoggle").css({width:"0"}),e.css({"margin-left":0,width:"100%"})),e.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend ",(function(){var e=$("#ntcDivContent");crmNTCDetailView.toggleSignalBusinessresizeIframeWidth(),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend ")}))},crmNTCDetailView.toggleSignalBusinessresizeIframeWidth=function(){var e=parseInt($("#ntcInnerDivContent").width())-parseInt($(".ntc-emailframe").css("padding-left"));$("#ntcInnerDivContent iframe.hasPerfectScrollbar").each((function(){var t=$(this).attr("id");$("#"+t).contents().find("#ntcIframeEmailContentDiv").css({width:e})}))},crmNTCDetailView.renderSocialSignalsDetails=function(){for(var e=crmNTCDetailView.socialSignalsQueue.length,t=0;t<e;t++){var a=crmNTCDetailView.socialSignalsQueue[t].notificationObj,n=crmNTCDetailView.socialSignalsQueue[t].entityObj;crmNTCDetailView.socialDetailView(a,n)}crmNTCDetailView.socialSignalsQueue=[]},crmNTCDetailView.loadSocialJS=function(e){crmNTC.new_social?networkUtils.loadFeatureScripts(["zcrm_zsoTab.js",networkUtils.getI18nJSUrl("social")],(function(){e()})):networkUtils.loadFeatureScripts(["zohocrm_zsocial.js"],(function(){crmNTCDetailView.populateSocialPermissions(e)}))},crmNTCDetailView.loadBMConversation=function(e){networkUtils.openUrl(Crm.getCrmBasePath()+"/tab/Messages/"+e)};var EntityEmail={globalDealPopupVisibility:!1,showDealPopup:function(e,t,a){EntityEmail.removePopUps();var n=$(e),i=0!==$("#selectMails").parents().find("crm-emails-related-list").length,l=i?$("#"+t).closest(".ecnBodyTxt").parent().parent():n.closest(".mailcontDiv"),s=l.data("dealid"),r=l.data("dealname"),o="canvas"==Lyte.Router.getRouteInstance().routeName,c=$("crm-emailsrl-canvas-view");if(Crm.userDetails.EMAIL_THREAD_VIEW){let e=t.substr(t.indexOf("_")+1),a=store.peekRecord("view_email",e);a&&a.mailData&&a.mailData.linked_deal&&(s=a.mailData.linked_deal.id,r=a.mailData.linked_deal.name)}var d,m,p=$("#module").val(),u=$("#id").val();if("Contacts"===p)m=u,d=$("#primEmail").val();else if("Potentials"===p){m=$("#cntId").val(),d=$("#primEmail").val(),o&&(m=c.attr("associated-cont-id"));var g=$L("#dealOnlyDropDown");if(g.length>0){var h=g[0].component.data.ltPropSelected;if(h&&"dealsOnly"!==h&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL){m=$L("#contactRolesDropDown")[0].component.data.ltPropSelected;var C=$L("crm-rl-users-list")[0].component.data.crObj;if(C.prim_contact.length>0&&C.prim_contact[0].id===m)d=C.prim_contact[0].email;else for(var f=C.contact_role.length,_=0;_<f;_++)if(C.contact_role[_].id===m){d=C.contact_role[_].email;break}}}}else if("Accounts"==p){var N=$("#contactSelDropdownInAcc");"ALL"==N.val()||"ALL"==N.attr("lt-prop-selected")?m=l.data("contactid"):(m=N.val(),d=$("#contactSelDropdownInAcc option:selected").attr("email"),(i||o)&&(m=N.attr("lt-prop-selected"),d=$('lyte-drop-item[data-value="'+m+'"]').data("email")))}if(!Crm.userDetails.CONTACT_ROLES_EMAILS_RL||Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&(!moduleRecordMapping.Contacts.visible||!moduleRecordMapping.Contacts.viewable||g&&0===g.length)){if(!m||""===m||"null"===m)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.relatedList.deals.error")+".",ltPropDuration:"3000",ltPropShow:!0}});if(!d||""===d||"null"===d)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.relatedList.deals.error")+I18n.getMsg("crm.label.Email")+".",ltPropDuration:"3000",ltPropShow:!0}})}var v=n.offset().top+n.outerHeight()+10,T=n.closest("td").offset().left,E=$L("#dvinner");E=0===E.length?$("#detailcanvascontainer"):E;var I=v-E.offset().top+E.scrollTop()-50,P=function(){var e;if(v=n.offset().top+n.outerHeight()+10,T=n.offset().left,a){var l={assoPotentialToId:t,name:"potDealOptions",dealId:s,dealName:r};$("body").append(Handlebars.templates.EmailPopUps(l)),e=$("#potDealOptions"),T-=e.outerWidth()/2}else{var c={assoPotentialToId:t,name:"associateDeal",dealName:r,dealId:s};$("body").append(Handlebars.templates.EmailPopUps(c)),e=$("#ldealInfo"),T-=80,e.draggable({handle:"#draggableHandle"})}Crm.userDetails.RTL_ENABLED&&i?T-=e.outerWidth()/2:i||o||(T-=80),e.css({top:v,left:T,"z-index":20}),setTimeout((function(){E.scroll((function(){EntityEmail.removePopUps()}))}),100)};if(n.offset().top+160>renderingUtils.windowHeight){var S=I+"px";E.animate({scrollTop:S},300,P)}else P()},showDVDealPopup:function(){$("#emailDetailIframeContent").contents().find("#editDealOptionsInner").show()},removePopUps:function(){$("#ldealInfo").remove(),$("#ldPopup").remove(),$("#dvinner").unbind("scroll"),$("#potDealOptions").remove()},listViewChangeDeal:function(e){EntityEmail.removePopUps();let t=$("#"+e);t.length>0?renderingUtils.triggerEvent("click",t):Crm.showLookUp($("#module").val(),e,e,"Potentials","Potentials","rLEmail")},showHideDealToolTip:function(e,t){var a=$(t),n=a.closest(".mailcontDiv").data("dealname");"show"==e?EntityEmail.globalDealPopupVisibility=setTimeout((function(){var e=$("#ldPopup"),t=e.outerHeight();if(!$("#ldealInfo").is(":visible")){var i=a.position(),l=i.top,s=i.left+a.outerWidth()+20,r={name:"dealInfo",dealName:n};$("body").append(Handlebars.templates.EmailPopUps(r)),e.css({left:s,top:l-t/2+10})}}),1500):"hide"==e&&(clearTimeout(EntityEmail.globalDealPopupVisibility),$("#ldPopup").remove())},changeDealForEmail:function(e,t,a,n){var i,l=$L("#etmmModal"),s=!!l.length&&l[0].ltProp("show"),r=$L("crm-emailconversation-view"),o=$("#"+t),c=$("#emailDetailIframeContent").contents(),d=o.closest(".ecnBodyTxt").parent().parent(),m=$L("crm-emailsrl-canvas-view"),p=m.attr("associated-cont-id")?m.attr("associated-cont-id"):$L("#cntId").val(),u=""!==p&&"null"!==p,g=Crm.getCrmBasePath()+"/mailer/EntityEmailAction.do",h={},C=$L("crm-rl-users-list"),f=C.length?C[0].component:void 0;if(h.action=e,s){let e=(i=r[0]).getData("conversationList")[0];h.userId=e.owner.id,h.msgId=t.split("assoPotential_")[1],h.mailSource=i.getData("mailSource")}else if(d.length>0)h.userId=d.data("userid")?d.data("userid"):void 0,h.msgId=d.data("msgid"),h.mailSource=d.data("emailtype");else if(c){var _=c.find("#mailUserId").val();h.userId=null!==_?_:void 0,h.msgId=t.split("assoPotential_")[1];var N=c.find("#viewMailType").val();h.mailSource="ALLUSERSMAILS"==N?"CRMMASSMAIL":N}"associateDeal"===e&&(h.dealId=a),null!=csrfParamName&&null!=csrfParamName&&null!=csrfToken&&null!=csrfToken?h[csrfParamName]=csrfToken:h[parent.csrfParamName]=parent.csrfToken;var v=s?i.getData("moduleInfo.moduleName"):$("#module").val(),T=s?i.getData("moduleInfo.moduleId"):$("#id").val(),E=Lyte.Router.getRouteInstance()&&"canvas"==Lyte.Router.getRouteInstance().routeName;if("Contacts"===v){h.contactId=T;var I=$L("#primEmail").val(),P=$L("#secondMail").val();if(I&&""!==I&&"null"!==I)h.email=I;else if(P&&""!==P&&"null"!==P)h.email=P;else{if(!Crm.userDetails.CONTACT_ROLES_EMAILS_RL)return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.relatedList.deals.error")+" "+I18n.getMsg("crm.label.Email")+".",ltPropDuration:"3000",ltPropShow:!0}});if(f){var S=o.data("contactid");f.getData("crObj").contact_role.forEach((function(e){e.id===S&&(h.email=e.email)}))}}E&&(h.email=document.querySelector("crm-emailsrl-canvas-view").getData("email"))}else if("Potentials"===v){if(u){h.contactId=$("#cntId").val();I=$L("#primEmail").val(),P=$L("#secondMail").val();E&&(h.contactId=$("crm-emailsrl-canvas-view").attr("associated-cont-id"))}else h.contactId=o.data("contactid");var b=$L("#dealOnlyDropDown");if(b.length>0){var w=b[0].component.data.ltPropSelected;if(w&&"dealsOnly"!==w&&Crm.userDetails.CONTACT_ROLES_EMAILS_RL){var y=$L("#contactRolesDropDown")[0].component.data.ltPropSelected;if(h.contactId=y,!0===y.includes("_")&&f)h.contactId=o.data("contactid"),f.getData("crObj").contact_role.forEach((function(e){e.id===h.contactId&&(I=e.email)}));if(!0!==y.includes("_")){var O=$(document.querySelector("lyte-drop-item[data-value='"+y+"']")).data().email;O&&(I=O.split(",")[0])}}}if(I&&""!==I&&"null"!==I)h.email=I;else if(P&&""!==P&&"null"!==P)h.email=P;else{if(!Crm.userDetails.CONTACT_ROLES_EMAILS_RL||!(!Crm.userDetails.CONTACT_ROLES_EMAILS_RL||moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.viewable))return void _cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:I18n.getMsg("crm.relatedList.deals.error")+" "+I18n.getMsg("crm.label.Email")+".",ltPropDuration:"3000",ltPropShow:!0}});if(f){S=o.data("contactid");f.getData("crObj").contact_role.forEach((function(e){e.id===S&&(h.email=e.email)}))}}}else if("Accounts"==v){var R=$("#contactSelDropdownInAcc");if($("#isFromNewAPI").length>0)if("ALL"==R.attr("lt-prop-selected")){h.contactId=d.data("contactid");var A=$('lyte-drop-item[data-value="'+h.contactId+'"]').data("email");h.email=A}else{h.contactId=R.attr("lt-prop-selected");A=$('lyte-drop-item[data-value="'+h.contactId+'"]').data("email");h.email=null!=A?A.split(",")[0]:A}else"ALL"==R.val()?(h.contactId=d.data("contactid"),h.email=R.find('option[value="'+h.contactId+'"]').attr("email")):(h.contactId=R.val(),h.email=$("#contactSelDropdownInAcc option:selected").attr("email"))}if(r.length&&r[0].component.getData("showModal")&&Crm.userDetails.EMAIL_THREAD_VIEW){let e=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getIndexByMessageId(h.msgId),t=r[0].component.getData("conversationList")[e];return"Accounts"===v&&(v="Contacts"),h.userId=t.owner.id,h.module=v,h.dealName=n,void Lyte.registeredMixins["crm-emailconversation-view-mixin"].bulkUpdateForThreadView(h)}(new crmRequestPool).initiate({action:g,type:"POST",data:h,dataType:"json",success:function(i){if("success"===i.status){var l=store.peekRecord("emails_rl_user",d.data("msgid"));if("associateDeal"===e){var s=d.closest(".topband_dv_row");if(d.addClass("hasDeal"),d.find(".erlSubjectBodyContainer").addClass("hasDeal"),d.find(".ecnBodyTxt").addClass("hasDeal"),d.find(".crmEllipticText").addClass("hasDeal"),d.removeClass("svgAttachIcon"),d.data("dealid",a),d.data("dealname",n),s.addClass("ldHighlightRow"),void 0!==l){var o=l.data;o.linked_deal={},o.linked_deal.id=a,o.linked_deal.name=n,store.pushPayload("emails_rl_user",{content:d.data("msgid"),data:o})}let e=$("crm-emailconversation-view");if(0!==e.length){let t=store.peekRecord("view_email",h.msgId);if(t){let e={id:a,name:n},i=t.mailData;i.linked_deal=e,store.pushPayload("view_email",{id:t.id,mailData:i})}let i=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getIndexByMessageId(h.msgId);Lyte.arrayUtils(e[0].component.getData("dealArray"),"replaceAt",i,{id:a,name:n})}Crm.userDetails.EMAIL_THREAD_VIEW&&Lyte.registeredMixins["crm-emailconversation-view-mixin"].removeHighlightFromSummary(r),setTimeout((function(){s.addClass("ldAnimateHighlight")}),500),setTimeout((function(){$(".ldAnimateHighlight").removeClass("ldHighlightRow ldAnimateHighlight")}),4e3),(p=$("#emailDetailIframeContent").contents()).find('li[name="dealLiOption"]').html(I18n.getMsg("crm.relatedList.deals.unlinkdeal",I18n.getMsg(moduleRecordMapping.Potentials.singular_label)));var c={name:"dealInfoInMailDetailView",dealId:a,dealName:n,assoPotentialToId:t};p.find("#emailLinkedDeal").html(Handlebars.templates.EmailPopUps(c)).show().addClass("hasDeal");var m=$("#dealOnlyDropDown");"dealsOnly"!==m.val()&&"dealsOnly"!==m.attr("lt-prop-selected")||(T!=a?s.addClass("hide"):s.hasClass("hide")&&s.removeClass("hide"),s.siblings(".topband_dv_row").length||(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("Emails"):reloadPersonality("emailspersonality"))),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:i.message+" '"+n+"'",ltPropDuration:"3000",ltPropShow:!0}})}else if("dissociateDeal"===e){var p;d.removeClass("hasDeal"),d.find(".erlSubjectBodyContainer").removeClass("hasDeal"),d.removeData("dealid"),d.removeData("dealname"),$("#ldealInfo").remove(),(p=$("#emailDetailIframeContent").contents()).find('li[name="dealLiOption"]').html(I18n.getMsg("crm.relatedList.deals.link",I18n.getMsg(moduleRecordMapping.Potentials.singular_label))),p.find("#emailLinkedDeal").html("").hide().removeClass("hasDeal"),EntityEmail.postProcessDealDisAccociation(l,h.msgId,t,d),_cruxUtils.showCustomMessage({params:{ltPropType:"success",ltPropMessage:i.message+" '"+n+"'",ltPropDuration:"3000",ltPropShow:!0}})}}else"failure"===i.status&&"Permission not available"===i.message&&renderingUtils.displayPermissionDenied(void 0)}})},postProcessDealDisAccociation:function(e,t,a,n){var i=$("#assoPotential_"+t);n=n||i.closest(".ecnBodyTxt").parent().parent();var l=$("#dealOnlyDropDown");if("dealsOnly"===l.val()||"dealsOnly"===l.attr("lt-prop-selected")){var s=n.closest(".topband_dv_row");s.addClass("hide"),s.siblings(".topband_dv_row").length||(Crm.userDetails.isRelatedListLyteEnabled?Lyte.registeredMixins["crm-related-list-utils"].reloadPersonality("Emails"):reloadPersonality("emailspersonality"))}if(void 0!==e){$("#unlinkDeal").addClass("hide"),$("#linkDeal").removeClass("hide");var r=e.data;delete r.linked_deal,store.pushPayload("emails_rl_user",{content:n.data("msgid"),data:r})}a&&$("#"+a).attr("value",""),Lyte.registeredMixins["crm-emailconversation-view-mixin"].clearAllDataAttributes(i);var o=$("crm-emailconversation-view");if(0!==o.length){let e=store.peekRecord("view_email",t);if(e){let a=e.mailData;delete a.linked_record,delete a.linked_deal,store.pushPayload("view_email",{id:t,mailData:a})}let a=Lyte.registeredMixins["crm-emailconversation-view-mixin"].getIndexByMessageId(t);Lyte.arrayUtils(o[0].component.getData("dealArray"),"replaceAt",a,{})}},changeEmailsViewForDeals:function(e){var t=$(e).val();t=t?$(e).attr("lt-prop-selected"):t;var a=$("#selectMails"),n=0!=a.parents().find("crm-emails-related-list").length;a.addClass("onDealChange");var i,l=$L("crm-rl-users-list")[0].component;if("dealsOnly"===t)if(l.setData("isToolTipEnabled",!0),n){a.find('lyte-drop-group:not([type="2"]) lyte-drop-item').prop("disabled",!0);if((i=a.find("[data-value='"+a.attr("lt-prop-selected")+"']").parent("lyte-drop-group")).length)if("2"!=i.attr("type"))(s=a.find("[data-value='IMAP_ALL']"))&&s.length>0?a.attr("lt-prop-selected","IMAP_ALL"):a.attr("lt-prop-selected","ALL")}else{var s;if(a.find('optGroup:not([type="2"]) option').prop("disabled",!0),(i=a.find(":selected").parent("optGroup")).length)if("2"!=i.attr("type"))(s=a.find('option[value="IMAP_ALL"]'))&&s.length>0?a.val("IMAP_ALL"):a.val("ALL")}else l.setData("isToolTipEnabled",!1),n?a.find('lyte-drop-group:not([type="2"]) lyte-drop-item').prop("disabled",!1):a.find('optGroup:not([type="2"]) option').prop("disabled",!1);a.length?n?showMailsListViaAPI("","0"):(thirdPartyUtils.bindSelect2(a),renderingUtils.triggerEvent("change",a)):Crm.userDetails.CONTACT_ROLES_EMAILS_RL&&showMailsListViaAPI("","0")},linkUnlinkDeal:function(){if($("#ecnSummeryView").hasClass("hide")||0!==$("#emailDetailIframeContent").length){var e=$("#emailDetailIframeContent").contents(),t=e.find("#dealLinkId").val();if(e.find("#emailLinkedDeal.hasDeal").length){var a=$("#"+t),n=a.closest(".mailcontDiv"),i=n.data("dealid"),l=n.data("dealname");if($("#isFromNewAPI").length>0&&0===n.length){var s=a.closest("lyte-td").children("div").data();i=s.dealid,l=s.dealname}EntityEmail.changeDealForEmail("dissociateDeal",t,i,l)}else EntityEmail.listViewChangeDeal(t)}else $("#linkDeal").hasClass("hide")?EntityEmail.linkUnlinkDealForSummary("unlink_deal"):EntityEmail.linkUnlinkDealForSummary("link_deal")},linkUnlinkDealForSummary:function(e){var t=$("email-summary")[0].component.getData("message_id");if("unlink_deal"===e){var a=$("#unlinkDeal"),n=a.data("id"),i=a.data("name");EntityEmail.changeDealForEmail("dissociateDeal","assoPotential_"+t,n,i)}else EntityEmail.listViewChangeDeal("assoPotential_"+t)}},EmailUnblocking={};function emailThreadViewForSignal(e,t,a,n,i,l,s,r,o,c,d,m){if(commonUtils.showHideLoadingDiv(!0),Lyte.Component.registeredComponents["crm-emailconversation-view"])Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadViewForSignalCallBack(e,t,a,n,i,l,s,r,o,c,d,m);else{let p=getThreadViewDependentFiles();Lyte.injectResources(p,void 0,(function(){Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadViewForSignalCallBack(e,t,a,n,i,l,s,r,o,c,d,m)}))}}function getThreadViewDependentFiles(){var e=networkUtils.returnDependencyFiles(["crm-email-summary-view.js","zia-data-enrichment-util-model.js","zia-data-enrichment-util.js","crm-emailconversation-view.js","crm-emailconversation-view-helpers.js","crm-email-activity-suggestions.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-emailconversation-view.css","crm-email-summary-view.css","crm-email-activity-suggestions.css","zia/zia-common.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);let a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailthreadview")],ResourceConstants.CRM);a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("threadsummaryandtranslation")],ResourceConstants.CRM));let n=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("activityV2")],ResourceConstants.CRM),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FeedbackMechanism")],ResourceConstants.CRM),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsRelatedList")],ResourceConstants.CRM),s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Notification")],ResourceConstants.CRM),r=e.concat(t);return r=r.concat(networkUtils.returnDependencyFiles(["crm-email-intent-helper.js","email-emotions.js","zia-notification-settings.js","crm-emails-related-list.js"],ResourceConstants.CRMClient)),r=r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailintent")],ResourceConstants.CRM)),r=r.concat(a).concat(n).concat(i).concat(l).concat(s),r}function emailThreadViewForMailMagnet(){if(commonUtils.showHideLoadingDiv(!0),Lyte.registeredMixins["crm-emailconversation-view-mixin"])Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadViewForMailMagnetCallback();else{let e=getThreadViewDependentFiles();Lyte.injectResources(e,void 0,(function(){Lyte.registeredMixins["crm-emailconversation-view-mixin"].emailThreadViewForMailMagnetCallback()}))}}EmailUnblocking.hoveredOrigin="",EmailUnblocking.getEmailBounceDependentFiles=function(){var e=networkUtils.returnDependencyFiles(["crm-email-unblocking.js"],ResourceConstants.CRMClient),t=networkUtils.returnDependencyFiles(["crm-email-unblocking.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT);let a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailunblocking")],ResourceConstants.CRM),n=e.concat(t);return n=n.concat(a),n},EmailUnblocking.checkIsBlockedSelcted=function(e){if(!Crm.userDetails.EMAIL_BOUNCE_MANAGEMENT)return!1;let t=e?"Email":"Secondary_Email",a=$L("#field_"+t);if(a.length>0&&a[0].ltProp&&!0===a[0].ltProp("checked")){let e=$L("#DDV_"+t);return e.length&&e[0].ltProp&&"${BLOCKED}"===e[0].ltProp("selected")}return!1},EmailUnblocking.isEmailBounced=function(e,t){let a=!1;return!!Crm.userDetails.EMAIL_BOUNCE_MANAGEMENT&&(a="Email"===t||"EMAIL"===t,EmailUnblocking.checkIsBlockedSelcted(a))},EmailUnblocking.unblockEmailHelper=function(e,t,a,n=null,i="EMAIL",l=null,s=null){let r=$L(t),o=!0,c=null;l||"detail"===a||(l=$L("crux-smart-filter")[0].component.data.cxPropModule);let d=r.parent(),m=d.text().trim(),p=r.closest("lyte-card"),u=r.closest(".zcanvas_zcdefaultcontd"),g=r.closest("crm-detailview-fields"),h=!1;if("list"===a?(m=r.closest("lyte-yield").prev().find("lyte-text").text().trim(),n=r.closest("lyte-exptable-tr").attr("id")):!n&&p.attr("id")?n=p.attr("id").split("_")[1]:!n&&u.attr("id")&&(n=u.attr("id").split("-")[5]),"canvas"===a)n=r.closest("table").parent().attr("id").split("_")[1],o="EMAIL"===JSON.parse(d.parent().attr("data-component")).COLUMNNAME;else if("kanban"===a)o=r.hasClass("Email");else if("detail"===a){let e=g[0].component.data;l=e.module,n=e.record.id,o=r.hasClass("Email"),h=d.attr("id").includes("header")}else o="Email"===i;let C=s&&$L("#id").val()?s:n;c=o?h?"bmUnblock_header_EMAIL_"+C:"bmUnblock_EMAIL_"+C:h?"bmUnblock_header_ADDN_EMAIL_"+C:"bmUnblock_ADDN_EMAIL_"+C,r.addClass(c),c="."+c,EmailUnblocking.hoveredOrigin=c,EmailUnblocking.unblockEmailFromListView(l,n,m,o,c)},EmailUnblocking.emailUnblockingMouseOut=function(){EmailUnblocking.hoveredOrigin=""},EmailUnblocking.bulkEmaiUnblock=function(e,t){if(Lyte.Component.registeredComponents["crm-email-unblocking"])Lyte.registeredMixins["crm-email-unblocking-mixin"].bulkEmaiUnblock(e,t);else{let a=EmailUnblocking.getEmailBounceDependentFiles();Lyte.injectResources(a,void 0,(function(){Lyte.registeredMixins["crm-email-unblocking-mixin"].bulkEmaiUnblock(e,t)}))}},EmailUnblocking.unblockEmailFromListView=function(e,t,a,n,i){if(Lyte.Component.registeredComponents["crm-email-unblocking"])Lyte.registeredMixins["crm-email-unblocking-mixin"].showBounceMsgTooltipForListView(e,t,a,n,i);else{let l=EmailUnblocking.getEmailBounceDependentFiles();Lyte.injectResources(l,void 0,(function(){Lyte.registeredMixins["crm-email-unblocking-mixin"].showBounceMsgTooltipForListView(e,t,a,n,i)}))}},EmailUnblocking.unblockEmail=function(e,t,a,n,i,l,s,r,o){if(EmailUnblocking.hoveredOrigin=o,Lyte.Component.registeredComponents["crm-email-unblocking"])Lyte.registeredMixins["crm-email-unblocking-mixin"].showBounceMsgTooltip(e,t,a,n,i,l,s,r,o);else{let c=EmailUnblocking.getEmailBounceDependentFiles();Lyte.injectResources(c,void 0,(function(){Lyte.registeredMixins["crm-email-unblocking-mixin"].showBounceMsgTooltip(e,t,a,n,i,l,s,r,o)}))}};var Notes={notesPresent:[],currentFiletr:"all",isRecentFirst:!1,titleBeforeEdit:"",contentBeforeEdit:"",isFileUploaded:!1,isFileRemoved:!1,isSharedToClient:!1,attachLimit:20,fileCount:0,filesize:0,alreadyAttachSize:0,alreadyAttachCount:0,removedAttachmentsId:"",noteFullSection:"",noteChk:"",noteInEditMode:"",noteContent:"",feedsContent:"",feedCommentsContent:"",noteId:"",mentionedCommentIds:[],mentionedTagsData:[],mentionedNames:[],registerPartial:function(){$(".commonRightPanel").length?Handlebars.registerPartial("actnotesRightPanel",Handlebars.templates.CrmNotes_RightPanelNotesList):(Handlebars.registerPartial("actnotesDetailsPage",Handlebars.templates.CrmNotes_DetailsPageNotesList),Handlebars.registerPartial("actnotesSinglePage",Handlebars.templates.CrmNotes_DetailsPageSingleNote),Handlebars.registerPartial("addnewNotes",Handlebars.templates.CrmNotes_AddNewNotes),Handlebars.registerPartial("showMore",Handlebars.templates.CrmNotes_ShowMore))},selectBox:function(e,t){var a=$(t),n=$("#notesTypeHolder");if(!t||!a.hasClass("sel")){var i=a.text(),l=n.text();if(t&&i!==l){$(".selectTrigger").removeClass("selectTriggerbG"),n.attr("isallnotes","allNotes"===a.attr("id")),n.text(i),e&&null!=e||(e=$("#entityID").val());var s=$("#TotalNotesCount");0!=s.length&&s.remove(),Notes.loadNotes(e,void 0,$("#note_module").val(),void 0,void 0,t.id)}$(".Optionlist ").addClass("hide")}},showOptions:function(e){if($(".OptionlistNotesNew").show(),$(e).addClass("selNotesDrop"),Crm.userDetails.isAccessibilityConfigSupported){var t=$L("#comboBox");if(t.keyboardNavigator("presence"))t.keyboardNavigator("destroy");else{t.keyboardNavigator({scope:"#OptionlistNotesNew",highlightValue:"",child:".OptionlistNotesNewLi",selectedClass:"nonLyte_dd_focus",triggerClick:"true"})}}},hideAttachError:function(){$("#showErrorMsg").html("")},resetFileCount:function(){Notes.fileCount=0,Notes.alreadyAttachCount=0;var e=$("#alreadyAttached");null!=e&&e.html(""),Notes.filesize=0,Notes.alreadyAttachSize=0,Notes.removedAttachmentsId="",$("#fullInfoNoteDiv").slideDown()},addNoteWithAttachment:function(e,t,a,n,l){if(!Crm.userDetails.isStorageLimitReached){if($("#note_process").removeClass("addDisable"),$("#"+t).css({background:"transparent"}),$(".note_reply_div").hide(),t||(t=$$rightPanel.entityId),n||(n=$$rightPanel.currentModule),1==$(e).find("[name='notefile']").length)return 0!=Notes.fileCount||null!=$(e).find("#alreadyAttached").find("#alreadyAttachCount")[0]&&$(e).find("#alreadyAttached").find("#alreadyAttachCount")[0].value>0?Notes.addNote(t,a,n,void 0,void 0,l,!0,Notes.removedAttachmentsId):Notes.addNote(t,a,n,void 0,void 0,l);var s=$(e).find("[name='notefile']").length;if(Notes.filesize=Notes.alreadyAttachSize,0===(s-=1)){if(""==trimBoth($(e).find("[name='notefile']")[0].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;if("application/x-ms-dos-executable"==(r=$(e).find("[name='notefile']")[0].files[0].type))return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;Notes.filesize+=$(e).find("[name='notefile']")[0].files[0].size}for(i=0;i<s;i++){if(""==trimBoth($(e).find("[name='notefile']")[i].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;var r;if("application/x-ms-dos-executable"==(r=$(e).find("[name='notefile']")[i].files[0].type)||"application/x-msdownload"==r)return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;Notes.filesize+=$(e).find("[name='notefile']")[i].files[0].size}return Notes.filesize>1024*Notes.attachLimit*1024?(alert(I18n.getMsg("crm.attach.restriction.relatedlist",Notes.attachLimit)),!1):(Notes.addNote(t,a,n,void 0,void 0,l,!0,Notes.removedAttachmentsId),!0)}},editFileAttach:function(e,t,a){Notes.isFileRemoved=!0,$(e).parent().parent().remove(),Notes.fileCount--,Notes.alreadyAttachCount--,Notes.alreadyAttachSize-=a,Notes.removedAttachmentsId+=t+";",Notes.validateSave(),Notes.fileCount<5&&$("#note_desktop").show()},toogleNotesVersion:function(e){if(!e||!$(e).hasClass("sel")){""!==Notes.noteInEditMode&&Notes.cancelEdit(Notes.noteInEditMode);var t=$("#note_module"),a=0!==t.length&&0!==t.val().trim().length?t.val():Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],n=new crmRequestPool,i=Crm.getCrmBasePath()+"/specific/noteattach.do?actionType=toogleNotesVersion",l=document.getElementById("relNEID"),s=l.value?l.value:Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],r={};r.id=s,r.module=a,networkUtils.setCsrfParam(r),n.initiate({action:i,data:r,success:function(e){var t=document.getElementById("relParentId");Notes.loadNotes(l.value,void 0,$("#note_module").val(),t.value,e),Crm.userDetails.CUSTOMIZE_INFO.Notes_Desc="true"!=e},error:function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error"),ltPropWrapperClass:"crmCenterAlert"}})}})}},getExtensionGroup:function(e){var t="file";if("txt"===e||"pdf"===e||"html"===e||"xml"===e)return t=e;var a={png:["jpeg","jpg","gif","png","webp","bmp","svg"],word:["doc","docx","odt","rtf"],excel:["csv","xls","xlsx","ots","xlsm","ods","numbers","fcs","bks","rdf"],ppt:["odp","pps","pot","pptx","ppt"],movie:["avi","wmv","mp4","mpeg","mpg","mov","flv","mkv","webm"],mp3:["mp3","ogg","oga","wma","m4p","m4a","au","3gp"],zip:["zip","zipx","tar","gz","z","cab","rar","bz2","lzh","7z","img","iso"]};for(var n in a)if(a.hasOwnProperty(n)){var i=a[n];if($.inArray(e,i)>=0){t=n;break}}return t},initComponent:function(e){var t,a=document.getElementById("relNEID").value,n=document.getElementById("note_module").value,i=$("#fullInfoNoteDiv");t=e?$(".notesEditModeAct"):i,i[0].dropzone&&i[0].dropzone.destroy(),Notes.smartPromptHandler(e),t.FileUploader({previewsContainer:"#noteMoreFiles",createImageThumbnails:!1,needWMSFallback:!0,needVirusFilter:!0,virusFilter:{okMessage:function(){var e=this.getFilesWithMaliciousContents();return this.files.length===e.length?I18n.getMsg("crm.fileuploader.message.savenoteswithoutattachments"):this.files.length-e.length<2?I18n.getMsg("crm.fileuploader.message.noteattachremainingfile"):I18n.getMsg("crm.fileuploader.message.noteattachremainingfiles")},isAlert:function(){return!1}},clickable:"#note_desktop",previewTemplate:'<div class="dz-preview dz-file-preview cBoth"><div class="dz-details"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size"><span data-dz-size></span></div></div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message"><span class="virusAlert"></span>&nbsp;<span data-dz-errormessage></span></div><div class="dz-remove ico-close-small svgIcons" data-dz-remove></div>',uploadMethod:"zfsng",needFolderUpload:!1,maxFiles:5-Notes.alreadyAttachCount,totalFilesize:(2e7-Notes.alreadyAttachSize)/1e6,parallelUploads:1,progressRatio:.9,save:"#save_comment",cancel:"#cancel_comment",init:function(){var e,t=this;t.on("proceed",(function(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("note_subject"),a=document.getElementById("noteContentTxt");if(a&&t){var n=a.value.trim(),i=t.value.trim();if(""==n&&""==i)return a.focus(),$(a).attr("placeholder",I18n.getMsg("crm.general.addnote")),!1}Crm.trackSpotLightAction("Note Added"),Notes.addNote.call(this)})),$("#alreadyAttached").click((e=t,function(t){t.preventDefault(),t.stopPropagation(),e.options.maxFiles=5-Notes.alreadyAttachCount,e.options.totalFilesize=(2e7-Notes.alreadyAttachSize)/1e6})),t.on("error",(function(e){if(e.previewElement){e.virus&&$(e.previewElement).find(".virusAlert").css("display","inline-block");var t=e.previewElement.querySelector("[data-dz-errormessage]");t&&t.innerHTML.length>20&&$(t).attr("title",t.innerHTML)}})),t.on("reset",(function(){Notes.isFileUploaded=!1,Notes.validateSave()})),t.on("batchcallbackcomplete",(function(){Notes.isFileUploaded=!0,Notes.validateSave()})),t.on("customizepreviewtemplate",(function(e){var t=$(a),a=e.previewElement.querySelector("[data-dz-name]"),n=e.name;n&&n.length>20&&t.attr("title",n);var i="";n&&""!==n&&-1!==n.lastIndexOf(".")&&(i=n.slice(n.lastIndexOf(".")+1)),(a=e.previewElement.querySelector(".dz-filename"))&&t.prepend(FileUploader.createElement('<span class="mR15 '+Notes.getExtensionGroup(i)+'-icon"></span>')),(a=e.previewElement.querySelector("[data-dz-size]"))&&(a.innerHTML="("+this.options.getFileSize(e.size)+")")}))},uploadBean:{crmHandback:{entityId:a,module:n,action:"notes"},user:{zgid:Crm.userDetails.ZGID},uploadTo:"EntityAttachments",folderId:"WS_ATTACHMENT_LIBRARY"}})},smartPromptHandler:function(e){try{if(Crm.userDetails.IS_SMART_PROMPT_AVAILABLE){var t=$L("#advancePromptModel")[0];t&&t.ltProp("show",!1),"edit"!==e&&"open"!==e||$L("#notesSmartPromptIcon")[0]||!$L("#smartPromptNotesOutlet")[0]||Lyte.Component.render("crm-zia-smart-prompt-icon",{iconType:"link",focusedArea:"notes",id:"notesSmartPromptIcon",noteType:"content"},"#smartPromptNotesOutlet")}}catch(e){murphy.error(e)}},validateSave:function(){var e=$("#note_subject").val().trim(),t=$("#noteContentTxt").val().trim(),a=$("#sharetoclient").prop("checked");(""!=e||""!=t)&&(e!=Notes.titleBeforeEdit||t!=Notes.contentBeforeEdit||Notes.isFileUploaded||Notes.isFileRemoved||a!=Notes.isSharedToClient)?$("#save_comment").prop("disabled",!1):$("#save_comment").prop("disabled",!0)},destroyMentionsComponent:function(e){var t=$L("#"+e);if(t.length>0){t.cruxMention({destroy:!0}),t.removeClass("lyteMentionsAdded");var a=Notes.mentionedCommentIds.indexOf(e);a>-1&&Notes.mentionedCommentIds.splice(a,1),Notes.mentionedTagsData=[]}},initNote:function(e,t){var a=$(".commonRightPanel").length;if(wmsLoaded){var n=document.getElementById("dvcreatenotespan"),i=document.getElementById("note_content"),l=document.getElementById("note_subject"),s=document.getElementById("title_tr"),r=document.getElementById("noteContentTxt"),o=document.getElementById("showHideTitle"),c=document.getElementById("addTitleSpan");if("open"==e){if(Notes.mentionedTagsData=[],i&&("none"==i.style.display||a)){a||(s.style.display="none"),$(".note_reply_div").html("");var d=$("#note_parent_td");""===Notes.noteFullSection&&(Notes.noteFullSection=d.html()),d.html(Notes.noteFullSection),i.style.display="block",Notes.noteContent="",$("#note_content").show()}var m=$("#noteContentTxt");a||m.focus(),$("#fullInfoNoteDiv").addClass("openNotes"),m.attr("placeholder",I18n.getMsg("crm.general.addnote")),Notes.initComponent(),bindMentions(this,"noteContentTxt")}else if("close"==e){if(Notes.isFileUploaded=!1,Notes.isFileRemoved=!1,Notes.titleBeforeEdit="",Notes.contentBeforeEdit="",Notes.isSharedToClient=!1,$(".feed_newpost_textarea_bg").removeClass("openNotes"),i&&(""==i.style.display||a))if(a||(s.style.display="",i.style.display="none",$("#note_subject").hide(0),c.style.display="",$(o).slideUp(300)),n.style.display="none",$(".note_reply_div").hide(),document.getElementById("editNoteId").value="null",l.value="",r.value="",Notes.noteContent="",Notes.destroyMentionsComponent("noteContentTxt"),a)document.getElementById("relNEID").value=$$rightPanel.entityId,document.getElementById("note_module").value=$$rightPanel.currentModule;else if(Crm.userDetails.isRelatedListLyteEnabled){var p=document.getElementById("relNEID"),u=document.getElementById("note_module");p&&u&&(p.value=Lyte.Globals.get("relatedList.entityId"),u.value=Lyte.Globals.get("relatedList.module"))}else document.getElementById("relNEID").value=crmRelatedList.EntityId,document.getElementById("note_module").value=crmRelatedList.Module;if(t){var g=$("#newNoteDivId");$("#fullInfoNoteDiv").html(g.html()),g.html("").hide(),getElemById("cancel_comment").setAttribute("onclick","initNote('close')")}a&&($("#note_content").closest(".note_edit_div").html(""),$("#note_parent_td").html(Notes.noteFullSection),setTimeout(Notes.initComponent,1e3)),$("#fullInfoNoteDiv").removeClass("openNotes"),$("#noteContentTxt").attr("placeholder",I18n.getMsg("crm.general.addnote")+"...")}else if("addtitle"==e){var h=$("#note_subject");$("#editModuleDet").is(":visible")?h.attr("onkeydown",'Notes.editNotesTitle("edit")'):h.attr("onkeydown",'Notes.editNotesTitle("add")'),a||(c.style.display="none",$(o).slideDown(300)),h.focus()}"undefined"!=typeof event&&$(event.target).closest("#krp_Rightpanel_InfoContainer").length>0&&$$rightPanel.setPerfectScrollBar("krp_Rightpanel_InfoContainer","krp_Rightpanel_InfoInnerContainer",!0),Notes.smartPromptHandler(e)}},doReply:function(e,t){if("null"==document.getElementById("editNoteId").value){document.getElementById("relNEID").value=e,document.getElementById("note_module").value=t;var a=!1;if(FileUploader.instances){for(var n=FileUploader.instances.length,i=0;i<n;i++)FileUploader.instances[i].batchId===$("#fullInfoNoteDiv").attr("batchid")&&(document.getElementById("noteContentTxt").focus(),a=!0);0!=n&&0!=a||Notes.initNote("open")}}},addNote:function(e,t,a,n,i,l,s){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;Notes.isFileRemoved=!1,Notes.isFileUploaded=!1,Notes.titleBeforeEdit="",Notes.contentBeforeEdit="",Notes.isSharedToClient=!1;var r=$("#noteContentTxt"),o=document.getElementById("noteContentTxt"),c=$("#sharetoclient").prop("checked"),d=$("#noteContentTxtInSalesinbox");s&&"mailMagnet"===s?(r=$("#mailMagnetNoteContentTxt"),Notes.noteContent=r.val(),o=document.getElementById("mailMagnetNoteContentTxt")):s&&"fromSalesinbox"===s&&(r=d,Notes.noteContent=r.val(),o=document.getElementById("noteContentTxtInSalesinbox"));var m=document.getElementById("note_subject"),p=m.value.trim(),u=Notes.noteContent.trim();if(""==p&&""==u)return!1;if(Crm.userDetails.CLIENT_ACCOUNT&&(c=!0),o&&o.value.length>65535)return renderingUtils.showCustomAlert(I18n.getMsg("crm.message.limit.exceed",I18n.getMsg(["65535","Content"]))),!1;var g=t||document.getElementById("curUserId").value,h=!0,C=$("#note_module");a=a||(0!=C.length&&0!=C.val().trim().length?C.val():Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]);var f=!1;if("Activities"===a){a=detailView.currentModule;let e={noteModuleLen:C.length,noteModuleVal:C.val(),transitionParam:Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],newModuleName:a};murphy.addCustomTracking({message:JSON.stringify(e),name:"activities semodule notes",type:"custom event"}),f=!0,murphy.error(new Error("Activities as notes semodule"+JSON.stringify(e)))}var _=!1,N=n||Notes.noteChk,v=document.getElementById("relNEID");if(v||e){var T=e||v.value;T=T||Lyte.Router.getRouteInstance().transition.info.dynamicParams[1];var E=document.getElementById("editNoteId")?document.getElementById("editNoteId").value:null,I="",P="";if(null!=E&&"null"!=E)h=!1,I="&actionType=Edit&notesid="+(P=E.split("::"))[0]+"&entityid="+P[1];else{if("true"!=N)return renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error","")),!1;null!=E&&"null"!=E||(I="&actionType=create")}var S={};networkUtils.setCsrfParam(S),S.rangeValue=null,S.startIndex=null,S.endIndex=null,S.action="onlyNotes",S.returnAnchor="krp"===i?"krp":"listViewAnchor",S.subject=p,S.description=u,S.id=T,S.module=a,S.shareToClient=c,h&&(S.ownerName=null,S.ownerId=g);var b=Crm.getCrmBasePath()+"/specific/noteattach.do?cvid=null&recordNum=null"+I;if(this instanceof FileUploader&&0!==this.options.successfullyUploadedFiles.length)b+="&uploadIds="+this.getParamsFromAllContents(this.options.successfullyUploadedFiles,"uploadId"),_=!0;null!=Notes.removedAttachmentsId&&""!==Notes.removedAttachmentsId&&(S.removedAttachmentsId=Notes.removedAttachmentsId),$(".outlookqCreate").length&&(S.isfromOutlookRightPanel=!0),(new crmRequestPool).initiate({action:b,type:"POST",data:S,success:function(c){if((c=JSON.stringify(c)).indexOf("ALERTERROR:::")>-1)_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error"),ltPropWrapperClass:"crmCenterAlert"}});else{if(c.indexOf("INVALID_ID:::")>-1)return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.form.rule.refresh.cases"),ltPropType:"error"}}),void Notes.cancelEdit(E.split("::")[0]);if(c.indexOf("INVALID_USERID:::")>-1)return _cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.note.error.message"),ltPropSecondaryMessage:I18n.getMsg("crm.note.error.invalid.user"),ltPropButtons:[{type:"accept",appearance:"primary",text:"Okay",cxPropZcqa:"button_1"}]}}),void Notes.cancelEdit(E.split("::")[0]);if(-1==c.indexOf("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEEDS"))if(-1==c.indexOf("CRM_ERROR_PAGE_500::::EXCEPTION")){if("{}"==c||'""'==c)return _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error"),ltPropWrapperClass:"crmCenterAlert"}}),void Notes.cancelEdit(E.split("::")[0]);s&&"fromSalesinbox"===s?$("#noteContentTxtInSalesinbox").hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("noteContentTxtInSalesinbox"):Notes.destroyMentionsComponent("noteContentTxt"),Notes.noteContent="";var d=$("#save_comment"),p=$("#note_parent_td");if(r.attr("placeholder",I18n.getMsg("crm.general.addnote")),l&&(d.removeAttr("onClick"),d.attr("onClick",'Crm.trackSpotLightAction("Note Added",{"Version":"NEW UI"});return Notes.addNote()')),""===Notes.noteFullSection&&(Notes.noteFullSection=p.html()),s&&"fromSalesinbox"===s||(p.length&&($("#note_content").remove(),$("#fullInfoNoteDiv,.note_reply_div").slideUp(),$(".notesLoading").show(),$("#fullInfoNoteDiv").removeClass("openNotes")),p.html(Notes.noteFullSection)),c.indexOf("timelineId")>-1)try{var u=JSON.parse(c);if(u.timelineId&&""!==u.timelineId){var g=u.timelineId,h=$("#tl_cruxNotes_"+g);if(h.length>0){h.children().remove();var C=$("#tl_noteOpen_"+g),N=$("#tl_noteHide_"+g),v=document.querySelector("crm-timeline-logs").component,T=v.data.notesInOpen,I="timelineLog_"+g,P=T.indexOf(I);T.splice(P,1),v.setData("notesInOpen",T),C.addClass("dIB").removeClass("dN"),N.addClass("dN").removeClass("dIB"),h.slideUp()}}}catch(e){murphy.error("Exception while deleting related notes under associated timeline logs :: "+e)}f&&(a="Activities"),Notes.addNoteCallBack(e,t,a,n,i,l,c,_,m,o,s);var S=$L("#advancePromptModel")[0];S&&S.ltProp("show",!1),Crm.userDetails.isRelatedListLyteEnabled&&"detail"===Lyte.Router.getRouteInstance().routeName&&$L("crux-note")[0]&&(store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})})))}else alert(I18n.getMsg("crm.unable.to.process.request"));else renderingUtils.showCustomAlert(I18n.getMsg("crm.newfree.limit.exceed"))}},error:function(e){return 403===e.status?(_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error"),ltPropWrapperClass:"crmCenterAlert"}}),void Notes.cancelEdit(E.split("::")[0])):void renderingUtils.showCustomAlert(I18n.getMsg("crm.contact.hierarchy.business_card_permission_error"))}}),this instanceof FileUploader&&this.clean(),Notes.mentionedNames=[],Notes.mentionedTagsData=[],$("#note_process").attr("onClick",'Notes.initNote("open")')}featuresAvailable&&featuresAvailable.ZIA_SUMMARY&&Crm.isSupportedModuleForZiaSummary(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])&&Notes.injectNotesSummaryComponent("addNote")},getNoteSummaryDom:function(e){return"outlet"===e?$L("#ziaNotesSummayOutlet")[0]:$L("crm-zia-notes-summary")[0]},injectNotesSummaryComponent:function(e,t){try{if(!window.clientPortalName){var a=e,n=t;Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-zia-notes-summary.js","crm-zia-feedback.js"],ResourceConstants.CRMClient),networkUtils.returnDependencyFiles(["crm-zia-notes-summary.css","crm-zia-feedback.css"],ResourceConstants.CRMClient,ResourceConstants.LESSDEFAULT),networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaSummary")],ResourceConstants.CRM)],void 0,(function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],i=Notes.notesPresent,l=Notes.notesPresent.length;"addNote"===a&&void 0===Notes.getNoteSummaryDom("icon")&&i&&l>=0?Lyte.Component.render("crm-zia-notes-summary",{module:e,recordId:t,notesCount:0===l?1:l},"#ziaNotesSummayOutlet"):"deleteNote"===a&&Notes.getNoteSummaryDom("icon")&&0===parseInt($("#TotalNotesCount").val())?Notes.getNoteSummaryDom("outlet").removeChild(Notes.getNoteSummaryDom("outlet").firstElementChild):"pageLoad"===a&&void 0===Notes.getNoteSummaryDom("icon")&&i&&l>0?Lyte.Component.render("crm-zia-notes-summary",{module:e,recordId:t,notesCount:l},"#ziaNotesSummayOutlet"):"timeLine"===a&&void 0===Notes.getNoteSummaryDom("icon")&&i&&l>0?Lyte.Component.render("crm-zia-notes-summary",{module:e,recordId:t,notesCount:0===l?1:l},"#ziaNotesSummayOutlet"):"toggleNotes"===a&&void 0===Notes.getNoteSummaryDom("icon")&&i&&l>0&&Lyte.Component.render("crm-zia-notes-summary",{module:e,filter:n,recordId:t,notesCount:0===l?1:l},"#ziaNotesSummayOutlet")}))}}catch(e){murphy.error(e)}},addNoteFromUpdateCallStatus:function(e,t,a,n,i,l){if(Crm.userDetails.isStorageLimitReached){var s=networkUtils.returnDependencyFiles(["datastorage.js"],ResourceConstants.CRMClient),r=networkUtils.returnDependencyFiles(["datastorage.css"],ResourceConstants.CRMClient),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")],ResourceConstants.CRM),c=s.concat(r).concat(o);Lyte.injectResources(c,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"Notes_Create"},"#mics_tipDiv")}))}var d=Notes.noteChk;if(e){if("true"!=d)return renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error","")),!1;var m={};networkUtils.setCsrfParam(m),m.rangeValue=null,m.startIndex=null,m.endIndex=null,m.action="onlyNotes",m.returnAnchor="krp"===i?"krp":"listViewAnchor",m.subject=a,m.description=t,m.id=e,m.module=n;var p=Crm.getCrmBasePath()+"/specific/noteattach.do?cvid=null&recordNum=null&actionType=create";(new crmRequestPool).initiate({action:p,type:"POST",data:m,success:function(t){if("listView"!=i){if("homePage"==i){var a=$("#entityID").val();if(null==a||t.whatid!=a&&t.contactid!=a&&t.mainEntId!=a)return}if((t=JSON.stringify(t)).indexOf("INVALID_USERID:::")>-1)return void _cruxUtils.showCustomAlert({params:{ltPropType:"error",ltPropPrimaryMessage:I18n.getMsg("crm.note.error.message"),ltPropSecondaryMessage:I18n.getMsg("crm.note.error.invalid.user"),ltPropButtons:[{type:"accept",appearance:"primary",text:"Okay",cxPropZcqa:"button_1"}]}});(!Crm.userDetails.isRelatedListLyteEnabled||Crm.userDetails.isRelatedListLyteEnabled&&"relatedList"!==i&&"detail"!==Lyte.Router.getRouteInstance().routeName)&&Notes.addNoteCallBack(e,void 0,n,void 0,i,void 0,t,!1),"relatedList"===i&&l&&("detail"===Lyte.Router.getRouteInstance().routeName&&Crm.userDetails.isRelatedListLyteEnabled||"canvas"===Lyte.Router.getRouteInstance().routeName)&&"entity"===Lyte.Router.getRouteInstance().parent.routeName&&Lyte.injectResources(networkUtils.returnDependencyFiles(["note_model.js"],ResourceConstants.CRMClient),void 0,(function(){Lyte.triggerEvent("relatedList",{res:l,callActivity:!0}),store.unloadAll("note"),store.findAll("note",{},!0,!0,{module:moduleApiMapping[$L("#module")[0].value],entityId:$L("#entityId")[0].value}).then((function(e){Lyte.triggerEvent("noteAddedOrDeleted",{allNotes:e,defaultDisplayedNotesCount:3})}))}))}}})}},addNoteCallBack:function(e,t,a,n,i,l,s,r,o,c,d){o=document.getElementById("note_subject"),c=document.getElementById("noteContentTxt");d&&"mailMagnet"===d?c=document.getElementById("mailMagnetNoteContentTxt"):d&&"fromSalesinbox"===d&&(c=document.getElementById("noteContentTxtInSalesinbox"));var m=document.getElementById("showHideTitle"),p=document.getElementById("title_tr"),u=document.getElementById("addTitleSpan"),g=$(".commonRightPanel").length;if(0==$("#noteDetails").length||0==$("#id").length||void 0!==d&&"mailMagnet"===d||void 0!==d&&"fromSalesinbox"===d)if(n&&"krp"===i){renderingUtils.removeFreezeLayer(),commonUtils.showHideLoadingDiv(),$("#qCreate").html("").hide();var h=JSON.parse(s);$$rightPanel.refreshOnCreatingNewEntity("Notes",h)}else n&&(1!=$("#mailhomecontainer").length?($("#noteCreation").hide(),document.getElementById("rmStatusMsgDiv").innerText=i,document.getElementById("rmStatusMsgDiv").style.display="block",setTimeout((function(){$("#rmStatusMsgDiv").fadeOut("slow")}),2e3)):(renderingUtils.removeFreezeLayer(),$("#qCreate").html("").hide(),setTimeout((function(){$("#mailSentSuccessfullyDiv").html("").hide()}),2e3)));else{var C=$("#model"),f=null,_=null;f=$(".commonRightPanel").length?Handlebars.templates.CrmNotes_RightPanelSingleNote:Handlebars.templates.CrmNotes_DetailsPageSingleNote;try{var N;if((N="string"==typeof s?JSON.parse(s):s).setype="Notes",Notes.addNotesClass(N),_=f(N),""==Notes.noteInEditMode){0!=C.length&&C.val().indexOf("Older")>-1?$("#actnotes").prepend(_):$("#actnotes").append(_);var v=$("#TotalNotesCount"),T=$("#dispcurrentCount"),E=$("#dispTotalNotesCount"),I=parseInt(v.val())+1;v.val(I),$("#newleft_Notes").find(".numCountn").addClass("numCountVal").text(I),T.html(parseInt(T.html())+1),E.html(parseInt(E.html())+1)}else $("#"+Notes.noteInEditMode).replaceWith(_),$("#fullInfoNoteDiv").slideDown(),Notes.noteInEditMode="";N.timelineData&&Notes.renderTimelineLogs(N,!0);var P=$(".singleNoteHighlight");P&&P.removeClass("singleNoteHighlight",3e3,void 0,(function(){$(".singleNoteBorderHighlight").removeClass("singleNoteBorderHighlight")})),Notes.processNotes(),o.value="",c.value="",$(c).attr("placeholder",I18n.getMsg("crm.general.addnote")),document.getElementById("editNoteId").value="null",$(".commonRightPanel").length||(document.getElementById("note_content").style.display="none",p.style.display="",$(m).slideUp(300),u.style.display="");var S=$("#module");0!=S.length&&refreshFollowDiv(S.val(),"Notes"),l&&l(),$(".commonRightPanel").length||(crmListView.dropCacheOnActivityCreate(detailView.currentModule,"Notes"),crmTab.deleteFromCache(detailView.currentModule))}finally{if(Notes.resetFileCount(),g)document.getElementById("relNEID").value=$$rightPanel.entityId,document.getElementById("note_module").value=$$rightPanel.currentModule,Notes.initComponent();else{var b=$(".social_rightpanel");b=b.length?b:$("#kso_social_rightpanel"),$("#module")&&"Events"==$("#module").val()?(document.getElementById("relNEID").value=$("#entityId").val(),document.getElementById("note_module").value=$("#module").val()):b.length?(b.find("#relNEID").val($$rightPanel.entityId),b.find("#note_module").val($$rightPanel.currentModule)):Crm.userDetails.isRelatedListLyteEnabled?(document.getElementById("relNEID").value=Lyte.Globals.get("relatedList.entityId"),document.getElementById("note_module").value=Lyte.Globals.get("relatedList.module")):(document.getElementById("relNEID").value=crmRelatedList.EntityId,document.getElementById("note_module").value=crmRelatedList.Module)}}}},processNotes:function(){var e=$(".commonRightPanel").length,t=$("#actnotes").find(".singleNoteBorder");if(t&&t.length>0){var a=$(t);a.find("span[data-title]").off("hover").hover((function(){renderingUtils.zctt.showtt($(this).attr("data-title"),void 0,void 0,void 0,void 0,"tooltipzc-small")}),(function(){renderingUtils.zctt.hidett()})),a.off("hover").hover((function(){$("#noteOper_"+this.id).length<1||(e&&$(document.getElementById("noteOper_"+this.id)).prev().hide(),document.getElementById("noteOper_"+this.id).style.visibility="visible")}),(function(){$("#noteOper_"+this.id).length<1||(e&&$(document.getElementById("noteOper_"+this.id)).prev().show(),document.getElementById("noteOper_"+this.id).style.visibility="hidden")}))}0==FileUploader.instances.length&&(Notes.noteFullSection=e?Notes.noteFullSection:""),$("a.imageGallery").colorbox({photo:!0}),Notes.addPreTagWidth()},createMap:function(e,t,a,n){if($("#"+a).is(":visible")){maps_getStaticImage([e,t],a,17,"tiles","no_marker");var i=L.icon({iconUrl:networkUtils.getImageUrl("spacer.gif",ResourceConstants.CRM),iconSize:[16,16],className:"green-mp-marker"});L.marker([e,t],{icon:i}).addTo(staticMap)}else null==n?n=1:n++,n<4?setTimeout((function(){Notes.createMap(e,t,a,n)}),1e3):setTimeout((function(){Notes.createMapAfterTimeout(e,t,a)}),1e3)},createMapAfterTimeout:function(e,t,a){maps_getStaticImage([e,t],a,17,"tiles","no_marker");var n=L.icon({iconUrl:networkUtils.getImageUrl("spacer.gif",ResourceConstants.CRM),iconSize:[16,16],className:"green-mp-marker"});L.marker([e,t],{icon:n}).addTo(staticMap)},callLeafletForVisibleNotes:function(){$("#actnotes").children().each((function(){var e=this;"hiddenNotes"!=this.id&&networkUtils.loadFeatureScripts(["zohocrm_maps.js"],(function(){$(e).find("#checkin_latitude").each((function(){var e=$(this).attr("data-params"),t=(e=JSON.parse(e)).latitude,a=e.longitude,n="mapContainer_"+e.noteId;!$("#"+n).children().length>0&&Notes.createMap(t,a,n)}))}))}))},invokeLeafletFunctions:function(e){$("#"+e).find(".singleNoteBorder").each((function(){$(this).find("#checkin_latitude").each((function(){var e=$(this).attr("data-params"),t=(e=JSON.parse(e)).latitude,a=e.longitude,n="mapContainer_"+e.noteId;!$("#"+n).children().length>0&&Notes.createMap(t,a,n)}))}))},addRightPanelClass:function(e){1==e.isOlderNotes||1==e.isOlderVersionNotes?(e.selectValue="rightPanelOlder",e.recentSelectClass="sel"):(e.selectValue="rightPanel",e.selectClass="detailsNotesSection",e.recentClass="sel"),e.addNoteWidth="100%",e.showMoreWidth="w100_per"},addNotesClass:function(e){(null!=e.TotalNotesCount&&e.TotalNotesCount<=3||e.isFirstTime)&&(Notes.notesPresent=[]);var t=Notes.notesPresent.length;if(1==e.isOlderNotes||1==e.isOlderVersionNotes){if(e.selectValue="detailPanelOlder",e.recentSelectClass="sel",null!=e.notes){Notes.isRecentFirst=!0;var a=0,n=0;for((s=e.notes.length)>30&&(s=30),n=0;n<s;n++){var i=e.notes[n].nId,l=0;for(a=t-1;a>-1;a--)if(i==Notes.notesPresent[a]){e.notes.splice(n,1),l=1,s--,n--;break}l||Notes.notesPresent.push(i)}(t=Notes.notesPresent.length)>30&&Notes.notesPresent.splice(0,t-30)}}else if(e.selectValue="detailPanel",e.selectClass="detailsNotesSection",e.recentClass="sel",null!=e.notes){Notes.isRecentFirst=!1;var s,r=-1;(s=e.notes.length)>30&&(r=s-30-1);var o=0;for(n=s-1;n>r;n--){i=e.notes[n].nId,l=0;for(a=o;a<t;a++)if(i==Notes.notesPresent[a]){e.notes.splice(n,1),l=1;break}l||(Notes.notesPresent.splice(0,0,i),o++,t++)}t>30&&Notes.notesPresent.splice(30,t-30)}else"now"==e.modifiedDate&&Notes.isRecentFirst?t<30&&Notes.notesPresent.splice(0,0,e.nId):"now"==e.modifiedDate&&t<30&&Notes.notesPresent.push(e.nId);1==e.isAllNotes?(e.allnotesSelect="sel",e.isallnotes="true",e.content=I18n.getMsg("crm.label.all")):1==e.selectProjectNotes?(e.projectsSelect="sel",e.isallnotes="false",e.content=I18n.getMsg("crm.territory.label.only","Projects")):(e.contactsSelect="sel",e.isallnotes="false",e.content=I18n.getMsg("crm.territory.label.only",e.tab_label)),e.addNoteWidth="574",e.showMoreWidth="w600 dvw720"},loadNotes:function(e,t,a,n,i,l){Notes.registerPartial();var s=$("#actnotes"),r=$("#TotalNotesCount"),o=$("#showMore");if(0!=r.length)var c=r.val();var d=$("#hiddenNotes");if(t)if(c<=10){if(0!=d.length)return d.show(),o.hide(),void Notes.invokeLeafletFunctions("hiddenNotes")}else 0!=d.length&&(d.show(),Notes.invokeLeafletFunctions("hiddenNotes"));var m={};"undefined"!=typeof print_view_page&&(m.action="print");var p=Crm.getCrmBasePath()+"/specific/noteattach.do";if(m.actionType="getNotesJSON",m.entityid=e,m.module=a,0!=r.length&&null==i&&(m.TotalNotesCount=c),networkUtils.setCsrfParam(m),void 0!==n&&"null"!==n&&"undefined"!==n&&(m.actParentId=n),t){var u=document.getElementById("tIdx"),g=5;u&&(g=u.value),m.tIdx=g;var h=s.find(".singleNoteBorder").length;m.dispcurrentCount=h}getAccessibleObj("notesTypeHolder")&&"true"===getAccessibleObj("notesTypeHolder").getAttribute("isallnotes")||getAccessibleObj("Allnotes")&&getAccessibleObj("Allnotes").checked?m.isAllNotes=!0:(getObj("projectNotesOnly")&&void 0!==l&&l===getObj("projectNotesOnly").id||$("#notesTypeHolder")&&"Projects only"==$("#notesTypeHolder").text())&&(m.isProjectNotes=!0),$(".outlookqCreate").length&&(m.isfromOutlookRightPanel=!0);var C=l;(new crmRequestPool).initiate({action:p,data:m,success:function(e){e=JSON.stringify(e);var t=JSON.parse(e),a=null,n=$("#model");n.val().indexOf("rightPanel")>-1&&$(".commonRightPanel").length?(a=t.isFilter&&t.isFirstTime||t.isFirstTime||t.TotalNotesCount<=3?Handlebars.templates.CrmNotes_RightPanel:Handlebars.templates.CrmNotes_RightPanelNotesList,Notes.addRightPanelClass(t)):n.val().indexOf("rightPanel")>-1?(a=t.isFilter&&t.isFirstTime||t.isFirstTime||t.TotalNotesCount<=3?Handlebars.templates.CrmNotes_DetailsPage:Handlebars.templates.CrmNotes_DetailsPageNotesList,Notes.addRightPanelClass(t)):n.val().indexOf("detailPanel")>-1&&(a=t.isFilter&&t.isFirstTime||t.isFirstTime||t.TotalNotesCount<=3?Handlebars.templates.CrmNotes_DetailsPage:Handlebars.templates.CrmNotes_DetailsPageNotesList,Notes.addNotesClass(t));var i=a(t);t.isFilter&&t.isFirstTime||t.isFirstTime||t.TotalNotesCount<=3?($("#noteDetails").empty(),getElemById("noteDetails").innerHTML=i):($("#dispcurrentCount").empty(),document.getElementById("dispcurrentCount").innerHTML=t.currentCount,$("#dispTotalNotesCount").empty(),document.getElementById("dispTotalNotesCount").innerHTML=t.TotalNotesCount,document.getElementById("currentCount").value=t.currentCount,document.getElementById("TotalNotesCount").value=t.TotalNotesCount,document.getElementById("tIdx").value=t.tIdx,n.val().indexOf("Older")>-1?s.append(i):s.prepend(i),t.isMore||o.hide()),"0"==t.TotalNotesCount?$("#newleft_Notes").find(".numCountn").removeClass("numCountVal").text(""):$("#newleft_Notes").find(".numCountn").addClass("numCountVal").text(t.TotalNotesCount),Events.eventNoteReqSent=!1,EvalInnerScript(getElemById("noteDetails")),Notes.processNotes(),Notes.callLeafletForVisibleNotes(),Notes.renderTimelineLogs(t),$(".commonRightPanel").length&&Notes.initNote("open"),featuresAvailable.ZIA_SUMMARY&&Crm.isSupportedModuleForZiaSummary(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])&&Notes.injectNotesSummaryComponent("toggleNotes",C)}})},fetchToolTipForNotesHeader:function(e){var t=e?$(e).find("p,.tl_contentRightPatch"):void 0;if(t&&t.length>0){var a=$(e),n=t[0].innerText,i=t[0].clientWidth,l=t[0].scrollWidth,s=$("#"+e.id+"_more_entry");s&&0===s.length&&t.addClass("peNone"),i<l&&(s&&s.length>0?t.attr({"lt-prop-title":n}):a.attr({"lt-prop-title":n})),a.removeAttr("onmouseover")}},editNote:function(e,t){var a=$(".commonRightPanel").length,n=getObj("tempNote_"+e)?$("#tempNote_"+e).parents(".askziacontainer").length:$("#ncontent_"+e).parents(".askziacontainer").length,i=$("#note_process");""!=Notes.noteInEditMode&&Notes.cancelEdit(Notes.noteInEditMode),Notes.noteInEditMode=e,getObj("tempNote_"+e)?n||(hide("tempNote_"+e),hide("ncontent_"+e)):n||hide("ncontent_"+e),$("#fullInfoNoteDiv").slideUp();var l=$("#"+e),s=!1,r=!1;null!=getObj("nsharedtoclient_"+e)&&(s=!0,null!=getObj("naddedbyclient_"+e)&&(r=!0)),n||hide("ntitle_"+e),a&&$("#"+e).find(".userName").hide(),$("#"+e+" .notesBtmDet").hide(0),l.find("#noteAttachments")&&l.find("#noteAttachments").hide();var o=$("#note_parent_td");if(""===Notes.noteFullSection&&(Notes.noteFullSection=o.html()),""===o.html()&&($(".note_reply_div").html(""),o.html(Notes.noteFullSection)),o.html(""),l.find(".note_edit_div").html(Notes.noteFullSection),l.addClass("notesEditModeAct"),a||l.stop().css({background:"#eff2f4"}),Crm.userDetails.CLIENT_ACCOUNT?$("#note_content").find("#sharetoclientdiv").addClass("dN"):($("#note_content").find("#sharetoclient").prop("checked",s),s&&r&&$("#note_content").find("#sharetoclient").prop("disabled",!0)),$("#note_content").show(),"salesinbox"==$$rightPanel.rightPanelSource){var c=$(".commonRightPanel").innerWidth()-55;$("#showHideTitle .addNotesTitle").css("max-width",c)}var d=trimBoth(document.getElementById("ntitle_"+e).innerHTML),m=trimBoth(document.getElementById("noteContWithRegex_"+e).innerHTML);Notes.titleBeforeEdit=d,Notes.contentBeforeEdit=m,Notes.isSharedToClient=$("#sharetoclient").prop("checked"),Notes.mentionedTagsData=[],Notes.noteContent=escapeToHTML(m);var p="";$L("#ncontent_"+e).contents().each((function(e,t){try{if(1===t.nodeType&&null!=t.getAttribute("href").match("javascript")){var a=t.textContent.toString(),n=a.length;a.lastIndexOf(",")==n-1&&(a=a.slice(0,n-1)+a.slice(n)),p+="@"+a,Notes.mentionedNames.push(a)}else t.nodeType,p+=t.textContent.toString()}catch(e){murphy.error("Exception in edit note "+e+"\nnote content "+t.textContent.toString()+"\nnode-Type "+t.nodeType+"\nitem-details\n"+t)}}));var u=document.getElementById("note_subject"),g=document.getElementById("noteContentTxt");if(document.getElementById("editNoteId").value=e+"::"+t,document.getElementById("relNEID").value=t,document.getElementById("note_module").value=l.data("module"),""!=d?(u.value=escapeToHTML(d).trim(),Notes.initNote("addtitle")):u.value="",$("#noteContentTxt").focus(),$("#noteContentTxt").attr("placeholder",I18n.getMsg("crm.general.addnote")),g.value=escapeToHTML(p),null!=l.find("#noteAttachments")){var h="",C=0,f=0;$.each(l.find("#noteAttachments").find(".fileTitle"),(function(e,t){C++;var a=$(t),n=a.find("#fileSize").val();f+=parseInt(n,10);var i=a.find("#attachmentId").val(),l=t.title.substring(t.title.lastIndexOf("-(")+2,t.title.lastIndexOf(")")),s=t.title.substring(0,t.title.lastIndexOf("-")-1);h+='<div class="noteFileName oH crm-base-font-size"><div class=\'dIB mR0 '+Notes.getExtensionGroup(s.substring(s.lastIndexOf(".")+1))+"-icon'></div><div class=\"dIB flNameSize mR0\"><div class='fL dIB notesTitleCs mR10'>"+$ESAPI.encoder().encodeForHTML(s)+"</div><div class='fL mR10 dIB' style=\"color: var(--baseColor);\">("+l+")</div><div onclick=\"Notes.editFileAttach(this,'"+i+"',"+n+')" class="dIB smalledit noteAttachedClose cP ico-close-small svgIcons"></div></div></div>'})),Notes.fileCount=C,Notes.alreadyAttachCount=C,Notes.alreadyAttachSize=f,h+='<input type="hidden" id="alreadyAttachCount" value="'+C+'">',null!=l.find("#noteAttachments").find("#totalFilesSize")[0]&&$(l.find("#noteAttachments").find("#totalFilesSize")[0]).attr("value",f),$("#alreadyAttached").html(h),Notes.fileCount>=5&&$("#note_desktop").hide()}var _=$("#cancel_comment");if(_.removeAttr("href"),_.attr("onClick",'javascript:Notes.cancelEdit("'+e+'")'),setTimeout((function(){var e=$("#note_subject"),t=$(".addedNotesList").width()-$("#editModuleDet").width()-60,a=e[0].scrollWidth;e.css({width:a,"max-width":t})}),100),$("#note_subject").attr("onkeydown",'Notes.editNotesTitle("edit")'),FileUploader.instances)for(var N=FileUploader.instances.length,v=0;v<N;v++)FileUploader.instances[v].batchId===$("#fullInfoNoteDiv").attr("batchid")&&FileUploader.instances[v].instance.clean();i.attr("onClick",'document.getElementById("noteContentTxt").focus()'),Notes.initComponent("edit"),Notes.mentionedNames.length>0&&Notes.setMentionsTagData(!1),bindMentions(this,"noteContentTxt")},setMentionsTagData:function(e){const t=[...Notes.noteContent.matchAll("crm[[aA-zZ]*#[0-9]+#[0-9]+]crm")],a=t.length;let n;e&&(n=document.getElementById("noteContentTxt")._mIData.lyteMICollection);for(let i=0;i<a;i++){const a=t[i][0].slice(4,-4).split("#");let l,s,r={};if(e){const e=a[1];if(l=n[n.findIndex((t=>t.id===e))],!l)continue;s="Users"===l.$setype?"full_name":"name",r={$setype:l.$setype,zuid:l.zuid,id:l.id,[s]:l[s]}}else{const e=a[0];s="user"===e?"full_name":"name";r={$setype:"user"===e?"Users":"group"===e?"Groups":"Roles",id:a[1],zuid:a[2],[s]:Notes.mentionedNames[i]}}Notes.mentionedTagsData.push(r)}},cancelEdit:function(e){Notes.noteInEditMode="",Notes.mentionedTagsData=[],Notes.mentionedNames=[];var t=$(".commonRightPanel").length,a=$("#note_process");a.removeClass("addDisable"),getObj("tempNote_"+e)?show("tempNote_"+e):show("ncontent_"+e);var n=$("#"+e);$("#"+e+" .notesUserImg,#"+e+" .notesBtmDet").show(),t&&$("#"+e).find(".userName").show(),n.removeClass("notesEditModeAct"),n.css({background:"transparent"}),$("#editModuleDet").remove(),show("ntitle_"+e),$("#fullInfoNoteDiv").slideDown();var i=$("#noteOper_"+e);i.length&&(i.show(),i[0].style.visibility="hidden"),n.find("#noteAttachments")&&n.find("#noteAttachments").show(),Notes.initNote("close"),t||($("#note_parent_td").html(Notes.noteFullSection),n.find(".note_edit_div").html("")),n.find(".note_edit_div").html(""),a.attr("onClick",'Notes.initNote("open")'),$("#noteContentTxt").attr("placeholder",I18n.getMsg("crm.general.addnote")),Notes.resetFileCount()},deleteNote:function(e,t){var a=0,n=Notes.notesPresent.length;for(a=0;a<n;a++)if(Notes.notesPresent[a]==e){Notes.notesPresent.splice(a,1);break}var i=document.getElementById("note_module");if(document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value&&""===document.getElementById("note_module").value)i=document.getElementById("activitytype");var l="";if(hideAnimatePopup("deletepopup"),i){l=$("#"+e).attr("data-module");var s={},r=Crm.getCrmBasePath()+"/deletenote.do";networkUtils.setCsrfParam(s),s.type="onlyNotes",s.notesid=e,s.module=l,s.accountid=t,s.id=t,s.nextStep="relatedlist",(new crmRequestPool).initiate({action:r,type:"POST",data:s,success:function(a){if(a.indexOf("ALERTERROR:::")>-1)_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.security.error"),ltPropWrapperClass:"crmCenterAlert"}});else if(a.indexOf("INVALID_ID:::")>-1)_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.form.rule.refresh.cases"),ltPropType:"error"}});else{if(0!=$("#noteDetails").length){var n=document.getElementById("relParentId"),i=$("#TotalNotesCount");if(0!=i.length){var s=parseInt(i.val());s-=1,i.attr("value",s),0==s?($("#newleft_Notes").find(".numCountn").removeClass("numCountVal").text(""),crmTab.deleteFromCache(detailView.currentModule)):$("#newleft_Notes").find(".numCountn").text(s)}$("#"+e).slideUp(200,(function(){$("#"+e).remove(),$("#actnotes").children().length<=1&&0!=s&&Notes.loadNotes(t,!1,l,n.value)}));var r=$("#dispcurrentCount"),o=$("#dispTotalNotesCount");r.html(parseInt(r.html())-1),o.html(parseInt(o.html())-1)}featuresAvailable.ZIA_SUMMARY&&Crm.isSupportedModuleForZiaSummary(Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])&&Notes.injectNotesSummaryComponent("deleteNote")}}})}refreshFollowDiv($("#module").val(),"Notes")},addPreTagWidth:function(){var e=$("#model");(e.length>0&&"rightPanelOlder"===e.val()||e.length>0&&"rightPanel"===e.val())&&$("#noteDetails pre,#noteDetails .fdNotesTitleNew").width($(".actnotes").width()-($("#noteDetails pre").parent("td").prev("td:visible").width()+75))},editNotesTitle:function(e){var t=$("#dummyspanWidth"),a=$("#editModuleDet"),n=$("#note_subject"),i=$("#actnotes");t.text(n.val());var l=t.width()+25,s=t.width()+30+a.width();if("add"==e)a.is(":visible")?(s<=i.width()-30&&n.width(l),n.width(l)):n.width(l);else if("edit"==e){l=t.width()+15;console.log(s+","+i.width()-30),s<=i.width()-30&&n.width(l)}},notesTitleChk:function(){""==$("#note_subject").val()&&($("#showHideTitle").slideUp(300),$("#addTitleSpan").show()),$L("#noteContentTxt").focus()},showNotesTitle:function(){$("#note_subject").show().focus()},toggleNotes:function(){var e=getObj("toggleNotes");e&&("none"==e.style.display?(e.style.display="block",showToggleNote.display="block",$("#noteDetails").removeClass("dvmB40")):(e.style.display="none",showToggleNote.display="none",$("#noteDetails").addClass("dvmB40")))},showNotesDiv:function(e,t,a,n){var i="";return-1!=e.indexOf("?")&&(i=e.substring(e.indexOf("?")+1),e=e.substring(0,e.indexOf("?"))),mR(e,(function(e){var t=e;if(t.indexOf("ALERTERROR:::")>-1){var a=t.split("ALERTERROR:::");alert(a[1])}else{var i=getObj("shownotes");$(i).empty(),i.style.display="block",i.style.zIndex="21",i.style.width="650px",i.innerHTML=t,EvalInnerScript(i),mailsetCenter("shownotes"),renderingUtils.freezeBackground(),n&&($("#notesButtonDiv").hide(),$("#shownotes").css("z-index","34")),getObj("subject")&&getObj("subject").focus()}}),i),!1},onNoteFocus:function(e){try{var t=$L("#notesSmartPromptIcon")[0];t&&t.setData("noteType",e),t=void 0}catch(e){murphy.error(e)}var a=Lyte.Service.getInjected("globalAccessibilityServices").getVariable("accessibility").accessibility;a&&a.motor.standard_navigation_order.enable&&$L("#note_content").trapFocus()},newToggleNote:function(e,t){var a=document.getElementById("noteSecondInfo"),n=document.getElementById("toggleNoteText"),i="none"==document.getElementById("noteSecondInfo").style.display;a.style.display=i?"block":"none",n.innerHTML=n.innerHTML==e?t:e},noteAttach:function(e,t,a,n){var i="";fieldname=new Array("subject"),fieldlabel=new Array("Note Title"),fielddatatype=new Array("V~M");var l=I18n.getMsg("confirmmsg");if("SmallDetailView"==a&&(fieldname=new Array("note_subject"),!validationUtils.formValidate()))return!1;var s=document.getElementById("subject"),r=document.getElementById("description");if(r&&s&&""==trimBoth(s.value)&&""==trimBoth(r.value))return s.value=trimBoth(s.value),r.value=trimBoth(r.value),document.getElementById("subject").focus(),!1;if(r&&s&&(s.value=trimBoth(s.value),r.value=trimBoth(r.value)),r&&r.value.length>65535)return alert(I18n.getMsg("crm.message.limit.exceed",I18n.getMsg(["65535",document.getElementById("desc_label").value]))),!1;e.substr(e.indexOf("#")+1,e.length);if("DeleteFromDetailView"==a||"DeleteFromGSearchView"==a){if(!window.confirm(l))return!1}else if(("EditFromDetail"==a||"CreateFromDetail"==a||"EditFromDetailView"==a)&&("EditFromDetail"==a&&"CreateFromDetail"==a||(e+="&isNoteUpdated=true"),getObj("ID_NOTESPERSONALITY"))){e+="&listRelationID="+getObj("ID_NOTESPERSONALITY").value;var o="sortColumnString_"+getObj("ID_NOTESPERSONALITY").value,c="sortOrderString_"+getObj("ID_NOTESPERSONALITY").value;getObj(o)&&(e+="&sortColumnString_"+getObj("ID_NOTESPERSONALITY").value+"="+getObj(o).value),getObj(c)&&(e+="&sortOrderString_"+getObj("ID_NOTESPERSONALITY").value+"="+getObj(c).value)}if("NoForm"!=t&&(i=commonUtils.formData2QueryString(t)),"EditFromGSearch"==a||"DeleteFromGSearchView"==a){e.split("notesid=").length>1?Notes.noteId=e.split("notesid=")[1].split("&")[0]:Notes.noteId=null;var d=getObj("searchStr")?getObj("searchStr").value:$L("crm-global-search-refine")[0].component.data.searchword,m=!!getObj("userOption")&&getObj("userOption").checked,p=!1;getObj("dbSearch")&&(p=getObj("dbSearch").checked),i+="ajaxSearch=true&searchword="+encodeURIComponent(d)+"&userOption="+m+"&searchCategory=AllEntities&dbSearch="+p}else"EditFromGSearchView"==a&&(i+="&EditFromGSearch=true");return mR(e,(function(e){var t=e;if(-1!=t.indexOf("ALERTERROR:::")){var n=t.split("ALERTERROR:::");return alert(n[1]),!1}if("EditFromDetailView"==a||"EditFromGSearchView"==a)$("#shownotes").empty(),document.getElementById("shownotes").innerHTML=t,JSEvalScript(getObj("shownotes"));else if("CustomViewDetails"==a||"EditFromGSearch"==a||"DeleteFromGSearchView"==a){if("EditFromGSearch"==a||"DeleteFromGSearchView"==a){var i=$(t).find("#ajax_Notes");$("#ajax_Notes").replaceWith(i);var l=$L("crm-global-search-refine");if(l&&"DeleteFromGSearchView"===a)if(1===$L("#tableComponent_Notes")[0].component.data.content.length){var s=l[0].component.data.meta.field_details,r=s.length;for(let e=0;e<r;e++)if("Notes"===s[e].module.api_name){Lyte.arrayUtils(s,"removeAt",e,1);break}}else{var o=l[0].component.data.meta,c=Lyte.deepCopyObject(o);c.info.Notes.count=c.info.Notes.count-1,c.info.Notes.total_records_count=c.info.Notes.total_records_count-1,l[0].setData("meta",c);var d=10*Math.floor($L("#navigator_Notes")[0].component.data.endRecord/10),m=d+10,p=l[0].component.data.values.Notes;for(let e=d;e<m;e++){if(p[e].id===Notes.noteId){Lyte.arrayUtils(p,"removeAt",e,1);break}}}}commonUtils.showHideLoadingDiv(),$("#shownotes").html("").hide(),renderingUtils.removeFreezeLayer()}else Crm.userDetails.isRelatedListLyteEnabled||crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,t),commonUtils.showHideLoadingDiv(),document.getElementById("shownotes").style.display="none",$("#shownotes").empty(),renderingUtils.removeFreezeLayer()}),i),""!=n&&"EditFromDetailView"!=a&&"CancelFromDetailView"!=a&&"EditFromGSearchView"!=a&&($(getObj("bulkUpdateSuccess")).empty(),getObj("bulkUpdateSuccess").innerHTML=n,mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),2e3)),!1},printNoteAction:function(e,t,a,n,i){win=window.open(Crm.getCrmBasePath()+"/printnote.do?module="+t+"&id="+e+"&notesid="+a+"&ownerId="+n+"&ownerName="+encodeURIComponent(i)+"&step=print","PrintNoteInformation","top=30,left=150,menubar=yes,toolbar=no,location=no,status=yes,scrollbars=yes,resizable=yes,width=750,height=600")},renderTimelineLogs:function(e,t){var a=e&&e.notes?e.notes:[],n=e.related_notes_module;void 0!==n&&(n.includes("Calls")||n.includes("Tasks"))||(t&&0===a.length&&a.push(e),a&&a.forEach((function(e){var t="nid_"+e.nId,a="#"+t,i=document.querySelectorAll("[id="+t+"]"),l=i.length;if(i&&l>1)for(var s=0;s<l;s++){var r=i[s],o=!1;$(r).parents().each(((e,t)=>{o=Notes.checkIdAndSetFlag(e,t,o)})),o||r.remove()}var c=e.timelineData;if(c){var d=!0;c.timelineData&&c.timelineData.record||(d=!1),$L(a).addClass("dIB"),Lyte.Component.render("crm-timeline-log-notes",{item:c.timelineData,token:c.token,logAvailable:d,nId:e.nId,module:n},a)}})))},checkIdAndSetFlag:function(e,t,a){return"relNotesInRL"===t.id&&(a=!0),a}};function bindMentions(e,t){var a=!0===Crm.userDetails.permissions.Crm_Implied_List_Subordinate_Users,n=$L("#"+t);n.hasClass("lyteMentionsAdded")||(Notes.idForMentions=t,n.cruxMention({textboxSelector:"#"+t,queryParam:{include_lite_users:!0},cxPropContent:function(e){"transitionNotes"==Notes.idForMentions?Notes.transNoteContent=e:"noteContentTxt"==Notes.idForMentions?Notes.noteContent=e:"feed_status"==Notes.idForMentions?Notes.feedsContent=e:"CallNotes"===Notes.idForMentions?Notes.callNotesContent=e:Notes.feedCommentsContent=e,(["transitionNotes","noteContentTxt","feed_status","CallNotes"].includes(Notes.idForMentions)||Notes.idForMentions.includes("note_")||Notes.idForMentions.includes("feed_"))&&a&&(this.queryParam.user_type="subordinate_users")}}),n.addClass("lyteMentionsAdded"),"CallNotes"===t&&$("#CallNotesDiv").find(".lyteMIWrapper").css("width","102%"),"transitionNotes"==t&&$(".lyteMentionsInnerDiv").css("color","transparent"),"noteContentTxt"!=t&&"feed_status"!=t&&Notes.mentionedCommentIds.push(t)),n.focus()}